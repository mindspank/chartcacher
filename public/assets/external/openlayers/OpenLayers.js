var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var src,m,r=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),s=document.getElementsByTagName("script"),l="",i=0,len=s.length;len>i;i++)if(src=s[i].getAttribute("src"),src&&(m=src.match(r))){l=m[1];break}return function(){return l}}(),ImgPath:""};OpenLayers.Class=function(){var len=arguments.length,P=arguments[0],F=arguments[len-1],C="function"==typeof F.initialize?F.initialize:function(){P.prototype.initialize.apply(this,arguments)};if(len>1){var newArgs=[C,P].concat(Array.prototype.slice.call(arguments).slice(1,len-1),F);OpenLayers.inherit.apply(null,newArgs)}else C.prototype=F;return C},OpenLayers.inherit=function(C,P){var F=function(){};F.prototype=P.prototype,C.prototype=new F;var i,l,o;for(i=2,l=arguments.length;l>i;i++)o=arguments[i],"function"==typeof o&&(o=o.prototype),OpenLayers.Util.extend(C.prototype,o)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(destination,source){if(destination=destination||{},source){for(var property in source){var value=source[property];void 0!==value&&(destination[property]=value)}var sourceIsEvt="function"==typeof window.Event&&source instanceof window.Event;!sourceIsEvt&&source.hasOwnProperty&&source.hasOwnProperty("toString")&&(destination.toString=source.toString)}return destination},OpenLayers.String={startsWith:function(str,sub){return 0==str.indexOf(sub)},contains:function(str,sub){return-1!=str.indexOf(sub)},trim:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(str){for(var oStringList=str.split("-"),camelizedString=oStringList[0],i=1,len=oStringList.length;len>i;i++){var s=oStringList[i];camelizedString+=s.charAt(0).toUpperCase()+s.substring(1)}return camelizedString},format:function(template,context,args){context||(context=window);var replacer=function(str,match){for(var replacement,subs=match.split(/\.+/),i=0;i<subs.length&&(0==i&&(replacement=context),void 0!==replacement);i++)replacement=replacement[subs[i]];return"function"==typeof replacement&&(replacement=args?replacement.apply(null,args):replacement()),"undefined"==typeof replacement?"undefined":replacement};return template.replace(OpenLayers.String.tokenRegEx,replacer)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(value){return OpenLayers.String.numberRegEx.test(value)},numericIf:function(value,trimWhitespace){var originalValue=value;return trimWhitespace===!0&&null!=value&&value.replace&&(value=value.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(value)?parseFloat(value):originalValue}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(num,sig){var fig=0;return sig>0&&(fig=parseFloat(num.toPrecision(sig))),fig},format:function(num,dec,tsep,dsep){dec="undefined"!=typeof dec?dec:0,tsep="undefined"!=typeof tsep?tsep:OpenLayers.Number.thousandsSeparator,dsep="undefined"!=typeof dsep?dsep:OpenLayers.Number.decimalSeparator,null!=dec&&(num=parseFloat(num.toFixed(dec)));var parts=num.toString().split(".");1==parts.length&&null==dec&&(dec=0);var integer=parts[0];if(tsep)for(var thousands=/(-?[0-9]+)([0-9]{3})/;thousands.test(integer);)integer=integer.replace(thousands,"$1"+tsep+"$2");var str;if(0==dec)str=integer;else{var rem=parts.length>1?parts[1]:"0";null!=dec&&(rem+=new Array(dec-rem.length+1).join("0")),str=integer+dsep+rem}return str},zeroPad:function(num,len,radix){for(var str=num.toString(radix||10);str.length<len;)str="0"+str;return str}},OpenLayers.Function={bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));return func.apply(object,newArgs)}},bindAsEventListener:function(func,object){return function(event){return func.call(object,event||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(array,callback,caller){var selected=[];if(Array.prototype.filter)selected=array.filter(callback,caller);else{var len=array.length;if("function"!=typeof callback)throw new TypeError;for(var i=0;len>i;i++)if(i in array){var val=array[i];callback.call(caller,val,i,array)&&selected.push(val)}}return selected}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(left,bottom,right,top){OpenLayers.Util.isArray(left)&&(top=left[3],right=left[2],bottom=left[1],left=left[0]),null!=left&&(this.left=OpenLayers.Util.toFloat(left)),null!=bottom&&(this.bottom=OpenLayers.Util.toFloat(bottom)),null!=right&&(this.right=OpenLayers.Util.toFloat(right)),null!=top&&(this.top=OpenLayers.Util.toFloat(top))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(bounds){var equals=!1;return null!=bounds&&(equals=this.left==bounds.left&&this.right==bounds.right&&this.top==bounds.top&&this.bottom==bounds.bottom),equals},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(reverseAxisOrder){return reverseAxisOrder===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(decimal,reverseAxisOrder){null==decimal&&(decimal=6);var mult=Math.pow(10,decimal),xmin=Math.round(this.left*mult)/mult,ymin=Math.round(this.bottom*mult)/mult,xmax=Math.round(this.right*mult)/mult,ymax=Math.round(this.top*mult)/mult;return reverseAxisOrder===!0?ymin+","+xmin+","+ymax+","+xmax:xmin+","+ymin+","+xmax+","+ymax},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(ratio,origin){null==origin&&(origin=this.getCenterLonLat());var origx,origy;"OpenLayers.LonLat"==origin.CLASS_NAME?(origx=origin.lon,origy=origin.lat):(origx=origin.x,origy=origin.y);var left=(this.left-origx)*ratio+origx,bottom=(this.bottom-origy)*ratio+origy,right=(this.right-origx)*ratio+origx,top=(this.top-origy)*ratio+origy;return new OpenLayers.Bounds(left,bottom,right,top)},add:function(x,y){if(null==x||null==y)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+x,this.bottom+y,this.right+x,this.top+y)},extend:function(object){if(object)switch(object.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(object.lon,object.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(object.x,object.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||object.left<this.left)&&(this.left=object.left),(null==this.bottom||object.bottom<this.bottom)&&(this.bottom=object.bottom),(null==this.right||object.right>this.right)&&(this.right=object.right),(null==this.top||object.top>this.top)&&(this.top=object.top)}},extendXY:function(x,y){this.centerLonLat=null,(null==this.left||x<this.left)&&(this.left=x),(null==this.bottom||y<this.bottom)&&(this.bottom=y),(null==this.right||x>this.right)&&(this.right=x),(null==this.top||y>this.top)&&(this.top=y)},containsLonLat:function(ll,options){"boolean"==typeof options&&(options={inclusive:options}),options=options||{};var contains=this.contains(ll.lon,ll.lat,options.inclusive),worldBounds=options.worldBounds;if(worldBounds&&!contains){var worldWidth=worldBounds.getWidth(),worldCenterX=(worldBounds.left+worldBounds.right)/2,worldsAway=Math.round((ll.lon-worldCenterX)/worldWidth);contains=this.containsLonLat({lon:ll.lon-worldsAway*worldWidth,lat:ll.lat},{inclusive:options.inclusive})}return contains},containsPixel:function(px,inclusive){return this.contains(px.x,px.y,inclusive)},contains:function(x,y,inclusive){if(null==inclusive&&(inclusive=!0),null==x||null==y)return!1;x=OpenLayers.Util.toFloat(x),y=OpenLayers.Util.toFloat(y);var contains=!1;return contains=inclusive?x>=this.left&&x<=this.right&&y>=this.bottom&&y<=this.top:x>this.left&&x<this.right&&y>this.bottom&&y<this.top},intersectsBounds:function(bounds,options){if("boolean"==typeof options&&(options={inclusive:options}),options=options||{},options.worldBounds){var self=this.wrapDateLine(options.worldBounds);bounds=bounds.wrapDateLine(options.worldBounds)}else self=this;null==options.inclusive&&(options.inclusive=!0);var intersects=!1,mightTouch=self.left==bounds.right||self.right==bounds.left||self.top==bounds.bottom||self.bottom==bounds.top;if(options.inclusive||!mightTouch){var inBottom=bounds.bottom>=self.bottom&&bounds.bottom<=self.top||self.bottom>=bounds.bottom&&self.bottom<=bounds.top,inTop=bounds.top>=self.bottom&&bounds.top<=self.top||self.top>bounds.bottom&&self.top<bounds.top,inLeft=bounds.left>=self.left&&bounds.left<=self.right||self.left>=bounds.left&&self.left<=bounds.right,inRight=bounds.right>=self.left&&bounds.right<=self.right||self.right>=bounds.left&&self.right<=bounds.right;intersects=(inBottom||inTop)&&(inLeft||inRight)}if(options.worldBounds&&!intersects){var world=options.worldBounds,width=world.getWidth(),selfCrosses=!world.containsBounds(self),boundsCrosses=!world.containsBounds(bounds);selfCrosses&&!boundsCrosses?(bounds=bounds.add(-width,0),intersects=self.intersectsBounds(bounds,{inclusive:options.inclusive})):boundsCrosses&&!selfCrosses&&(self=self.add(-width,0),intersects=bounds.intersectsBounds(self,{inclusive:options.inclusive}))}return intersects},containsBounds:function(bounds,partial,inclusive){null==partial&&(partial=!1),null==inclusive&&(inclusive=!0);var bottomLeft=this.contains(bounds.left,bounds.bottom,inclusive),bottomRight=this.contains(bounds.right,bounds.bottom,inclusive),topLeft=this.contains(bounds.left,bounds.top,inclusive),topRight=this.contains(bounds.right,bounds.top,inclusive);return partial?bottomLeft||bottomRight||topLeft||topRight:bottomLeft&&bottomRight&&topLeft&&topRight},determineQuadrant:function(lonlat){var quadrant="",center=this.getCenterLonLat();return quadrant+=lonlat.lat<center.lat?"b":"t",quadrant+=lonlat.lon<center.lon?"l":"r"},transform:function(source,dest){this.centerLonLat=null;var ll=OpenLayers.Projection.transform({x:this.left,y:this.bottom},source,dest),lr=OpenLayers.Projection.transform({x:this.right,y:this.bottom},source,dest),ul=OpenLayers.Projection.transform({x:this.left,y:this.top},source,dest),ur=OpenLayers.Projection.transform({x:this.right,y:this.top},source,dest);return this.left=Math.min(ll.x,ul.x),this.bottom=Math.min(ll.y,lr.y),this.right=Math.max(lr.x,ur.x),this.top=Math.max(ul.y,ur.y),this},wrapDateLine:function(maxExtent,options){options=options||{};var leftTolerance=options.leftTolerance||0,rightTolerance=options.rightTolerance||0,newBounds=this.clone();if(maxExtent){for(var width=maxExtent.getWidth();newBounds.left<maxExtent.left&&newBounds.right-rightTolerance<=maxExtent.left;)newBounds=newBounds.add(width,0);for(;newBounds.left+leftTolerance>=maxExtent.right&&newBounds.right>maxExtent.right;)newBounds=newBounds.add(-width,0);var newLeft=newBounds.left+leftTolerance;newLeft<maxExtent.right&&newLeft>maxExtent.left&&newBounds.right-rightTolerance>maxExtent.right&&(newBounds=newBounds.add(-width,0))}return newBounds},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(str,reverseAxisOrder){var bounds=str.split(",");return OpenLayers.Bounds.fromArray(bounds,reverseAxisOrder)},OpenLayers.Bounds.fromArray=function(bbox,reverseAxisOrder){return reverseAxisOrder===!0?new OpenLayers.Bounds(bbox[1],bbox[0],bbox[3],bbox[2]):new OpenLayers.Bounds(bbox[0],bbox[1],bbox[2],bbox[3])},OpenLayers.Bounds.fromSize=function(size){return new OpenLayers.Bounds(0,size.h,size.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(quadrant){var opp="";return opp+="t"==quadrant.charAt(0)?"b":"t",opp+="l"==quadrant.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(element){return"none"!=OpenLayers.Util.getElement(element).style.display},toggle:function(){for(var i=0,len=arguments.length;len>i;i++){var element=OpenLayers.Util.getElement(arguments[i]),display=OpenLayers.Element.visible(element)?"none":"";element.style.display=display}},remove:function(element){element=OpenLayers.Util.getElement(element),element.parentNode.removeChild(element)},getHeight:function(element){return element=OpenLayers.Util.getElement(element),element.offsetHeight},hasClass:function(element,name){var names=element.className;return!!names&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(names)},addClass:function(element,name){return OpenLayers.Element.hasClass(element,name)||(element.className+=(element.className?" ":"")+name),element},removeClass:function(element,name){var names=element.className;return names&&(element.className=OpenLayers.String.trim(names.replace(new RegExp("(^|\\s+)"+name+"(\\s+|$)")," "))),element},toggleClass:function(element,name){return OpenLayers.Element.hasClass(element,name)?OpenLayers.Element.removeClass(element,name):OpenLayers.Element.addClass(element,name),element},getStyle:function(element,style){element=OpenLayers.Util.getElement(element);var value=null;if(element&&element.style){if(value=element.style[OpenLayers.String.camelize(style)],!value)if(document.defaultView&&document.defaultView.getComputedStyle){var css=document.defaultView.getComputedStyle(element,null);value=css?css.getPropertyValue(style):null}else element.currentStyle&&(value=element.currentStyle[OpenLayers.String.camelize(style)]);var positions=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(positions,style)&&"static"==OpenLayers.Element.getStyle(element,"position")&&(value="auto")}return"auto"==value?null:value}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(lon,lat){OpenLayers.Util.isArray(lon)&&(lat=lon[1],lon=lon[0]),this.lon=OpenLayers.Util.toFloat(lon),this.lat=OpenLayers.Util.toFloat(lat)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(lon,lat){if(null==lon||null==lat)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(lon),this.lat+OpenLayers.Util.toFloat(lat))},equals:function(ll){var equals=!1;return null!=ll&&(equals=this.lon==ll.lon&&this.lat==ll.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(ll.lon)&&isNaN(ll.lat)),equals},transform:function(source,dest){var point=OpenLayers.Projection.transform({x:this.lon,y:this.lat},source,dest);return this.lon=point.x,this.lat=point.y,this},wrapDateLine:function(maxExtent){var newLonLat=this.clone();if(maxExtent){for(;newLonLat.lon<maxExtent.left;)newLonLat.lon+=maxExtent.getWidth();for(;newLonLat.lon>maxExtent.right;)newLonLat.lon-=maxExtent.getWidth()}return newLonLat},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(str){var pair=str.split(",");return new OpenLayers.LonLat(pair[0],pair[1])},OpenLayers.LonLat.fromArray=function(arr){var gotArr=OpenLayers.Util.isArray(arr),lon=gotArr&&arr[0],lat=gotArr&&arr[1];return new OpenLayers.LonLat(lon,lat)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(x,y){this.x=parseFloat(x),this.y=parseFloat(y)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(px){var equals=!1;return null!=px&&(equals=this.x==px.x&&this.y==px.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(px.x)&&isNaN(px.y)),equals},distanceTo:function(px){return Math.sqrt(Math.pow(this.x-px.x,2)+Math.pow(this.y-px.y,2))},add:function(x,y){if(null==x||null==y)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+x,this.y+y)},offset:function(px){var newPx=this.clone();return px&&(newPx=this.add(px.x,px.y)),newPx},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(w,h){this.w=parseFloat(w),this.h=parseFloat(h)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(sz){var equals=!1;return null!=sz&&(equals=this.w==sz.w&&this.h==sz.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(sz.w)&&isNaN(sz.h)),equals},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(error){alert(error)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var scripts=document.getElementsByTagName("script"),i=0,len=scripts.length;len>i;++i)if(-1!=scripts[i].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(code){var lang;code||(code="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var parts=code.split("-");if(parts[0]=parts[0].toLowerCase(),"object"==typeof OpenLayers.Lang[parts[0]]&&(lang=parts[0]),parts[1]){var testLang=parts[0]+"-"+parts[1].toUpperCase();"object"==typeof OpenLayers.Lang[testLang]&&(lang=testLang)}lang||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+parts.join("-")+" dictionary, falling back to default language"),lang=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=lang},translate:function(key,context){var dictionary=OpenLayers.Lang[OpenLayers.Lang.getCode()],message=dictionary&&dictionary[key];return message||(message=key),context&&(message=OpenLayers.String.format(message,context)),message}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var elements=[],i=0,len=arguments.length;len>i;i++){var element=arguments[i];if("string"==typeof element&&(element=document.getElementById(element)),1==arguments.length)return element;elements.push(element)}return elements},OpenLayers.Util.isElement=function(o){return!(!o||1!==o.nodeType)},OpenLayers.Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},OpenLayers.Util.removeItem=function(array,item){for(var i=array.length-1;i>=0;i--)array[i]==item&&array.splice(i,1);return array},OpenLayers.Util.indexOf=function(array,obj){if("function"==typeof array.indexOf)return array.indexOf(obj);for(var i=0,len=array.length;len>i;i++)if(array[i]==obj)return i;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(element,id,px,sz,position,border,overflow,opacity){id&&(element.id=id.replace(OpenLayers.Util.dotless,"_")),px&&(element.style.left=px.x+"px",element.style.top=px.y+"px"),sz&&(element.style.width=sz.w+"px",element.style.height=sz.h+"px"),position&&(element.style.position=position),border&&(element.style.border=border),overflow&&(element.style.overflow=overflow),parseFloat(opacity)>=0&&parseFloat(opacity)<1?(element.style.filter="alpha(opacity="+100*opacity+")",element.style.opacity=opacity):1==parseFloat(opacity)&&(element.style.filter="",element.style.opacity="")},OpenLayers.Util.createDiv=function(id,px,sz,imgURL,position,border,overflow,opacity){var dom=document.createElement("div");return imgURL&&(dom.style.backgroundImage="url("+imgURL+")"),id||(id=OpenLayers.Util.createUniqueID("OpenLayersDiv")),position||(position="absolute"),OpenLayers.Util.modifyDOMElement(dom,id,px,sz,position,border,overflow,opacity),dom},OpenLayers.Util.createImage=function(id,px,sz,imgURL,position,border,opacity,delayDisplay){function display(){image.style.display="",OpenLayers.Event.stopObservingElement(image)}var image=document.createElement("img");return id||(id=OpenLayers.Util.createUniqueID("OpenLayersDiv")),position||(position="relative"),OpenLayers.Util.modifyDOMElement(image,id,px,sz,position,border,null,opacity),delayDisplay&&(image.style.display="none",OpenLayers.Event.observe(image,"load",display),OpenLayers.Event.observe(image,"error",display)),image.style.alt=id,image.galleryImg="no",imgURL&&(image.src=imgURL),image},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var arVersion=navigator.appVersion.split("MSIE"),version=parseFloat(arVersion[1]),filter=!1;try{filter=!!document.body.filters}catch(e){}OpenLayers.Util.alphaHackNeeded=filter&&version>=5.5&&7>version}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(div,id,px,sz,imgURL,position,border,sizing,opacity){OpenLayers.Util.modifyDOMElement(div,id,px,sz,position,null,null,opacity);var img=div.childNodes[0];imgURL&&(img.src=imgURL),OpenLayers.Util.modifyDOMElement(img,div.id+"_innerImage",null,sz,"relative",border),OpenLayers.Util.alphaHack()&&("none"!=div.style.display&&(div.style.display="inline-block"),null==sizing&&(sizing="scale"),div.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='"+sizing+"')",parseFloat(div.style.opacity)>=0&&parseFloat(div.style.opacity)<1&&(div.style.filter+=" alpha(opacity="+100*div.style.opacity+")"),img.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(id,px,sz,imgURL,position,border,sizing,opacity,delayDisplay){var div=OpenLayers.Util.createDiv(),img=OpenLayers.Util.createImage(null,null,null,null,null,null,null,delayDisplay);return img.className="olAlphaImg",div.appendChild(img),OpenLayers.Util.modifyAlphaImageDiv(div,id,px,sz,imgURL,position,border,sizing,opacity),div},OpenLayers.Util.upperCaseObject=function(object){var uObject={};for(var key in object)uObject[key.toUpperCase()]=object[key];return uObject},OpenLayers.Util.applyDefaults=function(to,from){to=to||{};var fromIsEvt="function"==typeof window.Event&&from instanceof window.Event;for(var key in from)(void 0===to[key]||!fromIsEvt&&from.hasOwnProperty&&from.hasOwnProperty(key)&&!to.hasOwnProperty(key))&&(to[key]=from[key]);return!fromIsEvt&&from&&from.hasOwnProperty&&from.hasOwnProperty("toString")&&!to.hasOwnProperty("toString")&&(to.toString=from.toString),to},OpenLayers.Util.getParameterString=function(params){var paramsArray=[];for(var key in params){var value=params[key];if(null!=value&&"function"!=typeof value){var encodedValue;if("object"==typeof value&&value.constructor==Array){for(var item,encodedItemArray=[],itemIndex=0,len=value.length;len>itemIndex;itemIndex++)item=value[itemIndex],encodedItemArray.push(encodeURIComponent(null===item||void 0===item?"":item));encodedValue=encodedItemArray.join(",")}else encodedValue=encodeURIComponent(value);paramsArray.push(encodeURIComponent(key)+"="+encodedValue)}}return paramsArray.join("&")},OpenLayers.Util.urlAppend=function(url,paramStr){var newUrl=url;if(paramStr){var parts=(url+" ").split(/[?&]/);newUrl+=" "===parts.pop()?paramStr:parts.length?"&"+paramStr:"?"+paramStr}return newUrl},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(image){return OpenLayers.Util.getImagesLocation()+image},OpenLayers.Util.Try=function(){for(var returnValue=null,i=0,len=arguments.length;len>i;i++){var lambda=arguments[i];try{returnValue=lambda();break}catch(e){}}return returnValue},OpenLayers.Util.getXmlNodeValue=function(node){var val=null;return OpenLayers.Util.Try(function(){val=node.text,val||(val=node.textContent),val||(val=node.firstChild.nodeValue)},function(){val=node.textContent}),val},OpenLayers.Util.mouseLeft=function(evt,div){for(var target=evt.relatedTarget?evt.relatedTarget:evt.toElement;target!=div&&null!=target;)target=target.parentNode;return target!=div},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(number,precision){return null==precision&&(precision=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof number&&(number=parseFloat(number)),0===precision?number:parseFloat(number.toPrecision(precision))},OpenLayers.Util.rad=function(x){return x*Math.PI/180},OpenLayers.Util.deg=function(x){return 180*x/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(p1,p2){for(var ct=OpenLayers.Util.VincentyConstants,a=ct.a,b=ct.b,f=ct.f,L=OpenLayers.Util.rad(p2.lon-p1.lon),U1=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p1.lat))),U2=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p2.lat))),sinU1=Math.sin(U1),cosU1=Math.cos(U1),sinU2=Math.sin(U2),cosU2=Math.cos(U2),lambda=L,lambdaP=2*Math.PI,iterLimit=20;Math.abs(lambda-lambdaP)>1e-12&&--iterLimit>0;){var sinLambda=Math.sin(lambda),cosLambda=Math.cos(lambda),sinSigma=Math.sqrt(cosU2*sinLambda*(cosU2*sinLambda)+(cosU1*sinU2-sinU1*cosU2*cosLambda)*(cosU1*sinU2-sinU1*cosU2*cosLambda));if(0==sinSigma)return 0;var cosSigma=sinU1*sinU2+cosU1*cosU2*cosLambda,sigma=Math.atan2(sinSigma,cosSigma),alpha=Math.asin(cosU1*cosU2*sinLambda/sinSigma),cosSqAlpha=Math.cos(alpha)*Math.cos(alpha),cos2SigmaM=cosSigma-2*sinU1*sinU2/cosSqAlpha,C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha));lambdaP=lambda,lambda=L+(1-C)*f*Math.sin(alpha)*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)))}if(0==iterLimit)return NaN;var uSq=cosSqAlpha*(a*a-b*b)/(b*b),A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq))),B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq))),deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM))),s=b*A*(sigma-deltaSigma),d=s.toFixed(3)/1e3;return d},OpenLayers.Util.destinationVincenty=function(lonlat,brng,dist){for(var u=OpenLayers.Util,ct=u.VincentyConstants,a=ct.a,b=ct.b,f=ct.f,lon1=lonlat.lon,lat1=lonlat.lat,s=dist,alpha1=u.rad(brng),sinAlpha1=Math.sin(alpha1),cosAlpha1=Math.cos(alpha1),tanU1=(1-f)*Math.tan(u.rad(lat1)),cosU1=1/Math.sqrt(1+tanU1*tanU1),sinU1=tanU1*cosU1,sigma1=Math.atan2(tanU1,cosAlpha1),sinAlpha=cosU1*sinAlpha1,cosSqAlpha=1-sinAlpha*sinAlpha,uSq=cosSqAlpha*(a*a-b*b)/(b*b),A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq))),B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq))),sigma=s/(b*A),sigmaP=2*Math.PI;Math.abs(sigma-sigmaP)>1e-12;){var cos2SigmaM=Math.cos(2*sigma1+sigma),sinSigma=Math.sin(sigma),cosSigma=Math.cos(sigma),deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM)));sigmaP=sigma,sigma=s/(b*A)+deltaSigma}var tmp=sinU1*sinSigma-cosU1*cosSigma*cosAlpha1,lat2=Math.atan2(sinU1*cosSigma+cosU1*sinSigma*cosAlpha1,(1-f)*Math.sqrt(sinAlpha*sinAlpha+tmp*tmp)),lambda=Math.atan2(sinSigma*sinAlpha1,cosU1*cosSigma-sinU1*sinSigma*cosAlpha1),C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha)),L=lambda-(1-C)*f*sinAlpha*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)));Math.atan2(sinAlpha,-tmp);return new OpenLayers.LonLat(lon1+u.deg(L),u.deg(lat2))},OpenLayers.Util.getParameters=function(url,options){options=options||{},url=null===url||void 0===url?window.location.href:url;var paramsString="";if(OpenLayers.String.contains(url,"?")){var start=url.indexOf("?")+1,end=OpenLayers.String.contains(url,"#")?url.indexOf("#"):url.length;paramsString=url.substring(start,end)}for(var parameters={},pairs=paramsString.split(/[&;]/),i=0,len=pairs.length;len>i;++i){var keyValue=pairs[i].split("=");if(keyValue[0]){var key=keyValue[0];try{key=decodeURIComponent(key)}catch(err){key=unescape(key)}var value=(keyValue[1]||"").replace(/\+/g," ");try{value=decodeURIComponent(value)}catch(err){value=unescape(value)}options.splitArgs!==!1&&(value=value.split(",")),1==value.length&&(value=value[0]),parameters[key]=value}}return parameters},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(prefix){return prefix=null==prefix?"id_":prefix.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,prefix+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,
"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(scale){var normScale=scale>1?1/scale:scale;return normScale},OpenLayers.Util.getResolutionFromScale=function(scale,units){var resolution;if(scale){null==units&&(units="degrees");var normScale=OpenLayers.Util.normalizeScale(scale);resolution=1/(normScale*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH)}return resolution},OpenLayers.Util.getScaleFromResolution=function(resolution,units){null==units&&(units="degrees");var scale=resolution*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH;return scale},OpenLayers.Util.pagePosition=function(forElement){var pos=[0,0],viewportElement=OpenLayers.Util.getViewportElement();if(!forElement||forElement==window||forElement==viewportElement)return pos;var box,BUGGY_GECKO_BOX_OBJECT=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(forElement,"position")&&(""==forElement.style.top||""==forElement.style.left),parent=null;if(forElement.getBoundingClientRect){box=forElement.getBoundingClientRect();var scrollTop=window.pageYOffset||viewportElement.scrollTop,scrollLeft=window.pageXOffset||viewportElement.scrollLeft;pos[0]=box.left+scrollLeft,pos[1]=box.top+scrollTop}else if(document.getBoxObjectFor&&!BUGGY_GECKO_BOX_OBJECT){box=document.getBoxObjectFor(forElement);var vpBox=document.getBoxObjectFor(viewportElement);pos[0]=box.screenX-vpBox.screenX,pos[1]=box.screenY-vpBox.screenY}else{if(pos[0]=forElement.offsetLeft,pos[1]=forElement.offsetTop,parent=forElement.offsetParent,parent!=forElement)for(;parent;)pos[0]+=parent.offsetLeft,pos[1]+=parent.offsetTop,parent=parent.offsetParent;var browser=OpenLayers.BROWSER_NAME;for(("opera"==browser||"safari"==browser&&"absolute"==OpenLayers.Element.getStyle(forElement,"position"))&&(pos[1]-=document.body.offsetTop),parent=forElement.offsetParent;parent&&parent!=document.body;)pos[0]-=parent.scrollLeft,("opera"!=browser||"TR"!=parent.tagName)&&(pos[1]-=parent.scrollTop),parent=parent.offsetParent}return pos},OpenLayers.Util.getViewportElement=function(){var viewportElement=arguments.callee.viewportElement;return void 0==viewportElement&&(viewportElement="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=viewportElement),viewportElement},OpenLayers.Util.isEquivalentUrl=function(url1,url2,options){options=options||{},OpenLayers.Util.applyDefaults(options,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var urlObj1=OpenLayers.Util.createUrlObject(url1,options),urlObj2=OpenLayers.Util.createUrlObject(url2,options);for(var key in urlObj1)if("args"!==key&&urlObj1[key]!=urlObj2[key])return!1;for(var key in urlObj1.args){if(urlObj1.args[key]!=urlObj2.args[key])return!1;delete urlObj2.args[key]}for(var key in urlObj2.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(url,options){if(options=options||{},!/^\w+:\/\//.test(url)){var loc=window.location,port=loc.port?":"+loc.port:"",fullUrl=loc.protocol+"//"+loc.host.split(":").shift()+port;if(0===url.indexOf("/"))url=fullUrl+url;else{var parts=loc.pathname.split("/");parts.pop(),url=fullUrl+parts.join("/")+"/"+url}}options.ignoreCase&&(url=url.toLowerCase());var a=document.createElement("a");a.href=url;var urlObject={};urlObject.host=a.host.split(":").shift(),urlObject.protocol=a.protocol,options.ignorePort80?urlObject.port="80"==a.port||"0"==a.port?"":a.port:urlObject.port=""==a.port||"0"==a.port?"80":a.port,urlObject.hash=options.ignoreHash||"#"===a.hash?"":a.hash;var queryString=a.search;if(!queryString){var qMark=url.indexOf("?");queryString=-1!=qMark?url.substr(qMark):""}return urlObject.args=OpenLayers.Util.getParameters(queryString,{splitArgs:options.splitArgs}),urlObject.pathname="/"==a.pathname.charAt(0)?a.pathname:"/"+a.pathname,urlObject},OpenLayers.Util.removeTail=function(url){var head=null,qMark=url.indexOf("?"),hashMark=url.indexOf("#");return head=-1==qMark?-1!=hashMark?url.substr(0,hashMark):url:-1!=hashMark?url.substr(0,Math.min(qMark,hashMark)):url.substr(0,qMark)},OpenLayers.IS_GECKO=function(){var ua=navigator.userAgent.toLowerCase();return-1==ua.indexOf("webkit")&&-1!=ua.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var elem=document.createElement("canvas");return!(!elem.getContext||!elem.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var name="",ua=navigator.userAgent.toLowerCase();return-1!=ua.indexOf("opera")?name="opera":-1!=ua.indexOf("msie")?name="msie":-1!=ua.indexOf("safari")?name="safari":-1!=ua.indexOf("mozilla")&&(name=-1!=ua.indexOf("firefox")?"firefox":"mozilla"),name}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(contentHTML,size,options){var w,h,container=document.createElement("div");container.style.visibility="hidden";for(var containerElement=options&&options.containerElement?options.containerElement:document.body,parentHasPositionAbsolute=!1,superContainer=null,parent=containerElement;parent&&"body"!=parent.tagName.toLowerCase();){var parentPosition=OpenLayers.Element.getStyle(parent,"position");if("absolute"==parentPosition){parentHasPositionAbsolute=!0;break}if(parentPosition&&"static"!=parentPosition)break;parent=parent.parentNode}!parentHasPositionAbsolute||0!==containerElement.clientHeight&&0!==containerElement.clientWidth||(superContainer=document.createElement("div"),superContainer.style.visibility="hidden",superContainer.style.position="absolute",superContainer.style.overflow="visible",superContainer.style.width=document.body.clientWidth+"px",superContainer.style.height=document.body.clientHeight+"px",superContainer.appendChild(container)),container.style.position="absolute",size&&(size.w?(w=size.w,container.style.width=w+"px"):size.h&&(h=size.h,container.style.height=h+"px")),options&&options.displayClass&&(container.className=options.displayClass);var content=document.createElement("div");if(content.innerHTML=contentHTML,content.style.overflow="visible",content.childNodes)for(var i=0,l=content.childNodes.length;l>i;i++)content.childNodes[i].style&&(content.childNodes[i].style.overflow="visible");return container.appendChild(content),superContainer?containerElement.appendChild(superContainer):containerElement.appendChild(container),w||(w=parseInt(content.scrollWidth),container.style.width=w+"px"),h||(h=parseInt(content.scrollHeight)),container.removeChild(content),superContainer?(superContainer.removeChild(container),containerElement.removeChild(superContainer)):containerElement.removeChild(container),new OpenLayers.Size(w,h)},OpenLayers.Util.getScrollbarWidth=function(){var scrollbarWidth=OpenLayers.Util._scrollbarWidth;if(null==scrollbarWidth){var scr=null,inn=null,wNoScroll=0,wScroll=0;scr=document.createElement("div"),scr.style.position="absolute",scr.style.top="-1000px",scr.style.left="-1000px",scr.style.width="100px",scr.style.height="50px",scr.style.overflow="hidden",inn=document.createElement("div"),inn.style.width="100%",inn.style.height="200px",scr.appendChild(inn),document.body.appendChild(scr),wNoScroll=inn.offsetWidth,scr.style.overflow="scroll",wScroll=inn.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=wNoScroll-wScroll,scrollbarWidth=OpenLayers.Util._scrollbarWidth}return scrollbarWidth},OpenLayers.Util.getFormattedLonLat=function(coordinate,axis,dmsOption){dmsOption||(dmsOption="dms"),coordinate=(coordinate+540)%360-180;var abscoordinate=Math.abs(coordinate),coordinatedegrees=Math.floor(abscoordinate),coordinateminutes=(abscoordinate-coordinatedegrees)/(1/60),tempcoordinateminutes=coordinateminutes;coordinateminutes=Math.floor(coordinateminutes);var coordinateseconds=(tempcoordinateminutes-coordinateminutes)/(1/60);coordinateseconds=Math.round(10*coordinateseconds),coordinateseconds/=10,coordinateseconds>=60&&(coordinateseconds-=60,coordinateminutes+=1,coordinateminutes>=60&&(coordinateminutes-=60,coordinatedegrees+=1)),10>coordinatedegrees&&(coordinatedegrees="0"+coordinatedegrees);var str=coordinatedegrees+"Â°";return dmsOption.indexOf("dm")>=0&&(10>coordinateminutes&&(coordinateminutes="0"+coordinateminutes),str+=coordinateminutes+"'",dmsOption.indexOf("dms")>=0&&(10>coordinateseconds&&(coordinateseconds="0"+coordinateseconds),str+=coordinateseconds+'"')),str+="lon"==axis?0>coordinate?OpenLayers.i18n("W"):OpenLayers.i18n("E"):0>coordinate?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(options){OpenLayers.Util.extend(this,options),this.options=options},destroy:function(){},read:function(data){throw new Error("Read not implemented.")},write:function(object){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.CSWGetRecords=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.CSWGetRecords.DEFAULTS);var cls=OpenLayers.Format.CSWGetRecords["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported CSWGetRecords version: "+options.version;return new cls(options)},OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(options){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,options),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var key in this.handlers)this.handlers.hasOwnProperty(key)&&"function"==typeof this.handlers[key].destroy&&this.handlers[key].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(map){this.map=map,this.handler&&this.handler.setMap(map)},draw:function(px){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=px&&(this.position=px.clone()),this.moveTo(this.position),this.div},moveTo:function(px){null!=px&&null!=this.div&&(this.div.style.left=px.x+"px",this.div.style.top=px.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(event){return event.target||event.srcElement},isSingleTouch:function(event){return event.touches&&1==event.touches.length},isMultiTouch:function(event){return event.touches&&event.touches.length>1},isLeftClick:function(event){return event.which&&1==event.which||event.button&&1==event.button},isRightClick:function(event){return event.which&&3==event.which||event.button&&2==event.button},stop:function(event,allowDefault){allowDefault||OpenLayers.Event.preventDefault(event),event.stopPropagation?event.stopPropagation():event.cancelBubble=!0},preventDefault:function(event){event.preventDefault?event.preventDefault():event.returnValue=!1},findElement:function(event,tagName){for(var element=OpenLayers.Event.element(event);element.parentNode&&(!element.tagName||element.tagName.toUpperCase()!=tagName.toUpperCase());)element=element.parentNode;return element},observe:function(elementParam,name,observer,useCapture){var element=OpenLayers.Util.getElement(elementParam);if(useCapture=useCapture||!1,"keypress"==name&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.attachEvent)&&(name="keydown"),this.observers||(this.observers={}),!element._eventCacheID){var idPrefix="eventCacheID_";element.id&&(idPrefix=element.id+"_"+idPrefix),element._eventCacheID=OpenLayers.Util.createUniqueID(idPrefix)}var cacheID=element._eventCacheID;this.observers[cacheID]||(this.observers[cacheID]=[]),this.observers[cacheID].push({element:element,name:name,observer:observer,useCapture:useCapture}),element.addEventListener?element.addEventListener(name,observer,useCapture):element.attachEvent&&element.attachEvent("on"+name,observer)},stopObservingElement:function(elementParam){var element=OpenLayers.Util.getElement(elementParam),cacheID=element._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[cacheID])},_removeElementObservers:function(elementObservers){if(elementObservers)for(var i=elementObservers.length-1;i>=0;i--){var entry=elementObservers[i];OpenLayers.Event.stopObserving.apply(this,[entry.element,entry.name,entry.observer,entry.useCapture])}},stopObserving:function(elementParam,name,observer,useCapture){useCapture=useCapture||!1;var element=OpenLayers.Util.getElement(elementParam),cacheID=element._eventCacheID;"keypress"==name&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.detachEvent)&&(name="keydown");var foundEntry=!1,elementObservers=OpenLayers.Event.observers[cacheID];if(elementObservers)for(var i=0;!foundEntry&&i<elementObservers.length;){var cacheEntry=elementObservers[i];if(cacheEntry.name==name&&cacheEntry.observer==observer&&cacheEntry.useCapture==useCapture){elementObservers.splice(i,1),0==elementObservers.length&&delete OpenLayers.Event.observers[cacheID],foundEntry=!0;break}i++}return foundEntry&&(element.removeEventListener?element.removeEventListener(name,observer,useCapture):element&&element.detachEvent&&element.detachEvent("on"+name,observer)),foundEntry},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var cacheID in OpenLayers.Event.observers){var elementObservers=OpenLayers.Event.observers[cacheID];OpenLayers.Event._removeElementObservers.apply(this,[elementObservers])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(object,element,eventTypes,fallThrough,options){OpenLayers.Util.extend(this,options),this.object=object,this.fallThrough=fallThrough,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=element&&this.attachToElement(element)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(eventName){},attachToElement:function(element){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=element;for(var type,msTouch=!!window.navigator.msMaxTouchPoints,i=0,len=this.BROWSER_EVENTS.length;len>i;i++)type=this.BROWSER_EVENTS[i],OpenLayers.Event.observe(element,type,this.eventHandler),msTouch&&0===type.indexOf("touch")&&this.addMsTouchListener(element,type,this.eventHandler);OpenLayers.Event.observe(element,"dragstart",OpenLayers.Event.stop)},on:function(object){for(var type in object)"scope"!=type&&object.hasOwnProperty(type)&&this.register(type,object.scope,object[type])},register:function(type,obj,func,priority){if(type in OpenLayers.Events&&!this.extensions[type]&&(this.extensions[type]=new OpenLayers.Events[type](this)),null!=func){null==obj&&(obj=this.object);var listeners=this.listeners[type];listeners||(listeners=[],this.listeners[type]=listeners,this.extensionCount[type]=0);var listener={obj:obj,func:func};priority?(listeners.splice(this.extensionCount[type],0,listener),"object"==typeof priority&&priority.extension&&this.extensionCount[type]++):listeners.push(listener)}},registerPriority:function(type,obj,func){this.register(type,obj,func,!0)},un:function(object){for(var type in object)"scope"!=type&&object.hasOwnProperty(type)&&this.unregister(type,object.scope,object[type])},unregister:function(type,obj,func){null==obj&&(obj=this.object);var listeners=this.listeners[type];if(null!=listeners)for(var i=0,len=listeners.length;len>i;i++)if(listeners[i].obj==obj&&listeners[i].func==func){listeners.splice(i,1);break}},remove:function(type){null!=this.listeners[type]&&(this.listeners[type]=[])},triggerEvent:function(type,evt){var listeners=this.listeners[type];if(!listeners||0==listeners.length)return void 0;null==evt&&(evt={}),evt.object=this.object,evt.element=this.element,evt.type||(evt.type=type),listeners=listeners.slice();for(var continueChain,i=0,len=listeners.length;len>i;i++){var callback=listeners[i];if(continueChain=callback.func.apply(callback.obj,[evt]),void 0!=continueChain&&0==continueChain)break}return this.fallThrough||OpenLayers.Event.stop(evt,!0),continueChain},handleBrowserEvent:function(evt){var type=evt.type,listeners=this.listeners[type];if(listeners&&0!=listeners.length){var touches=evt.touches;if(touches&&touches[0]){for(var touch,x=0,y=0,num=touches.length,i=0;num>i;++i)touch=this.getTouchClientXY(touches[i]),x+=touch.clientX,y+=touch.clientY;evt.clientX=x/num,evt.clientY=y/num}this.includeXY&&(evt.xy=this.getMousePosition(evt)),this.triggerEvent(type,evt)}},getTouchClientXY:function(evt){var win=window.olMockWin||window,winPageX=win.pageXOffset,winPageY=win.pageYOffset,x=evt.clientX,y=evt.clientY;return 0===evt.pageY&&Math.floor(y)>Math.floor(evt.pageY)||0===evt.pageX&&Math.floor(x)>Math.floor(evt.pageX)?(x-=winPageX,y-=winPageY):(y<evt.pageY-winPageY||x<evt.pageX-winPageX)&&(x=evt.pageX-winPageX,y=evt.pageY-winPageY),evt.olClientX=x,evt.olClientY=y,{clientX:x,clientY:y}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(evt){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var viewportElement=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||viewportElement.scrollLeft,window.pageYOffset||viewportElement.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(evt.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],evt.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(element,type,handler){function msHandler(evt){handler(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var i=touches.length-1;i>=0;--i)touches[i].stopPropagation()},preventDefault:function(){for(var i=touches.length-1;i>=0;--i)touches[i].preventDefault()},type:type},evt))}var touches=(this.eventHandler,this._msTouches);switch(type){case"touchstart":return this.addMsTouchListenerStart(element,type,msHandler);case"touchend":return this.addMsTouchListenerEnd(element,type,msHandler);case"touchmove":return this.addMsTouchListenerMove(element,type,msHandler);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(element,type,handler){var touches=this._msTouches,cb=function(e){for(var alreadyInArray=!1,i=0,ii=touches.length;ii>i;++i)if(touches[i].pointerId==e.pointerId){alreadyInArray=!0;break}alreadyInArray||touches.push(e),e.touches=touches.slice(),handler(e)};OpenLayers.Event.observe(element,"MSPointerDown",cb);var internalCb=function(e){for(var i=0,ii=touches.length;ii>i;++i)if(touches[i].pointerId==e.pointerId){touches.splice(i,1);break}};OpenLayers.Event.observe(element,"MSPointerUp",internalCb)},addMsTouchListenerMove:function(element,type,handler){var touches=this._msTouches,cb=function(e){if(!(e.pointerType==e.MSPOINTER_TYPE_MOUSE&&0==e.buttons||1==touches.length&&touches[0].pageX==e.pageX&&touches[0].pageY==e.pageY)){for(var i=0,ii=touches.length;ii>i;++i)if(touches[i].pointerId==e.pointerId){touches[i]=e;break}e.touches=touches.slice(),handler(e)}};OpenLayers.Event.observe(element,"MSPointerMove",cb)},addMsTouchListenerEnd:function(element,type,handler){var touches=this._msTouches,cb=function(e){for(var i=0,ii=touches.length;ii>i;++i)if(touches[i].pointerId==e.pointerId){touches.splice(i,1);break}e.touches=touches.slice(),handler(e)};OpenLayers.Event.observe(element,"MSPointerUp",cb)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(target){this.target=target;for(var i=this.events.length-1;i>=0;--i)this.target.register(this.events[i],this,this.buttonClick,{extension:!0})},destroy:function(){for(var i=this.events.length-1;i>=0;--i)this.target.unregister(this.events[i],this,this.buttonClick);delete this.target},getPressedButton:function(element){var button,depth=3;do{if(OpenLayers.Element.hasClass(element,"olButton")){button=element;break}element=element.parentNode}while(--depth>0&&element);return button},ignore:function(element){var depth=3,ignore=!1;do{if("a"===element.nodeName.toLowerCase()){ignore=!0;break}element=element.parentNode}while(--depth>0&&element);return ignore},buttonClick:function(evt){var propagate=!0,element=OpenLayers.Event.element(evt);if(element&&(OpenLayers.Event.isLeftClick(evt)||!~evt.type.indexOf("mouse"))){var button=this.getPressedButton(element);if(button){if("keydown"===evt.type)switch(evt.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:button}),OpenLayers.Event.stop(evt),propagate=!1}else if(this.startEvt){if(this.completeRegEx.test(evt.type)){var pos=OpenLayers.Util.pagePosition(button),viewportElement=OpenLayers.Util.getViewportElement(),scrollTop=window.pageYOffset||viewportElement.scrollTop,scrollLeft=window.pageXOffset||viewportElement.scrollLeft;pos[0]=pos[0]-scrollLeft,pos[1]=pos[1]-scrollTop,this.target.triggerEvent("buttonclick",{buttonElement:button,buttonXY:{x:this.startEvt.clientX-pos[0],y:this.startEvt.clientY-pos[1]}})}this.cancelRegEx.test(evt.type)&&delete this.startEvt,OpenLayers.Event.stop(evt),propagate=!1}this.startRegEx.test(evt.type)&&(this.startEvt=evt,OpenLayers.Event.stop(evt),propagate=!1)}else propagate=!this.ignore(OpenLayers.Event.element(evt)),delete this.startEvt}return propagate}}),OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){"use strict";function domToCss(prefixedDom){return prefixedDom?prefixedDom.replace(/([A-Z])/g,function(c){return"-"+c.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function css(property){if(void 0===cssCache[property]){var domProperty=property.replace(/(-[\s\S])/g,function(c){return c.charAt(1).toUpperCase()}),prefixedDom=style(domProperty);cssCache[property]=domToCss(prefixedDom)}return cssCache[property]}function js(obj,property){if(void 0===jsCache[property]){var tmpProp,prefix,i=0,l=VENDOR_PREFIXES.length,isStyleObj="undefined"!=typeof obj.cssText;for(jsCache[property]=null;l>i;i++)if(prefix=VENDOR_PREFIXES[i],prefix?(isStyleObj||(prefix=prefix.toLowerCase()),tmpProp=prefix+property.charAt(0).toUpperCase()+property.slice(1)):tmpProp=property,void 0!==obj[tmpProp]){jsCache[property]=tmpProp;break}}return jsCache[property]}function style(property){return js(divStyle,property)}var VENDOR_PREFIXES=["","O","ms","Moz","Webkit"],divStyle=document.createElement("div").style,cssCache={},jsCache={};return{css:css,js:js,style:style,cssCache:cssCache,jsCache:jsCache}}(),OpenLayers.Animation=function(window){function start(callback,duration,element){duration=duration>0?duration:Number.POSITIVE_INFINITY;var id=++counter,start=+new Date;return loops[id]=function(){loops[id]&&+new Date-start<=duration?(callback(),loops[id]&&requestFrame(loops[id],element)):delete loops[id]},requestFrame(loops[id],element),id}function stop(id){delete loops[id]}var requestAnimationFrame=OpenLayers.Util.vendorPrefix.js(window,"requestAnimationFrame"),isNative=!!requestAnimationFrame,requestFrame=function(){var request=window[requestAnimationFrame]||function(callback,element){window.setTimeout(callback,16)};return function(callback,element){request.apply(window,[callback,element])}}(),counter=0,loops={};return{isNative:isNative,requestFrame:requestFrame,start:start,stop:stop}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(easing){this.easing=easing?easing:OpenLayers.Easing.Expo.easeOut},start:function(begin,finish,duration,options){this.playing=!0,this.begin=begin,this.finish=finish,this.duration=duration,this.callbacks=options.callbacks,this.minFrameRate=options.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var value={};for(var i in this.begin){var b=this.begin[i],f=this.finish[i];if(null==b||null==f||isNaN(b)||isNaN(f))throw new TypeError("invalid value for Tween");var c=f-b;value[i]=this.easing.apply(this,[this.time,b,c,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,value),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(t,b,c,d){return c*t/d+b},easeOut:function(t,b,c,d){return c*t/d+b},easeInOut:function(t,b,c,d){return c*t/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(t,b,c,d){return 0==t?b:c*Math.pow(2,10*(t/d-1))+b},easeOut:function(t,b,c,d){return t==d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b},easeInOut:function(t,b,c,d){return 0==t?b:t==d?b+c:(t/=d/2)<1?c/2*Math.pow(2,10*(t-1))+b:c/2*(-Math.pow(2,-10*--t)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(t,b,c,d){return c*(t/=d)*t+b},easeOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},easeInOut:function(t,b,c,d){return(t/=d/2)<1?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(projCode,options){OpenLayers.Util.extend(this,options),this.projCode=projCode,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(projCode))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(projection){var p=projection,equals=!1;if(p)if(p instanceof OpenLayers.Projection||(p=new OpenLayers.Projection(p)),"object"==typeof Proj4js&&this.proj.defData&&p.proj.defData)equals=this.proj.defData.replace(this.titleRegEx,"")==p.proj.defData.replace(this.titleRegEx,"");else if(p.getCode){var source=this.getCode(),target=p.getCode();equals=source==target||!!OpenLayers.Projection.transforms[source]&&OpenLayers.Projection.transforms[source][target]===OpenLayers.Projection.nullTransform}return equals},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(from,to,method){if(method===OpenLayers.Projection.nullTransform){var defaults=OpenLayers.Projection.defaults[from];defaults&&!OpenLayers.Projection.defaults[to]&&(OpenLayers.Projection.defaults[to]=defaults)}OpenLayers.Projection.transforms[from]||(OpenLayers.Projection.transforms[from]={}),OpenLayers.Projection.transforms[from][to]=method},OpenLayers.Projection.transform=function(point,source,dest){if(source&&dest)if(source instanceof OpenLayers.Projection||(source=new OpenLayers.Projection(source)),dest instanceof OpenLayers.Projection||(dest=new OpenLayers.Projection(dest)),source.proj&&dest.proj)point=Proj4js.transform(source.proj,dest.proj,point);else{var sourceCode=source.getCode(),destCode=dest.getCode(),transforms=OpenLayers.Projection.transforms;transforms[sourceCode]&&transforms[sourceCode][destCode]&&transforms[sourceCode][destCode](point)}return point},OpenLayers.Projection.nullTransform=function(point){return point},function(){function inverseMercator(xy){return xy.x=180*xy.x/pole,xy.y=180/Math.PI*(2*Math.atan(Math.exp(xy.y/pole*Math.PI))-Math.PI/2),xy}function forwardMercator(xy){xy.x=xy.x*pole/180;var y=Math.log(Math.tan((90+xy.y)*Math.PI/360))/Math.PI*pole;return xy.y=Math.max(-20037508.34,Math.min(y,20037508.34)),xy}function map(base,codes){var i,len,code,other,j,add=OpenLayers.Projection.addTransform,same=OpenLayers.Projection.nullTransform;for(i=0,len=codes.length;len>i;++i)for(code=codes[i],add(base,code,forwardMercator),add(code,base,inverseMercator),j=i+1;len>j;++j)other=codes[j],add(code,other,same),add(other,code,same)}var i,pole=20037508.34,mercator=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],geographic=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(i=mercator.length-1;i>=0;--i)map(mercator[i],geographic);for(i=geographic.length-1;i>=0;--i)map(geographic[i],mercator)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,
size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(div,options){1===arguments.length&&"object"==typeof div&&(options=div,div=options&&options.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.options=OpenLayers.Util.extend({},options),OpenLayers.Util.extend(this,options);var projCode=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[projCode]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(div),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var id=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(id,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),id=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(id),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.autoUpdateSize===!0&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var addNode=!0,nodes=document.getElementsByTagName("link"),i=0,len=nodes.length;len>i;++i)if(OpenLayers.Util.isEquivalentUrl(nodes.item(i).href,this.theme)){addNode=!1;break}if(addNode){var cssNode=document.createElement("link");cssNode.setAttribute("rel","stylesheet"),cssNode.setAttribute("type","text/css"),cssNode.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(cssNode)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var i=0,len=this.controls.length;len>i;i++)this.addControlToMap(this.controls[i]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),options&&options.layers&&(delete this.center,delete this.zoom,this.addLayers(options.layers),options.center&&!this.getCenter()&&this.setCenter(options.center,options.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(div){this.div=OpenLayers.Util.getElement(div),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var i=this.controls.length-1;i>=0;--i)this.controls[i].destroy();this.controls=null}if(null!=this.layers){for(var i=this.layers.length-1;i>=0;--i)this.layers[i].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(options){var updatePxExtent=this.minPx&&options.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,options),updatePxExtent&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(array,property,match){var test="function"==typeof match.test,found=OpenLayers.Array.filter(this[array],function(item){return item[property]==match||test&&match.test(item[property])});return found},getLayersBy:function(property,match){return this.getBy("layers",property,match)},getLayersByName:function(match){return this.getLayersBy("name",match)},getLayersByClass:function(match){return this.getLayersBy("CLASS_NAME",match)},getControlsBy:function(property,match){return this.getBy("controls",property,match)},getControlsByClass:function(match){return this.getControlsBy("CLASS_NAME",match)},getLayer:function(id){for(var foundLayer=null,i=0,len=this.layers.length;len>i;i++){var layer=this.layers[i];if(layer.id==id){foundLayer=layer;break}}return foundLayer},setLayerZIndex:function(layer,zIdx){layer.setZIndex(this.Z_INDEX_BASE[layer.isBaseLayer?"BaseLayer":"Overlay"]+5*zIdx)},resetLayersZIndex:function(){for(var i=0,len=this.layers.length;len>i;i++){var layer=this.layers[i];this.setLayerZIndex(layer,i)}},addLayer:function(layer){for(var i=0,len=this.layers.length;len>i;i++)if(this.layers[i]==layer)return!1;return this.events.triggerEvent("preaddlayer",{layer:layer})===!1?!1:(this.allOverlays&&(layer.isBaseLayer=!1),layer.div.className="olLayerDiv",layer.div.style.overflow="",this.setLayerZIndex(layer,this.layers.length),layer.isFixed?this.viewPortDiv.appendChild(layer.div):this.layerContainerDiv.appendChild(layer.div),this.layers.push(layer),layer.setMap(this),layer.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(layer):layer.setVisibility(!1):layer.redraw(),this.events.triggerEvent("addlayer",{layer:layer}),layer.events.triggerEvent("added",{map:this,layer:layer}),layer.afterAdd(),!0)},addLayers:function(layers){for(var i=0,len=layers.length;len>i;i++)this.addLayer(layers[i])},removeLayer:function(layer,setNewBaseLayer){if(this.events.triggerEvent("preremovelayer",{layer:layer})!==!1){if(null==setNewBaseLayer&&(setNewBaseLayer=!0),layer.isFixed?this.viewPortDiv.removeChild(layer.div):this.layerContainerDiv.removeChild(layer.div),OpenLayers.Util.removeItem(this.layers,layer),layer.removeMap(this),layer.map=null,this.baseLayer==layer&&(this.baseLayer=null,setNewBaseLayer))for(var i=0,len=this.layers.length;len>i;i++){var iLayer=this.layers[i];if(iLayer.isBaseLayer||this.allOverlays){this.setBaseLayer(iLayer);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:layer}),layer.events.triggerEvent("removed",{map:this,layer:layer})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(layer){return OpenLayers.Util.indexOf(this.layers,layer)},setLayerIndex:function(layer,idx){var base=this.getLayerIndex(layer);if(0>idx?idx=0:idx>this.layers.length&&(idx=this.layers.length),base!=idx){this.layers.splice(base,1),this.layers.splice(idx,0,layer);for(var i=0,len=this.layers.length;len>i;i++)this.setLayerZIndex(this.layers[i],i);this.events.triggerEvent("changelayer",{layer:layer,property:"order"}),this.allOverlays&&(0===idx?this.setBaseLayer(layer):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(layer,delta){var idx=this.getLayerIndex(layer)+delta;this.setLayerIndex(layer,idx)},setBaseLayer:function(newBaseLayer){if(newBaseLayer!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,newBaseLayer)){var center=this.getCachedCenter(),newResolution=OpenLayers.Util.getResolutionFromScale(this.getScale(),newBaseLayer.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=newBaseLayer,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),this.baseLayer.inRange===!1&&this.baseLayer.redraw()),null!=center){var newZoom=this.getZoomForResolution(newResolution||this.resolution,!0);this.setCenter(center,newZoom,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(control,px){this.controls.push(control),this.addControlToMap(control,px)},addControls:function(controls,pixels){for(var pxs=1===arguments.length?[]:pixels,i=0,len=controls.length;len>i;i++){var ctrl=controls[i],px=pxs[i]?pxs[i]:null;this.addControl(ctrl,px)}},addControlToMap:function(control,px){control.outsideViewport=null!=control.div,this.displayProjection&&!control.displayProjection&&(control.displayProjection=this.displayProjection),control.setMap(this);var div=control.draw(px);div&&(control.outsideViewport||(div.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(div))),control.autoActivate&&control.activate()},getControl:function(id){for(var returnControl=null,i=0,len=this.controls.length;len>i;i++){var control=this.controls[i];if(control.id==id){returnControl=control;break}}return returnControl},removeControl:function(control){control&&control==this.getControl(control.id)&&(control.div&&control.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(control.div),OpenLayers.Util.removeItem(this.controls,control))},addPopup:function(popup,exclusive){if(exclusive)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);popup.map=this,this.popups.push(popup);var popupDiv=popup.draw();popupDiv&&(popupDiv.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(popupDiv))},removePopup:function(popup){if(OpenLayers.Util.removeItem(this.popups,popup),popup.div)try{this.layerContainerDiv.removeChild(popup.div)}catch(e){}popup.map=null},getSize:function(){var size=null;return null!=this.size&&(size=this.size.clone()),size},updateSize:function(){var newSize=this.getCurrentSize();if(newSize&&!isNaN(newSize.h)&&!isNaN(newSize.w)){this.events.clearMouseCache();var oldSize=this.getSize();if(null==oldSize&&(this.size=oldSize=newSize),!newSize.equals(oldSize)){this.size=newSize;for(var i=0,len=this.layers.length;len>i;i++)this.layers[i].onMapResize();var center=this.getCachedCenter();if(null!=this.baseLayer&&null!=center){var zoom=this.getZoom();this.zoom=null,this.setCenter(center,zoom)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var size=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==size.w&&0==size.h||isNaN(size.w)&&isNaN(size.h))&&(size.w=this.div.offsetWidth,size.h=this.div.offsetHeight),(0==size.w&&0==size.h||isNaN(size.w)&&isNaN(size.h))&&(size.w=parseInt(this.div.style.width),size.h=parseInt(this.div.style.height)),size},calculateBounds:function(center,resolution){var extent=null;if(null==center&&(center=this.getCachedCenter()),null==resolution&&(resolution=this.getResolution()),null!=center&&null!=resolution){var halfWDeg=this.size.w*resolution/2,halfHDeg=this.size.h*resolution/2;extent=new OpenLayers.Bounds(center.lon-halfWDeg,center.lat-halfHDeg,center.lon+halfWDeg,center.lat+halfHDeg)}return extent},getCenter:function(){var center=null,cachedCenter=this.getCachedCenter();return cachedCenter&&(center=cachedCenter.clone()),center},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(dx,dy,options){if(options=OpenLayers.Util.applyDefaults(options,{animate:!0,dragging:!1}),options.dragging)(0!=dx||0!=dy)&&this.moveByPx(dx,dy);else{var centerPx=this.getViewPortPxFromLonLat(this.getCachedCenter()),newCenterPx=centerPx.add(dx,dy);if(this.dragging||!newCenterPx.equals(centerPx)){var newCenterLonLat=this.getLonLatFromViewPortPx(newCenterPx);options.animate?this.panTo(newCenterLonLat):(this.moveTo(newCenterLonLat),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(lonlat){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(lonlat)){var center=this.getCachedCenter();if(lonlat.equals(center))return;var from=this.getPixelFromLonLat(center),to=this.getPixelFromLonLat(lonlat),vector={x:to.x-from.x,y:to.y-from.y},last={x:0,y:0};this.panTween.start({x:0,y:0},vector,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(px){var x=px.x-last.x,y=px.y-last.y;this.moveByPx(x,y),last.x=Math.round(px.x),last.y=Math.round(px.y)},this),done:OpenLayers.Function.bind(function(px){this.moveTo(lonlat),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(lonlat)},setCenter:function(lonlat,zoom,dragging,forceZoomChange){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(lonlat,zoom,{dragging:dragging,forceZoomChange:forceZoomChange})},moveByPx:function(dx,dy){var hw=this.size.w/2,hh=this.size.h/2,x=hw+dx,y=hh+dy,wrapDateLine=this.baseLayer&&this.baseLayer.wrapDateLine,xRestriction=0,yRestriction=0;if(this.restrictedExtent&&(xRestriction=hw,yRestriction=hh,wrapDateLine=!1),dx=wrapDateLine||x<=this.maxPx.x-xRestriction&&x>=this.minPx.x+xRestriction?Math.round(dx):0,dy=y<=this.maxPx.y-yRestriction&&y>=this.minPx.y+yRestriction?Math.round(dy):0,dx||dy){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,dx&&(this.layerContainerOriginPx.x-=dx,this.minPx.x-=dx,this.maxPx.x-=dx),dy&&(this.layerContainerOriginPx.y-=dy,this.minPx.y-=dy,this.maxPx.y-=dy),this.applyTransform();var layer,i,len;for(i=0,len=this.layers.length;len>i;++i)layer=this.layers[i],layer.visibility&&(layer===this.baseLayer||layer.inRange)&&(layer.moveByPx(dx,dy),layer.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(zoom){if(this.baseLayer&&this.baseLayer.wrapDateLine){var resolutions=this.baseLayer.resolutions,maxResolution=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(zoom)>maxResolution)if(this.fractionalZoom)zoom=this.getZoomForResolution(maxResolution);else for(var i=0|zoom,ii=resolutions.length;ii>i;++i)if(resolutions[i]<=maxResolution){zoom=i;break}}return zoom},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(lonlat,zoom,options){null==lonlat||lonlat instanceof OpenLayers.LonLat||(lonlat=new OpenLayers.LonLat(lonlat)),options||(options={}),null!=zoom&&(zoom=parseFloat(zoom),this.fractionalZoom||(zoom=Math.round(zoom)));var requestedZoom=zoom;zoom=this.adjustZoom(zoom),zoom!==requestedZoom&&(lonlat=this.getCenter());var dragging=options.dragging||this.dragging,forceZoomChange=options.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(lonlat)||(lonlat=this.maxExtent.getCenterLonLat(),this.center=lonlat.clone()),null!=this.restrictedExtent){null==lonlat&&(lonlat=this.center),null==zoom&&(zoom=this.getZoom());var resolution=this.getResolutionForZoom(zoom),extent=this.calculateBounds(lonlat,resolution);if(!this.restrictedExtent.containsBounds(extent)){var maxCenter=this.restrictedExtent.getCenterLonLat();extent.getWidth()>this.restrictedExtent.getWidth()?lonlat=new OpenLayers.LonLat(maxCenter.lon,lonlat.lat):extent.left<this.restrictedExtent.left?lonlat=lonlat.add(this.restrictedExtent.left-extent.left,0):extent.right>this.restrictedExtent.right&&(lonlat=lonlat.add(this.restrictedExtent.right-extent.right,0)),extent.getHeight()>this.restrictedExtent.getHeight()?lonlat=new OpenLayers.LonLat(lonlat.lon,maxCenter.lat):extent.bottom<this.restrictedExtent.bottom?lonlat=lonlat.add(0,this.restrictedExtent.bottom-extent.bottom):extent.top>this.restrictedExtent.top&&(lonlat=lonlat.add(0,this.restrictedExtent.top-extent.top))}}var zoomChanged=forceZoomChange||this.isValidZoomLevel(zoom)&&zoom!=this.getZoom(),centerChanged=this.isValidLonLat(lonlat)&&!lonlat.equals(this.center);if(zoomChanged||centerChanged||dragging){dragging||this.events.triggerEvent("movestart",{zoomChanged:zoomChanged}),centerChanged&&(!zoomChanged&&this.center&&this.centerLayerContainer(lonlat),this.center=lonlat.clone());var res=zoomChanged?this.getResolutionForZoom(zoom):this.getResolution();if(zoomChanged||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var maxExtent=this.getMaxExtent({restricted:!0}),maxExtentCenter=maxExtent.getCenterLonLat(),lonDelta=this.center.lon-maxExtentCenter.lon,latDelta=maxExtentCenter.lat-this.center.lat,extentWidth=Math.round(maxExtent.getWidth()/res),extentHeight=Math.round(maxExtent.getHeight()/res);this.minPx={x:(this.size.w-extentWidth)/2-lonDelta/res,y:(this.size.h-extentHeight)/2-latDelta/res},this.maxPx={x:this.minPx.x+Math.round(maxExtent.getWidth()/res),y:this.minPx.y+Math.round(maxExtent.getHeight()/res)}}zoomChanged&&(this.zoom=zoom,this.resolution=res);var bounds=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(bounds,zoomChanged,options.dragging),options.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:zoomChanged})),bounds=this.baseLayer.getExtent();for(var i=this.layers.length-1;i>=0;--i){var layer=this.layers[i];if(layer!==this.baseLayer&&!layer.isBaseLayer){var inRange=layer.calculateInRange();layer.inRange!=inRange&&(layer.inRange=inRange,inRange||layer.display(!1),this.events.triggerEvent("changelayer",{layer:layer,property:"visibility"})),inRange&&layer.visibility&&(layer.moveTo(bounds,zoomChanged,options.dragging),options.dragging||layer.events.triggerEvent("moveend",{zoomChanged:zoomChanged}))}}if(this.events.triggerEvent("move"),dragging||this.events.triggerEvent("moveend"),zoomChanged){for(var i=0,len=this.popups.length;len>i;i++)this.popups[i].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(lonlat){var originPx=this.getViewPortPxFromLonLat(this.layerContainerOrigin),newPx=this.getViewPortPxFromLonLat(lonlat);if(null!=originPx&&null!=newPx){var oldLeft=this.layerContainerOriginPx.x,oldTop=this.layerContainerOriginPx.y,newLeft=Math.round(originPx.x-newPx.x),newTop=Math.round(originPx.y-newPx.y);this.applyTransform(this.layerContainerOriginPx.x=newLeft,this.layerContainerOriginPx.y=newTop);var dx=oldLeft-newLeft,dy=oldTop-newTop;this.minPx.x-=dx,this.maxPx.x-=dx,this.minPx.y-=dy,this.maxPx.y-=dy}},isValidZoomLevel:function(zoomLevel){return null!=zoomLevel&&zoomLevel>=0&&zoomLevel<this.getNumZoomLevels()},isValidLonLat:function(lonlat){var valid=!1;if(null!=lonlat){var maxExtent=this.getMaxExtent(),worldBounds=this.baseLayer&&this.baseLayer.wrapDateLine&&maxExtent;valid=maxExtent&&maxExtent.containsLonLat(lonlat,{worldBounds:worldBounds})}return valid},getProjection:function(){var projection=this.getProjectionObject();return projection?projection.getCode():null},getProjectionObject:function(){var projection=null;return null!=this.baseLayer&&(projection=this.baseLayer.projection),projection},getMaxResolution:function(){var maxResolution=null;return null!=this.baseLayer&&(maxResolution=this.baseLayer.maxResolution),maxResolution},getMaxExtent:function(options){var maxExtent=null;return options&&options.restricted&&this.restrictedExtent?maxExtent=this.restrictedExtent:null!=this.baseLayer&&(maxExtent=this.baseLayer.maxExtent),maxExtent},getNumZoomLevels:function(){var numZoomLevels=null;return null!=this.baseLayer&&(numZoomLevels=this.baseLayer.numZoomLevels),numZoomLevels},getExtent:function(){var extent=null;return null!=this.baseLayer&&(extent=this.baseLayer.getExtent()),extent},getResolution:function(){var resolution=null;return null!=this.baseLayer?resolution=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(resolution=this.layers[0].getResolution()),resolution},getUnits:function(){var units=null;return null!=this.baseLayer&&(units=this.baseLayer.units),units},getScale:function(){var scale=null;if(null!=this.baseLayer){var res=this.getResolution(),units=this.baseLayer.units;scale=OpenLayers.Util.getScaleFromResolution(res,units)}return scale},getZoomForExtent:function(bounds,closest){var zoom=null;return null!=this.baseLayer&&(zoom=this.baseLayer.getZoomForExtent(bounds,closest)),zoom},getResolutionForZoom:function(zoom){var resolution=null;return this.baseLayer&&(resolution=this.baseLayer.getResolutionForZoom(zoom)),resolution},getZoomForResolution:function(resolution,closest){var zoom=null;return null!=this.baseLayer&&(zoom=this.baseLayer.getZoomForResolution(resolution,closest)),zoom},zoomTo:function(zoom,xy){var map=this;if(map.isValidZoomLevel(zoom))if(map.baseLayer.wrapDateLine&&(zoom=map.adjustZoom(zoom)),map.zoomTween){var currentRes=map.getResolution(),targetRes=map.getResolutionForZoom(zoom),start={scale:1},end={scale:currentRes/targetRes};if(map.zoomTween.playing&&map.zoomTween.duration<3*map.zoomDuration)map.zoomTween.finish={scale:map.zoomTween.finish.scale*end.scale};else{if(!xy){var size=map.getSize();xy={x:size.w/2,y:size.h/2}}map.zoomTween.start(start,end,map.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(data){var containerOrigin=map.layerContainerOriginPx,scale=data.scale,dx=(scale-1)*(containerOrigin.x-xy.x)|0,dy=(scale-1)*(containerOrigin.y-xy.y)|0;map.applyTransform(containerOrigin.x+dx,containerOrigin.y+dy,scale)},done:function(data){map.applyTransform();var resolution=map.getResolution()/data.scale,zoom=map.getZoomForResolution(resolution,!0);map.moveTo(map.getZoomTargetCenter(xy,resolution),zoom,!0)}}})}}else{var center=xy?map.getZoomTargetCenter(xy,map.getResolutionForZoom(zoom)):null;map.setCenter(center,zoom)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(bounds,closest){bounds instanceof OpenLayers.Bounds||(bounds=new OpenLayers.Bounds(bounds));var center=bounds.getCenterLonLat();if(this.baseLayer&&this.baseLayer.wrapDateLine){var maxExtent=this.getMaxExtent();for(bounds=bounds.clone();bounds.right<bounds.left;)bounds.right+=maxExtent.getWidth();center=bounds.getCenterLonLat().wrapDateLine(maxExtent)}this.setCenter(center,this.getZoomForExtent(bounds,closest))},zoomToMaxExtent:function(options){var restricted=options?options.restricted:!0,maxExtent=this.getMaxExtent({restricted:restricted});this.zoomToExtent(maxExtent)},zoomToScale:function(scale,closest){var res=OpenLayers.Util.getResolutionFromScale(scale,this.baseLayer.units),halfWDeg=this.size.w*res/2,halfHDeg=this.size.h*res/2,center=this.getCachedCenter(),extent=new OpenLayers.Bounds(center.lon-halfWDeg,center.lat-halfHDeg,center.lon+halfWDeg,center.lat+halfHDeg);this.zoomToExtent(extent,closest)},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;return null!=this.baseLayer&&(lonlat=this.baseLayer.getLonLatFromViewPortPx(viewPortPx)),lonlat},getViewPortPxFromLonLat:function(lonlat){var px=null;return null!=this.baseLayer&&(px=this.baseLayer.getViewPortPxFromLonLat(lonlat)),px},getZoomTargetCenter:function(xy,resolution){var lonlat=null,size=this.getSize(),deltaX=size.w/2-xy.x,deltaY=xy.y-size.h/2,zoomPoint=this.getLonLatFromPixel(xy);return zoomPoint&&(lonlat=new OpenLayers.LonLat(zoomPoint.lon+deltaX*resolution,zoomPoint.lat+deltaY*resolution)),lonlat},getLonLatFromPixel:function(px){return this.getLonLatFromViewPortPx(px)},getPixelFromLonLat:function(lonlat){var px=this.getViewPortPxFromLonLat(lonlat);return px.x=Math.round(px.x),px.y=Math.round(px.y),px},getGeodesicPixelSize:function(px){var lonlat=px?this.getLonLatFromPixel(px):this.getCachedCenter()||new OpenLayers.LonLat(0,0),res=this.getResolution(),left=lonlat.add(-res/2,0),right=lonlat.add(res/2,0),bottom=lonlat.add(0,-res/2),top=lonlat.add(0,res/2),dest=new OpenLayers.Projection("EPSG:4326"),source=this.getProjectionObject()||dest;return source.equals(dest)||(left.transform(source,dest),right.transform(source,dest),bottom.transform(source,dest),top.transform(source,dest)),new OpenLayers.Size(OpenLayers.Util.distVincenty(left,right),OpenLayers.Util.distVincenty(bottom,top))},getViewPortPxFromLayerPx:function(layerPx){var viewPortPx=null;if(null!=layerPx){var dX=this.layerContainerOriginPx.x,dY=this.layerContainerOriginPx.y;viewPortPx=layerPx.add(dX,dY)}return viewPortPx},getLayerPxFromViewPortPx:function(viewPortPx){var layerPx=null;if(null!=viewPortPx){var dX=-this.layerContainerOriginPx.x,dY=-this.layerContainerOriginPx.y;layerPx=viewPortPx.add(dX,dY),(isNaN(layerPx.x)||isNaN(layerPx.y))&&(layerPx=null)}return layerPx},getLonLatFromLayerPx:function(px){return px=this.getViewPortPxFromLayerPx(px),this.getLonLatFromViewPortPx(px)},getLayerPxFromLonLat:function(lonlat){var px=this.getPixelFromLonLat(lonlat);return this.getLayerPxFromViewPortPx(px)},applyTransform:function(x,y,scale){scale=scale||1;var origin=this.layerContainerOriginPx,needTransform=1!==scale;x=x||origin.x,y=y||origin.y;var style=this.layerContainerDiv.style,transform=this.applyTransform.transform,template=this.applyTransform.template;if(void 0===transform&&(transform=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=transform,transform)){var computedStyle=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));computedStyle&&"none"===computedStyle||(template=["translate3d(",",0) ","scale3d(",",1)"],style[transform]=[template[0],"0,0",template[1]].join("")),template&&~style[transform].indexOf(template[0])||(template=["translate(",") ","scale(",")"]),this.applyTransform.template=template}null===transform||"translate3d("!==template[0]&&needTransform!==!0?(style.left=x+"px",style.top=y+"px",null!==transform&&(style[transform]="")):(needTransform===!0&&"translate("===template[0]&&(x-=origin.x,y-=origin.y,style.left=origin.x+"px",style.top=origin.y+"px"),style[transform]=[template[0],x,"px,",y,"px",template[1],template[2],scale,",",scale,template[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(control,callbacks,options){OpenLayers.Util.extend(this,options),this.control=control,this.callbacks=callbacks;var map=this.map||control.map;map&&this.setMap(map),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(map){this.map=map},checkModifiers:function(evt){if(null==this.keyMask)return!0;var keyModifiers=(evt.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(evt.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(evt.altKey?OpenLayers.Handler.MOD_ALT:0)|(evt.metaKey?OpenLayers.Handler.MOD_META:0);return keyModifiers==this.keyMask},activate:function(){if(this.active)return!1;for(var events=OpenLayers.Events.prototype.BROWSER_EVENTS,i=0,len=events.length;len>i;i++)this[events[i]]&&this.register(events[i],this[events[i]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var events=OpenLayers.Events.prototype.BROWSER_EVENTS,i=0,len=events.length;len>i;i++)this[events[i]]&&this.unregister(events[i],this[events[i]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var events=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],i=0,len=events.length;len>i;i++)this[events[i]]&&this.unregister(events[i],this[events[i]])}},callback:function(name,args){name&&this.callbacks[name]&&this.callbacks[name].apply(this.control,args)},register:function(name,method){this.map.events.registerPriority(name,this,method),this.map.events.registerPriority(name,this,this.setEvent)},unregister:function(name,method){this.map.events.unregister(name,this,method),this.map.events.unregister(name,this,this.setEvent)},setEvent:function(evt){return this.evt=evt,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(evt){return this.startTouch(),this.down=this.getEventInfo(evt),this.last=this.getEventInfo(evt),!0},touchmove:function(evt){return this.last=this.getEventInfo(evt),!0},touchend:function(evt){return this.down&&(evt.xy=this.last.xy,evt.lastTouches=this.last.touches,this.handleSingle(evt),this.down=null),!0},mousedown:function(evt){return this.down=this.getEventInfo(evt),this.last=this.getEventInfo(evt),!0},mouseup:function(evt){var propagate=!0;return this.checkModifiers(evt)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(evt)&&(propagate=this.rightclick(evt)),propagate},rightclick:function(evt){if(this.passesTolerance(evt)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[evt]),!this.stopDouble;var clickEvent=this["double"]?OpenLayers.Util.extend({},evt):this.callback("rightclick",[evt]),delayedRightCall=OpenLayers.Function.bind(this.delayedRightCall,this,clickEvent);this.rightclickTimerId=window.setTimeout(delayedRightCall,this.delay)}return!this.stopSingle},delayedRightCall:function(evt){this.rightclickTimerId=null,evt&&this.callback("rightclick",[evt])},click:function(evt){return this.last||(this.last=this.getEventInfo(evt)),this.handleSingle(evt),!this.stopSingle},dblclick:function(evt){return this.handleDouble(evt),!this.stopDouble},handleDouble:function(evt){this.passesDblclickTolerance(evt)&&(this["double"]&&this.callback("dblclick",[evt]),this.clearTimer())},handleSingle:function(evt){if(this.passesTolerance(evt))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.preventDefault(evt),this.handleDouble(evt)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(evt);var clickEvent=this.single?OpenLayers.Util.extend({},evt):null;this.queuePotentialClick(clickEvent)}},queuePotentialClick:function(evt){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,evt),this.delay);
},passesTolerance:function(evt){var passes=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(passes=this.pixelTolerance>=this.down.xy.distanceTo(evt.xy),passes&&this.touch&&this.down.touches.length===this.last.touches.length))for(var i=0,ii=this.down.touches.length;ii>i;++i)if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){passes=!1;break}return passes},getTouchDistance:function(from,to){return Math.sqrt(Math.pow(from.clientX-to.clientX,2)+Math.pow(from.clientY-to.clientY,2))},passesDblclickTolerance:function(evt){var passes=!0;return this.down&&this.first&&(passes=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),passes},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(evt){this.timerId=null,evt&&this.callback("click",[evt])},getEventInfo:function(evt){var touches;if(evt.touches){var len=evt.touches.length;touches=new Array(len);for(var touch,i=0;len>i;i++)touch=evt.touches[i],touches[i]={clientX:touch.olClientX,clientY:touch.olClientY}}return{xy:evt.xy,touches:touches}},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,deactivated=!0),deactivated},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(control,callbacks,options){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.documentDrag===!0){var me=this;this._docMove=function(evt){me.mousemove({xy:{x:evt.clientX,y:evt.clientY},element:document})},this._docUp=function(evt){me.mouseup({xy:{x:evt.clientX,y:evt.clientY}})}}},dragstart:function(evt){var propagate=!0;return this.dragging=!1,this.checkModifiers(evt)&&(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt))?(this.started=!0,this.start=evt.xy,this.last=evt.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(evt),this.callback("down",[evt.xy]),OpenLayers.Event.preventDefault(evt),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,propagate=!this.stopDown):(this.started=!1,this.start=null,this.last=null),propagate},dragmove:function(evt){return this.lastMoveEvt=evt,!this.started||this.timeoutId||evt.xy.x==this.last.x&&evt.xy.y==this.last.y||(this.documentDrag===!0&&this.documentEvents&&(evt.element===document?(this.adjustXY(evt),this.setEvent(evt)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(evt),this.callback("move",[evt.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=evt.xy),!0},dragend:function(evt){if(this.started){this.documentDrag===!0&&this.documentEvents&&(this.adjustXY(evt),this.removeDocumentEvents());var dragged=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(evt),this.callback("up",[evt.xy]),dragged&&this.callback("done",[evt.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(evt){},move:function(evt){},up:function(evt){},out:function(evt){},mousedown:function(evt){return this.dragstart(evt)},touchstart:function(evt){return this.startTouch(),this.dragstart(evt)},mousemove:function(evt){return this.dragmove(evt)},touchmove:function(evt){return this.dragmove(evt)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(evt){return this.dragend(evt)},touchend:function(evt){return evt.xy=this.last,this.dragend(evt)},mouseout:function(evt){if(this.started&&OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var dragged=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(evt),this.callback("out",[]),dragged&&this.callback("done",[evt.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(evt){return this.start==this.last},activate:function(){var activated=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,deactivated=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),deactivated},adjustXY:function(evt){var pos=OpenLayers.Util.pagePosition(this.map.viewPortDiv);evt.xy.x-=pos[0],evt.xy.y-=pos[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(options){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[options])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var layer=this.map.baseLayer.clone();this.layers=[layer]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var img=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,img,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv);var img=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,img,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(px){var deltaX=this.handlers.drag.last.x-px.x,deltaY=this.handlers.drag.last.y-px.y;if(0!=deltaX||0!=deltaY){var rectTop=this.rectPxBounds.top,rectLeft=this.rectPxBounds.left,rectHeight=Math.abs(this.rectPxBounds.getHeight()),rectWidth=this.rectPxBounds.getWidth(),newTop=Math.max(0,rectTop-deltaY);newTop=Math.min(newTop,this.ovmap.size.h-this.hComp-rectHeight);var newLeft=Math.max(0,rectLeft-deltaX);newLeft=Math.min(newLeft,this.ovmap.size.w-this.wComp-rectWidth),this.setRectPxBounds(new OpenLayers.Bounds(newLeft,newTop+rectHeight,newLeft+rectWidth,newTop))}},mapDivClick:function(evt){var pxCenter=this.rectPxBounds.getCenterPixel(),deltaX=evt.xy.x-pxCenter.x,deltaY=evt.xy.y-pxCenter.y,top=this.rectPxBounds.top,left=this.rectPxBounds.left,height=Math.abs(this.rectPxBounds.getHeight()),width=this.rectPxBounds.getWidth(),newTop=Math.max(0,top+deltaY);newTop=Math.min(newTop,this.ovmap.size.h-height);var newLeft=Math.max(0,left+deltaX);newLeft=Math.min(newLeft,this.ovmap.size.w-width),this.setRectPxBounds(new OpenLayers.Bounds(newLeft,newTop+height,newLeft+width,newTop)),this.updateMapToRect()},onButtonClick:function(evt){evt.buttonElement===this.minimizeDiv?this.minimizeControl():evt.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="",this.showToggle(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none",this.showToggle(!0),null!=e&&OpenLayers.Event.stop(e)},showToggle:function(minimize){this.maximizeDiv&&(this.maximizeDiv.style.display=minimize?"":"none"),this.minimizeDiv&&(this.minimizeDiv.style.display=minimize?"none":"")},update:function(){null==this.ovmap&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var mapExtent=this.map.getExtent(),maxExtent=this.map.getMaxExtent(),testExtent=new OpenLayers.Bounds(Math.max(mapExtent.left,maxExtent.left),Math.max(mapExtent.bottom,maxExtent.bottom),Math.min(mapExtent.right,maxExtent.right),Math.min(mapExtent.top,maxExtent.top));this.ovmap.getProjection()!=this.map.getProjection()&&(testExtent=testExtent.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var resRatio=this.ovmap.getResolution()/this.map.getResolution();return resRatio>this.minRatio&&resRatio<=this.maxRatio&&this.ovmap.getExtent().containsBounds(testExtent)},updateOverview:function(){var mapRes=this.map.getResolution(),targetRes=this.ovmap.getResolution(),resRatio=targetRes/mapRes;resRatio>this.maxRatio?targetRes=this.minRatio*mapRes:resRatio<=this.minRatio&&(targetRes=this.maxRatio*mapRes);var center;this.ovmap.getProjection()!=this.map.getProjection()?(center=this.map.center.clone(),center.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):center=this.map.center,this.ovmap.setCenter(center,this.ovmap.getZoomForResolution(targetRes*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var options=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);if(this.ovmap=new OpenLayers.Map(this.mapDiv,options),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(e){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(e){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()){var sourceUnits=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,targetUnits=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=sourceUnits&&targetUnits?OpenLayers.INCHES_PER_UNIT[sourceUnits]/OpenLayers.INCHES_PER_UNIT[targetUnits]:1}},updateRectToMap:function(){var bounds;bounds=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var pxBounds=this.getRectBoundsFromMapBounds(bounds);pxBounds&&this.setRectPxBounds(pxBounds)},updateMapToRect:function(){var lonLatBounds=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(lonLatBounds=lonLatBounds.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(lonLatBounds.getCenterLonLat())},setRectPxBounds:function(pxBounds){var top=Math.max(pxBounds.top,0),left=Math.max(pxBounds.left,0),bottom=Math.min(pxBounds.top+Math.abs(pxBounds.getHeight()),this.ovmap.size.h-this.hComp),right=Math.min(pxBounds.left+pxBounds.getWidth(),this.ovmap.size.w-this.wComp),width=Math.max(right-left,0),height=Math.max(bottom-top,0);if(width<this.minRectSize||height<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var rLeft=left+width/2-this.minRectSize/2,rTop=top+height/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(rTop)+"px",this.extentRectangle.style.left=Math.round(rLeft)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(top)+"px",this.extentRectangle.style.left=Math.round(left)+"px",this.extentRectangle.style.height=Math.round(height)+"px",this.extentRectangle.style.width=Math.round(width)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(left),Math.round(bottom),Math.round(right),Math.round(top))},getRectBoundsFromMapBounds:function(lonLatBounds){var leftBottomPx=this.getOverviewPxFromLonLat({lon:lonLatBounds.left,lat:lonLatBounds.bottom}),rightTopPx=this.getOverviewPxFromLonLat({lon:lonLatBounds.right,lat:lonLatBounds.top}),bounds=null;return leftBottomPx&&rightTopPx&&(bounds=new OpenLayers.Bounds(leftBottomPx.x,leftBottomPx.y,rightTopPx.x,rightTopPx.y)),bounds},getMapBoundsFromRectBounds:function(pxBounds){var leftBottomLonLat=this.getLonLatFromOverviewPx({x:pxBounds.left,y:pxBounds.bottom}),rightTopLonLat=this.getLonLatFromOverviewPx({x:pxBounds.right,y:pxBounds.top});return new OpenLayers.Bounds(leftBottomLonLat.lon,leftBottomLonLat.lat,rightTopLonLat.lon,rightTopLonLat.lat)},getLonLatFromOverviewPx:function(overviewMapPx){var size=this.ovmap.size,res=this.ovmap.getResolution(),center=this.ovmap.getExtent().getCenterLonLat(),deltaX=overviewMapPx.x-size.w/2,deltaY=overviewMapPx.y-size.h/2;return{lon:center.lon+deltaX*res,lat:center.lat-deltaY*res}},getOverviewPxFromLonLat:function(lonlat){var res=this.ovmap.getResolution(),extent=this.ovmap.getExtent();return extent?{x:Math.round(1/res*(lonlat.lon-extent.left)),y:Math.round(1/res*(extent.top-lonlat.lat))}:void 0},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(name,options){this.metadata={},options=OpenLayers.Util.extend({},options),null!=this.alwaysInRange&&(options.alwaysInRange=this.alwaysInRange),this.addOptions(options),this.name=name,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(setNewBaseLayer){null==setNewBaseLayer&&(setNewBaseLayer=!0),null!=this.map&&this.map.removeLayer(this,setNewBaseLayer),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(obj,this),obj.map=null,obj},getOptions:function(){var options={};for(var o in this.options)options[o]=this[o];return options},setName:function(newName){newName!=this.name&&(this.name=newName,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(newOptions,reinitialize){if(null==this.options&&(this.options={}),newOptions&&("string"==typeof newOptions.projection&&(newOptions.projection=new OpenLayers.Projection(newOptions.projection)),newOptions.projection&&OpenLayers.Util.applyDefaults(newOptions,OpenLayers.Projection.defaults[newOptions.projection.getCode()]),!newOptions.maxExtent||newOptions.maxExtent instanceof OpenLayers.Bounds||(newOptions.maxExtent=new OpenLayers.Bounds(newOptions.maxExtent)),!newOptions.minExtent||newOptions.minExtent instanceof OpenLayers.Bounds||(newOptions.minExtent=new OpenLayers.Bounds(newOptions.minExtent))),OpenLayers.Util.extend(this.options,newOptions),OpenLayers.Util.extend(this,newOptions),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var resolution=this.map.getResolution(),properties=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var o in newOptions)if(newOptions.hasOwnProperty(o)&&OpenLayers.Util.indexOf(properties,o)>=0){this.initResolutions(),reinitialize&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(resolution),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var redrawn=!1;if(this.map){this.inRange=this.calculateInRange();var extent=this.getExtent();if(extent&&this.inRange&&this.visibility){var zoomChanged=!0;this.moveTo(extent,zoomChanged,!1),this.events.triggerEvent("moveend",{zoomChanged:zoomChanged}),redrawn=!0}}return redrawn},moveTo:function(bounds,zoomChanged,dragging){var display=this.visibility;this.isBaseLayer||(display=display&&this.inRange),this.display(display)},moveByPx:function(dx,dy){},setMap:function(map){if(null==this.map){if(this.map=map,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var show=this.visibility&&this.inRange;this.div.style.display=show?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(map){},getImageSize:function(bounds){return this.imageSize||this.tileSize},setTileSize:function(size){var tileSize=size?size:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=tileSize,this.gutter&&(this.imageSize=new OpenLayers.Size(tileSize.w+2*this.gutter,tileSize.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(visibility){visibility!=this.visibility&&(this.visibility=visibility,this.display(visibility),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(display){display!=("none"!=this.div.style.display)&&(this.div.style.display=display&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var inRange=!1;if(this.alwaysInRange)inRange=!0;else if(this.map){var resolution=this.map.getResolution();inRange=resolution>=this.minResolution&&resolution<=this.maxResolution}return inRange},setIsBaseLayer:function(isBaseLayer){isBaseLayer!=this.isBaseLayer&&(this.isBaseLayer=isBaseLayer,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var i,len,p,props={},alwaysInRange=!0;for(i=0,len=this.RESOLUTION_PROPERTIES.length;len>i;i++)p=this.RESOLUTION_PROPERTIES[i],props[p]=this.options[p],alwaysInRange&&this.options[p]&&(alwaysInRange=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=alwaysInRange),null==props.resolutions&&(props.resolutions=this.resolutionsFromScales(props.scales)),null==props.resolutions&&(props.resolutions=this.calculateResolutions(props)),null==props.resolutions){for(i=0,len=this.RESOLUTION_PROPERTIES.length;len>i;i++)p=this.RESOLUTION_PROPERTIES[i],props[p]=null!=this.options[p]?this.options[p]:this.map[p];null==props.resolutions&&(props.resolutions=this.resolutionsFromScales(props.scales)),null==props.resolutions&&(props.resolutions=this.calculateResolutions(props))}var maxResolution;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(maxResolution=this.options.maxResolution),this.options.minScale&&(maxResolution=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var minResolution;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(minResolution=this.options.minResolution),this.options.maxScale&&(minResolution=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),props.resolutions&&(props.resolutions.sort(function(a,b){return b-a}),maxResolution||(maxResolution=props.resolutions[0]),!minResolution)){var lastIdx=props.resolutions.length-1;minResolution=props.resolutions[lastIdx]}if(this.resolutions=props.resolutions,this.resolutions){for(len=this.resolutions.length,this.scales=new Array(len),i=0;len>i;i++)this.scales[i]=OpenLayers.Util.getScaleFromResolution(this.resolutions[i],this.units);this.numZoomLevels=len}this.minResolution=minResolution,minResolution&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(minResolution,this.units)),this.maxResolution=maxResolution,maxResolution&&(this.minScale=OpenLayers.Util.getScaleFromResolution(maxResolution,this.units))},resolutionsFromScales:function(scales){if(null!=scales){var resolutions,i,len;for(len=scales.length,resolutions=new Array(len),i=0;len>i;i++)resolutions[i]=OpenLayers.Util.getResolutionFromScale(scales[i],this.units);return resolutions}},calculateResolutions:function(props){var viewSize,wRes,hRes,maxResolution=props.maxResolution;null!=props.minScale?maxResolution=OpenLayers.Util.getResolutionFromScale(props.minScale,this.units):"auto"==maxResolution&&null!=this.maxExtent&&(viewSize=this.map.getSize(),wRes=this.maxExtent.getWidth()/viewSize.w,hRes=this.maxExtent.getHeight()/viewSize.h,maxResolution=Math.max(wRes,hRes));var minResolution=props.minResolution;if(null!=props.maxScale?minResolution=OpenLayers.Util.getResolutionFromScale(props.maxScale,this.units):"auto"==props.minResolution&&null!=this.minExtent&&(viewSize=this.map.getSize(),wRes=this.minExtent.getWidth()/viewSize.w,hRes=this.minExtent.getHeight()/viewSize.h,minResolution=Math.max(wRes,hRes)),"number"!=typeof maxResolution&&"number"!=typeof minResolution&&null!=this.maxExtent){var tileSize=this.map.getTileSize();maxResolution=Math.max(this.maxExtent.getWidth()/tileSize.w,this.maxExtent.getHeight()/tileSize.h)}var maxZoomLevel=props.maxZoomLevel,numZoomLevels=props.numZoomLevels;if("number"==typeof minResolution&&"number"==typeof maxResolution&&void 0===numZoomLevels){var ratio=maxResolution/minResolution;numZoomLevels=Math.floor(Math.log(ratio)/Math.log(2))+1}else void 0===numZoomLevels&&null!=maxZoomLevel&&(numZoomLevels=maxZoomLevel+1);if(!("number"!=typeof numZoomLevels||0>=numZoomLevels||"number"!=typeof maxResolution&&"number"!=typeof minResolution)){var resolutions=new Array(numZoomLevels),base=2;"number"==typeof minResolution&&"number"==typeof maxResolution&&(base=Math.pow(maxResolution/minResolution,1/(numZoomLevels-1)));var i;if("number"==typeof maxResolution)for(i=0;numZoomLevels>i;i++)resolutions[i]=maxResolution/Math.pow(base,i);else for(i=0;numZoomLevels>i;i++)resolutions[numZoomLevels-1-i]=minResolution*Math.pow(base,i);return resolutions}},getResolution:function(){var zoom=this.map.getZoom();return this.getResolutionForZoom(zoom)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(extent,closest){var viewSize=this.map.getSize(),idealResolution=Math.max(extent.getWidth()/viewSize.w,extent.getHeight()/viewSize.h);return this.getZoomForResolution(idealResolution,closest)},getDataExtent:function(){},getResolutionForZoom:function(zoom){zoom=Math.max(0,Math.min(zoom,this.resolutions.length-1));var resolution;if(this.map.fractionalZoom){var low=Math.floor(zoom),high=Math.ceil(zoom);resolution=this.resolutions[low]-(zoom-low)*(this.resolutions[low]-this.resolutions[high])}else resolution=this.resolutions[Math.round(zoom)];return resolution},getZoomForResolution:function(resolution,closest){var zoom,i,len;if(this.map.fractionalZoom){var res,lowZoom=0,highZoom=this.resolutions.length-1,highRes=this.resolutions[lowZoom],lowRes=this.resolutions[highZoom];for(i=0,len=this.resolutions.length;len>i;++i)if(res=this.resolutions[i],res>=resolution&&(highRes=res,lowZoom=i),resolution>=res){lowRes=res,highZoom=i;break}var dRes=highRes-lowRes;zoom=dRes>0?lowZoom+(highRes-resolution)/dRes:lowZoom}else{var diff,minDiff=Number.POSITIVE_INFINITY;for(i=0,len=this.resolutions.length;len>i;i++)if(closest){if(diff=Math.abs(this.resolutions[i]-resolution),diff>minDiff)break;minDiff=diff}else if(this.resolutions[i]<resolution)break;zoom=Math.max(0,i-1)}return zoom},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null,map=this.map;if(null!=viewPortPx&&map.minPx){var res=map.getResolution(),maxExtent=map.getMaxExtent({restricted:!0}),lon=(viewPortPx.x-map.minPx.x)*res+maxExtent.left,lat=(map.minPx.y-viewPortPx.y)*res+maxExtent.top;lonlat=new OpenLayers.LonLat(lon,lat),this.wrapDateLine&&(lonlat=lonlat.wrapDateLine(this.maxExtent))}return lonlat},getViewPortPxFromLonLat:function(lonlat,resolution){var px=null;if(null!=lonlat){resolution=resolution||this.map.getResolution();var extent=this.map.calculateBounds(null,resolution);px=new OpenLayers.Pixel(1/resolution*(lonlat.lon-extent.left),1/resolution*(extent.top-lonlat.lat))}return px},setOpacity:function(opacity){if(opacity!=this.opacity){this.opacity=opacity;for(var childNodes=this.div.childNodes,i=0,len=childNodes.length;len>i;++i){var element=childNodes[i].firstChild||childNodes[i],lastChild=childNodes[i].lastChild;lastChild&&"iframe"===lastChild.nodeName.toLowerCase()&&(element=lastChild.parentNode),OpenLayers.Util.modifyDOMElement(element,null,null,null,null,null,null,opacity)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(zIndex){this.div.style.zIndex=zIndex},adjustBounds:function(bounds){if(this.gutter){var mapGutter=this.gutter*this.map.getResolution();bounds=new OpenLayers.Bounds(bounds.left-mapGutter,bounds.bottom-mapGutter,bounds.right+mapGutter,bounds.top+mapGutter)}if(this.wrapDateLine){var wrappingOptions={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};bounds=bounds.wrapDateLine(this.maxExtent,wrappingOptions)}return bounds},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.SphericalMercator={getExtent:function(){var extent=null;return extent=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(viewPortPx){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(lonlat){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var maxResolution=156543.03390625,zoom=0;zoom<=this.MAX_ZOOM_LEVEL;++zoom)this.RESOLUTIONS[zoom]=maxResolution/Math.pow(2,zoom);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var gg=new OpenLayers.Projection("EPSG:4326"),sm=new OpenLayers.Projection("EPSG:900913");return function(lon,lat){var point=OpenLayers.Projection.transform({x:lon,y:lat},gg,sm);return new OpenLayers.LonLat(point.x,point.y)}}(),inverseMercator:function(){var gg=new OpenLayers.Projection("EPSG:4326"),sm=new OpenLayers.Projection("EPSG:900913");return function(x,y){var point=OpenLayers.Projection.transform({x:x,y:y},sm,gg);return new OpenLayers.LonLat(point.x,point.y)}}()},OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(name,options){OpenLayers.Layer.prototype.initialize.apply(this,arguments),null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.mapObject=null,this.pane=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(map){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1,this.pane.style.display=this.div.style.display,this.pane.style.width="100%",this.pane.style.height="100%","msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"),this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane),this.loadMapObject(),null==this.mapObject&&this.loadWarningMessage()},removeMap:function(map){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane),OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var viewSize=this.map.getSize(),msgW=Math.min(viewSize.w,300),msgH=Math.min(viewSize.h,200),size=new OpenLayers.Size(msgW,msgH),centerPx=new OpenLayers.Pixel(viewSize.w/2,viewSize.h/2),topLeft=centerPx.add(-size.w/2,-size.h/2),div=OpenLayers.Util.createDiv(this.name+"_warning",topLeft,size,null,null,null,"auto");
div.style.padding="7px",div.style.backgroundColor="yellow",div.innerHTML=this.getWarningHTML(),this.div.appendChild(div)},getWarningHTML:function(){return""},display:function(display){OpenLayers.Layer.prototype.display.apply(this,arguments),this.pane.style.display=this.div.style.display},setZIndex:function(zIndex){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(dx,dy){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments),this.dragPanMapObject?this.dragPanMapObject(dx,-dy):this.moveTo(this.map.getCachedCenter())},moveTo:function(bounds,zoomChanged,dragging){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),null!=this.mapObject){var newCenter=this.map.getCenter(),newZoom=this.map.getZoom();if(null!=newCenter){var moOldCenter=this.getMapObjectCenter(),oldCenter=this.getOLLonLatFromMapObjectLonLat(moOldCenter),moOldZoom=this.getMapObjectZoom(),oldZoom=this.getOLZoomFromMapObjectZoom(moOldZoom);if(!newCenter.equals(oldCenter)||newZoom!=oldZoom)if(!zoomChanged&&oldCenter&&this.dragPanMapObject&&this.smoothDragPan){var oldPx=this.map.getViewPortPxFromLonLat(oldCenter),newPx=this.map.getViewPortPxFromLonLat(newCenter);this.dragPanMapObject(newPx.x-oldPx.x,oldPx.y-newPx.y)}else{var center=this.getMapObjectLonLatFromOLLonLat(newCenter),zoom=this.getMapObjectZoomFromOLZoom(newZoom);this.setMapObjectCenter(center,zoom,dragging)}}}},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var moPixel=this.getMapObjectPixelFromOLPixel(viewPortPx),moLonLat=this.getMapObjectLonLatFromMapObjectPixel(moPixel);lonlat=this.getOLLonLatFromMapObjectLonLat(moLonLat)}return lonlat},getViewPortPxFromLonLat:function(lonlat){var viewPortPx=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var moLonLat=this.getMapObjectLonLatFromOLLonLat(lonlat),moPixel=this.getMapObjectPixelFromMapObjectLonLat(moLonLat);viewPortPx=this.getOLPixelFromMapObjectPixel(moPixel)}return viewPortPx},getOLLonLatFromMapObjectLonLat:function(moLonLat){var olLonLat=null;if(null!=moLonLat){var lon=this.getLongitudeFromMapObjectLonLat(moLonLat),lat=this.getLatitudeFromMapObjectLonLat(moLonLat);olLonLat=new OpenLayers.LonLat(lon,lat)}return olLonLat},getMapObjectLonLatFromOLLonLat:function(olLonLat){var moLatLng=null;return null!=olLonLat&&(moLatLng=this.getMapObjectLonLatFromLonLat(olLonLat.lon,olLonLat.lat)),moLatLng},getOLPixelFromMapObjectPixel:function(moPixel){var olPixel=null;if(null!=moPixel){var x=this.getXFromMapObjectPixel(moPixel),y=this.getYFromMapObjectPixel(moPixel);olPixel=new OpenLayers.Pixel(x,y)}return olPixel},getMapObjectPixelFromOLPixel:function(olPixel){var moPixel=null;return null!=olPixel&&(moPixel=this.getMapObjectPixelFromXY(olPixel.x,olPixel.y)),moPixel},CLASS_NAME:"OpenLayers.Layer.EventPane"}),OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var props=["minZoomLevel","maxZoomLevel","numZoomLevels"],i=0,len=props.length;len>i;i++){var property=props[i];this[property]=null!=this.options[property]?this.options[property]:this.map[property]}(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL);var desiredZoomLevels,limitZoomLevels=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(desiredZoomLevels=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,null!=desiredZoomLevels?this.numZoomLevels=Math.min(desiredZoomLevels,limitZoomLevels):this.numZoomLevels=limitZoomLevels,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,null!=this.RESOLUTIONS){var resolutionsIndex=0;this.resolutions=[];for(var i=this.minZoomLevel;i<=this.maxZoomLevel;i++)this.resolutions[resolutionsIndex++]=this.RESOLUTIONS[i];this.maxResolution=this.resolutions[0],this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var resolution=null,viewSize=this.map.getSize(),extent=this.getExtent();return null!=viewSize&&null!=extent&&(resolution=Math.max(extent.getWidth()/viewSize.w,extent.getHeight()/viewSize.h)),resolution},getExtent:function(){var size=this.map.getSize(),tl=this.getLonLatFromViewPortPx({x:0,y:0}),br=this.getLonLatFromViewPortPx({x:size.w,y:size.h});return null!=tl&&null!=br?new OpenLayers.Bounds(tl.lon,br.lat,br.lon,tl.lat):null},getZoomForResolution:function(resolution){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var extent=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(extent)},getOLZoomFromMapObjectZoom:function(moZoom){var zoom=null;return null!=moZoom&&(zoom=moZoom-this.minZoomLevel,this.map.baseLayer!==this&&(zoom=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(zoom)))),zoom},getMapObjectZoomFromOLZoom:function(olZoom){var zoom=null;return null!=olZoom&&(zoom=olZoom+this.minZoomLevel,this.map.baseLayer!==this&&(zoom=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(zoom)))),zoom},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"}),OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(name,options){options=options||{},options.version||(options.version="function"==typeof GMap2?"2":"3");var mixin=OpenLayers.Layer.Google["v"+options.version.replace(/\./g,"_")];if(!mixin)throw"Unsupported Google Maps API version: "+options.version;OpenLayers.Util.applyDefaults(options,mixin),OpenLayers.Util.applyDefaults(options,mixin.DEFAULTS),options.maxExtent&&(options.maxExtent=options.maxExtent.clone()),OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[name,options]),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[name,options]),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(visible){var opacity=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments),this.setOpacity(opacity)},display:function(visible){this._dragging||this.setGMapVisibility(visible),OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(bounds,zoomChanged,dragging){this._dragging=dragging,OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments),delete this._dragging},setOpacity:function(opacity){if(opacity!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=opacity),this.getVisibility()){var container=this.getMapContainer();OpenLayers.Util.modifyDOMElement(container,null,null,null,null,null,null,opacity)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var cache=OpenLayers.Layer.Google.cache[this.map.id];cache&&cache.count<=1&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var cache=OpenLayers.Layer.Google.cache[this.map.id];if(cache){var container=this.mapObject&&this.getMapContainer();container&&container.parentNode&&container.parentNode.removeChild(container);var termsOfUse=cache.termsOfUse;termsOfUse&&termsOfUse.parentNode&&termsOfUse.parentNode.removeChild(termsOfUse);var poweredBy=cache.poweredBy;poweredBy&&poweredBy.parentNode&&poweredBy.parentNode.removeChild(poweredBy),this.mapObject&&window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners&&google.maps.event.clearListeners(this.mapObject,"tilesloaded")}},removeMap:function(map){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var cache=OpenLayers.Layer.Google.cache[map.id];cache&&(cache.count<=1?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[map.id]):--cache.count),delete this.termsOfUse,delete this.poweredBy,delete this.mapObject,delete this.dragObject,OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(moBounds){var olBounds=null;if(null!=moBounds){var sw=moBounds.getSouthWest(),ne=moBounds.getNorthEast();this.sphericalMercator?(sw=this.forwardMercator(sw.lng(),sw.lat()),ne=this.forwardMercator(ne.lng(),ne.lat())):(sw=new OpenLayers.LonLat(sw.lng(),sw.lat()),ne=new OpenLayers.LonLat(ne.lng(),ne.lat())),olBounds=new OpenLayers.Bounds(sw.lon,sw.lat,ne.lon,ne.lat)}return olBounds},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(moLonLat){return this.sphericalMercator?this.forwardMercator(moLonLat.lng(),moLonLat.lat()).lon:moLonLat.lng()},getLatitudeFromMapObjectLonLat:function(moLonLat){var lat=this.sphericalMercator?this.forwardMercator(moLonLat.lng(),moLonLat.lat()).lat:moLonLat.lat();return lat},getXFromMapObjectPixel:function(moPixel){return moPixel.x},getYFromMapObjectPixel:function(moPixel){return moPixel.y},CLASS_NAME:"OpenLayers.Layer.Google"}),OpenLayers.Layer.Google.cache={},OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var mapObject,termsOfUse,poweredBy,cache=OpenLayers.Layer.Google.cache[this.map.id];if(cache)mapObject=cache.mapObject,termsOfUse=cache.termsOfUse,poweredBy=cache.poweredBy,++cache.count;else{var container=this.map.viewPortDiv,div=document.createElement("div");div.id=this.map.id+"_GMap2Container",div.style.position="absolute",div.style.width="100%",div.style.height="100%",container.appendChild(div);try{mapObject=new GMap2(div),termsOfUse=div.lastChild,container.appendChild(termsOfUse),termsOfUse.style.zIndex="1100",termsOfUse.style.right="",termsOfUse.style.bottom="",termsOfUse.className="olLayerGoogleCopyright",poweredBy=div.lastChild,container.appendChild(poweredBy),poweredBy.style.zIndex="1100",poweredBy.style.right="",poweredBy.style.bottom="",poweredBy.className="olLayerGooglePoweredBy gmnoprint"}catch(e){throw e}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:mapObject,termsOfUse:termsOfUse,poweredBy:poweredBy,count:1}}this.mapObject=mapObject,this.termsOfUse=termsOfUse,this.poweredBy=poweredBy,-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type),"function"==typeof mapObject.getDragObject?this.dragObject=mapObject.getDragObject():this.dragPanMapObject=null,this.isBaseLayer===!1&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var layer=this,handle=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(handle),delete layer._resized,layer.mapObject.checkResize(),layer.moveTo(layer.map.getCenter(),layer.map.getZoom())});this._resized=!0}},setGMapVisibility:function(visible){var cache=OpenLayers.Layer.Google.cache[this.map.id];if(cache){var container=this.mapObject.getContainer();visible===!0?(this.mapObject.setMapType(this.type),container.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",cache.displayed=this.id):(cache.displayed===this.id&&delete cache.displayed,cache.displayed||(container.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(olBounds){var moBounds=null;if(null!=olBounds){var sw=this.sphericalMercator?this.inverseMercator(olBounds.bottom,olBounds.left):new OpenLayers.LonLat(olBounds.bottom,olBounds.left),ne=this.sphericalMercator?this.inverseMercator(olBounds.top,olBounds.right):new OpenLayers.LonLat(olBounds.top,olBounds.right);moBounds=new GLatLngBounds(new GLatLng(sw.lat,sw.lon),new GLatLng(ne.lat,ne.lon))}return moBounds},setMapObjectCenter:function(center,zoom){this.mapObject.setCenter(center,zoom)},dragPanMapObject:function(dX,dY){this.dragObject.moveBy(new GSize(-dX,dY))},getMapObjectLonLatFromMapObjectPixel:function(moPixel){return this.mapObject.fromContainerPixelToLatLng(moPixel)},getMapObjectPixelFromMapObjectLonLat:function(moLonLat){return this.mapObject.fromLatLngToContainerPixel(moLonLat)},getMapObjectZoomFromMapObjectBounds:function(moBounds){return this.mapObject.getBoundsZoomLevel(moBounds)},getMapObjectLonLatFromLonLat:function(lon,lat){var gLatLng;if(this.sphericalMercator){var lonlat=this.inverseMercator(lon,lat);gLatLng=new GLatLng(lonlat.lat,lonlat.lon)}else gLatLng=new GLatLng(lat,lon);return gLatLng},getMapObjectPixelFromXY:function(x,y){return new GPoint(x,y)}},OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(options){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[options]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var alias in this.namespaces)this.namespaceAlias[this.namespaces[alias]]=alias},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(alias,uri){this.namespaces[alias]=uri,this.namespaceAlias[uri]=alias},read:function(text){var index=text.indexOf("<");index>0&&(text=text.substring(index));var node=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var xmldom;return xmldom=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,xmldom.loadXML(text),xmldom},this),function(){return(new DOMParser).parseFromString(text,"text/xml")},function(){var req=new XMLHttpRequest;return req.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(text),!1),req.overrideMimeType&&req.overrideMimeType("text/xml"),req.send(null),req.responseXML});return this.keepData&&(this.data=node),node},write:function(node){var data;if(this.xmldom)data=node.xml;else{var serializer=new XMLSerializer;if(1==node.nodeType){var doc=document.implementation.createDocument("","",null);doc.importNode&&(node=doc.importNode(node,!0)),doc.appendChild(node),data=serializer.serializeToString(doc)}else data=serializer.serializeToString(node)}return data},createElementNS:function(uri,name){var element;return element=this.xmldom?"string"==typeof uri?this.xmldom.createNode(1,name,uri):this.xmldom.createNode(1,name,""):document.createElementNS(uri,name)},createDocumentFragment:function(){var element;return element=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(text){var node;return"string"!=typeof text&&(text=String(text)),node=this.xmldom?this.xmldom.createTextNode(text):document.createTextNode(text)},getElementsByTagNameNS:function(node,uri,name){var elements=[];if(node.getElementsByTagNameNS)elements=node.getElementsByTagNameNS(uri,name);else for(var potentialNode,fullName,allNodes=node.getElementsByTagName("*"),i=0,len=allNodes.length;len>i;++i)potentialNode=allNodes[i],fullName=potentialNode.prefix?potentialNode.prefix+":"+name:name,("*"==name||fullName==potentialNode.nodeName)&&("*"==uri||uri==potentialNode.namespaceURI)&&elements.push(potentialNode);return elements},getAttributeNodeNS:function(node,uri,name){var attributeNode=null;if(node.getAttributeNodeNS)attributeNode=node.getAttributeNodeNS(uri,name);else for(var potentialNode,fullName,attributes=node.attributes,i=0,len=attributes.length;len>i;++i)if(potentialNode=attributes[i],potentialNode.namespaceURI==uri&&(fullName=potentialNode.prefix?potentialNode.prefix+":"+name:name,fullName==potentialNode.nodeName)){attributeNode=potentialNode;break}return attributeNode},getAttributeNS:function(node,uri,name){var attributeValue="";if(node.getAttributeNS)attributeValue=node.getAttributeNS(uri,name)||"";else{var attributeNode=this.getAttributeNodeNS(node,uri,name);attributeNode&&(attributeValue=attributeNode.nodeValue)}return attributeValue},getChildValue:function(node,def){var value=def||"";if(node)for(var child=node.firstChild;child;child=child.nextSibling)switch(child.nodeType){case 3:case 4:value+=child.nodeValue}return value},isSimpleContent:function(node){for(var simple=!0,child=node.firstChild;child;child=child.nextSibling)if(1===child.nodeType){simple=!1;break}return simple},contentType:function(node){for(var simple=!1,complex=!1,type=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,child=node.firstChild;child;child=child.nextSibling){switch(child.nodeType){case 1:complex=!0;break;case 8:break;default:simple=!0}if(complex&&simple)break}if(complex&&simple)type=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(complex)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(simple)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return type},hasAttributeNS:function(node,uri,name){var found=!1;return found=node.hasAttributeNS?node.hasAttributeNS(uri,name):!!this.getAttributeNodeNS(node,uri,name)},setAttributeNS:function(node,uri,name,value){if(node.setAttributeNS)node.setAttributeNS(uri,name,value);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(uri){var attribute=node.ownerDocument.createNode(2,name,uri);attribute.nodeValue=value,node.setAttributeNode(attribute)}else node.setAttribute(name,value)}},createElementNSPlus:function(name,options){options=options||{};var uri=options.uri||this.namespaces[options.prefix];if(!uri){var loc=name.indexOf(":");uri=this.namespaces[name.substring(0,loc)]}uri||(uri=this.namespaces[this.defaultPrefix]);var node=this.createElementNS(uri,name);options.attributes&&this.setAttributes(node,options.attributes);var value=options.value;return null!=value&&node.appendChild(this.createTextNode(value)),node},setAttributes:function(node,obj){var value,uri;for(var name in obj)null!=obj[name]&&obj[name].toString&&(value=obj[name].toString(),uri=this.namespaces[name.substring(0,name.indexOf(":"))]||null,this.setAttributeNS(node,uri,name,value))},readNode:function(node,obj){obj||(obj={});var group=this.readers[node.namespaceURI?this.namespaceAlias[node.namespaceURI]:this.defaultPrefix];if(group){var local=node.localName||node.nodeName.split(":").pop(),reader=group[local]||group["*"];reader&&reader.apply(this,[node,obj])}return obj},readChildNodes:function(node,obj){obj||(obj={});for(var child,children=node.childNodes,i=0,len=children.length;len>i;++i)child=children[i],1==child.nodeType&&this.readNode(child,obj);return obj},writeNode:function(name,obj,parent){var prefix,local,split=name.indexOf(":");split>0?(prefix=name.substring(0,split),local=name.substring(split+1)):(prefix=parent?this.namespaceAlias[parent.namespaceURI]:this.defaultPrefix,local=name);var child=this.writers[prefix][local].apply(this,[obj]);return parent&&parent.appendChild(child),child},getChildEl:function(node,name,uri){return node&&this.getThisOrNextEl(node.firstChild,name,uri)},getNextEl:function(node,name,uri){return node&&this.getThisOrNextEl(node.nextSibling,name,uri)},getThisOrNextEl:function(node,name,uri){outer:for(var sibling=node;sibling;sibling=sibling.nextSibling)switch(sibling.nodeType){case 1:if(!(name&&name!==(sibling.localName||sibling.nodeName.split(":").pop())||uri&&uri!==sibling.namespaceURI))break outer;sibling=null;break outer;case 3:if(/^\s*$/.test(sibling.nodeValue))break;case 4:case 6:case 12:case 10:case 11:sibling=null;break outer}return sibling||null},lookupNamespaceURI:function(node,prefix){var uri=null;if(node)if(node.lookupNamespaceURI)uri=node.lookupNamespaceURI(prefix);else outer:switch(node.nodeType){case 1:if(null!==node.namespaceURI&&node.prefix===prefix){uri=node.namespaceURI;break outer}var len=node.attributes.length;if(len)for(var attr,i=0;len>i;++i){if(attr=node.attributes[i],"xmlns"===attr.prefix&&attr.name==="xmlns:"+prefix){uri=attr.value||null;break outer}if("xmlns"===attr.name&&null===prefix){uri=attr.value||null;break outer}}uri=this.lookupNamespaceURI(node.parentNode,prefix);break outer;case 2:uri=this.lookupNamespaceURI(node.ownerElement,prefix);break outer;case 9:uri=this.lookupNamespaceURI(node.documentElement,prefix);break outer;case 6:case 12:case 10:case 11:break outer;default:uri=this.lookupNamespaceURI(node.parentNode,prefix)}return uri},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Format.WFST=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.WFST.DEFAULTS);var cls=OpenLayers.Format.WFST["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported WFST version: "+options.version;return new cls(options)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(layer,lonlat,data){this.layer=layer,this.lonlat=lonlat,this.data=null!=data?data:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var onScreen=!1;if(null!=this.layer&&null!=this.layer.map){var screenBounds=this.layer.map.getExtent();onScreen=screenBounds.containsLonLat(this.lonlat)}return onScreen},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(closeBox){if(null!=this.lonlat){if(!this.popup){var anchor=this.marker?this.marker.icon:null,popupClass=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new popupClass(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,anchor,closeBox)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(geometry,attributes,style){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,attributes]),this.lonlat=null,this.geometry=geometry?geometry:null,this.state=null,this.attributes={},attributes&&(this.attributes=OpenLayers.Util.extend(this.attributes,attributes)),this.style=style?style:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(boundsOnly){var onScreen=!1;if(this.layer&&this.layer.map){var screenBounds=this.layer.map.getExtent();if(boundsOnly){var featureBounds=this.geometry.getBounds();onScreen=screenBounds.intersectsBounds(featureBounds)}else{var screenPoly=screenBounds.toGeometry();onScreen=screenPoly.intersects(this.geometry)}}return onScreen},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=!1;return this.geometry&&(atPoint=this.geometry.atPoint(lonlat,toleranceLon,toleranceLat)),atPoint},destroyPopup:function(){},move:function(location){if(!this.layer||!this.geometry.move)return void 0;var pixel;pixel="OpenLayers.LonLat"==location.CLASS_NAME?this.layer.getViewPortPxFromLonLat(location):location;var lastPixel=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),res=this.layer.map.getResolution();return this.geometry.move(res*(pixel.x-lastPixel.x),res*(lastPixel.y-pixel.y)),this.layer.drawFeature(this),lastPixel},toState:function(state){if(state==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=state;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(state==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=state}else if(state==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=state}else state==OpenLayers.State.UNKNOWN&&(this.state=state)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(style,options){OpenLayers.Util.extend(this,options),this.rules=[],options&&options.rules&&this.addRules(options.rules),this.setDefaultStyle(style||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var i=0,len=this.rules.length;len>i;i++)this.rules[i].destroy(),this.rules[i]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(feature){for(var rule,style=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),feature),rules=this.rules,elseRules=[],appliedRules=!1,i=0,len=rules.length;len>i;i++){rule=rules[i];var applies=rule.evaluate(feature);applies&&(rule instanceof OpenLayers.Rule&&rule.elseFilter?elseRules.push(rule):(appliedRules=!0,this.applySymbolizer(rule,style,feature)))}if(0==appliedRules&&elseRules.length>0){appliedRules=!0;for(var i=0,len=elseRules.length;len>i;i++)this.applySymbolizer(elseRules[i],style,feature)}return rules.length>0&&0==appliedRules&&(style.display="none"),null!=style.label&&"string"!=typeof style.label&&(style.label=String(style.label)),style},applySymbolizer:function(rule,style,feature){var symbolizerPrefix=feature.geometry?this.getSymbolizerPrefix(feature.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],symbolizer=rule.symbolizer[symbolizerPrefix]||rule.symbolizer;if(this.defaultsPerSymbolizer===!0){var defaults=this.defaultStyle;OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:defaults.pointRadius}),(symbolizer.stroke===!0||symbolizer.graphic===!0)&&OpenLayers.Util.applyDefaults(symbolizer,{strokeWidth:defaults.strokeWidth,strokeColor:defaults.strokeColor,strokeOpacity:defaults.strokeOpacity,strokeDashstyle:defaults.strokeDashstyle,strokeLinecap:defaults.strokeLinecap}),(symbolizer.fill===!0||symbolizer.graphic===!0)&&OpenLayers.Util.applyDefaults(symbolizer,{fillColor:defaults.fillColor,fillOpacity:defaults.fillOpacity}),symbolizer.graphic===!0&&OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(style,symbolizer),feature)},createLiterals:function(style,feature){var context=OpenLayers.Util.extend({},feature.attributes||feature.data);OpenLayers.Util.extend(context,this.context);for(var i in this.propertyStyles)style[i]=OpenLayers.Style.createLiteral(style[i],context,feature,i);return style},findPropertyStyles:function(){var propertyStyles={},style=this.defaultStyle;this.addPropertyStyles(propertyStyles,style);for(var symbolizer,value,rules=this.rules,i=0,len=rules.length;len>i;i++){symbolizer=rules[i].symbolizer;for(var key in symbolizer){if(value=symbolizer[key],"object"!=typeof value){this.addPropertyStyles(propertyStyles,symbolizer);break}this.addPropertyStyles(propertyStyles,value)}}return propertyStyles},addPropertyStyles:function(propertyStyles,symbolizer){var property;for(var key in symbolizer)property=symbolizer[key],"string"==typeof property&&property.match(/\$\{\w+\}/)&&(propertyStyles[key]=!0);return propertyStyles},addRules:function(rules){Array.prototype.push.apply(this.rules,rules),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(style){this.defaultStyle=style,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(geometry){for(var prefixes=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,len=prefixes.length;len>i;i++)if(-1!=geometry.CLASS_NAME.indexOf(prefixes[i]))return prefixes[i]},clone:function(){var options=OpenLayers.Util.extend({},this);if(this.rules){options.rules=[];for(var i=0,len=this.rules.length;len>i;++i)options.rules.push(this.rules[i].clone())}options.context=this.context&&OpenLayers.Util.extend({},this.context);
var defaultStyle=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(defaultStyle,options)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(value,context,feature,property){return"string"==typeof value&&-1!=value.indexOf("${")&&(value=OpenLayers.String.format(value,context,[feature,property]),value=isNaN(value)||!value?value:parseFloat(value)),value},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Filter=OpenLayers.Class({initialize:function(options){OpenLayers.Util.extend(this,options)},destroy:function(){},evaluate:function(context){return!0},clone:function(){return null},toString:function(){var string;return string=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(feature){var intersect=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(feature.geometry){var geom=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(geom=this.value.toGeometry()),feature.geometry.intersects(geom)&&(intersect=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return intersect},clone:function(){var options=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(options)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(options){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[options])},evaluate:function(feature){for(var i=0,len=this.fids.length;len>i;i++){var fid=feature.fid||feature.id;if(fid==this.fids[i])return!0}return!1},clone:function(){var filter=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(filter,this),filter.fids=this.fids.slice(),filter},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(options){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},getSrsName:function(feature,options){var srsName=options&&options.srsName;return srsName||(srsName=feature&&feature.layer?feature.layer.projection.getCode():this.srsName),srsName},read:function(data,options){options=options||{},OpenLayers.Util.applyDefaults(options,{output:"features"}),"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var obj={};return data&&this.readNode(data,obj,!0),obj.features&&"features"===options.output&&(obj=obj.features),obj},readers:{wfs:{FeatureCollection:function(node,obj){obj.features=[],this.readChildNodes(node,obj)}}},write:function(features,options){var node=this.writeNode("wfs:Transaction",{features:features,options:options}),value=this.schemaLocationAttr();return value&&this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",value),OpenLayers.Format.XML.prototype.write.apply(this,[node])},writers:{wfs:{GetFeature:function(options){var node=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:options&&options.handle,outputFormat:options&&options.outputFormat,maxFeatures:options&&options.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(options)}});if("string"==typeof this.featureType)this.writeNode("Query",options,node);else for(var i=0,len=this.featureType.length;len>i;i++)options.featureType=this.featureType[i],this.writeNode("Query",options,node);return node},Transaction:function(obj){obj=obj||{};var i,len,options=obj.options||{},node=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:options.handle}}),features=obj.features;if(features){options.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var name,feature;for(i=0,len=features.length;len>i;++i)feature=features[i],name=this.stateName[feature.state],name&&this.writeNode(name,{feature:feature,options:options},node);options.multi===!0&&this.setGeometryTypes()}if(options.nativeElements)for(i=0,len=options.nativeElements.length;len>i;++i)this.writeNode("wfs:Native",options.nativeElements[i],node);return node},Native:function(nativeElement){var node=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:nativeElement.vendorId,safeToIgnore:nativeElement.safeToIgnore},value:nativeElement.value});return node},Insert:function(obj){var feature=obj.feature,options=obj.options,node=this.createElementNSPlus("wfs:Insert",{attributes:{handle:options&&options.handle}});return this.srsName=this.getSrsName(feature),this.writeNode("feature:_typeName",feature,node),node},Update:function(obj){var feature=obj.feature,options=obj.options,node=this.createElementNSPlus("wfs:Update",{attributes:{handle:options&&options.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&node.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var modified=feature.modified;null===this.geometryName||modified&&void 0===modified.geometry||(this.srsName=this.getSrsName(feature),this.writeNode("Property",{name:this.geometryName,value:feature.geometry},node));for(var key in feature.attributes)void 0===feature.attributes[key]||modified&&modified.attributes&&(!modified.attributes||void 0===modified.attributes[key])||this.writeNode("Property",{name:key,value:feature.attributes[key]},node);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[feature.fid]}),node),node},Property:function(obj){var node=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",obj.name,node),null!==obj.value&&this.writeNode("Value",obj.value,node),node},Name:function(name){return this.createElementNSPlus("wfs:Name",{value:name})},Value:function(obj){var node;if(obj instanceof OpenLayers.Geometry){node=this.createElementNSPlus("wfs:Value");var geom=this.writeNode("feature:_geometry",obj).firstChild;node.appendChild(geom)}else node=this.createElementNSPlus("wfs:Value",{value:obj});return node},Delete:function(obj){var feature=obj.feature,options=obj.options,node=this.createElementNSPlus("wfs:Delete",{attributes:{handle:options&&options.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&node.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[feature.fid]}),node),node}}},schemaLocationAttr:function(options){options=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},options);var schemaLocations=OpenLayers.Util.extend({},this.schemaLocations);options.schema&&(schemaLocations[options.featurePrefix]=options.schema);var uri,parts=[];for(var key in schemaLocations)uri=this.namespaces[key],uri&&parts.push(uri+" "+schemaLocations[key]);var value=parts.join(" ")||void 0;return value},setFilterProperty:function(filter){if(filter.filters)for(var i=0,len=filter.filters.length;len>i;++i)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,filter.filters[i]);else filter instanceof OpenLayers.Filter.Spatial&&!filter.property&&(filter.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));var root=data.documentElement,exceptionInfo={exceptionReport:null};return root&&(this.readChildNodes(data,exceptionInfo),null===exceptionInfo.exceptionReport&&(exceptionInfo=(new OpenLayers.Format.OWSCommon).read(data))),exceptionInfo},readers:{ogc:{ServiceExceptionReport:function(node,obj){obj.exceptionReport={exceptions:[]},this.readChildNodes(node,obj.exceptionReport)},ServiceException:function(node,exceptionReport){var exception={code:node.getAttribute("code"),locator:node.getAttribute("locator"),text:this.getChildValue(node)};exceptionReport.exceptions.push(exception)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);var className=this.CLASS_NAME;this.name=className.substring(className.lastIndexOf(".")+1)},getVersion:function(root,options){var version;return root?(version=this.version,version||(version=root.getAttribute("version"),version||(version=this.defaultVersion))):version=options&&options.version||this.version||this.defaultVersion,version},getParser:function(version){version=version||this.defaultVersion;var profile=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=version){var format=OpenLayers.Format[this.name]["v"+version.replace(/\./g,"_")+profile];if(!format&&(""!==profile&&this.allowFallback&&(profile="",format=OpenLayers.Format[this.name]["v"+version.replace(/\./g,"_")]),!format))throw"Can't find a "+this.name+" parser for version "+version+profile;this.parser=new format(this.options)}return this.parser},write:function(obj,options){var version=this.getVersion(null,options);this.parser=this.getParser(version);var root=this.parser.write(obj,options);return this.stringifyOutput===!1?root:OpenLayers.Format.XML.prototype.write.apply(this,[root])},read:function(data,options){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));var root=data.documentElement,version=this.getVersion(root);this.parser=this.getParser(version);var obj=this.parser.read(data,options),errorProperty=this.parser.errorProperty||null;if(null!==errorProperty&&void 0===obj[errorProperty]){var format=new OpenLayers.Format.OGCExceptionReport;obj.error=format.read(data)}return obj.version=version,obj},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(options){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[options])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(context){var i,len;switch(this.type){case OpenLayers.Filter.Logical.AND:for(i=0,len=this.filters.length;len>i;i++)if(0==this.filters[i].evaluate(context))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(i=0,len=this.filters.length;len>i;i++)if(1==this.filters[i].evaluate(context))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(context)}return void 0},clone:function(){for(var filters=[],i=0,len=this.filters.length;len>i;++i)filters.push(this.filters[i].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:filters})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(options){OpenLayers.Filter.prototype.initialize.apply(this,[options]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===options.matchCase&&(this.matchCase=null)},evaluate:function(context){context instanceof OpenLayers.Feature.Vector&&(context=context.attributes);var exp,result=!1,got=context[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:exp=this.value,result=this.matchCase||"string"!=typeof got||"string"!=typeof exp?got==exp:got.toUpperCase()==exp.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:exp=this.value,result=this.matchCase||"string"!=typeof got||"string"!=typeof exp?got!=exp:got.toUpperCase()!=exp.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:result=got<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:result=got>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:result=got<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:result=got>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:result=got>=this.lowerBoundary&&got<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var regexp=new RegExp(this.value,"gi");result=regexp.test(got);break;case OpenLayers.Filter.Comparison.IS_NULL:result=null===got}return result},value2regex:function(wildCard,singleChar,escapeChar){if("."==wildCard)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return wildCard=wildCard?wildCard:"*",singleChar=singleChar?singleChar:".",escapeChar=escapeChar?escapeChar:"!",this.value=this.value.replace(new RegExp("\\"+escapeChar+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+singleChar,"g"),"."),this.value=this.value.replace(new RegExp("\\"+wildCard,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+wildCard),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+singleChar),this.value},regex2value:function(){var value=this.value;return value=value.replace(/!/g,"!!"),value=value.replace(/(\\)?\\\./g,function($0,$1){return $1?$0:"!."}),value=value.replace(/(\\)?\\\*/g,function($0,$1){return $1?$0:"!*"}),value=value.replace(/\\\\/g,"\\"),value=value.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Comparison.IS_NULL="NULL",OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(date){return date.toISOString()}:function(date){var str;return str=isNaN(date.getTime())?"Invalid Date":date.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(date.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(date.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(date.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(date.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(date.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(date.getUTCMilliseconds(),3)+"Z"}}(),parse:function(str){var date,match=str.match(this.dateRegEx);if(match&&(match[1]||match[7])){var year=parseInt(match[1],10)||0,month=parseInt(match[2],10)-1||0,day=parseInt(match[3],10)||1;date=new Date(Date.UTC(year,month,day));var type=match[7];if(type){var hours=parseInt(match[4],10),minutes=parseInt(match[5],10),secFrac=parseFloat(match[6]),seconds=0|secFrac,milliseconds=Math.round(1e3*(secFrac-seconds));if(date.setUTCHours(hours,minutes,seconds,milliseconds),"Z"!==type){var hoursOffset=parseInt(type,10),minutesOffset=parseInt(match[8],10)||0,offset=-1e3*(60*(60*hoursOffset)+60*minutesOffset);date=new Date(date.getTime()+offset)}}}else date=new Date("invalid");return date}},OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){var obj={};return this.readers.ogc.Filter.apply(this,[data,obj]),obj.filter},readers:{ogc:{_expression:function(node){for(var obj,value="",child=node.firstChild;child;child=child.nextSibling)switch(child.nodeType){case 1:obj=this.readNode(child),obj.property?value+="${"+obj.property+"}":void 0!==obj.value&&(value+=obj.value);break;case 3:case 4:value+=child.nodeValue}return value},Filter:function(node,parent){var obj={fids:[],filters:[]};this.readChildNodes(node,obj),obj.fids.length>0?parent.filter=new OpenLayers.Filter.FeatureId({fids:obj.fids}):obj.filters.length>0&&(parent.filter=obj.filters[0])},FeatureId:function(node,obj){var fid=node.getAttribute("fid");fid&&obj.fids.push(fid)},And:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(node,filter),obj.filters.push(filter)},Or:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(node,filter),obj.filters.push(filter)},Not:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsLessThan:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsGreaterThan:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsLessThanOrEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsGreaterThanOrEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsBetween:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(node,filter),obj.filters.push(filter)},Literal:function(node,obj){obj.value=OpenLayers.String.numericIf(this.getChildValue(node),!0)},PropertyName:function(node,filter){filter.property=this.getChildValue(node)},LowerBoundary:function(node,filter){filter.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,node),!0)},UpperBoundary:function(node,filter){filter.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,node),!0)},Intersects:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(node,obj){obj.distance=parseInt(this.getChildValue(node)),obj.distanceUnits=node.getAttribute("units")},Function:function(node,obj){},PropertyIsNull:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(node,filter),obj.filters.push(filter)}}},readSpatial:function(node,obj,type){var filter=new OpenLayers.Filter.Spatial({type:type});this.readChildNodes(node,filter),filter.value=filter.components[0],delete filter.components,obj.filters.push(filter)},encodeLiteral:function(value){return value instanceof Date&&(value=OpenLayers.Date.toISOString(value)),value},writeOgcExpression:function(value,node){return value instanceof OpenLayers.Filter.Function?this.writeNode("Function",value,node):this.writeNode("Literal",value,node),node},write:function(filter){return this.writers.ogc.Filter.apply(this,[filter])},writers:{ogc:{Filter:function(filter){var node=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(filter),filter,node),node},_featureIds:function(filter){for(var node=this.createDocumentFragment(),i=0,ii=filter.fids.length;ii>i;++i)this.writeNode("ogc:FeatureId",filter.fids[i],node);return node},FeatureId:function(fid){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:fid}})},And:function(filter){for(var childFilter,node=this.createElementNSPlus("ogc:And"),i=0,ii=filter.filters.length;ii>i;++i)childFilter=filter.filters[i],this.writeNode(this.getFilterType(childFilter),childFilter,node);return node},Or:function(filter){for(var childFilter,node=this.createElementNSPlus("ogc:Or"),i=0,ii=filter.filters.length;ii>i;++i)childFilter=filter.filters[i],this.writeNode(this.getFilterType(childFilter),childFilter,node);return node},Not:function(filter){var node=this.createElementNSPlus("ogc:Not"),childFilter=filter.filters[0];return this.writeNode(this.getFilterType(childFilter),childFilter,node),node},PropertyIsLessThan:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsGreaterThan:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsLessThanOrEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsGreaterThanOrEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsBetween:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",filter,node),this.writeNode("LowerBoundary",filter,node),this.writeNode("UpperBoundary",filter,node),node},PropertyName:function(filter){return this.createElementNSPlus("ogc:PropertyName",{value:filter.property})},Literal:function(value){var encode=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:encode(value)})},LowerBoundary:function(filter){var node=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(filter.lowerBoundary,node),node},UpperBoundary:function(filter){var node=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",filter.upperBoundary,node),node},INTERSECTS:function(filter){return this.writeSpatial(filter,"Intersects")},WITHIN:function(filter){return this.writeSpatial(filter,"Within")},CONTAINS:function(filter){return this.writeSpatial(filter,"Contains")},DWITHIN:function(filter){var node=this.writeSpatial(filter,"DWithin");return this.writeNode("Distance",filter,node),node},Distance:function(filter){return this.createElementNSPlus("ogc:Distance",{attributes:{units:filter.distanceUnits},value:filter.distance})},Function:function(filter){for(var node=this.createElementNSPlus("ogc:Function",{attributes:{name:filter.name}}),params=filter.params,i=0,len=params.length;len>i;i++)this.writeOgcExpression(params[i],node);return node},PropertyIsNull:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",filter,node),node}}},getFilterType:function(filter){var filterType=this.filterMap[filter.type];if(!filterType)throw"Filter writing not supported for rule type: "+filter.type;return filterType},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(bounds){bounds&&(this.bounds=bounds.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(newBounds){var bounds=this.getBounds();bounds?this.bounds.extend(newBounds):this.setBounds(newBounds)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(geometry,options){},getVertices:function(nodes){},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=!1,bounds=this.getBounds();if(null!=bounds&&null!=lonlat){var dX=null!=toleranceLon?toleranceLon:0,dY=null!=toleranceLat?toleranceLat:0,toleranceBounds=new OpenLayers.Bounds(this.bounds.left-dX,this.bounds.bottom-dY,this.bounds.right+dX,this.bounds.top+dY);atPoint=toleranceBounds.containsLonLat(lonlat)}return atPoint},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var string;return string=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(wkt){var geom;if(OpenLayers.Format&&OpenLayers.Format.WKT){var format=OpenLayers.Geometry.fromWKT.format;format||(format=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=format);var result=format.read(wkt);if(result instanceof OpenLayers.Feature.Vector)geom=result.geometry;else if(OpenLayers.Util.isArray(result)){for(var len=result.length,components=new Array(len),i=0;len>i;++i)components[i]=result[i].geometry;geom=new OpenLayers.Geometry.Collection(components)}}return geom},OpenLayers.Geometry.segmentsIntersect=function(seg1,seg2,options){var point=options&&options.point,tolerance=options&&options.tolerance,intersection=!1,x11_21=seg1.x1-seg2.x1,y11_21=seg1.y1-seg2.y1,x12_11=seg1.x2-seg1.x1,y12_11=seg1.y2-seg1.y1,y22_21=seg2.y2-seg2.y1,x22_21=seg2.x2-seg2.x1,d=y22_21*x12_11-x22_21*y12_11,n1=x22_21*y11_21-y22_21*x11_21,n2=x12_11*y11_21-y12_11*x11_21;if(0==d)0==n1&&0==n2&&(intersection=!0);else{var along1=n1/d,along2=n2/d;if(along1>=0&&1>=along1&&along2>=0&&1>=along2)if(point){var x=seg1.x1+along1*x12_11,y=seg1.y1+along1*y12_11;intersection=new OpenLayers.Geometry.Point(x,y)}else intersection=!0}if(tolerance){var dist;if(intersection){if(point){var seg,x,y,segs=[seg1,seg2];outer:for(var i=0;2>i;++i){seg=segs[i];for(var j=1;3>j;++j)if(x=seg["x"+j],y=seg["y"+j],dist=Math.sqrt(Math.pow(x-intersection.x,2)+Math.pow(y-intersection.y,2)),tolerance>dist){intersection.x=x,intersection.y=y;break outer}}}}else{var source,target,x,y,p,result,segs=[seg1,seg2];outer:for(var i=0;2>i;++i){source=segs[i],target=segs[(i+1)%2];for(var j=1;3>j;++j)if(p={x:source["x"+j],y:source["y"+j]},result=OpenLayers.Geometry.distanceToSegment(p,target),result.distance<tolerance){intersection=point?new OpenLayers.Geometry.Point(p.x,p.y):!0;break outer}}}}return intersection},OpenLayers.Geometry.distanceToSegment=function(point,segment){var result=OpenLayers.Geometry.distanceSquaredToSegment(point,segment);return result.distance=Math.sqrt(result.distance),result},OpenLayers.Geometry.distanceSquaredToSegment=function(point,segment){var x,y,x0=point.x,y0=point.y,x1=segment.x1,y1=segment.y1,x2=segment.x2,y2=segment.y2,dx=x2-x1,dy=y2-y1,along=(dx*(x0-x1)+dy*(y0-y1))/(Math.pow(dx,2)+Math.pow(dy,2));return 0>=along?(x=x1,y=y1):along>=1?(x=x2,y=y2):(x=x1+along*dx,y=y1+along*dy),{distance:Math.pow(x-x0,2)+Math.pow(y-y0,2),x:x,y:y,along:along}},OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(x,y){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(x),this.y=parseFloat(y)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(obj,this),obj},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(geometry,options){var distance,x0,y0,x1,y1,result,edge=!(options&&options.edge===!1),details=edge&&options&&options.details;return geometry instanceof OpenLayers.Geometry.Point?(x0=this.x,y0=this.y,x1=geometry.x,y1=geometry.y,distance=Math.sqrt(Math.pow(x0-x1,2)+Math.pow(y0-y1,2)),result=details?{x0:x0,y0:y0,x1:x1,y1:y1,distance:distance}:distance):(result=geometry.distanceTo(this,options),details&&(result={x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0,distance:result.distance})),result},equals:function(geom){var equals=!1;return null!=geom&&(equals=this.x==geom.x&&this.y==geom.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(geom.x)&&isNaN(geom.y)),equals},toShortString:function(){return this.x+", "+this.y},move:function(x,y){this.x=this.x+x,this.y=this.y+y,this.clearBounds()},rotate:function(angle,origin){angle*=Math.PI/180;var radius=this.distanceTo(origin),theta=angle+Math.atan2(this.y-origin.y,this.x-origin.x);this.x=origin.x+radius*Math.cos(theta),this.y=origin.y+radius*Math.sin(theta),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(scale,origin,ratio){return ratio=void 0==ratio?1:ratio,this.x=origin.x+scale*ratio*(this.x-origin.x),this.y=origin.y+scale*(this.y-origin.y),this.clearBounds(),this},intersects:function(geometry){var intersect=!1;return intersect="OpenLayers.Geometry.Point"==geometry.CLASS_NAME?this.equals(geometry):geometry.intersects(this)},transform:function(source,dest){return source&&dest&&(OpenLayers.Projection.transform(this,source,dest),this.bounds=null),this},getVertices:function(nodes){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(components){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=components&&this.addComponents(components)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var strings=[],i=0,len=this.components.length;len>i;i++)strings.push(this.components[i].toShortString());return strings.join(",")},calculateBounds:function(){this.bounds=null;var bounds=new OpenLayers.Bounds,components=this.components;
if(components)for(var i=0,len=components.length;len>i;i++)bounds.extend(components[i].getBounds());null!=bounds.left&&null!=bounds.bottom&&null!=bounds.right&&null!=bounds.top&&this.setBounds(bounds)},addComponents:function(components){OpenLayers.Util.isArray(components)||(components=[components]);for(var i=0,len=components.length;len>i;i++)this.addComponent(components[i])},addComponent:function(component,index){var added=!1;if(component&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,component.CLASS_NAME)>-1)){if(null!=index&&index<this.components.length){var components1=this.components.slice(0,index),components2=this.components.slice(index,this.components.length);components1.push(component),this.components=components1.concat(components2)}else this.components.push(component);component.parent=this,this.clearBounds(),added=!0}return added},removeComponents:function(components){var removed=!1;OpenLayers.Util.isArray(components)||(components=[components]);for(var i=components.length-1;i>=0;--i)removed=this.removeComponent(components[i])||removed;return removed},removeComponent:function(component){return OpenLayers.Util.removeItem(this.components,component),this.clearBounds(),!0},getLength:function(){for(var length=0,i=0,len=this.components.length;len>i;i++)length+=this.components[i].getLength();return length},getArea:function(){for(var area=0,i=0,len=this.components.length;len>i;i++)area+=this.components[i].getArea();return area},getGeodesicArea:function(projection){for(var area=0,i=0,len=this.components.length;len>i;i++)area+=this.components[i].getGeodesicArea(projection);return area},getCentroid:function(weighted){if(!weighted)return this.components.length&&this.components[0].getCentroid();var len=this.components.length;if(!len)return!1;for(var component,areas=[],centroids=[],areaSum=0,minArea=Number.MAX_VALUE,i=0;len>i;++i){component=this.components[i];var area=component.getArea(),centroid=component.getCentroid(!0);isNaN(area)||isNaN(centroid.x)||isNaN(centroid.y)||(areas.push(area),areaSum+=area,minArea=minArea>area&&area>0?area:minArea,centroids.push(centroid))}if(len=areas.length,0===areaSum){for(var i=0;len>i;++i)areas[i]=1;areaSum=areas.length}else{for(var i=0;len>i;++i)areas[i]/=minArea;areaSum/=minArea}for(var centroid,area,xSum=0,ySum=0,i=0;len>i;++i)centroid=centroids[i],area=areas[i],xSum+=centroid.x*area,ySum+=centroid.y*area;return new OpenLayers.Geometry.Point(xSum/areaSum,ySum/areaSum)},getGeodesicLength:function(projection){for(var length=0,i=0,len=this.components.length;len>i;i++)length+=this.components[i].getGeodesicLength(projection);return length},move:function(x,y){for(var i=0,len=this.components.length;len>i;i++)this.components[i].move(x,y)},rotate:function(angle,origin){for(var i=0,len=this.components.length;len>i;++i)this.components[i].rotate(angle,origin)},resize:function(scale,origin,ratio){for(var i=0;i<this.components.length;++i)this.components[i].resize(scale,origin,ratio);return this},distanceTo:function(geometry,options){for(var result,best,distance,edge=!(options&&options.edge===!1),details=edge&&options&&options.details,min=Number.POSITIVE_INFINITY,i=0,len=this.components.length;len>i&&(result=this.components[i].distanceTo(geometry,options),distance=details?result.distance:result,!(min>distance&&(min=distance,best=result,0==min)));++i);return best},equals:function(geometry){var equivalent=!0;if(geometry&&geometry.CLASS_NAME&&this.CLASS_NAME==geometry.CLASS_NAME)if(OpenLayers.Util.isArray(geometry.components)&&geometry.components.length==this.components.length){for(var i=0,len=this.components.length;len>i;++i)if(!this.components[i].equals(geometry.components[i])){equivalent=!1;break}}else equivalent=!1;else equivalent=!1;return equivalent},transform:function(source,dest){if(source&&dest){for(var i=0,len=this.components.length;len>i;i++){var component=this.components[i];component.transform(source,dest)}this.bounds=null}return this},intersects:function(geometry){for(var intersect=!1,i=0,len=this.components.length;len>i&&!(intersect=geometry.intersects(this.components[i]));++i);return intersect},getVertices:function(nodes){for(var vertices=[],i=0,len=this.components.length;len>i;++i)Array.prototype.push.apply(vertices,this.components[i].getVertices(nodes));return vertices},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(point,index){this.addComponent(point,index)},removePoint:function(point){this.removeComponent(point)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var length=0;if(this.components&&this.components.length>1)for(var i=1,len=this.components.length;len>i;i++)length+=this.components[i-1].distanceTo(this.components[i]);return length},getGeodesicLength:function(projection){var geom=this;if(projection){var gg=new OpenLayers.Projection("EPSG:4326");gg.equals(projection)||(geom=this.clone().transform(projection,gg))}var length=0;if(geom.components&&geom.components.length>1)for(var p1,p2,i=1,len=geom.components.length;len>i;i++)p1=geom.components[i-1],p2=geom.components[i],length+=OpenLayers.Util.distVincenty({lon:p1.x,lat:p1.y},{lon:p2.x,lat:p2.y});return 1e3*length},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(point){var removed=this.components&&this.components.length>2;return removed&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),removed},intersects:function(geometry){var intersect=!1,type=geometry.CLASS_NAME;if("OpenLayers.Geometry.LineString"==type||"OpenLayers.Geometry.LinearRing"==type||"OpenLayers.Geometry.Point"==type){var segs2,segs1=this.getSortedSegments();segs2="OpenLayers.Geometry.Point"==type?[{x1:geometry.x,y1:geometry.y,x2:geometry.x,y2:geometry.y}]:geometry.getSortedSegments();var seg1,seg1x1,seg1x2,seg1y1,seg1y2,seg2,seg2y1,seg2y2;outer:for(var i=0,len=segs1.length;len>i;++i){seg1=segs1[i],seg1x1=seg1.x1,seg1x2=seg1.x2,seg1y1=seg1.y1,seg1y2=seg1.y2;for(var j=0,jlen=segs2.length;jlen>j&&(seg2=segs2[j],!(seg2.x1>seg1x2));++j)if(!(seg2.x2<seg1x1)&&(seg2y1=seg2.y1,seg2y2=seg2.y2,!(Math.min(seg2y1,seg2y2)>Math.max(seg1y1,seg1y2))&&!(Math.max(seg2y1,seg2y2)<Math.min(seg1y1,seg1y2))&&OpenLayers.Geometry.segmentsIntersect(seg1,seg2))){intersect=!0;break outer}}}else intersect=geometry.intersects(this);return intersect},getSortedSegments:function(){function byX1(seg1,seg2){return seg1.x1-seg2.x1}for(var point1,point2,numSeg=this.components.length-1,segments=new Array(numSeg),i=0;numSeg>i;++i)point1=this.components[i],point2=this.components[i+1],point1.x<point2.x?segments[i]={x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}:segments[i]={x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y};return segments.sort(byX1)},splitWithSegment:function(seg,options){for(var vert1,vert2,point,vertex,target,edge=!(options&&options.edge===!1),tolerance=options&&options.tolerance,lines=[],verts=this.getVertices(),points=[],intersections=[],split=!1,interOptions={point:!0,tolerance:tolerance},result=null,i=0,stop=verts.length-2;stop>=i;++i)if(vert1=verts[i],points.push(vert1.clone()),vert2=verts[i+1],target={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y},point=OpenLayers.Geometry.segmentsIntersect(seg,target,interOptions),point instanceof OpenLayers.Geometry.Point&&(vertex=point.x===seg.x1&&point.y===seg.y1||point.x===seg.x2&&point.y===seg.y2||point.equals(vert1)||point.equals(vert2)?!0:!1,vertex||edge)){if(point.equals(intersections[intersections.length-1])||intersections.push(point.clone()),0===i&&point.equals(vert1))continue;if(point.equals(vert2))continue;split=!0,point.equals(vert1)||points.push(point),lines.push(new OpenLayers.Geometry.LineString(points)),points=[point.clone()]}if(split&&(points.push(vert2.clone()),lines.push(new OpenLayers.Geometry.LineString(points))),intersections.length>0){var xDir=seg.x1<seg.x2?1:-1,yDir=seg.y1<seg.y2?1:-1;result={lines:lines,points:intersections.sort(function(p1,p2){return xDir*p1.x-xDir*p2.x||yDir*p1.y-yDir*p2.y})}}return result},split:function(target,options){var sourceSplit,targetSplit,sourceParts,targetParts,results=null,mutual=options&&options.mutual;if(target instanceof OpenLayers.Geometry.LineString){var vert1,vert2,seg,splits,lines,point,verts=this.getVertices(),points=[];sourceParts=[];for(var i=0,stop=verts.length-2;stop>=i;++i){vert1=verts[i],vert2=verts[i+1],seg={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y},targetParts=targetParts||[target],mutual&&points.push(vert1.clone());for(var j=0;j<targetParts.length;++j)if(splits=targetParts[j].splitWithSegment(seg,options),splits&&(lines=splits.lines,lines.length>0&&(lines.unshift(j,1),Array.prototype.splice.apply(targetParts,lines),j+=lines.length-2),mutual))for(var k=0,len=splits.points.length;len>k;++k)point=splits.points[k],point.equals(vert1)||(points.push(point),sourceParts.push(new OpenLayers.Geometry.LineString(points)),points=point.equals(vert2)?[]:[point.clone()])}mutual&&sourceParts.length>0&&points.length>0&&(points.push(vert2.clone()),sourceParts.push(new OpenLayers.Geometry.LineString(points)))}else results=target.splitWith(this,options);return targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],(targetSplit||sourceSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},splitWith:function(geometry,options){return geometry.split(this,options)},getVertices:function(nodes){var vertices;return vertices=nodes===!0?[this.components[0],this.components[this.components.length-1]]:nodes===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(geometry,options){var result,edge=!(options&&options.edge===!1),details=edge&&options&&options.details,best={},min=Number.POSITIVE_INFINITY;if(geometry instanceof OpenLayers.Geometry.Point){for(var seg,segs=this.getSortedSegments(),x=geometry.x,y=geometry.y,i=0,len=segs.length;len>i;++i)if(seg=segs[i],result=OpenLayers.Geometry.distanceToSegment(geometry,seg),result.distance<min){if(min=result.distance,best=result,0===min)break}else if(seg.x2>x&&(y>seg.y1&&y<seg.y2||y<seg.y1&&y>seg.y2))break;best=details?{distance:best.distance,x0:best.x,y0:best.y,x1:x,y1:y}:best.distance}else if(geometry instanceof OpenLayers.Geometry.LineString){var seg0,seg1,intersection,x0,y0,segs0=this.getSortedSegments(),segs1=geometry.getSortedSegments(),len1=segs1.length,interOptions={point:!0};outer:for(var i=0,len=segs0.length;len>i;++i){seg0=segs0[i],x0=seg0.x1,y0=seg0.y1;for(var j=0;len1>j;++j){if(seg1=segs1[j],intersection=OpenLayers.Geometry.segmentsIntersect(seg0,seg1,interOptions)){min=0,best={distance:0,x0:intersection.x,y0:intersection.y,x1:intersection.x,y1:intersection.y};break outer}result=OpenLayers.Geometry.distanceToSegment({x:x0,y:y0},seg1),result.distance<min&&(min=result.distance,best={distance:min,x0:x0,y0:y0,x1:result.x,y1:result.y})}}if(details||(best=best.distance),0!==min&&seg0){result=geometry.distanceTo(new OpenLayers.Geometry.Point(seg0.x2,seg0.y2),options);var dist=details?result.distance:result;min>dist&&(best=details?{distance:min,x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0}:dist)}}else best=geometry.distanceTo(this,options),details&&(best={distance:best.distance,x0:best.x1,y0:best.y1,x1:best.x0,y1:best.y0});return best},simplify:function(tolerance){if(this&&null!==this){var points=this.getVertices();if(points.length<3)return this;var compareNumbers=function(a,b){return a-b},douglasPeuckerReduction=function(points,firstPoint,lastPoint,tolerance){for(var distance,maxDistance=0,indexFarthest=0,index=firstPoint;lastPoint>index;index++)distance=perpendicularDistance(points[firstPoint],points[lastPoint],points[index]),distance>maxDistance&&(maxDistance=distance,indexFarthest=index);maxDistance>tolerance&&indexFarthest!=firstPoint&&(pointIndexsToKeep.push(indexFarthest),douglasPeuckerReduction(points,firstPoint,indexFarthest,tolerance),douglasPeuckerReduction(points,indexFarthest,lastPoint,tolerance))},perpendicularDistance=function(point1,point2,point){var area=Math.abs(.5*(point1.x*point2.y+point2.x*point.y+point.x*point1.y-point2.x*point1.y-point.x*point2.y-point1.x*point.y)),bottom=Math.sqrt(Math.pow(point1.x-point2.x,2)+Math.pow(point1.y-point2.y,2)),height=area/bottom*2;return height},firstPoint=0,lastPoint=points.length-1,pointIndexsToKeep=[];for(pointIndexsToKeep.push(firstPoint),pointIndexsToKeep.push(lastPoint);points[firstPoint].equals(points[lastPoint]);)lastPoint--,pointIndexsToKeep.push(lastPoint);douglasPeuckerReduction(points,firstPoint,lastPoint,tolerance);var returnPoints=[];pointIndexsToKeep.sort(compareNumbers);for(var index=0;index<pointIndexsToKeep.length;index++)returnPoints.push(points[pointIndexsToKeep[index]]);return new OpenLayers.Geometry.LineString(returnPoints)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(geometry,options){for(var splits,sourceLine,sourceLines,sourceSplit,targetSplit,results=null,mutual=options&&options.mutual,sourceParts=[],targetParts=[geometry],i=0,len=this.components.length;len>i;++i){sourceLine=this.components[i],sourceSplit=!1;for(var j=0;j<targetParts.length;++j)if(splits=sourceLine.split(targetParts[j],options)){if(mutual){sourceLines=splits[0];for(var k=0,klen=sourceLines.length;klen>k;++k)0===k&&sourceParts.length?sourceParts[sourceParts.length-1].addComponent(sourceLines[k]):sourceParts.push(new OpenLayers.Geometry.MultiLineString([sourceLines[k]]));sourceSplit=!0,splits=splits[1]}if(splits.length){splits.unshift(j,1),Array.prototype.splice.apply(targetParts,splits);break}}sourceSplit||(sourceParts.length?sourceParts[sourceParts.length-1].addComponent(sourceLine.clone()):sourceParts=[new OpenLayers.Geometry.MultiLineString(sourceLine.clone())])}return sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],(sourceSplit||targetSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},splitWith:function(geometry,options){var splits,targetLine,sourceLines,sourceSplit,targetSplit,sourceParts,targetParts,results=null,mutual=options&&options.mutual;if(geometry instanceof OpenLayers.Geometry.LineString){targetParts=[],sourceParts=[geometry];for(var i=0,len=this.components.length;len>i;++i){targetSplit=!1,targetLine=this.components[i];for(var j=0;j<sourceParts.length;++j)if(splits=sourceParts[j].split(targetLine,options)){mutual&&(sourceLines=splits[0],sourceLines.length&&(sourceLines.unshift(j,1),Array.prototype.splice.apply(sourceParts,sourceLines),j+=sourceLines.length-2),splits=splits[1],0===splits.length&&(splits=[targetLine.clone()]));for(var k=0,klen=splits.length;klen>k;++k)0===k&&targetParts.length?targetParts[targetParts.length-1].addComponent(splits[k]):targetParts.push(new OpenLayers.Geometry.MultiLineString([splits[k]]));targetSplit=!0}targetSplit||(targetParts.length?targetParts[targetParts.length-1].addComponent(targetLine.clone()):targetParts=[new OpenLayers.Geometry.MultiLineString([targetLine.clone()])])}}else results=geometry.split(this);return sourceParts&&sourceParts.length>1?sourceSplit=!0:sourceParts=[],targetParts&&targetParts.length>1?targetSplit=!0:targetParts=[],(sourceSplit||targetSplit)&&(results=mutual?[sourceParts,targetParts]:targetParts),results},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(point,index){var added=!1,lastPoint=this.components.pop();null==index&&point.equals(lastPoint)||(added=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var firstPoint=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint]),added},removeComponent:function(point){var removed=this.components&&this.components.length>3;if(removed){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var firstPoint=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint])}return removed},move:function(x,y){for(var i=0,len=this.components.length;len-1>i;i++)this.components[i].move(x,y)},rotate:function(angle,origin){for(var i=0,len=this.components.length;len-1>i;++i)this.components[i].rotate(angle,origin)},resize:function(scale,origin,ratio){for(var i=0,len=this.components.length;len-1>i;++i)this.components[i].resize(scale,origin,ratio);return this},transform:function(source,dest){if(source&&dest){for(var i=0,len=this.components.length;len-1>i;i++){var component=this.components[i];component.transform(source,dest)}this.bounds=null}return this},getCentroid:function(){if(this.components){var len=this.components.length;if(len>0&&2>=len)return this.components[0].clone();if(len>2){var sumX=0,sumY=0,x0=this.components[0].x,y0=this.components[0].y,area=-1*this.getArea();if(0!=area){for(var i=0;len-1>i;i++){var b=this.components[i],c=this.components[i+1];sumX+=(b.x+c.x-2*x0)*((b.x-x0)*(c.y-y0)-(c.x-x0)*(b.y-y0)),sumY+=(b.y+c.y-2*y0)*((b.x-x0)*(c.y-y0)-(c.x-x0)*(b.y-y0))}var x=x0+sumX/(6*area),y=y0+sumY/(6*area)}else{for(var i=0;len-1>i;i++)sumX+=this.components[i].x,sumY+=this.components[i].y;var x=sumX/(len-1),y=sumY/(len-1)}return new OpenLayers.Geometry.Point(x,y)}return null}},getArea:function(){var area=0;if(this.components&&this.components.length>2){for(var sum=0,i=0,len=this.components.length;len-1>i;i++){var b=this.components[i],c=this.components[i+1];sum+=(b.x+c.x)*(c.y-b.y)}area=-sum/2}return area},getGeodesicArea:function(projection){var ring=this;if(projection){var gg=new OpenLayers.Projection("EPSG:4326");gg.equals(projection)||(ring=this.clone().transform(projection,gg))}var area=0,len=ring.components&&ring.components.length;if(len>2){for(var p1,p2,i=0;len-1>i;i++)p1=ring.components[i],p2=ring.components[i+1],area+=OpenLayers.Util.rad(p2.x-p1.x)*(2+Math.sin(OpenLayers.Util.rad(p1.y))+Math.sin(OpenLayers.Util.rad(p2.y)));area=6378137*area*6378137/2}return area},containsPoint:function(point){function getX(y,x1,y1,x2,y2){return(y-y2)*((x2-x1)/(y2-y1))+x2}for(var start,end,x1,y1,x2,y2,cx,approx=OpenLayers.Number.limitSigDigs,digs=14,px=approx(point.x,digs),py=approx(point.y,digs),numSeg=this.components.length-1,crosses=0,i=0;numSeg>i;++i)if(start=this.components[i],x1=approx(start.x,digs),y1=approx(start.y,digs),end=this.components[i+1],x2=approx(end.x,digs),y2=approx(end.y,digs),y1!=y2){if(cx=approx(getX(py,x1,y1,x2,y2),digs),cx==px&&(y2>y1&&py>=y1&&y2>=py||y1>y2&&y1>=py&&py>=y2)){crosses=-1;break}px>=cx||x1!=x2&&(cx<Math.min(x1,x2)||cx>Math.max(x1,x2))||(y2>y1&&py>=y1&&y2>py||y1>y2&&y1>py&&py>=y2)&&++crosses}else if(py==y1&&(x2>=x1&&px>=x1&&x2>=px||x1>=x2&&x1>=px&&px>=x2)){crosses=-1;break}var contained=-1==crosses?1:!!(1&crosses);return contained},intersects:function(geometry){var intersect=!1;if("OpenLayers.Geometry.Point"==geometry.CLASS_NAME)intersect=this.containsPoint(geometry);else if("OpenLayers.Geometry.LineString"==geometry.CLASS_NAME)intersect=geometry.intersects(this);else if("OpenLayers.Geometry.LinearRing"==geometry.CLASS_NAME)intersect=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[geometry]);else for(var i=0,len=geometry.components.length;len>i&&!(intersect=geometry.components[i].intersects(this));++i);return intersect},getVertices:function(nodes){return nodes===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var area=0;if(this.components&&this.components.length>0){area+=Math.abs(this.components[0].getArea());for(var i=1,len=this.components.length;len>i;i++)area-=Math.abs(this.components[i].getArea())}return area},getGeodesicArea:function(projection){var area=0;if(this.components&&this.components.length>0){area+=Math.abs(this.components[0].getGeodesicArea(projection));for(var i=1,len=this.components.length;len>i;i++)area-=Math.abs(this.components[i].getGeodesicArea(projection))}return area},containsPoint:function(point){var numRings=this.components.length,contained=!1;if(numRings>0&&(contained=this.components[0].containsPoint(point),1!==contained&&contained&&numRings>1))for(var hole,i=1;numRings>i;++i)if(hole=this.components[i].containsPoint(point)){contained=1===hole?1:!1;break}return contained},intersects:function(geometry){var i,len,intersect=!1;if("OpenLayers.Geometry.Point"==geometry.CLASS_NAME)intersect=this.containsPoint(geometry);else if("OpenLayers.Geometry.LineString"==geometry.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==geometry.CLASS_NAME){for(i=0,len=this.components.length;len>i&&!(intersect=geometry.intersects(this.components[i]));++i);if(!intersect)for(i=0,len=geometry.components.length;len>i&&!(intersect=this.containsPoint(geometry.components[i]));++i);}else for(i=0,len=geometry.components.length;len>i&&!(intersect=this.intersects(geometry.components[i]));++i);if(!intersect&&"OpenLayers.Geometry.Polygon"==geometry.CLASS_NAME){var ring=this.components[0];for(i=0,len=ring.components.length;len>i&&!(intersect=geometry.containsPoint(ring.components[i]));++i);}return intersect},distanceTo:function(geometry,options){var result,edge=!(options&&options.edge===!1);return result=!edge&&this.intersects(geometry)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[geometry,options])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(origin,radius,sides,rotation){var angle=Math.PI*(1/sides-.5);rotation&&(angle+=rotation/180*Math.PI);for(var rotatedAngle,x,y,points=[],i=0;sides>i;++i)rotatedAngle=angle+2*i*Math.PI/sides,x=origin.x+radius*Math.cos(rotatedAngle),y=origin.y+radius*Math.sin(rotatedAngle),points.push(new OpenLayers.Geometry.Point(x,y));var ring=new OpenLayers.Geometry.LinearRing(points);return new OpenLayers.Geometry.Polygon([ring])},OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(options){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));for(var featureNodes=this.getElementsByTagNameNS(data.documentElement,this.gmlns,this.featureName),features=[],i=0;i<featureNodes.length;i++){var feature=this.parseFeature(featureNodes[i]);feature&&features.push(feature)}return features},parseFeature:function(node){for(var type,nodeList,geometry,parser,order=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],i=0;i<order.length;++i)if(type=order[i],nodeList=this.getElementsByTagNameNS(node,this.gmlns,type),nodeList.length>0){if(parser=this.parseGeometry[type.toLowerCase()],!parser)throw new TypeError("Unsupported geometry type: "+type);geometry=parser.apply(this,[nodeList[0]]),this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection);break}var bounds,boxNodes=this.getElementsByTagNameNS(node,this.gmlns,"Box");for(i=0;i<boxNodes.length;++i){var boxNode=boxNodes[i],box=this.parseGeometry.box.apply(this,[boxNode]),parentNode=boxNode.parentNode,parentName=parentNode.localName||parentNode.nodeName.split(":").pop();"boundedBy"===parentName?bounds=box:geometry=box.toGeometry()}var attributes;this.extractAttributes&&(attributes=this.parseAttributes(node));var feature=new OpenLayers.Feature.Vector(geometry,attributes);feature.bounds=bounds,feature.gml={featureType:node.firstChild.nodeName.split(":")[1],featureNS:node.firstChild.namespaceURI,featureNSPrefix:node.firstChild.prefix};for(var fid,childNode=node.firstChild;childNode&&(1!=childNode.nodeType||!(fid=childNode.getAttribute("fid")||childNode.getAttribute("id")));)childNode=childNode.nextSibling;return feature.fid=fid,feature},parseGeometry:{point:function(node){var nodeList,coordString,coords=[],nodeList=this.getElementsByTagNameNS(node,this.gmlns,"pos");if(nodeList.length>0&&(coordString=nodeList[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.trimSpace,""),coords=coordString.split(this.regExes.splitSpace)),0==coords.length&&(nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates"),nodeList.length>0&&(coordString=nodeList[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.removeSpace,""),coords=coordString.split(","))),0==coords.length&&(nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coord"),nodeList.length>0)){var xList=this.getElementsByTagNameNS(nodeList[0],this.gmlns,"X"),yList=this.getElementsByTagNameNS(nodeList[0],this.gmlns,"Y");xList.length>0&&yList.length>0&&(coords=[xList[0].firstChild.nodeValue,yList[0].firstChild.nodeValue])}return 2==coords.length&&(coords[2]=null),this.xy?new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]):new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])},multipoint:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"Point"),components=[];if(nodeList.length>0)for(var point,i=0;i<nodeList.length;++i)point=this.parseGeometry.point.apply(this,[nodeList[i]]),point&&components.push(point);return new OpenLayers.Geometry.MultiPoint(components)},linestring:function(node,ring){var nodeList,coordString,coords=[],points=[];if(nodeList=this.getElementsByTagNameNS(node,this.gmlns,"posList"),nodeList.length>0){coordString=this.getChildValue(nodeList[0]),coordString=coordString.replace(this.regExes.trimSpace,""),coords=coordString.split(this.regExes.splitSpace);for(var j,x,y,z,dim=parseInt(nodeList[0].getAttribute("dimension")),i=0;i<coords.length/dim;++i)j=i*dim,x=coords[j],y=coords[j+1],z=2==dim?null:coords[j+2],this.xy?points.push(new OpenLayers.Geometry.Point(x,y,z)):points.push(new OpenLayers.Geometry.Point(y,x,z))}if(0==coords.length&&(nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates"),nodeList.length>0)){coordString=this.getChildValue(nodeList[0]),coordString=coordString.replace(this.regExes.trimSpace,""),coordString=coordString.replace(this.regExes.trimComma,",");for(var pointList=coordString.split(this.regExes.splitSpace),i=0;i<pointList.length;++i)coords=pointList[i].split(","),2==coords.length&&(coords[2]=null),this.xy?points.push(new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])):points.push(new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2]))}var line=null;return 0!=points.length&&(line=ring?new OpenLayers.Geometry.LinearRing(points):new OpenLayers.Geometry.LineString(points)),line},multilinestring:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"LineString"),components=[];if(nodeList.length>0)for(var line,i=0;i<nodeList.length;++i)line=this.parseGeometry.linestring.apply(this,[nodeList[i]]),line&&components.push(line);return new OpenLayers.Geometry.MultiLineString(components)},polygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"LinearRing"),components=[];if(nodeList.length>0)for(var ring,i=0;i<nodeList.length;++i)ring=this.parseGeometry.linestring.apply(this,[nodeList[i],!0]),ring&&components.push(ring);return new OpenLayers.Geometry.Polygon(components)},multipolygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"Polygon"),components=[];if(nodeList.length>0)for(var polygon,i=0;i<nodeList.length;++i)polygon=this.parseGeometry.polygon.apply(this,[nodeList[i]]),polygon&&components.push(polygon);return new OpenLayers.Geometry.MultiPolygon(components)},envelope:function(node){var coordString,envelope,components=[],lpoint=this.getElementsByTagNameNS(node,this.gmlns,"lowerCorner");if(lpoint.length>0){var coords=[];if(lpoint.length>0&&(coordString=lpoint[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.trimSpace,""),coords=coordString.split(this.regExes.splitSpace)),2==coords.length&&(coords[2]=null),this.xy)var lowerPoint=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]);else var lowerPoint=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])}var upoint=this.getElementsByTagNameNS(node,this.gmlns,"upperCorner");if(upoint.length>0){var coords=[];if(upoint.length>0&&(coordString=upoint[0].firstChild.nodeValue,coordString=coordString.replace(this.regExes.trimSpace,""),coords=coordString.split(this.regExes.splitSpace)),2==coords.length&&(coords[2]=null),this.xy)var upperPoint=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]);else var upperPoint=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])}if(lowerPoint&&upperPoint){components.push(new OpenLayers.Geometry.Point(lowerPoint.x,lowerPoint.y)),components.push(new OpenLayers.Geometry.Point(upperPoint.x,lowerPoint.y)),components.push(new OpenLayers.Geometry.Point(upperPoint.x,upperPoint.y)),components.push(new OpenLayers.Geometry.Point(lowerPoint.x,upperPoint.y)),components.push(new OpenLayers.Geometry.Point(lowerPoint.x,lowerPoint.y));var ring=new OpenLayers.Geometry.LinearRing(components);envelope=new OpenLayers.Geometry.Polygon([ring])}return envelope},box:function(node){var coordString,coords,nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates"),beginPoint=null,endPoint=null;return nodeList.length>0&&(coordString=nodeList[0].firstChild.nodeValue,coords=coordString.split(" "),2==coords.length&&(beginPoint=coords[0].split(","),endPoint=coords[1].split(","))),null!==beginPoint&&null!==endPoint?new OpenLayers.Bounds(parseFloat(beginPoint[0]),parseFloat(beginPoint[1]),parseFloat(endPoint[0]),parseFloat(endPoint[1])):void 0}},parseAttributes:function(node){for(var children,i,child,grandchildren,grandchild,name,value,attributes={},childNode=node.firstChild;childNode;){if(1==childNode.nodeType){for(children=childNode.childNodes,i=0;i<children.length;++i)child=children[i],1==child.nodeType&&(grandchildren=child.childNodes,1==grandchildren.length?(grandchild=grandchildren[0],(3==grandchild.nodeType||4==grandchild.nodeType)&&(name=child.prefix?child.nodeName.split(":")[1]:child.nodeName,value=grandchild.nodeValue.replace(this.regExes.trimSpace,""),attributes[name]=value)):attributes[child.nodeName.split(":").pop()]=null);break}childNode=childNode.nextSibling}return attributes},write:function(features){OpenLayers.Util.isArray(features)||(features=[features]);for(var gml=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;i<features.length;i++)gml.appendChild(this.createFeatureXML(features[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[gml])},createFeatureXML:function(feature){var geometry=feature.geometry,geometryNode=this.buildGeometryNode(geometry),geomContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);geomContainer.appendChild(geometryNode);var featureNode=this.createElementNS(this.gmlns,"gml:"+this.featureName),featureContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),fid=feature.fid||feature.id;featureContainer.setAttribute("fid",fid),featureContainer.appendChild(geomContainer);for(var attr in feature.attributes){
var attrText=this.createTextNode(feature.attributes[attr]),nodename=attr.substring(attr.lastIndexOf(":")+1),attrContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+nodename);attrContainer.appendChild(attrText),featureContainer.appendChild(attrContainer)}return featureNode.appendChild(featureContainer),featureNode},buildGeometryNode:function(geometry){this.externalProjection&&this.internalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var className=geometry.CLASS_NAME,type=className.substring(className.lastIndexOf(".")+1),builder=this.buildGeometry[type.toLowerCase()];return builder.apply(this,[geometry])},buildGeometry:{point:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:Point");return gml.appendChild(this.buildCoordinatesNode(geometry)),gml},multipoint:function(geometry){for(var pointMember,pointGeom,gml=this.createElementNS(this.gmlns,"gml:MultiPoint"),points=geometry.components,i=0;i<points.length;i++)pointMember=this.createElementNS(this.gmlns,"gml:pointMember"),pointGeom=this.buildGeometry.point.apply(this,[points[i]]),pointMember.appendChild(pointGeom),gml.appendChild(pointMember);return gml},linestring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:LineString");return gml.appendChild(this.buildCoordinatesNode(geometry)),gml},multilinestring:function(geometry){for(var lineMember,lineGeom,gml=this.createElementNS(this.gmlns,"gml:MultiLineString"),lines=geometry.components,i=0;i<lines.length;++i)lineMember=this.createElementNS(this.gmlns,"gml:lineStringMember"),lineGeom=this.buildGeometry.linestring.apply(this,[lines[i]]),lineMember.appendChild(lineGeom),gml.appendChild(lineMember);return gml},linearring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:LinearRing");return gml.appendChild(this.buildCoordinatesNode(geometry)),gml},polygon:function(geometry){for(var ringMember,ringGeom,type,gml=this.createElementNS(this.gmlns,"gml:Polygon"),rings=geometry.components,i=0;i<rings.length;++i)type=0==i?"outerBoundaryIs":"innerBoundaryIs",ringMember=this.createElementNS(this.gmlns,"gml:"+type),ringGeom=this.buildGeometry.linearring.apply(this,[rings[i]]),ringMember.appendChild(ringGeom),gml.appendChild(ringMember);return gml},multipolygon:function(geometry){for(var polyMember,polyGeom,gml=this.createElementNS(this.gmlns,"gml:MultiPolygon"),polys=geometry.components,i=0;i<polys.length;++i)polyMember=this.createElementNS(this.gmlns,"gml:polygonMember"),polyGeom=this.buildGeometry.polygon.apply(this,[polys[i]]),polyMember.appendChild(polyGeom),gml.appendChild(polyMember);return gml},bounds:function(bounds){var gml=this.createElementNS(this.gmlns,"gml:Box");return gml.appendChild(this.buildCoordinatesNode(bounds)),gml}},buildCoordinatesNode:function(geometry){var coordinatesNode=this.createElementNS(this.gmlns,"gml:coordinates");coordinatesNode.setAttribute("decimal","."),coordinatesNode.setAttribute("cs",","),coordinatesNode.setAttribute("ts"," ");var parts=[];if(geometry instanceof OpenLayers.Bounds)parts.push(geometry.left+","+geometry.bottom),parts.push(geometry.right+","+geometry.top);else for(var points=geometry.components?geometry.components:[geometry],i=0;i<points.length;i++)parts.push(points[i].x+","+points[i].y);var txtNode=this.createTextNode(parts.join(" "));return coordinatesNode.appendChild(txtNode),coordinatesNode},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]),this.setGeometryTypes(),options&&options.featureNS&&this.setNamespace("feature",options.featureNS),this.singleFeatureType=!options||"string"==typeof options.featureType},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var features=[];if(this.readNode(data,{features:features},!0),0==features.length){var elements=this.getElementsByTagNameNS(data,this.namespaces.gml,"featureMember");if(elements.length)for(var i=0,len=elements.length;len>i;++i)this.readNode(elements[i],{features:features},!0);else{var elements=this.getElementsByTagNameNS(data,this.namespaces.gml,"featureMembers");elements.length&&this.readNode(elements[0],{features:features},!0)}}return features},readNode:function(node,obj,first){return first===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||node.prefix in this.namespaces||node.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(node.parentNode.nodeName)||(this.featureType=node.nodeName.split(":").pop(),this.setNamespace("feature",node.namespaceURI),this.featureNS=node.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[node,obj])},readers:{gml:{_inherit:function(node,obj,container){},featureMember:function(node,obj){this.readChildNodes(node,obj)},featureMembers:function(node,obj){this.readChildNodes(node,obj)},name:function(node,obj){obj.name=this.getChildValue(node)},boundedBy:function(node,obj){var container={};this.readChildNodes(node,container),container.components&&container.components.length>0&&(obj.bounds=container.components[0])},Point:function(node,container){var obj={points:[]};this.readChildNodes(node,obj),container.components||(container.components=[]),container.components.push(obj.points[0])},coordinates:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");str=str.replace(this.regExes.trimComma,",");for(var coords,pointList=str.split(this.regExes.splitSpace),numPoints=pointList.length,points=new Array(numPoints),i=0;numPoints>i;++i)coords=pointList[i].split(","),this.xy?points[i]=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]):points[i]=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2]);obj.points=points},coord:function(node,obj){var coord={};this.readChildNodes(node,coord),obj.points||(obj.points=[]),obj.points.push(new OpenLayers.Geometry.Point(coord.x,coord.y,coord.z))},X:function(node,coord){coord.x=this.getChildValue(node)},Y:function(node,coord){coord.y=this.getChildValue(node)},Z:function(node,coord){coord.z=this.getChildValue(node)},MultiPoint:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),container.components=[new OpenLayers.Geometry.MultiPoint(obj.components)]},pointMember:function(node,obj){this.readChildNodes(node,obj)},LineString:function(node,container){var obj={};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),container.components||(container.components=[]),container.components.push(new OpenLayers.Geometry.LineString(obj.points))},MultiLineString:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),container.components=[new OpenLayers.Geometry.MultiLineString(obj.components)]},lineStringMember:function(node,obj){this.readChildNodes(node,obj)},Polygon:function(node,container){var obj={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),obj.inner.unshift(obj.outer),container.components||(container.components=[]),container.components.push(new OpenLayers.Geometry.Polygon(obj.inner))},LinearRing:function(node,obj){var container={};this.readers.gml._inherit.apply(this,[node,container]),this.readChildNodes(node,container),obj.components=[new OpenLayers.Geometry.LinearRing(container.points)]},MultiPolygon:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),container.components=[new OpenLayers.Geometry.MultiPolygon(obj.components)]},polygonMember:function(node,obj){this.readChildNodes(node,obj)},GeometryCollection:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),container.components=[new OpenLayers.Geometry.Collection(obj.components)]},geometryMember:function(node,obj){this.readChildNodes(node,obj)}},feature:{"*":function(node,obj){var name,local=node.localName||node.nodeName.split(":").pop();obj.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,local)?local===this.featureType&&(name="_typeName"):name="_typeName":0==node.childNodes.length||1==node.childNodes.length&&3==node.firstChild.nodeType?this.extractAttributes&&(name="_attribute"):name="_geometry",name&&this.readers.feature[name].apply(this,[node,obj])},_typeName:function(node,obj){var container={components:[],attributes:{}};this.readChildNodes(node,container),container.name&&(container.attributes.name=container.name);var feature=new OpenLayers.Feature.Vector(container.components[0],container.attributes);this.singleFeatureType||(feature.type=node.nodeName.split(":").pop(),feature.namespace=node.namespaceURI);var fid=node.getAttribute("fid")||this.getAttributeNS(node,this.namespaces.gml,"id");fid&&(feature.fid=fid),this.internalProjection&&this.externalProjection&&feature.geometry&&feature.geometry.transform(this.externalProjection,this.internalProjection),container.bounds&&(feature.bounds=container.bounds),obj.features.push(feature)},_geometry:function(node,obj){this.geometryName||(this.geometryName=node.nodeName.split(":").pop()),this.readChildNodes(node,obj)},_attribute:function(node,obj){var local=node.localName||node.nodeName.split(":").pop(),value=this.getChildValue(node);obj.attributes[local]=value}},wfs:{FeatureCollection:function(node,obj){this.readChildNodes(node,obj)}}},write:function(features){var name;name=OpenLayers.Util.isArray(features)?"featureMembers":"featureMember";var root=this.writeNode("gml:"+name,features);return this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[root])},writers:{gml:{featureMember:function(feature){var node=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",feature,node),node},MultiPoint:function(geometry){for(var node=this.createElementNSPlus("gml:MultiPoint"),components=geometry.components||[geometry],i=0,ii=components.length;ii>i;++i)this.writeNode("pointMember",components[i],node);return node},pointMember:function(geometry){var node=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",geometry,node),node},MultiLineString:function(geometry){for(var node=this.createElementNSPlus("gml:MultiLineString"),components=geometry.components||[geometry],i=0,ii=components.length;ii>i;++i)this.writeNode("lineStringMember",components[i],node);return node},lineStringMember:function(geometry){var node=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",geometry,node),node},MultiPolygon:function(geometry){for(var node=this.createElementNSPlus("gml:MultiPolygon"),components=geometry.components||[geometry],i=0,ii=components.length;ii>i;++i)this.writeNode("polygonMember",components[i],node);return node},polygonMember:function(geometry){var node=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",geometry,node),node},GeometryCollection:function(geometry){for(var node=this.createElementNSPlus("gml:GeometryCollection"),i=0,len=geometry.components.length;len>i;++i)this.writeNode("geometryMember",geometry.components[i],node);return node},geometryMember:function(geometry){var node=this.createElementNSPlus("gml:geometryMember"),child=this.writeNode("feature:_geometry",geometry);return node.appendChild(child.firstChild),node}},feature:{_typeName:function(feature){var node=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:feature.fid}});feature.geometry&&this.writeNode("feature:_geometry",feature.geometry,node);for(var name in feature.attributes){var value=feature.attributes[name];null!=value&&this.writeNode("feature:_attribute",{name:name,value:value},node)}return node},_geometry:function(geometry){this.externalProjection&&this.internalProjection&&(geometry=geometry.clone().transform(this.internalProjection,this.externalProjection));var node=this.createElementNSPlus("feature:"+this.geometryName),type=this.geometryTypes[geometry.CLASS_NAME],child=this.writeNode("gml:"+type,geometry,node);return this.srsName&&child.setAttribute("srsName",this.srsName),node},_attribute:function(obj){return this.createElementNSPlus("feature:"+obj.name,{value:obj.value})}},wfs:{FeatureCollection:function(features){for(var node=this.createElementNSPlus("wfs:FeatureCollection"),i=0,len=features.length;len>i;++i)this.writeNode("gml:featureMember",features[i],node);return node}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(options){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[options])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(node,obj,container){var dim=parseInt(node.getAttribute("srsDimension"),10)||container&&container.srsDimension;dim&&(obj.srsDimension=dim)},featureMembers:function(node,obj){this.readChildNodes(node,obj)},Curve:function(node,container){var obj={points:[]};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),container.components||(container.components=[]),container.components.push(new OpenLayers.Geometry.LineString(obj.points))},segments:function(node,obj){this.readChildNodes(node,obj)},LineStringSegment:function(node,container){var obj={};this.readChildNodes(node,obj),obj.points&&Array.prototype.push.apply(container.points,obj.points)},pos:function(node,obj){var point,str=this.getChildValue(node).replace(this.regExes.trimSpace,""),coords=str.split(this.regExes.splitSpace);point=this.xy?new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]):new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2]),obj.points=[point]},posList:function(node,obj){for(var x,y,z,str=this.getChildValue(node).replace(this.regExes.trimSpace,""),coords=str.split(this.regExes.splitSpace),dim=obj.srsDimension||parseInt(node.getAttribute("srsDimension")||node.getAttribute("dimension"),10)||2,numPoints=coords.length/dim,points=new Array(numPoints),i=0,len=coords.length;len>i;i+=dim)x=coords[i],y=coords[i+1],z=2==dim?void 0:coords[i+2],this.xy?points[i/dim]=new OpenLayers.Geometry.Point(x,y,z):points[i/dim]=new OpenLayers.Geometry.Point(y,x,z);obj.points=points},Surface:function(node,obj){this.readChildNodes(node,obj)},patches:function(node,obj){this.readChildNodes(node,obj)},PolygonPatch:function(node,obj){this.readers.gml.Polygon.apply(this,[node,obj])},exterior:function(node,container){var obj={};this.readChildNodes(node,obj),container.outer=obj.components[0]},interior:function(node,container){var obj={};this.readChildNodes(node,obj),container.inner.push(obj.components[0])},MultiCurve:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),obj.components.length>0&&(container.components=[new OpenLayers.Geometry.MultiLineString(obj.components)])},curveMember:function(node,obj){this.readChildNodes(node,obj)},MultiSurface:function(node,container){var obj={components:[]};this.readers.gml._inherit.apply(this,[node,obj,container]),this.readChildNodes(node,obj),obj.components.length>0&&(container.components=[new OpenLayers.Geometry.MultiPolygon(obj.components)])},surfaceMember:function(node,obj){this.readChildNodes(node,obj)},surfaceMembers:function(node,obj){this.readChildNodes(node,obj)},pointMembers:function(node,obj){this.readChildNodes(node,obj)},lineStringMembers:function(node,obj){this.readChildNodes(node,obj)},polygonMembers:function(node,obj){this.readChildNodes(node,obj)},geometryMembers:function(node,obj){this.readChildNodes(node,obj)},Envelope:function(node,container){var obj={points:new Array(2)};this.readChildNodes(node,obj),container.components||(container.components=[]);var min=obj.points[0],max=obj.points[1];container.components.push(new OpenLayers.Bounds(min.x,min.y,max.x,max.y))},lowerCorner:function(node,container){var obj={};this.readers.gml.pos.apply(this,[node,obj]),container.points[0]=obj.points[0]},upperCorner:function(node,container){var obj={};this.readers.gml.pos.apply(this,[node,obj]),container.points[1]=obj.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(features){var name;name=OpenLayers.Util.isArray(features)?"featureMembers":"featureMember";var root=this.writeNode("gml:"+name,features);return this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[root])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(features){for(var node=this.createElementNSPlus("gml:featureMembers"),i=0,len=features.length;len>i;++i)this.writeNode("feature:_typeName",features[i],node);return node},Point:function(geometry){var node=this.createElementNSPlus("gml:Point");return this.writeNode("pos",geometry,node),node},pos:function(point){var pos=this.xy?point.x+" "+point.y:point.y+" "+point.x;return this.createElementNSPlus("gml:pos",{value:pos})},LineString:function(geometry){var node=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",geometry.components,node),node},Curve:function(geometry){var node=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",geometry,node),node},segments:function(geometry){var node=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",geometry,node),node},LineStringSegment:function(geometry){var node=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",geometry.components,node),node},posList:function(points){for(var point,len=points.length,parts=new Array(len),i=0;len>i;++i)point=points[i],this.xy?parts[i]=point.x+" "+point.y:parts[i]=point.y+" "+point.x;return this.createElementNSPlus("gml:posList",{value:parts.join(" ")})},Surface:function(geometry){var node=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",geometry,node),node},patches:function(geometry){var node=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",geometry,node),node},PolygonPatch:function(geometry){var node=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",geometry.components[0],node);for(var i=1,len=geometry.components.length;len>i;++i)this.writeNode("interior",geometry.components[i],node);return node},Polygon:function(geometry){var node=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",geometry.components[0],node);for(var i=1,len=geometry.components.length;len>i;++i)this.writeNode("interior",geometry.components[i],node);return node},exterior:function(ring){var node=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",ring,node),node},interior:function(ring){var node=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",ring,node),node},LinearRing:function(ring){var node=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",ring.components,node),node},MultiCurve:function(geometry){for(var node=this.createElementNSPlus("gml:MultiCurve"),components=geometry.components||[geometry],i=0,len=components.length;len>i;++i)this.writeNode("curveMember",components[i],node);return node},curveMember:function(geometry){var node=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",geometry,node):this.writeNode("LineString",geometry,node),node},MultiSurface:function(geometry){for(var node=this.createElementNSPlus("gml:MultiSurface"),components=geometry.components||[geometry],i=0,len=components.length;len>i;++i)this.writeNode("surfaceMember",components[i],node);return node},surfaceMember:function(polygon){var node=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",polygon,node):this.writeNode("Polygon",polygon,node),node},Envelope:function(bounds){var node=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",bounds,node),this.writeNode("upperCorner",bounds,node),this.srsName&&node.setAttribute("srsName",this.srsName),node},lowerCorner:function(bounds){var pos=this.xy?bounds.left+" "+bounds.bottom:bounds.bottom+" "+bounds.left;return this.createElementNSPlus("gml:lowerCorner",{value:pos})},upperCorner:function(bounds){var pos=this.xy?bounds.right+" "+bounds.top:bounds.top+" "+bounds.right;return this.createElementNSPlus("gml:upperCorner",{value:pos})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(options){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[options])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(node,obj){var matchCase=node.getAttribute("matchCase"),filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===matchCase||"0"===matchCase)});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsNotEqualTo:function(node,obj){var matchCase=node.getAttribute("matchCase"),filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===matchCase||"0"===matchCase)});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsLike:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(node,filter);var wildCard=node.getAttribute("wildCard"),singleChar=node.getAttribute("singleChar"),esc=node.getAttribute("escapeChar");filter.value2regex(wildCard,singleChar,esc),obj.filters.push(filter)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:filter.matchCase}});return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsNotEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:filter.matchCase}});return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsLike:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:filter.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",filter,node),this.writeNode("Literal",filter.regex2value(),node),node},BBOX:function(filter){var node=this.createElementNSPlus("ogc:BBOX");filter.property&&this.writeNode("PropertyName",filter,node);var box=this.writeNode("gml:Envelope",filter.value);return filter.projection&&box.setAttribute("srsName",filter.projection),node.appendChild(box),node},SortBy:function(sortProperties){for(var node=this.createElementNSPlus("ogc:SortBy"),i=0,l=sortProperties.length;l>i;i++)this.writeNode("ogc:SortProperty",sortProperties[i],node);return node},SortProperty:function(sortProperty){var node=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",sortProperty,node),this.writeNode("ogc:SortOrder","DESC"==sortProperty.order?"DESC":"ASC",node),node},SortOrder:function(value){var node=this.createElementNSPlus("ogc:SortOrder",{value:value});return node}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(filter,name){var node=this.createElementNSPlus("ogc:"+name);if(this.writeNode("PropertyName",filter,node),filter.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",filter.value,node);else{var child;child=filter.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",filter.value).firstChild:this.writeNode("gml:Envelope",filter.value),filter.projection&&child.setAttribute("srsName",filter.projection),node.appendChild(child)}return node},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(root,options){var version=this.version;if(!version){var uri=root.getAttribute("xmlns:ows");uri&&"1.1"===uri.substring(uri.lastIndexOf("/")+1)&&(version="1.1.0"),version||(version=this.defaultVersion)}return version},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);var ows={};return this.readChildNodes(data,ows),ows},readers:{ows:{Exception:function(node,exceptionReport){var exception={code:node.getAttribute("exceptionCode"),locator:node.getAttribute("locator"),texts:[]};exceptionReport.exceptions.push(exception),this.readChildNodes(node,exception)},ExceptionText:function(node,exception){var text=this.getChildValue(node);exception.texts.push(text)},ServiceIdentification:function(node,obj){obj.serviceIdentification={},this.readChildNodes(node,obj.serviceIdentification)},Title:function(node,obj){obj.title=this.getChildValue(node)},Abstract:function(node,serviceIdentification){serviceIdentification["abstract"]=this.getChildValue(node)},Keywords:function(node,serviceIdentification){serviceIdentification.keywords={},this.readChildNodes(node,serviceIdentification.keywords)},Keyword:function(node,keywords){keywords[this.getChildValue(node)]=!0},ServiceType:function(node,serviceIdentification){serviceIdentification.serviceType={codeSpace:node.getAttribute("codeSpace"),value:this.getChildValue(node)}},ServiceTypeVersion:function(node,serviceIdentification){serviceIdentification.serviceTypeVersion=this.getChildValue(node)},Fees:function(node,serviceIdentification){serviceIdentification.fees=this.getChildValue(node)},AccessConstraints:function(node,serviceIdentification){serviceIdentification.accessConstraints=this.getChildValue(node)},ServiceProvider:function(node,obj){obj.serviceProvider={},this.readChildNodes(node,obj.serviceProvider)},ProviderName:function(node,serviceProvider){serviceProvider.providerName=this.getChildValue(node)},ProviderSite:function(node,serviceProvider){serviceProvider.providerSite=this.getAttributeNS(node,this.namespaces.xlink,"href")},ServiceContact:function(node,serviceProvider){serviceProvider.serviceContact={},this.readChildNodes(node,serviceProvider.serviceContact)},IndividualName:function(node,serviceContact){serviceContact.individualName=this.getChildValue(node)},PositionName:function(node,serviceContact){serviceContact.positionName=this.getChildValue(node)},ContactInfo:function(node,serviceContact){serviceContact.contactInfo={},this.readChildNodes(node,serviceContact.contactInfo)},Phone:function(node,contactInfo){contactInfo.phone={},this.readChildNodes(node,contactInfo.phone)},Voice:function(node,phone){phone.voice=this.getChildValue(node)},Address:function(node,contactInfo){contactInfo.address={},this.readChildNodes(node,contactInfo.address)},DeliveryPoint:function(node,address){address.deliveryPoint=this.getChildValue(node)},City:function(node,address){address.city=this.getChildValue(node)},AdministrativeArea:function(node,address){address.administrativeArea=this.getChildValue(node)},PostalCode:function(node,address){address.postalCode=this.getChildValue(node)},Country:function(node,address){address.country=this.getChildValue(node)},ElectronicMailAddress:function(node,address){address.electronicMailAddress=this.getChildValue(node)},Role:function(node,serviceContact){serviceContact.role=this.getChildValue(node)},OperationsMetadata:function(node,obj){obj.operationsMetadata={},this.readChildNodes(node,obj.operationsMetadata)},Operation:function(node,operationsMetadata){var name=node.getAttribute("name");operationsMetadata[name]={},this.readChildNodes(node,operationsMetadata[name])},DCP:function(node,operation){operation.dcp={},this.readChildNodes(node,operation.dcp)},HTTP:function(node,dcp){dcp.http={},this.readChildNodes(node,dcp.http)},Get:function(node,http){http.get||(http.get=[]);var obj={url:this.getAttributeNS(node,this.namespaces.xlink,"href")};this.readChildNodes(node,obj),http.get.push(obj)},Post:function(node,http){http.post||(http.post=[]);var obj={url:this.getAttributeNS(node,this.namespaces.xlink,"href")};this.readChildNodes(node,obj),http.post.push(obj)},Parameter:function(node,operation){operation.parameters||(operation.parameters={});var name=node.getAttribute("name");operation.parameters[name]={},this.readChildNodes(node,operation.parameters[name])},Constraint:function(node,obj){obj.constraints||(obj.constraints={});var name=node.getAttribute("name");obj.constraints[name]={},this.readChildNodes(node,obj.constraints[name])},Value:function(node,allowedValues){allowedValues[this.getChildValue(node)]=!0},OutputFormat:function(node,obj){obj.formats.push({value:this.getChildValue(node)}),this.readChildNodes(node,obj)},WGS84BoundingBox:function(node,obj){var boundingBox={};boundingBox.crs=node.getAttribute("crs"),obj.BoundingBox?obj.BoundingBox.push(boundingBox):(obj.projection=boundingBox.crs,boundingBox=obj),this.readChildNodes(node,boundingBox)},BoundingBox:function(node,obj){this.readers.ows.WGS84BoundingBox.apply(this,[node,obj])},LowerCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");str=str.replace(this.regExes.trimComma,",");var pointList=str.split(this.regExes.splitSpace);obj.left=pointList[0],obj.bottom=pointList[1]},UpperCorner:function(node,obj){
var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");str=str.replace(this.regExes.trimComma,",");var pointList=str.split(this.regExes.splitSpace);obj.right=pointList[0],obj.top=pointList[1],obj.bounds=new OpenLayers.Bounds(obj.left,obj.bottom,obj.right,obj.top),delete obj.left,delete obj.bottom,delete obj.right,delete obj.top},Language:function(node,obj){obj.language=this.getChildValue(node)}}},writers:{ows:{BoundingBox:function(options,nodeName){var node=this.createElementNSPlus(nodeName||"ows:BoundingBox",{attributes:{crs:options.projection}});return this.writeNode("ows:LowerCorner",options,node),this.writeNode("ows:UpperCorner",options,node),node},LowerCorner:function(options){var node=this.createElementNSPlus("ows:LowerCorner",{value:options.bounds.left+" "+options.bounds.bottom});return node},UpperCorner:function(options){var node=this.createElementNSPlus("ows:UpperCorner",{value:options.bounds.right+" "+options.bounds.top});return node},Identifier:function(identifier){var node=this.createElementNSPlus("ows:Identifier",{value:identifier});return node},Title:function(title){var node=this.createElementNSPlus("ows:Title",{value:title});return node},Abstract:function(abstractValue){var node=this.createElementNSPlus("ows:Abstract",{value:abstractValue});return node},OutputFormat:function(format){var node=this.createElementNSPlus("ows:OutputFormat",{value:format});return node}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(node,obj){obj.success=!1,obj.exceptionReport={version:node.getAttribute("version"),language:node.getAttribute("language"),exceptions:[]},this.readChildNodes(node,obj.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(options){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[options]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[options])},readNode:function(node,obj,first){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(node,obj){obj.numberOfFeatures=parseInt(node.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(node,obj){obj.insertIds=[],obj.success=!1,this.readChildNodes(node,obj)},TransactionSummary:function(node,obj){obj.success=!0},InsertResults:function(node,obj){this.readChildNodes(node,obj)},Feature:function(node,container){var obj={fids:[]};this.readChildNodes(node,obj),container.insertIds.push(obj.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(options){var node=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return options&&this.setAttributes(node,{resultType:options.resultType,startIndex:options.startIndex,count:options.count}),node},Query:function(options){options=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},options);var prefix=options.featurePrefix,node=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(prefix?prefix+":":"")+options.featureType,srsName:options.srsName}});if(options.featureNS&&node.setAttribute("xmlns:"+prefix,options.featureNS),options.propertyNames)for(var i=0,len=options.propertyNames.length;len>i;i++)this.writeNode("wfs:PropertyName",{property:options.propertyNames[i]},node);return options.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,options.filter),this.writeNode("ogc:Filter",options.filter,node)),node},PropertyName:function(obj){return this.createElementNSPlus("wfs:PropertyName",{value:obj.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(options){options=options||{},OpenLayers.Util.extend(this,options),this.options=options},mergeWithDefaultFilter:function(filter){var merged;return merged=filter&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,filter]}):filter||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(options){options=options||{},options.filter=this.mergeWithDefaultFilter(options.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(response){},createCallback:function(method,response,options){return OpenLayers.Function.bind(function(){method.apply(this,[response,options])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(options){OpenLayers.Util.extend(this,options)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(k,v){if(v&&"object"==typeof v)for(var i in v)v.hasOwnProperty(i)&&(v[i]=walk(i,v[i]));return filter(k,v)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(e){}return this.keepData&&(this.data=object),object},write:function(value,pretty){this.pretty=!!pretty;var json=null,type=typeof value;if(this.serialize[type])try{json=!this.pretty&&this.nativeJSON?JSON.stringify(value):this.serialize[type].apply(this,[value])}catch(err){OpenLayers.Console.error("Trouble serializing: "+err)}return json},writeIndent:function(){var pieces=[];if(this.pretty)for(var i=0;i<this.level;++i)pieces.push(this.indent);return pieces.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(object){if(null==object)return"null";if(object.constructor==Date)return this.serialize.date.apply(this,[object]);if(object.constructor==Array)return this.serialize.array.apply(this,[object]);var pieces=["{"];this.level+=1;var key,keyJSON,valueJSON,addComma=!1;for(key in object)object.hasOwnProperty(key)&&(keyJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[key,this.pretty]),valueJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[object[key],this.pretty]),null!=keyJSON&&null!=valueJSON&&(addComma&&pieces.push(","),pieces.push(this.writeNewline(),this.writeIndent(),keyJSON,":",this.writeSpace(),valueJSON),addComma=!0));return this.level-=1,pieces.push(this.writeNewline(),this.writeIndent(),"}"),pieces.join("")},array:function(array){var json,pieces=["["];this.level+=1;for(var i=0,len=array.length;len>i;++i)json=OpenLayers.Format.JSON.prototype.write.apply(this,[array[i],this.pretty]),null!=json&&(i>0&&pieces.push(","),pieces.push(this.writeNewline(),this.writeIndent(),json));return this.level-=1,pieces.push(this.writeNewline(),this.writeIndent(),"]"),pieces.join("")},string:function(string){var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(string)?'"'+string.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];return c?c:(c=b.charCodeAt(),"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16))})+'"':'"'+string+'"'},number:function(number){return isFinite(number)?String(number):"null"},"boolean":function(bool){return String(bool)},date:function(date){function format(number){return 10>number?"0"+number:number}return'"'+date.getFullYear()+"-"+format(date.getMonth()+1)+"-"+format(date.getDate())+"T"+format(date.getHours())+":"+format(date.getMinutes())+":"+format(date.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(json,type,filter){type=type?type:"FeatureCollection";var results=null,obj=null;if(obj="string"==typeof json?OpenLayers.Format.JSON.prototype.read.apply(this,[json,filter]):json){if("string"!=typeof obj.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+json);else if(this.isValidType(obj,type))switch(type){case"Geometry":try{results=this.parseGeometry(obj)}catch(err){OpenLayers.Console.error(err)}break;case"Feature":try{results=this.parseFeature(obj),results.type="Feature"}catch(err){OpenLayers.Console.error(err)}break;case"FeatureCollection":switch(results=[],obj.type){case"Feature":try{results.push(this.parseFeature(obj))}catch(err){results=null,OpenLayers.Console.error(err)}break;case"FeatureCollection":for(var i=0,len=obj.features.length;len>i;++i)try{results.push(this.parseFeature(obj.features[i]))}catch(err){results=null,OpenLayers.Console.error(err)}break;default:try{var geom=this.parseGeometry(obj);results.push(new OpenLayers.Feature.Vector(geom))}catch(err){results=null,OpenLayers.Console.error(err)}}}}else OpenLayers.Console.error("Bad JSON: "+json);return results},isValidType:function(obj,type){var valid=!1;switch(type){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],obj.type)?OpenLayers.Console.error("Unsupported geometry type: "+obj.type):valid=!0;break;case"FeatureCollection":valid=!0;break;default:obj.type==type?valid=!0:OpenLayers.Console.error("Cannot convert types from "+obj.type+" to "+type)}return valid},parseFeature:function(obj){var feature,geometry,attributes,bbox;attributes=obj.properties?obj.properties:{},bbox=obj.geometry&&obj.geometry.bbox||obj.bbox;try{geometry=this.parseGeometry(obj.geometry)}catch(err){throw err}return feature=new OpenLayers.Feature.Vector(geometry,attributes),bbox&&(feature.bounds=OpenLayers.Bounds.fromArray(bbox)),obj.id&&(feature.fid=obj.id),feature},parseGeometry:function(obj){if(null==obj)return null;var geometry,collection=!1;if("GeometryCollection"==obj.type){if(!OpenLayers.Util.isArray(obj.geometries))throw"GeometryCollection must have geometries array: "+obj;for(var numGeom=obj.geometries.length,components=new Array(numGeom),i=0;numGeom>i;++i)components[i]=this.parseGeometry.apply(this,[obj.geometries[i]]);geometry=new OpenLayers.Geometry.Collection(components),collection=!0}else{if(!OpenLayers.Util.isArray(obj.coordinates))throw"Geometry must have coordinates array: "+obj;if(!this.parseCoords[obj.type.toLowerCase()])throw"Unsupported geometry type: "+obj.type;try{geometry=this.parseCoords[obj.type.toLowerCase()].apply(this,[obj.coordinates])}catch(err){throw err}}return this.internalProjection&&this.externalProjection&&!collection&&geometry.transform(this.externalProjection,this.internalProjection),geometry},parseCoords:{point:function(array){if(0==this.ignoreExtraDims&&2!=array.length)throw"Only 2D points are supported: "+array;return new OpenLayers.Geometry.Point(array[0],array[1])},multipoint:function(array){for(var points=[],p=null,i=0,len=array.length;len>i;++i){try{p=this.parseCoords.point.apply(this,[array[i]])}catch(err){throw err}points.push(p)}return new OpenLayers.Geometry.MultiPoint(points)},linestring:function(array){for(var points=[],p=null,i=0,len=array.length;len>i;++i){try{p=this.parseCoords.point.apply(this,[array[i]])}catch(err){throw err}points.push(p)}return new OpenLayers.Geometry.LineString(points)},multilinestring:function(array){for(var lines=[],l=null,i=0,len=array.length;len>i;++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])}catch(err){throw err}lines.push(l)}return new OpenLayers.Geometry.MultiLineString(lines)},polygon:function(array){for(var r,l,rings=[],i=0,len=array.length;len>i;++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])}catch(err){throw err}r=new OpenLayers.Geometry.LinearRing(l.components),rings.push(r)}return new OpenLayers.Geometry.Polygon(rings)},multipolygon:function(array){for(var polys=[],p=null,i=0,len=array.length;len>i;++i){try{p=this.parseCoords.polygon.apply(this,[array[i]])}catch(err){throw err}polys.push(p)}return new OpenLayers.Geometry.MultiPolygon(polys)},box:function(array){if(2!=array.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(array[0][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[0][1])])])}},write:function(obj,pretty){var geojson={type:null};if(OpenLayers.Util.isArray(obj)){geojson.type="FeatureCollection";var numFeatures=obj.length;geojson.features=new Array(numFeatures);for(var i=0;numFeatures>i;++i){var element=obj[i];if(!element instanceof OpenLayers.Feature.Vector){var msg="FeatureCollection only supports collections of features: "+element;throw msg}geojson.features[i]=this.extract.feature.apply(this,[element])}}else 0==obj.CLASS_NAME.indexOf("OpenLayers.Geometry")?geojson=this.extract.geometry.apply(this,[obj]):obj instanceof OpenLayers.Feature.Vector&&(geojson=this.extract.feature.apply(this,[obj]),obj.layer&&obj.layer.projection&&(geojson.crs=this.createCRSObject(obj)));return OpenLayers.Format.JSON.prototype.write.apply(this,[geojson,pretty])},createCRSObject:function(object){var proj=object.layer.projection.toString(),crs={};if(proj.match(/epsg:/i)){var code=parseInt(proj.substring(proj.indexOf(":")+1));crs=4326==code?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+code}}}return crs},extract:{feature:function(feature){var geom=this.extract.geometry.apply(this,[feature.geometry]),json={type:"Feature",properties:feature.attributes,geometry:geom};return null!=feature.fid&&(json.id=feature.fid),json},geometry:function(geometry){if(null==geometry)return null;this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var json,geometryType=geometry.CLASS_NAME.split(".")[2],data=this.extract[geometryType.toLowerCase()].apply(this,[geometry]);return json="Collection"==geometryType?{type:"GeometryCollection",geometries:data}:{type:geometryType,coordinates:data}},point:function(point){return[point.x,point.y]},multipoint:function(multipoint){for(var array=[],i=0,len=multipoint.components.length;len>i;++i)array.push(this.extract.point.apply(this,[multipoint.components[i]]));return array},linestring:function(linestring){for(var array=[],i=0,len=linestring.components.length;len>i;++i)array.push(this.extract.point.apply(this,[linestring.components[i]]));return array},multilinestring:function(multilinestring){for(var array=[],i=0,len=multilinestring.components.length;len>i;++i)array.push(this.extract.linestring.apply(this,[multilinestring.components[i]]));return array},polygon:function(polygon){for(var array=[],i=0,len=polygon.components.length;len>i;++i)array.push(this.extract.linestring.apply(this,[polygon.components[i]]));return array},multipolygon:function(multipolygon){for(var array=[],i=0,len=multipolygon.components.length;len>i;++i)array.push(this.extract.polygon.apply(this,[multipolygon.components[i]]));return array},collection:function(collection){for(var len=collection.components.length,array=new Array(len),i=0;len>i;++i)array[i]=this.extract.geometry.apply(this,[collection.components[i]]);return array}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(options){if(options=options||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var format=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(filter,params){return format.write(filter,params)}}},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments),options=OpenLayers.Util.applyDefaults(options,this.options),options.params=OpenLayers.Util.applyDefaults(options.params,this.options.params),options.filter&&this.filterToParams&&(options.params=this.filterToParams(options.filter,options.params));var response=new OpenLayers.Protocol.Response({requestType:"read"}),request=this.createRequest(options.url,options.params,OpenLayers.Function.bind(function(data){response.data=data,this.handleRead(response,options)},this));return response.priv=request,response},createRequest:function(url,params,callback){var id=OpenLayers.Protocol.Script.register(callback),name=OpenLayers.String.format(this.callbackTemplate,{id:id});params=OpenLayers.Util.extend({},params),params[this.callbackKey]=this.callbackPrefix+name,url=OpenLayers.Util.urlAppend(url,OpenLayers.Util.getParameterString(params));var script=document.createElement("script");script.type="text/javascript",script.src=url,script.id="OpenLayers_Protocol_Script_"+id,this.pendingRequests[script.id]=script;var head=document.getElementsByTagName("head")[0];return head.appendChild(script),script},destroyRequest:function(script){OpenLayers.Protocol.Script.unregister(script.id.split("_").pop()),delete this.pendingRequests[script.id],script.parentNode&&script.parentNode.removeChild(script)},handleRead:function(response,options){this.handleResponse(response,options)},handleResponse:function(response,options){options.callback&&(response.data?(response.features=this.parseFeatures(response.data),response.code=OpenLayers.Protocol.Response.SUCCESS):response.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(response.priv),options.callback.call(options.scope,response))},parseFeatures:function(data){return this.format.read(data)},abort:function(response){if(response)this.destroyRequest(response.priv);else for(var key in this.pendingRequests)this.destroyRequest(this.pendingRequests[key])},destroy:function(){this.abort(),delete this.params,delete this.format,OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var o=OpenLayers.Protocol.Script,counter=0;o.registry={},o.register=function(callback){var id="c"+ ++counter;return o.registry[id]=function(){callback.apply(this,arguments)},id},o.unregister=function(id){delete o.registry[id]}}(),OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,{geometryType:"linestring",initialize:function(options){OpenLayers.Format.prototype.initialize.apply(this,[options])},read:function(encoded){var geomType;if("linestring"==this.geometryType)geomType=OpenLayers.Geometry.LineString;else if("linearring"==this.geometryType)geomType=OpenLayers.Geometry.LinearRing;else if("multipoint"==this.geometryType)geomType=OpenLayers.Geometry.MultiPoint;else if("point"!=this.geometryType&&"polygon"!=this.geometryType)return null;for(var flatPoints=this.decodeDeltas(encoded,2),flatPointsLength=flatPoints.length,pointGeometries=[],i=0;flatPointsLength>i+1;){var y=flatPoints[i++],x=flatPoints[i++];pointGeometries.push(new OpenLayers.Geometry.Point(x,y))}return"point"==this.geometryType?new OpenLayers.Feature.Vector(pointGeometries[0]):"polygon"==this.geometryType?new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(pointGeometries)])):new OpenLayers.Feature.Vector(new geomType(pointGeometries))},decode:function(encoded,dims,opt_factor){for(var factor=opt_factor||1e5,flatPoints=this.decodeDeltas(encoded,dims,factor),flatPointsLength=flatPoints.length,points=[],i=0;flatPointsLength>i+(dims-1);){for(var point=[],dim=0;dims>dim;++dim)point.push(flatPoints[i++]);points.push(point)}return points},write:function(features){var feature;feature=features.constructor==Array?features[0]:features;var pointGeometries,geometry=feature.geometry,type=geometry.CLASS_NAME.split(".")[2].toLowerCase();if("point"==type)pointGeometries=new Array(geometry);else if("linestring"==type||"linearring"==type||"multipoint"==type)pointGeometries=geometry.components;else{if("polygon"!=type)return null;pointGeometries=geometry.components[0].components}for(var flatPoints=[],pointGeometriesLength=pointGeometries.length,i=0;pointGeometriesLength>i;++i){var pointGeometry=pointGeometries[i];flatPoints.push(pointGeometry.y),flatPoints.push(pointGeometry.x)}return this.encodeDeltas(flatPoints,2)},encode:function(points,dims,opt_factor){for(var factor=opt_factor||1e5,flatPoints=[],pointsLength=points.length,i=0;pointsLength>i;++i)for(var point=points[i],dim=0;dims>dim;++dim)flatPoints.push(point[dim]);return this.encodeDeltas(flatPoints,dims,factor)},encodeDeltas:function(numbers,dimension,opt_factor){var d,factor=opt_factor||1e5,lastNumbers=new Array(dimension);for(d=0;dimension>d;++d)lastNumbers[d]=0;for(var numbersLength=numbers.length,i=0;numbersLength>i;)for(d=0;dimension>d;++d,++i){var num=numbers[i],delta=num-lastNumbers[d];lastNumbers[d]=num,numbers[i]=delta}return this.encodeFloats(numbers,factor)},decodeDeltas:function(encoded,dimension,opt_factor){var d,factor=opt_factor||1e5,lastNumbers=new Array(dimension);for(d=0;dimension>d;++d)lastNumbers[d]=0;for(var numbers=this.decodeFloats(encoded,factor),numbersLength=numbers.length,i=0;numbersLength>i;)for(d=0;dimension>d;++d,++i)lastNumbers[d]+=numbers[i],numbers[i]=lastNumbers[d];return numbers},encodeFloats:function(numbers,opt_factor){for(var factor=opt_factor||1e5,numbersLength=numbers.length,i=0;numbersLength>i;++i)numbers[i]=Math.round(numbers[i]*factor);return this.encodeSignedIntegers(numbers)},decodeFloats:function(encoded,opt_factor){for(var factor=opt_factor||1e5,numbers=this.decodeSignedIntegers(encoded),numbersLength=numbers.length,i=0;numbersLength>i;++i)numbers[i]/=factor;return numbers},encodeSignedIntegers:function(numbers){for(var numbersLength=numbers.length,i=0;numbersLength>i;++i){var num=numbers[i],signedNum=num<<1;0>num&&(signedNum=~signedNum),numbers[i]=signedNum}return this.encodeUnsignedIntegers(numbers)},decodeSignedIntegers:function(encoded){for(var numbers=this.decodeUnsignedIntegers(encoded),numbersLength=numbers.length,i=0;numbersLength>i;++i){var num=numbers[i];numbers[i]=1&num?~(num>>1):num>>1}return numbers},encodeUnsignedIntegers:function(numbers){for(var encoded="",numbersLength=numbers.length,i=0;numbersLength>i;++i)encoded+=this.encodeUnsignedInteger(numbers[i]);return encoded},decodeUnsignedIntegers:function(encoded){for(var numbers=[],current=0,shift=0,encodedLength=encoded.length,i=0;encodedLength>i;++i){var b=encoded.charCodeAt(i)-63;current|=(31&b)<<shift,32>b?(numbers.push(current),current=0,shift=0):shift+=5}return numbers},encodeFloat:function(num,opt_factor){return num=Math.round(num*(opt_factor||1e5)),this.encodeSignedInteger(num)},decodeFloat:function(encoded,opt_factor){var result=this.decodeSignedInteger(encoded);return result/(opt_factor||1e5)},encodeSignedInteger:function(num){var signedNum=num<<1;return 0>num&&(signedNum=~signedNum),this.encodeUnsignedInteger(signedNum)},decodeSignedInteger:function(encoded){var result=this.decodeUnsignedInteger(encoded);return 1&result?~(result>>1):result>>1},encodeUnsignedInteger:function(num){for(var value,encoded="";num>=32;)value=(32|31&num)+63,encoded+=String.fromCharCode(value),num>>=5;return value=num+63,encoded+=String.fromCharCode(value)},decodeUnsignedInteger:function(encoded){for(var result=0,shift=0,encodedLength=encoded.length,i=0;encodedLength>i;++i){var b=encoded.charCodeAt(i)-63;if(result|=(31&b)<<shift,32>b)break;shift+=5}return result},CLASS_NAME:"OpenLayers.Format.EncodedPolyline"}),OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var ctl,i=this.controls.length-1;i>=0;i--)ctl=this.controls[i],ctl.events&&ctl.events.un({activate:this.iconOn,deactivate:this.iconOff}),ctl.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var control,i=0,len=this.controls.length;len>i;i++)control=this.controls[i],(control===this.defaultControl||this.saveState&&this.activeState[control.id])&&control.activate();return this.saveState===!0&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var control,i=0,len=this.controls.length;len>i;i++)control=this.controls[i],this.activeState[control.id]=control.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var l=this.div.childNodes.length,i=l-1;i>=0;i--)this.div.removeChild(this.div.childNodes[i]);if(this.div.innerHTML="",this.active)for(var i=0,len=this.controls.length;len>i;i++)this.div.appendChild(this.controls[i].panel_div)},activateControl:function(control){if(!this.active)return!1;if(control.type==OpenLayers.Control.TYPE_BUTTON)return void control.trigger();if(control.type==OpenLayers.Control.TYPE_TOGGLE)return void(control.active?control.deactivate():control.activate());if(this.allowDepress&&control.active)control.deactivate();else{for(var c,i=0,len=this.controls.length;len>i;i++)c=this.controls[i],c==control||c.type!==OpenLayers.Control.TYPE_TOOL&&null!=c.type||c.deactivate();control.activate()}},addControls:function(controls){OpenLayers.Util.isArray(controls)||(controls=[controls]),this.controls=this.controls.concat(controls);for(var i=0,len=controls.length;len>i;i++){var control=controls[i],element=this.createControlMarkup(control);OpenLayers.Element.addClass(element,control.displayClass+"ItemInactive"),OpenLayers.Element.addClass(element,"olButton"),""==control.title||element.title||(element.title=control.title),control.panel_div=element}this.map&&(this.addControlsToMap(controls),this.redraw())},createControlMarkup:function(control){return document.createElement("div")},addControlsToMap:function(controls){for(var control,i=0,len=controls.length;len>i;i++)control=controls[i],control.autoActivate===!0?(control.autoActivate=!1,this.map.addControl(control),control.autoActivate=!0):(this.map.addControl(control),control.deactivate()),control.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var d=this.panel_div,re=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");d.className=d.className.replace(re,"$1Active")},iconOff:function(){var d=this.panel_div,re=new RegExp("\\b("+this.displayClass+"Item)Active\\b");d.className=d.className.replace(re,"$1Inactive")},onButtonClick:function(evt){for(var controls=this.controls,button=evt.buttonElement,i=controls.length-1;i>=0;--i)if(controls[i].panel_div===button){this.activateControl(controls[i]);break}},getControlsBy:function(property,match){var test="function"==typeof match.test,found=OpenLayers.Array.filter(this.controls,function(item){return item[property]==match||test&&match.test(item[property])});return found},getControlsByName:function(match){return this.getControlsBy("name",match)},getControlsByClass:function(match){return this.getControlsBy("CLASS_NAME",match)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(name,url,params,options){OpenLayers.Layer.prototype.initialize.apply(this,[name,options]),this.url=url,this.params||(this.params=OpenLayers.Util.extend({},params))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.prototype.clone.apply(this,[obj])},setUrl:function(newUrl){this.url=newUrl},mergeNewParams:function(newParams){this.params=OpenLayers.Util.extend(this.params,newParams);var ret=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),ret},redraw:function(force){return force?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(paramString,urls){for(var product=1,i=0,len=paramString.length;len>i;i++)product*=paramString.charCodeAt(i)*this.URL_HASH_FACTOR,product-=Math.floor(product);return urls[Math.floor(product*urls.length)]},getFullRequestString:function(newParams,altUrl){var url=altUrl||this.url,allParams=OpenLayers.Util.extend({},this.params);allParams=OpenLayers.Util.extend(allParams,newParams);var paramsString=OpenLayers.Util.getParameterString(allParams);OpenLayers.Util.isArray(url)&&(url=this.selectUrl(paramsString,url));var urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));for(var key in allParams)key.toUpperCase()in urlParams&&delete allParams[key];return paramsString=OpenLayers.Util.getParameterString(allParams),OpenLayers.Util.urlAppend(url,paramsString);
},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(layer,position,bounds,url,size,options){this.layer=layer,this.position=position.clone(),this.setBounds(bounds),this.url=url,size&&(this.size=size.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,options),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(force){force||this.clear();var draw=this.shouldDraw();return draw&&!force&&this.events.triggerEvent("beforedraw")===!1&&(draw=null),draw},shouldDraw:function(){var withinMaxExtent=!1,maxExtent=this.layer.maxExtent;if(maxExtent){var map=this.layer.map,worldBounds=map.baseLayer.wrapDateLine&&map.getMaxExtent();this.bounds.intersectsBounds(maxExtent,{inclusive:!1,worldBounds:worldBounds})&&(withinMaxExtent=!0)}return withinMaxExtent||this.layer.displayOutsideMaxExtent},setBounds:function(bounds){if(bounds=bounds.clone(),this.layer.map.baseLayer.wrapDateLine){var worldExtent=this.layer.map.getMaxExtent(),tolerance=this.layer.map.getResolution();bounds=bounds.wrapDateLine(worldExtent,{leftTolerance:tolerance,rightTolerance:tolerance})}this.bounds=bounds},moveTo:function(bounds,position,redraw){null==redraw&&(redraw=!0),this.setBounds(bounds),this.position=position.clone(),redraw&&this.draw()},clear:function(draw){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(layer,position,bounds,url,size,options){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=url,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var shouldDraw=OpenLayers.Tile.prototype.draw.apply(this,arguments);return shouldDraw?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):shouldDraw===!1&&this.unload(),shouldDraw},renderTile:function(){if(this.layer.async){var id=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(url){id==this.asyncRequestId&&(this.url=url,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var style=this.getTile().style,size=this.frame?this.size:this.layer.getImageSize(this.bounds),ratio=1;this.layer instanceof OpenLayers.Layer.Grid&&(ratio=this.layer.getServerResolution()/this.layer.map.getResolution()),style.left=this.position.x+"px",style.top=this.position.y+"px",style.width=Math.round(ratio*size.w)+"px",style.height=Math.round(ratio*size.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var img=this.imgDiv;if(img){var tile=this.getTile();tile.parentNode===this.layer.div&&this.layer.div.removeChild(tile),this.setImgSrc(),this.layerAlphaHack===!0&&(img.style.filter=""),OpenLayers.Element.removeClass(img,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var style=this.imgDiv.style;if(this.frame){var left=0,top=0;this.layer.gutter&&(left=this.layer.gutter/this.layer.tileSize.w*100,top=this.layer.gutter/this.layer.tileSize.h*100),style.left=-left+"%",style.top=-top+"%",style.width=2*left+100+"%",style.height=2*top+100+"%"}style.visibility="hidden",style.opacity=0,this.layer.opacity<1&&(style.filter="alpha(opacity="+100*this.layer.opacity+")"),style.position="absolute",this.layerAlphaHack&&(style.paddingTop=style.height,style.height="0",style.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(img){this.imgDiv=img},initImage:function(){if(!this.url&&!this.imgDiv)return void(this.isLoading=!1);this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var img=this.getImage(),src=img.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(src,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&img.removeAttribute("crossorigin"),OpenLayers.Event.observe(img,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(img,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(url){var img=this.imgDiv;url?(img.style.visibility="hidden",img.style.opacity=0,this.crossOriginKeyword&&("data:"!==url.substr(0,5)?img.setAttribute("crossorigin",this.crossOriginKeyword):img.removeAttribute("crossorigin")),img.src=url):(this.stopLoading(),this.imgDiv=null,img.parentNode&&img.parentNode.removeChild(img))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var backBuffer;return this.frame?(backBuffer=this.frame.cloneNode(!1),backBuffer.appendChild(this.imgDiv)):backBuffer=this.imgDiv,this.imgDiv=null,backBuffer}},onImageLoad:function(){var img=this.imgDiv;this.stopLoading(),img.style.visibility="inherit",img.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),this.layerAlphaHack===!0&&(img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='scale')")},onImageError:function(){var img=this.imgDiv;null!=img.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(img,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var canvas=document.createElement("canvas");canvas.width=this.size.w,canvas.height=this.size.h,this.canvasContext=canvas.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var img=new Image;return img.className="olTileImage",img.galleryImg="no",img}(),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(name,url,params,options){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(map){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,map),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(map){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var iRow=0,len=this.grid.length;len>iRow;iRow++)for(var row=this.grid[iRow],iCol=0,clen=row.length;clen>iCol;iCol++){var tile=row[iCol];this.destroyTile(tile)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(newOptions,reinitialize){var singleTileChanged=void 0!==newOptions.singleTile&&newOptions.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&singleTileChanged&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[obj]),null!=this.tileSize&&(obj.tileSize=this.tileSize.clone()),obj.grid=[],obj.gridResolution=null,obj.backBuffer=null,obj.backBufferTimerId=null,obj.loading=!1,obj.numLoadingTiles=0,obj},moveTo:function(bounds,zoomChanged,dragging){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),bounds=bounds||this.map.getExtent(),null!=bounds){var forceReTile=!this.grid.length||zoomChanged,tilesBounds=this.getTilesBounds(),resolution=this.map.getResolution();this.getServerResolution(resolution);this.singleTile?(forceReTile||!dragging&&!tilesBounds.containsBounds(bounds))&&(zoomChanged&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),zoomChanged&&"resize"!==this.transitionEffect||this.applyBackBuffer(resolution),this.initSingleTile(bounds)):(forceReTile=forceReTile||!tilesBounds.intersectsBounds(bounds,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),forceReTile?(!zoomChanged||"resize"!==this.transitionEffect&&this.gridResolution!==resolution||this.applyBackBuffer(resolution),this.initGriddedTiles(bounds)):this.moveGriddedTiles())}},getTileData:function(loc){var data=null,x=loc.lon,y=loc.lat,numRows=this.grid.length;if(this.map&&numRows){var res=this.map.getResolution(),tileWidth=this.tileSize.w,tileHeight=this.tileSize.h,bounds=this.grid[0][0].bounds,left=bounds.left,top=bounds.top;if(left>x&&this.map.baseLayer.wrapDateLine){var worldWidth=this.map.getMaxExtent().getWidth(),worldsAway=Math.ceil((left-x)/worldWidth);x+=worldWidth*worldsAway}var dtx=(x-left)/(res*tileWidth),dty=(top-y)/(res*tileHeight),col=Math.floor(dtx),row=Math.floor(dty);if(row>=0&&numRows>row){var tile=this.grid[row][col];tile&&(data={tile:tile,i:Math.floor((dtx-col)*tileWidth),j:Math.floor((dty-row)*tileHeight)})}}return data},destroyTile:function(tile){this.removeTileMonitoringHooks(tile),tile.destroy()},getServerResolution:function(resolution){var distance=Number.POSITIVE_INFINITY;if(resolution=resolution||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,resolution)){var i,newDistance,newResolution,serverResolution;for(i=this.serverResolutions.length-1;i>=0&&(newResolution=this.serverResolutions[i],newDistance=Math.abs(newResolution-resolution),!(newDistance>distance));i--)distance=newDistance,serverResolution=newResolution;resolution=serverResolution}return resolution},getServerZoom:function(){var resolution=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,resolution):this.map.getZoomForResolution(resolution)+(this.zoomOffset||0)},applyBackBuffer:function(resolution){null!==this.backBufferTimerId&&this.removeBackBuffer();var backBuffer=this.backBuffer;if(!backBuffer){if(backBuffer=this.createBackBuffer(),!backBuffer)return;resolution===this.gridResolution?this.div.insertBefore(backBuffer,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(backBuffer,this.map.baseLayer.div),this.backBuffer=backBuffer;var topLeftTileBounds=this.grid[0][0].bounds;this.backBufferLonLat={lon:topLeftTileBounds.left,lat:topLeftTileBounds.top},this.backBufferResolution=this.gridResolution}for(var tile,ratio=this.backBufferResolution/resolution,tiles=backBuffer.childNodes,i=tiles.length-1;i>=0;--i)tile=tiles[i],tile.style.top=(ratio*tile._i*tile._h|0)+"px",tile.style.left=(ratio*tile._j*tile._w|0)+"px",tile.style.width=Math.round(ratio*tile._w)+"px",tile.style.height=Math.round(ratio*tile._h)+"px";var position=this.getViewPortPxFromLonLat(this.backBufferLonLat,resolution),leftOffset=this.map.layerContainerOriginPx.x,topOffset=this.map.layerContainerOriginPx.y;backBuffer.style.left=Math.round(position.x-leftOffset)+"px",backBuffer.style.top=Math.round(position.y-topOffset)+"px"},createBackBuffer:function(){var backBuffer;if(this.grid.length>0){backBuffer=document.createElement("div"),backBuffer.id=this.div.id+"_bb",backBuffer.className="olBackBuffer",backBuffer.style.position="absolute";var map=this.map;backBuffer.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:map.Z_INDEX_BASE.BaseLayer-(map.getNumLayers()-map.getLayerIndex(this));for(var i=0,lenI=this.grid.length;lenI>i;i++)for(var j=0,lenJ=this.grid[i].length;lenJ>j;j++){var tile=this.grid[i][j],markup=this.grid[i][j].createBackBuffer();markup&&(markup._i=i,markup._j=j,markup._w=tile.size.w,markup._h=tile.size.h,markup.id=tile.id+"_bb",backBuffer.appendChild(markup))}}return backBuffer},removeBackBuffer:function(){if(this._transitionElement){for(var i=this.transitionendEvents.length-1;i>=0;--i)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[i],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(dx,dy){this.singleTile||this.moveGriddedTiles()},setTileSize:function(size){this.singleTile&&(size=this.map.getSize(),size.h=parseInt(size.h*this.ratio,10),size.w=parseInt(size.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[size])},getTilesBounds:function(){var bounds=null,length=this.grid.length;if(length){var bottomLeftTileBounds=this.grid[length-1][0].bounds,width=this.grid[0].length*bottomLeftTileBounds.getWidth(),height=this.grid.length*bottomLeftTileBounds.getHeight();bounds=new OpenLayers.Bounds(bottomLeftTileBounds.left,bottomLeftTileBounds.bottom,bottomLeftTileBounds.left+width,bottomLeftTileBounds.bottom+height)}return bounds},initSingleTile:function(bounds){this.events.triggerEvent("retile");var center=bounds.getCenterLonLat(),tileWidth=bounds.getWidth()*this.ratio,tileHeight=bounds.getHeight()*this.ratio,tileBounds=new OpenLayers.Bounds(center.lon-tileWidth/2,center.lat-tileHeight/2,center.lon+tileWidth/2,center.lat+tileHeight/2),px=this.map.getLayerPxFromLonLat({lon:tileBounds.left,lat:tileBounds.top});this.grid.length||(this.grid[0]=[]);var tile=this.grid[0][0];tile?tile.moveTo(tileBounds,px):(tile=this.addTile(tileBounds,px),this.addTileMonitoringHooks(tile),tile.draw(),this.grid[0][0]=tile),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w,tilelat=resolution*this.tileSize.h,offsetlon=bounds.left-origin.lon,tilecol=Math.floor(offsetlon/tilelon)-this.buffer,rowSign=this.rowSign,offsetlat=rowSign*(origin.lat-bounds.top+tilelat),tilerow=Math[~rowSign?"floor":"ceil"](offsetlat/tilelat)-this.buffer*rowSign;return{tilelon:tilelon,tilelat:tilelat,startcol:tilecol,startrow:tilerow}},getTileOrigin:function(){var origin=this.tileOrigin;if(!origin){var extent=this.getMaxExtent(),edges={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];origin=new OpenLayers.LonLat(extent[edges[0]],extent[edges[1]])}return origin},getTileBoundsForGridIndex:function(row,col){var origin=this.getTileOrigin(),tileLayout=this.gridLayout,tilelon=tileLayout.tilelon,tilelat=tileLayout.tilelat,startcol=tileLayout.startcol,startrow=tileLayout.startrow,rowSign=this.rowSign;return new OpenLayers.Bounds(origin.lon+(startcol+col)*tilelon,origin.lat-(startrow+row*rowSign)*tilelat*rowSign,origin.lon+(startcol+col+1)*tilelon,origin.lat-(startrow+(row-1)*rowSign)*tilelat*rowSign)},initGriddedTiles:function(bounds){this.events.triggerEvent("retile");var viewSize=this.map.getSize(),origin=this.getTileOrigin(),resolution=this.map.getResolution(),serverResolution=this.getServerResolution(),ratio=resolution/serverResolution,tileSize={w:this.tileSize.w/ratio,h:this.tileSize.h/ratio},minRows=Math.ceil(viewSize.h/tileSize.h)+2*this.buffer+1,minCols=Math.ceil(viewSize.w/tileSize.w)+2*this.buffer+1,tileLayout=this.calculateGridLayout(bounds,origin,serverResolution);this.gridLayout=tileLayout;var tilelon=tileLayout.tilelon,tilelat=tileLayout.tilelat,layerContainerDivLeft=this.map.layerContainerOriginPx.x,layerContainerDivTop=this.map.layerContainerOriginPx.y,tileBounds=this.getTileBoundsForGridIndex(0,0),startPx=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(tileBounds.left,tileBounds.top));startPx.x=Math.round(startPx.x)-layerContainerDivLeft,startPx.y=Math.round(startPx.y)-layerContainerDivTop;var tileData=[],center=this.map.getCenter(),rowidx=0;do{var row=this.grid[rowidx];row||(row=[],this.grid.push(row));var colidx=0;do{tileBounds=this.getTileBoundsForGridIndex(rowidx,colidx);var px=startPx.clone();px.x=px.x+colidx*Math.round(tileSize.w),px.y=px.y+rowidx*Math.round(tileSize.h);var tile=row[colidx];tile?tile.moveTo(tileBounds,px,!1):(tile=this.addTile(tileBounds,px),this.addTileMonitoringHooks(tile),row.push(tile));var tileCenter=tileBounds.getCenterLonLat();tileData.push({tile:tile,distance:Math.pow(tileCenter.lon-center.lon,2)+Math.pow(tileCenter.lat-center.lat,2)}),colidx+=1}while(tileBounds.right<=bounds.right+tilelon*this.buffer||minCols>colidx);rowidx+=1}while(tileBounds.bottom>=bounds.bottom-tilelat*this.buffer||minRows>rowidx);this.removeExcessTiles(rowidx,colidx);var resolution=this.getServerResolution();this.gridResolution=resolution,tileData.sort(function(a,b){return a.distance-b.distance});for(var i=0,ii=tileData.length;ii>i;++i)tileData[i].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(bounds,position){var tile=new this.tileClass(this,position,bounds,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:tile}),tile},addTileMonitoringHooks:function(tile){var replacingCls="olTileReplacing";tile.onLoadStart=function(){this.loading===!1&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:tile}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(tile.getTile(),replacingCls)},tile.onLoadEnd=function(evt){this.numLoadingTiles--;var aborted="unload"===evt.type;if(this.events.triggerEvent("tileloaded",{tile:tile,aborted:aborted}),!this.singleTile&&!aborted&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var tileDiv=tile.getTile();if("none"===OpenLayers.Element.getStyle(tileDiv,"display")){var bufferTile=document.getElementById(tile.id+"_bb");bufferTile&&bufferTile.parentNode.removeChild(bufferTile)}OpenLayers.Element.removeClass(tileDiv,replacingCls)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=aborted?this.div.lastChild:tile.imgDiv;for(var transitionendEvents=this.transitionendEvents,i=transitionendEvents.length-1;i>=0;--i)OpenLayers.Event.observe(this._transitionElement,transitionendEvents[i],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},tile.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:tile})},tile.events.on({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,loaderror:tile.onLoadError,scope:this})},removeTileMonitoringHooks:function(tile){tile.unload(),tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,loaderror:tile.onLoadError,scope:this})},moveGriddedTiles:function(){for(var buffer=this.buffer+1;;){var tlTile=this.grid[0][0],tlViewPort={x:tlTile.position.x+this.map.layerContainerOriginPx.x,y:tlTile.position.y+this.map.layerContainerOriginPx.y},ratio=this.getServerResolution()/this.map.getResolution(),tileSize={w:Math.round(this.tileSize.w*ratio),h:Math.round(this.tileSize.h*ratio)};if(tlViewPort.x>-tileSize.w*(buffer-1))this.shiftColumn(!0,tileSize);else if(tlViewPort.x<-tileSize.w*buffer)this.shiftColumn(!1,tileSize);else if(tlViewPort.y>-tileSize.h*(buffer-1))this.shiftRow(!0,tileSize);else{if(!(tlViewPort.y<-tileSize.h*buffer))break;this.shiftRow(!1,tileSize)}}},shiftRow:function(prepend,tileSize){var grid=this.grid,rowIndex=prepend?0:grid.length-1,sign=prepend?-1:1,rowSign=this.rowSign,tileLayout=this.gridLayout;tileLayout.startrow+=sign*rowSign;for(var modelRow=grid[rowIndex],row=grid[prepend?"pop":"shift"](),i=0,len=row.length;len>i;i++){var tile=row[i],position=modelRow[i].position.clone();position.y+=tileSize.h*sign,tile.moveTo(this.getTileBoundsForGridIndex(rowIndex,i),position)}grid[prepend?"unshift":"push"](row)},shiftColumn:function(prepend,tileSize){var grid=this.grid,colIndex=prepend?0:grid[0].length-1,sign=prepend?-1:1,tileLayout=this.gridLayout;tileLayout.startcol+=sign;for(var i=0,len=grid.length;len>i;i++){var row=grid[i],position=row[colIndex].position.clone(),tile=row[prepend?"pop":"shift"]();position.x+=tileSize.w*sign,tile.moveTo(this.getTileBoundsForGridIndex(i,colIndex),position),row[prepend?"unshift":"push"](tile)}},removeExcessTiles:function(rows,columns){for(var i,l;this.grid.length>rows;){var row=this.grid.pop();for(i=0,l=row.length;l>i;i++){var tile=row[i];this.destroyTile(tile)}}for(i=0,l=this.grid.length;l>i;i++)for(;this.grid[i].length>columns;){var row=this.grid[i],tile=row.pop();this.destroyTile(tile)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(viewPortPx){var maxExtent=this.maxExtent,resolution=this.getResolution(),tileMapWidth=resolution*this.tileSize.w,tileMapHeight=resolution*this.tileSize.h,mapPoint=this.getLonLatFromViewPortPx(viewPortPx),tileLeft=maxExtent.left+tileMapWidth*Math.floor((mapPoint.lon-maxExtent.left)/tileMapWidth),tileBottom=maxExtent.bottom+tileMapHeight*Math.floor((mapPoint.lat-maxExtent.bottom)/tileMapHeight);return new OpenLayers.Bounds(tileLeft,tileBottom,tileLeft+tileMapWidth,tileBottom+tileMapHeight)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(options){if(this.request=new OpenLayers.Format.ArcXML.Request,this.response=new OpenLayers.Format.ArcXML.Response,options)if("feature"==options.requesttype){this.request.get_image=null;var qry=this.request.get_feature.query;this.addCoordSys(qry.featurecoordsys,options.featureCoordSys),this.addCoordSys(qry.filtercoordsys,options.filterCoordSys),options.polygon?(qry.isspatial=!0,qry.spatialfilter.polygon=options.polygon):options.envelope&&(qry.isspatial=!0,qry.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(qry.spatialfilter.envelope,options.envelope))}else if("image"==options.requesttype){this.request.get_feature=null;var props=this.request.get_image.properties;this.parseEnvelope(props.envelope,options.envelope),this.addLayers(props.layerlist,options.layers),this.addImageSize(props.imagesize,options.tileSize),this.addCoordSys(props.featurecoordsys,options.featureCoordSys),this.addCoordSys(props.filtercoordsys,options.filterCoordSys)}else this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},parseEnvelope:function(env,arr){arr&&4==arr.length&&(env.minx=arr[0],env.miny=arr[1],env.maxx=arr[2],env.maxy=arr[3])},addLayers:function(ll,lyrs){for(var lind=0,len=lyrs.length;len>lind;lind++)ll.push(lyrs[lind])},addImageSize:function(imsize,olsize){null!==olsize&&(imsize.width=olsize.w,imsize.height=olsize.h,imsize.printwidth=olsize.w,imsize.printheight=olsize.h)},addCoordSys:function(featOrFilt,fsys){"string"==typeof fsys?(featOrFilt.id=parseInt(fsys),featOrFilt.string=fsys):"object"==typeof fsys&&null!==fsys.proj?(featOrFilt.id=fsys.proj.srsProjNumber,featOrFilt.string=fsys.proj.srsCode):featOrFilt=fsys},iserror:function(data){var ret=null;if(data){data=OpenLayers.Format.XML.prototype.read.apply(this,[data]);var errorNodes=data.documentElement.getElementsByTagName("ERROR");ret=null!==errorNodes&&errorNodes.length>0}else ret=""!==this.response.error;return ret},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));var arcNode=null;if(data&&data.documentElement&&(arcNode="ARCXML"==data.documentElement.nodeName?data.documentElement:data.documentElement.getElementsByTagName("ARCXML")[0]),!arcNode||"parsererror"===arcNode.firstChild.nodeName){var error,source;try{error=data.firstChild.nodeValue,source=data.firstChild.childNodes[1].firstChild.nodeValue}catch(err){}throw{message:"Error parsing the ArcXML request",error:error,source:source}}var response=this.parseResponse(arcNode);return response},write:function(request){request||(request=this.request);var root=this.createElementNS("","ARCXML");root.setAttribute("version","1.1");var reqElem=this.createElementNS("","REQUEST");if(null!=request.get_image){var getElem=this.createElementNS("","GET_IMAGE");reqElem.appendChild(getElem);var propElem=this.createElementNS("","PROPERTIES");getElem.appendChild(propElem);var props=request.get_image.properties;if(null!=props.featurecoordsys){var feat=this.createElementNS("","FEATURECOORDSYS");propElem.appendChild(feat),0===props.featurecoordsys.id?feat.setAttribute("string",props.featurecoordsys.string):feat.setAttribute("id",props.featurecoordsys.id)}if(null!=props.filtercoordsys){var filt=this.createElementNS("","FILTERCOORDSYS");propElem.appendChild(filt),0===props.filtercoordsys.id?filt.setAttribute("string",props.filtercoordsys.string):filt.setAttribute("id",props.filtercoordsys.id)}if(null!=props.envelope){var env=this.createElementNS("","ENVELOPE");propElem.appendChild(env),env.setAttribute("minx",props.envelope.minx),env.setAttribute("miny",props.envelope.miny),env.setAttribute("maxx",props.envelope.maxx),env.setAttribute("maxy",props.envelope.maxy)}var imagesz=this.createElementNS("","IMAGESIZE");if(propElem.appendChild(imagesz),imagesz.setAttribute("height",props.imagesize.height),imagesz.setAttribute("width",props.imagesize.width),(props.imagesize.height!=props.imagesize.printheight||props.imagesize.width!=props.imagesize.printwidth)&&(imagesz.setAttribute("printheight",props.imagesize.printheight),imagesz.setArrtibute("printwidth",props.imagesize.printwidth)),null!=props.background){var backgrnd=this.createElementNS("","BACKGROUND");propElem.appendChild(backgrnd),backgrnd.setAttribute("color",props.background.color.r+","+props.background.color.g+","+props.background.color.b),null!==props.background.transcolor&&backgrnd.setAttribute("transcolor",props.background.transcolor.r+","+props.background.transcolor.g+","+props.background.transcolor.b)}if(null!=props.layerlist&&props.layerlist.length>0){var layerlst=this.createElementNS("","LAYERLIST");propElem.appendChild(layerlst);for(var ld=0;ld<props.layerlist.length;ld++){var ldef=this.createElementNS("","LAYERDEF");if(layerlst.appendChild(ldef),ldef.setAttribute("id",props.layerlist[ld].id),ldef.setAttribute("visible",props.layerlist[ld].visible),"object"==typeof props.layerlist[ld].query){var query=props.layerlist[ld].query;if(query.where.length<0)continue;var queryElem=null;queryElem="boolean"==typeof query.spatialfilter&&query.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),queryElem.setAttribute("where",query.where),"number"==typeof query.accuracy&&query.accuracy>0&&queryElem.setAttribute("accuracy",query.accuracy),"number"==typeof query.featurelimit&&query.featurelimit<2e3&&queryElem.setAttribute("featurelimit",query.featurelimit),"string"==typeof query.subfields&&"#ALL#"!=query.subfields&&queryElem.setAttribute("subfields",query.subfields),"string"==typeof query.joinexpression&&query.joinexpression.length>0&&queryElem.setAttribute("joinexpression",query.joinexpression),"string"==typeof query.jointables&&query.jointables.length>0&&queryElem.setAttribute("jointables",query.jointables),ldef.appendChild(queryElem)}"object"==typeof props.layerlist[ld].renderer&&this.addRenderer(ldef,props.layerlist[ld].renderer)}}}else if(null!=request.get_feature){var getElem=this.createElementNS("","GET_FEATURES");if(getElem.setAttribute("outputmode","newxml"),getElem.setAttribute("checkesc","true"),request.get_feature.geometry?getElem.setAttribute("geometry",request.get_feature.geometry):getElem.setAttribute("geometry","false"),request.get_feature.compact&&getElem.setAttribute("compact",request.get_feature.compact),"number"==request.get_feature.featurelimit&&getElem.setAttribute("featurelimit",request.get_feature.featurelimit),getElem.setAttribute("globalenvelope","true"),reqElem.appendChild(getElem),null!=request.get_feature.layer&&request.get_feature.layer.length>0){var lyrElem=this.createElementNS("","LAYER");lyrElem.setAttribute("id",request.get_feature.layer),getElem.appendChild(lyrElem)}var fquery=request.get_feature.query;if(null!=fquery){var qElem=null;if(qElem=fquery.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),getElem.appendChild(qElem),"number"==typeof fquery.accuracy&&qElem.setAttribute("accuracy",fquery.accuracy),null!=fquery.featurecoordsys){var fcsElem1=this.createElementNS("","FEATURECOORDSYS");0==fquery.featurecoordsys.id?fcsElem1.setAttribute("string",fquery.featurecoordsys.string):fcsElem1.setAttribute("id",fquery.featurecoordsys.id),qElem.appendChild(fcsElem1)}if(null!=fquery.filtercoordsys){var fcsElem2=this.createElementNS("","FILTERCOORDSYS");0===fquery.filtercoordsys.id?fcsElem2.setAttribute("string",fquery.filtercoordsys.string):fcsElem2.setAttribute("id",fquery.filtercoordsys.id),qElem.appendChild(fcsElem2)}if(fquery.buffer>0){var bufElem=this.createElementNS("","BUFFER");bufElem.setAttribute("distance",fquery.buffer),qElem.appendChild(bufElem)}if(fquery.isspatial){var spfElem=this.createElementNS("","SPATIALFILTER");if(spfElem.setAttribute("relation",fquery.spatialfilter.relation),qElem.appendChild(spfElem),fquery.spatialfilter.envelope){var envElem=this.createElementNS("","ENVELOPE");envElem.setAttribute("minx",fquery.spatialfilter.envelope.minx),envElem.setAttribute("miny",fquery.spatialfilter.envelope.miny),envElem.setAttribute("maxx",fquery.spatialfilter.envelope.maxx),envElem.setAttribute("maxy",fquery.spatialfilter.envelope.maxy),spfElem.appendChild(envElem)}else"object"==typeof fquery.spatialfilter.polygon&&spfElem.appendChild(this.writePolygonGeometry(fquery.spatialfilter.polygon));
}null!=fquery.where&&fquery.where.length>0&&qElem.setAttribute("where",fquery.where)}}return root.appendChild(reqElem),OpenLayers.Format.XML.prototype.write.apply(this,[root])},addGroupRenderer:function(ldef,toprenderer){var topRelem=this.createElementNS("","GROUPRENDERER");ldef.appendChild(topRelem);for(var rind=0;rind<toprenderer.length;rind++){var renderer=toprenderer[rind];this.addRenderer(topRelem,renderer)}},addRenderer:function(topRelem,renderer){if(OpenLayers.Util.isArray(renderer))this.addGroupRenderer(topRelem,renderer);else{var renderElem=this.createElementNS("",renderer.type.toUpperCase()+"RENDERER");topRelem.appendChild(renderElem),"VALUEMAPRENDERER"==renderElem.tagName?this.addValueMapRenderer(renderElem,renderer):"VALUEMAPLABELRENDERER"==renderElem.tagName?this.addValueMapLabelRenderer(renderElem,renderer):"SIMPLELABELRENDERER"==renderElem.tagName?this.addSimpleLabelRenderer(renderElem,renderer):"SCALEDEPENDENTRENDERER"==renderElem.tagName&&this.addScaleDependentRenderer(renderElem,renderer)}},addScaleDependentRenderer:function(renderElem,renderer){("string"==typeof renderer.lower||"number"==typeof renderer.lower)&&renderElem.setAttribute("lower",renderer.lower),("string"==typeof renderer.upper||"number"==typeof renderer.upper)&&renderElem.setAttribute("upper",renderer.upper),this.addRenderer(renderElem,renderer.renderer)},addValueMapLabelRenderer:function(renderElem,renderer){if(renderElem.setAttribute("lookupfield",renderer.lookupfield),renderElem.setAttribute("labelfield",renderer.labelfield),"object"==typeof renderer.exacts)for(var ext=0,extlen=renderer.exacts.length;extlen>ext;ext++){var exact=renderer.exacts[ext],eelem=this.createElementNS("","EXACT");if("string"==typeof exact.value&&eelem.setAttribute("value",exact.value),"string"==typeof exact.label&&eelem.setAttribute("label",exact.label),"string"==typeof exact.method&&eelem.setAttribute("method",exact.method),renderElem.appendChild(eelem),"object"==typeof exact.symbol){var selem=null;if("text"==exact.symbol.type&&(selem=this.createElementNS("","TEXTSYMBOL")),null!=selem){for(var keys=this.fontStyleKeys,i=0,len=keys.length;len>i;i++){var key=keys[i];exact.symbol[key]&&selem.setAttribute(key,exact.symbol[key])}eelem.appendChild(selem)}}}},addValueMapRenderer:function(renderElem,renderer){if(renderElem.setAttribute("lookupfield",renderer.lookupfield),"object"==typeof renderer.ranges)for(var rng=0,rnglen=renderer.ranges.length;rnglen>rng;rng++){var range=renderer.ranges[rng],relem=this.createElementNS("","RANGE");if(relem.setAttribute("lower",range.lower),relem.setAttribute("upper",range.upper),renderElem.appendChild(relem),"object"==typeof range.symbol){var selem=null;"simplepolygon"==range.symbol.type&&(selem=this.createElementNS("","SIMPLEPOLYGONSYMBOL")),null!=selem&&("string"==typeof range.symbol.boundarycolor&&selem.setAttribute("boundarycolor",range.symbol.boundarycolor),"string"==typeof range.symbol.fillcolor&&selem.setAttribute("fillcolor",range.symbol.fillcolor),"number"==typeof range.symbol.filltransparency&&selem.setAttribute("filltransparency",range.symbol.filltransparency),relem.appendChild(selem))}}else if("object"==typeof renderer.exacts)for(var ext=0,extlen=renderer.exacts.length;extlen>ext;ext++){var exact=renderer.exacts[ext],eelem=this.createElementNS("","EXACT");if("string"==typeof exact.value&&eelem.setAttribute("value",exact.value),"string"==typeof exact.label&&eelem.setAttribute("label",exact.label),"string"==typeof exact.method&&eelem.setAttribute("method",exact.method),renderElem.appendChild(eelem),"object"==typeof exact.symbol){var selem=null;"simplemarker"==exact.symbol.type&&(selem=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=selem&&("string"==typeof exact.symbol.antialiasing&&selem.setAttribute("antialiasing",exact.symbol.antialiasing),"string"==typeof exact.symbol.color&&selem.setAttribute("color",exact.symbol.color),"string"==typeof exact.symbol.outline&&selem.setAttribute("outline",exact.symbol.outline),"string"==typeof exact.symbol.overlap&&selem.setAttribute("overlap",exact.symbol.overlap),"string"==typeof exact.symbol.shadow&&selem.setAttribute("shadow",exact.symbol.shadow),"number"==typeof exact.symbol.transparency&&selem.setAttribute("transparency",exact.symbol.transparency),"string"==typeof exact.symbol.usecentroid&&selem.setAttribute("usecentroid",exact.symbol.usecentroid),"number"==typeof exact.symbol.width&&selem.setAttribute("width",exact.symbol.width),eelem.appendChild(selem))}}},addSimpleLabelRenderer:function(renderElem,renderer){renderElem.setAttribute("field",renderer.field);for(var keys=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"],i=0,len=keys.length;len>i;i++){var key=keys[i];renderer[key]&&renderElem.setAttribute(key,renderer[key])}if("text"==renderer.symbol.type){var symbol=renderer.symbol,selem=this.createElementNS("","TEXTSYMBOL");renderElem.appendChild(selem);for(var keys=this.fontStyleKeys,i=0,len=keys.length;len>i;i++){var key=keys[i];symbol[key]&&selem.setAttribute(key,renderer[key])}}},writePolygonGeometry:function(polygon){if(!(polygon instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+polygon.CLASS_NAME+" object.",geometry:polygon};for(var polyElem=this.createElementNS("","POLYGON"),ln=0,lnlen=polygon.components.length;lnlen>ln;ln++){for(var ring=polygon.components[ln],ringElem=this.createElementNS("","RING"),rn=0,rnlen=ring.components.length;rnlen>rn;rn++){var point=ring.components[rn],pointElem=this.createElementNS("","POINT");pointElem.setAttribute("x",point.x),pointElem.setAttribute("y",point.y),ringElem.appendChild(pointElem)}polyElem.appendChild(ringElem)}return polyElem},parseResponse:function(data){if("string"==typeof data){var newData=new OpenLayers.Format.XML;data=newData.read(data)}var response=new OpenLayers.Format.ArcXML.Response,errorNode=data.getElementsByTagName("ERROR");if(null!=errorNode&&errorNode.length>0)response.error=this.getChildValue(errorNode,"Unknown error.");else{var responseNode=data.getElementsByTagName("RESPONSE");if(null==responseNode||0==responseNode.length)return response.error="No RESPONSE tag found in ArcXML response.",response;var rtype=responseNode[0].firstChild.nodeName;if("#text"==rtype&&(rtype=responseNode[0].firstChild.nextSibling.nodeName),"IMAGE"==rtype){var envelopeNode=data.getElementsByTagName("ENVELOPE"),outputNode=data.getElementsByTagName("OUTPUT");if(null==envelopeNode||0==envelopeNode.length)response.error="No ENVELOPE tag found in ArcXML response.";else if(null==outputNode||0==outputNode.length)response.error="No OUTPUT tag found in ArcXML response.";else{var envAttr=this.parseAttributes(envelopeNode[0]),outputAttr=this.parseAttributes(outputNode[0]);"string"==typeof outputAttr.type?response.image={envelope:envAttr,output:{type:outputAttr.type,data:this.getChildValue(outputNode[0])}}:response.image={envelope:envAttr,output:outputAttr}}}else if("FEATURES"==rtype){var features=responseNode[0].getElementsByTagName("FEATURES"),featureCount=features[0].getElementsByTagName("FEATURECOUNT");if(response.features.featurecount=featureCount[0].getAttribute("count"),response.features.featurecount>0){var envelope=features[0].getElementsByTagName("ENVELOPE");response.features.envelope=this.parseAttributes(envelope[0],"number");for(var featureList=features[0].getElementsByTagName("FEATURE"),fn=0;fn<featureList.length;fn++){for(var feature=new OpenLayers.Feature.Vector,fields=featureList[fn].getElementsByTagName("FIELD"),fdn=0;fdn<fields.length;fdn++){var fieldName=fields[fdn].getAttribute("name"),fieldValue=fields[fdn].getAttribute("value");feature.attributes[fieldName]=fieldValue}var geom=featureList[fn].getElementsByTagName("POLYGON");if(geom.length>0){for(var ring=geom[0].getElementsByTagName("RING"),polys=[],rn=0;rn<ring.length;rn++){var linearRings=[];linearRings.push(this.parsePointGeometry(ring[rn]));for(var holes=ring[rn].getElementsByTagName("HOLE"),hn=0;hn<holes.length;hn++)linearRings.push(this.parsePointGeometry(holes[hn]));holes=null,polys.push(new OpenLayers.Geometry.Polygon(linearRings)),linearRings=null}ring=null,1==polys.length?feature.geometry=polys[0]:feature.geometry=new OpenLayers.Geometry.MultiPolygon(polys)}response.features.feature.push(feature)}}}else response.error="Unidentified response type."}return response},parseAttributes:function(node,type){for(var attributes={},attr=0;attr<node.attributes.length;attr++)"number"==type?attributes[node.attributes[attr].nodeName]=parseFloat(node.attributes[attr].nodeValue):attributes[node.attributes[attr].nodeName]=node.attributes[attr].nodeValue;return attributes},parsePointGeometry:function(node){var ringPoints=[],coords=node.getElementsByTagName("COORDS");if(coords.length>0){var coordArr=this.getChildValue(coords[0]);coordArr=coordArr.split(/;/);for(var cn=0;cn<coordArr.length;cn++){var coordItems=coordArr[cn].split(/ /);ringPoints.push(new OpenLayers.Geometry.Point(coordItems[0],coordItems[1]))}coords=null}else{var point=node.getElementsByTagName("POINT");if(point.length>0)for(var pn=0;pn<point.length;pn++)ringPoints.push(new OpenLayers.Geometry.Point(parseFloat(point[pn].getAttribute("x")),parseFloat(point[pn].getAttribute("y"))));point=null}return new OpenLayers.Geometry.LinearRing(ringPoints)},CLASS_NAME:"OpenLayers.Format.ArcXML"}),OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(params){var defaults={get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,defaults)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"}),OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(params){var defaults={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,defaults)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"}),function(){function fXMLHttpRequest(){this._object=oXMLHttpRequest&&!bIE7?new oXMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function cXMLHttpRequest(){return new fXMLHttpRequest}function fXMLHttpRequest_send(oRequest){if(oRequest._object.send(oRequest._data),bGecko&&!oRequest._async)for(oRequest.readyState=cXMLHttpRequest.OPENED,fSynchronizeValues(oRequest);oRequest.readyState<cXMLHttpRequest.DONE;)if(oRequest.readyState++,fReadyStateChange(oRequest),oRequest._aborted)return}function fReadyStateChange(oRequest){cXMLHttpRequest.onreadystatechange&&cXMLHttpRequest.onreadystatechange.apply(oRequest),oRequest.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function fGetDocument(oRequest){var oDocument=oRequest.responseXML,sResponse=oRequest.responseText;return bIE&&sResponse&&oDocument&&!oDocument.documentElement&&oRequest.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(oDocument=new window.ActiveXObject("Microsoft.XMLDOM"),oDocument.async=!1,oDocument.validateOnParse=!1,oDocument.loadXML(sResponse)),oDocument&&(bIE&&0!=oDocument.parseError||!oDocument.documentElement||oDocument.documentElement&&"parsererror"==oDocument.documentElement.tagName)?null:oDocument}function fSynchronizeValues(oRequest){try{oRequest.responseText=oRequest._object.responseText}catch(e){}try{oRequest.responseXML=fGetDocument(oRequest._object)}catch(e){}try{oRequest.status=oRequest._object.status}catch(e){}try{oRequest.statusText=oRequest._object.statusText}catch(e){}}function fCleanTransport(oRequest){oRequest._object.onreadystatechange=new window.Function}var oXMLHttpRequest=window.XMLHttpRequest,bGecko=!!window.controllers,bIE=window.document.all&&!window.opera,bIE7=bIE&&window.navigator.userAgent.match(/MSIE 7.0/);cXMLHttpRequest.prototype=fXMLHttpRequest.prototype,bGecko&&oXMLHttpRequest.wrapped&&(cXMLHttpRequest.wrapped=oXMLHttpRequest.wrapped),cXMLHttpRequest.UNSENT=0,cXMLHttpRequest.OPENED=1,cXMLHttpRequest.HEADERS_RECEIVED=2,cXMLHttpRequest.LOADING=3,cXMLHttpRequest.DONE=4,cXMLHttpRequest.prototype.readyState=cXMLHttpRequest.UNSENT,cXMLHttpRequest.prototype.responseText="",cXMLHttpRequest.prototype.responseXML=null,cXMLHttpRequest.prototype.status=0,cXMLHttpRequest.prototype.statusText="",cXMLHttpRequest.prototype.priority="NORMAL",cXMLHttpRequest.prototype.onreadystatechange=null,cXMLHttpRequest.onreadystatechange=null,cXMLHttpRequest.onopen=null,cXMLHttpRequest.onsend=null,cXMLHttpRequest.onabort=null,cXMLHttpRequest.prototype.open=function(sMethod,sUrl,bAsync,sUser,sPassword){delete this._headers,arguments.length<3&&(bAsync=!0),this._async=bAsync;var fOnUnload,oRequest=this,nState=this.readyState;bIE&&bAsync&&(fOnUnload=function(){nState!=cXMLHttpRequest.DONE&&(fCleanTransport(oRequest),oRequest.abort())},window.attachEvent("onunload",fOnUnload)),cXMLHttpRequest.onopen&&cXMLHttpRequest.onopen.apply(this,arguments),arguments.length>4?this._object.open(sMethod,sUrl,bAsync,sUser,sPassword):arguments.length>3?this._object.open(sMethod,sUrl,bAsync,sUser):this._object.open(sMethod,sUrl,bAsync),this.readyState=cXMLHttpRequest.OPENED,fReadyStateChange(this),this._object.onreadystatechange=function(){if(!bGecko||bAsync){if(oRequest.readyState=oRequest._object.readyState,fSynchronizeValues(oRequest),oRequest._aborted)return void(oRequest.readyState=cXMLHttpRequest.UNSENT);oRequest.readyState==cXMLHttpRequest.DONE&&(delete oRequest._data,fCleanTransport(oRequest),bIE&&bAsync&&window.detachEvent("onunload",fOnUnload)),nState!=oRequest.readyState&&fReadyStateChange(oRequest),nState=oRequest.readyState}}},cXMLHttpRequest.prototype.send=function(vData){cXMLHttpRequest.onsend&&cXMLHttpRequest.onsend.apply(this,arguments),arguments.length||(vData=null),vData&&vData.nodeType&&(vData=window.XMLSerializer?(new window.XMLSerializer).serializeToString(vData):vData.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=vData,fXMLHttpRequest_send(this)},cXMLHttpRequest.prototype.abort=function(){cXMLHttpRequest.onabort&&cXMLHttpRequest.onabort.apply(this,arguments),this.readyState>cXMLHttpRequest.UNSENT&&(this._aborted=!0),this._object.abort(),fCleanTransport(this),this.readyState=cXMLHttpRequest.UNSENT,delete this._data},cXMLHttpRequest.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},cXMLHttpRequest.prototype.getResponseHeader=function(sName){return this._object.getResponseHeader(sName)},cXMLHttpRequest.prototype.setRequestHeader=function(sName,sValue){return this._headers||(this._headers={}),this._headers[sName]=sValue,this._object.setRequestHeader(sName,sValue)},cXMLHttpRequest.prototype.addEventListener=function(sName,fHandler,bUseCapture){for(var oListener,nIndex=0;oListener=this._listeners[nIndex];nIndex++)if(oListener[0]==sName&&oListener[1]==fHandler&&oListener[2]==bUseCapture)return;this._listeners.push([sName,fHandler,bUseCapture])},cXMLHttpRequest.prototype.removeEventListener=function(sName,fHandler,bUseCapture){for(var oListener,nIndex=0;(oListener=this._listeners[nIndex])&&(oListener[0]!=sName||oListener[1]!=fHandler||oListener[2]!=bUseCapture);nIndex++);oListener&&this._listeners.splice(nIndex,1)},cXMLHttpRequest.prototype.dispatchEvent=function(oEvent){var oEventPseudo={type:oEvent.type,target:this,currentTarget:this,eventPhase:2,bubbles:oEvent.bubbles,cancelable:oEvent.cancelable,timeStamp:oEvent.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==oEventPseudo.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[oEventPseudo]);for(var oListener,nIndex=0;oListener=this._listeners[nIndex];nIndex++)oListener[0]!=oEventPseudo.type||oListener[2]||(oListener[1].handleEvent||oListener[1]).apply(this,[oEventPseudo])},cXMLHttpRequest.prototype.toString=function(){return"[object XMLHttpRequest]"},cXMLHttpRequest.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(oRequest,oArguments){oArguments||(oArguments=[]),oRequest.__func=this,oRequest.__func(oArguments[0],oArguments[1],oArguments[2],oArguments[3],oArguments[4]),delete oRequest.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=cXMLHttpRequest}(),OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(url,proxy){var sameOrigin=0!==url.indexOf("http"),urlParts=!sameOrigin&&url.match(this.URL_SPLIT_REGEX);if(urlParts){var location=window.location;sameOrigin=urlParts[1]==location.protocol&&urlParts[3]==location.hostname;var uPort=urlParts[4],lPort=location.port;(80!=uPort&&""!=uPort||"80"!=lPort&&""!=lPort)&&(sameOrigin=sameOrigin&&uPort==lPort)}return sameOrigin||proxy&&(url="function"==typeof proxy?proxy(url):proxy+encodeURIComponent(url)),url},issue:function(config){var defaultConfig=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});config=config||{},config.headers=config.headers||{},config=OpenLayers.Util.applyDefaults(config,defaultConfig),config.headers=OpenLayers.Util.applyDefaults(config.headers,defaultConfig.headers);var headerKey,customRequestedWithHeader=!1;for(headerKey in config.headers)config.headers.hasOwnProperty(headerKey)&&"x-requested-with"===headerKey.toLowerCase()&&(customRequestedWithHeader=!0);customRequestedWithHeader===!1&&(config.headers["X-Requested-With"]="XMLHttpRequest");var request=new OpenLayers.Request.XMLHttpRequest,url=OpenLayers.Util.urlAppend(config.url,OpenLayers.Util.getParameterString(config.params||{}));url=OpenLayers.Request.makeSameOrigin(url,config.proxy),request.open(config.method,url,config.async,config.user,config.password);for(var header in config.headers)request.setRequestHeader(header,config.headers[header]);var events=this.events,self=this;return request.onreadystatechange=function(){if(request.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var proceed=events.triggerEvent("complete",{request:request,config:config,requestUrl:url});proceed!==!1&&self.runCallbacks({request:request,config:config,requestUrl:url})}},config.async===!1?request.send(config.data):window.setTimeout(function(){0!==request.readyState&&request.send(config.data)},0),request},runCallbacks:function(options){var success,request=options.request,config=options.config,complete=config.scope?OpenLayers.Function.bind(config.callback,config.scope):config.callback;config.success&&(success=config.scope?OpenLayers.Function.bind(config.success,config.scope):config.success);var failure;config.failure&&(failure=config.scope?OpenLayers.Function.bind(config.failure,config.scope):config.failure),"file:"==OpenLayers.Util.createUrlObject(config.url).protocol&&request.responseText&&(request.status=200),complete(request),(!request.status||request.status>=200&&request.status<300)&&(this.events.triggerEvent("success",options),success&&success(request)),request.status&&(request.status<200||request.status>=300)&&(this.events.triggerEvent("failure",options),failure&&failure(request))},GET:function(config){return config=OpenLayers.Util.extend(config,{method:"GET"}),OpenLayers.Request.issue(config)},POST:function(config){return config=OpenLayers.Util.extend(config,{method:"POST"}),config.headers=config.headers?config.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(config.headers)||(config.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(config)},PUT:function(config){return config=OpenLayers.Util.extend(config,{method:"PUT"}),config.headers=config.headers?config.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(config.headers)||(config.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(config)},DELETE:function(config){return config=OpenLayers.Util.extend(config,{method:"DELETE"}),OpenLayers.Request.issue(config)},HEAD:function(config){return config=OpenLayers.Util.extend(config,{method:"HEAD"}),OpenLayers.Request.issue(config)},OPTIONS:function(config){return config=OpenLayers.Util.extend(config,{method:"OPTIONS"}),OpenLayers.Request.issue(config)}}),OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(name,url,options){this.tileSize=new OpenLayers.Size(512,512),this.params=OpenLayers.Util.applyDefaults({ServiceName:options.serviceName},this.DEFAULT_PARAMS),this.options=OpenLayers.Util.applyDefaults(options,this.DEFAULT_OPTIONS),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,this.params,options]),this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png")),null===this.options.layers&&(this.options.layers=[])},getURL:function(bounds){var url="";bounds=this.adjustBounds(bounds);var axlReq=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:bounds.toArray(),tileSize:this.tileSize})),req=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:axlReq.write(),async:!1});if(null!=req){var doc=req.responseXML;doc&&doc.documentElement||(doc=req.responseText);var axlResp=new OpenLayers.Format.ArcXML,arcxml=axlResp.read(doc);url=this.getUrlOrImage(arcxml.image.output)}return url},getURLasync:function(bounds,callback,scope){bounds=this.adjustBounds(bounds);var axlReq=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:bounds.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:axlReq.write(),callback:function(req){var doc=req.responseXML;doc&&doc.documentElement||(doc=req.responseText);var axlResp=new OpenLayers.Format.ArcXML,arcxml=axlResp.read(doc);callback.call(scope,this.getUrlOrImage(arcxml.image.output))},scope:this})},getUrlOrImage:function(output){var ret="";return output.url?ret=output.url:output.data&&(ret="data:image/"+output.type+";base64,"+output.data),ret},setLayerQuery:function(id,querydef){for(var lyr=0;lyr<this.options.layers.length;lyr++)if(id==this.options.layers[lyr].id)return void(this.options.layers[lyr].query=querydef);this.options.layers.push({id:id,visible:!0,query:querydef})},getFeatureInfo:function(geometry,layer,options){var buffer=options.buffer||1,callback=options.callback||function(){},scope=options.scope||window,requestOptions={};OpenLayers.Util.extend(requestOptions,this.options),requestOptions.requesttype="feature",geometry instanceof OpenLayers.LonLat?(requestOptions.polygon=null,requestOptions.envelope=[geometry.lon-buffer,geometry.lat-buffer,geometry.lon+buffer,geometry.lat+buffer]):geometry instanceof OpenLayers.Geometry.Polygon&&(requestOptions.envelope=null,requestOptions.polygon=geometry);var arcxml=new OpenLayers.Format.ArcXML(requestOptions);if(OpenLayers.Util.extend(arcxml.request.get_feature,options),arcxml.request.get_feature.layer=layer.id,"number"==typeof layer.query.accuracy)arcxml.request.get_feature.query.accuracy=layer.query.accuracy;else{var mapCenter=this.map.getCenter(),viewPx=this.map.getViewPortPxFromLonLat(mapCenter);viewPx.x++;var mapOffCenter=this.map.getLonLatFromPixel(viewPx);arcxml.request.get_feature.query.accuracy=mapOffCenter.lon-mapCenter.lon}arcxml.request.get_feature.query.where=layer.query.where,arcxml.request.get_feature.query.spatialfilter.relation="area_intersection",OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:arcxml.write(),callback:function(request){var response=arcxml.parseResponse(request.responseText);arcxml.iserror()?callback.call(scope,null):callback.call(scope,response.features)}})},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(options){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),this.removeButtons(),this.buttons=null,this.position=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(px){OpenLayers.Control.prototype.draw.apply(this,arguments),px=this.position,this.buttons=[];var sz={w:18,h:18},centered=new OpenLayers.Pixel(px.x+sz.w/2,px.y);return this._addButton("panup","north-mini.png",centered,sz),px.y=centered.y+sz.h,this._addButton("panleft","west-mini.png",px,sz),this._addButton("panright","east-mini.png",px.add(sz.w,0),sz),this._addButton("pandown","south-mini.png",centered.add(0,2*sz.h),sz),this._addButton("zoomin","zoom-plus-mini.png",centered.add(0,3*sz.h+5),sz),this._addButton("zoomworld","zoom-world-mini.png",centered.add(0,4*sz.h+5),sz),this._addButton("zoomout","zoom-minus-mini.png",centered.add(0,5*sz.h+5),sz),this.div},_addButton:function(id,img,xy,sz){var imgLocation=OpenLayers.Util.getImageLocation(img),btn=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+id,xy,sz,imgLocation,"absolute");return btn.style.cursor="pointer",this.div.appendChild(btn),btn.action=id,btn.className="olButton",this.buttons.push(btn),btn},_removeButton:function(btn){this.div.removeChild(btn),OpenLayers.Util.removeItem(this.buttons,btn)},removeButtons:function(){for(var i=this.buttons.length-1;i>=0;--i)this._removeButton(this.buttons[i])},onButtonClick:function(evt){var btn=evt.buttonElement;switch(btn.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(dim){return this.slideRatio?this.map.getSize()[dim]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(map){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(px){OpenLayers.Control.prototype.draw.apply(this,arguments),px=this.position.clone(),this.buttons=[];var sz={w:18,h:18};if(this.panIcons){var centered=new OpenLayers.Pixel(px.x+sz.w/2,px.y),wposition=sz.w;this.zoomWorldIcon&&(centered=new OpenLayers.Pixel(px.x+sz.w,px.y)),this._addButton("panup","north-mini.png",centered,sz),px.y=centered.y+sz.h,this._addButton("panleft","west-mini.png",px,sz),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",px.add(sz.w,0),sz),wposition*=2),this._addButton("panright","east-mini.png",px.add(wposition,0),sz),this._addButton("pandown","south-mini.png",centered.add(0,2*sz.h),sz),this._addButton("zoomin","zoom-plus-mini.png",centered.add(0,3*sz.h+5),sz),centered=this._addZoomBar(centered.add(0,4*sz.h+5)),this._addButton("zoomout","zoom-minus-mini.png",centered,sz)}else this._addButton("zoomin","zoom-plus-mini.png",px,sz),centered=this._addZoomBar(px.add(0,sz.h)),this._addButton("zoomout","zoom-minus-mini.png",centered,sz),this.zoomWorldIcon&&(centered=centered.add(0,sz.h+3),this._addButton("zoomworld","zoom-world-mini.png",centered,sz));return this.div},_addZoomBar:function(centered){var imgLocation=OpenLayers.Util.getImageLocation("slider.png"),id=this.id+"_"+this.map.id,minZoom=this.map.getMinZoom(),zoomsToEnd=this.map.getNumZoomLevels()-1-this.map.getZoom(),slider=OpenLayers.Util.createAlphaImageDiv(id,centered.add(-1,zoomsToEnd*this.zoomStopHeight),{w:20,h:9},imgLocation,"absolute");slider.style.cursor="move",this.slider=slider,this.sliderEvents=new OpenLayers.Events(this,slider,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var sz={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-minZoom)},imgLocation=OpenLayers.Util.getImageLocation("zoombar.png"),div=null;if(OpenLayers.Util.alphaHack()){var id=this.id+"_"+this.map.id;div=OpenLayers.Util.createAlphaImageDiv(id,centered,{w:sz.w,h:this.zoomStopHeight},imgLocation,"absolute",null,"crop"),div.style.height=sz.h+"px"}else div=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,centered,sz,imgLocation);return div.style.cursor="pointer",div.className="olButton",this.zoombarDiv=div,this.div.appendChild(div),this.startTop=parseInt(div.style.top),this.div.appendChild(slider),this.map.events.register("zoomend",this,this.moveZoomBar),centered=centered.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-minZoom))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(evt){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),evt.buttonElement===this.zoombarDiv){var levels=evt.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(levels=Math.floor(levels));var zoom=this.map.getNumZoomLevels()-1-levels;zoom=Math.min(Math.max(zoom,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(zoom)}},passEventToSlider:function(evt){this.sliderEvents.handleBrowserEvent(evt)},zoomBarDown:function(evt){(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt))&&(this.map.events.on({touchmove:this.passEventToSlider,
mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=evt.xy.clone(),this.zoomStart=evt.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(evt))},zoomBarDrag:function(evt){if(null!=this.mouseDragStart){var deltaY=this.mouseDragStart.y-evt.xy.y,offsets=OpenLayers.Util.pagePosition(this.zoombarDiv);if(evt.clientY-offsets[1]>0&&evt.clientY-offsets[1]<parseInt(this.zoombarDiv.style.height)-2){var newTop=parseInt(this.slider.style.top)-deltaY;this.slider.style.top=newTop+"px",this.mouseDragStart=evt.xy.clone()}this.deltaY=this.zoomStart.y-evt.xy.y,OpenLayers.Event.stop(evt)}},zoomBarUp:function(evt){if((OpenLayers.Event.isLeftClick(evt)||"touchend"===evt.type)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var zoomLevel=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(zoomLevel+=this.deltaY/this.zoomStopHeight,zoomLevel=Math.min(Math.max(zoomLevel,0),this.map.getNumZoomLevels()-1)):(zoomLevel+=this.deltaY/this.zoomStopHeight,zoomLevel=Math.max(Math.round(zoomLevel),0)),this.map.zoomTo(zoomLevel),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(evt)}},moveZoomBar:function(){var newTop=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=newTop+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"}),OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&9==data.nodeType&&(data=data.documentElement);var capabilities={};return this.readNode(data,capabilities),capabilities},readers:{wfs:{WFS_Capabilities:function(node,obj){this.readChildNodes(node,obj)},FeatureTypeList:function(node,request){request.featureTypeList={featureTypes:[]},this.readChildNodes(node,request.featureTypeList)},FeatureType:function(node,featureTypeList){var featureType={};this.readChildNodes(node,featureType),featureTypeList.featureTypes.push(featureType)},Name:function(node,obj){var name=this.getChildValue(node);if(name){var parts=name.split(":");obj.name=parts.pop(),parts.length>0&&(obj.featureNS=this.lookupNamespaceURI(node,parts[0]))}},Title:function(node,obj){var title=this.getChildValue(node);title&&(obj.title=title)},Abstract:function(node,obj){var abst=this.getChildValue(node);abst&&(obj["abstract"]=abst)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"}),OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(node,obj){var defaultSRS=this.getChildValue(node);defaultSRS&&(obj.srs=defaultSRS)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"}),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(name,url,extent,size,options){this.url=url,this.extent=extent,this.maxExtent=extent,this.size=size,OpenLayers.Layer.prototype.initialize.apply(this,[name,options]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),obj=OpenLayers.Layer.prototype.clone.apply(this,[obj])},setMap:function(map){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var firstRendering=null==this.tile;if(zoomChanged||firstRendering){this.setTileSize();var ulPx=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});firstRendering?(this.tile=new OpenLayers.Tile.Image(this,ulPx,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=ulPx.clone()),this.tile.draw()}},setTileSize:function(){var tileWidth=this.extent.getWidth()/this.map.getResolution(),tileHeight=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(tileWidth,tileHeight)},addTileMonitoringHooks:function(tile){tile.onLoadStart=function(){this.events.triggerEvent("loadstart")},tile.events.register("loadstart",this,tile.onLoadStart),tile.onLoadEnd=function(){this.events.triggerEvent("loadend")},tile.events.register("loadend",this,tile.onLoadEnd),tile.events.register("unload",this,tile.onLoadEnd)},removeTileMonitoringHooks:function(tile){tile.unload(),tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,scope:this})},setUrl:function(newUrl){this.url=newUrl,this.tile.draw()},getURL:function(bounds){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(options){OpenLayers.Util.extend(this,options),this.options=options,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(layer){this.layer=layer},activate:function(){return this.active?!1:(this.active=!0,!0)},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(options){OpenLayers.Strategy.prototype.initialize.apply(this,[options]),this.events=new OpenLayers.Events(this)},activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);return activated&&this.auto&&("number"==typeof this.auto?this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1e3*this.auto):this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&this.auto&&("number"==typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),deactivated},triggerSave:function(event){var feature=event.feature;(feature.state===OpenLayers.State.INSERT||feature.state===OpenLayers.State.UPDATE||feature.state===OpenLayers.State.DELETE)&&this.save([event.feature])},save:function(features){features||(features=this.layer.features),this.events.triggerEvent("start",{features:features});var remote=this.layer.projection,local=this.layer.map.getProjectionObject();if(!local.equals(remote)){for(var orig,clone,len=features.length,clones=new Array(len),i=0;len>i;++i)orig=features[i],clone=orig.clone(),clone.fid=orig.fid,clone.state=orig.state,orig.url&&(clone.url=orig.url),clone._original=orig,clone.geometry.transform(local,remote),clones[i]=clone;features=clones}this.layer.protocol.commit(features,{callback:this.onCommit,scope:this})},onCommit:function(response){var evt={response:response};if(response.success()){for(var state,feature,features=response.reqFeatures,destroys=[],insertIds=response.insertIds||[],j=0,i=0,len=features.length;len>i;++i)feature=features[i],feature=feature._original||feature,state=feature.state,state&&(state==OpenLayers.State.DELETE?destroys.push(feature):state==OpenLayers.State.INSERT&&(feature.fid=insertIds[j],++j),feature.state=null);destroys.length>0&&this.layer.destroyFeatures(destroys),this.events.triggerEvent("success",evt)}else this.events.triggerEvent("fail",evt)},CLASS_NAME:"OpenLayers.Strategy.Save"}),OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(target){if(this.target=target,target.object instanceof OpenLayers.Map)this.setMap(target.object);else{if(!(target.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";target.object.map?this.setMap(target.object.map):target.object.events.register("added",this,function(evt){this.setMap(target.object.map)})}for(var i=this.provides.length-1;i>=0;--i)target.extensions[this.provides[i]]=!0},setMap:function(map){this.map=map,this.cache={},map.events.register("mousedown",this,this.start,{extension:!0}),map.events.register("mouseup",this,this.onClick,{extension:!0}),map.events.register("touchstart",this,this.start,{extension:!0}),map.events.register("touchmove",this,this.cancel,{extension:!0}),map.events.register("touchend",this,this.onClick,{extension:!0}),map.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(evt){this.startEvt=evt},cancel:function(evt){delete this.startEvt},onClick:function(evt){if(this.startEvt&&("touchend"===evt.type||OpenLayers.Event.isLeftClick(evt))){var features=this.getFeatures(this.startEvt);delete this.startEvt;for(var feature,layer,more,clicked={},i=0,len=features.length;len>i&&(feature=features[i],layer=feature.layer,clicked[layer.id]=!0,more=this.triggerEvent("featureclick",{feature:feature}),more!==!1);++i);for(i=0,len=this.map.layers.length;len>i;++i)layer=this.map.layers[i],layer instanceof OpenLayers.Layer.Vector&&!clicked[layer.id]&&this.triggerEvent("nofeatureclick",{layer:layer})}},onMousemove:function(evt){delete this.startEvt;for(var feature,features=this.getFeatures(evt),over={},newly=[],i=0,len=features.length;len>i;++i)feature=features[i],over[feature.id]=feature,this.cache[feature.id]||newly.push(feature);var out=[];for(var id in this.cache)feature=this.cache[id],feature.layer&&feature.layer.map?over[feature.id]||out.push(feature):delete this.cache[id];var more;for(i=0,len=newly.length;len>i&&(feature=newly[i],this.cache[feature.id]=feature,more=this.triggerEvent("featureover",{feature:feature}),more!==!1);++i);for(i=0,len=out.length;len>i&&(feature=out[i],delete this.cache[feature.id],more=this.triggerEvent("featureout",{feature:feature}),more!==!1);++i);},triggerEvent:function(type,evt){var layer=evt.feature?evt.feature.layer:evt.layer,object=this.target.object;return object instanceof OpenLayers.Map||object===layer?this.target.triggerEvent(type,evt):void 0},getFeatures:function(evt){var layer,target,feature,i,len,x=evt.clientX,y=evt.clientY,features=[],targets=[],layers=[];for(i=this.map.layers.length-1;i>=0;--i)if(layer=this.map.layers[i],"none"!==layer.div.style.display)if(layer.renderer instanceof OpenLayers.Renderer.Elements){if(layer instanceof OpenLayers.Layer.Vector)for(target=document.elementFromPoint(x,y);target&&target._featureId;)feature=layer.getFeatureById(target._featureId),feature?(features.push(feature),target.style.display="none",targets.push(target),target=document.elementFromPoint(x,y)):target=!1;layers.push(layer),layer.div.style.display="none"}else layer.renderer instanceof OpenLayers.Renderer.Canvas&&(feature=layer.renderer.getFeatureIdFromEvent(evt),feature&&(features.push(feature),layers.push(layer)));for(i=0,len=targets.length;len>i;++i)targets[i].style.display="";for(i=layers.length-1;i>=0;--i)layers[i].div.style.display="block";return features},destroy:function(){for(var i=this.provides.length-1;i>=0;--i)delete this.target.extensions[this.provides[i]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this}),delete this.cache,delete this.map,delete this.target}}),OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick,OpenLayers.Events.featureover=OpenLayers.Events.featureclick,OpenLayers.Events.featureout=OpenLayers.Events.featureclick,OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(options){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(doc){"string"==typeof doc&&(doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc]));var features=[];if(this.extractTracks)for(var tracks=doc.getElementsByTagName("trk"),i=0,len=tracks.length;len>i;i++){var attrs={};this.extractAttributes&&(attrs=this.parseAttributes(tracks[i]));for(var segs=this.getElementsByTagNameNS(tracks[i],tracks[i].namespaceURI,"trkseg"),j=0,seglen=segs.length;seglen>j;j++){var track=this.extractSegment(segs[j],"trkpt");features.push(new OpenLayers.Feature.Vector(track,attrs))}}if(this.extractRoutes)for(var routes=doc.getElementsByTagName("rte"),k=0,klen=routes.length;klen>k;k++){var attrs={};this.extractAttributes&&(attrs=this.parseAttributes(routes[k]));var route=this.extractSegment(routes[k],"rtept");features.push(new OpenLayers.Feature.Vector(route,attrs))}if(this.extractWaypoints)for(var waypoints=doc.getElementsByTagName("wpt"),l=0,len=waypoints.length;len>l;l++){var attrs={};this.extractAttributes&&(attrs=this.parseAttributes(waypoints[l]));var wpt=new OpenLayers.Geometry.Point(waypoints[l].getAttribute("lon"),waypoints[l].getAttribute("lat"));features.push(new OpenLayers.Feature.Vector(wpt,attrs))}if(this.internalProjection&&this.externalProjection)for(var g=0,featLength=features.length;featLength>g;g++)features[g].geometry.transform(this.externalProjection,this.internalProjection);return features},extractSegment:function(segment,segmentType){for(var points=this.getElementsByTagNameNS(segment,segment.namespaceURI,segmentType),point_features=[],i=0,len=points.length;len>i;i++)point_features.push(new OpenLayers.Geometry.Point(points[i].getAttribute("lon"),points[i].getAttribute("lat")));return new OpenLayers.Geometry.LineString(point_features)},parseAttributes:function(node){for(var value,name,attributes={},attrNode=node.firstChild;attrNode;)1==attrNode.nodeType&&attrNode.firstChild&&(value=attrNode.firstChild,(3==value.nodeType||4==value.nodeType)&&(name=attrNode.prefix?attrNode.nodeName.split(":")[1]:attrNode.nodeName,"trkseg"!=name&&"rtept"!=name&&(attributes[name]=value.nodeValue))),attrNode=attrNode.nextSibling;return attributes},write:function(features,metadata){features=OpenLayers.Util.isArray(features)?features:[features];var gpx=this.createElementNS(this.namespaces.gpx,"gpx");gpx.setAttribute("version","1.1"),gpx.setAttribute("creator",this.creator),this.setAttributes(gpx,{"xsi:schemaLocation":this.schemaLocation}),metadata&&"object"==typeof metadata&&gpx.appendChild(this.buildMetadataNode(metadata));for(var i=0,len=features.length;len>i;i++)gpx.appendChild(this.buildFeatureNode(features[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[gpx])},buildMetadataNode:function(metadata){for(var types=["name","desc","author"],node=this.createElementNS(this.namespaces.gpx,"metadata"),i=0;i<types.length;i++){var type=types[i];if(metadata[type]){var n=this.createElementNS(this.namespaces.gpx,type);n.appendChild(this.createTextNode(metadata[type])),node.appendChild(n)}}return node},buildFeatureNode:function(feature){var geometry=feature.geometry;if(geometry=geometry.clone(),this.internalProjection&&this.externalProjection&&geometry.transform(this.internalProjection,this.externalProjection),"OpenLayers.Geometry.Point"==geometry.CLASS_NAME){var wpt=this.buildWptNode(geometry);return this.appendAttributesNode(wpt,feature),wpt}var trkNode=this.createElementNS(this.namespaces.gpx,"trk");this.appendAttributesNode(trkNode,feature);var trkSegNodes=this.buildTrkSegNode(geometry);trkSegNodes=OpenLayers.Util.isArray(trkSegNodes)?trkSegNodes:[trkSegNodes];for(var i=0,len=trkSegNodes.length;len>i;i++)trkNode.appendChild(trkSegNodes[i]);return trkNode},buildTrkSegNode:function(geometry){var node,i,len,point,nodes;if("OpenLayers.Geometry.LineString"==geometry.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==geometry.CLASS_NAME){for(node=this.createElementNS(this.namespaces.gpx,"trkseg"),i=0,len=geometry.components.length;len>i;i++)point=geometry.components[i],node.appendChild(this.buildTrkPtNode(point));return node}for(nodes=[],i=0,len=geometry.components.length;len>i;i++)nodes.push(this.buildTrkSegNode(geometry.components[i]));return nodes},buildTrkPtNode:function(point){var node=this.createElementNS(this.namespaces.gpx,"trkpt");return node.setAttribute("lon",point.x),node.setAttribute("lat",point.y),node},buildWptNode:function(geometry){var node=this.createElementNS(this.namespaces.gpx,"wpt");return node.setAttribute("lon",geometry.x),node.setAttribute("lat",geometry.y),node},appendAttributesNode:function(node,feature){var name=this.createElementNS(this.namespaces.gpx,"name");name.appendChild(this.createTextNode(feature.attributes.name||feature.id)),node.appendChild(name);var desc=this.createElementNS(this.namespaces.gpx,"desc");desc.appendChild(this.createTextNode(feature.attributes.description||this.defaultDesc)),node.appendChild(desc)},CLASS_NAME:"OpenLayers.Format.GPX"}),OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"}),OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(options){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[options])},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));for(var childNode,nodeName,root=data.documentElement,children=root.childNodes,describelayer={layerDescriptions:[]},i=0;i<children.length;++i)if(childNode=children[i],nodeName=childNode.nodeName,"LayerDescription"==nodeName){var layerName=childNode.getAttribute("name"),owsType="",owsURL="",typeName="";childNode.getAttribute("owsType")?(owsType=childNode.getAttribute("owsType"),owsURL=childNode.getAttribute("owsURL")):""!=childNode.getAttribute("wfs")?(owsType="WFS",owsURL=childNode.getAttribute("wfs")):""!=childNode.getAttribute("wcs")&&(owsType="WCS",owsURL=childNode.getAttribute("wcs"));var query=childNode.getElementsByTagName("Query");query.length>0&&(typeName=query[0].getAttribute("typeName"),typeName||(typeName=query[0].getAttribute("typename")));var layerDescription={layerName:layerName,owsType:owsType,owsURL:owsURL,typeName:typeName};describelayer.layerDescriptions.push(layerDescription),describelayer.length=describelayer.layerDescriptions.length,describelayer[describelayer.length-1]=layerDescription}else if("ServiceException"==nodeName){var parser=new OpenLayers.Format.OGCExceptionReport;return{error:parser.read(data)}}return describelayer},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"}),OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1,OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(name,url,options){(options&&options.sphericalMercator||this.sphericalMercator)&&(options=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},options)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name||this.name,url||this.url,{},options])},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){var xyz=this.getXYZ(bounds),url=this.url;if(OpenLayers.Util.isArray(url)){var s=""+xyz.x+xyz.y+xyz.z;url=this.selectUrl(s,url)}return OpenLayers.String.format(url,xyz)},getXYZ:function(bounds){var res=this.getServerResolution(),x=Math.round((bounds.left-this.maxExtent.left)/(res*this.tileSize.w)),y=Math.round((this.maxExtent.top-bounds.top)/(res*this.tileSize.h)),z=this.getServerZoom();if(this.wrapDateLine){var limit=Math.pow(2,z);x=(x%limit+limit)%limit}return{x:x,y:y,z:z}},setMap:function(map){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(name,url,options){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),obj=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(containerID,options){this.container=OpenLayers.Util.getElement(containerID),OpenLayers.Util.extend(this,options)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(extent,resolutionChanged){if(this.extent=extent.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var ratio=extent.getWidth()/this.map.getExtent().getWidth(),extent=extent.scale(1/ratio);this.extent=extent.wrapDateLine(this.map.getMaxExtent()).scale(ratio)}return resolutionChanged&&(this.resolution=null),!0},setSize:function(size){this.size=size.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(feature,style){if(null==style&&(style=feature.style),feature.geometry){var bounds=feature.geometry.getBounds();if(bounds){var worldBounds;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(worldBounds=this.map.getMaxExtent()),bounds.intersectsBounds(this.extent,{worldBounds:worldBounds})?this.calculateFeatureDx(bounds,worldBounds):style={display:"none"};var rendered=this.drawGeometry(feature.geometry,style,feature.id);if("none"!=style.display&&style.label&&rendered!==!1){var location=feature.geometry.getCentroid();if(style.labelXOffset||style.labelYOffset){var xOffset=isNaN(style.labelXOffset)?0:style.labelXOffset,yOffset=isNaN(style.labelYOffset)?0:style.labelYOffset,res=this.getResolution();location.move(xOffset*res,yOffset*res)}this.drawText(feature.id,style,location)}else this.removeText(feature.id);return rendered}}},calculateFeatureDx:function(bounds,worldBounds){if(this.featureDx=0,worldBounds){var worldWidth=worldBounds.getWidth(),rendererCenterX=(this.extent.left+this.extent.right)/2,featureCenterX=(bounds.left+bounds.right)/2,worldsAway=Math.round((featureCenterX-rendererCenterX)/worldWidth);this.featureDx=worldsAway*worldWidth}},drawGeometry:function(geometry,style,featureId){},drawText:function(featureId,style,location){},removeText:function(featureId){},clear:function(){},getFeatureIdFromEvent:function(evt){},eraseFeatures:function(features){OpenLayers.Util.isArray(features)||(features=[features]);for(var i=0,len=features.length;len>i;++i){var feature=features[i];this.eraseGeometry(feature.geometry,feature.id),this.removeText(feature.id)}},eraseGeometry:function(geometry,featureId){},moveRoot:function(renderer){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(symbolizer){var result=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return symbolizer.stroke===!1&&(delete result.strokeWidth,delete result.strokeColor),symbolizer.fill===!1&&delete result.fillColor,OpenLayers.Util.extend(result,symbolizer),result},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(containerID,options){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(geometry,featureId){this.eraseFeatures(this.features[featureId][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(size){this.size=size.clone();var root=this.root;if(root.style.width=size.w+"px",root.style.height=size.h+"px",root.width=size.w,root.height=size.h,this.resolution=null,this.hitDetection){var hitCanvas=this.hitCanvas;hitCanvas.style.width=size.w+"px",hitCanvas.style.height=size.h+"px",hitCanvas.width=size.w,hitCanvas.height=size.h}},drawFeature:function(feature,style){var rendered;if(feature.geometry){style=this.applyDefaultSymbolizer(style||feature.style);var worldBounds,bounds=feature.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(worldBounds=this.map.getMaxExtent());var intersects=bounds&&bounds.intersectsBounds(this.extent,{worldBounds:worldBounds});rendered="none"!==style.display&&!!bounds&&intersects,rendered?this.features[feature.id]=[feature,style]:delete this.features[feature.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),rendered},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=className&&"OpenLayers.Geometry.MultiPoint"!=className&&"OpenLayers.Geometry.MultiLineString"!=className&&"OpenLayers.Geometry.MultiPolygon"!=className)switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(geometry,style,featureId);break;case"OpenLayers.Geometry.LineString":this.drawLineString(geometry,style,featureId);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(geometry,style,featureId);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(geometry,style,featureId)}else for(var i=0;i<geometry.components.length;i++)this.drawGeometry(geometry.components[i],style,featureId)},drawExternalGraphic:function(geometry,style,featureId){var img=new Image,title=style.title||style.graphicTitle;title&&(img.title=title);var width=style.graphicWidth||style.graphicHeight,height=style.graphicHeight||style.graphicWidth;width=width?width:2*style.pointRadius,height=height?height:2*style.pointRadius;var xOffset=void 0!=style.graphicXOffset?style.graphicXOffset:-(.5*width),yOffset=void 0!=style.graphicYOffset?style.graphicYOffset:-(.5*height),opacity=style.graphicOpacity||style.fillOpacity,onLoad=function(){if(this.features[featureId]){var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){var x=p0+xOffset|0,y=p1+yOffset|0,canvas=this.canvas;canvas.globalAlpha=opacity;var factor=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);canvas.drawImage(img,x*factor,y*factor,width*factor,height*factor),this.hitDetection&&(this.setHitContextStyle("fill",featureId),this.hitContext.fillRect(x,y,width,height))}}};img.onload=OpenLayers.Function.bind(onLoad,this),img.src=style.externalGraphic},drawNamedSymbol:function(geometry,style,featureId){var x,y,cx,cy,i,symbolBounds,scaling,angle,unscaledStrokeWidth,deg2rad=Math.PI/180,symbol=OpenLayers.Renderer.symbol[style.graphicName];if(!symbol)throw new Error(style.graphicName+" is not a valid symbol name");if(symbol.length&&!(symbol.length<2)){var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),style.graphicName in this.cachedSymbolBounds)symbolBounds=this.cachedSymbolBounds[style.graphicName];else{for(symbolBounds=new OpenLayers.Bounds,i=0;i<symbol.length;i+=2)symbolBounds.extend(new OpenLayers.LonLat(symbol[i],symbol[i+1]));this.cachedSymbolBounds[style.graphicName]=symbolBounds}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(p0,p1),this.hitDetection&&this.hitContext.translate(p0,p1),angle=deg2rad*style.rotation,isNaN(angle)||(this.canvas.rotate(angle),this.hitDetection&&this.hitContext.rotate(angle)),scaling=2*style.pointRadius/Math.max(symbolBounds.getWidth(),symbolBounds.getHeight()),this.canvas.scale(scaling,scaling),this.hitDetection&&this.hitContext.scale(scaling,scaling),cx=symbolBounds.getCenterLonLat().lon,cy=symbolBounds.getCenterLonLat().lat,this.canvas.translate(-cx,-cy),this.hitDetection&&this.hitContext.translate(-cx,-cy),unscaledStrokeWidth=style.strokeWidth,style.strokeWidth=unscaledStrokeWidth/scaling,style.fill!==!1){for(this.setCanvasStyle("fill",style),this.canvas.beginPath(),i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],0==i&&this.canvas.moveTo(x,y),this.canvas.lineTo(x,y);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",featureId,style),this.hitContext.beginPath(),i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],0==i&&this.canvas.moveTo(x,y),this.hitContext.lineTo(x,y);this.hitContext.closePath(),this.hitContext.fill()}}if(style.stroke!==!1){for(this.setCanvasStyle("stroke",style),this.canvas.beginPath(),i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],0==i&&this.canvas.moveTo(x,y),this.canvas.lineTo(x,y);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",featureId,style,scaling),this.hitContext.beginPath(),i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],0==i&&this.hitContext.moveTo(x,y),this.hitContext.lineTo(x,y);this.hitContext.closePath(),this.hitContext.stroke()}}style.strokeWidth=unscaledStrokeWidth,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(type,style){"fill"===type?(this.canvas.globalAlpha=style.fillOpacity,this.canvas.fillStyle=style.fillColor):"stroke"===type?(this.canvas.globalAlpha=style.strokeOpacity,this.canvas.strokeStyle=style.strokeColor,this.canvas.lineWidth=style.strokeWidth):(this.canvas.globalAlpha=0,
this.canvas.lineWidth=1)},featureIdToHex:function(featureId){var id=Number(featureId.split("_").pop())+1;id>=16777216&&(this.hitOverflow=id-16777215,id=id%16777216+1);var hex="000000"+id.toString(16),len=hex.length;return hex="#"+hex.substring(len-6,len)},setHitContextStyle:function(type,featureId,symbolizer,strokeScaling){var hex=this.featureIdToHex(featureId);"fill"==type?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=hex):"stroke"==type?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=hex,"undefined"==typeof strokeScaling?this.hitContext.lineWidth=symbolizer.strokeWidth+2:isNaN(strokeScaling)||(this.hitContext.lineWidth=symbolizer.strokeWidth+2/strokeScaling)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(geometry,style,featureId){if(style.graphic!==!1)if(style.externalGraphic)this.drawExternalGraphic(geometry,style,featureId);else if(style.graphicName&&"circle"!=style.graphicName)this.drawNamedSymbol(geometry,style,featureId);else{var pt=this.getLocalXY(geometry),p0=pt[0],p1=pt[1];if(!isNaN(p0)&&!isNaN(p1)){var twoPi=2*Math.PI,radius=style.pointRadius;style.fill!==!1&&(this.setCanvasStyle("fill",style),this.canvas.beginPath(),this.canvas.arc(p0,p1,radius,0,twoPi,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",featureId,style),this.hitContext.beginPath(),this.hitContext.arc(p0,p1,radius,0,twoPi,!0),this.hitContext.fill())),style.stroke!==!1&&(this.setCanvasStyle("stroke",style),this.canvas.beginPath(),this.canvas.arc(p0,p1,radius,0,twoPi,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",featureId,style),this.hitContext.beginPath(),this.hitContext.arc(p0,p1,radius,0,twoPi,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(geometry,style,featureId){style=OpenLayers.Util.applyDefaults({fill:!1},style),this.drawLinearRing(geometry,style,featureId)},drawLinearRing:function(geometry,style,featureId){style.fill!==!1&&(this.setCanvasStyle("fill",style),this.renderPath(this.canvas,geometry,style,featureId,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",featureId,style),this.renderPath(this.hitContext,geometry,style,featureId,"fill"))),style.stroke!==!1&&(this.setCanvasStyle("stroke",style),this.renderPath(this.canvas,geometry,style,featureId,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",featureId,style),this.renderPath(this.hitContext,geometry,style,featureId,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(context,geometry,style,featureId,type){var components=geometry.components,len=components.length;context.beginPath();var start=this.getLocalXY(components[0]),x=start[0],y=start[1];if(!isNaN(x)&&!isNaN(y)){context.moveTo(start[0],start[1]);for(var i=1;len>i;++i){var pt=this.getLocalXY(components[i]);context.lineTo(pt[0],pt[1])}"fill"===type?context.fill():context.stroke()}},drawPolygon:function(geometry,style,featureId){var components=geometry.components,len=components.length;this.drawLinearRing(components[0],style,featureId);for(var i=1;len>i;++i)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(components[i],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},style),featureId),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(components[i],OpenLayers.Util.applyDefaults({fill:!1},style),featureId)},drawText:function(location,style){var pt=this.getLocalXY(location);this.setCanvasStyle("reset"),this.canvas.fillStyle=style.fontColor,this.canvas.globalAlpha=style.fontOpacity||1;var fontStyle=[style.fontStyle?style.fontStyle:"normal","normal",style.fontWeight?style.fontWeight:"normal",style.fontSize?style.fontSize:"1em",style.fontFamily?style.fontFamily:"sans-serif"].join(" "),labelRows=style.label.split("\n"),numRows=labelRows.length;if(this.canvas.fillText){this.canvas.font=fontStyle,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[style.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[style.labelAlign[1]]||"middle";var vfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[1]];null==vfactor&&(vfactor=-.5);var lineHeight=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;pt[1]+=lineHeight*vfactor*(numRows-1);for(var i=0;numRows>i;i++)style.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=style.labelOutlineOpacity||style.fontOpacity||1,this.canvas.strokeStyle=style.labelOutlineColor,this.canvas.lineWidth=style.labelOutlineWidth,this.canvas.strokeText(labelRows[i],pt[0],pt[1]+lineHeight*i+1),this.canvas.restore()),this.canvas.fillText(labelRows[i],pt[0],pt[1]+lineHeight*i)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=fontStyle;var hfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[0]];null==hfactor&&(hfactor=-.5);var vfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[1]];null==vfactor&&(vfactor=-.5);var lineHeight=this.canvas.mozMeasureText("xx");pt[1]+=lineHeight*(1+vfactor*numRows);for(var i=0;numRows>i;i++){var x=pt[0]+hfactor*this.canvas.mozMeasureText(labelRows[i]),y=pt[1]+i*lineHeight;this.canvas.translate(x,y),this.canvas.mozDrawText(labelRows[i]),this.canvas.translate(-x,-y)}}this.setCanvasStyle("reset")},getLocalXY:function(point){var resolution=this.getResolution(),extent=this.extent,x=(point.x-this.featureDx)/resolution+-extent.left/resolution,y=extent.top/resolution-point.y/resolution;return[x,y]},clear:function(){var height=this.root.height,width=this.root.width;this.canvas.clearRect(0,0,width,height),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,width,height)},getFeatureIdFromEvent:function(evt){var featureId,feature;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var xy=evt.xy,x=0|xy.x,y=0|xy.y,data=this.hitContext.getImageData(x,y,1,1).data;if(255===data[3]){var id=data[2]+256*(data[1]+256*data[0]);if(id){featureId="OpenLayers_Feature_Vector_"+(id-1+this.hitOverflow);try{feature=this.features[featureId][0]}catch(err){}}}}return feature},eraseFeatures:function(features){OpenLayers.Util.isArray(features)||(features=[features]);for(var i=0;i<features.length;++i)delete this.features[features[i].id];this.redraw()},redraw:function(){if(!this.locked){var height=this.root.height,width=this.root.width;this.canvas.clearRect(0,0,width,height),this.hitDetection&&this.hitContext.clearRect(0,0,width,height);var feature,geometry,style,labelMap=[],worldBounds=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var id in this.features)this.features.hasOwnProperty(id)&&(feature=this.features[id][0],geometry=feature.geometry,this.calculateFeatureDx(geometry.getBounds(),worldBounds),style=this.features[id][1],this.drawGeometry(geometry,style,feature.id),style.label&&labelMap.push([feature,style]));for(var item,i=0,len=labelMap.length;len>i;++i)item=labelMap[i],this.drawText(item[0].geometry.getCentroid(),item[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(options){var layer_defaults={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};layer_defaults=OpenLayers.Util.extend(layer_defaults,options);for(var interesting={},i=0;i<layer_defaults.interestingTagsExclude.length;i++)interesting[layer_defaults.interestingTagsExclude[i]]=!0;layer_defaults.interestingTagsExclude=interesting;for(var area={},i=0;i<layer_defaults.areaTags.length;i++)area[layer_defaults.areaTags[i]]=!0;layer_defaults.areaTags=area,this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[layer_defaults])},read:function(doc){"string"==typeof doc&&(doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc]));for(var nodes=this.getNodes(doc),ways=this.getWays(doc),feat_list=new Array(ways.length),i=0;i<ways.length;i++){for(var point_list=new Array(ways[i].nodes.length),poly=this.isWayArea(ways[i])?1:0,j=0;j<ways[i].nodes.length;j++){var node=nodes[ways[i].nodes[j]],point=new OpenLayers.Geometry.Point(node.lon,node.lat);point.osm_id=parseInt(ways[i].nodes[j]),point_list[j]=point,node.used=!0}var geometry=null;geometry=poly?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(point_list)):new OpenLayers.Geometry.LineString(point_list),this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection);var feat=new OpenLayers.Feature.Vector(geometry,ways[i].tags);feat.osm_id=parseInt(ways[i].id),feat.fid="way."+feat.osm_id,feat_list[i]=feat}for(var node_id in nodes){var node=nodes[node_id];if(!node.used||this.checkTags){var tags=null;if(this.checkTags){var result=this.getTags(node.node,!0);if(node.used&&!result[1])continue;tags=result[0]}else tags=this.getTags(node.node);var feat=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(node.lon,node.lat),tags);this.internalProjection&&this.externalProjection&&feat.geometry.transform(this.externalProjection,this.internalProjection),feat.osm_id=parseInt(node_id),feat.fid="node."+feat.osm_id,feat_list.push(feat)}node.node=null}return feat_list},getNodes:function(doc){for(var node_list=doc.getElementsByTagName("node"),nodes={},i=0;i<node_list.length;i++){var node=node_list[i],id=node.getAttribute("id");nodes[id]={lat:node.getAttribute("lat"),lon:node.getAttribute("lon"),node:node}}return nodes},getWays:function(doc){for(var way_list=doc.getElementsByTagName("way"),return_ways=[],i=0;i<way_list.length;i++){var way=way_list[i],way_object={id:way.getAttribute("id")};way_object.tags=this.getTags(way);var node_list=way.getElementsByTagName("nd");way_object.nodes=new Array(node_list.length);for(var j=0;j<node_list.length;j++)way_object.nodes[j]=node_list[j].getAttribute("ref");return_ways.push(way_object)}return return_ways},getTags:function(dom_node,interesting_tags){for(var tag_list=dom_node.getElementsByTagName("tag"),tags={},interesting=!1,j=0;j<tag_list.length;j++){var key=tag_list[j].getAttribute("k");tags[key]=tag_list[j].getAttribute("v"),interesting_tags&&(this.interestingTagsExclude[key]||(interesting=!0))}return interesting_tags?[tags,interesting]:tags},isWayArea:function(way){var poly_shaped=!1,poly_tags=!1;if(way.nodes[0]==way.nodes[way.nodes.length-1]&&(poly_shaped=!0),this.checkTags)for(var key in way.tags)if(this.areaTags[key]){poly_tags=!0;break}return poly_shaped&&(this.checkTags?poly_tags:!0)},write:function(features){OpenLayers.Util.isArray(features)||(features=[features]),this.osm_id=1,this.created_nodes={};var root_node=this.createElementNS(null,"osm");root_node.setAttribute("version","0.5"),root_node.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var i=features.length-1;i>=0;i--)for(var nodes=this.createFeatureNodes(features[i]),j=0;j<nodes.length;j++)root_node.appendChild(nodes[j]);return OpenLayers.Format.XML.prototype.write.apply(this,[root_node])},createFeatureNodes:function(feature){var nodes=[],className=feature.geometry.CLASS_NAME,type=className.substring(className.lastIndexOf(".")+1);type=type.toLowerCase();var builder=this.createXML[type];return builder&&(nodes=builder.apply(this,[feature])),nodes},createXML:{point:function(point){var id=null,geometry=point.geometry?point.geometry:point;this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var already_exists=!1;if(point.osm_id?(id=point.osm_id,this.created_nodes[id]&&(already_exists=!0)):(id=-this.osm_id,this.osm_id++),already_exists)node=this.created_nodes[id];else var node=this.createElementNS(null,"node");return this.created_nodes[id]=node,node.setAttribute("id",id),node.setAttribute("lon",geometry.x),node.setAttribute("lat",geometry.y),point.attributes&&this.serializeTags(point,node),this.setState(point,node),already_exists?[]:[node]},linestring:function(feature){var id,nodes=[],geometry=feature.geometry;feature.osm_id?id=feature.osm_id:(id=-this.osm_id,this.osm_id++);var way=this.createElementNS(null,"way");way.setAttribute("id",id);for(var i=0;i<geometry.components.length;i++){var node=this.createXML.point.apply(this,[geometry.components[i]]);if(node.length){node=node[0];var node_ref=node.getAttribute("id");nodes.push(node)}else node_ref=geometry.components[i].osm_id,node=this.created_nodes[node_ref];this.setState(feature,node);var nd_dom=this.createElementNS(null,"nd");nd_dom.setAttribute("ref",node_ref),way.appendChild(nd_dom)}return this.serializeTags(feature,way),nodes.push(way),nodes},polygon:function(feature){var attrs=OpenLayers.Util.extend({area:"yes"},feature.attributes),feat=new OpenLayers.Feature.Vector(feature.geometry.components[0],attrs);return feat.osm_id=feature.osm_id,this.createXML.linestring.apply(this,[feat])}},serializeTags:function(feature,node){for(var key in feature.attributes){var tag=this.createElementNS(null,"tag");tag.setAttribute("k",key),tag.setAttribute("v",feature.attributes[key]),node.appendChild(tag)}},setState:function(feature,node){if(feature.state){var state=null;switch(feature.state){case OpenLayers.State.UPDATE:state="modify";case OpenLayers.State.DELETE:state="delete"}state&&node.setAttribute("action",state)}},CLASS_NAME:"OpenLayers.Format.OSM"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var i=0,len=this.KEY_EVENTS.length;len>i;i++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[i],this.eventListener);return!0}return!1},deactivate:function(){var deactivated=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var i=0,len=this.KEY_EVENTS.length;len>i;i++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[i],this.eventListener);deactivated=!0}return deactivated},handleKeyEvent:function(evt){this.checkModifiers(evt)&&this.callback(evt.type,[evt])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(layer,options){options=options||{},this.layer=layer,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,options.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[options]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var dragCallbacks={down:function(pixel){this.vertex=null;var feature=this.layer.getFeatureFromEvent(this.handlers.drag.evt);feature?this.dragStart(feature):this.clickout&&(this._unselect=this.feature)},move:function(pixel){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,pixel)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(pixel){this.vertex&&this.dragComplete(this.vertex)}},dragOptions={documentDrag:this.documentDrag,stopDown:!1},keyboardOptions={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,keyboardOptions),drag:new OpenLayers.Handler.Drag(this,dragCallbacks,dragOptions)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var deactivated=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var feature=this.feature;feature&&feature.geometry&&feature.layer&&this.unselectFeature(feature),deactivated=!0}return deactivated},beforeSelectFeature:function(feature){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:feature})},selectFeature:function(feature){if(!(this.feature===feature||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME))){this.beforeSelectFeature(feature)!==!1&&(this.feature&&this.unselectFeature(this.feature),this.feature=feature,this.layer.selectedFeatures.push(feature),this.layer.drawFeature(feature,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var modified=feature.modified;!feature.geometry||modified&&modified.geometry||(this._originalGeometry=feature.geometry.clone())}},unselectFeature:function(feature){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.layer.drawFeature(this.feature,"default"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,feature),this.onModificationEnd(feature),this.layer.events.triggerEvent("afterfeaturemodified",{feature:feature,modified:this.modified}),this.modified=!1},dragStart:function(feature){var isPoint="OpenLayers.Geometry.Point"==feature.geometry.CLASS_NAME;this.standalone||(feature._sketch||!isPoint)&&feature._sketch||(this.toggle&&this.feature===feature&&(this._unselect=feature),this.selectFeature(feature)),(feature._sketch||isPoint)&&(this.vertex=feature,this.handlers.drag.stopDown=!0)},dragVertex:function(vertex,pixel){var pos=this.map.getLonLatFromViewPortPx(pixel),geom=vertex.geometry;geom.move(pos.lon-geom.x,pos.lat-geom.y),this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",{vertex:vertex.geometry,feature:this.feature,pixel:pixel}):(vertex._index?(vertex.geometry.parent.addComponent(vertex.geometry,vertex._index),delete vertex._index,OpenLayers.Util.removeItem(this.virtualVertices,vertex),this.vertices.push(vertex)):vertex==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):vertex!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:vertex.geometry,feature:this.feature,pixel:pixel}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(vertex)},dragComplete:function(vertex){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var feature=this.feature;feature.modified=OpenLayers.Util.extend(feature.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(evt){var code=evt.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,code)){var vertex=this.layer.getFeatureFromEvent(this.handlers.drag.evt);vertex&&-1!=OpenLayers.Util.indexOf(this.vertices,vertex)&&!this.handlers.drag.dragging&&vertex.geometry.parent&&(vertex.geometry.parent.removeComponent(vertex.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:vertex.geometry,feature:this.feature,pixel:evt.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function collectComponentVertices(geometry){var i,vertex,component,len;if("OpenLayers.Geometry.Point"==geometry.CLASS_NAME)vertex=new OpenLayers.Feature.Vector(geometry),vertex._sketch=!0,vertex.renderIntent=control.vertexRenderIntent,control.vertices.push(vertex);else{var numVert=geometry.components.length;for("OpenLayers.Geometry.LinearRing"==geometry.CLASS_NAME&&(numVert-=1),i=0;numVert>i;++i)component=geometry.components[i],"OpenLayers.Geometry.Point"==component.CLASS_NAME?(vertex=new OpenLayers.Feature.Vector(component),vertex._sketch=!0,vertex.renderIntent=control.vertexRenderIntent,control.vertices.push(vertex)):collectComponentVertices(component);if(control.createVertices&&"OpenLayers.Geometry.MultiPoint"!=geometry.CLASS_NAME)for(i=0,len=geometry.components.length;len-1>i;++i){var prevVertex=geometry.components[i],nextVertex=geometry.components[i+1];if("OpenLayers.Geometry.Point"==prevVertex.CLASS_NAME&&"OpenLayers.Geometry.Point"==nextVertex.CLASS_NAME){var x=(prevVertex.x+nextVertex.x)/2,y=(prevVertex.y+nextVertex.y)/2,point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(x,y),null,control.virtualStyle);point.geometry.parent=geometry,point._index=i+1,point._sketch=!0,control.virtualVertices.push(point)}}}}this.vertices=[],this.virtualVertices=[];var control=this;collectComponentVertices.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var geometry=this.feature.geometry,center=geometry.getBounds().getCenterLonLat(),originGeometry=new OpenLayers.Geometry.Point(center.lon,center.lat),origin=new OpenLayers.Feature.Vector(originGeometry);originGeometry.move=function(x,y){OpenLayers.Geometry.Point.prototype.move.call(this,x,y),geometry.move(x,y)},origin._sketch=!0,this.dragHandle=origin,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var geometry=this.feature.geometry,bounds=geometry.getBounds(),center=bounds.getCenterLonLat(),originGeometry=new OpenLayers.Geometry.Point(center.lon,center.lat),radiusGeometry=new OpenLayers.Geometry.Point(bounds.right,bounds.bottom),radius=new OpenLayers.Feature.Vector(radiusGeometry),resize=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,reshape=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,rotate=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;radiusGeometry.move=function(x,y){OpenLayers.Geometry.Point.prototype.move.call(this,x,y);var dx1=this.x-originGeometry.x,dy1=this.y-originGeometry.y,dx0=dx1-x,dy0=dy1-y;if(rotate){var a0=Math.atan2(dy0,dx0),a1=Math.atan2(dy1,dx1),angle=a1-a0;angle*=180/Math.PI,geometry.rotate(angle,originGeometry)}if(resize){var scale,ratio;if(reshape)scale=dy1/dy0,ratio=dx1/dx0/scale;else{var l0=Math.sqrt(dx0*dx0+dy0*dy0),l1=Math.sqrt(dx1*dx1+dy1*dy1);scale=l1/l0}geometry.resize(scale,originGeometry,ratio)}},radius._sketch=!0,this.radiusHandle=radius,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(map){this.handlers.drag.setMap(map),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(evt){("removelayer"==evt.type||"order"==evt.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var index=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(index)},moveLayerBack:function(){var index=this.layer.getZIndex()-1;index>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(index):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(options){options=OpenLayers.Util.applyDefaults({sphericalMercator:!0},options);var name=options.name||"Bing "+(options.type||this.type),newArgs=[name,null,options];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,newArgs),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var params=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),url=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(params),script=document.createElement("script");script.type="text/javascript",script.src=url,script.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(script)},initLayer:function(){var res=this.metadata.resourceSets[0].resources[0],url=res.imageUrl.replace("{quadkey}","${quadkey}");url=url.replace("{culture}",this.culture),url=url.replace(this.protocolRegex,this.protocol),this.url=[];for(var i=0;i<res.imageUrlSubdomains.length;++i)this.url.push(url.replace("{subdomain}",res.imageUrlSubdomains[i]));this.addOptions({maxResolution:Math.min(this.serverResolutions[res.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(res.zoomMax+1-res.zoomMin,this.numZoomLevels)},!0),this.isBaseLayer||this.redraw(),this.updateAttribution()},getURL:function(bounds){if(this.url){for(var xyz=this.getXYZ(bounds),x=xyz.x,y=xyz.y,z=xyz.z,quadDigits=[],i=z;i>0;--i){var digit="0",mask=1<<i-1;0!=(x&mask)&&digit++,0!=(y&mask)&&(digit++,digit++),quadDigits.push(digit)}var quadKey=quadDigits.join(""),url=this.selectUrl(""+x+y+z,this.url);return OpenLayers.String.format(url,{quadkey:quadKey})}},updateAttribution:function(){var metadata=this.metadata;if(metadata.resourceSets&&this.map&&this.map.center){var provider,i,ii,j,jj,bbox,coverage,res=metadata.resourceSets[0].resources[0],extent=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),providers=res.imageryProviders||[],zoom=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),copyrights="";for(i=0,ii=providers.length;ii>i;++i)for(provider=providers[i],j=0,jj=provider.coverageAreas.length;jj>j;++j)coverage=provider.coverageAreas[j],bbox=OpenLayers.Bounds.fromArray(coverage.bbox,!0),extent.intersectsBounds(bbox)&&zoom<=coverage.zoomMax&&zoom>=coverage.zoomMin&&(copyrights+=provider.attribution+" ");var logo=metadata.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:logo,copyrights:copyrights}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.Bing(this.options)),obj=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(metadata){this.metadata=metadata,this.initLayer();var script=document.getElementById(this._callbackId);script.parentNode.removeChild(script),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(style,options){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},style instanceof OpenLayers.Style)this.styles["default"]=style,this.styles.select=style,this.styles.temporary=style,this.styles["delete"]=style;else if("object"==typeof style)for(var key in style)if(style[key]instanceof OpenLayers.Style)this.styles[key]=style[key];else{if("object"!=typeof style[key]){this.styles["default"]=new OpenLayers.Style(style),this.styles.select=new OpenLayers.Style(style),this.styles.temporary=new OpenLayers.Style(style),this.styles["delete"]=new OpenLayers.Style(style);break}this.styles[key]=new OpenLayers.Style(style[key]);
}OpenLayers.Util.extend(this,options)},destroy:function(){for(var key in this.styles)this.styles[key].destroy();this.styles=null},createSymbolizer:function(feature,intent){feature||(feature=new OpenLayers.Feature.Vector),this.styles[intent]||(intent="default"),feature.renderIntent=intent;var defaultSymbolizer={};return this.extendDefault&&"default"!=intent&&(defaultSymbolizer=this.styles["default"].createSymbolizer(feature)),OpenLayers.Util.extend(defaultSymbolizer,this.styles[intent].createSymbolizer(feature))},addUniqueValueRules:function(renderIntent,property,symbolizers,context){var rules=[];for(var value in symbolizers)rules.push(new OpenLayers.Rule({symbolizer:symbolizers[value],context:context,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:property,value:value})}));this.styles[renderIntent].addRules(rules)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(name,options){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var i=0,len=this.strategies.length;len>i;i++)this.strategies[i].setLayer(this)},destroy:function(){if(this.strategies){var strategy,i,len;for(i=0,len=this.strategies.length;len>i;i++)strategy=this.strategies[i],strategy.autoDestroy&&strategy.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(obj){null==obj&&(obj=new OpenLayers.Layer.Vector(this.name,this.getOptions())),obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);for(var features=this.features,len=features.length,clonedFeatures=new Array(len),i=0;len>i;++i)clonedFeatures[i]=features[i].clone();return obj.features=clonedFeatures,obj},refresh:function(obj){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",obj)},assignRenderer:function(){for(var i=0,len=this.renderers.length;len>i;i++){var rendererClass=this.renderers[i],renderer="function"==typeof rendererClass?rendererClass:OpenLayers.Renderer[rendererClass];if(renderer&&renderer.prototype.supported()){this.renderer=new renderer(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(map){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var newSize=this.map.getSize();newSize.w=newSize.w*this.ratio,newSize.h=newSize.h*this.ratio,this.renderer.setSize(newSize)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var strategy,i,len;for(i=0,len=this.strategies.length;len>i;i++)strategy=this.strategies[i],strategy.autoActivate&&strategy.activate()}},removeMap:function(map){if(this.drawn=!1,this.strategies){var strategy,i,len;for(i=0,len=this.strategies.length;len>i;i++)strategy=this.strategies[i],strategy.autoActivate&&strategy.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var newSize=this.map.getSize();newSize.w=newSize.w*this.ratio,newSize.h=newSize.h*this.ratio,this.renderer.setSize(newSize)},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var coordSysUnchanged=!0;if(!dragging){this.renderer.root.style.visibility="hidden";var viewSize=this.map.getSize(),viewWidth=viewSize.w,viewHeight=viewSize.h,offsetLeft=viewWidth/2*this.ratio-viewWidth/2,offsetTop=viewHeight/2*this.ratio-viewHeight/2;offsetLeft+=this.map.layerContainerOriginPx.x,offsetLeft=-Math.round(offsetLeft),offsetTop+=this.map.layerContainerOriginPx.y,offsetTop=-Math.round(offsetTop),this.div.style.left=offsetLeft+"px",this.div.style.top=offsetTop+"px";var extent=this.map.getExtent().scale(this.ratio);if(coordSysUnchanged=this.renderer.setExtent(extent,zoomChanged),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!zoomChanged&&coordSysUnchanged)for(var i in this.unrenderedFeatures){var feature=this.unrenderedFeatures[i];this.drawFeature(feature)}}if(!this.drawn||zoomChanged||!coordSysUnchanged){this.drawn=!0;for(var feature,i=0,len=this.features.length;len>i;i++)this.renderer.locked=i!==len-1,feature=this.features[i],this.drawFeature(feature)}},display:function(display){OpenLayers.Layer.prototype.display.apply(this,arguments);var currentDisplay=this.div.style.display;currentDisplay!=this.renderer.root.style.display&&(this.renderer.root.style.display=currentDisplay)},addFeatures:function(features,options){OpenLayers.Util.isArray(features)||(features=[features]);var notify=!options||!options.silent;if(notify){var event={features:features},ret=this.events.triggerEvent("beforefeaturesadded",event);if(ret===!1)return;features=event.features}for(var featuresAdded=[],i=0,len=features.length;len>i;i++){i!=features.length-1?this.renderer.locked=!0:this.renderer.locked=!1;var feature=features[i];if(this.geometryType&&!(feature.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(feature.layer=this,!feature.style&&this.style&&(feature.style=OpenLayers.Util.extend({},this.style)),notify){if(this.events.triggerEvent("beforefeatureadded",{feature:feature})===!1)continue;this.preFeatureInsert(feature)}featuresAdded.push(feature),this.features.push(feature),this.drawFeature(feature),notify&&(this.events.triggerEvent("featureadded",{feature:feature}),this.onFeatureInsert(feature))}notify&&this.events.triggerEvent("featuresadded",{features:featuresAdded})},removeFeatures:function(features,options){if(features&&0!==features.length){if(features===this.features)return this.removeAllFeatures(options);OpenLayers.Util.isArray(features)||(features=[features]),features===this.selectedFeatures&&(features=features.slice());var notify=!options||!options.silent;notify&&this.events.triggerEvent("beforefeaturesremoved",{features:features});for(var i=features.length-1;i>=0;i--){0!=i&&features[i-1].geometry?this.renderer.locked=!0:this.renderer.locked=!1;var feature=features[i];delete this.unrenderedFeatures[feature.id],notify&&this.events.triggerEvent("beforefeatureremoved",{feature:feature}),this.features=OpenLayers.Util.removeItem(this.features,feature),feature.layer=null,feature.geometry&&this.renderer.eraseFeatures(feature),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,feature)&&OpenLayers.Util.removeItem(this.selectedFeatures,feature),notify&&this.events.triggerEvent("featureremoved",{feature:feature})}notify&&this.events.triggerEvent("featuresremoved",{features:features})}},removeAllFeatures:function(options){var notify=!options||!options.silent,features=this.features;notify&&this.events.triggerEvent("beforefeaturesremoved",{features:features});for(var feature,i=features.length-1;i>=0;i--)feature=features[i],notify&&this.events.triggerEvent("beforefeatureremoved",{feature:feature}),feature.layer=null,notify&&this.events.triggerEvent("featureremoved",{feature:feature});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],notify&&this.events.triggerEvent("featuresremoved",{features:features})},destroyFeatures:function(features,options){var all=void 0==features;if(all&&(features=this.features),features){this.removeFeatures(features,options);for(var i=features.length-1;i>=0;i--)features[i].destroy()}},drawFeature:function(feature,style){if(this.drawn){if("object"!=typeof style){style||feature.state!==OpenLayers.State.DELETE||(style="delete");var renderIntent=style||feature.renderIntent;style=feature.style||this.style,style||(style=this.styleMap.createSymbolizer(feature,renderIntent))}var drawn=this.renderer.drawFeature(feature,style);drawn===!1||null===drawn?this.unrenderedFeatures[feature.id]=feature:delete this.unrenderedFeatures[feature.id]}},eraseFeatures:function(features){this.renderer.eraseFeatures(features)},getFeatureFromEvent:function(evt){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var feature=null,featureId=this.renderer.getFeatureIdFromEvent(evt);return featureId&&(feature="string"==typeof featureId?this.getFeatureById(featureId):featureId),feature},getFeatureBy:function(property,value){for(var feature=null,i=0,len=this.features.length;len>i;++i)if(this.features[i][property]==value){feature=this.features[i];break}return feature},getFeatureById:function(featureId){return this.getFeatureBy("id",featureId)},getFeatureByFid:function(featureFid){return this.getFeatureBy("fid",featureFid)},getFeaturesByAttribute:function(attrName,attrValue){var i,feature,len=this.features.length,foundFeatures=[];for(i=0;len>i;i++)feature=this.features[i],feature&&feature.attributes&&feature.attributes[attrName]===attrValue&&foundFeatures.push(feature);return foundFeatures},onFeatureInsert:function(feature){},preFeatureInsert:function(feature){},getDataExtent:function(){var maxExtent=null,features=this.features;if(features&&features.length>0)for(var geometry=null,i=0,len=features.length;len>i;i++)geometry=features[i].geometry,geometry&&(null===maxExtent&&(maxExtent=new OpenLayers.Bounds),maxExtent.extend(geometry.getBounds()));return maxExtent},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(config){config=config||{},OpenLayers.Layer.Vector.prototype.initialize.apply(this,[config.name,config])},setMap:function(map){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),map.events.register("moveend",this,this.onMoveEnd)},removeMap:function(map){map.events.unregister("moveend",this,this.onMoveEnd),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(ratio){this.ratio=ratio,this.updateGrid(!0)},setMaxFeatures:function(maxFeatures){this.maxFeatures=maxFeatures,this.updateGrid(!0)},setSpacing:function(dx,dy){this.dx=dx,this.dy=dy||dx,this.updateGrid(!0)},setOrigin:function(origin){this.origin=origin,this.updateGrid(!0)},getOrigin:function(){return this.origin||(this.origin=this.map.getExtent().getCenterLonLat()),this.origin},setRotation:function(rotation){this.rotation=rotation,this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var bounds=this.map.getExtent();if(this.rotation){var origin=this.getOrigin(),rotationOrigin=new OpenLayers.Geometry.Point(origin.lon,origin.lat),rect=bounds.toGeometry();rect.rotate(-this.rotation,rotationOrigin),bounds=rect.getBounds()}return bounds},updateGrid:function(force){if(force||this.invalidBounds()){var viewBounds=this.getViewBounds(),origin=this.getOrigin(),rotationOrigin=new OpenLayers.Geometry.Point(origin.lon,origin.lat),viewBoundsWidth=viewBounds.getWidth(),viewBoundsHeight=viewBounds.getHeight(),aspectRatio=viewBoundsWidth/viewBoundsHeight,maxHeight=Math.sqrt(this.dx*this.dy*this.maxFeatures/aspectRatio),maxWidth=maxHeight*aspectRatio,gridWidth=Math.min(viewBoundsWidth*this.ratio,maxWidth),gridHeight=Math.min(viewBoundsHeight*this.ratio,maxHeight),center=viewBounds.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(center.lon-gridWidth/2,center.lat-gridHeight/2,center.lon+gridWidth/2,center.lat+gridHeight/2);for(var x,y,point,rows=Math.floor(gridHeight/this.dy),cols=Math.floor(gridWidth/this.dx),gridLeft=origin.lon+this.dx*Math.ceil((this.gridBounds.left-origin.lon)/this.dx),gridBottom=origin.lat+this.dy*Math.ceil((this.gridBounds.bottom-origin.lat)/this.dy),features=new Array(rows*cols),i=0;cols>i;++i){x=gridLeft+i*this.dx;for(var j=0;rows>j;++j)y=gridBottom+j*this.dy,point=new OpenLayers.Geometry.Point(x,y),this.rotation&&point.rotate(this.rotation,rotationOrigin),features[i*rows+j]=new OpenLayers.Feature.Vector(point)}this.destroyFeatures(this.features,{silent:!0}),this.addFeatures(features,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var overScrollableDiv=!1,allowScroll=!1,overMapDiv=!1,elem=OpenLayers.Event.element(e);null!=elem&&!overMapDiv&&!overScrollableDiv;){if(!overScrollableDiv)try{var overflow;if(elem.currentStyle)overflow=elem.currentStyle.overflow;else{var style=document.defaultView.getComputedStyle(elem,null);overflow=style.getPropertyValue("overflow")}overScrollableDiv=overflow&&"auto"==overflow||"scroll"==overflow}catch(err){}if(!allowScroll&&(allowScroll=OpenLayers.Element.hasClass(elem,"olScrollable"),!allowScroll))for(var i=0,len=this.map.layers.length;len>i;i++){var layer=this.map.layers[i];if(elem==layer.div||elem==layer.pane){allowScroll=!0;break}}overMapDiv=elem==this.map.div,elem=elem.parentNode}if(!overScrollableDiv&&overMapDiv){if(allowScroll){var delta=0;if(e.wheelDelta?(delta=e.wheelDelta,delta%160===0&&(delta=.75*delta),delta/=120):e.detail&&(delta=-(e.detail/Math.abs(e.detail))),this.delta+=delta,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var evt=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(evt)},this),this.interval)}else this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var delta=this.delta;this.delta=0,delta&&(e.xy=this.map.events.getMousePosition(e),0>delta?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,delta):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,delta):1]))},activate:function(evt){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var wheelListener=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",wheelListener),OpenLayers.Event.observe(window,"mousewheel",wheelListener),OpenLayers.Event.observe(document,"mousewheel",wheelListener),!0}return!1},deactivate:function(evt){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var wheelListener=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",wheelListener),OpenLayers.Event.stopObserving(window,"mousewheel",wheelListener),OpenLayers.Event.stopObserving(document,"mousewheel",wheelListener),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(config){OpenLayers.Util.extend(this,config)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"}),OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"}),OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(options){this.symbolizer={},OpenLayers.Util.extend(this,options),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var i in this.symbolizer)this.symbolizer[i]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(feature){var context=this.getContext(feature),applies=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var scale=feature.layer.map.getScale();return this.minScaleDenominator&&(applies=scale>=OpenLayers.Style.createLiteral(this.minScaleDenominator,context)),applies&&this.maxScaleDenominator&&(applies=scale<OpenLayers.Style.createLiteral(this.maxScaleDenominator,context)),applies&&this.filter&&(applies="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(feature):this.filter.evaluate(context)),applies},getContext:function(feature){var context=this.context;return context||(context=feature.attributes||feature.data),"function"==typeof this.context&&(context=this.context(feature)),context},clone:function(){var options=OpenLayers.Util.extend({},this);if(this.symbolizers){var len=this.symbolizers.length;options.symbolizers=new Array(len);for(var i=0;len>i;++i)options.symbolizers[i]=this.symbolizers[i].clone()}else{options.symbolizer={};var value,type;for(var key in this.symbolizer)value=this.symbolizer[key],type=typeof value,"object"===type?options.symbolizer[key]=OpenLayers.Util.extend({},value):"string"===type&&(options.symbolizer[key]=value)}return options.filter=this.filter&&this.filter.clone(),options.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(options)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(options){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[options])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(node,container){var obj={};this.readChildNodes(node,obj),container.outer=obj.components[0]},innerBoundaryIs:function(node,container){var obj={};this.readChildNodes(node,obj),container.inner.push(obj.components[0])},Box:function(node,container){var obj={};this.readChildNodes(node,obj),container.components||(container.components=[]);var min=obj.points[0],max=obj.points[1];container.components.push(new OpenLayers.Bounds(min.x,min.y,max.x,max.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(features){var name;name=OpenLayers.Util.isArray(features)?"wfs:FeatureCollection":"gml:featureMember";var root=this.writeNode(name,features);return this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[root])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(geometry){var node=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[geometry],node),node},coordinates:function(points){for(var point,numPoints=points.length,parts=new Array(numPoints),i=0;numPoints>i;++i)point=points[i],this.xy?parts[i]=point.x+","+point.y:parts[i]=point.y+","+point.x,void 0!=point.z&&(parts[i]+=","+point.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==numPoints?parts[0]:parts.join(" ")})},LineString:function(geometry){var node=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",geometry.components,node),node},Polygon:function(geometry){var node=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",geometry.components[0],node);for(var i=1;i<geometry.components.length;++i)this.writeNode("innerBoundaryIs",geometry.components[i],node);return node},outerBoundaryIs:function(ring){var node=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",ring,node),node},innerBoundaryIs:function(ring){var node=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",ring,node),node},LinearRing:function(ring){var node=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",ring.components,node),node},Box:function(bounds){var node=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:bounds.left,y:bounds.bottom},{x:bounds.right,y:bounds.top}],node),this.srsName&&node.setAttribute("srsName",this.srsName),node}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(options){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[options])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsNotEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(node,filter),obj.filters.push(filter)},PropertyIsLike:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(node,filter);var wildCard=node.getAttribute("wildCard"),singleChar=node.getAttribute("singleChar"),esc=node.getAttribute("escape");filter.value2regex(wildCard,singleChar,esc),obj.filters.push(filter)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsNotEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",filter,node),this.writeOgcExpression(filter.value,node),node},PropertyIsLike:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",filter,node),this.writeNode("Literal",filter.regex2value(),node),node},BBOX:function(filter){var node=this.createElementNSPlus("ogc:BBOX");filter.property&&this.writeNode("PropertyName",filter,node);var box=this.writeNode("gml:Box",filter.value,node);return filter.projection&&box.setAttribute("srsName",filter.projection),node}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(filter,name){var node=this.createElementNSPlus("ogc:"+name);if(this.writeNode("PropertyName",filter,node),filter.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",filter.value,node);else{var child;child=filter.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",filter.value).firstChild:this.writeNode("gml:Box",filter.value),filter.projection&&child.setAttribute("srsName",filter.projection),node.appendChild(child)}return node},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(options){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[options]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[options])},readNode:function(node,obj,first){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(node,obj){obj.insertIds=[],obj.success=!1,this.readChildNodes(node,obj)},InsertResult:function(node,container){var obj={fids:[]};this.readChildNodes(node,obj),container.insertIds=container.insertIds.concat(obj.fids)},TransactionResult:function(node,obj){this.readChildNodes(node,obj)},Status:function(node,obj){this.readChildNodes(node,obj)},SUCCESS:function(node,obj){obj.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(options){options=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},options);var prefix=options.featurePrefix,node=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(prefix?prefix+":":"")+options.featureType}});if(options.srsNameInQuery&&options.srsName&&node.setAttribute("srsName",options.srsName),options.featureNS&&node.setAttribute("xmlns:"+prefix,options.featureNS),options.propertyNames)for(var i=0,len=options.propertyNames.length;len>i;i++)this.writeNode("ogc:PropertyName",{property:options.propertyNames[i]},node);return options.filter&&(this.setFilterProperty(options.filter),this.writeNode("ogc:Filter",options.filter,node)),node}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(yOrdering){this.compare=yOrdering?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(newNode){this.exists(newNode)&&this.remove(newNode);var nodeId=newNode.id;this.determineZIndex(newNode);for(var middle,leftIndex=-1,rightIndex=this.order.length;rightIndex-leftIndex>1;){middle=parseInt((leftIndex+rightIndex)/2);var placement=this.compare(this,newNode,OpenLayers.Util.getElement(this.order[middle]));placement>0?leftIndex=middle:rightIndex=middle}return this.order.splice(rightIndex,0,nodeId),this.indices[nodeId]=this.getZIndex(newNode),this.getNextElement(rightIndex)},remove:function(node){var nodeId=node.id,arrayIndex=OpenLayers.Util.indexOf(this.order,nodeId);if(arrayIndex>=0)if(this.order.splice(arrayIndex,1),delete this.indices[nodeId],this.order.length>0){var lastId=this.order[this.order.length-1];this.maxZIndex=this.indices[lastId]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(node){return null!=this.indices[node.id]},getZIndex:function(node){return node._style.graphicZIndex},determineZIndex:function(node){var zIndex=node._style.graphicZIndex;null==zIndex?(zIndex=this.maxZIndex,node._style.graphicZIndex=zIndex):zIndex>this.maxZIndex&&(this.maxZIndex=zIndex)},getNextElement:function(index){var nextIndex=index+1;if(nextIndex<this.order.length){var nextElement=OpenLayers.Util.getElement(this.order[nextIndex]);return void 0==nextElement&&(nextElement=this.getNextElement(nextIndex)),nextElement}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(indexer,newNode,nextNode){var newZIndex=indexer.getZIndex(newNode),returnVal=0;if(nextNode){var nextZIndex=indexer.getZIndex(nextNode);returnVal=newZIndex-nextZIndex}return returnVal},Z_ORDER_DRAWING_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);return nextNode&&0==returnVal&&(returnVal=1),returnVal},Z_ORDER_Y_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);if(nextNode&&0===returnVal){var result=nextNode._boundsBottom-newNode._boundsBottom;returnVal=0===result?1:result}return returnVal}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(containerID,options){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),options&&(options.zIndexing||options.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(options.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var child,root=this.vectorRoot;if(root)for(;child=root.firstChild;)root.removeChild(child);if(root=this.textRoot)for(;child=root.firstChild;)root.removeChild(child);this.indexer&&this.indexer.clear()},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),resolution=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var rightOfDateLine,ratio=extent.getWidth()/this.map.getExtent().getWidth(),extent=extent.scale(1/ratio),world=this.map.getMaxExtent();world.right>extent.left&&world.right<extent.right?rightOfDateLine=!0:world.left>extent.left&&world.left<extent.right&&(rightOfDateLine=!1),(rightOfDateLine!==this.rightOfDateLine||resolutionChanged)&&(coordSysUnchanged=!1,this.xOffset=rightOfDateLine===!0?world.getWidth()/resolution:0),this.rightOfDateLine=rightOfDateLine}return coordSysUnchanged},getNodeType:function(geometry,style){},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME,rendered=!0;if("OpenLayers.Geometry.Collection"==className||"OpenLayers.Geometry.MultiPoint"==className||"OpenLayers.Geometry.MultiLineString"==className||"OpenLayers.Geometry.MultiPolygon"==className){for(var i=0,len=geometry.components.length;len>i;i++)rendered=this.drawGeometry(geometry.components[i],style,featureId)&&rendered;return rendered}rendered=!1;var removeBackground=!1;if("none"!=style.display&&(style.backgroundGraphic?this.redrawBackgroundNode(geometry.id,geometry,style,featureId):removeBackground=!0,rendered=this.redrawNode(geometry.id,geometry,style,featureId)),0==rendered){var node=document.getElementById(geometry.id);node&&(node._style.backgroundGraphic&&(removeBackground=!0),node.parentNode.removeChild(node))}if(removeBackground){var node=document.getElementById(geometry.id+this.BACKGROUND_ID_SUFFIX);node&&node.parentNode.removeChild(node)}return rendered},redrawNode:function(id,geometry,style,featureId){
style=this.applyDefaultSymbolizer(style);var node=this.nodeFactory(id,this.getNodeType(geometry,style));node._featureId=featureId,node._boundsBottom=geometry.getBounds().bottom,node._geometryClass=geometry.CLASS_NAME,node._style=style;var drawResult=this.drawGeometryNode(node,geometry,style);if(drawResult===!1)return!1;if(node=drawResult.node,this.indexer){var insert=this.indexer.insert(node);insert?this.vectorRoot.insertBefore(node,insert):this.vectorRoot.appendChild(node)}else node.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(node);return this.postDraw(node),drawResult.complete},redrawBackgroundNode:function(id,geometry,style,featureId){var backgroundStyle=OpenLayers.Util.extend({},style);return backgroundStyle.externalGraphic=backgroundStyle.backgroundGraphic,backgroundStyle.graphicXOffset=backgroundStyle.backgroundXOffset,backgroundStyle.graphicYOffset=backgroundStyle.backgroundYOffset,backgroundStyle.graphicZIndex=backgroundStyle.backgroundGraphicZIndex,backgroundStyle.graphicWidth=backgroundStyle.backgroundWidth||backgroundStyle.graphicWidth,backgroundStyle.graphicHeight=backgroundStyle.backgroundHeight||backgroundStyle.graphicHeight,backgroundStyle.backgroundGraphic=null,backgroundStyle.backgroundXOffset=null,backgroundStyle.backgroundYOffset=null,backgroundStyle.backgroundGraphicZIndex=null,this.redrawNode(id+this.BACKGROUND_ID_SUFFIX,geometry,backgroundStyle,null)},drawGeometryNode:function(node,geometry,style){style=style||node._style;var drawn,options={isFilled:void 0===style.fill?!0:style.fill,isStroked:void 0===style.stroke?!!style.strokeWidth:style.stroke};switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":style.graphic===!1&&(options.isFilled=!1,options.isStroked=!1),drawn=this.drawPoint(node,geometry);break;case"OpenLayers.Geometry.LineString":options.isFilled=!1,drawn=this.drawLineString(node,geometry);break;case"OpenLayers.Geometry.LinearRing":drawn=this.drawLinearRing(node,geometry);break;case"OpenLayers.Geometry.Polygon":drawn=this.drawPolygon(node,geometry);break;case"OpenLayers.Geometry.Rectangle":drawn=this.drawRectangle(node,geometry)}return node._options=options,0!=drawn?{node:this.setStyle(node,style,options,geometry),complete:drawn}:!1},postDraw:function(node){},drawPoint:function(node,geometry){},drawLineString:function(node,geometry){},drawLinearRing:function(node,geometry){},drawPolygon:function(node,geometry){},drawRectangle:function(node,geometry){},drawCircle:function(node,geometry){},removeText:function(featureId){var label=document.getElementById(featureId+this.LABEL_ID_SUFFIX);label&&this.textRoot.removeChild(label);var outline=document.getElementById(featureId+this.LABEL_OUTLINE_SUFFIX);outline&&this.textRoot.removeChild(outline)},getFeatureIdFromEvent:function(evt){var target=evt.target,useElement=target&&target.correspondingUseElement,node=useElement?useElement:target||evt.srcElement;return node._featureId},eraseGeometry:function(geometry,featureId){if("OpenLayers.Geometry.MultiPoint"==geometry.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==geometry.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==geometry.CLASS_NAME||"OpenLayers.Geometry.Collection"==geometry.CLASS_NAME)for(var i=0,len=geometry.components.length;len>i;i++)this.eraseGeometry(geometry.components[i],featureId);else{var element=OpenLayers.Util.getElement(geometry.id);if(element&&element.parentNode&&(element.geometry&&(element.geometry.destroy(),element.geometry=null),element.parentNode.removeChild(element),this.indexer&&this.indexer.remove(element),element._style.backgroundGraphic)){var backgroundId=geometry.id+this.BACKGROUND_ID_SUFFIX,bElem=OpenLayers.Util.getElement(backgroundId);bElem&&bElem.parentNode&&bElem.parentNode.removeChild(bElem)}}},nodeFactory:function(id,type){var node=OpenLayers.Util.getElement(id);return node?this.nodeTypeCompare(node,type)||(node.parentNode.removeChild(node),node=this.nodeFactory(id,type)):node=this.createNode(type,id),node},nodeTypeCompare:function(node,type){},createNode:function(type,id){},moveRoot:function(renderer){var root=this.root;renderer.root.parentNode==this.rendererRoot&&(root=renderer.root),root.parentNode.removeChild(root),renderer.rendererRoot.appendChild(root)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(graphicName){return"circle"!=graphicName&&!!graphicName},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(url){url=url||window.location.href;var parameters=OpenLayers.Util.getParameters(url),index=url.indexOf("#");return index>0&&(url="?"+url.substring(index+1,url.length),OpenLayers.Util.extend(parameters,OpenLayers.Util.getParameters(url))),parameters},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var i=0,len=this.map.controls.length;len>i;i++){var control=this.map.controls[i];if(control!=this&&"OpenLayers.Control.ArgParser"==control.CLASS_NAME){control.displayProjection!=this.displayProjection&&(this.displayProjection=control.displayProjection);break}}if(i==this.map.controls.length){var args=this.getParameters();args.layers&&(this.layers=args.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),args.lat&&args.lon&&(this.center=new OpenLayers.LonLat(parseFloat(args.lon),parseFloat(args.lat)),args.zoom&&(this.zoom=parseFloat(args.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var i=0,len=this.layers.length;len>i;i++){var layer=this.map.layers[i],c=this.layers.charAt(i);"B"==c?this.map.setBaseLayer(layer):("T"==c||"F"==c)&&layer.setVisibility("T"==c)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(element,base,options){null===element||"object"!=typeof element||OpenLayers.Util.isElement(element)?(OpenLayers.Control.prototype.initialize.apply(this,[options]),this.element=OpenLayers.Util.getElement(element),this.base=base||document.location.href):(options=element,this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[options]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var i=0,len=this.map.controls.length;len>i;i++){var control=this.map.controls[i];if(control.CLASS_NAME==this.argParserClass.CLASS_NAME){control.displayProjection!=this.displayProjection&&(this.displayProjection=control.displayProjection);break}}i==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div},updateLink:function(){var separator=this.anchor?"#":"?",href=this.base,anchor=null;-1!=href.indexOf("#")&&0==this.anchor&&(anchor=href.substring(href.indexOf("#"),href.length)),-1!=href.indexOf(separator)&&(href=href.substring(0,href.indexOf(separator)));var splits=href.split("#");href=splits[0]+separator+OpenLayers.Util.getParameterString(this.createParams()),anchor&&(href+=anchor),this.anchor&&!this.element?window.location.href=href:this.element.href=href},createParams:function(center,zoom,layers){center=center||this.map.getCenter();var params=OpenLayers.Util.getParameters(this.base);if(center){params.zoom=zoom||this.map.getZoom();var lat=center.lat,lon=center.lon;if(this.displayProjection){var mapPosition=OpenLayers.Projection.transform({x:lon,y:lat},this.map.getProjectionObject(),this.displayProjection);lon=mapPosition.x,lat=mapPosition.y}params.lat=Math.round(1e5*lat)/1e5,params.lon=Math.round(1e5*lon)/1e5,layers=layers||this.map.layers,params.layers="";for(var i=0,len=layers.length;len>i;i++){var layer=layers[i];layer.isBaseLayer?params.layers+=layer==this.map.baseLayer?"B":"0":params.layers+=layer.getVisibility()?"T":"F"}}return params},CLASS_NAME:"OpenLayers.Control.Permalink"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(name,url,options){var newArguments=[];newArguments.push(name,url,{},options),OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){bounds=this.adjustBounds(bounds);var res=this.getServerResolution(),x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w)),y=Math.round((bounds.bottom-this.tileOrigin.lat)/(res*this.tileSize.h)),z=this.getServerZoom(),path=this.serviceVersion+"/"+this.layername+"/"+z+"/"+x+"/"+y+"."+this.type,url=this.url;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(path,url)),url+path},setMap:function(map){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WCSCapabilities"}),OpenLayers.Format.WCSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,splitSpace:/\s+/},defaultPrefix:"wcs",read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));data&&9==data.nodeType&&(data=data.documentElement);var capabilities={};return this.readNode(data,capabilities),capabilities},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1"}),OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"service",readers:{wcs:{WCS_Capabilities:function(node,obj){this.readChildNodes(node,obj)},Service:function(node,obj){obj.service={},this.readChildNodes(node,obj.service)},name:function(node,service){service.name=this.getChildValue(node)},label:function(node,service){service.label=this.getChildValue(node)},keywords:function(node,service){service.keywords=[],this.readChildNodes(node,service.keywords)},keyword:function(node,keywords){keywords.push(this.getChildValue(node))},responsibleParty:function(node,service){service.responsibleParty={},this.readChildNodes(node,service.responsibleParty)},individualName:function(node,responsibleParty){responsibleParty.individualName=this.getChildValue(node)},organisationName:function(node,responsibleParty){responsibleParty.organisationName=this.getChildValue(node)},positionName:function(node,responsibleParty){responsibleParty.positionName=this.getChildValue(node)},contactInfo:function(node,responsibleParty){responsibleParty.contactInfo={},this.readChildNodes(node,responsibleParty.contactInfo)},phone:function(node,contactInfo){contactInfo.phone={},this.readChildNodes(node,contactInfo.phone)},voice:function(node,phone){phone.voice=this.getChildValue(node)},facsimile:function(node,phone){phone.facsimile=this.getChildValue(node)},address:function(node,contactInfo){contactInfo.address={},this.readChildNodes(node,contactInfo.address)},deliveryPoint:function(node,address){address.deliveryPoint=this.getChildValue(node)},city:function(node,address){address.city=this.getChildValue(node)},postalCode:function(node,address){address.postalCode=this.getChildValue(node)},country:function(node,address){address.country=this.getChildValue(node)},electronicMailAddress:function(node,address){address.electronicMailAddress=this.getChildValue(node)},fees:function(node,service){service.fees=this.getChildValue(node)},accessConstraints:function(node,service){service.accessConstraints=this.getChildValue(node)},ContentMetadata:function(node,obj){obj.contentMetadata=[],this.readChildNodes(node,obj.contentMetadata)},CoverageOfferingBrief:function(node,contentMetadata){var coverageOfferingBrief={};this.readChildNodes(node,coverageOfferingBrief),contentMetadata.push(coverageOfferingBrief)},name:function(node,coverageOfferingBrief){coverageOfferingBrief.name=this.getChildValue(node)},label:function(node,coverageOfferingBrief){coverageOfferingBrief.label=this.getChildValue(node)},lonLatEnvelope:function(node,coverageOfferingBrief){var nodeList=this.getElementsByTagNameNS(node,"http://www.opengis.net/gml","pos");if(2==nodeList.length){var min={},max={};OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[nodeList[0],min]),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[nodeList[1],max]),coverageOfferingBrief.lonLatEnvelope={},coverageOfferingBrief.lonLatEnvelope.srsName=node.getAttribute("srsName"),coverageOfferingBrief.lonLatEnvelope.min=min.points[0],coverageOfferingBrief.lonLatEnvelope.max=max.points[0]}}}},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_0_0"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return activated&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),deactivated},load:function(options){var layer=this.layer;layer.events.triggerEvent("loadstart",{filter:layer.filter}),layer.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:layer.filter,scope:this},options)),layer.events.un({visibilitychanged:this.load,scope:this})},merge:function(resp){var layer=this.layer;layer.destroyFeatures();var features=resp.features;if(features&&features.length>0){var remote=layer.projection,local=layer.map.getProjectionObject();if(!local.equals(remote))for(var geom,i=0,len=features.length;len>i;++i)geom=features[i].geometry,geom&&geom.transform(remote,local);layer.addFeatures(features)}layer.events.triggerEvent("loadend",{response:resp})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"â",zoomOutId:"olZoomOutLink",draw:function(){var div=OpenLayers.Control.prototype.draw.apply(this),links=this.getOrCreateLinks(div),zoomIn=links.zoomIn,zoomOut=links.zoomOut,eventsInstance=this.map.events;return zoomOut.parentNode!==div&&(eventsInstance=this.events,eventsInstance.attachToElement(zoomOut.parentNode)),eventsInstance.register("buttonclick",this,this.onZoomClick),this.zoomInLink=zoomIn,this.zoomOutLink=zoomOut,div},getOrCreateLinks:function(el){var zoomIn=document.getElementById(this.zoomInId),zoomOut=document.getElementById(this.zoomOutId);return zoomIn||(zoomIn=document.createElement("a"),zoomIn.href="#zoomIn",zoomIn.appendChild(document.createTextNode(this.zoomInText)),zoomIn.className="olControlZoomIn",el.appendChild(zoomIn)),OpenLayers.Element.addClass(zoomIn,"olButton"),zoomOut||(zoomOut=document.createElement("a"),zoomOut.href="#zoomOut",zoomOut.appendChild(document.createTextNode(this.zoomOutText)),zoomOut.className="olControlZoomOut",el.appendChild(zoomOut)),OpenLayers.Element.addClass(zoomOut,"olButton"),{zoomIn:zoomIn,zoomOut:zoomOut}},onZoomClick:function(evt){var button=evt.buttonElement;button===this.zoomInLink?this.map.zoomIn():button===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(pointFeatures,options){if(pointFeatures.length<2)throw new Error("At least two point features have to be added to create a line from");for(var pointFeature,startPoint,endPoint,lines=new Array(pointFeatures.length-1),i=0,len=pointFeatures.length;len>i;i++){if(pointFeature=pointFeatures[i],endPoint=pointFeature.geometry){if("OpenLayers.Geometry.Point"!=endPoint.CLASS_NAME)throw new TypeError("Only features with point geometries are supported.")}else{var lonlat=pointFeature.lonlat;endPoint=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat)}if(i>0){var attributes=null!=this.dataFrom?pointFeatures[i+this.dataFrom].data||pointFeatures[i+this.dataFrom].attributes:null,style=null!=this.styleFrom?pointFeatures[i+this.styleFrom].style:null,line=new OpenLayers.Geometry.LineString([startPoint,endPoint]);lines[i-1]=new OpenLayers.Feature.Vector(line,attributes,style)}startPoint=endPoint}this.addFeatures(lines,options)},CLASS_NAME:"OpenLayers.Layer.PointTrack"}),OpenLayers.Layer.PointTrack.SOURCE_NODE=-1,OpenLayers.Layer.PointTrack.TARGET_NODE=0,OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0},OpenLayers.Protocol.WFS=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.WFS.DEFAULTS);var cls=OpenLayers.Protocol.WFS["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported WFS version: "+options.version;return new cls(options)},OpenLayers.Protocol.WFS.fromWMSLayer=function(layer,options){var typeName,featurePrefix,param=layer.params.LAYERS,parts=(OpenLayers.Util.isArray(param)?param[0]:param).split(":");parts.length>1&&(featurePrefix=parts[0]),typeName=parts.pop();var protocolOptions={url:layer.url,featureType:typeName,featurePrefix:featurePrefix,srsName:layer.projection&&layer.projection.getCode()||layer.map&&layer.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(options,protocolOptions))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(name,options){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(opacity){if(opacity!=this.opacity){this.opacity=opacity;for(var i=0,len=this.markers.length;len>i;i++)this.markers[i].setOpacity(this.opacity)}},moveTo:function(bounds,zoomChanged,dragging){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),zoomChanged||!this.drawn){for(var i=0,len=this.markers.length;len>i;i++)this.drawMarker(this.markers[i]);this.drawn=!0}},addMarker:function(marker){this.markers.push(marker),this.opacity<1&&marker.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(marker.map=this.map,this.drawMarker(marker))},removeMarker:function(marker){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,marker),marker.erase())},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(marker){var px=this.map.getLayerPxFromLonLat(marker.lonlat);if(null==px)marker.display(!1);else if(marker.isDrawn())marker.icon&&marker.icon.moveTo(px);else{var markerImg=marker.draw(px);this.div.appendChild(markerImg)}},getDataExtent:function(){var maxExtent=null;if(this.markers&&this.markers.length>0)for(var maxExtent=new OpenLayers.Bounds,i=0,len=this.markers.length;len>i;i++){var marker=this.markers[i];maxExtent.extend(marker.lonlat)}return maxExtent},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(direction,options){this.direction=direction,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[options])},trigger:function(){if(this.map){var getSlideFactor=OpenLayers.Function.bind(function(dim){return this.slideRatio?this.map.getSize()[dim]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-getSlideFactor("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,getSlideFactor("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-getSlideFactor("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(getSlideFactor("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Format.CSWGetDomain=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.CSWGetDomain.DEFAULTS);var cls=OpenLayers.Format.CSWGetDomain["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported CSWGetDomain version: "+options.version;return new cls(options)},OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"},OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var obj={};return this.readNode(data,obj),obj},readers:{csw:{GetDomainResponse:function(node,obj){this.readChildNodes(node,obj)},DomainValues:function(node,obj){OpenLayers.Util.isArray(obj.DomainValues)||(obj.DomainValues=[]);for(var attrs=node.attributes,domainValue={},i=0,len=attrs.length;len>i;++i)domainValue[attrs[i].name]=attrs[i].nodeValue;this.readChildNodes(node,domainValue),obj.DomainValues.push(domainValue)},PropertyName:function(node,obj){obj.PropertyName=this.getChildValue(node)},ParameterName:function(node,obj){obj.ParameterName=this.getChildValue(node)},ListOfValues:function(node,obj){OpenLayers.Util.isArray(obj.ListOfValues)||(obj.ListOfValues=[]),this.readChildNodes(node,obj.ListOfValues)},Value:function(node,obj){for(var attrs=node.attributes,value={},i=0,len=attrs.length;len>i;++i)value[attrs[i].name]=attrs[i].nodeValue;value.value=this.getChildValue(node),obj.push({Value:value})},ConceptualScheme:function(node,obj){obj.ConceptualScheme={},this.readChildNodes(node,obj.ConceptualScheme)},Name:function(node,obj){obj.Name=this.getChildValue(node)},Document:function(node,obj){obj.Document=this.getChildValue(node)},Authority:function(node,obj){obj.Authority=this.getChildValue(node)},RangeOfValues:function(node,obj){obj.RangeOfValues={},this.readChildNodes(node,obj.RangeOfValues)},MinValue:function(node,obj){for(var attrs=node.attributes,value={},i=0,len=attrs.length;len>i;++i)value[attrs[i].name]=attrs[i].nodeValue;value.value=this.getChildValue(node),obj.MinValue=value},MaxValue:function(node,obj){for(var attrs=node.attributes,value={},i=0,len=attrs.length;len>i;++i)value[attrs[i].name]=attrs[i].nodeValue;value.value=this.getChildValue(node),obj.MaxValue=value}}},write:function(options){var node=this.writeNode("csw:GetDomain",options);return OpenLayers.Format.XML.prototype.write.apply(this,[node])},writers:{csw:{GetDomain:function(options){var node=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});return options.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",options.PropertyName||this.PropertyName,node):(options.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",options.ParameterName||this.ParameterName,node),this.readChildNodes(node,options),node},PropertyName:function(value){var node=this.createElementNSPlus("csw:PropertyName",{value:value});return node},ParameterName:function(value){var node=this.createElementNSPlus("csw:ParameterName",{value:value});return node}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"}),OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(data){var axl=new OpenLayers.Format.ArcXML,parsed=axl.read(data);return parsed.features.feature}}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.options=options||{},this.options.layer&&this.setLayer(this.options.layer);var defaults=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(defaults,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(layer){this.active?(this.deactivate(),this.layer=layer,this.activate()):this.layer=layer},setTargets:function(targets){if(this.targets=[],targets&&targets.length)for(var target,i=0,len=targets.length;len>i;++i)target=targets[i],target instanceof OpenLayers.Layer.Vector?this.addTargetLayer(target):this.addTarget(target)},addTargetLayer:function(layer){this.addTarget({layer:layer})},addTarget:function(target){target=OpenLayers.Util.applyDefaults(target,this.defaults),target.nodeTolerance=target.nodeTolerance||target.tolerance,target.vertexTolerance=target.vertexTolerance||target.tolerance,target.edgeTolerance=target.edgeTolerance||target.tolerance,this.targets.push(target)},removeTargetLayer:function(layer){for(var target,i=this.targets.length-1;i>=0;--i)target=this.targets[i],target.layer===layer&&this.removeTarget(target)},removeTarget:function(target){return OpenLayers.Util.removeItem(this.targets,target)},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this);return activated&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),activated},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this);return deactivated&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,deactivated},onSketchModified:function(event){this.feature=event.feature,this.considerSnapping(event.vertex,event.vertex)},onVertexModified:function(event){this.feature=event.feature;var loc=this.layer.map.getLonLatFromViewPortPx(event.pixel);this.considerSnapping(event.vertex,new OpenLayers.Geometry.Point(loc.lon,loc.lat))},considerSnapping:function(point,loc){for(var result,target,best={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},snapped=!1,i=0,len=this.targets.length;len>i;++i)if(target=this.targets[i],result=this.testTarget(target,loc)){if(this.greedy){best=result,best.target=target,snapped=!0;break}(result.rank<best.rank||result.rank===best.rank&&result.dist<best.dist)&&(best=result,best.target=target,snapped=!0)}if(snapped){var proceed=this.events.triggerEvent("beforesnap",{point:point,x:best.x,y:best.y,distance:best.dist,layer:best.target.layer,snapType:this.precedence[best.rank]});proceed!==!1?(point.x=best.x,point.y=best.y,this.point=point,this.events.triggerEvent("snap",{point:point,snapType:this.precedence[best.rank],layer:best.target.layer,distance:best.dist})):snapped=!1}this.point&&!snapped&&(point.x=loc.x,point.y=loc.y,this.point=null,this.events.triggerEvent("unsnap",{point:point}))},testTarget:function(target,loc){var resolution=this.layer.map.getResolution();if("minResolution"in target&&resolution<target.minResolution)return null;if("maxResolution"in target&&resolution>=target.maxResolution)return null;for(var feature,type,vertices,vertex,closest,dist,found,tolerance={node:this.getGeoTolerance(target.nodeTolerance,resolution),vertex:this.getGeoTolerance(target.vertexTolerance,resolution),edge:this.getGeoTolerance(target.edgeTolerance,resolution)},maxTolerance=Math.max(tolerance.node,tolerance.vertex,tolerance.edge),result={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},eligible=!1,features=target.layer.features,numTypes=this.precedence.length,ll=new OpenLayers.LonLat(loc.x,loc.y),i=0,len=features.length;len>i;++i)if(feature=features[i],feature!==this.feature&&!feature._sketch&&feature.state!==OpenLayers.State.DELETE&&(!target.filter||target.filter.evaluate(feature))&&feature.atPoint(ll,maxTolerance,maxTolerance))for(var j=0,stop=Math.min(result.rank+1,numTypes);stop>j;++j)if(type=this.precedence[j],target[type])if("edge"===type){if(closest=feature.geometry.distanceTo(loc,{details:!0}),dist=closest.distance,dist<=tolerance[type]&&dist<result.dist){result={rank:j,dist:dist,x:closest.x0,y:closest.y0},eligible=!0;break}}else{vertices=feature.geometry.getVertices("node"===type),found=!1;for(var k=0,klen=vertices.length;klen>k;++k)vertex=vertices[k],dist=vertex.distanceTo(loc),dist<=tolerance[type]&&(j<result.rank||j===result.rank&&dist<result.dist)&&(result={rank:j,dist:dist,x:vertex.x,y:vertex.y},eligible=!0,found=!0);if(found)break}return eligible?result:null},getGeoTolerance:function(tolerance,resolution){resolution!==this.resolution&&(this.resolution=resolution,this.geoToleranceCache={});var geoTolerance=this.geoToleranceCache[tolerance];return void 0===geoTolerance&&(geoTolerance=tolerance*resolution,this.geoToleranceCache[tolerance]=geoTolerance),geoTolerance},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(node,obj){obj.exceptionReport={version:node.getAttribute("version"),language:node.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(node,obj.exceptionReport)},AllowedValues:function(node,parameter){parameter.allowedValues={},this.readChildNodes(node,parameter.allowedValues)},AnyValue:function(node,parameter){parameter.anyValue=!0},DataType:function(node,parameter){parameter.dataType=this.getChildValue(node)},Range:function(node,allowedValues){allowedValues.range={},this.readChildNodes(node,allowedValues.range)},MinimumValue:function(node,range){range.minValue=this.getChildValue(node)},MaximumValue:function(node,range){range.maxValue=this.getChildValue(node)},Identifier:function(node,obj){obj.identifier=this.getChildValue(node)},SupportedCRS:function(node,obj){
obj.supportedCRS=this.getChildValue(node)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(range){var node=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":range.closure}});return this.writeNode("ows:MinimumValue",range.minValue,node),this.writeNode("ows:MaximumValue",range.maxValue,node),node},MinimumValue:function(minValue){var node=this.createElementNSPlus("ows:MinimumValue",{value:minValue});return node},MaximumValue:function(maxValue){var node=this.createElementNSPlus("ows:MaximumValue",{value:maxValue});return node},Value:function(value){var node=this.createElementNSPlus("ows:Value",{value:value});return node}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(options){var node=this.writeNode("wcs:GetCoverage",options);return this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[node])},writers:{wcs:{GetCoverage:function(options){var node=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:options.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",options.identifier,node),this.writeNode("wcs:DomainSubset",options.domainSubset,node),this.writeNode("wcs:Output",options.output,node),node},DomainSubset:function(domainSubset){var node=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",domainSubset.boundingBox,node),domainSubset.temporalSubset&&this.writeNode("wcs:TemporalSubset",domainSubset.temporalSubset,node),node},TemporalSubset:function(temporalSubset){for(var node=this.createElementNSPlus("wcs:TemporalSubset",{}),i=0,len=temporalSubset.timePeriods.length;len>i;++i)this.writeNode("wcs:TimePeriod",temporalSubset.timePeriods[i],node);return node},TimePeriod:function(timePeriod){var node=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",timePeriod.begin,node),this.writeNode("wcs:EndPosition",timePeriod.end,node),timePeriod.resolution&&this.writeNode("wcs:TimeResolution",timePeriod.resolution,node),node},BeginPosition:function(begin){var node=this.createElementNSPlus("wcs:BeginPosition",{value:begin});return node},EndPosition:function(end){var node=this.createElementNSPlus("wcs:EndPosition",{value:end});return node},TimeResolution:function(resolution){var node=this.createElementNSPlus("wcs:TimeResolution",{value:resolution});return node},Output:function(output){var node=this.createElementNSPlus("wcs:Output",{attributes:{format:output.format,store:output.store}});return output.gridCRS&&this.writeNode("wcs:GridCRS",output.gridCRS,node),node},GridCRS:function(gridCRS){var node=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",gridCRS.baseCRS,node),gridCRS.type&&this.writeNode("wcs:GridType",gridCRS.type,node),gridCRS.origin&&this.writeNode("wcs:GridOrigin",gridCRS.origin,node),this.writeNode("wcs:GridOffsets",gridCRS.offsets,node),gridCRS.CS&&this.writeNode("wcs:GridCS",gridCRS.CS,node),node},GridBaseCRS:function(baseCRS){return this.createElementNSPlus("wcs:GridBaseCRS",{value:baseCRS})},GridOrigin:function(origin){return this.createElementNSPlus("wcs:GridOrigin",{value:origin})},GridType:function(type){return this.createElementNSPlus("wcs:GridType",{value:type})},GridOffsets:function(offsets){return this.createElementNSPlus("wcs:GridOffsets",{value:offsets})},GridCS:function(CS){return this.createElementNSPlus("wcs:GridCS",{value:CS})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(options){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){this.features=[],this.styles={},this.fetched={};var options={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(data,options)},parseData:function(data,options){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));for(var types=["Link","NetworkLink","Style","StyleMap","Placemark"],i=0,len=types.length;len>i;++i){var type=types[i],nodes=this.getElementsByTagNameNS(data,"*",type);if(0!=nodes.length)switch(type.toLowerCase()){case"link":case"networklink":this.parseLinks(nodes,options);break;case"style":this.extractStyles&&this.parseStyles(nodes,options);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(nodes,options);break;case"placemark":this.parseFeatures(nodes,options)}}return this.features},parseLinks:function(nodes,options){if(options.depth>=this.maxDepth)return!1;var newOptions=OpenLayers.Util.extend({},options);newOptions.depth++;for(var i=0,len=nodes.length;len>i;i++){var href=this.parseProperty(nodes[i],"*","href");if(href&&!this.fetched[href]){this.fetched[href]=!0;var data=this.fetchLink(href);data&&this.parseData(data,newOptions)}}},fetchLink:function(href){var request=OpenLayers.Request.GET({url:href,async:!1});return request?request.responseText:void 0},parseStyles:function(nodes,options){for(var i=0,len=nodes.length;len>i;i++){var style=this.parseStyle(nodes[i]);if(style){var styleName=(options.styleBaseUrl||"")+"#"+style.id;this.styles[styleName]=style}}},parseKmlColor:function(kmlColor){var color=null;if(kmlColor){var matches=kmlColor.match(this.regExes.kmlColor);matches&&(color={color:"#"+matches[4]+matches[3]+matches[2],opacity:parseInt(matches[1],16)/255})}return color},parseStyle:function(node){for(var type,styleTypeNode,style={},types=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],i=0,len=types.length;len>i;++i)if(type=types[i],styleTypeNode=this.getElementsByTagNameNS(node,"*",type)[0])switch(type.toLowerCase()){case"linestyle":var kmlColor=this.parseProperty(styleTypeNode,"*","color"),color=this.parseKmlColor(kmlColor);color&&(style.strokeColor=color.color,style.strokeOpacity=color.opacity);var width=this.parseProperty(styleTypeNode,"*","width");width&&(style.strokeWidth=width);break;case"polystyle":var kmlColor=this.parseProperty(styleTypeNode,"*","color"),color=this.parseKmlColor(kmlColor);color&&(style.fillOpacity=color.opacity,style.fillColor=color.color);var fill=this.parseProperty(styleTypeNode,"*","fill");"0"==fill&&(style.fillColor="none");var outline=this.parseProperty(styleTypeNode,"*","outline");"0"==outline&&(style.strokeWidth="0");break;case"iconstyle":var scale=parseFloat(this.parseProperty(styleTypeNode,"*","scale")||1),width=32*scale,height=32*scale,iconNode=this.getElementsByTagNameNS(styleTypeNode,"*","Icon")[0];if(iconNode){var href=this.parseProperty(iconNode,"*","href");if(href){var w=this.parseProperty(iconNode,"*","w"),h=this.parseProperty(iconNode,"*","h"),google="http://maps.google.com/mapfiles/kml";!OpenLayers.String.startsWith(href,google)||w||h||(w=64,h=64,scale/=2),w=w||h,h=h||w,w&&(width=parseInt(w)*scale),h&&(height=parseInt(h)*scale);var matches=href.match(this.regExes.kmlIconPalette);if(matches){var palette=matches[1],file_extension=matches[2],x=this.parseProperty(iconNode,"*","x"),y=this.parseProperty(iconNode,"*","y"),posX=x?x/32:0,posY=y?7-y/32:7,pos=8*posY+posX;href="http://maps.google.com/mapfiles/kml/pal"+palette+"/icon"+pos+file_extension}style.graphicOpacity=1,style.externalGraphic=href}}var hotSpotNode=this.getElementsByTagNameNS(styleTypeNode,"*","hotSpot")[0];if(hotSpotNode){var x=parseFloat(hotSpotNode.getAttribute("x")),y=parseFloat(hotSpotNode.getAttribute("y")),xUnits=hotSpotNode.getAttribute("xunits");"pixels"==xUnits?style.graphicXOffset=-x*scale:"insetPixels"==xUnits?style.graphicXOffset=-width+x*scale:"fraction"==xUnits&&(style.graphicXOffset=-width*x);var yUnits=hotSpotNode.getAttribute("yunits");"pixels"==yUnits?style.graphicYOffset=-height+y*scale+1:"insetPixels"==yUnits?style.graphicYOffset=-(y*scale)+1:"fraction"==yUnits&&(style.graphicYOffset=-height*(1-y)+1)}style.graphicWidth=width,style.graphicHeight=height;break;case"balloonstyle":var balloonStyle=OpenLayers.Util.getXmlNodeValue(styleTypeNode);balloonStyle&&(style.balloonStyle=balloonStyle.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var kmlColor=this.parseProperty(styleTypeNode,"*","color"),color=this.parseKmlColor(kmlColor);color&&(style.fontColor=color.color,style.fontOpacity=color.opacity)}!style.strokeColor&&style.fillColor&&(style.strokeColor=style.fillColor);var id=node.getAttribute("id");return id&&style&&(style.id=id),style},parseStyleMaps:function(nodes,options){for(var i=0,len=nodes.length;len>i;i++)for(var node=nodes[i],pairs=this.getElementsByTagNameNS(node,"*","Pair"),id=node.getAttribute("id"),j=0,jlen=pairs.length;jlen>j;j++){var pair=pairs[j],key=this.parseProperty(pair,"*","key"),styleUrl=this.parseProperty(pair,"*","styleUrl");styleUrl&&"normal"==key&&(this.styles[(options.styleBaseUrl||"")+"#"+id]=this.styles[(options.styleBaseUrl||"")+styleUrl])}},parseFeatures:function(nodes,options){for(var features=[],i=0,len=nodes.length;len>i;i++){var featureNode=nodes[i],feature=this.parseFeature.apply(this,[featureNode]);if(!feature)throw"Bad Placemark: "+i;if(this.extractStyles&&feature.attributes&&feature.attributes.styleUrl&&(feature.style=this.getStyle(feature.attributes.styleUrl,options)),this.extractStyles){var inlineStyleNode=this.getElementsByTagNameNS(featureNode,"*","Style")[0];if(inlineStyleNode){var inlineStyle=this.parseStyle(inlineStyleNode);inlineStyle&&(feature.style=OpenLayers.Util.extend(feature.style,inlineStyle))}}if(this.extractTracks){var tracks=this.getElementsByTagNameNS(featureNode,this.namespaces.gx,"Track");if(tracks&&tracks.length>0){var track=tracks[0],container={features:[],feature:feature};this.readNode(track,container),container.features.length>0&&features.push.apply(features,container.features)}}else features.push(feature)}this.features=this.features.concat(features)},readers:{kml:{when:function(node,container){container.whens.push(OpenLayers.Date.parse(this.getChildValue(node)))},_trackPointAttribute:function(node,container){var name=node.nodeName.split(":").pop();container.attributes[name].push(this.getChildValue(node))}},gx:{Track:function(node,container){var obj={whens:[],points:[],angles:[]};if(this.trackAttributes){var name;obj.attributes={};for(var i=0,ii=this.trackAttributes.length;ii>i;++i)name=this.trackAttributes[i],obj.attributes[name]=[],name in this.readers.kml||(this.readers.kml[name]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(node,obj),obj.whens.length!==obj.points.length)throw new Error("gx:Track with unequal number of when ("+obj.whens.length+") and gx:coord ("+obj.points.length+") elements.");var hasAngles=obj.angles.length>0;if(hasAngles&&obj.whens.length!==obj.angles.length)throw new Error("gx:Track with unequal number of when ("+obj.whens.length+") and gx:angles ("+obj.angles.length+") elements.");for(var feature,point,angles,i=0,ii=obj.whens.length;ii>i;++i){if(feature=container.feature.clone(),feature.fid=container.feature.fid||container.feature.id,point=obj.points[i],feature.geometry=point,"z"in point&&(feature.attributes.altitude=point.z),this.internalProjection&&this.externalProjection&&feature.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(var j=0,jj=this.trackAttributes.length;jj>j;++j){var name=this.trackAttributes[j];feature.attributes[name]=obj.attributes[name][i]}feature.attributes.when=obj.whens[i],feature.attributes.trackId=container.feature.id,hasAngles&&(angles=obj.angles[i],feature.attributes.heading=parseFloat(angles[0]),feature.attributes.tilt=parseFloat(angles[1]),feature.attributes.roll=parseFloat(angles[2])),container.features.push(feature)}},coord:function(node,container){var str=this.getChildValue(node),coords=str.replace(this.regExes.trimSpace,"").split(/\s+/),point=new OpenLayers.Geometry.Point(coords[0],coords[1]);coords.length>2&&(point.z=parseFloat(coords[2])),container.points.push(point)},angles:function(node,container){var str=this.getChildValue(node),parts=str.replace(this.regExes.trimSpace,"").split(/\s+/);container.angles.push(parts)}}},parseFeature:function(node){for(var type,nodeList,geometry,parser,order=["MultiGeometry","Polygon","LineString","Point"],i=0,len=order.length;len>i;++i)if(type=order[i],this.internalns=node.namespaceURI?node.namespaceURI:this.kmlns,nodeList=this.getElementsByTagNameNS(node,this.internalns,type),nodeList.length>0){var parser=this.parseGeometry[type.toLowerCase()];if(!parser)throw new TypeError("Unsupported geometry type: "+type);geometry=parser.apply(this,[nodeList[0]]),this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection);break}var attributes;this.extractAttributes&&(attributes=this.parseAttributes(node));var feature=new OpenLayers.Feature.Vector(geometry,attributes),fid=node.getAttribute("id")||node.getAttribute("name");return null!=fid&&(feature.fid=fid),feature},getStyle:function(styleUrl,options){var styleBaseUrl=OpenLayers.Util.removeTail(styleUrl),newOptions=OpenLayers.Util.extend({},options);if(newOptions.depth++,newOptions.styleBaseUrl=styleBaseUrl,!this.styles[styleUrl]&&!OpenLayers.String.startsWith(styleUrl,"#")&&newOptions.depth<=this.maxDepth&&!this.fetched[styleBaseUrl]){var data=this.fetchLink(styleBaseUrl);data&&this.parseData(data,newOptions)}var style=OpenLayers.Util.extend({},this.styles[styleUrl]);return style},parseGeometry:{point:function(node){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"coordinates"),coords=[];if(nodeList.length>0){var coordString=nodeList[0].firstChild.nodeValue;coordString=coordString.replace(this.regExes.removeSpace,""),coords=coordString.split(",")}var point=null;if(!(coords.length>1))throw"Bad coordinate string: "+coordString;return 2==coords.length&&(coords[2]=null),point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])},linestring:function(node,ring){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"coordinates"),line=null;if(nodeList.length>0){var coordString=this.getChildValue(nodeList[0]);coordString=coordString.replace(this.regExes.trimSpace,""),coordString=coordString.replace(this.regExes.trimComma,",");for(var coords,numCoords,pointList=coordString.split(this.regExes.splitSpace),numPoints=pointList.length,points=new Array(numPoints),i=0;numPoints>i;++i){if(coords=pointList[i].split(","),numCoords=coords.length,!(numCoords>1))throw"Bad LineString point coordinates: "+pointList[i];2==coords.length&&(coords[2]=null),points[i]=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])}if(!numPoints)throw"Bad LineString coordinates: "+coordString;line=ring?new OpenLayers.Geometry.LinearRing(points):new OpenLayers.Geometry.LineString(points)}return line},polygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"LinearRing"),numRings=nodeList.length,components=new Array(numRings);if(numRings>0)for(var ring,i=0,len=nodeList.length;len>i;++i){if(ring=this.parseGeometry.linestring.apply(this,[nodeList[i],!0]),!ring)throw"Bad LinearRing geometry: "+i;components[i]=ring}return new OpenLayers.Geometry.Polygon(components)},multigeometry:function(node){for(var child,parser,parts=[],children=node.childNodes,i=0,len=children.length;len>i;++i)if(child=children[i],1==child.nodeType){var type=child.prefix?child.nodeName.split(":")[1]:child.nodeName,parser=this.parseGeometry[type.toLowerCase()];parser&&parts.push(parser.apply(this,[child]))}return new OpenLayers.Geometry.Collection(parts)}},parseAttributes:function(node){var attributes={},edNodes=node.getElementsByTagName("ExtendedData");edNodes.length&&(attributes=this.parseExtendedData(edNodes[0]));for(var child,grandchildren,grandchild,children=node.childNodes,i=0,len=children.length;len>i;++i)if(child=children[i],1==child.nodeType&&(grandchildren=child.childNodes,grandchildren.length>=1&&grandchildren.length<=3)){var grandchild;switch(grandchildren.length){case 1:grandchild=grandchildren[0];break;case 2:var c1=grandchildren[0],c2=grandchildren[1];grandchild=3==c1.nodeType||4==c1.nodeType?c1:c2;break;case 3:default:grandchild=grandchildren[1]}if(3==grandchild.nodeType||4==grandchild.nodeType){var name=child.prefix?child.nodeName.split(":")[1]:child.nodeName,value=OpenLayers.Util.getXmlNodeValue(grandchild);value&&(value=value.replace(this.regExes.trimSpace,""),attributes[name]=value)}}return attributes},parseExtendedData:function(node){var i,len,data,key,attributes={},dataNodes=node.getElementsByTagName("Data");for(i=0,len=dataNodes.length;len>i;i++){data=dataNodes[i],key=data.getAttribute("name");var ed={},valueNode=data.getElementsByTagName("value");if(valueNode.length&&(ed.value=this.getChildValue(valueNode[0])),this.kvpAttributes)attributes[key]=ed.value;else{var nameNode=data.getElementsByTagName("displayName");nameNode.length&&(ed.displayName=this.getChildValue(nameNode[0])),attributes[key]=ed}}var simpleDataNodes=node.getElementsByTagName("SimpleData");for(i=0,len=simpleDataNodes.length;len>i;i++){var ed={};data=simpleDataNodes[i],key=data.getAttribute("name"),ed.value=this.getChildValue(data),this.kvpAttributes?attributes[key]=ed.value:(ed.displayName=key,attributes[key]=ed)}return attributes},parseProperty:function(xmlNode,namespace,tagName){var value,nodeList=this.getElementsByTagNameNS(xmlNode,namespace,tagName);try{value=OpenLayers.Util.getXmlNodeValue(nodeList[0])}catch(e){value=null}return value},write:function(features){OpenLayers.Util.isArray(features)||(features=[features]);for(var kml=this.createElementNS(this.kmlns,"kml"),folder=this.createFolderXML(),i=0,len=features.length;len>i;++i)folder.appendChild(this.createPlacemarkXML(features[i]));return kml.appendChild(folder),OpenLayers.Format.XML.prototype.write.apply(this,[kml])},createFolderXML:function(){var folder=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var folderName=this.createElementNS(this.kmlns,"name"),folderNameText=this.createTextNode(this.foldersName);folderName.appendChild(folderNameText),folder.appendChild(folderName)}if(this.foldersDesc){var folderDesc=this.createElementNS(this.kmlns,"description"),folderDescText=this.createTextNode(this.foldersDesc);folderDesc.appendChild(folderDescText),folder.appendChild(folderDesc)}return folder},createPlacemarkXML:function(feature){var placemarkName=this.createElementNS(this.kmlns,"name"),label=feature.style&&feature.style.label?feature.style.label:feature.id,name=feature.attributes.name||label;placemarkName.appendChild(this.createTextNode(name));var placemarkDesc=this.createElementNS(this.kmlns,"description"),desc=feature.attributes.description||this.placemarksDesc;placemarkDesc.appendChild(this.createTextNode(desc));var placemarkNode=this.createElementNS(this.kmlns,"Placemark");null!=feature.fid&&placemarkNode.setAttribute("id",feature.fid),placemarkNode.appendChild(placemarkName),placemarkNode.appendChild(placemarkDesc);var geometryNode=this.buildGeometryNode(feature.geometry);if(placemarkNode.appendChild(geometryNode),feature.attributes){var edNode=this.buildExtendedData(feature.attributes);edNode&&placemarkNode.appendChild(edNode)}return placemarkNode},buildGeometryNode:function(geometry){var className=geometry.CLASS_NAME,type=className.substring(className.lastIndexOf(".")+1),builder=this.buildGeometry[type.toLowerCase()],node=null;return builder&&(node=builder.apply(this,[geometry])),node},buildGeometry:{point:function(geometry){var kml=this.createElementNS(this.kmlns,"Point");return kml.appendChild(this.buildCoordinatesNode(geometry)),kml},multipoint:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])},linestring:function(geometry){var kml=this.createElementNS(this.kmlns,"LineString");return kml.appendChild(this.buildCoordinatesNode(geometry)),kml},multilinestring:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])},linearring:function(geometry){var kml=this.createElementNS(this.kmlns,"LinearRing");return kml.appendChild(this.buildCoordinatesNode(geometry)),kml},polygon:function(geometry){for(var ringMember,ringGeom,type,kml=this.createElementNS(this.kmlns,"Polygon"),rings=geometry.components,i=0,len=rings.length;len>i;++i)type=0==i?"outerBoundaryIs":"innerBoundaryIs",ringMember=this.createElementNS(this.kmlns,type),ringGeom=this.buildGeometry.linearring.apply(this,[rings[i]]),ringMember.appendChild(ringGeom),kml.appendChild(ringMember);return kml},multipolygon:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])},collection:function(geometry){for(var child,kml=this.createElementNS(this.kmlns,"MultiGeometry"),i=0,len=geometry.components.length;len>i;++i)child=this.buildGeometryNode.apply(this,[geometry.components[i]]),child&&kml.appendChild(child);return kml}},buildCoordinatesNode:function(geometry){var path,coordinatesNode=this.createElementNS(this.kmlns,"coordinates"),points=geometry.components;if(points){for(var point,numPoints=points.length,parts=new Array(numPoints),i=0;numPoints>i;++i)point=points[i],parts[i]=this.buildCoordinates(point);path=parts.join(" ")}else path=this.buildCoordinates(geometry);var txtNode=this.createTextNode(path);return coordinatesNode.appendChild(txtNode),coordinatesNode},buildCoordinates:function(point){return this.internalProjection&&this.externalProjection&&(point=point.clone(),point.transform(this.internalProjection,this.externalProjection)),point.x+","+point.y},buildExtendedData:function(attributes){var extendedData=this.createElementNS(this.kmlns,"ExtendedData");for(var attributeName in attributes)if(attributes[attributeName]&&"name"!=attributeName&&"description"!=attributeName&&"styleUrl"!=attributeName){var data=this.createElementNS(this.kmlns,"Data");data.setAttribute("name",attributeName);var value=this.createElementNS(this.kmlns,"value");if("object"==typeof attributes[attributeName]){if(attributes[attributeName].value&&value.appendChild(this.createTextNode(attributes[attributeName].value)),attributes[attributeName].displayName){var displayName=this.createElementNS(this.kmlns,"displayName");displayName.appendChild(this.getXMLDoc().createCDATASection(attributes[attributeName].displayName)),data.appendChild(displayName)}}else value.appendChild(this.createTextNode(attributes[attributeName]));data.appendChild(value),extendedData.appendChild(data)}return this.isSimpleContent(extendedData)?null:extendedData},CLASS_NAME:"OpenLayers.Format.KML"}),OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"}),OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));var raw=data;data&&9==data.nodeType&&(data=data.documentElement);var capabilities={};if(this.readNode(data,capabilities),void 0===capabilities.service){var parser=new OpenLayers.Format.OGCExceptionReport;capabilities.error=parser.read(raw)}return capabilities},readers:{wms:{Service:function(node,obj){obj.service={},this.readChildNodes(node,obj.service)},Name:function(node,obj){obj.name=this.getChildValue(node)},Title:function(node,obj){obj.title=this.getChildValue(node)},Abstract:function(node,obj){obj["abstract"]=this.getChildValue(node)},BoundingBox:function(node,obj){var bbox={};bbox.bbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))];var res={x:parseFloat(node.getAttribute("resx")),y:parseFloat(node.getAttribute("resy"))};return isNaN(res.x)&&isNaN(res.y)||(bbox.res=res),bbox},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")},ContactInformation:function(node,obj){obj.contactInformation={},this.readChildNodes(node,obj.contactInformation)},ContactPersonPrimary:function(node,obj){obj.personPrimary={},this.readChildNodes(node,obj.personPrimary)},ContactPerson:function(node,obj){obj.person=this.getChildValue(node)},ContactOrganization:function(node,obj){obj.organization=this.getChildValue(node)},ContactPosition:function(node,obj){obj.position=this.getChildValue(node)},ContactAddress:function(node,obj){obj.contactAddress={},this.readChildNodes(node,obj.contactAddress)},AddressType:function(node,obj){obj.type=this.getChildValue(node)},Address:function(node,obj){obj.address=this.getChildValue(node)},City:function(node,obj){obj.city=this.getChildValue(node)},StateOrProvince:function(node,obj){obj.stateOrProvince=this.getChildValue(node)},PostCode:function(node,obj){obj.postcode=this.getChildValue(node)},Country:function(node,obj){obj.country=this.getChildValue(node)},ContactVoiceTelephone:function(node,obj){obj.phone=this.getChildValue(node)},ContactFacsimileTelephone:function(node,obj){obj.fax=this.getChildValue(node)},ContactElectronicMailAddress:function(node,obj){obj.email=this.getChildValue(node)},Fees:function(node,obj){var fees=this.getChildValue(node);fees&&"none"!=fees.toLowerCase()&&(obj.fees=fees)},AccessConstraints:function(node,obj){var constraints=this.getChildValue(node);constraints&&"none"!=constraints.toLowerCase()&&(obj.accessConstraints=constraints)},Capability:function(node,obj){obj.capability={nestedLayers:[],layers:[]},this.readChildNodes(node,obj.capability)},Request:function(node,obj){obj.request={},this.readChildNodes(node,obj.request)},GetCapabilities:function(node,obj){obj.getcapabilities={formats:[]},this.readChildNodes(node,obj.getcapabilities)},Format:function(node,obj){OpenLayers.Util.isArray(obj.formats)?obj.formats.push(this.getChildValue(node)):obj.format=this.getChildValue(node)},DCPType:function(node,obj){this.readChildNodes(node,obj)},HTTP:function(node,obj){this.readChildNodes(node,obj)},Get:function(node,obj){obj.get={},this.readChildNodes(node,obj.get),obj.href||(obj.href=obj.get.href)},Post:function(node,obj){obj.post={},this.readChildNodes(node,obj.post),obj.href||(obj.href=obj.get.href)},GetMap:function(node,obj){obj.getmap={formats:[]},this.readChildNodes(node,obj.getmap)},GetFeatureInfo:function(node,obj){obj.getfeatureinfo={formats:[]},this.readChildNodes(node,obj.getfeatureinfo)},Exception:function(node,obj){obj.exception={formats:[]},this.readChildNodes(node,obj.exception)},Layer:function(node,obj){var parentLayer,capability;obj.capability?(capability=obj.capability,parentLayer=obj):capability=obj;var attrNode=node.getAttributeNode("queryable"),queryable=attrNode&&attrNode.specified?node.getAttribute("queryable"):null;attrNode=node.getAttributeNode("cascaded");var cascaded=attrNode&&attrNode.specified?node.getAttribute("cascaded"):null;attrNode=node.getAttributeNode("opaque");var opaque=attrNode&&attrNode.specified?node.getAttribute("opaque"):null,noSubsets=node.getAttribute("noSubsets"),fixedWidth=node.getAttribute("fixedWidth"),fixedHeight=node.getAttribute("fixedHeight"),parent=parentLayer||{},extend=OpenLayers.Util.extend,layer={nestedLayers:[],styles:parentLayer?[].concat(parentLayer.styles):[],srs:parentLayer?extend({},parent.srs):{},metadataURLs:[],bbox:parentLayer?extend({},parent.bbox):{},llbbox:parent.llbbox,dimensions:parentLayer?extend({},parent.dimensions):{},authorityURLs:parentLayer?extend({},parent.authorityURLs):{},identifiers:{},keywords:[],queryable:queryable&&""!==queryable?"1"===queryable||"true"===queryable:parent.queryable||!1,cascaded:null!==cascaded?parseInt(cascaded):parent.cascaded||0,opaque:opaque?"1"===opaque||"true"===opaque:parent.opaque||!1,noSubsets:null!==noSubsets?"1"===noSubsets||"true"===noSubsets:parent.noSubsets||!1,fixedWidth:null!=fixedWidth?parseInt(fixedWidth):parent.fixedWidth||0,fixedHeight:null!=fixedHeight?parseInt(fixedHeight):parent.fixedHeight||0,minScale:parent.minScale,maxScale:parent.maxScale,attribution:parent.attribution};if(obj.nestedLayers.push(layer),layer.capability=capability,this.readChildNodes(node,layer),delete layer.capability,layer.name){var parts=layer.name.split(":"),request=capability.request,gfi=request.getfeatureinfo;parts.length>0&&(layer.prefix=parts[0]),capability.layers.push(layer),void 0===layer.formats&&(layer.formats=request.getmap.formats),void 0===layer.infoFormats&&gfi&&(layer.infoFormats=gfi.formats)}},Attribution:function(node,obj){obj.attribution={},this.readChildNodes(node,obj.attribution)},LogoURL:function(node,obj){obj.logo={width:node.getAttribute("width"),height:node.getAttribute("height")},this.readChildNodes(node,obj.logo)},Style:function(node,obj){var style={};obj.styles.push(style),this.readChildNodes(node,style)},LegendURL:function(node,obj){var legend={width:node.getAttribute("width"),height:node.getAttribute("height")};obj.legend=legend,this.readChildNodes(node,legend)},MetadataURL:function(node,obj){var metadataURL={type:node.getAttribute("type")};obj.metadataURLs.push(metadataURL),this.readChildNodes(node,metadataURL)},DataURL:function(node,obj){obj.dataURL={},this.readChildNodes(node,obj.dataURL)},FeatureListURL:function(node,obj){obj.featureListURL={},this.readChildNodes(node,obj.featureListURL)},AuthorityURL:function(node,obj){var name=node.getAttribute("name"),authority={};this.readChildNodes(node,authority),obj.authorityURLs[name]=authority.href},Identifier:function(node,obj){var authority=node.getAttribute("authority");obj.identifiers[authority]=this.getChildValue(node)},KeywordList:function(node,obj){this.readChildNodes(node,obj)},SRS:function(node,obj){obj.srs[this.getChildValue(node)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"}),OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(node,obj){this.readChildNodes(node,obj)},Keyword:function(node,obj){obj.keywords&&obj.keywords.push(this.getChildValue(node))},DescribeLayer:function(node,obj){obj.describelayer={formats:[]},this.readChildNodes(node,obj.describelayer)},GetLegendGraphic:function(node,obj){obj.getlegendgraphic={formats:[]},this.readChildNodes(node,obj.getlegendgraphic)},GetStyles:function(node,obj){obj.getstyles={formats:[]},this.readChildNodes(node,obj.getstyles)},PutStyles:function(node,obj){obj.putstyles={formats:[]},this.readChildNodes(node,obj.putstyles)},UserDefinedSymbolization:function(node,obj){var userSymbols={supportSLD:1==parseInt(node.getAttribute("SupportSLD")),userLayer:1==parseInt(node.getAttribute("UserLayer")),userStyle:1==parseInt(node.getAttribute("UserStyle")),remoteWFS:1==parseInt(node.getAttribute("RemoteWFS"))};obj.userSymbols=userSymbols},LatLonBoundingBox:function(node,obj){obj.llbbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))];
},BoundingBox:function(node,obj){var bbox=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[node,obj]);bbox.srs=node.getAttribute("SRS"),obj.bbox[bbox.srs]=bbox},ScaleHint:function(node,obj){var min=node.getAttribute("min"),max=node.getAttribute("max"),rad2=Math.pow(2,.5),ipm=OpenLayers.INCHES_PER_UNIT.m;0!=min&&(obj.maxScale=parseFloat((min/rad2*ipm*OpenLayers.DOTS_PER_INCH).toPrecision(13))),max!=Number.POSITIVE_INFINITY&&(obj.minScale=parseFloat((max/rad2*ipm*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(node,obj){var name=node.getAttribute("name").toLowerCase(),dim={name:name,units:node.getAttribute("units"),unitsymbol:node.getAttribute("unitSymbol")};obj.dimensions[dim.name]=dim},Extent:function(node,obj){var name=node.getAttribute("name").toLowerCase();if(name in obj.dimensions){var extent=obj.dimensions[name];extent.nearestVal="1"===node.getAttribute("nearestValue"),extent.multipleVal="1"===node.getAttribute("multipleValues"),extent.current="1"===node.getAttribute("current"),extent["default"]=node.getAttribute("default")||"";var values=this.getChildValue(node);extent.values=values.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(node,obj){for(var srs=this.getChildValue(node),values=srs.split(/ +/),i=0,len=values.length;len>i;i++)obj.srs[values[i]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"}),OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]),options.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!options.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments),options=OpenLayers.Util.extend({},options),OpenLayers.Util.applyDefaults(options,this.options||{});var response=new OpenLayers.Protocol.Response({requestType:"read"}),data=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",options)]);return response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),params:options.params,headers:options.headers,data:data}),response},setFeatureType:function(featureType){this.featureType=featureType,this.format.featureType=featureType},setGeometryName:function(geometryName){this.geometryName=geometryName,this.format.geometryName=geometryName},handleRead:function(response,options){if(options=OpenLayers.Util.extend({},options),OpenLayers.Util.applyDefaults(options,this.options),options.callback){var request=response.priv;if(request.status>=200&&request.status<300){var result=this.parseResponse(request,options.readOptions);result&&result.success!==!1?(options.readOptions&&"object"==options.readOptions.output?OpenLayers.Util.extend(response,result):response.features=result,response.code=OpenLayers.Protocol.Response.SUCCESS):(response.code=OpenLayers.Protocol.Response.FAILURE,response.error=result)}else response.code=OpenLayers.Protocol.Response.FAILURE;options.callback.call(options.scope,response)}},parseResponse:function(request,options){var doc=request.responseXML;if(doc&&doc.documentElement||(doc=request.responseText),!doc||doc.length<=0)return null;var result=null!==this.readFormat?this.readFormat.read(doc):this.format.read(doc,options);if(!this.featureNS){var format=this.readFormat||this.format;this.featureNS=format.featureNS,format.autoConfig=!1,this.geometryName||this.setGeometryName(format.geometryName)}return result},commit:function(features,options){options=OpenLayers.Util.extend({},options),OpenLayers.Util.applyDefaults(options,this.options);var response=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:features});return response.priv=OpenLayers.Request.POST({url:options.url,headers:options.headers,data:this.format.write(features,options),callback:this.createCallback(this.handleCommit,response,options)}),response},handleCommit:function(response,options){if(options.callback){var request=response.priv,data=request.responseXML;data&&data.documentElement||(data=request.responseText);var obj=this.format.read(data)||{};response.insertIds=obj.insertIds||[],obj.success?response.code=OpenLayers.Protocol.Response.SUCCESS:(response.code=OpenLayers.Protocol.Response.FAILURE,response.error=obj),options.callback.call(options.scope,response)}},filterDelete:function(filter,options){options=OpenLayers.Util.extend({},options),OpenLayers.Util.applyDefaults(options,this.options);var root=(new OpenLayers.Protocol.Response({requestType:"commit"}),this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}})),deleteNode=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(options.featureNS?this.featurePrefix+":":"")+options.featureType}});options.featureNS&&deleteNode.setAttribute("xmlns:"+this.featurePrefix,options.featureNS);var filterNode=this.format.writeNode("ogc:Filter",filter);deleteNode.appendChild(filterNode),root.appendChild(deleteNode);var data=OpenLayers.Format.XML.prototype.write.apply(this.format,[root]);return OpenLayers.Request.POST({url:this.url,callback:options.callback||function(){},data:data})},abort:function(response){response&&response.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(control,layer,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,[control,callbacks,options]),this.layer=layer},touchstart:function(evt){return this.startTouch(),OpenLayers.Event.isMultiTouch(evt)?!0:this.mousedown(evt)},touchmove:function(evt){OpenLayers.Event.preventDefault(evt)},mousedown:function(evt){return(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt))&&(this.down=evt.xy),this.handle(evt)?!this.stopDown:!0},mouseup:function(evt){return this.up=evt.xy,this.handle(evt)?!this.stopUp:!0},click:function(evt){return this.handle(evt)?!this.stopClick:!0},mousemove:function(evt){return this.callbacks.over||this.callbacks.out?(this.handle(evt),!0):!0},dblclick:function(evt){return!this.handle(evt)},geometryTypeMatches:function(feature){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1},handle:function(evt){this.feature&&!this.feature.layer&&(this.feature=null);var type=evt.type,handled=!1,previouslyIn=!!this.feature,click="click"==type||"dblclick"==type||"touchstart"==type;if(this.feature=this.layer.getFeatureFromEvent(evt),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===type&&OpenLayers.Event.preventDefault(evt);var inNew=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(previouslyIn&&inNew?(this.lastFeature&&this.triggerCallback(type,"out",[this.lastFeature]),this.triggerCallback(type,"in",[this.feature])):(!previouslyIn||click)&&this.triggerCallback(type,"in",[this.feature]),this.lastFeature=this.feature,handled=!0):(this.lastFeature&&(previouslyIn&&inNew||click)&&this.triggerCallback(type,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(previouslyIn||click)&&this.triggerCallback(type,"out",[this.lastFeature]);return handled},triggerCallback:function(type,mode,args){var key=this.EVENTMAP[type][mode];if(key)if("click"==type&&this.up&&this.down){var dpx=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));dpx<=this.clickTolerance&&this.callback(key,args),this.up=this.down=null}else this.callback(key,args)},activate:function(){var activated=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),deactivated=!0),deactivated},handleMapEvents:function(evt){("removelayer"==evt.type||"order"==evt.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var index=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(index)},moveLayerBack:function(){var index=this.layer.getZIndex()-1;index>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(index):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(evt){for(var feature,layers=this.layers,i=0;i<layers.length;i++)if(feature=layers[i].getFeatureFromEvent(evt))return feature},setMap:function(map){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),map.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(map){map.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var layer,i=0;i<this.map.layers.length;++i)layer=this.map.layers[i],-1!=OpenLayers.Util.indexOf(this.layers,layer)&&layer.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var layer,i=0;i<this.layers.length;++i)layer=this.layers[i],this.renderer&&layer.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(layer.renderer)},handleChangeLayer:function(evt){var layer=evt.layer;"order"==evt.property&&-1!=OpenLayers.Util.indexOf(this.layers,layer)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(layers,options){OpenLayers.Control.prototype.initialize.apply(this,[options]),null===this.scope&&(this.scope=this),this.initLayer(layers);var callbacks={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(callbacks.over=this.overFeature,callbacks.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(layers){OpenLayers.Util.isArray(layers)?(this.layers=layers,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:layers})):this.layer=layers},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(options){var layer,feature,l,numExcept,layers=this.layers||[this.layer];for(l=0;l<layers.length;++l)if(layer=layers[l],numExcept=0,null!=layer.selectedFeatures)for(;layer.selectedFeatures.length>numExcept;)feature=layer.selectedFeatures[numExcept],options&&options.except==feature?++numExcept:this.unselect(feature)},clickFeature:function(feature){if(!this.hover){var selected=OpenLayers.Util.indexOf(feature.layer.selectedFeatures,feature)>-1;selected?this.toggleSelect()?this.unselect(feature):this.multipleSelect()||this.unselectAll({except:feature}):(this.multipleSelect()||this.unselectAll({except:feature}),this.select(feature))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(feature){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(feature){var layer=feature.layer;this.hover&&(this.highlightOnly?this.highlight(feature):-1==OpenLayers.Util.indexOf(layer.selectedFeatures,feature)&&this.select(feature))},outFeature:function(feature){if(this.hover)if(this.highlightOnly){if(feature._lastHighlighter==this.id)if(feature._prevHighlighter&&feature._prevHighlighter!=this.id){delete feature._lastHighlighter;var control=this.map.getControl(feature._prevHighlighter);control&&control.highlight(feature)}else this.unhighlight(feature)}else this.unselect(feature)},highlight:function(feature){var layer=feature.layer,cont=this.events.triggerEvent("beforefeaturehighlighted",{feature:feature});if(cont!==!1){feature._prevHighlighter=feature._lastHighlighter,feature._lastHighlighter=this.id;var style=this.selectStyle||this.renderIntent;layer.drawFeature(feature,style),this.events.triggerEvent("featurehighlighted",{feature:feature})}},unhighlight:function(feature){var layer=feature.layer;void 0==feature._prevHighlighter?delete feature._lastHighlighter:feature._prevHighlighter==this.id?delete feature._prevHighlighter:(feature._lastHighlighter=feature._prevHighlighter,delete feature._prevHighlighter),layer.drawFeature(feature,feature.style||feature.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:feature})},select:function(feature){var cont=this.onBeforeSelect.call(this.scope,feature),layer=feature.layer;cont!==!1&&(cont=layer.events.triggerEvent("beforefeatureselected",{feature:feature}),cont!==!1&&(layer.selectedFeatures.push(feature),this.highlight(feature),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=layer.selectedFeatures[0]),layer.events.triggerEvent("featureselected",{feature:feature}),this.onSelect.call(this.scope,feature)))},unselect:function(feature){var layer=feature.layer;this.unhighlight(feature),OpenLayers.Util.removeItem(layer.selectedFeatures,feature),layer.events.triggerEvent("featureunselected",{feature:feature}),this.onUnselect.call(this.scope,feature)},selectBox:function(position){if(position instanceof OpenLayers.Bounds){var minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom}),maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top}),bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);this.multipleSelect()||this.unselectAll();var prevMultiple=this.multiple;this.multiple=!0;var layers=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:layers});for(var layer,l=0;l<layers.length;++l){layer=layers[l];for(var i=0,len=layer.features.length;len>i;++i){var feature=layer.features[i];feature.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1)&&bounds.toGeometry().intersects(feature.geometry)&&-1==OpenLayers.Util.indexOf(layer.selectedFeatures,feature)&&this.select(feature)}}this.multiple=prevMultiple,this.events.triggerEvent("boxselectionend",{layers:layers})}},setMap:function(map){this.handlers.feature.setMap(map),this.box&&this.handlers.box.setMap(map),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(layers){var isActive=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(layers),this.handlers.feature.layer=this.layer,isActive&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(control,callbacks,options){options&&options.layerOptions&&options.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var options=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options),this.map.addLayer(this.layer),!0},createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0):!1},destroyFeature:function(force){!this.layer||!force&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var layer=this.layer;layer&&layer.features.length>1&&this.layer.features[0].destroy()},finalize:function(cancel){var key=cancel?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(key,[this.geometryClone()]),this.destroyFeature(cancel)},cancel:function(){this.finalize(!0)},click:function(evt){return OpenLayers.Event.stop(evt),!1},dblclick:function(evt){return OpenLayers.Event.stop(evt),!1},modifyFeature:function(pixel){this.point||this.createFeature(pixel);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point.geometry.x=lonlat.lon,this.point.geometry.y=lonlat.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var geometry=this.point&&this.point.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiPoint([geometry])),geometry},geometryClone:function(){var geom=this.getGeometry();return geom&&geom.clone()},mousedown:function(evt){return this.down(evt)},touchstart:function(evt){return this.startTouch(),this.lastTouchPx=evt.xy,this.down(evt)},mousemove:function(evt){return this.move(evt)},touchmove:function(evt){return this.lastTouchPx=evt.xy,this.move(evt)},mouseup:function(evt){return this.up(evt)},touchend:function(evt){return evt.xy=this.lastTouchPx,this.up(evt)},down:function(evt){return this.mouseDown=!0,this.lastDown=evt.xy,this.touch||this.modifyFeature(evt.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(evt){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(evt.xy),!0},up:function(evt){return this.mouseDown=!1,this.stoppedDown=this.stopDown,this.checkModifiers(evt)?this.lastUp&&this.lastUp.equals(evt.xy)?!0:this.lastDown&&this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)?(this.touch&&this.modifyFeature(evt.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=evt.xy,this.finalize(),!this.stopUp):!0:!0},mouseout:function(evt){OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(pixel1,pixel2,tolerance){var passes=!0;if(null!=tolerance&&pixel1&&pixel2){var dist=pixel1.distanceTo(pixel2);dist>tolerance&&(passes=!1)}return passes},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(force){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,force),this.line=null},destroyPersistedFeature:function(){var layer=this.layer;layer&&layer.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(pixel){this.layer.removeFeatures([this.point]);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(x,y){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(x,y),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(dx,dy){var previousIndex=this.getCurrentPointIndex()-1,p0=this.line.geometry.components[previousIndex];!p0||isNaN(p0.x)||isNaN(p0.y)||this.insertXY(p0.x+dx,p0.y+dy)},insertDirectionLength:function(direction,length){direction*=Math.PI/180;var dx=length*Math.cos(direction),dy=length*Math.sin(direction);this.insertDeltaXY(dx,dy)},insertDeflectionLength:function(deflection,length){var previousIndex=this.getCurrentPointIndex()-1;if(previousIndex>0){var p1=this.line.geometry.components[previousIndex],p0=this.line.geometry.components[previousIndex-1],theta=Math.atan2(p1.y-p0.y,p1.x-p0.x);this.insertDirectionLength(180*theta/Math.PI+deflection,length)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var geometry=this.line.geometry,components=geometry.components,index=this.getCurrentPointIndex()-1,target=components[index],undone=geometry.removeComponent(target);if(undone){if(this.touch&&index>0){components=geometry.components;var lastpt=components[index-1],curptidx=this.getCurrentPointIndex(),curpt=components[curptidx];curpt.x=lastpt.x,curpt.y=lastpt.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(target),this.drawFeature()}return undone},redo:function(){var target=this.redoStack&&this.redoStack.pop();return target&&(this.line.geometry.addComponent(target,this.getCurrentPointIndex()),this.drawFeature()),!!target},freehandMode:function(evt){return this.freehandToggle&&evt[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(pixel,drawing){this.line||this.createFeature(pixel);var lonlat=this.layer.getLonLatFromViewPortPx(pixel);this.point.geometry.x=lonlat.lon,this.point.geometry.y=lonlat.lat,this.callback("modify",[this.point.geometry,this.getSketch(),drawing]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var geometry=this.line&&this.line.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiLineString([geometry])),geometry},touchstart:function(evt){return this.timerId&&this.passesTolerance(this.lastTouchPx,evt.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,evt))},down:function(evt){var stopDown=this.stopDown;return this.freehandMode(evt)&&(stopDown=!0,this.touch&&(this.modifyFeature(evt.xy,!!this.lastUp),OpenLayers.Event.stop(evt))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)||this.modifyFeature(evt.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=evt.xy,this.stoppedDown=stopDown,!stopDown},move:function(evt){return this.stoppedDown&&this.freehandMode(evt)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(evt.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(evt.xy,!!this.lastUp),!0)},up:function(evt){return!this.mouseDown||this.lastUp&&this.lastUp.equals(evt.xy)||(this.stoppedDown&&this.freehandMode(evt)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(evt.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(evt.xy),this.lastUp=evt.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var index=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[index]),this.removePoint(),this.finalize()},dblclick:function(evt){return this.freehandMode(evt)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Spherical=OpenLayers.Spherical||{},OpenLayers.Spherical.DEFAULT_RADIUS=6378137,OpenLayers.Spherical.computeDistanceBetween=function(from,to,radius){var R=radius||OpenLayers.Spherical.DEFAULT_RADIUS,sinHalfDeltaLon=Math.sin(Math.PI*(to.lon-from.lon)/360),sinHalfDeltaLat=Math.sin(Math.PI*(to.lat-from.lat)/360),a=sinHalfDeltaLat*sinHalfDeltaLat+sinHalfDeltaLon*sinHalfDeltaLon*Math.cos(Math.PI*from.lat/180)*Math.cos(Math.PI*to.lat/180);return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))},OpenLayers.Spherical.computeHeading=function(from,to){var y=Math.sin(Math.PI*(from.lon-to.lon)/180)*Math.cos(Math.PI*to.lat/180),x=Math.cos(Math.PI*from.lat/180)*Math.sin(Math.PI*to.lat/180)-Math.sin(Math.PI*from.lat/180)*Math.cos(Math.PI*to.lat/180)*Math.cos(Math.PI*(from.lon-to.lon)/180);return 180*Math.atan2(y,x)/Math.PI},OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);var i,layers=this.layers||map.layers;for(i=layers.length-1;i>=0;--i)this.addLayer({layer:layers[i]});this.layers||map.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(evt){evt.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},removeLayer:function(evt){evt.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},makeSameOrigin:function(evt){if(this.active){var tile=evt.tile;if(tile instanceof OpenLayers.Tile.Image&&!tile.crossOriginKeyword&&"data:"!==tile.url.substr(0,5)){var sameOriginUrl=OpenLayers.Request.makeSameOrigin(tile.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[sameOriginUrl]=tile.url,tile.url=sameOriginUrl}}},onTileLoaded:function(evt){this.active&&!evt.aborted&&evt.tile instanceof OpenLayers.Tile.Image&&"data:"!==evt.tile.url.substr(0,5)&&(this.cache({tile:evt.tile}),delete OpenLayers.Control.CacheWrite.urlMap[evt.tile.url])},cache:function(obj){if(window.localStorage){var tile=obj.tile;try{var canvasContext=tile.getCanvasContext();if(canvasContext){var urlMap=OpenLayers.Control.CacheWrite.urlMap,url=urlMap[tile.url]||tile.url;window.localStorage.setItem("olCache_"+url,canvasContext.canvas.toDataURL(this.imageFormat))}}catch(e){var reason=e.name||e.message;reason&&this.quotaRegEx.test(reason)?this.events.triggerEvent("cachefull",{tile:tile}):OpenLayers.Console.error(e.toString())}}},destroy:function(){if(this.layers||this.map){var i,layers=this.layers||this.map.layers;for(i=layers.length-1;i>=0;--i)this.removeLayer({layer:layers[i]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"}),OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var i,key;for(i=window.localStorage.length-1;i>=0;--i)key=window.localStorage.key(i),"olCache_"===key.substr(0,8)&&window.localStorage.removeItem(key)}},OpenLayers.Control.CacheWrite.urlMap={},OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(data,options){var map,context=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(options&&options.map)if(this.context=context,options.map instanceof OpenLayers.Map)map=this.mergeContextToMap(context,options.map);else{var mapOptions=options.map;(OpenLayers.Util.isElement(mapOptions)||"string"==typeof mapOptions)&&(mapOptions={div:mapOptions}),map=this.contextToMap(context,mapOptions)}else map=context;return map},getLayerFromContext:function(layerContext){var i,len,options={queryable:layerContext.queryable,visibility:layerContext.visibility,maxExtent:layerContext.maxExtent,metadata:OpenLayers.Util.applyDefaults(layerContext.metadata,{styles:layerContext.styles,formats:layerContext.formats,"abstract":layerContext["abstract"],dataURL:layerContext.dataURL}),numZoomLevels:layerContext.numZoomLevels,units:layerContext.units,isBaseLayer:layerContext.isBaseLayer,opacity:layerContext.opacity,displayInLayerSwitcher:layerContext.displayInLayerSwitcher,singleTile:layerContext.singleTile,tileSize:layerContext.tileSize?new OpenLayers.Size(layerContext.tileSize.width,layerContext.tileSize.height):void 0,minScale:layerContext.minScale||layerContext.maxScaleDenominator,maxScale:layerContext.maxScale||layerContext.minScaleDenominator,srs:layerContext.srs,dimensions:layerContext.dimensions,metadataURL:layerContext.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(options,this.layerOptions);var params={layers:layerContext.name,transparent:layerContext.transparent,version:layerContext.version};if(layerContext.formats&&layerContext.formats.length>0)for(params.format=layerContext.formats[0].value,i=0,len=layerContext.formats.length;len>i;i++){var format=layerContext.formats[i];
if(1==format.current){params.format=format.value;break}}if(layerContext.styles&&layerContext.styles.length>0)for(i=0,len=layerContext.styles.length;len>i;i++){var style=layerContext.styles[i];if(1==style.current){style.href?params.sld=style.href:style.body?params.sld_body=style.body:params.styles=style.name;break}}this.layerParams&&OpenLayers.Util.applyDefaults(params,this.layerParams);var layer=null,service=layerContext.service;return service==OpenLayers.Format.Context.serviceTypes.WFS?(options.strategies=[new OpenLayers.Strategy.BBOX],options.protocol=new OpenLayers.Protocol.WFS({url:layerContext.url,featurePrefix:layerContext.name.split(":")[0],featureType:layerContext.name.split(":").pop()}),layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)):service==OpenLayers.Format.Context.serviceTypes.KML?(options.strategies=[new OpenLayers.Strategy.Fixed],options.protocol=new OpenLayers.Protocol.HTTP({url:layerContext.url,format:new OpenLayers.Format.KML}),layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)):service==OpenLayers.Format.Context.serviceTypes.GML?(options.strategies=[new OpenLayers.Strategy.Fixed],options.protocol=new OpenLayers.Protocol.HTTP({url:layerContext.url,format:new OpenLayers.Format.GML}),layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)):layerContext.features?(layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options),layer.addFeatures(layerContext.features)):layerContext.categoryLayer!==!0&&(layer=new OpenLayers.Layer.WMS(layerContext.title||layerContext.name,layerContext.url,params,options)),layer},getLayersFromContext:function(layersContext){for(var layers=[],i=0,len=layersContext.length;len>i;i++){var layer=this.getLayerFromContext(layersContext[i]);null!==layer&&layers.push(layer)}return layers},contextToMap:function(context,options){options=OpenLayers.Util.applyDefaults({maxExtent:context.maxExtent,projection:context.projection,units:context.units},options),options.maxExtent&&(options.maxResolution=options.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);var metadata={contactInformation:context.contactInformation,"abstract":context["abstract"],keywords:context.keywords,logo:context.logo,descriptionURL:context.descriptionURL};options.metadata=metadata;var map=new OpenLayers.Map(options);return map.addLayers(this.getLayersFromContext(context.layersContext)),map.setCenter(context.bounds.getCenterLonLat(),map.getZoomForExtent(context.bounds,!0)),map},mergeContextToMap:function(context,map){return map.addLayers(this.getLayersFromContext(context.layersContext)),map},write:function(obj,options){return obj=this.toContext(obj),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"}),OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"},OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(layer){var parser=this.getParser(),layerContext={queryable:layer.queryable,visibility:layer.visibility,name:layer.params.LAYERS,title:layer.name,"abstract":layer.metadata["abstract"],dataURL:layer.metadata.dataURL,metadataURL:layer.metadataURL,server:{version:layer.params.VERSION,url:layer.url},maxExtent:layer.maxExtent,transparent:layer.params.TRANSPARENT,numZoomLevels:layer.numZoomLevels,units:layer.units,isBaseLayer:layer.isBaseLayer,opacity:1==layer.opacity?void 0:layer.opacity,displayInLayerSwitcher:layer.displayInLayerSwitcher,singleTile:layer.singleTile,tileSize:layer.singleTile||!layer.tileSize?void 0:{width:layer.tileSize.w,height:layer.tileSize.h},minScale:layer.options.resolutions||layer.options.scales||layer.options.maxResolution||layer.options.minScale?layer.minScale:void 0,maxScale:layer.options.resolutions||layer.options.scales||layer.options.minResolution||layer.options.maxScale?layer.maxScale:void 0,formats:[],styles:[],srs:layer.srs,dimensions:layer.dimensions};if(layer.metadata.servertitle&&(layerContext.server.title=layer.metadata.servertitle),layer.metadata.formats&&layer.metadata.formats.length>0)for(var i=0,len=layer.metadata.formats.length;len>i;i++){var format=layer.metadata.formats[i];layerContext.formats.push({value:format.value,current:format.value==layer.params.FORMAT})}else layerContext.formats.push({value:layer.params.FORMAT,current:!0});if(layer.metadata.styles&&layer.metadata.styles.length>0)for(var i=0,len=layer.metadata.styles.length;len>i;i++){var style=layer.metadata.styles[i];style.href==layer.params.SLD||style.body==layer.params.SLD_BODY||style.name==layer.params.STYLES?style.current=!0:style.current=!1,layerContext.styles.push(style)}else layerContext.styles.push({href:layer.params.SLD,body:layer.params.SLD_BODY,name:layer.params.STYLES||parser.defaultStyleName,title:parser.defaultStyleTitle,current:!0});return layerContext},toContext:function(obj){var context={},layers=obj.layers;if("OpenLayers.Map"==obj.CLASS_NAME){var metadata=obj.metadata||{};context.size=obj.getSize(),context.bounds=obj.getExtent(),context.projection=obj.projection,context.title=obj.title,context.keywords=metadata.keywords,context["abstract"]=metadata["abstract"],context.logo=metadata.logo,context.descriptionURL=metadata.descriptionURL,context.contactInformation=metadata.contactInformation,context.maxExtent=obj.maxExtent}else OpenLayers.Util.applyDefaults(context,obj),void 0!=context.layers&&delete context.layers;if(void 0==context.layersContext&&(context.layersContext=[]),void 0!=layers&&OpenLayers.Util.isArray(layers))for(var i=0,len=layers.length;len>i;i++){var layer=layers[i];layer instanceof OpenLayers.Layer.WMS&&context.layersContext.push(this.layerToContext(layer))}return context},CLASS_NAME:"OpenLayers.Format.WMC"}),OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(uri){var prefix=null;if(null==uri)prefix=this.namespaces[this.defaultPrefix];else for(prefix in this.namespaces)if(this.namespaces[prefix]==uri)break;return prefix},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));var root=data.documentElement;this.rootPrefix=root.prefix;var context={version:root.getAttribute("version")};return this.runChildNodes(context,root),context},runChildNodes:function(obj,node){for(var childNode,processor,prefix,local,children=node.childNodes,i=0,len=children.length;len>i;++i)childNode=children[i],1==childNode.nodeType&&(prefix=this.getNamespacePrefix(childNode.namespaceURI),local=childNode.nodeName.split(":").pop(),processor=this["read_"+prefix+"_"+local],processor&&processor.apply(this,[obj,childNode]))},read_wmc_General:function(context,node){this.runChildNodes(context,node)},read_wmc_BoundingBox:function(context,node){context.projection=node.getAttribute("SRS"),context.bounds=new OpenLayers.Bounds(node.getAttribute("minx"),node.getAttribute("miny"),node.getAttribute("maxx"),node.getAttribute("maxy"))},read_wmc_LayerList:function(context,node){context.layersContext=[],this.runChildNodes(context,node)},read_wmc_Layer:function(context,node){var layerContext={visibility:"1"!=node.getAttribute("hidden"),queryable:"1"==node.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(layerContext,node),context.layersContext.push(layerContext)},read_wmc_Extension:function(obj,node){this.runChildNodes(obj,node)},read_ol_units:function(layerContext,node){layerContext.units=this.getChildValue(node)},read_ol_maxExtent:function(obj,node){var bounds=new OpenLayers.Bounds(node.getAttribute("minx"),node.getAttribute("miny"),node.getAttribute("maxx"),node.getAttribute("maxy"));obj.maxExtent=bounds},read_ol_transparent:function(layerContext,node){layerContext.transparent=this.getChildValue(node)},read_ol_numZoomLevels:function(layerContext,node){layerContext.numZoomLevels=parseInt(this.getChildValue(node))},read_ol_opacity:function(layerContext,node){layerContext.opacity=parseFloat(this.getChildValue(node))},read_ol_singleTile:function(layerContext,node){layerContext.singleTile="true"==this.getChildValue(node)},read_ol_tileSize:function(layerContext,node){var obj={width:node.getAttribute("width"),height:node.getAttribute("height")};layerContext.tileSize=obj},read_ol_isBaseLayer:function(layerContext,node){layerContext.isBaseLayer="true"==this.getChildValue(node)},read_ol_displayInLayerSwitcher:function(layerContext,node){layerContext.displayInLayerSwitcher="true"==this.getChildValue(node)},read_wmc_Server:function(layerContext,node){layerContext.version=node.getAttribute("version"),layerContext.url=this.getOnlineResource_href(node),layerContext.metadata.servertitle=node.getAttribute("title")},read_wmc_FormatList:function(layerContext,node){this.runChildNodes(layerContext,node)},read_wmc_Format:function(layerContext,node){var format={value:this.getChildValue(node)};"1"==node.getAttribute("current")&&(format.current=!0),layerContext.formats.push(format)},read_wmc_StyleList:function(layerContext,node){this.runChildNodes(layerContext,node)},read_wmc_Style:function(layerContext,node){var style={};this.runChildNodes(style,node),"1"==node.getAttribute("current")&&(style.current=!0),layerContext.styles.push(style)},read_wmc_SLD:function(style,node){this.runChildNodes(style,node)},read_sld_StyledLayerDescriptor:function(sld,node){var xml=OpenLayers.Format.XML.prototype.write.apply(this,[node]);sld.body=xml},read_sld_FeatureTypeStyle:function(sld,node){var xml=OpenLayers.Format.XML.prototype.write.apply(this,[node]);sld.body=xml},read_wmc_OnlineResource:function(obj,node){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")},read_wmc_Name:function(obj,node){var name=this.getChildValue(node);name&&(obj.name=name)},read_wmc_Title:function(obj,node){var title=this.getChildValue(node);title&&(obj.title=title)},read_wmc_MetadataURL:function(layerContext,node){layerContext.metadataURL=this.getOnlineResource_href(node)},read_wmc_KeywordList:function(context,node){context.keywords=[],this.runChildNodes(context.keywords,node)},read_wmc_Keyword:function(keywords,node){keywords.push(this.getChildValue(node))},read_wmc_Abstract:function(obj,node){var abst=this.getChildValue(node);abst&&(obj["abstract"]=abst)},read_wmc_LogoURL:function(context,node){context.logo={width:node.getAttribute("width"),height:node.getAttribute("height"),format:node.getAttribute("format"),href:this.getOnlineResource_href(node)}},read_wmc_DescriptionURL:function(context,node){context.descriptionURL=this.getOnlineResource_href(node)},read_wmc_ContactInformation:function(obj,node){var contact={};this.runChildNodes(contact,node),obj.contactInformation=contact},read_wmc_ContactPersonPrimary:function(contact,node){var personPrimary={};this.runChildNodes(personPrimary,node),contact.personPrimary=personPrimary},read_wmc_ContactPerson:function(primaryPerson,node){var person=this.getChildValue(node);person&&(primaryPerson.person=person)},read_wmc_ContactOrganization:function(primaryPerson,node){var organization=this.getChildValue(node);organization&&(primaryPerson.organization=organization)},read_wmc_ContactPosition:function(contact,node){var position=this.getChildValue(node);position&&(contact.position=position)},read_wmc_ContactAddress:function(contact,node){var contactAddress={};this.runChildNodes(contactAddress,node),contact.contactAddress=contactAddress},read_wmc_AddressType:function(contactAddress,node){var type=this.getChildValue(node);type&&(contactAddress.type=type)},read_wmc_Address:function(contactAddress,node){var address=this.getChildValue(node);address&&(contactAddress.address=address)},read_wmc_City:function(contactAddress,node){var city=this.getChildValue(node);city&&(contactAddress.city=city)},read_wmc_StateOrProvince:function(contactAddress,node){var stateOrProvince=this.getChildValue(node);stateOrProvince&&(contactAddress.stateOrProvince=stateOrProvince)},read_wmc_PostCode:function(contactAddress,node){var postcode=this.getChildValue(node);postcode&&(contactAddress.postcode=postcode)},read_wmc_Country:function(contactAddress,node){var country=this.getChildValue(node);country&&(contactAddress.country=country)},read_wmc_ContactVoiceTelephone:function(contact,node){var phone=this.getChildValue(node);phone&&(contact.phone=phone)},read_wmc_ContactFacsimileTelephone:function(contact,node){var fax=this.getChildValue(node);fax&&(contact.fax=fax)},read_wmc_ContactElectronicMailAddress:function(contact,node){var email=this.getChildValue(node);email&&(contact.email=email)},read_wmc_DataURL:function(layerContext,node){layerContext.dataURL=this.getOnlineResource_href(node)},read_wmc_LegendURL:function(style,node){var legend={width:node.getAttribute("width"),height:node.getAttribute("height"),format:node.getAttribute("format"),href:this.getOnlineResource_href(node)};style.legend=legend},read_wmc_DimensionList:function(layerContext,node){layerContext.dimensions={},this.runChildNodes(layerContext.dimensions,node)},read_wmc_Dimension:function(dimensions,node){var name=node.getAttribute("name").toLowerCase(),dim={name:name,units:node.getAttribute("units")||"",unitSymbol:node.getAttribute("unitSymbol")||"",userValue:node.getAttribute("userValue")||"",nearestValue:"1"===node.getAttribute("nearestValue"),multipleValues:"1"===node.getAttribute("multipleValues"),current:"1"===node.getAttribute("current"),"default":node.getAttribute("default")||""},values=this.getChildValue(node);dim.values=values.split(","),dimensions[dim.name]=dim},write:function(context,options){var root=this.createElementDefaultNS("ViewContext");return this.setAttributes(root,{version:this.VERSION,id:options&&"string"==typeof options.id?options.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),root.appendChild(this.write_wmc_General(context)),root.appendChild(this.write_wmc_LayerList(context)),OpenLayers.Format.XML.prototype.write.apply(this,[root])},createElementDefaultNS:function(name,childValue,attributes){var node=this.createElementNS(this.namespaces[this.defaultPrefix],name);return childValue&&node.appendChild(this.createTextNode(childValue)),attributes&&this.setAttributes(node,attributes),node},setAttributes:function(node,obj){var value;for(var name in obj)value=obj[name].toString(),value.match(/[A-Z]/)?this.setAttributeNS(node,null,name,value):node.setAttribute(name,value)},write_wmc_General:function(context){var node=this.createElementDefaultNS("General");context.size&&node.appendChild(this.createElementDefaultNS("Window",null,{width:context.size.w,height:context.size.h}));var bounds=context.bounds;return node.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18),SRS:context.projection})),node.appendChild(this.createElementDefaultNS("Title",context.title)),context.keywords&&node.appendChild(this.write_wmc_KeywordList(context.keywords)),context["abstract"]&&node.appendChild(this.createElementDefaultNS("Abstract",context["abstract"])),context.logo&&node.appendChild(this.write_wmc_URLType("LogoURL",context.logo.href,context.logo)),context.descriptionURL&&node.appendChild(this.write_wmc_URLType("DescriptionURL",context.descriptionURL)),context.contactInformation&&node.appendChild(this.write_wmc_ContactInformation(context.contactInformation)),node.appendChild(this.write_ol_MapExtension(context)),node},write_wmc_KeywordList:function(keywords){for(var node=this.createElementDefaultNS("KeywordList"),i=0,len=keywords.length;len>i;i++)node.appendChild(this.createElementDefaultNS("Keyword",keywords[i]));return node},write_wmc_ContactInformation:function(contact){var node=this.createElementDefaultNS("ContactInformation");return contact.personPrimary&&node.appendChild(this.write_wmc_ContactPersonPrimary(contact.personPrimary)),contact.position&&node.appendChild(this.createElementDefaultNS("ContactPosition",contact.position)),contact.contactAddress&&node.appendChild(this.write_wmc_ContactAddress(contact.contactAddress)),contact.phone&&node.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",contact.phone)),contact.fax&&node.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",contact.fax)),contact.email&&node.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",contact.email)),node},write_wmc_ContactPersonPrimary:function(personPrimary){var node=this.createElementDefaultNS("ContactPersonPrimary");return personPrimary.person&&node.appendChild(this.createElementDefaultNS("ContactPerson",personPrimary.person)),personPrimary.organization&&node.appendChild(this.createElementDefaultNS("ContactOrganization",personPrimary.organization)),node},write_wmc_ContactAddress:function(contactAddress){var node=this.createElementDefaultNS("ContactAddress");return contactAddress.type&&node.appendChild(this.createElementDefaultNS("AddressType",contactAddress.type)),contactAddress.address&&node.appendChild(this.createElementDefaultNS("Address",contactAddress.address)),contactAddress.city&&node.appendChild(this.createElementDefaultNS("City",contactAddress.city)),contactAddress.stateOrProvince&&node.appendChild(this.createElementDefaultNS("StateOrProvince",contactAddress.stateOrProvince)),contactAddress.postcode&&node.appendChild(this.createElementDefaultNS("PostCode",contactAddress.postcode)),contactAddress.country&&node.appendChild(this.createElementDefaultNS("Country",contactAddress.country)),node},write_ol_MapExtension:function(context){var node=this.createElementDefaultNS("Extension"),bounds=context.maxExtent;if(bounds){var maxExtent=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(maxExtent,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18)}),node.appendChild(maxExtent)}return node},write_wmc_LayerList:function(context){for(var list=this.createElementDefaultNS("LayerList"),i=0,len=context.layersContext.length;len>i;++i)list.appendChild(this.write_wmc_Layer(context.layersContext[i]));return list},write_wmc_Layer:function(context){var node=this.createElementDefaultNS("Layer",null,{queryable:context.queryable?"1":"0",hidden:context.visibility?"0":"1"});return node.appendChild(this.write_wmc_Server(context)),node.appendChild(this.createElementDefaultNS("Name",context.name)),node.appendChild(this.createElementDefaultNS("Title",context.title)),context["abstract"]&&node.appendChild(this.createElementDefaultNS("Abstract",context["abstract"])),context.dataURL&&node.appendChild(this.write_wmc_URLType("DataURL",context.dataURL)),context.metadataURL&&node.appendChild(this.write_wmc_URLType("MetadataURL",context.metadataURL)),node},write_wmc_LayerExtension:function(context){var node=this.createElementDefaultNS("Extension"),bounds=context.maxExtent,maxExtent=this.createElementNS(this.namespaces.ol,"ol:maxExtent");if(this.setAttributes(maxExtent,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18)}),node.appendChild(maxExtent),context.tileSize&&!context.singleTile){var size=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(size,context.tileSize),node.appendChild(size)}for(var child,properties=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"],i=0,len=properties.length;len>i;++i)child=this.createOLPropertyNode(context,properties[i]),child&&node.appendChild(child);return node},createOLPropertyNode:function(obj,prop){var node=null;return null!=obj[prop]&&(node=this.createElementNS(this.namespaces.ol,"ol:"+prop),node.appendChild(this.createTextNode(obj[prop].toString()))),node},write_wmc_Server:function(context){var server=context.server,node=this.createElementDefaultNS("Server"),attributes={service:"OGC:WMS",version:server.version};return server.title&&(attributes.title=server.title),this.setAttributes(node,attributes),node.appendChild(this.write_wmc_OnlineResource(server.url)),node},write_wmc_URLType:function(elName,url,attr){var node=this.createElementDefaultNS(elName);if(node.appendChild(this.write_wmc_OnlineResource(url)),attr)for(var optionalAttributes=["width","height","format"],i=0;i<optionalAttributes.length;i++)optionalAttributes[i]in attr&&node.setAttribute(optionalAttributes[i],attr[optionalAttributes[i]]);return node},write_wmc_DimensionList:function(context){var node=this.createElementDefaultNS("DimensionList");for(var dim in context.dimensions){var attributes={},dimension=context.dimensions[dim];for(var name in dimension)"boolean"==typeof dimension[name]?attributes[name]=Number(dimension[name]):attributes[name]=dimension[name];var values="";attributes.values&&(values=attributes.values.join(","),delete attributes.values),node.appendChild(this.createElementDefaultNS("Dimension",values,attributes))}return node},write_wmc_FormatList:function(context){for(var node=this.createElementDefaultNS("FormatList"),i=0,len=context.formats.length;len>i;i++){var format=context.formats[i];node.appendChild(this.createElementDefaultNS("Format",format.value,format.current&&1==format.current?{current:"1"}:null))}return node},write_wmc_StyleList:function(layer){var node=this.createElementDefaultNS("StyleList"),styles=layer.styles;if(styles&&OpenLayers.Util.isArray(styles))for(var sld,i=0,len=styles.length;len>i;i++){var s=styles[i],style=this.createElementDefaultNS("Style",null,s.current&&1==s.current?{current:"1"}:null);if(s.href){sld=this.createElementDefaultNS("SLD"),s.name&&sld.appendChild(this.createElementDefaultNS("Name",s.name)),s.title&&sld.appendChild(this.createElementDefaultNS("Title",s.title)),s.legend&&sld.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend));var link=this.write_wmc_OnlineResource(s.href);sld.appendChild(link),style.appendChild(sld)}else if(s.body){sld=this.createElementDefaultNS("SLD"),s.name&&sld.appendChild(this.createElementDefaultNS("Name",s.name)),s.title&&sld.appendChild(this.createElementDefaultNS("Title",s.title)),s.legend&&sld.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend));var doc=OpenLayers.Format.XML.prototype.read.apply(this,[s.body]),imported=doc.documentElement;sld.ownerDocument&&sld.ownerDocument.importNode&&(imported=sld.ownerDocument.importNode(imported,!0)),sld.appendChild(imported),style.appendChild(sld)}else style.appendChild(this.createElementDefaultNS("Name",s.name)),style.appendChild(this.createElementDefaultNS("Title",s.title)),s["abstract"]&&style.appendChild(this.createElementDefaultNS("Abstract",s["abstract"])),s.legend&&style.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend));node.appendChild(style)}return node},write_wmc_OnlineResource:function(href){var node=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(node,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(node,this.namespaces.xlink,"xlink:href",href),node},getOnlineResource_href:function(node){var object={},links=node.getElementsByTagName("OnlineResource");return links.length>0&&this.read_wmc_OnlineResource(object,links[0]),object.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"}),OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);var options={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,options)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var attributions=[];if(this.map&&this.map.layers){for(var i=0,len=this.map.layers.length;len>i;i++){var layer=this.map.layers[i];layer.attribution&&layer.getVisibility()&&-1===OpenLayers.Util.indexOf(attributions,layer.attribution)&&attributions.push(layer.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:attributions.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(options){OpenLayers.Util.extend(this,options)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(xy){this.points.unshift({xy:xy,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(xy){for(var last,point,now=(new Date).getTime(),i=0,l=this.points.length;l>i&&(point=this.points[i],!(now-point.tick>this.delay));i++)last=point;if(last){var time=(new Date).getTime()-last.tick,dist=Math.sqrt(Math.pow(xy.x-last.xy.x,2)+Math.pow(xy.y-last.xy.y,2)),speed=dist/time;if(!(0==speed||speed<this.threshold)){var theta=Math.asin((xy.y-last.xy.y)/dist);return last.xy.x<=xy.x&&(theta=Math.PI-theta),{speed:speed,theta:theta}}}},move:function(info,callback){var v0=info.speed,fx=Math.cos(info.theta),fy=-Math.sin(info.theta),initialTime=(new Date).getTime(),lastX=0,lastY=0,timerCallback=function(){if(null!=this.timerId){var t=(new Date).getTime()-initialTime,p=-this.deceleration*Math.pow(t,2)/2+v0*t,x=p*fx,y=p*fy,args={};args.end=!1;var v=-this.deceleration*t+v0;0>=v&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,args.end=!0),args.x=x-lastX,args.y=y-lastY,lastX=x,lastY=y,callback(args.x,args.y,args.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(timerCallback,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(options){return void 0},write:function(options){var doc;window.ActiveXObject?(doc=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=doc):doc=document.implementation.createDocument("","",null);var node=this.writeNode("wps:Execute",options,doc);return this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[node])},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var info={};return this.readNode(data,info),info},writers:{wps:{Execute:function(options){var node=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",options.identifier,node),this.writeNode("wps:DataInputs",options.dataInputs,node),this.writeNode("wps:ResponseForm",options.responseForm,node),node},ResponseForm:function(responseForm){var node=this.createElementNSPlus("wps:ResponseForm",{});return responseForm.rawDataOutput&&this.writeNode("wps:RawDataOutput",responseForm.rawDataOutput,node),responseForm.responseDocument&&this.writeNode("wps:ResponseDocument",responseForm.responseDocument,node),node},ResponseDocument:function(responseDocument){var node=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:responseDocument.storeExecuteResponse,lineage:responseDocument.lineage,status:responseDocument.status}});if(responseDocument.outputs)for(var i=0,len=responseDocument.outputs.length;len>i;i++)this.writeNode("wps:Output",responseDocument.outputs[i],node);return node},Output:function(output){var node=this.createElementNSPlus("wps:Output",{attributes:{asReference:output.asReference,mimeType:output.mimeType,encoding:output.encoding,schema:output.schema}});return this.writeNode("ows:Identifier",output.identifier,node),this.writeNode("ows:Title",output.title,node),this.writeNode("ows:Abstract",output["abstract"],node),node},RawDataOutput:function(rawDataOutput){var node=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:rawDataOutput.mimeType,encoding:rawDataOutput.encoding,schema:rawDataOutput.schema}});return this.writeNode("ows:Identifier",rawDataOutput.identifier,node),node},DataInputs:function(dataInputs){for(var node=this.createElementNSPlus("wps:DataInputs",{}),i=0,ii=dataInputs.length;ii>i;++i)this.writeNode("wps:Input",dataInputs[i],node);return node},Input:function(input){var node=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",input.identifier,node),input.title&&this.writeNode("ows:Title",input.title,node),input.data&&this.writeNode("wps:Data",input.data,node),input.reference&&this.writeNode("wps:Reference",input.reference,node),input.boundingBoxData&&this.writeNode("wps:BoundingBoxData",input.boundingBoxData,node),node},Data:function(data){var node=this.createElementNSPlus("wps:Data",{});return data.literalData?this.writeNode("wps:LiteralData",data.literalData,node):data.complexData?this.writeNode("wps:ComplexData",data.complexData,node):data.boundingBoxData&&this.writeNode("ows:BoundingBox",data.boundingBoxData,node),node},LiteralData:function(literalData){var node=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:literalData.uom},value:literalData.value});return node},ComplexData:function(complexData){var node=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:complexData.mimeType,encoding:complexData.encoding,schema:complexData.schema}}),data=complexData.value;return"string"==typeof data?node.appendChild(this.getXMLDoc().createCDATASection(complexData.value)):node.appendChild(data),node},Reference:function(reference){var node=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:reference.mimeType,"xlink:href":reference.href,method:reference.method,encoding:reference.encoding,schema:reference.schema}});return reference.body&&this.writeNode("wps:Body",reference.body,node),node},BoundingBoxData:function(node,obj){this.writers.ows.BoundingBox.apply(this,[node,obj,"wps:BoundingBoxData"])},Body:function(body){var node=this.createElementNSPlus("wps:Body",{});return body.wcs?this.writeNode("wcs:GetCoverage",body.wcs,node):body.wfs?(this.featureType=body.wfs.featureType,this.version=body.wfs.version,this.writeNode("wfs:GetFeature",body.wfs,node)):this.writeNode("wps:Execute",body,node),
node}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(node,obj){obj.executeResponse={lang:node.getAttribute("lang"),statusLocation:node.getAttribute("statusLocation"),serviceInstance:node.getAttribute("serviceInstance"),service:node.getAttribute("service")},this.readChildNodes(node,obj.executeResponse)},Process:function(node,obj){obj.process={},this.readChildNodes(node,obj.process)},Status:function(node,obj){obj.status={creationTime:node.getAttribute("creationTime")},this.readChildNodes(node,obj.status)},ProcessSucceeded:function(node,obj){obj.processSucceeded=!0},ProcessOutputs:function(node,processDescription){processDescription.processOutputs=[],this.readChildNodes(node,processDescription.processOutputs)},Output:function(node,processOutputs){var output={};this.readChildNodes(node,output),processOutputs.push(output)},Reference:function(node,output){output.reference={href:node.getAttribute("href"),mimeType:node.getAttribute("mimeType"),encoding:node.getAttribute("encoding"),schema:node.getAttribute("schema")}},Data:function(node,output){output.data={},this.readChildNodes(node,output)},LiteralData:function(node,output){output.literalData={dataType:node.getAttribute("dataType"),uom:node.getAttribute("uom"),value:this.getChildValue(node)}},ComplexData:function(node,output){if(output.complexData={mimeType:node.getAttribute("mimeType"),schema:node.getAttribute("schema"),encoding:node.getAttribute("encoding"),value:""},this.isSimpleContent(node)){var child;for(child=node.firstChild;child;child=child.nextSibling)switch(child.nodeType){case 3:case 4:output.complexData.value+=child.nodeValue}}else for(child=node.firstChild;child;child=child.nextSibling)1==child.nodeType&&(output.complexData.value=child)},BoundingBox:function(node,output){output.boundingBoxData={dimensions:node.getAttribute("dimensions"),crs:node.getAttribute("crs")},this.readChildNodes(node,output.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(name,location,options){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[name,options]),this.location=location,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(bounds,zoomChanged,minor){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(ajaxRequest){var doc=ajaxRequest.responseXML;if(doc&&doc.documentElement||(doc=OpenLayers.Format.XML.prototype.read(ajaxRequest.responseText)),this.useFeedTitle){var name=null;try{name=doc.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(e){name=doc.getElementsByTagName("title")[0].firstChild.nodeValue}name&&this.setName(name)}var options={};OpenLayers.Util.extend(options,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(options.externalProjection=this.projection,options.internalProjection=this.map.getProjectionObject());for(var format=new OpenLayers.Format.GeoRSS(options),features=format.read(doc),i=0,len=features.length;len>i;i++){var data={},feature=features[i];if(feature.geometry){var title=feature.attributes.title?feature.attributes.title:"Untitled",description=feature.attributes.description?feature.attributes.description:"No description.",link=feature.attributes.link?feature.attributes.link:"",location=feature.geometry.getBounds().getCenterLonLat();if(data.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),data.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),title||description){data.title=title,data.description=description;var contentHTML='<div class="olLayerGeoRSSClose">[x]</div>';contentHTML+='<div class="olLayerGeoRSSTitle">',link&&(contentHTML+='<a class="link" href="'+link+'" target="_blank">'),contentHTML+=title,link&&(contentHTML+="</a>"),contentHTML+="</div>",contentHTML+='<div style="" class="olLayerGeoRSSDescription">',contentHTML+=description,contentHTML+="</div>",data.popupContentHTML=contentHTML}var feature=new OpenLayers.Feature(this,location,data);this.features.push(feature);var marker=feature.createMarker();marker.events.register("click",feature,this.markerClick),this.addMarker(marker)}}this.events.triggerEvent("loadend")},markerClick:function(evt){var sameMarkerClicked=this==this.layer.selectedFeature;this.layer.selectedFeature=sameMarkerClicked?null:this;for(var i=0,len=this.layer.map.popups.length;len>i;i++)this.layer.map.removePopup(this.layer.map.popups[i]);if(!sameMarkerClicked){var popup=this.createPopup();OpenLayers.Event.observe(popup.div,"click",OpenLayers.Function.bind(function(){for(var i=0,len=this.layer.map.popups.length;len>i;i++)this.layer.map.removePopup(this.layer.map.popups[i])},this)),this.layer.map.addPopup(popup)}OpenLayers.Event.stop(evt)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var feature=this.features[0];OpenLayers.Util.removeItem(this.features,feature),feature.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"}),OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"}),OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"}),OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"}),OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);var sld={namedLayers:options.namedLayersAsArray===!0?[]:{}};return this.readChildNodes(data,sld),sld},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(node,sld){sld.version=node.getAttribute("version"),this.readChildNodes(node,sld)},Name:function(node,obj){obj.name=this.getChildValue(node)},Title:function(node,obj){obj.title=this.getChildValue(node)},Abstract:function(node,obj){obj.description=this.getChildValue(node)},NamedLayer:function(node,sld){var layer={userStyles:[],namedStyles:[]};this.readChildNodes(node,layer);for(var i=0,len=layer.userStyles.length;len>i;++i)layer.userStyles[i].layerName=layer.name;OpenLayers.Util.isArray(sld.namedLayers)?sld.namedLayers.push(layer):sld.namedLayers[layer.name]=layer},NamedStyle:function(node,layer){layer.namedStyles.push(this.getChildName(node.firstChild))},UserStyle:function(node,layer){var obj={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(node,obj);var style;this.multipleSymbolizers?(delete obj.defaultsPerSymbolizer,style=new OpenLayers.Style2(obj)):style=new OpenLayers.Style(this.defaultSymbolizer,obj),layer.userStyles.push(style)},IsDefault:function(node,style){"1"==this.getChildValue(node)&&(style.isDefault=!0)},FeatureTypeStyle:function(node,style){++this.featureTypeCounter;var obj={rules:this.multipleSymbolizers?style.rules:[]};this.readChildNodes(node,obj),this.multipleSymbolizers||(style.rules=obj.rules)},Rule:function(node,obj){var config;this.multipleSymbolizers&&(config={symbolizers:[]});var rule=new OpenLayers.Rule(config);this.readChildNodes(node,rule),obj.rules.push(rule)},ElseFilter:function(node,rule){rule.elseFilter=!0},MinScaleDenominator:function(node,rule){rule.minScaleDenominator=parseFloat(this.getChildValue(node))},MaxScaleDenominator:function(node,rule){rule.maxScaleDenominator=parseFloat(this.getChildValue(node))},TextSymbolizer:function(node,rule){var config={};this.readChildNodes(node,config),this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Text(config))):rule.symbolizer.Text=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Text)},LabelPlacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)},PointPlacement:function(node,symbolizer){var config={};this.readChildNodes(node,config),config.labelRotation=config.rotation,delete config.rotation;var labelAlign,x=symbolizer.labelAnchorPointX,y=symbolizer.labelAnchorPointY;1/3>=x?labelAlign="l":x>1/3&&2/3>x?labelAlign="c":x>=2/3&&(labelAlign="r"),1/3>=y?labelAlign+="b":y>1/3&&2/3>y?labelAlign+="m":y>=2/3&&(labelAlign+="t"),config.labelAlign=labelAlign,OpenLayers.Util.applyDefaults(symbolizer,config)},AnchorPoint:function(node,symbolizer){this.readChildNodes(node,symbolizer)},AnchorPointX:function(node,symbolizer){var labelAnchorPointX=this.readers.ogc._expression.call(this,node);labelAnchorPointX&&(symbolizer.labelAnchorPointX=labelAnchorPointX)},AnchorPointY:function(node,symbolizer){var labelAnchorPointY=this.readers.ogc._expression.call(this,node);labelAnchorPointY&&(symbolizer.labelAnchorPointY=labelAnchorPointY)},Displacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)},DisplacementX:function(node,symbolizer){var labelXOffset=this.readers.ogc._expression.call(this,node);labelXOffset&&(symbolizer.labelXOffset=labelXOffset)},DisplacementY:function(node,symbolizer){var labelYOffset=this.readers.ogc._expression.call(this,node);labelYOffset&&(symbolizer.labelYOffset=labelYOffset)},LinePlacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)},PerpendicularOffset:function(node,symbolizer){var labelPerpendicularOffset=this.readers.ogc._expression.call(this,node);labelPerpendicularOffset&&(symbolizer.labelPerpendicularOffset=labelPerpendicularOffset)},Label:function(node,symbolizer){var value=this.readers.ogc._expression.call(this,node);value&&(symbolizer.label=value)},Font:function(node,symbolizer){this.readChildNodes(node,symbolizer)},Halo:function(node,symbolizer){var obj={};this.readChildNodes(node,obj),symbolizer.haloRadius=obj.haloRadius,symbolizer.haloColor=obj.fillColor,symbolizer.haloOpacity=obj.fillOpacity},Radius:function(node,symbolizer){var radius=this.readers.ogc._expression.call(this,node);null!=radius&&(symbolizer.haloRadius=radius)},RasterSymbolizer:function(node,rule){var config={};this.readChildNodes(node,config),this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Raster(config))):rule.symbolizer.Raster=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Raster)},Geometry:function(node,obj){obj.geometry={},this.readChildNodes(node,obj.geometry)},ColorMap:function(node,symbolizer){symbolizer.colorMap=[],this.readChildNodes(node,symbolizer.colorMap)},ColorMapEntry:function(node,colorMap){var q=node.getAttribute("quantity"),o=node.getAttribute("opacity");colorMap.push({color:node.getAttribute("color"),quantity:null!==q?parseFloat(q):void 0,label:node.getAttribute("label")||void 0,opacity:null!==o?parseFloat(o):void 0})},LineSymbolizer:function(node,rule){var config={};this.readChildNodes(node,config),this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Line(config))):rule.symbolizer.Line=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Line)},PolygonSymbolizer:function(node,rule){var config={fill:!1,stroke:!1};this.multipleSymbolizers||(config=rule.symbolizer.Polygon||config),this.readChildNodes(node,config),this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Polygon(config))):rule.symbolizer.Polygon=config},PointSymbolizer:function(node,rule){var config={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(config=rule.symbolizer.Point||config),this.readChildNodes(node,config),this.multipleSymbolizers?(config.zIndex=this.featureTypeCounter,rule.symbolizers.push(new OpenLayers.Symbolizer.Point(config))):rule.symbolizer.Point=config},Stroke:function(node,symbolizer){symbolizer.stroke=!0,this.readChildNodes(node,symbolizer)},Fill:function(node,symbolizer){symbolizer.fill=!0,this.readChildNodes(node,symbolizer)},CssParameter:function(node,symbolizer){var cssProperty=node.getAttribute("name"),symProperty=this.cssMap[cssProperty];if(symbolizer.label&&("fill"===cssProperty?symProperty="fontColor":"fill-opacity"===cssProperty&&(symProperty="fontOpacity")),symProperty){var value=this.readers.ogc._expression.call(this,node);value&&(symbolizer[symProperty]=value)}},Graphic:function(node,symbolizer){symbolizer.graphic=!0;var graphic={};this.readChildNodes(node,graphic);for(var prop,value,properties=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],i=0,len=properties.length;len>i;++i)prop=properties[i],value=graphic[prop],void 0!=value&&(symbolizer[prop]=value);if(void 0!=graphic.opacity&&(symbolizer.graphicOpacity=graphic.opacity),void 0!=graphic.size){var pointRadius=graphic.size/2;isNaN(pointRadius)?symbolizer.graphicWidth=graphic.size:symbolizer.pointRadius=graphic.size/2}void 0!=graphic.href&&(symbolizer.externalGraphic=graphic.href),void 0!=graphic.rotation&&(symbolizer.rotation=graphic.rotation)},ExternalGraphic:function(node,graphic){this.readChildNodes(node,graphic)},Mark:function(node,graphic){this.readChildNodes(node,graphic)},WellKnownName:function(node,graphic){graphic.graphicName=this.getChildValue(node)},Opacity:function(node,obj){var opacity=this.readers.ogc._expression.call(this,node);opacity&&(obj.opacity=opacity)},Size:function(node,obj){var size=this.readers.ogc._expression.call(this,node);size&&(obj.size=size)},Rotation:function(node,obj){var rotation=this.readers.ogc._expression.call(this,node);rotation&&(obj.rotation=rotation)},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")},Format:function(node,graphic){graphic.graphicFormat=this.getChildValue(node)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(sym){var css=null;for(var prop in this.cssMap)if(this.cssMap[prop]==sym){css=prop;break}return css},getGraphicFormat:function(href){var format;for(var key in this.graphicFormats)if(this.graphicFormats[key].test(href)){format=key;break}return format||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(sld){return this.writers.sld.StyledLayerDescriptor.apply(this,[sld])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(nodeName,value){var node=this.createElementNSPlus(nodeName),tokens="string"==typeof value?value.split("${"):[value];node.appendChild(this.createTextNode(tokens[0]));for(var item,last,i=1,len=tokens.length;len>i;i++)item=tokens[i],last=item.indexOf("}"),last>0?(this.writeNode("ogc:PropertyName",{property:item.substring(0,last)},node),node.appendChild(this.createTextNode(item.substring(++last)))):node.appendChild(this.createTextNode("${"+item));return node},StyledLayerDescriptor:function(sld){var root=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(root.setAttribute("xmlns:ogc",this.namespaces.ogc),root.setAttribute("xmlns:gml",this.namespaces.gml),sld.name&&this.writeNode("Name",sld.name,root),sld.title&&this.writeNode("Title",sld.title,root),sld.description&&this.writeNode("Abstract",sld.description,root),OpenLayers.Util.isArray(sld.namedLayers))for(var i=0,len=sld.namedLayers.length;len>i;++i)this.writeNode("NamedLayer",sld.namedLayers[i],root);else for(var name in sld.namedLayers)this.writeNode("NamedLayer",sld.namedLayers[name],root);return root},Name:function(name){return this.createElementNSPlus("sld:Name",{value:name})},Title:function(title){return this.createElementNSPlus("sld:Title",{value:title})},Abstract:function(description){return this.createElementNSPlus("sld:Abstract",{value:description})},NamedLayer:function(layer){var node=this.createElementNSPlus("sld:NamedLayer");if(this.writeNode("Name",layer.name,node),layer.namedStyles)for(var i=0,len=layer.namedStyles.length;len>i;++i)this.writeNode("NamedStyle",layer.namedStyles[i],node);if(layer.userStyles)for(var i=0,len=layer.userStyles.length;len>i;++i)this.writeNode("UserStyle",layer.userStyles[i],node);return node},NamedStyle:function(name){var node=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",name,node),node},UserStyle:function(style){var node=this.createElementNSPlus("sld:UserStyle");if(style.name&&this.writeNode("Name",style.name,node),style.title&&this.writeNode("Title",style.title,node),style.description&&this.writeNode("Abstract",style.description,node),style.isDefault&&this.writeNode("IsDefault",style.isDefault,node),this.multipleSymbolizers&&style.rules){for(var rule,ruleMap,symbolizer,zIndex,clone,rulesByZ={0:[]},zValues=[0],i=0,ii=style.rules.length;ii>i;++i)if(rule=style.rules[i],rule.symbolizers){ruleMap={};for(var j=0,jj=rule.symbolizers.length;jj>j;++j)symbolizer=rule.symbolizers[j],zIndex=symbolizer.zIndex,zIndex in ruleMap||(clone=rule.clone(),clone.symbolizers=[],ruleMap[zIndex]=clone),ruleMap[zIndex].symbolizers.push(symbolizer.clone());for(zIndex in ruleMap)zIndex in rulesByZ||(zValues.push(zIndex),rulesByZ[zIndex]=[]),rulesByZ[zIndex].push(ruleMap[zIndex])}else rulesByZ[0].push(rule.clone());zValues.sort();for(var rules,i=0,ii=zValues.length;ii>i;++i)rules=rulesByZ[zValues[i]],rules.length>0&&(clone=style.clone(),clone.rules=rulesByZ[zValues[i]],this.writeNode("FeatureTypeStyle",clone,node))}else this.writeNode("FeatureTypeStyle",style,node);return node},IsDefault:function(bool){return this.createElementNSPlus("sld:IsDefault",{value:bool?"1":"0"})},FeatureTypeStyle:function(style){for(var node=this.createElementNSPlus("sld:FeatureTypeStyle"),i=0,len=style.rules.length;len>i;++i)this.writeNode("Rule",style.rules[i],node);return node},Rule:function(rule){var node=this.createElementNSPlus("sld:Rule");rule.name&&this.writeNode("Name",rule.name,node),rule.title&&this.writeNode("Title",rule.title,node),rule.description&&this.writeNode("Abstract",rule.description,node),rule.elseFilter?this.writeNode("ElseFilter",null,node):rule.filter&&this.writeNode("ogc:Filter",rule.filter,node),void 0!=rule.minScaleDenominator&&this.writeNode("MinScaleDenominator",rule.minScaleDenominator,node),void 0!=rule.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",rule.maxScaleDenominator,node);var type,symbolizer;if(this.multipleSymbolizers&&rule.symbolizers)for(var symbolizer,i=0,ii=rule.symbolizers.length;ii>i;++i)symbolizer=rule.symbolizers[i],type=symbolizer.CLASS_NAME.split(".").pop(),this.writeNode(type+"Symbolizer",symbolizer,node);else for(var types=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,len=types.length;len>i;++i)type=types[i],symbolizer=rule.symbolizer[type],symbolizer&&this.writeNode(type+"Symbolizer",symbolizer,node);return node},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(scale){return this.createElementNSPlus("sld:MinScaleDenominator",{value:scale})},MaxScaleDenominator:function(scale){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:scale})},LineSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:LineSymbolizer");return this.writeNode("Stroke",symbolizer,node),node},Stroke:function(symbolizer){var node=this.createElementNSPlus("sld:Stroke");return void 0!=symbolizer.strokeColor&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeColor"},node),void 0!=symbolizer.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeOpacity"},node),void 0!=symbolizer.strokeWidth&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeWidth"},node),void 0!=symbolizer.strokeDashstyle&&"solid"!==symbolizer.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeDashstyle"},node),void 0!=symbolizer.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeLinecap"},node),node},CssParameter:function(obj){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(obj.key)},value:obj.symbolizer[obj.key]})},TextSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:TextSymbolizer");return null!=symbolizer.label&&this.writeNode("Label",symbolizer.label,node),(null!=symbolizer.fontFamily||null!=symbolizer.fontSize||null!=symbolizer.fontWeight||null!=symbolizer.fontStyle)&&this.writeNode("Font",symbolizer,node),(null!=symbolizer.labelAnchorPointX||null!=symbolizer.labelAnchorPointY||null!=symbolizer.labelAlign||null!=symbolizer.labelXOffset||null!=symbolizer.labelYOffset||null!=symbolizer.labelRotation||null!=symbolizer.labelPerpendicularOffset)&&this.writeNode("LabelPlacement",symbolizer,node),(null!=symbolizer.haloRadius||null!=symbolizer.haloColor||null!=symbolizer.haloOpacity)&&this.writeNode("Halo",symbolizer,node),(null!=symbolizer.fontColor||null!=symbolizer.fontOpacity)&&this.writeNode("Fill",{fillColor:symbolizer.fontColor,fillOpacity:symbolizer.fontOpacity},node),node},LabelPlacement:function(symbolizer){var node=this.createElementNSPlus("sld:LabelPlacement");return null==symbolizer.labelAnchorPointX&&null==symbolizer.labelAnchorPointY&&null==symbolizer.labelAlign&&null==symbolizer.labelXOffset&&null==symbolizer.labelYOffset&&null==symbolizer.labelRotation||null!=symbolizer.labelPerpendicularOffset||this.writeNode("PointPlacement",symbolizer,node),null!=symbolizer.labelPerpendicularOffset&&this.writeNode("LinePlacement",symbolizer,node),node},LinePlacement:function(symbolizer){var node=this.createElementNSPlus("sld:LinePlacement");return this.writeNode("PerpendicularOffset",symbolizer.labelPerpendicularOffset,node),node},PerpendicularOffset:function(value){return this.createElementNSPlus("sld:PerpendicularOffset",{value:value})},PointPlacement:function(symbolizer){var node=this.createElementNSPlus("sld:PointPlacement");return(null!=symbolizer.labelAnchorPointX||null!=symbolizer.labelAnchorPointY||null!=symbolizer.labelAlign)&&this.writeNode("AnchorPoint",symbolizer,node),(null!=symbolizer.labelXOffset||null!=symbolizer.labelYOffset)&&this.writeNode("Displacement",symbolizer,node),null!=symbolizer.labelRotation&&this.writeNode("Rotation",symbolizer.labelRotation,node),node},AnchorPoint:function(symbolizer){var node=this.createElementNSPlus("sld:AnchorPoint"),x=symbolizer.labelAnchorPointX,y=symbolizer.labelAnchorPointY;if(null!=x&&this.writeNode("AnchorPointX",x,node),null!=y&&this.writeNode("AnchorPointY",y,node),null==x&&null==y){var xAlign=symbolizer.labelAlign.substr(0,1),yAlign=symbolizer.labelAlign.substr(1,1);"l"===xAlign?x=0:"c"===xAlign?x=.5:"r"===xAlign&&(x=1),"b"===yAlign?y=0:"m"===yAlign?y=.5:"t"===yAlign&&(y=1),this.writeNode("AnchorPointX",x,node),this.writeNode("AnchorPointY",y,node)}return node},AnchorPointX:function(value){return this.createElementNSPlus("sld:AnchorPointX",{value:value})},AnchorPointY:function(value){return this.createElementNSPlus("sld:AnchorPointY",{value:value})},Displacement:function(symbolizer){var node=this.createElementNSPlus("sld:Displacement");return null!=symbolizer.labelXOffset&&this.writeNode("DisplacementX",symbolizer.labelXOffset,node),null!=symbolizer.labelYOffset&&this.writeNode("DisplacementY",symbolizer.labelYOffset,node),node},DisplacementX:function(value){return this.createElementNSPlus("sld:DisplacementX",{value:value})},DisplacementY:function(value){return this.createElementNSPlus("sld:DisplacementY",{value:value})},Font:function(symbolizer){var node=this.createElementNSPlus("sld:Font");return symbolizer.fontFamily&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontFamily"},node),symbolizer.fontSize&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontSize"},node),symbolizer.fontWeight&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontWeight"},node),symbolizer.fontStyle&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontStyle"},node),node},Label:function(label){return this.writers.sld._OGCExpression.call(this,"sld:Label",label)},Halo:function(symbolizer){var node=this.createElementNSPlus("sld:Halo");return symbolizer.haloRadius&&this.writeNode("Radius",symbolizer.haloRadius,node),(symbolizer.haloColor||symbolizer.haloOpacity)&&this.writeNode("Fill",{fillColor:symbolizer.haloColor,fillOpacity:symbolizer.haloOpacity},node),node},Radius:function(value){return this.createElementNSPlus("sld:Radius",{value:value})},RasterSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:RasterSymbolizer");return symbolizer.geometry&&this.writeNode("Geometry",symbolizer.geometry,node),symbolizer.opacity&&this.writeNode("Opacity",symbolizer.opacity,node),symbolizer.colorMap&&this.writeNode("ColorMap",symbolizer.colorMap,node),node},Geometry:function(geometry){var node=this.createElementNSPlus("sld:Geometry");return geometry.property&&this.writeNode("ogc:PropertyName",geometry,node),node},ColorMap:function(colorMap){for(var node=this.createElementNSPlus("sld:ColorMap"),i=0,len=colorMap.length;len>i;++i)this.writeNode("ColorMapEntry",colorMap[i],node);return node},ColorMapEntry:function(colorMapEntry){var node=this.createElementNSPlus("sld:ColorMapEntry"),a=colorMapEntry;return node.setAttribute("color",a.color),void 0!==a.opacity&&node.setAttribute("opacity",parseFloat(a.opacity)),void 0!==a.quantity&&node.setAttribute("quantity",parseFloat(a.quantity)),void 0!==a.label&&node.setAttribute("label",a.label),node},PolygonSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:PolygonSymbolizer");return symbolizer.fill!==!1&&this.writeNode("Fill",symbolizer,node),symbolizer.stroke!==!1&&this.writeNode("Stroke",symbolizer,node),node},Fill:function(symbolizer){var node=this.createElementNSPlus("sld:Fill");return symbolizer.fillColor&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fillColor"},node),null!=symbolizer.fillOpacity&&this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fillOpacity"},node),node},PointSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:PointSymbolizer");return this.writeNode("Graphic",symbolizer,node),node},Graphic:function(symbolizer){var node=this.createElementNSPlus("sld:Graphic");return void 0!=symbolizer.externalGraphic?this.writeNode("ExternalGraphic",symbolizer,node):this.writeNode("Mark",symbolizer,node),void 0!=symbolizer.graphicOpacity&&this.writeNode("Opacity",symbolizer.graphicOpacity,node),void 0!=symbolizer.pointRadius?this.writeNode("Size",2*symbolizer.pointRadius,node):void 0!=symbolizer.graphicWidth&&this.writeNode("Size",symbolizer.graphicWidth,node),void 0!=symbolizer.rotation&&this.writeNode("Rotation",symbolizer.rotation,node),node},ExternalGraphic:function(symbolizer){var node=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",symbolizer.externalGraphic,node);var format=symbolizer.graphicFormat||this.getGraphicFormat(symbolizer.externalGraphic);return this.writeNode("Format",format,node),node},Mark:function(symbolizer){var node=this.createElementNSPlus("sld:Mark");return symbolizer.graphicName&&this.writeNode("WellKnownName",symbolizer.graphicName,node),symbolizer.fill!==!1&&this.writeNode("Fill",symbolizer,node),symbolizer.stroke!==!1&&this.writeNode("Stroke",symbolizer,node),node},WellKnownName:function(name){return this.createElementNSPlus("sld:WellKnownName",{value:name})},Opacity:function(value){return this.createElementNSPlus("sld:Opacity",{value:value})},Size:function(value){return this.writers.sld._OGCExpression.call(this,"sld:Size",value)},Rotation:function(value){return this.createElementNSPlus("sld:Rotation",{value:value})},OnlineResource:function(href){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":href}})},Format:function(format){return this.createElementNSPlus("sld:Format",{value:format})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(name,url,params,options){var newArguments=[];params=OpenLayers.Util.upperCaseObject(params),parseFloat(params.VERSION)>=1.3&&!params.EXCEPTIONS&&(params.EXCEPTIONS="INIMAGE"),newArguments.push(name,url,params,options),OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=options&&options.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},reverseAxisOrder:function(){var projCode=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[projCode]||OpenLayers.Projection.defaults[projCode]&&OpenLayers.Projection.defaults[projCode].yx)},getURL:function(bounds){bounds=this.adjustBounds(bounds);var imageSize=this.getImageSize(),newParams={},reverseAxisOrder=this.reverseAxisOrder();newParams.BBOX=this.encodeBBOX?bounds.toBBOX(null,reverseAxisOrder):bounds.toArray(reverseAxisOrder),newParams.WIDTH=imageSize.w,newParams.HEIGHT=imageSize.h;var requestString=this.getFullRequestString(newParams);return requestString},mergeNewParams:function(newParams){var upperParams=OpenLayers.Util.upperCaseObject(newParams),newArguments=[upperParams];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,newArguments)},getFullRequestString:function(newParams,altUrl){var mapProjection=this.map.getProjectionObject(),projectionCode=this.projection&&this.projection.equals(mapProjection)?this.projection.getCode():mapProjection.getCode(),value="none"==projectionCode?null:projectionCode;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=value:this.params.SRS=value,"boolean"==typeof this.params.TRANSPARENT&&(newParams.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(name,url,params,options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),
this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(bounds){bounds=this.adjustBounds(bounds);var mapRes=this.map.getResolution(),scale=Math.round(1e4*this.map.getScale())/1e4,pX=Math.round(bounds.left/mapRes),pY=-Math.round(bounds.top/mapRes);return this.getFullRequestString({t:pY,l:pX,s:scale})},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w,tilelat=resolution*this.tileSize.h,offsetlon=bounds.left,tilecol=Math.floor(offsetlon/tilelon)-this.buffer,offsetlat=bounds.top,tilerow=Math.floor(offsetlat/tilelat)+this.buffer;return{tilelon:tilelon,tilelat:tilelat,startcol:tilecol,startrow:tilerow}},getTileBoundsForGridIndex:function(row,col){var tileLayout=(this.getTileOrigin(),this.gridLayout),tilelon=tileLayout.tilelon,tilelat=tileLayout.tilelat,minX=(tileLayout.startcol+col)*tilelon,minY=(tileLayout.startrow-row)*tilelat;return new OpenLayers.Bounds(minX,minY,minX+tilelon,minY+tilelat)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]),null!=this.tileSize&&(obj.tileSize=this.tileSize.clone()),obj.grid=[],obj},getTileBounds:function(viewPortPx){var resolution=this.getResolution(),tileMapWidth=resolution*this.tileSize.w,tileMapHeight=resolution*this.tileSize.h,mapPoint=this.getLonLatFromViewPortPx(viewPortPx),tileLeft=tileMapWidth*Math.floor(mapPoint.lon/tileMapWidth),tileBottom=tileMapHeight*Math.floor(mapPoint.lat/tileMapHeight);return new OpenLayers.Bounds(tileLeft,tileBottom,tileLeft+tileMapWidth,tileBottom+tileMapHeight)},CLASS_NAME:"OpenLayers.Layer.KaMap"}),OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(options){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[options])},read_sld_MinScaleDenominator:function(layerContext,node){var minScaleDenominator=parseFloat(this.getChildValue(node));minScaleDenominator>0&&(layerContext.maxScale=minScaleDenominator)},read_sld_MaxScaleDenominator:function(layerContext,node){layerContext.minScale=parseFloat(this.getChildValue(node))},read_wmc_SRS:function(layerContext,node){"srs"in layerContext||(layerContext.srs={}),layerContext.srs[this.getChildValue(node)]=!0},write_wmc_Layer:function(context){var node=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[context]);if(context.maxScale){var minSD=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");minSD.appendChild(this.createTextNode(context.maxScale.toPrecision(16))),node.appendChild(minSD)}if(context.minScale){var maxSD=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");maxSD.appendChild(this.createTextNode(context.minScale.toPrecision(16))),node.appendChild(maxSD)}if(context.srs)for(var name in context.srs)node.appendChild(this.createElementDefaultNS("SRS",name));return node.appendChild(this.write_wmc_FormatList(context)),node.appendChild(this.write_wmc_StyleList(context)),context.dimensions&&node.appendChild(this.write_wmc_DimensionList(context)),node.appendChild(this.write_wmc_LayerExtension(context)),node},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"}),OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"}),OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);var xls={};return this.readChildNodes(data,xls),xls},readers:{xls:{XLS:function(node,xls){xls.version=node.getAttribute("version"),this.readChildNodes(node,xls)},Response:function(node,xls){this.readChildNodes(node,xls)},GeocodeResponse:function(node,xls){xls.responseLists=[],this.readChildNodes(node,xls)},GeocodeResponseList:function(node,xls){var responseList={features:[],numberOfGeocodedAddresses:parseInt(node.getAttribute("numberOfGeocodedAddresses"))};xls.responseLists.push(responseList),this.readChildNodes(node,responseList)},GeocodedAddress:function(node,responseList){var feature=new OpenLayers.Feature.Vector;responseList.features.push(feature),this.readChildNodes(node,feature),feature.geometry=feature.components[0]},GeocodeMatchCode:function(node,feature){feature.attributes.matchCode={accuracy:parseFloat(node.getAttribute("accuracy")),matchType:node.getAttribute("matchType")}},Address:function(node,feature){var address={countryCode:node.getAttribute("countryCode"),addressee:node.getAttribute("addressee"),street:[],place:[]};feature.attributes.address=address,this.readChildNodes(node,address)},freeFormAddress:function(node,address){address.freeFormAddress=this.getChildValue(node)},StreetAddress:function(node,address){this.readChildNodes(node,address)},Building:function(node,address){address.building={number:node.getAttribute("number"),subdivision:node.getAttribute("subdivision"),buildingName:node.getAttribute("buildingName")}},Street:function(node,address){address.street.push(this.getChildValue(node))},Place:function(node,address){address.place[node.getAttribute("type")]=this.getChildValue(node)},PostalCode:function(node,address){address.postalCode=this.getChildValue(node)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(request){return this.writers.xls.XLS.apply(this,[request])},writers:{xls:{XLS:function(request){var root=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});return this.writeNode("RequestHeader",request.header,root),this.writeNode("Request",request,root),root},RequestHeader:function(header){return this.createElementNSPlus("xls:RequestHeader")},Request:function(request){var node=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:request.requestID||"",version:this.VERSION}});return this.writeNode("GeocodeRequest",request.addresses,node),node},GeocodeRequest:function(addresses){for(var node=this.createElementNSPlus("xls:GeocodeRequest"),i=0,len=addresses.length;len>i;i++)this.writeNode("Address",addresses[i],node);return node},Address:function(address){var node=this.createElementNSPlus("xls:Address",{attributes:{countryCode:address.countryCode}});return address.freeFormAddress?this.writeNode("freeFormAddress",address.freeFormAddress,node):(address.street&&this.writeNode("StreetAddress",address,node),address.municipality&&this.writeNode("Municipality",address.municipality,node),address.countrySubdivision&&this.writeNode("CountrySubdivision",address.countrySubdivision,node),address.postalCode&&this.writeNode("PostalCode",address.postalCode,node)),node},freeFormAddress:function(freeFormAddress){return this.createElementNSPlus("freeFormAddress",{value:freeFormAddress})},StreetAddress:function(address){var node=this.createElementNSPlus("xls:StreetAddress");address.building&&this.writeNode(node,"Building",address.building);var street=address.street;OpenLayers.Util.isArray(street)||(street=[street]);for(var i=0,len=street.length;len>i;i++)this.writeNode("Street",street[i],node);return node},Building:function(building){return this.createElementNSPlus("xls:Building",{attributes:{number:building.number,subdivision:building.subdivision,buildingName:building.buildingName}})},Street:function(street){return this.createElementNSPlus("xls:Street",{value:street})},Municipality:function(municipality){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:municipality})},CountrySubdivision:function(countrySubdivision){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:countrySubdivision})},PostalCode:function(postalCode){return this.createElementNSPlus("xls:PostalCode",{value:postalCode})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"}),OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"}),OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0,OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(containerID){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var svgFeature="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(svgFeature+"SVG","1.1")||document.implementation.hasFeature(svgFeature+"BasicStructure","1.1"))},inValidRange:function(x,y,xyOnly){var left=x+(xyOnly?0:this.translationParameters.x),top=y+(xyOnly?0:this.translationParameters.y);return left>=-this.MAX_PIXEL&&left<=this.MAX_PIXEL&&top>=-this.MAX_PIXEL&&top<=this.MAX_PIXEL},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),resolution=this.getResolution(),left=-extent.left/resolution,top=extent.top/resolution;if(resolutionChanged){this.left=left,this.top=top;var extentString="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",extentString),this.translate(this.xOffset,0),!0}var inRange=this.translate(left-this.left+this.xOffset,top-this.top);return inRange||this.setExtent(extent,!0),coordSysUnchanged&&inRange},translate:function(x,y){if(this.inValidRange(x,y,!0)){var transformString="";return(x||y)&&(transformString="translate("+x+","+y+")"),this.root.setAttributeNS(null,"transform",transformString),this.translationParameters={x:x,y:y},!0}return!1},setSize:function(size){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(geometry,style){var nodeType=null;switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":nodeType=style.externalGraphic?"image":this.isComplexSymbol(style.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":nodeType="rect";break;case"OpenLayers.Geometry.LineString":nodeType="polyline";break;case"OpenLayers.Geometry.LinearRing":nodeType="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":nodeType="path"}return nodeType},setStyle:function(node,style,options){style=style||node._style,options=options||node._options;var title=style.title||style.graphicTitle;if(title){node.setAttributeNS(null,"title",title);var titleNode=node.getElementsByTagName("title");if(titleNode.length>0)titleNode[0].firstChild.textContent=title;else{var label=this.nodeFactory(null,"title");label.textContent=title,node.appendChild(label)}}var pos,r=parseFloat(node.getAttributeNS(null,"r")),widthFactor=1;if("OpenLayers.Geometry.Point"==node._geometryClass&&r){if(node.style.visibility="",style.graphic===!1)node.style.visibility="hidden";else if(style.externalGraphic){pos=this.getPosition(node),style.graphicWidth&&style.graphicHeight&&node.setAttributeNS(null,"preserveAspectRatio","none");var width=style.graphicWidth||style.graphicHeight,height=style.graphicHeight||style.graphicWidth;width=width?width:2*style.pointRadius,height=height?height:2*style.pointRadius;var xOffset=void 0!=style.graphicXOffset?style.graphicXOffset:-(.5*width),yOffset=void 0!=style.graphicYOffset?style.graphicYOffset:-(.5*height),opacity=style.graphicOpacity||style.fillOpacity;node.setAttributeNS(null,"x",(pos.x+xOffset).toFixed()),node.setAttributeNS(null,"y",(pos.y+yOffset).toFixed()),node.setAttributeNS(null,"width",width),node.setAttributeNS(null,"height",height),node.setAttributeNS(this.xlinkns,"xlink:href",style.externalGraphic),node.setAttributeNS(null,"style","opacity: "+opacity),node.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(style.graphicName)){var offset=3*style.pointRadius,size=2*offset,src=this.importSymbol(style.graphicName);pos=this.getPosition(node),widthFactor=3*this.symbolMetrics[src.id][0]/size;var parent=node.parentNode,nextSibling=node.nextSibling;parent&&parent.removeChild(node),node.firstChild&&node.removeChild(node.firstChild),node.appendChild(src.firstChild.cloneNode(!0)),node.setAttributeNS(null,"viewBox",src.getAttributeNS(null,"viewBox")),node.setAttributeNS(null,"width",size),node.setAttributeNS(null,"height",size),node.setAttributeNS(null,"x",pos.x-offset),node.setAttributeNS(null,"y",pos.y-offset),nextSibling?parent.insertBefore(node,nextSibling):parent&&parent.appendChild(node)}else node.setAttributeNS(null,"r",style.pointRadius);var rotation=style.rotation;if((void 0!==rotation||void 0!==node._rotation)&&pos)if(node._rotation=rotation,rotation|=0,"svg"!==node.nodeName)node.setAttributeNS(null,"transform","rotate("+rotation+" "+pos.x+" "+pos.y+")");else{var metrics=this.symbolMetrics[src.id];node.firstChild.setAttributeNS(null,"transform","rotate("+rotation+" "+metrics[1]+" "+metrics[2]+")")}}return options.isFilled?(node.setAttributeNS(null,"fill",style.fillColor),node.setAttributeNS(null,"fill-opacity",style.fillOpacity)):node.setAttributeNS(null,"fill","none"),options.isStroked?(node.setAttributeNS(null,"stroke",style.strokeColor),node.setAttributeNS(null,"stroke-opacity",style.strokeOpacity),node.setAttributeNS(null,"stroke-width",style.strokeWidth*widthFactor),node.setAttributeNS(null,"stroke-linecap",style.strokeLinecap||"round"),node.setAttributeNS(null,"stroke-linejoin","round"),style.strokeDashstyle&&node.setAttributeNS(null,"stroke-dasharray",this.dashStyle(style,widthFactor))):node.setAttributeNS(null,"stroke","none"),style.pointerEvents&&node.setAttributeNS(null,"pointer-events",style.pointerEvents),null!=style.cursor&&node.setAttributeNS(null,"cursor",style.cursor),node},dashStyle:function(style,widthFactor){var w=style.strokeWidth*widthFactor,str=style.strokeDashstyle;switch(str){case"solid":return"none";case"dot":return[1,4*w].join();case"dash":return[4*w,4*w].join();case"dashdot":return[4*w,4*w,1,4*w].join();case"longdash":return[8*w,4*w].join();case"longdashdot":return[8*w,4*w,1,4*w].join();default:return OpenLayers.String.trim(str).replace(/\s+/g,",")}},createNode:function(type,id){var node=document.createElementNS(this.xmlns,type);return id&&node.setAttributeNS(null,"id",id),node},nodeTypeCompare:function(node,type){return type==node.nodeName},createRenderRoot:function(){var svg=this.nodeFactory(this.container.id+"_svgRoot","svg");return svg.style.display="block",svg},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"g")},createDefs:function(){var defs=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(defs),defs},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)},drawCircle:function(node,geometry,radius){var resolution=this.getResolution(),x=(geometry.x-this.featureDx)/resolution+this.left,y=this.top-geometry.y/resolution;return this.inValidRange(x,y)?(node.setAttributeNS(null,"cx",x),node.setAttributeNS(null,"cy",y),node.setAttributeNS(null,"r",radius),node):!1},drawLineString:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);return componentsResult.path?(node.setAttributeNS(null,"points",componentsResult.path),componentsResult.complete?node:null):!1},drawLinearRing:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);return componentsResult.path?(node.setAttributeNS(null,"points",componentsResult.path),componentsResult.complete?node:null):!1},drawPolygon:function(node,geometry){for(var linearRingResult,path,d="",draw=!0,complete=!0,j=0,len=geometry.components.length;len>j;j++)d+=" M",linearRingResult=this.getComponentsString(geometry.components[j].components," "),path=linearRingResult.path,path?(d+=" "+path,complete=linearRingResult.complete&&complete):draw=!1;return d+=" z",draw?(node.setAttributeNS(null,"d",d),node.setAttributeNS(null,"fill-rule","evenodd"),complete?node:null):!1},drawRectangle:function(node,geometry){var resolution=this.getResolution(),x=(geometry.x-this.featureDx)/resolution+this.left,y=this.top-geometry.y/resolution;return this.inValidRange(x,y)?(node.setAttributeNS(null,"x",x),node.setAttributeNS(null,"y",y),node.setAttributeNS(null,"width",geometry.width/resolution),node.setAttributeNS(null,"height",geometry.height/resolution),node):!1},drawText:function(featureId,style,location){var drawOutline=!!style.labelOutlineWidth;if(drawOutline){var outlineStyle=OpenLayers.Util.extend({},style);outlineStyle.fontColor=outlineStyle.labelOutlineColor,outlineStyle.fontStrokeColor=outlineStyle.labelOutlineColor,outlineStyle.fontStrokeWidth=style.labelOutlineWidth,style.labelOutlineOpacity&&(outlineStyle.fontOpacity=style.labelOutlineOpacity),delete outlineStyle.labelOutlineWidth,this.drawText(featureId,outlineStyle,location)}var resolution=this.getResolution(),x=(location.x-this.featureDx)/resolution+this.left,y=location.y/resolution-this.top,suffix=drawOutline?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,label=this.nodeFactory(featureId+suffix,"text");label.setAttributeNS(null,"x",x),label.setAttributeNS(null,"y",-y),style.fontColor&&label.setAttributeNS(null,"fill",style.fontColor),style.fontStrokeColor&&label.setAttributeNS(null,"stroke",style.fontStrokeColor),style.fontStrokeWidth&&label.setAttributeNS(null,"stroke-width",style.fontStrokeWidth),style.fontOpacity&&label.setAttributeNS(null,"opacity",style.fontOpacity),style.fontFamily&&label.setAttributeNS(null,"font-family",style.fontFamily),style.fontSize&&label.setAttributeNS(null,"font-size",style.fontSize),style.fontWeight&&label.setAttributeNS(null,"font-weight",style.fontWeight),style.fontStyle&&label.setAttributeNS(null,"font-style",style.fontStyle),style.labelSelect===!0?(label.setAttributeNS(null,"pointer-events","visible"),label._featureId=featureId):label.setAttributeNS(null,"pointer-events","none");var align=style.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;label.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[0]]||"middle"),OpenLayers.IS_GECKO===!0&&label.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[1]]||"central");for(var labelRows=style.label.split("\n"),numRows=labelRows.length;label.childNodes.length>numRows;)label.removeChild(label.lastChild);for(var i=0;numRows>i;i++){var tspan=this.nodeFactory(featureId+suffix+"_tspan_"+i,"tspan");if(style.labelSelect===!0&&(tspan._featureId=featureId,tspan._geometry=location,tspan._geometryClass=location.CLASS_NAME),OpenLayers.IS_GECKO===!1&&tspan.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[align[1]]||"-35%"),tspan.setAttribute("x",x),0==i){var vfactor=OpenLayers.Renderer.SVG.LABEL_VFACTOR[align[1]];null==vfactor&&(vfactor=-.5),tspan.setAttribute("dy",vfactor*(numRows-1)+"em")}else tspan.setAttribute("dy","1em");tspan.textContent=""===labelRows[i]?" ":labelRows[i],tspan.parentNode||label.appendChild(tspan)}label.parentNode||this.textRoot.appendChild(label)},getComponentsString:function(components,separator){for(var str,component,renderCmp=[],complete=!0,len=components.length,strings=[],i=0;len>i;i++)component=components[i],renderCmp.push(component),str=this.getShortString(component),str?strings.push(str):(i>0&&this.getShortString(components[i-1])&&strings.push(this.clipLine(components[i],components[i-1])),len-1>i&&this.getShortString(components[i+1])&&strings.push(this.clipLine(components[i],components[i+1])),complete=!1);return{path:strings.join(separator||","),complete:complete}},clipLine:function(badComponent,goodComponent){if(goodComponent.equals(badComponent))return"";var k,resolution=this.getResolution(),maxX=this.MAX_PIXEL-this.translationParameters.x,maxY=this.MAX_PIXEL-this.translationParameters.y,x1=(goodComponent.x-this.featureDx)/resolution+this.left,y1=this.top-goodComponent.y/resolution,x2=(badComponent.x-this.featureDx)/resolution+this.left,y2=this.top-badComponent.y/resolution;return(-maxX>x2||x2>maxX)&&(k=(y2-y1)/(x2-x1),x2=0>x2?-maxX:maxX,y2=y1+(x2-x1)*k),(-maxY>y2||y2>maxY)&&(k=(x2-x1)/(y2-y1),y2=0>y2?-maxY:maxY,x2=x1+(y2-y1)*k),x2+","+y2},getShortString:function(point){var resolution=this.getResolution(),x=(point.x-this.featureDx)/resolution+this.left,y=this.top-point.y/resolution;return this.inValidRange(x,y)?x+","+y:!1},getPosition:function(node){return{x:parseFloat(node.getAttributeNS(null,"cx")),y:parseFloat(node.getAttributeNS(null,"cy"))}},importSymbol:function(graphicName){this.defs||(this.defs=this.createDefs());var id=this.container.id+"-"+graphicName,existing=document.getElementById(id);if(null!=existing)return existing;var symbol=OpenLayers.Renderer.symbol[graphicName];if(!symbol)throw new Error(graphicName+" is not a valid symbol name");var symbolNode=this.nodeFactory(id,"symbol"),node=this.nodeFactory(null,"polygon");symbolNode.appendChild(node);for(var x,y,symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),points=[],i=0;i<symbol.length;i+=2)x=symbol[i],y=symbol[i+1],symbolExtent.left=Math.min(symbolExtent.left,x),symbolExtent.bottom=Math.min(symbolExtent.bottom,y),symbolExtent.right=Math.max(symbolExtent.right,x),symbolExtent.top=Math.max(symbolExtent.top,y),points.push(x,",",y);node.setAttributeNS(null,"points",points.join(" "));var width=symbolExtent.getWidth(),height=symbolExtent.getHeight(),viewBox=[symbolExtent.left-width,symbolExtent.bottom-height,3*width,3*height];return symbolNode.setAttributeNS(null,"viewBox",viewBox.join(" ")),this.symbolMetrics[id]=[Math.max(width,height),symbolExtent.getCenterLonLat().lon,symbolExtent.getCenterLonLat().lat],this.defs.appendChild(symbolNode),symbolNode},getFeatureIdFromEvent:function(evt){var featureId=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!featureId){var target=evt.target;featureId=target.parentNode&&target!=this.rendererRoot?target.parentNode._featureId:void 0}return featureId},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)},OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"}),OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(root,options){var version=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return"0.3.0"===version&&(version=this.defaultVersion),version},toContext:function(obj){var context={};return"OpenLayers.Map"==obj.CLASS_NAME&&(context.bounds=obj.getExtent(),context.maxExtent=obj.maxExtent,context.projection=obj.projection,context.size=obj.getSize(),context.layers=obj.layers),context},CLASS_NAME:"OpenLayers.Format.OWSContext"}),OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]),OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(l){if(l.layersContext)for(var i=0,len=l.layersContext.length;len>i;i++){var layerContext=l.layersContext[i],nPath=[],nTitle=l.title||"";l.metadata&&l.metadata.nestingPath&&(nPath=l.metadata.nestingPath.slice()),""!=nTitle&&nPath.push(nTitle),layerContext.metadata.nestingPath=nPath,layerContext.layersContext&&this.setNestingPath(layerContext)}},decomposeNestingPath:function(nPath){var a=[];if(OpenLayers.Util.isArray(nPath)){for(var path=nPath.slice();path.length>0;)a.push(path.slice()),path.pop();a.reverse()}return a},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var context={};this.readNode(data,context),this.setNestingPath({layersContext:context.layersContext});var layers=[];return this.processLayer(layers,context),delete context.layersContext,context.layersContext=layers,context},processLayer:function(layerArray,layer){if(layer.layersContext)for(var i=0,len=layer.layersContext.length;len>i;i++){var l=layer.layersContext[i];layerArray.push(l),l.layersContext&&this.processLayer(layerArray,l)}},write:function(context,options){var name="OWSContext";this.nestingLayerLookup={},options=options||{},OpenLayers.Util.applyDefaults(options,context);var root=this.writeNode(name,options);return this.nestingLayerLookup=null,this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[root])},readers:{kml:{Document:function(node,obj){obj.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0}).read(node)}},owc:{OWSContext:function(node,obj){this.readChildNodes(node,obj)},General:function(node,obj){this.readChildNodes(node,obj)},ResourceList:function(node,obj){this.readChildNodes(node,obj)},Layer:function(node,obj){var layerContext={metadata:{},visibility:"1"!=node.getAttribute("hidden"),queryable:"1"==node.getAttribute("queryable"),opacity:null!=node.getAttribute("opacity")?parseFloat(node.getAttribute("opacity")):null,name:node.getAttribute("name"),categoryLayer:null==node.getAttribute("name"),formats:[],styles:[]};obj.layersContext||(obj.layersContext=[]),obj.layersContext.push(layerContext),this.readChildNodes(node,layerContext)},InlineGeometry:function(node,obj){obj.features=[];var el,elements=this.getElementsByTagNameNS(node,this.namespaces.gml,"featureMember");if(elements.length>=1&&(el=elements[0]),el&&el.firstChild){var featurenode=el.firstChild.nextSibling?el.firstChild.nextSibling:el.firstChild;this.setNamespace("feature",featurenode.namespaceURI),this.featureType=featurenode.localName||featurenode.nodeName.split(":").pop(),this.readChildNodes(node,obj)}},Server:function(node,obj){(!obj.service&&!obj.version||obj.service!=OpenLayers.Format.Context.serviceTypes.WMS)&&(obj.service=node.getAttribute("service"),obj.version=node.getAttribute("version"),this.readChildNodes(node,obj))},Name:function(node,obj){obj.name=this.getChildValue(node),this.readChildNodes(node,obj)},Title:function(node,obj){obj.title=this.getChildValue(node),this.readChildNodes(node,obj)},StyleList:function(node,obj){this.readChildNodes(node,obj.styles)},Style:function(node,obj){var style={};obj.push(style),this.readChildNodes(node,style)},LegendURL:function(node,obj){var legend={};obj.legend=legend,this.readChildNodes(node,legend)},OnlineResource:function(node,obj){obj.url=this.getAttributeNS(node,this.namespaces.xlink,"href"),this.readChildNodes(node,obj)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(options){var node=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:options.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});return this.writeNode("General",options,node),this.writeNode("ResourceList",options,node),node},General:function(options){var node=this.createElementNSPlus("General");return this.writeNode("ows:BoundingBox",options,node),this.writeNode("ows:Title",options.title||"OpenLayers OWSContext",node),node},ResourceList:function(options){for(var node=this.createElementNSPlus("ResourceList"),i=0,len=options.layers.length;len>i;i++){var layer=options.layers[i],decomposedPath=this.decomposeNestingPath(layer.metadata.nestingPath);this.writeNode("_Layer",{layer:layer,subPaths:decomposedPath},node)}return node},Server:function(options){var node=this.createElementNSPlus("Server",{attributes:{version:options.version,service:options.service}});return this.writeNode("OnlineResource",options,node),node},OnlineResource:function(options){var node=this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":options.url}});return node},InlineGeometry:function(layer){var node=this.createElementNSPlus("InlineGeometry"),dataExtent=layer.getDataExtent();null!==dataExtent&&this.writeNode("gml:boundedBy",dataExtent,node);for(var i=0,len=layer.features.length;len>i;i++)this.writeNode("gml:featureMember",layer.features[i],node);return node},StyleList:function(styles){for(var node=this.createElementNSPlus("StyleList"),i=0,len=styles.length;len>i;i++)this.writeNode("Style",styles[i],node);return node},Style:function(style){var node=this.createElementNSPlus("Style");return this.writeNode("Name",style,node),this.writeNode("Title",style,node),style.legend&&this.writeNode("LegendURL",style,node),node},Name:function(obj){var node=this.createElementNSPlus("Name",{value:obj.name});return node},Title:function(obj){var node=this.createElementNSPlus("Title",{value:obj.title});return node},LegendURL:function(style){var node=this.createElementNSPlus("LegendURL");return this.writeNode("OnlineResource",style.legend,node),node},_WMS:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:layer.params.LAYERS,queryable:layer.queryable?"1":"0",hidden:layer.visibility?"0":"1",opacity:layer.hasOwnProperty("opacity")?layer.opacity:null}});return this.writeNode("ows:Title",layer.name,node),this.writeNode("ows:OutputFormat",layer.params.FORMAT,node),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:layer.params.VERSION,url:layer.url},node),layer.metadata.styles&&layer.metadata.styles.length>0&&this.writeNode("StyleList",layer.metadata.styles,node),node},_Layer:function(options){var layer,subPaths,node,title;if(layer=options.layer,subPaths=options.subPaths,node=null,title=null,subPaths.length>0){var path=subPaths[0].join("/"),index=path.lastIndexOf("/");return node=this.nestingLayerLookup[path],title=index>0?path.substring(index+1,path.length):path,node||(node=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",title,node),this.nestingLayerLookup[path]=node),options.subPaths.shift(),this.writeNode("_Layer",options,node),node}return layer instanceof OpenLayers.Layer.WMS?node=this.writeNode("_WMS",layer):layer instanceof OpenLayers.Layer.Vector&&(layer.protocol instanceof OpenLayers.Protocol.WFS.v1?node=this.writeNode("_WFS",layer):layer.protocol instanceof OpenLayers.Protocol.HTTP?layer.protocol.format instanceof OpenLayers.Format.GML?(layer.protocol.format.version="2.1.2",node=this.writeNode("_GML",layer)):layer.protocol.format instanceof OpenLayers.Format.KML&&(layer.protocol.format.version="2.2",
node=this.writeNode("_KML",layer)):(this.setNamespace("feature",this.featureNS),node=this.writeNode("_InlineGeometry",layer))),layer.options.maxScale&&this.writeNode("sld:MinScaleDenominator",layer.options.maxScale,node),layer.options.minScale&&this.writeNode("sld:MaxScaleDenominator",layer.options.minScale,node),this.nestingLayerLookup[layer.name]=node,node},_WFS:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:layer.protocol.featurePrefix+":"+layer.protocol.featureType,hidden:layer.visibility?"0":"1"}});return this.writeNode("ows:Title",layer.name,node),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:layer.protocol.version,url:layer.protocol.url},node),node},_InlineGeometry:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:layer.visibility?"0":"1"}});return this.writeNode("ows:Title",layer.name,node),this.writeNode("InlineGeometry",layer,node),node},_GML:function(layer){var node=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",layer.name,node),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:layer.protocol.url,version:layer.protocol.format.version},node),node},_KML:function(layer){var node=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",layer.name,node),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:layer.protocol.format.version,url:layer.protocol.url},node),node}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(bounds){var node=this.createElementNSPlus("gml:boundedBy");return this.writeNode("gml:Box",bounds,node),node}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"}),OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(id,lonlat,contentSize,contentHTML,closeBox,closeBoxCallback){null==id&&(id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=id,this.lonlat=lonlat,this.contentSize=null!=contentSize?contentSize:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=contentHTML&&(this.contentHTML=contentHTML),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass;var groupDivId=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(groupDivId,null,null,null,"relative",null,"hidden");var id=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(id,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),closeBox&&this.addCloseBox(closeBoxCallback),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(px){return null==px&&null!=this.lonlat&&null!=this.map&&(px=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var style=document.defaultView.getComputedStyle(this.contentDiv,null),currentOverflow=style.getPropertyValue("overflow");"hidden"!=currentOverflow&&(this.contentDiv._oldOverflow=currentOverflow,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var oldOverflow=this.contentDiv._oldOverflow;oldOverflow&&(this.contentDiv.style.overflow=oldOverflow,this.contentDiv._oldOverflow=null)})),this.moveTo(px),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var px=this.map.getLayerPxFromLonLat(this.lonlat);px&&this.moveTo(px)}},moveTo:function(px){null!=px&&null!=this.div&&(this.div.style.left=px.x+"px",this.div.style.top=px.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(contentSize){this.size=contentSize.clone();var contentDivPadding=this.getContentDivPadding(),wPadding=contentDivPadding.left+contentDivPadding.right,hPadding=contentDivPadding.top+contentDivPadding.bottom;if(this.fixPadding(),wPadding+=this.padding.left+this.padding.right,hPadding+=this.padding.top+this.padding.bottom,this.closeDiv){var closeDivWidth=parseInt(this.closeDiv.style.width);wPadding+=closeDivWidth+contentDivPadding.right}this.size.w+=wPadding,this.size.h+=hPadding,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=contentDivPadding.left+contentDivPadding.right,this.contentSize.h+=contentDivPadding.bottom+contentDivPadding.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=contentSize.w+"px",this.contentDiv.style.height=contentSize.h+"px")},updateSize:function(){var preparedHTML="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",containerElement=this.map?this.map.div:document.body,realSize=OpenLayers.Util.getRenderedDimensions(preparedHTML,null,{displayClass:this.displayClass,containerElement:containerElement}),safeSize=this.getSafeContentSize(realSize),newSize=null;if(safeSize.equals(realSize))newSize=realSize;else{var fixedSize={w:safeSize.w<realSize.w?safeSize.w:null,h:safeSize.h<realSize.h?safeSize.h:null};if(fixedSize.w&&fixedSize.h)newSize=safeSize;else{var clippedSize=OpenLayers.Util.getRenderedDimensions(preparedHTML,fixedSize,{displayClass:this.contentDisplayClass,containerElement:containerElement}),currentOverflow=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=currentOverflow&&clippedSize.equals(safeSize)){var scrollBar=OpenLayers.Util.getScrollbarWidth();fixedSize.w?clippedSize.h+=scrollBar:clippedSize.w+=scrollBar}newSize=this.getSafeContentSize(clippedSize)}}this.setSize(newSize)},setBackgroundColor:function(color){void 0!=color&&(this.backgroundColor=color),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(opacity){void 0!=opacity&&(this.opacity=opacity),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(border){void 0!=border&&(this.border=border),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(contentHTML){null!=contentHTML&&(this.contentHTML=contentHTML),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var onImgLoad=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},images=this.contentDiv.getElementsByTagName("img"),i=0,len=images.length;len>i;i++){var img=images[i];if(0==img.width||0==img.height){var context={popup:this,img:img};img._onImgLoad=OpenLayers.Function.bind(onImgLoad,context),OpenLayers.Event.observe(img,"load",img._onImgLoad)}}},getSafeContentSize:function(size){var safeContentSize=size.clone(),contentDivPadding=this.getContentDivPadding(),wPadding=contentDivPadding.left+contentDivPadding.right,hPadding=contentDivPadding.top+contentDivPadding.bottom;if(this.fixPadding(),wPadding+=this.padding.left+this.padding.right,hPadding+=this.padding.top+this.padding.bottom,this.closeDiv){var closeDivWidth=parseInt(this.closeDiv.style.width);wPadding+=closeDivWidth+contentDivPadding.right}if(this.minSize&&(safeContentSize.w=Math.max(safeContentSize.w,this.minSize.w-wPadding),safeContentSize.h=Math.max(safeContentSize.h,this.minSize.h-hPadding)),this.maxSize&&(safeContentSize.w=Math.min(safeContentSize.w,this.maxSize.w-wPadding),safeContentSize.h=Math.min(safeContentSize.h,this.maxSize.h-hPadding)),this.map&&this.map.size){var extraX=0,extraY=0;if(this.keepInMap&&!this.panMapIfOutOfView){var px=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":extraX=px.x,extraY=this.map.size.h-px.y;break;case"tl":extraX=this.map.size.w-px.x,extraY=this.map.size.h-px.y;break;case"bl":extraX=this.map.size.w-px.x,extraY=px.y;break;case"br":extraX=px.x,extraY=px.y;break;default:extraX=px.x,extraY=this.map.size.h-px.y}}var maxY=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-hPadding-extraY,maxX=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-wPadding-extraX;safeContentSize.w=Math.min(safeContentSize.w,maxX),safeContentSize.h=Math.min(safeContentSize.h,maxY)}return safeContentSize},getContentDivPadding:function(){var contentDivPadding=this._contentDivPadding;return contentDivPadding||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),contentDivPadding=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=contentDivPadding,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),contentDivPadding},addCloseBox:function(callback){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var contentDivPadding=this.getContentDivPadding();this.closeDiv.style.right=contentDivPadding.right+"px",this.closeDiv.style.top=contentDivPadding.top+"px",this.groupDiv.appendChild(this.closeDiv);var closePopup=callback||function(e){this.hide(),OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(closePopup,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(closePopup,this))},panIntoView:function(){var mapSize=this.map.getSize(),origTL=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),newTL=origTL.clone();origTL.x<this.map.paddingForPopups.left?newTL.x=this.map.paddingForPopups.left:origTL.x+this.size.w>mapSize.w-this.map.paddingForPopups.right&&(newTL.x=mapSize.w-this.map.paddingForPopups.right-this.size.w),origTL.y<this.map.paddingForPopups.top?newTL.y=this.map.paddingForPopups.top:origTL.y+this.size.h>mapSize.h-this.map.paddingForPopups.bottom&&(newTL.y=mapSize.h-this.map.paddingForPopups.bottom-this.size.h);var dx=origTL.x-newTL.x,dy=origTL.y-newTL.y;this.map.pan(dx,dy)},registerEvents:function(){function onTouchstart(evt){OpenLayers.Event.stop(evt,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:onTouchstart,scope:this})},onmousedown:function(evt){this.mousedown=!0,OpenLayers.Event.stop(evt,!0)},onmousemove:function(evt){this.mousedown&&OpenLayers.Event.stop(evt,!0)},onmouseup:function(evt){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(evt,!0))},onclick:function(evt){OpenLayers.Event.stop(evt,!0)},onmouseout:function(evt){this.mousedown=!1},ondblclick:function(evt){OpenLayers.Event.stop(evt,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.eTop){this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top";this.topInUnits.length;this.div.appendChild(this.eTop),""==this.topOutUnits||""==this.topInUnits?this.eTop.style.visibility="hidden":this.eTop.style.visibility="visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),""==this.bottomOutUnits||""==this.bottomInUnits?this.eBottom.style.visibility="hidden":this.eBottom.style.visibility="visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(maxLen){var barLen,digits=parseInt(Math.log(maxLen)/Math.log(10)),pow10=Math.pow(10,digits),firstChar=parseInt(maxLen/pow10);return barLen=firstChar>5?5:firstChar>2?2:1,barLen*pow10},update:function(){var res=this.map.getResolution();if(res){var curMapUnits=this.map.getUnits(),inches=OpenLayers.INCHES_PER_UNIT,maxSizeData=this.maxWidth*res*inches[curMapUnits],geodesicRatio=1;if(this.geodesic===!0){var maxSizeGeodesic=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,maxSizeKilometers=maxSizeData/inches.km;geodesicRatio=maxSizeGeodesic/maxSizeKilometers,maxSizeData*=geodesicRatio}var topUnits,bottomUnits;maxSizeData>1e5?(topUnits=this.topOutUnits,bottomUnits=this.bottomOutUnits):(topUnits=this.topInUnits,bottomUnits=this.bottomInUnits);var topMax=maxSizeData/inches[topUnits],bottomMax=maxSizeData/inches[bottomUnits],topRounded=this.getBarLen(topMax),bottomRounded=this.getBarLen(bottomMax);topMax=topRounded/inches[curMapUnits]*inches[topUnits],bottomMax=bottomRounded/inches[curMapUnits]*inches[bottomUnits];var topPx=topMax/res/geodesicRatio,bottomPx=bottomMax/res/geodesicRatio;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(bottomPx)+"px",this.eBottom.innerHTML=bottomRounded+" "+bottomUnits),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(topPx)+"px",this.eTop.innerHTML=topRounded+" "+topUnits)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(url,size,offset,calculateOffset){this.url=url,this.size=size||{w:20,h:20},this.offset=offset||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=calculateOffset;var id=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(id)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(size){null!=size&&(this.size=size),this.draw()},setUrl:function(url){null!=url&&(this.url=url),this.draw()},draw:function(px){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(px),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(opacity){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,opacity)},moveTo:function(px){null!=px&&(this.px=px),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(display){this.imageDiv.style.display=display?"":"none"},isDrawn:function(){var isDrawn=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return isDrawn},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(lonlat,icon){this.lonlat=lonlat;var newIcon=icon?icon:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=newIcon:(this.icon.url=newIcon.url,this.icon.size=newIcon.size,this.icon.offset=newIcon.offset,this.icon.calculateOffset=newIcon.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(px){return this.icon.draw(px)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(px){null!=px&&null!=this.icon&&this.icon.moveTo(px),this.lonlat=this.map.getLonLatFromLayerPx(px)},isDrawn:function(){var isDrawn=this.icon&&this.icon.isDrawn();return isDrawn},onScreen:function(){var onScreen=!1;if(this.map){var screenBounds=this.map.getExtent();onScreen=screenBounds.containsLonLat(this.lonlat)}return onScreen},inflate:function(inflate){this.icon&&this.icon.setSize({w:this.icon.size.w*inflate,h:this.icon.size.h*inflate})},setOpacity:function(opacity){this.icon.setOpacity(opacity)},setUrl:function(url){this.icon.setUrl(url)},display:function(display){this.icon.display(display)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(name,url,layername,options){this.layername=layername,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,{},options]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){var res=this.getServerResolution(),bbox=this.maxExtent,size=this.tileSize,tileX=Math.round((bounds.left-bbox.left)/(res*size.w)),tileY=Math.round((bounds.bottom-bbox.bottom)/(res*size.h)),tileZ=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,res):this.map.getZoom(),components=[this.layername,OpenLayers.Number.zeroPad(tileZ,2),OpenLayers.Number.zeroPad(parseInt(tileX/1e6),3),OpenLayers.Number.zeroPad(parseInt(tileX/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(tileX)%1e3,3),OpenLayers.Number.zeroPad(parseInt(tileY/1e6),3),OpenLayers.Number.zeroPad(parseInt(tileY/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(tileY)%1e3,3)+"."+this.extension],path=components.join("/"),url=this.url;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(path,url)),url="/"==url.charAt(url.length-1)?url:url+"/",url+path},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);return activated&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this}),activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})),deactivated},cacheFeatures:function(event){this.paging||(this.clearCache(),this.features=event.features,this.pageNext(event))},clearCache:function(){if(this.features)for(var i=0;i<this.features.length;++i)this.features[i].destroy();this.features=null,this.num=null},pageCount:function(){var numFeatures=this.features?this.features.length:0;return Math.ceil(numFeatures/this.length)},pageNum:function(){return this.num},pageLength:function(newLength){return newLength&&newLength>0&&(this.length=newLength),this.length},pageNext:function(event){var changed=!1;if(this.features){null===this.num&&(this.num=-1);var start=(this.num+1)*this.length;changed=this.page(start,event)}return changed},pagePrevious:function(){var changed=!1;if(this.features){null===this.num&&(this.num=this.pageCount());var start=(this.num-1)*this.length;changed=this.page(start)}return changed},page:function(start,event){var changed=!1;if(this.features&&start>=0&&start<this.features.length){var num=Math.floor(start/this.length);if(num!=this.num){this.paging=!0;var features=this.features.slice(start,start+this.length);this.layer.removeFeatures(this.layer.features),this.num=num,event&&event.features?event.features=features:this.layer.addFeatures(features),this.paging=!1,changed=!0}}return changed},CLASS_NAME:"OpenLayers.Strategy.Paging"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(feature,pixel){},onDrag:function(feature,pixel){},onComplete:function(feature,pixel){},onEnter:function(feature){},onLeave:function(feature){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(layer,options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.layer=layer,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(feature){this.handlers.feature.touch&&!this.over&&this.overFeature(feature)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(feature){this.handlers.feature.touch&&this.over&&(this.outFeature(feature),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(feature){var activated=!1;return this.handlers.drag.dragging?this.feature.id==feature.id?this.over=!0:this.over=!1:(this.feature=feature,this.handlers.drag.activate(),activated=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(feature)),activated},downFeature:function(pixel){this.lastPixel=pixel,this.onStart(this.feature,pixel)},moveFeature:function(pixel){var res=this.map.getResolution();this.feature.geometry.move(res*(pixel.x-this.lastPixel.x),res*(this.lastPixel.y-pixel.y)),this.layer.drawFeature(this.feature),this.lastPixel=pixel,this.onDrag(this.feature,pixel)},upFeature:function(pixel){this.over||this.handlers.drag.deactivate()},doneDragging:function(pixel){this.onComplete(this.feature,pixel)},outFeature:function(feature){this.handlers.drag.dragging?this.feature.id==feature.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(feature),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(map){this.handlers.drag.setMap(map),this.handlers.feature.setMap(map),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(layer,options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.layer=layer,this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"}),this.createBox(),this.createControl()},activate:function(){var activated=!1;return OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),deactivated=!0),deactivated},setMap:function(map){this.dragControl.setMap(map),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(feature,initialParams){initialParams=OpenLayers.Util.applyDefaults(initialParams,{rotation:0,scale:1,ratio:1});var oldRotation=this.rotation,oldCenter=this.center;OpenLayers.Util.extend(this,initialParams);var cont=this.events.triggerEvent("beforesetfeature",{feature:feature});if(cont!==!1){this.feature=feature,this.activate(),this._setfeature=!0;var featureBounds=this.feature.geometry.getBounds();this.box.move(featureBounds.getCenterLonLat()),this.box.geometry.rotate(-oldRotation,oldCenter),this._angle=0;var ll;if(this.rotation){var geom=feature.geometry.clone();geom.rotate(-this.rotation,this.center);var box=new OpenLayers.Feature.Vector(geom.getBounds().toGeometry());box.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(box.geometry.getBounds().getCenterLonLat());var llGeom=box.geometry.components[0].components[0];ll=llGeom.getBounds().getCenterLonLat()}else ll=new OpenLayers.LonLat(featureBounds.left,featureBounds.bottom);this.handles[0].move(ll),delete this._setfeature,this.events.triggerEvent("setfeature",{feature:feature})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.scale=1,this.ratio=1)},createBox:function(){var control=this;this.center=new OpenLayers.Geometry.Point(0,0),this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent),this.box.geometry.move=function(x,y){control._moving=!0,OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments),control.center.move(x,y),delete control._moving};for(var geom,handle,rotationHandle,vertexMoveFn=function(x,y){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.move(x,y),this._handle.geometry.move(x,y)},vertexResizeFn=function(scale,center,ratio){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.resize(scale,center,ratio),this._handle.geometry.resize(scale,center,ratio)},vertexRotateFn=function(angle,center){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.rotate(angle,center),this._handle.geometry.rotate(angle,center)},handleMoveFn=function(x,y){var oldX=this.x,oldY=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,x,y),!control._moving){var evt=control.dragControl.handlers.drag.evt,preserveAspectRatio=!control._setfeature&&control.preserveAspectRatio,reshape=!(preserveAspectRatio||evt&&evt.shiftKey),oldGeom=new OpenLayers.Geometry.Point(oldX,oldY),centerGeometry=control.center;this.rotate(-control.rotation,centerGeometry),oldGeom.rotate(-control.rotation,centerGeometry);var dx1=this.x-centerGeometry.x,dy1=this.y-centerGeometry.y,dx0=dx1-(this.x-oldGeom.x),dy0=dy1-(this.y-oldGeom.y);control.irregular&&!control._setfeature&&(dx1-=(this.x-oldGeom.x)/2,dy1-=(this.y-oldGeom.y)/2),this.x=oldX,this.y=oldY;var scale,ratio=1;if(reshape)scale=Math.abs(dy0)<1e-5?1:dy1/dy0,ratio=(Math.abs(dx0)<1e-5?1:dx1/dx0)/scale;else{var l0=Math.sqrt(dx0*dx0+dy0*dy0),l1=Math.sqrt(dx1*dx1+dy1*dy1);scale=l1/l0}if(control._moving=!0,control.box.geometry.rotate(-control.rotation,centerGeometry),delete control._moving,control.box.geometry.resize(scale,centerGeometry,ratio),control.box.geometry.rotate(control.rotation,centerGeometry),control.transformFeature({scale:scale,ratio:ratio}),control.irregular&&!control._setfeature){var newCenter=centerGeometry.clone();newCenter.x+=Math.abs(oldX-centerGeometry.x)<1e-5?0:this.x-oldX,newCenter.y+=Math.abs(oldY-centerGeometry.y)<1e-5?0:this.y-oldY,control.box.geometry.move(this.x-oldX,this.y-oldY),control.transformFeature({center:newCenter})}}},rotationHandleMoveFn=function(x,y){var oldX=this.x,oldY=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,x,y),!control._moving){var evt=control.dragControl.handlers.drag.evt,constrain=evt&&evt.shiftKey?45:1,centerGeometry=control.center,dx1=this.x-centerGeometry.x,dy1=this.y-centerGeometry.y,dx0=dx1-x,dy0=dy1-y;this.x=oldX,this.y=oldY;var a0=Math.atan2(dy0,dx0),a1=Math.atan2(dy1,dx1),angle=a1-a0;angle*=180/Math.PI,control._angle=(control._angle+angle)%360;var diff=control.rotation%constrain;(Math.abs(control._angle)>=constrain||0!==diff)&&(angle=Math.round(control._angle/constrain)*constrain-diff,control._angle=0,control.box.geometry.rotate(angle,centerGeometry),control.transformFeature({rotation:angle}))}},handles=new Array(8),rotationHandles=new Array(4),positions=["sw","s","se","e","ne","n","nw","w"],i=0;8>i;++i)geom=this.box.geometry.components[i],handle=new OpenLayers.Feature.Vector(geom.clone(),{role:positions[i]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),i%2==0&&(rotationHandle=new OpenLayers.Feature.Vector(geom.clone(),{role:positions[i]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),rotationHandle.geometry.move=rotationHandleMoveFn,geom._rotationHandle=rotationHandle,rotationHandles[i/2]=rotationHandle),geom.move=vertexMoveFn,geom.resize=vertexResizeFn,geom.rotate=vertexRotateFn,handle.geometry.move=handleMoveFn,geom._handle=handle,handles[i]=handle;this.rotationHandles=rotationHandles,this.handles=handles},createControl:function(){var control=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,
moveFeature:function(pixel){this.feature===control.feature&&(this.feature=control.box),OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(feature,pixel){feature===control.box&&control.transformFeature({center:control.center})},onStart:function(feature,pixel){var eligible=!control.geometryTypes||-1!==OpenLayers.Util.indexOf(control.geometryTypes,feature.geometry.CLASS_NAME),i=OpenLayers.Util.indexOf(control.handles,feature);i+=OpenLayers.Util.indexOf(control.rotationHandles,feature),feature!==control.feature&&feature!==control.box&&-2==i&&eligible&&control.setFeature(feature)},onComplete:function(feature,pixel){control.events.triggerEvent("transformcomplete",{feature:control.feature})}})},drawHandles:function(){for(var layer=this.layer,i=0;8>i;++i)this.rotate&&i%2===0&&layer.drawFeature(this.rotationHandles[i/2],this.rotationHandleSymbolizer),layer.drawFeature(this.handles[i],this.renderIntent)},transformFeature:function(mods){if(!this._setfeature){this.scale*=mods.scale||1,this.ratio*=mods.ratio||1;var oldRotation=this.rotation;if(this.rotation=(this.rotation+(mods.rotation||0))%360,this.events.triggerEvent("beforetransform",mods)!==!1){var feature=this.feature,geom=feature.geometry,center=this.center;geom.rotate(-oldRotation,center),mods.scale||mods.ratio?geom.resize(mods.scale,center,mods.ratio):mods.center&&feature.move(mods.center.getBounds().getCenterLonLat()),geom.rotate(this.rotation,center),this.layer.drawFeature(feature),feature.toState(OpenLayers.State.UPDATE),this.events.triggerEvent("transform",mods)}}this.layer.drawFeature(this.box,this.renderIntent),this.drawHandles()},destroy:function(){for(var geom,i=0;8>i;++i)geom=this.box.geometry.components[i],geom._handle.destroy(),geom._handle=null,geom._rotationHandle&&geom._rotationHandle.destroy(),geom._rotationHandle=null;this.center=null,this.feature=null,this.handles=null,this.rotationHandleSymbolizer=null,this.rotationHandles=null,this.box.destroy(),this.box=null,this.layer=null,this.dragControl.destroy(),this.dragControl=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(map){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(map)},startBox:function(xy){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(xy){var startX=this.dragHandler.start.x,startY=this.dragHandler.start.y,deltaX=Math.abs(startX-xy.x),deltaY=Math.abs(startY-xy.y),offset=this.getBoxOffsets();this.zoomBox.style.width=deltaX+offset.width+1+"px",this.zoomBox.style.height=deltaY+offset.height+1+"px",this.zoomBox.style.left=(xy.x<startX?startX-deltaX-offset.left:startX-offset.left)+"px",this.zoomBox.style.top=(xy.y<startY?startY-deltaY-offset.top:startY-offset.top)+"px"},endBox:function(end){var result;if(Math.abs(this.dragHandler.start.x-end.x)>5||Math.abs(this.dragHandler.start.y-end.y)>5){var start=this.dragHandler.start,top=Math.min(start.y,end.y),bottom=Math.max(start.y,end.y),left=Math.min(start.x,end.x),right=Math.max(start.x,end.x);result=new OpenLayers.Bounds(left,bottom,right,top)}else result=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[result])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var testDiv=document.createElement("div");testDiv.style.position="absolute",testDiv.style.border="1px solid black",testDiv.style.width="3px",document.body.appendChild(testDiv);var w3cBoxModel=3==testDiv.clientWidth;document.body.removeChild(testDiv);var left=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),right=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),top=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),bottom=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:left,right:right,top:top,bottom:bottom,width:w3cBoxModel===!1?left+right:0,height:w3cBoxModel===!1?top+bottom:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(position){if(position instanceof OpenLayers.Bounds){var bounds,targetCenterPx=position.getCenterPixel();if(this.out){var pixWidth=position.right-position.left,pixHeight=position.bottom-position.top,zoomFactor=Math.min(this.map.size.h/pixHeight,this.map.size.w/pixWidth),extent=this.map.getExtent(),center=this.map.getLonLatFromPixel(targetCenterPx),xmin=center.lon-extent.getWidth()/2*zoomFactor,xmax=center.lon+extent.getWidth()/2*zoomFactor,ymin=center.lat-extent.getHeight()/2*zoomFactor,ymax=center.lat+extent.getHeight()/2*zoomFactor;bounds=new OpenLayers.Bounds(xmin,ymin,xmax,ymax)}else{var minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom}),maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top});bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat)}var lastZoom=this.map.getZoom(),size=this.map.getSize(),centerPx={x:size.w/2,y:size.h/2},zoom=this.map.getZoomForExtent(bounds),oldRes=this.map.getResolution(),newRes=this.map.getResolutionForZoom(zoom);if(oldRes==newRes)this.map.setCenter(this.map.getLonLatFromPixel(targetCenterPx));else{var zoomOriginPx={x:(oldRes*targetCenterPx.x-newRes*centerPx.x)/(oldRes-newRes),y:(oldRes*targetCenterPx.y-newRes*centerPx.y)/(oldRes-newRes)};this.map.zoomTo(zoom,zoomOriginPx)}lastZoom==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(lastZoom+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,position):this.map.zoomTo(this.map.getZoom()+1,position))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var config={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(config=OpenLayers.Util.extend(config,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(config)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(xy){this.kinetic&&this.kinetic.update(xy),this.panned=!0,this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:!0,animate:!1})},panMapDone:function(xy){if(this.panned){var res=null;if(this.kinetic&&(res=this.kinetic.end(xy)),this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:!!res,animate:!1}),res){var self=this;this.kinetic.move(res,function(x,y,end){self.map.pan(x,y,{dragging:!end,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(options){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var clickCallbacks={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},clickOptions={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,clickOptions),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw();var wheelOptions=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(wheelOptions,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(evt){evt.lastTouches&&2==evt.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(evt){this.map.zoomTo(this.map.zoom+1,evt.xy)},defaultDblRightClick:function(evt){this.map.zoomTo(this.map.zoom-1,evt.xy)},wheelChange:function(evt,deltaZ){this.map.fractionalZoom||(deltaZ=Math.round(deltaZ));var currentZoom=this.map.getZoom(),newZoom=currentZoom+deltaZ;newZoom=Math.max(newZoom,0),newZoom=Math.min(newZoom,this.map.getNumZoomLevels()),newZoom!==currentZoom&&this.map.zoomTo(newZoom,evt.xy)},wheelUp:function(evt,delta){this.wheelChange(evt,delta||1)},wheelDown:function(evt,delta){this.wheelChange(evt,delta||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(layer,handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(vertex,feature){this.layer.events.triggerEvent("sketchmodified",{vertex:vertex,feature:feature})},create:function(vertex,feature){this.layer.events.triggerEvent("sketchstarted",{vertex:vertex,feature:feature})}},this.callbacks),this.layer=layer,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:layer.renderers,rendererOptions:layer.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var sketchStyle=this.layer.styleMap&&this.layer.styleMap.styles.temporary;sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":sketchStyle})})),this.handler=new handler(this,this.callbacks,this.handlerOptions)},drawFeature:function(geometry){var feature=new OpenLayers.Feature.Vector(geometry),proceed=this.layer.events.triggerEvent("sketchcomplete",{feature:feature});proceed!==!1&&(feature.state=OpenLayers.State.INSERT,this.layer.addFeatures([feature]),this.featureAdded(feature),this.events.triggerEvent("featureadded",{feature:feature}))},insertXY:function(x,y){this.handler&&this.handler.line&&this.handler.insertXY(x,y)},insertDeltaXY:function(dx,dy){this.handler&&this.handler.line&&this.handler.insertDeltaXY(dx,dy)},insertDirectionLength:function(direction,length){this.handler&&this.handler.line&&this.handler.insertDirectionLength(direction,length)},insertDeflectionLength:function(deflection,length){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(deflection,length)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel),geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);this.point=new OpenLayers.Feature.Vector(geometry),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(pixel){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var candidate,polygon,geometry=this.point.geometry,features=this.control.layer.features,i=features.length-1;i>=0;--i)if(candidate=features[i].geometry,(candidate instanceof OpenLayers.Geometry.Polygon||candidate instanceof OpenLayers.Geometry.MultiPolygon)&&candidate.intersects(geometry)){polygon=features[i],this.control.layer.removeFeatures([polygon],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),polygon.geometry.addComponent(this.line.geometry),this.polygon=polygon,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(event){var point=event.vertex,components=this.line.geometry.components;if(!this.polygon.geometry.intersects(point)){var last=components[components.length-3];point.x=last.x,point.y=last.y}},finishGeometry:function(){var index=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[index]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var ring=this.line.geometry,modified=0!==ring.getArea();if(modified){for(var rings=this.polygon.geometry.components,i=rings.length-2;i>=0;--i)if(ring.intersects(rings[i])){modified=!1;break}if(modified){outer:for(var i=rings.length-2;i>0;--i)for(var points=rings[i].components,j=0,jj=points.length;jj>j;++j)if(ring.containsPoint(points[j])){modified=!1;break outer}}}return modified?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(ring),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(cancel){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,cancel||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(force){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,force),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var geometry=this.polygon&&this.polygon.geometry;return geometry&&this.multi&&(geometry=new OpenLayers.Geometry.MultiPolygon([geometry])),geometry},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(layer,options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]),this.addControls([new OpenLayers.Control.Navigation]);var controls=[new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(controls)},draw:function(){var div=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),div},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);return activated&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),deactivated},update:function(options){var mapBounds=this.getMapBounds();null!==mapBounds&&(options&&options.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(mapBounds))&&(this.calculateBounds(mapBounds),this.resolution=this.layer.map.getResolution(),this.triggerRead(options))},getMapBounds:function(){if(null===this.layer.map)return null;var bounds=this.layer.map.getExtent();return bounds&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(bounds=bounds.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),bounds},invalidBounds:function(mapBounds){mapBounds||(mapBounds=this.getMapBounds());var invalid=!this.bounds||!this.bounds.containsBounds(mapBounds);if(!invalid&&this.resFactor){var ratio=this.resolution/this.layer.map.getResolution();invalid=ratio>=this.resFactor||ratio<=1/this.resFactor}return invalid},calculateBounds:function(mapBounds){mapBounds||(mapBounds=this.getMapBounds());var center=mapBounds.getCenterLonLat(),dataWidth=mapBounds.getWidth()*this.ratio,dataHeight=mapBounds.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(center.lon-dataWidth/2,center.lat-dataHeight/2,center.lon+dataWidth/2,center.lat+dataHeight/2)},triggerRead:function(options){!this.response||options&&options.noAbort===!0||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var evt={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",evt),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:evt.filter,callback:this.merge,scope:this},options))},createFilter:function(){var filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,filter]})),filter},merge:function(resp){if(this.layer.destroyFeatures(),resp.success()){var features=resp.features;if(features&&features.length>0){var remote=this.layer.projection,local=this.layer.map.getProjectionObject();if(!local.equals(remote))for(var geom,i=0,len=features.length;len>i;++i)geom=features[i].geometry,geom&&geom.transform(remote,local);this.layer.addFeatures(features)}}else this.bounds=null;this.response=null,this.layer.events.triggerEvent("loadend",{response:resp})},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(name,url,lzd,zoomLevels,params,options){this.lzd=lzd,this.zoomLevels=zoomLevels;var newArguments=[];newArguments.push(name,url,params,options),OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var zoom=this.map.getZoom();this.map.getMaxExtent();return zoom-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(bounds){bounds=this.adjustBounds(bounds);var zoom=this.getZoom(),extent=this.map.getMaxExtent(),deg=this.lzd/Math.pow(2,this.getZoom()),x=Math.floor((bounds.left-extent.left)/deg),y=Math.floor((bounds.bottom-extent.bottom)/deg);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:zoom,X:x,Y:y}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"}),OpenLayers.Protocol.CSW=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.CSW.DEFAULTS);var cls=OpenLayers.Protocol.CSW["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported CSW version: "+options.version;return new cls(options)},OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"},OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(capabilities,config){if(!("layer"in config))throw new Error("Missing property 'layer' in configuration.");for(var layerDef,contents=capabilities.contents,i=(contents.layers,0),ii=contents.layers.length;ii>i;++i)if(contents.layers[i].identifier===config.layer){layerDef=contents.layers[i];break}if(!layerDef)throw new Error("Layer not found");var format=config.format;!format&&layerDef.formats&&layerDef.formats.length&&(format=layerDef.formats[0]);var matrixSet;if(config.matrixSet?matrixSet=contents.tileMatrixSets[config.matrixSet]:layerDef.tileMatrixSetLinks.length>=1&&(matrixSet=contents.tileMatrixSets[layerDef.tileMatrixSetLinks[0].tileMatrixSet]),!matrixSet)throw new Error("matrixSet not found");for(var style,i=0,ii=layerDef.styles.length;ii>i&&(style=layerDef.styles[i],!style.isDefault);++i);var requestEncoding=config.requestEncoding;if(!requestEncoding&&(requestEncoding="KVP",capabilities.operationsMetadata.GetTile.dcp.http)){var http=capabilities.operationsMetadata.GetTile.dcp.http;if(http.get[0].constraints){var constraints=http.get[0].constraints,allowedValues=constraints.GetEncoding.allowedValues;allowedValues.KVP||!allowedValues.REST&&!allowedValues.RESTful||(requestEncoding="REST")}}var dimensions=[],params=config.params||{};delete config.params;for(var id=0,ld=layerDef.dimensions.length;ld>id;id++){var dimension=layerDef.dimensions[id];dimensions.push(dimension.identifier),params.hasOwnProperty(dimension.identifier)||(params[dimension.identifier]=dimension["default"])}var projection=config.projection||matrixSet.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),units=config.units||("EPSG:4326"===projection?"degrees":"m"),resolutions=[];for(var mid in matrixSet.matrixIds)matrixSet.matrixIds.hasOwnProperty(mid)&&resolutions.push(28e-5*matrixSet.matrixIds[mid].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[units]);var url;if("REST"===requestEncoding&&layerDef.resourceUrls){url=[];for(var resourceUrl,t=(layerDef.resourceUrls,0),tt=layerDef.resourceUrls.length;tt>t;++t)resourceUrl=layerDef.resourceUrls[t],resourceUrl.format===format&&"tile"===resourceUrl.resourceType&&url.push(resourceUrl.template)}else{var httpGet=capabilities.operationsMetadata.GetTile.dcp.http.get;url=[];for(var constraint,i=0,ii=httpGet.length;ii>i;i++)constraint=httpGet[i].constraints,(!constraint||constraint&&constraint.GetEncoding.allowedValues[requestEncoding])&&url.push(httpGet[i].url)}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(config,{url:url,requestEncoding:requestEncoding,name:layerDef.title,style:style.identifier,format:format,matrixIds:matrixSet.matrixIds,matrixSet:matrixSet.identifier,projection:projection,units:units,resolutions:config.isBaseLayer===!1?void 0:resolutions,serverResolutions:resolutions,tileFullExtent:matrixSet.bounds,dimensions:dimensions,params:params}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"}),OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var mapObject,cache=OpenLayers.Layer.Google.cache[this.map.id];if(cache)mapObject=cache.mapObject,++cache.count;else{var center=this.map.getCenter(),container=document.createElement("div");container.className="olForeignContainer",container.style.width="100%",container.style.height="100%",mapObject=new google.maps.Map(container,{center:center?new google.maps.LatLng(center.lat,center.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1});var googleControl=document.createElement("div");googleControl.style.width="100%",googleControl.style.height="100%",mapObject.controls[google.maps.ControlPosition.TOP_LEFT].push(googleControl),cache={googleControl:googleControl,mapObject:mapObject,count:1},OpenLayers.Layer.Google.cache[this.map.id]=cache}this.mapObject=mapObject,this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,"resize")},setGMapVisibility:function(visible){var cache=OpenLayers.Layer.Google.cache[this.map.id],map=this.map;if(cache){for(var layer,type=this.type,layers=map.layers,i=layers.length-1;i>=0;--i)if(layer=layers[i],layer instanceof OpenLayers.Layer.Google&&layer.visibility===!0&&layer.inRange===!0){type=layer.type,visible=!0;break}var container=this.mapObject.getDiv();if(visible===!0){if(container.parentNode!==map.div)if(cache.rendered)map.div.appendChild(container),cache.googleControl.appendChild(map.viewPortDiv),google.maps.event.trigger(this.mapObject,"resize");else{var me=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){cache.rendered=!0,me.setGMapVisibility(me.getVisibility()),me.moveTo(me.map.getCenter())})}this.mapObject.setMapTypeId(type)}else cache.googleControl.hasChildNodes()&&(map.div.appendChild(map.viewPortDiv),map.div.removeChild(container))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(olBounds){var moBounds=null;if(null!=olBounds){var sw=this.sphericalMercator?this.inverseMercator(olBounds.bottom,olBounds.left):new OpenLayers.LonLat(olBounds.bottom,olBounds.left),ne=this.sphericalMercator?this.inverseMercator(olBounds.top,olBounds.right):new OpenLayers.LonLat(olBounds.top,olBounds.right);moBounds=new google.maps.LatLngBounds(new google.maps.LatLng(sw.lat,sw.lon),new google.maps.LatLng(ne.lat,ne.lon))}return moBounds},getMapObjectLonLatFromMapObjectPixel:function(moPixel){var size=this.map.getSize(),lon=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),lat=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),res=this.map.getResolution(),delta_x=moPixel.x-size.w/2,delta_y=moPixel.y-size.h/2,lonlat=new OpenLayers.LonLat(lon+delta_x*res,lat-delta_y*res);return this.wrapDateLine&&(lonlat=lonlat.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(lonlat.lon,lonlat.lat)},getMapObjectPixelFromMapObjectLonLat:function(moLonLat){var lon=this.getLongitudeFromMapObjectLonLat(moLonLat),lat=this.getLatitudeFromMapObjectLonLat(moLonLat),res=this.map.getResolution(),extent=this.map.getExtent();return this.getMapObjectPixelFromXY(1/res*(lon-extent.left),1/res*(extent.top-lat))},setMapObjectCenter:function(center,zoom){if(this.animationEnabled===!1&&zoom!=this.mapObject.zoom){var mapContainer=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){mapContainer.style.visibility=""}),mapContainer.style.visibility="hidden"}this.mapObject.setOptions({center:center,zoom:zoom})},getMapObjectZoomFromMapObjectBounds:function(moBounds){return this.mapObject.getBoundsZoomLevel(moBounds)},getMapObjectLonLatFromLonLat:function(lon,lat){var gLatLng;if(this.sphericalMercator){var lonlat=this.inverseMercator(lon,lat);gLatLng=new google.maps.LatLng(lonlat.lat,lonlat.lon)}else gLatLng=new google.maps.LatLng(lat,lon);return gLatLng},getMapObjectPixelFromXY:function(x,y){return new google.maps.Point(x,y)}},OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var info={};return this.readNode(data,info),info},readers:{wps:{ProcessDescriptions:function(node,obj){obj.processDescriptions={},this.readChildNodes(node,obj.processDescriptions)},ProcessDescription:function(node,processDescriptions){var processVersion=this.getAttributeNS(node,this.namespaces.wps,"processVersion"),processDescription={processVersion:processVersion,statusSupported:"true"===node.getAttribute("statusSupported"),storeSupported:"true"===node.getAttribute("storeSupported")};this.readChildNodes(node,processDescription),processDescriptions[processDescription.identifier]=processDescription},DataInputs:function(node,processDescription){processDescription.dataInputs=[],this.readChildNodes(node,processDescription.dataInputs)},ProcessOutputs:function(node,processDescription){processDescription.processOutputs=[],this.readChildNodes(node,processDescription.processOutputs)},Output:function(node,processOutputs){var output={};this.readChildNodes(node,output),processOutputs.push(output)},ComplexOutput:function(node,output){output.complexOutput={},this.readChildNodes(node,output.complexOutput)},LiteralOutput:function(node,output){output.literalOutput={},this.readChildNodes(node,output.literalOutput)},Input:function(node,dataInputs){var input={maxOccurs:parseInt(node.getAttribute("maxOccurs")),minOccurs:parseInt(node.getAttribute("minOccurs"))};this.readChildNodes(node,input),dataInputs.push(input);
},BoundingBoxData:function(node,input){input.boundingBoxData={},this.readChildNodes(node,input.boundingBoxData)},CRS:function(node,obj){obj.CRSs||(obj.CRSs={}),obj.CRSs[this.getChildValue(node)]=!0},LiteralData:function(node,input){input.literalData={},this.readChildNodes(node,input.literalData)},ComplexData:function(node,input){input.complexData={},this.readChildNodes(node,input.complexData)},Default:function(node,complexData){complexData["default"]={},this.readChildNodes(node,complexData["default"])},Supported:function(node,complexData){complexData.supported={},this.readChildNodes(node,complexData.supported)},Format:function(node,obj){var format={};this.readChildNodes(node,format),obj.formats||(obj.formats={}),obj.formats[format.mimeType]=!0},MimeType:function(node,format){format.mimeType=this.getChildValue(node)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(options){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[options])},read:function(wkt){var features,type,str;wkt=wkt.replace(/[\n\r]/g," ");var matches=this.regExes.typeStr.exec(wkt);if(matches&&(type=matches[1].toLowerCase(),str=matches[2],this.parse[type]&&(features=this.parse[type].apply(this,[str])),this.internalProjection&&this.externalProjection))if(features&&"OpenLayers.Feature.Vector"==features.CLASS_NAME)features.geometry.transform(this.externalProjection,this.internalProjection);else if(features&&"geometrycollection"!=type&&"object"==typeof features)for(var i=0,len=features.length;len>i;i++){var component=features[i];component.geometry.transform(this.externalProjection,this.internalProjection)}return features},write:function(features){var collection,geometry,isCollection;features.constructor==Array?(collection=features,isCollection=!0):(collection=[features],isCollection=!1);var pieces=[];isCollection&&pieces.push("GEOMETRYCOLLECTION(");for(var i=0,len=collection.length;len>i;++i)isCollection&&i>0&&pieces.push(","),geometry=collection[i].geometry,pieces.push(this.extractGeometry(geometry));return isCollection&&pieces.push(")"),pieces.join("")},extractGeometry:function(geometry){var type=geometry.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[type])return null;this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var wktType="collection"==type?"GEOMETRYCOLLECTION":type.toUpperCase(),data=wktType+"("+this.extract[type].apply(this,[geometry])+")";return data},extract:{point:function(point){return point.x+" "+point.y},multipoint:function(multipoint){for(var array=[],i=0,len=multipoint.components.length;len>i;++i)array.push("("+this.extract.point.apply(this,[multipoint.components[i]])+")");return array.join(",")},linestring:function(linestring){for(var array=[],i=0,len=linestring.components.length;len>i;++i)array.push(this.extract.point.apply(this,[linestring.components[i]]));return array.join(",")},multilinestring:function(multilinestring){for(var array=[],i=0,len=multilinestring.components.length;len>i;++i)array.push("("+this.extract.linestring.apply(this,[multilinestring.components[i]])+")");return array.join(",")},polygon:function(polygon){for(var array=[],i=0,len=polygon.components.length;len>i;++i)array.push("("+this.extract.linestring.apply(this,[polygon.components[i]])+")");return array.join(",")},multipolygon:function(multipolygon){for(var array=[],i=0,len=multipolygon.components.length;len>i;++i)array.push("("+this.extract.polygon.apply(this,[multipolygon.components[i]])+")");return array.join(",")},collection:function(collection){for(var array=[],i=0,len=collection.components.length;len>i;++i)array.push(this.extractGeometry.apply(this,[collection.components[i]]));return array.join(",")}},parse:{point:function(str){var coords=OpenLayers.String.trim(str).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(coords[0],coords[1]))},multipoint:function(str){for(var point,points=OpenLayers.String.trim(str).split(","),components=[],i=0,len=points.length;len>i;++i)point=points[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.point.apply(this,[point]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(components))},linestring:function(str){for(var points=OpenLayers.String.trim(str).split(","),components=[],i=0,len=points.length;len>i;++i)components.push(this.parse.point.apply(this,[points[i]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(components))},multilinestring:function(str){for(var line,lines=OpenLayers.String.trim(str).split(this.regExes.parenComma),components=[],i=0,len=lines.length;len>i;++i)line=lines[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.linestring.apply(this,[line]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(components))},polygon:function(str){for(var ring,linestring,linearring,rings=OpenLayers.String.trim(str).split(this.regExes.parenComma),components=[],i=0,len=rings.length;len>i;++i)ring=rings[i].replace(this.regExes.trimParens,"$1"),linestring=this.parse.linestring.apply(this,[ring]).geometry,linearring=new OpenLayers.Geometry.LinearRing(linestring.components),components.push(linearring);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(components))},multipolygon:function(str){for(var polygon,polygons=OpenLayers.String.trim(str).split(this.regExes.doubleParenComma),components=[],i=0,len=polygons.length;len>i;++i)polygon=polygons[i].replace(this.regExes.trimParens,"$1"),components.push(this.parse.polygon.apply(this,[polygon]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(components))},geometrycollection:function(str){str=str.replace(/,\s*([A-Za-z])/g,"|$1");for(var wktArray=OpenLayers.String.trim(str).split("|"),components=[],i=0,len=wktArray.length;len>i;++i)components.push(OpenLayers.Format.WKT.prototype.read.apply(this,[wktArray[i]]));return components}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(options){OpenLayers.Util.extend(this,options),this.executeCallbacks=[],this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(options){if(options=options||{},this.description){if(options.callback){var description=this.description;window.setTimeout(function(){options.callback.call(options.scope,description)},0)}}else this.client.describeProcess(this.server,this.identifier,function(description){this.description||this.parseDescription(description),options.callback&&options.callback.call(options.scope,this.description)},this)},configure:function(options){return this.describe({callback:function(){var input,i,ii,description=this.description,inputs=options.inputs;for(i=0,ii=description.dataInputs.length;ii>i;++i)input=description.dataInputs[i],this.setInputData(input,inputs[input.identifier]);options.callback&&options.callback.call(options.scope)},scope:this}),this},execute:function(options){this.configure({inputs:options.inputs,callback:function(){var me=this,outputIndex=this.getOutputIndex(me.description.processOutputs,options.output);me.setResponseForm({outputIndex:outputIndex}),function callback(){return OpenLayers.Util.removeItem(me.executeCallbacks,callback),0!==me.chained?void me.executeCallbacks.push(callback):void OpenLayers.Request.POST({url:me.client.servers[me.server].url,data:(new OpenLayers.Format.WPSExecute).write(me.description),success:function(response){var output=me.description.processOutputs[outputIndex],mimeType=me.findMimeType(output.complexOutput.supported.formats),features=me.formats[mimeType].read(response.responseText);if(features instanceof OpenLayers.Feature.Vector&&(features=[features]),options.success){var outputs={};outputs[options.output||"result"]=features,options.success.call(options.scope,outputs)}},scope:me})}()},scope:this})},output:function(identifier){return new OpenLayers.WPSProcess.ChainLink({process:this,output:identifier})},parseDescription:function(description){var server=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(server.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(input,data){if(delete input.data,delete input.reference,data instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,input.reference={method:"POST",href:data.process.server===this.server?this.localWPS:this.client.servers[data.process.server].url},data.process.describe({callback:function(){--this.chained,this.chainProcess(input,data)},scope:this});else{input.data={};var complexData=input.complexData;if(complexData){var format=this.findMimeType(complexData.supported.formats);input.data.complexData={mimeType:format,value:this.formats[format].write(this.toFeatures(data))}}else input.data.literalData={value:data}}},setResponseForm:function(options){options=options||{};var output=this.description.processOutputs[options.outputIndex||0];this.description.responseForm={rawDataOutput:{identifier:output.identifier,mimeType:this.findMimeType(output.complexOutput.supported.formats,options.supportedFormats)}}},getOutputIndex:function(outputs,identifier){var output;if(identifier){for(var i=outputs.length-1;i>=0;--i)if(outputs[i].identifier===identifier){output=i;break}}else output=0;return output},chainProcess:function(input,chainLink){var output=this.getOutputIndex(chainLink.process.description.processOutputs,chainLink.output);input.reference.mimeType=this.findMimeType(input.complexData.supported.formats,chainLink.process.description.processOutputs[output].complexOutput.supported.formats);var formats={};for(formats[input.reference.mimeType]=!0,chainLink.process.setResponseForm({outputIndex:output,supportedFormats:formats}),input.reference.body=chainLink.process.description;this.executeCallbacks.length>0;)this.executeCallbacks[0]()},toFeatures:function(source){var isArray=OpenLayers.Util.isArray(source);isArray||(source=[source]);for(var current,target=new Array(source.length),i=0,ii=source.length;ii>i;++i)current=source[i],target[i]=current instanceof OpenLayers.Feature.Vector?current:new OpenLayers.Feature.Vector(current);return isArray?target:target[0]},findMimeType:function(sourceFormats,targetFormats){targetFormats=targetFormats||this.formats;for(var f in sourceFormats)if(f in targetFormats)return f},CLASS_NAME:"OpenLayers.WPSProcess"}),OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(options){OpenLayers.Util.extend(this,options)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"}),OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(options){OpenLayers.Util.extend(this,options),this.events=new OpenLayers.Events(this),this.servers={};for(var s in options.servers)this.servers[s]="string"==typeof options.servers[s]?{url:options.servers[s],version:this.version,processDescription:{}}:options.servers[s]},execute:function(options){var process=this.getProcess(options.server,options.process);process.execute({inputs:options.inputs,success:options.success,scope:options.scope})},getProcess:function(serverID,processID){var process=new OpenLayers.WPSProcess({client:this,server:serverID,identifier:processID});return this.lazy||process.describe(),process},describeProcess:function(serverID,processID,callback,scope){var server=this.servers[serverID];server.processDescription[processID]?window.setTimeout(function(){callback.call(scope,server.processDescription[processID])},0):processID in server.processDescription?this.events.register("describeprocess",this,function describe(evt){evt.identifier===processID&&(this.events.unregister("describeprocess",this,describe),callback.call(scope,evt.raw))}):(server.processDescription[processID]=null,OpenLayers.Request.GET({url:server.url,params:{SERVICE:"WPS",VERSION:server.version,REQUEST:"DescribeProcess",IDENTIFIER:processID},success:function(response){server.processDescription[processID]=response.responseText,this.events.triggerEvent("describeprocess",{identifier:processID,raw:response.responseText})},scope:this}))},destroy:function(){this.events.destroy(),this.events=null,this.servers=null},CLASS_NAME:"OpenLayers.WPSClient"}),OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var obj={};return this.readNode(data,obj),obj},readers:{csw:{GetRecordsResponse:function(node,obj){obj.records=[],this.readChildNodes(node,obj);var version=this.getAttributeNS(node,"","version");""!=version&&(obj.version=version)},RequestId:function(node,obj){obj.RequestId=this.getChildValue(node)},SearchStatus:function(node,obj){obj.SearchStatus={};var timestamp=this.getAttributeNS(node,"","timestamp");""!=timestamp&&(obj.SearchStatus.timestamp=timestamp)},SearchResults:function(node,obj){this.readChildNodes(node,obj);for(var attrs=node.attributes,SearchResults={},i=0,len=attrs.length;len>i;++i)"numberOfRecordsMatched"==attrs[i].name||"numberOfRecordsReturned"==attrs[i].name||"nextRecord"==attrs[i].name?SearchResults[attrs[i].name]=parseInt(attrs[i].nodeValue):SearchResults[attrs[i].name]=attrs[i].nodeValue;obj.SearchResults=SearchResults},SummaryRecord:function(node,obj){var record={type:"SummaryRecord"};this.readChildNodes(node,record),obj.records.push(record)},BriefRecord:function(node,obj){var record={type:"BriefRecord"};this.readChildNodes(node,record),obj.records.push(record)},DCMIRecord:function(node,obj){var record={type:"DCMIRecord"};this.readChildNodes(node,record),obj.records.push(record)},Record:function(node,obj){var record={type:"Record"};this.readChildNodes(node,record),obj.records.push(record)},"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();obj[name]=this.getChildValue(node)}},geonet:{info:function(node,obj){var gninfo={};this.readChildNodes(node,gninfo),obj.gninfo=gninfo}},dc:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();OpenLayers.Util.isArray(obj[name])||(obj[name]=[]);for(var dc_element={},attrs=node.attributes,i=0,len=attrs.length;len>i;++i)dc_element[attrs[i].name]=attrs[i].nodeValue;dc_element.value=this.getChildValue(node),""!=dc_element.value&&obj[name].push(dc_element)}},dct:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();OpenLayers.Util.isArray(obj[name])||(obj[name]=[]),obj[name].push(this.getChildValue(node))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(node,obj){obj.bounds&&(obj.BoundingBox=[{crs:obj.projection,value:[obj.bounds.left,obj.bounds.bottom,obj.bounds.right,obj.bounds.top]}],delete obj.projection,delete obj.bounds),OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(options){var node=this.writeNode("csw:GetRecords",options);return node.setAttribute("xmlns:gmd",this.namespaces.gmd),OpenLayers.Format.XML.prototype.write.apply(this,[node])},writers:{csw:{GetRecords:function(options){options||(options={});var node=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:options.requestId||this.requestId,resultType:options.resultType||this.resultType,outputFormat:options.outputFormat||this.outputFormat,outputSchema:options.outputSchema||this.outputSchema,startPosition:options.startPosition||this.startPosition,maxRecords:options.maxRecords||this.maxRecords}});(options.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",options.DistributedSearch||this.DistributedSearch,node);var ResponseHandler=options.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(ResponseHandler)&&ResponseHandler.length>0)for(var i=0,len=ResponseHandler.length;len>i;i++)this.writeNode("csw:ResponseHandler",ResponseHandler[i],node);return this.writeNode("Query",options.Query||this.Query,node),node},DistributedSearch:function(options){var node=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:options.hopCount}});return node},ResponseHandler:function(options){var node=this.createElementNSPlus("csw:ResponseHandler",{value:options.value});return node},Query:function(options){options||(options={});var node=this.createElementNSPlus("csw:Query",{attributes:{typeNames:options.typeNames||"csw:Record"}}),ElementName=options.ElementName;if(OpenLayers.Util.isArray(ElementName)&&ElementName.length>0)for(var i=0,len=ElementName.length;len>i;i++)this.writeNode("csw:ElementName",ElementName[i],node);else this.writeNode("csw:ElementSetName",options.ElementSetName||{value:"summary"},node);return options.Constraint&&this.writeNode("csw:Constraint",options.Constraint,node),options.SortBy&&this.writeNode("ogc:SortBy",options.SortBy,node),node},ElementName:function(options){var node=this.createElementNSPlus("csw:ElementName",{value:options.value});return node},ElementSetName:function(options){var node=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:options.typeNames},value:options.value});return node},Constraint:function(options){var node=this.createElementNSPlus("csw:Constraint",{attributes:{version:options.version}});if(options.Filter){var format=new OpenLayers.Format.Filter({version:options.version});node.appendChild(format.write(options.Filter))}else if(options.CqlText){var child=this.createElementNSPlus("CqlText",{value:options.CqlText.value});node.appendChild(child)}return node}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"}),/**
 * @license Apache 2 
 *  
 * Contains portions of Rico <http://openrico.org/>
 * 
 * Copyright 2005 Sabre Airline Solutions  
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you
 * may not use this file except in compliance with the License. You
 * may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0  
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 * implied. See the License for the specific language governing
 * permissions and limitations under the License. 
 */
OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(bounds,borderColor,borderWidth){this.bounds=bounds,this.div=OpenLayers.Util.createDiv(),this.div.style.overflow="hidden",this.events=new OpenLayers.Events(this,this.div),this.setBorder(borderColor,borderWidth)},destroy:function(){this.bounds=null,this.div=null,OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(color,width){color||(color="red"),width||(width=2),this.div.style.border=width+"px solid "+color},draw:function(px,sz){return OpenLayers.Util.modifyDOMElement(this.div,null,px,sz),this.div},onScreen:function(){var onScreen=!1;if(this.map){var screenBounds=this.map.getExtent();onScreen=screenBounds.containsBounds(this.bounds,!0,!0)}return onScreen},display:function(display){this.div.style.display=display?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"}),OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(options){options=options||{},options.extractStyles!==!1&&(options.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}),OpenLayers.Format.prototype.initialize.apply(this,[options])},read:function(text){for(var columns,lines=text.split("\n"),features=[],lcv=0;lcv<lines.length-1;lcv++){var currLine=lines[lcv].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=currLine.charAt(0))if(columns){for(var vals=currLine.split("	"),geometry=new OpenLayers.Geometry.Point(0,0),attributes={},style=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,set=!1,valIndex=0;valIndex<vals.length;valIndex++)if(vals[valIndex])if("point"==columns[valIndex]){var coords=vals[valIndex].split(",");geometry.y=parseFloat(coords[0]),geometry.x=parseFloat(coords[1]),set=!0}else if("lat"==columns[valIndex])geometry.y=parseFloat(vals[valIndex]),set=!0;else if("lon"==columns[valIndex])geometry.x=parseFloat(vals[valIndex]),set=!0;else if("title"==columns[valIndex])attributes.title=vals[valIndex];else if("image"==columns[valIndex]||"icon"==columns[valIndex]&&style)style.externalGraphic=vals[valIndex];else if("iconSize"==columns[valIndex]&&style){var size=vals[valIndex].split(",");style.graphicWidth=parseFloat(size[0]),style.graphicHeight=parseFloat(size[1])}else if("iconOffset"==columns[valIndex]&&style){var offset=vals[valIndex].split(",");style.graphicXOffset=parseFloat(offset[0]),style.graphicYOffset=parseFloat(offset[1])}else"description"==columns[valIndex]?attributes.description=vals[valIndex]:"overflow"==columns[valIndex]?attributes.overflow=vals[valIndex]:attributes[columns[valIndex]]=vals[valIndex];if(set){this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection);var feature=new OpenLayers.Feature.Vector(geometry,attributes,style);features.push(feature)}}else columns=currLine.split("	")}return features},CLASS_NAME:"OpenLayers.Format.Text"}),OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(name,options){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments),this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadText:function(){if(!this.loaded&&null!=this.location){var onFail=function(e){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:onFail,scope:this}),this.loaded=!0}},moveTo:function(bounds,zoomChanged,minor){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadText()},parseData:function(ajaxRequest){var text=ajaxRequest.responseText,options={};OpenLayers.Util.extend(options,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(options.externalProjection=this.projection,options.internalProjection=this.map.getProjectionObject());for(var parser=new OpenLayers.Format.Text(options),features=parser.read(text),i=0,len=features.length;len>i;i++){var location,iconSize,iconOffset,data={},feature=features[i];location=new OpenLayers.LonLat(feature.geometry.x,feature.geometry.y),feature.style.graphicWidth&&feature.style.graphicHeight&&(iconSize=new OpenLayers.Size(feature.style.graphicWidth,feature.style.graphicHeight)),void 0!==feature.style.graphicXOffset&&void 0!==feature.style.graphicYOffset&&(iconOffset=new OpenLayers.Pixel(feature.style.graphicXOffset,feature.style.graphicYOffset)),null!=feature.style.externalGraphic?data.icon=new OpenLayers.Icon(feature.style.externalGraphic,iconSize,iconOffset):(data.icon=OpenLayers.Marker.defaultIcon(),null!=iconSize&&data.icon.setSize(iconSize)),null!=feature.attributes.title&&null!=feature.attributes.description&&(data.popupContentHTML="<h2>"+feature.attributes.title+"</h2><p>"+feature.attributes.description+"</p>"),data.overflow=feature.attributes.overflow||"auto";var markerFeature=new OpenLayers.Feature(this,location,data);this.features.push(markerFeature);var marker=markerFeature.createMarker();null!=feature.attributes.title&&null!=feature.attributes.description&&marker.events.register("click",markerFeature,this.markerClick),this.addMarker(marker)}this.events.triggerEvent("loadend")},markerClick:function(evt){var sameMarkerClicked=this==this.layer.selectedFeature;this.layer.selectedFeature=sameMarkerClicked?null:this;for(var i=0,len=this.layer.map.popups.length;len>i;i++)this.layer.map.removePopup(this.layer.map.popups[i]);sameMarkerClicked||this.layer.map.addPopup(this.createPopup()),OpenLayers.Event.stop(evt)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var feature=this.features[0];OpenLayers.Util.removeItem(this.features,feature),feature.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(control,callbacks,options){options&&options.layerOptions&&options.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[control,callbacks,options]),this.options=options?options:{}},setOptions:function(newOptions){OpenLayers.Util.extend(this.options,newOptions),OpenLayers.Util.extend(this,newOptions)},activate:function(){var activated=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var options=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options),this.map.addLayer(this.layer),activated=!0}return activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,deactivated=!0),deactivated},down:function(evt){this.fixedRadius=!!this.radius;var maploc=this.layer.getLonLatFromViewPortPx(evt.xy);this.origin=new OpenLayers.Geometry.Point(maploc.lon,maploc.lat),(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(evt){var maploc=this.layer.getLonLatFromViewPortPx(evt.xy),point=new OpenLayers.Geometry.Point(maploc.lon,maploc.lat);if(this.irregular){var ry=Math.sqrt(2)*Math.abs(point.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,ry)}else this.fixedRadius?this.origin=point:(this.calculateAngle(point,evt),this.radius=Math.max(this.map.getResolution()/2,point.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var ratio,dx=point.x-this.origin.x,dy=point.y-this.origin.y;ratio=0==dy?dx/(this.radius*Math.sqrt(2)):dx/dy,this.feature.geometry.resize(1,this.origin,ratio),this.feature.geometry.move(dx/2,dy/2)}this.layer.drawFeature(this.feature,this.style)},up:function(evt){this.finalize(),this.start==this.last&&this.callback("done",[evt.xy])},out:function(evt){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var angle,point,ring=this.feature.geometry.components[0];ring.components.length!=this.sides+1&&(this.createGeometry(),ring=this.feature.geometry.components[0]);for(var i=0;i<this.sides;++i)point=ring.components[i],angle=this.angle+2*i*Math.PI/this.sides,point.x=this.origin.x+this.radius*Math.cos(angle),point.y=this.origin.y+this.radius*Math.sin(angle),point.clearBounds()},calculateAngle:function(point,evt){var alpha=Math.atan2(point.y-this.origin.y,point.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!evt[this.snapToggle]){var snapAngleRad=Math.PI/180*this.snapAngle;this.angle=Math.round(alpha/snapAngleRad)*snapAngleRad}else this.angle=alpha},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(name,args){this.callbacks[name]&&this.callbacks[name].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=name&&"cancel"!=name||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks),this.handlerOptions=this.handlerOptions||{},this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}}),this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})})),this.handler=new handler(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var key in this.layerCache)delete this.layerCache[key];for(var key in this.wfsCache)delete this.wfsCache[key];OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(evt){this.setVisibility(evt.object.getVisibility())},createSelectionLayer:function(source){var selectionLayer;return this.layerCache[source.id]?selectionLayer=this.layerCache[source.id]:(selectionLayer=new OpenLayers.Layer.WMS(source.name,source.url,source.params,OpenLayers.Util.applyDefaults(this.layerOptions,source.getOptions())),this.layerCache[source.id]=selectionLayer,this.layerOptions.displayInLayerSwitcher===!1&&source.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:selectionLayer}),this.map.addLayer(selectionLayer)),selectionLayer},createSLD:function(layer,filters,geometryAttributes){for(var sld={version:"1.0.0",namedLayers:{}},layerNames=[layer.params.LAYERS].join(",").split(","),i=0,len=layerNames.length;len>i;i++){var name=layerNames[i];sld.namedLayers[name]={name:name,userStyles:[]};var symbolizer=this.selectionSymbolizer,geometryAttribute=geometryAttributes[i];geometryAttribute.type.indexOf("Polygon")>=0?symbolizer={Polygon:this.selectionSymbolizer.Polygon}:geometryAttribute.type.indexOf("LineString")>=0?symbolizer={Line:this.selectionSymbolizer.Line}:geometryAttribute.type.indexOf("Point")>=0&&(symbolizer={Point:this.selectionSymbolizer.Point});var filter=filters[i];sld.namedLayers[name].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:symbolizer,filter:filter,maxScaleDenominator:layer.options.minScale})]})}return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(sld)},parseDescribeLayer:function(request){var format=new OpenLayers.Format.WMSDescribeLayer,doc=request.responseXML;doc&&doc.documentElement||(doc=request.responseText);for(var describeLayer=format.read(doc),typeNames=[],url=null,i=0,len=describeLayer.length;len>i;i++)"WFS"==describeLayer[i].owsType&&(typeNames.push(describeLayer[i].typeName),url=describeLayer[i].owsURL);var options={url:url,params:{SERVICE:"WFS",TYPENAME:typeNames.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(request){var format=new OpenLayers.Format.WFSDescribeFeatureType,doc=request.responseXML;doc&&doc.documentElement||(doc=request.responseText);var describeFeatureType=format.read(doc);this.control.wfsCache[this.layer.id]=describeFeatureType,this.control._queue&&this.control.applySelection()},scope:this};OpenLayers.Request.GET(options)},getGeometryAttributes:function(layer){for(var result=[],cache=this.wfsCache[layer.id],i=0,len=cache.featureTypes.length;len>i;i++)for(var typeName=cache.featureTypes[i],properties=typeName.properties,j=0,lenj=properties.length;lenj>j;j++){var property=properties[j],type=property.type;(type.indexOf("LineString")>=0||type.indexOf("GeometryAssociationType")>=0||type.indexOf("GeometryPropertyType")>=0||type.indexOf("Point")>=0||type.indexOf("Polygon")>=0)&&result.push(property)}return result},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this);if(activated)for(var i=0,len=this.layers.length;len>i;i++){var layer=this.layers[i];if(layer&&!this.wfsCache[layer.id]){var options={url:layer.url,params:{SERVICE:"WMS",VERSION:layer.params.VERSION,LAYERS:layer.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:layer,control:this}};OpenLayers.Request.GET(options)}}return activated},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this);if(deactivated)for(var i=0,len=this.layers.length;len>i;i++){var layer=this.layers[i];if(layer&&this.clearOnDeactivate===!0){var layerCache=this.layerCache,selectionLayer=layerCache[layer.id];selectionLayer&&(layer.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:selectionLayer}),selectionLayer.destroy(),delete layerCache[layer.id])}}return deactivated},setLayers:function(layers){this.active?(this.deactivate(),this.layers=layers,this.activate()):this.layers=layers},createFilter:function(geometryAttribute,geometry){var filter=null;return this.handler instanceof OpenLayers.Handler.RegularPolygon?filter=this.handler.irregular===!0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:geometryAttribute.name,value:geometry.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry}):this.handler instanceof OpenLayers.Handler.Polygon?filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry}):this.handler instanceof OpenLayers.Handler.Path?filter=geometryAttribute.type.indexOf("Point")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:geometryAttribute.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:geometry}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry}):this.handler instanceof OpenLayers.Handler.Click&&(filter=geometryAttribute.type.indexOf("Polygon")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:geometryAttribute.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:geometry})),filter},select:function(geometry){this._queue=function(){for(var i=0,len=this.layers.length;len>i;i++){for(var layer=this.layers[i],geometryAttributes=this.getGeometryAttributes(layer),filters=[],j=0,lenj=geometryAttributes.length;lenj>j;j++){var geometryAttribute=geometryAttributes[j];if(null!==geometryAttribute){if(!(geometry instanceof OpenLayers.Geometry)){var point=this.map.getLonLatFromPixel(geometry.xy);geometry=new OpenLayers.Geometry.Point(point.lon,point.lat)}var filter=this.createFilter(geometryAttribute,geometry);null!==filter&&filters.push(filter)}}var selectionLayer=this.createSelectionLayer(layer);this.events.triggerEvent("selected",{layer:layer,filters:filters});var sld=this.createSLD(layer,filters,geometryAttributes);selectionLayer.mergeNewParams({SLD_BODY:sld}),delete this._queue}},this.applySelection()},applySelection:function(){for(var canApply=!0,i=0,len=this.layers.length;len>i;i++)if(!this.wfsCache[this.layers[i].id]){canApply=!1;break}canApply&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(element,options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.element=OpenLayers.Util.getElement(element)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div},updateScale:function(){var scale;if(this.geodesic===!0){var units=this.map.getUnits();if(!units)return;var inches=OpenLayers.INCHES_PER_UNIT;scale=(this.map.getGeodesicPixelSize().w||1e-6)*inches.km*OpenLayers.DOTS_PER_INCH}else scale=this.map.getScale();scale&&(scale=scale>=9500&&95e4>=scale?Math.round(scale/1e3)+"K":scale>=95e4?Math.round(scale/1e6)+"M":Math.round(scale),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:scale}))},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(name,url,params,options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),(null==options||null==options.isBaseLayer)&&(this.isBaseLayer="true"!=this.transparent&&1!=this.transparent),options&&null!=options.useOverlay&&(this.useOverlay=options.useOverlay),this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){var url,center=bounds.getCenterLonLat(),mapSize=this.map.getSize();if(this.singleTile){var params={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:mapSize.h*this.ratio,setdisplaywidth:mapSize.w*this.ratio,setviewcenterx:center.lon,setviewcentery:center.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var getVisParams={};getVisParams=OpenLayers.Util.extend(getVisParams,params),getVisParams.operation="GETVISIBLEMAPEXTENT",getVisParams.version="1.0.0",getVisParams.session=this.params.session,getVisParams.mapName=this.params.mapName,getVisParams.format="text/xml",url=this.getFullRequestString(getVisParams),OpenLayers.Request.GET({url:url,async:!1})}url=this.getFullRequestString(params)}else{var currentRes=this.map.getResolution(),colidx=Math.floor((bounds.left-this.maxExtent.left)/currentRes);colidx=Math.round(colidx/this.tileSize.w);var rowidx=Math.floor((this.maxExtent.top-bounds.top)/currentRes);rowidx=Math.round(rowidx/this.tileSize.h),url=this.useHttpTile?this.getImageFilePath({tilecol:colidx,tilerow:rowidx,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:colidx,tilerow:rowidx,scaleindex:this.resolutions.length-this.map.zoom-1})}return url},getFullRequestString:function(newParams,altUrl){var url=null==altUrl?this.url:altUrl;"object"==typeof url&&(url=url[Math.floor(Math.random()*url.length)]);var requestString=url,allParams=OpenLayers.Util.extend({},this.params);allParams=OpenLayers.Util.extend(allParams,newParams);var urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));for(var key in allParams)key.toUpperCase()in urlParams&&delete allParams[key];var paramsString=OpenLayers.Util.getParameterString(allParams);if(paramsString=paramsString.replace(/,/g,"+"),""!=paramsString){var lastServerChar=url.charAt(url.length-1);requestString+="&"==lastServerChar||"?"==lastServerChar?paramsString:-1==url.indexOf("?")?"?"+paramsString:"&"+paramsString}return requestString},getImageFilePath:function(newParams,altUrl){var url=null==altUrl?this.url:altUrl;"object"==typeof url&&(url=url[Math.floor(Math.random()*url.length)]);var requestString=url,tileRowGroup="",tileColGroup="";newParams.tilerow<0&&(tileRowGroup="-"),tileRowGroup+=0==newParams.tilerow?"0":Math.floor(Math.abs(newParams.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder,newParams.tilecol<0&&(tileColGroup="-"),tileColGroup+=0==newParams.tilecol?"0":Math.floor(Math.abs(newParams.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;var tilePath="/S"+Math.floor(newParams.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+tileRowGroup+"/C"+tileColGroup+"/"+newParams.tilerow%this.params.tileRowsPerFolder+"_"+newParams.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;return this.params.querystring&&(tilePath+="?"+this.params.querystring),requestString+=tilePath},CLASS_NAME:"OpenLayers.Layer.MapGuide"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);var callbacks={done:this.measureComplete,point:this.measurePartial};this.immediate&&(callbacks.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new handler(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(immediate){this.immediate=immediate,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(handler,options){var active=this.active;active&&this.deactivate(),this.handler=new handler(this,this.callbacks,options),active&&this.activate()},measureComplete:function(geometry){this.cancelDelay(),this.measure(geometry,"measure")},measurePartial:function(point,geometry){this.cancelDelay(),geometry=geometry.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(geometry,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(geometry,"measurepartial")},this),this.partialDelay)},measureImmediate:function(point,feature,drawing){drawing&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(feature.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(geometry,eventType){var stat,order;geometry.CLASS_NAME.indexOf("LineString")>-1?(stat=this.getBestLength(geometry),order=1):(stat=this.getBestArea(geometry),order=2),this.events.triggerEvent(eventType,{measure:stat[0],units:stat[1],order:order,geometry:geometry})},getBestArea:function(geometry){for(var unit,area,units=this.displaySystemUnits[this.displaySystem],i=0,len=units.length;len>i&&(unit=units[i],area=this.getArea(geometry,unit),!(area>1));++i);return[area,unit]},getArea:function(geometry,units){var area,geomUnits;this.geodesic?(area=geometry.getGeodesicArea(this.map.getProjectionObject()),geomUnits="m"):(area=geometry.getArea(),geomUnits=this.map.getUnits());var inPerDisplayUnit=OpenLayers.INCHES_PER_UNIT[units];if(inPerDisplayUnit){var inPerMapUnit=OpenLayers.INCHES_PER_UNIT[geomUnits];area*=Math.pow(inPerMapUnit/inPerDisplayUnit,2)}return area},getBestLength:function(geometry){for(var unit,length,units=this.displaySystemUnits[this.displaySystem],i=0,len=units.length;len>i&&(unit=units[i],length=this.getLength(geometry,unit),!(length>1));++i);return[length,unit]},getLength:function(geometry,units){var length,geomUnits;this.geodesic?(length=geometry.getGeodesicLength(this.map.getProjectionObject()),geomUnits="m"):(length=geometry.getLength(),geomUnits=this.map.getUnits());var inPerDisplayUnit=OpenLayers.INCHES_PER_UNIT[units];if(inPerDisplayUnit){var inPerMapUnit=OpenLayers.INCHES_PER_UNIT[geomUnits];length*=inPerMapUnit/inPerDisplayUnit}return length},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(options){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[options])},read_wmc_SRS:function(layerContext,node){var srs=this.getChildValue(node);"object"!=typeof layerContext.projections&&(layerContext.projections={});for(var values=srs.split(/ +/),i=0,len=values.length;len>i;i++)layerContext.projections[values[i]]=!0},write_wmc_Layer:function(context){var node=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[context]);if(context.srs){var projections=[];for(var name in context.srs)projections.push(name);node.appendChild(this.createElementDefaultNS("SRS",projections.join(" ")))}node.appendChild(this.write_wmc_FormatList(context)),node.appendChild(this.write_wmc_StyleList(context)),context.dimensions&&node.appendChild(this.write_wmc_DimensionList(context)),node.appendChild(this.write_wmc_LayerExtension(context))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"}),OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){var newArguments=[id,lonlat,contentSize,contentHTML,closeBox,closeBoxCallback];OpenLayers.Popup.prototype.initialize.apply(this,newArguments),this.anchor=null!=anchor?anchor:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null,this.relativePosition=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(px){var oldRelativePosition=this.relativePosition;this.relativePosition=this.calculateRelativePosition(px),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(px)),this.relativePosition!=oldRelativePosition&&this.updateRelativePosition()},setSize:function(contentSize){if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var px=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(px)}},calculateRelativePosition:function(px){var lonlat=this.map.getLonLatFromLayerPx(px),extent=this.map.getExtent(),quadrant=extent.determineQuadrant(lonlat);return OpenLayers.Bounds.oppositeQuadrant(quadrant)},updateRelativePosition:function(){},calculateNewPx:function(px){var newPx=px.offset(this.anchor.offset),size=this.size||this.contentSize,top="t"==this.relativePosition.charAt(0);newPx.y+=top?-size.h:this.anchor.size.h;var left="l"==this.relativePosition.charAt(1);return newPx.x+=left?-size.w:this.anchor.size.w,newPx},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(px){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,closeBox&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var i=0;i<this.blocks.length;i++){var block=this.blocks[i];block.image&&block.div.removeChild(block.image),block.image=null,block.div&&this.groupDiv.removeChild(block.div),block.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(color){},setBorder:function(){},setOpacity:function(opacity){},setSize:function(contentSize){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var contentDivPadding=this.getContentDivPadding();this.closeDiv.style.right=contentDivPadding.right+this.padding.right+"px",this.closeDiv.style.top=contentDivPadding.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(px){var newPx=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return newPx=newPx.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var firstPosition=null;for(var key in this.positionBlocks){firstPosition=key;break}for(var position=this.positionBlocks[firstPosition],i=0;i<position.blocks.length;i++){var block={};this.blocks.push(block);var divId=this.id+"_FrameDecorationDiv_"+i;block.div=OpenLayers.Util.createDiv(divId,null,null,null,"absolute",null,"hidden",null);var imgId=this.id+"_FrameDecorationImg_"+i,imageCreator=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;block.image=imageCreator(imgId,null,this.imageSize,this.imageSrc,"absolute",null,null,null),block.div.appendChild(block.image),this.groupDiv.appendChild(block.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var position=this.positionBlocks[this.relativePosition],i=0;i<position.blocks.length;i++){var positionBlock=position.blocks[i],block=this.blocks[i],l=positionBlock.anchor.left,b=positionBlock.anchor.bottom,r=positionBlock.anchor.right,t=positionBlock.anchor.top,w=isNaN(positionBlock.size.w)?this.size.w-(r+l):positionBlock.size.w,h=isNaN(positionBlock.size.h)?this.size.h-(b+t):positionBlock.size.h;
block.div.style.width=(0>w?0:w)+"px",block.div.style.height=(0>h?0:h)+"px",block.div.style.left=null!=l?l+"px":"",block.div.style.bottom=null!=b?b+"px":"",block.div.style.right=null!=r?r+"px":"",block.div.style.top=null!=t?t+"px":"",block.image.style.left=positionBlock.position.x+"px",block.image.style.top=positionBlock.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png"),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){var draw=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);if(draw){var url=this.layer.getURL(this.bounds),usedIFrame=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&url.length>this.maxGetUrlLength;var fromIFrame=usedIFrame&&!this.useIFrame,toIFrame=!usedIFrame&&this.useIFrame;(fromIFrame||toIFrame)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,fromIFrame&&this.frame.removeChild(this.frame.firstChild))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===!0){if(!this.frame.childNodes.length){var eventPane=document.createElement("div"),style=eventPane.style;style.position="absolute",style.width="100%",style.height="100%",style.zIndex=1,style.backgroundImage="url("+this.blankImageUrl+")",this.frame.appendChild(eventPane)}var iframe,id=this.id+"_iFrame";return parseFloat(navigator.appVersion.split("MSIE")[1])<9?(iframe=document.createElement('<iframe name="'+id+'">'),iframe.style.backgroundColor="#FFFFFF",iframe.style.filter="chroma(color=#FFFFFF)"):(iframe=document.createElement("iframe"),iframe.style.backgroundColor="transparent",iframe.name=id),iframe.scrolling="no",iframe.marginWidth="0px",iframe.marginHeight="0px",iframe.frameBorder="0",iframe.style.position="absolute",iframe.style.width="100%",iframe.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(iframe,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(iframe),this.imgDiv=iframe,iframe}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var form=document.createElement("form");form.method="POST";var cacheId=this.layer.params._OLSALT;cacheId=(cacheId?cacheId+"_":"")+this.bounds.toBBOX(),form.action=OpenLayers.Util.urlAppend(this.layer.url,cacheId),form.target=this.id+"_iFrame";var field,params=(this.layer.getImageSize(),OpenLayers.Util.getParameters(this.url));for(var par in params)field=document.createElement("input"),field.type="hidden",field.name=par,field.value=params[par],form.appendChild(field);return form},setImgSrc:function(url){if(this.useIFrame===!0)if(url){var form=this.createRequestForm();this.frame.appendChild(form),form.submit(),this.frame.removeChild(form)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var backBuffer;return this.useIFrame===!1&&(backBuffer=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),backBuffer}},OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"}),OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]),this.options=options},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var capabilities={};return this.readNode(data,capabilities),capabilities},readers:{gml:OpenLayers.Util.applyDefaults({name:function(node,obj){obj.name=this.getChildValue(node)},TimePeriod:function(node,obj){obj.timePeriod={},this.readChildNodes(node,obj.timePeriod)},beginPosition:function(node,timePeriod){timePeriod.beginPosition=this.getChildValue(node)},endPosition:function(node,timePeriod){timePeriod.endPosition=this.getChildValue(node)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(node,obj){this.readChildNodes(node,obj)},Contents:function(node,obj){obj.contents={},this.readChildNodes(node,obj.contents)},ObservationOfferingList:function(node,contents){contents.offeringList={},this.readChildNodes(node,contents.offeringList)},ObservationOffering:function(node,offeringList){var id=this.getAttributeNS(node,this.namespaces.gml,"id");offeringList[id]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]},this.readChildNodes(node,offeringList[id])},time:function(node,offering){offering.time={},this.readChildNodes(node,offering.time)},procedure:function(node,offering){offering.procedures.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))},observedProperty:function(node,offering){offering.observedProperties.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))},featureOfInterest:function(node,offering){offering.featureOfInterestIds.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))},responseFormat:function(node,offering){offering.responseFormats.push(this.getChildValue(node))},resultModel:function(node,offering){offering.resultModels.push(this.getChildValue(node))},responseMode:function(node,offering){offering.responseModes.push(this.getChildValue(node))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(evt){var propagate=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(evt))this.started=!0,this.last=this.start={distance:this.getDistance(evt.touches),delta:0,scale:1},this.callback("start",[evt,this.start]),propagate=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.start=null,this.last=null}return OpenLayers.Event.preventDefault(evt),propagate},touchmove:function(evt){if(this.started&&OpenLayers.Event.isMultiTouch(evt)){this.pinching=!0;var current=this.getPinchData(evt);this.callback("move",[evt,current]),this.last=current,OpenLayers.Event.stop(evt)}else if(this.started)return!1;return!0},touchend:function(evt){return this.started&&!OpenLayers.Event.isMultiTouch(evt)?(this.started=!1,this.pinching=!1,this.callback("done",[evt,this.start,this.last]),this.start=null,this.last=null,!1):!0},activate:function(){var activated=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,activated=!0),activated},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,deactivated=!0),deactivated},getDistance:function(touches){var t0=touches[0],t1=touches[1];return Math.sqrt(Math.pow(t0.olClientX-t1.olClientX,2)+Math.pow(t0.olClientY-t1.olClientY,2))},getPinchData:function(evt){var distance=this.getDistance(evt.touches),scale=distance/this.start.distance;return{distance:distance,delta:this.last.distance-distance,scale:scale}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var div=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),div},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);return activated&&(this.layer.visibility===!0&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this})),activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&(this.stop(),this.layer.events.un({visibilitychanged:this.reset,scope:this})),deactivated},reset:function(){this.layer.visibility===!0?this.start():this.stop()},start:function(){this.interval&&"number"==typeof this.interval&&this.interval>0&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&"function"==typeof this.layer.refresh&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"}),OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(name,url,params,options){var newArguments=[];params=OpenLayers.Util.upperCaseObject(params),newArguments.push(name,url,params,options),OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=options&&options.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){bounds=this.adjustBounds(bounds);var projWords=this.projection.getCode().split(":"),srid=projWords[projWords.length-1],imageSize=this.getImageSize(),newParams={BBOX:bounds.toBBOX(),SIZE:imageSize.w+","+imageSize.h,F:"image",BBOXSR:srid,IMAGESR:srid};if(this.layerDefs){var layerID,layerDefStrList=[];for(layerID in this.layerDefs)this.layerDefs.hasOwnProperty(layerID)&&this.layerDefs[layerID]&&(layerDefStrList.push(layerID),layerDefStrList.push(":"),layerDefStrList.push(this.layerDefs[layerID]),layerDefStrList.push(";"));layerDefStrList.length>0&&(newParams.LAYERDEFS=layerDefStrList.join(""))}var requestString=this.getFullRequestString(newParams);return requestString},setLayerFilter:function(id,queryDef){this.layerDefs||(this.layerDefs={}),queryDef?this.layerDefs[id]=queryDef:delete this.layerDefs[id]},clearLayerFilter:function(id){id?delete this.layerDefs[id]:delete this.layerDefs},mergeNewParams:function(newParams){var upperParams=OpenLayers.Util.upperCaseObject(newParams),newArguments=[upperParams];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,newArguments)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(evt){return this.passesTolerance(evt.xy)&&(this.clearTimer(),this.callback("move",[evt]),this.px=evt.xy,evt=OpenLayers.Util.extend({},evt),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,evt),this.delay)),!this.stopMove},mouseout:function(evt){return OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[evt])),!0},passesTolerance:function(px){var passes=!0;if(this.pixelTolerance&&this.px){var dpx=Math.sqrt(Math.pow(this.px.x-px.x,2)+Math.pow(this.px.y-px.y,2));dpx<this.pixelTolerance&&(passes=!1)}return passes},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(evt){this.callback("pause",[evt])},deactivate:function(){var deactivated=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),deactivated=!0),deactivated},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(options){options.handlerOptions=options.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[options]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var i in this.handlers)this.handlers[i].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var i in this.handlers)this.handlers[i].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(evt){var bounds=this.pixelToBounds(evt.xy);this.setModifiers(evt),this.request(bounds,{single:this.single})},selectBox:function(position){var bounds;if(position instanceof OpenLayers.Bounds){var minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom}),maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top});bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat)}else{if(this.click)return;bounds=this.pixelToBounds(position)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(bounds)},selectHover:function(evt){var bounds=this.pixelToBounds(evt.xy);this.request(bounds,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(bounds,options){options=options||{};var filter=new OpenLayers.Filter.Spatial({type:this.filterType,value:bounds});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var response=this.protocol.read({maxFeatures:1==options.single?this.maxFeatures:void 0,filter:filter,callback:function(result){result.success()&&(result.features.length?1==options.single?this.selectBestFeature(result.features,bounds.getCenterLonLat(),options):this.select(result.features):options.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});1==options.hover&&(this.hoverResponse=response)},selectBestFeature:function(features,clickPosition,options){if(options=options||{},features.length){for(var feature,resultFeature,dist,point=new OpenLayers.Geometry.Point(clickPosition.lon,clickPosition.lat),minDist=Number.MAX_VALUE,i=0;i<features.length&&(feature=features[i],!(feature.geometry&&(dist=point.distanceTo(feature.geometry,{edge:!1}),minDist>dist&&(minDist=dist,resultFeature=feature,0==minDist))));++i);1==options.hover?this.hoverSelect(resultFeature):this.select(resultFeature||features)}},setModifiers:function(evt){this.modifiers={multiple:this.multiple||this.multipleKey&&evt[this.multipleKey],toggle:this.toggle||this.toggleKey&&evt[this.toggleKey]}},select:function(features){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(features)||(features=[features]);var cont=this.events.triggerEvent("beforefeaturesselected",{features:features});if(cont!==!1){for(var feature,selectedFeatures=[],i=0,len=features.length;len>i;++i)feature=features[i],this.features[feature.fid||feature.id]?this.modifiers.toggle&&this.unselect(this.features[feature.fid||feature.id]):(cont=this.events.triggerEvent("beforefeatureselected",{feature:feature}),cont!==!1&&(this.features[feature.fid||feature.id]=feature,selectedFeatures.push(feature),this.events.triggerEvent("featureselected",{feature:feature})));this.events.triggerEvent("featuresselected",{features:selectedFeatures})}},hoverSelect:function(feature){var fid=feature?feature.fid||feature.id:null,hfid=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;hfid&&hfid!=fid&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),fid&&fid!=hfid&&(this.events.triggerEvent("hoverfeature",{feature:feature}),this.hoverFeature=feature)},unselect:function(feature){delete this.features[feature.fid||feature.id],this.events.triggerEvent("featureunselected",{feature:feature})},unselectAll:function(){for(var fid in this.features)this.unselect(this.features[fid])},setMap:function(map){for(var i in this.handlers)this.handlers[i].setMap(map);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(pixel){var llPx=pixel.add(-this.clickTolerance/2,this.clickTolerance/2),urPx=pixel.add(this.clickTolerance/2,-this.clickTolerance/2),ll=this.map.getLonLatFromPixel(llPx),ur=this.map.getLonLatFromPixel(urPx);return new OpenLayers.Bounds(ll.lon,ll.lat,ur.lon,ur.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Format.QueryStringFilter=function(){function regex2value(value){return value=value.replace(/%/g,"\\%"),value=value.replace(/\\\\\.(\*)?/g,function($0,$1){return $1?$0:"\\\\_"}),value=value.replace(/\\\\\.\*/g,"\\\\%"),value=value.replace(/(\\)?\.(\*)?/g,function($0,$1,$2){return $1||$2?$0:"_"}),value=value.replace(/(\\)?\.\*/g,function($0,$1){return $1?$0:"%"}),value=value.replace(/\\\./g,"."),value=value.replace(/(\\)?\\\*/g,function($0,$1){return $1?$0:"*"})}var cmpToStr={};return cmpToStr[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",cmpToStr[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",cmpToStr[OpenLayers.Filter.Comparison.LESS_THAN]="lt",cmpToStr[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",cmpToStr[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",cmpToStr[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",cmpToStr[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(filter,params){params=params||{};var className=filter.CLASS_NAME,filterType=className.substring(className.lastIndexOf(".")+1);switch(filterType){case"Spatial":switch(filter.type){case OpenLayers.Filter.Spatial.BBOX:params.bbox=filter.value.toArray(),this.srsInBBOX&&filter.projection&&params.bbox.push(filter.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:params.tolerance=filter.distance;case OpenLayers.Filter.Spatial.WITHIN:params.lon=filter.value.x,params.lat=filter.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+filter.type)}break;case"Comparison":var op=cmpToStr[filter.type];if(void 0!==op){var value=filter.value;filter.type==OpenLayers.Filter.Comparison.LIKE&&(value=regex2value(value),this.wildcarded&&(value="%"+value+"%")),params[filter.property+"__"+op]=value,params.queryable=params.queryable||[],params.queryable.push(filter.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+filter.type);break;case"Logical":if(filter.type===OpenLayers.Filter.Logical.AND)for(var i=0,len=filter.filters.length;len>i;i++)params=this.write(filter.filters[i],params);else OpenLayers.Console.warn("Unsupported logical filter type "+filter.type);break;default:OpenLayers.Console.warn("Unknown filter type "+filterType)}return params},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(evt){var lonLat;if(null==evt)return void this.reset();if(null==this.lastXy||Math.abs(evt.xy.x-this.lastXy.x)>this.granularity||Math.abs(evt.xy.y-this.lastXy.y)>this.granularity)return void(this.lastXy=evt.xy);if(lonLat=this.map.getLonLatFromPixel(evt.xy)){this.displayProjection&&lonLat.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=evt.xy;var newHtml=this.formatOutput(lonLat);newHtml!=this.element.innerHTML&&(this.element.innerHTML=newHtml)}},reset:function(evt){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(lonLat){var digits=parseInt(this.numDigits),newHtml=this.prefix+lonLat.lon.toFixed(digits)+this.separator+lonLat.lat.toFixed(digits)+this.suffix;return newHtml},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:"geolocation"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation),this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(position){var center=new OpenLayers.LonLat(position.coords.longitude,position.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(center),this.events.triggerEvent("locationupdated",{position:position,point:new OpenLayers.Geometry.Point(center.lon,center.lat)})},getCurrentLocation:function(){return!this.active||this.watch?!1:(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(error){this.events.triggerEvent("locationfailed",{error:error})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear(),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var drawn=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(drawn)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var ols=new OpenLayers.Protocol.Script({url:this.url,callback:function(response){this.isLoading=!1,this.events.triggerEvent("loadend"),this.json=response.data},scope:this});ols.read(),this.request=ols}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(response){this.isLoading=!1,this.events.triggerEvent("loadend"),200===response.status&&this.parseData(response.responseText)},scope:this});else this.unload();return drawn},abortLoading:function(){this.request&&(this.request.abort(),delete this.request),this.isLoading=!1},getFeatureInfo:function(i,j){var info=null;if(this.json){var id=this.getFeatureId(i,j);null!==id&&(info={id:id,data:this.json.data[id]})}return info},getFeatureId:function(i,j){var id=null;if(this.json){var resolution=this.utfgridResolution,row=Math.floor(j/resolution),col=Math.floor(i/resolution),charCode=this.json.grid[row].charCodeAt(col),index=this.indexFromCharCode(charCode),keys=this.json.keys;!isNaN(index)&&index in keys&&(id=keys[index])}return id},indexFromCharCode:function(charCode){return charCode>=93&&charCode--,charCode>=35&&charCode--,charCode-32},parseData:function(str){this.format||(this.format=new OpenLayers.Format.JSON),this.json=this.format.read(str)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"}),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(options){if(options=options||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var format=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(filter,params){return format.write(filter,params)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments),options=options||{},options.params=OpenLayers.Util.applyDefaults(options.params,this.options.params),options=OpenLayers.Util.applyDefaults(options,this.options),options.filter&&this.filterToParams&&(options.params=this.filterToParams(options.filter,options.params));var readWithPOST=void 0!==options.readWithPOST?options.readWithPOST:this.readWithPOST,resp=new OpenLayers.Protocol.Response({requestType:"read"});if(readWithPOST){var headers=options.headers||{};headers["Content-Type"]="application/x-www-form-urlencoded",resp.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,resp,options),data:OpenLayers.Util.getParameterString(options.params),headers:headers})}else resp.priv=OpenLayers.Request.GET({url:options.url,callback:this.createCallback(this.handleRead,resp,options),params:options.params,headers:options.headers});return resp},handleRead:function(resp,options){this.handleResponse(resp,options)},create:function(features,options){options=OpenLayers.Util.applyDefaults(options,this.options);var resp=new OpenLayers.Protocol.Response({reqFeatures:features,requestType:"create"});return resp.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleCreate,resp,options),headers:options.headers,data:this.format.write(features)}),resp},handleCreate:function(resp,options){this.handleResponse(resp,options)},update:function(feature,options){options=options||{};var url=options.url||feature.url||this.options.url+"/"+feature.fid;options=OpenLayers.Util.applyDefaults(options,this.options);var resp=new OpenLayers.Protocol.Response({reqFeatures:feature,requestType:"update"}),method=this.updateWithPOST?"POST":"PUT";return resp.priv=OpenLayers.Request[method]({url:url,callback:this.createCallback(this.handleUpdate,resp,options),headers:options.headers,data:this.format.write(feature)}),resp},handleUpdate:function(resp,options){this.handleResponse(resp,options)},"delete":function(feature,options){options=options||{};var url=options.url||feature.url||this.options.url+"/"+feature.fid;options=OpenLayers.Util.applyDefaults(options,this.options);var resp=new OpenLayers.Protocol.Response({reqFeatures:feature,requestType:"delete"}),method=this.deleteWithPOST?"POST":"DELETE",requestOptions={url:url,callback:this.createCallback(this.handleDelete,resp,options),headers:options.headers};return this.deleteWithPOST&&(requestOptions.data=this.format.write(feature)),resp.priv=OpenLayers.Request[method](requestOptions),resp},handleDelete:function(resp,options){this.handleResponse(resp,options)},handleResponse:function(resp,options){var request=resp.priv;options.callback&&(request.status>=200&&request.status<300?("delete"!=resp.requestType&&(resp.features=this.parseFeatures(request)),
resp.code=OpenLayers.Protocol.Response.SUCCESS):resp.code=OpenLayers.Protocol.Response.FAILURE,options.callback.call(options.scope,resp))},parseFeatures:function(request){var doc=request.responseXML;return doc&&doc.documentElement||(doc=request.responseText),!doc||doc.length<=0?null:this.format.read(doc)},commit:function(features,options){function insertCallback(response){for(var len=response.features?response.features.length:0,fids=new Array(len),i=0;len>i;++i)fids[i]=response.features[i].fid;finalResponse.insertIds=fids,callback.apply(this,[response])}function callback(response){this.callUserCallback(response,options),success=success&&response.success(),nResponses++,nResponses>=nRequests&&options.callback&&(finalResponse.code=success?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,options.callback.apply(options.scope,[finalResponse]))}options=OpenLayers.Util.applyDefaults(options,this.options);var resp=[],nResponses=0,types={};types[OpenLayers.State.INSERT]=[],types[OpenLayers.State.UPDATE]=[],types[OpenLayers.State.DELETE]=[];for(var feature,list,requestFeatures=[],i=0,len=features.length;len>i;++i)feature=features[i],list=types[feature.state],list&&(list.push(feature),requestFeatures.push(feature));var nRequests=(types[OpenLayers.State.INSERT].length>0?1:0)+types[OpenLayers.State.UPDATE].length+types[OpenLayers.State.DELETE].length,success=!0,finalResponse=new OpenLayers.Protocol.Response({reqFeatures:requestFeatures}),queue=types[OpenLayers.State.INSERT];queue.length>0&&resp.push(this.create(queue,OpenLayers.Util.applyDefaults({callback:insertCallback,scope:this},options.create))),queue=types[OpenLayers.State.UPDATE];for(var i=queue.length-1;i>=0;--i)resp.push(this.update(queue[i],OpenLayers.Util.applyDefaults({callback:callback,scope:this},options.update)));queue=types[OpenLayers.State.DELETE];for(var i=queue.length-1;i>=0;--i)resp.push(this["delete"](queue[i],OpenLayers.Util.applyDefaults({callback:callback,scope:this},options["delete"])));return resp},abort:function(response){response&&response.priv.abort()},callUserCallback:function(resp,options){var opt=options[resp.requestType];opt&&opt.callback&&opt.callback.call(opt.scope,resp)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);return activated&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this}),activated},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);return deactivated&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})),deactivated},cacheFeatures:function(event){var propagate=!0;return this.clustering||(this.clearCache(),this.features=event.features,this.cluster(),propagate=!1),propagate},clearCache:function(){this.clustering||(this.features=null)},cluster:function(event){if((!event||event.zoomChanged)&&this.features){var resolution=this.layer.map.getResolution();if(resolution!=this.resolution||!this.clustersExist()){this.resolution=resolution;for(var feature,clustered,cluster,clusters=[],i=0;i<this.features.length;++i)if(feature=this.features[i],feature.geometry){clustered=!1;for(var j=clusters.length-1;j>=0;--j)if(cluster=clusters[j],this.shouldCluster(cluster,feature)){this.addToCluster(cluster,feature),clustered=!0;break}clustered||clusters.push(this.createCluster(this.features[i]))}if(this.clustering=!0,this.layer.removeAllFeatures(),this.clustering=!1,clusters.length>0){if(this.threshold>1){var clone=clusters.slice();clusters=[];for(var candidate,i=0,len=clone.length;len>i;++i)candidate=clone[i],candidate.attributes.count<this.threshold?Array.prototype.push.apply(clusters,candidate.cluster):clusters.push(candidate)}this.clustering=!0,this.layer.addFeatures(clusters),this.clustering=!1}this.clusters=clusters}}},clustersExist:function(){var exist=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){exist=!0;for(var i=0;i<this.clusters.length;++i)if(this.clusters[i]!=this.layer.features[i]){exist=!1;break}}return exist},shouldCluster:function(cluster,feature){var cc=cluster.geometry.getBounds().getCenterLonLat(),fc=feature.geometry.getBounds().getCenterLonLat(),distance=Math.sqrt(Math.pow(cc.lon-fc.lon,2)+Math.pow(cc.lat-fc.lat,2))/this.resolution;return distance<=this.distance},addToCluster:function(cluster,feature){cluster.cluster.push(feature),cluster.attributes.count+=1},createCluster:function(feature){var center=feature.geometry.getBounds().getCenterLonLat(),cluster=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(center.lon,center.lat),{count:1});return cluster.cluster=[feature],cluster},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return activated&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),activated},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(event){if(!this.caching&&this.filter){var features=event.features;event.features=[];for(var feature,i=0,ii=features.length;ii>i;++i)feature=features[i],this.filter.evaluate(feature)?event.features.push(feature):this.cache.push(feature)}},handleRemove:function(event){this.caching||(this.cache=[])},setFilter:function(filter){this.filter=filter;var previousCache=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),previousCache.length>0){var event={features:previousCache};this.handleAdd(event),event.features.length>0&&(this.caching=!0,this.layer.addFeatures(event.features),this.caching=!1)}},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Protocol.SOS=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.SOS.DEFAULTS);var cls=OpenLayers.Protocol.SOS["v"+options.version.replace(/\./g,"_")];if(!cls)throw"Unsupported SOS version: "+options.version;return new cls(options)},OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(node,obj){var i,len,complexTypes=[],customTypes={},schema={complexTypes:complexTypes,customTypes:customTypes};this.readChildNodes(node,schema);var attr,name,attributes=node.attributes;for(i=0,len=attributes.length;len>i;++i)attr=attributes[i],name=attr.name,0===name.indexOf("xmlns")?this.setNamespace(name.split(":")[1]||"",attr.value):obj[name]=attr.value;obj.featureTypes=complexTypes,obj.targetPrefix=this.namespaceAlias[obj.targetNamespace];var complexType,customType;for(i=0,len=complexTypes.length;len>i;++i)complexType=complexTypes[i],customType=customTypes[complexType.typeName],customTypes[complexType.typeName]&&(complexType.typeName=customType.name)},complexType:function(node,obj){var complexType={typeName:node.getAttribute("name")};this.readChildNodes(node,complexType),obj.complexTypes.push(complexType)},complexContent:function(node,obj){this.readChildNodes(node,obj)},extension:function(node,obj){this.readChildNodes(node,obj)},sequence:function(node,obj){var sequence={elements:[]};this.readChildNodes(node,sequence),obj.properties=sequence.elements},element:function(node,obj){var type;if(obj.elements){for(var attr,element={},attributes=node.attributes,i=0,len=attributes.length;len>i;++i)attr=attributes[i],element[attr.name]=attr.value;type=element.type,type||(type={},this.readChildNodes(node,type),element.restriction=type,element.type=type.base);var fullType=type.base||type;element.localType=fullType.split(":").pop(),obj.elements.push(element),this.readChildNodes(node,element)}if(obj.complexTypes){type=node.getAttribute("type");var localType=type.split(":").pop();obj.customTypes[localType]={name:node.getAttribute("name"),type:type}}},annotation:function(node,obj){obj.annotation={},this.readChildNodes(node,obj.annotation)},appinfo:function(node,obj){obj.appinfo||(obj.appinfo=[]),obj.appinfo.push(this.getChildValue(node))},documentation:function(node,obj){obj.documentation||(obj.documentation=[]);var value=this.getChildValue(node);obj.documentation.push({lang:node.getAttribute("xml:lang"),textContent:value.replace(this.regExes.trimSpace,"")})},simpleType:function(node,obj){this.readChildNodes(node,obj)},restriction:function(node,obj){obj.base=node.getAttribute("base"),this.readRestriction(node,obj)}}},readRestriction:function(node,obj){for(var child,nodeName,value,children=node.childNodes,i=0,len=children.length;len>i;++i)child=children[i],1==child.nodeType&&(nodeName=child.nodeName.split(":").pop(),value=child.getAttribute("value"),obj[nodeName]?("string"==typeof obj[nodeName]&&(obj[nodeName]=[obj[nodeName]]),obj[nodeName].push(value)):obj[nodeName]=value)},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var schema={};if("ExceptionReport"===data.nodeName.split(":").pop()){var parser=new OpenLayers.Format.OGCExceptionReport;schema.error=parser.read(data)}else this.readNode(data,schema);return schema},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"}),OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(item){var point=this.getElementsByTagNameNS(item,this.georssns,"point"),lat=this.getElementsByTagNameNS(item,this.geons,"lat"),lon=this.getElementsByTagNameNS(item,this.geons,"long"),line=this.getElementsByTagNameNS(item,this.georssns,"line"),polygon=this.getElementsByTagNameNS(item,this.georssns,"polygon"),where=this.getElementsByTagNameNS(item,this.georssns,"where"),box=this.getElementsByTagNameNS(item,this.georssns,"box");if(point.length>0||lat.length>0&&lon.length>0){var location;point.length>0?(location=OpenLayers.String.trim(point[0].firstChild.nodeValue).split(/\s+/),2!=location.length&&(location=OpenLayers.String.trim(point[0].firstChild.nodeValue).split(/\s*,\s*/))):location=[parseFloat(lat[0].firstChild.nodeValue),parseFloat(lon[0].firstChild.nodeValue)];var geometry=new OpenLayers.Geometry.Point(location[1],location[0])}else if(line.length>0){for(var point,coords=OpenLayers.String.trim(this.getChildValue(line[0])).split(/\s+/),components=[],i=0,len=coords.length;len>i;i+=2)point=new OpenLayers.Geometry.Point(coords[i+1],coords[i]),components.push(point);geometry=new OpenLayers.Geometry.LineString(components)}else if(polygon.length>0){for(var point,coords=OpenLayers.String.trim(this.getChildValue(polygon[0])).split(/\s+/),components=[],i=0,len=coords.length;len>i;i+=2)point=new OpenLayers.Geometry.Point(coords[i+1],coords[i]),components.push(point);geometry=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(components)])}else if(where.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy}));var feature=this.gmlParser.parseFeature(where[0]);geometry=feature.geometry}else if(box.length>0){var point,coords=OpenLayers.String.trim(box[0].firstChild.nodeValue).split(/\s+/),components=[];coords.length>3&&(point=new OpenLayers.Geometry.Point(coords[1],coords[0]),components.push(point),point=new OpenLayers.Geometry.Point(coords[1],coords[2]),components.push(point),point=new OpenLayers.Geometry.Point(coords[3],coords[2]),components.push(point),point=new OpenLayers.Geometry.Point(coords[3],coords[0]),components.push(point),point=new OpenLayers.Geometry.Point(coords[1],coords[0]),components.push(point)),geometry=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(components)])}return geometry&&this.internalProjection&&this.externalProjection&&geometry.transform(this.externalProjection,this.internalProjection),geometry},createFeatureFromItem:function(item){var geometry=this.createGeometryFromItem(item),title=this._getChildValue(item,"*","title",this.featureTitle),description=this._getChildValue(item,"*","description",this._getChildValue(item,"*","content",this._getChildValue(item,"*","summary",this.featureDescription))),link=this._getChildValue(item,"*","link");if(!link)try{link=this.getElementsByTagNameNS(item,"*","link")[0].getAttribute("href")}catch(e){link=null}var id=this._getChildValue(item,"*","id",null),data={title:title,description:description,link:link},feature=new OpenLayers.Feature.Vector(geometry,data);return feature.fid=id,feature},_getChildValue:function(node,nsuri,name,def){var value,eles=this.getElementsByTagNameNS(node,nsuri,name);return value=eles&&eles[0]&&eles[0].firstChild&&eles[0].firstChild.nodeValue?this.getChildValue(eles[0]):void 0==def?"":def},read:function(doc){"string"==typeof doc&&(doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc]));var itemlist=null;itemlist=this.getElementsByTagNameNS(doc,"*","item"),0==itemlist.length&&(itemlist=this.getElementsByTagNameNS(doc,"*","entry"));for(var numItems=itemlist.length,features=new Array(numItems),i=0;numItems>i;i++)features[i]=this.createFeatureFromItem(itemlist[i]);return features},write:function(features){var georss;if(OpenLayers.Util.isArray(features)){georss=this.createElementNS(this.rssns,"rss");for(var i=0,len=features.length;len>i;i++)georss.appendChild(this.createFeatureXML(features[i]))}else georss=this.createFeatureXML(features);return OpenLayers.Format.XML.prototype.write.apply(this,[georss])},createFeatureXML:function(feature){var geometryNode=this.buildGeometryNode(feature.geometry),featureNode=this.createElementNS(this.rssns,"item"),titleNode=this.createElementNS(this.rssns,"title");titleNode.appendChild(this.createTextNode(feature.attributes.title?feature.attributes.title:""));var descNode=this.createElementNS(this.rssns,"description");if(descNode.appendChild(this.createTextNode(feature.attributes.description?feature.attributes.description:"")),featureNode.appendChild(titleNode),featureNode.appendChild(descNode),feature.attributes.link){var linkNode=this.createElementNS(this.rssns,"link");linkNode.appendChild(this.createTextNode(feature.attributes.link)),featureNode.appendChild(linkNode)}for(var attr in feature.attributes)if("link"!=attr&&"title"!=attr&&"description"!=attr){var attrText=this.createTextNode(feature.attributes[attr]),nodename=attr;-1!=attr.search(":")&&(nodename=attr.split(":")[1]);var attrContainer=this.createElementNS(this.featureNS,"feature:"+nodename);attrContainer.appendChild(attrText),featureNode.appendChild(attrContainer)}return featureNode.appendChild(geometryNode),featureNode},buildGeometryNode:function(geometry){this.internalProjection&&this.externalProjection&&(geometry=geometry.clone(),geometry.transform(this.internalProjection,this.externalProjection));var node;if("OpenLayers.Geometry.Polygon"==geometry.CLASS_NAME)node=this.createElementNS(this.georssns,"georss:polygon"),node.appendChild(this.buildCoordinatesNode(geometry.components[0]));else if("OpenLayers.Geometry.LineString"==geometry.CLASS_NAME)node=this.createElementNS(this.georssns,"georss:line"),node.appendChild(this.buildCoordinatesNode(geometry));else{if("OpenLayers.Geometry.Point"!=geometry.CLASS_NAME)throw"Couldn't parse "+geometry.CLASS_NAME;node=this.createElementNS(this.georssns,"georss:point"),node.appendChild(this.buildCoordinatesNode(geometry))}return node},buildCoordinatesNode:function(geometry){var points=null;geometry.components&&(points=geometry.components);var path;if(points){for(var numPoints=points.length,parts=new Array(numPoints),i=0;numPoints>i;i++)parts[i]=points[i].y+" "+points[i].x;path=parts.join(" ")}else path=geometry.y+" "+geometry.x;return this.createTextNode(path)},CLASS_NAME:"OpenLayers.Format.GeoRSS"}),OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"}),OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var capabilities={};return this.readNode(data,capabilities),capabilities},readers:{wps:{Capabilities:function(node,obj){this.readChildNodes(node,obj)},ProcessOfferings:function(node,obj){obj.processOfferings={},this.readChildNodes(node,obj.processOfferings)},Process:function(node,processOfferings){var processVersion=this.getAttributeNS(node,this.namespaces.wps,"processVersion"),process={processVersion:processVersion};this.readChildNodes(node,process),processOfferings[process.identifier]=process},Languages:function(node,obj){obj.languages=[],this.readChildNodes(node,obj.languages)},Default:function(node,languages){var language={isDefault:!0};this.readChildNodes(node,language),languages.push(language)},Supported:function(node,languages){var language={};this.readChildNodes(node,language),languages.push(language)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(evt,pinchData){var xy=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):evt.xy;this.pinchOrigin=xy,this.currentCenter=xy},pinchMove:function(evt,pinchData){var scale=pinchData.scale,containerOrigin=this.map.layerContainerOriginPx,pinchOrigin=this.pinchOrigin,current=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):evt.xy,dx=Math.round(containerOrigin.x+current.x-pinchOrigin.x+(scale-1)*(containerOrigin.x-pinchOrigin.x)),dy=Math.round(containerOrigin.y+current.y-pinchOrigin.y+(scale-1)*(containerOrigin.y-pinchOrigin.y));this.map.applyTransform(dx,dy,scale),this.currentCenter=current},pinchDone:function(evt,start,last){this.map.applyTransform();var zoom=this.map.getZoomForResolution(this.map.getResolution()/last.scale,!0);if(zoom!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var resolution=this.map.getResolutionForZoom(zoom),location=this.map.getLonLatFromPixel(this.pinchOrigin),zoomPixel=this.currentCenter,size=this.map.getSize();location.lon+=resolution*(size.w/2-zoomPixel.x),location.lat-=resolution*(size.h/2-zoomPixel.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(location,zoom)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(options){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var clickCallbacks={click:this.defaultClick,dblclick:this.defaultDblClick},clickOptions=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,clickOptions),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(evt){evt.lastTouches&&2==evt.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(evt){this.map.zoomTo(this.map.zoom+1,evt.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(red,green,blue){this.rgb={r:red,g:green,b:blue}},setRed:function(r){this.rgb.r=r},setGreen:function(g){this.rgb.g=g},setBlue:function(b){this.rgb.b=b},setHue:function(h){var hsb=this.asHSB();hsb.h=h,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},setSaturation:function(s){var hsb=this.asHSB();hsb.s=s,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},setBrightness:function(b){var hsb=this.asHSB();hsb.b=b,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)},darken:function(percent){var hsb=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.max(hsb.b-percent,0))},brighten:function(percent){var hsb=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.min(hsb.b+percent,1))},blend:function(other){this.rgb.r=Math.floor((this.rgb.r+other.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+other.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+other.rgb.b)/2)},isBright:function(){this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}}),OpenLayers.Rico.Color.createFromHex=function(hexCode){if(4==hexCode.length)for(var shortHexCode=hexCode,hexCode="#",i=1;4>i;i++)hexCode+=shortHexCode.charAt(i)+shortHexCode.charAt(i);0==hexCode.indexOf("#")&&(hexCode=hexCode.substring(1));var red=hexCode.substring(0,2),green=hexCode.substring(2,4),blue=hexCode.substring(4,6);return new OpenLayers.Rico.Color(parseInt(red,16),parseInt(green,16),parseInt(blue,16))},OpenLayers.Rico.Color.createColorFromBackground=function(elem){var actualColor=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(elem),"backgroundColor");if("transparent"==actualColor&&elem.parentNode)return OpenLayers.Rico.Color.createColorFromBackground(elem.parentNode);if(null==actualColor)return new OpenLayers.Rico.Color(255,255,255);if(0==actualColor.indexOf("rgb(")){var colors=actualColor.substring(4,actualColor.length-1),colorArray=colors.split(",");return new OpenLayers.Rico.Color(parseInt(colorArray[0]),parseInt(colorArray[1]),parseInt(colorArray[2]))}return 0==actualColor.indexOf("#")?OpenLayers.Rico.Color.createFromHex(actualColor):new OpenLayers.Rico.Color(255,255,255)},OpenLayers.Rico.Color.HSBtoRGB=function(hue,saturation,brightness){var red=0,green=0,blue=0;if(0==saturation)red=parseInt(255*brightness+.5),green=red,blue=red;else{var h=6*(hue-Math.floor(hue)),f=h-Math.floor(h),p=brightness*(1-saturation),q=brightness*(1-saturation*f),t=brightness*(1-saturation*(1-f));switch(parseInt(h)){case 0:red=255*brightness+.5,green=255*t+.5,blue=255*p+.5;break;case 1:red=255*q+.5,green=255*brightness+.5,blue=255*p+.5;break;case 2:red=255*p+.5,green=255*brightness+.5,blue=255*t+.5;break;case 3:red=255*p+.5,green=255*q+.5,blue=255*brightness+.5;break;case 4:red=255*t+.5,green=255*p+.5,blue=255*brightness+.5;break;case 5:red=255*brightness+.5,green=255*p+.5,blue=255*q+.5}}return{r:parseInt(red),g:parseInt(green),b:parseInt(blue)}},OpenLayers.Rico.Color.RGBtoHSB=function(r,g,b){var hue,saturation,brightness,cmax=r>g?r:g;b>cmax&&(cmax=b);var cmin=g>r?r:g;if(cmin>b&&(cmin=b),brightness=cmax/255,saturation=0!=cmax?(cmax-cmin)/cmax:0,0==saturation)hue=0;else{var redc=(cmax-r)/(cmax-cmin),greenc=(cmax-g)/(cmax-cmin),bluec=(cmax-b)/(cmax-cmin);hue=r==cmax?bluec-greenc:g==cmax?2+redc-bluec:4+greenc-redc,hue/=6,0>hue&&(hue+=1)}return{h:hue,s:saturation,b:brightness}},OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(config){OpenLayers.Util.extend(this,config),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var i=0,len=this.rules.length;len>i;i++)this.rules[i].destroy();delete this.rules},clone:function(){var config=OpenLayers.Util.extend({},this);if(this.rules){config.rules=[];for(var i=0,len=this.rules.length;len>i;++i)config.rules.push(this.rules[i].clone())}return new OpenLayers.Style2(config)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(options,layer){OpenLayers.Format.GML.prototype.initialize.apply(this,[options]),this.layer=layer,this.layer.featureNS&&(this.featureNS=this.layer.featureNS),this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column),this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(features){var transaction=this.createElementNS(this.wfsns,"wfs:Transaction");transaction.setAttribute("version","1.0.0"),transaction.setAttribute("service","WFS");for(var i=0;i<features.length;i++)switch(features[i].state){case OpenLayers.State.INSERT:transaction.appendChild(this.insert(features[i]));break;case OpenLayers.State.UPDATE:transaction.appendChild(this.update(features[i]));break;case OpenLayers.State.DELETE:transaction.appendChild(this.remove(features[i]))}return OpenLayers.Format.XML.prototype.write.apply(this,[transaction])},createFeatureXML:function(feature){var geometryNode=this.buildGeometryNode(feature.geometry),geomContainer=this.createElementNS(this.featureNS,"feature:"+this.geometryName);geomContainer.appendChild(geometryNode);var featureContainer=this.createElementNS(this.featureNS,"feature:"+this.featureName);featureContainer.appendChild(geomContainer);for(var attr in feature.attributes){var attrText=this.createTextNode(feature.attributes[attr]),nodename=attr;-1!=attr.search(":")&&(nodename=attr.split(":")[1]);var attrContainer=this.createElementNS(this.featureNS,"feature:"+nodename);attrContainer.appendChild(attrText),featureContainer.appendChild(attrContainer)}return featureContainer},insert:function(feature){var insertNode=this.createElementNS(this.wfsns,"wfs:Insert");return insertNode.appendChild(this.createFeatureXML(feature)),insertNode},update:function(feature){feature.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var updateNode=this.createElementNS(this.wfsns,"wfs:Update");updateNode.setAttribute("typeName",this.featurePrefix+":"+this.featureName),updateNode.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var propertyNode=this.createElementNS(this.wfsns,"wfs:Property"),nameNode=this.createElementNS(this.wfsns,"wfs:Name"),txtNode=this.createTextNode(this.geometryName);nameNode.appendChild(txtNode),propertyNode.appendChild(nameNode);var valueNode=this.createElementNS(this.wfsns,"wfs:Value"),geometryNode=this.buildGeometryNode(feature.geometry);feature.layer&&geometryNode.setAttribute("srsName",feature.layer.projection.getCode()),valueNode.appendChild(geometryNode),propertyNode.appendChild(valueNode),updateNode.appendChild(propertyNode);for(var propName in feature.attributes)propertyNode=this.createElementNS(this.wfsns,"wfs:Property"),nameNode=this.createElementNS(this.wfsns,"wfs:Name"),nameNode.appendChild(this.createTextNode(propName)),propertyNode.appendChild(nameNode),valueNode=this.createElementNS(this.wfsns,"wfs:Value"),valueNode.appendChild(this.createTextNode(feature.attributes[propName])),propertyNode.appendChild(valueNode),updateNode.appendChild(propertyNode);var filterNode=this.createElementNS(this.ogcns,"ogc:Filter"),filterIdNode=this.createElementNS(this.ogcns,"ogc:FeatureId");return filterIdNode.setAttribute("fid",feature.fid),filterNode.appendChild(filterIdNode),updateNode.appendChild(filterNode),updateNode},remove:function(feature){if(!feature.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var deleteNode=this.createElementNS(this.wfsns,"wfs:Delete");deleteNode.setAttribute("typeName",this.featurePrefix+":"+this.featureName),deleteNode.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var filterNode=this.createElementNS(this.ogcns,"ogc:Filter"),filterIdNode=this.createElementNS(this.ogcns,"ogc:FeatureId");return filterIdNode.setAttribute("fid",feature.fid),filterNode.appendChild(filterIdNode),deleteNode.appendChild(filterNode),deleteNode},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"}),OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(node,obj){var value=this.readers.ogc._expression.call(this,node);value&&(obj.priority=value)},VendorOption:function(node,obj){obj.vendorOptions||(obj.vendorOptions={}),obj.vendorOptions[node.getAttribute("name")]=this.getChildValue(node)},TextSymbolizer:function(node,rule){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var symbolizer=this.multipleSymbolizers?rule.symbolizers[rule.symbolizers.length-1]:rule.symbolizer.Text;void 0===symbolizer.graphic&&(symbolizer.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(priority){return this.writers.sld._OGCExpression.call(this,"sld:Priority",priority)},VendorOption:function(option){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:option.name},value:option.value})},TextSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers,node=writers.sld.TextSymbolizer.apply(this,arguments);return symbolizer.graphic!==!1&&(symbolizer.externalGraphic||symbolizer.graphicName)&&this.writeNode("Graphic",symbolizer,node),"priority"in symbolizer&&this.writeNode("Priority",symbolizer.priority,node),this.addVendorOptions(node,symbolizer)},PointSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers,node=writers.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(node,symbolizer)},LineSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers,node=writers.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(node,symbolizer)},PolygonSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers,node=writers.sld.PolygonSymbolizer.apply(this,arguments);
return this.addVendorOptions(node,symbolizer)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(node,symbolizer){var options=symbolizer.vendorOptions;if(options)for(var key in symbolizer.vendorOptions)this.writeNode("VendorOption",{name:key,value:symbolizer.vendorOptions[key]},node);return node},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"}),OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(marker){var topleft=this.map.getLayerPxFromLonLat({lon:marker.bounds.left,lat:marker.bounds.top}),botright=this.map.getLayerPxFromLonLat({lon:marker.bounds.right,lat:marker.bounds.bottom});if(null==botright||null==topleft)marker.display(!1);else{var markerDiv=marker.draw(topleft,{w:Math.max(1,botright.x-topleft.x),h:Math.max(1,botright.y-topleft.y)});marker.drawn||(this.div.appendChild(markerDiv),marker.drawn=!0)}},removeMarker:function(marker){OpenLayers.Util.removeItem(this.markers,marker),null!=marker.div&&marker.div.parentNode==this.div&&this.div.removeChild(marker.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"}),OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(node,capabilities){capabilities.service={},this.readChildNodes(node,capabilities.service)},Fees:function(node,service){var fees=this.getChildValue(node);fees&&"none"!=fees.toLowerCase()&&(service.fees=fees)},AccessConstraints:function(node,service){var constraints=this.getChildValue(node);constraints&&"none"!=constraints.toLowerCase()&&(service.accessConstraints=constraints)},OnlineResource:function(node,service){var onlineResource=this.getChildValue(node);onlineResource&&"none"!=onlineResource.toLowerCase()&&(service.onlineResource=onlineResource)},Keywords:function(node,service){var keywords=this.getChildValue(node);keywords&&"none"!=keywords.toLowerCase()&&(service.keywords=keywords.split(", "))},Capability:function(node,capabilities){capabilities.capability={},this.readChildNodes(node,capabilities.capability)},Request:function(node,obj){obj.request={},this.readChildNodes(node,obj.request)},GetFeature:function(node,request){request.getfeature={href:{},formats:[]},this.readChildNodes(node,request.getfeature)},ResultFormat:function(node,obj){for(var childNode,children=node.childNodes,i=0;i<children.length;i++)childNode=children[i],1==childNode.nodeType&&obj.formats.push(childNode.nodeName)},DCPType:function(node,obj){this.readChildNodes(node,obj)},HTTP:function(node,obj){this.readChildNodes(node,obj.href)},Get:function(node,obj){obj.get=node.getAttribute("onlineResource")},Post:function(node,obj){obj.post=node.getAttribute("onlineResource")},SRS:function(node,obj){var srs=this.getChildValue(node);srs&&(obj.srs=srs)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"}),OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(node,obj){this.readChildNodes(node,obj)},LayerLimit:function(node,obj){obj.layerLimit=parseInt(this.getChildValue(node))},MaxWidth:function(node,obj){obj.maxWidth=parseInt(this.getChildValue(node))},MaxHeight:function(node,obj){obj.maxHeight=parseInt(this.getChildValue(node))},BoundingBox:function(node,obj){var bbox=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[node,obj]);bbox.srs=node.getAttribute("CRS"),obj.bbox[bbox.srs]=bbox},CRS:function(node,obj){this.readers.wms.SRS.apply(this,[node,obj])},EX_GeographicBoundingBox:function(node,obj){obj.llbbox=[],this.readChildNodes(node,obj.llbbox)},westBoundLongitude:function(node,obj){obj[0]=this.getChildValue(node)},eastBoundLongitude:function(node,obj){obj[2]=this.getChildValue(node)},southBoundLatitude:function(node,obj){obj[1]=this.getChildValue(node)},northBoundLatitude:function(node,obj){obj[3]=this.getChildValue(node)},MinScaleDenominator:function(node,obj){obj.maxScale=parseFloat(this.getChildValue(node)).toPrecision(16)},MaxScaleDenominator:function(node,obj){obj.minScale=parseFloat(this.getChildValue(node)).toPrecision(16)},Dimension:function(node,obj){var name=node.getAttribute("name").toLowerCase(),dim={name:name,units:node.getAttribute("units"),unitsymbol:node.getAttribute("unitSymbol"),nearestVal:"1"===node.getAttribute("nearestValue"),multipleVal:"1"===node.getAttribute("multipleValues"),"default":node.getAttribute("default")||"",current:"1"===node.getAttribute("current"),values:this.getChildValue(node).split(",")};obj.dimensions[dim.name]=dim},Keyword:function(node,obj){var keyword={value:this.getChildValue(node),vocabulary:node.getAttribute("vocabulary")};obj.keywords&&obj.keywords.push(keyword)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(node,obj){this.readers.wms.UserDefinedSymbolization.apply(this,[node,obj]),obj.userSymbols.inlineFeature=1==parseInt(node.getAttribute("InlineFeature")),obj.userSymbols.remoteWCS=1==parseInt(node.getAttribute("RemoteWCS"))},DescribeLayer:function(node,obj){this.readers.wms.DescribeLayer.apply(this,[node,obj])},GetLegendGraphic:function(node,obj){this.readers.wms.GetLegendGraphic.apply(this,[node,obj])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"}),OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(name,url,size,options){this.initializeZoomify(size),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,size,{},options])},initializeZoomify:function(size){var imageSize=size.clone();this.size=size.clone();var tiles=new OpenLayers.Size(Math.ceil(imageSize.w/this.standardTileSize),Math.ceil(imageSize.h/this.standardTileSize));for(this.tierSizeInTiles=[tiles],this.tierImageSize=[imageSize];imageSize.w>this.standardTileSize||imageSize.h>this.standardTileSize;)imageSize=new OpenLayers.Size(Math.floor(imageSize.w/2),Math.floor(imageSize.h/2)),tiles=new OpenLayers.Size(Math.ceil(imageSize.w/this.standardTileSize),Math.ceil(imageSize.h/this.standardTileSize)),this.tierSizeInTiles.push(tiles),this.tierImageSize.push(imageSize);this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length;var resolutions=[1];this.tileCountUpToTier=[0];for(var i=1;i<this.numberOfTiers;i++)resolutions.unshift(Math.pow(2,i)),this.tileCountUpToTier.push(this.tierSizeInTiles[i-1].w*this.tierSizeInTiles[i-1].h+this.tileCountUpToTier[i-1]);this.serverResolutions||(this.serverResolutions=resolutions)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.tileCountUpToTier.length=0,this.tierSizeInTiles.length=0,this.tierImageSize.length=0},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){bounds=this.adjustBounds(bounds);var res=this.getServerResolution(),x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w)),y=Math.round((this.tileOrigin.lat-bounds.top)/(res*this.tileSize.h)),z=this.getZoomForResolution(res),tileIndex=x+y*this.tierSizeInTiles[z].w+this.tileCountUpToTier[z],path="TileGroup"+Math.floor(tileIndex/256)+"/"+z+"-"+x+"-"+y+".jpg",url=this.url;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(path,url)),url+path},getImageSize:function(){if(arguments.length>0){var bounds=this.adjustBounds(arguments[0]),res=this.getServerResolution(),x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w)),y=Math.round((this.tileOrigin.lat-bounds.top)/(res*this.tileSize.h)),z=this.getZoomForResolution(res),w=this.standardTileSize,h=this.standardTileSize;if(x==this.tierSizeInTiles[z].w-1)var w=this.tierImageSize[z].w%this.standardTileSize;if(y==this.tierSizeInTiles[z].h-1)var h=this.tierImageSize[z].h%this.standardTileSize;return new OpenLayers.Size(w,h)}return this.tileSize},setMap:function(map){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"}),OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(name,url,params,options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS),(null==options||null==options.isBaseLayer)&&(this.isBaseLayer="true"!=this.params.transparent&&1!=this.params.transparent)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getURL:function(bounds){bounds=this.adjustBounds(bounds);var extent=[bounds.left,bounds.bottom,bounds.right,bounds.top],imageSize=this.getImageSize(),url=this.getFullRequestString({mapext:extent,imgext:extent,map_size:[imageSize.w,imageSize.h],imgx:imageSize.w/2,imgy:imageSize.h/2,imgxy:[imageSize.w,imageSize.h]});return url},getFullRequestString:function(newParams,altUrl){var url=null==altUrl?this.url:altUrl,allParams=OpenLayers.Util.extend({},this.params);allParams=OpenLayers.Util.extend(allParams,newParams);var paramsString=OpenLayers.Util.getParameterString(allParams);OpenLayers.Util.isArray(url)&&(url=this.selectUrl(paramsString,url));var urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));for(var key in allParams)key.toUpperCase()in urlParams&&delete allParams[key];paramsString=OpenLayers.Util.getParameterString(allParams);var requestString=url;if(paramsString=paramsString.replace(/,/g,"+"),""!=paramsString){var lastServerChar=url.charAt(url.length-1);requestString+="&"==lastServerChar||"?"==lastServerChar?paramsString:-1==url.indexOf("?")?"?"+paramsString:"&"+paramsString}return requestString},CLASS_NAME:"OpenLayers.Layer.MapServer"}),OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(containerID){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var style=document.createStyleSheet(),shapes=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],i=0,len=shapes.length;len>i;i++)style.addRule("olv\\:"+shapes[i],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),resolution=this.getResolution(),left=extent.left/resolution|0,top=extent.top/resolution-this.size.h|0;resolutionChanged||!this.offset?(this.offset={x:left,y:top},left=0,top=0):(left-=this.offset.x,top-=this.offset.y);var org=left-this.xOffset+" "+top;this.root.coordorigin=org;for(var root,roots=[this.root,this.vectorRoot,this.textRoot],i=0,len=roots.length;len>i;++i){root=roots[i];var size=this.size.w+" "+this.size.h;root.coordsize=size}return this.root.style.flip="y",coordSysUnchanged},setSize:function(size){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var root,roots=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],w=this.size.w+"px",h=this.size.h+"px",i=0,len=roots.length;len>i;++i)root=roots[i],root.style.width=w,root.style.height=h},getNodeType:function(geometry,style){var nodeType=null;switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":nodeType=style.externalGraphic?"olv:rect":this.isComplexSymbol(style.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":nodeType="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":nodeType="olv:shape"}return nodeType},setStyle:function(node,style,options,geometry){style=style||node._style,options=options||node._options;var fillColor=style.fillColor,title=style.title||style.graphicTitle;if(title&&(node.title=title),"OpenLayers.Geometry.Point"===node._geometryClass)if(style.externalGraphic){options.isFilled=!0;var width=style.graphicWidth||style.graphicHeight,height=style.graphicHeight||style.graphicWidth;width=width?width:2*style.pointRadius,height=height?height:2*style.pointRadius;var resolution=this.getResolution(),xOffset=void 0!=style.graphicXOffset?style.graphicXOffset:-(.5*width),yOffset=void 0!=style.graphicYOffset?style.graphicYOffset:-(.5*height);node.style.left=((geometry.x-this.featureDx)/resolution-this.offset.x+xOffset|0)+"px",node.style.top=(geometry.y/resolution-this.offset.y-(yOffset+height)|0)+"px",node.style.width=width+"px",node.style.height=height+"px",node.style.flip="y",fillColor="none",options.isStroked=!1}else if(this.isComplexSymbol(style.graphicName)){var cache=this.importSymbol(style.graphicName);node.path=cache.path,node.coordorigin=cache.left+","+cache.bottom;var size=cache.size;node.coordsize=size+","+size,this.drawCircle(node,geometry,style.pointRadius),node.style.flip="y"}else this.drawCircle(node,geometry,style.pointRadius);options.isFilled?node.fillcolor=fillColor:node.filled="false";var fills=node.getElementsByTagName("fill"),fill=0==fills.length?null:fills[0];options.isFilled?(fill||(fill=this.createNode("olv:fill",node.id+"_fill")),fill.opacity=style.fillOpacity,"OpenLayers.Geometry.Point"===node._geometryClass&&style.externalGraphic&&(style.graphicOpacity&&(fill.opacity=style.graphicOpacity),fill.src=style.externalGraphic,fill.type="frame",style.graphicWidth&&style.graphicHeight||(fill.aspect="atmost")),fill.parentNode!=node&&node.appendChild(fill)):fill&&node.removeChild(fill);var rotation=style.rotation;(void 0!==rotation||void 0!==node._rotation)&&(node._rotation=rotation,style.externalGraphic?(this.graphicRotate(node,xOffset,yOffset,style),fill.opacity=0):"OpenLayers.Geometry.Point"===node._geometryClass&&(node.style.rotation=rotation||0));var strokes=node.getElementsByTagName("stroke"),stroke=0==strokes.length?null:strokes[0];return options.isStroked?(stroke||(stroke=this.createNode("olv:stroke",node.id+"_stroke"),node.appendChild(stroke)),stroke.on=!0,stroke.color=style.strokeColor,stroke.weight=style.strokeWidth+"px",stroke.opacity=style.strokeOpacity,stroke.endcap="butt"==style.strokeLinecap?"flat":style.strokeLinecap||"round",style.strokeDashstyle&&(stroke.dashstyle=this.dashStyle(style))):(node.stroked=!1,stroke&&(stroke.on=!1)),"inherit"!=style.cursor&&null!=style.cursor&&(node.style.cursor=style.cursor),node},graphicRotate:function(node,xOffset,yOffset,style){var aspectRatio,size,style=style||node._style,rotation=style.rotation||0;if(!style.graphicWidth||!style.graphicHeight){var img=new Image;return img.onreadystatechange=OpenLayers.Function.bind(function(){("complete"==img.readyState||"interactive"==img.readyState)&&(aspectRatio=img.width/img.height,size=Math.max(2*style.pointRadius,style.graphicWidth||0,style.graphicHeight||0),xOffset*=aspectRatio,style.graphicWidth=size*aspectRatio,style.graphicHeight=size,this.graphicRotate(node,xOffset,yOffset,style))},this),void(img.src=style.externalGraphic)}size=Math.max(style.graphicWidth,style.graphicHeight),aspectRatio=style.graphicWidth/style.graphicHeight;var width=Math.round(style.graphicWidth||size*aspectRatio),height=Math.round(style.graphicHeight||size);node.style.width=width+"px",node.style.height=height+"px";var image=document.getElementById(node.id+"_image");image||(image=this.createNode("olv:imagedata",node.id+"_image"),node.appendChild(image)),image.style.width=width+"px",image.style.height=height+"px",image.src=style.externalGraphic,image.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var rot=rotation*Math.PI/180,sintheta=Math.sin(rot),costheta=Math.cos(rot),filter="progid:DXImageTransform.Microsoft.Matrix(M11="+costheta+",M12="+-sintheta+",M21="+sintheta+",M22="+costheta+",SizingMethod='auto expand')\n",opacity=style.graphicOpacity||style.fillOpacity;opacity&&1!=opacity&&(filter+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+opacity+")\n"),node.style.filter=filter;var centerPoint=new OpenLayers.Geometry.Point(-xOffset,-yOffset),imgBox=new OpenLayers.Bounds(0,0,width,height).toGeometry();imgBox.rotate(style.rotation,centerPoint);var imgBounds=imgBox.getBounds();node.style.left=Math.round(parseInt(node.style.left)+imgBounds.left)+"px",node.style.top=Math.round(parseInt(node.style.top)-imgBounds.bottom)+"px"},postDraw:function(node){node.style.visibility="visible";var fillColor=node._style.fillColor,strokeColor=node._style.strokeColor;"none"==fillColor&&node.fillcolor!=fillColor&&(node.fillcolor=fillColor),"none"==strokeColor&&node.strokecolor!=strokeColor&&(node.strokecolor=strokeColor)},setNodeDimension:function(node,geometry){var bbox=geometry.getBounds();if(bbox){var resolution=this.getResolution(),scaledBox=new OpenLayers.Bounds((bbox.left-this.featureDx)/resolution-this.offset.x|0,bbox.bottom/resolution-this.offset.y|0,(bbox.right-this.featureDx)/resolution-this.offset.x|0,bbox.top/resolution-this.offset.y|0);node.style.left=scaledBox.left+"px",node.style.top=scaledBox.top+"px",node.style.width=scaledBox.getWidth()+"px",node.style.height=scaledBox.getHeight()+"px",node.coordorigin=scaledBox.left+" "+scaledBox.top,node.coordsize=scaledBox.getWidth()+" "+scaledBox.getHeight()}},dashStyle:function(style){var dash=style.strokeDashstyle;switch(dash){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return dash;default:var parts=dash.split(/[ ,]/);return 2==parts.length?1*parts[0]>=2*parts[1]?"longdash":1==parts[0]||1==parts[1]?"dot":"dash":4==parts.length?1*parts[0]>=2*parts[1]?"longdashdot":"dashdot":"solid"}},createNode:function(type,id){var node=document.createElement(type);return id&&(node.id=id),node.unselectable="on",node.onselectstart=OpenLayers.Function.False,node},nodeTypeCompare:function(node,type){var subType=type,splitIndex=subType.indexOf(":");-1!=splitIndex&&(subType=subType.substr(splitIndex+1));var nodeName=node.nodeName;return splitIndex=nodeName.indexOf(":"),-1!=splitIndex&&(nodeName=nodeName.substr(splitIndex+1)),subType==nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"olv:group")},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)},drawCircle:function(node,geometry,radius){if(!isNaN(geometry.x)&&!isNaN(geometry.y)){var resolution=this.getResolution();node.style.left=((geometry.x-this.featureDx)/resolution-this.offset.x|0)-radius+"px",node.style.top=(geometry.y/resolution-this.offset.y|0)-radius+"px";var diameter=2*radius;return node.style.width=diameter+"px",node.style.height=diameter+"px",node}return!1},drawLineString:function(node,geometry){return this.drawLine(node,geometry,!1)},drawLinearRing:function(node,geometry){return this.drawLine(node,geometry,!0)},drawLine:function(node,geometry,closeLine){this.setNodeDimension(node,geometry);for(var comp,x,y,resolution=this.getResolution(),numComponents=geometry.components.length,parts=new Array(numComponents),i=0;numComponents>i;i++)comp=geometry.components[i],x=(comp.x-this.featureDx)/resolution-this.offset.x|0,y=comp.y/resolution-this.offset.y|0,parts[i]=" "+x+","+y+" l ";var end=closeLine?" x e":" e";return node.path="m"+parts.join("")+end,node},drawPolygon:function(node,geometry){this.setNodeDimension(node,geometry);var j,jj,points,area,first,second,i,ii,comp,pathComp,x,y,resolution=this.getResolution(),path=[];for(j=0,jj=geometry.components.length;jj>j;j++){for(path.push("m"),points=geometry.components[j].components,area=0===j,first=null,second=null,i=0,ii=points.length;ii>i;i++)comp=points[i],x=(comp.x-this.featureDx)/resolution-this.offset.x|0,y=comp.y/resolution-this.offset.y|0,pathComp=" "+x+","+y,path.push(pathComp),0==i&&path.push(" l"),area||(first?first!=pathComp&&(second?second!=pathComp&&(area=!0):second=pathComp):first=pathComp);path.push(area?" x ":" ")}return path.push("e"),node.path=path.join(""),node},drawRectangle:function(node,geometry){var resolution=this.getResolution();return node.style.left=((geometry.x-this.featureDx)/resolution-this.offset.x|0)+"px",node.style.top=(geometry.y/resolution-this.offset.y|0)+"px",node.style.width=(geometry.width/resolution|0)+"px",node.style.height=(geometry.height/resolution|0)+"px",node},drawText:function(featureId,style,location){var label=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX,"olv:rect"),textbox=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),resolution=this.getResolution();label.style.left=((location.x-this.featureDx)/resolution-this.offset.x|0)+"px",label.style.top=(location.y/resolution-this.offset.y|0)+"px",label.style.flip="y",textbox.innerText=style.label,"inherit"!=style.cursor&&null!=style.cursor&&(textbox.style.cursor=style.cursor),style.fontColor&&(textbox.style.color=style.fontColor),style.fontOpacity&&(textbox.style.filter="alpha(opacity="+100*style.fontOpacity+")"),style.fontFamily&&(textbox.style.fontFamily=style.fontFamily),style.fontSize&&(textbox.style.fontSize=style.fontSize),style.fontWeight&&(textbox.style.fontWeight=style.fontWeight),style.fontStyle&&(textbox.style.fontStyle=style.fontStyle),style.labelSelect===!0&&(label._featureId=featureId,textbox._featureId=featureId,textbox._geometry=location,textbox._geometryClass=location.CLASS_NAME),textbox.style.whiteSpace="nowrap",textbox.inset="1px,0px,0px,0px",label.parentNode||(label.appendChild(textbox),this.textRoot.appendChild(label));var align=style.labelAlign||"cm";1==align.length&&(align+="m");var xshift=textbox.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[align.substr(0,1)],yshift=textbox.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[align.substr(1,1)];label.style.left=parseInt(label.style.left)-xshift-1+"px",label.style.top=parseInt(label.style.top)+yshift+"px"},moveRoot:function(renderer){var layer=this.map.getLayer(renderer.container.id);layer instanceof OpenLayers.Layer.Vector.RootContainer&&(layer=this.map.getLayer(this.container.id)),layer&&layer.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),layer&&layer.redraw()},importSymbol:function(graphicName){var id=this.container.id+"-"+graphicName,cache=this.symbolCache[id];if(cache)return cache;var symbol=OpenLayers.Renderer.symbol[graphicName];if(!symbol)throw new Error(graphicName+" is not a valid symbol name");for(var symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),pathitems=["m"],i=0;i<symbol.length;i+=2){var x=symbol[i],y=symbol[i+1];symbolExtent.left=Math.min(symbolExtent.left,x),symbolExtent.bottom=Math.min(symbolExtent.bottom,y),symbolExtent.right=Math.max(symbolExtent.right,x),symbolExtent.top=Math.max(symbolExtent.top,y),pathitems.push(x),pathitems.push(y),0==i&&pathitems.push("l")}pathitems.push("x e");var path=pathitems.join(" "),diff=(symbolExtent.getWidth()-symbolExtent.getHeight())/2;return diff>0?(symbolExtent.bottom=symbolExtent.bottom-diff,symbolExtent.top=symbolExtent.top+diff):(symbolExtent.left=symbolExtent.left+diff,symbolExtent.right=symbolExtent.right-diff),cache={path:path,size:symbolExtent.getWidth(),left:symbolExtent.left,bottom:symbolExtent.bottom},this.symbolCache[id]=cache,cache},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);var i,layers=this.layers||map.layers;for(i=layers.length-1;i>=0;--i)this.addLayer({layer:layers[i]});this.layers||map.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(evt){evt.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(evt){evt.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(evt){if(this.active&&window.localStorage&&evt.tile instanceof OpenLayers.Tile.Image){var tile=evt.tile,url=tile.url;!tile.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&0===url.indexOf(OpenLayers.ProxyHost)&&(url=OpenLayers.Control.CacheWrite.urlMap[url]);var dataURI=window.localStorage.getItem("olCache_"+url);dataURI&&(tile.url=dataURI,"tileerror"===evt.type&&tile.setImgSrc(dataURI))}},destroy:function(){if(this.layers||this.map){var i,layers=this.layers||this.map.layers;for(i=layers.length-1;i>=0;--i)this.removeLayer({layer:layers[i]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(data){var result;"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data]));var root=data.documentElement;if(root){var read=this["read_"+root.nodeName];result=read?read.call(this,root):new OpenLayers.Format.GML(this.options?this.options:{}).read(data)}else result=data;return result},read_msGMLOutput:function(data){var response=[],layerNodes=this.getSiblingNodesByTagCriteria(data,this.layerIdentifier);if(layerNodes)for(var i=0,len=layerNodes.length;len>i;++i){var node=layerNodes[i],layerName=node.nodeName;node.prefix&&(layerName=layerName.split(":")[1]);var layerName=layerName.replace(this.layerIdentifier,""),featureNodes=this.getSiblingNodesByTagCriteria(node,this.featureIdentifier);if(featureNodes)for(var j=0;j<featureNodes.length;j++){var featureNode=featureNodes[j],geomInfo=this.parseGeometry(featureNode),attributes=this.parseAttributes(featureNode),feature=new OpenLayers.Feature.Vector(geomInfo.geometry,attributes,null);feature.bounds=geomInfo.bounds,feature.type=layerName,response.push(feature)}}return response},read_FeatureInfoResponse:function(data){for(var response=[],featureNodes=this.getElementsByTagNameNS(data,"*","FIELDS"),i=0,len=featureNodes.length;len>i;i++){var j,featureNode=featureNodes[i],geom=null,attributes={},jlen=featureNode.attributes.length;if(jlen>0)for(j=0;jlen>j;j++){var attribute=featureNode.attributes[j];attributes[attribute.nodeName]=attribute.nodeValue}else{var nodes=featureNode.childNodes;for(j=0,jlen=nodes.length;jlen>j;++j){var node=nodes[j];3!=node.nodeType&&(attributes[node.getAttribute("name")]=node.getAttribute("value"))}}response.push(new OpenLayers.Feature.Vector(geom,attributes,null))}return response},getSiblingNodesByTagCriteria:function(node,criteria){var children,tagName,n,matchNodes,child,nodes=[];if(node&&node.hasChildNodes()){children=node.childNodes,n=children.length;for(var k=0;n>k;k++){for(child=children[k];child&&1!=child.nodeType;)child=child.nextSibling,k++;tagName=child?child.nodeName:"",tagName.length>0&&tagName.indexOf(criteria)>-1?nodes.push(child):(matchNodes=this.getSiblingNodesByTagCriteria(child,criteria),matchNodes.length>0&&(0==nodes.length?nodes=matchNodes:nodes.push(matchNodes)))}}return nodes},parseAttributes:function(node){var attributes={};if(1==node.nodeType)for(var children=node.childNodes,n=children.length,i=0;n>i;++i){var child=children[i];if(1==child.nodeType){var grandchildren=child.childNodes,name=child.prefix?child.nodeName.split(":")[1]:child.nodeName;if(0==grandchildren.length)attributes[name]=null;else if(1==grandchildren.length){var grandchild=grandchildren[0];if(3==grandchild.nodeType||4==grandchild.nodeType){var value=grandchild.nodeValue.replace(this.regExes.trimSpace,"");attributes[name]=value}}}}return attributes},parseGeometry:function(node){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var geometry,feature=this.gmlFormat.parseFeature(node),bounds=null;return feature&&(geometry=feature.geometry&&feature.geometry.clone(),bounds=feature.bounds&&feature.bounds.clone(),feature.destroy()),{geometry:geometry,bounds:bounds}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(options){if(options=options||{},options.handlerOptions=options.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[options]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(options.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var callbacks={};callbacks[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,callbacks,this.handlerOptions.click||{})}},getInfoForClick:function(evt){this.request(evt.xy,{})},getInfoForHover:function(evt){this.request(evt.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var layer,candidates=this.layers||this.map.layers,layers=[],i=candidates.length-1;i>=0&&(layer=candidates[i],!(layer instanceof OpenLayers.Layer.WMTS&&layer.requestEncoding===this.requestEncoding)||this.queryVisible&&!layer.getVisibility()||(layers.push(layer),this.drillDown&&!this.hover));--i);return layers},buildRequestOptions:function(layer,xy){var loc=this.map.getLonLatFromPixel(xy),getTileUrl=layer.getURL(new OpenLayers.Bounds(loc.lon,loc.lat,loc.lon,loc.lat)),params=OpenLayers.Util.getParameters(getTileUrl),tileInfo=layer.getTileInfo(loc);return OpenLayers.Util.extend(params,{service:"WMTS",version:layer.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:tileInfo.i,j:tileInfo.j}),OpenLayers.Util.applyDefaults(params,this.vendorParams),{url:OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url,params:OpenLayers.Util.upperCaseObject(params),callback:function(request){this.handleResponse(xy,request,layer)},scope:this}},request:function(xy,options){options=options||{};var layers=this.findLayers();if(layers.length>0){for(var issue,layer,i=0,len=layers.length;len>i;i++)if(layer=layers[i],issue=this.events.triggerEvent("beforegetfeatureinfo",{xy:xy,layer:layer}),issue!==!1){++this.pending;var requestOptions=this.buildRequestOptions(layer,xy),request=OpenLayers.Request.GET(requestOptions);options.hover===!0&&(this.hoverRequest=request)}this.pending>0&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(xy,request,layer){if(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),request.status&&(request.status<200||request.status>=300))this.events.triggerEvent("exception",{xy:xy,request:request,layer:layer});else{var doc=request.responseXML;doc&&doc.documentElement||(doc=request.responseText);var features,except;try{features=this.format.read(doc)}catch(error){except=!0,this.events.triggerEvent("exception",{xy:xy,request:request,error:error,layer:layer})}except||this.events.triggerEvent("getfeatureinfo",{
text:request.responseText,features:features,request:request,xy:xy,layer:layer})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"}),OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]),options.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(options){options=OpenLayers.Util.extend({},options),OpenLayers.Util.applyDefaults(options,this.options||{});var response=new OpenLayers.Protocol.Response({requestType:"read"}),data=this.format.write(options.params||options);return response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),params:options.params,headers:options.headers,data:data}),response},handleRead:function(response,options){if(options.callback){var request=response.priv;request.status>=200&&request.status<300?(response.data=this.parseData(request),response.code=OpenLayers.Protocol.Response.SUCCESS):response.code=OpenLayers.Protocol.Response.FAILURE,options.callback.call(options.scope,response)}},parseData:function(request){var doc=request.responseXML;return doc&&doc.documentElement||(doc=request.responseText),!doc||doc.length<=0?null:this.format.read(doc)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"}),OpenLayers.Format.WCSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"},errorProperty:"operationsMetadata",readers:{wcs:OpenLayers.Util.applyDefaults({Capabilities:function(node,obj){this.readChildNodes(node,obj)},Contents:function(node,request){request.contentMetadata=[],this.readChildNodes(node,request.contentMetadata)},CoverageSummary:function(node,contentMetadata){var coverageSummary={};this.readChildNodes(node,coverageSummary),contentMetadata.push(coverageSummary)},Identifier:function(node,coverageSummary){coverageSummary.identifier=this.getChildValue(node)},Title:function(node,coverageSummary){coverageSummary.title=this.getChildValue(node)},Abstract:function(node,coverageSummary){coverageSummary["abstract"]=this.getChildValue(node)},SupportedCRS:function(node,coverageSummary){var crs=this.getChildValue(node);crs&&(coverageSummary.supportedCRS||(coverageSummary.supportedCRS=[]),coverageSummary.supportedCRS.push(crs))},SupportedFormat:function(node,coverageSummary){var format=this.getChildValue(node);format&&(coverageSummary.supportedFormat||(coverageSummary.supportedFormat=[]),coverageSummary.supportedFormat.push(format))}},OpenLayers.Format.WCSCapabilities.v1.prototype.readers.wcs),ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_1_0"}),OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:.5},labelSymbolizer:{},gratLayer:null,initialize:function(options){options=options||{},options.layerName=options.layerName||OpenLayers.i18n("Graticule"),OpenLayers.Control.prototype.initialize.apply(this,[options]),this.labelSymbolizer.stroke=!1,this.labelSymbolizer.fill=!1,this.labelSymbolizer.label="${label}",this.labelSymbolizer.labelAlign="${labelAlign}",this.labelSymbolizer.labelXOffset="${xOffset}",this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.gratLayer){var gratStyle=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":gratStyle}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var mapBounds=this.map.getExtent();if(mapBounds){this.gratLayer.destroyFeatures();var llProj=new OpenLayers.Projection("EPSG:4326"),mapProj=this.map.getProjectionObject(),mapRes=this.map.getResolution();mapProj.proj&&"longlat"==mapProj.proj.projName&&(this.numPoints=1);var mapCenter=this.map.getCenter(),mapCenterLL=new OpenLayers.Pixel(mapCenter.lon,mapCenter.lat);OpenLayers.Projection.transform(mapCenterLL,mapProj,llProj);var testSq=this.targetSize*mapRes;testSq*=testSq;for(var llInterval,i=0;i<this.intervals.length;++i){llInterval=this.intervals[i];var delta=llInterval/2,p1=mapCenterLL.offset({x:-delta,y:-delta}),p2=mapCenterLL.offset({x:delta,y:delta});OpenLayers.Projection.transform(p1,llProj,mapProj),OpenLayers.Projection.transform(p2,llProj,mapProj);var distSq=(p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y);if(testSq>=distSq)break}mapCenterLL.x=Math.floor(mapCenterLL.x/llInterval)*llInterval,mapCenterLL.y=Math.floor(mapCenterLL.y/llInterval)*llInterval;var mapXY,iter=0,centerLonPoints=[mapCenterLL.clone()],newPoint=mapCenterLL.clone();do newPoint=newPoint.offset({x:0,y:llInterval}),mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj),centerLonPoints.unshift(newPoint);while(mapBounds.containsPixel(mapXY)&&++iter<1e3);newPoint=mapCenterLL.clone();do newPoint=newPoint.offset({x:0,y:-llInterval}),mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj),centerLonPoints.push(newPoint);while(mapBounds.containsPixel(mapXY)&&++iter<1e3);iter=0;var centerLatPoints=[mapCenterLL.clone()];newPoint=mapCenterLL.clone();do newPoint=newPoint.offset({x:-llInterval,y:0}),mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj),centerLatPoints.unshift(newPoint);while(mapBounds.containsPixel(mapXY)&&++iter<1e3);newPoint=mapCenterLL.clone();do newPoint=newPoint.offset({x:llInterval,y:0}),mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj),centerLatPoints.push(newPoint);while(mapBounds.containsPixel(mapXY)&&++iter<1e3);for(var lines=[],i=0;i<centerLatPoints.length;++i){for(var lon=centerLatPoints[i].x,pointList=[],labelPoint=null,latEnd=Math.min(centerLonPoints[0].y,90),latStart=Math.max(centerLonPoints[centerLonPoints.length-1].y,-90),latDelta=(latEnd-latStart)/this.numPoints,lat=latStart,j=0;j<=this.numPoints;++j){var gridPoint=new OpenLayers.Geometry.Point(lon,lat);gridPoint.transform(llProj,mapProj),pointList.push(gridPoint),lat+=latDelta,gridPoint.y>=mapBounds.bottom&&!labelPoint&&(labelPoint=gridPoint)}if(this.labelled){var labelPos=new OpenLayers.Geometry.Point(labelPoint.x,mapBounds.bottom),labelAttrs={value:lon,label:this.labelled?OpenLayers.Util.getFormattedLonLat(lon,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(labelPos,labelAttrs))}var geom=new OpenLayers.Geometry.LineString(pointList);lines.push(new OpenLayers.Feature.Vector(geom))}for(var j=0;j<centerLonPoints.length;++j)if(lat=centerLonPoints[j].y,!(-90>lat||lat>90)){for(var pointList=[],lonStart=centerLatPoints[0].x,lonEnd=centerLatPoints[centerLatPoints.length-1].x,lonDelta=(lonEnd-lonStart)/this.numPoints,lon=lonStart,labelPoint=null,i=0;i<=this.numPoints;++i){var gridPoint=new OpenLayers.Geometry.Point(lon,lat);gridPoint.transform(llProj,mapProj),pointList.push(gridPoint),lon+=lonDelta,gridPoint.x<mapBounds.right&&(labelPoint=gridPoint)}if(this.labelled){var labelPos=new OpenLayers.Geometry.Point(mapBounds.right,labelPoint.y),labelAttrs={value:lat,label:this.labelled?OpenLayers.Util.getFormattedLonLat(lat,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(labelPos,labelAttrs))}var geom=new OpenLayers.Geometry.LineString(pointList);lines.push(new OpenLayers.Feature.Vector(geom))}this.gratLayer.addFeatures(lines)}},CLASS_NAME:"OpenLayers.Control.Graticule"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Corner={round:function(e,options){e=OpenLayers.Util.getElement(e),this._setOptions(options);var color=this.options.color;"fromElement"==this.options.color&&(color=this._background(e));var bgColor=this.options.bgColor;"fromParent"==this.options.bgColor&&(bgColor=this._background(e.offsetParent)),this._roundCornersImpl(e,color,bgColor)},changeColor:function(theDiv,newColor){theDiv.style.backgroundColor=newColor;for(var spanElements=theDiv.parentNode.getElementsByTagName("span"),currIdx=0;currIdx<spanElements.length;currIdx++)spanElements[currIdx].style.backgroundColor=newColor},changeOpacity:function(theDiv,newOpacity){var mozillaOpacity=newOpacity,ieOpacity="alpha(opacity="+100*newOpacity+")";theDiv.style.opacity=mozillaOpacity,theDiv.style.filter=ieOpacity;for(var spanElements=theDiv.parentNode.getElementsByTagName("span"),currIdx=0;currIdx<spanElements.length;currIdx++)spanElements[currIdx].style.opacity=mozillaOpacity,spanElements[currIdx].style.filter=ieOpacity},reRound:function(theDiv,options){var topRico=theDiv.parentNode.childNodes[0],bottomRico=theDiv.parentNode.childNodes[2];theDiv.parentNode.removeChild(topRico),theDiv.parentNode.removeChild(bottomRico),this.round(theDiv.parentNode,options)},_roundCornersImpl:function(e,color,bgColor){this.options.border&&this._renderBorder(e,bgColor),this._isTopRounded()&&this._roundTopCorners(e,color,bgColor),this._isBottomRounded()&&this._roundBottomCorners(e,color,bgColor)},_renderBorder:function(el,bgColor){var borderValue="1px solid "+this._borderColor(bgColor),borderL="border-left: "+borderValue,borderR="border-right: "+borderValue,style="style='"+borderL+";"+borderR+"'";el.innerHTML="<div "+style+">"+el.innerHTML+"</div>"},_roundTopCorners:function(el,color,bgColor){for(var corner=this._createCorner(bgColor),i=0;i<this.options.numSlices;i++)corner.appendChild(this._createCornerSlice(color,bgColor,i,"top"));el.style.paddingTop=0,el.insertBefore(corner,el.firstChild)},_roundBottomCorners:function(el,color,bgColor){for(var corner=this._createCorner(bgColor),i=this.options.numSlices-1;i>=0;i--)corner.appendChild(this._createCornerSlice(color,bgColor,i,"bottom"));el.style.paddingBottom=0,el.appendChild(corner)},_createCorner:function(bgColor){var corner=document.createElement("div");return corner.style.backgroundColor=this._isTransparent()?"transparent":bgColor,corner},_createCornerSlice:function(color,bgColor,n,position){var slice=document.createElement("span"),inStyle=slice.style;inStyle.backgroundColor=color,inStyle.display="block",inStyle.height="1px",inStyle.overflow="hidden",inStyle.fontSize="1px";var borderColor=this._borderColor(color,bgColor);return this.options.border&&0==n?(inStyle.borderTopStyle="solid",inStyle.borderTopWidth="1px",inStyle.borderLeftWidth="0px",inStyle.borderRightWidth="0px",inStyle.borderBottomWidth="0px",inStyle.height="0px",inStyle.borderColor=borderColor):borderColor&&(inStyle.borderColor=borderColor,inStyle.borderStyle="solid",inStyle.borderWidth="0px 1px"),this.options.compact||n!=this.options.numSlices-1||(inStyle.height="2px"),this._setMargin(slice,n,position),this._setBorder(slice,n,position),slice},_setOptions:function(options){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1},OpenLayers.Util.extend(this.options,options||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(color,bgColor){return"transparent"==color?bgColor:this.options.border?this.options.border:this.options.blend?this._blend(bgColor,color):""},_setMargin:function(el,n,corners){var marginSize=this._marginSize(n),whichSide="top"==corners?this._whichSideTop():this._whichSideBottom();"left"==whichSide?(el.style.marginLeft=marginSize+"px",el.style.marginRight="0px"):"right"==whichSide?(el.style.marginRight=marginSize+"px",el.style.marginLeft="0px"):(el.style.marginLeft=marginSize+"px",el.style.marginRight=marginSize+"px")},_setBorder:function(el,n,corners){var borderSize=this._borderSize(n),whichSide="top"==corners?this._whichSideTop():this._whichSideBottom();"left"==whichSide?(el.style.borderLeftWidth=borderSize+"px",el.style.borderRightWidth="0px"):"right"==whichSide?(el.style.borderRightWidth=borderSize+"px",el.style.borderLeftWidth="0px"):(el.style.borderLeftWidth=borderSize+"px",el.style.borderRightWidth=borderSize+"px"),0!=this.options.border&&(el.style.borderLeftWidth=borderSize+"px",el.style.borderRightWidth=borderSize+"px")},_marginSize:function(n){if(this._isTransparent())return 0;var marginSizes=[5,3,2,1],blendedMarginSizes=[3,2,1,0],compactMarginSizes=[2,1],smBlendedMarginSizes=[1,0];return this.options.compact&&this.options.blend?smBlendedMarginSizes[n]:this.options.compact?compactMarginSizes[n]:this.options.blend?blendedMarginSizes[n]:marginSizes[n]},_borderSize:function(n){var transparentBorderSizes=[5,3,2,1],blendedBorderSizes=[2,1,1,1],compactBorderSizes=[1,0],actualBorderSizes=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?compactBorderSizes[n]:this.options.blend?blendedBorderSizes[n]:this.options.border?actualBorderSizes[n]:this._isTransparent()?transparentBorderSizes[n]:0},_hasString:function(str){for(var i=1;i<arguments.length;i++)if(str.indexOf(arguments[i])>=0)return!0;return!1},_blend:function(c1,c2){var cc1=OpenLayers.Rico.Color.createFromHex(c1);return cc1.blend(OpenLayers.Rico.Color.createFromHex(c2)),cc1},_background:function(el){try{return OpenLayers.Rico.Color.createColorFromBackground(el).asHex()}catch(err){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(el){return 1==el.childNodes.length&&3==el.childNodes[0].nodeType}},OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var previousOptions={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(previousOptions,this.previousOptions),this.previous=new OpenLayers.Control.Button(previousOptions);var nextOptions={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(nextOptions,this.nextOptions),this.next=new OpenLayers.Control.Button(nextOptions),this.clear()},onPreviousChange:function(state,length){state&&!this.previous.active?this.previous.activate():!state&&this.previous.active&&this.previous.deactivate()},onNextChange:function(state,length){state&&!this.next.active?this.next.activate():!state&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var prop in this)this[prop]=null},setMap:function(map){this.map=map,this.next.setMap(map),this.previous.setMap(map)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var current=this.previousStack.shift(),state=this.previousStack.shift();return void 0!=state?(this.nextStack.unshift(current),this.previousStack.unshift(state),this.restoring=!0,this.restore(state),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(current),state},nextTrigger:function(){var state=this.nextStack.shift();return void 0!=state&&(this.previousStack.unshift(state),this.restoring=!0,this.restore(state),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),state},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(state){var center,zoom;if(this.map.getProjectionObject()==state.projection)zoom=this.map.getZoomForResolution(state.resolution),center=state.center;else{center=state.center.clone(),center.transform(state.projection,this.map.getProjectionObject());var sourceUnits=state.units,targetUnits=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,resolutionFactor=sourceUnits&&targetUnits?OpenLayers.INCHES_PER_UNIT[sourceUnits]/OpenLayers.INCHES_PER_UNIT[targetUnits]:1;zoom=this.map.getZoomForResolution(resolutionFactor*state.resolution)}this.map.setCenter(center,zoom)},setListeners:function(){this.listeners={};for(var type in this.registry)this.listeners[type]=OpenLayers.Function.bind(function(){if(!this.restoring){var state=this.registry[type].apply(this,arguments);this.previousStack.unshift(state),this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var activated=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var type in this.listeners)this.map.events.register(type,this,this.listeners[type]);activated=!0,0==this.previousStack.length&&this.initStack()}return activated},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var deactivated=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var type in this.listeners)this.map.events.unregister(type,this,this.listeners[type]);this.clearOnDeactivate&&this.clear(),deactivated=!0}return deactivated},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[options.name,options.url,{},options]),this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},createBackBuffer:function(){},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.UTFGrid(this.getOptions())),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getFeatureInfo:function(location){var info=null,tileInfo=this.getTileData(location);return tileInfo&&tileInfo.tile&&(info=tileInfo.tile.getFeatureInfo(tileInfo.i,tileInfo.j)),info},getFeatureId:function(location){var id=null,info=this.getTileData(location);return info.tile&&(id=info.tile.getFeatureId(info.i,info.j)),id},CLASS_NAME:"OpenLayers.Layer.UTFGrid"}),OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(options){OpenLayers.Util.extend(this,options),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(map){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(map),this.tileQueue[map.id]=[];for(var i=0,ii=map.layers.length;ii>i;++i)this.addLayer({layer:map.layers[i]});map.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(map){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[map.id]),map.layers)for(var i=0,ii=map.layers.length;ii>i;++i)this.removeLayer({layer:map.layers[i]});map.events&&map.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[map.id],delete this.tileQueueId[map.id],OpenLayers.Util.removeItem(this.maps,map)}},move:function(evt){this.updateTimeout(evt.object,this.moveDelay,!0)},zoomEnd:function(evt){this.updateTimeout(evt.object,this.zoomDelay)},changeLayer:function(evt){("visibility"===evt.property||"params"===evt.property)&&this.updateTimeout(evt.object,0)},addLayer:function(evt){var layer=evt.layer;if(layer instanceof OpenLayers.Layer.Grid){layer.events.on({addtile:this.addTile,retile:this.clearTileQueue,scope:this});var i,j,tile;for(i=layer.grid.length-1;i>=0;--i)for(j=layer.grid[i].length-1;j>=0;--j)tile=layer.grid[i][j],this.addTile({tile:tile}),tile.url&&!tile.imgDiv&&this.manageTileCache({object:tile})}},removeLayer:function(evt){var layer=evt.layer;if(layer instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:layer}),layer.events&&layer.events.un({addtile:this.addTile,retile:this.clearTileQueue,scope:this}),layer.grid)){var i,j,tile;for(i=layer.grid.length-1;i>=0;--i)for(j=layer.grid[i].length-1;j>=0;--j)tile=layer.grid[i][j],this.unloadTile({object:tile})}},updateTimeout:function(map,delay,nice){window.clearTimeout(this.tileQueueId[map.id]);var tileQueue=this.tileQueue[map.id];(!nice||tileQueue.length)&&(this.tileQueueId[map.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(map),tileQueue.length&&this.updateTimeout(map,this.frameDelay)},this),delay))},addTile:function(evt){evt.tile instanceof OpenLayers.Tile.Image?evt.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:evt.tile.layer})},unloadTile:function(evt){var tile=evt.object;tile.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[tile.layer.map.id],tile)},queueTileDraw:function(evt){var tile=evt.object,queued=!1,layer=tile.layer,url=layer.getURL(tile.bounds),img=this.tileCache[url];if(img&&"olTileImage"!==img.className&&(delete this.tileCache[url],OpenLayers.Util.removeItem(this.tileCacheIndex,url),img=null),layer.url&&(layer.async||!img)){var tileQueue=this.tileQueue[layer.map.id];~OpenLayers.Util.indexOf(tileQueue,tile)||tileQueue.push(tile),queued=!0}return!queued},drawTilesFromQueue:function(map){for(var tileQueue=this.tileQueue[map.id],limit=this.tilesPerFrame,animating=map.zoomTween&&map.zoomTween.playing;!animating&&tileQueue.length&&limit;)tileQueue.shift().draw(!0),--limit},manageTileCache:function(evt){var tile=evt.object,img=this.tileCache[tile.url];img&&(img.parentNode&&OpenLayers.Element.hasClass(img.parentNode,"olBackBuffer")&&(img.parentNode.removeChild(img),img.id=null),img.parentNode||(img.style.visibility="hidden",img.style.opacity=0,tile.setImage(img),OpenLayers.Util.removeItem(this.tileCacheIndex,tile.url),this.tileCacheIndex.push(tile.url)))},addToCache:function(evt){var tile=evt.object;this.tileCache[tile.url]||OpenLayers.Element.hasClass(tile.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[tile.url]=tile.imgDiv,this.tileCacheIndex.push(tile.url))},clearTileQueue:function(evt){for(var layer=evt.object,tileQueue=this.tileQueue[layer.map.id],i=tileQueue.length-1;i>=0;--i)tileQueue[i].layer===layer&&tileQueue.splice(i,1)},destroy:function(){for(var i=this.maps.length-1;i>=0;--i)this.removeMap(this.maps[i]);this.maps=null,this.tileQueue=null,this.tileQueueId=null,this.tileCache=null,this.tileCacheIndex=null,this._destroyed=!0}}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(name,url,options){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var info=this.layerInfo,startingTileExtent=new OpenLayers.Bounds(info.fullExtent.xmin,info.fullExtent.ymin,info.fullExtent.xmax,info.fullExtent.ymax);if(this.projection="EPSG:"+info.spatialReference.wkid,this.sphericalMercator=102100==info.spatialReference.wkid,this.units="esriFeet"==info.units?"ft":"m",info.tileInfo){this.tileSize=new OpenLayers.Size(info.tileInfo.width||info.tileInfo.cols,info.tileInfo.height||info.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(info.tileInfo.origin.x,info.tileInfo.origin.y);var upperLeft=new OpenLayers.Geometry.Point(startingTileExtent.left,startingTileExtent.top),bottomRight=new OpenLayers.Geometry.Point(startingTileExtent.right,startingTileExtent.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var key in info.tileInfo.lods)if(info.tileInfo.lods.hasOwnProperty(key)){var lod=info.tileInfo.lods[key];this.useScales?this.scales.push(lod.scale):this.resolutions.push(lod.resolution);var start=this.getContainingTileCoords(upperLeft,lod.resolution);lod.startTileCol=start.x,lod.startTileRow=start.y;var end=this.getContainingTileCoords(bottomRight,lod.resolution);lod.endTileCol=end.x,lod.endTileRow=end.y,this.lods.push(lod)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&info.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=info.tileInfo.dpi)}}},getContainingTileCoords:function(point,res){return new OpenLayers.Pixel(Math.max(Math.floor((point.x-this.tileOrigin.lon)/(this.tileSize.w*res)),0),Math.max(Math.floor((this.tileOrigin.lat-point.y)/(this.tileSize.h*res)),0))},calculateMaxExtentWithLOD:function(lod){var numTileCols=lod.endTileCol-lod.startTileCol+1,numTileRows=lod.endTileRow-lod.startTileRow+1,minX=this.tileOrigin.lon+lod.startTileCol*this.tileSize.w*lod.resolution,maxX=minX+numTileCols*this.tileSize.w*lod.resolution,maxY=this.tileOrigin.lat-lod.startTileRow*this.tileSize.h*lod.resolution,minY=maxY-numTileRows*this.tileSize.h*lod.resolution;return new OpenLayers.Bounds(minX,minY,maxX,maxY)},calculateMaxExtentWithExtent:function(extent,res){var upperLeft=new OpenLayers.Geometry.Point(extent.left,extent.top),bottomRight=new OpenLayers.Geometry.Point(extent.right,extent.bottom),start=this.getContainingTileCoords(upperLeft,res),end=this.getContainingTileCoords(bottomRight,res),lod={resolution:res,startTileCol:start.x,startTileRow:start.y,endTileCol:end.x,endTileRow:end.y};return this.calculateMaxExtentWithLOD(lod)},getUpperLeftTileCoord:function(res){var upperLeft=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(upperLeft,res)},getLowerRightTileCoord:function(res){var bottomRight=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(bottomRight,res)},getMaxExtentForResolution:function(res){var start=this.getUpperLeftTileCoord(res),end=this.getLowerRightTileCoord(res),numTileCols=end.x-start.x+1,numTileRows=end.y-start.y+1,minX=this.tileOrigin.lon+start.x*this.tileSize.w*res,maxX=minX+numTileCols*this.tileSize.w*res,maxY=this.tileOrigin.lat-start.y*this.tileSize.h*res,minY=maxY-numTileRows*this.tileSize.h*res;return new OpenLayers.Bounds(minX,minY,maxX,maxY)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj])},initGriddedTiles:function(bounds){delete this._tileOrigin,OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var resolution=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(resolution)},getTileOrigin:function(){if(!this._tileOrigin){var extent=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(extent.left,extent.bottom)}return this._tileOrigin},getURL:function(bounds){var res=this.getResolution(),originTileX=this.tileOrigin.lon+res*this.tileSize.w/2,originTileY=this.tileOrigin.lat-res*this.tileSize.h/2,center=bounds.getCenterLonLat(),x=({x:center.lon,y:center.lat},Math.round(Math.abs((center.lon-originTileX)/(res*this.tileSize.w)))),y=Math.round(Math.abs((originTileY-center.lat)/(res*this.tileSize.h))),z=this.map.getZoom();if(this.lods){var lod=this.lods[this.map.getZoom()];if(x<lod.startTileCol||x>lod.endTileCol||y<lod.startTileRow||y>lod.endTileRow)return null}else{var start=this.getUpperLeftTileCoord(res),end=this.getLowerRightTileCoord(res);if(x<start.x||x>=end.x||y<start.y||y>=end.y)return null}var url=this.url,s=""+x+y+z;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(s,url)),this.useArcGISServer?url+="/tile/${z}/${y}/${x}":(x="C"+OpenLayers.Number.zeroPad(x,8,16),y="R"+OpenLayers.Number.zeroPad(y,8,16),z="L"+OpenLayers.Number.zeroPad(z,2,10),url=url+"/${z}/${y}/${x}."+this.type),url=OpenLayers.String.format(url,{x:x,y:y,z:z}),OpenLayers.Util.urlAppend(url,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(options){if(options=options||{},options.handlerOptions=options.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[options]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(options.formatOptions)),this.drillDown===!0&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var callbacks={};callbacks[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,callbacks,this.handlerOptions.click||{})}},getInfoForClick:function(evt){this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(evt.xy,{})},getInfoForHover:function(evt){
this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy}),this.request(evt.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var layer,url,candidates=this.layers||this.map.layers,layers=[],i=candidates.length-1;i>=0;--i)layer=candidates[i],layer instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||layer.getVisibility())&&(url=OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url,this.drillDown!==!1||this.url||(this.url=url),(this.drillDown===!0||this.urlMatches(url))&&layers.push(layer));return layers},urlMatches:function(url){var matches=OpenLayers.Util.isEquivalentUrl(this.url,url);if(!matches&&this.layerUrls)for(var i=0,len=this.layerUrls.length;len>i;++i)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],url)){matches=!0;break}return matches},buildWMSOptions:function(url,layers,clickPosition,format){for(var layerNames=[],styleNames=[],i=0,len=layers.length;len>i;i++)null!=layers[i].params.LAYERS&&(layerNames=layerNames.concat(layers[i].params.LAYERS),styleNames=styleNames.concat(this.getStyleNames(layers[i])));var firstLayer=layers[0],projection=this.map.getProjection(),layerProj=firstLayer.projection;layerProj&&layerProj.equals(this.map.getProjectionObject())&&(projection=layerProj.getCode());var params=OpenLayers.Util.extend({service:"WMS",version:firstLayer.params.VERSION,request:"GetFeatureInfo",exceptions:firstLayer.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,firstLayer.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:format,info_format:firstLayer.params.INFO_FORMAT||this.infoFormat},parseFloat(firstLayer.params.VERSION)>=1.3?{crs:projection,i:parseInt(clickPosition.x),j:parseInt(clickPosition.y)}:{srs:projection,x:parseInt(clickPosition.x),y:parseInt(clickPosition.y)});return 0!=layerNames.length&&(params=OpenLayers.Util.extend({layers:layerNames,query_layers:layerNames,styles:styleNames},params)),OpenLayers.Util.applyDefaults(params,this.vendorParams),{url:url,params:OpenLayers.Util.upperCaseObject(params),callback:function(request){this.handleResponse(clickPosition,request,url)},scope:this}},getStyleNames:function(layer){var styleNames;return styleNames=layer.params.STYLES?layer.params.STYLES:OpenLayers.Util.isArray(layer.params.LAYERS)?new Array(layer.params.LAYERS.length):layer.params.LAYERS.replace(/[^,]/g,"")},request:function(clickPosition,options){var layers=this.findLayers();if(0==layers.length)return this.events.triggerEvent("nogetfeatureinfo"),void OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");if(options=options||{},this.drillDown===!1){var wmsOptions=this.buildWMSOptions(this.url,layers,clickPosition,layers[0].params.FORMAT),request=OpenLayers.Request.GET(wmsOptions);options.hover===!0&&(this.hoverRequest=request)}else{this._requestCount=0,this._numRequests=0,this.features=[];for(var url,services={},i=0,len=layers.length;len>i;i++){var layer=layers[i];url=OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url,url in services?services[url].push(layer):(this._numRequests++,services[url]=[layer])}var layers;for(var url in services){layers=services[url];var wmsOptions=this.buildWMSOptions(url,layers,clickPosition,layers[0].params.FORMAT);OpenLayers.Request.GET(wmsOptions)}}},triggerGetFeatureInfo:function(request,xy,features){this.events.triggerEvent("getfeatureinfo",{text:request.responseText,features:features,request:request,xy:xy}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(xy,request,url){var doc=request.responseXML;doc&&doc.documentElement||(doc=request.responseText);var features=this.format.read(doc);this.drillDown===!1?this.triggerGetFeatureInfo(request,xy,features):(this._requestCount++,"object"===this.output?this._features=(this._features||[]).concat({url:url,features:features}):this._features=(this._features||[]).concat(features),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(request,xy,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"}),OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var info={features:[]};this.readNode(data,info);for(var features=[],i=0,len=info.features.length;len>i;i++){var container=info.features[i];this.internalProjection&&this.externalProjection&&container.components[0]&&container.components[0].transform(this.externalProjection,this.internalProjection);var feature=new OpenLayers.Feature.Vector(container.components[0],container.attributes);features.push(feature)}return features},readers:{sa:{SamplingPoint:function(node,obj){if(!obj.attributes){var feature={attributes:{}};obj.features.push(feature),obj=feature}obj.attributes.id=this.getAttributeNS(node,this.namespaces.gml,"id"),this.readChildNodes(node,obj)},position:function(node,obj){this.readChildNodes(node,obj)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(node,obj){this.readChildNodes(node,obj)},featureMember:function(node,obj){var feature={attributes:{}};obj.features.push(feature),this.readChildNodes(node,feature)},name:function(node,obj){obj.attributes.name=this.getChildValue(node)},pos:function(node,obj){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(node.getAttribute("srsName"))),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[node,obj])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(options){for(var node=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),i=0,len=options.fois.length;len>i;i++)this.writeNode("FeatureOfInterestId",{foi:options.fois[i]},node);return node},FeatureOfInterestId:function(options){var node=this.createElementNSPlus("FeatureOfInterestId",{value:options.foi});return node}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"}),OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var info={measurements:[],observations:[]};return this.readNode(data,info),info},write:function(options){var node=this.writeNode("sos:GetObservation",options);return node.setAttribute("xmlns:om",this.namespaces.om),node.setAttribute("xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[node])},readers:{om:{ObservationCollection:function(node,obj){obj.id=this.getAttributeNS(node,this.namespaces.gml,"id"),this.readChildNodes(node,obj)},member:function(node,observationCollection){this.readChildNodes(node,observationCollection)},Measurement:function(node,observationCollection){var measurement={};observationCollection.measurements.push(measurement),this.readChildNodes(node,measurement)},Observation:function(node,observationCollection){var observation={};observationCollection.observations.push(observation),this.readChildNodes(node,observation)},samplingTime:function(node,measurement){var samplingTime={};measurement.samplingTime=samplingTime,this.readChildNodes(node,samplingTime)},observedProperty:function(node,measurement){measurement.observedProperty=this.getAttributeNS(node,this.namespaces.xlink,"href"),this.readChildNodes(node,measurement)},procedure:function(node,measurement){measurement.procedure=this.getAttributeNS(node,this.namespaces.xlink,"href"),this.readChildNodes(node,measurement)},featureOfInterest:function(node,observation){var foi={features:[]};observation.fois=[],observation.fois.push(foi),this.readChildNodes(node,foi);for(var features=[],i=0,len=foi.features.length;len>i;i++){var feature=foi.features[i];features.push(new OpenLayers.Feature.Vector(feature.components[0],feature.attributes))}foi.features=features},result:function(node,measurement){var result={};measurement.result=result,""!==this.getChildValue(node)?(result.value=this.getChildValue(node),result.uom=node.getAttribute("uom")):this.readChildNodes(node,result)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(node,samplingTime){var timeInstant={};samplingTime.timeInstant=timeInstant,this.readChildNodes(node,timeInstant)},timePosition:function(node,timeInstant){timeInstant.timePosition=this.getChildValue(node)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(options){var node=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",options,node),options.eventTime&&this.writeNode("eventTime",options,node);for(var procedure in options.procedures)this.writeNode("procedure",options.procedures[procedure],node);for(var observedProperty in options.observedProperties)this.writeNode("observedProperty",options.observedProperties[observedProperty],node);return options.foi&&this.writeNode("featureOfInterest",options.foi,node),this.writeNode("responseFormat",options,node),options.resultModel&&this.writeNode("resultModel",options,node),options.responseMode&&this.writeNode("responseMode",options,node),node},featureOfInterest:function(foi){var node=this.createElementNSPlus("featureOfInterest");return this.writeNode("ObjectID",foi.objectId,node),node},ObjectID:function(options){return this.createElementNSPlus("ObjectID",{value:options})},responseFormat:function(options){return this.createElementNSPlus("responseFormat",{value:options.responseFormat})},procedure:function(procedure){return this.createElementNSPlus("procedure",{value:procedure})},offering:function(options){return this.createElementNSPlus("offering",{value:options.offering})},observedProperty:function(observedProperty){return this.createElementNSPlus("observedProperty",{value:observedProperty})},eventTime:function(options){var node=this.createElementNSPlus("eventTime");return"latest"===options.eventTime&&this.writeNode("ogc:TM_Equals",options,node),node},resultModel:function(options){return this.createElementNSPlus("resultModel",{value:options.resultModel})},responseMode:function(options){return this.createElementNSPlus("responseMode",{value:options.responseMode})}},ogc:{TM_Equals:function(options){var node=this.createElementNSPlus("ogc:TM_Equals");return this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},node),"latest"===options.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},node),node},PropertyName:function(options){return this.createElementNSPlus("ogc:PropertyName",{value:options.property})}},gml:{TimeInstant:function(options){var node=this.createElementNSPlus("gml:TimeInstant");return this.writeNode("gml:timePosition",options,node),node},timePosition:function(options){var node=this.createElementNSPlus("gml:timePosition",{value:options.value});return node}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"}),OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(hm){this.handlerMode=hm,this.resetHandler()},resetHandler:function(){return this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null),"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)),this.handler?!0:!1},initialize:function(options){options=options||{},options.handlerOptions=options.handlerOptions||this.defaultHandlerOptions,OpenLayers.Control.prototype.initialize.apply(this,[options]),this.resetHandler()},handleEvent:function(evt){if(null==evt)return void this.reset();var lonLat=this.map.getLonLatFromPixel(evt.xy);if(lonLat){var layers=this.findLayers();if(layers.length>0){for(var layer,idx,infoLookup={},i=0,len=layers.length;len>i;i++)layer=layers[i],idx=OpenLayers.Util.indexOf(this.map.layers,layer),infoLookup[idx]=layer.getFeatureInfo(lonLat);this.callback(infoLookup,lonLat,evt.xy)}}},callback:function(infoLookup){},reset:function(evt){this.callback(null)},findLayers:function(){for(var layer,candidates=this.layers||this.map.layers,layers=[],i=candidates.length-1;i>=0;--i)layer=candidates[i],layer instanceof OpenLayers.Layer.UTFGrid&&layers.push(layer);return layers},CLASS_NAME:"OpenLayers.Control.UTFGrid"}),OpenLayers.Format.CQL=function(){function tryToken(text,pattern){return pattern instanceof RegExp?pattern.exec(text):pattern(text)}function nextToken(text,tokens){var i,token,len=tokens.length;for(i=0;len>i;i++){token=tokens[i];var pat=patterns[token],matches=tryToken(text,pat);if(matches){var match=matches[0],remainder=text.substr(match.length).replace(/^\s*/,"");return{type:token,text:match,remainder:remainder}}}var msg="ERROR: In parsing: ["+text+"], expected one of: ";for(i=0;len>i;i++)token=tokens[i],msg+="\n    "+token+": "+patterns[token];throw new Error(msg)}function tokenize(text){var token,results=[],expect=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(token=nextToken(text,expect),text=token.remainder,expect=follows[token.type],"END"!=token.type&&!expect)throw new Error("No follows list for "+token.type);results.push(token)}while("END"!=token.type);return results}function buildAst(tokens){function buildTree(){var tok=postfix.pop();switch(tok.type){case"LOGICAL":var rhs=buildTree(),lhs=buildTree();return new OpenLayers.Filter.Logical({filters:[lhs,rhs],type:logicals[tok.text.toUpperCase()]});case"NOT":var operand=buildTree();return new OpenLayers.Filter.Logical({filters:[operand],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var min,max,property;return postfix.pop(),max=buildTree(),min=buildTree(),property=buildTree(),new OpenLayers.Filter.Comparison({property:property,lowerBoundary:min,upperBoundary:max,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var value=buildTree(),property=buildTree();return new OpenLayers.Filter.Comparison({property:property,value:value,type:operators[tok.text.toUpperCase()]});case"IS_NULL":var property=buildTree();return new OpenLayers.Filter.Comparison({property:property,type:operators[tok.text.toUpperCase()]});case"VALUE":var match=tok.text.match(/^'(.*)'$/);return match?match[1].replace(/''/g,"'"):Number(tok.text);case"SPATIAL":switch(tok.text.toUpperCase()){case"BBOX":var maxy=buildTree(),maxx=buildTree(),miny=buildTree(),minx=buildTree(),prop=buildTree();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:prop,value:OpenLayers.Bounds.fromArray([minx,miny,maxx,maxy])});case"INTERSECTS":var value=buildTree(),property=buildTree();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:property,value:value});case"WITHIN":var value=buildTree(),property=buildTree();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:property,value:value});case"CONTAINS":var value=buildTree(),property=buildTree();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:property,value:value});case"DWITHIN":var distance=buildTree(),value=buildTree(),property=buildTree();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:value,property:property,distance:Number(distance)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(tok.text);default:return tok.text}}for(var operatorStack=[],postfix=[];tokens.length;){var tok=tokens.shift();switch(tok.type){case"PROPERTY":case"GEOMETRY":case"VALUE":postfix.push(tok);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var p=precedence[tok.type];operatorStack.length>0&&precedence[operatorStack[operatorStack.length-1].type]<=p;)postfix.push(operatorStack.pop());operatorStack.push(tok);break;case"SPATIAL":case"NOT":case"LPAREN":operatorStack.push(tok);break;case"RPAREN":for(;operatorStack.length>0&&"LPAREN"!=operatorStack[operatorStack.length-1].type;)postfix.push(operatorStack.pop());operatorStack.pop(),operatorStack.length>0&&"SPATIAL"==operatorStack[operatorStack.length-1].type&&postfix.push(operatorStack.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+tok.type)}}for(;operatorStack.length>0;)postfix.push(operatorStack.pop());var result=buildTree();if(postfix.length>0){for(var msg="Remaining tokens after building AST: \n",i=postfix.length-1;i>=0;i--)msg+=postfix[i].type+": "+postfix[i].text+"\n";throw new Error(msg)}return result}var i,patterns={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(text){var type=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(text);if(type){var len=text.length,idx=text.indexOf("(",type[0].length);if(idx>-1)for(var depth=1;len>idx&&depth>0;)switch(idx++,text.charAt(idx)){case"(":depth++;break;case")":depth--}return[text.substr(0,idx+1)]}},END:/^$/},follows={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},operators={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},operatorReverse={},logicals={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},logicalReverse={},precedence={RPAREN:3,LOGICAL:2,COMPARISON:1};for(i in operators)operators.hasOwnProperty(i)&&(operatorReverse[operators[i]]=i);for(i in logicals)logicals.hasOwnProperty(i)&&(logicalReverse[logicals[i]]=i);return OpenLayers.Class(OpenLayers.Format,{read:function(text){var result=buildAst(tokenize(text));return this.keepData&&(this.data=result),result},write:function(filter){if(filter instanceof OpenLayers.Geometry)return filter.toString();switch(filter.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(filter.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+filter.property+","+filter.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+filter.property+", "+this.write(filter.value)+", "+filter.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+filter.property+", "+this.write(filter.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+filter.property+", "+this.write(filter.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+filter.property+", "+this.write(filter.value)+")";default:throw new Error("Unknown spatial filter type: "+filter.type)}case"OpenLayers.Filter.Logical":if(filter.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(filter.filters[0])+")";for(var res="(",first=!0,i=0;i<filter.filters.length;i++)first?first=!1:res+=") "+logicalReverse[filter.type]+" (",res+=this.write(filter.filters[i]);return res+")";case"OpenLayers.Filter.Comparison":return filter.type==OpenLayers.Filter.Comparison.BETWEEN?filter.property+" BETWEEN "+this.write(filter.lowerBoundary)+" AND "+this.write(filter.upperBoundary):null!==filter.value?filter.property+" "+operatorReverse[filter.type]+" "+this.write(filter.value):filter.property+" "+operatorReverse[filter.type];case void 0:if("string"==typeof filter)return"'"+filter.replace(/'/g,"''")+"'";if("number"==typeof filter)return String(filter);default:throw new Error("Can't encode: "+filter.CLASS_NAME+" "+filter)}},CLASS_NAME:"OpenLayers.Format.CQL"})}(),OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]),this.options=options||{},this.options.source&&this.setSource(this.options.source)},setSource:function(layer){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=layer,this.activate()):this.source=layer},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this);return activated&&(this.source?this.source.events&&this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}):(this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(geometry){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(geometry)})}},{layerOptions:this.sourceOptions})),this.handler.activate())),activated},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this);return deactivated&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}),deactivated},onSketchComplete:function(event){return this.feature=null,!this.considerSplit(event.feature)},afterFeatureModified:function(event){if(event.modified){var feature=event.feature;"function"==typeof feature.geometry.split&&(this.feature=event.feature,this.considerSplit(event.feature))}},removeByGeometry:function(features,geometry){for(var i=0,len=features.length;len>i;++i)if(features[i].geometry===geometry){features.splice(i,1);break}},isEligible:function(target){return target.geometry?target.state!==OpenLayers.State.DELETE&&"function"==typeof target.geometry.split&&this.feature!==target&&(!this.targetFilter||this.targetFilter.evaluate(target.attributes)):!1},considerSplit:function(feature){var sourceSplit=!1,targetSplit=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(feature.attributes)){for(var target,results,proceed,targetFeature,targetParts,source,parts,features=this.layer&&this.layer.features||[],additions=[],removals=[],mutual=this.layer===this.source&&this.mutual,options={edge:this.edge,tolerance:this.tolerance,mutual:mutual},sourceParts=[feature.geometry],i=0,len=features.length;len>i;++i)if(targetFeature=features[i],this.isEligible(targetFeature)){targetParts=[targetFeature.geometry];for(var j=0;j<sourceParts.length;++j){source=sourceParts[j];for(var k=0;k<targetParts.length;++k)target=targetParts[k],source.getBounds().intersectsBounds(target.getBounds())&&(results=source.split(target,options),results&&(proceed=this.events.triggerEvent("beforesplit",{source:feature,target:targetFeature}),proceed!==!1&&(mutual&&(parts=results[0],parts.length>1&&(parts.unshift(j,1),Array.prototype.splice.apply(sourceParts,parts),j+=parts.length-3),results=results[1]),results.length>1&&(results.unshift(k,1),Array.prototype.splice.apply(targetParts,results),k+=results.length-3))))}targetParts&&targetParts.length>1&&(this.geomsToFeatures(targetFeature,targetParts),this.events.triggerEvent("split",{original:targetFeature,features:targetParts}),Array.prototype.push.apply(additions,targetParts),removals.push(targetFeature),targetSplit=!0)}if(sourceParts&&sourceParts.length>1&&(this.geomsToFeatures(feature,sourceParts),this.events.triggerEvent("split",{original:feature,features:sourceParts}),Array.prototype.push.apply(additions,sourceParts),removals.push(feature),sourceSplit=!0),sourceSplit||targetSplit){if(this.deferDelete){for(var feat,destroys=[],i=0,len=removals.length;len>i;++i)feat=removals[i],feat.state===OpenLayers.State.INSERT?destroys.push(feat):(feat.state=OpenLayers.State.DELETE,this.layer.drawFeature(feat));this.layer.destroyFeatures(destroys,{silent:!0});for(var i=0,len=additions.length;len>i;++i)additions[i].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(removals,{silent:!0});this.layer.addFeatures(additions,{silent:!0}),this.events.triggerEvent("aftersplit",{source:feature,features:additions})}}return sourceSplit},geomsToFeatures:function(feature,geoms){var clone=feature.clone();delete clone.geometry;for(var newFeature,i=0,len=geoms.length;len>i;++i)newFeature=clone.clone(),newFeature.geometry=geoms[i],newFeature.state=OpenLayers.State.INSERT,geoms[i]=newFeature},destroy:function(){this.active&&this.deactivate(),OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(config){var required={url:!0,layer:!0,style:!0,matrixSet:!0};for(var prop in required)if(!(prop in config))throw new Error("Missing property '"+prop+"' in layer configuration.");config.params=OpenLayers.Util.upperCaseObject(config.params);var args=[config.name,config.url,config.params,config];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,args),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var len=this.matrixIds.length;if(len&&"string"==typeof this.matrixIds[0]){var ids=this.matrixIds;this.matrixIds=new Array(len);for(var i=0;len>i;++i)this.matrixIds[i]={identifier:ids[i]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(bounds,zoomChanged,dragging){return(zoomChanged||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(obj){return null==obj&&(obj=new OpenLayers.Layer.WMTS(this.options)),obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var matrix;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var delta,denom=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,diff=Number.POSITIVE_INFINITY,i=0,ii=this.matrixIds.length;ii>i;++i)delta=Math.abs(1-this.matrixIds[i].scaleDenominator/denom),diff>delta&&(diff=delta,matrix=this.matrixIds[i]);else matrix=this.matrixIds[this.getIdentifier()];else matrix={identifier:this.getIdentifier()};return matrix},getTileInfo:function(loc){var res=this.getServerResolution(),fx=(loc.lon-this.tileOrigin.lon)/(res*this.tileSize.w),fy=(this.tileOrigin.lat-loc.lat)/(res*this.tileSize.h),col=Math.floor(fx),row=Math.floor(fy);return{col:col,row:row,i:Math.floor((fx-col)*this.tileSize.w),j:Math.floor((fy-row)*this.tileSize.h)}},getURL:function(bounds){bounds=this.adjustBounds(bounds);var url="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(bounds)){var params,center=bounds.getCenterLonLat(),info=this.getTileInfo(center),dimensions=(this.matrix.identifier,this.dimensions);if(url=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,info.row,info.col].join(","),this.url):this.url,"REST"===this.requestEncoding.toUpperCase())if(params=this.params,-1!==url.indexOf("{")){var template=url.replace(/\{/g,"${"),context={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:info.row,TileCol:info.col};if(dimensions){var dimension,i;for(i=dimensions.length-1;i>=0;--i)dimension=dimensions[i],context[dimension]=params[dimension.toUpperCase()]}url=OpenLayers.String.format(template,context)}else{var path=this.version+"/"+this.layer+"/"+this.style+"/";if(dimensions)for(var i=0;i<dimensions.length;i++)params[dimensions[i]]&&(path=path+params[dimensions[i]]+"/");path=path+this.matrixSet+"/"+this.matrix.identifier+"/"+info.row+"/"+info.col+"."+this.formatSuffix,url.match(/\/$/)||(url+="/"),url+=path}else"KVP"===this.requestEncoding.toUpperCase()&&(params={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:info.row,TILECOL:info.col,FORMAT:this.format},url=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[params]))}return url},mergeNewParams:function(newParams){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(newParams)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]),options.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(options){options=OpenLayers.Util.extend({},options),OpenLayers.Util.applyDefaults(options,this.options||{});var response=new OpenLayers.Protocol.Response({requestType:"read"}),format=this.format,data=OpenLayers.Format.XML.prototype.write.apply(format,[format.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);return response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),
data:data}),response},handleRead:function(response,options){if(options.callback){var request=response.priv;request.status>=200&&request.status<300?(response.features=this.parseFeatures(request),response.code=OpenLayers.Protocol.Response.SUCCESS):response.code=OpenLayers.Protocol.Response.FAILURE,options.callback.call(options.scope,response)}},parseFeatures:function(request){var doc=request.responseXML;return doc&&doc.documentElement||(doc=request.responseText),!doc||doc.length<=0?null:this.format.read(doc)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"}),OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(name,url,params,options){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments),this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(bounds){bounds=this.adjustBounds(bounds);var mapRes=this.map.getResolution(),scale=Math.round(1e4*this.map.getScale())/1e4,pX=Math.round(bounds.left/mapRes),pY=-Math.round(bounds.top/mapRes),metaX=Math.floor(pX/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,metaY=Math.floor(pY/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,components=["/",this.params.map,"/",scale,"/",this.params.g.replace(/\s/g,"_"),"/def/t",metaY,"/l",metaX,"/t",pY,"l",pX,".",this.extension],url=this.url;return OpenLayers.Util.isArray(url)&&(url=this.selectUrl(components.join(""),url)),url+components.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"}),OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(options){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"}),OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(node,obj){obj.srs[this.getChildValue(node)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(node,obj){obj.vendorSpecific={tileSets:[]},this.readChildNodes(node,obj.vendorSpecific)},TileSet:function(node,vendorSpecific){var tileset={srs:{},bbox:{},resolutions:[]};this.readChildNodes(node,tileset),vendorSpecific.tileSets.push(tileset)},Resolutions:function(node,tileset){for(var res=this.getChildValue(node).split(" "),i=0,len=res.length;len>i;i++)""!=res[i]&&tileset.resolutions.push(parseFloat(res[i]))},Width:function(node,tileset){tileset.width=parseInt(this.getChildValue(node))},Height:function(node,tileset){tileset.height=parseInt(this.getChildValue(node))},Layers:function(node,tileset){tileset.layers=this.getChildValue(node)},Styles:function(node,tileset){tileset.styles=this.getChildValue(node)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[]},destroy:function(){this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(evt){var button=evt.buttonElement;button===this.minimizeDiv?this.minimizeControl():button===this.maximizeDiv?this.maximizeControl():button._layerSwitcher===this.id&&(button["for"]&&(button=document.getElementById(button["for"])),button.disabled||("radio"==button.type?(button.checked=!0,this.map.setBaseLayer(this.map.getLayer(button._layer))):(button.checked=!button.checked,this.updateMap())))},clearLayersArray:function(layersType){this[layersType+"LayersDiv"].innerHTML="",this[layersType+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var i=0,len=this.layerStates.length;len>i;i++){var layerState=this.layerStates[i],layer=this.map.layers[i];if(layerState.name!=layer.name||layerState.inRange!=layer.inRange||layerState.id!=layer.id||layerState.visibility!=layer.visibility)return!0}return!1},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var containsOverlays=!1,containsBaseLayers=!1,len=this.map.layers.length;this.layerStates=new Array(len);for(var i=0;len>i;i++){var layer=this.map.layers[i];this.layerStates[i]={name:layer.name,visibility:layer.visibility,inRange:layer.inRange,id:layer.id}}var layers=this.map.layers.slice();this.ascending||layers.reverse();for(var i=0,len=layers.length;len>i;i++){var layer=layers[i],baseLayer=layer.isBaseLayer;if(layer.displayInLayerSwitcher){baseLayer?containsBaseLayers=!0:containsOverlays=!0;var checked=baseLayer?layer==this.map.baseLayer:layer.getVisibility(),inputElem=document.createElement("input"),inputId=OpenLayers.Util.createUniqueID(this.id+"_input_");inputElem.id=inputId,inputElem.name=baseLayer?this.id+"_baseLayers":layer.name,inputElem.type=baseLayer?"radio":"checkbox",inputElem.value=layer.name,inputElem.checked=checked,inputElem.defaultChecked=checked,inputElem.className="olButton",inputElem._layer=layer.id,inputElem._layerSwitcher=this.id,baseLayer||layer.inRange||(inputElem.disabled=!0);var labelSpan=document.createElement("label");labelSpan["for"]=inputElem.id,OpenLayers.Element.addClass(labelSpan,"labelSpan olButton"),labelSpan._layer=layer.id,labelSpan._layerSwitcher=this.id,baseLayer||layer.inRange||(labelSpan.style.color="gray"),labelSpan.innerHTML=layer.name,labelSpan.style.verticalAlign=baseLayer?"bottom":"baseline";var br=document.createElement("br"),groupArray=baseLayer?this.baseLayers:this.dataLayers;groupArray.push({layer:layer,inputElem:inputElem,labelSpan:labelSpan});var groupDiv=baseLayer?this.baseLayersDiv:this.dataLayersDiv;groupDiv.appendChild(inputElem),groupDiv.appendChild(labelSpan),groupDiv.appendChild(br)}}return this.dataLbl.style.display=containsOverlays?"":"none",this.baseLbl.style.display=containsBaseLayers?"":"none",this.div},updateMap:function(){for(var i=0,len=this.baseLayers.length;len>i;i++){var layerEntry=this.baseLayers[i];layerEntry.inputElem.checked&&this.map.setBaseLayer(layerEntry.layer,!1)}for(var i=0,len=this.dataLayers.length;len>i;i++){var layerEntry=this.dataLayers[i];layerEntry.layer.setVisibility(layerEntry.inputElem.checked)}},maximizeControl:function(e){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=e&&OpenLayers.Event.stop(e)},showControls:function(minimize){this.maximizeDiv.style.display=minimize?"":"none",this.minimizeDiv.style.display=minimize?"none":"",this.layersDiv.style.display=minimize?"none":""},loadContents:function(){this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv);var img=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,img,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton"),this.maximizeDiv.style.display="none",this.div.appendChild(this.maximizeDiv);var img=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,img,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton"),this.minimizeDiv.style.display="none",this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(doc){return"string"==typeof doc&&(doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc])),this.parseFeatures(doc)},write:function(features){var doc;if(OpenLayers.Util.isArray(features)){doc=this.createElementNSPlus("atom:feed"),doc.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var i=0,ii=features.length;ii>i;i++)doc.appendChild(this.buildEntryNode(features[i]))}else doc=this.buildEntryNode(features);return OpenLayers.Format.XML.prototype.write.apply(this,[doc])},buildContentNode:function(content){var node=this.createElementNSPlus("atom:content",{attributes:{type:content.type||null}});if(content.src)node.setAttribute("src",content.src);else if("text"==content.type||null==content.type)node.appendChild(this.createTextNode(content.value));else if("html"==content.type){if("string"!=typeof content.value)throw"HTML content must be in form of an escaped string";node.appendChild(this.createTextNode(content.value))}else"xhtml"==content.type?node.appendChild(content.value):"xhtml"==content.type||content.type.match(/(\+|\/)xml$/)?node.appendChild(content.value):node.appendChild(this.createTextNode(content.value));return node},buildEntryNode:function(feature){var attrib=feature.attributes,atomAttrib=attrib.atom||{},entryNode=this.createElementNSPlus("atom:entry");if(atomAttrib.authors)for(var authors=OpenLayers.Util.isArray(atomAttrib.authors)?atomAttrib.authors:[atomAttrib.authors],i=0,ii=authors.length;ii>i;i++)entryNode.appendChild(this.buildPersonConstructNode("author",authors[i]));if(atomAttrib.categories)for(var category,categories=OpenLayers.Util.isArray(atomAttrib.categories)?atomAttrib.categories:[atomAttrib.categories],i=0,ii=categories.length;ii>i;i++)category=categories[i],entryNode.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:category.term,scheme:category.scheme||null,label:category.label||null}}));if(atomAttrib.content&&entryNode.appendChild(this.buildContentNode(atomAttrib.content)),atomAttrib.contributors)for(var contributors=OpenLayers.Util.isArray(atomAttrib.contributors)?atomAttrib.contributors:[atomAttrib.contributors],i=0,ii=contributors.length;ii>i;i++)entryNode.appendChild(this.buildPersonConstructNode("contributor",contributors[i]));if(feature.fid&&entryNode.appendChild(this.createElementNSPlus("atom:id",{value:feature.fid})),atomAttrib.links)for(var link,links=OpenLayers.Util.isArray(atomAttrib.links)?atomAttrib.links:[atomAttrib.links],i=0,ii=links.length;ii>i;i++)link=links[i],entryNode.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:link.href,rel:link.rel||null,type:link.type||null,hreflang:link.hreflang||null,title:link.title||null,length:link.length||null}}));if(atomAttrib.published&&entryNode.appendChild(this.createElementNSPlus("atom:published",{value:atomAttrib.published})),atomAttrib.rights&&entryNode.appendChild(this.createElementNSPlus("atom:rights",{value:atomAttrib.rights})),(atomAttrib.summary||attrib.description)&&entryNode.appendChild(this.createElementNSPlus("atom:summary",{value:atomAttrib.summary||attrib.description})),entryNode.appendChild(this.createElementNSPlus("atom:title",{value:atomAttrib.title||attrib.title||this.defaultEntryTitle})),atomAttrib.updated&&entryNode.appendChild(this.createElementNSPlus("atom:updated",{value:atomAttrib.updated})),feature.geometry){var whereNode=this.createElementNSPlus("georss:where");whereNode.appendChild(this.buildGeometryNode(feature.geometry)),entryNode.appendChild(whereNode)}return entryNode},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(geometry){this.gmlParser||this.initGmlParser();var node=this.gmlParser.writeNode("feature:_geometry",geometry);return node.firstChild},buildPersonConstructNode:function(name,value){var oNames=["uri","email"],personNode=this.createElementNSPlus("atom:"+name);personNode.appendChild(this.createElementNSPlus("atom:name",{value:value.name}));for(var i=0,ii=oNames.length;ii>i;i++)value[oNames[i]]&&personNode.appendChild(this.createElementNSPlus("atom:"+oNames[i],{value:value[oNames[i]]}));return personNode},getFirstChildValue:function(node,nsuri,name,def){var value,nodes=this.getElementsByTagNameNS(node,nsuri,name);return value=nodes&&nodes.length>0?this.getChildValue(nodes[0],def):def},parseFeature:function(node){var atomAttrib={},value=null,nodes=null,attval=null,atomns=this.namespaces.atom;this.parsePersonConstructs(node,"author",atomAttrib),nodes=this.getElementsByTagNameNS(node,atomns,"category"),nodes.length>0&&(atomAttrib.categories=[]);for(var i=0,ii=nodes.length;ii>i;i++)value={},value.term=nodes[i].getAttribute("term"),attval=nodes[i].getAttribute("scheme"),attval&&(value.scheme=attval),attval=nodes[i].getAttribute("label"),attval&&(value.label=attval),atomAttrib.categories.push(value);nodes=this.getElementsByTagNameNS(node,atomns,"content"),nodes.length>0&&(value={},attval=nodes[0].getAttribute("type"),attval&&(value.type=attval),attval=nodes[0].getAttribute("src"),attval?value.src=attval:("text"==value.type||"html"==value.type||null==value.type?value.value=this.getFirstChildValue(node,atomns,"content",null):"xhtml"==value.type||value.type.match(/(\+|\/)xml$/)?value.value=this.getChildEl(nodes[0]):value.value=this.getFirstChildValue(node,atomns,"content",null),atomAttrib.content=value)),this.parsePersonConstructs(node,"contributor",atomAttrib),atomAttrib.id=this.getFirstChildValue(node,atomns,"id",null),nodes=this.getElementsByTagNameNS(node,atomns,"link"),nodes.length>0&&(atomAttrib.links=new Array(nodes.length));for(var oAtts=["rel","type","hreflang","title","length"],i=0,ii=nodes.length;ii>i;i++){value={},value.href=nodes[i].getAttribute("href");for(var j=0,jj=oAtts.length;jj>j;j++)attval=nodes[i].getAttribute(oAtts[j]),attval&&(value[oAtts[j]]=attval);atomAttrib.links[i]=value}value=this.getFirstChildValue(node,atomns,"published",null),value&&(atomAttrib.published=value),value=this.getFirstChildValue(node,atomns,"rights",null),value&&(atomAttrib.rights=value),value=this.getFirstChildValue(node,atomns,"summary",null),value&&(atomAttrib.summary=value),atomAttrib.title=this.getFirstChildValue(node,atomns,"title",null),atomAttrib.updated=this.getFirstChildValue(node,atomns,"updated",null);var featureAttrib={title:atomAttrib.title,description:atomAttrib.summary,atom:atomAttrib},geometry=this.parseLocations(node)[0],feature=new OpenLayers.Feature.Vector(geometry,featureAttrib);return feature.fid=atomAttrib.id,feature},parseFeatures:function(node){var features=[],entries=this.getElementsByTagNameNS(node,this.namespaces.atom,"entry");0==entries.length&&(entries=[node]);for(var i=0,ii=entries.length;ii>i;i++)features.push(this.parseFeature(entries[i]));return features},parseLocations:function(node){var georssns=this.namespaces.georss,locations={components:[]},where=this.getElementsByTagNameNS(node,georssns,"where");if(where&&where.length>0){this.gmlParser||this.initGmlParser();for(var i=0,ii=where.length;ii>i;i++)this.gmlParser.readChildNodes(where[i],locations)}var components=locations.components,point=this.getElementsByTagNameNS(node,georssns,"point");if(point&&point.length>0)for(var i=0,ii=point.length;ii>i;i++){var xy=OpenLayers.String.trim(point[i].firstChild.nodeValue).split(/\s+/);2!=xy.length&&(xy=OpenLayers.String.trim(point[i].firstChild.nodeValue).split(/\s*,\s*/)),components.push(new OpenLayers.Geometry.Point(xy[1],xy[0]))}var line=this.getElementsByTagNameNS(node,georssns,"line");if(line&&line.length>0)for(var coords,p,points,i=0,ii=line.length;ii>i;i++){coords=OpenLayers.String.trim(line[i].firstChild.nodeValue).split(/\s+/),points=[];for(var j=0,jj=coords.length;jj>j;j+=2)p=new OpenLayers.Geometry.Point(coords[j+1],coords[j]),points.push(p);components.push(new OpenLayers.Geometry.LineString(points))}var polygon=this.getElementsByTagNameNS(node,georssns,"polygon");if(polygon&&polygon.length>0)for(var coords,p,points,i=0,ii=polygon.length;ii>i;i++){coords=OpenLayers.String.trim(polygon[i].firstChild.nodeValue).split(/\s+/),points=[];for(var j=0,jj=coords.length;jj>j;j+=2)p=new OpenLayers.Geometry.Point(coords[j+1],coords[j]),points.push(p);components.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(points)]))}if(this.internalProjection&&this.externalProjection)for(var i=0,ii=components.length;ii>i;i++)components[i]&&components[i].transform(this.externalProjection,this.internalProjection);return components},parsePersonConstructs:function(node,name,data){for(var persons=[],atomns=this.namespaces.atom,nodes=this.getElementsByTagNameNS(node,atomns,name),oAtts=["uri","email"],i=0,ii=nodes.length;ii>i;i++){var value={};value.name=this.getFirstChildValue(nodes[i],atomns,"name",null);for(var j=0,jj=oAtts.length;jj>j;j++){var attval=this.getFirstChildValue(nodes[i],atomns,oAtts[j],null);attval&&(value[oAtts[j]]=attval)}persons.push(value)}persons.length>0&&(data[name+"s"]=persons)},CLASS_NAME:"OpenLayers.Format.Atom"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){var observeElement=this.observeElement||document;this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:observeElement})},defaultKeyPress:function(evt){var size,handled=!0,target=OpenLayers.Event.element(evt);if(!target||"INPUT"!=target.tagName&&"TEXTAREA"!=target.tagName&&"SELECT"!=target.tagName){switch(evt.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:size=this.map.getSize(),this.map.pan(0,-.75*size.h);break;case 34:size=this.map.getSize(),this.map.pan(0,.75*size.h);break;case 35:size=this.map.getSize(),this.map.pan(.75*size.w,0);break;case 36:size=this.map.getSize(),this.map.pan(-.75*size.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:handled=!1}handled&&OpenLayers.Event.stop(evt)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]),this.options=options;var yx=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(yx,this.yx)},read:function(data){"string"==typeof data&&(data=OpenLayers.Format.XML.prototype.read.apply(this,[data])),data&&9==data.nodeType&&(data=data.documentElement);var capabilities={};return this.readNode(data,capabilities),capabilities.version=this.version,capabilities},readers:{wmts:{Capabilities:function(node,obj){this.readChildNodes(node,obj)},Contents:function(node,obj){obj.contents={},obj.contents.layers=[],obj.contents.tileMatrixSets={},this.readChildNodes(node,obj.contents)},Layer:function(node,obj){var layer={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};layer.layers=[],this.readChildNodes(node,layer),obj.layers.push(layer)},Style:function(node,obj){var style={};style.isDefault="true"===node.getAttribute("isDefault"),this.readChildNodes(node,style),obj.styles.push(style)},Format:function(node,obj){obj.formats.push(this.getChildValue(node))},TileMatrixSetLink:function(node,obj){var tileMatrixSetLink={};this.readChildNodes(node,tileMatrixSetLink),obj.tileMatrixSetLinks.push(tileMatrixSetLink)},TileMatrixSet:function(node,obj){if(obj.layers){var tileMatrixSet={matrixIds:[]};this.readChildNodes(node,tileMatrixSet),obj.tileMatrixSets[tileMatrixSet.identifier]=tileMatrixSet}else obj.tileMatrixSet=this.getChildValue(node)},TileMatrix:function(node,obj){var tileMatrix={supportedCRS:obj.supportedCRS};this.readChildNodes(node,tileMatrix),obj.matrixIds.push(tileMatrix)},ScaleDenominator:function(node,obj){obj.scaleDenominator=parseFloat(this.getChildValue(node))},TopLeftCorner:function(node,obj){var yx,topLeftCorner=this.getChildValue(node),coords=topLeftCorner.split(" ");if(obj.supportedCRS){var crs=obj.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");yx=!!this.yx[crs]}yx?obj.topLeftCorner=new OpenLayers.LonLat(coords[1],coords[0]):obj.topLeftCorner=new OpenLayers.LonLat(coords[0],coords[1])},TileWidth:function(node,obj){obj.tileWidth=parseInt(this.getChildValue(node))},TileHeight:function(node,obj){obj.tileHeight=parseInt(this.getChildValue(node))},MatrixWidth:function(node,obj){obj.matrixWidth=parseInt(this.getChildValue(node))},MatrixHeight:function(node,obj){obj.matrixHeight=parseInt(this.getChildValue(node))},ResourceURL:function(node,obj){obj.resourceUrl=obj.resourceUrl||{};var resourceType=node.getAttribute("resourceType");obj.resourceUrls||(obj.resourceUrls=[]);var resourceUrl=obj.resourceUrl[resourceType]={format:node.getAttribute("format"),template:node.getAttribute("template"),resourceType:resourceType};obj.resourceUrls.push(resourceUrl)},WSDL:function(node,obj){obj.wsdl={},obj.wsdl.href=node.getAttribute("xlink:href")},ServiceMetadataURL:function(node,obj){obj.serviceMetadataUrl={},obj.serviceMetadataUrl.href=node.getAttribute("xlink:href")},LegendURL:function(node,obj){obj.legend={},obj.legend.href=node.getAttribute("xlink:href"),obj.legend.format=node.getAttribute("format")},Dimension:function(node,obj){var dimension={values:[]};this.readChildNodes(node,dimension),obj.dimensions.push(dimension)},Default:function(node,obj){obj["default"]=this.getChildValue(node)},Value:function(node,obj){obj.values.push(this.getChildValue(node))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});