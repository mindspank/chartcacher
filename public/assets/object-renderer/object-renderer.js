/*!
* Copyright(C) 2016
* Qlik International AB
* All Rights Reserved
*/
define("js/configloader",{load:function(a,b,c){b(["assets/require-config"],function(d){(d=d||b)([a],function(a){c(a)})})}}),define("core.utils/class",[],function(){"use strict";var a=/xyz/.test(function(){})?/\b_super\b/:/.*/,b=function(){};return b.extend=function b(c,d){var e=this.prototype;"string"!=typeof c&&(d=c,c="Class");var f=Object.create(this.prototype);for(var g in d)f[g]="function"==typeof d[g]&&"function"==typeof e[g]&&a.test(d[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,d[g]):d[g];if(!/^[_a-z][_a-z\d]*$/i.test(c))throw new Error("Invalid subclass name. Alphanumericals only.");var h=new Function("return (function "+c+"(){ typeof this.init === 'function' && this.init.apply(this, [].slice.call(arguments)) });")();return h.prototype=f,h.prototype.constructor=h,h.extend=b,h},b}),define("objects.backend-api/engine-throttle",["core.utils/deferred","core.utils/class","core.utils/notification","util"],function(a,b,c,d){function e(a,b){var c=this;this.queuedRequests.push(a),clearTimeout(this._debounceTimer),b>=10?this._debounceTimer=setTimeout(function(){f.call(c)},b):f.call(c)}function f(){if(this.ongoingRequests.length)return void(this.waitingForResponse=!0);var a=this.queuedRequests.pop();for(a&&g.call(this,a);this.queuedRequests.length;)a=this.queuedRequests.shift(),a.dfd.reject()}function g(a){this.waitingForResponse=!1,this.ongoingRequests.push(a);var b=this,c=a.wrapper;a.sentAt=Date.now(),c.promise.then(function(){b.ongoingRequests.splice(b.ongoingRequests.indexOf(a),1),a.respondedAt=Date.now(),b.resolvedRequests.push({sentAt:a.sentAt,respondedAt:a.respondedAt,requestedAt:a.requestedAt}),b.resolvedRequests.length>10&&(b.resolvedRequests=b.resolvedRequests.slice(-10)),a.requestedAt>b._latestResolvedRequestedAt?a.dfd.resolve.apply(a.dfd,[].slice.call(arguments)):a.dfd.reject(),b._latestResolvedRequestedAt=a.requestedAt},function(){b.ongoingRequests.splice(b.ongoingRequests.indexOf(a),1),a.respondedAt=Date.now(),a.dfd.reject.apply(a.dfd,[].slice.call(arguments))}).finally(function(){b.waitingForResponse&&f.call(b)}),this.Send.emit(a.data,c)}var h,i={enabled:!0,delay:50};return h=b.extend("Throttle",{init:function(){this.options={},this.ongoingRequests=[],this.queuedRequests=[],this.recentRequests=[],this.resolvedRequests=[],this._debounceTimer=null,this._latestResolvedRequestedAt=-1,c.mixin(this),this.notification("Send"),this.notification("Cancel"),this.setOptions({})},destroy:function(){this.clear(),this.recentRequests=[],this.resolvedRequests=[],c.release(this)},setOptions:function(a){this.options=d.extend(!0,{},i,this.options,a),this.enabled=this.options.enabled||!1,this.delay=this.options.delay||-1},clear:function(){clearTimeout(this._debounceTimer);for(var a;this.queuedRequests.length;)a=this.queuedRequests.pop(),a.dfd.reject();for(;this.ongoingRequests.length;)a=this.ongoingRequests.pop(),a.dfd.reject()},queue:function(b){var c=this.enabled?this.delay:-1,d={data:b,dfd:a(),wrapper:a(),requestedAt:Date.now()},f=Math.max(this._getAvgResolutionTime(),c);return c<1||this.recentRequests.length<1||Date.now()-this.recentRequests.slice(-1)[0].requestedAt>f?e.apply(this,[d,0]):e.apply(this,[d,Math.min(c,1e3)]),this.recentRequests.push(d),this.recentRequests.length>10&&(this.recentRequests=this.recentRequests.slice(-10)),d.dfd.promise},updateResolutionTime:function(){this._latestResolvedRequestedAt=Date.now()},_getAvgResolutionTime:function(){var a;return this.resolvedRequests.length&&(a=0,this.resolvedRequests.forEach(function(b){a+=b.respondedAt-b.sentAt}),a/=this.resolvedRequests.length),a}})}),define("general.utils/shapes/geometry-math",[],function(){"use strict";var a,b=1e-12;return a={checkPointsCoincident:function(a,b){return a.x===b.x&&a.y===b.y},checkPointOnLineSegment2:function(c,d,e){var f,g,h,i;return f=e.x-d.x,g=e.y-d.y,0===f?0===g?a.checkPointsCoincident(c,d):c.x===d.x&&(h=(c.y-d.y)/g,h>=0&&h<=1):0===g?c.y===d.y&&(h=(c.x-d.x)/f,h>=0&&h<=1):(h=(c.x-d.x)/f,i=(c.y-d.y)/g,h>=0&&h<=1&&Math.abs(h-i)<b)},checkPointOnLineSegment:function(b,c){return a.checkPointOnLineSegment2(b,c[0],c[1])},checkLineSegmentIntersectingLineSegment2:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r;if(f=c.x-b.x,g=c.y-b.y,h=e.x-d.x,i=e.y-d.y,j=b.x-d.x,k=b.y-d.y,n=i*f-h*g,l=h*k-i*j,m=f*k-g*j,0===n){if(0===l&&0===m){if(0===f){if(0===g)return a.checkPointOnLineSegment2(b,d,e);q=(d.y-b.y)/g,r=(e.y-b.y)/g}else q=(d.x-b.x)/f,r=(e.x-b.x)/f;return!(q<0&&r<0||q>1&&r>1)}return!1}return o=l/n,p=m/n,o>=0&&o<=1&&p>=0&&p<=1},checkLineSegmentIntersectingLineSegment:function(b,c){return a.checkLineSegmentIntersectingLineSegment2(b[0],b[1],c[0],c[1])},checkPointInsideRectDefinedByMaxMin:function(a,b){return a.x>b.minX&&a.x<b.maxX&&a.y>b.minY&&a.y<b.maxY},checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin:function(a,b){return a.x>=b.minX&&a.x<=b.maxX&&a.y>=b.minY&&a.y<=b.maxY},checkLineSegmentIntersectingRectDefinedByMaxMin:function(b,c){return!(!a.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(b[0],c)&&!a.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(b[0],c))||(!!a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.minY},{x:c.minX,y:c.maxY}])||(!!a.checkLineSegmentIntersectingLineSegment(b,[{x:c.maxX,y:c.minY},{x:c.maxX,y:c.maxY}])||(!!a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.minY},{x:c.maxX,y:c.minY}])||!!a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.maxY},{x:c.maxX,y:c.maxY}]))))},checkPolylineIntersectingRectDefinedByMaxMin:function(b,c){var d,e,f,g,h,i,j,k=0,l=1,m=1,n=b?b.length:0;if(0===n)return!1;var o=function(){return f<n};if(b[0].x>b[n-1].x&&(k=n-1,l=n-2,m=-1,o=function(){return f>-1}),e=b[k],e.x>c.maxX)return!1;if(e.x>=c.minX&&e.y>=c.minY&&e.y<=c.maxY)return!0;for(d=e,f=l;o();f+=m){if(e=b[f],e.x>=c.minX&&e.x<=c.maxX&&e.y>=c.minY&&e.y<=c.maxY)return!0;if(g=Math.min(d.x,e.x),g>c.maxX)return!1;if(h=Math.max(d.x,e.x),h<c.minX)d=e;else if(i=Math.min(d.y,e.y),i>c.maxY)d=e;else if(j=Math.max(d.y,e.y),j<c.minY)d=e;else{if(a.checkLineSegmentIntersectingRectDefinedByMaxMin([d,e],c))return!0;d=e}}return!1},checkPolylinesIntersectingRectDefinedByMaxMin:function(b,c){var d,e=b?b.length:0;for(d=0;d<e;d++)if(a.checkPolylineIntersectingRectDefinedByMaxMin(b[d],c))return!0;return!1},calculateBounds:function(a){var b,c,d,e,f,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=Number.MAX_VALUE,j=-Number.MAX_VALUE,k=a?a.length:0;if(0===k)return null;for(d=0;d<k;d++)b=a[d],c=b?b.calculateBounds():void 0,c&&c.x!==1/0&&(e=c.getRight(),f=c.getBottom(),e>h&&(h=e),c.x<g&&(g=c.x),f>j&&(j=f),c.y<i&&(i=c.y));return{x:g,y:i,width:h-g,height:j-i}}}}),define("general.utils/shapes/line",["./geometry-math"],function(a){"use strict";function b(a,b,c,d){0===arguments.length?this.set(0,0,0,0):2===arguments.length?this.set(a.x,a.y,b.x,b.y):this.set(a,b,c,d)}return b.prototype={toString:function(){return this.x1+" "+this.y1+" "+this.x2+" "+this.y2},clone:function(){return new b(this.x1,this.y1,this.x2,this.y2)},set:function(a,b,c,d){this.x1=a,this.y1=b,this.x2=c,this.y2=d},intersectsLine:function(b){return a.checkLineSegmentIntersectingLineSegment(this.getPoints(),b.getPoints())},intersectsRect:function(a){return this.intersectsLine(new b(a.x,a.y,a.x+a.width,a.y))||this.intersectsLine(new b(a.x+a.width,a.y,a.x+a.width,a.y+a.height))||this.intersectsLine(new b(a.x,a.y+a.height,a.x+a.width,a.y+a.height))||this.intersectsLine(new b(a.x,a.y,a.x,a.y+a.height))},getPoints:function(){var a=[];return a.push({x:this.x1,y:this.y1}),a.push({x:this.x2,y:this.y2}),a}},b}),define("general.utils/shapes/rect",["./line"],function(a){"use strict";function b(a,b,c,d){0===arguments.length?this.set(0,0,0,0):this.set(a,b,c,d)}return b.prototype={toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height},clone:function(){return new b(this.x,this.y,this.width,this.height)},set:function(a,b,c,d){c>=0?(this.x=a,this.width=c):(this.x=a+c,this.width=-c),d>=0?(this.y=b,this.height=d):(this.y=b+d,this.height=-d)},setLTRB:function(a,b,c,d){a<=c?(this.x=a,this.width=c-a):(this.x=c,this.width=a-c),b<=d?(this.y=b,this.height=d-b):(this.y=d,this.height=b-d)},equal:function(a){return a&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},combineWith:function(a){var c,d,e,f,g=Math.max(a.getRight(),this.getRight()),h=Math.max(a.getBottom(),this.getBottom());return c=Math.min(a.x,this.x),d=Math.min(a.y,this.y),e=Math.max(0,g-c),f=Math.max(0,h-d),new b(c,d,e,f)},intersectsWith:function(a){return!!a&&(this.x<=a.getRight()&&a.x<=this.getRight()&&this.y<=a.getBottom()&&a.y<=this.getBottom())},intersectsRect:function(a){return this.intersectsWith(a)},intersection:function(a,c){var d,e,f,g;return this.intersectsWith(a)?(d=Math.max(this.x,a.x),e=Math.max(this.y,a.y),f=Math.min(this.getRight(),a.getRight()),g=Math.min(this.getBottom(),a.getBottom()),new b(d,e,f-d,g-e)):c?null:new b(this.x,this.y,this.width,this.height)},union:function(a){var c,d,e,f;return c=Math.min(this.x,a.x),d=Math.min(this.y,a.y),e=Math.max(this.getRight(),a.getRight()),f=Math.max(this.getBottom(),a.getBottom()),new b(c,d,e-c,f-d)},pointInside:function(a,b){return a>=this.x&&a<=this.getRight()&&b>=this.y&&b<=this.getBottom()},rectInside:function(a){var b,c=a.getPoints();for(b=0;b<4;b++)if(!this.pointInside(c[b].x,c[b].y))return!1;return!0},intersectsLine:function(b){var c=this.getRight(),d=this.getBottom();return!(!this.pointInside(b.x1,b.y1)&&!this.pointInside(b.x2,b.y2))||!!(b.intersectsLine(new a(this.x,this.y,c,this.y))||b.intersectsLine(new a(c,this.y,c,d))||b.intersectsLine(new a(c,d,this.x,d))||b.intersectsLine(new a(this.x,d,this.x,this.y)))},getPoints:function(){var a=[];return a.push({x:this.x,y:this.y}),a.push({x:this.getRight(),y:this.y}),a.push({x:this.getRight(),y:this.getBottom()}),a.push({x:this.x,y:this.getBottom()}),a},getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},getCenterPoint:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},getBoundingRect:function(){return this},scale:function(a){var b=a-1,c=b*this.width/2,d=b*this.height/2;this.x-=c,this.y-=d,this.width*=a,this.height*=a},hasNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.width)||isNaN(this.height)}},b}),define("objects.backend-api/cube-slicer",["core.utils/class","general.utils/shapes/rect"],function(a,b){"use strict";var c,d=new b(0,0,0,0),e=new b(0,0,0,0);return c=a.extend("CubeSlicer",{init:function(){this.pages=[]},get:function(a){return a.map(function(a){return this.getPage(a)}.bind(this))},getPage:function(a){var c,f,g,h=[];for(f=0;f<this.pages.length;f++)if(c=this.pages[f].qArea,d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(c.qLeft,c.qTop,c.qWidth,c.qHeight),g=e.intersection(d,!0),h.push({coverage:g?g.clone():new b(0,0,0,0),idx:f}),c.qLeft<=a.qLeft&&c.qLeft+c.qWidth>=a.qLeft+a.qWidth&&c.qTop<=a.qTop&&c.qTop+c.qHeight>=a.qTop+a.qHeight)return this._extract(a,this.pages[f]);return h.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),h[0].coverage.height>0&&h[0].coverage.width>0?this._extract(a,this.pages[h[0].idx]):{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qMatrix:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(a){this.pages=a},containsArea:function(a){for(var b,c=0;c<this.pages.length;c++)if(b=this.pages[c].qArea,b.qLeft<=a.qLeft&&b.qLeft+b.qWidth>=a.qLeft+a.qWidth&&b.qTop<=a.qTop&&b.qTop+b.qHeight>=a.qTop+a.qHeight)return!0;return!1},contains:function(a){return!(!this.pages||!this.pages.length)&&0===a.filter(function(a){return!this.containsArea(a)}.bind(this)).length},_extract:function(a,b){d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(b.qArea.qLeft,b.qArea.qTop,b.qArea.qWidth,b.qArea.qHeight);var c,f,g,h=d.intersection(e,!0);return h?(g=Math.max(0,a.qTop-b.qArea.qTop),f=Math.max(0,a.qLeft-b.qArea.qLeft),c=b.qMatrix.slice(g,g+h.height).map(function(a){return a.slice(f,f+h.width)}),{qArea:{qTop:h.y,qLeft:h.x,qWidth:h.width,qHeight:h.height},qMatrix:c}):{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qMatrix:[]}}})}),define("objects.backend-api/pivot-cube-slicer",["./cube-slicer","general.utils/shapes/rect"],function(a,b){"use strict";function c(a,b){var c,d={};for(c in a)"qSubNodes"!==c&&a.hasOwnProperty(c)&&(d[c]=a[c]);return b.push(d),d}function d(a,b,e){var g,h,i,j=[],k=[],l=0,m=0;for(e.length&&(l=e[0].qUp||0,m=e[e.length-1].qDown||0),g=0;g<e.length;++g)if(h=e[g],h.qSubNodes.length>0&&(k=d(a,b,h.qSubNodes)),i=null,(0===h.qSubNodes.length&&f>=a&&f<=a+b||k.length>0)&&(i=c(h,j),void 0!==i.qUp&&1===j.length&&(i.qUp=l+g),i.qSubNodes=k),0===h.qSubNodes.length&&f++,f===a+b){i&&void 0!==i.qDown&&(i.qDown=m+(e.length-1-g));break}return j}function e(a,b,c){return f=0,d(a,b,c)}var f,g,h=new b(0,0,0,0),i=new b(0,0,0,0);return g=a.extend("PivotCubeSlicer",{init:function(){this._super(),this.requestedAreas=[]},getPage:function(a){var c,d,e,f=[];for(d=0;d<this.pages.length;d++)if(c=this.pages[d].qArea,h.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),i.set(c.qLeft,c.qTop,c.qWidth,c.qHeight),e=i.intersection(h,!0),f.push({coverage:e?e.clone():new b(0,0,0,0),idx:d}),c.qLeft<=a.qLeft&&c.qLeft+c.qWidth>=a.qLeft+a.qWidth&&c.qTop<=a.qTop&&c.qTop+c.qHeight>=a.qTop+a.qHeight)return this._extract(a,this.pages[d]);return f.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),f[0].coverage.height>0&&f[0].coverage.width>0?this._extract(a,this.pages[f[0].idx]):{qLeft:[],qTop:[],qData:[],qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0}}},_extract:function(a,b){var c,d;h.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),i.set(b.qArea.qLeft,b.qArea.qTop,b.qArea.qWidth,b.qArea.qHeight);var f,g,j,k=h.intersection(i,!0);return k?(j=Math.max(0,a.qTop-b.qArea.qTop),g=Math.max(0,a.qLeft-b.qArea.qLeft),f=b.qData.slice(j,j+k.height).map(function(a){return a.slice(g,g+k.width)}),c=e(j,k.height,b.qLeft),d=e(g,k.width,b.qTop),{qLeft:c,qTop:d,qData:f,qArea:{qTop:k.y,qLeft:k.x,qWidth:k.width,qHeight:k.height}}):{qLeft:[],qTop:[],qData:[],qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0}}}})}),define("objects.backend-api/cache-cube",["core.utils/class","util","core.utils/deferred","objects.backend-api/engine-throttle","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function(a,b,c,d,e,f){var g,h={mode:"S",enabled:!0,debouncing:{enabled:!0,delay:50},height:250,width:250,maxTotalArea:1e4};return g=a.extend("CacheCube",{init:function(a,b,c,g){this.model=a,this.responseProperty=b,this.options={},this.cubeHeight=0,this.cubeWidth=0,this.setOptions(g||{}),this.setPath(c),"P"===this.options.mode?this.cube=new f:this.cube=new e,this.throttle=new d;var h=this;this.throttle.Send.bind(function(a,b){var c=h._getDirections(h.throttle.recentRequests.map(function(a){return{top:a.data[0].qTop,left:a.data[0].qLeft}})),d=h._getAreasToCache(a,c.vertical,c.horizontal);h.cacheData(d,a).then(function(a){h.cube?b.resolve(a):b.reject()},function(){b.reject()})}),this._modelBinding=function(){h.clear()},this.model.Invalidated.bind(this._modelBinding)},destroy:function(){this.cube.destroy(),this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle,delete this.cube},setMethodName:function(a){this.method=a},setPath:function(a){this.path=a},setCubeSize:function(a){this.cubeHeight=a.qcy,this.cubeWidth=a.qcx},setOptions:function(a){a&&(this.options=b.extend(!0,{},h,this.options,a),this.cacheHeight=this.options.height,this.cacheWidth=this.options.width,this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1})},clear:function(){this.cube.clear(),this.throttle.clear()},set:function(a){this.clear(),a&&a.length&&this.cube.store(a)},cacheData:function(a,b){return this.model.rpc(this.method,this.responseProperty,[this.path,a]).then(function(a){return this.cube?(this.cube.store(a),this.cube.get(b)):a}.bind(this))},getData:function(a){if(!this.model)return c.reject();if(!this.enabled||!this.cubeHeight||!this.cubeWidth)return this.model.rpc(this.method,this.responseProperty,[this.path,a]);var b,d,e=[];for(b=0;b<a.length;++b)d=a[b],e.push({qTop:Math.max(Math.floor(d.qTop),0),qLeft:Math.max(d.qLeft,0),qHeight:Math.min(d.qHeight,this.cubeHeight-Math.floor(d.qTop)),qWidth:Math.min(d.qWidth,this.cubeWidth-d.qLeft)});return this.cube.contains(e)?(this.throttle.updateResolutionTime(),c.resolve(this.cube.get(e))):0===e[0].qTop&&this.cube.isEmpty()?(this.throttle.updateResolutionTime(),this.cacheData(e,e)):this.throttle.queue(e)},_getDirections:function(a){if(!a||a.length<2)return{vertical:0,horizontal:0};var b=a.slice(-2),c=b[1].top-b[0].top,d=b[1].left-b[0].left;return{vertical:c<0?-1:c>0?1:0,horizontal:d<0?-1:d>0?1:0}},_getAreasToCache:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=[],n=this.cacheHeight;for("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),this.cacheHeight*this.cacheWidth*a.length>this.options.maxTotalArea&&(n=Math.floor(this.options.maxTotalArea/(a.length*this.cacheWidth))),d=0;d<a.length;++d)e=0!==b?Math.floor(.5*Math.max(0,n-a[d].qHeight)):0,f=0!==c?Math.floor(.5*Math.max(0,this.cacheWidth-a[d].qWidth)):0,g=e*b-e,h=f*c-f,i=0!==b?Math.max(0,Math.min(Math.max(a[d].qHeight,n),this.cubeHeight)):a[d].qHeight,j=0!==c?Math.max(0,Math.min(Math.max(a[d].qWidth,this.cacheWidth),this.cubeWidth)):a[d].qWidth,k=Math.max(0,Math.min(a[d].qTop+g,this.cubeHeight-i)),l=Math.max(0,Math.min(a[d].qLeft+h,this.cubeWidth-j)),m.push({qTop:k,qHeight:i,qLeft:l,qWidth:j});return m}})}),define("objects.backend-api/backend-throttle",["core.utils/class","util","objects.backend-api/engine-throttle"],function(a,b,c){var d,e={enabled:!0,debouncing:{enabled:!0,delay:50}};return d=a.extend({init:function(a,b,d){this.model=a,this.responseProperty=b,this.options={},this.setOptions({}),this.setPath(d),this.throttle=new c,this.throttle.Send.bind(function(a,b){e.model.rpc(e.method,e.responseProperty,[e.path,a]).then(function(a){b.resolve(a)},function(){b.reject()})});var e=this;this._modelBinding=function(){e.clear()},this.model.Invalidated.bind(this._modelBinding)},setMethodName:function(a){this.method=a},setPath:function(a){this.path=a},setOptions:function(a){this.options=b.extend(!0,{},e,this.options,a),this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1}},clear:function(){this.throttle.clear()},destroy:function(){this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle},set:function(){this.clear()},getData:function(a){return this.enabled?this.throttle.queue(a):this.model.rpc(this.method,this.responseProperty,[this.path,a])}})}),define("core.utils/json-patch",["jquery"],function(a){function b(a){return a&&(a=i({},{val:a}).val),a}function c(a,b){return m(a[b])||"$$"===b.substring(0,2)||"_"===b.substring(0,1)}function d(a,b){var c,d="/",e=b.substring(1).split(d).slice(0,-1);return e.forEach(function(b,d){d!==e.length&&(c=+b,a=a[c||b]=l(a[c||b])?isNaN(c)?{}:[]:a[b])}),a}function e(a){Object.keys(a).forEach(function(b){var d=Object.getOwnPropertyDescriptor(a,b);d.configurable&&!c(a,b)&&delete a[b]})}function f(a,b){var c,d,e=!0;if(j(a)&&j(b))return Object.keys(a).length===Object.keys(b).length&&(Object.keys(a).forEach(function(c){if(!f(a[c],b[c]))return e=!1,!1}),e);if(k(a)&&k(b)){if(a.length!==b.length)return!1;for(c=0,d=a.length;c<d;c++)if(!f(a[c],b[c]))return!1;return!0}return a===b}function g(a,b,c){function d(a,b,c){if(a[c]&&l(a[c].qInfo))return null;if(a[c]&&a[c].qInfo.qId===b)return c;for(var d=0,e=a.length;d<e;d++)if(a[d]&&a[d].qInfo.qId===b)return d;return-1}var e,g,i=[],j=a.slice(),k=-1;if(f(b,j))return i;if(null===b[0]||!l(b[0])&&l(b[0].qInfo))return i.push({op:"replace",path:c,value:b}),i;for(e=j.length-1;e>=0;--e)k=d(b,j[e].qInfo&&j[e].qInfo.qId,e),k===-1?(i.push({op:"remove",path:c+"/"+e}),j.splice(e,1)):i=i.concat(h.generate(j[e],b[k],c+"/"+e));for(e=0,g=b.length;e<g;++e)k=d(j,b[e].qInfo&&b[e].qInfo.qId),k===-1?(i.push({op:"add",path:c+"/"+e,value:b[e]}),j.splice(e,0,b[e])):k!==e&&(i.push({op:"move",path:c+"/"+e,from:c+"/"+k}),j.splice(e,0,j.splice(k,1)[0]));return i}var h={},i=function(){return a.extend.apply(a,[!0].concat(Array.prototype.slice.call(arguments)))},j=a.isPlainObject,k=Array.isArray,l=function(a){return"undefined"==typeof a},m=function(a){return"function"==typeof a};return h.generate=function(a,d,e){e=e||"";var i=[];return Object.keys(d).forEach(function(m){var n=b(d[m]),o=a[m],p=e+"/"+m;f(n,o)||c(d,m)||(l(o)?i.push({op:"add",path:p,value:n}):j(n)&&j(o)?i=i.concat(h.generate(o,n,p)):k(n)&&k(o)?i=i.concat(g(o,n,p)):i.push({op:"replace",path:e+"/"+m,value:n}))}),Object.keys(a).forEach(function(b){l(d[b])&&!c(a,b)&&i.push({op:"remove",path:e+"/"+b})}),i},h.apply=function(a,b){b.forEach(function(b){var c=d(a,b.path),f=b.path.split("/").splice(-1)[0],g=f&&isNaN(+f)?c[f]:c[+f]||c,h=b.from?b.from.split("/").splice(-1)[0]:null;if("add"===b.op||"replace"===b.op)if(k(c))"-"===f&&(f=c.length),c.splice(+f,"add"===b.op?0:1,b.value);else if(k(g)&&k(b.value)){var l=b.value.slice();g.length=0,g.push.apply(g,l)}else j(g)&&j(b.value)?(e(g),i(g,b.value)):c[f]=b.value;else if("move"===b.op){var m=d(a,b.from);k(c)?c.splice(+f,0,m.splice(+h,1)[0]):(c[f]=m[h],delete m[h])}else"remove"===b.op&&(k(c)?c.splice(+f,1):delete c[f])})},h.clone=function(a){return i({},a)},h.createPatch=function(a,b,c){var d={op:a.toLowerCase(),path:c};return"move"===d.op?d.from=b:"undefined"!=typeof b&&(d.value=b),d},h.updateObject=function(a,b){return Object.keys(a).length?void h.apply(a,h.generate(a,b)):void i(a,b)},h}),define("core.utils/permissions",[],function(){function a(a,b){return a.length||(a=["update","publish","export","exportdata","changeowner","delete"]),e&&(a=[]),b=b||{},b.update=a.indexOf("update")!==-1,b.publish=a.indexOf("publish")!==-1,b.export=a.indexOf("export")!==-1,b.exportData=a.indexOf("exportdata")!==-1,b.changeOwner=a.indexOf("changeowner")!==-1,b.remove=a.indexOf("delete")!==-1,b}function b(a,b){b=b||{};for(var c in b)delete b[c];return e?b:(a.forEach(function(a){a.canCreate&&(b["create"+a.resource[0].toUpperCase()+a.resource.substring(1)]=!0)}),b)}function c(c,f){var g={};return c.permissions||Object.defineProperty(c,"permissions",{configurable:!1,enumerable:!1,get:function(){return c&&(f&&(e=c.qReadOnly,b(c.create||d,g)),a(c.privileges||c.qMeta&&c.qMeta.privileges||[],g)),g}}),c}var d=[{resource:"sheet",canCreate:!0},{resource:"bookmark",canCreate:!0},{resource:"story",canCreate:!0},{resource:"searchhistory",canCreate:!0},{resource:"dimension",canCreate:!0},{resource:"measure",canCreate:!0},{resource:"masterobject",canCreate:!0}],e=!0;return{mapToLayout:c,parse:a,parseCreate:b}}),define("core.utils/model-garbage-collector",["core.utils/notification","core.utils/debug-flags"],function(a,b){function c(a){return a.Invalidated&&a.Invalidated.observers&&0===a.Invalidated.observers.length}function d(){for(var a,d=g.length;d--;)a=g[d],b.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Checking model (id, handle, model):",a.id,a.handle,a),c(a)&&(e(a),g.splice(d,1))}function e(c){b.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Releasing model (id):",c.id),a.release(c);for(var d in c)delete c[d]}function f(a){g.push(a)}var g=[];return setInterval(d,1e4),{addToQueue:f}}),define("text!autogenerated/qix/jsonspec.json",[],function(){return'{\r\n\t"structs": {\r\n\t\t"Field":{\r\n\t\t\t"GetCardinal": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetAndMode": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SelectValues": {\r\n\t\t\t\t"In": [{ "Name": "qFieldValues","DefaultValue": [{"qText": "", "qIsNumeric": false, "qNumber": 0}] }, { "Name": "qToggleMode","DefaultValue": false, "Optional": true }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Select": {\r\n\t\t\t\t"In": [{ "Name": "qMatch","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }, { "Name": "qExcludedValuesMode","DefaultValue": 0, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ToggleSelect": {\r\n\t\t\t\t"In": [{ "Name": "qMatch","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }, { "Name": "qExcludedValuesMode","DefaultValue": 0, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ClearAllButThis": {\r\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SelectPossible": {\r\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SelectExcluded": {\r\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SelectAll": {\r\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Lock": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Unlock": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetNxProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProperties" }]\r\n\t\t\t},\r\n\t\t\t"SetNxProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProperties","DefaultValue": {"qOneAndOnlyOne": false} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetAndMode": {\r\n\t\t\t\t"In": [{ "Name": "qAndMode","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SelectAlternative": {\r\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"LowLevelSelect": {\r\n\t\t\t\t"In": [{ "Name": "qValues","DefaultValue": [0] }, { "Name": "qToggleMode","DefaultValue": false }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Clear": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t}\r\n\t\t},\r\n\t\t"Variable":{\r\n\t\t\t"GetContent": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qContent" }]\r\n\t\t\t},\r\n\t\t\t"GetRawContent": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetContent": {\r\n\t\t\t\t"In": [{ "Name": "qContent","DefaultValue": "" }, { "Name": "qUpdateMRU","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ForceContent": {\r\n\t\t\t\t"In": [{ "Name": "qs","DefaultValue": "" }, { "Name": "qd","DefaultValue": 0 }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetNxProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProperties" }]\r\n\t\t\t},\r\n\t\t\t"SetNxProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProperties","DefaultValue": {"qName": "", "qNumberPresentation": {"qType": 0, "qnDec": 0, "qUseThou": 0, "qFmt": "", "qDec": "", "qThou": ""}, "qIncludeInBookmark": false, "qUsePredefListedValues": false, "qPreDefinedList": [""]} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t}\r\n\t\t},\r\n\t\t"GenericObject":{\r\n\t\t\t"GetLayout": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\r\n\t\t\t},\r\n\t\t\t"GetListObjectData": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }],\r\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\r\n\t\t\t},\r\n\t\t\t"GetHyperCubeData": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }],\r\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\r\n\t\t\t},\r\n\t\t\t"GetHyperCubeReducedData": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }, { "Name": "qZoomFactor","DefaultValue": 0 }, { "Name": "qReductionMode","DefaultValue": 0 }],\r\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\r\n\t\t\t},\r\n\t\t\t"GetHyperCubePivotData": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }],\r\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\r\n\t\t\t},\r\n\t\t\t"GetHyperCubeStackData": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }, { "Name": "qMaxNbrCells","DefaultValue": 0, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\r\n\t\t\t},\r\n\t\t\t"GetHyperCubeContinuousData": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qOptions","DefaultValue": {"qStart": 0, "qEnd": 0, "qNbrPoints": 0, "qMaxNbrTicks": 0, "qMaxNumberLines": 0} }, { "Name": "qReverseSort","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qDataPages" }, { "Name": "qAxisData" }]\r\n\t\t\t},\r\n\t\t\t"GetHyperCubeBinnedData": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }, { "Name": "qViewport","DefaultValue": {"qWidth": 0, "qHeight": 0, "qZoomLevel": 0} }, { "Name": "qDataRanges","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }, { "Name": "qMaxNbrCells","DefaultValue": 0 }, { "Name": "qQueryLevel","DefaultValue": 0 }, { "Name": "qBinningMethod","DefaultValue": 0 }],\r\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\r\n\t\t\t},\r\n\t\t\t"ApplyPatches": {\r\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }, { "Name": "qSoftPatch","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ClearSoftPatches": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProp" }]\r\n\t\t\t},\r\n\t\t\t"GetEffectiveProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProp" }]\r\n\t\t\t},\r\n\t\t\t"SetFullPropertyTree": {\r\n\t\t\t\t"In": [{ "Name": "qPropEntry","DefaultValue": {"qProperty": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}}, "qChildren": [], "qEmbeddedSnapshotRef": null} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetFullPropertyTree": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qPropEntry" }]\r\n\t\t\t},\r\n\t\t\t"GetInfo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"ClearSelections": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qColIndices","DefaultValue": [0], "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ExportData": {\r\n\t\t\t\t"In": [{ "Name": "qFileType","DefaultValue": 0 }, { "Name": "qPath","DefaultValue": "", "Optional": true }, { "Name": "qFileName","DefaultValue": "", "Optional": true }, { "Name": "qExportState","DefaultValue": 0, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qUrl" }]\r\n\t\t\t},\r\n\t\t\t"SelectListObjectValues": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qValues","DefaultValue": [0] }, { "Name": "qToggleMode","DefaultValue": false }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SelectListObjectPossible": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SelectListObjectExcluded": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SelectListObjectAlternative": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SelectListObjectAll": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SelectListObjectContinuousRange": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRanges","DefaultValue": [{"qMin": 0, "qMax": 0, "qMinInclEq": false, "qMaxInclEq": false}] }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SearchListObjectFor": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qMatch","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"AbortListObjectSearch": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"AcceptListObjectSearch": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qToggleMode","DefaultValue": false }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ExpandLeft": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRow","DefaultValue": 0 }, { "Name": "qCol","DefaultValue": 0 }, { "Name": "qAll","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ExpandTop": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRow","DefaultValue": 0 }, { "Name": "qCol","DefaultValue": 0 }, { "Name": "qAll","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CollapseLeft": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRow","DefaultValue": 0 }, { "Name": "qCol","DefaultValue": 0 }, { "Name": "qAll","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CollapseTop": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRow","DefaultValue": 0 }, { "Name": "qCol","DefaultValue": 0 }, { "Name": "qAll","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"DrillUp": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qDimNo","DefaultValue": 0 }, { "Name": "qNbrSteps","DefaultValue": 0 }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Lock": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qColIndices","DefaultValue": [0], "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Unlock": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qColIndices","DefaultValue": [0], "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SelectHyperCubeValues": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qDimNo","DefaultValue": 0 }, { "Name": "qValues","DefaultValue": [0] }, { "Name": "qToggleMode","DefaultValue": false }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SelectHyperCubeCells": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRowIndices","DefaultValue": [0] }, { "Name": "qColIndices","DefaultValue": [0] }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }, { "Name": "qDeselectOnlyOneSelected","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SelectPivotCells": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSelections","DefaultValue": [{"qType": 0, "qCol": 0, "qRow": 0}] }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }, { "Name": "qDeselectOnlyOneSelected","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"RangeSelectHyperCubeValues": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRanges","DefaultValue": [{"qRange": {"qMin": 0, "qMax": 0, "qMinInclEq": false, "qMaxInclEq": false}, "qMeasureIx": 0}] }, { "Name": "qColumnsToSelect","DefaultValue": [0], "Optional": true }, { "Name": "qOrMode","DefaultValue": false, "Optional": true }, { "Name": "qDeselectOnlyOneSelected","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"SelectHyperCubeContinuousRange": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRanges","DefaultValue": [{"qRange": {"qMin": 0, "qMax": 0, "qMinInclEq": false, "qMaxInclEq": false}, "qDimIx": 0}] }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"GetChild": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetChildInfos": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qInfos" }]\r\n\t\t\t},\r\n\t\t\t"CreateChild": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}} }, { "Name": "qPropForThis","DefaultValue": null, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"DestroyChild": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }, { "Name": "qPropForThis","DefaultValue": null, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"DestroyAllChildren": {\r\n\t\t\t\t"In": [{ "Name": "qPropForThis","DefaultValue": null, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetChildArrayOrder": {\r\n\t\t\t\t"In": [{ "Name": "qIds","DefaultValue": [""] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetLinkedObjects": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qItems" }]\r\n\t\t\t},\r\n\t\t\t"CopyFrom": {\r\n\t\t\t\t"In": [{ "Name": "qFromId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"BeginSelections": {\r\n\t\t\t\t"In": [{ "Name": "qPaths","DefaultValue": [""] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"EndSelections": {\r\n\t\t\t\t"In": [{ "Name": "qAccept","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ResetMadeSelections": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"EmbedSnapshotObject": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetSnapshotObject": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Publish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"UnPublish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t}\r\n\t\t},\r\n\t\t"GenericDimension":{\r\n\t\t\t"GetLayout": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\r\n\t\t\t},\r\n\t\t\t"ApplyPatches": {\r\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qDim": {"qGrouping": 0, "qFieldDefs": [""], "qFieldLabels": [""]}, "qMetaDef": {}} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProp" }]\r\n\t\t\t},\r\n\t\t\t"GetInfo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"GetDimension": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qDim" }]\r\n\t\t\t},\r\n\t\t\t"GetLinkedObjects": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qItems" }]\r\n\t\t\t},\r\n\t\t\t"Publish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"UnPublish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t}\r\n\t\t},\r\n\t\t"GenericBookmark":{\r\n\t\t\t"GetFieldValues": {\r\n\t\t\t\t"In": [{ "Name": "qField","DefaultValue": "" }, { "Name": "qGetExcludedValues","DefaultValue": false }, { "Name": "qDataPage","DefaultValue": {"qStartIndex": 0, "qEndIndex": 0} }],\r\n\t\t\t\t"Out": [{ "Name": "qFieldValues" }]\r\n\t\t\t},\r\n\t\t\t"GetLayout": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\r\n\t\t\t},\r\n\t\t\t"ApplyPatches": {\r\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProp" }]\r\n\t\t\t},\r\n\t\t\t"GetInfo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"Apply": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"Publish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"UnPublish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t}\r\n\t\t},\r\n\t\t"GenericVariable":{\r\n\t\t\t"GetLayout": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\r\n\t\t\t},\r\n\t\t\t"ApplyPatches": {\r\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}, "qName": "", "qComment": "", "qNumberPresentation": {"qType": 0, "qnDec": 0, "qUseThou": 0, "qFmt": "", "qDec": "", "qThou": ""}, "qIncludeInBookmark": false, "qDefinition": ""} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProp" }]\r\n\t\t\t},\r\n\t\t\t"GetInfo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"SetStringValue": {\r\n\t\t\t\t"In": [{ "Name": "qVal","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetNumValue": {\r\n\t\t\t\t"In": [{ "Name": "qVal","DefaultValue": 0 }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetDualValue": {\r\n\t\t\t\t"In": [{ "Name": "qText","DefaultValue": "" }, { "Name": "qNum","DefaultValue": 0 }],\r\n\t\t\t\t"Out": []\r\n\t\t\t}\r\n\t\t},\r\n\t\t"GenericMeasure":{\r\n\t\t\t"GetLayout": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\r\n\t\t\t},\r\n\t\t\t"ApplyPatches": {\r\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMeasure": {"qLabel": "", "qDef": "", "qGrouping": 0, "qExpressions": [""], "qActiveExpression": 0}, "qMetaDef": {}} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProp" }]\r\n\t\t\t},\r\n\t\t\t"GetInfo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"GetMeasure": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qMeasure" }]\r\n\t\t\t},\r\n\t\t\t"GetLinkedObjects": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qItems" }]\r\n\t\t\t},\r\n\t\t\t"Publish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"UnPublish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t}\r\n\t\t},\r\n\t\t"GenericDerivedFields":{\r\n\t\t\t"SetProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qDerivedDefinitionId": "", "qFieldName": [""], "qMetaDef": {}} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProp" }]\r\n\t\t\t},\r\n\t\t\t"GetInfo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"GetDerivedFieldData": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qData" }]\r\n\t\t\t},\r\n\t\t\t"GetDerivedField": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qFields" }]\r\n\t\t\t},\r\n\t\t\t"GetListData": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qListData" }]\r\n\t\t\t},\r\n\t\t\t"GetDerivedFields": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qFields" }]\r\n\t\t\t},\r\n\t\t\t"GetDerivedGroups": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qGroups" }]\r\n\t\t\t}\r\n\t\t},\r\n\t\t"Doc":{\r\n\t\t\t"GetProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetField": {\r\n\t\t\t\t"In": [{ "Name": "qFieldName","DefaultValue": "" }, { "Name": "qStateName","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetFieldDescription": {\r\n\t\t\t\t"In": [{ "Name": "qFieldName","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetVariable": {\r\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetLooselyCoupledVector": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qv" }]\r\n\t\t\t},\r\n\t\t\t"SetLooselyCoupledVector": {\r\n\t\t\t\t"In": [{ "Name": "qv","DefaultValue": [0] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Evaluate": {\r\n\t\t\t\t"In": [{ "Name": "qExpression","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"EvaluateEx": {\r\n\t\t\t\t"In": [{ "Name": "qExpression","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qValue" }]\r\n\t\t\t},\r\n\t\t\t"ClearAll": {\r\n\t\t\t\t"In": [{ "Name": "qLockedAlso","DefaultValue": false, "Optional": true }, { "Name": "qStateName","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"LockAll": {\r\n\t\t\t\t"In": [{ "Name": "qStateName","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"UnlockAll": {\r\n\t\t\t\t"In": [{ "Name": "qStateName","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Back": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Forward": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ReduceData": {\r\n\t\t\t\t"In": [{ "Name": "qConfirm","DefaultValue": false, "Optional": true }, { "Name": "qDropFieldNames","DefaultValue": [""], "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"RemoveAllData": {\r\n\t\t\t\t"In": [{ "Name": "qConfirm","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CreateVariable": {\r\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"RemoveVariable": {\r\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetLocaleInfo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetTablesAndKeys": {\r\n\t\t\t\t"In": [{ "Name": "qWindowSize","DefaultValue": {"qcx": 0, "qcy": 0} }, { "Name": "qNullSize","DefaultValue": {"qcx": 0, "qcy": 0} }, { "Name": "qCellHeight","DefaultValue": 0 }, { "Name": "qSyntheticMode","DefaultValue": false }, { "Name": "qIncludeSysVars","DefaultValue": false }],\r\n\t\t\t\t"Out": [{ "Name": "qtr" }, { "Name": "qk" }]\r\n\t\t\t},\r\n\t\t\t"GetViewDlgSaveInfo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetViewDlgSaveInfo": {\r\n\t\t\t\t"In": [{ "Name": "qInfo","DefaultValue": {"qPos": {"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}, "qCtlInfo": {"qInternalView": {"qTables": [{"qPos": {"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}, "qCaption": ""}], "qBroomPoints": [{"qPos": {"qx": 0, "qy": 0}, "qTable": "", "qFields": [""]}], "qConnectionPoints": [{"qPos": {"qx": 0, "qy": 0}, "qFields": [""]}], "qZoomFactor": 0}, "qSourceView": {"qTables": [{"qPos": {"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}, "qCaption": ""}], "qBroomPoints": [{"qPos": {"qx": 0, "qy": 0}, "qTable": "", "qFields": [""]}], "qConnectionPoints": [{"qPos": {"qx": 0, "qy": 0}, "qFields": [""]}], "qZoomFactor": 0}}, "qMode": 0} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetEmptyScript": {\r\n\t\t\t\t"In": [{ "Name": "qLocalizedMainSection","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"DoReload": {\r\n\t\t\t\t"In": [{ "Name": "qMode","DefaultValue": 0, "Optional": true }, { "Name": "qPartial","DefaultValue": false, "Optional": true }, { "Name": "qDebug","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetScriptBreakpoints": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qBreakpoints" }]\r\n\t\t\t},\r\n\t\t\t"SetScriptBreakpoints": {\r\n\t\t\t\t"In": [{ "Name": "qBreakpoints","DefaultValue": [{"qbufferName": "", "qlineIx": 0, "qEnabled": false}] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetScript": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qScript" }]\r\n\t\t\t},\r\n\t\t\t"GetTextMacros": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qMacros" }]\r\n\t\t\t},\r\n\t\t\t"SetFetchLimit": {\r\n\t\t\t\t"In": [{ "Name": "qLimit","DefaultValue": 0 }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"DoSave": {\r\n\t\t\t\t"In": [{ "Name": "qFileName","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetTableData": {\r\n\t\t\t\t"In": [{ "Name": "qOffset","DefaultValue": 0 }, { "Name": "qRows","DefaultValue": 0 }, { "Name": "qSyntheticMode","DefaultValue": false }, { "Name": "qTableName","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qData" }]\r\n\t\t\t},\r\n\t\t\t"GetAppLayout": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\r\n\t\t\t},\r\n\t\t\t"SetAppProperties": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qTitle": "", "qLastReloadTime": "", "qMigrationHash": "", "qSavedInProductVersion": "", "qThumbnail": {"qUrl": ""}} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetAppProperties": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qProp" }]\r\n\t\t\t},\r\n\t\t\t"CreateSessionObject": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"DestroySessionObject": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"CreateObject": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}} }],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"DestroyObject": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"GetObject": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CloneObject": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qCloneId" }]\r\n\t\t\t},\r\n\t\t\t"CreateDraft": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qDraftId" }]\r\n\t\t\t},\r\n\t\t\t"CommitDraft": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"DestroyDraft": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }, { "Name": "qSourceId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"Undo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"Redo": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"ClearUndoBuffer": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CreateDimension": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qDim": {"qGrouping": 0, "qFieldDefs": [""], "qFieldLabels": [""]}, "qMetaDef": {}} }],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"DestroyDimension": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"GetDimension": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CloneDimension": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qCloneId" }]\r\n\t\t\t},\r\n\t\t\t"CreateMeasure": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMeasure": {"qLabel": "", "qDef": "", "qGrouping": 0, "qExpressions": [""], "qActiveExpression": 0}, "qMetaDef": {}} }],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"DestroyMeasure": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"GetMeasure": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CloneMeasure": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qCloneId" }]\r\n\t\t\t},\r\n\t\t\t"CreateSessionVariable": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}, "qName": "", "qComment": "", "qNumberPresentation": {"qType": 0, "qnDec": 0, "qUseThou": 0, "qFmt": "", "qDec": "", "qThou": ""}, "qIncludeInBookmark": false, "qDefinition": ""} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"DestroySessionVariable": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"CreateVariableEx": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}, "qName": "", "qComment": "", "qNumberPresentation": {"qType": 0, "qnDec": 0, "qUseThou": 0, "qFmt": "", "qDec": "", "qThou": ""}, "qIncludeInBookmark": false, "qDefinition": ""} }],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"DestroyVariableById": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"DestroyVariableByName": {\r\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"GetVariableById": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetVariableByName": {\r\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"MigrateVariables": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"MigrateDerivedFields": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CheckExpression": {\r\n\t\t\t\t"In": [{ "Name": "qExpr","DefaultValue": "" }, { "Name": "qLabels","DefaultValue": [""], "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qErrorMsg" }, { "Name": "qBadFieldNames" }, { "Name": "qDangerousFieldNames" }]\r\n\t\t\t},\r\n\t\t\t"CheckNumberOrExpression": {\r\n\t\t\t\t"In": [{ "Name": "qExpr","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qErrorMsg" }, { "Name": "qBadFieldNames" }]\r\n\t\t\t},\r\n\t\t\t"AddAlternateState": {\r\n\t\t\t\t"In": [{ "Name": "qStateName","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"RemoveAlternateState": {\r\n\t\t\t\t"In": [{ "Name": "qStateName","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CreateBookmark": {\r\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}} }],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"DestroyBookmark": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"GetBookmark": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ApplyBookmark": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"CloneBookmark": {\r\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qCloneId" }]\r\n\t\t\t},\r\n\t\t\t"AddFieldFromExpression": {\r\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }, { "Name": "qExpr","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"GetAllInfos": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qInfos" }]\r\n\t\t\t},\r\n\t\t\t"Resume": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"AbortModal": {\r\n\t\t\t\t"In": [{ "Name": "qAccept","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"Publish": {\r\n\t\t\t\t"In": [{ "Name": "qStreamId","DefaultValue": "" }, { "Name": "qName","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"UnPublish": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetMatchingFields": {\r\n\t\t\t\t"In": [{ "Name": "qTags","DefaultValue": [""] }, { "Name": "qMatchingFieldMode","DefaultValue": 0, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qFieldNames" }]\r\n\t\t\t},\r\n\t\t\t"FindMatchingFields": {\r\n\t\t\t\t"In": [{ "Name": "qFieldName","DefaultValue": "" }, { "Name": "qTags","DefaultValue": [""] }],\r\n\t\t\t\t"Out": [{ "Name": "qFieldNames" }]\r\n\t\t\t},\r\n\t\t\t"SaveObjects": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetAssociationScores": {\r\n\t\t\t\t"In": [{ "Name": "qTable1","DefaultValue": "" }, { "Name": "qTable2","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qScore" }]\r\n\t\t\t},\r\n\t\t\t"GetMediaList": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qList" }]\r\n\t\t\t},\r\n\t\t\t"GetContentLibraries": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qList" }]\r\n\t\t\t},\r\n\t\t\t"GetLibraryContent": {\r\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qList" }]\r\n\t\t\t},\r\n\t\t\t"DoReloadEx": {\r\n\t\t\t\t"In": [{ "Name": "qParams","DefaultValue": {"qMode": 0, "qPartial": false, "qDebug": false}, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qResult" }]\r\n\t\t\t},\r\n\t\t\t"BackCount": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ForwardCount": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SetScript": {\r\n\t\t\t\t"In": [{ "Name": "qScript","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CheckScriptSyntax": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qErrors" }]\r\n\t\t\t},\r\n\t\t\t"GetFavoriteVariables": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qNames" }]\r\n\t\t\t},\r\n\t\t\t"SetFavoriteVariables": {\r\n\t\t\t\t"In": [{ "Name": "qNames","DefaultValue": [""] }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetIncludeFileContent": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qContent" }]\r\n\t\t\t},\r\n\t\t\t"CreateConnection": {\r\n\t\t\t\t"In": [{ "Name": "qConnection","DefaultValue": {"qId": "", "qName": "", "qConnectionString": "", "qType": "", "qUserName": "", "qPassword": "", "qModifiedDate": "", "qMeta": {"qName": ""}, "qLogOn": 0} }],\r\n\t\t\t\t"Out": [{ "Name": "qConnectionId" }]\r\n\t\t\t},\r\n\t\t\t"ModifyConnection": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qConnection","DefaultValue": {"qId": "", "qName": "", "qConnectionString": "", "qType": "", "qUserName": "", "qPassword": "", "qModifiedDate": "", "qMeta": {"qName": ""}, "qLogOn": 0} }, { "Name": "qOverrideCredentials","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"DeleteConnection": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetConnection": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qConnection" }]\r\n\t\t\t},\r\n\t\t\t"GetConnections": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qConnections" }]\r\n\t\t\t},\r\n\t\t\t"GetDatabaseInfo": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\r\n\t\t\t},\r\n\t\t\t"GetDatabases": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qDatabases" }]\r\n\t\t\t},\r\n\t\t\t"GetDatabaseOwners": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qDatabase","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qOwners" }]\r\n\t\t\t},\r\n\t\t\t"GetDatabaseTables": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qDatabase","DefaultValue": "", "Optional": true }, { "Name": "qOwner","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qTables" }]\r\n\t\t\t},\r\n\t\t\t"GetDatabaseTableFields": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qDatabase","DefaultValue": "", "Optional": true }, { "Name": "qOwner","DefaultValue": "", "Optional": true }, { "Name": "qTable","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qFields" }]\r\n\t\t\t},\r\n\t\t\t"GetDatabaseTablePreview": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qDatabase","DefaultValue": "", "Optional": true }, { "Name": "qOwner","DefaultValue": "", "Optional": true }, { "Name": "qTable","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qPreview" }]\r\n\t\t\t},\r\n\t\t\t"GetFolderItemsForConnection": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qFolderItems" }]\r\n\t\t\t},\r\n\t\t\t"GuessFileType": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qDataFormat" }]\r\n\t\t\t},\r\n\t\t\t"GetFileTables": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }, { "Name": "qDataFormat","DefaultValue": {"qType": 0, "qLabel": "", "qQuote": "", "qComment": "", "qDelimiter": {"qName": "", "qScriptCode": "", "qNumber": 0, "qIsMultiple": false}, "qCodePage": 0, "qHeaderSize": 0, "qRecordSize": 0, "qTabSize": 0, "qIgnoreEOF": false, "qFixedWidthDelimiters": ""} }],\r\n\t\t\t\t"Out": [{ "Name": "qTables" }]\r\n\t\t\t},\r\n\t\t\t"GetFileTableFields": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }, { "Name": "qDataFormat","DefaultValue": {"qType": 0, "qLabel": "", "qQuote": "", "qComment": "", "qDelimiter": {"qName": "", "qScriptCode": "", "qNumber": 0, "qIsMultiple": false}, "qCodePage": 0, "qHeaderSize": 0, "qRecordSize": 0, "qTabSize": 0, "qIgnoreEOF": false, "qFixedWidthDelimiters": ""} }, { "Name": "qTable","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qFields" }, { "Name": "qFormatSpec" }]\r\n\t\t\t},\r\n\t\t\t"GetFileTablePreview": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }, { "Name": "qDataFormat","DefaultValue": {"qType": 0, "qLabel": "", "qQuote": "", "qComment": "", "qDelimiter": {"qName": "", "qScriptCode": "", "qNumber": 0, "qIsMultiple": false}, "qCodePage": 0, "qHeaderSize": 0, "qRecordSize": 0, "qTabSize": 0, "qIgnoreEOF": false, "qFixedWidthDelimiters": ""} }, { "Name": "qTable","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qPreview" }, { "Name": "qFormatSpec" }]\r\n\t\t\t},\r\n\t\t\t"GetFileTablesEx": {\r\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }, { "Name": "qDataFormat","DefaultValue": {"qType": 0, "qLabel": "", "qQuote": "", "qComment": "", "qDelimiter": {"qName": "", "qScriptCode": "", "qNumber": 0, "qIsMultiple": false}, "qCodePage": 0, "qHeaderSize": 0, "qRecordSize": 0, "qTabSize": 0, "qIgnoreEOF": false, "qFixedWidthDelimiters": ""} }],\r\n\t\t\t\t"Out": [{ "Name": "qTables" }]\r\n\t\t\t},\r\n\t\t\t"SendGenericCommandToCustomConnector": {\r\n\t\t\t\t"In": [{ "Name": "qProvider","DefaultValue": "" }, { "Name": "qCommand","DefaultValue": "" }, { "Name": "qMethod","DefaultValue": "" }, { "Name": "qParameters","DefaultValue": [""] }, { "Name": "qAppendConnection","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qResult" }]\r\n\t\t\t},\r\n\t\t\t"SearchSuggest": {\r\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qSearchFields": [""], "qContext": 0} }, { "Name": "qTerms","DefaultValue": [""] }],\r\n\t\t\t\t"Out": [{ "Name": "qResult" }]\r\n\t\t\t},\r\n\t\t\t"SearchAssociations": {\r\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qSearchFields": [""], "qContext": 0} }, { "Name": "qTerms","DefaultValue": [""] }, { "Name": "qPage","DefaultValue": {"qOffset": 0, "qCount": 0, "qMaxNbrFieldMatches": 0, "qGroupOptions": [{"qGroupType": 0, "qOffset": 0, "qCount": 0}], "qGroupItemOptions": [{"qGroupItemType": 0, "qOffset": 0, "qCount": 0}]} }],\r\n\t\t\t\t"Out": [{ "Name": "qResults" }]\r\n\t\t\t},\r\n\t\t\t"SelectAssociations": {\r\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qSearchFields": [""], "qContext": 0} }, { "Name": "qTerms","DefaultValue": [""] }, { "Name": "qMatchIx","DefaultValue": 0 }, { "Name": "qSoftLock","DefaultValue": null, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"SearchResults": {\r\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qSearchFields": [""], "qContext": 0} }, { "Name": "qTerms","DefaultValue": [""] }, { "Name": "qPage","DefaultValue": {"qOffset": 0, "qCount": 0, "qMaxNbrFieldMatches": 0, "qGroupOptions": [{"qGroupType": 0, "qOffset": 0, "qCount": 0}], "qGroupItemOptions": [{"qGroupItemType": 0, "qOffset": 0, "qCount": 0}]} }],\r\n\t\t\t\t"Out": [{ "Name": "qResult" }]\r\n\t\t\t},\r\n\t\t\t"SearchObjects": {\r\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qAttributes": [""]} }, { "Name": "qTerms","DefaultValue": [""] }, { "Name": "qPage","DefaultValue": {"qOffset": 0, "qCount": 0, "qMaxNbrFieldMatches": 0, "qGroupOptions": [{"qGroupType": 0, "qOffset": 0, "qCount": 0}], "qGroupItemOptions": [{"qGroupItemType": 0, "qOffset": 0, "qCount": 0}]} }],\r\n\t\t\t\t"Out": [{ "Name": "qResult" }]\r\n\t\t\t}\r\n\t\t},\r\n\t\t"Global":{\r\n\t\t\t"AbortRequest": {\r\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"AbortAll": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetProgress": {\r\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }],\r\n\t\t\t\t"Out": [{ "Name": "qProgressData" }]\r\n\t\t\t},\r\n\t\t\t"QvVersion": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"OSVersion": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"OSName": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"QTProduct": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetDocList": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qDocList" }]\r\n\t\t\t},\r\n\t\t\t"GetInteract": {\r\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }],\r\n\t\t\t\t"Out": [{ "Name": "qDef" }]\r\n\t\t\t},\r\n\t\t\t"InteractDone": {\r\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }, { "Name": "qDef","DefaultValue": {"qType": 0, "qTitle": "", "qMsg": "", "qButtons": 0, "qLine": "", "qOldLineNr": 0, "qNewLineNr": 0, "qPath": "", "qHidden": false, "qResult": 0, "qInput": ""} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetAuthenticatedUser": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetStreamList": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qStreamList" }]\r\n\t\t\t},\r\n\t\t\t"UploadToContentService": {\r\n\t\t\t\t"In": [{ "Name": "qDirectory","DefaultValue": "" }, { "Name": "qAppId","DefaultValue": "" }, { "Name": "qQrsObjects","DefaultValue": [{"qEngineObjectID": "", "qItemID": ""}] }],\r\n\t\t\t\t"Out": [{ "Name": "qUploadedObjects" }]\r\n\t\t\t},\r\n\t\t\t"CreateDocEx": {\r\n\t\t\t\t"In": [{ "Name": "qDocName","DefaultValue": "" }, { "Name": "qUserName","DefaultValue": "", "Optional": true }, { "Name": "qPassword","DefaultValue": "", "Optional": true }, { "Name": "qSerial","DefaultValue": "", "Optional": true }, { "Name": "qLocalizedScriptMainSection","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qDocId" }]\r\n\t\t\t},\r\n\t\t\t"GetActiveDoc": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"AllowCreateApp": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CreateApp": {\r\n\t\t\t\t"In": [{ "Name": "qAppName","DefaultValue": "" }, { "Name": "qLocalizedScriptMainSection","DefaultValue": "", "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }, { "Name": "qAppId" }]\r\n\t\t\t},\r\n\t\t\t"DeleteApp": {\r\n\t\t\t\t"In": [{ "Name": "qAppId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"IsDesktopMode": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetConfiguration": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qConfig" }]\r\n\t\t\t},\r\n\t\t\t"CancelRequest": {\r\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ShutdownProcess": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ReloadExtensionList": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ReplaceAppFromID": {\r\n\t\t\t\t"In": [{ "Name": "qTargetAppId","DefaultValue": "" }, { "Name": "qSrcAppID","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"CopyApp": {\r\n\t\t\t\t"In": [{ "Name": "qTargetAppId","DefaultValue": "" }, { "Name": "qSrcAppId","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"ImportApp": {\r\n\t\t\t\t"In": [{ "Name": "qAppId","DefaultValue": "" }, { "Name": "qSrcPath","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"ImportAppEx": {\r\n\t\t\t\t"In": [{ "Name": "qAppId","DefaultValue": "" }, { "Name": "qSrcPath","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }, { "Name": "qExcludeConnections","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"ExportApp": {\r\n\t\t\t\t"In": [{ "Name": "qTargetPath","DefaultValue": "" }, { "Name": "qSrcAppId","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }],\r\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\r\n\t\t\t},\r\n\t\t\t"PublishApp": {\r\n\t\t\t\t"In": [{ "Name": "qAppId","DefaultValue": "" }, { "Name": "qName","DefaultValue": "" }, { "Name": "qStreamId","DefaultValue": "" }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"IsPersonalMode": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetUniqueID": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qUniqueID" }]\r\n\t\t\t},\r\n\t\t\t"OpenDoc": {\r\n\t\t\t\t"In": [{ "Name": "qDocName","DefaultValue": "" }, { "Name": "qUserName","DefaultValue": "", "Optional": true }, { "Name": "qPassword","DefaultValue": "", "Optional": true }, { "Name": "qSerial","DefaultValue": "", "Optional": true }, { "Name": "qNoData","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CreateSessionApp": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qSessionAppId" }]\r\n\t\t\t},\r\n\t\t\t"CreateSessionAppFromApp": {\r\n\t\t\t\t"In": [{ "Name": "qSrcAppId","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qSessionAppId" }]\r\n\t\t\t},\r\n\t\t\t"ProductVersion": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetAppEntry": {\r\n\t\t\t\t"In": [{ "Name": "qAppID","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qEntry" }]\r\n\t\t\t},\r\n\t\t\t"ConfigureReload": {\r\n\t\t\t\t"In": [{ "Name": "qCancelOnScriptError","DefaultValue": false }, { "Name": "qUseErrorData","DefaultValue": false }, { "Name": "qInteractOnError","DefaultValue": false }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"CancelReload": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetBNF": {\r\n\t\t\t\t"In": [{ "Name": "qBnfType","DefaultValue": 0 }],\r\n\t\t\t\t"Out": [{ "Name": "qBnfDefs" }]\r\n\t\t\t},\r\n\t\t\t"GetFunctions": {\r\n\t\t\t\t"In": [{ "Name": "qGroup","DefaultValue": 0, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qFunctions" }]\r\n\t\t\t},\r\n\t\t\t"GetOdbcDsns": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qOdbcDsns" }]\r\n\t\t\t},\r\n\t\t\t"GetOleDbProviders": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qOleDbProviders" }]\r\n\t\t\t},\r\n\t\t\t"GetDatabasesFromConnectionString": {\r\n\t\t\t\t"In": [{ "Name": "qConnection","DefaultValue": {"qId": "", "qName": "", "qConnectionString": "", "qType": "", "qUserName": "", "qPassword": "", "qModifiedDate": "", "qMeta": {"qName": ""}, "qLogOn": 0} }],\r\n\t\t\t\t"Out": [{ "Name": "qDatabases" }]\r\n\t\t\t},\r\n\t\t\t"IsValidConnectionString": {\r\n\t\t\t\t"In": [{ "Name": "qConnection","DefaultValue": {"qId": "", "qName": "", "qConnectionString": "", "qType": "", "qUserName": "", "qPassword": "", "qModifiedDate": "", "qMeta": {"qName": ""}, "qLogOn": 0} }],\r\n\t\t\t\t"Out": []\r\n\t\t\t},\r\n\t\t\t"GetDefaultAppFolder": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qPath" }]\r\n\t\t\t},\r\n\t\t\t"GetMyDocumentsFolder": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qFolder" }]\r\n\t\t\t},\r\n\t\t\t"GetLogicalDriveStrings": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qDrives" }]\r\n\t\t\t},\r\n\t\t\t"GetFolderItemsForPath": {\r\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }],\r\n\t\t\t\t"Out": [{ "Name": "qFolderItems" }]\r\n\t\t\t},\r\n\t\t\t"GetSupportedCodePages": {\r\n\t\t\t\t"In": [],\r\n\t\t\t\t"Out": [{ "Name": "qCodePages" }]\r\n\t\t\t},\r\n\t\t\t"GetCustomConnectors": {\r\n\t\t\t\t"In": [{ "Name": "qReloadList","DefaultValue": false, "Optional": true }],\r\n\t\t\t\t"Out": [{ "Name": "qConnectors" }]\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t"enums": {\r\n\t\t"LocalizedMessageCode": {\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_EMPTY_MESSAGE": 0,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_SAVING_STARTED": 1,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_BYTES_LEFT": 2,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_STORING_TABLES": 3,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWS_SO_FAR": 4,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTED": 5,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTING_TO": 6,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECT_FAILED": 7,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWISH": 8,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_COLUMNAR": 9,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_ERROR": 10,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_DONE": 11,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_LOAD_EXTERNAL_DATA": 12,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_OLD_QVD_ISLOADING": 13,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_LOADING": 14,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_BUFFERED": 15,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_PREPARING": 16,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_APPENDING": 17,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_REMOVE_SYNTHETIC": 18,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_PENDING_LINKEDTABLE_FETCHING": 19,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_RELOAD": 20,\r\n\t\t\t"LOCMSG_SCRIPTEDITOR_LINES_FETCHED": 21\r\n\t\t},\r\n\t\t"QrsChangeType": {\r\n\t\t\t"QRS_CHANGE_UNDEFINED": 0,\r\n\t\t\t"QRS_CHANGE_ADD": 1,\r\n\t\t\t"QRS_CHANGE_UPDATE": 2,\r\n\t\t\t"QRS_CHANGE_DELETE": 3\r\n\t\t},\r\n\t\t"LocalizedErrorCode": {\r\n\t\t\t"LOCERR_INTERNAL_ERROR": -128,\r\n\t\t\t"LOCERR_GENERIC_UNKNOWN": -1,\r\n\t\t\t"LOCERR_GENERIC_OK": 0,\r\n\t\t\t"LOCERR_GENERIC_NOT_SET": 1,\r\n\t\t\t"LOCERR_GENERIC_NOT_FOUND": 2,\r\n\t\t\t"LOCERR_GENERIC_ALREADY_EXISTS": 3,\r\n\t\t\t"LOCERR_GENERIC_INVALID_PATH": 4,\r\n\t\t\t"LOCERR_GENERIC_ACCESS_DENIED": 5,\r\n\t\t\t"LOCERR_GENERIC_OUT_OF_MEMORY": 6,\r\n\t\t\t"LOCERR_GENERIC_NOT_INITIALIZED": 7,\r\n\t\t\t"LOCERR_GENERIC_INVALID_PARAMETERS": 8,\r\n\t\t\t"LOCERR_GENERIC_EMPTY_PARAMETERS": 9,\r\n\t\t\t"LOCERR_GENERIC_INTERNAL_ERROR": 10,\r\n\t\t\t"LOCERR_GENERIC_CORRUPT_DATA": 11,\r\n\t\t\t"LOCERR_GENERIC_MEMORY_INCONSISTENCY": 12,\r\n\t\t\t"LOCERR_GENERIC_INVISIBLE_OWNER_ABORT": 13,\r\n\t\t\t"LOCERR_GENERIC_PROHIBIT_VALIDATE": 14,\r\n\t\t\t"LOCERR_GENERIC_ABORTED": 15,\r\n\t\t\t"LOCERR_GENERIC_CONNECTION_LOST": 16,\r\n\t\t\t"LOCERR_GENERIC_UNSUPPORTED_IN_PRODUCT_VERSION": 17,\r\n\t\t\t"LOCERR_GENERIC_REST_CONNECTION_FAILURE": 18,\r\n\t\t\t"LOCERR_HTTP_400": 400,\r\n\t\t\t"LOCERR_HTTP_401": 401,\r\n\t\t\t"LOCERR_HTTP_402": 402,\r\n\t\t\t"LOCERR_HTTP_403": 403,\r\n\t\t\t"LOCERR_HTTP_404": 404,\r\n\t\t\t"LOCERR_HTTP_405": 405,\r\n\t\t\t"LOCERR_HTTP_406": 406,\r\n\t\t\t"LOCERR_HTTP_407": 407,\r\n\t\t\t"LOCERR_HTTP_408": 408,\r\n\t\t\t"LOCERR_HTTP_409": 409,\r\n\t\t\t"LOCERR_HTTP_410": 410,\r\n\t\t\t"LOCERR_HTTP_411": 411,\r\n\t\t\t"LOCERR_HTTP_412": 412,\r\n\t\t\t"LOCERR_HTTP_413": 413,\r\n\t\t\t"LOCERR_HTTP_414": 414,\r\n\t\t\t"LOCERR_HTTP_415": 415,\r\n\t\t\t"LOCERR_HTTP_416": 416,\r\n\t\t\t"LOCERR_HTTP_417": 417,\r\n\t\t\t"LOCERR_HTTP_500": 500,\r\n\t\t\t"LOCERR_HTTP_501": 501,\r\n\t\t\t"LOCERR_HTTP_502": 502,\r\n\t\t\t"LOCERR_HTTP_503": 503,\r\n\t\t\t"LOCERR_HTTP_504": 504,\r\n\t\t\t"LOCERR_HTTP_505": 505,\r\n\t\t\t"LOCERR_HTTP_509": 509,\r\n\t\t\t"LOCERR_APP_ALREADY_EXISTS": 1000,\r\n\t\t\t"LOCERR_APP_INVALID_NAME": 1001,\r\n\t\t\t"LOCERR_APP_ALREADY_OPEN": 1002,\r\n\t\t\t"LOCERR_APP_NOT_FOUND": 1003,\r\n\t\t\t"LOCERR_APP_IMPORT_FAILED": 1004,\r\n\t\t\t"LOCERR_APP_SAVE_FAILED": 1005,\r\n\t\t\t"LOCERR_APP_CREATE_FAILED": 1006,\r\n\t\t\t"LOCERR_APP_INVALID": 1007,\r\n\t\t\t"LOCERR_APP_CONNECT_FAILED": 1008,\r\n\t\t\t"LOCERR_APP_ALREADY_OPEN_IN_DIFFERENT_MODE": 1009,\r\n\t\t\t"LOCERR_APP_MIGRATION_COULD_NOT_CONTACT_MIGRATION_SERVICE": 1010,\r\n\t\t\t"LOCERR_APP_MIGRATION_COULD_NOT_START_MIGRATION": 1011,\r\n\t\t\t"LOCERR_APP_MIGRATION_FAILURE": 1012,\r\n\t\t\t"LOCERR_APP_SCRIPT_MISSING": 1013,\r\n\t\t\t"LOCERR_CONNECTION_ALREADY_EXISTS": 2000,\r\n\t\t\t"LOCERR_CONNECTION_NOT_FOUND": 2001,\r\n\t\t\t"LOCERR_CONNECTION_FAILED_TO_LOAD": 2002,\r\n\t\t\t"LOCERR_CONNECTION_FAILED_TO_IMPORT": 2003,\r\n\t\t\t"LOCERR_CONNECTION_NAME_IS_INVALID": 2004,\r\n\t\t\t"LOCERR_FILE_ACCESS_DENIED": 3000,\r\n\t\t\t"LOCERR_FILE_NAME_INVALID": 3001,\r\n\t\t\t"LOCERR_FILE_CORRUPT": 3002,\r\n\t\t\t"LOCERR_FILE_NOT_FOUND": 3003,\r\n\t\t\t"LOCERR_FILE_FORMAT_UNSUPPORTED": 3004,\r\n\t\t\t"LOCERR_FILE_OPENED_IN_UNSUPPORTED_MODE": 3005,\r\n\t\t\t"LOCERR_USER_ACCESS_DENIED": 4000,\r\n\t\t\t"LOCERR_USER_IMPERSONATION_FAILED": 4001,\r\n\t\t\t"LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS": 5000,\r\n\t\t\t"LOCERR_SERVER_OUT_OF_SESSION_CALS": 5001,\r\n\t\t\t"LOCERR_SERVER_OUT_OF_USAGE_CALS": 5002,\r\n\t\t\t"LOCERR_SERVER_OUT_OF_CALS": 5003,\r\n\t\t\t"LOCERR_SERVER_OUT_OF_NAMED_CALS": 5004,\r\n\t\t\t"LOCERR_SERVER_OFF_DUTY": 5005,\r\n\t\t\t"LOCERR_SERVER_BUSY": 5006,\r\n\t\t\t"LOCERR_SERVER_LICENSE_EXPIRED": 5007,\r\n\t\t\t"LOCERR_SERVER_AJAX_DISABLED": 5008,\r\n\t\t\t"LOCERR_HC_INVALID_OBJECT": 6000,\r\n\t\t\t"LOCERR_HC_RESULT_TOO_LARGE": 6001,\r\n\t\t\t"LOCERR_HC_INVALID_OBJECT_STATE": 6002,\r\n\t\t\t"LOCERR_HC_MODAL_OBJECT_ERROR": 6003,\r\n\t\t\t"LOCERR_CALC_INVALID_DEF": 7000,\r\n\t\t\t"LOCERR_CALC_NOT_IN_LIB": 7001,\r\n\t\t\t"LOCERR_CALC_HEAP_ERROR": 7002,\r\n\t\t\t"LOCERR_CALC_TOO_LARGE": 7003,\r\n\t\t\t"LOCERR_CALC_TIMEOUT": 7004,\r\n\t\t\t"LOCERR_CALC_EVAL_CONDITION_FAILED": 7005,\r\n\t\t\t"LOCERR_CALC_MIXED_LINKED_AGGREGATION": 7006,\r\n\t\t\t"LOCERR_CALC_MISSING_LINKED": 7007,\r\n\t\t\t"LOCERR_CALC_INVALID_COL_SORT": 7008,\r\n\t\t\t"LOCERR_CALC_PAGES_TOO_LARGE": 7009,\r\n\t\t\t"LOCERR_CALC_SEMANTIC_FIELD_NOT_ALLOWED": 7010,\r\n\t\t\t"LOCERR_CALC_VALIDATION_STATE_INVALID": 7011,\r\n\t\t\t"LOCERR_CALC_PIVOT_DIMENSIONS_ALREADY_EXISTS": 7012,\r\n\t\t\t"LOCERR_CALC_MISSING_LINKED_FIELD": 7013,\r\n\t\t\t"LOCERR_LAYOUT_EXTENDS_INVALID_ID": 8000,\r\n\t\t\t"LOCERR_LAYOUT_LINKED_OBJECT_NOT_FOUND": 8001,\r\n\t\t\t"LOCERR_LAYOUT_LINKED_OBJECT_INVALID": 8002,\r\n\t\t\t"LOCERR_PERSISTENCE_WRITE_FAILED": 9000,\r\n\t\t\t"LOCERR_PERSISTENCE_READ_FAILED": 9001,\r\n\t\t\t"LOCERR_PERSISTENCE_DELETE_FAILED": 9002,\r\n\t\t\t"LOCERR_PERSISTENCE_NOT_FOUND": 9003,\r\n\t\t\t"LOCERR_PERSISTENCE_UNSUPPORTED_VERSION": 9004,\r\n\t\t\t"LOCERR_PERSISTENCE_MIGRATION_FAILED_READ_ONLY": 9005,\r\n\t\t\t"LOCERR_PERSISTENCE_MIGRATION_CANCELLED": 9006,\r\n\t\t\t"LOCERR_PERSISTENCE_MIGRATION_BACKUP_FAILED": 9007,\r\n\t\t\t"LOCERR_PERSISTENCE_DISK_FULL": 9008,\r\n\t\t\t"LOCERR_PERSISTENCE_NOT_SUPPORTED_FOR_SESSION_APP": 9009,\r\n\t\t\t"LOCERR_PERSISTENCE_SYNC_SET_CHUNK_INVALID_PARAMETERS": 9510,\r\n\t\t\t"LOCERR_PERSISTENCE_SYNC_GET_CHUNK_INVALID_PARAMETERS": 9511,\r\n\t\t\t"LOCERR_SCRIPT_DATASOURCE_ACCESS_DENIED": 10000,\r\n\t\t\t"LOCERR_RELOAD_IN_PROGRESS": 11000,\r\n\t\t\t"LOCERR_PERSONAL_NEW_VERSION_AVAILABLE": 12000,\r\n\t\t\t"LOCERR_PERSONAL_VERSION_EXPIRED": 12001,\r\n\t\t\t"LOCERR_PERSONAL_SECTION_ACCESS_DETECTED": 12002,\r\n\t\t\t"LOCERR_PERSONAL_APP_DELETION_FAILED": 12003,\r\n\t\t\t"LOCERR_EXPORT_OUT_OF_MEMORY": 13000,\r\n\t\t\t"LOCERR_EXPORT_NO_DATA": 13001,\r\n\t\t\t"LOCERR_SYNC_INVALID_OFFSET": 14000,\r\n\t\t\t"LOCERR_SEARCH_TIMEOUT": 15000,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_LINKED_EXPRESSION_FAIL": 16000,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_ROWCOUNT_OVERFLOW": 16001,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_EMPTY_RESULT": 16002,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_DB_CONNECTION_FAILED": 16003,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_MEASURE_NOT_ALLOWED": 16004,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_DETAIL_NOT_ALLOWED": 16005,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_NOT_SYNTH_CIRCULAR_ALLOWED": 16006,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_ONLY_ONE_DD_TABLE_ALLOWED": 16007,\r\n\t\t\t"LOCERR_DIRECT_DISCOVERY_DB_AUTHORIZATION_FAILED": 16008,\r\n\t\t\t"LOCERR_SMART_LOAD_TABLE_NOT_FOUND": 17000,\r\n\t\t\t"LOCERR_SMART_LOAD_TABLE_DUPLICATED": 17001,\r\n\t\t\t"LOCERR_VARIABLE_NO_NAME": 18000,\r\n\t\t\t"LOCERR_VARIABLE_DUPLICATE_NAME": 18001,\r\n\t\t\t"LOCERR_VARIABLE_INCONSISTENCY": 18002,\r\n\t\t\t"LOCERR_MEDIA_LIBRARY_LIST_FAILED": 19000,\r\n\t\t\t"LOCERR_MEDIA_LIBRARY_CONTENT_FAILED": 19001,\r\n\t\t\t"LOCERR_MEDIA_BUNDLING_FAILED": 19002,\r\n\t\t\t"LOCERR_MEDIA_UNBUNDLING_FAILED": 19003,\r\n\t\t\t"LOCERR_MEDIA_LIBRARY_NOT_FOUND": 19004,\r\n\t\t\t"LOCERR_FEATURE_DISABLED": 20000,\r\n\t\t\t"LOCERR_JSON_RPC_INVALID_REQUEST": -32600,\r\n\t\t\t"LOCERR_JSON_RPC_METHOD_NOT_FOUND": -32601,\r\n\t\t\t"LOCERR_JSON_RPC_INVALID_PARAMETERS": -32602,\r\n\t\t\t"LOCERR_JSON_RPC_INTERNAL_ERROR": -32603,\r\n\t\t\t"LOCERR_JSON_RPC_PARSE_ERROR": -32700\r\n\t\t},\r\n\t\t"LocalizedWarningCode": {\r\n\t\t\t"LOCWARN_PERSONAL_RELOAD_REQUIRED": 0,\r\n\t\t\t"LOCWARN_PERSONAL_VERSION_EXPIRES_SOON": 1,\r\n\t\t\t"LOCWARN_EXPORT_DATA_TRUNCATED": 1000,\r\n\t\t\t"LOCWARN_COULD_NOT_OPEN_ALL_OBJECTS": 2000\r\n\t\t},\r\n\t\t"GrpType": {\r\n\t\t\t"GRP_NX_NONE": 0,\r\n\t\t\t"GRP_NX_HIEARCHY": 1,\r\n\t\t\t"GRP_NX_COLLECTION": 2\r\n\t\t},\r\n\t\t"ExportFileType": {\r\n\t\t\t"EXPORT_CSV_C": 0,\r\n\t\t\t"EXPORT_CSV_T": 1,\r\n\t\t\t"EXPORT_OOXML": 2\r\n\t\t},\r\n\t\t"ExportState": {\r\n\t\t\t"EXPORT_POSSIBLE": 0,\r\n\t\t\t"EXPORT_ALL": 1\r\n\t\t},\r\n\t\t"DimCellType": {\r\n\t\t\t"NX_DIM_CELL_VALUE": 0,\r\n\t\t\t"NX_DIM_CELL_EMPTY": 1,\r\n\t\t\t"NX_DIM_CELL_NORMAL": 2,\r\n\t\t\t"NX_DIM_CELL_TOTAL": 3,\r\n\t\t\t"NX_DIM_CELL_OTHER": 4,\r\n\t\t\t"NX_DIM_CELL_AGGR": 5,\r\n\t\t\t"NX_DIM_CELL_PSEUDO": 6,\r\n\t\t\t"NX_DIM_CELL_ROOT": 7,\r\n\t\t\t"NX_DIM_CELL_NULL": 8\r\n\t\t},\r\n\t\t"StackElemType": {\r\n\t\t\t"NX_STACK_CELL_NORMAL": 0,\r\n\t\t\t"NX_STACK_CELL_TOTAL": 1,\r\n\t\t\t"NX_STACK_CELL_OTHER": 2,\r\n\t\t\t"NX_STACK_CELL_SUM": 3,\r\n\t\t\t"NX_STACK_CELL_VALUE": 4,\r\n\t\t\t"NX_STACK_CELL_PSEUDO": 5\r\n\t\t},\r\n\t\t"SortIndicatorType": {\r\n\t\t\t"NX_SORT_INDICATE_NONE": 0,\r\n\t\t\t"NX_SORT_INDICATE_ASC": 1,\r\n\t\t\t"NX_SORT_INDICATE_DESC": 2\r\n\t\t},\r\n\t\t"DimensionType": {\r\n\t\t\t"NX_DIMENSION_TYPE_DISCRETE": 0,\r\n\t\t\t"NX_DIMENSION_TYPE_NUMERIC": 1,\r\n\t\t\t"NX_DIMENSION_TYPE_TIME": 2\r\n\t\t},\r\n\t\t"FieldSelectionMode": {\r\n\t\t\t"SELECTION_MODE_NORMAL": 0,\r\n\t\t\t"SELECTION_MODE_AND": 1,\r\n\t\t\t"SELECTION_MODE_NOT": 2\r\n\t\t},\r\n\t\t"FrequencyMode": {\r\n\t\t\t"NX_FREQUENCY_NONE": 0,\r\n\t\t\t"NX_FREQUENCY_VALUE": 1,\r\n\t\t\t"NX_FREQUENCY_PERCENT": 2,\r\n\t\t\t"NX_FREQUENCY_RELATIVE": 3\r\n\t\t},\r\n\t\t"DataReductionMode": {\r\n\t\t\t"DATA_REDUCTION_NONE": 0,\r\n\t\t\t"DATA_REDUCTION_ONEDIM": 1,\r\n\t\t\t"DATA_REDUCTION_SCATTERED": 2,\r\n\t\t\t"DATA_REDUCTION_CLUSTERED": 3,\r\n\t\t\t"DATA_REDUCTION_STACKED": 4\r\n\t\t},\r\n\t\t"HypercubeMode": {\r\n\t\t\t"DATA_MODE_STRAIGHT": 0,\r\n\t\t\t"DATA_MODE_PIVOT": 1,\r\n\t\t\t"DATA_MODE_PIVOT_STACK": 2\r\n\t\t},\r\n\t\t"PatchOperationType": {\r\n\t\t\t"Add": 0,\r\n\t\t\t"Remove": 1,\r\n\t\t\t"Replace": 2\r\n\t\t},\r\n\t\t"SelectionCellType": {\r\n\t\t\t"NX_CELL_DATA": 0,\r\n\t\t\t"NX_CELL_TOP": 1,\r\n\t\t\t"NX_CELL_LEFT": 2\r\n\t\t},\r\n\t\t"MatchingFieldMode": {\r\n\t\t\t"MATCHINGFIELDMODE_MATCH_ALL": 0,\r\n\t\t\t"MATCHINGFIELDMODE_MATCH_ONE": 1\r\n\t\t},\r\n\t\t"ExtEngineDataType": {\r\n\t\t\t"NX_EXT_DATATYPE_STRING": 0,\r\n\t\t\t"NX_EXT_DATATYPE_DOUBLE": 1,\r\n\t\t\t"NX_EXT_DATATYPE_BOTH": 2\r\n\t\t},\r\n\t\t"ExtEngineFunctionType": {\r\n\t\t\t"NX_EXT_FUNCTIONTYPE_SCALAR": 0,\r\n\t\t\t"NX_EXT_FUNCTIONTYPE_AGGR": 1,\r\n\t\t\t"NX_EXT_FUNCTIONTYPE_TENSOR": 2\r\n\t\t},\r\n\t\t"ExtEngineMsgType": {\r\n\t\t\t"NX_EXT_MSGTYPE_FUNCTION_CALL": 1,\r\n\t\t\t"NX_EXT_MSGTYPE_SCRIPT_CALL": 2,\r\n\t\t\t"NX_EXT_MSGTYPE_RETURN_VALUE": 3,\r\n\t\t\t"NX_EXT_MSGTYPE_RETURN_MULTIPLE": 4,\r\n\t\t\t"NX_EXT_MSGTYPE_RETURN_ERROR": 5\r\n\t\t}\r\n\t}\r\n}';
}),define("autogenerated/qix/engine-api",["text!autogenerated/qix/jsonspec.json"],function(a){return JSON.parse(a)}),define("autogenerated/qix/engine-enums",["./engine-api"],function(a){var b=a.enums;for(var c in b)b["Nx"+c]=b[c];return b}),define("core.utils/authentication",["jquery"],function(a){"use strict";var b,c,d,e,f={},g=!1,h=a.Deferred();return f.parse=function(a){b=a.userId,c=a.userDirectory,g=a.mustAuthenticate,e=a.loginUri,d=a.logoutUri,g===!0&&a.loginUri&&(window.location.href=a.loginUri),h.resolve(this)},f.onDataReceived=h.promise(),Object.defineProperties(f,{userId:{get:function(){return b}},userDirectory:{get:function(){return c}},mustAuthenticate:{get:function(){return g}},loginUri:{get:function(){return e}},logoutUri:{get:function(){return d}}}),f}),define("core.models/rpc-base",["core.utils/deferred","core.utils/notification","core.utils/class","core.utils/json-patch","core.utils/debug-flags","core.utils/permissions","core.utils/model-garbage-collector","autogenerated/qix/engine-enums","core.utils/authentication"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){Array.isArray(b)?d.apply(a,b):d.updateObject(a,b)}var k,l,m=h.NxLocalizedErrorCode,n=["GetLayout","GetAppLayout","AbortModal","DoSave"];i.onDataReceived.then(function(a){"NONE"!==a.userDirectory&&(k=a.userId,l=a.userDirectory)});var o=c.extend("RPCBase",{init:function(a){var c=this;b.mixin(c),c.notification("Validated"),c.notification("Invalidated"),c.notification("Aborted"),c.notification("Validating"),c.notification("Closed"),c.notification("Closing"),c.notification("Cancelled"),c.id=a.id,c.session=a.session,c.handle=a.handle,c.layout={},c._properties={},c.properties={},c.propertyTree={},c.ongoingRequests={},c.needCacheProperties=!0,c._effectiveProperties={},c.effectiveProperties={},c.needCacheEffectiveProperties=!0,c.setState(o.States.INVALID),f.mapToLayout(c.layout,a.checkCreate),"App"!==c.constructor.name&&c.bindToRPC(),c.enigmaModel=a.enigmaModel},bindToRPC:function(){var a=this;a.session.onChange(a.handle,a.changeHandler.bind(a)),a.Aborted.bind(a.clearPending.bind(a)),a.Cancelled.bind(a.clearPending.bind(a))},changeHandler:function(){var a=this;a.clearPending(),a.needCacheProperties=!0,a.needCacheEffectiveProperties=!0,a.isCancelled||a.setState(o.States.INVALID)},clearPending:function(){for(var a in this.ongoingRequests)delete this.ongoingRequests[a]},publish:function(){return this.layout.permissions.publish?this.rpc("Publish"):a.reject("permission denied")},unpublish:function(){var b=this,c=a();return b.getLayout().then(function(a){return!a.qMeta.published||a.qMeta.approved||a.qMeta.owner.userId!==k||a.qMeta.owner.userDirectory!==l?c.reject("permission denied"):void b.rpc("UnPublish").then(function(a){c.resolve(a)})}),c.promise},setState:function(a){var b=this,c=b.state;delete this.__layoutRPCId,b.state=a,c!==b.state&&(a===o.States.INVALID?b.Invalidated.emit():a===o.States.VALID?b.Validated.emit():a===o.States.ABORTED?b.Aborted.emit():a===o.States.VALIDATING?b.Validating.emit():a===o.States.CLOSED?b.Closed.emit():a===o.States.CLOSING?b.Closing.emit():a===o.States.CANCELLED&&b.Cancelled.emit())},getLayout:function(b,c){function d(a){return e.DELTA&&h&&window.console.info("[DBGFLG:DELTA] APPLY ["+g.constructor.name+"]:",a),j(g.layout,a),g.setState(o.States.VALID),g.layout}function f(b){return b.error.code!==m.LOCERR_GENERIC_ABORTED||g.isCancelled||(g.setState(o.States.INVALID),b.error.isHandled=!0),a.reject(b)}var g=this,h=!0;if(g.isValid||g.isCancelled)return a.resolve(g.layout);if(b=b||"GetLayout",c=c||"qLayout",g.isValidating||g.setState(o.States.VALIDATING),g.ongoingRequests[b+h])return g.ongoingRequests[b+h];var i=g.rpc(b,c,[],{delta:h}),k=i.then(d,f);return g.__layoutRPCId=i.rpcId,g.ongoingRequests[b+h]=k,k},getProperties:function(b){var c=this,e=!1;if(b=b||"GetProperties",c.isValid&&!c.needCacheProperties)return a.resolve(c.properties);if(c.ongoingRequests[b+e])return c.ongoingRequests[b+e];var f=c.rpc(b,"qProp",[],{delta:e}).then(function(a){var b=d.generate(c._properties,a);return c._properties=a,d.apply(c.properties,b),c.isValid&&(c.needCacheProperties=!1),c.properties});return c.ongoingRequests[b+e]=f,f},getEffectiveProperties:function(){var b=this,c=!1,e="GetEffectiveProperties";if(b.isValid&&!b.needCacheEffectiveProperties)return a.resolve(b.effectiveProperties);if(b.ongoingRequests[e+c])return b.ongoingRequests[e+c];var f=b.rpc(e,"qProp",[],{delta:c}).then(function(a){var c=d.generate(b._effectiveProperties,a);return b._effectiveProperties=a,d.apply(b.effectiveProperties,c),b.isValid&&(b.needCacheEffectiveProperties=!1),b.effectiveProperties});return b.ongoingRequests[e+c]=f,f},hasChanges:function(){var a=d.generate(this._properties,this.properties);return a.length>0},markAsInvalid:function(){this.state=-99,this.setState(o.States.INVALID)},markAsCancelled:function(){this.setState(o.States.CANCELLED)},getFullPropertyTree:function(a){var b=this,c=!1;return a=a||"GetFullPropertyTree",b.rpc(a,"qPropEntry",[],c).then(function(a){return b._propertyTree=a,j(b.propertyTree,a),b.propertyTree})},setProperties:function(a,b,c){var e=this;return b=b||"SetProperties",Array.isArray(a)||(a=[a]),this.rpc(b,null,a,c).then(function(){d.updateObject(e._properties,e.properties)})},setFullPropertyTree:function(a,b,c){return b=b||"SetFullPropertyTree",Array.isArray(a)||(a=[a]),this.rpc(b,null,a,c)},save:function(){return this.hasChanges()?this.setProperties(this.properties):a.resolve()},saveTree:function(){return this.setFullPropertyTree(this.propertyTree)},getChildInfos:function(){return this.rpc("GetChildInfos","qInfos",[])},close:function(){var b=this;b.setState(o.States.CLOSING);var c=a.resolve();delete b.session.changeHandlers[b.handle],delete b.session.modelCache[b.id];for(var d in b.ongoingRequests)b.ongoingRequests[d].then&&b.ongoingRequests[d].then(null,function(a){a.error.isHandled=!0});return c.then(function(){b.setState(o.States.CLOSED),g.addToQueue(b)})},rpc:function(b,c,d,e){e=e||{delta:!1,raw:!1};var f=this,g=[].slice.call(arguments);if(!f.handle&&"App"===f.constructor.name)return f.waitForOpen.promise.then(function(){return f.rpc.apply(f,g)});var h={method:b,handle:this.handle,params:d||[]};if(e.delta&&(h.delta=!0),!f.session||f.isClosing||f.isClosed)return a.reject();var i=f.session.rpc(h).then(function(a){return c?a.result[c]:e.raw?a:a.result},function(b){return b.error.code===m.LOCERR_HC_MODAL_OBJECT_ERROR?(b.error.isHandled=!0,f.session.currentApp.abortModal().then(function(){return f.rpc.apply(f,g)})):a.reject(b)});return n.indexOf(b)>-1&&(f.ongoingRequests[b+e.delta]=i,i.finally(function(){delete f.ongoingRequests[b+e.delta]})),i.rpcId=h.id,i}});return o.getModel=function(b,c,d){function e(d){return delete c.modelCache[b],a.reject({error:{code:d&&d.error&&d.error.code,message:"No object with Id "+b+" found",parameter:b}})}var f=c.modelCache[b],g=this;return b?f?f:(f=d().then(function(a){return a?new g({id:a.id,session:c,handle:a.handle,enigmaModel:a}):e({error:{code:m.LOCERR_GENERIC_NOT_FOUND}})},e),c.modelCache[b]=f,f):a.reject("No ID given to RPCBase#getModel")},o.getLayout=function(a,b){return this.get(a,b).then(function(a){return a.getLayout().then(function(a){return a})})},o.getProperties=function(a,b){return this.get(a,b).then(function(a){return a.getProperties().then(function(){return a})})},o.extend=function(a,b){var d=c.extend.call(this,a,b);return d.bindLayout=o.bindLayout,d.getLayout=o.getLayout,d.getProperties=o.getProperties,d.getModel=o.getModel,d},Object.defineProperties(o.prototype,{isValid:{get:function(){return this.state===o.States.VALID}},isValidating:{get:function(){return this.state===o.States.VALIDATING}},isInvalid:{get:function(){return this.state===o.States.INVALID}},isAborted:{get:function(){return this.state===o.States.ABORTED}},isClosed:{get:function(){return this.state===o.States.CLOSED}},isClosing:{get:function(){return this.state===o.States.CLOSING}},isCancelled:{get:function(){return this.state===o.States.CANCELLED}}}),o.States={VALID:1,INVALID:2,VALIDATING:3,ABORTED:4,CLOSED:5,CLOSING:6,CANCELLED:7},o.bindLayout=function(a,b,c,d){function e(){var c=a.$eval(b);c&&c.Invalidated&&c.Invalidated.unbind(f)}b=b||"model";var f,g,h,i=function(){var d=this,e=this.getLayout();a.__layoutRPCId=e.rpcId,e.then(function(e){var f=a.$eval(b);f===d&&c&&c(e)})};return h=a.$on("$destroy",function(){e()}),g=a.$watch(b,function(a,b){b&&b!==a&&b.Invalidated&&b.Invalidated.unbind(f),!a||a.isClosing&&a.isClosed||(d&&d(a),a.getLayout().then(c),f=i.bind(a),a.Invalidated.bind(f))}),function(){e(),g(),h(),c&&(c=null),d&&(d=null)}},o}),define("core.utils/websocket",[],function(){if("undefined"!=typeof window&&"undefined"!=typeof document)return window.angular&&window.angular.mock?function(){}:window.WebSocket;var a=require("ws");return a}),define("general.enums/qrs-enums",[],function(){"use strict";return{NxLocalizedErrorCode:{LOCERR_JSON_RPC_ENTITY_NOT_FOUND:-32001,LOCERR_JSON_RPC_ACCESS_DENIED:-32002,LOCERR_JSON_RPC_APP_DUPLICATION_FAILED:-32003}}}),/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
function(a){function b(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0}function c(a,b){if("function"!=typeof a)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))}function d(){this._bindings=[],this._prevParams=null;var a=this;this.dispatch=function(){d.prototype.dispatch.apply(a,arguments)}}b.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},d.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,c,d,e){var f,g=this._indexOfListener(a,d);if(g!==-1){if(f=this._bindings[g],f.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else f=new b(this,a,c,d,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return this._indexOfListener(a,b)!==-1},add:function(a,b,d){return c(a,"add"),this._registerListener(a,!1,b,d)},addOnce:function(a,b,d){return c(a,"addOnce"),this._registerListener(a,!0,b,d)},remove:function(a,b){c(a,"remove");var d=this._indexOfListener(a,b);return d!==-1&&(this._bindings[d]._destroy(),this._bindings.splice(d,1)),a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b,c=Array.prototype.slice.call(arguments),d=this._bindings.length;if(this.memorize&&(this._prevParams=c),d){b=this._bindings.slice(),this._shouldPropagate=!0;do d--;while(b[d]&&this._shouldPropagate&&b[d].execute(c)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var e=d;e.Signal=d,"function"==typeof define&&define.amd?define("signals",[],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.signals=e}(this),/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */
function(){var a=function(a){function b(a,b){if(a.indexOf)return a.indexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function c(a,c){var d=b(a,c);d!==-1&&a.splice(d,1)}function d(a,b){return"[object "+b+"]"===Object.prototype.toString.call(a)}function e(a){return d(a,"RegExp")}function f(a){return d(a,"Array")}function g(a){return"function"==typeof a}function h(a){var b;return b=null===a||"null"===a?null:"true"===a||"false"!==a&&(a===o||"undefined"===a?o:""===a||isNaN(a)?a:parseFloat(a))}function i(a){for(var b=a.length,c=[];b--;)c[b]=h(a[b]);return c}function j(a,b){for(var c,d,e=(a||"").replace("?","").split("&"),f=e.length,g={};f--;)c=e[f].split("="),d=b?h(c[1]):c[1],g[c[0]]="string"==typeof d?decodeURIComponent(d):d;return g}function k(){this.bypassed=new a.Signal,this.routed=new a.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function l(b,c,d,f){var g=e(b),h=f.patternLexer;this._router=f,this._pattern=b,this._paramsIds=g?null:h.getParamIds(b),this._optionalParamsIds=g?null:h.getOptionalParamsIds(b),this._matchRegexp=g?b:h.compilePattern(b,f.ignoreCase),this.matched=new a.Signal,this.switched=new a.Signal,c&&this.matched.add(c),this._priority=d||0}var m,n,o;return n=""===/t(.+)?/.exec("t")[1],k.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new k},addRoute:function(a,b,c){var d=new l(a,b,c,this);return this._sortedInsert(d),d},removeRoute:function(a){c(this._routes,a),a._destroy()},removeAllRoutes:function(){for(var a=this.getNumRoutes();a--;)this._routes[a]._destroy();this._routes.length=0},parse:function(a,b){if(a=a||"",b=b||[],this.ignoreState||a!==this._prevMatchedRequest&&a!==this._prevBypassedRequest){var c,d=this._getMatchedRoutes(a),e=0,f=d.length;if(f)for(this._prevMatchedRequest=a,this._notifyPrevRoutes(d,a),this._prevRoutes=d;e<f;)c=d[e],c.route.matched.dispatch.apply(c.route.matched,b.concat(c.params)),c.isFirst=!e,this.routed.dispatch.apply(this.routed,b.concat([a,c])),e+=1;else this._prevBypassedRequest=a,this.bypassed.dispatch.apply(this.bypassed,b.concat([a]));this._pipeParse(a,b)}},_notifyPrevRoutes:function(a,b){for(var c,d=0;c=this._prevRoutes[d++];)c.route.switched&&this._didSwitch(c.route,a)&&c.route.switched.dispatch(b)},_didSwitch:function(a,b){for(var c,d=0;c=b[d++];)if(c.route===a)return!1;return!0},_pipeParse:function(a,b){for(var c,d=0;c=this._piped[d++];)c.parse(a,b)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(a){var b=this._routes,c=b.length;do--c;while(b[c]&&a._priority<=b[c]._priority);b.splice(c+1,0,a)},_getMatchedRoutes:function(a){for(var b,c=[],d=this._routes,e=d.length;(b=d[--e])&&((!c.length||this.greedy||b.greedy)&&b.match(a)&&c.push({route:b,params:b._getParamsArray(a)}),this.greedyEnabled||!c.length););return c},pipe:function(a){this._piped.push(a)},unpipe:function(a){c(this._piped,a)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},m=new k,m.VERSION="0.12.0",m.NORM_AS_ARRAY=function(a,b){return[b.vals_]},m.NORM_AS_OBJECT=function(a,b){return[b]},l.prototype={greedy:!1,rules:void 0,match:function(a){return a=a||"",this._matchRegexp.test(a)&&this._validateParams(a)},_validateParams:function(a){var b,c=this.rules,d=this._getParamsObject(a);for(b in c)if("normalize_"!==b&&c.hasOwnProperty(b)&&!this._isValidParam(a,b,d))return!1;return!0},_isValidParam:function(a,c,d){var h=this.rules[c],i=d[c],j=!1,k=0===c.indexOf("?");return null==i&&this._optionalParamsIds&&b(this._optionalParamsIds,c)!==-1?j=!0:e(h)?(k&&(i=d[c+"_"]),j=h.test(i)):f(h)?(k&&(i=d[c+"_"]),j=this._isValidArrayRule(h,i)):g(h)&&(j=h(i,a,d)),j},_isValidArrayRule:function(a,c){if(!this._router.ignoreCase)return b(a,c)!==-1;"string"==typeof c&&(c=c.toLowerCase());for(var d,e,f=a.length;f--;)if(d=a[f],e="string"==typeof d?d.toLowerCase():d,e===c)return!0;return!1},_getParamsObject:function(a){for(var c,d,e=this._router.shouldTypecast,f=this._router.patternLexer.getParamValues(a,this._matchRegexp,e),g={},i=f.length;i--;)d=f[i],this._paramsIds&&(c=this._paramsIds[i],0===c.indexOf("?")&&d&&(g[c+"_"]=d,d=j(d,e),f[i]=d),n&&""===d&&b(this._optionalParamsIds,c)!==-1&&(d=void 0,f[i]=d),g[c]=d),g[i]=d;return g.request_=e?h(a):a,g.vals_=f,g},_getParamsArray:function(a){var b,c=this.rules?this.rules.normalize_:null;return c=c||this._router.normalizeFn,b=c&&g(c)?c(a,this._getParamsObject(a)):this._getParamsObject(a).vals_},interpolate:function(a){var b=this._router.patternLexer.interpolate(this._pattern,a);if(!this._validateParams(b))throw new Error("Generated string doesn't validate against `Route.rules`.");return b},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},k.prototype.patternLexer=function(){function a(){var a,b;for(a in n)n.hasOwnProperty(a)&&(b=n[a],b.id="__CR_"+a+"__",b.save="save"in b?b.save.replace("{{id}}",b.id):b.id,b.rRestore=new RegExp(b.id,"g"))}function b(a,b){var c,d=[];for(a.lastIndex=0;c=a.exec(b);)d.push(c[1]);return d}function c(a){return b(m,a)}function d(a){return b(n.OP.rgx,a)}function e(a,b){return a=a||"",a&&(r===o?a=a.replace(k,""):r===q&&(a=a.replace(l,"")),a=f(a,"rgx","save"),a=a.replace(j,"\\$&"),a=f(a,"rRestore","res"),r===o&&(a="\\/?"+a)),r!==p&&(a+="\\/?"),new RegExp("^"+a+"$",b?"i":"")}function f(a,b,c){var d,e;for(e in n)n.hasOwnProperty(e)&&(d=n[e],a=a.replace(d[b],d[c]));return a}function g(a,b,c){var d=b.exec(a);return d&&(d.shift(),c&&(d=i(d))),d}function h(a,b){if("string"!=typeof a)throw new Error("Route pattern should be a string.");var c=function(a,c){var d;if(c="?"===c.substr(0,1)?c.substr(1):c,null!=b[c]){if("object"==typeof b[c]){var e=[];for(var f in b[c])e.push(encodeURI(f+"="+b[c][f]));d="?"+e.join("&")}else d=String(b[c]);if(a.indexOf("*")===-1&&d.indexOf("/")!==-1)throw new Error('Invalid value "'+d+'" for segment "'+a+'".')}else{if(a.indexOf("{")!==-1)throw new Error("The segment "+a+" is required.");d=""}return d};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),a.replace(n.OS.rgx,n.OS.save).replace(m,c).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var j=/[\\.+*?\^$\[\](){}\/'#]/g,k=/^\/|\/$/g,l=/\/$/g,m=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},o=1,p=2,q=3,r=o;return a(),{strict:function(){r=p},loose:function(){r=o},legacy:function(){r=q},getParamIds:c,getOptionalParamsIds:d,getParamValues:g,compilePattern:e,interpolate:h}}(),m};"function"==typeof define&&define.amd?define("crossroads",["signals"],a):"undefined"!=typeof module&&module.exports?module.exports=a(require("signals")):window.crossroads=a(window.signals)}(),define("general.controllers/route-controller",["crossroads","util"],function(a,b){"use strict";function c(){o.forEach(function(a){a.dispose()}),n.forEach(function(a){e.addRoute(a)})}function d(){window.addEventListener("popstate",function(){var a=b.getParameterByName("app");return f&&f!==a?void(location.href=location.href):void e.parse()},!1)}if(location.pathname.match(/hub$/i))return void(location.href=location.href+"/");location.hash&&history.replaceState(null,null,location.href.replace("#!/",""));var e={},f=b.getParameterByName("app"),g=b.getParameterByName("language"),h=b.getParameterByName("theme"),i=b.getParameterByName("debug"),j=b.getParameterByName("noData"),k=b.getParameterByName("feature"),l=[],m=[],n=[],o=[];return f&&l.push("app",f),g&&m.push("language",g),h&&m.push("theme",h),i&&m.push("debug",i),j&&m.push("noData",!0),k&&m.push("feature",k),e.isSuffixInUse=function(a){for(var b=0;b<m.length;b++)if(m[b]===a)return!0;return!1},e.removePartialSuffix=function(a){for(var b=!1,d=0;d<m.length;d++)if(m[d]===a){m.splice(d,2),b=!0;break}if(b){var f=location.href,g=new RegExp("/"+a+"/[^/]+","i");c(),g.test(f)&&(f=f.replace(g,""),e.setUrl(f))}return b},e.parse=function(b){a.parse(b||location.pathname)},e.addRoute=function(b){var c=this,d=b.pattern;n.push(b),b.isPartial&&("/"===d&&(d=""),d=c.buildUrl("replaceme").replace(location.protocol+"//"+location.host+"/","").replace("/replaceme",d));var e=a.addRoute(d,function(){c.lastRoute&&c.lastRoute!==b&&c.lastRoute.DeRoute.emit(),c.lastRoute=b,b.Route.emit.apply(b.Route,arguments)});o.push(e)},e.setUrl=function(a,c,d){c=!0;var f=location.href.toLowerCase().indexOf("?x-")>-1;f&&(a=a.replace(/\?x-.+?=[^&]+/i,"").replace("&","?")),0!==a.indexOf(b.baseURI)?location.href=a:a!==location.href&&(history[c?"replaceState":"pushState"](null,null,a),d||e.parse())},e.start=function(){this.setUrl(location.href),d(this),e.parse()},e.buildUrl=function(){var a,c=Array.apply(null,arguments),d="",e="";if(c[0]===!0?(d=c[1],c=c.slice(2)):c.unshift.apply(c,l),m.length&&c.push.apply(c,m),c=c.map(function(a){return encodeURIComponent(a).replace(/'/g,"%27")}),d){var f=new RegExp("([^/])/"+b.project+"/","i");e=b.baseURI.replace(f,"$1/"+d+"/")}else e=b.baseURI;return a=e+c.join("/").replace(/[\/]+/g,"/")},e}),define("core.utils/external-urls",["translator","autogenerated/product-info"],function(a,b){var c=b.externalUrls;return a.ready.then(function(){c.serverHelpBaseUrl=c.serverHelpBaseUrl.replace("{language}",a.language),c.personalHelpBaseUrl=c.personalHelpBaseUrl.replace("{language}",a.language)}),Object.defineProperty(c,"gettingStarted",{get:function(){return c.qlikWebPageUrl+"/"+a.language+"-sense-gettingstarted"}}),c}),define("text!general.controllers/expire-dialog.ng.html",[],function(){return"<div>\n\t<p class='dm-pb' ng-class=\"{'dm-pt': noTitle}\" q-translation=\"{{content}}\"></p>\n\t<p><upgrade-msg/></p>\n</div>"}),define("text!general.services/delayed-modal/delayed-modal.ng.html",[],function(){return'<div class="qui-delayedModal" on-close-view="closeView( $event )" qv-escape="handleEscButton( $event )" ng-style="modalStyle" tid="errorDialog">\n\t<header class="dm-header" ng-if="title" q-translation="{{title}}"></header>\n\t<main ng-if="!html" class="dm-main"> <p class="dm-p">{{content | translate}}</p></main>\n\t<main ng-if="html" class="dm-main qv-appname"></main>\n\t<footer class="dm-footer">\n\t\t<lui-button x-variant="inverse" qv-delayed-dialog-button ng-if="!buttons.length && showDefaultButton" qva-activate="closeModal( $event, true );" qva-focus="true"\n\t\t\t\t\tq-translation="Common.OK" tid="confirm"></lui-button>\n\t\t<lui-button x-variant="inverse" qv-delayed-dialog-button ng-repeat="button in buttons" qva-focus="button.defaultButton" qva-activate="closeModal( $event );" ng-disabled="button.expression === false"\n\t\t\t\t\tq-translation="{{button.name}}" tid="{{button.tid}}"></lui-button>\n\t</footer>\n</div>\n'}),define("general.services/delayed-modal/delayed-modal",["jquery","core.utils/deferred","qvangular","text!general.services/delayed-modal/delayed-modal.ng.html","angular"],function(a,b,c,d){var e,f=window.angular,g={"max-height":"90%","max-width":"90%","min-height":"180px",width:"400px"},h=!1,i=!1;c.directive("qvDelayedDialogButton",function(){return{replace:!0,restrict:"A",link:function(a){a.button&&a.button.defaultEscButton&&(e=a),a.closeModal=function(b,c){b&&(b.preventDefault(),b.stopPropagation()),a.button&&a.button.callback&&("undefined"==typeof a.button.expression||a.button.expression)&&a.button.callback(),(c||a.autoClose||a.button&&!a.button.callback)&&a.destroyModal()}}}}),c.service("$delayedModal",["$compile","$rootScope","$document",function(c,j,k){var l,m,n,o,p={},q=d,r={open:function(a){var d,r=new b;l&&(m=l,o=n),l=j.$new(),n=f.element('<div class="qv-modal-container qui-modalbackground-centered" qva-outside-ignore-for="allOutside" ng-style="containerStyle" ng-class="classes"></div>'),l.containerStyle={content:" "},l.classes={},l.modalStyle={};for(var s in g)l.modalStyle[s]=g[s];l.wasDisabled=[],l.showDefaultButton=!0,h=!0,i=!1,p=a,l.failed=!1,l.autoClose=!0;for(s in p)l[s]=p[s];return n.html(q).appendTo(k.find("body")),l.html&&n.find("main").append(l.html),d=l.$watch("element",function(){r.resolve(),d()}),l.element=c(n)(l),l.destroyModal=this.close.bind(this),l.handleEscButton=function(a){a&&(a.preventDefault(),a.stopPropagation()),l.buttons&&e?e&&e.closeModal():l.destroyModal()},l.$broadcast("delayed-modal-opened"),l.$watchCollection("[width, height]",function(){l.width&&(l.modalStyle.width=l.width),l.height&&(l.modalStyle.height=l.height)}),r.promise},update:function(a){if(h){for(var b in a)l[b]=a[b],p[b]=a[b];(a.html||a.buttons)&&(n.html(q),n.find("main").html(a.html),k.find("body").find(".qui-delayedModal").replaceWith(n.html()),l.element=c(n)(l))}},close:function(){l&&n&&(l.$broadcast("delayed-modal-closed"),n.remove(),l.$destroy(),l=m||null,n=o||null,m=o=null),h=!1,i=!1},lock:function(){i=!0,l.wasDisabled.length=0,l.element.find("button, input, textarea, select").each(function(){var b=a(this);b.prop("disabled")?l.wasDisabled.push(this):b.prop("disabled",!0)})},unlock:function(){i=!1,l.element.find("button, input, textarea, select").each(function(){l.wasDisabled.indexOf(this)===-1&&a(this).prop("disabled",!1)}),l.wasDisabled.length=0}};return Object.defineProperty(r,"isOpened",{get:function(){return h}}),Object.defineProperty(r,"isLocked",{get:function(){return i}}),Object.defineProperty(r,"scope",{get:function(){return l}}),r}])}),define("general.controllers/error-handler-controller",["jquery","qvangular","translator","autogenerated/qix/engine-enums","general.enums/qrs-enums","general.controllers/route-controller","core.utils/external-urls","text!general.controllers/expire-dialog.ng.html","general.services/delayed-modal/delayed-modal"],function(a,b,c,d,e,f,g,h){"use strict";function i(){b.getService("$timeout")(function(){location.reload(!0)})}function j(d){if(!k){var e=b.getService("$delayedModal");if(k=!0,"OnSessionLoggedOut"===d)return m={title:"Hub.OnSessionLoggedOut.title",content:"Hub.OnSessionLoggedOut.message",buttons:[{name:"Hub.OnSessionLoggedOut.button",defaultButton:!0,callback:function(){location.href=f.buildUrl(!0,"hub")}}],showDefaultButton:!1,classes:{"qs-e-dim":!0}},void c.ready.then(function(){b.getService("$delayedModal").open(m),b.getService("$delayedModal").scope.$on("delayed-modal-closed",function(){k=!1})});if(d.code===l.LOCERR_JSON_RPC_INVALID_PARAMETERS)return void(k=!1);var j=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0,callback:function(){var a=null;2===m.buttons.length&&(a=m.buttons[1]),k=!1,e.scope.$root.$broadcast("errorHandlerClosed",m.content,a)}}];d.buttons?j=d.buttons:"ErrorDialog.AppClosed"===d.message||d.method&&"OnEngineWebsocketFailed"===d.method||d.code===l.LOCERR_APP_NOT_FOUND||d.code===l.LOCERR_APP_CONNECT_FAILED?j=[{name:"Common.Refresh",callback:i},{name:"ErrorDialog.GoToHub",defaultButton:!0,callback:function(){location.href=f.buildUrl(!0,"hub")}}]:d.code===l.LOCERR_SERVER_LICENSE_EXPIRED||d.code===l.LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS||d.code===l.LOCERR_SERVER_OUT_OF_SESSION_CALS||d.code===l.LOCERR_SERVER_OUT_OF_USAGE_CALS||d.code===l.LOCERR_SERVER_OUT_OF_CALS||d.code===l.LOCERR_SERVER_OUT_OF_NAMED_CALS||d.code===l.LOCERR_GENERIC_CONNECTION_LOST?(j[0].defaultButton=!1,j.push({name:"Common.Refresh",defaultButton:!0,callback:function(){i();var a=null;2===m.buttons.length&&(a=m.buttons[1]),b.$rootScope.$broadcast("errorHandlerRefresh",m.content,a)}})):d.refreshButton&&(j=[{name:"Common.Refresh",defaultButton:!0,callback:i}]),c.ready.then(function(){if(m=a.extend(!0,{},d,{title:d.title||"ErrorDialog.Title",content:d.code?"ErrorCode."+d.code:d.message,buttons:j,showDefaultButton:!1,classes:{"qs-e-dim":!0}}),d.code===l.LOCERR_PERSONAL_VERSION_EXPIRED){var b=c.get("Info.QlikView.Personal.Upgrade",["<a href='"+g.personalUpgradeUrl+"' target='_blank'>"+g.personalUpgradeBase+"</a>"]),f=h.replace("<upgrade-msg/>",b);m.html=f,m.title="ErrorCode.12001.Sense.Desktop.Expired"}else"ProxyError.OnSessionTimedOut"===d.message&&(m.title="TimeoutDialog.Title");e.open(m),e.scope.$on("delayed-modal-closed",function(){k=!1}),e.scope.$root.$broadcast("errorHandlerOpen")}),document.activeElement&&a(document.activeElement).blur()}}var k=!1,l=a.extend({},d.NxLocalizedErrorCode,e.NxLocalizedErrorCode),m={};return{showDialog:j,isOpen:function(){return k}}}),function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("enigma",[],b):"object"==typeof exports?exports.enigma=b():a.enigma=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(1),f=d(e),g=c(4),h=d(g),i=new f.default,j=new h.default;i.registerService("qix",j.connect.bind(j)),b.default=i,a.exports=i},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(2),h=d(g),i=c(3),j=d(i),k=Object.assign||j.default,l=function(){function a(){e(this,a),this.services=new h.default}return f(a,[{key:"registerService",value:function(a,b){this.services.add(a,b)}},{key:"getService",value:function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=k.apply(void 0,[{}].concat(c)),f=this.services.get(a);return f(e)}}]),a}();b.default=l},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a),this.entries={}}return d(a,[{key:"add",value:function(a,b){if(a+="","undefined"!=typeof this.entries[a])throw new Error("Entry already defined with key "+a);this.entries[a]=b}},{key:"set",value:function(a,b){a+="",this.entries[a]=b}},{key:"remove",value:function(a){delete this.entries[a]}},{key:"get",value:function(a){return this.entries[a]}},{key:"getAll",value:function(){var a=this;return Object.keys(this.entries).map(function(b){return{key:b,value:a.entries[b]}})}},{key:"getKey",value:function(a){var b=this;return Object.keys(this.entries).filter(function(c){return b.entries[c]===a})[0]}},{key:"clear",value:function(){this.entries={}}}]),a}();b.default=e},function(a,b){"use strict";var c=Object.prototype.hasOwnProperty,d=Object.prototype.toString,e=function(a){return"function"==typeof Array.isArray?Array.isArray(a):"[object Array]"===d.call(a)},f=function(a){if(!a||"[object Object]"!==d.call(a))return!1;var b=c.call(a,"constructor"),e=a.constructor&&a.constructor.prototype&&c.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!e)return!1;var f;for(f in a);return"undefined"==typeof f||c.call(a,f)};a.exports=function a(){var b,c,d,g,h,i,j=arguments[0],k=1,l=arguments.length,m=!1;for("boolean"==typeof j?(m=j,j=arguments[1]||{},k=2):("object"!=typeof j&&"function"!=typeof j||null==j)&&(j={});k<l;++k)if(b=arguments[k],null!=b)for(c in b)d=j[c],g=b[c],j!==g&&(m&&g&&(f(g)||(h=e(g)))?(h?(h=!1,i=d&&e(d)?d:[]):i=d&&f(d)?d:{},j[c]=a(m,i,g)):"undefined"!=typeof g&&(j[c]=g));return j}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(5),h=d(g),i=c(9),j=d(i),k=c(10),l=d(k),m=c(2),n=d(m),o=c(12),p=d(o),q=function(){function a(){e(this,a),this.sessions=new n.default}return f(a,[{key:"createSession",value:function(a,b,c,d,e,f){return new h.default(a,b,c,d,e,f)}},{key:"createRPC",value:function(a,b,c,d){return new l.default(a,b,c,d)}},{key:"buildUrl",value:function(a,b){var c=a.unsecure,d=a.host,e=a.port,f=a.prefix,g=a.subpath,h=a.route,i=a.identity,j=a.reloadURI,k="";return k+=c?"ws":"wss",k+="://",k+=d||"localhost",e&&(k+=":"+e),k+=f||"/",g&&(k+=g+"/"),h?k+=h:b&&""!==b&&(k+="app/"+encodeURIComponent(b)),i&&(k+="/identity/"+encodeURIComponent(i)),k+="?reloadUri="+(j?encodeURIComponent(j):"")}},{key:"getSession",value:function(a){var b=this,c=this.buildUrl(a.session,a.appId),d=a.session.disableCache,e=!d&&this.sessions.get(c);if(!e){var f=this.createRPC(a.Promise,c,a.createSocket,a.session);e=this.createSession(f,a.delta,a.schema,a.JSONPatch,a.Promise,a.notifications),d||(this.sessions.add(c,e),e.on("close",function(){return b.sessions.remove(c)}))}return e}},{key:"getGlobal",value:function(a,b){var c=this;return a.connect().then(function(){var d={handle:-1,id:"Global",type:"Global",customType:"Global",delta:b.delta},e=a.getObjectApi(d);return e.openApp=e.openDoc=function(a){var d=arguments.length<=1||void 0===arguments[1]?"":arguments[1],e=arguments.length<=2||void 0===arguments[2]?"":arguments[2],f=arguments.length<=3||void 0===arguments[3]?"":arguments[3],g=!(arguments.length<=4||void 0===arguments[4])&&arguments[4];b.session.route="",b.appId=a;var h=c.getSession(b);return h.apiPromise||(h.apiPromise=h.connect().then(function(){return h.send({method:"OpenDoc",handle:-1,params:[a,d,e,f,!!g],delta:!1},{method:"OpenDoc",handle:-1,outKey:-1})})),h.apiPromise},e}).catch(function(b){throw a.emit("close",b),b})}},{key:"get",value:function(a,b){return this.getGlobal(a,b).then(function(a){return b.appId?a.openApp(b.appId,b.user,b.password,b.serial,b.noData).then(function(b){return{global:a,app:b}}):a})}},{key:"connect",value:function(a){a.session=a.session||{},a.schema instanceof j.default||(a.schema=new j.default(a.Promise,a.schema)),a.mixins=a.mixins||[],a.mixins.forEach(function(b){a.schema.registerMixin(b)}),a.JSONPatch=a.JSONPatch||p.default;var b=this.getSession(a);return this.get(b,a)}}]),a}();b.default=q},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(null==a)throw new TypeError("Cannot destructure undefined")}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(6),j=d(i),k=c(8),l=d(k),m="qReturn",n=Object.prototype.hasOwnProperty,o=function(){function a(b,c,d,e,g){var h=this,i=arguments.length<=5||void 0===arguments[5]?{}:arguments[5];f(this,a),j.default.mixin(this),this.rpc=b,this.delta=c,this.definition=d,this.JSONPatch=e,this.Promise=g,this.apis=new l.default,this.responseInterceptors=[{onFulfilled:this.processErrorInterceptor},{onFulfilled:this.processDeltaInterceptor},{onFulfilled:this.processResultInterceptor},{onFulfilled:this.processOutInterceptor},{onFulfilled:this.processObjectApiInterceptor}],b.on("error-socket",function(a){return h.emit("error-socket",a)}),b.on("close",function(a){return h.emit("close",a)}),b.on("notification",function(a){h.emit("notification:*",a.method,a.params),h.emit("notification:"+a.method,a.params)}),b.on("message",function(a){a.change&&a.change.forEach(function(a){return h.emit("handle-changed",a)}),a.close&&a.close.forEach(function(a){return h.emit("handle-closed",a)}),a.suspend&&h.rpc.send({method:"Resume",params:[],handle:a.suspend[0]})}),this.on("handle-changed",function(a){var b=h.apis.getApi(a);b&&b.emit("invalidated")}),this.on("handle-closed",function(a){var b=h.apis.getApi(a);b&&(b.emit("closed"),h.apis.remove(a))}),this.on("close",function(){h.removeAllListeners(),h.apis.getApis().forEach(function(a){a.api.emit("closed"),a.api.removeAllListeners()}),h.apis.clear()}),Object.keys(i).forEach(function(a){return h.on(a,i[a])}),this.emit("session-created",this)}return h(a,[{key:"connect",value:function(){return this.rpc.open()}},{key:"send",value:function(b,c){var d=this.intercept(this.rpc.send(b),this.responseInterceptors,c);return a.addToPromiseChain(d,"requestId",b.id),d}},{key:"close",value:function(){return this.rpc.close()}},{key:"getObjectApi",value:function(a){var b=a.handle,c=a.id,d=a.type,e=a.customType,f=a.delta,g=void 0===f||f,h=this.apis.getApi(b);return h?h:(h=this.definition.generate(d).create(this,b,c,g,e),this.apis.add(b,h),h)}},{key:"isPrimitivePatch",value:function(a){return 1===a.length&&["add","replace"].indexOf(a[0].op)!==-1&&this.isPrimitiveValue(a[0].value)&&"/"===a[0].path}},{key:"isPrimitiveValue",value:function(a){return"undefined"!=typeof a&&null!==a&&"object"!==("undefined"==typeof a?"undefined":g(a))&&!Array.isArray(a)}},{key:"getPatchee",value:function(a,b,c){if(this.isPrimitivePatch(b)){var d=b[0].value;return this.apis.setPatchee(a,c,d),d}var e=this.apis.getPatchee(a,c);return this.isPrimitiveValue(e)||(e=e||(b.length&&Array.isArray(b[0].value)?[]:{}),this.applyPatch(e,b)),this.apis.setPatchee(a,c,e),e}},{key:"applyPatch",value:function(a,b){this.JSONPatch.apply(a,b)}},{key:"intercept",value:function(a,b,c){var d=this;return b.reduce(function(a,b){return a.then(b.onFulfilled.bind(d,c),b.onRejected)},a)}},{key:"processErrorInterceptor",value:function(a,b){return e(a),"undefined"!=typeof b.error?(this.emit("error-qix",b.error),this.Promise.reject(b.error)):b}},{key:"processDeltaInterceptor",value:function(a,b){var c=b.result;if(b.delta)for(var d=Object.keys(c),e=0,f=d.length;e<f;++e){var g=d[e],h=c[g];if(!Array.isArray(h))return this.Promise.reject("Unexpected rpc response, expected array of patches");c[g]=this.getPatchee(a.handle,h,a.method+"-"+g)}return b}},{key:"processResultInterceptor",value:function(a,b){return b.result}},{key:"processOutInterceptor",value:function(a,b){return n.call(b,m)?b[m]:a.outKey!==-1?b[a.outKey]:b}},{key:"processObjectApiInterceptor",value:function(a,b){if(e(a),b.qHandle&&b.qType){var c={handle:b.qHandle,type:b.qType,id:b.qGenericId,customType:b.qGenericType,delta:this.delta};return this.getObjectApi(c)}return null===b.qHandle&&null===b.qType?null:b}}],[{key:"addToPromiseChain",value:function(b,c,d){b[c]=d;var e=b.then;b.then=function(){for(var b=arguments.length,f=Array(b),g=0;g<b;g++)f[g]=arguments[g];var h=e.apply(this,f);return a.addToPromiseChain(h,c,d),h}}}]),a}();b.default=o},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(7),f=d(e);b.default={mixin:function(a){Object.keys(f.default.prototype).forEach(function(b){a[b]=f.default.prototype[b]}),f.default.init(a)}}},function(a,b){function c(){c.init.call(this)}var d={};d.isObject=function(a){return"object"==typeof a&&null!==a},d.isNumber=function(a){return"number"==typeof a},d.isUndefined=function(a){return void 0===a},d.isFunction=function(a){return"function"==typeof a},a.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.init=function(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(a){if(!d.isNumber(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,f,g,h;if(this._events||(this._events={}),"error"===a&&!this._events.error)throw b=arguments[1],b instanceof Error?b:Error('Uncaught, unspecified "error" event.');if(c=this._events[a],d.isUndefined(c))return!1;if(d.isFunction(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,f=new Array(e-1),g=1;g<e;g++)f[g-1]=arguments[g];c.apply(this,f)}else if(d.isObject(c)){for(e=arguments.length,f=new Array(e-1),g=1;g<e;g++)f[g-1]=arguments[g];for(h=c.slice(),e=h.length,g=0;g<e;g++)h[g].apply(this,f)}return!0},c.prototype.addListener=function(a,b){var e;if(!d.isFunction(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d.isFunction(b.listener)?b.listener:b),this._events[a]?d.isObject(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,d.isObject(this._events[a])&&!this._events[a].warned){var e;e=d.isUndefined(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,d.isFunction(console.error)&&console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),d.isFunction(console.trace)&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d.isFunction(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,f,g;if(!d.isFunction(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,e=-1,c===b||d.isFunction(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(d.isObject(c)){for(g=f;g-- >0;)if(c[g]===b||c[g].listener&&c[g].listener===b){e=g;break}if(e<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d.isFunction(c))this.removeListener(a,c);else if(Array.isArray(c))for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d.isFunction(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d.isFunction(a._events[b])?1:a._events[b].length:0}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},j=c(2),k=d(j),l=function(a){function b(){return e(this,b),f(this,Object.getPrototypeOf(b).call(this))}return g(b,a),h(b,[{key:"add",value:function(a,c){var d={api:c,deltaCache:new k.default};return i(Object.getPrototypeOf(b.prototype),"add",this).call(this,a.toString(),d),d}},{key:"getApi",value:function(a){var b=this.get(a.toString());return b&&b.api}},{key:"getApis",value:function(){return i(Object.getPrototypeOf(b.prototype),"getAll",this).call(this).map(function(a){return{handle:a.key,api:a.value.api}})}},{key:"getPatchee",value:function(a,b){var c=this.get(a.toString());return c&&c.deltaCache.get(b)}},{key:"addPatchee",value:function(a,b,c){this.get(a.toString()).deltaCache.add(b,c)}},{key:"setPatchee",value:function(a,b,c){this.get(a.toString()).deltaCache.set(b,c)}}]),b}(k.default);b.default=l},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(2),h=d(g),i=c(6),j=d(i),k=["GetProperties","SetProperties","GetFullPropertyTree","SetFullPropertyTree","GetAppProperties","SetAppProperties"],l="qSuccess",m=function(){function a(b,c){e(this,a),this.Promise=b,this.mixins=new h.default,this.def=c,this.types=new h.default}return f(a,[{key:"registerMixin",value:function(a){var b=this,c=a.types,d=a.type,e=a.extend,f=a.override,g=a.init;Array.isArray(c)||(c=[c]),d&&c.push(d);var h={extend:e,override:f,init:g};c.forEach(function(a){var c=b.mixins.get(a);c?c.push(h):b.mixins.add(a,[h])})}},{key:"generate",value:function(a){var b=this.types.get(a);if(b)return b;if(!this.def.structs[a])throw new Error(a+" not found");var c=this.generateApi(a,this.def.structs[a]);return this.types.add(a,c),c}},{key:"generateApi",value:function(a,b){var c=Object.create({});this.generateDefaultApi(c,b),this.mixinType(a,c);var d=function(b,d,e,f,g){var h=this,i=Object.create(c);j.default.mixin(i),Object.defineProperties(i,{session:{enumerable:!0,value:b},handle:{enumerable:!0,value:d},id:{enumerable:!0,value:e},delta:{enumerable:!0,value:f}});var k=this.mixins.get(a)||[];return g!==a&&(this.mixinType(g,i),k=k.concat(this.mixins.get(g)||[])),k.forEach(function(a){"function"==typeof a.init&&a.init({Promise:h.Promise,api:i})}),i}.bind(this);return{create:d,def:c}}},{key:"generateDefaultApi",value:function(a,b){Object.keys(b).forEach(function(c){var d=c.substring(0,1).toLowerCase()+c.substring(1),e=b[c].Out&&1===b[c].Out.length?b[c].Out[0].Name:-1,f=k.indexOf(c)===-1&&e!==-1&&e!==l,g=function(){for(var a=arguments.length,b=Array(a),d=0;d<a;d++)b[d]=arguments[d];return this.session.send({method:c,handle:this.handle,params:b,delta:this.delta&&f},{handle:this.handle,method:c,outKey:e})};Object.defineProperty(a,d,{enumerable:!0,writable:!0,value:g})})}},{key:"mixinType",value:function(a,b){var c=this.mixins.get(a);c&&c.forEach(function(c){var d=c.extend,e=void 0===d?{}:d,f=c.override,g=void 0===f?{}:f;Object.keys(g).forEach(function(c){if("function"!=typeof b[c]||"function"!=typeof g[c])throw new Error("No function to override. Type: "+a+" function: "+c);!function(){var a=b[c];b[c]=function(){for(var b=arguments.length,d=Array(b),e=0;e<b;e++)d[e]=arguments[e];return g[c].apply(this,[a.bind(this)].concat(d))}}()}),Object.keys(e).forEach(function(c){if("function"==typeof b[c]&&"function"==typeof e[c])throw new Error("Extend is not allowed for this mixin. Type: "+a+" function: "+c);b[c]=e[c]})})}}]),a}();b.default=m},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(6),h=d(g),i=c(11),j=d(i),k=function(){function a(b,c,d,f){e(this,a),h.default.mixin(this),this.Promise=b,this.url=c,this.createSocket=d,this.sessionConfig=f,this.resolvers={},this.requestId=0,this.openPromise=void 0}return f(a,[{key:"open",value:function(){var a=this;if(this.openPromise)return this.openPromise;try{this.socket=this.createSocket(this.url,this.sessionConfig)}catch(b){return this.Promise.reject(b)}return this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.openPromise=new this.Promise(function(b,c){return a.registerResolver("open",b,c)}),this.closePromise=new this.Promise(function(b,c){return a.registerResolver("close",b,c)}),this.openPromise}},{key:"onOpen",value:function(){var a=this;this.resolvers.open.resolveWith(function(){return a.closePromise})}},{key:"onClose",value:function(a){this.emit("close",a),this.resolvers.close.resolveWith(a),this.rejectAllOutstandingResolvers()}},{key:"close",value:function(){var a=arguments.length<=0||void 0===arguments[0]?1e3:arguments[0],b=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return this.socket.close(a,b),this.closePromise}},{key:"onError",value:function(a){this.resolvers.open?this.resolvers.open.rejectWith(a):this.emit("error-socket",a),this.rejectAllOutstandingResolvers()}},{key:"onMessage",value:function(a){var b=JSON.parse(a.data);"undefined"!=typeof b.id?(this.emit("message",b),this.resolvers[b.id].resolveWith(b)):this.emit(b.params?"notification":"message",b)}},{key:"rejectAllOutstandingResolvers",value:function(){var a=this;Object.keys(this.resolvers).forEach(function(b){if("open"!==b&&"close"!==b){var c=a.resolvers[b];c.rejectWith()}})}},{key:"unregisterResolver",value:function(a){var b=this.resolvers[a];b.removeAllListeners(),delete this.resolvers[a]}},{key:"registerResolver",value:function(a,b,c){var d=this,e=this.resolvers[a]=new j.default(a,b,c);e.on("resolved",function(a){return d.unregisterResolver(a)}),e.on("rejected",function(a){return d.unregisterResolver(a)})}},{key:"send",value:function(a){var b=this;return this.socket&&this.socket.readyState===this.socket.OPEN?(a.jsonrpc="2.0",a.id=++this.requestId,this.socket.send(JSON.stringify(a)),new this.Promise(function(c,d){return b.registerResolver(a.id,c,d)})):this.Promise.reject(new Error("Not connected"))}}]),a}();b.default=k},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(6),h=d(g),i=function(){function a(b,c,d){e(this,a),h.default.mixin(this),this.id=b,this.resolve=c,this.reject=d}return f(a,[{key:"resolveWith",value:function(a){this.resolve(a),this.emit("resolved",this.id)}},{key:"rejectWith",value:function(a){this.reject(a),this.emit("rejected",this.id)}}]),a}();b.default=i},function(a,b,c){var d,e,f;!function(g,h){e=[c(3)],d=h,f="function"==typeof d?d.apply(b,e):d,!(void 0!==f&&(a.exports=f))}(this,function(a){function b(b){return b&&(b=a({},{val:b}).val),b}function c(a,b){return l(a[b])||"$$"===b.substring(0,2)||"_"===b.substring(0,1)}function d(a,b){var c,d="/",e=b.substring(1).split(d).slice(0,-1);return e.forEach(function(b,d){d!==e.length&&(c=+b,a=a[c||b]=k(a[c||b])?isNaN(c)?{}:[]:a[b])}),a}function e(a){Object.keys(a).forEach(function(b){var d=Object.getOwnPropertyDescriptor(a,b);d.configurable&&!c(a,b)&&delete a[b]})}function f(a,b){var c,d,e=!0;if(i(a)&&i(b))return Object.keys(a).length===Object.keys(b).length&&(Object.keys(a).forEach(function(c){if(!f(a[c],b[c]))return e=!1,!1}),e);if(j(a)&&j(b)){if(a.length!==b.length)return!1;for(c=0,d=a.length;c<d;c++)if(!f(a[c],b[c]))return!1;return!0}return a===b}function g(a,b,c){function d(a,b,c){if(a[c]&&k(a[c].qInfo))return null;if(a[c]&&a[c].qInfo.qId===b)return c;for(var d=0,e=a.length;d<e;d++)if(a[d]&&a[d].qInfo.qId===b)return d;return-1}var e,g,i=[],j=a.slice(),l=-1;if(f(b,j))return i;if(!k(b[0])&&k(b[0].qInfo))return i.push({op:"replace",path:c,value:b}),i;for(e=j.length-1;e>=0;--e)l=d(b,j[e].qInfo&&j[e].qInfo.qId,e),l===-1?(i.push({op:"remove",path:c+"/"+e}),j.splice(e,1)):i=i.concat(h.generate(j[e],b[l],c+"/"+e));for(e=0,g=b.length;e<g;++e)l=d(j,b[e].qInfo&&b[e].qInfo.qId),l===-1?(i.push({op:"add",path:c+"/"+e,value:b[e]}),j.splice(e,0,b[e])):l!==e&&(i.push({op:"move",path:c+"/"+e,from:c+"/"+l}),j.splice(e,0,j.splice(l,1)[0]));return i}a=a.bind(null,!0);var h={},i=function(a){return null!=a&&!Array.isArray(a)&&"object"==typeof a},j=Array.isArray,k=function(a){return"undefined"==typeof a},l=function(a){return"function"==typeof a};return h.generate=function(a,d,e){e=e||"";var l=[];return Object.keys(d).forEach(function(m){var n=b(d[m]),o=a[m],p=e+"/"+m;f(n,o)||c(d,m)||(k(o)?l.push({op:"add",path:p,value:n}):i(n)&&i(o)?l=l.concat(h.generate(o,n,p)):j(n)&&j(o)?l=l.concat(g(o,n,p)):l.push({op:"replace",path:e+"/"+m,value:n}))}),Object.keys(a).forEach(function(b){k(d[b])&&!c(a,b)&&l.push({op:"remove",path:e+"/"+b})}),l},h.apply=function(b,c){c.forEach(function(c){var f=d(b,c.path),g=c.path.split("/").splice(-1)[0],h=g&&isNaN(+g)?f[g]:f[+g]||f,k=c.from?c.from.split("/").splice(-1)[0]:null;if("/"===c.path&&(f=null,h=b),"add"===c.op||"replace"===c.op)if(j(f))"-"===g&&(g=f.length),f.splice(+g,"add"===c.op?0:1,c.value);else if(j(h)&&j(c.value)){var l=c.value.slice();h.length=0,h.push.apply(h,l)}else if(i(h)&&i(c.value))e(h),a(h,c.value);else{if(!f)throw new Error("Patchee is not an object we can patch");f[g]=c.value}else if("move"===c.op){var m=d(b,c.from);j(f)?f.splice(+g,0,m.splice(+k,1)[0]):(f[g]=m[k],delete m[k])}else"remove"===c.op&&(j(f)?f.splice(+g,1):delete f[g])})},h.clone=function(b){return a({},b)},h.createPatch=function(a,b,c){var d={op:a.toLowerCase(),path:c};return"move"===d.op?d.from=b:"undefined"!=typeof b&&(d.value=b),d},h.updateObject=function(b,c){return Object.keys(b).length?void h.apply(b,h.generate(b,c)):void a(b,c)},h})}])}),define("core.models/mixins/app-on-child",[],function(){"use strict";var a={types:["GenericObject","GenericDimension","GenericMeasure","GenericBookmark","GenericVariable","Field"],init:function(a){var b=a.api;b.app=b.session.app}};return a}),define("core.models/mixins/app-settings",[],function(){"use strict";var a={qInfo:{qId:"appprops",qType:"appprops"},sheetTitleBgColor:"",sheetTitleGradientColor:"",sheetTitleColor:"",sheetLogoThumbnail:{qStaticContentUrlDef:null},sheetLogoPosition:"",rtl:!1},b={types:"Doc",extend:{getClientAppSettingsObject:function(){return this.getObject(a.qInfo.qId).then(function(b){return b||this.createObject(a)}.bind(this))},getClientAppSettings:function(){return this.getClientAppSettingsObject().then(function(a){return a.getLayout()})},setClientAppSettings:function(a){return this.getClientAppSettingsObject().then(function(b){return b.setProperties(a)})}}};return b}),define("core.models/mixins/bookmark-list",[],function(){"use strict";var a={qInfo:{qId:"BookmarkList",qType:"BookmarkList"},qBookmarkListDef:{qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",sheetId:"/sheetId",selectionFields:"/selectionFields",creationDate:"/creationDate"}}},b={types:"Doc",extend:{getBookmarkList:function(){return this.getListData(a)},getBookmarkListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/mixins/current-selections",[],function(){"use strict";function a(a,b,c){return a.getField(b).then(function(a){return a[c]()})}var b={types:["CurrentSelection"],extend:{clearField:function(b){return a(this.app,b,"clear")},lockField:function(b){return a(this.app,b,"lock")},unlockField:function(b){return a(this.app,b,"unlock")},clearAll:function(){return this.app.clearAll()},back:function(){return this.app.back()},forward:function(){return this.app.forward()}}};return b}),define("core.models/mixins/dimension-list",[],function(){"use strict";var a={qInfo:{qId:"DimensionList",qType:"DimensionList"},qDimensionListDef:{qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}},b={types:"Doc",extend:{getDimensionList:function(){return this.getListData(a)},getDimensionListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/mixins/doc",["core.utils/permissions"],function(a){"use strict";var b={qInfo:{qId:"CurrentSelection",qType:"CurrentSelection"},qSelectionObjectDef:{}},c={qInfo:{qId:"UndoInfo",qType:"UndoInfo"},qUndoInfoDef:{}};return{types:"Doc",override:{getProperties:function(){return this.getAppProperties()},getContentLibraries:function(a){return a().then(function(a){return a.qItems})},getLibraryContent:function(a,b){return a(b).then(function(a){return a.qItems})}},extend:{setProperties:function(a){return this.setAppProperties(a)},getListData:function(a){return this.getListObject(a).then(function(a){return a.getLayout()})},getListObject:function(b){var c=Object.keys(b).filter(function(a){return a.indexOf("ListDef")!==-1})[0];if(!c)throw new Error("Invalid list definition");c&&(c=c.replace(/Def$/g,""));var d=b.qInfo.qId;return this._listCache[d]||(this._listCache[d]=this.getObject(d).then(function(a){return a||this.createSessionObject(b)}.bind(this)).then(function(b){var d=b.getLayout.bind(b);return b.getLayout=function(){return d().then(function(b){var d=b[c].qItems;return d.forEach(function(b){"object"==typeof b&&a.mapToLayout(b)}),b[c].qItems})},b})),this._listCache[d]},getCurrentSelectionObject:function(){var a=this;return this.getObject(b.qInfo.qId).then(function(c){return c||a.createSessionObject(b)})},getUndoInfoObject:function(){var a=this;return a.getObject(c.qInfo.qId).then(function(b){return b||a.createSessionObject(c)})},createSheet:function(a,b,c){return this.createObject({qInfo:{qType:"sheet"},qMetaDef:{title:a||"",description:b||""},rank:-1,thumbnail:{qStaticContentUrlDef:c||null},columns:24,rows:12,cells:[],qChildListDef:{qData:{title:"/title"}}})},createStory:function(){return this.createObject({qInfo:{qType:"story"},qMetaDef:{title:"",description:""},rank:-1,thumbnail:{qStaticContentUrlDef:null},qChildListDef:{qData:{title:"/title",rank:"/rank"}}})},getLayout:function(){return this.getAppLayout().then(function(b){return a.mapToLayout(b,!0),b})},abortSelection:function(a){return a=void 0===a||a,this.setSelection(null),this.abortModal(a)},switchSelection:function(a,b,c){return a=a||null,b=b||"",c=void 0===c||c,this.isInSelection()&&this.selectionObject.endSelections(c),a&&!a.isClosed?(this.setSelection(a),a.beginSelections(b)):void this.setSelection(null)},setSelection:function(a){this.selectionObject=a},isInSelection:function(){return this.selectionObject&&!this.selectionObject.isClosed},getPublishableStreams:function(){return this.Promise.all([this.getLayout(),this.global.getStreamList()]).then(function(a){return a[1].filter(function(b){return a[0].stream?b.qId===a[0].stream.id&&b.privileges.indexOf("publish")!==-1:b.privileges.indexOf("publish")!==-1})})}},init:function(a){var b=a.api;b.Promise=a.Promise,b.session.app=b,b._listCache={}}}}),define("core.models/mixins/field-list-object",[],function(){"use strict";function a(){return this.getLayout().then(function(a){for(var b=[],c=0;c<a.length;++c){var d=a[c];if(b.push(d),d.qDerivedFieldData)for(var e=0;e<d.qDerivedFieldData.qDerivedFieldLists.length;++e)for(var f=d.qDerivedFieldData.qDerivedFieldLists[e],g=0;g<f.qFieldDefs.length;++g){var h=f.qFieldDefs[g];b.push({qName:h.qName,qSrcTables:d.qSrcTables,qTags:h.qTags,isDerived:!0,sourceField:d.qName,derivedDefinitionName:f.qDerivedDefinitionName})}}return b})}var b={types:["FieldList"],extend:{expand:a}};return b}),define("core.models/mixins/field-list",[],function(){"use strict";var a={qInfo:{qId:"FieldList",qType:"FieldList"},qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0}},b={types:"Doc",extend:{getFieldList:function(){return this.getListData(a)},getFieldListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/mixins/fields-on-the-fly-list",[],function(){"use strict";var a={qInfo:{qId:"FieldOnTheFlyList",qType:"FieldOnTheFlyList"},qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0,qShowDefinitionOnly:!0}},b={types:"Doc",extend:{getFieldsOnTheFlyList:function(){return this.getListData(a)},getFieldsOnTheFlyListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/mixins/layout-observable",[],function(){"use strict";function a(a){this.getLayout=function(a){this.requestPromise=a.getLayout().then(function(b){this.requestPromise=null,a.isCancelled||this.fn(b)}.bind(this))}.bind(this,a),this.onInvalidated=function(){this.getLayout()}.bind(this),this.api=a,this.fn=null}return a.prototype.subscribe=function(a){if("function"!=typeof a)throw new Error("Observer must be a function");"function"!=typeof this.fn&&(this.fn=a,this.api.on("invalidated",this.onInvalidated),this.getLayout())},a.prototype.dispose=function(){this.api.removeListener("invalidated",this.onInvalidated)},a.prototype.cancel=function(){return!!this.requestPromise&&(this.api.app.global.cancelRequest(this.requestPromise.requestId),this.api.markAsCancelled(),this.requestPromise=null,!0)},a.prototype.retry=function(){this.api.isCancelled&&this.getLayout()},{types:["Doc","GenericObject","GenericDimension","GenericMeasure","GenericBookmark","GenericVariable"],extend:{layoutSubscribe:function(b){var c=new a(this);return c.subscribe(b),c}}}}),define("core.models/mixins/master-object-list",[],function(){"use strict";var a={qInfo:{qId:"MasterObjectList",qType:"MasterObjectList"},qAppObjectListDef:{qType:"masterobject",qData:{name:"/qMetaDef/title",visualization:"/visualization",tags:"/qMetaDef/tags"}}},b={types:"Doc",extend:{getMasterObjectList:function(){return this.getListData(a)},getMasterObjectListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/mixins/measure-list",[],function(){"use strict";var a={qInfo:{qId:"MeasureList",qType:"MeasureList"},qMeasureListDef:{qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}},b={types:"Doc",extend:{getMeasureList:function(){return this.getListData(a)},getMeasureListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/mixins/permissions",["core.utils/permissions"],function(a){"use strict";return{types:["GenericObject"],override:{getLayout:function(b){return b().then(function(b){return a.mapToLayout(b,!1),b})}}}}),define("core.models/mixins/sheet-list",[],function(){"use strict";var a={qInfo:{qId:"SheetList",qType:"SheetList"},qAppObjectListDef:{qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}},b={types:"Doc",extend:{getSheetList:function(){return this.getListData(a)},getSheetListObject:function(){return this.getListObject(a)}}};return b}),define("general.utils/visualizations",[],function(){function a(a){return c[a]}function b(a,b){c[a]=b}var c={};return{getType:a,getRegisteredNames:function(){return Object.keys(c)},getLibraryInfo:function(a){return c[a]?c[a].getLibraryInfo():null},getTemplateIconClassName:function(a){return c[a]?c[a].getTemplateIconClassName():null},getIconChar:function(a){return c[a]?c[a].getIconChar():null},registerType:b}}),define("core.models/mixins/sheet",["util","core.utils/deferred","general.utils/visualizations"],function(a,b,c){"use strict";function d(a,b){var c,d;for(c=0;c<a.cells.length;++c)if(d=a.cells[c],d.col===b.col&&d.row===b.row)return c;return-1}function e(a,b,c){var e=d(a,b);if(e===-1){if(c)return null;throw new Error("invalid pos")}return a.cells[e]}function f(a,b){a.col=b.col,a.row=b.row,a.colspan=b.colspan,a.rowspan=b.rowspan}function g(a,b,c,d){var f=e(a,b,!0),g=f?f.name:null;return f?(f.name=c,f.type=d):a.cells.push({name:c,type:d,col:b.col,row:b.row,colspan:b.colspan,rowspan:b.rowspan}),g}function h(a,b){var c={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan},d={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan};if("left"===b||"right"===b){var e=Math.ceil(a.colspan/2);c.colspan-=e,d.col+=a.colspan-e,d.colspan=e}if("top"===b||"bottom"===b){var f=Math.ceil(a.rowspan/2);c.rowspan-=f,d.row+=a.rowspan-f,d.rowspan=f}if("top"===b||"left"===b){var g=c;c=d,d=g}return{pos1:c,pos2:d}}function i(a,b,c){var d=e(a,b,!1);if(!d||d.colspan!==b.colspan||d.rowspan!==b.rowspan)return!1;var g=h(d,c);return f(d,g.pos1),g.pos2}function j(a,b){return b.filter(function(b){return b.name===a})[0]}function k(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.qInfo.qId=a.generateId(),b.qChildren.push({qChildren:[],qProperty:e})}}return{types:"sheet",extend:{edit:function(a){var b=this;return b.getProperties().then(function(c){return a(c),b.setProperties(c)})},getObject:function(a,b){return this.getLayout().then(function(c){return e(c,a,b)})},moveObject:function(a,c){return this.edit(function(d){var g=e(d,a);return c.split&&(c=i(d,c.pos,c.split),!c)?b.reject():void f(g,c)})},swapObjects:function(a,b){return this.edit(function(c){var d=e(c,a),g=e(c,b,!0);f(d,b),g&&f(g,a)})},addObject:function(d){var e,f=this,h=d.template,j=d.cell.pos,l=c.getType(h),m=d.init,n=d.children||[];return e=m.qExtendsId?b.resolve(a.extend({qInfo:{qType:h}},m)):l.getInitialProperties(m),b.all({initProps:e,props:f.getFullPropertyTree()}).then(function(c){var d=c.initProps,e=c.props;if(j.split&&(j=i(e.qProperty,j.pos,j.split),!j))return b.reject();d.qInfo.qId=a.generateId();var h=g(e.qProperty,j,d.qInfo.qId,d.qInfo.qType);if(h){for(var l=0;l<e.qChildren.length;l++)if(e.qChildren[l].qProperty.qInfo.qId===h){e.qChildren[l].qProperty=d,e.qChildren[l].qChildren=[],k(e.qChildren[l],n);break}}else{var m=e.qChildren.push({qChildren:[],qProperty:d});k(e.qChildren[m-1],n)}return f.setFullPropertyTree(e)})},getObjectById:function(a){var b,c,d=this.layout.cells;for(b=0;b<d.length;++b)if(c=d[b],a===c.name)return c;return null},removeObject:function(b){var c=this;return c.getProperties().then(function(e){e=a.extend(!0,{},e);var f=d(e,b),g=e.cells[f].name;if(f===-1)throw new Error("invalid pos");return e.cells.splice(f,1),c.destroyChild(g,e)})},setCloneChildrenInfos:function(a){var c=this;return b.all([c.getChildInfos(),a.getChildInfos(),a.getProperties()]).then(function(b){var c=b[0],d=b[1],e=b[2];return c.forEach(function(a,b){var c=j(a.qId,e.cells);c&&(c.name=d[b].qId)}),a.setProperties(e).then(function(){return a})})},clone:function(){var a=this.app,b=this;return a.cloneObject(this.id).then(function(b){return a.getObject(b)}).then(function(a){return b.setCloneChildrenInfos(a)})},draft:function(){var a=this.app,b=this;return a.createDraft(this.id).then(function(c){return a.getObject(c).then(function(a){return b.setCloneChildrenInfos(a)})})}},init:function(){}}}),define("core.models/mixins/snapshot-list",[],function(){"use strict";var a={qInfo:{qId:"SnapshotList",qType:"SnapshotList"},qBookmarkListDef:{qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}},b={types:"Doc",extend:{getSnapshotListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/rpc-states",[],function(){return{VALID:1,INVALID:2,VALIDATING:3,ABORTED:4,CLOSED:5,CLOSING:6,CANCELLED:7}}),define("core.models/mixins/state",["core.utils/notification","core.models/rpc-states"],function(a,b){"use strict";return{types:["Doc","GenericObject","GenericDimension","GenericMeasure","GenericBookmark","GenericVariable"],extend:{setState:function(a){var c=this.state;this.state=a,c!==this.state&&(a===b.INVALID?this.Invalidated.emit():a===b.VALID?this.Validated.emit():a===b.ABORTED?this.Aborted.emit():a===b.VALIDATING?this.Validating.emit():a===b.CLOSED?this.Closed.emit():a===b.CLOSING?this.Closing.emit():a===b.CANCELLED&&this.Cancelled.emit())},markAsInvalid:function(){this.state=-99,this.setState(b.INVALID)},markAsCancelled:function(){this.setState(b.CANCELLED)}},override:{getLayout:function(a){return this.setState(b.VALIDATING),a().then(function(a){return this.layout=a,this.setState(b.VALID),a}.bind(this))}},init:function(c){var d=c.api;d.Promise=c.Promise,a.mixin(d),d.notification("Validated"),d.notification("Invalidated"),d.notification("Aborted"),d.notification("Validating"),d.notification("Closed"),d.notification("Closing"),d.notification("Cancelled"),d.setState(b.INVALID),d.on("invalidated",function(){d.setState(b.INVALID)}),d.on("closed",function(){d.setState(b.CLOSED)}),Object.defineProperties(d,{isValid:{get:function(){return this.state===b.VALID}},isValidating:{get:function(){return this.state===b.VALIDATING}},isInvalid:{get:function(){return this.state===b.INVALID}},isAborted:{get:function(){return this.state===b.ABORTED}},isClosed:{get:function(){return this.state===b.CLOSED}},isClosing:{get:function(){return this.state===b.CLOSING}},isCancelled:{get:function(){return this.state===b.CANCELLED}}})}}}),define("core.models/mixins/story-list",[],function(){"use strict";var a={qInfo:{qId:"StoryList",qType:"StoryList"},qAppObjectListDef:{qType:"story",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",rank:"/rank"}}},b={types:"Doc",extend:{getStoryList:function(){return this.getListData(a)},getStoryListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/mixins/undo-info",[],function(){"use strict";return{types:["UndoInfo"],extend:{undo:function(){return this.layout.qUndoInfo.qUndoCount>0?this.app.undo():this.Promise.resolve()},redo:function(){return this.layout.qUndoInfo.qRedoCount>0?this.app.redo():this.Promise.resolve()},reset:function(){return this.getLayout().then(function(a){if(a.qUndoCount||a.qRedoCount)return this.app.clearUndoBuffer()}.bind(this))}},override:{getLayout:function(a){return a().then(function(a){return a.qUndoInfo})}},init:function(a){var b=a.api;b.Promise=a.Promise}}}),define("core.models/mixins/variable-list",[],function(){"use strict";var a={qInfo:{qId:"VariableList",qType:"VariableList"},qVariableListDef:{qType:"variable",qShowReserved:!0,qShowConfig:!0,qData:{tags:"/tags"}}},b={types:"Doc",extend:{getVariableList:function(){return this.getListData(a)},getVariableListObject:function(){return this.getListObject(a)}}};return b}),define("core.models/mixins/search-history-list",["core.utils/deferred"],function(a){"use strict";var b={qInfo:{qId:"SearchHistoryList",qType:"SearchHistoryList"},qAppObjectListDef:{qType:"searchhistory",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",creationDate:"/creationDate",lastUsedDate:"/lastUsedDate",query:"/query",searchTerms:"/searchTerms"}}},c=10,d={types:"Doc",extend:{getSearchHistoryList:function(){return this.getListData(b)},getSearchHistoryListObject:function(){return this.getListObject(b)},createSearchHistoryObject:function(b,d){return this.createObject({qInfo:{qType:"searchhistory"},qMetaDef:{title:"",description:""},searchTerms:d||[],query:b||"",creationDate:(new Date).toISOString(),lastUsedDate:(new Date).toISOString()}).then(function(b){return this.getSearchHistoryList().then(function(d){if(d.length===c+1){var e,f=(new Date).getTime();return d.forEach(function(a){Date.parse(a.qData.lastUsedDate)<f&&(f=Date.parse(a.qData.lastUsedDate),e=a)}),this.destroyObject(e.qInfo.qId).then(function(){return a.resolve(b)})}return a.resolve(b)}.bind(this))}.bind(this))},updateSearchHistoryObject:function(a,b){return this.getObject(a).then(function(a){return a.getProperties().then(function(c){return b(c),a.setProperties(c)})})},clearSearchHistory:function(){return this.getSearchHistoryList().then(function(b){for(var c=[],d=0;d<b.length;d++)c.push(this.destroyObject(b[d].qInfo.qId));return a.all(c)}.bind(this))}}};return d}),define("core.models/mixins/all",["core.models/mixins/app-on-child","core.models/mixins/app-settings","core.models/mixins/bookmark-list","core.models/mixins/current-selections","core.models/mixins/dimension-list","core.models/mixins/doc","core.models/mixins/field-list-object","core.models/mixins/field-list","core.models/mixins/fields-on-the-fly-list","core.models/mixins/layout-observable","core.models/mixins/master-object-list","core.models/mixins/measure-list","core.models/mixins/permissions","core.models/mixins/sheet-list","core.models/mixins/sheet","core.models/mixins/snapshot-list","core.models/mixins/state","core.models/mixins/story-list","core.models/mixins/undo-info","core.models/mixins/variable-list","core.models/mixins/search-history-list"],function(){"use strict";return Array.prototype.slice.call(arguments)}),define("core.models/communication",["qvangular","core.utils/authentication","core.utils/websocket","general.controllers/error-handler-controller","enigma","autogenerated/qix/engine-api","autogenerated/qix/engine-enums","util","core.models/mixins/all"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){b.parse(a)}function k(a){d.showDialog({message:"ProxyError."+a,refreshButton:!0})}function l(a,b){return"OnAuthenticationInformation"==a?void j(b):void(q.indexOf(a)!==-1&&k(a))}function m(b){b.code!==g.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&a.getService("$timeout")(function(){b.isHandled||d.showDialog(b)},1e3)}function n(a){return"undefined"==typeof a&&(a={}),"string"!=typeof a.host&&(a.host=h.hostname),"string"!=typeof a.port&&(a.port=h.port||void 0),"string"!=typeof a.prefix&&(a.prefix=h.basePath),"boolean"!=typeof a.isSecure?a.unsecure=!h.isSecure:a.unsecure=!a.isSecure,"string"!=typeof a.reloadURI&&(a.reloadURI=h.reloadURI),a}function o(b,g,h,j){return e.getService("qix",{Promise:a.getService("$q"),schema:f,session:g,createSocket:function(a){return new c(a)},appId:b,noData:j,mixins:i,notifications:{"session-created":h,"error-qix":m,"notification:*":l}}).catch(function(a){throw(!a||a.srcElement instanceof c)&&(a={method:"OnEngineWebsocketFailed",code:16}),d.showDialog(a),a})}function p(a,b,c){a=a||h.getParameterByName("app")||"?transient=",b=n(b);var d="true"===h.getParameterByName("noData");return o(a,b,c,d)}var q=["OnLicenseAccessDenied","OnLicenseAccessDeniedPendingUserSync","OnNoAppFound","OnEngineWebsocketFailed","OnNoEngineAvailable","OnSessionTimedOut","OnSessionClosed","OnNoDataPrepServiceAvailable","OnDataPrepServiceWebsocketFailed"];return{get:function(a,b,c){return b=n(b),a?this.getApp(a,b,c):this.getGlobal(b,c);
},getApp:function(a,b,c){return p(a,b,c).then(function(a){return a.app.global=a.global,a.app})},getAppGlobal:function(a,b,c){return p(a,b,c).then(function(a){return a.global})},getAppAndGlobal:function(a,b,c){return p(a,b,c)},getGlobal:function(a,b){return a=n(a),o(void 0,a,b)}}}),define("core.models/rpc-session",["core.utils/websocket","core.utils/notification","core.utils/deferred","core.models/communication","autogenerated/qix/engine-enums"],function(a,b,c,d,e){"use strict";function f(a,b,c,d){a.Send.emit(c);var e=b.send(c,{handle:c.handle,method:c.method,outKey:-1});return a.dfdCache[c.id]=d,a.reqCache[c.id]=c,d.id=c.id,d.promise.requestId=e.requestId,d.promise}function g(a){var c=this;b.mixin(c),c.notification("Open"),c.notification("Close"),c.notification("Send"),c.notification("Data"),c.notification("Error"),c.notification("ClosedHandles"),c.notification("ChangedHandles"),c.notification("Notification"),c.notification("Warning"),c.changeHandlers={},c.cacheName=a.cacheName,c.dfdCache={},c.reqCache={},c.modelCache={},c.options=a,c.socket={url:""}}function h(a,b,c,d){c.connect().then(function(){a[b](d)})}function i(a,b){a.__enigmaSession||(b.rpc.on("close",function(c){h(a,"onClose",b,c)}),b.rpc.on("error-socket",function(c){h(a,"onError",b,c)}),b.rpc.on("message",function(c){h(a,"onData",b,c)}),b.rpc.on("notification",function(c){h(a,"onData",b,c)}))}var j=e.NxLocalizedErrorCode,k=1e3,l=["GetObject","GetLayout","GetAppLayout","GetProperties","GetAppProperties","GetEffectiveProperties","GetFullPropertyTree","GetDimension","GetMeasure","GetVariableById","GetVariableByName","GetBookmark"];g.prototype={open:function(){return this.enigmaPromise},onError:function(a){var b=this;Object.keys(b.dfdCache).forEach(function(c){a.error={err:a,isHandled:!0},b.dfdCache[c].reject(a)}),b.Error.emit(a)},_cleanup:function(){var a=this;if(a.Close){a.Close.emit();for(var c in a.modelCache)a.modelCache[c].then(function(a){a.close(!0)});b.release(a)}},onClose:function(){var a=this;a._isClosed||(delete g.__cache[a.cacheName],g.useTimeoutOnClose?setTimeout(a._cleanup.bind(a),k):a._cleanup(),a._isClosed=!0)},onData:function(a){var b=this,c=b.dfdCache[a.id];a.change&&b.handleChanged(a),a.close&&b.handleClosed(a),g.debounceApply(function(){if(a.handle&&!b.changeHandlers[a.handle]&&c)c.reject("No model mapped to handle");else if(a.result)b.Data.emit(a),a.warnings&&b.Warning.emit(a),c&&c.resolve(a);else if(a.params)b.Notification.emit(a),c&&c.resolve(a);else if(a.suspend)b.rpc({method:"Resume",params:[],handle:a.suspend[0]}),c&&c.resolve(a);else if(a.error){var d=b.reqCache[a.id];a.error.code===j.LOCERR_GENERIC_ABORTED&&l.indexOf(d.method)>-1?f(b,b.__enigmaSession,d,c):(c&&c.reject(a),b.Error.emit(a))}delete b.dfdCache[a.id],delete b.reqCache[a.id]})},handleChanged:function(a){var b=this;a.change.forEach(function(a){var c=b.changeHandlers[a];c&&c.forEach(function(a){a()})}),b.ChangedHandles.emit(a.change)},handleClosed:function(a){var b=this;Object.keys(b.modelCache).forEach(function(c){b.modelCache[c].then(function(b){a.close.indexOf(b.handle)>-1&&b.close(!0)})}),b.ClosedHandles.emit(a.close)},close:function(){var a=this;a.enigmaPromise.then(function(){a.__enigmaSession.close()})},rpc:function(a,b){var d=this;return b||(b=new c),d.__enigmaSession?f(d,d.__enigmaSession,a,b):d.enigmaPromise.then(function(){return f(d,d.__enigmaSession,a,b)})},onChange:function(a,b){this.changeHandlers[a]||(this.changeHandlers[a]=[]),this.changeHandlers[a].push(b)},getRequest:function(a){return this.reqCache[a]||null}},g.useTimeoutOnClose=!0,g.__cache={},b.create(g,"NewSessionCreated");var m=g.NewSessionCreated.bind,n=!0,o=null;return g.NewSessionCreated.bind=function(){m.apply(this,arguments),n=!1,o&&!n&&g.NewSessionCreated.emit(o)},g.createSocket=function(b){return new a(b)},g.createInput=function(a,b){return b=b||{},b.appName=a,b.cacheName=g.buildUrl(b),b},g.debounceApply=function(a){a()},g.get=function(a,b){var c=g.createInput(a,b),e=g.getIfCached(a,b);return e||(e=g.__cache[c.cacheName]=new g(c),g.NewSessionCreated.emit(e),o=e,a&&"?transient="!==a?e.enigmaPromise=d.get(a,b,i.bind(null,e)).then(function(a){e.__enigmaSession=a.session||a.app.session}):("?transient="===a&&(b.route="app/"+encodeURIComponent(a)),e.enigmaPromise=d.getGlobal(b,i.bind(null,e)).then(function(a){e.__enigmaSession=a.session}))),e},g.getIfCached=function(a,b){var c=g.createInput(a,b);return g.__cache[c.cacheName]},g.buildUrl=function(a){var b="",c=a.host,d="string"==typeof a.port?a.port:a.isSecure?443:4848;return b+=a.isSecure?"wss":"ws",b+="://",b+=c||"localhost",a.port&&(b+=":",b+=d),b+=a.prefix||"/",a.subpath&&(b+=a.subpath+"/"),b+=a.route?a.route:"app/"+encodeURIComponent(a.appName),a.identity&&(b+="/identity/"+encodeURIComponent(a.identity)),b+="?reloadUri="+(a.reloadURI||"")},g}),define("autogenerated/qix/engine-api-def",["./engine-api"],function(a){return a.structs}),define("core.models/engine",["autogenerated/qix/engine-api-def","core.models/communication","util"],function(a,b,c){"use strict";function d(a,b){if("object"==typeof b&&(b=c.extend(!0,Array.isArray(b)?[]:{},b)),a&&"qResult"!==a){var d={};return d[a]=b,d}return b}function e(a,b){var c=Object.keys(a),d=b.In.map(function(a){return a.Name});return 0!==c.filter(function(a,b){return a===d[b]}).length}function f(a,b){var c=[];if(Array.isArray(b)&&1===b.length&&"object"==typeof b[0]&&e(b[0],a)&&(b=b[0]),Array.isArray(b)||"object"!=typeof b)Array.isArray(b)?c=b:c.push(b);else for(var d=0;d<a.In.length;++d)b&&void 0!==b[a.In[d].Name]?c.push(b[a.In[d].Name]):a.In[d].Optional&&void 0!==a.In[d].DefaultValue&&c.push(a.In[d].DefaultValue);return c}function g(b){var c={};return Object.keys(a.Doc).forEach(function(e){var g=a.Doc[e],h=1===g.Out.length?g.Out[0].Name:null;e=e.substring(0,1).toLowerCase()+e.substring(1),c[e]=function(){var a=Array.prototype.slice.call(arguments);a=f(g,a);var c=b[e].apply(b,a).then(d.bind(null,h));return c.__protocolRequestId=c.requestId,c}}),c.global=b.global,c}var h={global:void 0,currentApp:void 0};return function(){function c(){return b.getAppGlobal().then(function(a){return e=a,a})}var e;h.global={},Object.keys(a.Global).forEach(function(b){var g=a.Global[b],i=1===g.Out.length?g.Out[0].Name:null;b=b.substring(0,1).toLowerCase()+b.substring(1),h.global[b]=function(){var a=Array.prototype.slice.call(arguments);if(a=f(g,a),h.currentApp&&(e=h.currentApp.global),e){var j=e[b].apply(e,a).then(d.bind(null,i));return j.__protocolRequestId=j.requestId,j}return c().then(function(c){return c[b].apply(c,a)}).then(d.bind(null,i))}}),h.global.getInteract=function(a){var b={method:"GetInteract",handle:-1,params:[a],delta:!1};return e?e.session.rpc.send(b).then(function(a){return a.result}):c().then(function(a){return a.session.rpc.send(b).then(function(a){return a.result})})}}(),h.getCurrentApp=function(){return h.currentApp},h.openApp=function(a,c){return b.getApp(a,c).then(function(b){var c=g(b);return c.name=a,h.currentApp=c,{app:b,engineApp:c}})},"undefined"!=typeof window&&(window.engineModuleGlobal=h),h}),define("core.models/app",["core.models/rpc-base","core.models/rpc-session","core.models/engine","core.utils/deferred","util","qvangular","general.controllers/error-handler-controller","autogenerated/qix/engine-enums"],function(a,b,c,d,e,f,g,h){"use strict";function i(){f.getService("$timeout")(function(){g.showDialog({code:h.NxLocalizedErrorCode.LOCERR_GENERIC_CONNECTION_LOST})},1e3)}var j,k,l={};return j=a.extend("App",{init:function(a,c,e,f){var g=this;e&&k||(k=g);var h=b.get(a,c);if(g.onError=f,h.Close.bind(g.onError||i),h.modelCache[a]=d.resolve(g),g.waitForOpen=new d,g.rpcOptions=c,g._super({id:a,session:h,checkCreate:!0}),g.session.connectedAppHandle)g.handle=g.session.connectedAppHandle,g.bindToRPC(),g.waitForOpen.resolve(g);else try{g.open().then(function(){g.waitForOpen.resolve(g)},function(a){g.waitForOpen.reject({error:a})})}catch(j){g.waitForOpen.reject({isHandled:!1,error:j})}g.session.currentApp=g},open:function(){function a(a){b.session.connectedAppHandle=b.handle=a.app.handle,b.enigmaModel=a.app,b.engineApp=a.engineApp,b.bindToRPC()}var b=this;return b.session.Error.bind(function(a){a.error&&!a.error.isHandled&&window.console.log("Error from Engine:",a)}),b.rpcOptions||(b.rpcOptions={}),c.openApp(b.id,b.rpcOptions).then(a)},close:function(a){return a?this.onError||g.showDialog({message:"ErrorDialog.AppClosed"}):this.session.Close.unbind(this.onError||i),delete l[this.cacheId],this.session.close(),k===this&&(k=void 0),this._super(a)},createSessionObject:function(a){return this.rpc("CreateSessionObject","qReturn",[a])},createSessionVariable:function(a){return this.rpc("CreateSessionVariable","qReturn",[a])},doSave:function(){return this.rpc("DoSave",null)},getLayout:function(){return this._super("GetAppLayout")},getProperties:function(){return this._super("GetAppProperties")},setProperties:function(a){return this._super(a,"SetAppProperties")},checkExpression:function(a,b){var c=[a];return b&&c.push(b),this.rpc("CheckExpression",null,c)},checkNumberOrExpression:function(a){return this.rpc("CheckNumberOrExpression",null,[a])},evaluateExpression:function(a){return this.rpc("Evaluate","qReturn",[a])},getConfiguration:function(){return this.session.rpc({method:"GetConfiguration",handle:-1,params:[]}).then(function(a){return a.result.qConfig})},getVersion:function(){return this.session.rpc({method:"QvVersion",handle:-1,params:[]}).then(function(a){return a.result.qReturn})},getListOfFunctions:function(){return this.session.rpc({method:"GetFunctions",handle:-1,params:[]}).then(function(a){return a.result.qFunctions})},getLocaleInfo:function(){return this.rpc("GetLocaleInfo","qReturn")},getExpressions:function(){return this.rpc("GetExpressions","qExpressions")},getStreams:function(){var a=this;return a.streamsList?d.resolve(a.streamsList):this.session.rpc({method:"GetStreamList",handle:-1,params:[]}).then(function(b){return a.streamsList=b.result.qStreamList,a.streamsList})},getPublishableStreams:function(){var a=this.getLayout(),b=this.getStreams(),c=new d;return d.all({layout:a,streams:b}).then(function(a){var b=a.streams.filter(function(b){return a.layout.stream?b.qId===a.layout.stream.id&&b.privileges.indexOf("publish")!==-1:b.privileges.indexOf("publish")!==-1});c.resolve(b)}),c.promise},getMatchingFields:function(a){return this.rpc("GetMatchingFields",null,[a])},getContentLibraries:function(){return this.rpc("GetContentLibraries").then(function(a){return a.qList.qItems})},getLibraryContent:function(a){return this.rpc("GetLibraryContent",null,[a]).then(function(a){return a.qList.qItems})},getMediaList:function(){return this.rpc("GetMediaList").then(function(a){return a.qList.qItems})},findMatchingFields:function(a,b){return this.rpc("FindMatchingFields",null,[a,b])},abortModal:function(a){return a=void 0===a||a,this.setModal(null),this.rpc("AbortModal",null,[a])},switchModal:function(a,b,c){var e,f=this;return a=a||null,b=b||"",e=Array.isArray(b)?b:[b],c=void 0===c||c,f.modalObject&&!f.modalObject.isClosed&&f.modalObject.rpc("EndSelections",null,[c]),a&&!a.isClosed?(f.modalObject=a,a.rpc("BeginSelections",null,[e])):(f.setModal(null),d.resolve())},setModal:function(a){this.modalObject=a},isModal:function(){return null!=this.modalObject},publish:function(a){return this.rpc("Publish",null,[a])}}),Object.defineProperty(j,"current",{get:function(){return k}}),j.makeCacheId=function(a,b){var c=a.toLowerCase();return b&&(c+=b.host?"/"+b.host:"/",c+=b.identity?"/"+b.identity:"/",c+=b.openWithoutData?"/openWithoutData":"/",c+=b.port?"/"+b.port:"/"),c},j.get=function(a,b,c,d){var e=j.getSync(a,b,c,d);return e.waitForOpen.promise},j.getSync=function(a,b,c,d){a=a||e.getParameterByName("app")||"?transient=","undefined"==typeof b&&(b={}),"string"!=typeof b.host&&(b.host=e.hostname),"string"!=typeof b.port&&(b.port=e.port),"string"!=typeof b.prefix&&(b.prefix=e.basePath),"boolean"!=typeof b.isSecure&&(b.isSecure=e.isSecure),"string"!=typeof b.reloadURI&&(b.reloadURI=e.reloadURI);var f=j.makeCacheId(a,b),g=l[f]=l[f]||new j(a,b,c,d);return g.cacheId=f,g},j.create=function(a,b){return b.rpc({method:"CreateApp",handle:-1,params:[a]}).then(function(a){return a.result})},j.remove=function(a,b){return b.rpc({method:"DeleteApp",handle:-1,params:[a]}).then(function(a){return a.result})},j.getList=function(a){return a.rpc({method:"GetDocList",handle:-1,params:[]}).then(function(a){return a.result.qDocList})},j}),define("objects.backend-api/backend-api",["jquery","core.utils/class","core.utils/deferred","./cache-cube","./backend-throttle","core.models/app"],function(a,b,c,d,e,f){"use strict";var g;return g=b.extend("BackendApi",{init:function(a,b,c){this.model=a,this.localeInfo=a.session.currentApp?a.session.currentApp.layout.qLocaleInfo:{},this.path=b,b&&(this.dataPath=b.slice(1,-3)),this.cacheCube=new d(a,"qDataPages",this.path,c),this.backendStackThrottle=new e(a,"qDataPages",this.path)},setCacheOptions:function(a){this.cacheCube.setOptions(a)},updateCache:function(){},applyPatches:function(a){return this.model.rpc("ApplyPatches",null,a)},clearSoftProperties:function(){var a=this;return this.model.getLayout().then(function(b){return b.qHasSoftPatches?a.model.rpc("ClearSoftPatches"):c.resolve()})},beginSelections:function(){return f.current.switchModal(this.model,this.path)},endSelections:function(a){return f.current.switchModal(null,null,a)},clearSelections:function(a){return a=a||0,this.model.rpc("ClearSelections",null,[this.path,[a]])},getDimensionInfos:function(){return this.model.layout[this.dataPath].qDimensionInfo?Array.isArray(this.model.layout[this.dataPath].qDimensionInfo)?this.model.layout[this.dataPath].qDimensionInfo:[this.model.layout[this.dataPath].qDimensionInfo]:[]},getMeasureInfos:function(){return this.model.layout[this.dataPath].qMeasureInfo},getRowCount:function(){return this.model.layout[this.dataPath].qSize.qcy},eachDataRow:function(b){var c=this.model.layout[this.dataPath],d=!0;c&&a.each(c.qDataPages,function(c,e){return a.each(e.qMatrix,function(a,c){return d=b(e.qArea.qTop+a,c)}),d})},drillUp:function(a,b){return this.model.rpc("DrillUp",null,[this.path,a,b])},hasSelections:function(){for(var a=this.getDimensionInfos(),b=0;b<a.length;++b)if(a[b].qStateCounts.qSelected>0)return!0;return!1},inSelections:function(){return this.model.layout.qSelectionInfo&&this.model.layout.qSelectionInfo.qInSelections},destroy:function(){this.cacheCube.destroy(),this.backendStackThrottle.destroy()},getSize:function(){return this.model.layout[this.dataPath].qSize}})}),define("objects.backend-api/snapshot-api",["./backend-api","core.utils/deferred","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function(a,b,c,d){"use strict";function e(a,b,c,d){if(a){b.snapshotData.object.origDataPages||(b.snapshotData.object.origDataPages=b.qHyperCube[d]);for(var e=0;e<c.length;e++)c[e].qHeight=Math.min(b.qHyperCube.qSize.qcy,c[e].qHeight),c[e].qTop=b.snapshotData.object.origDataPages[e].qArea.qTop;b.qHyperCube[d]=a.get(c)}}function f(a){if("pivot-table"===a.visualization)this.responseProperty="qPivotDataPages",this.slicer=new d;else{if("table"!==a.visualization)return;this.slicer=new c}a.snapshotData.object.origDataPages?this.slicer.store(a.snapshotData.object.origDataPages):this.slicer.store(a.qHyperCube[this.responseProperty])}var g;return g=a.extend("SnapshotAPI",{init:function(a){this.responseProperty="qDataPages",f.call(this,a.layout),this._super(a,a.layout.qListObject?"/qListObjectDef":"/qHyperCubeDef")},getData:function(a){var c=b();if("map"===this.model.layout.visualization){var d=this.dataPath.split("/")[1],f=this.dataPath.split("/"),g=f[f.length-1];"polygon"===this.model.layout.layers[d].type&&"3"===this.model.layout.layers[d].version?c.resolve(this.model.layout.layers[d].geodata.qHyperCube[this.responseProperty]):c.resolve(this.model.layout.layers[d][g][this.responseProperty])}else e(this.slicer,this.model.layout,a,this.responseProperty),c.resolve(this.model.layout[this.dataPath][this.responseProperty]);return c.promise},getHyperCubeBinnedData:function(){return b.resolve(this.model.layout.dataPages)},getHyperCubeContinousData:function(){return b.resolve({qDataPages:this.model.layout.qHyperCube.qDataPages,qAxisData:this.model.layout.qHyperCube.qAxisData})},getSize:function(){return this.model.layout[this.dataPath].qSize},beginSelections:function(){},endSelections:function(){},clearSelections:function(){},isSnapshot:!0})}),define("client.utils/state",["core.utils/notification","general.controllers/route-controller"],function(a,b){"use strict";var c,d,e,f,g,h,i={};return i.States={analysis:0,edit:1,play:2,editstory:3},i.Views={overview:0,sheet:1,story:2,object:3,masterObject:4,dataManager:7,dataSpaceScriptEditor:8,dataSpaceAssociations:9,dataSpaceDataModel:10},a.mixin(i),i.notification("StateChanged"),i.notification("SheetChanged"),i.notification("StoryChanged"),i.setState=function(a){a!==d&&(g=d,d=a,i.StateChanged.emit(c,d,h,g),c===i.Views.sheet||c===i.Views.object||c===i.Views.masterObject?b.setUrl(b.buildUrl("sheet",e.layout.qInfo.qId,"state",Object.keys(i.States)[a])):c===i.Views.story&&b.setUrl(b.buildUrl("story",e.layout.qInfo.qId,"state",Object.keys(i.States)[a],"slide",f)))},i.setView=function(a){a!==c&&(h=c,c=a,a===i.Views.overview&&(e=null),i.StateChanged.emit(c,d,h,g))},i.setSheet=function(a,b){var f=!1;a!==e&&(e=a,h=c,c=i.Views.sheet,i.SheetChanged.emit(a),f=!0),i.States[b]!==d&&(g=d,d=i.States[b]||i.States.analysis,f=!0),f&&i.StateChanged.emit(c,d,h,g)},i.setStory=function(a,b,j){var k=!1;a!==e&&(e=a,h=c,c=i.Views.story,i.StoryChanged.emit(a),k=!0),f=j,i.States[b]!==d&&(g=d,d=i.States[b]||i.States.editstory,k=!0),k&&i.StateChanged.emit(c,d,h,g)},i.isInAnalysisMode=function(){return d===i.States.analysis},i.isInEditMode=function(){return d===i.States.edit},i.inStoryPlayState=function(){return i.inStorytelling()&&d===i.States.play},i.inStorytelling=function(){return c===i.Views.story},i.inAppOverView=function(){return c===i.Views.overview},i.inDataManager=function(){return c===i.Views.dataManager},i.inDataSpaceScriptEditor=function(){return c===i.Views.dataSpaceScriptEditor},i.inDataSpaceDataModel=function(){return c===i.Views.dataSpaceDataModel},i.inSheetView=function(){return c===i.Views.sheet},i.inObjectView=function(){return c===i.Views.object},i.inMasterObjectView=function(){return c===i.Views.masterObject},i.getModel=function(){return i.model},Object.defineProperties(i,{state:{get:function(){return d}},view:{get:function(){return c}},model:{get:function(){return e},set:function(a){e=a}}}),i}),define("client.utils/property-resolver",["util"],function(a){function b(a){return"object"==typeof a.items&&"array"!==a.type&&("items"===a.type||"items"===a.component||"expandable-items"===a.component||"accordion"===a.component||!a.type&&!a.component)}function c(a,b,c){if("string"!=typeof b)return b;switch(a){case"integer":b=parseInt(b,10),isNaN(b)&&(b=c);break;case"number":b=parseFloat(b),isNaN(b)&&(b=c);break;case"boolean":b="true"===b}return b}function d(a,b){if("function"==typeof b.defaultValue)return b.defaultValue();if("undefined"!=typeof b.defaultValue)return b.defaultValue;if(Array.isArray(b.options))return b.options[0].value;switch(a){case"array":return[];case"string":return"";case"integer":return 0;case"number":return 0;case"boolean":return!1;default:return null}}function e(c){function e(c){var g,h,i;if(!c.schemaIgnore)if(b(c))for(g=Object.keys(c.items),i=0;i<g.length;i++)h=c.items[g[i]],h&&e(h);else c.ref&&!c.schemaIgnore&&a.setValue(f,c.ref,d(c.type,c))}var f={};return"array"===c.type&&c.items?(f={},e({type:"items",items:c.items})):e(c),f}var f={};return f.invertedBoolean={get:function(a){return!a("boolean")},set:function(a,b){b("boolean",!a)}},f.booleanToSortInteger={get:function(a){return!!a("integer")},set:function(a,b,c){var d;a?(d=c.defaultSort?c.defaultSort:1,b("integer",d)):b("integer",0)}},f.enumToSortInteger={get:function(a){switch(a("integer")){case-1:return"descending";case 1:return"ascending";default:return"disabled"}},set:function(a,b){switch(a){case"descending":b("integer",-1);break;case"ascending":b("integer",1);break;default:b("integer",void 0)}}},f.invertedEnumToSortInteger={get:function(a){switch(a("integer")){case 1:return"descending";case-1:return"ascending";default:return"disabled"}},set:function(a,b){switch(a){case"descending":b("integer",1);break;case"ascending":b("integer",-1);break;default:b("integer",void 0)}}},{getValue:a.getValue,setValue:a.setValue,getTypeValue:c,getDefaultValue:d,getDefaults:e,resolveFunctions:f,isHierarchical:b}}),define("client.property-panel/default-sorting-properties",["client.utils/property-resolver"],function(a){var b=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return{type:"array",component:"sorting",translation:"properties.sorting",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",allowMove:!0,schemaIgnore:!0,items:{dimensions:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){if(a.qDef.autoSort)return b.autoSortDimension(a).then(function(){})}},dimension:{component:"sorting-dimension",type:"items",ref:"",items:{dimensionDefinition:{type:"items",grouped:!0,items:{expression:{type:"items",items:{expressionToggled:{type:"boolean",ref:"qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",expressionType:"ValueExpr",ref:"qExpression",translation:"Common.Expression",defaultValue:"",show:function(b){return 0!==a.getValue(b,"qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qSortByExpression",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByExpression",0)}}}},frequency:{type:"items",show:!1,items:{frequencyToggled:{type:"boolean",ref:"qSortByFrequency",translation:"properties.sorting.sortByFrequency",resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qSortByFrequency",options:b,resolveFunctions:"invertedEnumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByFrequency",0)}}}},numeric:{type:"items",items:{numericToggled:{type:"boolean",ref:"qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortByNumeric",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByNumeric",0)}}}},ascii:{type:"items",items:{asciiToggled:{type:"boolean",ref:"qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortByAscii",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(a){return!(a.qSortByAscii||a.qSortByNumeric||a.qSortByExpression||a.qSortByFrequency)}}}}}}}},measures:{type:"items",component:"expandable-items",grouped:!0,ref:"qHyperCubeDef.qMeasures",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){if(a.qDef.autoSort)return b.autoSortMeasure(a).then(function(){})}},numeric:{type:"items",show:function(a){return!a.qDef.autoSort},items:{numericToggled:{type:"boolean",ref:"qSortBy.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByNumeric",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortBy.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(a){return!a.qDef.autoSort},items:{asciiToggled:{type:"boolean",ref:"qSortBy.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByAscii",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortBy.qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(b){var c;return!b.qDef.autoSort&&(c=a.getValue(b,"qSortBy",{}),!(c.qSortByAscii||c.qSortByNumeric||c.qSortByFrequency))}}}}}}}),define("general.utils/number-formatting",["util"],function(a){function b(a,b,c,d,e){void 0===c&&(c=e.qDecimalSep),void 0===d&&(d=e.qThousandSep);var f,g,h,i,j="";if("F"===a)if(0===b)j="#"+d+"##0";else for(j="#"+d+"##0"+c,h=0;h<b;++h)j+="0";else{for(h=0;h<b;++h)j+="#";b>3&&(i=j.length,f=j.substring(0,i-3),g=j.substr(i-3),j=f+d+g)}return j}var c;return{setNumFmtPattern:function(a,b,d){var e,f={type:b.qType||"U",nDec:"qType"===a?("F"===b.qType,2):"R"===b.qType?b.qnDec||10:"number"==typeof b.qnDec?Math.max(0,b.qnDec):2,thousandSep:b.qThou,decimalSep:b.qDec};e=this._getSeparators(a,"M"===b.qType,f.decimalSep,f.thousandSep,d),e.decimal!==c&&(f.decimalSep=e.decimal),e.thousand!==c&&(f.thousandSep=e.thousand),b.qType=f.type,b.qnDec=f.nDec,b.qDec=f.decimalSep,b.qThou=f.thousandSep,b.qFmt=this._getPattern(f.type,f.nDec,f.decimalSep,f.thousandSep,d),["D","T","TS","IV"].indexOf(f.type)>=0&&(b.qDec="",b.qThou="")},_getSeparators:function(a,b,c,d,e){var f=c,g=d,h="q"+(b?"Money":"");return"qType"===a?(g=e[h+"ThousandSep"]||"",f=e[h+"DecimalSep"]||"."):"qThou"===a&&void 0===d?(g=e[h+"ThousandSep"]||"",f=c||"."):"qDec"!==a||void 0!==c&&""!==c||(f=e[h+"DecimalSep"]||".",g=d||""),{decimal:f||".",thousand:g||""}},_getPattern:function(b,c,d,e,f){var g;switch(b){case"U":return"";case"I":return"#"+e+"##0";case"R":case"F":return this.getNDecPattern("F",c,d,e,f);case"M":return g=f.qMoneyFmt,f.qMoneyDecimalSep&&(g=g.replace(new RegExp(a.escapeRegExp(f.qMoneyDecimalSep),"g"),d)),f.qMoneyThousandSep&&(g=g.replace(new RegExp(a.escapeRegExp(f.qMoneyThousandSep),"g"),e)),g;case"D":return f.qDateFmt;case"T":return f.qTimeFmt;case"TS":return f.qTimestampFmt;case"IV":return"h:mm:ss";default:return""}},getDefaultNumericFormat:function(a,c){return b("F",2,a.qDec,a.qThou||"",c)},getNDecPattern:b,getNormalizedFormat:function(a,b){var c=a.qDec+a.qThou;return/\u00a0/.test(c)&&!/\u0020/.test(c)?b.replace(/\u0020/g,""):b}}}),define("client.utils/theme/theme",["jquery","util","core.utils/notification","text!themes/sense/theme.json","require"],function(a,b,c,d,e){"use strict";function f(a,b){var c=document.createElement("link");return c.setAttribute("rel","stylesheet"),c.setAttribute("href",e.toUrl("themes/"+a+"/"+(b||"theme.css"))),document.head.appendChild(c),c}function g(a,c,d){try{a=JSON.parse(a)}catch(e){console.warn("Theme parsing error for theme: "+d+": "+e),a={}}b.extend(!0,r,k,a),c&&q.forEach(function(c){var d=b.getValue(a,c);void 0!==d&&b.setValue(r,c,d)}),o=[],a.customStyles&&a.customStyles.length&&a.customStyles.forEach(function(a){o.push({node:f(d,a.cssRef),cssClass:a.classRef}),i(a.classRef,!0)}),p=a}function h(a){var b=f(a);return e(["text!themes/"+a+"/theme.json"],function(b){g(b,!0,a),r.ThemeChanged.emit()}),b}function i(b,c){a(".qv-client").toggleClass(b,c)}function j(){n.parentNode.removeChild(n),o.forEach(function(a){a.node.parentNode.removeChild(a.node),i(a.cssClass,!1)}),Object.keys(p).forEach(function(a){delete r[a]})}var k=JSON.parse(d),l="sense",m=null,n=null,o=[],p={},q=["palette","colorSchemes.qualitativeScales","colorSchemes.ordinalScales"],r={};return c.create(r,"ThemeChanged"),Object.defineProperty(r,"name",{iterable:!1,get:function(){return m||l}}),r.set=function(a){a.indexOf("/")>-1||a!==m&&(m&&j(),a&&(n=h(a),m=a))},f("sense"),g(d),r}),define("general.utils/string-limits",[],function(){"use strict";var a={};return Object.defineProperties(a,{name:{value:255,writable:!1},description:{value:512,writable:!1},expression:{value:8192,writable:!1},script:{value:5e4,writable:!1},textImage:{value:12e3,writable:!1}}),a}),define("core.utils/feature-flags",["util"],function(a){var b={PUBLISH:!1,SMARTSEARCH_OBJECTS:!0,QDM_MULTITABLE:!0,TALC:!0,TALC2D:!0,CROSS_TABLE:!0,DM_GEOPOINT:!0,WIDGET:!0,COLORBY:!0,ENT_CONNECT:!1,CARDS:!1,REGIONAL_DATA:!1,DM_GEOINFO:!0,MAGIC2:!0,DM_BUBBLES_FIRST:!0,CONNECTOR_LOGO_PAGE:!0,SEARCH_HISTORY:!1,DEVHUB_TRANSITION:!1,GENERIC_SELECT_FILTER_TABLE:!0,MONKEY:!1},c=(a.getParameterByName("feature")||"").split("+");return c.forEach(function(a){a&&(b[a.toUpperCase()]=!0)}),b}),define("client.utils/property-hypercube-helper",["client.utils/property-resolver"],function(a){var b={getDimensions:function(b){return a.getValue(b,"qHyperCubeDef.qDimensions",[])},getNumDimensions:function(b){return a.getValue(b,"qHyperCubeDef.qDimensions.length",0)},getMeasures:function(b){return a.getValue(b,"qHyperCubeDef.qMeasures",[])},getNumMeasures:function(b){return a.getValue(b,"qHyperCubeDef.qMeasures.length",0)},getDimensionLayouts:function(a){return a&&a.qHyperCube?a.qHyperCube.qDimensionInfo:[]},getDimensionLayout:function(a,b){return this.getDimensionLayouts(b).filter(function(b){return a===b.cId})[0]},getMeasureLayouts:function(a){return a&&a.qHyperCube?a.qHyperCube.qMeasureInfo:[]},getMeasureLayout:function(a,b){return this.getMeasureLayouts(b).filter(function(b){return a===b.cId})[0]}};return b}),define("general.utils/attribute-expression-util",[],function(){return{getById:function(a,b,c){return!!a&&(c=c||"id",a.filter(function(a){return a[c]===b})[0])},getIndexById:function(a,b,c){var d=-1;return a&&(c=c||"id",a.forEach(function(a,e){a[c]===b&&(d=e)})),d},moveById:function(a,b,c,d){var e=this.getIndexById(a,c,d);if(b=b||[],e!==-1){var f=a.splice(e,1);b.push(f[0])}return b},moveByIdFromGroup:function(a,b,c,d,e){c=c||"qAttributeExpressions",e=e||"id";for(var f=0;f<a.length;f++){var g=a[f][c],h=b.length;if(this.moveById(g,b,d,e),h!==b.length)return b}return b},clean:function(a){return a.filter(function(a){return a&&a.id})},IDMAP:{CELL_BACKGROUND_COLOR:"cellBackgroundColor",CELL_FOREGROUND_COLOR:"cellForegroundColor",COLOR_BY_ALTERNATIVE:"colorByAlternative",COLOR_BY_EXPRESSION:"colorByExpression"}}}),define("client.utils/default-property-logic",["client.utils/theme/theme","core.utils/feature-flags","client.utils/property-resolver","client.utils/property-hypercube-helper","general.utils/attribute-expression-util"],function(a,b,c,d,e){function f(a){return c.getValue(a,"color.reverseScheme")!==!0}function g(a){return"byExpression"===c.getValue(a,"color.mode")&&c.getValue(a,"color.expressionIsColor")===!1}function h(a){return"byExpression"===c.getValue(a,"color.mode")&&c.getValue(a,"color.expressionIsColor")===!0}function i(a){var e=c.getValue(a,"color.auto"),f=c.getValue(a,"color.mode"),g=d.getNumMeasures(a),h=d.getNumDimensions(a);return h>1&&g<=1&&!e&&"byDimension"===f&&!b.COLORBY}function j(a){var b=d.getDimensionLayouts(a)[0];return b&&b.qCardinal>n}function k(){var b=[],c=a.colorSchemes.qualitativeScales;return c.forEach(function(a){if("true"!==a.disabled){var c={type:"classes",component:"color-scale",translation:a.translation||a.name,value:a.propertyValue};"pyramid"===a.type?c.colors=a.scale[a.scale.length-1]:c.colors=a.scale,b.push(c)}}),b}function l(){var b=[],c=a.colorSchemes.ordinalScales;return c.forEach(function(a){if(!a.disabled){var c={component:"color-scale",reverse:this.helpers.schemeIsReverse,translation:a.translation||a.name,value:a.propertyValue};"class-pyramid"===a.type?(c.colors=a.scale[a.scale.length-1],c.type="classes"):(c.colors=a.scale,c.type="gradient"),b.push(c)}},this),b}function m(a,b){var c=t[a]||o;return c[b]||o[b]}var n=1e3,o={
showLegend:function(a){var b=c.getValue(a,"color.auto"),e=c.getValue(a,"color.mode"),f=c.getValue(a,"color.expressionIsColor"),g=d.getNumDimensions(a),h=d.getNumMeasures(a);return b&&(g>1||h>1)||!b&&"primary"!==e&&("byExpression"!==e||!f)},colorModeOptions:{primary:function(){return!0},dimension:function(a){return d.getNumMeasures(a)<=1},multiColor:function(a){return d.getNumMeasures(a)>1},measure:function(a){return 1===d.getNumMeasures(a)},expression:function(a){return d.getNumMeasures(a)>=1}},persistentColorsShow:function(a){return!c.getValue(a,"color.auto")&&"byDimension"===c.getValue(a,"color.mode")&&d.getNumMeasures(a)<=1},expressionLabelChange:function(a){var b=c.getValue(a,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=c.getValue(a,"color");b&&(b.label=c.getValue(a,"color.expressionLabel"),d&&(d.colorExpression=b.qExpression))},attributeExpressionChange:function(a){var b=c.getValue(a,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=c.getValue(a,"color");b&&(b.id="colorByExpression",d&&(d.colorExpression=b.qExpression))},attributeExpressionGlobalChange:function(a){var b,d,e,f=c.getValue(a,"qHyperCubeDef.qMeasures",[]),g=c.getValue(a,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),h=null,i=function(a,b){"colorByExpression"===a.id&&(d=b)};if(f.length+g.length>1){for(b=g.length-1;b>=0;--b)e=g[b].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);for(b=f.length-1;b>=0;--b)e=f[b].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);f.length&&(!f[0].qAttributeExpressions&&h&&(f[0].qAttributeExpressions=[]),h&&f[0].qAttributeExpressions.splice(0,0,h))}var j=c.getValue(a,"color.colorExpression");1!==f.length||f[0].qAttributeExpressions&&0!==f[0].qAttributeExpressions.length||!j||(f[0].qAttributeExpressions=[{qExpression:j,id:"colorByExpression"}])},colorByGlobalChange:function(a,d,f){var g,h,i,j=c.getValue(a,"color.mode"),k=c.getValue(a,"color.auto"),l=c.getValue(a,f+"qDimensions",[]),m=c.getValue(a,f+"qMeasures",[]),n=c.getValue(a,f+"qLayoutExclude.qHyperCubeDef.qDimensions",[]);if(!b.COLORBY)return void("byDimension"===j&&m.length>1&&"scatterplot"!==c.getValue(a,"visualization")?c.setValue(a,"color.mode","byMultiple"):"byMultiple"===j&&m.length<2&&c.setValue(a,"color.mode","primary"));if(!k&&"byDimension"===j&&l.length){if(m.length>1&&"scatterplot"!==c.getValue(a,"visualization"))return void c.setValue(a,"color.mode","byMultiple");if(g=c.getValue(a,"color.byDimDef"),!g||!g.key){h=l[l.length-1];var o=f.split(".");if(2===l.length&&"map"===c.getValue(a,"visualization")&&"point"===a.layers[Number(o[1])].type&&(h=l[0]),i=e.getById(h.qAttributeDimensions,e.IDMAP.COLOR_BY_ALTERNATIVE))return void(i.qLibraryId?d.setColorByDef({type:"dimension",name:i.qLibraryId,id:i.qLibraryId}):d.setColorByDef({type:"field",name:i.label||i.qDef,id:i.qDef}));h.qLibraryId?d.setColorByDef({type:"dimension",name:h.qLibraryId,id:h.qLibraryId}):d.setColorByDef({type:"field",name:h.qDef.qFieldDefs[0],label:""!==h.qDef.qFieldLabels[0]?h.qDef.qFieldLabels[0]:h.qDef.qFieldDefs[0]})}d.setColorByItem(!0,l,n,c.getValue(a,"color.byDimDef.label"))}else if(!k&&"byMeasure"===j&&l.length){if(g=c.getValue(a,"color.byMeasureDef"),m.length>1&&"scatterplot"!==c.getValue(a,"visualization"))return void c.setValue(a,"color.mode","byMultiple");if((!g||!g.key)&&m.length){var p=m[0];if(h=l[l.length-1],i=e.getById(h.qAttributeExpressions,e.IDMAP.COLOR_BY_ALTERNATIVE))return void(i.qLibraryId?d.setColorByDef({type:"measure",name:i.qLibraryId,id:i.qLibraryId}):d.setColorByDef({type:"expression",name:i.label||i.qExpression,id:i.qExpression}));p.qLibraryId?d.setColorByDef({type:"measure",name:p.qLibraryId,id:p.qLibraryId}):d.setColorByDef({type:"expression",name:p.qDef.qDef,label:p.qDef.qLabel||p.qDef.qDef})}d.setColorByItem(!1,l,n,c.getValue(a,"color.byMeasureDef.label"))}else"byMultiple"===j&&m.length<2&&c.setValue(a,"color.mode","primary"),d.clearColorByItem(l,n)}},p={showLegend:function(a){var b=c.getValue(a,"color.auto"),d=c.getValue(a,"color.expressionIsColor"),e=c.getValue(a,"color.mode");return!(!b&&"primary"===e||!b&&"byExpression"===e&&(d||void 0===d))}},q={colorModeOptions:{primary:function(){return!0},dimension:function(){return!0},multiColor:function(){return!1},measure:function(){return!1},expression:function(a){return d.getNumMeasures(a)>=1}},showLegend:function(a){return"primary"!==c.getValue(a,"color.mode")&&!c.getValue(a,"color.auto")},persistentColorsShow:function(a){return!c.getValue(a,"color.auto")&&"byDimension"===c.getValue(a,"color.mode")}},r={colorModeOptions:{primary:function(){return!0},dimension:function(a){return d.getNumDimensions(a)>1},multiColor:function(a){return d.getNumMeasures(a)>1},measure:function(a){return 1===d.getNumMeasures(a)&&d.getNumDimensions(a)<=1},expression:function(a){return d.getNumMeasures(a)>=1}}},s={colorModeOptions:{primary:function(){return!0},dimension:function(a){return d.getNumDimensions(a)>=1},multiColor:function(a){return d.getNumMeasures(a)>1},measure:function(a){return d.getNumDimensions(a)>=1},expression:function(a){return d.getNumDimensions(a)>=1}}},t={scatterplot:q,piechart:p,linechart:r,map:s},u=function(a,e){var n=m(e,"colorModeOptions"),o=m(e,"persistentColorsShow"),p=m(e,"expressionLabelChange"),q=m(e,"attributeExpressionChange"),r=m(e,"attributeExpressionGlobalChange"),s=m(e,"colorByGlobalChange");this.helpers={schemeIsReverse:f,showDimensionIdOption:i,showCompressionResolution:j,colorModeOptions:n,getMeasureSchemeOptions:l.bind(this),getDimensionSchemeOptions:k},this.color={colorMode:{options:function(b){var c=[];return"explore"===a&&c.push({value:"auto",translation:"Common.Auto"}),n.primary(b)&&c.push({value:"primary",translation:"properties.colorMode.primary"}),n.multiColor(b)&&c.push({value:"byMultiple",translation:"properties.colorMode.multicolored"}),n.dimension(b)&&c.push({value:"byDimension",translation:"properties.colorMode.byDimension"}),n.measure(b)&&c.push({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),n.expression(b)&&"explore"!==a&&c.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),c},show:function(a){return!c.getValue(a,"color.auto")}},singleColor:{show:function(a){return!c.getValue(a,"color.auto")&&"primary"===c.getValue(a,"color.mode")}},colorBy:{globalChange:s,dimension:{show:function(a){return!c.getValue(a,"color.auto")&&"byDimension"===c.getValue(a,"color.mode")&&b.COLORBY}},measure:{show:function(a){return!c.getValue(a,"color.auto")&&"byMeasure"===c.getValue(a,"color.mode")&&b.COLORBY}},label:{show:function(a){return!c.getValue(a,"color.auto")&&b.COLORBY&&("byDimension"===c.getValue(a,"color.mode")&&"libraryItem"!==c.getValue(a,"color.byDimDef.type")||"byMeasure"===c.getValue(a,"color.mode")&&"libraryItem"!==c.getValue(a,"color.byMeasureDef.type"))}}},persistentColors:{show:o,readOnly:function(a){return c.getValue(a,"qHyperCubeDef.qDimensions.length")>1}},attributeExpression:{change:q,globalChange:r,show:function(a){return!c.getValue(a,"color.auto")&&"byExpression"===c.getValue(a,"color.mode")&&d.getNumMeasures(a)>0}},expressionIsColor:{show:function(a){return!c.getValue(a,"color.auto")&&"byExpression"===c.getValue(a,"color.mode")&&d.getNumMeasures(a)>0}},expressionLabel:{change:p,show:function(a){return!c.getValue(a,"color.auto")&&g(a)&&d.getNumMeasures(a)>0}},colorSchemeMeasure:{show:function(a){return!c.getValue(a,"color.auto")&&("byMeasure"===c.getValue(a,"color.mode")||g(a))}},reverseScheme:{show:function(a){return!c.getValue(a,"color.auto")&&("byMeasure"===c.getValue(a,"color.mode")||g(a))}},colorSchemeDimension:{show:function(a){return!c.getValue(a,"color.auto")&&("byDimension"===c.getValue(a,"color.mode")||"byMultiple"===c.getValue(a,"color.mode"))}},customRange:{show:function(a){return!c.getValue(a,"color.auto")},autoMinMax:{show:function(a){return"byMeasure"===c.getValue(a,"color.mode")||g(a)}},min:{show:function(a){return("byMeasure"===c.getValue(a,"color.mode")||g(a))&&c.getValue(a,"color.autoMinMax")===!1},invalid:function(a){return"minMax"===c.getValue(a,"color.minMax")&&c.getValue(a,"color.measureMin")>=c.getValue(a,"color.measureMax")}},max:{show:function(a){return("byMeasure"===c.getValue(a,"color.mode")||g(a))&&c.getValue(a,"color.autoMinMax")===!1},invalid:function(a){return"minMax"===c.getValue(a,"color.minMax")&&c.getValue(a,"color.measureMin")>=c.getValue(a,"color.measureMax")}}}};var t=m(e,"showLegend");this.legend={show:t,showTitle:{show:function(a){return c.getValue(a,"legend.show")&&t(a)&&!h(a)}},dock:{show:function(a){return c.getValue(a,"legend.show")&&t(a)}}}};return{getLogicFor:function(a,b){return new u(a,b)}}}),define("client.property-panel/default-properties",["client.utils/property-resolver","client.property-panel/default-sorting-properties","general.utils/number-formatting","translator","client.utils/theme/theme","general.utils/string-limits","util","client.utils/default-property-logic"],function(a,b,c,d,e,f,g,h){function i(b,d){return a.getValue(b,"qDef.qNumFormat.qFmt")===c.getDefaultNumericFormat(b.qDef.qNumFormat,d?d.localeInfo:"")}function j(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return["R","M","IV"].contains(c)||"U"!==c&&a.getValue(b,"qDef.numFormatFromTemplate",!0)===!1}var k={sorting:b,"dimensions-sorting":b.items.dimensions,"measures-sorting":b.items.measures},l=h.getLogicFor("hard","default");return k.general={type:"items",translation:"properties.general",grouped:!0,items:{showTitles:{translation:"properties.showTitles",type:"boolean",ref:"showTitles",component:"switch",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-showTitles"}},titles:{type:"items",show:function(a){return a.showTitles!==!1},items:{title:{translation:"Common.Title",type:"string",expression:"optional",ref:"title",defaultValue:""},subtitle:{translation:"properties.subtitle",type:"string",expression:"optional",ref:"subtitle",defaultValue:""},footnote:{translation:"properties.footnote",type:"string",expression:"optional",ref:"footnote",defaultValue:""}}}}},k.metadata={type:"items",translation:"properties.metadata",schemaIgnore:!0,show:function(a){return"masterobject"===a.qInfo.qType},grouped:!0,items:{name:{translation:"Common.Name",type:"string",ref:"qMetaDef.title",minlength:1,rollbackInvalid:!0,show:function(a){return a.qMetaDef}},description:{translation:"Common.Description",type:"string",component:"textarea",ref:"qMetaDef.description",maxlength:f.description,show:function(a){return a.qMetaDef}},tags:{translation:"Common.Tags",component:"tags",type:"array",ref:"qMetaDef.tags",show:function(a){return a.qMetaDef}}}},k.settings={type:"items",component:"expandable-items",translation:"Common.Appearance",items:{metadata:k.metadata,general:k.general}},k.addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{}},k.dimensions={type:"array",component:"dimensions",translation:"Common.Dimensions",ref:"qHyperCubeDef.qDimensions",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qLibraryId",translation:"Common.Dimension",show:function(a){return a.qLibraryId}},inlineDimension:{component:"inline-dimension",show:function(a){return!a.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},nullSuppression:{type:"boolean",ref:"qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0},dimensionLimits:{type:"items",items:{otherMode:{type:"string",component:"dropdown",ref:"qOtherTotalSpec.qOtherMode",translation:"properties.dimensionLimits.limitation",options:[{value:"OTHER_OFF",translation:"properties.dimensionLimits.none"},{value:"OTHER_COUNTED",translation:"properties.dimensionLimits.fixedNumber"},{value:"OTHER_ABS_LIMITED",translation:"properties.dimensionLimits.exactValue"},{value:"OTHER_REL_LIMITED",translation:"properties.dimensionLimits.relativeValue"}],defaultValue:"OTHER_OFF",readOnly:function(a,b){return 0===b.getMeasures().length},change:function(b){var c,d=a.getValue(b,"qOtherTotalSpec.qOtherMode");"OTHER_REL_LIMITED"===d?(c=a.getValue(b,"qOtherTotalSpec.qOtherLimit.qv","0"),c.length&&"%"!==c[c.length-1]&&g.isNumeric(c)&&(b.qOtherTotalSpec.qOtherLimit||a.setValue(b,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),b.qOtherTotalSpec.qOtherLimit.qv=c+"%")):"OTHER_ABS_LIMITED"===d&&(c=a.getValue(b,"qOtherTotalSpec.qOtherLimit.qv","0"),c.length&&"%"===c[c.length-1]&&(b.qOtherTotalSpec.qOtherLimit||a.setValue(b,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),b.qOtherTotalSpec.qOtherLimit.qv=c.substr(0,c.length-1)))}},otherSortMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherSortMode",options:[{value:"OTHER_SORT_DESCENDING",translation:"Common.Top"},{value:"OTHER_SORT_ASCENDING",translation:"Common.Bottom"}],defaultValue:"OTHER_SORT_DESCENDING",show:function(b,c){return"OTHER_COUNTED"===a.getValue(b,"qOtherTotalSpec.qOtherMode")&&c.getMeasures().length>0}},otherCounted:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherCounted",defaultValue:{qv:"10"},show:function(b,c){return"OTHER_COUNTED"===a.getValue(b,"qOtherTotalSpec.qOtherMode")&&c.getMeasures().length>0}},otherLimitMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherLimitMode",options:[{value:"OTHER_GE_LIMIT",label:">=",tooltipTranslation:"properties.greaterOrEqualTo"},{value:"OTHER_GT_LIMIT",label:">",tooltipTranslation:"properties.greaterThan"},{value:"OTHER_LT_LIMIT",label:"<",tooltipTranslation:"properties.lessThan"},{value:"OTHER_LE_LIMIT",label:"<=",tooltipTranslation:"properties.lessOrEqualTo"}],defaultValue:"OTHER_GE_LIMIT",icon:!0,smallIconFont:!0,show:function(b,c){var d=a.getValue(b,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===d||"OTHER_REL_LIMITED"===d)&&c.getMeasures().length>0}},otherLimit:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherLimit",defaultValue:{qv:"0"},show:function(b,c){var d=a.getValue(b,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===d||"OTHER_REL_LIMITED"===d)&&c.getMeasures().length>0}},calculatedAgainstMessage:{component:"text",label:function(a,b){var c=b.getMeasureLayouts()[0];return c?d.get("Properties.DimensionLimits.CalculatedAgainst",c.qFallbackTitle):d.get("Properties.DimensionLimits.NoMeasure")},show:function(b){var c=a.getValue(b,"qOtherTotalSpec.qOtherMode");return"OTHER_OFF"!==c}}}},others:{type:"items",items:{suppressOther:{type:"boolean",ref:"qOtherTotalSpec.qSuppressOther",translation:"properties.dimensionLimits.showOthers",inverted:!0,defaultValue:!1,show:function(b,c){return"OTHER_OFF"!==a.getValue(b,"qOtherTotalSpec.qOtherMode")&&c.getMeasures().length>0}},othersLabel:{type:"string",expression:"optional",ref:"qDef.othersLabel",translation:"properties.dimensionLimits.othersLabel",defaultValue:function(){return d.get("properties.dimensionLimits.others")},change:function(a){if(a.qDef){var b=a.qDef.othersLabel||"";"object"==typeof b?(b=b.qStringExpression&&b.qStringExpression.qExpr||"",a.qOtherLabel={qv:0===b.indexOf("=")?b:"="+b}):a.qOtherLabel={qv:b}}},show:function(b,c){return!a.getValue(b,"qOtherTotalSpec.qSuppressOther")&&"OTHER_OFF"!==a.getValue(b,"qOtherTotalSpec.qOtherMode")&&c.getMeasures().length>0}},othersLabel2:{type:"string",component:"expression",expressionType:"StringExpr",ref:"qOtherLabel",translation:"properties.dimensionLimits.othersLabel",defaultValue:function(){return d.get("properties.dimensionLimits.others")},show:!1}}}}},k.measures={type:"array",component:"measures",translation:"Common.Measures",ref:"qHyperCubeDef.qMeasures",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.measures.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qLibraryId",translation:"Common.Measure",show:function(a){return a.qLibraryId}},inlineMeasure:{component:"inline-measure",show:function(a){return!a.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},numberFormatting:{type:"items",items:{numberFormattingType:{type:"string",component:"dropdown",ref:"qDef.qNumFormat.qType",translation:"properties.numberFormatting",defaultValue:"U",schemaIgnore:!0,options:[{value:"U",translation:"Common.Auto"},{value:"F",translation:"properties.numberFormatting.types.number"},{value:"M",translation:"properties.numberFormatting.types.money"},{value:"D",translation:"properties.numberFormatting.types.date"},{value:"IV",translation:"properties.numberFormatting.types.duration"},{value:"R",translation:"Common.Custom"}],change:function(a,b,d,e){c.setNumFmtPattern("qType",a.qDef.qNumFormat,e.localeInfo)}},numberFormattingMode:{type:"boolean",component:"switch",ref:"qDef.numFormatFromTemplate",translation:"properties.numberFormatting.formatting",defaultValue:!0,options:[{value:!0,translation:"properties.numberFormatting.simple"},{value:!1,translation:"Common.Custom"}],show:function(b){return["F","D","TS","T"].contains(a.getValue(b,"qDef.qNumFormat.qType"))}},numberFormattingTemplates:{type:"string",component:"number-formatter-dropdown",ref:"qDef.qNumFormat.qFmt",defaultValue:"#,##0",schemaIgnore:!0,show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return["F","D","TS","T"].contains(c)&&a.getValue(b,"qDef.numFormatFromTemplate",!0)===!0}},numDecimals:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.nDec",defaultValue:2,schemaIgnore:!0,min:0,max:14,show:!1},numPrecisionDigits:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.significantFigures",defaultValue:10,schemaIgnore:!0,min:1,max:14,show:!1},decimalSep:{type:"string",ref:"qDef.qNumFormat.qDec",translation:"properties.numberFormatting.dec",defaultValue:".",schemaIgnore:!0,show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"R"===c},change:function(a,b,d,e){c.setNumFmtPattern("qDec",a.qDef.qNumFormat,e.localeInfo)},invalid:function(b){return a.getValue(b,"qDef.qNumFormat.qDec")===a.getValue(b,"qDef.qNumFormat.qThou")},readOnly:function(a,b,c,d){return!i(a,d)}},thousandSep:{type:"string",ref:"qDef.qNumFormat.qThou",translation:"properties.numberFormatting.thousandSeparator",defaultValue:"",schemaIgnore:!0,show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"R"===c},change:function(a,b,d,e){c.setNumFmtPattern("qThou",a.qDef.qNumFormat,e.localeInfo)},invalid:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"I"!==c&&a.getValue(b,"qDef.qNumFormat.qDec")===a.getValue(b,"qDef.qNumFormat.qThou")},readOnly:function(a,b,c,d){return!i(a,d)}},format:{type:"string",component:"number-formatter",ref:"qDef.qNumFormat.qFmt",resetTranslation:"properties.numberFormatting.resetPattern",translation:"properties.numberFormatting.formatPattern",defaultValue:"",schemaIgnore:!0,show:function(a){return j(a)},change:function(a){a.qDef.qNumFormat.qFmt=c.getNormalizedFormat(a.qDef.qNumFormat,a.qDef.qNumFormat.qFmt)},invalid:function(a,b,c){if(["D","T","TS","IV"].contains(a.qDef.qNumFormat.qType))return!1;var d="R"===a.qDef.qNumFormat.qType?a.qDef.qNumFormat.qDec:c.localeInfo["q"+("M"===a.qDef.qNumFormat.qType?"Money":"")+"DecimalSep"],e=new RegExp("(0|#)"+g.escapeRegExp(d)+"0*#*"),f=(a.qDef.qNumFormat.qFmt||"").split(";"),h=f[0].match(e),i=h&&h[0]?h[0].length-2:0,j=f[1]?f[1].match(e):null,k=j&&j[0]?j[0].length-2:0;return i>15||k>15}}}}}},k.measureAxis={type:"items",label:d.get("properties.yAxis"),grouped:!0,items:{axis:{type:"items",items:{show:{type:"string",component:"dropdown",ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},dock:{type:"string",component:"dropdown",ref:"measureAxis.dock",translation:"Common.Position",defaultValue:"near",options:function(a,b,c){var d,e;return"horizontal"===a.orientation?(d="Common.Bottom",e="Common.Top"):(d=c.yMirrorMode?"properties.dock.right":"properties.dock.left",e=c.yMirrorMode?"properties.dock.left":"properties.dock.right"),[{value:"near",translation:d},{value:"far",translation:e}]},show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show}},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}],show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxis.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},minMax:{type:"string",component:"dropdown",ref:"measureAxis.minMax",options:[{translation:"properties.axis.min",value:"min"},{translation:"Common.Max",value:"max"},{translation:"properties.axis.minMax",value:"minMax"}],defaultValue:"min",show:function(a){return a.measureAxis&&!a.measureAxis.autoMinMax}},min:{ref:"measureAxis.min",translation:"properties.axis.min",expression:"optional",type:"number",show:function(a){return a.measureAxis&&["min","minMax"].contains(a.measureAxis.minMax)&&!a.measureAxis.autoMinMax},invalid:function(a){return!(!a.measureAxis||"minMax"!==a.measureAxis.minMax)&&a.measureAxis.min>=a.measureAxis.max}},max:{ref:"measureAxis.max",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(a){return a.measureAxis&&["max","minMax"].contains(a.measureAxis.minMax)&&!a.measureAxis.autoMinMax},invalid:function(a){return!(!a.measureAxis||"minMax"!==a.measureAxis.minMax)&&a.measureAxis.min>=a.measureAxis.max}}}}}},k.reflines={type:"array",ref:"refLine.refLines",translation:"properties.referenceLines",itemTitleRef:"label",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.referenceLines.add",items:{show:{ref:"show",translation:"Common.Show",type:"boolean",defaultValue:!0},label:{ref:"label",translation:"Common.Label",type:"string"},color:{ref:"color",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:2},expressionValue:{ref:"refLineExpr.value",translation:"properties.referenceLines.expression",type:"number",expression:"optional",expressionType:"ValueExpression",defaultValue:0,change:function(a){var b=a.refLineExpr;"object"==typeof b.value?b.label={qStringExpression:{qExpr:b.value.qValueExpression.qExpr}}:b.label=""+b.value}},expressionLabel:{ref:"refLineExpr.label",translation:"properties.referenceLines.expression",type:"string",expression:"optional",expressionType:"StringExpression",defaultValue:"0",show:!1}}},k.dataHandling={type:"items",translation:"properties.dataHandling",grouped:!0,items:{suppressZero:{ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",type:"boolean",inverted:!0},calcCond:{type:"items",items:{expr:{ref:"qHyperCubeDef.qCalcCond",type:"string",component:"expression",expressionType:"ValueExpr",translation:"properties.hyperCube.calcCond"},customErrorMessage:{ref:"qHyperCubeDef.customErrorMessage.calcCond",component:"textarea",defaultValue:"",type:"string",placeholderTranslation:"Object.ErrorMessage.CalculationCondition",translation:"properties.hyperCube.calcCondMessage",show:function(b){var c=a.getValue(b,"qHyperCubeDef.qCalcCond");return c.qv&&""!==c.qv}}}}}},k.colorsAndLegend={type:"items",translation:"properties.colorsAndLegend",grouped:!0,items:{colors:{type:"items",items:{autoColor:{ref:"color.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},colorMode:{ref:"color.mode",type:"string",component:"dropdown",options:l.color.colorMode.options,defaultValue:"primary",show:l.color.colorMode.show,globalChange:function(a,b){l.color.colorBy.globalChange(a,b,"qHyperCubeDef.")}},colorByDimension:{ref:"color.byDimDef",schemaIgnore:!0,translation:"properties.colorBy.selectDimension",type:"object",defaultValue:{},component:"color-by-dropdown",libraryItemType:"dimension",show:l.color.colorBy.dimension.show,change:function(b){b.color.altLabel=a.getValue(b,"color.byDimDef.label","")}},colorByMeasure:{ref:"color.byMeasureDef",schemaIgnore:!0,translation:"properties.colorBy.selectMeasure",type:"object",defaultValue:{},component:"color-by-dropdown",libraryItemType:"measure",show:l.color.colorBy.measure.show,change:function(b){b.color.altLabel=a.getValue(b,"color.byMeasureDef.label","")}},colorByLabel:{type:"string",ref:"color.altLabel",schemaIgnore:!0,translation:"Common.Label",show:l.color.colorBy.label.show,change:function(b){l.color.colorBy.measure&&l.color.colorBy.measure.show(b)?b.color.byMeasureDef.label=a.getValue(b,"color.altLabel",""):l.color.colorBy.dimension&&l.color.colorBy.dimension.show(b)&&(b.color.byDimDef.label=a.getValue(b,"color.altLabel",""))}},singleColor:{ref:"color.singleColor",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:3,show:l.color.singleColor.show},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",defaultValue:!1,show:l.color.persistentColors.show,readOnly:l.color.persistentColors.readOnly},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:!0,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:l.color.attributeExpression.change,globalChange:l.color.attributeExpression.globalChange,translation:"Common.Expression",show:l.color.attributeExpression.show},expressionIsColor:{ref:"color.expressionIsColor",translation:"properties.expressionIsColor",type:"boolean",defaultValue:!0,show:l.color.expressionIsColor.show},expressionLabel:{type:"string",ref:"color.expressionLabel",translation:"Common.Label",change:l.color.expressionLabel.change,show:l.color.expressionLabel.show},colorSchemeMeasure:{ref:"color.measureScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:e.colorSchemes.defaultScales.ordinal,items:l.helpers.getMeasureSchemeOptions(),show:l.color.colorSchemeMeasure.show},reverseScheme:{ref:"color.reverseScheme",translation:"properties.reverseColorScheme",type:"boolean",defaultValue:!1,show:l.color.reverseScheme.show},colorSchemeDimension:{ref:"color.dimensionScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:e.colorSchemes.defaultScales.qualitative,items:l.helpers.getDimensionSchemeOptions(),show:l.color.colorSchemeDimension.show},customRange:{type:"items",items:{autoMinMax:{ref:"color.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:l.color.customRange.autoMinMax.show},min:{ref:"color.measureMin",translation:"properties.axis.min",expression:"optional",type:"number",show:l.color.customRange.min.show,invalid:l.color.customRange.min.invalid},max:{ref:"color.measureMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:l.color.customRange.max.show,invalid:l.color.customRange.max.invalid}},show:l.color.customRange.show}}},legend:{type:"items",items:{show:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:l.legend.show},dock:{type:"string",component:"dropdown",ref:"legend.dock",translation:"properties.legend.position",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"bottom",translation:"Common.Bottom"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"Common.Top"}],defaultValue:"auto",show:l.legend.dock.show},showTitle:{ref:"legend.showTitle",translation:"properties.legend.showTitle",type:"boolean",defaultValue:!0,show:l.legend.showTitle.show}}}}},k.data={type:"items",component:"hypercube-data",translation:"Common.Data",addTranslation:"Properties.AddData",allowAdd:!0,items:{dimensions:k.dimensions,measures:k.measures}},k}),define("client.utils/property-mapper",["client.property-panel/default-properties","client.utils/property-resolver","util"],function(a,b,c){function d(a,c,e){var f,g,h,i=null;if(a.ref===c)return a;if(b.isHierarchical(a))for(f=Object.keys(a.items),h=0;h<f.length;++h){if(g=a.items[f[h]],g.ref===c){i=g;break}if(e&&(i=d(g,c,e),null!==i))break}return i}function e(d,f,g){var h,i,l;if(g=g||a,d||(d=j),f&&k[f])return k[f];if(d.uses){if(l=g[d.uses],!l)throw"No defaults found for: "+d.uses;d=c.extend(!0,{},l,d)}return b.isHierarchical(d)?(i={},Object.keys(d.items).forEach(function(a){d.items[a]&&(i[a]=e(d.items[a],null,g))}),h=c.extend({},d,{items:i})):"array"===d.type&&d.items?(i={},Object.keys(d.items).forEach(function(a){d.items[a]&&(i[a]=e(d.items[a],null,g))}),h=c.extend({},d,{items:i})):h=c.extend({},d),f&&!k[f]&&(k[f]=h),h}function f(a,d,f){var g=e(a,f);return d?c.extend(!0,b.getDefaults(g),d):b.getDefaults(g)}function g(a){function c(a){function d(a){return a.search(/\.\d/g)!==-1}function e(a){var c={type:a.type,defaultValue:b.getDefaultValue(a.type,a)};return a.maxlength&&(c.maxlength=a.maxlength),a.min&&(c.min=a.min),a.max&&(c.max=a.max),a.expression&&(c.expression=a.expression),a.options&&"boolean"!==a.type&&(c.enum=a.options.map(function(a){return a.value})),c}function f(a){var h,i,j,k,l,m;if(b.isHierarchical(a))for(h=Object.keys(a.items),l=0;l<h.length;l++)i=h[l],j=a.items[i],f(j);else a.ref&&"array"===a.type&&a.items?(k=c({type:"items",items:a.items}),m={type:"array",items:k},d(a.ref)||b.setValue(g,a.ref,m)):a.ref&&(m=e(a),d(a.ref)||b.setValue(g,a.ref,m))}var g={};return f(a),g}return c(a)}function h(a){function c(a){var e,f,g;if(b.isHierarchical(a))for(e=Object.keys(a.items),g=0;g<e.length;++g)f=a.items[e[g]],f.snapshot&&d.push(f),c(f)}var d=[];return c(a),d}function i(a,b){function c(a){a.globalChange&&d.push(a.globalChange),"items"!==a.type&&"array"!==a.type||!a.items||Object.keys(a.items).forEach(function(b){a.items[b]&&c(a.items[b])})}if(b&&l[b])return l[b];var d=[];return c(a),b&&!l[b]&&(l[b]=d),d}var j,k={},l={};return j={type:"items",component:"accordion",items:{settings:{uses:"settings"}}},{findDefinition:d,findSnapshotProperties:h,findGlobalListeners:i,mapDefinition:e,mapProperties:f,getPropertyHierarchy:g}}),define("objects.backend-api/generic-api",["./backend-api"],function(a){"use strict";function b(a,b){if(b){if(a[b]){if(a[b].qHyperCube)return b+".qHyperCube";if(a[b].qListObject)return b+".qListObject"}return b.indexOf("Def",b.length-3)!==-1?b.slice(0,b.length-3):b}return a.qHyperCube?"qHyperCube":"qListObject"}var c;return c=a.extend("GenericApi",{init:function(a,c){var d=b(a.layout,c);this._super(a,"/"+d+"Def"),this.isHyperCube=this.dataPath.indexOf("qHyperCube")!==-1,this.cacheCube.setMethodName(this.isHyperCube?"GetHyperCubeData":"GetListObjectData")},getBackendApi:function(a){return new c(this.model,a)},getProperties:function(){return this.model.getProperties()},setProperties:function(a){return this.model.setProperties(a)},applyPatches:function(a,b){return this.model.applyPatches(a,b)},clearSoftPatches:function(){return this.model.clearSoftPatches()},save:function(){return this.model.save()},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){
return this.model.layout.qSelectionInfo.qMadeSelections},updateCache:function(a){a&&a[this.dataPath]?(this.cacheCube.set(a[this.dataPath].qDataPages),this.cacheCube.setCubeSize(a[this.dataPath].qSize)):this.cacheCube.clear()},getData:function(a){var b=this.cacheCube.getData(a),c=this;return b.then(function(a){c.model.layout[c.dataPath].qDataPages.push(a[0])}),b},getDataRow:function(a){var b=this.model.layout[this.dataPath];if(b)for(var c=b.qDataPages.length,d=0;d<c;d++){var e=b.qDataPages[d];if(a>=e.qArea.qTop&&a<e.qArea.qTop+e.qArea.qHeight)return e.qMatrix[a-e.qArea.qTop]}return null},selectValues:function(a,b,c){return this.isHyperCube?this.model.rpc("SelectHyperCubeValues",null,[this.path,a,b,c]):this.model.rpc("SelectListObjectValues",null,[this.path,b,c])},select:function(a,b,c){return this.selectValues(b,a,c)},getReducedData:function(a,b,c){return this.isHyperCube?this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c||"D1"]):null},selectRange:function(a,b,c){return b=!!b,c=c||[],this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,a,c,b])},search:function(a){return this.isHyperCube?null:this.model.rpc("SearchListObjectFor",null,[this.path,a])},abortSearch:function(){return this.isHyperCube?null:this.model.rpc("AbortListObjectSearch",null,[this.path])},acceptSearch:function(a){return this.isHyperCube?null:this.model.rpc("AcceptListObjectSearch",null,[this.path,a])},getPivotData:function(a){return this.isHyperCube?this.model.rpc("GetHyperCubePivotData","qDataPages",[this.path,a]):null},getStackData:function(a,b){return this.isHyperCube?this.model.rpc("GetHyperCubeStackData","qDataPages",[this.path,a,b||1e3]):null},expandTop:function(a,b,c){return this.model.rpc("ExpandTop",null,[this.path,a,b,c||!1])},expandLeft:function(a,b,c){return this.model.rpc("ExpandLeft",null,[this.path,a,b,c||!1])},collapseTop:function(a,b,c){return this.model.rpc("CollapseTop",null,[this.path,a,b,c])},collapseLeft:function(a,b,c){return this.model.rpc("CollapseLeft",null,[this.path,a,b,c])}})}),define("objects.utils/data-properties/data-property-handler",["core.utils/class","util","core.utils/deferred","general.utils/attribute-expression-util","client.utils/property-resolver","client.utils/default-property-logic"],function(a,b,c,d,e,f){"use strict";function g(a,b,c){if(a[c]){var e=d.getIndexById(a[c],b);e>=0&&a[c].splice(e,1)}else a[c]=[]}var h,i;return i="Not supported in this object, need to implement in subclass.",h=a.extend({init:function(a){a=a||{},this.dimensionDefinition=a.dimensionDefinition||{max:0},this.measureDefinition=a.measureDefinition||{max:0},a.dimensionDefinition&&(this.dimensionProperties=a.dimensionProperties||{}),a.measureDefinition&&(this.measureProperties=a.measureProperties||{}),a.globalChangeListeners&&(this.globalChangeListeners=a.globalChangeListeners),this.app=a.app},setProperties:function(a){this.properties=a},setGlobalChangeListeners:function(a){this.globalChangeListeners=a},setLayout:function(a){this.layout=a},type:function(){throw"Must override this method"},getDimensions:function(){return[]},getDimension:function(a){var b=this.getDimensions(),c=0;for(c;c<b.length;++c)if(b[c].qDef.cId===a)return b[c];return null},minDimensions:function(){return"function"==typeof this.dimensionDefinition.min?this.dimensionDefinition.min.call(null,this.properties,this):this.dimensionDefinition.min||0},maxDimensions:function(){return"function"==typeof this.dimensionDefinition.max?this.dimensionDefinition.max.call(null,this.getMeasures().length):isNaN(this.dimensionDefinition.max)?1e4:this.dimensionDefinition.max},canAddDimension:function(){return this.getDimensions().length<this.maxDimensions()},minMeasures:function(){return"function"==typeof this.measureDefinition.min?this.measureDefinition.min.call(null,this.properties,this):this.measureDefinition.min||0},maxMeasures:function(){return"function"==typeof this.measureDefinition.max?this.measureDefinition.max.call(null,this.getDimensions().length):isNaN(this.measureDefinition.max)?1e4:this.measureDefinition.max},canAddMeasure:function(){return this.getMeasures().length<this.maxMeasures()},canColorBy:function(a){var b=a?a:{qHyperCubeDef:this.hcProperties||this.properties.qHyperCubeDef},c=this.layout?this.layout.visualization:null,d=b.qHyperCubeDef.qDimensions.length>=this.minDimensions()&&b.qHyperCubeDef.qMeasures.length>=this.minMeasures();return d&&this.layout&&this.layout.color?h.canColorBy(b,c):{}},getMeasures:function(){return[]},getMeasure:function(a){var b=this.getMeasures(),c=0;for(c;c<b.length;++c)if(b[c].qDef.cId===a)return b[c];return null},addDimension:function(){throw i},getSorting:function(){throw i},addFieldDimension:function(a,b,c){var d=this.createFieldDimension(a,b,c);return this.addDimension(d)},addLibraryDimension:function(a,b){var c=this.createLibraryDimension(a,b);return this.addDimension(c)},addMeasure:function(){throw i},addExpressionMeasure:function(a,b,c){var d=this.createExpressionMeasure(a,b,c);return this.addMeasure(d)},addLibraryMeasure:function(a,b){var c=this.createLibraryMeasure(a,b);return this.addMeasure(c)},addAlternativeFieldDimension:function(a,b,c){var d=this.createFieldDimension(a,b,c);return this.addDimension(d,!0)},addAlternativeLibraryDimension:function(a,b){var c=this.createLibraryDimension(a,b);return this.addDimension(c,!0)},addAlternativeExpressionMeasure:function(a,b,c){var d=this.createExpressionMeasure(a,b,c);return this.addMeasure(d,!0)},addAlternativeLibraryMeasure:function(a,b){var c=this.createLibraryMeasure(a,b);return this.addMeasure(c,!0)},replaceDimension:function(){throw i},replaceMeasure:function(){throw i},autoSortDimension:function(){throw i},autoSortMeasure:function(){throw i},createFieldDimension:function(a,c,d){var e=b.extend(!0,{},this.dimensionProperties||{},d||{});return e.qDef||(e.qDef={}),e.qOtherTotalSpec||(e.qOtherTotalSpec={}),a?(e.qDef.qFieldDefs=[a],c?e.qDef.qFieldLabels=[c]:e.qDef.qFieldLabels=[""],e.qDef.qSortCriterias=[{qSortByLoadOrder:1}]):(e.qDef.qFieldDefs=[],e.qDef.qFieldLabels=[],e.qDef.qSortCriterias=[]),e.qDef.autoSort=!0,e},createLibraryDimension:function(a,c){var d=b.extend(!0,{},this.dimensionProperties||{},c||{});return d.qDef||(d.qDef={}),d.qOtherTotalSpec||(d.qOtherTotalSpec={}),d.qLibraryId=a,d.qDef.qSortCriterias=[{qSortByLoadOrder:1}],d.qDef.autoSort=!0,delete d.qDef.qFieldDefs,delete d.qDef.qFieldLabels,d},createExpressionMeasure:function(a,c,d){var e=b.extend(!0,{},this.measureProperties||{},d||{});return e.qDef||(e.qDef={}),e.qDef.qNumFormat||(e.qDef.qNumFormat={}),e.qDef.qDef=a,e.qDef.qLabel=c,e.qDef.autoSort=!0,e},createLibraryMeasure:function(a,c){var d=b.extend(!0,{},this.measureProperties||{},c||{});return d.qDef||(d.qDef={}),d.qDef.qNumFormat||(d.qDef.qNumFormat={}),d.qLibraryId=a,d.qDef.autoSort=!0,delete d.qDef.qDef,delete d.qDef.qLabel,d},getDimensionLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qDimensionInfo:[]},getDimensionLayout:function(a){return this.getDimensionLayouts().filter(function(b){return a===b.cId})[0]},getMeasureLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qMeasureInfo:[]},getMeasureLayout:function(a){return this.getMeasureLayouts().filter(function(b){return a===b.cId})[0]},updateGlobalChangeListeners:function(){this.globalChangeListeners&&(this.globalChangeListeners||[]).forEach(function(a){a&&"function"==typeof a&&a(this.properties,this)}.bind(this))},removeDimension:function(){throw i},removeMeasure:function(){throw i},moveDimension:function(){throw i},moveMeasure:function(){throw i},changeSorting:function(){throw i},setColorByDef:function(a,b){function c(a){return a.split(" ").length>1?"["+a+"]":a}var d=b?"expression":a.type;switch(d){case"field":this.properties.color.mode="byDimension",this.properties.color.byDimDef={label:c(a.name),key:c(a.name),type:"expression"};break;case"expression":this.properties.color.mode="byMeasure",this.properties.color.byMeasureDef={label:b||a.name,key:b||a.name,type:"expression"};break;case"dimension":this.properties.color.mode="byDimension",this.properties.color.byDimDef={label:a.name,key:a.id,type:"libraryItem"};break;case"measure":this.properties.color.mode="byMeasure",this.properties.color.byMeasureDef={label:a.name,key:a.id,type:"libraryItem"}}this.properties.color.auto=!1,this.properties.color.altLabel=a.name},setColorByItem:function(a,b,d,e){return h.setColorByItem(a,b,d,e,this.properties),c.resolve()},clearColorByItem:function(a,b){h.clearColorByItem(a,b)}}),h.clearColorByItem=function(a,b){a.forEach(function(a){g(a,d.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeDimensions"),g(a,d.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeExpressions")}),b.forEach(function(a){g(a,d.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeDimensions"),g(a,d.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeExpressions")})},h.setColorByItem=function(a,b,c,f,g){h.clearColorByItem(b,c);var i=b[b.length-1];if(i){var j=a?e.getValue(g,"color.byDimDef"):e.getValue(g,"color.byMeasureDef"),k={id:d.IDMAP.COLOR_BY_ALTERNATIVE};if(j)switch(j.type){case"expression":k.label=f||j.label,a?k.qDef=j.key:k.qExpression=j.key;break;case"libraryItem":k.qLibraryId=j.key}a?(k.qSortBy={qSortByAscii:1},i.qAttributeDimensions.push(k)):i.qAttributeExpressions.push(k)}},h.canColorBy=function(a,b){var c={};if(a){var d=f.getLogicFor("hard",b).helpers.colorModeOptions;c.byDimension=d.dimension(a),c.byMeasure=d.measure(a),c.byMultiple=d.multiColor(a),c.byExpression=d.expression(a)}return c},h}),define("general.utils/array-util",[],function(){function a(a){return a&&"[object Array]"===Object.prototype.toString.call(a)}function b(a){return a&&"function"==typeof a}function c(c,d){var e,f;if(!a(c))throw"No valid items were specified.";if(!b(d))throw"No valid action function was specified.";if(Array.prototype.forEach)c.forEach(d);else for(e in c)f=c[e],d(f)}function d(b,c){if(!a(b))throw"No valid items were specified.";if(Array.prototype.indexOf)return b.indexOf(c)!==-1;for(var d=b.length;d--;)if(b[d]===c)return!0;return!1}function e(a,b){if(!(a&&b&&a.length&&b.length))return!1;var c,d=b.length;for(c=0;c<d;c++)if(a.indexOf(b[c])>-1)return!0;return!1}function f(a,b){if(!(a&&b&&a.length&&b.length))return!1;var c=a.indexOf(b[0]);if(c!==-1){for(var d=0;d<b.length;d++){var e=a.indexOf(b[d]);if(c>e)return!1;c=e}return!0}return!1}function g(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0])}function h(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function i(a,b){var c;for(c=0;c<a.length;++c)a[c]>=0&&a[c]>=b&&++a[c];a.push(b)}function j(a,b,c){var d;for(d=0;d<a.length;++d)a[d]>=0&&a[d]>=b&&++a[d];a.splice(c,0,b)}function k(a,b){var c,d=0;for(c=0;c<a.length;++c)a[c]>b?--a[c]:a[c]===b&&(d=c);return a.splice(d,1),d}function l(a,b){return a.length>b?a.slice(0,b):a}function m(a){if(!(a instanceof Array))throw new Error("Argument is not an Array.");return a.slice(0)}return{forEach:c,contains:d,move:g,swap:h,limit:l,indexAdded:i,indexAddedAt:j,indexRemoved:k,intersects:e,isOrderedSubset:f,copy:m}}),define("objects.utils/data-properties/listobject-util",["util"],function(a){"use strict";return{autoSortDimension:function(a,b){return a.qDef.qSortCriterias=[],a.qDef.autoSort=!0,b?b.forEach(function(b,c){a.qDef.qSortCriterias[c]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1}}):a.qDef.qSortCriterias[0]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1},a},createFieldDimension:function(a){return{qDef:{qFieldDefs:[a],qFieldLabels:[a],qSortCriterias:[]}}},createLibraryDimension:function(a){return{qLibraryId:a,qDef:{qSortCriterias:[]}}},createDefaultListBox:function(b,c){var d,e=a.extend(!0,{},b);for(e.qShowAlternatives=!0,d=0;d<e.qDef.qSortCriterias.length;++d)e.qDef.qSortCriterias[d].qSortByState=1;return c=c||(b.qDef.qFieldLabels&&b.qDef.qFieldLabels.length?b.qDef.qFieldLabels[0]:""),{qInfo:{qType:"listbox"},qListObjectDef:e,title:c,visualization:"listbox"}}}}),define("client.assets/tab-contents/fields/assets-directdiscovery-service",[],function(){"use strict";function a(a){return!!a.qTags&&a.qTags.indexOf("$dd_measure")!==-1}function b(a){return!!a.qTags&&a.qTags.indexOf("$dd_details")!==-1}function c(a){return!!a.qTags&&a.qTags.indexOf("$dd_dimension")!==-1}function d(a){return!!a.qTags&&a.qTags.indexOf("$directdiscovery")!==-1}function e(c){var d=c;return c&&(d=c.filter(function(c){return!a(c)&&!b(c)})),d}function f(d){var e="",f={qTags:d};return a(f)?e="DirectDiscovery.Measure":b(f)?e="DirectDiscovery.Details":c(f)&&(e="DirectDiscovery.Dimension"),e}return{isMeasure:a,isDetails:b,isDimension:c,removeMeasureAndDetailsFields:e,getTypeTranslationKey:f,isDirectDiscoveryField:d}}),define("client.assets/tab-contents/fields/derived-field-formatter-service",[],function(){function a(a){var c=a?a.split(b).join(""):"";return c}var b=".autoCalendar";return{trimAutoCalendarName:a}}),define("client.assets/tab-contents/fields/assets-field-list-model",["objects.utils/data-properties/listobject-util","client.assets/tab-contents/fields/assets-directdiscovery-service","client.assets/tab-contents/fields/derived-field-formatter-service"],function(a,b,c){"use strict";function d(b){var d;return d=a.createFieldDimension(b.qName),a.autoSortDimension(d,[b]),{id:"newObject",args:{template:"filterpane",children:[a.createDefaultListBox(d,c.trimAutoCalendarName(b.qName))],init:{}}}}function e(a){for(var b=[],d=0;d<a.length;++d){var e=a[d];if(e.isDateField=g(e),e.isGeoField=h(e),b.push(e),e.qDerivedFieldData)for(var f=0;f<e.qDerivedFieldData.qDerivedFieldLists.length;++f)for(var i=e.qDerivedFieldData.qDerivedFieldLists[f],j=0;j<i.qFieldDefs.length;++j){var k=i.qFieldDefs[j];b.push({qName:k.qName,displayName:c.trimAutoCalendarName(k.qName),qSrcTables:e.qSrcTables,qTags:k.qTags,isDerived:!0,isDerivedFromDate:e.isDateField,sourceField:e.qName,derivedDefinitionName:i.qDerivedDefinitionName})}}return b}function f(a,b,e){var f=[];if(b)for(var g=0;g<b.qDerivedFieldLists.length;++g)for(var h=b.qDerivedFieldLists[g],i=0;i<h.qFieldDefs.length;++i){var j=h.qFieldDefs[i];f.push({id:j.qName,qName:j.qMethod,name:j.qName,displayName:c.trimAutoCalendarName(j.qName),qSrcTables:a.qSrcTables,srcTables:a.qSrcTables,qTags:j.qTags,tags:j.qTags,type:"field",isDerived:!0,isDerivedFromDate:e,getDropOption:d.bind(null,j),sourceField:a.qName,derivedDefinitionName:h.qDerivedDefinitionName})}return f}function g(a){return!!a.qDerivedFieldData&&(a.qTags.indexOf("$date")>-1||a.qTags.indexOf("$timestamp")>-1)}function h(a){return a.qTags.indexOf("$geoname")>-1}var i={create:function(a){var c=a.map(function(a){var c=g(a),e=h(a);return{id:a.qName,name:a.qName,type:"field",isDateField:c,isGeoField:e,srcTables:a.qSrcTables,sourceField:a.sourceField,calendarTemplateName:a.derivedDefinitionName,getDropOption:d.bind(null,a),tags:a.qTags,icon:b.isDirectDiscoveryField(a)?"directdiscovery":"",iconTooltip:b.getTypeTranslationKey(a.qTags),derivedFields:a.qDerivedFieldData?f(a,a.qDerivedFieldData,c):[]}});return c},expand:e,createFromArray:function(a,b){var c,e=[];for(c=0;c<a.length;c++)b&&(a[c].qName=a[c][b]),e.push({name:a[c].qName,type:"field",getDropOption:d.bind(null,a[c])});return e},getTables:function(a){var b,c,d,e=a;for(d=[],b=0;b<e.length;++b)for(c=0;c<e[b].qSrcTables.length;++c)d.indexOf(e[b].qSrcTables[c])===-1&&d.push(e[b].qSrcTables[c]);return d}};return i}),define("objects.utils/data-properties/library-utils",["general.utils/array-util","client.assets/tab-contents/fields/assets-field-list-model"],function(a,b){"use strict";function c(c,d){var e,f,g=b.expand(a.copy(d));if(g)for(e=0;e<g.length;e++)if(f=g[e],f.qName===c)return f;return null}function d(a,b){var c,d;if(b)for(c=0;c<b.length;c++)if(d=b[c],d.qInfo.qId===a)return d;return null}function e(a,b){var c,d;if(b)for(c=0;c<b.length;c++)if(d=b[c],d.qInfo.qId===a)return d;return null}function f(c){return c.getFieldList().then(function(c){return b.expand(a.copy(c)).sort(function(a,b){return a.qName.toLowerCase().localeCompare(b.qName.toLowerCase())})})}function g(b){return b.getDimensionList().then(function(b){return a.copy(b).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}function h(b){return b.getMeasureList().then(function(b){return a.copy(b).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}return{findField:c,findLibraryDimension:e,findLibraryMeasure:d,getSortedFields:f,getSortedDimensions:g,getSortedMeasures:h}}),define("objects.utils/data-properties/hypercube-handler",["./data-property-handler","core.utils/deferred","objects.utils/data-properties/library-utils","general.utils/array-util","util"],function(a,b,c,d,e){"use strict";function f(a){return k.test(a)}var g,h=1e3,i=1e3,j=["$numeric","$year","$quarter","$yearquarter","$month","$yearmonth","$weeknumber","$date","$timestamp"],k=new RegExp(j.join("|").replace(/\$/g,"\\$"));return g=a.extend({init:function(a){this._super(a)},setProperties:function(a){a.qHyperCubeDef&&(this._super(a),this.hcProperties=a.qHyperCubeDef,this.hcProperties.qDimensions||(this.hcProperties.qDimensions=[]),this.hcProperties.qMeasures||(this.hcProperties.qMeasures=[]),this.hcProperties.qInterColumnSortOrder||(this.hcProperties.qInterColumnSortOrder=[]),this.hcProperties.qLayoutExclude||(this.hcProperties.qLayoutExclude={}),this.hcProperties.qLayoutExclude.qHyperCubeDef||(this.hcProperties.qLayoutExclude.qHyperCubeDef={}),this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions=[]),this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures=[]),this.hcProperties.qDimensions.forEach(function(a){void 0!==a.autoSort&&(a.qDef.autoSort=a.autoSort,delete a.autoSort)}),this.hcProperties.qMeasures.forEach(function(a){void 0!==a.autoSort&&(a.qDef.autoSort=a.autoSort,delete a.autoSort)}))},getDimensions:function(){return this.hcProperties?this.hcProperties.qDimensions:[]},getMeasures:function(){return this.hcProperties?this.hcProperties.qMeasures:[]},getSorting:function(){return this.hcProperties.qInterColumnSortOrder},addDimension:function(a,c,f){var g=this.getDimensions(),i=this;return a.qDef.cId||(a.qDef.cId=e.generateId()),c?(f=void 0!==f?f:this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(f,0,a),b.resolve(a)):g.length<this.maxDimensions()?(f=void 0!==f?f:g.length,g.splice(f,0,a),this.autoSortDimension(a).then(function(){return d.indexAdded(i.hcProperties.qInterColumnSortOrder,"undefined"!=typeof f?f:g.length-1),"function"==typeof i.dimensionDefinition.add?b.when(i.dimensionDefinition.add.call(i,a,i.properties,i)).then(function(){return a}):a})):g.length<h?(f=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(f,0,a),b.resolve(a)):void 0},reinsertDimension:function(a,c,f){var g=this.getDimensions(),i=this;if(a.qDef.cId||(a.qDef.cId=e.generateId()),c){if(f=void 0!==f?f:this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(f,0,a),"function"==typeof i.dimensionDefinition.move)return b.when(i.dimensionDefinition.move.call(i,a,i.properties,i)).then(function(){return a})}else if(g.length<this.maxDimensions()){if(f=void 0!==f?f:g.length,g.splice(f,0,a),d.indexAdded(i.hcProperties.qInterColumnSortOrder,"undefined"!=typeof f?f:g.length-1),"function"==typeof i.dimensionDefinition.move)return b.when(i.dimensionDefinition.move.call(i,a,i.properties,i)).then(function(){return a})}else g.length<h&&(f=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(f,0,a));return b.resolve(a)},addMeasure:function(a,c,f){var g=this.getMeasures(),h=this;return a.qDef.cId||(a.qDef.cId=e.generateId()),c?(f=void 0!==f?f:this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(f,0,a),b.resolve(a)):(f=void 0!==f?f:g.length,g.length<this.maxMeasures()?(g.splice(f,0,a),this.autoSortMeasure(a).then(function(){return d.indexAdded(h.hcProperties.qInterColumnSortOrder,h.getDimensions().length+g.length-1),"function"==typeof h.measureDefinition.add?b.when(h.measureDefinition.add.call(null,a,h.properties,h)).then(function(){return a}):a})):g.length<i?(f=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(f,0,a),b.resolve(a)):void 0)},reinsertMeasure:function(a,c,f){var g=this.getMeasures(),h=this;if(a.qDef.cId||(a.qDef.cId=e.generateId()),c)f=void 0!==f?f:this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(f,0,a);else if(f=void 0!==f?f:g.length,g.length<this.maxMeasures()){if(g.splice(f,0,a),d.indexAdded(h.hcProperties.qInterColumnSortOrder,h.getDimensions().length+g.length-1),"function"==typeof h.measureDefinition.move)return b.when(h.measureDefinition.move.call(null,a,h.properties,h,!0)).then(function(){return a})}else g.length<i&&(f=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(f,0,a));return b.resolve(a)},replaceDimension:function(a,b){var c=this.getDimensions(),d=c[a],f=this;return this.autoSortDimension(b).then(function(){return b.qDef.cId=e.generateId(),c[a]=b,"function"==typeof f.dimensionDefinition.replace&&f.dimensionDefinition.replace.call(null,b,d,a,f.properties,f),b})},replaceMeasure:function(a,b){var c=this.getMeasures(),d=c[a],f=this;return this.autoSortMeasure(b).then(function(){return b.qDef.cId=e.generateId(),c[a]=b,"function"==typeof f.measureDefinition.replace&&f.measureDefinition.replace.call(null,b,d,a,f.properties,f),b})},autoSortDimension:function(a){function b(b){b.forEach(function(b,c){var e=b.qTags,g={qSortByLoadOrder:1};"function"==typeof d.dimensionDefinition.autoSort?d.dimensionDefinition.autoSort(a,d.properties,e,g,d):e&&(f(e)?g.qSortByNumeric=1:(e.contains("$text")||e.contains("$ascii"))&&(g.qSortByAscii=1)),a.qDef.qSortCriterias[c]=g})}var d=this;return a.qLibraryId?this.app.getDimensionList().then(function(d){var e=c.findLibraryDimension(a.qLibraryId,d);return e&&b(e.qData.info),a}):this.app.getFieldList().then(function(d){var e=c.findField(a.qDef.qFieldDefs[0],d);return e&&b([e]),a})},autoSortMeasure:function(a){return a.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.resolve(a)},removeDimension:function(a,c){var e;if(c){if(e=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(a,1),"function"==typeof this.dimensionDefinition.remove)return b.when(this.dimensionDefinition.remove.call(null,e,this.properties,this,a))}else if(e=this.hcProperties.qDimensions.splice(a,1)[0],d.indexRemoved(this.hcProperties.qInterColumnSortOrder,a),"function"==typeof this.dimensionDefinition.remove)return b.when(this.dimensionDefinition.remove.call(null,e,this.properties,this,a));return b.resolve(e)},removeMeasure:function(a,c){var e;if(c)e=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(a,1)[0];else if(e=this.hcProperties.qMeasures.splice(a,1)[0],d.indexRemoved(this.hcProperties.qInterColumnSortOrder,this.getDimensions().length+a),"function"==typeof this.measureDefinition.remove)return b.when(this.measureDefinition.remove.call(null,e,this.properties,this,a));return b.resolve(e)},moveDimension:function(a,c){var e,f,g,h=this.getDimensions(),i=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;return a<h.length&&c<h.length?d.move(h,a,c):a<h.length&&c>=h.length?(f=c-h.length,g=i.splice(0,1)[0],h.push(g),g=h.splice(a,1)[0],i.splice(f,0,g)):a>=h.length&&c<h.length?(e=a-h.length,g=h.splice(h.length-1,1)[0],i.splice(0,0,g),g=i.splice(e+1,1)[0],h.splice(c,0,g)):(e=a-h.length,f=c-h.length,d.move(i,e,f)),b.resolve(g)},moveMeasure:function(a,c){var e,f,g,h=this.getMeasures(),i=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;return a<h.length&&c<h.length?d.move(h,a,c):a<h.length&&c>=h.length?(f=c-h.length,g=i.splice(0,1)[0],h.push(g),g=h.splice(a,1)[0],i.splice(f,0,g)):a>=h.length&&c<h.length?(e=a-h.length,g=h.splice(h.length-1,1)[0],i.splice(0,0,g),g=i.splice(e+1,1)[0],h.splice(c,0,g)):(e=a-h.length,f=c-h.length,d.move(i,e,f)),b.resolve(g)},changeSorting:function(a,b){d.move(this.hcProperties.qInterColumnSortOrder,a,b)},setSorting:function(a){a&&a.length===this.hcProperties.qInterColumnSortOrder.length&&(this.hcProperties.qInterColumnSortOrder=a)}})}),define("objects.utils/data-properties/listobject-handler",["core.utils/deferred","./data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util"],function(a,b,c,d,e){"use strict";var f=b.extend({init:function(a){this._super(a)},minDimensions:function(){return 1},maxDimensions:function(){return 1},minMeasures:function(){return 0},maxMeasures:function(){return 0},autoSortDimension:function(a){return c.autoSortDimension(a)},getDimensions:function(){var a=this.properties.qListObjectDef.qDef;return a&&a.qFieldDefs&&a.qFieldDefs.length||this.properties.qListObjectDef.qLibraryId?[this.properties.qListObjectDef]:[]},addDimension:function(a){function b(){f.properties.qListObjectDef=e.extend(!0,f.properties.qListObjectDef,a),"function"==typeof f.dimensionDefinition.add&&f.dimensionDefinition.add.call(null,a,f.properties,f)}var f=this;return a.qLibraryId?this.app.getDimensionList().then(function(e){var f=d.findLibraryDimension(a.qLibraryId,e);return f&&c.autoSortDimension(a,f.qData.info),b(),a}):this.app.getFieldList().then(function(e){var f=d.findField(a.qDef.qFieldDefs[0],e);return f&&c.autoSortDimension(a,[f]),b(),a})},replaceDimension:function(b,d){var f=this,g=e.extend(!0,this.properties.qListObjectDef,d);return c.autoSortDimension(d),d.qLibraryId?(delete g.qDef.qFieldDefs,delete g.qDef.qFieldLabels):delete g.qLibraryId,f.properties.qListObjectDef=g,a.resolve(d)},removeDimension:function(){},getDimensionLayouts:function(){return[this.getDimensionLayout()]},getDimensionLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qDimensionInfo?this.layout.qListObject.qDimensionInfo:""},getMeasures:function(){return this.properties.qListObjectDef.qExpressions},getMeasureLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qExpressions&&this.layout.qListObject.qExpressions[0]?this.layout.qListObject.qExpressions[0].qExpr:""}});return f}),define("text!objects.extension/default-template.ng.html",[],function(){return'<div style="height: 100%; position: relative;"></div>\n'}),define("objects.extension/export-format",[],function(){"use strict";function a(a){a=void 0!==a?a:1,this.data=[];for(var b=0;b<a;++b)this.data.push({dimensions:[],measures:[],excludedDimensions:[],excludedMeasures:[],interColumnSortOrder:[]});this.properties={}}return a}),define("objects.extension/object-conversion",["util","objects.extension/export-format","general.utils/array-util","client.utils/property-resolver","client.utils/property-mapper","translator","objects.utils/data-properties/data-property-handler","general.utils/attribute-expression-util"],function(a,b,c,d,e,f,g,h){function i(a,b,c){b.hasOwnProperty(a)&&(c[a]=b[a])}function j(a,b,c,d){b.hasOwnProperty(a)?c[a]=b[a]:c[a]=d}function k(b){var c=a.extend(!0,{},b);return d.getValue(c,"qOtherTotalSpec.qOtherCounted")||d.setValue(c,"qOtherTotalSpec.qOtherCounted",{qv:"10"}),d.getValue(c,"qOtherTotalSpec.qOtherLimit")||d.setValue(c,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),c.hasOwnProperty("othersLabel")||(c.othersLabel=f.get("properties.dimensionLimits.others")),c}function l(a,b,c){"masterobject"===b.properties.qInfo.qType?a.qInfo.qType="masterobject":a.qInfo.qType=c.qInfo.qType,a.visualization=c.visualization}function m(a,b,c){var e=c.qProperty,f=c.qProperty.qLayoutExclude;return/boolean|number|string/.test(typeof b)?(f&&(f.changed||(f.changed={}),f.changed[a]={from:d.getValue(e,a),to:b}),void d.setValue(e,a,b)):void d.setValue(e,a,b)}function n(a){for(var b in a.qLayoutExclude.changed)a.qLayoutExclude.changed[b].to===d.getValue(a,b)&&d.setValue(a,b,a.qLayoutExclude.changed[b].from)}function o(a,b,c){var e,f,g=b.properties,h=b.properties.qLayoutExclude,i=d.getValue(g,a);if(!/boolean|number|string/.test(typeof i))try{if(e=JSON.stringify(i),f=e.match(/:\{/g),f=f?f.length:0,f>2)return;i=JSON.parse(e)}catch(j){return}h||(b.properties.qLayoutExclude={quarantine:{}},h=b.properties.qLayoutExclude),h.quarantine||(h.quarantine={}),h.quarantine[c]||(h.quarantine[c]={}),h.quarantine[c][a]=i}function p(a,b){var c,e=a.qLayoutExclude?a.qLayoutExclude.quarantine:{};if(!e[b])return!1;e=e[b];for(c in e)d.setValue(a,c,e[c]);return delete a.qLayoutExclude.quarantine[b],!0}var q,r,s,t,u,v,w=Math.pow(2,53)-1;return q={exportProperties:function(d){var e,f,g,h=new b,i=d.qProperty,j=i.qHyperCubeDef,k=h.data[0];for(e=0;e<j.qDimensions.length;++e)k.dimensions.push(j.qDimensions[e]);if(j.qLayoutExclude&&j.qLayoutExclude.qHyperCubeDef&&j.qLayoutExclude.qHyperCubeDef.qDimensions)for(e=0;e<j.qLayoutExclude.qHyperCubeDef.qDimensions.length;++e)k.excludedDimensions.push(j.qLayoutExclude.qHyperCubeDef.qDimensions[e]);for(e=0;e<j.qMeasures.length;++e)k.measures.push(j.qMeasures[e]);if(j.qLayoutExclude&&j.qLayoutExclude.qHyperCubeDef&&j.qLayoutExclude.qHyperCubeDef.qMeasures)for(e=0;e<j.qLayoutExclude.qHyperCubeDef.qMeasures.length;++e)k.excludedMeasures.push(j.qLayoutExclude.qHyperCubeDef.qMeasures[e]);if(k.interColumnSortOrder=j.qInterColumnSortOrder.concat(),j.qLayoutExclude&&j.qLayoutExclude.qHyperCubeDef&&j.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder){var l=j.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.concat();c.isOrderedSubset(l,k.interColumnSortOrder)&&(k.interColumnSortOrder=l)}delete j.qLayoutExclude;for(f in i)h.properties[f]=i[f];if(i.qLayoutExclude||(i.qLayoutExclude={}),i.qLayoutExclude.disabled){for(f in i.qLayoutExclude.disabled)g=f,h.properties.hasOwnProperty(g)||(h.properties[g]=i.qLayoutExclude.disabled[f]);delete i.qLayoutExclude.disabled}return i.qLayoutExclude.changed&&(n(i),delete i.qLayoutExclude.changed),i.qLayoutExclude.quarantine&&!a.isEmpty(i.qLayoutExclude.quarantine)||delete i.qLayoutExclude,h},importProperties:function(b,d,f){var g,h,m,n,o={qChildren:[]},p={},q=b.data[0],r=f.data&&f.data.measures;r||(r=f.definition&&f.definition.items&&f.definition.items.measures||{max:0});var s="function"==typeof r.max?r.max(q.dimensions.length):isNaN(r.max)?w:r.max,t="function"==typeof r.min?r.min(q.dimensions.length):isNaN(r.min)?0:r.min,u=f.data&&f.data.dimensions;u||(u=f.definition&&f.definition.items&&f.definition.items.dimensions||{max:0});var v="function"==typeof u.max?u.max(s):isNaN(u.max)?w:u.max,x="function"==typeof u.min?u.min(t):isNaN(u.min)?0:u.min;p.qLayoutExclude||(p.qLayoutExclude={}),p.qLayoutExclude.disabled={},p.qLayoutExclude.quarantine={};for(h in b.properties)"qLayoutExclude"===h?b.properties[h].quarantine&&(p.qLayoutExclude.quarantine=a.extend(!0,{},b.properties[h].quarantine)):d.hasOwnProperty(h)||"qMetaDef"===h?p[h]=b.properties[h]:p.qLayoutExclude.disabled[h]=b.properties[h];if(p=a.extend(!0,{},d,p),p.qHyperCubeDef.qDimensions.length=0,p.qHyperCubeDef.qMeasures.length=0,(q.dimensions.length>v&&v>0||q.measures.length>s&&s>0||q.excludedDimensions.length&&q.dimensions.length+q.excludedDimensions.length>x||q.excludedMeasures.length&&q.measures.length+q.excludedMeasures.length>t||!s&&q.measures.length||!v&&q.dimensions.length)&&(p.qHyperCubeDef.qLayoutExclude||(p.qHyperCubeDef.qLayoutExclude={}),p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef||(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef={}),(q.dimensions.length>v&&v>0||q.excludedDimensions&&q.excludedDimensions.length&&q.dimensions.length+q.excludedDimensions.length>x)&&(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions||(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions=[])),
(q.measures.length>s&&s>0||q.excludedMeasures&&q.excludedMeasures.length&&q.measures.length+q.excludedMeasures.length>t)&&(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures||(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures=[])),!s&&q.measures.length&&(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures||(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures=[])),!v&&q.dimensions.length&&(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions||(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions=[]))),v>0)for(m=0;m<q.dimensions.length;++m)p.qHyperCubeDef.qDimensions.length<v?p.qHyperCubeDef.qDimensions.push(k(q.dimensions[m])):p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(k(q.dimensions[m]));else if(q.dimensions.length)for(m=0;m<q.dimensions.length;++m)p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(k(q.dimensions[m]));if(q.excludedDimensions.length)for(m=0;m<q.excludedDimensions.length;++m)p.qHyperCubeDef.qDimensions.length<x?p.qHyperCubeDef.qDimensions.push(k(q.excludedDimensions[m])):p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(k(q.excludedDimensions[m]));if(s>0)for(m=0;m<q.measures.length;++m)p.qHyperCubeDef.qMeasures.length<s?p.qHyperCubeDef.qMeasures.push(q.measures[m]):p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(q.measures[m]);else if(q.measures.length)for(m=0;m<q.measures.length;++m)p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(q.measures[m]);if(q.excludedMeasures.length)for(m=0;m<q.excludedMeasures.length;++m)p.qHyperCubeDef.qMeasures.length<t?p.qHyperCubeDef.qMeasures.push(q.excludedMeasures[m]):p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(q.excludedMeasures[m]);if(n=p.qHyperCubeDef.qDimensions.length+p.qHyperCubeDef.qMeasures.length,p.qHyperCubeDef.qInterColumnSortOrder=q.interColumnSortOrder.concat(),m=p.qHyperCubeDef.qInterColumnSortOrder.length,m!==n)for(p.qHyperCubeDef.qLayoutExclude&&(p.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder=q.interColumnSortOrder.concat());m!==n;)m<n?(c.indexAdded(p.qHyperCubeDef.qInterColumnSortOrder,m),++m):(--m,c.indexRemoved(p.qHyperCubeDef.qInterColumnSortOrder,m));return g=e.mapProperties(e.mapDefinition(f.definition,f.type),{},f.type),["qAlwaysFullyExpanded","qSuppressMissing","qSuppressZero"].filter(function(a){return g&&g.qHyperCubeDef&&"undefined"==typeof g.qHyperCubeDef[a]}).forEach(function(a){i(a,d.qHyperCubeDef,p.qHyperCubeDef)}),i("qMaxStackedCells",d.qHyperCubeDef,p.qHyperCubeDef),i("qNoOfLeftDims",d.qHyperCubeDef,p.qHyperCubeDef),j("qInitialDataFetch",d.qHyperCubeDef,p.qHyperCubeDef,[{qTop:0,qLeft:0,qWidth:0,qHeight:0}]),j("qMode",d.qHyperCubeDef,p.qHyperCubeDef,"S"),j("qReductionMode",d.qHyperCubeDef,p.qHyperCubeDef,"N"),j("qSortbyYValue",d.qHyperCubeDef,p.qHyperCubeDef),j("qIndentMode",d.qHyperCubeDef,p.qHyperCubeDef),j("qShowTotalsAbove",d.qHyperCubeDef,p.qHyperCubeDef),l(p,b,d),o.qProperty=p,o}},r={exportProperties:function(a){var c,d,e,f=new b,g=a.qProperty,h=g.qListObjectDef,i=f.data[0];if((h.qLibraryId||h.qDef&&h.qDef.qFieldDefs[0])&&i.dimensions.push({qLibraryId:h.qLibraryId,qDef:h.qDef,title:h.title,qOtherTotalSpec:{}}),h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef&&h.qLayoutExclude.qHyperCubeDef.qDimensions)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qDimensions.length;++c)i.excludedDimensions.push(h.qLayoutExclude.qHyperCubeDef.qDimensions[c]);if(h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef&&h.qLayoutExclude.qHyperCubeDef.qMeasures)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qMeasures.length;++c)i.excludedMeasures.push(h.qLayoutExclude.qHyperCubeDef.qMeasures[c]);if(h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef&&h.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.length;++c)i.interColumnSortOrder.push(h.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder[c]);delete h.qLayoutExclude;for(d in g)f.properties[d]=g[d];if(g.qLayoutExclude&&g.qLayoutExclude._disabled){for(d in g.qLayoutExclude._disabled)e="_"===d.substr(0,1)?d.substring(1):d,f.properties.hasOwnProperty(e)||(f.properties[e]=g.qLayoutExclude.disabled[d]);delete g.qLayoutExclude.disabled}if(i.dimensions.length>0)for(c=0;c<i.dimensions[0].qDef.qSortCriterias.length;++c)i.dimensions[0].qDef.qSortCriterias[c].qSortByFrequency=0;return f},importProperties:function(b,c){var d,e,f={qChildren:[]},g={},h=b.data[0],i=1;g.qLayoutExclude||(g.qLayoutExclude={}),g.qLayoutExclude.disabled={};for(d in b.properties)"qLayoutExclude"===d?b.properties[d].quarantine&&(g.qLayoutExclude.quarantine=a.extend(!0,{},b.properties[d].quarantine)):c.hasOwnProperty(d)||"qMetaDef"===d?g[d]=b.properties[d]:g.qLayoutExclude.disabled[d]=b.properties[d];for(g=a.extend(!0,{},c,g),g.qListObjectDef.qLayoutExclude||(g.qListObjectDef.qLayoutExclude={}),g.qListObjectDef.qLayoutExclude.qHyperCubeDef||(g.qListObjectDef.qLayoutExclude.qHyperCubeDef={}),g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions||(g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions=[]),g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures||(g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]),g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder||(g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder=[]),e=0;e<h.dimensions.length;++e)e<i?(g.qListObjectDef.qDef=h.dimensions[e].qDef,g.qListObjectDef.qLibraryId=h.dimensions[e].qLibraryId):g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(h.dimensions[e]);for(e=0;e<h.excludedDimensions.length;++e)g.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(k(h.excludedDimensions[e]));for(e=0;e<h.measures.length;++e)g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(h.measures[e]);for(e=0;e<h.excludedMeasures.length;++e)g.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(h.excludedMeasures[e]);for(e=0;e<h.interColumnSortOrder.length;++e)g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.push(h.interColumnSortOrder[e]);return g.qListObjectDef.qInitialDataFetch=c.qListObjectDef.qInitialDataFetch,l(g,b,c),f.qProperty=g,f}},s={importProperties:function(a,b,c){var e=this.hypercube.importProperties(a,b,c),f=d.getValue(e,"qProperty.visualization"),h=d.getValue(e,"qProperty.qHyperCubeDef.qDimensions",[]),i=d.getValue(e,"qProperty.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",[]),j=d.getValue(e,"qProperty.qHyperCubeDef.qMeasures",[]).length,k=d.getValue(e,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]),l=d.getValue(e,"qProperty.color.colorExpression",""),n=d.getValue(e,"qProperty.color.mode",""),o=d.getValue(e,"qProperty.color.persistent",!1),p=g.canColorBy(e.qProperty,f);if(p[n])if("byDimension"!==n&&"byMeasure"!==n||!h.length)"byExpression"===n&&j&&(k.splice(0,0,{qExpression:l,id:"colorByExpression"}),d.setValue(e,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",k));else{var q=d.getValue(e,"qProperty.color.altLabel");g.setColorByItem("byDimension"===n,h,i,q,e.qProperty)}else d.setValue(e,"qProperty.color.mode","primary"),d.setValue(e,"qProperty.color.auto",!0);return h.length>1&&!o&&m("color.persistent",!0,e),h.forEach(function(a){"qTotalMode"in a.qOtherTotalSpec&&delete a.qOtherTotalSpec.qTotalMode,"qGlobalOtherGrouping"in a.qOtherTotalSpec&&delete a.qOtherTotalSpec.qGlobalOtherGrouping}),e},exportProperties:function(a){var b=this.hypercube.exportProperties(a),c=b.data[0];return h.moveByIdFromGroup(c.dimensions.concat(c.excludedDimensions),[],"qAttributeDimensions",h.IDMAP.COLOR_BY_ALTERNATIVE),h.moveByIdFromGroup(c.dimensions.concat(c.excludedDimensions),[],"qAttributeExpressions",h.IDMAP.COLOR_BY_ALTERNATIVE),h.moveByIdFromGroup(c.measures.concat(c.excludedMeasures),[],"qAttributeExpressions",h.IDMAP.COLOR_BY_EXPRESSION),b}},t={importProperties:function(b,c,d){var e,f,g=this.colorChart.importProperties.apply(this,[b,c,d]),h=g.qProperty;if(c.measureAxis&&"undefined"==typeof c.measureAxis.autoMinMax?p(h,"unsupportedAutoMinMax")||a.extend(h.measureAxis,c.measureAxis):p(h,"supportedAutoMinMax")||a.extend(h.measureAxis,c.measureAxis),b.properties.measureAxes&&!c.measureAxes&&c.measureAxis&&"undefined"!=typeof c.measureAxis.autoMinMax){var i=[];if(h.qHyperCubeDef.qMeasures.length>0&&h.qHyperCubeDef.qMeasures.forEach(function(a){a.qDef.series&&(i[a.qDef.series.axis]||(i[a.qDef.series.axis]={axis:a.qDef.series.axis,type:{line:0,marker:0,bar:0,total:0}}),["bar","marker","line"].contains(a.qDef.series.type)&&i[a.qDef.series.axis].type[a.qDef.series.type]++,i[a.qDef.series.axis].type.total++)}),i.length){var j="barchart"===c.visualization?"bar":"linechart"===c.visualization?"line":"";j&&(e=i.filter(function(a){return a.type[j]>0}).sort(function(a,b){return b.type[j]-a.type[j]})),e&&e.length||(e=i.sort(function(a,b){return b.type.total-a.type.total})),e&&e[0]&&a.extend(h.measureAxis,b.properties.measureAxes[e[0].axis])}else a.extend(h.measureAxis,b.properties.measureAxes[0])}return h.qHyperCubeDef.qDimensions.length>1&&(f=h.qHyperCubeDef.qInterColumnSortOrder.indexOf(0),0!==f&&(e=h.qHyperCubeDef.qInterColumnSortOrder[0],h.qHyperCubeDef.qInterColumnSortOrder[0]=0,h.qHyperCubeDef.qInterColumnSortOrder[f]=e)),g},exportProperties:function(a){var b=this.colorChart.exportProperties.apply(this,[a]);return"gauge"===b.properties.visualization?(o("measureAxis.min",b,"unsupportedAutoMinMax"),o("measureAxis.max",b,"unsupportedAutoMinMax")):(o("measureAxis.min",b,"supportedAutoMinMax"),o("measureAxis.max",b,"supportedAutoMinMax")),b}},u={importProperties:function(a,b,c){var e,f,g=this.hypercube.importProperties(a,b,c),h=d.getValue(g,"qProperty.qHyperCubeDef.qDimensions",[]),i=h.length,j=d.getValue(g,"qProperty.qHyperCubeDef.qMeasures",[]).length,k=d.getValue(g,"qProperty.qHyperCubeDef.qInterColumnSortOrder",[]),l=!0;i+j===k.length&&d.setValue(g,"qProperty.qLayoutExclude.quarantine.interColSortOrder",k.concat());var m=d.getValue(g,"qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder");m?(k=m,f=m.slice(),d.setValue(g,"qProperty.qHyperCubeDef.qInterColumnSortOrder",k),delete g.qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder):k.length=0;var n=k.indexOf(-1)>-1,o=i+n;if(o>k.length)for(e=k.length;e<o;e++)k.indexOf(e)<0&&k.push(e-n);for(e=k.length-1;e>=0;e--)k[e]>=i&&k.splice(e,1);if(j>1&&k.indexOf(-1)<0?k.push(-1):j<2&&k.indexOf(-1)>-1&&k.splice(k.indexOf(-1),1),i>0&&d.getValue(g,"qProperty.qHyperCubeDef.qNoOfLeftDims",-1)===-1&&d.setValue(g,"qProperty.qHyperCubeDef.qNoOfLeftDims",i),f&&k&&f.length===k.length){for(e=0;e<f.length;e++)if(f[e]!==k[e]){l=!1;break}l&&p(g.qProperty,"noOfLeftDims")}return h.forEach(function(a){"qTotalMode"in a.qOtherTotalSpec||(a.qOtherTotalSpec.qTotalMode="TOTAL_EXPR")}),g},exportProperties:function(a){var b=d.getValue(a,"qProperty.qHyperCubeDef.qInterColumnSortOrder",[]),c=b.slice(0),e=b.indexOf(-1);e>-1&&b.splice(e,1);var f=this.hypercube.exportProperties(a),g=f.properties.qHyperCubeDef,h=g.qDimensions.length,i=g.qMeasures.length,j=g.qInterColumnSortOrder;d.setValue(f,"properties.qLayoutExclude.quarantine.pivotInterColSortOrder",c),o("qHyperCubeDef.qNoOfLeftDims",f,"noOfLeftDims"),delete f.properties.qHyperCubeDef.qNoOfLeftDims;var k=d.getValue(f,"properties.qLayoutExclude.quarantine.interColSortOrder");k&&(j=k,d.setValue(f,"properties.qHyperCubeDef.qInterColumnSortOrder",j),d.setValue(f,"data.0.interColumnSortOrder",j),delete f.properties.qLayoutExclude.quarantine.interColSortOrder);for(var l=j.length;l<h+i;l++)j.length<=l&&j.push(l);return f}},v={importProperties:function(b,c){var d,e={qChildren:[]},f={};f.qLayoutExclude||(f.qLayoutExclude={}),f.qLayoutExclude.disabled={};for(d in b.properties)"qLayoutExclude"!==d&&(c.hasOwnProperty(d)||"qMetaDef"===d?f[d]=b.properties[d]:f.qLayoutExclude.disabled[d]=b.properties[d]);return f=a.extend(!0,{},c,f),l(f,b,c),e.qProperty=f,e},exportProperties:function(a){var c,d,e=new b,f=a.qProperty;for(c in f)e.properties[c]=f[c];if(f.qLayoutExclude||(f.qLayoutExclude={}),f.qLayoutExclude.disabled)for(c in f.qLayoutExclude.disabled)d=c,e.properties.hasOwnProperty(d)||(e.properties[d]=f.qLayoutExclude.disabled[c]);return delete f.qLayoutExclude,e}},{importCommonProperties:l,hypercube:q,listbox:r,axisChart:t,colorChart:s,pivotChart:u,other:v,changeProperty:m}}),define("client.soft-property-panel/default-explore-properties",["client.utils/property-resolver","client.utils/default-property-logic","client.utils/property-hypercube-helper"],function(a,b,c){var d,e,f,g,h,i=b.getLogicFor("explore","default");return h={translation:"properties.data",type:"items",component:"hypercube-data",icon:"database",items:{dimensions:{ref:"qHyperCubeDef.qDimensions",alternativeRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",type:"items"},measures:{ref:"qHyperCubeDef.qMeasures",alternativeRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",type:"items"}}},d={translation:"properties.sorting",type:"items",component:"sort",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",icon:"ascending",items:{dimensions:{ref:"qHyperCubeDef.qDimensions",type:"items",items:{sortOptions:{component:"radio-list",type:"number",diffs:["qDef.qSortCriterias.0.qSortByExpression","qDef.qSortCriterias.0.qSortByNumeric","qDef.qSortCriterias.0.qSortByAscii"],options:function(){return[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}]},setPropertyValue:function(b,c){a.setValue(b,"qDef.qSortCriterias.0.qSortByExpression",0),a.setValue(b,"qDef.qSortCriterias.0.qSortByNumeric",0),a.setValue(b,"qDef.qSortCriterias.0.qSortByAscii",c)},getValue:function(b){return 0===a.getValue(b,"qDef.qSortCriterias.0.qSortByExpression",0)&&0===a.getValue(b,"qDef.qSortCriterias.0.qSortByNumeric",0)?a.getValue(b,"qDef.qSortCriterias.0.qSortByAscii",0):0}}}},measures:{ref:"qHyperCubeDef.qMeasures",type:"items",items:{sortOptions:{component:"radio-list",type:"number",ref:"qSortBy.qSortByNumeric",options:function(){return[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}]}}}}}},e={component:"items",translation:"properties.colorsAndLegend",icon:"palette",grouped:!0,items:{mode:{component:"radio-list",type:"string",options:i.color.colorMode.options,diffs:["color.mode","color.auto"],setPropertyValue:function(a,b){"auto"===b?a.color.auto=!0:(a.color.auto=!1,a.color.mode=b)},getValue:function(a){return a.color.auto?"auto":a.color.mode}},dimension:{type:"items",show:function(a){return!a.color.auto&&"byDimension"===a.color.mode},items:{colorScheme:{translation:"properties.colorScheme",type:"string",component:"item-selection-list",horizontal:!0,showLabels:!1,ref:"color.dimensionScheme",items:i.helpers.getDimensionSchemeOptions(),show:function(a,b){if(1===c.getNumDimensions(a)&&c.getNumMeasures(a)<=1){var d=c.getDimensionLayouts(b)[0];return!(d&&d.qCardinal<=12)}return c.getNumMeasures(a)<=1||c.getNumMeasures(a)>12}},dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-radio-list",translation:"properties.colorDimensionId",show:!1},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",show:function(a){return c.getNumMeasures(a)<=1&&c.getNumDimensions(a)<=1},readOnly:i.color.persistentColors.readOnly}}},measure:{type:"items",show:function(a){return!a.color.auto&&"byMeasure"===a.color.mode},items:{sequential:{component:"item-selection-list",translation:"properties.colorScheme",horizontal:!0,showLabels:!1,type:"string",ref:"color.measureScheme",items:i.helpers.getMeasureSchemeOptions()}}},legend:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(a,b){return!a.color.auto&&i.legend.show(a,b)}}}},g={translation:"properties.presentation",type:"items",icon:"view",grouped:!0,items:{}},{data:h,sort:d,color:e,colorsAndLegend:f,presentation:g}}),define("objects.extension/default-extension",["qvangular","core.utils/deferred","objects.backend-api/generic-api","client.utils/property-mapper","objects.utils/data-properties/hypercube-handler","objects.utils/data-properties/listobject-handler","text!./default-template.ng.html","general.utils/visualizations","objects.utils/data-properties/library-utils","objects.extension/object-conversion","client.soft-property-panel/default-explore-properties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a){if(a.qHyperCube)return a.qHyperCube.qDimensionInfo||[];if(a.qChildList){var b=a.qChildList.qItems||[];return b.map(function(){return{}})}var c=!a.qListObject||!a.qListObject.qDimensionInfo||a.qListObject.qDimensionInfo.qError;return c?[]:[a.qListObject.qDimensionInfo]}function m(a){return a.qHyperCube?a.qHyperCube.qMeasureInfo||[]:[]}function n(a,b,c){var d,e,f,g,h,j;for(d=0;d<a.data.length;++d){for(e=0;e<a.data[d].dimensions.length;++e)f=a.data[d].dimensions[e],f.qLibraryId&&(h=i.findLibraryDimension(f.qLibraryId,b),h&&(f.title=h.qData.title));for(e=0;e<a.data[d].measures.length;++e)g=a.data[d].measures[e],g.qLibraryId&&(j=i.findLibraryMeasure(g.qLibraryId,c),j&&(g.title=j.qData.title));for(e=0;e<a.data[d].excludedDimensions.length;++e)f=a.data[d].excludedDimensions[e],f.qLibraryId&&(h=i.findLibraryDimension(f.qLibraryId,b),h&&(f.title=h.qData.title));for(e=0;e<a.data[d].excludedMeasures.length;++e)g=a.data[d].excludedMeasures[e],g.qLibraryId&&(j=i.findLibraryMeasure(g.qLibraryId,c),j&&(g.title=j.qData.title))}}return{BackendApi:c,template:g,hasDefaultTemplate:function(){return this.template===g},mapProperties:function(){this.mappedDefinition=d.mapDefinition(this.definition,this.type),this.globalChangeListeners=d.findGlobalListeners(this.mappedDefinition);var a=this.data&&this.data.dimensions;a?(a.min="undefined"!=typeof a.min?a.min:1,a.max="undefined"!=typeof a.max?a.max:1e3):this.data||(a=d.findDefinition(this.mappedDefinition,"qHyperCubeDef.qDimensions",!0),a||(a=d.findDefinition(this.mappedDefinition,"qListObjectDef",!0)),a&&(a.obsolete=!0)),this.dimensionDefinition=a;var b=this.data&&this.data.measures;b?(b.min="undefined"!=typeof b.min?b.min:1,b.max="undefined"!=typeof b.max?b.max:1):this.data||(b=d.findDefinition(this.mappedDefinition,"qHyperCubeDef.qMeasures",!0),b&&(b.obsolete=!0)),this.measureDefinition=b},getCreatePropertyHandler:function(a){var b,c,g=this.mappedDefinition,h=this.globalChangeListeners;return this.model.layout.qListObject?(b=d.mapProperties(this.dimensionDefinition),new f({app:a,dimensionDefinition:this.dimensionDefinition,dimensionProperties:b})):(this.dimensionDefinition&&this.dimensionDefinition.obsolete?b=d.mapProperties(this.dimensionDefinition):this.dimensionDefinition&&(b=d.mapProperties(g.items.data.items.dimensions)),this.measureDefinition&&this.measureDefinition.obsolete?c=d.mapProperties(this.measureDefinition):this.measureDefinition&&(c=d.mapProperties(g.items.data.items.measures)),new e({app:a,dimensionDefinition:this.dimensionDefinition,measureDefinition:this.measureDefinition,dimensionProperties:b,measureProperties:c,globalChangeListeners:h}))},mapSoftProperties:function(){function a(b){var c=[{diffs:b.ref||b.sortIndexRef?[b.ref||b.sortIndexRef]:b.diffs||[]}];return b.items&&Object.keys(b.items).forEach(function(d){c.push({diffs:a(b.items[d])})}),b._diffs=c,c}if(this.softDefinition){var b=d.mapDefinition(this.softDefinition,null,k);a(b),this.mappedSoftDefinition=b}},hasError:function(a){var b=a.layout;return b.qHyperCube?!!b.qHyperCube.qError:!!b.qListObject&&!!b.qListObject.qError},showRequirements:function(a){var b,c=a.ext.dimensionDefinition?a.ext.dimensionDefinition.min:0,d=a.ext.measureDefinition?a.ext.measureDefinition.min:0,e=l(a.layout),f=m(a.layout);if(c>0&&e.length<c)return!0;for(b=0;b<e.length;++b)if(e[b].qError)return!0;if(d>0&&f.length<d)return!0;for(b=0;b<f.length;++b)if(f[b].qError)return!0;return!1},addFieldDimension:function(b,c){return c.model.getProperties().then(function(d){var e=c.getCreatePropertyHandler();return e.setProperties(d),e.addFieldDimension(b.value,b.trimmedValue).then(function(b){e.updateGlobalChangeListeners(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})})},addLibraryDimension:function(b,c){return c.model.getProperties().then(function(d){var e=c.getCreatePropertyHandler();return e.setProperties(d),e.addLibraryDimension(b.libraryId).then(function(b){e.updateGlobalChangeListeners(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})})},addLibraryMeasure:function(b,c){return c.model.getProperties().then(function(d){var e=c.getCreatePropertyHandler();return e.setProperties(d),e.addLibraryMeasure(b.libraryId).then(function(b){e.updateGlobalChangeListeners(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})})},addExpressionMeasure:function(b,c){return c.model.getProperties().then(function(d){var e=c.getCreatePropertyHandler();return e.setProperties(d),e.addExpressionMeasure(b.value,b.trimmedValue).then(function(b){e.updateGlobalChangeListeners(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})})},getDropFieldOptions:function(a,b,c,d,e){a.Add(c,b,e),a.ReplaceDimensions(c,b,e),a.AddFieldAsMeasure(c,b,e),a.ColorBy(c,b,e),d()},getDropDimensionOptions:function(b,c,d,e,f){c.getDimensions().length<c.minDimensions()?c.addLibraryDimension(b.item.id).then(function(b){d.save(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)}):(b.Add(d,c,f),b.ReplaceDimensions(d,c,f),b.ColorBy(d,c,f),e())},getDropMeasureOptions:function(b,c,d,e,f){var g=c.getMeasures().length;g<c.minMeasures()||0===g&&g<c.maxMeasures()?"expression"===b.item.type?c.addExpressionMeasure(b.item.name,"").then(function(b){d.save(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)}):c.addLibraryMeasure(b.item.id).then(function(b){d.save(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)}):(b.Add(d,c,f),b.ReplaceMeasures(d,c,f),b.ColorBy(d,c,f),e())},getDropTemplateOptions:function(a,b,c,d,e){var f=this,g=h.getType(a.item.template),i=["contextMenu.convertTo",a.item.name];f.type!==g.type?g.getExtensionType().then(function(b){!e.isReadonly&&f.exportProperties&&b.importProperties&&a.menu.addItem({translation:i,tid:"convert",select:function(){f._convert(g,b,a.item)}}),d()},function(){d()}):d()},getDropOptions:function(a,b,c){var d,e,f,g=a.model,h=this;return e={field:"getDropFieldOptions",dimension:"getDropDimensionOptions",measure:"getDropMeasureOptions",template:"getDropTemplateOptions",expression:"getDropMeasureOptions"},d=b.item.type,(f=e[d])?g.getProperties().then(function(d){var e=a.getCreatePropertyHandler();return e.setProperties(d),e.setLayout(a.model&&a.model.layout),h[f](b,e,g,c,a)}):void c()},_convert:function(a,c,d){var e,f,g=this;b.all({initialProperties:a.getInitialProperties(d.init),propertyTree:g.model.getFullPropertyTree()}).then(function(a){try{e=g.exportProperties(a.propertyTree),b.all({dimensionList:g.model.enigmaModel.app.getDimensionList(),measureList:g.model.enigmaModel.app.getMeasureList()}).then(function(b){n(e,b.dimensionList,b.measureList),f=c.importProperties(e,a.initialProperties,c),g.model.getLayout().then(function(a){a.qHasSoftPatches?(g.model.markAsCancelled(),g.model.clearSoftPatches().then(function(){g.model.propertyTree=f,g.model.saveTree().then(function(){g.model.markAsInvalid()})})):(g.model.propertyTree=f,g.model.saveTree())})})}catch(d){}})},exportProperties:function(a){return a.qProperty.qHyperCubeDef?j.hypercube.exportProperties(a):a.qProperty.qListObjectDef?j.listbox.exportProperties(a):j.other.exportProperties(a)},importProperties:function(a,b,c){return b.qHyperCubeDef?j.hypercube.importProperties(a,b,c):b.qListObjectDef?j.listbox.importProperties(a,b,c):j.other.importProperties(a,b,c)},support:{cssScaling:!1,sharing:!1,snapshot:!1,export:!1,exportData:!0},options:{}}}),define("core.models/base-object",["core.models/rpc-base","core.models/app","core.utils/deferred","core.utils/permissions","util"],function(a,b,c,d,e){"use strict";function f(c,e){var f,g,h=c.name+"List",i=Object.keys(e).filter(function(a){if(a.indexOf("ListDef")>-1)return a})[0].replace(/Def$/g,"");if(!i)throw new Error("BaseObject: Tried to create a model without a ListDef in properties");g=a.extend(h,{strippedLayout:{},getLayout:function(){var a=this;return this._super().then(function(b){return a.strippedLayout=b[i].qItems,a.strippedLayout.forEach(function(a){"object"==typeof a&&d.mapToLayout(a)}),a.strippedLayout})}}),e.qInfo={qId:h,qType:h},c.getList=function(a,c){return a=a||b.current,f&&!c?f:f=a.createSessionObject(e).then(function(b){return new g({id:h,handle:b.qHandle,session:a.session})})},c.getListLayout=function(a,b){return this.getList(a,b).then(function(a){return a.getLayout()})}}var g;return g=a.extend("BaseObject",{getInfo:function(){return this.rpc("GetInfo","qInfo")},clone:function(a,c){var d=this;return c=c||b.current,c.rpc(a||"CloneObject","qCloneId",[d.id]).then(function(a){return d.constructor.get(a)})}}),g.get=function(a,c){var d=function(b){function c(){return b.enigmaModel.getObject(a)}return this.getModel(a,b.session,c)}.bind(this);return c?d(c):b.current.waitForOpen.promise.then(function(a){return d(a)})},g.create=function(a,d,f){var g=this;return a.qInfo=a.qInfo||{},a.qInfo.qId=a.qInfo.qId||e.generateId(),a.qInfo.qType=a.qInfo.qType||this.name.toLowerCase(),d=d||"CreateObject",d=d.substring(0,1).toLowerCase()+d.substring(1),f=f||b.current,f.enigmaModel[d](a).then(function(a){return g.getModel(a.id,f.session,function(){return c.resolve(a)})})},g.remove=function(a,c,d,e){var f=[a];return e&&f.push(e),d=d||b.current,c=c||"DestroyObject",d.rpc(c,"qReturn",f)},g.States=a.States,g.extend=function(b,c,d){var e=a.extend.call(this,b,c);return e.extend=g.extend,e.get=g.get,e.create=g.create,e.remove=g.remove,e.States=g.States,d&&d.listProperties&&f(e,d.listProperties),e},g}),define("core.models/generic-object",["core.models/base-object","core.utils/deferred","util"],function(a,b,c){"use strict";var d;return d=a.extend("GenericObject",{createChild:function(a,e,f){var g=this.session,h=[a];return f=f||d,e&&h.push(e),a.qInfo.qId=a.qInfo.qId||c.generateId(),this.enigmaModel.createChild(a).then(function(a){return f.getModel(a.id,g,function(){return b.resolve(a)})})},removeChild:function(a,b){return d.remove(a,"DestroyChild",this,b)},setChildArrayOrder:function(a){var b=[a];return this.rpc("SetChildArrayOrder",null,b)},removeAllChildren:function(a){var b=[];return a&&b.push(a),this.rpc("DestroyAllChildren",null,b)},copyFrom:function(a){return this.rpc("CopyFrom",null,[a])},applyPatches:function(a,b){return this.rpc("ApplyPatches",null,[a,b])},clearSoftPatches:function(){return this.rpc("ClearSoftPatches")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])},exportData:function(a,b,c,d){a=a||"OOXML",b=b||"",c=c||"",d=d||"P";var e=[a,b,c,d];return this.rpc("ExportData",null,e,{raw:!0})},cancelRequest:function(a){var b=this,c=b.session.getRequest(a);return b.session.rpc({method:"CancelRequest",handle:-1,params:[a]}).then(function(){c&&"GetLayout"===c.method&&b.setState(d.States.CANCELLED)})},selectHyperCubeValues:function(a,b,c,d){return this.rpc("SelectHyperCubeValues",null,[a,b,c,d])},getHyperCubeData:function(a,b){return this.rpc("GetHyperCubeData",null,[a,b])}})}),define("objects.models/visualization-object",["core.models/app","core.models/generic-object"],function(a,b){"use strict";var c;return c=b.extend("VisualizationObject",{init:function(){this._super.apply(this,Array.prototype.slice.apply(arguments))}}),c.create=function(c,d,e){return d=d||a.current,d.createChild?d.createChild(c,e,this):b.create.call(this,c)},c.createTransient=function(b,c){var d=this,e=function(a){return a.enigmaModel.createSessionObject(b).then(function(b){return new d({id:null,handle:b.handle,session:a.session,enigmaModel:b})})};return c?e(c):a.current.waitForOpen.promise.then(function(a){return e(a)})},c.remove=function(a,c,d){var e=null;c&&c.removeChild&&(e="DestroyChild"),b.remove.call(this,a,e,c,d)},c.extend=function(){var a=b.extend.apply(this,arguments);return a.extend=c.extend,a.create=c.create,a.createTransient=c.createTransient,a.remove=c.remove,a},c}),define("objects.extension/base-view",["core.utils/class","core.utils/deferred"],function(a,b){"use strict";var c=a.extend({paint:function(){return b.resolve()},resize:function(){return b.resolve()}});return c}),define("objects.views/selections/cache-item",[],function(){"use strict";function a(a,b,c,d,e,f,g){if(a instanceof Array&&!a[0].pointInside&&!a.pointInside)throw"The shape must implement a `pointInside` function";this.setShape(a),this.selected=!!b,this.value=c,this.parent=d,this.index=e,this.objectShapes={},f&&(this.parent=f.parent,this.node=f,this.rowIndex=f.data.rowIndex,this.label=f.data.qText,this.id=f.data.qElemNo),g&&a&&(this.objectShapes[g]=a instanceof Array?a:[a])}return a.prototype={getShapes:function(a){return(a||0===a)&&this.objectShapes&&this.objectShapes[a]?this.objectShapes[a]:this.shapes?this.shapes:[this.shape]},addShape:function(a,b){this.objectShapes[a]instanceof Array||(this.objectShapes[a]=[]),this.objectShapes[a].push(b),this.shapes.push(b)},setShape:function(a){this.shape=a instanceof Array?a[0]:a,a?this.shapes=a instanceof Array?a:[a]:this.shapes=[]},addValue:function(a){void 0===this.value&&(this.value=[]),this.value instanceof Array||(this.value=[this.value]),this.value.push(a)}},a}),define("objects.extension/default-selection-toolbar",["core.utils/class"],function(a){"use strict";var b;return b=a.extend("SelectionToolbar",{menuButtons:[],init:function(a,b,c,d,e,f){this.backendApi=a,this.selectionsApi=b,this.showMenu=c,this.showLock=d,e=e||[],this.menuButtons=f||[];var g=[{name:"Tooltip.clearSelection",tid:"selection-toolbar.clear",isIcon:!0,buttonClass:"clear",iconClass:"lui-icon lui-icon--clear-selections",action:function(){this.selectionsApi.clear()},isDisabled:function(){return!this.selectionsApi.selectionsMade}},{clazz:"sel-toolbar-separator",buttonClass:"sel-toolbar-icon-separator",isDisabled:function(){return!0}}];g.push({name:"Tooltip.CancelSelections",tid:"selection-toolbar.undo",isIcon:!1,iconClass:"lui-icon lui-icon--remove",buttonClass:"sel-toolbar-cancel",action:function(){this.selectionsApi.cancel()}}),g.push({name:"Tooltip.ConfirmSelections",tid:"selection-toolbar.refresh",iconClass:"lui-icon lui-icon--tick",buttonClass:"sel-toolbar-confirm",action:function(){this.selectionsApi.confirm()},isDisabled:function(){return!this.selectionsApi.selectionsMade}}),this.buttons=e.concat(g)},hasState:function(a){if(!a)return!0;for(var b=this.backendApi.getDimensionInfos(),c=0;c<b.length;++c)for(var d=0;d<a.length;++d)if(b[c].qStateCounts[a[d]]>0)return!0;return!1}})}),define("objects.utils/interaction-states",[],function(){"use strict";var a={STATIC:0,ANALYSIS:1,EDIT:2};return a}),define("objects.extension/default-view",["objects.extension/base-view","core.utils/deferred","qvangular","general.utils/shapes/rect","objects.views/selections/cache-item","objects.extension/default-selection-toolbar","objects.utils/interaction-states"],function(a,b,c,d,e,f,g){"use strict";var h;return h=a.extend("DefaultView",{$scope:null,$element:null,containerRect:null,options:null,selections:null,backendApi:null,activeDimensions:[0],selectedShapes:[],init:function(a,b,c,d){this.$scope=a,this.$element=b,this.options=c,this.backendApi=d,a.selectValues=this.selectValues.bind(this)},on:function(){this.selections&&this.selections.on(),this.tooltips&&this.tooltips.on(),this.options&&this.options.selections===!1?this.selectionsEnabled=!1:this.selectionsEnabled=!0,this._on=!0},off:function(){this.selections&&this.selections.off(),this.tooltips&&this.tooltips.off(),this.selectionsEnabled=!1,this._on=!1},isOn:function(){return this._on},prePaint:function(){},suppressOnPaint:function(a){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):a.qSelectionInfo&&a.qSelectionInfo.qInSelections},paint:function(){return b.resolve(!1)},updateData:function(){return b.resolve();
},resize:function(a,b){return this.paint(a,b)},destroy:function(){this.$scope.selectValues=null},initialize:function(){this.selections&&this.initSelections(),this.options&&(isNaN(this.options.interactionState)||this.setInteractionState(this.options.interactionState),this.options.direction&&this.setDirection(this.options.direction)),this.tooltips&&this.initTooltips()},setSelections:function(a){this.selections=a},initSelections:function(){this.selections&&(this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",{rect:new d(0,0,this.$element.width(),this.$element.height())}),this.options._disableSelections||(this.selections.Select.bind(function(a,b){this.onSelect(a,b)}.bind(this)),this.selections.ToggleShape.bind(function(a){var b=this.selectedShapes.indexOf(a);b!==-1?this.selectedShapes.splice(b,1):this.selectedShapes.push(a),this.onToggleShape(a)}.bind(this)),this.selections.Deactivated.bind(function(){this.selectedShapes=[]}.bind(this)),this.selections.Clear.bind(function(){this.selectedShapes=[]}.bind(this))))},setTooltips:function(a){this.tooltips=a},initTooltips:function(){},refreshSelections:function(){this.selections&&(this.containerRect=this.$element[0].getBoundingClientRect(),this.selections.cache.clear())},onToggleShape:function(a){a.$element[this.isSelected(a.value)?"addClass":"removeClass"]("selected")},onSelect:function(a,b){if(a.length){var c=this.selectedShapes.map(function(a){return a.value});c.length>0&&this.activeDimensions.length>0?this.backendApi.select(c,this.activeDimensions,b):1!==a.length||a[0].selected||this.backendApi.clearSelections()}},onRangeSelect:function(){},addToSelectionCache:function(a,b){if(this.selections){var c=this.containerRect,f=a[0].getBoundingClientRect(),g=new e(new d(f.left-c.left,f.top-c.top,f.right-f.left,f.bottom-f.top),!1,b);g.$element=a,this.selections.cache.add(g)}},isSelected:function(a){return this.selectedShapes.filter(function(b){return b.value===a}).length},getContextMenu:function(){},setSnapshotData:function(){},getViewState:function(){return{}},getSelectionToolbar:function(){var a=this;return new f(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[{name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"lui-icon lui-icon--lasso",action:function(){a.toggleLasso=!a.toggleLasso},isActive:function(){return this.name=a.toggleLasso?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection",a.toggleLasso},isDisabled:function(){return!(!a.isLassoDisabled||!a.isLassoDisabled())}}],[])},setBackendApi:function(a){this.backendApi=a},selectValues:function(a,b,c){if(this.selectionsEnabled){if(!this.backendApi.inSelections()){var d=this.$scope,e=this;d.selectionsApi.confirm=function(){d.backendApi.endSelections(!0).then(function(){d.selectionsApi.deactivated()})},d.selectionsApi.cancel=function(){d.backendApi.endSelections(!1),d.selectionsApi.deactivated()},d.selectionsApi.deactivate=function(){this.deactivated()},d.selectionsApi.clear=function(){e.clearSelectedValues(e.$element),d.backendApi.clearSelections(),d.selectionsApi.selectionsMade=!1,e.selectedArrays={}},this.getSelectionToolbar=function(){return new f(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[],[])},this.backendApi.beginSelections(),d.selectionsApi.activated(),this.selectedArrays={}}if(this.$scope.selectionsApi.selectionsMade=!0,this.selectedArrays[a]||(this.selectedArrays[a]=[]),c)for(var g=0;g<b.length;g++){var h=this.selectedArrays[a].indexOf(b[g]);h===-1?this.selectedArrays[a].push(b[g]):this.selectedArrays[a].splice(h,1)}else this.selectedArrays[a]=this.selectedArrays[a].concat(b);this.backendApi.selectValues(a,this.selectedArrays[a],!1)}},clearSelectedValues:function(a){a.find(".selected").removeClass("selected")},setInteractionState:function(a){this._interactionState=a,this._inEditState=a===g.EDIT,this._inAnalysisState=a===g.ANALYSIS,this._inAnalysisState&&!this._on?this.on():!this._inAnalysisState&&this._on&&this.off()},setDirection:function(a){this.$scope.options.direction=a,this.options.direction=a,this.selections&&this.selections.options&&this.selections.options.range&&(this.selections.options.range.rtl="rtl"===a,this.selections.types.range.setDirection(a))},inAnalysisState:function(){return this._inAnalysisState},inEditState:function(){return this._inEditState},getPreferredSize:function(){}}),Object.defineProperties(h.prototype,{toggleLasso:{set:function(a){this.selections&&(this.selections.lassoEnabled=a,c.$apply(function(){this.options.lassoEnabled=a}.bind(this)))},get:function(){return this.selections&&this.selections.lassoEnabled}}}),h}),define("objects.extension/base-controller",["core.utils/class","core.utils/deferred","objects.extension/default-selection-toolbar"],function(a,b,c){"use strict";var d=a.extend({$scope:null,init:function(a){this.$scope=a},onPaint:function(){return b.resolve()},onResize:function(){return b.resolve()},setInteractionState:function(){},setDirection:function(){},setSnapshotData:function(){},setBackendApi:function(){},getContextMenu:function(){},getObjectMenu:function(){},getSelectionToolbar:function(){return new c(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1)},getPreferredSize:function(){},onInit:function(){return b.resolve()}});return d.$inject=["$scope"],d}),define("general.utils/shapes/point",[],function(){"use strict";function a(a,b){0===arguments.length?this.set(0,0):this.set(a,b)}return a.prototype={toString:function(){return this.x+" "+this.y},clone:function(){return new a(this.x,this.y)},set:function(a,b){this.x=a,this.y=b},equal:function(a){return this.x===a.x&&this.y===a.y},closeTo:function(a,b){return!!a&&(Math.abs(this.x-a.x)<b&&Math.abs(this.y-a.y)<b)},distanceTo:function(a){return a?Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2)):NaN}},a}),define("objects.views/charts/utils/cache-utils",[],function(){function a(b,c){return b.forEach(function(b){if(b.isCacheItem)c.push(b);else if(b.data.cacheItem)c.push(b.data.cacheItem);else if(b.cacheItem&&(c.push(b.cacheItem),b.cacheItem.isCacheItem))throw"Using new cache item before its time";b.children&&b.children.length>0&&a.apply(this,[b.children,c])}),c}var b={getCacheItems:function(){return this.children&&this.children?a.apply(this,[this.children,[]]):[]}};return b}),define("objects.views/charts/utils/tree-iterator",[],function(){var a={getLevel:function(){if(this&&this.parent!==this){for(var a=this.parent,b=0;a;)b+=1,a=a.parent;return b}},each:function(b){var c,d=this.children;if(d)for(c=0;c<d.length;c+=1){if(b&&b(d[c],c,d.length-1)===!1)return!1;if(a.each.call(d[c],b)===!1)return!1}},getLeaves:function(){if(!this.children||!this.children)return[];var b,c=[];for(b=0;b<this.children.length;b+=1)this.children[b]&&this.children[b].children&&this.children[b].children.length?c=c.concat(a.getLeaves.call(this.children[b])):c.push(this.children[b]);return c}};return a}),define("objects.views/selections/shapes-from",["jquery","core.utils/class","objects.views/charts/utils/cache-utils","objects.views/charts/utils/tree-iterator"],function(a,b,c,d){"use strict";function e(a){return a?a.selectionIdentifier:null}function f(a,b){if(b){var c=!1;return b.contains(0)&&(c=a.parent?a.parent.id===-2:a.id===-2),a.parent&&b.contains(1)&&(c=c||a.id===-2),c}return a.id===-2||a.parent&&a.parent.id===-2}function g(a,b){return a&&a.length?b.filter(function(b){return a.some(function(a){return b.col===a.col&&b.id===a.id})}):[]}var h=b.extend({init:function(b,c){this.options=a.extend(!0,{},{allowNullSelect:!1,activeComponent:null},c),this.cache=b,this.allowNullSelect=this.options.allowNullSelect,this.activeComponent=this.options.activeComponent},shapeFromPoint:function(a){return this.shapesFromPoints([a])[0]},shapesFromPoints:function(a){var b,c,d,g,h,i,j,k,l,m,n=this.cache.data,o=this.cache.data.length,p=a.length,q=this.activeComponent||this.components&&this.components.dataArea?(this.activeComponent||this.components.dataArea[0]).chartScale||1:1,r=e(this.activeComponent),s=[];for(k=0;k<o;++k)if(j=n[k],!f(j)||this.allowNullSelect)for(l=0;l<p;++l)for(b=a[l],c={x:b.x/q,y:b.y/q},h=j.getShapes(e(this.activeComponent)),"dataArea"===r&&j.toggleShapes&&(h=h.concat(j.toggleShapes)),g=h.length,m=0;m<g;++m)if(i=h[m],d=i.clearModelView?b:c,i.pointInside(d.x,d.y)){s.push(j);break}return s},shapesFromLines:function(a){var b,c,d,g,h,i,j,k,l=this.cache.data,m=this.cache.data.length,n=a.length,o=[];for(i=0;i<m;++i)if(h=l[i],!f(h)||this.allowNullSelect)for(j=0;j<n;++j)for(b=a[j],d=h.getShapes(e(this.activeComponent)),c=d.length,k=0;k<c;++k)if(g=d[k],g.intersectsLine(b)){o.push(h);break}return o},shapesFromPolygon:function(a){var b,c,d,g,h,i,j,k,l,m,n=this.cache.data,o=this.cache.data.length,p=[];for(j=0;j<o;++j)if(i=n[j],!f(i)||this.allowNullSelect)for(m=!1,h=i.getShapes(e(this.activeComponent)),g=h.length,l=0;l<g&&!m;++l)for(b=h[l].getPoints(),d=b.length,k=0;k<d;++k)if(c=b[k],a.pointInside(c.x,c.y)){p.push(i),m=!0;break}return p},shapesFromRect:function(a,b){if(!a)return[];var c,d,g,h,i,j,k=this.cache.data,l=this.cache.data.length,m=[];for(i=0;i<l;++i)if(h=k[i],!f(h)||this.allowNullSelect)for(d=h.getShapes(b?b:e(this.activeComponent)),c=d.length,j=0;j<c;j++)if(g=d[j],g.intersectsRect){if(g.intersectsRect(a)){m.push(h);break}}else if(a.intersectsWith(g)){m.push(h);break}return m},shapesFromRectForDirection:function(a,b,c){var d,g,h,i,j,k,l,m=this.cache.data,n=this.cache.data.length,o=[],p=0,q=0,r="";switch(b){case"x":p=a.x,q=a.getRight(),r="getRight";break;case"y":p=a.y,q=a.getBottom(),r="getBottom"}for(k=0;k<n;++k)if(d=m[k],!f(d)||this.allowNullSelect)for(h=d.getShapes(c?c:e(this.activeComponent)),g=h.length,l=0;l<g;++l)if(i=h[l],"cx"in i){if(i["c"+b]>=p&&i["c"+b]<=q){o.push(d);break}}else{if(j=i.getBoundingRect(),j[b]>=p&&j[b]<=q){o.push(d);break}if(j[r]()>=p&&j[r]()<=q){o.push(d);break}if(p>=j[b]&&q<=j[r]()){o.push(d);break}}return o},shapesFromRange:function(a,b,c,d){var e,g,h,i,j,k,l=Math.min(a,b),m=Math.max(a,b),n=this.cache.data,o=this.cache.data.length,p=this.activeComponent&&"function"==typeof this.activeComponent.getType?this.activeComponent.getType().indices:null,q=[];for(c=c!==!1,d=d!==!1,k=c&&d?function(a){return a>=l&&a<=m}:c?function(a){return a>=l&&a<m}:d?function(a){return a>l&&a<=m}:function(a){return a>l&&a<m},i=0;i<o;++i)if(e=n[i],!f(e)||this.allowNullSelect)for(g=e.values instanceof Array?e.values:e.value instanceof Array?e.value:[e.value],p&&p.length&&(g=g.filter(function(a,b){return p.indexOf(b)>=0})),j=0;j<g.length;j++)if(h=g[j],k(h)){q.push(e);break}return q},shapesFromDimensionValue:function(a){var b,c,d,e=this.cache.data,g=this.cache.data.length,h=[];for(c=0;c<g;++c)if(b=e[c],!f(b)||this.allowNullSelect)for(d=0;d<a.length;d++)if(b.id===a[d]){h.push(b);break}return h},groupedItemsFromShapes:function(a){var b,e,f,h,i=[];return b=void 0!==this.activeComponent.getSelectionIndices?this.activeComponent.getSelectionIndices():[0],e=b[b.length-1],a&&a[0]&&a[0].col===e?g(a,this.cache.data):(a.forEach(function(b){h=b.parent,void 0!==h&&(f=d.getLevel.call(h)-(b.isCacheItem?0:1),f===e&&i.indexOf(h)===-1&&a&&i.push(h))}),i.length>0&&(a=[],i.forEach(function(b){a=a.concat(c.getCacheItems.call(b))})),a)},shapesFromIndex:function(a,b){var c,d,e=Math.min(a,b),f=Math.max(a,b),g=this.cache.data,h=this.cache.data.length,i=[];for(d=0;d<h;++d)c=g[d],void 0!==c.index&&c.index>=e&&c.index<=f&&i.push(c);return i},_isNull:f,release:function(){this.cache=null,this.allowNullSelect=null,this.activeComponent=null}});return h}),define("objects.views/selections/cache-consumer",["jquery","core.utils/class","general.utils/shapes/point","./shapes-from"],function(a,b,c,d){"use strict";function e(a){var b=this.indexOf(a);return b>=0?this.splice(b,1):null}function f(a,b){return Object.keys(b).filter(function(c){return b[c].filter(function(b){return b===a}).length})[0]}var g=b.extend({init:function(b,c){this.options=a.extend(!0,{},{components:{}},c),this._selectedShapes=[],this._cssTransform={scale:1},this.components=this.options.components,this.shapesFrom=new d(b,c)},setActiveComponent:function(a){this.activeComponent=a,this.shapesFrom.activeComponent=a},initComponent:function(){throw new Error("base.js: initComponent has to be implemented in subclass")},setComponent:function(a,b){var c=Array.isArray(b)?b.concat():[b];switch(c.forEach(function(a){var b=f(a,this.components);b&&this.removeComponent(b,a)},this),a){case"x":case"y":case"dataArea":case"colorLegend":this.components[a]&&this.components[a].forEach(function(a){c.indexOf(a)===-1&&this.deregister(this,a)},this),c.forEach(function(b){this.components[a]&&this.components[a].indexOf(b)!==-1||this.register(this,b)},this),this.components[a]=c;break;default:throw"Key "+a+" not implemented"}},addComponent:function(a,b){switch(a){case"x":case"y":case"dataArea":case"colorLegend":this.components[a]||(this.components[a]=[]);var c=e.call(this.components[a],b);!c&&this.register(this,b),this.components[a].push(b);break;default:throw"Key "+a+" not implemented"}},removeComponent:function(a,b){switch(a){case"x":case"y":case"dataArea":case"colorLegend":this.components[a]&&b&&e.call(this.components[a],b),b&&this.components[a]&&this.components[a].length||delete this.components[a],this.deregister(this,b);break;default:throw"Key "+a+" not implemented"}},register:function(){},deregister:function(){},getComponent:function(a,b,d){var e=new c(a-d.x,b-d.y);return Object.keys(this.components).map(function(a){return this.components[a]},this).reduce(function(a,b){return a.concat(b)}).filter(function(a){var b=(a.chartScale||1)*this._cssTransform.scale;return this.getRect(a).pointInside(e.x/b,e.y/b)},this)[0]},getRect:function(a){return a.rect},getComponentKey:function(a){return Object.keys(this.components).filter(function(b){return this.components[b].indexOf(a)>=0},this)[0]},getTransformedPoint:function(a,b,d){var e=this.getRect(this.activeComponent||this.components.dataArea[0]),f=(this.activeComponent||this.components.dataArea[0]).chartScale||1;return new c((a-e.x*f*this._cssTransform.scale-d.x)/this._cssTransform.scale,(b-e.y*f*this._cssTransform.scale-d.y)/this._cssTransform.scale)},getPagePoint:function(a,b,d,e){var f=this.getRect(d||this.activeComponent||this.components.dataArea[0]),g=(this.activeComponent||this.components.dataArea[0]).chartScale||1;return new c(a+f.x*g+e.x,b+f.y*g+e.y)},release:function(){this.activeComponent=null,this.shapesFrom&&this.shapesFrom.release(),this.components=null,this.options.components=null,this.shapesFrom=null}});return g}),define("objects.views/selections/interaction-type",["core.utils/class"],function(a){var b=a.extend({init:function(){},tap:{},taptwo:{},tapthree:{},swipe:{},swipetwo:{},rotate:{},mousemove:{},mouseleave:{},mousewheel:{},wheelswipe:{},exclusive:function(){return!1},active:function(){return!0}});return{extend:function(){return 2===arguments.length?b.extend.call(a,arguments[0],arguments[1]):new(b.extend(arguments[0]))}}}),define("objects.utils/event-utils",["qvangular","touche"],function(a){"use strict";function b(a,b){a.gestures.forEach(function(c){c!==b&&a.cancelGesture(c)})}function c(a){var b=0,c=0,d=0,e=60;return a.wheelDelta&&(b=a.wheelDelta/e),a.detail&&(b=-a.detail/3),d=b,void 0!==a.axis&&a.axis===a.HORIZONTAL_AXIS&&(d=0,c=-1*b),void 0!==a.wheelDeltaY&&(d=a.wheelDeltaY/e),void 0!==a.wheelDeltaX&&(c=-1*a.wheelDeltaX/e),{delta:b,deltaX:c,deltaY:d,x:a.pageX,y:a.pageY}}function d(a,b,c){var d,e;return function(){var f=c||this,g=+new Date,h=arguments;d&&g<d+b?(clearTimeout(e),e=setTimeout(function(){d=g,a.apply(f,h)},b)):(d=g,a.apply(f,h))}}function e(a,b,c){return function(){var d,e=this,g=arguments;c=c||i,f(c),d=setTimeout(function(){a.apply(e,g)},b),c.debounceTimer=d}}function f(a){a=a||i,a.debounceTimer&&clearTimeout(a.debounceTimer),a.debounceTimer=null}function g(b){b&&(b=b.map(function(a){return a.qGroupFieldDefs?a.qGroupFieldDefs[a.qGroupPos||0]:a.qFallbackTitle}),a.$rootScope.$broadcast("locked-feedback",[b]),e(function(){a.$rootScope.$broadcast("locked-feedback",[b,!0])},100)())}var h=Touche.Gesture.augment(function(a){function b(){a.apply(this,arguments)}return this.defaults={which:2,radiusThreshold:3},this.start=function(a,b){Touche.utils.touch||Touche.utils.msPointer&&a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||this.isValidMouseButton(a,this.options.which)&&(this.initiated=!0,b.startPoint=b.points[0],this.binder.start.call(this,a,b))},this.update=function(a,b){!this.started&&b.startPoint&&b.startPoint.distanceTo(b.points[0])>=this.options.radiusThreshold?(this.started=!0,this.binder.update.call(this,a,b)):this.started&&this.binder.update.call(this,a,b)},this.end=function(a,b){this.initiated&&(this.binder.end.call(this,a,b),this.initiated=!1)},b});Touche.gestures.add("wheelswipe",h);var i={debouceTimer:null};return{getMouseWheelData:c,cancelGestures:b,throttle:d,debounce:e,cancelDebounce:f,showLockedFeedback:g}}),define("objects.views/selections/interaction-handler",["jquery","core.utils/class","core.utils/notification","objects.utils/event-utils"],function(a,b,c){function d(a){return s+"."+a}function e(a,b){return a.priority-b.priority}function f(a,b){return a.filter(function(a){return a.target===b.target&&a.container===b.container}).length?null:(b.priority=isNaN(b.priority)?0:b.priority,a.push(b),a.sort(e),b)}function g(a,b){var c=a.indexOf(b);c!==-1&&a.splice(c,1)}function h(a,b,c){return a.filter(function(a){return a[c]===b})}function i(a,b,c){for(var d,e=a.gesture,f=a.action,g=a.item.targets,h=0;h<g.length&&(d=g[h].target,d[e][f]&&d[e][f].apply(this,[b,c,g[h].data]),!d.exclusive());h++);}function j(a,b,c){for(var d,e=a.gesture,f=a.item.targets,g=0;g<f.length&&(d=f[g].target,d[e].apply(this,[b,c,f[g].data]),!d.exclusive||!d.exclusive());g++);}function k(a,b){a.handlers.start=function(c,d){i.apply(this,[{gesture:b,action:"start",item:a},c,d])},a.handlers.end=function(c,d){i.apply(this,[{gesture:b,action:"end",item:a},c,d])},["swipe","swipetwo","wheelswipe","rotate"].contains(b)&&(a.handlers.update=function(c,d){i.apply(this,[{gesture:b,action:"update",item:a},c,d])},a.handlers.cancel=function(c,d){i.apply(this,[{gesture:b,action:"cancel",item:a},c,d])})}function l(a,b,c){var e={id:d(b),options:{preventDefault:c}};switch(Object.keys(a.handlers).forEach(function(b){e[b]=a.handlers[b]}),b){case"swipe":e.options.useMomentum=!0,e.options.inertia=.5;case"tap":e.options.touches=1;break;case"swipetwo":e.options.useMomentum=!0,e.options.inertia=.5;case"taptwo":e.options.touches=2;break;case"tapthree":e.options.touches=3;break;case"wheelswipe":case"rotate":}return e}function m(a){switch(a){case"taptwo":case"tapthree":return"tap";case"swipetwo":return"swipe";case"tap":case"swipe":case"wheelswipe":case"rotate":default:return a}}function n(a,b,c){var d=t[c].containers.filter(function(b){return b.container===a.container})[0];return d||(d={container:a.container,targets:[],handlers:{}},k(d,c),d.unbind=Touche(a.container)[m(c)](l(d,c,b)),t[c].containers.push(d)),f(d.targets,a),d}function o(b,c){var d=u[c].containers.filter(function(a){return a.container===b.container})[0];return d||(d={container:b.container,targets:[],handler:null},d.handler=function(a){j.apply(this,[{gesture:c,item:d},a])},a(b.container).on(c+"."+s+("mousewheel"===c?" DOMMouseScroll."+s:""),d.handler)),f(d.targets,b),d}function p(a){switch(a){case"tap":case"swipe":case"taptwo":case"swipetwo":case"wheelswipe":case"tapthree":case"rotate":return"touche";case"mousemove":case"mouseleave":case"mousewheel":case"mouseup":return"jquery"}}var q=a(document),r=[],s="chart-interaction",t={tap:{containers:[]},taptwo:{containers:[]},tapthree:{containers:[]},swipe:{containers:[]},swipetwo:{containers:[]},wheelswipe:{containers:[]},rotate:{containers:[]}},u={mousemove:{containers:[]},mouseleave:{containers:[]},mousewheel:{containers:[]},mouseup:{containers:[]}},v=b.extend({init:function(){c.mixin(this),this.notification("ShiftToggle"),this.notification("KeyPressed"),this.notification("MouseUp"),this.notification("MouseLeave"),q.on("keydown."+s,function(a){16!==a.which||this.shiftPressed||(this.shiftPressed=!0,this.ShiftToggle.emit(this.shiftPressed))}.bind(this)),q.on("keyup."+s,function(a){16===a.which&&this.shiftPressed&&(this.shiftPressed=!1,this.ShiftToggle.emit(this.shiftPressed)),this.KeyPressed.emit(a.which)}.bind(this)),q.on("mouseup."+s,function(a){this.MouseUp.emit(a)}.bind(this)),q.on("mouseleave."+s,function(a){this.MouseLeave.emit(a)}.bind(this)),this.shiftPressed=!1},addInteraction:function(a,b,c,d,e,g){var h=f(r,{target:a,container:b,priority:c,types:{},data:g});if(!h)throw new Error("Duplicate add of interaction, potential leak detected.");d.forEach(function(b){if(!a[b])throw new Error("Interaction reciver does not implement the specified interaction type: "+b);switch(b){case"tap":case"taptwo":case"swipe":case"swipetwo":case"wheelswipe":case"tapthree":case"rotate":h.types[b]=n(h,e,b);break;case"mousemove":case"mouseleave":case"mousewheel":case"mouseup":h.types[b]=o(h,b);break;default:throw"The specified interaction type does not exist: "+b}})},removeInteraction:function(b,c){var e=h(r,b,"target");c&&(e=h(e,c,"container")),e&&e.length&&e.forEach(function(b){Object.keys(b.types).forEach(function(c){var e=b.types[c];g(e.targets,b),e.targets.length||("touche"===p(c)?(Touche(e.container).off("*",d(c)),g(t[c].containers,e)):a(e.container).off(c+"."+s))}),g(r,b)})},removeAllInteraction:function(){Object.keys(t).forEach(function(a){t[a].containers.forEach(function(b){Touche(b.container).off("*",d(a))}),t[a].containers=[]}),r=[]}}),w=new v;return{ShiftToggle:w.ShiftToggle,KeyPressed:w.KeyPressed,MouseUp:w.MouseUp,MouseLeave:w.MouseLeave,addInteraction:w.addInteraction,removeInteraction:w.removeInteraction,removeAllInteraction:w.removeAllInteraction,preventGestures:function(a){if(!a.gestureHandler)throw"Interaction.js, preventGestures: Called with invalid binder";Touche.preventGestures(a.gestureHandler)},_unitTestExposure:{toucheHandlers:t}}}),define("general.utils/arrow-positioner",[],function(){"use strict";function a(a){var b={left:"right",right:"left",top:"bottom",bottom:"top"};return b[a]}function b(b,c,d,e){var f=a(d),g={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},h=g[f],i=0,j=0,k=0,l=0,m=c[0].getBoundingClientRect(),n=e.outerWidth();"left"===f||"right"===f?(k=parseInt(c.offset().top+m.height*(1-h.height)-b.offset().top-n*(1-h.height),10),"left"===f?j="auto":i="auto",l="auto"):(i=parseInt(c.offset().left+m.width*(1-h.width)-b.offset().left-n*(1-h.width),10),"bottom"===f?k="auto":l="auto",j="auto"),e.css({left:i,right:j,top:k,bottom:l})}function c(b,c,d,f,g){var h,i,j=a(f),k={left:{width:0,height:.5,size:-1.5},right:{width:1,height:.5,size:.5},top:{width:.5,height:0,size:-1},bottom:{width:.5,height:1,size:1}},l=k[j],m=b.outerWidth(),n=b.outerHeight(),o=g.outerWidth(),p=g.outerHeight();"left"===j||"right"===j?(h=l.width*(m-p)+p*l.size,i=d-b.offset().top-p*(1-l.height)):(h=c-b.offset().left-o*(1-l.width),i=l.height*(n-p)+p*l.size),g.css({left:e(h),top:e(i)})}function d(b,c,d){var e,f,g=a(c),h={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},i=h[g],j=b.outerWidth(),k=b.outerHeight(),l=d.outerWidth(),m=d.outerHeight();"left"===g||"right"===g?(e=i.width*(j-m),f=d.offset().top-l*(1-i.height)):(e=j*(1-i.width)-l*(1-i.width),f=i.height*(k-m)+m),d.css({left:e,top:f})}var e=Math.floor;return{align:b,alignToParent:d,alignToCoordinate:c}}),define("general.utils/window-positioner",["jquery","general.utils/shapes/rect"],function(a,b){"use strict";function c(c,d){var e,f,g=a("body").outerHeight();return e=d.y+d.height/2-c.height/2,e=e<0?0:e,g-e-c.height<0&&(e=g-c.height),f=d.x+d.width,new b(f,e,c.width,c.height)}function d(c,d){var e,f,g=a("body").outerWidth();return f=d.x+d.width/2-c.width/2,f=f<0?0:f,g-f-c.width<0&&(f=g-c.width),e=d.y+d.height,new b(f,e,c.width,c.height)}function e(c,d){var e,f,g=a("body").outerHeight();return e=d.y+d.height/2-c.height/2,e=e<0?0:e,g-e-c.height<0&&(e=g-c.height),f=d.x-c.width,new b(f,e,c.width,c.height)}function f(c,d){var e,f,g=a("body").outerWidth();return f=d.x+d.width/2-c.width/2,f=f<0?0:f,g-f-c.width<0&&(f=g-c.width),e=d.y-c.height,new b(f,e,c.width,c.height)}function g(a){var c=a[0]===window?{left:0,top:0,width:a.outerWidth(),height:a.outerHeight()}:a[0].getBoundingClientRect();return new b(c.left,c.top,c.width,c.height)}function h(a,b,g){var h,i={top:f,right:c,bottom:d,left:e};return h=i[g]||c,h.call({},a,b)}function i(a){var b="bottom,bottomLeft,bottomRight,centerLeft,center,centerRight,topLeft,top,topRight,topLeft,left,right".split(",");if(b.indexOf(a)===-1)throw new Error("Not a valid docking position. Try "+b.join(" ,")+".")}function j(a,b,c){return"right"===a?b.getRight()-c.getRight():"left"===a?c.x-b.x:"top"===a?c.y-b.y:"bottom"===a?b.getBottom()-c.getBottom():0}function k(a){var b={top:"bottom",right:"left",bottom:"top",left:"right"};return b[a]}function l(a){return"flip"===a||"flipfit"===a}function m(a){return"fit"===a||"flipfit"===a}function n(a){var b={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"};return b[a]}function o(a){var b={vertical:["top","bottom"],horizontal:["left","right"]};return b[a]}function p(a){var b={horizontal:"vertical",vertical:"horizontal"};return b[a]}function q(a){var b=a.collision.split(" "),c={horizontal:b[0],vertical:b[1]||b[0]},d=n(a.position),e=p(d);return{flipPrimary:l(c[d]),fitPrimary:m(c[d]),fitSecondary:m(c[e])}}function r(a,b,c){var d,e;for(d=0;d<b.length;d++){if(e=b[d],"left"===e&&a.x<c.x){a.x=c.x;break}if("right"===e&&a.getRight()>c.getRight()){a.x=c.getRight()-a.width;break}if("top"===e&&a.y<c.y){a.y=c.y;break}if("bottom"===e&&a.getBottom()>c.getBottom()){a.y=c.getBottom()-a.height;break}}return a}function s(a,b,c,d,e,f){if(!c)return a.map(function(a,c){var d=b[c]||b[0];return{align:a,x:d.x,y:d.y}});var g=b[0].x,h=b[0].y,i=function(a){var b,c,f,i,j=a?a.length/2:0,k=new Array(j);for(b=0;b<j;b++)c=a[2*b+1],f=c*g+(1-c)*d,i=c*h+(1-c)*e,k[b]={align:a[2*b],x:f,y:i};return k},j=a[0]+(a[1]?"-"+a[1]:""),k=1,l=.7,m=.5,n=f>.5?0:.5-f,o=f>.5?.5:.7-.4*f;switch(j){case"top":return i(g>=d?["top",k,"top",l,"top",m,"right",l,"right",m,"left",m,"left",l,"bottom",n,"bottom",o]:["top",k,"top",l,"top",m,"left",l,"left",m,"right",m,"right",l,"bottom",n,"bottom",o]);case"top-right":return i(["top",k,"top",l,"top",m,"right",l,"right",m,"left",m,"left",l,"bottom",n,"bottom",o]);case"top-left":return i(["top",k,"top",l,"top",m,"left",l,"left",m,"right",m,"right",l,"bottom",n,"bottom",o]);case"bottom":return i(g>=d?["bottom",k,"bottom",l,"bottom",m,"right",l,"right",m,"left",m,"left",l,"top",n,"top",o]:["bottom",k,"bottom",l,"bottom",m,"left",l,"left",m,"right",m,"right",l,"top",n,"top",o]);case"bottom-right":return i(["bottom",k,"bottom",l,"bottom",m,"right",l,"right",m,"left",m,"left",l,"top",n,"top",o]);case"bottom-left":return i(["bottom",k,"bottom",l,"bottom",m,"left",l,"left",m,"right",m,"right",l,"top",n,"top",o]);case"left":return i(h<=e?["left",k,"left",l,"left",m,"top",l,"top",m,"bottom",m,"bottom",l,"right",m,"right",l]:["left",k,"left",l,"left",m,"bottom",l,"bottom",m,"top",m,"top",l,"right",m,"right",l]);case"left-top":return i(["left",k,"left",l,"left",m,"top",l,"top",m,"bottom",m,"bottom",l,"right",m,"right",l]);case"left-bottom":return i(["left",k,"left",l,"left",m,"bottom",l,"bottom",m,"top",m,"top",l,"right",m,"right",l]);case"right":return i(h<=e?["right",k,"right",l,"right",m,"top",l,"top",m,"bottom",m,"bottom",l,"left",m,"left",l]:["right",k,"right",l,"right",m,"bottom",l,"bottom",m,"top",m,"top",l,"left",m,"left",l]);case"right-top":return i(["right",k,"right",l,"right",m,"top",l,"top",m,"bottom",m,"bottom",l,"left",m,"left",l]);case"right-bottom":return i(["right",k,"right",l,"right",m,"bottom",l,"bottom",m,"top",m,"top",l,"left",m,"left",l])}}var t={align:function(b,c,d){if(d=d||{position:"right",collision:"none"},d.position=d.position||"right",d.collision=d.collision||"none",b&&c){var e,f=g(a(window)),i=g(b),l=g(c),m=q(d),s=h(i,l,d.position);e=function(a){var b=h(i,l,k(d.position)),c=j(d.position,a,f),e=j(k(d.position),b,f);return e<c},m.flipPrimary&&j(d.position,s,f)>0&&e(s)&&(s=h(i,l,k(d.position)),d.position=k(d.position)),m.fitPrimary&&(s=r(s,[d.position],f)),m.fitSecondary&&(s=r(s,o(p(n(d.position))),f)),d.limits&&s.y<d.limits.top&&(s.y=d.limits.top),b.offset({top:s.y,left:s.x})}return d.position},alignToCoordinate:function(b,c,d,e,f){i(e);var g,h;e=e||"top",g=function(a,c,d){var e=c,f=d;switch(a){case"topRight":f=d-b.outerHeight();break;case"top":e=c-b.outerWidth()/2,f=d-b.outerHeight();break;case"topLeft":e=c-b.outerWidth(),f=d-b.outerHeight();break;case"right":case"centerRight":f=d-b.outerHeight()/2;break;case"center":e=c-b.outerWidth()/2,f=d-b.outerHeight()/2;break;case"left":case"centerLeft":e=c-b.outerWidth(),f=d-b.outerHeight()/2;break;case"bottom":e=c-b.outerWidth()/2;break;case"bottomLeft":e=c-b.outerWidth();break;case"bottomRight":e=c,f=d}return{x:e,y:f}},h=g(e,c,d);var j,k,l,m,n={},o={};j=a(window),k=10,o.x=j.outerWidth()-b.outerWidth()-k,n.x=k,o.y=j.outerHeight()-b.outerHeight()-k,n.y=k;var p=function(a,b){return b[a]>o[a]?b[a]-o[a]:b[a]<n[a]?n[a]-b[a]:0};if(f){l=p("x",h),m=p("y",h);var q=g(f,c,d);(l>p("x",q)||m>p("y",q))&&(h=q,e=f)}return h.x=Math.max(n.x,Math.min(o.x,h.x)),h.y=Math.max(n.y,Math.min(o.y,h.y)),b.offset({left:h.x,top:h.y}),e},alignToBestCoordinate:function(b,c,d,e,f,g,h){i(d[0]),c=c instanceof Array?c:[c];var j=c[0].x,k=c[0].y;b.offset({left:0,top:0}),b.width("auto"),b.height("auto");var l=a(window),m=l.outerWidth(),n=l.outerHeight(),o=b.outerWidth(),p=b.outerHeight(),q={},r={};h=void 0===h?5:h;var t=(void 0===g?5:g)+h;r.x=m-o-t,q.x=t,r.y=n-p-t,q.y=t,m<o+2*t&&(o=m-2*t,b.width(o),r.x=q.x),n<p+2*t&&(p=n-2*t,b.height(p),r.y=q.y),d=d||["top"];var u,v,w,x,y,z,A,B,C,D,E,F=function(a,b,c){var d=b,e=c;switch(a){case"topRight":e=c-p;break;case"top":d=b-o/2,e=c-p;break;case"topLeft":d=b-o,e=c-p;break;case"right":case"centerRight":e=c-p/2;break;case"center":d=b-o/2,e=c-p/2;break;case"left":case"centerLeft":d=b-o,e=c-p/2;break;case"bottom":d=b-o/2;break;case"bottomLeft":d=b-o;break;case"bottomRight":d=b,e=c}return{x:d,y:e}},G=function(a,b){return b[a]>r[a]?b[a]-r[a]:b[a]<q[a]?b[a]-q[a]:0},H=j,I=k;f&&(x=e.shape.cx+e.targetToPageTranslation.x,y=e.shape.cy+e.targetToPageTranslation.y,z=e.shape.innerRadius,A=e.shape.radius,B=0,z>0&&(B=z/A,x+=B*(j-x),y+=B*(k-y))),E=s(d,c,f,x,y,B);var J=function(){for(u=0;u<E.length;u++)if(v=E[u].align,H=E[u].x,I=E[u].y,w=F(v,H,I),C=G("x",w),D=G("y",w),0===C&&0===D||(0!==D||"top"!==v&&"bottom"!==v?0!==C||"left"!==v&&"right"!==v||(w.y-=D,D=0):(w.x-=C,C=0)),0===C&&0===D)return;0===C&&0===D||(v=E[0].align,H=E[0].x,I=E[0].y,w=F(v,H,I),C=G("x",w),D=G("y",w),w.x-=C,w.y-=D)};return J(),w&&b.offset({left:w.x,top:w.y}),{position:v,x:H,y:I}}};return t}),define("pubsub",[],function(){function a(){this.topics={},this.wildcards=[]}return a.prototype.getTopics=function(a,b){var c=this.topics[a];return"undefined"==typeof c&&b&&(c=this.topics[a]=[]),c},a.prototype.createMatcher=function(a){return a=a.replace(/\$/g,"\\$"),new RegExp("^"+a.replace(/\*/g,".+?")+"$","i")},a.prototype.subscribe=function(a,b,c){if(a=a.toLowerCase().split("."),"function"!=typeof b)throw"pubsub: Invalid handler";var d={handler:b,topic:a[0],namespace:a[1],context:c||window};a[0].indexOf("*")>-1?(d.matcher=this.createMatcher(a[0]),this.wildcards.push(d)):this.getTopics(a[0],!0).push(d)},a.prototype.subscribeOnce=function(a,b,c){function d(){b.apply(this,arguments),e.unsubscribe(a,b)}var e=this;d.original=b,this.subscribe(a,d,c)},a.prototype.unsubscribe=function(a,b){a=a.toLowerCase(),this["."===a[0]?"unsubscribeNamespace":"unsubscribeTopic"](a,b)},a.prototype.unsubscribeNamespace=function(a){function b(b){return b.namespace!==a}a=a.substr(1);var c;this.wildcards=this.wildcards.filter(b);
for(c in this.topics)this.topics[c]=this.topics[c].filter(b),this.topics[c].length||delete this.topics[c]},a.prototype.unsubscribeTopic=function(a,b){function c(c){var d=c.topic!==a[0];return!d&&b&&(d=c.handler.original?c.handler.original!==b:c.handler!==b),d}a=a.split(".");var d=this.getTopics(a[0]);this.wildcards=this.wildcards.filter(c),d&&(d=this.topics[a[0]]=d.filter(c),d.length||delete this.topics[a[0]])},a.prototype.publish=function(a,b){function c(c){(!c.matcher||c.matcher&&c.matcher.test(a[0]))&&c.handler.call(c.context,b,a[0])}a=a.toLowerCase().split(".");var d=this.getTopics(a[0]);this.wildcards.forEach(c),d&&d.forEach(c)},window.pubsub=new a,window.pubsub}),define("general.utils/android-keyboard-fix",[],function(){"use strict";function a(a,b,c){this.lastHeight=null,this.document=c||document,this.window=b||window,this.viewport=a||this.document.querySelector("meta[name=viewport]"),this.viewportContent=this.viewport.getAttribute("content"),this.updateHeight()}return a.prototype.clearHeight=function(){this.viewport.setAttribute("content",this.viewportContent)},a.prototype.setHeight=function(a){this.viewport.setAttribute("content",this.viewportContent+", height="+a)},a.prototype.updateHeight=function(){var a=this.window.innerHeight;return this.lastHeight!==a&&(this.lastHeight=a,this.setHeight(a),!0)},a.prototype.rotate=function(a){var b=function(){this.updateHeight()&&a()}.bind(this);this.document.activeElement&&this.document.activeElement.blur(),this.clearHeight(),this.window.setTimeout(b,500),this.window.setTimeout(b,1e3),this.window.setTimeout(b,1500)},a.isNeeded=function(){var a=navigator.userAgent.toLowerCase().indexOf("android")>-1;return a},a}),define("core.utils/resize",["touche","pubsub","general.utils/android-keyboard-fix"],function(a,b,c){function d(a){k=!0,f("/resize/start",a)}function e(a){f("/resize/end",a),k=!1}function f(a,c){b.publish(a,{width:window.innerWidth,height:window.innerHeight,element:c.target})}function g(a){a.target!==window&&a.target!==document||(k||d(a),clearTimeout(i),f("/resize/update",a),i=setTimeout(function(){e(a)},j))}function h(a){l?l.rotate(function(){d(a),e(a)}):(d(a),e(a))}var i,j=250,k=!1,l=c.isNeeded()?new c:null;return a.utils.touch&&"ondeviceorientation"in window&&window.addEventListener("orientationchange",h,!1),l||window.addEventListener("resize",g,!1),{on:function(a,c){b.subscribe("/resize/"+a,c)},off:function(a,c){b.unsubscribe("/resize/"+a,c)},force:function(a){a=a||"end",b.publish("/resize/"+a)}}}),define("text!objects.views/charts/tooltip/chart-tooltip.ng.html",[],function(){return'<div ng-switch on="template">\n\t<div qva-direction x-dir-setting={{options.direction}}" ng-switch-when="generic" class="qv-tooltip qvt-generic-tooltip" ng-class="{\'above\':alwaysOnTop}">\n\t\t<div ng-repeat="item in content">\n\t\t\t<div qva-direction x-dir-text="{{item.header}}" x-dir-setting="{{options.direction}}" class="header">\n\t\t\t\t<strong>{{item.header}}</strong>\n\t\t\t</div>\n\t\t\t<table>\n\t\t\t\t<tr ng-repeat="row in item.rows" class="row">\n\t\t\t\t\t<td class=\'item\'>\n\t\t\t\t\t\t<div qva-direction x-dir-text="{{row.content}}" class="rowContent fade-out">{{row.content}}</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n\n\t<div qva-direction x-dir-setting="{{options.direction}}" ng-switch-default class="qv-tooltip qvt-chart-tooltip" qva-press="hideTooltip($event)" tid="qv-chart-tooltip" ng-class="{\'above\':alwaysOnTop}">\n\t\t<div class="immidiate-contextual-arrow"></div>\n\t\t<div class="qv-chart-tooltip-inner">\n\t\t\t<div ng-repeat="item in content">\n\t\t\t\t<div class="qv-chart-tooltip-content">\n\t\t\t\t\t<div qva-direction x-dir-text="{{item.header}}" x-dir-setting="{{options.direction}}" class=\'header\' ng-if="item.header !== undefined">\n\t\t\t\t\t\t<strong>{{item.header}}</strong>\n\t\t\t\t\t</div>\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr ng-repeat="row in item.rows" class="row">\n\t\t\t\t\t\t\t<td class=\'item\'>\n\t\t\t\t\t\t\t\t<span qva-direction x-dir-text="{{row.label}}" class="rowPart" ng-class="{\'single\' : (content.length + item.rows.length) <= 3}">{{row.label}}</span>\n\t\t\t\t\t\t\t\t<span>:&nbsp;</span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td ng-if="!row.template" class=\'value\'>\n\t\t\t\t\t\t\t\t<div class="rowPart" dir="ltr">{{row.value}}</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td ng-if="row.template" class=\'template value\' ng-bind-html="row.template">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="qv-chart-tooltip-excess" ng-if="numberInExcess > 0" q-translation="Object.ChartTooltip.NMore,{{numberInExcess}}"></div>\n\t</div>\n</div>'}),define("objects.views/charts/tooltip/chart-tooltip-directive",["jquery","touche","qvangular","general.utils/arrow-positioner","general.utils/window-positioner","core.utils/resize","text!./chart-tooltip.ng.html"],function(a,b,c,d,e,f,g){var h=5,i=5,j=25;c.directive("qvaChartTooltip",function(){return{template:g,replace:!0,scope:{content:"=",position:"=",visible:"=",direction:"=",template:"=",numberInExcess:"=",target:"=",hideCallback:"=",alwaysOnTop:"=",options:"="},link:function(g,k){var l,m,n=!1;l=function(a){var b=a?"block":"none";k.css("display",b)},g.synchronAlign=function(){var b,c=k.find(".qv-tooltip"),f=k.find(".immidiate-contextual-arrow");l(g.visible);var m=g.direction instanceof Array?g.direction:[g.direction];b=e.alignToBestCoordinate(c,g.position,m,g.target,!1,h,i);var o=c.offset(),p=a(window),q=p.outerWidth(),r=p.outerHeight();switch(b.position){case"right":o.left+=9,b.y=Math.min(r-j,Math.max(j,b.y));break;case"left":o.left-=9,b.y=Math.min(r-j,Math.max(j,b.y));break;case"bottom":o.top+=9,b.x=Math.min(q-j,Math.max(j,b.x));break;default:o.top-=9,b.x=Math.min(q-j,Math.max(j,b.x))}c.offset(o),f.removeClass().addClass("immidiate-contextual-arrow").addClass(b.position),d.alignToCoordinate(c,b.x,b.y,b.position,f),n=!1},g.align=function(){m=c.getService("$timeout")(g.synchronAlign)},g.$watch("position",function(a){a&&(a instanceof Array||a.x&&a.y)&&(n=!0,g.align())}),g.$watch("visible",function(a){n||l(a)}),g.$watch("content",function(a){a||(g.visible=!1)}),g.hideTooltip=function(a){g.visible=!1,g.hideCallback&&g.hideCallback(),a&&a.stopPropagation&&(a.stopPropagation(),a.preventDefault(),b.preventGestures())},g.$on("$destroy",function(){c.getService("$timeout").cancel(m),f.off("end",g.hideTooltip)}),f.on("end",g.hideTooltip)}}})}),define("objects.views/charts/tooltip/chart-tooltip-component",["./chart-tooltip-directive"],function(){var a;return a={transclude:!0,template:'<div qva-chart-tooltip position="position" content="content" direction="direction" visible="visible" template="template" number-in-excess="numberInExcess" target="target" hide-callback="hideCallback" always-on-top="alwaysOnTop" options="options"></div>',controller:["$scope",function(a){a.visible=!1,this.hide=function(){a.visible=!1},this.show=function(b){a.content=b.content,a.position=b.position,a.direction=b.direction,a.template=b.template,a.numberInExcess=b.numberInExcess,a.alwaysOnTop=b.alwaysOnTop,a.visible=!0,a.hideCallback=b.hideCallback,a.target=b.target,a.options={direction:b.dir}}}]}}),define("objects.views/charts/tooltip/chart-tooltip-service",["qvangular","core.utils/notification","./chart-tooltip-component","angular"],function(a,b,c){"use strict";a.service("qvChartTooltipService",["$document","$timeout",function(a,d){function e(){d.cancel(i),i=null,d.cancel(h),h=null}var f,g,h,i,j=a.find("body"),k=angular.element('<div id="qs-chart-tooltip">').appendTo(j),l=!1;return f={open:function(a,b,j){if(l&&g&&g.hide(),e(),!g){var m=a.position;a.position=void 0,g=k.showComponent(c,a),a.position=m}k.attr("dir",a.dir),h=d(function(){b&&(i=d(function(){f.close()},b)),l=!0,g.show(a)},j)},close:function(){this.Closed.emit(),g&&d(function(){g.hide()}),e()},destroy:function(){l&&g&&g.hide(),g=null}},b.create(f,"Closed"),f}])}),define("objects.views/charts/tooltip/chart-tooltip",["jquery","qvangular","general.utils/support","general.utils/shapes/rect","general.utils/shapes/point","objects.views/selections/cache-consumer","objects.views/selections/interaction-type","objects.views/selections/interaction-handler","objects.views/charts/tooltip/chart-tooltip-service"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){var b=a.getBoundingRect();return isNaN(b.x+b.y+b.width+b.height)}function j(a){return a.getDimensions().join(", ")}function k(a){return a.id+(a.parent?"-"+a.parent.id:"")}function l(){A&&(A=null,B=null),z=null}function m(a,b,c,e){if(c){var f=new d(0,0,c.rect.width,c.rect.height);a=a.intersection(f)}return{positions:[b(a.x+a.width/2,a.y,c,e),b(a.x+a.width,a.y+a.height/2,c,e),b(a.x,a.y+a.height/2,c,e),b(a.x+a.width/2,a.y+a.height,c,e)],directions:["top","right","left","bottom"]}}function n(a,b){var c,d,e,f,g,h,j,k=[],l={positions:null,directions:null,target:null,component:null};return this._positionAtMouse||1!==this._cssTransform.scale?(c=b||a[0].interactPosition,c&&(d=this.getTransformedPoint(c.x,c.y,this.containerRect),f=a[0].getShapes(),k=f.filter(function(a){return a.pointInside(d.x,d.y)}),l.target=k.length?k[0]:f[0],l.directions=["top","right","left","bottom"],l.positions=[c])):(a.forEach(function(a){var c=null,h=null;f=a.getShapes(),a.calculateTooltipPosition&&a.tooltipShape?(h=this.components[a.tooltipShapeComponent]?this.components[a.tooltipShapeComponent][0]:void 0,e=a.getShapeBounds(a.tooltipShapeComponent,h?h.chartScale||1:1),e&&(l.target=k.length?k[0]:f[0],l.component=h)):(a.tooltipShape&&!i(a.tooltipShape)?(k=[a.tooltipShape],l.component=this.components[a.tooltipShapeComponent]?this.components[a.tooltipShapeComponent][0]:void 0):b&&(d=this.getTransformedPoint(b.x,b.y,this.containerRect),k=f.filter(function(a){return a.pointInside(d.x,d.y)})),l.target=k.length?k[0]:f[0],l.target&&(l.target.getRelevantPosition?c=l.target.getRelevantPosition():(e=l.target.getBoundingRect(),!l.target.clearModelView&&l.component&&(j=l.component.chartScale||1,e=e.clone(),e.set(e.x*j,e.y*j,e.width*j,e.height*j))))),c?(l.positions=[this.getPagePoint(c.pos.x,c.pos.y,l.component,this.containerRect)],l.directions=c.direction):g=g?e.combineWith(g):e},this),g&&(h=m(g,this.getPagePoint.bind(this),l.component,this.containerRect),l.positions=h.positions,l.directions=h.directions)),l}function o(a,b){var c,d,e,f,g,h,i=[],j=0,k=this.measureFormatters||[];if(a.isCacheItem)for(g=a.getMeasures(),h=a.getMeasuresIndecies(b),d=h.length,j;j<d;++j){var l=h[j];e=a.getValue(l),f=a.getPreformattedLabel(l),k[h[j]]&&(e="U"!==k[l].type&&f?f:k[l].format(e)),g[l]&&void 0!==e&&i.push({label:g[l],value:e})}else for(d=a.node.children.length,j;j<d;++j)e=a.node.children[j].children[0].data.qNum||a.node.children[j].children[0].data.qValue,f=a.node.children[j].children[0].data.qText,k[j]&&(e="U"!==k[j].type&&f?f:k[j].format(e)),i.push({label:a.node.children[j].data.qText,value:e});if(this.colorMap&&(c=this.colorMap.getTooltipContent(a))){if("measure"===this.colorMap.getColorDataInfo().internalMode){var m=i.filter(function(a){return a.label===c.label});1===m.length&&i.splice(i.indexOf(m[0]),1)}i.push(c)}return i}function p(a,b){for(var c=[],d=0,e=0;d<C&&e<a.length;)c.push({header:j(a[e]),rows:o.call(this,a[e],b)}),d+=c[e].rows.length+1,e++;return a.length>e&&(c.numberInExcess=a.length-e),c}function q(a,c,d,e){var f=n.call(this,a,c);if(f.positions&&f.directions){var g=this.getPagePoint(0,0,f.component,this.containerRect),h=p.call(this,a,f.target);b.getService("qvChartTooltipService").open({target:{shape:f.target,targetToPageTranslation:g},position:f.positions,content:h,direction:f.directions,numberInExcess:h.numberInExcess,hideCallback:l.bind(this),dir:this.yMirrorMode?"rtl":"ltr"},d,e),A=a[0],B=a.map(k).join("")}}function r(a){var b=this.getTransformedPoint(a.x,a.y,this.containerRect);return this.shapesFrom.shapesFromPoints([b])}function s(a){var b=r.call(this,a);return b.map(k).join("")}function t(a){var c=this;this.setActiveComponent(this.getComponent(a.x,a.y,this.containerRect));var d=r.call(c,a);d&&d.length&&this.activeComponent&&(c._positionAtMouse="MapArea"===c.activeComponent.className||1!==c._cssTransform.scale,z=b.getService("$timeout")(function(){q.call(c,d,a,c._duration),z=null},D))}function u(a,b){var c=this;a&&a.length&&this.activeComponent&&(c._positionAtMouse="MapArea"===c.activeComponent.className||1!==c._cssTransform.scale,q.call(c,a,null,2e4,b))}function v(){b.getService("$timeout").cancel(z),z=null,this.prevPoint=null}function w(){A&&(A=null,B=null,b.getService("qvChartTooltipService").close()),z=null}function x(a,b){var c,d,e=b?b.length:0;for(c=0;c<e;c++)if(d=b[c],d&&d.pointInside&&d.pointInside(a.x,a.y))return!0;return!1}function y(a){var b,c,d,e=a?a.length:0,f=[];for(b=0;b<e;b++)c=a[b]._shapes,d||(d=a[b]._interactPosition,d&&(d=this.getTransformedPoint(d.x,d.y,this.containerRect))),d&&x(d,c)&&(f[f.length]=a[b]);return f.length||(f=a),f}var z,A,B,C=7,D=500,E=7e3,F=f.extend("ChartTooltip",{init:function(a,b,c){this._super(c,b),this.cache=c,A=null,z=null,this.container=a,this.containerRect=new d(0,0,0,0),this._positionAtMouse=!0,this.enabled=!0,this._allowNullSelect=!0,this.touchTimeout=isNaN(b.touchTimeout)?10:b.touchTimeout,this._duration=E},refreshContainerRect:function(){var a=this.offset=this.container.offset(),b=this.container.width(),c=this.container.height();this.containerRect.set(a.left,a.top,b,c)},on:function(){function a(a){c.treatAsDesktop()?h.addInteraction(b._interactionEvents,a.container,0,["mousemove","mouseleave","swipe","mousewheel"]):h.addInteraction(b._interactionEvents,a.container,0,["swipe","swipetwo","rotate","tap"])}if(!this._isListening){this._isListening=!0;var b=this;this._interactionEvents=g.extend({mousemove:function(a){var c=new e(a.pageX,a.pageY);b.refreshContainerRect(),b.move(a,c)},mouseleave:function(a){b.leave(a)},mousewheel:function(){b.cancel()},swipe:{start:function(){b.cancel()},cancel:function(){b.cancel()}},swipetwo:{start:function(){b.cancel()},cancel:function(){b.cancel()}},rotate:{start:function(){b.cancel()},cancel:function(){b.cancel()}},tap:{end:function(a,c){var d=c.pagePoints[0];b.refreshContainerRect(),b.setActiveComponent(b.getComponent(d.x,d.y,b.containerRect));var e=r.call(b,d);e.forEach(function(a){a.interactPosition=d}),b.updateHighlightedShape(e)}}}),c.treatAsDesktop()&&h.MouseLeave.bind(b._interactionEvents.mouseleave),this.registerAddedComponent=function(b){a(b)},this.deregisterAddedComponent=function(a){h.removeInteraction(b._interactionEvents,a.container)},Object.keys(this.components).map(function(a){return b.components[a]}).forEach(function(a){a.forEach(function(a){b.registerAddedComponent(a)})})}},register:function(a,b){this.registerAddedComponent&&this.registerAddedComponent(b)},deregister:function(a,b){this.deregisterAddedComponent&&this.deregisterAddedComponent(b)},off:function(){this._isListening=!1,h.MouseLeave.unbind(this._onMouseLeave),h.removeInteraction(this._interactionEvents),this.registerAddedComponent=null,this.deregisterAddedComponent=null},initComponent:function(a){this.setActiveComponent(this.getComponent(a.x,a.y,this.containerRect))},updateHighlightedShape:function(a,b){if(a.length>=1){var d,e=!0,f=!1;if(d=y.call(this,a),!d||!d.length)return;c.treatAsDesktop()||(d=d.filter(function(a){return!a.selected}),d.length&&(A||z?(d.length>1||d[0]!==A)&&(e=!1,f=!0):(e=!1,f=!0)),e&&(v.call(this),w.call(this)),f&&u.call(this,d,this.touchTimeout))}else!c.treatAsDesktop()&&b&&(v.call(this),w.call(this))},getRect:function(a){return a?a.hasOwnProperty("innerRect")?a.innerRect:a.rect:new d(0,0,0,0)},move:function(a,b){c.treatAsDesktop()&&this.enabled&&(null!==z?(!this.prevPoint||b.distanceTo(this.prevPoint)>5)&&(v.call(this),t.call(this,b)):(this.prevPoint=b,A?s.call(this,b)!==B&&(w.call(this),t.call(this,b)):t.call(this,b)))},setCssTransform:function(a){this._cssTransform=a||{scale:1}},leave:function(b){var c=b.toElement||b.relatedTarget;a(c).hasClass("qvt-chart-tooltip")||a(c).parents(".qvt-chart-tooltip").length||(v.call(this),w.call(this))},cancel:function(){v.call(this),w.call(this)},clearSelection:function(){v.call(this),w.call(this)},release:function(){this._super(),this.off()}});return F}),define("objects.views/selections/cache-item-base",["core.utils/class"],function(a){"use strict";function b(a){var b=a.getBoundingRect();return isNaN(b.x+b.y+b.width+b.height)}var c=a.extend({init:function(a,b,c,d,e,f,g){if(a&&!(a instanceof Array)||b&&!(b instanceof Array)||c&&!(b instanceof Array)||d&&!(c instanceof Array))throw"The dimensions, measures and values input must be undefined or arrays";this.selected=!1,this.highlighted=!1,this.values=c||[],this.labels=d||[],this.row=e,this.col=f,this.id=g,this.parent=void 0,this.children=[],this._dimensions=a||[],this._measures=b||[],this._attrDims=[],this._attrDimTypes=[],this._objectShapes={},this._shapes=[],this._tooltipShape=void 0,this._tooltipShapeComponent=void 0},get siblings(){return this._parent?this._parent.children:[]},clearShapes:function(a){a&&this._objectShapes[a]&&(this._objectShapes[a]=[]),this._shapes=[];for(var b in this._objectShapes)this._shapes=this._shapes.concat(this._objectShapes[b])},getShapes:function(a){return a?this._objectShapes[a]||(this._objectShapes[a]=[]):this._shapes},getShapeBounds:function(a,c){if(this._calculateTooltipPosition&&a){var d=this.getShapes(a),e=d.map(function(a){var b=a.getBoundingRect();return a.clearModelView||(b=b.clone(),b.set(b.x*c,b.y*c,b.width*c,b.height*c)),b});if(e=e.filter(function(a){return!b(a)}),e.length){var f=e.reduce(function(a,b){return a.combineWith(b)},e[0]);return f}return null}return null},addShape:function(a,b,c){if(b instanceof Array&&(!b[0].pointInside||!b[0].getBoundingRect)||!b.pointInside||!b.getBoundingRect)throw"The shape must implement a `pointInside` function";this._objectShapes[a]instanceof Array||(this._objectShapes[a]=[]),this._objectShapes[a].push(b),this._shapes.push(b),c&&(this._tooltipShape=b,this._tooltipShapeComponent=a)},addMeasure:function(a,b,c){this.values.push(b),this.labels.push(c),this._measures.push(a)},getMeasures:function(){return this._measures},getMeasuresIndecies:function(){return this._measures.map(function(a,b){return b})},addDimension:function(a){this._dimensions.push(a)},getDimensions:function(){return this._dimensions},addAttributeDimension:function(a,b,c){this._attrDims.push({value:a,label:b,name:c})},getAttributeDimensions:function(a){return this._attrDims.length?isNaN(a)?this._attrDims.map(function(a){return a.value}):[this._attrDims[a].value]:null},getValue:function(a){return a=a||0,this.values[a]},getPreformattedLabel:function(a){return a=a||0,this.labels[a]},getCombinedElementID:function(){for(var a=this,b=[a.id];a.parent;)a=a.parent,b.push(a.id);return b.reverse(),b.join(",")}});return c.prototype.isCacheItem=!0,Object.defineProperties(c.prototype,{tooltipShape:{get:function(){return this._tooltipShape}},calculateTooltipPosition:{set:function(a){this._calculateTooltipPosition=a},get:function(){return this._calculateTooltipPosition}},interactPosition:{set:function(a){this._interactPosition=a},get:function(){return this._interactPosition}},tooltipShapeComponent:{get:function(){return this._tooltipShapeComponent}},label:{get:function(){throw new Error("CacheItem: label: Removed functionality")}},shape:{get:function(){throw new Error("CacheItem: shape: Removed functionality")}},value:{get:function(){throw new Error("CacheItem: value: Removed functionality")}}}),c}),define("objects.views/selections/cache",["./cache-item","./cache-item-base"],function(a,b){"use strict";function c(){this.data=[]}return Object.defineProperties(c.prototype,{has:{value:function(a){return this.data.indexOf(a)!==-1}},add:{value:function(c){if(!(c instanceof a||c instanceof b))throw"Invalid cache item!";this.has(c)||this.data.push(c)}},remove:{value:function(a){var b=this.data.indexOf(a);b!==-1&&this.data.splice(b,1)}},clear:{value:function(){this.data.length=0}}}),c}),define("general.utils/shapes/polygon",["general.utils/shapes/rect","general.utils/shapes/line"],function(a,b){"use strict";function c(b){var c,d,e=Number.MAX_VALUE,f=-Number.MAX_VALUE,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=b?b.length:0;if(!i)return null;for(d=0;d<i;d++)c=b[d],f=c.x>f?c.x:f,e=c.x<e?c.x:e,h=c.y>h?c.y:h,g=c.y<g?c.y:g;return new a(e,g,f-e,h-g)}function d(){this._numPoints=this.points?this.points.length:0,this._closedPolygon=this._numPoints>1&&this.points[0].x===this.points[this._numPoints-1].x&&this.points[0].y===this.points[this._numPoints-1].y,this._closedPolygon?this._numLines=this._numPoints-1:this._numLines=this._numPoints,this._pointsChanged=!0}function e(a){0===arguments.length?this.set([]):this.set(a),this._pointsChanged=!0}return e.prototype={clone:function(){var a=this.points.map(function(a){return a.clone()});return new e(a)},set:function(a){this.points=a,d.call(this)},getPoints:function(){return this.points},getNumPoints:function(){return this.points?this.points.length:0},addPoint:function(a){this.points.push(a),d.call(this)},pointInside:function(a,b){if(this.calculateBounds(),!this._bounds)return!1;if(a<this._bounds.x||a>this._bounds.x+this._bounds.width||b<this._bounds.y||b>this._bounds.y+this._bounds.height)return!1;var c,d,e,f,g;for(c=!1,f=-1,d=this.points.length,e=d-1;++f<d;e=f){if(this.points[f].x===a&&this.points[f].y===b)return!0;if(this.points[f].y===this.points[e].y&&this.points[f].y===b&&(a-this.points[f].x)*(a-this.points[e].x)<=0)return!0;if(this.points[f].y<b&&b<=this.points[e].y||this.points[e].y<b&&b<=this.points[f].y){if(g=(this.points[e].x-this.points[f].x)*(b-this.points[f].y)/(this.points[e].y-this.points[f].y)+this.points[f].x,a===g)return!0;a<g&&(c=!c)}}return c},intersectsLine:function(a){if(!a)return!1;if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var c,d;if(0===this._numPoints)return!1;if(1===this._numPoints)return!!a.intersectsLine(new b(this.points[0].x,this.points[0].y,this.points[0].x,this.points[0].y));for(d=this._numPoints-1,c=0;c<d;c++)if(a.intersectsLine(new b(this.points[c].x,this.points[c].y,this.points[c+1].x,this.points[c+1].y)))return!0;return!(this._closedPolygon||!a.intersectsLine(new b(this.points[d].x,this.points[d].y,this.points[0].x,this.points[0].y)))},intersectsLines:function(a){var b,c=a?a.length:0;for(b=0;b<c;b++)if(this.intersectsLine(a[b]))return!0;return!1},intersectsRect:function(a){if(!a)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(a.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(a))return!1;var c,d,e,f,g;return c=a.x,d=a.getRight(),e=a.y,f=a.getBottom(),!!(this.pointInside(c,e)||this.pointInside(d,e)||this.pointInside(d,f)||this.pointInside(c,f))||(g=[new b(c,e,d,e),new b(c,f,d,f),new b(c,e,c,f),new b(d,e,d,f)],this.intersectsLines(g))},calculateBounds:function(){return this._pointsChanged&&(this._bounds=c(this.points),this._pointsChanged=!1),this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="",c=this._numPoints-1;for(a=0;a<c;a++)b+=this.points[a].toString()+",";return b+=this.points[c].toString()}},e}),define("objects.views/selections/types/base",["../cache-consumer"],function(a){"use strict";var b=a.extend({init:function(a,b){this._super(a.cache,b),this._selectedShapes=[],this.handler=a,this.options=b,this.components=b.components||{}},release:function(){this._super(),this.components={},this._selectedShapes=[],this.handler=null},resetSelectedShapes:function(){this._selectedShapes.length=0},getSelectedShapes:function(){return this._selectedShapes},toggleSelectedShape:function(a){var b=this._selectedShapes.indexOf(a);b!==-1?this._selectedShapes.splice(b,1):this._selectedShapes.push(a)},setActiveMode:function(a){this._activeMode=a},getActiveMode:function(){return this._activeMode},register:function(a,b){this.handler.register(a,b)},deregister:function(a,b){this.handler.deregister(a,b)},getActiveDimensions:function(){return this.activeComponent.getSelectionIndices()},toggle:function(){},toggleRect:function(){},start:function(){},update:function(){},end:function(){},cancel:function(){},move:function(){},leave:function(){},getTransformedPoint:function(a,b){return this._super(a,b,this.handler.containerRect)},getPagePoint:function(a,b,c){return this._super(a,b,c,this.handler.containerRect)},shapeFromPoint:function(a){return this.shapesFrom.shapeFromPoint(a)},shapesFromPoints:function(a){return this.shapesFrom.shapesFromPoints(a)},shapesFromLines:function(a){return this.shapesFrom.shapesFromLines(a)},shapesFromPolygon:function(a){return this.shapesFrom.shapesFromPolygon(a)},shapesFromRect:function(a,b){return this.shapesFrom.shapesFromRect(a,b)},shapesFromRectForDirection:function(a,b,c){return this.shapesFrom.shapesFromRectForDirection(a,b,c)},shapesFromRange:function(a,b,c,d){return this.shapesFrom.shapesFromRange(a,b,c,d)},shapesFromDimensionValue:function(a){return this.shapesFrom.shapesFromDimensionValue(a)},groupedItemsFromShapes:function(a){return this.shapesFrom.groupedItemsFromShapes(a)},shapesFromIndex:function(a,b){return this.shapesFrom.shapesFromIndex(a,b)},ToggleFlag:{select:1,deselect:2,auto:4,replace:8},toggleSelection:function(a,b){function c(c){var d=a.filter(c);d.forEach(function(a){e||(a.selected=!a.selected,i(a),g.emit(a,b))}),d.length>0&&h.emit(a,b)}var d,e=this.handler._disableSelections,f=this.ToggleFlag,g=this.handler.ToggleShape,h=this.handler.ToggleShapes,i=this.toggleSelectedShape.bind(this);b=b||f.auto,b&f.select?c(function(a){return!a.selected}):b&f.deselect?c(function(a){return a.selected}):b&f.auto?c(function(){return!0}):b&f.replace&&(d=a,a=this.handler.cache.data,c(function(a){return a.selected}),a=d,c(function(){return!0}))},clearSelection:function(){var a=this.handler.Clear,b=this.handler.cache.data,c=this.ToggleFlag.deselect;this.toggleSelection(b,c),a.emit()}});return b.defaultOptions={},b}),define("general.components/framer/framer",["qvangular","general.services/show-service/show-service"],function(a,b){var c={template:'<div class ="qv-framer" ng-style="style"></div>',controller:["$scope",function(a){a.style={},a.style.top=a.top,a.style.left=a.left,a.style.height=a.height,a.style.width=a.width,a.closeComponent()}],scope:{top:"=",left:"=",height:"=",width:"=",closeComponent:"="}},d={flash:function(d,e){var f=a.getService("$timeout"),g=b.show(c,{top:Math.min(d.y,e.y)+"px",left:Math.min(d.x,e.x)+"px",height:Math.max(d.y,e.y)-Math.min(d.y,e.y)+"px",width:Math.max(d.x,e.x)-Math.min(d.x,e.x)+"px",closeComponent:function(){f(function(){g.destroy(),g=null},300)}})}};return d}),define("objects.views/selections/types/data-area",["jquery","general.utils/shapes/point","general.utils/shapes/polygon","general.utils/shapes/rect","general.utils/shapes/line","./base","general.components/framer/framer"],function(a,b,c,d,e,f,g){"use strict";function h(){w.beginPath(),w.moveTo(n.x,n.y),w.fillStyle="rgba(77, 192, 78, 1)",w.arc(n.x,n.y,10,0,2*Math.PI,!0),w.fill()}function i(a,b,c){var d,e;!c||"x"!==c&&"y"!==c||(b[c]=n[c]),d=(a.x+b.x)/2,e=(a.y+b.y)/2,w.beginPath(),w.moveTo(a.x,a.y),w.quadraticCurveTo(d,e,b.x,b.y),w.stroke()}function j(a,b,c,d){d=d||[2,4];var e,f=d.length,g=c.x-b.x,h=c.y-b.y,i=Math.sqrt(g*g+h*h),j=i,k=0,l=!0,m=b.x,n=b.y;for(g/=i,h/=i,a.moveTo(m,n),k=0;j>=.1&&k<5e3;++k)e=d[k%f],0===e&&(e=.001),e>j&&(e=j),m+=e*g,n+=e*h,a[l?"lineTo":"moveTo"](m,n),j-=e,l=!l}function k(a,b){x.clearRect(0,0,t.width,t.height),x.beginPath(),j(x,a,b),x.stroke()}function l(){o.hide(),q.hide(),s.hide(),o.detach()}var m,n,o=a("<div />"),p=o[0],q=a("<canvas />"),r=q[0],s=a("<canvas />"),t=s[0],u=a("<canvas />"),v=u[0],w=r.getContext("2d"),x=t.getContext("2d"),y=v.getContext("2d"),z=[],A=!1,B=!1;return p.appendChild(r),p.appendChild(t),p.appendChild(v),p.className="selections-data-area-ui",o.hide(),m=f.extend("DataAreaSelection",{init:function(a,b){this._super(a,b),this.setActiveMode("item"),this._startIndex=-1,this._endIndex=-1},initComponent:function(){this.setActiveComponent(this.components.dataArea[0])},refreshCanvas:function(){this.rect=this.components.dataArea[0].rect;var a={position:"absolute",left:this.rect.x+"px",top:this.rect.y+"px",width:this.rect.width+"px",height:this.rect.height+"px","z-index":20};w.canvas.width=this.rect.width,w.canvas.height=this.rect.height,w.lineWidth=2,w.lineCap="round",w.lineJoin="round",w.strokeStyle="rgba(102,102,102,1)",w.fillStyle="rgba(102,102,102,1)",q.css(a),x.canvas.width=this.rect.width,x.canvas.height=this.rect.height,x.lineWidth=2,x.lineCap="round",x.lineJoin="round",x.strokeStyle="rgba(102,102,102,1)",s.css(a),y.canvas.width=this.rect.width,y.canvas.height=this.rect.height,u.css(a)},toggle:function(a,b,c){c=void 0!==c?c:this.handler.getKeyAsToggleSelected(a),c||this.clearSelection(),this.resetSelectedShapes(),this.setActiveComponent(this.components.dataArea[0]);var e,f=this.getTransformedPoint(b.x,b.y),g=this.options.toggle.callback||this.toggleSelection,h=this.options.indexSelection,i=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return e=h?this.shapesFromRectForDirection(new d(f.x,f.y,0,0),"y"):this.shapesFromPoints([f]),e=this.groupedItemsFromShapes(e),e.forEach(function(a){a.selectionMode="dataArea"}),e.forEach(function(a){a.interactPosition=b}),g.call(this,e,i),e&&e.length>0},toggleRect:function(b,c,e){if(c&&e){var f,h,i,j,k,l,m,n,o,p,q,r=a(this.components.dataArea[0].container),s=r.offset(),t=function(a){return{x:Math.min(Math.max(a.x,s.left),s.left+r.width()),y:Math.min(Math.max(a.y,s.top),s.top+r.height())}};c=t(c),e=t(e),p=c,q=e,this.resetSelectedShapes(),c=this.getTransformedPoint(c.x,c.y),e=this.getTransformedPoint(e.x,e.y),f=Math.min(c.x,e.x),h=Math.min(c.y,e.y),i=Math.max(1,Math.abs(e.x-c.x)),j=Math.max(1,Math.abs(e.y-c.y)),k=new d(f,h,i,j),m=this.ToggleFlag.select,n=this.options.indexSelection,o=this.toggleSelection,this.setActiveComponent(this.components.dataArea[0]),l=n?this.shapesFromRectForDirection(k,"y"):this.shapesFromRect(k),l=this.groupedItemsFromShapes(l),l.forEach(function(a){a.selectionMode="dataArea"}),o.call(this,l,m),this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),!0),g.flash(p,q)}},start:function(a,c){this.handler.getKeyAsToggleSelected(a)||this.clearSelection(),this.resetSelectedShapes(),this.setActiveComponent(this.components.dataArea[0]);var e=this.getTransformedPoint(c.x,c.y),f=this.options.captureInput,g=this.options.indexSelection;if(f&&(q.show(),s.show(),o.appendTo(this.handler.container),o.show(),this.refreshCanvas()),z.length=0,z.push(e),n=new b(z[0].x,z[0].y),A=!1,B=!1,g){var i=this.shapesFromRectForDirection(new d(n.x,n.y,1,1),"y"),j=i.length&&i[0].index;void 0!==j&&j>=0&&(this._startIndex=j)}f&&h()},update:function(a,b){var c,f,g,h,j=this.getTransformedPoint(b.x,b.y),l=this.options,m=l.captureInput,o=l.lassoAutoCloseDistance,p=l.indexSelection,q=a.shiftKey&&l.shiftLockCapture?l.shiftLockAxis:"",r=this.ToggleFlag.select,s=-1,u=this.toggleSelection;c=z[z.length-1],z.push(j),m&&i(c,j,q),m&&(A||(A=z.length>2&&n.distanceTo(j)>=o),x.clearRect(0,0,t.width,t.height),A&&(n.distanceTo(j)<=o?(k(j,n),B=!0):B=!1)),p?(h=this.shapesFromRectForDirection(new d(j.x,j.y,1,1),"y"),s=h.length?h[0].index:-1,void 0!==s&&s>=0&&(this._endIndex=s),f=this.shapesFromIndex(this._startIndex,this._endIndex),g=this.getSelectedShapes().filter(function(a){return f.indexOf(a)===-1}),u.call(this,g,this.ToggleFlag.deselect),u.call(this,f,r)):(f=this.shapesFromLines([new e(c.x,c.y,j.x,j.y)]),f=this.groupedItemsFromShapes(f),f.forEach(function(a){a.selectionMode="dataArea"}),u.call(this,f,r))},end:function(a){var b,d,e=this.options.captureInput,f=this.options.indexSelection,g=this.ToggleFlag.select,h=this.toggleSelection;f&&(this._startIndex=-1,this._endIndex=-1),e&&l(),e&&B&&(d=new c(z),b=this.shapesFromPolygon(d),b=this.groupedItemsFromShapes(b),b.forEach(function(a){a.selectionMode="dataArea"}),h.call(this,b,g)),z.length=0,this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),this.handler.getKeyAsToggleSelected(a));
},cancel:function(a){z.length&&l(),a&&this.clearSelection(),this.setActiveComponent(null)}}),m.defaultOptions={captureInput:!0,indexSelection:!1,shiftLockCapture:!1,shiftLockAxis:"x",lassoAutoCloseDistance:50,autoConfirm:!1,toggle:{callback:null},interpolation:{pixelPrecision:2}},m}),define("text!objects.views/selections/types/range/range-template.ng.html",[],function(){return'<div class="qvt-range-selection">\n\t<div class="range-vertical-clip" ng-style="{ top: vOptions.offset, height: vOptions.rect.height }">\n\t\t<div class="range-vertical"\n\t\t\t ng-repeat="range in vRanges track by $index"\n\t\t\t qva-range-selection-range="y"\n\t\t\t ng-class="{\'near\': vOptions.dock == \'left\', \'far\' : vOptions.dock == \'right\'}"\n\t\t\t ng-style="range.style">\n\t\t\t<div class="range">\n\t\t\t\t<div class="axis-cover" ng-style="vRelevantSize" tid="range-vertical-cover" ng-class="{\'active\' : range.cover}"></div>\n\t\t\t</div>\n\t\t\t<div class="far-edge" tid="range-vertical-far" ng-class="{\'active\' : range.near}">\n\t\t\t</div>\n\t\t\t<div class="near-edge" tid="range-vertical-near" ng-class="{\'active\' : range.far}">\n\t\t\t</div>\n\t\t\t<div class="outer-bubble-wrapper" ng-style="vWrappperSize">\n\t\t\t\t<qva-range-selection-bubble tid="range-vertical-near-bubble" visible="visible" active-component="vComponent" handle-points="range.points" range-index="$index" horizontal="false" far="false" data="range.values.start" active="range.far"> </qva-range-selection-bubble>\n\t\t\t\t<qva-range-selection-bubble tid="range-vertical-far-bubble" visible="visible" active-component="vComponent" handle-points="range.points" range-index="$index" horizontal="false" far="true" data="range.values.end" active="range.near"> </qva-range-selection-bubble>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="range-horizontal-clip" ng-style="{ left: hOptions.offset, width: hOptions.rect.width }">\n\t\t<div class="range-horizontal"\n\t\t\t ng-repeat="range in hRanges track by $index"\n\t\t\t qva-range-selection-range="x"\n\t\t\t ng-class="{\'near\': hOptions.dock == \'bottom\', \'far\' : hOptions.dock == \'top\'}"\n\t\t\t ng-style="range.style">\n\t\t\t<div class="range">\n\t\t\t\t<div class="axis-cover" ng-style="hRelevantSize" tid="range-horizontal-cover" ng-class="{\'active\' : range.cover}"></div>\n\t\t\t</div>\n\n\t\t\t<div class="far-edge" tid="range-horizontal-far" ng-class="{\'active\' : range.far}">\n\t\t\t</div>\n\t\t\t<div class="near-edge" tid="range-horizontal-near" ng-class="{\'active\' : range.near}">\n\t\t\t</div>\n\t\t\t<div class="outer-bubble-wrapper" ng-style="hWrappperSize">\n\t\t\t\t<qva-range-selection-bubble tid="range-horizontal-near-bubble" visible="visible" active-component="hComponent" handle-points="range.points" range-index="$index" horizontal="true" far="false" data="range.values.start" active="range.near"> </qva-range-selection-bubble>\n\t\t\t\t<qva-range-selection-bubble tid="range-horizontal-far-bubble" visible="visible" active-component="hComponent" handle-points="range.points" range-index="$index" horizontal="true" far="true" data="range.values.end" active="range.far"> </qva-range-selection-bubble>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'}),define("text!objects.views/selections/types/range/range-bubble.ng.html",[],function(){return'<div class="bubble-wrapper" ng-class="{\'far\' : far, \'near\' : !far}">\n\t<div ng-show="!editing" qva-direction x-dir-text="{{data.text}}" class="bubble range-bubble" ng-class="{\'active\' : active}">{{data.text}}</div>\n\t<input ng-show="editing" type="text" ng-class="{\'active\' : active, \'invalid\': invalid}" class="bubble range-input"/>\n</div>'}),define("objects.views/selections/types/range/range-bubble-directive",["jquery","touche","qvangular","text!./range-bubble.ng.html"],function(a,b,c,d){function e(a){a.$emit("rangeStart")}function f(a,b){a.editing=b,a.$emit("rangeEditChanged",b)}function g(a,b,c,d,e){a.$emit("rangeUpdate",b,c,d,!1,e)}function h(a,b){a.$emit("rangeEnd",b)}function i(){a(this).css("width",6*a(this).val().length+50+"px")}var j=".rangeselection";c.directive("qvaRangeSelectionBubble",["$timeout",function(c){return{template:d,replace:!0,restrict:"E",scope:{data:"=",active:"=",far:"=",horizontal:"=",activeComponent:"=",handlePoints:"=",visible:"=",rangeIndex:"="},link:function(d,k){function l(){p||(p=!0,b(m[0]).tap({id:j,options:{preventDefault:!1},start:function(){b.preventGestures(this.gestureHandler)}}),b(n[0]).tap({id:j,start:function(){b.preventGestures(this.gestureHandler)},end:function(){d.editable&&!d.editing&&(f(d,!0),d.onEditBubble())}}).swipe({id:j,start:function(){a.extend(!0,o,d.handlePoints),b.preventGestures(this.gestureHandler),e(d)},update:function(a,b){var c,e,f,h,i=d.far?1:0;d.horizontal?(c=b.swipe.deltaX,e="x"):(c=b.swipe.deltaY,e="y"),f=o[1^i][e],h=o[i][e]+c,0===i&&(d.horizontal&&h>f||!d.horizontal&&h<f)?(i=1,f=o[1][e]):1===i&&(d.horizontal&&h<f||!d.horizontal&&h>f)&&(i=0,f=o[0][e]),d.handlePoints[i][e]=h,d.handlePoints[1^i][e]=f,d.$digest(),g(d,d.handlePoints,e,d.rangeIndex)},end:function(){h(d,d.handlePoints)}}),m.keyup(i),d.onEditConfirmed=function(){if(d.editing){var a,b,c=m.val(),e={value:parseFloat(c),index:d.far?1:0,switch:!1},f=d.activeComponent.getPositionOfValue(e.value),i=d.handlePoints;isNaN(e.value)?d.invalid=!0:(b=d.horizontal?"x":"y",i[e.index][b]=f,(d.horizontal&&i[1][b]<i[0][b]||!d.horizontal&&i[1][b]>i[0][b])&&(a=i[1][b],i[1][b]=i[0][b],i[0][b]=a,e.index=e.index?0:1,e.switch=!0),d.endEditing(),g(d,d.handlePoints,b,d.rangeIndex,e),h(d,d.handlePoints)),d.$digest()}},d.$on("confirmEdit",d.onEditConfirmed))}var m=k.find(".range-input"),n=k.find(".range-bubble"),o={},p=!1;d.$watch("activeComponent",function(){d.editable=d.activeComponent&&!d.activeComponent.isDimension&&!d.activeComponent.isDiscrete()&&"function"==typeof d.activeComponent.getPositionOfValue,d.editable?(m.removeClass("non-editable"),n.removeClass("non-editable")):(m.addClass("non-editable"),n.addClass("non-editable"))}),d.endEditing=function(){d.invalid=!1,d.editing&&(f(d,!1),m.blur())},d.$watch("data.value",function(a){return isNaN(a)?void(this.invalid=!0):(d.editing&&d.endEditing(),void m.val(a))}),d.$watch("visible",function(){d.visible||d.endEditing()}),d.$on("off",function(){d.endEditing(),b(m[0]).off("*",j),b(n[0]).off("*",j),k.off("keyup"+j,"*"),p=!1}),d.onEditBubble=function(){d.editing=!0,m.css("width",n.width()),d.$digest(),m.focus(),m[0].setSelectionRange(0,9999),d.$digest(),c(function(){i.call(m)})},d.$on("on",l),l()}}}])}),define("objects.views/selections/types/range/range-directive",["touche","qvangular","general.utils/shapes/point","text!./range-template.ng.html","./range-bubble-directive"],function(a,b,c,d){function e(a,b,d,e){var f=[];return"y"===d?f[b]=new c(a[b].x,a[b].y+e):f[b]=new c(a[b].x+e,a[b].y),f[1^b]=a[1^b],f}function f(a){a.$emit("rangeStart")}function g(a,b,c,d,e){a.$emit("rangeUpdate",b,c,d,e)}function h(a,b){a.$emit("rangeEnd",b)}function i(a,b,c){return b?a[0][c]>a[1][c]?0:1:a[0][c]<a[1][c]?0:1}function j(b,c,d,j){var k,l,n,o=d?"x":"y";a(c).tap({id:m,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:m,options:{radiusThreshold:0},start:function(){l=i(b.range.points,j,o),k=b.range.points,a.preventGestures(this.gestureHandler),f(b)},update:function(a,c){b.range.points=e(k,l,o,d?c.swipe.deltaX:c.swipe.deltaY),b.$digest(),b.range.near=b.range.far=!1,n=i(b.range.points,j,o)^!d?"far":"near",b.range[n]=!0,g(b,b.range.points,o,b.$index,!1)},end:function(){h(b,b.range.points),b.range.near=b.range.far=!1}})}function k(b,c){if(!b.isOn){b.isOn=!0;var d="hey";if(a(b.axisCover).tap({id:m,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)},end:function(a,b){c.$emit("rangeToggle",a,b.pagePoints[0])}}).swipe({id:m,options:{preventDefault:!0},start:function(){d=c.range.points,a.preventGestures(this.gestureHandler),f(c),c.range.cover=!0},update:function(a,e){"y"===b.dir?c.range.points=[{x:d[0].x,y:d[0].y+e.swipe.deltaY},{x:d[1].x,y:d[1].y+e.swipe.deltaY}]:c.range.points=[{x:d[0].x+e.swipe.deltaX,y:d[0].y},{x:d[1].x+e.swipe.deltaX,y:d[1].y}],c.$digest(),g(c,c.range.points,b.dir,c.$index,!0)},end:function(){h(c,c.range.points),c.range.cover=!1}}),!a.utils.touch){var e="x"===b.dir;j(c,b.farEdge,e,e),j(c,b.nearEdge,e,!e)}}}function l(b){a(b.axisCover).off("*",m),a(b.farEdge).off("*",m),a(b.nearEdge).off("*",m),b.isOn=!1}var m=".rangeselection";b.directive("qvaRangeSelectionRange",function(){return{scope:!1,link:function(a,b,c){var d={isOn:!1,dir:c.qvaRangeSelectionRange,axisCover:b.find(".axis-cover")[0],farEdge:b.find(".far-edge")[0],nearEdge:b.find(".near-edge")[0]};k(d,a),a.$on("on",function(){k(d,a)}),a.$on("off",function(){l(d)}),a.$on("$destroy",function(){l(d)})}}}),b.directive("qvaRangeSelection",function(){return{template:d,replace:!0,scope:{vOptions:"=",hOptions:"=",vRanges:"=",hRanges:"=",activeComponent:"=",hComponent:"=",vComponent:"=",visible:"="},link:function(a){a.vRelevantSize=0,a.hRelevantSize=0,a.activeOptions={y:{far:!1,near:!1,cover:!1},x:{far:!1,near:!1,cover:!1}},a.setRangeStyle=function(a,b,c){b&&c&&b.forEach(function(b){var c=b.points[0],d=b.points[1];"y"===a?b.style={height:Math.abs(c[a]-d[a]),top:Math.min(c[a],d[a])}:b.style={width:Math.abs(c[a]-d[a]),left:Math.min(c[a],d[a])}})},a.$watchCollection("[vRanges, vOptions]",function(b){a.setRangeStyle("y",b[0],b[1])}),a.$watchCollection("[hRanges, hOptions]",function(b){a.setRangeStyle("x",b[0],b[1])}),a.$watch("hOptions",function(b){b&&a.setRelevantSize("x",b.rect.height)}),a.$watch("vOptions",function(b){b&&a.setRelevantSize("y",b.rect.width)}),a.setRelevantSize=function(b,c){"x"===b?(a.hRelevantSize={height:c+"px"},a.hWrappperSize={height:"calc(100% - "+c+"px)"}):(a.vRelevantSize={width:c+"px"},a.vWrappperSize={width:"calc(100% - "+c+"px)"})}}}})}),define("objects.views/selections/types/range/range-angular",["jquery","qvangular","./../base","general.utils/shapes/point","general.utils/shapes/rect","./range-directive"],function(a,b,c,d,e){"use strict";function f(a){if(a.isCacheItem){var b=a.getDimensions();return b[b.length-1]}return a.parent&&a.parent.data&&a.parent.data.qText?a.parent.data.qText:a.label}function g(a,b,c){c=c||!1;var d,e,f=a.getValueOfPosition(b),g=a.indicators||a.getLevels()[0],h=a.getPlotMax(),i=a.getPlotMin(),j=Number.MAX_VALUE,k=Math.abs(f-i),l=Math.abs(f-h),m={value:f,newPoint:b,label:""};g.rangeLabels||(c=!1);for(var n=0;n<g.values.length;n++)if(d=g.values[n],e=Math.abs(f-d),!(d<i||d>h)){if(!(e<j))break;j=e,m.value=d,m.label=g.qualifiedLabels?g.qualifiedLabels[n+(c?-1:0)]:g.labels[n+(c?-1:0)]}return k<j?(m.value=i,m.newPoint=a.yMirrorMode?a.getPlotSize()-1:0,m.label=t(i,a)):l<j?(m.value=h,m.newPoint=a.yMirrorMode?0:a.getPlotSize()-1,m.label=t(h,a)):m.newPoint=a.getPositionOfValue(m.value),m}function h(a,b){if(b||!a.isDimension)return!1;var c=a.getSnapTicksAvgWidth()>E;return!c}function i(a,b){var c=this.getComponentKey(this.activeComponent),d="x"===c?"width":"height",e=a.rect[c],f=a.rect[c]+a.rect[d],g=this.activeComponent.rect,h=this.getRect(this.activeComponent),i=h[c]-g[c],j=i+h[d];e===f&&0===e&&(e=f=b[c]);var k=null,l=null;if(D[c].length>1)for(var m=0;m<D[c].length;++m){var n=D[c][m];if(a!==n){var o=n.rect[c],p=n.rect[c]+n.rect[d];p<=e&&(null===k||p>k)&&(k=p),o>=f&&(null===l||o<l)&&(l=o)}}return i<=e&&(null===k||i>k)&&(k=i),j>=f&&(null===l||j<l)&&(l=j),{min:k,max:l}}function j(a,b,c,d,e){var h,j,k,l,m,n=this.activeComponent.rect,o=this.getRect(this.activeComponent),p=this.components.dataArea[0].rect,q=function(a,b,d){if(e){if(e.switch){var f=c.startVal;c.startVal=c.updateVal,c.updateVal=f}var g=Math.max(Math.min(e.value,this.activeComponent.getPlotMax()),this.activeComponent.getPlotMin());0===e.index&&"horizontal"===d||1===e.index&&"vertical"===d?c.startVal=g:c.updateVal=g}else c.startVal=this.activeComponent.getValueOfPosition(a),c.updateVal=this.activeComponent.getValueOfPosition(b),this._snapToTicks||(c.startLabel=this.activeComponent.getLabelFromPoint(a),c.updateLabel=this.activeComponent.getLabelFromPoint(b))},r=o.y-n.y,s=o.x-n.x,t=0,u=0,v=0,w=0,x=this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete(),A=i.call(this,c,a);switch(this.activeComponent.dock){case"top":case"bottom":if(t=y(a.x,b.x),t=z(t,0),v=z(a.x,b.x,0),u=0,w=p.height,null!==A.min&&A.min>t&&(d&&(v+=A.min-t),t=A.min),null!==A.max&&A.max<v&&(d&&(t+=A.max-v),v=A.max),this._snapToTicks){var B=this.activeComponent.yMirrorMode;t>=s&&(h=g(this.activeComponent,t,B),c.startLabel=h.label,t=h.newPoint),v<=s+o.width&&(j=g(this.activeComponent,v,!B),c.updateLabel=j.label,v=j.newPoint)}c.rect.set(t,u,v-t,w-u),x?(k=this.shapesFromRectForDirection(c.rect,"x","dataArea"),k.length?(l=this.options&&this.options.rtl?k[k.length-1]:k[0],m=this.options&&this.options.rtl?k[0]:k[k.length-1],c.startVal=f(l),c.updateVal=f(m)):(c.startVal="-",c.updateVal="-")):q.call(this,t,v,"horizontal");break;case"left":case"right":u=y(a.y,b.y),w=z(a.y,b.y),t=0,v=p.width,null!==A.min&&A.min>u&&(d&&(w+=A.min-u),u=A.min),null!==A.max&&A.max<w&&(d&&(u+=A.max-w),w=A.max),this._snapToTicks&&(u>=r&&(h=g(this.activeComponent,u,!1),c.startLabel=h.label,u=h.newPoint),w<=r+o.height&&(j=g(this.activeComponent,w,!0),c.updateLabel=j.label,w=j.newPoint)),c.rect.set(t,u,v-t,w-u),x?(k=this.shapesFromRectForDirection(c.rect,"y","dataArea"),k.length?(l=k[0],m=k[k.length-1],c.startVal=f(l),c.updateVal=f(m)):(c.startVal="-",c.updateVal="-")):q.call(this,u,w,"vertical")}}function k(){return this.components.x&&this.components.y&&1===this.components.x.length&&!this.components.x[0].isDiscrete()&&!this.components.y[0].isDiscrete()}function l(){v.y=!1,v.x=!1,this._rangeEventWatchers&&(this._rangeEventWatchers.forEach(function(a){a()}),this._rangeEventWatchers=null),A.hide(),A.detach(),v.rangeSelectIsVisible=!1,D={x:[],y:[]}}function m(a,b,c){var d={rect:new e(0,0,0,0),startVal:0,updateVal:0,component:b};return c?D[a].push(d):D[a][0]=d,d}function n(a,b,c){for(var d,f,h=D[a],i="x"===a&&c.yMirrorMode,j=i?b.end:b.start,k=i?b.start:b.end,l=c.getPositionOfValue(j),m=c.getPositionOfValue(k),n=-1,p=0;p<h.length;p++){var q=i?h[p].updateVal<=k&&j<=h[p].startVal:h[p].startVal<=j&&k<=h[p].updateVal;if(q){n=p;break}}if(n===-1)d=g(c,l,i).label,f=g(c,m,!i).label,h.push({startVal:j,startLabel:d,updateVal:k,updateLabel:f,component:c,rect:new e(0,0,0,0)});else{d=g(c,l,!i).label,f=g(c,m,i).label;var r=h[n];h[n]={startVal:r.startVal,startLabel:r.startLabel,updateVal:j,updateLabel:d,component:c,rect:new e(0,0,0,0)},h.push({startVal:k,startLabel:f,updateVal:r.updateVal,updateLabel:r.updateLabel,component:c,rect:new e(0,0,0,0)})}o(a,c.yMirrorMode)}function o(a,b){var c="x"===a&&b,d=c?"updateVal":"startVal",e=c?"startVal":"updateVal",f=D[a];f.sort(function(a,b){return a[d]<b[d]?-1:a[d]>b[d]?1:0});for(var g=f.length-1;g>=0;--g)if(f[g].startVal!==f[g].updateVal){if(g<f.length-1){var h=f[g][e],i=f[g+1][d];h>=i&&(f[g+1][e]>f[g][e]&&(f[g][e]=f[g+1][e],c?f[g].startLabel=f[g+1].startLabel:f[g].updateLabel=f[g+1].updateLabel),f.splice(g+1,1),g<f.length-1&&++g)}}else f.splice(g,1)}function p(a,b,c){a||(a="x"),b||(b=0);var d=D[a][b];return d||(d={rect:new e(0,0,0,0),startVal:0,endVal:0},D[a][b]=d),d.component=c,d}function q(a,b,c,d,e){var f,g=[],h=this._previousShapes?this._previousShapes.slice():[],i=this.getActiveMode(),j=D["y"===b?"x":"y"];if("range.discrete"===i)g=this.shapesFromRectForDirection(a.rect,b,"dataArea"),g=this.groupedItemsFromShapes(g),g.forEach(function(a){var b=h.indexOf(a);b>=0&&h.splice(b,1),a.selectionMode=i}),c.call(this,g,d),this._clearPrev&&c.call(this,h,this.ToggleFlag.deselect),this._shapes=g;else if("range.dimension"===i){if(this.components.dataArea&&this.components.dataArea[0].updateRangeSelection){var l=D[b].map(function(a){return s(a.startVal,a.updateVal,!!e)});this.handler.UpdateRanges.emit(l)}}else k.call(this)?(f=j.length?a.rect.intersection(j[0].rect):a.rect,g=this.shapesFromRect(f,"dataArea"),this.components.dataArea&&this.components.dataArea[0].updateRangeSelection&&this.components.dataArea[0].updateRangeSelection(f)):g=this.shapesFromRange(a.startVal,a.updateVal),g.forEach(function(a){a.selectionMode=i}),c.call(this,g,d),this._shapes=g}function r(a,b,c,d){var e=this.getComponentKey(this.activeComponent),f=b,g=this.ToggleFlag.select,i=this.toggleSelection;this._snapToTicks=h(this.activeComponent,this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()),j.call(this,w,f,a,c,d);var k=this.getActiveMode();"range.measure"===k?this.clearSelection(!0):this._shapes&&i.call(this,this._shapes,this.ToggleFlag.deselect),q.call(this,a,e,i,g),this.updateRangeDisplay()}function s(a,b,c){return{min:Math.min(a,b),max:Math.max(a,b),maxNotIncluded:!!c}}function t(a,b){var c=b.isDiscrete&&b.isDiscrete();return c||!b.isDimension?b.getFormatter().format(a):b.formatValue(a)}var u,v,w,x=!1,y=Math.min,z=Math.max,A=a("<div />"),B=A[0],C=a('<div qva-range-selection visible="rangeSelectIsVisible" active-component="activeComponent" v-component="vComponent" h-component="hComponent" v-ranges="vRanges" h-ranges="hRanges" h-options="hOptions" v-options="vOptions"/>'),D={x:[],y:[]},E=80;return u=c.extend("RangeSelection",{init:function(a,b){this._super(a,b),this._shapes=null,this._nrEditing=0,this.setActiveMode("item")},initComponent:function(a){this.previousComponent=this.activeComponent,this.setActiveComponent(this.getComponent(a.x,a.y)),v.activeComponent=this.activeComponent,this.components.x.indexOf(v.activeComponent)!==-1?v.hComponent=v.activeComponent:this.components.y.indexOf(v.activeComponent)!==-1&&(v.vComponent=v.activeComponent)},setDirection:function(a){this.options.rtl="rtl"===a},refreshContainer:function(){var b,c=this.components.dataArea[0].rect,d=a(this.components.dataArea[0].container).position(),f=new e(d.left,d.top,c.width,c.height),g=[];["x","y"].forEach(function(a){this.components[a]&&!this.components[a].contains(this.activeComponent)&&(g=g.concat(this.components[a]))}.bind(this)),this.activeComponent&&g.push(this.activeComponent),g.forEach(function(c){c.isVisible()&&(b=a(c.container).position(),f=f.combineWith(new e(b.left,b.top,c.rect.width,c.rect.height)))},this),this._offset={left:d.left-f.x,top:d.top-f.y},A.css({left:f.x,top:f.y,width:f.width,height:f.height})},resetSelectedShapes:function(){this._previousSelectedShapes=this._selectedShapes.concat(),this._super()},getIsEditing:function(){return this._editing},confirmEdit:function(){v.$broadcast("confirmEdit")},getRect:function(a,b){return a?(b=b||!1,a.hasOwnProperty("innerRect")&&!b?a.innerRect:a.rect):new e(0,0,0,0)},getExtendedRect:function(a){return a?a.hasOwnProperty("extendedRect")?a.extendedRect:this.getRect(a):new e(0,0,0,0)},getTransformedPoint:function(a,b){var c=this.getRect(this.activeComponent||this.components.dataArea[0],!0);return new d(a-c.x-this.handler.containerRect.x,b-c.y-this.handler.containerRect.y)},getComponent:function(a,b){var c=new d(a-this.handler.containerRect.x,b-this.handler.containerRect.y);return Object.keys(this.components).map(function(a){return this.components[a]},this).reduce(function(a,b){return a.concat(b)}).filter(function(a){return this.getExtendedRect(a).pointInside(c.x,c.y)},this)[0]},checkActiveMode:function(a,b){a.contains(this.handler.getActiveMode())||this.clearSelection(b),this.setActiveMode(a[0])},toggleRect:function(a,b,c){this.start(a,b),this.update(a,c),this.end(a)},toggle:function(a,b,c){c=void 0!==c?c:this.handler.getKeyAsToggleSelected(a);var d;if(c||this.clearSelection(),this.resetSelectedShapes(),this._editing&&this.confirmEdit(),this.activeComponent&&"function"==typeof this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()){this.cancel(),d=this.getTransformedPoint(b.x,b.y);var e=this.shapesFromPoints([d]),f=this.options.toggle.callback||this.toggleSelection,g=this.ToggleFlag.auto|this.ToggleFlag.tooltip;e=this.groupedItemsFromShapes(e),e.forEach(function(a){a.selectionMode="dataArea"}),this.checkActiveMode(["item"]),f.call(this,e,g)}else if(this.activeComponent&&this.activeComponent.isDimension){d=this.getTransformedPoint(b.x,b.y);var h=this.activeComponent.getLabelFromPoint(d);if(h){this.checkActiveMode(["range.dimension"]),this.resetSelectedShapes();var i=this.getComponentKey(this.activeComponent);n(i,h,this.activeComponent),q.call(this,null,i,null,null,!0),this.selectRange(!0),this.refreshContainer(),this.initWatchers(),this.updateRangeProjection(),this.updateRangeDisplay()}}},updateRangeDisplay:function(){v.hRanges=[],v.vRanges=[],v.vRanges=D.y.map(function(a){var b=new d(a.rect.x,a.rect.y),c=new d(a.rect.x+a.rect.width,a.rect.y+a.rect.height),e=a.startLabel||(isNaN(a.startVal)?a.startVal:t(a.startVal,a.component)),f=a.updateLabel||(isNaN(a.updateVal)?a.updateVal:t(a.updateVal,a.component));return{points:[c,b],values:{start:{text:f,value:a.updateVal},end:{text:e,value:a.startVal}}}}),v.hRanges=D.x.map(function(a){var b=new d(a.rect.x,a.rect.y),c=new d(a.rect.x+a.rect.width,a.rect.y+a.rect.height),e=a.startLabel||(isNaN(a.startVal)?a.startVal:t(a.startVal,a.component)),f=a.updateLabel||(isNaN(a.updateVal)?a.updateVal:t(a.updateVal,a.component));return{points:[b,c],values:{start:{text:e,value:a.startVal},end:{text:f,value:a.updateVal}}}}),D.y.length>0&&(v.vOptions={rect:this.getRect(D.y[0].component,!0).clone(),offset:this._offset.top,padding:D.y[0].component.getPadding(),dock:D.y[0].component.dock}),D.x.length>0&&(v.hOptions={rect:this.getRect(D.x[0].component,!0).clone(),offset:this._offset.left,padding:D.x[0].component.getPadding(),dock:D.x[0].component.dock}),v.rangeSelectIsVisible||(this.handler.container.append(A),A.show(),v.rangeSelectIsVisible=!0),v.$digest()},initWatchers:function(){if(!this._rangeEventWatchers){var a=this;this._rangeEventWatchers=[],this._rangeEventWatchers.push(v.$on("rangeStart",function(){a.resetSelectedShapes(),a._shapes=a._previousShapes,a._clearPrev=!0})),this._rangeEventWatchers.push(v.$on("rangeUpdate",function(b,c,d,e,f,g){w=c[0],a.components[d].indexOf(a.activeComponent)<0&&a.setActiveComponent(a.components[d][0]);var h=D[d][e];r.call(a,h,c[1],f,g),a._clearPrev=!1})),this._rangeEventWatchers.push(v.$on("rangeEditChanged",function(b,c){a._nrEditing=c?a._nrEditing+1:a._nrEditing-1,a._nrEditing>1&&(a.confirmEdit(),a._nrEditing=1,b.targetScope.onEditBubble()),a._editing=a._nrEditing>0})),this._rangeEventWatchers.push(v.$on("rangeEnd",function(){a.end(),a._clearPrev=!1})),this._rangeEventWatchers.push(v.$on("rangeToggle",function(b,c,d){a.toggle(c,d)}))}},start:function(a,b){if(this.handler._disableSelections)return!0;this.resetSelectedShapes(),this.refreshContainer(),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?this.checkActiveMode(["range.discrete","item"]):this.activeComponent.isDimension?this.checkActiveMode(["range.dimension"]):this.checkActiveMode(["range.measure"]);var c=this.getComponentKey(this.activeComponent);"x"!==c&&"y"!==c||(this.currentRange=m(c,this.activeComponent,"range.dimension"===this.getActiveMode()),this.initWatchers(),w=this.getTransformedPoint(b.x,b.y))},update:function(a,b){return!!this.handler._disableSelections||void r.call(this,this.currentRange,this.getTransformedPoint(b.x,b.y),!1)},updateShapesState:function(){var a=this.getComponentKey(this.activeComponent),b=p(a,0,this.activeComponent),c=this.getActiveMode(),d=this.ToggleFlag.select,e=[],f=this.toggleSelection;this.clearSelection(!0),this.activeComponent.isDiscrete&&!this.activeComponent.isDiscrete()&&(e=this.shapesFromRange(b.startVal,b.updateVal),e.forEach(function(a){a.selectionMode=c}),f.call(this,e,d)),this._shapes=e},updateRangeProjection:function(){var a=this.components.dataArea[0].rect;D.x.forEach(function(b){var c=b.component.getPositionOfValue(b.startVal),d=b.component.getPositionOfValue(b.updateVal),e=Math.min(c,d),f=Math.max(c,d),g=0,h=a.height;b.rect.set(e,g,f-e,h-g)}),D.y.forEach(function(b){var c=b.component.getPositionOfValue(b.startVal),d=b.component.getPositionOfValue(b.updateVal),e=0,f=a.width,g=Math.max(c,d),h=Math.min(c,d);b.rect.set(e,h,f-e,g-h)})},end:function(){if(this.handler._disableSelections)return!0;if(this.currentRange=null,"range.dimension"===this.getActiveMode()){var a=this.getComponentKey(this.activeComponent);o(a,this.activeComponent.yMirrorMode),this.updateRangeProjection()}this.updateRangeDisplay(),this.selectRange(),this._previousShapes=this._shapes,this._shapes=null},cancel:function(){if(this.handler._disableSelections)return!0;this._nrEditing=0,this._editing=!1;var a=this.getActiveMode();"range.discrete"===a&&this.setActiveMode("item"),this._shapes=null,l.call(this)},clearSelection:function(a){a=a||!1,this._shapes=null,a?this._super():(this._super(),l.call(this))},selectRange:function(a){var b=this.handler.SelectRange,c=[],d=!1;if(this.activeComponent){if("range.discrete"===this.getActiveMode()){var e=this._previousSelectedShapes,f=this.getSelectedShapes().concat();return e.forEach(function(a){var b=f.indexOf(a);b===-1&&f.push(a)}),void(f.length>0&&this.handler.Select.emit(f))}D.x.concat(D.y).forEach(function(b){b.component.getType().current.forEach(function(d){c.push({idx:d,type:b.component.getType().type,range:s(b.startVal,b.updateVal,!!a)})})}),d=!k.call(this),this._editing||b.emit(c,d)}},on:function(){if(!x){var a=b.getService("$compile"),c=b.getService("$rootScope");v=c.$new(),B.className="selections-range-ui",A.append(C),A.hide(),a(B)(v),x=!0,v.rangeSelectIsVisible=!1}v.$broadcast("on")},off:function(){this.activeComponent&&(v.$broadcast("off"),this.setActiveComponent(null),l.call(this))}}),u.defaultOptions={toggle:{callback:null}},u}),define("objects.views/selections/types/dom-base",["./base","general.utils/shapes/rect"],function(a,b){"use strict";function c(a,b){var c,d,e=b[0],f=!1;for(c=0;c<a.length;c++)d=a[c],d.startVal===e.startVal&&d.updateVal===e.updateVal&&(a.splice(c,1),c--,f=!0);return f||(a=a.concat(b)),a}var d;return d=a.extend({init:function(a,b){this._super(a,b),this.internal=!0},release:function(){},initComponent:function(a,b){document.activeElement&&document.activeElement.blur(),b?this.setActiveComponent(b):(this.handler.refreshContainerRect(),this.setActiveComponent(this.getComponent(a.x,a.y,this.handler.containerRect)))},getRect:function(a){return a?a.hasOwnProperty("innerRect")?a.innerRect:a.rect:new b(0,0,0,0)},setComponent:function(a,b){this._super(a,b);var c=Array.isArray(b)?b.concat():[b];c.forEach(function(a){a.selections=this,this.handler._isListening&&b.on()},this)},addComponent:function(a,b){this._super(a,b),b.selections=this,this.handler._isListening&&b.on()},removeComponent:function(a,b){this._super(a,b),b.selections=null,b.off()},updateFromItems:function(a,b,c,d){var e=this.handler,f=this;if(!e.canTypeBeActivated(this))return void e.SelectWhileLocked.emit(c?this.activeComponent.getAttributeDimensionInfo():void 0);if(this.resetSelectedShapes(),this.setActiveMode(c?"item"+this.activeComponent.getColorMap().getColorDataInfo().legendPath.replace(/\//g,"."):"item"),e.activate(this),c&&e.SelectAttributeDim.emit(d,e.getKeyAsToggleSelected(a)),b=b.filter(function(a){return f._allowNullSelect||!f.shapesFrom._isNull(a,f.activeComponent.getSelectionIndices())}),b.length){var g=this.options.toggle.callback||this.toggleSelection;g.call(this,b),c||e.Select.emit(this.getSelectedShapes(),e.getKeyAsToggleSelected(a))}},rangeStart:function(a){var b=this.handler;return b.canTypeBeActivated(this)?(this.setActiveMode("range.measure"),b.activate(this),void(a&&this.resetSelectedShapes())):void b.SelectWhileLocked.emit()},rangeUpdate:function(a,b){var d=this.handler;if(!d.canTypeBeActivated(this))return void d.SelectWhileLocked.emit();var e,f=this.options.toggle.callback||this.toggleSelection,g=[],h=this.ToggleFlag.select;for(this.clearSelection(!0),this._rangeObjects&&b&&(a=c(this._rangeObjects,a)),e=0;e<a.length;e++){var i=a[e];g=g.concat(this.shapesFromRange(i.startVal,i.updateVal,!0,i.isMax))}g.forEach(function(a){a.selectionMode="range.measure"}),f.call(this,g,h),this._rangeObjects=a,this._shapes=g},rangeEnd:function(){this.selectRange(),this._shapes=null},toggle:function(){},cancel:function(){this._rangeObjects=null,this.activeComponent.cancelSelection()},clearSelection:function(a){this._super(),a||(this._rangeObjects=null,this.activeComponent.clearSelection())},selectRange:function(){var a,b,c=this.handler.SelectRange,d=[];if(this._rangeObjects){for(a=0;a<this._rangeObjects.length;a++)b=this._rangeObjects[a],d.push({idx:b.idx||0,range:{min:Math.min(b.startVal,b.updateVal),max:Math.max(b.startVal,b.updateVal)}});c.emit(d,!0)}}}),d.defaultOptions={},d}),define("objects.views/selections/types/color-legend",["./dom-base"],function(a){"use strict";var b;return b=a.extend({setIsEditing:function(a,b){this._editing=a,this._scope=b},getIsEditing:function(){return this._editing},confirmEdit:function(){this._scope.$broadcast("confirmEdit")},selectWhileLocked:function(a){this.handler.SelectWhileLocked.emit(a)}}),b.defaultOptions={captureInput:!0,toggle:{callback:null}},b}),define("objects.views/selections/handler",["jquery","core.utils/class","core.utils/notification","client.utils/state","./types/data-area","./types/range/range-angular","./types/color-legend","general.utils/shapes/rect","./interaction-type","./interaction-handler"],function(a,b,c,d,e,f,g,h,i,j){function k(b){Object.keys(b).forEach(function(c){c in o&&(this.types[c]=new o[c](this,a.extend(!0,{},o[c].defaultOptions,b[c])))},this)}function l(a,b){var c;for(c=0;c<b.length;c++)if(a.contains(b[c]))return!0;for(c=0;c<a.length;c++)if(b.contains(a[c]))return!0;return!1}var m,n,o={dataArea:e,range:f,colorLegend:g};return m=b.extend({init:function(b,d,e){c.mixin(this),this.notification("Activated"),this.notification("Deactivated"),this.notification("ToggleShape"),this.notification("ToggleShapes"),this.notification("SelectWhileLocked"),this.notification("Lasso"),this.notification("Confirm"),this.notification("Cancel"),this.notification("Select"),this.notification("SelectRange"),this.notification("SelectAttributeDim"),this.notification("Clear"),this.notification("ResetSelections"),this.notification("UpdateRanges"),this._active=!1,this._autoActivated=!1,this._isListening=!1,this._isScrolling=!1,this._isLocked=!1,this._shiftPressed=!1,this._lassoEnabled=!1,this._allowLasso=!0,this.container=b,this.options=a.extend(!0,{},{toggle:!0,toggleRect:!0,swipe:!0,ctrlKeyAsToggleSelected:!1},d),this.cache=e,this.containerRect=new h(0,0,0,0),this.types={},this._keyboard=!0,k.call(this,this.options)},setContainer:function(a){this.off(),this.container=a,this.on()},refreshContainerRect:function(){var a=this.offset=this.container.offset(),b=this.container.width(),c=this.container.height();this.containerRect.set(a.left,a.top,b,c)},canTypeBeActivated:function(a){return!(a&&a.activeComponent&&"function"==typeof a.activeComponent.isSelectionLocked?a.activeComponent.isSelectionLocked():this._isLocked)},on:function(){function a(){if(o._activeType&&o._activeType!==m){var a=o._activeType.getActiveDimensions();o._activeType.getActiveMode()===m.getActiveMode()&&l(a,m.getActiveDimensions())||(o._activeType.clearSelection(),o.ResetSelections.emit()),o._activeType.cancel()}o._activeType=m}function b(){a(),p._disableSelectionActivation||o.activate()}function c(){return o._active&&!d.isInEditMode()}function g(){return m&&p.swipe}function h(a,b){n=b,m=a,o.refreshContainerRect(),m&&m.initComponent(b)}function k(a,b){j.addInteraction(o._eventHandlers,a.container,1,["tap","swipe","taptwo"],p.swipe,b)}if(!this._isListening){this._isListening=!0;var m,o=this,p=this.options;this._reset=function(){m=null},this.getActiveType=function(){return o._activeType},this.getActiveMode=function(){return o._activeType?o._activeType.getActiveMode():null},this._setTypeOnAutoActivate=function(){m=o.types.dataArea},this._activateType=function(b){m=b,a()},this._mouseUp=function(a){1===a.which&&(!o._shiftPressed&&o._drawingWithShift||o._shiftPressed&&o._drawingWithoutShift)&&o.Lasso.emit(!o.lassoEnabled)},this._shiftToggle=function(a){
o._shiftPressed=a,o._allowLasso&&o._keyboard&&!o._drawingWithShift&&!o._drawingWithoutShift&&o._active&&o.Lasso.emit(!o.lassoEnabled)},this._keyPressed=function(a){o._keyboard&&c()&&(27===a?o.cancel():13===a&&(m&&m.getIsEditing&&m.getIsEditing()?m.confirmEdit():o.confirm()))},j.ShiftToggle.bind(this._shiftToggle),j.KeyPressed.bind(this._keyPressed),j.MouseUp.bind(this._mouseUp),this.types.range&&this.types.range.on&&this.types.range.on();var q,r=!1;this._eventHandlers=i.extend({tap:{start:function(a,b,c){h(c,b.pagePoints[0]),document.activeElement&&document.activeElement.blur()},end:function(a,c){if(m&&!m.internal&&p.toggle){if(!o.canTypeBeActivated(m))return void o.SelectWhileLocked.emit();b(),j.preventGestures(this),m.toggle.call(m,a,c.pagePoints[0]),m.getSelectedShapes().length>0&&o.Select.emit(m.getSelectedShapes(),o.getKeyAsToggleSelected(a))}}},taptwo:{start:function(){},end:function(a,c,d){if(p.toggleRect&&(h(d,c.pagePoints[0]),m&&p.toggle)){if(!o.canTypeBeActivated(m))return void o.SelectWhileLocked.emit();b(),m.toggleRect.call(m,a,c.pagePoints[0],c.pagePoints[1])}}},swipe:{start:function(a){if((g()||p._enablePanning)&&(o._shiftPressed&&!o._active&&o.allowLasso&&o.Lasso.emit(!o.lassoEnabled),m&&!m.internal)){if(o._drawingWithShift=o._shiftPressed,o._drawingWithoutShift=!o._shiftPressed,!o.lassoEnabled&&m.activeComponent&&m instanceof e)return void(this._isPanning=!0);if(m.activeComponent){if(this._isPanning=!1,r=!0,q=this.options.useMomentum,this.options.useMomentum=!1,!o.canTypeBeActivated(m))return void o.SelectWhileLocked.emit();b(),m.start.call(m,a,n)}}},update:function(a,b){if((g()||p._enablePanning)&&!this._isPanning&&r&&m){if(!o.canTypeBeActivated(m))return void o.SelectWhileLocked.emit();m.update.call(m,a,b.pagePoints[0])}},end:function(a,b){if(g()||p._enablePanning)if(o._drawingWithShift=!1,o._drawingWithoutShift=!1,this._isPanning)this._isPanning=!1;else if(r&&m){if(r=!1,this.options.useMomentum=q,!o.canTypeBeActivated(m))return void o.SelectWhileLocked.emit();m.end.call(m,a,b)}},cancel:function(){m&&r&&(this.options.useMomentum=q,m.cancel.call(m,!0))}},exclusive:function(){return o.lassoEnabled}}),this.registerAddedComponent=function(a,b){a.internal||a instanceof f&&"dataArea"===b.selectionIdentifier||k(b,a)},this.deregisterAddedComponent=function(a,b){a.internal||a instanceof f&&"dataArea"===b.selectionIdentifier||j.removeInteraction(o._eventHandlers,b.container)},Object.keys(this.types).map(function(a){return this.types[a]},this).forEach(function(a){return Object.keys(a.components).map(function(b){return a.components[b]}).forEach(function(b){b.forEach(function(b){o.registerAddedComponent(a,b)})})})}},register:function(a,b){this.registerAddedComponent&&this.registerAddedComponent(a,b)},deregister:function(a,b){this.deregisterAddedComponent&&this.deregisterAddedComponent(a,b)},off:function(){j.ShiftToggle.unbind(this._shiftToggle),j.KeyPressed.unbind(this._keyPressed),j.MouseUp.unbind(this._mouseUp),j.removeInteraction(this._eventHandlers),this.types.range&&this.types.range.off&&this.types.range.off(),this._isListening=!1,this.registerAddedComponent=null,this.deregisterAddedComponent=null},autoActivate:function(){!this._autoActivated&&this._isListening&&(this._autoActivated=!0,this._setTypeOnAutoActivate(),this._activeType=this.types.dataArea,this._activeType.initComponent(),this.activate())},activate:function(a){this._active||(this.Activated.emit(),this._active=!0,this._shiftPressed&&!this.lassoEnabled&&this.Lasso.emit(!0)),a&&this._activateType(a)},deactivate:function(a){this._active&&(this._active=!1,this._autoActivated=!1,a||this.clearSelection(),this._activeType&&(this._activeType.cancel(),this._activeType=void 0),this.Deactivated.emit(),this._reset())},confirm:function(){this._activeType&&this.deactivate(!0),this.Confirm.emit()},cancel:function(){this.deactivate(),this.Cancel.emit()},clearSelection:function(){this._activeType&&this._activeType.clearSelection()},toggleKeyboardAccelerators:function(a){this._keyboard=a},getKeyAsToggleSelected:function(a){return!(a.metaKey||a.ctrlKey)},release:function(){this.off(),c.release(this),Object.keys(this.types).forEach(function(a){this.types[a].release()},this)},setLocked:function(a){this._isLocked=a}}),Object.defineProperties(m.prototype,{allowLasso:{set:function(a){this._allowLasso=a},get:function(){return this._allowLasso}},lassoEnabled:{set:function(a){this._lassoEnabled=a&&this.allowLasso},get:function(){return this._lassoEnabled}}}),m}),define("objects.extension/default-view-selection-service",["qvangular","objects.views/selections/handler"],function(a,b){"use strict";a.service("qvDefaultViewSelectionService",[function(){return{createSelections:function(a,c,d,e){var f,g;if(d&&d.dataArea)return d.range&&(d.range.rtl="rtl"===a.options.direction),d.isPopover=a.options.isPopover,d.selectionsDisabled=a.options.selectionsDisabled||!1,f=new b(c,d,e),f.Activated.bind(function(){a.selectionsApi.activated()}),f.Deactivated.bind(function(){a.selectionsApi.deactivateSearch&&a.selectionsApi.deactivateSearch()}),f.Cancel.bind(function(){a.selectionsApi.cancel()}),f.Select.bind(function(){a.selectionsApi.selectionsMade=!0}),f.SelectRange.bind(function(){a.selectionsApi.selectionsMade=!0}),f.SelectAttributeDim.bind(function(){a.selectionsApi.selectionsMade=!0}),f.Confirm.bind(function(){a.backendApi.endSelections(!0),a.selectionsApi.deactivated()}),f.ResetSelections.bind(function(){a.backendApi.clearSelections()}),a.selectionsApi.confirm=function(){f&&f.confirm()},g=a.selectionsApi.deactivated.bind(a.selectionsApi),a.selectionsApi.deactivated=function(){f&&f.deactivate(),g()},a.selectionsApi.deactivate=function(){f&&(f.deactivate(),this.deactivated())},a.selectionsApi.clear=function(){f.clearSelection(),a.backendApi.clearSelections(),a.tooltipApi.cancel(),a.selectionsApi.selectionsMade=!1},a.selectionsApi.toggleKeyboardAccelerators=function(a){f.toggleKeyboardAccelerators(a)},a.selectionsApi.getKeyAsToggleSelected=function(a){return f.getKeyAsToggleSelected(a)},a.selectionsApi.toggleSearch=function(){a.options.search.toggle()},a.selectionsApi.activate=function(){f.autoActivate()},a.selectionsApi.on=function(){f.on()},a.selectionsApi.off=function(){f.off()},a.$on("$destroy",function(){f&&(f.release(),f=null)}),f}}}])}),define("objects.extension/default-controller",["objects.extension/base-controller","util","core.utils/deferred","objects.views/charts/tooltip/chart-tooltip","objects.views/selections/cache","objects.extension/default-view-selection-service"],function(a,b,c,d,e){"use strict";var f;return f=a.extend({$scope:null,$element:null,api:null,view:null,_create:function(a,c,d,f,g,h,i){f.navigation=f.navigation!==!1;var j=this._createView(a,c,d,f,h,i),k=new e;if(g.selections){var l=b.extend(!0,{},g.selections,f.selections||{});f.selections!==!1&&f._disableSelections!==!0&&this._createSelections(j,a,c,l,k)}return g.tooltips&&f.tooltips!==!1&&this._createTooltip(j,a,c,b.extend(!0,{},g.tooltips,f.tooltips||{}),k,f.cssTransform),j},_createView:function(a,b,c,d,e,f){return new c(a,b,d,e,f)},_createSelections:function(a,b,c,d,e){var f=this.selectionService.createSelections(b,c,d,e);return a.setSelections(f),f},_createTooltip:function(a,b,c,e,f,g){var h=new d(c,e,f);h.setCssTransform(g),b.tooltipApi.cancel=function(){h.cancel()},a.setTooltips(h)},init:function(a,b,c){this.$scope=a,this.$element=b,this.selectionService=c;var d=this,e=this.view=this._create(a,b,a.ext.View,a.options,a.ext.options,a.backendApi,a.selectionsApi);e.initialize(),this._handleSpecialCaseForSyntaxSugarInExtension(e),a.$on("$destroy",function(){e&&(e.destroy(e),a.options=null,d.view=null,e=null)})},_handleSpecialCaseForSyntaxSugarInExtension:function(a){var b,c=this.$scope.object.ext;for(b in c)"View"!==b&&"constructor"!==b&&"options"!==b&&"init"!==b&&"destroy"!==b&&a[b]&&(a[b]=c[b])},onPaint:function(a,b){var d=this.view,e=this.$scope;return c.resolve().then(function(){if(d&&!d.suppressOnPaint(e.layout))return d.refreshSelections(),d.prePaint(e.layout),d.updateData(e.layout).then(function(){if(b.visible){var a=d.$element;return e.ext.hasDefaultTemplate()&&(a=a.children().first()),d.paint(a,e.layout)}})})},onResize:function(a,b){var d=this.view,e=this.$scope;return d.refreshSelections(),c.resolve().then(function(){var c=d.$element;return e.ext.hasDefaultTemplate()&&(c=c.children().first()),d.resize(c,a,b)})},setInteractionState:function(a){this.view&&this.view.setInteractionState(a)},setDirection:function(a){this.view&&this.view.setDirection(a)},setBackendApi:function(a){this.view.setBackendApi(a)},setSnapshotData:function(a,b){return this.view.setSnapshotData(a,b)},getContextMenu:function(a,b){return this.view.getContextMenu(a,b)},getSelectionToolbar:function(){return this.view.getSelectionToolbar()},getViewState:function(){return this.view.getViewState()},getPreferredSize:function(){return this.view.getPreferredSize()}}),f.$inject=["$scope","$element","qvDefaultViewSelectionService"],f}),define("text!objects/inline-title-edit.ng.html",[],function(){return'<div ng-show="!editing && displayValue == \'\'" class="qv-inline-edit-button">\n\t<div qva-direction x-dir-setting="{{dirSetting}}" class="add-content" q-title-translation="{{emptyTranslation}}">\n\t\t<span class="lui-icon lui-icon--plus"></span>\n\t\t<span class="add-text" qva-direction x-dir-text="{{addTranslation}}" title="{{addTranslation}}">{{addTranslation}}</span>\n\t</div>\n</div>\n<div qva-direction x-dir-setting="{{dirSetting}}" x-dir-text="{{displayValue}}" ng-show="!editing && displayValue != \'\'" class="qv-inline-edit-value">{{displayValue}}</div>\n<input qva-direction x-dir-setting="{{dirSetting}}" x-dir-text="{{displayValue}}" ng-show="editing" class="qv-inline-edit-input" type="text" ng-model="titleValue" qv-inline-title-input maxlength="255"/>\n'}),define("objects/inline-title-edit",["qvangular","angular","translator","core.models/rpc-base","client.utils/property-resolver","text!./inline-title-edit.ng.html"],function(a,b,c,d,e,f){"use strict";function g(a){return"object"==typeof a&&(a=a.qStringExpression.qExpr,"="!==a[0]&&(a="="+a)),a}function h(a){return a&&0===a.indexOf("=")?{qStringExpression:{qExpr:a}}:a}a.directive("qvInlineTitleInput",[function(){return{priority:1,require:"ngModel",link:function(b,c,d,e){c.unbind("input keydown change compositionend"),c.bind("blur",function(){a.$apply(b,function(){e.$setViewValue(c.val()),b.doEdit()})}),b.$on("$destroy",function(){c.trigger("blur")}),c.bind("keydown",function(a){a.stopPropagation(),27===a.which?(c.val(e.$viewValue),c.trigger("blur")):13===a.which&&"textarea"!==c[0].nodeName.toLowerCase()&&c.trigger("blur")})}}}]),a.directive("qvInlineTitleEdit",["$timeout",function(a){return{template:f,restrict:"A",scope:{model:"=",propertyPath:"@",layoutPath:"@",emptyTranslation:"@",dirSetting:"@"},priority:1,link:function(f,i){var j=i.children().first(),k=i.children().eq(1),l=i.children().eq(2);f.editing=!1,f.titleProperty="",f.titleValue="",f.addTranslation=c.get(f.emptyTranslation),d.bindLayout(f,"model",function(a){f.displayValue=e.getValue(a,f.layoutPath),f.editing=!1}),f.doEdit=function(){var a=h(f.titleValue);f.editing&&(b.equals(m,a)?f.editing=!1:f.model.getProperties().then(function(b){e.setValue(b,f.propertyPath,a),f.model.save(),m=a}))};var m;j.add(k).on("qv-activate",function(){f.editing||f.model.getProperties().then(function(b){var c,d=l.get(0);f.editing=!0,f.titleProperty=e.getValue(b,f.propertyPath),f.titleValue=g(f.titleProperty),m=f.titleProperty,d.scrollLeft=d.scrollWidth,c=g(f.titleProperty).length,d.selectionStart=c,d.selectionEnd=c,a(function(){d.focus(),d.setSelectionRange(c,c)})})})}}}])}),define("objects.utils/layout",[],function(){"use strict";function a(a,b){var c;for(c=0;c<i;++c)if(a>=f[c][0]&&b>=f[c][1])return f[c][2];return e.SPARK}function b(a){var b;for(b=0;b<i;++b)if(a>=g[b][0])return g[b][1];return e.SPARK}function c(a){var b;for(b=0;b<i;++b)if(a>=h[b][0])return h[b][1];return e.SPARK}function d(a){var b=Object.keys(e).filter(function(b){return e[b]===a})[0];return b&&b.toLowerCase()||""}var e={SPARK:1,XSMALL:3,SMALL:7,MEDIUM:15,FULL:31},f=[[550,450,e.FULL],[400,220,e.MEDIUM],[300,150,e.SMALL],[150,75,e.XSMALL],[0,0,e.SPARK]],g=[[450,e.FULL],[220,e.MEDIUM],[150,e.SMALL],[75,e.XSMALL],[0,e.SPARK]],h=[[550,e.FULL],[400,e.MEDIUM],[300,e.SMALL],[150,e.XSMALL],[0,e.SPARK]],i=f.length;return{LayoutMode:e,getLayoutMode:a,getLayoutModeKey:d,getHorizontalLayoutMode:c,getVerticalLayoutMode:b}}),define("text!objects/object.ng.html",[],function(){return'<div class="qv-object-wrapper" ng-class="wrapperClassList">\n\n\t<article class="qv-object qvt-visualization" ng-class="classList" tid="{{objectClass}}">\n\t\t<div class="qv-inner-object">\n\t\t\t<qv-rain ng-if="object.throbberApi.isVisible" show="object.throbberApi.isVisible" resize="object.throbberApi.watchResize"></qv-rain>\n\t\t\t<div class="retry-overlay" ng-if="object.throbberApi.isQueryCanceled">\n\t\t\t\t<ul class="cancelled-list">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="retry-text" q-translation="Object.Cancelled"></div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<button class="retry-button lui-button" qva-activate="retry()" q-translation="Dialog.Button.Retry" tid="retry-calculations"></button>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div class="cancel-overlay" ng-if="object.throbberApi.isLongRunningQuery">\n\t\t\t\t<button class="cancel-button lui-button" ng-if="!object.throbberApi.isQueryCanceled" qva-activate="cancel()"\n\t\t\t\t\t\tq-translation="Common.Cancel" tid="cancel-calculations"></button>\n\t\t\t</div>\n\n\t\t<header qva-direction x-dir-setting="{{options.direction}}" class="qv-object-header" ng-class="{\'thin\' : !object.showTitles || ( layout.title === \'\' && layout.subtitle === \'\' && !object._inEditState )}">\n\t\t\t<h1 ng-show="object.showTitles" qva-direction x-dir-setting="{{options.direction}}" ng-attr-title="{{layout.title}}" class="qv-object-title qvt-visualization-title" qva-activate="titleClicked();">\n\t\t\t\t\t<a ng-if="options.showSearch && !object.isReadonly && !object.backendApi.isLocked() && !object._inEditState" q-title-translation="Common.Search" class="qv-object-search lui-icon lui-icon--search"\n\t\t\t\t\t   qva-activate="options.showSearch && options.search.toggle()"></a>\n\t\t\t\t<a ng-if="options.showSearch && !object.isReadonly && object.backendApi.isLocked()" class="qv-object-locked lui-icon lui-icon--lock"\n\t\t\t\t\t   qva-activate="titleClicked()"></a>\n\t\t\t\t<div ng-if="options.highlightTitle && (!object._inEditState || object._inEditState && object.isReadonly)" qve-highlight text="{{layout.title}}" query="options.highlightQuery" class="qv-object-title-text" qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{layout.title}}"></div>\n\t\t\t\t<div ng-if="!options.highlightTitle && (!object._inEditState || object._inEditState && object.isReadonly)" class="qv-object-title-text" qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{layout.title}}">{{layout.title}}</div>\n\t\t\t\t<div ng-if="options.showDisclaimerStar && !!layout.title && !object._inEditState" class="disclaimer qv-object-title-text">*</div>\n\t\t\t\t<div ng-if="object._inEditState && !object.isReadonly" qv-inline-title-edit x-dir-setting="{{options.direction}}" x-model="model" x-property-path="title" x-layout-path="title"\n\t\t\t\t\t x-empty-translation="Object.AddTitle" class="qv-object-title-edit" qva-direction x-dir-setting="{{options.direction}}"></div>\n\t\t\t\t</h1>\n\n\t\t\t<h2 ng-if="!!layout.subtitle && object.showTitles" qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{layout.subtitle}}" ng-attr-title="{{layout.subtitle}}" ng-show="!!layout.subtitle" class="qv-object-subtitle qvt-visualization-subtitle">{{layout.subtitle}}</h2>\n\t\t\t</header>\n\n\t\t\t<div class="qv-object-content-container">\n\t\t\t\t<div class="qv-object-content" qv-object-content component="object.content" options="options" object="object" backend-api="object.backendApi" layout="layout"\n\t\t\t\t ext="object.ext" selections-api="object.selectionsApi" tooltip-api="object.tooltipApi" throbber-api="object.throbberApi" on-init="onInit">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="qv-footer-wrapper" ng-show="object.hasFrame && object.showTitles && !!layout.footnote">\n\t\t\t<footer qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{layout.footnote}}" ng-attr-title="{{layout.footnote}}" ng-if="object.hasFrame && object.showTitles && !!layout.footnote" class="qv-object-footnote qvt-visualization-footnote">{{layout.footnote}}</footer>\n\t\t</div>\n\n\n\t<div qva-direction x-dir-setting="{{options.direction}}" class="qv-object-nav" ng-class="{\'zero-top\' : options.isZoomed, \'visible\' : navMenu.visible, \'active\': options.isActive, \'inline\' : thinHeader}">\n\t\t\t<a ng-repeat="menuItem in navMenu.items"\n\t\t\t   ng-if="menuItem.isVisible()"\n\t\t\t   ng-class="[menuItem.cssClasses, menuItem.dynamicCssClasses()]"\n\t\t\t   qva-activate="menuItem.action()"\n\t\t\t   q-title-translation="{{menuItem.translation}}"\n\t\t\t   tid="{{menuItem.tid}}"></a>\n\t\t</div>\n\n\t</article>\n\n\t<qv-soft-property-panel object="object" ng-if="options.isZoomed && object.hasSoftProperties" can-save-soft-properties="options.canSaveSoftProperties" ng-hide="!object.showExploreMenu"></qv-soft-property-panel>\n</div>\n'}),define("text!objects.requirements/requirements.ng.html",[],function(){return'<div qv-requirements class="requirements-wrapper" ng-show="show" ng-class="{\'incomplete\': !showAdd}">\n\t<div class="requirements">\n\t\t<h2 class="header">\n\t\t\t<i class="object-icon" ng-class="iconClass"></i>\n\t\t</h2>\n\t<p class="incomplete-text" ng-if="!showAdd" q-translation="Visualization.Requirements.IncompleteVisualization"></p>\n\t\t<!-- finished dimensions -->\n\t<ul ng-if="showAdd && finishedDimensions.length">\n\t\t<li ng-repeat="dimension in finishedDimensions" class="item" ng-class="{ finished: !dimension.invalid, invalid: dimension.invalid }"\n\t\t\ttid="{{ dimension.invalid ? \'invalid-dimension\' : \'added-dimension\'}}">\n\t\t\t<span class="text" title="{{dimension.title}}">{{dimension.title}}</span>\n\t\t\t<i class="lui-icon lui-icon--remove" qva-activate="removeDimension($index)" q-title-translation="Common.Delete"></i>\n\t\t\t</li>\n\t\t</ul>\n\t\t<!-- unfinished dimensions -->\n\t<ul ng-if="showAdd && unfinishedDimensions.length">\n\t\t<li ng-repeat="d in unfinishedDimensions" class="item missing" tid="missing-dimension">\n\t\t\t<button class="add-button lui-button" ng-class="{ \'lui-active\': d.active }" qva-activate="showAddDimension($event,d)"\n\t\t\t\t\tq-translation="Visualization.Requirements.AddDimension" tid="add-dimension"></button>\n\t\t\t</li>\n\t\t</ul>\n\t\t<!-- finished measures -->\n\t<ul ng-if="showAdd && finishedMeasures.length">\n\t\t<li ng-repeat="measure in finishedMeasures" class="item" ng-class="{ finished: !measure.invalid, invalid: measure.invalid }"\n\t\t\ttid="{{ measure.invalid ? \'invalid-measure\' : \'added-measure\'}}">\n\t\t\t<span class="text" title="{{measure.title}}">{{measure.title}}</span>\n\t\t\t<i class="lui-icon lui-icon--remove" qva-activate="removeMeasure($index)" q-title-translation="Common.Delete"></i>\n\t\t\t</li>\n\t\t</ul>\n\t\t<!-- unfinished measures -->\n\t<ul ng-if="showAdd && unfinishedMeasures.length">\n\t\t<li ng-repeat="m in unfinishedMeasures" class="item missing" tid="missing-measure">\n\t\t\t<button class="add-button lui-button" ng-class="{ \'lui-active\': m.active }" qva-activate="showAddMeasure($event,m)"\n\t\t\t\t\tq-translation="Visualization.Requirements.AddMeasure" tid="add-measure"></button>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n</div>\n'}),define("core.utils/help-url",["core.utils/external-urls"],function(a){function b(){var a=location.pathname.split("/").slice(-2,-1)[0];location.pathname.toLowerCase().indexOf("/workbench/")>-1?a="workbench":location.pathname.toLowerCase().indexOf("/dev-hub/")>-1?a="dev-hub":"qmc"!==a.toLowerCase()&&(a="client"),d+=a+"/"}var c={},d=a.serverHelpBaseUrl;return c.setBaseUrl=function(c){d=c?a.personalHelpBaseUrl:a.serverHelpBaseUrl,b()},Object.defineProperty(c,"path",{get:function(){return d}}),b(),c}),define("core.utils/environment",["core.utils/deferred","qvangular","core.utils/help-url"],function(a,b,c){var d={},e=null;return d.setup=function(d){return e||(e=new a,d.rpc({method:"IsPersonalMode",handle:-1,params:[]}).then(function(a){var d=a.result.qReturn;b.$rootScope.isPersonalMode=d,c.setBaseUrl(d),e.resolve({isPersonalMode:d})})),e.promise},d.inClient=function(){return document.body.classList.contains("qv-client")},d}),define("objects.error-handling/error-translation",["autogenerated/qix/engine-enums","translator"],function(a,b){"use strict";function c(a){return"ErrorCode."+a}var d=a.NxLocalizedErrorCode;return{getDimensionError:function(a){var e;return e=a===d.LOCERR_CALC_INVALID_DEF?"Object.ErrorMessage.InvalidDimension":a===d.LOCERR_CALC_NOT_IN_LIB?"Object.ErrorMessage.MissingDimension":c(a),b.get(e)},getMeasureError:function(a){var e;return e=a===d.LOCERR_CALC_INVALID_DEF?"Object.ErrorMessage.InvalidMeasure":a===d.LOCERR_CALC_NOT_IN_LIB?"Object.ErrorMessage.MissingMeasure":c(a),b.get(e)},getHyperCubeError:function(a){var d=c(a);return b.get(d)},getListObjectError:function(a){var d=c(a);return b.get(d)}}}),define("text!objects.add-popovers/add-dimension-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)" qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<object-add-typeahead>\n\t\t<div class="object-add-popover-header">\n\t\t\t<div class="lui-input-group">\n\t\t\t\t<input class="lui-input  lui-input-group__item  lui-input-group__input" type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\n\t\t\t\t\t   object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)" maxlength="255"/>\n\t\t\t\t<button ng-if="allowExpressionEditor !== false" class="lui-button  lui-input-group__item  lui-input-group__button" qva-activate="closeAddPopover()"\n\t\t\t\t\t\tpp-expression-editor="search.term" pp-expression-editor-on-apply="addFieldDimension({value:value})" expression-type="dimension"\n\t\t\t\t\t\tq-title-translation="Tooltip.OpenExpressionEditor">\n\t\t\t\t\t<span class="lui-button__icon  lui-icon  lui-icon--expression  edit-expression"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="object-add-popover-content" object-add-typeahead-menu>\n\t\t\t<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="dimension in dimensions" tid="dimension-item"\n\t\t\t\t\tobject-add-typeahead-item="dimension" on-select="addLibraryDimension(dimension)">\n\t\t\t\t\t<span qve-highlight text="{{dimension.label}}" title="{{dimension.label}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="field in fields" tid="field-item"\n\t\t\t\t\tobject-add-typeahead-item="field" on-select="addFieldDimension(field)"\n\t\t\t\t\tng-class="{\'derived-field\': (field.isDerived && search.term === \'\')}">\n\t\t\t\t\t<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery lui-list__aside" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\n\t\t\t\t\t<span ng-if="field.isDateField" class="lui-icon lui-icon--calendar icon-align"></span>\n\t\t\t\t\t<span ng-if="field.isGeoField" class="lui-icon lui-icon--map icon-align"></span>\n\t\t\t\t\t<span qve-highlight text="{{getFieldDisplayName(field)}}" title="{{field.toolTip}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\n\t\t</div>\n\t</object-add-typeahead>\n</immidiate-contextual>\n'}),define("text!objects.add-popovers/object-add-typeahead.ng.html",[],function(){return"<div ng-transclude></div>"}),define("general.services/aligner/aligner",[],function(){function a(a){this.container=a.container,this.body=a.body,this.alignAgainst=a.alignAgainst}return a.prototype.showTranscluded=function(a){a(function(a){this.container.appendTo(this.body).append(a)}.bind(this))},a.prototype.showContent=function(a){this.container.appendTo(this.body).append(a)},a.prototype.update=function(){var a=this.alignAgainst.offset();this.container.css({top:a.top,left:a.left,width:this.alignAgainst.width(),height:this.alignAgainst.height(),zIndex:1021})},a.prototype.hide=function(){this.container.remove()},a}),define("objects.add-popovers/object-add-typeahead",["qvangular","text!./object-add-typeahead.ng.html","general.services/aligner/aligner"],function(a,b){a.directive("objectAddTypeahead",[function(){return{template:b,scope:{},transclude:!0,replace:!0,restrict:"E",controller:["$scope",function(a){function b(){var b=a.menu;if(a.activeItem){var c=a.activeItem,d=c.getPosition();d.top<0?b.setScrollTop(c.getOffsetTop()):d.top+c.getHeight()>b.getHeight()&&c.scrollIntoView(!1)}else b.setScrollTop(0)}var c=this;a.items=[],this.activate=function(b){a.activeItem=b},this.nextItem=function(d){var e=a.items.indexOf(a.activeItem);"undefined"!=typeof d&&(e=(e+d)%a.items.length),e===a.items.length-1?c.activate(null):e===-1?c.activate(a.items[0]):c.activate(a.items[e+1]),b()},this.prevItem=function(d){var e=a.items.indexOf(a.activeItem);"undefined"!=typeof d&&(e=(e-d+a.items.length)%a.items.length),0===e?c.activate(null):e===-1?c.activate(a.items[a.items.length-1]):c.activate(a.items[e-1]),b()},this.getActiveItem=function(){return a.activeItem},this.selectActiveItem=function(){a.activeItem&&a.activeItem.select()},this.select=function(b){a.select({item:b}),a.activeItem=null},this.setMenu=function(b){a.menu=b},this.addItem=function(b){a.items.push(b)},this.removeItem=function(b){var c=a.items.indexOf(b);c>=0&&a.items.splice(c,1)}}]}}]),a.directive("objectAddTypeaheadInput",[function(){return{require:["^objectAddTypeahead","ngModel"],link:function(a,b,c,d){var e=d[0],f=d[1];b.on("keydown",function(b){b.stopPropagation(),13===b.which||9===b.which?(b.preventDefault(),e.getActiveItem()?a.$apply(function(){e.selectActiveItem()}):a.$apply(function(){a.$eval(c.onEnter,{$event:b})})):33===b.which?(b.preventDefault(),a.$apply(function(){e.prevItem(10)})):34===b.which?(b.preventDefault(),a.$apply(function(){e.nextItem(10)})):40===b.which?(b.preventDefault(),a.$apply(function(){e.nextItem()})):38===b.which?(b.preventDefault(),a.$apply(function(){e.prevItem()})):27===b.which&&(b.preventDefault(),a.$apply(function(){a.$eval(c.onEscape,{$event:b})}))}),a.$watch(e.getActiveItem,function(a){a?a.item.label&&b.val(a.item.label):b.val(f.$modelValue)}),a.$watch(f.$modelValue,function(a){a||e.activate(null)})}}}]),a.directive("objectAddTypeaheadMenu",[function(){return{require:"^objectAddTypeahead",link:function(a,b,c,d){a.controller=d,d.setMenu({getHeight:function(){return b.height()},setScrollTop:function(a){b[0].scrollTop=a}})}}}]),a.directive("objectAddTypeaheadItem",[function(){return{require:"^objectAddTypeahead",link:function(a,b,c,d){function e(){a.$eval(c.onSelect,{item:f})}var f=a.$eval(c.objectAddTypeaheadItem),g={item:f,getOffsetTop:function(){return b[0].offsetTop},scrollIntoView:function(a){b[0].scrollIntoView(a)},getPosition:function(){return b.position()},getHeight:function(){return b.height()},select:function(){e()}};d.addItem(g),a.$on("$destroy",function(){d.removeItem(g)}),a.$watch(function(){var a=d.getActiveItem();return!!a&&a.item===f},function(a){a?b.addClass("object-add-typeahead-active"):b.removeClass("object-add-typeahead-active")}),b.on("mouseenter",function(){b.addClass("object-add-typeahead-hover")}),b.on("mouseleave",function(){b.removeClass("object-add-typeahead-hover")}),b.on("qv-activate",function(b){b.preventDefault(),a.$apply(function(){e()})})}}}])}),define("objects.add-popovers/add-dimension-popover",["core.utils/deferred","general.utils/string-normalization","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-dimension-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","client.assets/tab-contents/fields/derived-field-formatter-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,c){return""===c?a:a.filter(function(a){return"undefined"!=typeof a.value&&b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var j=100,k={template:f,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=g.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=g.getTypeTranslationKey,b.autoFocus=d.treatAsDesktop(),b.position||(b.position="right"),b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.onEnter=function(a){""!==b.search.term?(a.stopPropagation(),b.addFieldDimension({value:b.search.term})):b.closeAddPopover()},b.getFieldDisplayName=function(a){return""===b.search.term?a.label:h.trimAutoCalendarName(a.value)};var f=null;b.$watch("search.term",function(d){function g(){var a=i(f.fields,d),e=i(f.dimensions,d);e.length>j?(e=c.limit(e,j),a=[]):a.length+e.length>j&&(a=c.limit(a,j-e.length)),b.fields=a,b.dimensions=e}f?g():a.all({fields:e.getSortedFields(b.app),dimensions:e.getSortedDimensions(b.app)}).then(function(a){var b=a.fields.map(function(a){var b=a.isDerived&&""===d?a.qName.substring(a.qName.lastIndexOf(".")+1,a.qName.length):a.qName;return{toolTip:a.qName,label:b,value:a.qName,trimmedValue:a.displayName,qTags:a.qTags,isDerived:a.isDerived,isDateField:a.isDateField,isGeoField:a.isGeoField}}),c=a.dimensions.map(function(a){return{label:a.qData.title,value:a.qData.title,libraryId:a.qInfo.qId}});f={fields:b,dimensions:c},g()})})}],scope:{alignTo:"=",app:"=",addFieldDimension:"=",addLibraryDimension:"=",qvaOutsideIgnoreFor:"=",closeAddPopover:"=",position:"=",allowExpressionEditor:"@"}};return k}),define("text!objects.add-popovers/add-measure-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)" qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<div class="object-add-popover" ng-show="!step2">\n\t\t<object-add-typeahead>\n\t\t\t<div class="object-add-popover-header">\n\t\t\t\t<div class="lui-input-group">\n\t\t\t\t\t<input class="lui-input  lui-input-group__item  lui-input-group__input" type="text" name="new-measure" autocomplete="off" ng-model="search.term" tid="add-measure-input" qva-focus="autoFocus"\n\t\t\t\t\t\t   maxlength="255" object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)"/>\n\n\t\t\t\t\t<button ng-if="allowExpressionEditor !== false" class="lui-button  lui-input-group__item  lui-input-group__button" qva-activate="closeAddPopover()"\n\t\t\t\t\t\t\tpp-expression-editor="search.term" pp-expression-editor-on-apply="addExpressionMeasure({value:value})" expression-type="measure"\n\t\t\t\t\t\t\tq-title-translation="Tooltip.OpenExpressionEditor">\n\t\t\t\t\t\t<span class="lui-button__icon  lui-icon  lui-icon--expression  edit-expression"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="object-add-popover-content" object-add-typeahead-menu>\n\t\t\t\t<div class="object-add-popover-list-header" ng-if="measures.length" q-translation="Common.Measures"></div>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="measure in measures" tid="measure-item"\n\t\t\t\t\t\tobject-add-typeahead-item="measure" on-select="addLibraryMeasure(measure)">\n\t\t\t\t\t\t<span qve-highlight text="{{measure.value}}" title="{{measure.value}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Visualization.Requirements.FromField"></div>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="field in fields" tid="field-item"\n\t\t\t\t\t\tobject-add-typeahead-item="field" on-select="showFromField(field)"\n\t\t\t\t\t\tng-class="{\'derived-field\': (field.isDerived && search.term === \'\')}"\t>\n\t\t\t\t\t\t<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery lui-list__aside" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\n\t\t\t\t\t\t<span ng-if="field.isGeoField" class="lui-icon lui-icon--map icon-align"></span>\n\t\t\t\t\t\t<span ng-if="field.isDateField" class="lui-icon lui-icon--calendar icon-align"></span>\n\t\t\t\t\t\t<span qve-highlight text="{{getFieldDisplayName(field)}}" title="{{field.toolTip}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t\t<i class="object-add-popover-toogle-step2-icon  lui-list__aside lui-icon  lui-icon--triangle-right"></i>\n\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-nohits" ng-if="!measures.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\n\t\t\t</div>\n\t\t</object-add-typeahead>\n\t</div>\n\t<div class="object-add-popover back" ng-show="step2">\n\t\t<div class="object-add-popover-header">\n\t\t\t<div qva-activate="goBack($event);">\n\t\t\t\t<i class="object-add-popover-back-icon  lui-icon  lui-icon--triangle-left"></i>\n\t\t\t\t<span q-translation="Visualization.Requirements.Back"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="object-add-popover-content">\n\t\t\t<div class="object-add-popover-list-header" q-translation="Visualization.Requirements.Aggregation"></div>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="suggestion in fieldSuggestions" qva-activate="addFromField(suggestion)" tid="from-field-item">\n\t\t\t\t\t<span class="lui-list__text lui-list__text--ellipsis" title="{{suggestion.aggregation}}({{suggestion.field}})">{{suggestion.aggregation}}({{suggestion.field}})</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</immidiate-contextual>\n';
}),define("objects.add-popovers/add-measure-popover",["core.utils/deferred","general.utils/string-normalization","util","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-measure-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","client.assets/tab-contents/fields/derived-field-formatter-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,c){return""===c?a:a.filter(function(a){return"undefined"!=typeof a.value&&b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var k=100,l={template:g,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=h.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=h.getTypeTranslationKey,b.autoFocus=e.treatAsDesktop(),b.position||(b.position="right"),b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.onEnter=function(a){""!==b.search.term?(a.stopPropagation(),b.addExpressionMeasure({value:b.search.term})):b.closeAddPopover()},b.showFromField=function(a){b.currentField=a,b.step2=!0},b.goBack=function(a){a.preventDefault(),b.currentField=null,b.step2=!1},b.$watch("currentField",function(a){a?b.fieldSuggestions=["Sum","Count","Avg","Min","Max"].map(function(a){var d=c.escapeField(b.currentField.value);return{aggregation:a,field:d}}):b.fieldSuggestions=[]}),b.addFromField=function(a){var c=a.aggregation+"("+a.field+")";b.addExpressionMeasure({value:c})},b.getFieldDisplayName=function(a){return""===b.search.term?a.label:i.trimAutoCalendarName(a.value)};var g=null;b.$watch("search.term",function(c){function e(){var a=j(g.measures,c),e=j(g.fields,c);a.length>k?(a=d.limit(a,k),e=[]):a.length+e.length>k&&(e=d.limit(e,k-a.length)),b.fields=e,b.measures=a}g?e():a.all({fields:f.getSortedFields(b.app),measures:f.getSortedMeasures(b.app)}).then(function(a){var b=a.fields.map(function(a){var b=a.isDerived&&""===c?a.qName.substring(a.qName.lastIndexOf(".")+1,a.qName.length):a.qName;return{toolTip:a.qName,value:a.qName,trimmedValue:a.displayName,label:b,field:a.qName,qTags:a.qTags,isDerived:a.isDerived,isDateField:a.isDateField,isGeoField:a.isGeoField}}),d=a.measures.map(function(a){return{value:a.qData.title,label:a.qData.title,libraryId:a.qInfo.qId}});g={fields:b,measures:d},e()})})}],scope:{alignTo:"=",app:"=",addExpressionMeasure:"=",addLibraryMeasure:"=",closeAddPopover:"=",qvaOutsideIgnoreFor:"=",position:"=",allowExpressionEditor:"@"}};return l}),define("objects.requirements/requirements",["jquery","text!./requirements.ng.html","client.utils/state","core.utils/environment","core.utils/deferred","general.services/show-service/show-service","objects.extension/base-controller","objects.error-handling/error-translation","core.utils/resize","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){var b,c=new Array(a);for(b=0;b<a;++b)c[b]={index:b};return c}function m(a){if(a.qHyperCube)return a.qHyperCube.qDimensionInfo||[];if(a.qChildList){var b=a.qChildList.qItems||[];return b.map(function(){return{}})}var c=!a.qListObject||!a.qListObject.qDimensionInfo||a.qListObject.qDimensionInfo.qError;return c?[]:[a.qListObject.qDimensionInfo]}function n(a){return a.qHyperCube?a.qHyperCube.qMeasureInfo||[]:[]}function o(a){var b=a&&a.substring(5),c="lui-icon lui-icon--";switch(b){case"bar-chart-vertical":return c.concat("bar-chart");case"components":return c.concat("scatter-chart");case"text-image":return c.concat("text");default:return c.concat(b)}}function p(a){a.showAdd=d.inClient()?c.isInEditMode()&&!a.object.isReadonly:!a.object.isReadonly}var q=null,r=g.extend({$scope:null,init:function(b){function d(){p(b)}function e(a){return b.object.ext.addFieldDimension(a,b.object).then(function(){b.object.model.save(),m()})}function g(a){return b.object.ext.addLibraryDimension(a,b.object).then(function(){b.object.model.save(),m()})}function h(a){return b.object.ext.addLibraryMeasure(a,b.object).then(function(){b.object.model.save(),m()})}function l(a){return b.object.ext.addExpressionMeasure(a,b.object).then(function(){b.object.model.save(),m()})}function m(b){n&&(n.destroy(),n=null),q&&(q.active=!1),b&&!a(b.target).hasClass("add-button")&&(q=null)}this.$scope=b,c.StateChanged.bind(d),b.$on("$destroy",function(){c.StateChanged.unbind(d)}),d(),b.removeDimension=function(a){b.object.model.getProperties().then(function(c){var d=b.object.getCreatePropertyHandler();d.setProperties(c),d.removeDimension(a).then(function(){b.object.model.save()})})},b.removeMeasure=function(a){b.object.model.getProperties().then(function(c){var d=b.object.getCreatePropertyHandler();d.setProperties(c),d.removeMeasure(a).then(function(){b.object.model.save()})})};var n;b.showAddDimension=function(c,d){if(q&&q===d)return void(q=null);var h=b.ext.addDimensionPopoverComponent||j;n=f.show(h,{alignTo:a(c.target),app:b.object.model.enigmaModel.app,closeAddPopover:m,addFieldDimension:e,addLibraryDimension:g}),d.active=!0,q=d},b.showAddMeasure=function(c,d){if(q&&q===d)return void(q=null);var e=b.ext.addMeasurePopoverComponent||k;n=f.show(e,{alignTo:a(c.target),app:b.object.model.enigmaModel.app,closeAddPopover:m,addLibraryMeasure:h,addExpressionMeasure:l}),d.active=!0,q=d},i.on("start",m),b.$on("$destroy",function(){i.off("start",m),m()})},onPaint:function(){var a,b,c=this.$scope,d=c.layout,f=c.ext.dimensionDefinition?c.ext.dimensionDefinition.min:0,g=c.ext.dimensionDefinition?c.ext.dimensionDefinition.max:0,i=c.ext.measureDefinition?c.ext.measureDefinition.min:0,j=c.ext.measureDefinition?c.ext.measureDefinition.max:0;return p(c),c.iconClass=o(c.object.ext.libraryInfo.templateIconClassName),c.minDimensions=f,c.minMeasures=i,c.maxDimensions=g,c.maxMeasures=j,f!==g||i!==j?c.headerStr="Visualization.Requirements.AddAtLeast":c.headerStr="Visualization.Requirements.Add",a=m(d).map(function(a){var b,c=a.qError&&a.qError.qErrorCode;return b=c?h.getDimensionError(c):a.title||a.qFallbackTitle,{invalid:!!c,title:b}}),b=n(d).map(function(a){var b,c=a.qError&&a.qError.qErrorCode;return b=c?h.getMeasureError(c):a.qFallbackTitle,{invalid:!!c,title:b}}),c.finishedDimensions=a,c.finishedMeasures=b,c.unfinishedDimensions=l(Math.max(0,c.minDimensions-c.finishedDimensions.length)),c.unfinishedMeasures=l(Math.max(0,c.minMeasures-c.finishedMeasures.length)),c.show=!0,e.resolve()}});return r.$inject=["$scope"],{template:b,controller:r}}),define("text!objects.error-handling/error-info-popup.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" width="200" position="\'top\'" collision="\'flipfit\'" class="qui-immidiateContextual" on-close-view="onClose(event)">\n\t<div class="object-error-popup">\n\t\t<!--<div class="object-error-title" q-translation="{{error.title}}"></div>-->\n\t\t<div class="object-error-message">{{error.message}}</div>\n\t</div>\n</immidiate-contextual>'}),define("objects.error-handling/error-info-popup",["text!objects.error-handling/error-info-popup.ng.html","core.utils/resize"],function(a,b){"use strict";return{template:a,controller:["$scope",function(a){function c(){a.onClose()}a.$on("$destroy",function(){b.off("start",c)}),b.on("start",c)}]}}),define("text!objects.error-handling/error.ng.html",[],function(){return'<div qv-errorhandler class="object-error" ng-class="error.class" tid="object.Error">\n\t<div class="object-error-content">\n\t\t<div class="object-error-title">\n\t\t\t<span>{{error.title}}</span>\n\t\t\t<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\n\t\t</div>\n\t\t<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\n\t</div>\n</div>\n'}),define("objects.error-handling/error-handler",["angular","touche","translator","core.utils/deferred","./error-info-popup","text!./error.ng.html","objects.extension/base-controller","objects.error-handling/error-translation","autogenerated/qix/engine-enums"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return a.qErrorCode===i.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED}function k(a){var b={holder:null,type:""};return a.qHyperCube&&a.qHyperCube.qError?(b.holder=a.qHyperCube,b.errorTranslationFunc=h.getHyperCubeError):a.layers&&a.layers.length&&a.layers[0].qHyperCube?(a.layers[0].qHyperCube.qError?b.holder=a.layers[0].qHyperCube:a.layers[0].geodata.qHyperCube.qError&&(b.holder=a.layers[0].geodata.qHyperCube),b.errorTranslationFunc=h.getHyperCubeError):a.qListObject&&a.qListObject.qError?(b.holder=a.qListObject,b.errorTranslationFunc=h.getListObjectError):a.qListObject.qDimensionInfo&&a.qListObject.qDimensionInfo.qError.qErrorCode&&(b.holder=a.qListObject.qDimensionInfo,b.errorTranslationFunc=h.getDimensionError),b}function l(a){var b=a.qError.qErrorCode;switch(b){case i.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED:return a.customErrorMessage?a.customErrorMessage.calcCond:""}}var m=g.extend({$scope:null,init:function(c){this.$scope=c,c.hasSoftError=!1,c.hasHardError=!1,c.showMore=function(d){var f=a.element("<div>").appendTo("body");f.showComponent(e,{alignTo:a.element(d.target),error:c.error,onClose:function(){f.remove(),b.preventGestures()}})}},onPaint:function(){var a,b=this.$scope,e=b.object.error;if(!e){var f=b.layout,g=k(f);g.holder&&(a=l(g.holder)||g.errorTranslationFunc(g.holder.qError.qErrorCode),e=j(g.holder.qError)?{class:"soft-error",message:a}:{class:"hard-error",title:c.get("Object.Error"),message:a})}return b.error=e,d.resolve()}});return m.$inject=["$scope"],{template:f,controller:m}}),define("objects.utils/data-properties/empty-handler",["./data-property-handler","util"],function(a){"use strict";var b=a.extend({getDimensions:function(){return[]},getMeasures:function(){return[]}});return b}),define("text!objects.error-handling/invalid-type.ng.html",[],function(){return'<div class="object-error hard-error" tid="object.Error">\n\t<div class="object-error-content">\n\t\t<div class="object-error-title">\n\t\t\t<span>{{error.title}}</span>\n\t\t\t<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\n\t\t</div>\n\t\t<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\n\t\t<button ng-if="showButton" class="lui-button object-error-remove" qva-activate="remove($event)" q-translation="Common.Delete"></button>\n\t</div>\n</div>\n'}),define("objects.error-handling/invalid-type",["angular","touche","translator","objects.utils/data-properties/empty-handler","./error-info-popup","text!objects.error-handling/invalid-type.ng.html"],function(a,b,c,d,e,f){"use strict";return{type:"invalid",template:f,definition:{type:"items",items:{}},support:{exportData:!1},getContextMenu:function(){},hasError:function(){return!1},showRequirements:function(){return!1},getCreatePropertyHandler:function(a){return new d({app:a})},getDropFieldOptions:function(){},getDropDimensionOptions:function(){},getDropMeasureOptions:function(){},controller:["$scope",function(d){var f,g=d.object.error,h=c.get(g.title);f=Array.isArray(g.message)?c.get(g.message[0],g.message.slice(1)):c.get(g.message),d.error={title:h,message:f},d.showButton=d.options&&"function"==typeof d.options.removeIt,d.remove=function(a){d.options.removeIt(),a.stopPropagation()},d.showMore=function(c){var f=a.element("<div>").appendTo("body");f.showComponent(e,{alignTo:a.element(c.target),error:d.error,onClose:function(){f.remove(),b.preventGestures()}})}}]}}),define("objects.utils/resize",["pubsub"],function(a){function b(b){b=b||{},a.publish("/ui/object/resize",b)}["/resize/end","/ui/panel/toggle","/ui/grid/cellswap","/ui/grid/cellresize","/ui/grid/cellsplitting","/ui/grid/zoom/activated","/ui/grid/zoom/deactivated"].forEach(function(c){a.subscribe(c,b)})}),define("text!client.views/selection-toolbar/selection-toolbar.ng.html",[],function(){return'<div qva-direction class="qv-selection-toolbar qvt-selection-toolbar"\n\t ng-style="toolbar.style"\n\t ng-class="{ \'sel-toolbar-card\': !options.isPopover, \'sel-toolbar-popover\': options.isPopover, \'sel-toolbar-click-to-unlock-bg\': locked, \'sel-toolbar-menu-item\': locked }"\n\t qva-activate="locked && toggleLock($event);">\n    <div class="sel-toolbar-list-wrapper">\n\t\t<table class="sel-toolbar-list">\n            <tr>\n                <td class="sel-toolbar-list-item" ng-class="{ \'sel-toolbar-list-item-hide-more\': filteredMenuButtons.length === 0 }">\n                    <button tid="selection-toolbar.toggleShowMenu"\n                            class="sel-toolbar-btn sel-toolbar-icon sel-toolbar-icon-toggle"\n                            ng-class="{ \'menu-active\': toolbar.showMenu }"\n                            q-title-translation="{{toolbar.showMenu ? \'Tooltip.CloseSelectionMenu\' : \'Tooltip.SelectionMenu\'}}"\n                            qva-activate="toggleShowMenu($event)">\n                        <span class="lui-icon  lui-icon--more"></span>\n                    </button>\n                </td>\n                <td ng-if="toolbar.showLock || locked" class="sel-toolbar-list-item sel-toolbar-list-item-lockunlock">\n                    <button tid="selection-toolbar.lock"\n                            class="sel-toolbar-btn sel-toolbar-icon"\n                            q-title-translation="{{locked ? \'SelectionToolbar.ClickToUnlock\' : \'SelectionToolbar.ClickToLock\'}}"\n                            ng-disabled="locked ? false : !toolbar.backendApi.hasSelections()"\n                            qva-activate="!locked && toggleLock($event);">\n                        <span class="lui-icon sel-toolbar-span-icon" ng-class="!locked ? \'lui-icon--unlock\':\'lui-icon--lock sel-toolbar-menu-span-icon\'"></span>\n                    </button>\n                </td>\n                <td ng-show="locked" class="sel-toolbar-list-item-locked">\n                    <p class="sel-toolbar-menu-text" q-translation="SelectionToolbar.ClickToUnlock"></p>\n                </td>\n                <td ng-show="locked && options.smallDevice" qva-activate="toolbar.selectionsApi.confirm()" class="sel-toolbar-list-item-close">\n                    <qui-toolbarbutton>\n                        <span class="sel-toolbar-menu-text sel-toolbar-btn-close-text" q-translation="Common.Close"></span>\n                    </qui-toolbarbutton>\n                </td>\n                <td ng-show="!locked" ng-repeat="button in filteredButtons" class="sel-toolbar-list-item" ng-class="button.clazz">\n                    <button tid="{{button.tid}}"\n                            qva-activate="buttonAction($event, button)"\n                            q-title-translation="{{button.name}}"\n                            ng-disabled="buttonIsDisabled(button)"\n                            class="sel-toolbar-btn"\n                            ng-class="[button.buttonClass, button.isIcon ? \'sel-toolbar-icon\' : \'\', button.isActive(this) ? \'menu-active\' : \'\']">\n                        <span class="sel-toolbar-span-icon lui-icon" ng-class="button.iconClass"></span>\n                    </button>\n                </td>\n            </tr>\n        </table>\n\n    </div>\n\t<div ng-if="toolbar.showMenu" class="sel-toolbar-menu" ng-style="toolbar.menuStyle"\n\t\t qva-delegated-activate="div:not(.disabled)#menuAction($event);">\n\t\t<div ng-repeat="button in filteredMenuButtons" class="sel-toolbar-menu-item"\n\t\t\t tid="{{button.tid}}"\n\t\t\t q-title-translation="{{button.name}}"\n\t\t\t ng-class="{\'disabled\': buttonIsDisabled(button) }">\n\t\t\t<table class="sel-toolbar-menu-table" ng-class="{ \'selection-toolbar-menu-table-align-center\': filteredButtons.length === 0 }">\n\t\t\t\t<tr>\n\t\t\t\t\t<td><span class="sel-toolbar-menu-span-icon" ng-class="button.iconClass"></span></td>\n\t\t\t\t\t<td ng-if="filteredButtons.length !== 0"><p class="sel-toolbar-menu-text" q-translation="{{button.name}}"></p></td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n</div>\n'}),define("client.views/selection-toolbar/selection-toolbar",["jquery","qvangular","text!./selection-toolbar.ng.html","core.utils/deferred"],function(a,b,c,d){"use strict";var e,f,g=44,h=1,i=8,j=2;return b.componentDirective("qvaIncludeSelectionToolbar",{toolbar:"=",options:"="}),f={width:0,buttons:[],haveButtons:function(){return this.buttons.length>0},reset:function(a){this.width=a,this.buttons.length=0},freeWidth:function(){var a,b=0;for(a=0;a<this.buttons.length;a++)b+=this.buttons[a];return this.width-b}},e={template:c,controller:["$scope",function(b){function c(a,c,d){var e,k,l=0;for(f.reset(a-(i+2*j)),k=c.length-1;k>=0&&(e="sel-toolbar-icon-separator"!==c[k].buttonClass?g+i:h+i,e<=f.freeWidth());k--)f.buttons.push(e);for((b.toolbar.showLock||b.locked)&&(l+=g+i),(d.length>0||c.length>f.buttons.length)&&(l+=g+i);f.haveButtons()&&f.freeWidth()<l;)f.buttons.pop();return f.buttons.length}function e(){var a,d,e=[].concat(b.toolbar.buttons),f=[].concat(b.toolbar.menuButtons),g=c(b.toolbar.style.width,e,f);for(b.filteredButtons=[],b.filteredMenuButtons=[],a=0;a<g&&e.length;++a)b.filteredButtons.push(e.pop());for(b.filteredButtons.reverse();e.length;)d=e.pop(),"sel-toolbar-icon-separator"!==d.buttonClass&&b.filteredMenuButtons.push(d);for(;f.length;)b.filteredMenuButtons.push(f.shift())}function k(a){b.locked=a,b.toolbar.showMenu=!1,m.then(function(){e()})}var l=d(),m=l.promise;b.filteredButtons=[],b.filteredMenuButtons=[],b.selectionInfo={show:!1,selected:0,total:0},b.lassoEnabled=!1,this.confirm=function(){b.selectionsApi.confirm()},this.close=function(){b.destroyComponent()},b.buttonAction=function(a,c){a.originalEvent.preventDefault(),c.action.call(b.toolbar)},b.buttonIsDisabled=function(a){return"function"==typeof a.isDisabled&&a.isDisabled.call(b.toolbar)},b.menuAction=function(c){var d=a(c.target).scope();c.originalEvent.preventDefault(),d.button.action.call(b.toolbar),b.toolbar.showMenu=!b.toolbar.showMenu},b.toggleShowMenu=function(a){a.originalEvent.preventDefault(),b.toolbar.showMenu=!b.toolbar.showMenu},b.toggleLasso=function(){b.lassoEnabled=!b.lassoEnabled,b.toolbar.toggleLasso(b.lassoEnabled)},b.toggleLock=function(c){a(c.target).closest(".sel-toolbar-list-item-close").length>0||(c.originalEvent.preventDefault(),c.stopPropagation(),b.toolbar.backendApi.isLocked()?(b.toolbar.selectionsApi.selectionsMade=!0,b.toolbar.backendApi.unlock()):b.toolbar.backendApi.lock())},b.$watch("toolbar.backendApi.isLocked()",function(a){void 0!==a&&k(!!a)}),b.$watch("toolbar.position",function(a){a&&(b.toolbar.style=a,l.resolve(),k(!!b.toolbar.backendApi.isLocked&&b.toolbar.backendApi.isLocked()))}),b.$watch("toolbar.menuMaxHeight",function(a){a&&(b.toolbar.menuStyle={maxHeight:a})}),b.$watch("options.lassoEnabled",function(a){b.lassoEnabled=a})}]}}),define("client.views/selection-toolbar/selection-toolbar-service",["qvangular","client.views/selection-toolbar/selection-toolbar","util","core.utils/notification","angular"],function(a,b,c,d){"use strict";a.service("qvSelectionToolbarService",function(){function a(a,b){var c,d,e,f,g=a[0].getBoundingClientRect(),h=b[0].getBoundingClientRect();return b.is("th, td")&&(d=b.closest("table")[0].getBoundingClientRect(),c=b.prevAll(),e=c.length?c.last():b,f=e[0].getBoundingClientRect(),f.left-d.left===1)?{top:h.top-g.top,left:h.left-1-g.left,width:h.width}:{top:h.top-g.top,left:h.left-g.left,width:h.width}}var e,f,g;return e={open:function(d,e,h){var i=a(d,e),j={top:-44+i.top,width:i.width+(h.offsetWidth||0),left:i.left};h.toolbar=c.extend(!0,h.toolbar,{position:j,menuMaxHeight:h.menuMaxHeight}),f=angular.element("<div>"),g=f.showComponent(b,h),f.appendTo(d),this.Opened.emit()},close:function(){g&&(g.close(),this.Closed.emit(),g=void 0),f&&f.remove()},confirm:function(){g&&(g.confirm(),g=void 0),this.close()}},d.create(e,"Closed"),d.create(e,"Opened"),e})}),define("text!objects/throbber/throbber.ng.html",[],function(){return'<div ng-show="progress" class="qv-animate progress ng-hide">\n\t<div class="progress-loader" style="width:20%;height:20%;position:absolute;top:40%;left:40%"></div>\n</div>\n'}),define("objects/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(a,b){"use strict";a.directive("qvThrobber",["$timeout",function(a){return{replace:!0,template:b,restrict:"E",scope:{model:"=",progress:"=",delay:"=",disabled:"="},link:function(b){var c;b.$watch("model.isValidating",function(d){return b.disabled===!0?void(b.progress=!1):void(b.model&&void 0===b.model.state?b.progress=!0:d?(c&&a.cancel(c),c=a(function(){b.model&&b.model.isValidating&&(b.progress=!0)},b.delay||1e3)):b.progress=!1)})}}}])}),define("text!general.services/loader/rain/rain.ng.html",[],function(){return'<div class="rain progress" ng-class="{\'qv-fade-out\': fadeOut}">\n\t<div class="rain-progress" ng-style="rainStyle">\n\t\t<div class="progress-div rotating" ng-class="ngClasses">\n\t\t</div>\n\t</div>\n\t<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\n\t\t<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\n\t\t<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\n\t</div>\n</div>\n'}),define("general.services/loader/rain/rain",["qvangular","text!../rain/rain.ng.html"],function(a,b){"use strict";a.directive("qvRain",[function(){return{replace:!0,template:b,restrict:"E",scope:{show:"=",resize:"=?",messageObj:"=?"},link:function(a,b){function c(){var c=b[0].getBoundingClientRect(),d=Math.min(c.width,c.height);d=.3*d,a.rainStyle.height=d+"px",a.rainStyle.width=d+"px",a.rainStyle.top=(c.height-d)/2,a.rainStyle.left=(c.width-d)/2}a.rainStyle={},a.$watch("show",function(a){void 0!==a&&a&&c()}),a.resize&&a.resize(c),c()}}}])}),define("objects/object",["jquery","qvangular","core.utils/deferred","general.utils/visualizations","objects.models/visualization-object","objects.utils/layout","objects.utils/type-loader","text!./object.ng.html","pubsub","general.utils/responsive-state","objects.extension/extension-type","util","translator","objects.requirements/requirements","objects.error-handling/error-handler","core.utils/resize","objects.extension/base-controller","objects.extension/default-controller","objects.utils/interaction-states","client.utils/theme/theme","objects.error-handling/invalid-type","objects.utils/resize","client.views/selection-toolbar/selection-toolbar-service","objects/throbber/throbber","general.services/loader/rain/rain"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";function u(a){a.selectionsApi&&a.selectionsApi.active&&a.selectionsApi.confirm()}function v(a,c){function d(){return!a.options||a.options.isVisible!==!1}function e(){u(c)}function f(){d()&&(b.$apply(a,function(){c.resize()}),c.throbberApi.resize(),c.explore.resize())}function g(){h||(h=setTimeout(function(){f(),clearTimeout(h),h=null},100))}var h;a.$on("resizeCell",function(){g()}),i.subscribe("/ui/object/resize."+a.$id,function(){g()}),p.on("start."+a.$id,e),a.$on("$destroy",function(){clearTimeout(h),i.unsubscribe("."+a.$id),p.off("start."+a.$id,e)})}function w(a,b){function c(c){a.model.isCancelled||(a.layout=c,b.setLayout(c,a.options))}function d(a){b.model&&h(b.model),g(a),b.setModel(a)}function f(){b.setRenderState(D.INVALID)}function g(a){a.Invalidated&&!a.isCancelled&&a.Invalidated.bind(f)}function h(a){a.Invalidated&&a.Invalidated.unbind(f)}var i;a.object._forcePaint=!0,i=e.bindLayout(a,"model",c,d),a.$on("$destroy",function(){b.model&&h(b.model),i&&i()})}function x(a,c,d,e){function g(){return!a.options||a.options.isVisible!==!1}var h,i,j,k,l,n;c.setObjectClass=function(b){k||(k=d.find(".qv-object")),(b||void 0===l)&&(l=k[0].clientWidth),(b||void 0===n)&&(n=k[0].clientHeight);var e=f.getLayoutMode(l,n),g=c.type&&c.type.type,h=[];c.supportSnapshot()&&h.push("qv-can-take-snapshot"),c.selectionsApi&&c.selectionsApi.active&&h.push("qv-selections-active"),c.objectSize={w:l,h:n},a.options.layoutMode=e;var i="qv-layout-"+f.getLayoutModeKey(e);h.push(i),a.objectClass="qv-object-"+g,h.push(a.objectClass),c.selectionClass&&h.push(c.selectionClass),a.classList=h,a.wrapperClassList=[],a.object&&a.object.hasFrame&&a.object.showTitles&&a.layout.footnote&&a.wrapperClassList.push("has-footnote"),a.thinHeader=!c.showTitles||""===a.layout.title&&""===a.layout.subtitle&&!c._inEditState},c.update=function(){if(this.valid){var d=this;h=b.getService("$timeout")(function(){c.backendApi&&c.backendApi.updateCache(a.layout),c.setObjectClass(),a.$digest(),d.loadContent(),e.contentLoaded().then(function(b){try{return b.onPaint(a.layout,{visible:g()}).then(function(){c.setRenderState(D.RENDERED),"function"==typeof a.options.onRendered&&a.options.onRendered.call(null)}).catch(function(){c.setRenderState(D.INVALID),"function"==typeof a.options.onRendered&&a.options.onRendered.call(null)})}catch(d){throw c.setRenderState(D.INVALID),c.error={class:"hard-error",title:m.get("Object.Error"),message:m.get("Object.ErrorMessage.RenderingFailed",c.ext&&c.ext.type)},e.updateContent(o).then(function(b){b.onPaint(a.layout,{visible:!1}).then(function(){c.setRenderState(D.RENDERED),"function"==typeof a.options.onRendered&&a.options.onRendered.call(null,d)})}),d}})})}},c.resize=function(){g()&&(c.setRenderState(D.INVALID),i=b.getService("$timeout")(function(){c.setObjectClass(!0),e.contentLoaded().then(function(b){b.onResize(a.layout).then(function(){c.setRenderState(D.RENDERED)})})}))},c.onResize=function(){e.contentLoaded().then(function(b){b.onResize(a.layout).then(function(){c.setRenderState(D.RENDERED)})})},a.$on("$destroy",function(){var a=b.getService("$timeout");a.cancel(h),a.cancel(i),j&&j.reject()})}function y(a,e,f,g){var h,i=c();f.loaded=i.promise,f.valid=!1,f.showExploreMenu=!1,f.loadContent=function(){var b,c={options:a.options,object:f,layout:a.layout,ext:f.ext};b=f.ext.hasError(c)?o:f.ext.showRequirements(c)?n:f.ext,g.updateContent(b)},f.reset=function(){this.valid&&(a.options=l.extend({},a.resetOptions,{isZoomed:a.options.isZoomed,interactionState:a.options.interactionState,direction:a.options.direction}),i=c(),this.loaded=i.promise,this.valid=!1)},f.validate=function(){this.valid||this.layout&&this.type&&this.ext&&(this.valid=!0,i.resolve())},f.setExtension=function(b){this.ext=b,a.ext=b,"invalid"!==b.type&&(b.mapProperties(this.model),b.mapSoftProperties(),this.setBackendApi()),this.validate(),this.update(),this.ext.model=this.model},f.setBackendApi=function(){var b=a.options.APIType||this.ext.BackendApi,c=this.backendApi=new b(this.model);g.contentLoaded().then(function(a){a.setBackendApi(c)})},f.setType=function(c,d){this.backendApi&&this.backendApi.destroy(),this.ext=null,this.backendApi=null,this.hasContent=!1,this.type=c,c.load().then(function(h){function i(){f.setExtension(h),z(a,e,f,g),d&&(b.$rootScope.$broadcast("refreshPropertyPanel"),b.$rootScope.$broadcast("reloadExploreContent"))}if(f.type===c)if(c!==C&&(f.error=null),"function"==typeof h.init){var j=h.init.call(null,e,f.layout);j&&"function"==typeof j.then?j.then(function(){i()},function(b){f.setRenderState(D.INVALID),f.error={class:"hard-error",title:m.get("Object.Invalid.Title"),message:b||m.get("Object.ErrorMessage.RenderingFailed",h.type)},g.updateContent(o).then(function(c){c.onPaint(a.layout,{visible:!1}).then(function(){f.setRenderState(D.RENDERED),"function"==typeof a.options.onRendered&&a.options.onRendered.call(null,b)})}),i()}):i()}else i()},function(){f.setType(C),f.error={class:"hard-error",title:m.get("Object.Invalid.Title"),message:m.get("Object.ErrorMessage.NotFound",c.type)},f.isInvalid=!0,f.setObjectClass()})},f.setModel=function(a){this.model=a,this.ext&&(this.ext.model=a,this.setBackendApi())},f.on=function(){g.contentLoaded().then(function(a){a.view&&a.view.on()})},f.off=function(){g.contentLoaded().then(function(a){a.view&&a.view.off()})},f.isOn=function(){return g.contentLoaded().then(function(a){return a.view?a.view.isOn():null})},f.setInteractionState=function(c){f._interactionState=c,f._inEditState=c===s.EDIT,f._inAnalysisState=c===s.ANALYSIS,a.options.interactionState=c,g.contentLoaded().then(function(a){c!==s.ANALYSIS&&u(f),a.setInteractionState(c),b.getService("$timeout").cancel(h),h=b.getService("$timeout")(function(){f.setObjectClass()})})},f.getInteractionState=function(){return f._interactionState},f.inAnalysisState=function(){return f._inAnalysisState},f.inEditState=function(){return f._inEditState},f.setDirection=function(b){b&&(a.options.direction=b,g.contentLoaded().then(function(a){a.setDirection(b)}))},f.setLayout=function(a){this.layout=a;var b=a.visualization||a.qInfo.qType,c=d.getType(b);a.qError&&(c=C,this.error={title:"Object.Error",message:"Object.Invalid.Info"}),c||(c=C,this.error={title:"Object.Invalid.Title",message:["Object.ErrorMessage.NotFound",b]}),this.type!==c&&(this.reset(),this.setType(c,!!this.type)),this.isInvalid=c===C,this.isLink=!this.isInvalid&&!!a.qExtendsId,this.showTitles=a.showTitles!==!1,this.validate(),this.update()}}function z(c,d,e){function f(b){var c=a(b.target);e.selectionsApi.ignoreOnOutside(c)||(e.selectionsApi.getDockToElement().off(".object"),e.selectionsApi.confirm())}function g(){return e.backendApi&&e.backendApi.endSelections(!0),null}e.activateSelections=function(){"undefined"!=typeof e.ext.options.selections&&e.inAnalysisState()&&e.selectionsApi.activate()},e.selectionsApi&&"function"==typeof e.selectionsApi.destroy&&e.selectionsApi.destroy(),e.tooltipApi={cancel:function(){},destroy:function(){}},e.selectionsApi={destroy:function(){this._activatedCallbacks=[],this._deactivatedCallbacks=[],a(window).off("onbeforeunload",g)},active:!1,selectionsMade:!1,_activatedCallbacks:[],_deactivatedCallbacks:[],on:function(){},off:function(){},ignoreOnOutside:function(a){return!(!a.closest(".qv-selection-toolbar").length&&!a.closest(".selections-data-area-ui").length)},getDockToElement:function(){return j.isSmallDevice?d:d.children(".qv-object")},getMenuMaxHeight:function(){return e.selectionsApi.getDockToElement().outerHeight()},getSelectionToolbarWidthOffset:function(){return 0},watchActivated:function(a){return this._activatedCallbacks.push(a),function(){var b=this._activatedCallbacks.indexOf(a);this._activatedCallbacks.splice(b,1)}.bind(this)},activated:function(h){this.active=!0,h||e.backendApi.beginSelections(),a(window).on("onbeforeunload",g),c.options.isPopover||(this.getDockToElement().on("qv-outside.object",f),b.$apply(c,function(){e.setObjectClass(),e.getSelectionToolbar().then(function(a){var f={toolbar:a,selectionsApi:e.selectionsApi,options:c.options,menuMaxHeight:e.selectionsApi.getMenuMaxHeight(),offsetWidth:e.selectionsApi.getSelectionToolbarWidthOffset()};b.getService("qvSelectionToolbarService").open(d,e.selectionsApi.getDockToElement(),f)})})),this._activatedCallbacks.forEach(function(a){a.call(this)},this)},watchDeactivated:function(a){return this._deactivatedCallbacks.push(a),function(){var b=this._deactivatedCallbacks.indexOf(a);this._deactivatedCallbacks.splice(b,1)}.bind(this)},deactivated:function(){a(window).off("onbeforeunload",g),this.active=!1,this.selectionsMade=!1,e.tooltipApi.cancel(),c.options.isPopover||(e.selectionsApi.getDockToElement().off(".object"),b.$apply(c,function(){e.setObjectClass(),b.getService("qvSelectionToolbarService").close()})),this._deactivatedCallbacks.forEach(function(a){a.call(this)},this)},confirm:function(){e.selectionsApi.deactivateSearch&&e.selectionsApi.deactivateSearch(),e.backendApi.endSelections(!0),e.tooltipApi.cancel(),this.deactivated()},cancel:function(){e.selectionsApi.deactivateSearch&&e.selectionsApi.deactivateSearch(),e.backendApi.endSelections(!1),e.tooltipApi.cancel(),this.deactivated()},clear:function(){e.backendApi.clearSelections(),e.tooltipApi.cancel(),this.selectionsMade=!1},toggleKeyboardAccelerators:function(){},getKeyAsToggleSelected:function(a){return!(a.metaKey||a.ctrlKey)},search:function(){},confirmSearch:function(){},cancelSearch:function(){},activate:function(){this.active||this.activated();
}}}function A(a,c){function d(d,e){b.getService("$timeout").cancel(f),b.getService("$timeout").cancel(g),c.selectionsApi&&c.selectionsApi.active?c.throbberApi.hide():a.model&&void 0===a.model.state?c.throbberApi.show():a.model&&a.model.isCancelled?c.throbberApi.isQueryCanceled=!0:d?(f=b.getService("$timeout")(function(){a.model&&a.model.isValidating&&c.throbberApi.show()},e),g=b.getService("$timeout")(function(){c.throbberApi.isVisible===!0&&(c.throbberApi.isLongRunningQuery=!0,c.throbberApi.isQueryCanceled=!1)},8e3)):(c.throbberApi.hide(),c.throbberApi.isLongRunningQuery=!1)}var e,f,g;c.throbberApi&&"function"==typeof c.throbberApi.destroy&&c.throbberApi.destroy(),c.throbberApi={resizeCallbacks:[],isVisible:!1,isLongRunningQuery:!1,isQueryCanceled:!1,initialize:function(){e=a.$watch("model.isValidating",function(a){d(a,1e3)})},reset:function(a){d(a,0)},show:function(){c.throbberApi.isVisible=!0,c.throbberApi.isQueryCanceled=!1,c.throbberApi.isLongRunningQuery=!1},hide:function(){c.throbberApi.isVisible=!1,c.throbberApi.isLongRunningQuery=!1,b.getService("$timeout").cancel(f),b.getService("$timeout").cancel(g)},off:function(){e(),b.getService("$timeout").cancel(f),b.getService("$timeout").cancel(g)},destroy:function(){c.throbberApi.off(),c.throbberApi.resizeCallbacks.length=0},resize:function(){c.throbberApi.resizeCallbacks.forEach(function(a){a()})},watchResize:function(a){c.throbberApi.resizeCallbacks.push(a)}},c.throbberApi.initialize()}function B(a,b){b.explore={resizeCallbacks:[],resize:function(){b.explore.resizeCallbacks.forEach(function(a){a()})},watchResize:function(a){b.explore.resizeCallbacks.push(a)},unwatchResize:function(a){var c=b.explore.resizeCallbacks.indexOf(a);c!==-1&&b.explore.resizeCallbacks.splice(c,1)},destroy:function(){b.explore.resizeCallbacks=[]}}}var C=new k({type:"invalid",path:"objects.error-handling/invalid-type"}),D={INVALID:0,RENDERED:1};b.componentDirective("qvObjectContent",{object:"=",backendApi:"=",ext:"=",options:"=",layout:"=",selectionsApi:"=",tooltipApi:"=",throbberApi:"=",onInit:"="},null,function(a,b,c){b.onInit(a,b,c)}),b.directive("qvObject",function(){return{restrict:"E",replace:!0,template:h,scope:{options:"=",model:"=",object:"=?",navMenu:"=",snapshot:"=?"},controller:["$scope","qvDefaultViewSelectionService",function(a,b){var d=c();this.updateContent=function(b){var e=a.object;return e&&e.content!==b&&("undefined"!=typeof e.content&&(d=c()),e.content=b),d.promise},this.contentLoaded=function(){return d.promise},a.onInit=function(a,c,e){a instanceof q||(a=new(r.extend(a))(c,e,b)),d.resolve(a)}}],link:function(c,d,e,f){function h(a,b,d){var e=m&&c.ext&&!(c.model&&!c.model.isValid&&!c.model.isValidating);return b||(e=e&&a!==n),d||(e=e&&a!==o),e}function i(a){var b=c.ext&&c.ext.support[a];if("function"==typeof b)return b.call(null,c.layout);if("boolean"==typeof b)return b;throw"Unknown 'support' property name/type"+a}function j(){m.update()}var k,m=c.object={};c.options||(c.options={}),c.options.zoomEnabled=!!e.zoomObject,c.resetOptions=l.extend({},c.options),Object.defineProperties(m,{hasFrame:{get:function(){return!c.options.isPopover&&!m.isInvalid}},isReadonly:{get:function(){return!m||m.isLink||m.isInvalid||c.options.isReadonly}},hasSoftProperties:{get:function(){return!!this.ext&&!!this.ext.mappedSoftDefinition}}}),m.getCreatePropertyHandler=function(){var a=m.model.enigmaModel.app;return m.ext.getCreatePropertyHandler(a)},m.getPropertyPanelContent=function(){return m.loaded.then(function(){var a=m.getCreatePropertyHandler(),b=m.ext.mappedDefinition||m.ext.definition,c=m.ext.globalChangeListeners;return{definition:b,globalChangeListeners:c,type:m.type,app:m.model.enigmaModel.app,backendApi:m.backendApi,handler:a,iconClass:m.ext.libraryInfo.templateIconClassName,titleRef:"title",ext:m.ext}})},m.getSoftPropertyContent=function(){return m.loaded.then(function(){var a=m.ext.mappedSoftDefinition||m.ext.softDefinition;return{definition:a,type:m.type,backendApi:m.backendApi}})},m.toggleExploreMenu=function(a){void 0!==a?m.showExploreMenu=a:m.showExploreMenu=!m.showExploreMenu},m.setSnapshotData=function(a,b){return f.contentLoaded().then(function(c){return c.setSnapshotData(a,b)})},m.getViewState=function(){return f.contentLoaded().then(function(a){return a.getViewState?a.getViewState():void 0})},m.getPreferredSize=function(){return f.contentLoaded().then(function(a){var b=a.getPreferredSize();return b?b.then(function(a){var b=d.find("footer"),c=d.find("header"),e=35;return{w:a.w,h:a.h+b.height()+c.height()+e+d[0].offsetTop}}):void 0})},m.getDropOptions=function(a,b){return m.loaded.then(function(){return f.contentLoaded().then(function(){return m.ext.getDropOptions(m,a,b)})})},m.getContextMenu=function(a){return f.contentLoaded().then(function(b){return b.getContextMenu(m,a)})},m.getObjectMenu=function(a){return f.contentLoaded().then(function(b){return b.getObjectMenu(m,a)})},m.getSelectionToolbar=function(){return m.loaded.then(function(){return f.contentLoaded().then(function(a){return a.getSelectionToolbar()})})},m.reloadContent=function(){c.ext=m.ext=a.extend({},m.ext),m.loadContent()},m.canShowExploreMenu=function(){var a=this.content===n||this.content===o;return!this.isInvalid&&this.hasSoftProperties&&!a},m.supportCssScaling=function(){return h(this.content)&&i("cssScaling")},m.supportSnapshot=function(){if(!h(this.content))return!1;var a=c.ext&&c.ext.snapshot&&c.ext.snapshot.canTakeSnapshot;return"undefined"==typeof a?i("snapshot"):"function"==typeof a?a.call(null,c.layout):"boolean"==typeof a&&a},m.supportExportData=function(){return h(this.content,!1,!0)&&i("exportData")},m.supportExport=function(){return h(this.content)&&i("export")},m.supportSharing=function(){return h(this.content)&&i("sharing")},m.setRenderState=function(a){m&&m.renderState!==a&&(m.renderState=a,c.$emit("objectRenderStateChange",a))},y(c,d,m,f),v(c,m),x(c,m,d,f),B(c,m),m.setRenderState(D.INVALID),m._themeChangeWatcher=j,t.ThemeChanged.bind(m._themeChangeWatcher),g.load(c.options._skipRegisterExtensions).then(function(){w(c,m)}),m.loaded.then(function(){c.cancelled=c.model.isCancelled}),c.$watch("options.interactionState",function(a){var b=isNaN(a)?1:a;m.setInteractionState(b)}),c.$watch("options.direction",function(a){m.setDirection(a)}),c.$watch("options",function(a){a&&a.setController&&f.contentLoaded().then(function(){a.setController(m)})}),c.$on("childSelectionActive",function(a,b){m.childInSelection=b,a.preventDefault()}),c.titleClicked=function(){this.options._disableSelections||m._inEditState||f.contentLoaded().then(function(a){(a.view&&a.view.selections||a.$scope.interactive)&&m.activateSelections()})},c.cancel=function(){c.model.__layoutRPCId&&(c.model.cancelRequest(c.model.__layoutRPCId),delete c.model.__layoutRPCId,m.throbberApi.hide(),m.throbberApi.isQueryCanceled=!0)},c.retry=function(){m.throbberApi.hide(),m.throbberApi.reset(!0),m.throbberApi.isQueryCanceled=!1,c.model.markAsInvalid(),c.model.getLayout().then(function(a){c.layout=a,m.setLayout(a)})},A(c,m,f),c.$on("$destroy",function(){if(b.getService("$timeout").cancel(k),t.ThemeChanged.unbind(m._themeChangeWatcher),m){u(m),m.selectionsApi&&"function"==typeof m.selectionsApi.destroy&&m.selectionsApi.destroy(),m.tooltipApi&&(m.tooltipApi.destroy&&m.tooltipApi.destroy(),m.tooltipApi=null),m.backendApi&&(m.backendApi.destroy(),m.backendApi=null),m.throbberApi&&m.throbberApi.destroy(),m.explore&&m.explore.destroy();var a=m.ext,e=m.layout;m=null,c.object=null,a&&"function"==typeof a.destroy&&a.destroy.call(null,d,e)}})}}})}),define("objects.extension/extension-type",["jquery","core.utils/class","client.utils/property-mapper","objects.extension/default-extension","util","qvangular","core.utils/deferred","objects.models/visualization-object","objects.extension/default-view","objects.extension/default-controller","require","objects/inline-title-edit"],function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){var c=e.extend(!0,{},d,b);return c.libraryInfo=a.getLibraryInfo(),c}function m(a){var b,c=a.path;return t[c]||(b=g(),k([c],function(c){f.$rootScope.$apply(function(){b.resolve(l(a,c))})},function(a){b.reject(a)}),t[c]=b.promise),t[c]}function n(a){var b="";switch(a.toLowerCase()){case"listbox":b="Object.Listbox";break;case"barchart":b="Object.BarChart";break;case"combochart":b="Object.ComboChart";break;case"filterpane":b="Object.FilterPane";break;case"gauge":b="Object.Gauge";break;case"kpi":b="Object.Kpi";break;case"linechart":b="Object.LineChart";break;case"piechart":b="Object.PieChart";break;case"pivot-table":b="Object.PivotTable";break;case"scatterplot":b="Object.ScatterPlot";break;case"table":b="Object.Table";break;case"treemap":b="Object.Treemap";break;case"text-image":b="Object.TextImage";break;case"sheet":b="Common.Sheet";break;case"objectlibrary":b="Object.ObjectLibrary";break;case"libraryobject":b="Object.LibraryObject";break;case"map":b="Object.Map";break;default:b=""}return b}function o(a){switch(a.toLowerCase()){case"barchart":return"bar-chart-vertical";case"linechart":return"line-chart";case"table":return"table";case"pivot-table":return"pivot-table";case"components":return"components";case"piechart":return"pie-chart";case"filterpane":return"filterpane";case"listbox":return"list";case"gauge":return"gauge-chart";case"kpi":return"kpi";case"scatterplot":return"scatter-chart";case"text-image":return"text-image";case"treemap":return"treemap";case"map":return"map";case"combochart":return"combo-chart";default:return"extension"}}function p(a){return"icon-"+o(a)}function q(a){if(!a)return"icon-extension";switch(a.toLowerCase()){case"bar-chart-vertical":return"icon-bar-chart-vertical";case"line-chart":return"icon-line-chart";case"table":return"icon-table";case"pivot-table":return"icon-pivot-table";case"components":return"icon-components";case"pie-chart":return"icon-pie-chart";case"filterpane":return"icon-filterpane";case"list":return"icon-list";case"gauge-chart":return"icon-gauge-chart";case"kpi":return"icon-kpi";case"scatter-chart":return"icon-scatter-chart";case"text-image":return"icon-text-image";case"text":return"icon-titletext";case"map":return"icon-map";case"combo-chart":return"icon-combo-chart";case"widget":return"icon-widget";default:return"icon-extension"}}function r(a){var b=0!==a.indexOf("listbox");return{name:a,descriptionKey:"Template.preview.description."+a,translationKey:n(a),template:a,templateIconClassName:p(a),icon:o(a),author:"Qlik",isThirdParty:!1,isLibraryItem:b}}var s,t={};f.componentDirective("qvaIncludeObject",{model:"=",ext:"=",options:"="});var u={"bar-chart-vertical":"!","line-chart":"%","pie-chart":"&",list:"-",table:"'","pivot-table":"(",filterpane:".","scatter-chart":"+","text-image":"/","gauge-chart":")",kpi:"1",treemap:"",map:",","combo-chart":"","":"E"};return s=b.extend("ExtensionType",{init:function(a){this.type=a.type,this.path=a.path,this.libraryInfo=a.libraryInfo||r(a.type),this.components=a.components||[],this.libraryInfo.templateIconClassName||(this.libraryInfo.templateIconClassName=q(this.libraryInfo.icon))},getLibraryInfo:function(){return this.libraryInfo},getTemplateIconClassName:function(){return this.libraryInfo.templateIconClassName},getIconChar:function(){return u[this.libraryInfo.icon]?u[this.libraryInfo.icon]:"g"},getModelCtor:function(){return m(this).then(function(a){return a.Model})},getInitialProperties:function(a){var b=this;return m(b).then(function(d){var f=e.extend(!0,{qInfo:{qType:b.type},visualization:b.type},d.initialProperties,a);return d.libraryInfo.isThirdParty&&(d.libraryInfo.version&&!f.version&&(f.version=d.libraryInfo.version),f.extensionMeta=e.extend(!0,{},d.libraryInfo)),c.mapProperties(d.definition,f,b.type)}).catch(function(){return{qInfo:{qType:b.type},visualization:b.type}})},load:function(){return m(this).then(function(a){if(a=e.extend(!0,{},a),a.View)for(var b in i)i.hasOwnProperty(b);return"undefined"==typeof a.View&&(a.View=i),"undefined"==typeof a.controller&&(a.controller=j),a})},getExtensionType:function(){return m(this)}}),s.addObject=function(b,c,d){var e=new g;return k(["objects/object"],function(){var g=a(b);g.html('<qv-object model="model" options="options"></qv-object>');var i=f.$rootScope.$new(),j=h.get(c,d);j.then(function(a){i.model=a,i.options={};var b=f.getService("$compile");b(g.contents())(i),f.$apply(i),e.resolve(j)},function(a){e.reject(a)})}),e.promise},s}),function(){"use strict";define("xsrfplugin",["jquery"],function(a){function b(a){var b,c,d="";for(b=0;b<a;b++)c=Math.floor(62*Math.random()),d+=c<10?c:c>9&&c<36?String.fromCharCode(c+55):String.fromCharCode(c+61);return d}function c(){var c,d;e||(e=!0,c=b(16),d=a.ajax,a.extend({ajax:function(a){if(a.headers||(a.headers={}),a.headers["X-Qlik-XrfKey"]=c,"GET"===a.type)void 0===a.data&&(a.data={}),a.data.xrfkey=c;else if(a.url){var b=a.url.indexOf("?")===-1?"?":"&";a.url+=b+"xrfkey="+c}return d.call(this,a)}}))}function d(){e=!1}var e=!1;return{getRandomString:b,setupXsrfPlugin:c,resetHasBeenSetup:d}})}(),define("general.services/content-api/content-api",["qvangular","core.utils/deferred","translator","xsrfplugin","require"],function(a,b,c,d,e){a.service("$contentApi",["$http",function(f){function g(a){a.headers||(a.headers={})}function h(a){a.params||(a.params={})}function i(a){var b=d.getRandomString(16);return a.headers["X-Qlik-XrfKey"]=b,a.params.xrfkey=b,a}function j(a){var b=e.toUrl(""),c=b.indexOf("/resources");return c>-1&&(b=b.substring(0,c)),a.url=b+a.url,a}function k(a){var b=c.language;return b&&(a.headers["Accept-Language"]="pseudo"!==b?b:"qps-ploc"),a}function l(b){return g(b),h(b),a.$rootScope.isPersonalMode||i(b),j(b),k(b),f(b)}function m(){var a=new b,c={method:"GET",url:"/qrs/extension/schema"};return l(c).then(function(b){var c=b.data;a.resolve(c)}).catch(function(b){var c=b.data;a.reject(c)}),a.promise}return{getExtensions:m,request:l}}])}),define("general.models/library/extension-list",["core.utils/deferred","qvangular","general.services/content-api/content-api"],function(a,b){"use strict";var c={list:[]},d=null;return c.getList=function(c){function e(a){return b.getService("$contentApi").getExtensions().then(function(b){f.list=[];for(var c in b)b.hasOwnProperty(c)&&f.list.push({id:c,data:b[c]});a.resolve(f.list)},function(){f.list=[],a.resolve(f.list)}),a.promise}var f=this;return null===d?(d=new a,e(d)):c?e(new a):d.promise},c}),define("objects.utils/type-loader",["core.utils/deferred","general.utils/visualizations","objects.extension/extension-type","general.models/library/extension-list"],function(a,b,c,d){function e(a,b){return b=b||{},b.previewIconURL||"string"==typeof b.preview&&b.preview.match(/\.(?:png|gif|jpe?g|svg)$/)&&(b.previewIconURL="../extensions/"+a+"/"+b.preview),b.icon=b.icon||"extension",b.description=b.description||b.name,b.template=b.template||a,b.isLibraryItem=b.isLibraryItem!==!1,b.isThirdParty=!0,b.name=b.name||b.template||a,b}function f(a){a.data&&"visualization"===a.data.type&&b.registerType(a.id,new c({type:a.id,path:"extensions/"+a.id+"/"+a.id,libraryInfo:e(a.id,a.data)}))}function g(g){return null===h&&(h=new a,b.registerType("listbox",new c({type:"listbox",path:"extensions.qliktech/listbox/listbox"})),b.registerType("filterpane",new c({type:"filterpane",path:"extensions.qliktech/filterpane/filterpane",components:["extensions.qliktech/filterpane/properties/filterpane-data/filterpane-data","extensions.qliktech/filterpane/properties/filterpane-sorting/filterpane-sorting"]})),b.registerType("gauge",new c({type:"gauge",path:"extensions.qliktech/gauge/gauge"})),b.registerType("kpi",new c({type:"kpi",path:"extensions.qliktech/kpi/kpi"})),b.registerType("table",new c({type:"table",path:"extensions.qliktech/straight-table/straight-table",components:["extensions.qliktech/straight-table/properties/columns/columns"]})),b.registerType("pivot-table",new c({type:"pivot-table",path:"extensions.qliktech/pivot-table/pivot-table",components:["extensions.qliktech/pivot-table/properties/pivot-data/pivot-data","extensions.qliktech/pivot-table/properties/pivot-sorting/pivot-sorting"]})),b.registerType("barchart",new c({type:"barchart",path:"extensions.qliktech/barchart/barchart"})),b.registerType("piechart",new c({type:"piechart",path:"extensions.qliktech/piechart/piechart"})),b.registerType("scatterplot",new c({type:"scatterplot",path:"extensions.qliktech/scatterplot/scatterplot"})),b.registerType("linechart",new c({type:"linechart",path:"extensions.qliktech/linechart/linechart"})),b.registerType("combochart",new c({type:"combochart",path:"extensions.qliktech/combochart/combochart"})),b.registerType("treemap",new c({type:"treemap",path:"extensions.qliktech/treemap/treemap"})),b.registerType("map",new c({type:"map",path:"extensions.qliktech/map/map",components:["extensions.qliktech/map/properties/layers"]})),b.registerType("text-image",new c({type:"text-image",path:"extensions.qliktech/text-image/text-image"})),b.registerType("widget",new c({type:"widget",path:"extensions.qliktech/widget/widget",libraryInfo:e("widget",{name:"Widget",icon:"widget",description:"Qlik Sense Widget",isLibraryItem:!1})})),g?h.resolve():d.getList().then(function(a){a.forEach(function(a){f(a)}),h.resolve()})),h.promise}var h=null;return{load:g,isLoaded:function(a){return!!b.getType(a)},registerExtension:f}}),define("assets/object-renderer/settings-validator",[],function(){function a(a,b){switch(a){case"object":return null!=b&&!Array.isArray(b)&&"object"==typeof b;case"HTMLElement":return b&&b.toString().indexOf("Element]")>-1||!1;case"boolean":return"boolean"==typeof b;case"string":return"string"==typeof b;case"number":return"number"==typeof b;default:throw"Unknown type: "+a}}function b(b,c){for(var d,e,f,g=[],h=0;h<c.length;h++)e=c[h],d=e.param,f=b[d],e.optional||"undefined"!=typeof f?(!e.optional||e.optional&&"undefined"!=typeof f)&&(a(e.type,f)||g.push("Invalid type for parameter: "+d)):g.push("Missing setting: "+d);return g}return{validateSettings:b,validateType:a}}),define("general.utils/touch-configuration-util",["jquery","general.utils/support"],function(a,b){"use strict";return{configureTouchSupport:function(){a(document.body.parentElement).addClass("touch-"+(b.treatAsDesktop()?"off":"on"))}}}),define("text!assets/qlikui/custom-components/qui-button-icon/qui-button-icon.html",[],function(){return'<button class="{{className}}" ng-class="classes" ng-transclude></button>'}),define("assets/qlikui/custom-components/qui-button-icon/qui-button-icon",["qvangular","text!./qui-button-icon.html"],function(a,b){function c(a,b,c){var d="qui-btn-icn";a.className=d+(b?"-tgl":""),c&&(a.className+=" qui-active")}var d=13;a.component("quiButtonIcon",{template:b,scope:{icon:"@",active:"="},controller:["$scope","$element","$attrs",function(a,b,e){function f(){c(a,e.hasOwnProperty("toggle"),a.active)}function g(a){a.keyCode===d&&b.trigger("qv-activate")}a.$watch("active",f),b.on("keypress",g)}]})}),define("text!assets/qlikui/custom-components/qui-button-outline-round/qui-button-outline-round.html",[],function(){return'<button class="{{className}}" ng-class="{\'qv-btn-outline-round-no-text\': !qvaButtonText && !qvaButtonPreIconText, \'qv-btn-outline-round-with-text\':  qvaButtonText || qvaButtonPreIconText}">\n\t<div class="qv-btn-outline-round-flex">\n\t\t<div ng-if="qvaButtonPreIconText" ng-class="{\'qv-btn-outline-round-icon-right\': classIcon}" class="qv-btn-outline-round-text">{{qvaButtonPreIconText}}</div>\n\t\t<i class="outline-icon {{ classIcon }}"></i>\n\t\t<div ng-if="qvaButtonText" ng-class="{\'qv-btn-outline-round-icon-left\': classIcon}" class="qv-btn-outline-round-text" q-translation="{{qvaButtonText}}"></div>\n\t</div>\n</button>\n'}),define("assets/qlikui/custom-components/qui-button-outline-round/qui-button-outline-round",["qvangular","text!./qui-button-outline-round.html"],function(a,b){a.component("quiButtonOutlineRound",{template:b,scope:{classIcon:"@",qvaButtonText:"@",qvaButtonPreIconText:"="},controller:["$scope","$attrs",function(a,b){a.className="qv-btn-outline-round",b.hasOwnProperty("light")&&(a.className+=" qv-btn-outline-round-light"),a.$watch("classIcon",function(b){a.classIcon=b})}]})}),define("text!assets/qlikui/custom-components/qui-dialog-default/qui-dialog-default.html",[],function(){return'<div class="qui-delayedModal delayedModal qui-delayedmodal" ng-transclude>\n\t<!-- This will be replaced by ng-transclude -->\n</div>\n'}),define("assets/qlikui/custom-components/qui-dialog-default/qui-dialog-default",["qvangular","text!./qui-dialog-default.html"],function(a,b){a.component("quiDialogDefault",{template:b})}),define("text!assets/qlikui/custom-components/qui-dialog-pleasewait/qui-dialog-pleasewait.html",[],function(){return'<div>\n\t<qui-dialog-default>\n\t\t<header class="dm-header" q-translation="Common.PleaseWait">#Working#</header>\n\t\t<main class="dm-main">\n\t\t\t<p class="qui-pleasewaitdialog-loader-container"><img src="../resources/img/core/loader.svg"/></p>\n\n\t\t\t<p class="qui-pleasewaitdialog-pleasewait" q-translation="Common.PleaseWait"></p>\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t</footer>\n\t</qui-dialog-default>\n</div>\n'}),define("assets/qlikui/custom-components/qui-dialog-pleasewait/qui-dialog-pleasewait",["qvangular","text!./qui-dialog-pleasewait.html"],function(a,b){a.component("quiDialogPleasewait",{template:b})}),define("text!assets/qlikui/custom-components/qui-filter/qui-filter.ng.html",[],function(){return'<div class="button-div qui-filter lui-buttongroup">\n\t<lui-button qva-activate="toggleAscDesc()"\n\t\t\t\tclass="asc-desc"\n\t\t\t\ttitle="{{sortTitle | translate}}">\n\t\t<span class="lui-icon  lui-button__icon" ng-class="isAscending ? \'lui-icon--ascending\' : \'lui-icon--descending\'"></span>\n\t</lui-button>\n\n\t<lui-button disabled="disabled"\n\t\t\t\tng-if="sections.length <= 1"\n\t\t\t\tclass="sort-filter"\n\t\t\t\ttitle="{{ sortOptTitle | translate }}">\n\t\t<span class="lui-button__text">\n\t\t\t{{ $parent.sections[0].text || "Common.SortByAlphabetical" | translate }}\n\t\t</span>\n\t\t<span class="lui-caret  lui-button__caret"></span>\n\t</lui-button>\n\n\t<lui-select ng-if="sections.length > 1"\n\t\t\t\tclass="sort-filter"\n\t\t\t\tx-model="$parent.selectedFltr"\n\t\t\t\tx-options="option.value as option.text | translate for option in sections"\n\t\t\t\ttitle="{{sortOptTitle | translate}}"></lui-select>\n</div>\n'}),define("assets/qlikui/custom-components/qui-filter/qui-filter",["qvangular","text!./qui-filter.ng.html"],function(a,b){a.component("quiFilter",{template:b,scope:{isAscending:"=",sections:"=",selectedFltr:"=",toggleAscDesc:"&",sortTitle:"@",sortOptTitle:"@"}})}),define("text!assets/qlikui/custom-components/qui-float/qui-float.html",[],function(){return'<div class="qui-float" ng-style="{top:top, left:left}" ng-show="visible" qva-reported-window-size="reportedWindowSize">\n\t<div ng-transclude></div>\n</div>\n'}),define("assets/qlikui/custom-components/qui-float/qui-float",["qvangular","text!./qui-float.html"],function(a,b){a.component("quiFloat",{transclude:!0,template:b,scope:{quiOffset:"=",quiResizeOnChange:"="},controller:["$scope","$element","$timeout",function(a,b,c){function d(){a.quiOffset&&a.reportedSize&&a.reportedWindowSize?(a.quiOffset.left+a.reportedSize.width<a.reportedWindowSize.width?a.left=a.quiOffset.left:a.left=a.reportedWindowSize.width-a.reportedSize.width,a.quiOffset.top+a.reportedSize.height<a.reportedWindowSize.height?a.top=a.quiOffset.top:a.top=a.reportedWindowSize.height-a.reportedSize.height,a.visible=!0):a.visible=!1}function e(){c(function(){a.reportedSize={width:b.outerWidth(),height:b.outerHeight()}})}a.$watch("quiResizeOnChange",e,!0),a.$watch("[quiOffset, reportedSize, reportedWindowSize]",d,!0)}]})}),define("assets/qlikui/custom-components/qui-input-number/numerical-interval-transformer",[],function(){function a(a){return Number(String(a).replace(/[^-\d]/g,""))}return{getNumerical:function(b,c,d){return b=a(b),c=Number(c),d=Number(d),b<c?c:0!==d&&b>d?d:b}}}),define("text!assets/qlikui/custom-components/qui-input-number/qui-input-number.ng.html",[],function(){return'<span class="qui-input-number lui-input-group">\n\t<button class="lui-input-group__item  lui-input-group__button  lui-button" qva-activate="onChange(-1)" ng-disabled="quiDisabled" ng-if="quiWithButtons">\n\t\t<span class="lui-button__icon">-</span>\n\t</button>\n\t<input type="tel" class="lui-input-group__item  lui-input-group__input  lui-input {{quiClass}}" tid="{{quiTid}}" title="{{quiTitle}}" ng-model="quiModel" ng-change="onChange()" ng-disabled="quiDisabled"/>\n\t<button class="lui-input-group__item  lui-input-group__button  lui-button" qva-activate="onChange(1)" ng-disabled="quiDisabled" ng-if="quiWithButtons">\n\t\t<span class="lui-button__icon">+</span>\n\t</button>\n</span>\n'}),define("assets/qlikui/custom-components/qui-input-number/qui-input-number",["qvangular","./numerical-interval-transformer","text!./qui-input-number.ng.html"],function(a,b,c){a.component("quiInputNumber",{template:c,scope:{quiModel:"=",quiDisabled:"=",quiTitle:"@",quiMin:"@",quiMax:"@",quiClass:"@",quiSelectTextOnFocus:"@",quiWithButtons:"@",quiTid:"@"},controller:["$scope","$element",function(a,c){a.quiSelectTextOnFocus&&(a.selected=!1,c.click(function(){a.selected===!1&&(c.select(),a.selected=!0)}),c.blur(function(){a.selected=!1})),a.onChange=function(d){var e=parseInt(d)||0;a.quiModel=b.getNumerical(parseInt(c.find(".lui-input").val())+e,a.quiMin,a.quiMax)}}]})}),define("text!assets/qlikui/custom-components/qui-popover-button/qui-popover-button.ng.html",[],function(){return'<button\n\t\tclass="qui-popover-button qui-dropdown"\n\t\ttid="{{quiModel.tid}}"\n\t\tdata-ng-disabled="quiModel.isDisabled()"\n\t\tdata-ng-class="buttonClasses"\n\t\tdata-icon="{{quiModel.icon}}"\n\t\tq-title-translation="{{currentTitle}}"\n\t\tdata-qva-activate="onClick()">\n\t{{quiModel.buttonText}}\n\t<ng-transclude></ng-transclude>\n</button>\n'}),define("text!assets/qlikui/custom-components/qui-popover-button/qui-popover-button-menu.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo"\n\t\t\t\t\t  smallview="quiModel.menuOptions.smallview"\n\t\t\t\t\t  position="quiModel.menuOptions.position"\n\t\t\t\t\t  width="quiModel.menuOptions.width"\n\t\t\t\t\t  top="quiModel.menuOptions.top"\n\t\t\t\t\t  hidepointer="quiModel.menuOptions.hidepointer"\n\t\t\t\t\t  on-close-view="onClose(event)">\n\t<ul ng-class="menuClasses" tid="{{quiModel.menuOptions.content.tid}}">\n\t\t<li class="toolbar-menu-li" ng-repeat="menuItem in menuItems" data-icon="{{menuItem.icon}}" ng-disabled="menuItem.disable" qui-click=\'menuItem.fn()\'\n\t\t\tng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" ng-hide="menuItem.hide">\n\t\t\t<span class="qui-textlist-text"\n\t\t\t\t  tid="{{menuItem.tid}}"\n\t\t\t\t  q-title-translation="{{ menuItem.title || menuItem.text}}"\n\t\t\t\t  ng-class="{\'open-in-new-tab-text-optional\': menuItem.openInNewTab == \'optional\', \'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}"\n\t\t\t\t  qva-activate="selectMenuItem(menuItem, $event)" q-translation="{{menuItem.text}}" ng-disabled="menuItem.disable">\n\t\t\t</span>\n\t\t\t<span ng-if="menuItem.openInNewTab" class="open-in-new-tab" ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" data-icon="stacked-windows" q-title-translation="{{ menuItem.title || \'Tooltip.OpenInNewTab\'}}" qva-activate="selectMenuItem(menuItem, $event, \'true\')" ng-disabled="menuItem.disable"></span>\n\t\t</li>\n\t</ul>\n</immidiate-contextual>\n'}),define("text!general.components/immidiate-contextual/immidiate-contextual.ng.html",[],function(){return"<div qva-outside='onOutsidePopover($event)' ng-class=\"{'lui-immidiateContextual': popupStyle === 'lui', 'qui-immidiateContextual' : popupStyle !== 'lui' }\">\n\t<div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\n\t<div class='content' ng-transclude></div>\n</div>\n"}),define("text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html",[],function(){return"<div class='qui-immidiateContextual-small' qva-activate='onOutsidePopover($event)' qva-outside='onOutsidePopover($event)'>\n    <div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\n    <div class='content' ng-transclude></div>\n</div>\n"}),define("general.components/immidiate-contextual/immidiate-contextual",["jquery","general.utils/window-positioner","general.utils/arrow-positioner","text!general.components/immidiate-contextual/immidiate-contextual.ng.html","text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html","assets/qvangular/qvangular-core","core.utils/resize","general.utils/dom-util","general.utils/responsive-state"],function(a,b,c,d,e,f,g,h,i){f.directive("immidiateContextual",function(){return{replace:!0,template:function(a,b){var c=d;return i.isSmallDevice&&b.smallview&&(c=e),c},transclude:!0,scope:{onCloseView:"&",hidepointer:"=",luiStyle:"="},restrict:"E",link:function(d,e,i){d.popupStyle="qui",d.luiStyle&&(d.popupStyle="lui");var j,k,l=a(d.$parent.$eval(i.alignTo)),m=a(d.$parent.$eval(i.offset))[0],n=d.$parent.$eval(i.width),o=d.$parent.$eval(i.top),p=d.$parent.$eval(i.height),q=d.$parent.$eval(i.position),r=d.$parent.$eval(i.limits)||null,s=d.$parent.$eval(i.collision)||"none";"undefined"!=typeof p&&e.css("height",p||"100"),"undefined"!=typeof n&&e.css("width",n||"100"),d.onOutsidePopover=function(a){a.stopPropagation(),a.preventDefault(),d.onCloseView({event:a})},a(document).on("keydown.immediateContextual",function(b){var c=h.isInput(document.activeElement);!a(".qui-immidiateContextual").length||c||9!==b.which&&32!==b.which||(b.preventDefault(),d.onCloseView({event:b}),d.$apply(),l.hasClass("lui-button")&&l.hasClass("lui-active")&&l.removeClass("lui-active"))}),d.positionMap=function(a){var b={topRight:"right",top:"top",topLeft:"left",centerRight:"right",center:"right",centerLeft:"left",bottom:"bottom",bottomLeft:"left",bottomRight:"right"};return b[a]},d.synchronAlign=function(){d.hidepointer?d.$parent.event&&(j=b.alignToCoordinate(e,d.$parent.event.pageX,d.$parent.event.pageY,i.position)):(m?(j=b.alignToCoordinate(e,m.x,m.y,q),j=d.positionMap(j)):j=b.align(e,l,{position:q,collision:s,limits:r}),e.find("div.immidiate-contextual-arrow").addClass(j),c.align(e,l,j,e.children("div.immidiate-contextual-arrow")))},d.align=function(){"undefined"!=typeof o&&e.css({top:parseInt(o,10)}),k=f.getService("$timeout")(d.synchronAlign)},d.$on("recalculatePointer",function(){d.hidepointer||c.align(e,l,j,e.children("div.immidiate-contextual-arrow"))}),d.$on("$destroy",function(){f.getService("$timeout").cancel(k),g.off("end",d.align),a(document).off("keydown.immediateContextual")}),g.on("end",d.align),d.align()}}})}),define("assets/qlikui/custom-components/qui-popover-button/qui-popover-button",["assets/qvangular/qvangular-core","jquery","text!./qui-popover-button.ng.html","text!./qui-popover-button-menu.ng.html","general.services/show-service/show-service","core.utils/resize","general.components/immidiate-contextual/immidiate-contextual"],function(a,b,c,d,e,f){var g={template:d,scope:{quiModel:"=",alignTo:"=",shared:"="},controller:["$scope",function(a){a.shared.destroyComponent=a.destroyComponent,a.menuClasses=a.quiModel.menuOptions.content.menuClasses?a.quiModel.menuOptions.content.menuClasses:"qui-textlist",a.quiModel.menuOptions.content.createMenuItems().then(function(b){a.menuItems=b}),a.selectMenuItem=function(b,c,d){c&&c.preventDefault&&c.preventDefault(),b.disable||(a.onClose&&a.onClose(c),b.selected(c,d))},a.onClose=function(c){b(c.target).hasClass("qui-popover-button")&&a.quiModel.tid===b(c.target).attr("tid")||(a.destroyComponent(),a.shared.pressed=!1)},a.closeFromContent=function(){a.destroyComponent(),a.shared.pressed=!1},a.$on("$destroy",function(){f.off("start",a.onClose)}),f.on("start",a.onClose)}]};a.directive("quiPopoverButton",function(){return{template:c,transclude:!0,replace:!0,restrict:"E",scope:{quiModel:"=",
quiPopoverContainer:"=?"},controller:["$scope","$element",function(a,b){var c=13;a.shared={},a.shared.pressed=!1,a.buttonClasses={"lui-active":a.shared.pressed},a.$watch("quiModel.buttonType",function(b){b&&(a.buttonClasses[b]=!0),b&&0===b.indexOf("lui-button")?a.buttonClasses["lui-button"]=!0:a.buttonClasses["lui-button"]=!1}),a.$watch("shared.pressed",function(b){a.buttonClasses["lui-active"]=b,a.currentTitle=b&&a.quiModel.tooltipActive?a.quiModel.tooltipActive:a.quiModel.tooltipInactive}),b.on("keypress",function(b){b.keyCode===c&&a.onClick()}),a.onClick=function(){a.shared.pressed?(a.shared.destroyComponent(),a.shared.pressed=!1):(a.shared.pressed=!0,e.show(a.quiPopoverContainer||g,{quiModel:a.quiModel,alignTo:b,shared:a.shared}))},a.quiModel&&(a.quiModel.forceClick=a.onClick)}]}})}),define("text!assets/qlikui/custom-components/qui-search-field-old/qui-search-field-old.ng.html",[],function(){return'<div class="qui-searchfield-old" ng-disabled="disabled">\n\t<span class="magnifying-glass"></span>\n\t<span q-title-translation="Common.Clear" class="clear-button" ng-show="query.length" qva-activate="clearSearch($event)"></span>\n\t<input maxlength="{{maxlength || 255}}" q-placeholder="{{placeholder}}" ng-model="query" ng-disabled="disabled" autocomplete="{{autocomplete}}" spellcheck="false" ng-trim="false" type="text" qva-blur="blurred()"\n\t\t\tqva-focus="autoFocus" qv-escape="escape($event)" qv-enter="enter($event)"/>\n</div>\n'}),define("assets/qlikui/custom-components/qui-search-field-old/qui-search-field-old",["qvangular","text!./qui-search-field-old.ng.html"],function(a,b){a.component("quiSearchFieldOld",{scope:{query:"=",disabled:"=",autocomplete:"=",placeholder:"@",autoFocus:"=?",isFocused:"=?",focuscallback:"&",maxlength:"=",onEscape:"&",onEnter:"&",onClear:"&"},template:b,link:function(a,b){var c=b.find("span.clear-button"),d=b.find("input");d.on("focus.quiSearchField",function(){a.$root.$$phase?a.focused():a.$apply(function(){a.focused()})}),a.focused=function(){a.focuscallback(),a.isFocused=!0},a.blurred=function(){a.isFocused=!1},a.escape=function(b){a.onEscape&&a.onEscape({$event:b})},a.enter=function(b){a.onEnter&&a.onEnter({$event:b})},a.clearSearch=function(b){b.preventDefault(),a.query="",a.onClear&&a.onClear({$event:b})},a.$on("$destroy",function(){d.off(".quiSearchField"),c.off(".quiSearchField")})}})}),define("text!assets/qlikui/custom-components/qui-toolbar/qui-app-info.ng.html",[],function(){return'<section class="qv-app-info-holder">\n\t<div class="app-info-click-area"\n\t\t qva-activate="quiModel.onButton()"\n\t\t q-title-translation="{{quiModel.tooltip()}}"\n\t\t ng-class="{\'has-app-details\': quiModel.hasAppDetails()}">\n\t\t<span class="app-read-only" ng-if="quiModel.readOnly"><i data-icon="padlock" q-title-translation="Hub.App.ReadOnly"></i>&nbsp;</span>\n\n\t\t<h1 class="app-title">{{quiModel.appTitle}}</h1>\n\n\t\t<span class="app-info-icon lui-icon  lui-icon--more-rounded" ng-if="quiModel.hasAppDetails()"></span>\n\t</div>\n</section>\n'}),define("text!assets/qlikui/custom-components/qui-toolbar/qui-toolbar-button.ng.html",[],function(){return'<button\n\t\ttid="{{quiModel.tid}}"\n\t\tqva-activate="onButton($event)"\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tq-title-translation="{{(quiModel.pressed && quiModel.tooltipActive ? quiModel.tooltipActive : quiModel.tooltipInactive)}}"\n\t\tng-disabled="quiModel.isDisabled()"\n\t\tng-hide="quiModel.isHidden()"\n\t\tclass="{{quiModel.hasStrongActiveColor}}"\n\t\tng-class="{\n\t\t\t\'lui-button\': !quiModel.qlikuiSmallIconButton,\n\t\t\t\'lui-button--toolbar\': !quiModel.qlikuiSmallIconButton,\n\t\t\t\'qui-smalliconbutton\': quiModel.qlikuiSmallIconButton,\n\t\t\t\'lui-active\': quiModel.pressed,\n\t\t\t\'noIcon\': !quiModel.icon,\n\t\t\t\'iconToTheRight\': quiModel.iconToTheRight,\n\t\t\t\'dyn-text\': quiModel.dynamicText\n\t\t}">\n\t<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && !quiModel.iconToTheRight && quiModel.showLoading" class="qv-loader lui-button-loading"></span>\n\t<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && !quiModel.iconToTheRight && !quiModel.showLoading" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\n\t<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && quiModel.showText()" class="item-title" qva-direction x-dir-text="{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}">{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}</span>\n\t<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && quiModel.iconToTheRight && !quiModel.showLoading" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\n\t<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && quiModel.iconToTheRight && quiModel.showLoading" class="qv-loader lui-button-loading"></span>\n\t<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="quiModel.dynamicText">{{ quiModel.dynamicText() }}</span>\n</button>\n'}),define("assets/qlikui/custom-components/qui-toolbar/qui-toolbar",["jquery","qvangular","text!./qui-app-info.ng.html","text!./qui-toolbar-button.ng.html"],function(a,b,c,d){b.component("quiToolbar",{template:"<div class='qui-toolbar' ng-transclude />"}),b.component("quiToolbarLeft",{template:"<div class='qui-buttonset-left' ng-transclude />"}),b.component("quiToolbarRight",{template:"<div class='qui-buttonset-right' ng-transclude />"}),b.component("quiToolbarButtonGroup",{template:"<div class='lui-buttongroup' ng-transclude />"}),b.component("quiToolbarAppInfo",{template:c,scope:{quiModel:"="}}),b.component("quiToolbarButton",{template:d,scope:{quiModel:"="},controller:["$scope","$element",function(b,c){var d=13;c.on("keypress",function(a){a.keyCode===d&&c.trigger("qv-activate")}),b.onButton=function(c){a.support.touch&&c.target.focus(),b.quiModel.isToggleButton&&(b.quiModel.pressed=!b.quiModel.pressed),b.quiModel.onButtonClicked(b.quiModel,c)}}]})}),define("assets/qlikui/custom-components",["assets/qlikui/custom-components/qui-button-icon/qui-button-icon","assets/qlikui/custom-components/qui-button-outline-round/qui-button-outline-round","assets/qlikui/custom-components/qui-dialog-default/qui-dialog-default","assets/qlikui/custom-components/qui-dialog-pleasewait/qui-dialog-pleasewait","assets/qlikui/custom-components/qui-filter/qui-filter","assets/qlikui/custom-components/qui-float/qui-float","assets/qlikui/custom-components/qui-input-number/qui-input-number","assets/qlikui/custom-components/qui-popover-button/qui-popover-button","assets/qlikui/custom-components/qui-search-field-old/qui-search-field-old","assets/qlikui/custom-components/qui-toolbar/qui-toolbar"],function(){}),define("general.utils/qv-activate",["jquery","jqueryoutside","touche"],function(a){function b(b,c,d){return a.Event(b,{pageX:d.pagePoints[0].x,pageY:d.pagePoints[0].y,ctrlKey:c.ctrlKey,metaKey:c.metaKey,shiftKey:c.shiftKey,originalEvent:c,gestureData:d})}var c;Touche(document.body).tap({options:{preventDefault:!1},start:function(b){c=a(b.target)},end:function(a,d){var e=b("qv-activate",a,d);0===c.closest(":disabled").length&&c.trigger(e),c=null}});var d=Touche.Gesture.augment(function(a){function b(){a.apply(this,arguments)}return this.defaults={precedence:6},this.start=function(a,b){this.binder.start.call(this,a,b)},b});Touche.gestures.add("press",d),Touche(document.body).press({start:function(c,d){var e=b("qv-press",c,d);a(c.target).trigger(e)}}),a.addOutsideEvent("qv-press","qv-outside","touchstart","touchend")}),define("client.utils/rtl/rtl-util",["jquery"],function(a){function b(){return void 0===m&&h(),m}function c(a){return r.test(a)}function d(a){return s.test(a)||t.test(a)}function e(a){return u.test(a)}function f(a){var b,e,f=a?a.length:0;for(b=0;b<f;b++){if(e=a[b],c(e))return"ltr";if(d(e))return"rtl"}return"ltr"}function g(a){return m?"auto":f(a)}function h(){var a=document.createElement("div"),b=document.getElementsByTagName("body")[0];a.setAttribute("style","position: absolute; width: 1px; height: 1px; top: -999px; overflow: scroll; white-space:nowrap;"),a.setAttribute("dir","rtl"),b.appendChild(a),l=i(a),m=j(a),b.removeChild(a)}function i(a){a.innerHTML="RTL-SCROLL-TEST";var b="reverse";return a.scrollLeft>0?b="default":(a.scrollLeft=1,0===a.scrollLeft&&(b="negative")),b}function j(b){b.innerHTML="        ";var c;switch(l){case"reverse":c=!1;break;case"default":c=b.scrollLeft>0;break;case"negative":a(b).scrollLeft(-1e3),c=b.scrollLeft<0;break;default:c=!1}return c}function k(a,b,c){return c=isNaN(c)?0:c,a&&"reverse"===l?b+c:b-c}var l,m,n="[A-Za-z---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]",o="[-------]",p="[-----------]",q='[\t-\r-"&-*;-@[-`{-~-----------------------------\u2029-------------------------------------------------------]',r=new RegExp(n),s=new RegExp(o),t=new RegExp(p),u=new RegExp(q),v=String.fromCharCode(8206),w=String.fromCharCode(8207);return h(),{supportDirAuto:b,detectTextDirection:f,getAutoOrAlternativeDirection:g,isLtrChar:c,isRtlChar:d,isNeutralChar:e,lrm:v,rlm:w,scrollImplementation:l,getScrollPos:k}}),define("client.models/app-generic-properties",["jquery","core.models/generic-object"],function(a,b){"use strict";var c;return c=b.extend("AppProps",{},{listProperties:{qAppObjectListDef:{qType:"appprops",qData:{sheetTitleBgColor:"/sheetTitleBgColor",sheetTitleGradientColor:"/sheetTitleGradientColor",sheetTitleColor:"/sheetTitleColor",sheetLogoThumbnail:"/sheetLogoThumbnail",sheetLogoPosition:"/sheetLogoPosition",rtl:"/rtl",theme:"/theme"}}}}),c.create=function(d,e){var f={sheetTitleBgColor:"",sheetTitleGradientColor:"",sheetTitleColor:"",sheetLogoThumbnail:{qStaticContentUrlDef:null},sheetLogoPosition:"",rtl:!1,theme:"sense"};return b.create.call(c,a.extend(!0,f,d),e)},c}),define("client.models/app-generic-props-wrapper",["client.models/app-generic-properties","core.utils/notification","core.utils/deferred","util"],function(a,b,c,d){"use strict";function e(b){k=b,a.get(k).then(function(a){a.Invalidated.bind(f)})}function f(){var a;i().then(function(b){a=b,j.UpdateObjProps.emit(a)})}function g(){return a.getList().then(function(b){return b.getLayout().then(function(b){return b&&b.length?e(b[0].qInfo.qId):m?a.create({}).then(function(a){return a.getProperties().then(function(a){return e(a.qInfo.qId)})}):(l=new c,l.resolve(),l.promise)})})}function h(b,c){return a.get(b).then(function(a){m&&a.getLayout(),a.getProperties().then(function(b){var e={};e=d.extend(!0,b,c),a.setProperties(e)})})}function i(){return k?a.get(k).then(function(a){return a.getLayout().then(function(a){return a})}):(l=new c,l.resolve({}),l.promise)}var j={},k=null,l=null,m=!1;return b.mixin(j),j.notification("UpdateObjProps"),j.setProperties=function(a){k?(m=!1,h(k,a)):(m=!0,g().then(function(){h(k,a)}))},j.getProperties=function(){return k?i():(m=!1,g().then(i))},j});define("client.utils/rtl/direction-service",["client.models/app-generic-props-wrapper","core.utils/notification"],function(a,b){"use strict";function c(a){d.setRtl(a.rtl)}var d={},e=!1,f="ltr",g=!1;return b.mixin(d),d.notification("DirectionChanged"),d.init=function(){return a.getProperties().then(function(a){return g=!0,d.setRtl(a&&a.rtl)})},d.setRtl=function(a){return e!==a&&(e=a,f=e?"rtl":"ltr",d.DirectionChanged.emit(f)),f},Object.defineProperty(d,"isInit",{get:function(){return g}}),Object.defineProperty(d,"isRtl",{get:function(){return e}}),Object.defineProperty(d,"direction",{get:function(){return f}}),a.UpdateObjProps.bind(c),d});define("client.utils/rtl/direction-directive",["qvangular","client.utils/rtl/rtl-util","client.utils/rtl/direction-service"],function(a,b,c){a.directive("qvaDirection",function(){return{restrict:"A",link:function(a,d,e){function f(){var a,f=e.dirSetting?e.dirSetting:c.direction,g=e.dirText;a=g?b.detectTextDirection(g):f,d.attr("dir",a),"rtl"===a?d.addClass("qv-rtl-text"):d.removeClass("qv-rtl-text"),"rtl"===f?d.addClass("qv-rtl-layout"):d.removeClass("qv-rtl-layout")}f(),e.$observe("dirText",f),e.$observe("dirSetting",f)}}})}),"undefined"==typeof Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{enumerable:!1,get:function(){var a=this.toString().match(/^function( (.*?))?\(/);return a&&a.length>=3?a[2]:"anonymous function"}}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,value:function(a){return this.indexOf(a)!==-1}}),"scrollX"in window.constructor.prototype||Object.defineProperties(window.constructor.prototype,{scrollX:{get:function(){return this.pageXOffset}},scrollY:{get:function(){return this.pageYOffset}}}),define("core.utils/augment",function(){}),define("assets/object-renderer/object-renderer-impl",["jquery","core.utils/deferred","objects.backend-api/snapshot-api","core.models/rpc-base","client.utils/state","objects.utils/type-loader","assets/object-renderer/settings-validator","general.utils/touch-configuration-util","translator","util","assets/leonardo-ui/leonardo-ui","assets/qlikui/custom-components","objects/object","general.utils/qv-activate","client.utils/rtl/direction-directive","core.utils/augment"],function(a,b,c,d,e,f,g,h,i,j){function k(a,c){return{session:{currentApp:{layout:{qLocaleInfo:c},getLayout:function(){return b.resolve(this.layout)}}},state:d.States.VALID,layout:a,getLayout:function(){return b.resolve(a)},Invalidated:function(){}}}function l(a){var c=g.validateSettings(a,p);return c.length?b.reject(c):(f.load(!0),h.configureTouchSupport(),i.setup({context:"client",language:a.language}))}function m(a){a.snapshotData.content&&delete a.snapshotData.content.size,a.snapshotData.object.freeResize=!0,a.qInfo||(a.qInfo={}),a.qInfo.qId||(a.qInfo.qId=j.generateId()),a.qInfo.qType||(a.qInfo.qType=a.visualization||"unknown")}function n(d){var h=g.validateSettings(d,q);if(h.length)return b.reject(h);var i=d.layout.visualization;return f.isLoaded(i)||f.registerExtension({id:i,data:{type:"visualization"}}),m(d.layout),new b.Promise(function(b,f){var g={APIType:c,_disableSelections:!0,_skipRegisterExtensions:!0,_readStoredData:!0,_validatePromised:!0,selections:{_disableSelectionActivation:!0,_enablePanning:!0,toggleRect:!1,swipe:!1,tooltip:{touchTimeout:0}},onRendered:function(a){a?f(a):b()}};d.direction?g.direction=d.direction:d.layout.snapshotData.rtl&&(g.direction="rtl"),d.interactive&&e.setState(e.States.analysis);var h=a(d.element),i=k(d.layout,d.localeInfo);h.showComponent(o,{options:g,model:i})})}var o={template:'<qv-object options="options" model="model"></qv-object>',controller:["$scope",function(){}]},p=[{param:"language",type:"string"}],q=[{param:"element",type:"HTMLElement"},{param:"layout",type:"object"},{param:"localeInfo",type:"object"},{param:"element",type:"HTMLElement"},{param:"interactive",type:"boolean",optional:!0}];return{init:l,renderSnapshot:n}}),define("assets/object-renderer/object-renderer",["js/configloader!assets/object-renderer/object-renderer-impl"],function(a){return a}),define("objects.views/charts/events/event-launcher",["core.utils/class"],function(a){"use strict";return a.extend({init:function(){this._listeners={}},listen:function(a,b,c){return"function"!=typeof b?this:(this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push({callback:b,scope:c}),this)},stopListen:function(a,b,c){var d,e=this._listeners[a];if(e)for(d=e.length-1;d>=0;d-=1)b?(c&&c===e[d].scope&&e[d].callback===b||!c&&e[d].callback===b)&&e.splice(d,1):e.splice(d,1);return this},fire:function(a,b){var c,d,e=a;if("string"!=typeof e&&(e=a.getType()),c=this._listeners[e])for(d=c.length-1;d>=0;--d)"string"==typeof a?c[d].callback.apply(c[d].scope?c[d].scope:this,b||[]):c[d].callback.apply(c[d].scope?c[d].scope:this,[a]);return this},hasListener:function(a){var b=a;return"string"!=typeof b&&(b=a.getType()),this._listeners&&this._listeners[b]&&this._listeners[b].length}})}),define("objects.utils/animation-frame",[],function(){var a=function(a){return window.setTimeout(a,1e3/60)},b=function(a){return window.clearTimeout(a)},c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||a,d=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame||b;return{request:c===a?a:c.bind(window),cancel:d===b?b:d.bind(window)}}),define("objects.views/charts/invalidatable",["core.utils/deferred","./events/event-launcher","objects.utils/animation-frame"],function(a,b,c){"use strict";function d(b,c){var d;this._validating=!0,this._invalidatedProperties&&(!b||b&&b.contains("properties"))&&(d=f.call(this),d&&"function"==typeof d.then&&this._pendingDfds.push(d)),this._invalidatedDisplay&&(!b||b&&b.contains("display"))&&(d=e.call(this),d&&"function"==typeof d.then&&this._pendingDfds.push(d)),this._validating=!1,this._invalidated=this._invalidatedDisplay||this._invalidatedProperties,this._invalidated||(this._pendingDfds.length?(a.all(this._pendingDfds).then(function(){c.__qvState=1,c.resolve()}),this._pendingDfds=[]):(c.__qvState=1,c.resolve()))}function e(){var a=this._updateDisplay();return this._invalidatedDisplay=!1,this.__invalidators.display=[],a}function f(){var a=this._updateProperties();return this._invalidatedProperties=!1,this.__invalidators.properties=[],a}function g(){if(!this._invalidated&&!this._validating&&!this._released){var b,d=this;this._invalidated=!0,b=a(),b.__qvState=0,b.__id=++this._dfdCount,this.dfd=b,this._timer=c.request(function(){d._validate(null,b)})}if(this.dfd)return this.dfd.promise}return b.extend("Invalidatable",{init:function(){this._super(),this.__invalidators={size:[],display:[],properties:[]},this._pendingDfds=[],this._dfdCount=0},invalidate:function(){return this._released?a.reject():g.call(this)},invalidateProperties:function(b){return this._released?a.reject():(this._invalidatedProperties||(this._invalidatedProperties=!0,g.call(this)),this.__invalidators.properties.push(b),this.dfd.promise)},invalidateDisplay:function(b){return this._released?a.reject():(this._invalidatedDisplay||(this._invalidatedDisplay=!0,g.call(this)),this.__invalidators.display.push(b),this.dfd.promise)},validateNow:function(){return this._invalidated=!0,this.updateNow(),this},updateNow:function(a){if(this._invalidated&&!this._validating){var b=a&&a.contains("display")===this._invalidatedDisplay,d=a&&a.contains("properties")===this._invalidatedProperties;(!a||b&&d)&&(c.cancel(this._timer),this._timer=null),this._validate(a,this.dfd)}return this},_update:function(){return this},_updateDisplay:function(){},_updateProperties:function(){},cancel:function(){c.cancel(this._timer),this._invalidatedProperties=!1,this.__invalidators.properties=[],this._invalidatedDisplay=!1,this.__invalidators.display=[],this._invalidated=!1,this.dfd&&(this.dfd.__qvState=2,this.dfd.reject())},release:function(){this._released=!0,this.cancel(),this.dfd=null},_validate:function(a,b){d.call(this,a,b)}})}),define("objects.views/charts/utils/transition-helper",["jquery","core.utils/class","core.utils/deferred"],function(a,b,c){"use strict";function d(b,c,d,g){f.apply(this,[b,c]);var i,j,k,l,m,n=!0,o=!1,p=this;n=h.checkEqual(b,d);for(i in d)void 0===b[i]&&(o=!0);return n?(p._endCallback&&p._endCallback.call(p._scope),void g.resolve()):o?(a.extend(c,d),a.extend(b,d),p._endCallback&&p._endCallback.call(p._scope),void g.resolve()):(j=this._transitionTime,k=Date.now(),this._inAnimation=!0,this._initiateAnimation=!1,this._transitionProgress=0,a.extend(c,e(b,c,d,0)),void(this._animationCallback=setInterval(function(){if(l=(Date.now()-k)/j,l>1)clearInterval(p._animationCallback),a.extend(c,e(b,c,d,1)),p._updateCallback&&p._updateCallback.call(p._scope),p._inAnimation=!1,p._lastFrame=!0,p._transitionProgress=1;else{switch(p._transitionCurve){case"linear":m=l;break;case"easeout":m=Math.sin(Math.PI*l/2);break;case"easein":m=1-Math.cos(Math.PI*l/2);break;default:m=(1+Math.cos(Math.PI*(1+l)))/2}p._transitionProgress=m,a.extend(c,e(b,c,d,m)),p._updateCallback&&p._updateCallback.call(p._scope)}l>1&&(c=a.extend({},d),p._endCallback.call(p._scope),g.resolve())},15)))}function e(b,c,d,f){var g=function(b,c){a.extend(b,e(b,d[i][c],f))},h=function(a,b,c){b[i]=e(a[i],b[i],c[i],f)};if(f<=0)return b;if(f>=1)return d;for(var i in b)b||!d?!b||d?(b[i]instanceof Array?b[i].forEach(g):isNaN(b[i])&&b[i]instanceof Object&&h(b,c,d),b[i]&&!d[i]&&(c[i]=d[i]),null===b[i]||null===d[i]||isNaN(b[i])||isNaN(d[i])||(c[i]=b[i]*(1-f)+d[i]*f)):void 0!==b.opacity&&(c.opacity=1-f):(void 0!==d.opacity&&(c.opacity=f),c=a.extend(c,d));return c}function f(b,c){a.extend(b,c),clearInterval(this._animationCallback),this._inAnimation=!1,this._lastFrame=!1}function g(a,b,c,e){this._inAnimation||this._initiateAnimation&&this._transitionEnabled?d.call(this,a,b,c,e):e.resolve()}var h;return h=b.extend("TransitionHelper",{namespace:".transitionhelper",init:function(a,b,c,d){this._updateCallback=a,this._endCallback=b,this._transitionTime=c?c:500,this._scope=d,this._inAnimation=!1,this._transitionProgress=0,this._lastFrame=!1,this._animationCallback=function(){return null},this._initiateAnimation=!0,this._transitionEnabled=!0,this._transitionDelay=0,this._transitionCurve=""},transition:function(a,b,d,e,h,i){var j=this,k=c();return this._oldValues=a,this._currentValues=b,this._newValues=d,this._updateCallback=h,this._endCallback=e,this._scope=i,f.apply(this,[a,b]),this._initiateAnimation=!0,this._inAnimation||this._lastFrame?k.resolve():this._transitionDelay>0?this._trantisionTimeout=setTimeout(function(){g.apply(j,[a,b,d,k])},this._transitionDelay):g.apply(this,[a,b,d,k]),k.promise},clear:function(){clearInterval(this._animationCallback),clearTimeout(this._trantisionTimeout),this._inAnimation=!1,this._lastFrame=!0,this._transitionProgress=1},setTransitionTime:function(a){this._transitionTime=a},setDelay:function(a){this._transitionDelay=a},setTransitionCurve:function(a){this._transitionCurve=a}}),h.checkEqual=function(a,b){var c;for(c in b){if(!(c in a))return!1;if(typeof b[c]!=typeof a[c])return!1;if(Array.isArray(b[c])){if(!h.checkEqual(a[c],b[c]))return!1}else if(!(b[c]===a[c]||void 0===a[c]||"number"==typeof b[c]&&"number"==typeof a[c]&&isNaN(b[c])&&isNaN(a[c])))return!1}return!0},h}),define("objects.views/charts/utils/node",["core.utils/class"],function(a){var b;return b=a.extend("Node",{init:function(){this._parent=null,this._children=[],this._ancestors=null,this.data={}},detach:function(){return this._parent&&this._parent.removeChild(this),this},each:function(a,b){if("function"!=typeof a||!this._children||!this._children.length)return this;var c,d=this._children.length;for(c=0;c<d;c++)a.call(b,this._children[c],c),this._children[c].isBranch&&this._children[c].each(a,b);return this}}),Object.defineProperties(b.prototype,{parent:{get:function(){return this._parent}},isBranch:{get:function(){return this._children&&this._children.length}},children:{get:function(){return this._children}},siblings:{get:function(){if(!this._parent)return[];var a=this._parent._children.slice();return a.splice(a.indexOf(this),1),a}},ancestors:{get:function(){if(!this._ancestors){var a=this._parent;this._ancestors=a?[a].concat(a.ancestors):[]}return this._ancestors}},descendants:{get:function(){var a,b,c,d=[];for(a=0,b=this._children.length;a<b;a++)c=this._children[a],d.push(c),c._children.length&&(d=d.concat(c.descendants));return d}},leaves:{get:function(){var a,b,c=[],d=this._children.length;for(b=0;b<d;b++)a=this._children[b],a._children&&a._children.length?c=c.concat(a.leaves):c.push(a);return c}}}),b}),define("objects.views/charts/utils/matrix",["core.utils/class"],function(a){var b;return b=a.extend({init:function(){this._elements=[[1,0,0],[0,1,0],[0,0,1]],this._stack=[]},clone:function(){var a=new b;return a.multiply(this._elements)},set:function(a){return this._elements=a,this},save:function(){return this._stack.push(this.elements),this},restore:function(){return this._stack.length&&(this._elements=this._stack.pop()),this},add:function(a){var b,c;for(b=0;b<this._elements.length;b++)for(c=0;c<this._elements[b].length;c++)this._elements[b][c]+=a;return this},translate:function(a,b){return this.multiply([[1,0,a],[0,1,b],[0,0,1]]),this},rotate:function(a){var b=Math.cos(-a),c=Math.sin(-a);return this.multiply([[b,c,0],[-c,b,0],[0,0,1]]),this},skew:function(a,b){var c=Math.tan(a),d=Math.tan(b);return this.multiply([[1,c,0],[d,1,0],[0,0,1]]),this},multiply:function(a){var c,d,e,f;if(a instanceof b&&(a=a._elements),Array.isArray(a)){for(e=[[0,0,0],[0,0,0],[0,0,0]],c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)for(f=0;f<3;f++)e[c][d]+=this._elements[c][f]*a[f][d];this._elements=e}else for(c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)this._elements[c][d]*=a;return this},scale:function(a,b){return(arguments.length<2||"undefined"==typeof b)&&(b=a),this.multiply([[a,0,0],[0,b,0],[0,0,1]]),this},determinant:function(){var a=this._elements[0][0],b=this._elements[0][1],c=this._elements[0][2],d=this._elements[1][0],e=this._elements[1][1],f=this._elements[1][2],g=this._elements[2][0],h=this._elements[2][1],i=this._elements[2][2],j=0;return j=a*e*i+b*f*g+c*d*h-c*e*g-b*d*i-a*f*h},invert:function(){var a=this.determinant(),b=this._elements[0][0],c=this._elements[0][1],d=this._elements[0][2],e=this._elements[1][0],f=this._elements[1][1],g=this._elements[1][2],h=this._elements[2][0],i=this._elements[2][1],j=this._elements[2][2];return this._elements=[[f*j-g*i,d*i-c*j,c*g-d*f],[g*h-e*j,b*j-d*h,d*e-b*g],[e*i-f*h,h*c-b*i,b*f-c*e]],this.multiply(1/a),this},transpose:function(){var a=Object.create(this._elements);return this._elements=[[a[0][0],a[1][0],a[2][0]],[a[0][1],a[1][1],a[2][1]],[a[0][2],a[1][2],a[2][2]]],this},identity:function(){return this._elements=[[1,0,0],[0,1,0],[0,0,1]],this},transformPoint:function(a){var b,c,d=[a.x,a.y,1],e=this._elements,f=[0,0,0];for(b=0;b<this._elements.length;b++)for(c=0;c<this._elements[b].length;c++)f[b]+=d[c]*e[b][c];return{x:f[0],y:f[1]}},transformPoints:function(a){var b,c,d,e,f,g=this._elements,h=[];for(e=0;e<a.length;e++){for(b=[a[e].x,a[e].y,1],f=[0,0,0],c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)f[c]+=b[d]*g[c][d];h.push({x:f[0],y:f[1]})}return h},toString:function(){var a="";return this._elements.forEach(function(b,c,d){a+=b.join("\t")+(c<d.length?"\n":"")}),a},isIdentity:function(){var a=this._elements;return 1===a[0][0]&&0===a[0][1]&&0===a[0][2]&&0===a[1][0]&&1===a[1][1]&&0===a[1][2]&&0===a[2][0]&&0===a[2][1]&&1===a[2][2]},identityIfClose:function(a){var b=this._elements;Math.abs(b[0][0]-1)<a&&Math.abs(b[0][1])<a&&Math.abs(b[0][2])<a&&Math.abs(b[1][0])<a&&Math.abs(b[1][1]-1)<a&&Math.abs(b[1][2])<a&&Math.abs(b[2][0])<a&&Math.abs(b[2][1])<a&&Math.abs(b[2][2]-1)<a&&this.identity()}}),Object.defineProperties(b.prototype,{elements:{get:function(){var a=this._elements;return[[a[0][0],a[0][1],a[0][2]],[a[1][0],a[1][1],a[1][2]],[a[2][0],a[2][1],a[2][2]]]}}}),b}),define("objects.views/charts/utils/node-selector",["client.utils/property-resolver"],function(a){"use strict";var b={className:/^\w[\w-]+/,attr:/^\[\w(?:[\w\._-]+)?(?:[!]?=['\"][\w\s*#_-]*['\"])?\]/},c={className:function(a,b){return b.filter(function(b){var c=b.constructor.name;if(c){var d=a.replace(/(\-[a-z])/g,function(a){return a[1].toUpperCase()});return d=d[0].toUpperCase()+d.slice(1),c===a||c===d}})},attr:function(b,c,d,e){return e.filter(function(e){var f=a.getValue(e,b);if(!c)return"undefined"!=typeof f;if("undefined"==typeof f)return!1;switch(c){case"=":return d===String(f);case"!=":return d!==String(f)}return!1})}},d={find:function(a,b){var c,d,e=[],f=[];return b.isBranch&&(c=this._tokenize(a),d=b.descendants,c.forEach(function(a){var b=d.slice(),c=[],e=!1;a.reverse().forEach(function(a){return" "===a.type?(c.push(b),b=d.slice(),void(e=!1)):(b=this._filter(a,b),void(e=!0))},this),e&&c.push(b);var g=c[0].filter(function(a){var b,d,e=a.parent;for(b=1;b<c.length;b++){for(;e&&(d=c[b].indexOf(e))<0;)e=e.parent;if(d<0)return!1}return!0});f.push(g)},this),f.forEach(function(a){a.forEach(function(a){e.indexOf(a)<0&&e.push(a)})})),e||[]},_filter:function(a,b){if(!b||!b.length||!a||"function"!=typeof c[a.type])return[];switch(a.type){case"className":return c[a.type](a.value,b);case"attr":return c[a.type](a.attribute,a.operator,a.attributeValue,b)}return[]},_tokenize:function(a){var c,d,e,f,g=[];return a.split(/\s*,\s*/).forEach(function(a){for(a=a.trim(),c=[];a;){f=!1,e=a.match(/^\s*([>+~]|\s)\s*/),e&&(f=!0,c.push({type:" ",value:e[0]}),a=a.slice(e[0].length));for(var h in b)e=a.match(b[h]),e&&(f=!0,a=a.slice(e[0].length),d={type:h,value:e[0]},"attr"===h&&(e=e[0].match(/\[(\w[\w\._-]+)?(?:([!]?=)['\"]([\w\s#_-]*)['\"])?\]/),d.attribute=e[1],d.operator=e[2],d.attributeValue=e[3]),c.push(d));if(c&&c.length&&g.indexOf(c)<0&&g.push(c),!f)break}}),g}};return d}),define("objects.views/charts/shapes/display-object",["objects.views/charts/utils/node","objects.views/charts/utils/matrix","general.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(a,b,c,d){"use strict";function e(){this.matrix=new b,this.scale=g.scale,this.rotate=g.rotate,this.translate=g.translate,this._dirtyBounds=!0}var f,g={translate:function(a,b){return this.matrix.translate(a,b),this._dirtyBounds=!0,this.invalidate(),this},rotate:function(a){return this.matrix.rotate(a),this._dirtyBounds=!0,this.invalidate(),this},scale:function(a,b){return this.matrix.scale(a,b),this._dirtyBounds=!0,this.invalidate(),this}};return f=a.extend("DisplayObject",{init:function(){this._super(),this._dirtyBounds=!0,this._bounds=new c(NaN,NaN,NaN,NaN),this._vmBounds=new c(NaN,NaN,NaN,NaN),this._visualBounds=new c(NaN,NaN,NaN,NaN),this._stage=null,this.rData={inherited:{}},this._modelView=null,this._inverseModelView=null,this._inheritedProps={}},find:function(a){return d.find(a,this)},translate:function(a,b){return 0===a&&0===b?this:(e.call(this),g.translate.call(this,a,b))},rotate:function(a){return isNaN(a)||0===a?this:(e.call(this),g.rotate.call(this,a))},scale:function(a,b){return 1===a?this:(e.call(this),g.scale.call(this,a,b))},clearTransform:function(){return this.matrix&&(this.matrix.identity(),this._dirtyBounds=!0,this.invalidate()),this},invalidate:function(){var a=this._stage||this.stage;
return a&&a.invalidateObject(this),this._inheritedProps={},this},attr:function(a){return"undefined"!=typeof this[a]?this[a]:"undefined"!=typeof this.rData.inherited[a]?this.rData.inherited[a]:void 0},attrs:function(a){for(var b in a)"undefined"==typeof a[b]?delete this[b]:this[b]=a[b];return this},getBoundingRect:function(){return this._dirtyBounds&&this._calculateBounds(),this._vmBounds},getVisualBounds:function(){return this._dirtyBounds&&this._calculateBounds(),this._visualBounds},getVisualExpansion:function(){var a,b=this.attr("stroke");return b?(a=this.attr("strokeWidth"),a?a/2:0):0},pointInside:function(a,b){if(this.visible===!1)return!1;var c,d=this.getInverseModelView();return d&&this._transformedIncomingPoint!==!0?(c=d.transformPoint({x:a,y:b}),this.containsPoint(c.x,c.y)):this.containsPoint(a,b)},intersectsLine:function(a){if(this.visible===!1)return!1;var b,c,d,e=this.getInverseModelView();return e&&this._transformedIncomingPoint!==!0?(c=e.transformPoint({x:a.x1,y:a.y1}),d=e.transformPoint({x:a.x2,y:a.y2}),a=a.clone(),a.set(c.x,c.y,d.x,d.y),this._transformedIncomingPoint=!0,b=this.intersectsLocalLine(a),delete this._transformedIncomingPoint,b):this.intersectsLocalLine(a)},intersectsRect:function(a){if(this.visible===!1)return!1;var b,c,d=this.getInverseModelView();return d&&this._transformedIncomingPoint!==!0?(this._transformedIncomingPoint=!0,b=this._getTransformedBoundsOfRect(d,a),c=this.intersectsLocalRect(b),delete this._transformedIncomingPoint,c):this.intersectsLocalRect(a)},getPoints:function(){if(this.visible===!1)return[];var a,b,c,d=this.getModelView();if(d){for(a=this.getLocalPoints().slice(),b=0,c=a?a.length:0;b<c;b++)a[b]=d.transformPoint(a[b]);return a}return this.getLocalPoints()},getLocalPoints:function(){return[]},intersectsLocalLine:function(){return!1},intersectsLocalRect:function(a){var b,c="function"==typeof a.getPoints?a.getPoints():[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}],d=c.length;for(b=0;b<d;b++)if(this.containsPoint(c[b].x,c[b].y))return!0;for(c=this.getLocalPoints(),d=c.length,b=0;b<d;b++)if(c[b].x>=a.x&&c[b].x<=a.x+a.width&&c[b].y>=a.y&&c[b].y<=a.y+a.height)return!0;return!1},containsPoint:function(){return!1},getLocalBoundingRect:function(){return this._bounds},invalidateBounds:function(){return this._dirtyBounds=!0,this},clearModelView:function(){this._modelView=null,this._inverseModelView=null,this._isModelViewCalculated=!1,this._dirtyBounds=!0},getModelView:function(){return this._modelView||this._isModelViewCalculated||this._calculateModelView(),this._modelView},getInverseModelView:function(){return this._inverseModelView||this._isModelViewCalculated||this._calculateModelView(),this._inverseModelView},destroy:function(){this._stage=null},_calculateBounds:function(){var a,b=this._bounds,c=this.getLocalBoundingRect(),d=this.getModelView(),e=this.getVisualExpansion();c?(b.set(c.x,c.y,c.width,c.height),d?(a=this._getTransformedBoundsOfRect(d,b),this._vmBounds.set(a.x,a.y,a.width,a.height),a=this._getTransformedBoundsOfRect(d,{x:b.x-e,y:b.y-e,width:b.width+2*e,height:b.height+2*e}),this._visualBounds.set(a.x,a.y,a.width,a.height)):(this._vmBounds.set(c.x,c.y,c.width,c.height),this._visualBounds.set(c.x-e,c.y-e,c.width+2*e,c.height+2*e))):(b.set(NaN,NaN,NaN,NaN),this._vmBounds.set(NaN,NaN,NaN,NaN),this._visualBounds.set(NaN,NaN,NaN,NaN)),this._dirtyBounds=!1},_getTransformedBoundsOfRect:function(a,b){var d,e,f,g,h,i,j;return d=a.transformPoints([{x:b.x,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x+b.width,y:b.y+b.height},{x:b.x,y:b.y+b.height}]),e=d.map(function(a){return a.x}),f=d.map(function(a){return a.y}),g=Math.min.apply(null,e),i=Math.max.apply(null,e),h=Math.min.apply(null,f),j=Math.max.apply(null,f),new c(g,h,i-g,j-h)},_calculateModelView:function(){for(var a=this;a&&!a.rData.vmTransform;)a=a._parent;return this._isModelViewCalculated=!0,!!a&&(a._modelView||(a._modelView=new b,a._inverseModelView=new b),a.rData.dirtyVMTransform&&(a._modelView.set(a.rData.vmTransform),a._inverseModelView.set(a.rData.vmTransform).invert(),delete a.rData.dirtyVMTransform),this._modelView=a._modelView,this._inverseModelView=a._inverseModelView,!0)}}),Object.defineProperties(f.prototype,{stage:{get:function(){return this._parent&&!this._stage?this._stage=this._parent.stage:this._parent||this._stage===this||(this._stage=null),this._stage}}}),f}),define("general.utils/shapes/circle",["./rect"],function(a){"use strict";function b(a,b,c){0===arguments.length?this.set(0,0,0):this.set(a,b,c)}return b.prototype={toString:function(){return this.cx+" "+this.cy+" "+this.r},clone:function(){return new b(this.cx,this.cy,this.r)},set:function(a,b,c){this.cx=a,this.cy=b,this.r=c,this.radius=c},setPosition:function(a,b){this.cx=a,this.cy=b},setRadius:function(a){this.radius=a},combineWith:function(){},intersectsWith:function(a){return a.pointInside(this.cx,this.cy)},intersectsRect:function(a){return a.pointInside(this.cx,this.cy)},intersectsLine:function(a){if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var b,c,d,e,f,g,h,i;if(b=Math.sqrt(Math.pow(a.x2-a.x1,2)+Math.pow(a.y2-a.y1,2)),c=(a.x2-a.x1)/b,d=(a.y2-a.y1)/b,e=c*(this.cx-a.x1)+d*(this.cy-a.y1),f=c*(this.cx-a.x2)+d*(this.cy-a.y2),e>=0&&f<=1){if(g=e*c+a.x1,h=e*d+a.y1,i=Math.sqrt(Math.pow(g-this.cx,2)+Math.pow(h-this.cy,2)),i<=this.r)return!0}else if(f>=0&&f<=1&&(g=f*c+a.x2,h=f*d+a.y2,i=Math.sqrt(Math.pow(g-this.cx,2)+Math.pow(h-this.cy,2)),i<=this.r))return!0;return!1},pointInside:function(a,b){var c=Math.sqrt(Math.pow(this.cx-a,2)+Math.pow(this.cy-b,2));return c<=this.r},getPoints:function(){return[{x:this.cx,y:this.cy}]},getBoundingRect:function(){return new a(this.cx-this.r,this.cy-this.r,2*this.r,2*this.r)}},b}),define("general.utils/shapes/vector",["core.utils/class"],function(a){var b;return b=a.extend({init:function(a,b){this.x=a||0,this.y=b||0},clone:function(){return new b(this.x,this.y)},add:function(a){this.x+=a.x,this.y+=a.y},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),b.add=function(a,b){return a.clone().add(b)},b}),define("general.utils/shapes/arc",["./line","./circle","./rect","./vector"],function(a,b,c,d){"use strict";function e(a,b,c,d,e,f,g){this.cx=a,this.cy=b,this.innerRadius=c,this.radius=d,this.radianOffset=(g<0?g+2*Math.PI:g)%(2*Math.PI),this.start=e,this.start-=this.start>Math.PI?2*Math.PI:0,this.end=f,this.end-=this.end>Math.PI?2*Math.PI:0,this.arcCenter=(e+f)/2%(2*Math.PI),this.x1=a+d*Math.cos(this.start+this.radianOffset),this.y1=b+d*Math.sin(this.start+this.radianOffset),this.x2=a+d*Math.cos(this.end+this.radianOffset),this.y2=b+d*Math.sin(this.end+this.radianOffset),this.x3=a+c*Math.cos(this.start+this.radianOffset),this.y3=b+c*Math.sin(this.start+this.radianOffset),this.x4=a+c*Math.cos(this.end+this.radianOffset),this.y4=b+c*Math.sin(this.end+this.radianOffset)}var f=["top","left","bottom","right"],g={top:"left",left:"bottom",bottom:"right",right:"top"},h={top:"right",left:"top",bottom:"left",right:"bottom"};return e.prototype={getDistance:function(a,b,c,d){var e=Math.abs(a-c),f=Math.abs(b-d),g=Math.sqrt(Math.pow(e,2)+Math.pow(f,2));return g},getAngle:function(a,b,c,d){var e=a-c,f=b-d,g=Math.atan2(f,e)-this.radianOffset;return g=g<0?g+2*Math.PI:g,g=g>Math.PI?g-2*Math.PI:g},pointInside:function(a,b){var c=this.getAngle(a,b,this.cx,this.cy),d=this.getDistance(a,b,this.cx,this.cy),e=this.start,f=this.end;return!(d>this.radius||d<this.innerRadius)&&(c>=e&&c<=f||e>f&&(c<=f||c>=e))},getDirection:function(a){a+=Math.PI/4,a<0&&(a+=2*Math.PI),a%=2*Math.PI;var b=3;return a>=1.5*Math.PI?b=0:a>=Math.PI?b=1:a>=Math.PI/2&&(b=2),f[b]},getSecondaryDirection:function(a){var b=this.getDirection(a);return a+=Math.PI/4,a%(Math.PI/2)>Math.PI/4?h[b]:g[b]},getPoints:function(){var a=[];return a.push({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},{x:this.x3,y:this.y3},{x:this.x4,y:this.y4}),a},getBoundingRect:function(){var a=Math.min(Math.min(this.x1,this.x2),Math.min(this.x3,this.x4)),b=Math.min(Math.min(this.y1,this.y2),Math.min(this.y3,this.y4)),d=Math.max(Math.max(this.x1,this.x2),Math.max(this.x3,this.x4))-a,e=Math.max(Math.max(this.y1,this.y2),Math.max(this.y3,this.y4))-b;return new c(a,b,d,e)},getRelevantPosition:function(){var a=this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),b=this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset),c=this.getDirection(this.arcCenter+this.radianOffset),d=this.getSecondaryDirection(this.arcCenter+this.radianOffset);return{pos:{x:a,y:b},direction:[c,d].concat(d===g[c]?[h[c],g[d]]:[g[c],h[d]])}},intersectsWith:function(b){return this.intersectsLine(new a(b.x,b.y,b.x+b.width,b.y))||this.intersectsLine(new a(b.x+b.width,b.y,b.x+b.width,b.y+b.height))||this.intersectsLine(new a(b.x,b.y+b.height,b.x+b.width,b.y+b.height))||this.intersectsLine(new a(b.x,b.y,b.x,b.y+b.height))},intersectsLine:function(c){if(this.pointInside(c.x1,c.y1)||this.pointInside(c.x2,c.y2))return!0;if(c.intersectsLine(new a(this.x1,this.y1,this.x4,this.y4))||c.intersectsLine(new a(this.x3,this.y3,this.x2,this.y2)))return!0;var e=new b(this.cx,this.cy,this.innerRadius);if(this.innerRadius>0&&e.pointInside(c.x1,c.y1)&&e.pointInside(c.x2,c.y2))return!1;var f,g,h,i,j=new d(c.x2-c.x1,c.y2-c.y1),k=new d(c.x1-this.cx,c.y2-this.cy),l=j.dot(j),m=2*k.dot(j),n=k.dot(k)-this.radius*this.radius,o=m*m-4*l*n,p=[];if(o<0)return!1;if(o=Math.sqrt(o),g=(-m-o)/(2*l),h=(-m+o)/(2*l),g>=0&&g<=1&&p.push({x:c.x1+g*j.x,y:c.y1+g*j.y}),h>=0&&h<=1&&p.push({x:c.x1+h*j.x,y:c.y1+h*j.y}),!p.length)return!1;for(f=0;f<p.length;f++){if(i=this.getAngle(p[f].x,p[f].y,this.cx,this.cy),i>=this.start&&i<=this.end)return!0;if(this.start>this.end&&(i<=this.end||i>=this.start))return!0}return!1}},e}),define("objects.views/charts/shapes/arc",["objects.views/charts/shapes/display-object","general.utils/shapes/arc"],function(a,b){"use strict";var c,d=Math.PI/2,e=3*Math.PI/2,f=2*Math.PI;return c=a.extend("Arc",{init:function(a,c,d,e,f,g,h){this._super(),b.apply(this,[a,c,d,e,f,g,h])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,getLocalPoints:b.prototype.getPoints,intersectsLocalRect:function(a){return b.prototype.intersectsWith.call(this,a)},getLocalBoundingRect:function(){var a,b,c=[this.x1,this.x2,this.x3,this.x4],g=[this.y1,this.y2,this.y3,this.y4],h=(this.start+this.radianOffset)%f,i=h+this.end-this.start;return(h<f&&i>f||h<0&&i>0)&&c.push(this.cx+this.radius),h<d&&i>d&&g.push(this.cy+this.radius),h<Math.PI&&i>Math.PI&&c.push(this.cx-this.radius),(h<e&&i>e||h<-d&&i>-d)&&g.push(this.cy-this.radius),a=Math.min.apply(null,c),b=Math.min.apply(null,g),{x:a,y:b,width:Math.max.apply(null,c)-a,height:Math.max.apply(null,g)-b}},getRelevantPosition:function(){var a=this.getModelView(),c=b.prototype.getRelevantPosition.call(this);if(a){var d=this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),e=this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset),f={x:d,y:e};f=a.transformPoint(f),c.pos.x=f.x,c.pos.y=f.y}return c},set:function(){b.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints","getRelevantPosition","intersectsRect"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/components/chart-component",["../invalidatable","objects.views/charts/utils/transition-helper","general.utils/shapes/rect","objects.views/charts/shapes/arc","objects.utils/layout","core.utils/deferred","jquery"],function(a,b,c,d,e,f,g){"use strict";function h(a){if(this._$renderAreaWrap){this.containerRect=new c(this.rect.x*this.layoutToContainerRatios.x||1,this.rect.y*this.layoutToContainerRatios.y||1,this.rect.width*this.layoutToContainerRatios.x||1,this.rect.height*this.layoutToContainerRatios.y||1),this.container.style.left=this.containerRect.x+"px",this.container.style.top=this.containerRect.y+"px",this.container.style.width=this.containerRect.width+"px",this.container.style.height=this.containerRect.height+"px";var b=this.isVisible(a)&&0!==this.rect.width&&0!==this.rect.height?"block":"none";this.container.style.display!==b&&(this.container.style.display=b)}}function i(a,c){return b.checkEqual(a,c)}function j(a){return a?(a=a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()}),a.replace(/^\-/,"")):""}var k;return k=a.extend("ChartComponent",{init:function(a,d,e){this._super(),this.testId=e,this.options=g.extend(!0,{},{dock:"center",show:!0,relevantSize:0,showFlag:this.ShowFlags.SPARK,components:{}},d),this.rect=new c,this._transitionHelper=new b,this._transitionHelper.setTransitionCurve("easein"),this._oldProperties={},this._currentProperties={},this._transitionProperties={},this._useTransition=!1,this.outerRect=new c,this.containerRect=new c,this.layoutToContainerRatios={x:1,y:1},this.renderers={},this.dock=this.options.dock,this.show=this.options.show,this.isMini=this.options.isMini,this.relevantSize=this.options.relevantSize,this.showFlag=this.options.showFlag,this.layoutOrder=this.options.order||1,this.reductionOrder=this.options.reductionOrder,this.parentContainer=a,this.components=this.options.components,this.selectionIdentifier=this.options.label,this._selectionIndices=[0],this.chartFormatter=null,this.measureFormatters=[],this._globalAlpha=1,this._hasValidData=!1,this._createRenderArea();try{var f=d&&d.tcl?d.tcl:j(this.constructor.name);f&&this._$renderAreaWrap[0].setAttribute("tcl",f)}catch(h){}this.chartScale=1,this._edgeBleed={top:0,bottom:0,left:0,right:0}},ShowFlags:{SPARK:1,XSMALL:2,SMALL:4,MEDIUM:8,FULL:16},setData:function(a){return this._data=a,this.invalidateProperties("ChartComponent.setData")},getTransformedShape:function(a){var b,e=this.layoutToContainerRatios.x||1,f=this.layoutToContainerRatios.y||1;if(a instanceof c)b=new c(a.x*e,a.y*f,a.width*e,a.height*f);else if(a instanceof d){var g=a.getModelView(),h={x:a.cx*e,y:a.cy*f};g&&(h=g.transformPoint(h)),b=new d(h.x,h.y,Math.min(e,f)*a.innerRadius,Math.min(e,f)*a.radius,a.start,a.end,a.radianOffset)}return b},getTransformedPoint:function(a,b){return{x:a*this.layoutToContainerRatios.x||1,y:b*this.layoutToContainerRatios.y||1}},getOriginalPoint:function(a,b){return{x:a/this.layoutToContainerRatios.x||1,y:b/this.layoutToContainerRatios.y||1}},setLayoutMode:function(a){if(this._layoutMode!==a){this._layoutMode=a;var b=/\s*qv-layout-\S+\s*/g,c=this._layoutMode?" qv-layout-"+e.getLayoutModeKey(a):"";this.container.className.match(b)?this.container.className=this.container.className.replace(/\s*qv-layout-\S+/g,c):this.container.className+=c,this.invalidateDisplay("ChartComponent.setLayoutMode")}},getLayoutMode:function(){return this._layoutMode},setVerticalLayoutMode:function(a){this._verticalLayoutMode=a},setHorizontalLayoutMode:function(a){this._horizontalLayoutMode=a},setSelectableShapes:function(a){this._selectableShapes=a},getSelectableShapes:function(){return this._selectableShapes||[]},getSelectedCacheItems:function(){var a,b=this._selectableShapes?this._selectableShapes.length:0,c=[];for(a=0;a<b;a++)this._selectableShapes[a].selected&&c.push(this._selectableShapes[a]);return c},getRect:function(){return this.rect},setRect:function(a,b,c,d){this.rect.set(a,b,c,d)},setUseTransition:function(a){this._useTransition=a},getUseTransition:function(){return this._useTransition},getTransitionHelper:function(){return this._transitionHelper},setOuterRect:function(a,b,c,d){this.outerRect.set(a,b,c,d)},setLayoutToContainerRatios:function(a,b){this.layoutToContainerRatios={x:a,y:b}},setContainerRect:function(a,b,c,d){this.containerRect.set(a,b,c,d)},setSelectionIndices:function(a){if(!(a&&a instanceof Array))throw"invalid input, selectionsIndices has to be an Array";this._selectionIndices=a},getSelectionIndices:function(){return this._selectionIndices},setSelectionLocked:function(a){this._selectionLocked=a},isSelectionLocked:function(a){a=a||this._data;var b=this.getSelectionIndices();return a&&Array.isArray(b)&&b.length?!a.qHyperCube.qDimensionInfo.filter(function(a,c){return b.indexOf(c)!==-1},this).some(function(a){return a.qLocked!==!0}):this._selectionLocked},setYMirrorMode:function(a){this.yMirrorMode=a,this.readDirection=this.yMirrorMode?"rtl":"ltr"},setDock:function(a){switch(a){case"left":case"top":case"right":case"bottom":case"center":break;default:throw a+" invalid parameter"}this.options.dock=a,this.dock=a},getOppositeDock:function(){var a=this.options.dock;switch(a){case"left":return"right";case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"center":return"center";default:throw a+" invalid parameter"}},isHorizontal:function(){var a=this.options.dock;switch(a){case"top":case"bottom":return!0;default:return!1}},isVertical:function(){var a=this.options.dock;switch(a){case"left":case"right":return!0;default:return!1}},showComponent:function(){if(this.show=this.options.show,this.renderers)for(var a in this.renderers)this.renderers[a].show()},hideComponent:function(){if(this.show=!1,this.renderers)for(var a in this.renderers)this.renderers[a].hide()},getFormatter:function(){return this._formatter||this.measureFormatters[0]||{format:function(a){return a.toString()}}},isVisible:function(a){void 0===a&&(a=this._layoutMode);var b=this.showFlag,c=a;return"object"==typeof b&&("whenVertical"in b&&(b=this.isVertical()?b.whenVertical:b.whenHorizontal),"vertical"in b)?this.show&&!!(b.vertical&this._verticalLayoutMode)&&!!(b.horizontal&this._horizontalLayoutMode):this.show&&!!(b&c)},setHasValidData:function(a){this._hasValidData=a},hasValidData:function(){return this._hasValidData},calculateRelevantSize:function(){this.relevantSize=this.options.relevantSize},reduceLayoutRect:function(a){switch(this.dock){case"top":a.y+=this.relevantSize,a.height-=this.relevantSize;break;case"bottom":a.height-=this.relevantSize;break;case"left":a.x+=this.relevantSize,a.width-=this.relevantSize;break;case"right":a.width-=this.relevantSize}},insertAdjacentTo:function(a,b){switch(this.dock){case"top":this.rect.x=a.x,this.rect.y=a.y-this.relevantSize,this.rect.width=a.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,b&&(a.y-=this.relevantSize,a.height+=this.relevantSize);break;case"bottom":this.rect.x=a.x,this.rect.y=a.getBottom(),this.rect.width=a.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,b&&(a.height+=this.relevantSize);break;case"left":this.rect.x=a.x-this.relevantSize,this.rect.y=a.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=a.height,b&&(a.x-=this.relevantSize,a.width+=this.relevantSize);break;case"right":this.rect.x=a.getRight(),this.rect.y=a.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=a.height,b&&(a.width+=this.relevantSize);break;case"center":this.rect.x=a.x,this.rect.y=a.y,this.rect.width=a.width,this.rect.height=a.height}},_updateProperties:function(){return this._transition()},_updateDisplay:function(){return this.hasValidData()?this.isVisible(this._layoutMode)&&this.rect.width>0&&this.rect.height>0?this.paint(this._layoutMode,this._data):f.resolve():this.clear()},updateSize:function(){h.call(this,this._layoutMode);for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},_transition:function(){this._useTransition?i(this._currentProperties,this._transitionProperties)?this._onAnimatitonEnd():(this._inTransition=!0,this._transitionHelper.transition(this._oldProperties,this._currentProperties,this._transitionProperties,this._onAnimatitonEnd,this._updateDisplay,this)):(g.extend(this._currentProperties,this._transitionProperties),g.extend(this._oldProperties,this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd"))},paint:function(){},setGlobalOpacity:function(a,b){this._globalAlpha=a,b||this.invalidateDisplay("ChartComponent.setGlobalOpacity")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=g(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container))},_onAnimatitonEnd:function(){this._inTransition=!1,this._oldProperties=g.extend(!0,{},this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd")},release:function(){if(this._super(),this.renderers)for(var a in this.renderers)this.renderers[a].release();this.container=null,this._$renderAreaWrap=null,this._selectableShapes=null},clear:function(){var a=[];if(this.renderers)for(var b in this.renderers)a.push(this.renderers[b].clear());return f.all(a)},on:function(){this._on=!0},off:function(){this._on=!1}})}),define("objects.views/charts/shapes/polygon",["objects.views/charts/shapes/display-object","general.utils/shapes/polygon","general.utils/shapes/line"],function(a,b){"use strict";var c;return c=a.extend("Polygon",{init:function(a){this._super(),a?this.set(a):this._polygons=[]},getLocalBoundingRect:function(){var a;if(this._polygons&&this._polygons.length)return a=this._polygons.reduce(function(a,b){return a.combineWith(b.getBoundingRect())},this._polygons[0].getBoundingRect()),{x:a.x,y:a.y,width:a.width,height:a.height}},getLocalPoints:function(){return this._polygons&&this._polygons[0]?this._polygons[0].points:[]},getPartialFromRange:function(a,b){for(var d,e=0,f=[],g=this._polygons[0]?this._polygons[0].points:[],h=g.length,i=a<=b;e<h&&(i?g[e].x<a:g[e].x>a);)e++;for(e&&e<h&&(d=(a-g[e-1].x)/(g[e].x-g[e-1].x),f.push({x:a,y:g[e-1].y+d*(g[e].y-g[e-1].y),y_:g[e-1].y_+d*(g[e].y_-g[e-1].y_)}));e<h&&(i?g[e].x<b:g[e].x>b);)f.push({x:g[e].x,y:g[e].y,y_:g[e].y_}),e++;if(e&&e<h&&(d=(b-g[e-1].x)/(g[e].x-g[e-1].x),f.push({x:b,y:g[e-1].y+d*(g[e].y-g[e-1].y),y_:g[e-1].y_+d*(g[e].y_-g[e-1].y_)})),f.length)return new c(f)},set:function(a){var c=a&&a[0]&&Array.isArray(a[0])?a:[a];this._polygons=c.map(function(a){return new b(a)}),this.invalidateBounds()},intersectsLocalLine:function(a){return this._polygons.some(function(b){return b.intersectsLine(a)})},intersectsLocalRect:function(a){return this._polygons.some(function(c){return b.prototype.intersectsRect.call(c,a)})},containsPoint:function(a,b){return this._polygons.some(function(c){return c.pointInside(a,b)})}})}),define("objects.views/charts/utils/tree-node",["objects.views/charts/utils/node"],function(a){"use strict";var b,c;return b=a.extend("TreeNode",{addChild:function(b){if(!(b&&b instanceof a))throw new TypeError("Expecting a Node as argument, but got "+b);if(b===this)throw"Can not add itself as child!";if(b._children&&b._children.length&&this.ancestors.indexOf(b)>=0)throw"Can not add an ancestor as child!";return b._parent&&b._parent!==this&&b._parent.removeChild(b),c=this._children.indexOf(b),c>=0&&this._children.splice(c,1),this._children.push(b),b._parent=this,b._ancestors=null,this},addChildren:function(a){var b,c=a?a.length:0;for(b=0;b<c;b++)this.addChild(a[b]);return this},removeChild:function(a){return c=this._children.indexOf(a),c>=0&&(this._children.splice(c,1),a._parent=null,a._ancestors=null),this},removeChildren:function(a){var b,c;if(!this._children)return this;if(a)for(c=a.length,b=0;b<c;b++)this.removeChild(a[b]);else for(;this._children.length;)this.removeChild(this._children[0]);return this}})}),define("objects.views/charts/shapes/container",["objects.views/charts/shapes/display-object","objects.views/charts/utils/tree-node"],function(a,b){"use strict";var c,d;return c=a.extend("Container",{init:function(){this._super()},addChild:function(a){b.prototype.addChild.call(this,a),this.doInvalidate&&a.invalidate()},addChildren:b.prototype.addChildren,removeChild:function(a){this.doInvalidate&&a.invalidate(),a._stage=null;var c,d=a.descendants,e=d?d.length:0;for(c=0;c<e;c++)d[c]._stage=null;return b.prototype.removeChild.call(this,a),this},removeChildren:function(a){var b,c,d,e,f;if(!this._children)return this;if(a)for(d=a.length,b=0;b<d;b++)this.removeChild(a[b]);else{for(d=this._children.length,b=0;b<d;b++)for(this._children[b]._parent=null,this._children[b]._ancestors=null,this._children[b]._stage=null,e=this._children[b].descendants,f=e?e.length:0,c=0;c<f;c++)e[c]._stage=null;this._children.length=0}return this},containsPoint:function(a,b){if(this._children&&this._children.length)for(var c=0,d=this._children.length;c<d;c++)if(this._children[c].containsPoint(a,b))return!0;return!1},intersectsLocalRect:function(a){if(this._children&&this._children.length)for(var b=0,c=this._children.length;b<c;b++)if(this._children[b].intersectsLocalRect(a))return!0;return!1},intersectsLocalLine:function(a){if(this._children&&this._children.length)for(var b=0,c=this._children.length;b<c;b++)if(this._children[b].intersectsLocalLine(a))return!0;return!1},getLocalPoints:function(){var a=[];if(this._children&&this._children.length)for(var b=0,c=this._children.length;b<c;b++)a=a.concat(this._children[b].getLocalPoints());return a},getLocalBoundingRect:function(){var a,b,c,e,f,g,h,i=!1;if(this._children&&this._children.length){for(g=0,h=this._children.length;g<h;g++)f=this._children[g].getVisualBounds(),f&&!isNaN(f.width+f.height+f.x+f.y)&&(i?(a=Math.min(a,f.x),c=Math.max(c,f.x+f.width),b=Math.min(b,f.y),e=Math.max(e,f.y+f.height)):(a=f.x,c=f.x+f.width,b=f.y,e=f.y+f.height,i=!0));return i?{x:a,y:b,width:c-a,height:e-b}:d}return d},_calculateBounds:function(){var a=this._bounds,b=this.getLocalBoundingRect(),c=0;b?(a.set(b.x,b.y,b.width,b.height),this._vmBounds.set(b.x,b.y,b.width,b.height),this._visualBounds.set(b.x-c,b.y-c,b.width+2*c,b.height+2*c)):(a.set(NaN,NaN,NaN,NaN),this._vmBounds.set(NaN,NaN,NaN,NaN),this._visualBounds.set(NaN,NaN,NaN,NaN)),this._dirtyBounds=!1}})}),define("objects.views/charts/renderers/stage",["objects.views/charts/shapes/container","general.utils/shapes/rect","core.utils/notification"],function(a,b,c){var d;return d=a.extend("Stage",{init:function(){this._super(),this._stage=this,this._dimensions=new b(0,0,0,0),c.create(this,"Invalid")},invalidateObject:function(a){return this.Invalid.emit(a),this},destroy:function(){this._super(),c.release(this)}})}),define("objects.views/charts/renderers/renderer",["core.utils/class","objects.views/charts/renderers/stage","general.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(a,b,c,d){"use strict";var e;return e=a.extend("Renderer",{init:function(){this._stage=new b,this._stageBinding=function(a){this.invalidateObject(a)}.bind(this),this._stage.Invalid.bind(this._stageBinding),this.scaling={x:1,y:1},this._size=new c,this._extendedSize=new c},find:function(a){return d.find(a,this._stage)},setDimensions:function(a,b,c,d){this._size.set(a,b,c,d)},setDimensionsToContainerRatio:function(a,b){this.scaling={x:a,y:b}},release:function(){this._stage&&this._stage.Invalid&&this._stage.Invalid.unbind(this._stageBinding),this._stage.destroy(),this._stageBinding=null},render:function(){},clear:function(){},invalidateObject:function(){}}),Object.defineProperties(e.prototype,{stage:{get:function(){return this._stage}}}),e}),define("objects.views/charts/shapes/rect",["objects.views/charts/shapes/display-object","general.utils/shapes/rect"],function(a,b){"use strict";var c;return c=a.extend("Rect",{init:function(a,c,d,e,f){this._super(),this._radius=f||0,b.apply(this,[a,c,d,e])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,intersectsLocalRect:b.prototype.intersectsRect,getLocalBoundingRect:b.prototype.getBoundingRect,getLocalPoints:b.prototype.getPoints,set:function(a,c,d,e,f){b.prototype.set.apply(this,[a,c,d,e]),f>=0&&(this._radius=f),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/rect",["objects.views/charts/shapes/rect"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){if(this._radius){var d=this.x,e=this.y,f=this.width,g=this.height,h=Math.min(this._radius,f/2,g/2),i=d+f,j=e+g;a.beginPath(),a.moveTo(d+h,e),a.quadraticCurveTo(d,e,d,e+h),a.lineTo(d,j-h),a.quadraticCurveTo(d,j,d+h,j),a.lineTo(i-h,j),a.quadraticCurveTo(i,j,i,j-h),a.lineTo(i,e+h),a.quadraticCurveTo(i,e,i-h,e),a.lineTo(d+h,e),a.closePath(),b&&a.fill(),c&&a.stroke()}else b&&a.fillRect(this.x,this.y,this.width,this.height),c&&a.strokeRect(this.x,this.y,this.width,this.height)}}}),define("objects.views/charts/shapes/circle",["objects.views/charts/shapes/display-object","general.utils/shapes/circle"],function(a,b){"use strict";var c;return c=a.extend("Circle",{init:function(a,c,d){this._super(),b.apply(this,[a,c,d])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,intersectsLocalRect:b.prototype.intersectsRect,getLocalPoints:b.prototype.getPoints,getLocalBoundingRect:function(){return{x:this.cx-this.r,y:this.cy-this.r,width:2*this.r,height:2*this.r}},set:function(){b.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/circle",["objects.views/charts/shapes/circle"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){a.beginPath(),a.moveTo(this.cx+this.r,this.cy),a.arc(this.cx,this.cy,this.r,0,2*Math.PI,!1),b&&a.fill(),c&&a.stroke()}}}),define("objects.views/charts/shapes/line",["objects.views/charts/shapes/display-object","general.utils/shapes/line","util"],function(a,b,c){"use strict";var d;return d=a.extend("Line",{init:function(a,c,d,e){this._super(),b.apply(this,[a,c,d,e])},containsPoint:function(){return!1},intersectsLocalLine:b.prototype.intersectsLine,intersectsLocalRect:b.prototype.intersectsRect,getLocalPoints:b.prototype.getPoints,getLocalBoundingRect:function(){var a=Math.min(this.x1,this.x2),b=Math.max(this.x1,this.x2),c=Math.min(this.y1,this.y2),d=Math.max(this.y1,this.y2);return{x:a,y:c,width:b-a,height:d-c}},set:function(){b.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()},getPartialFromRange:function(a,b){if(!(b<this.x1||a>this.x2)){var e=this.x2-this.x1,f=this.y2-this.y1,g=a<=this.x1?0:(a-this.x1)/e,h=b>=this.x2?1:(b-this.x1)/e,i=new d(this.x1+g*e,this.y1+g*f,this.x1+h*e,this.y1+h*f);if(i.data=c.extend({},this.data),!isNaN(this.data.y1_)){var j=this.data.y2_-this.data.y1_;i.data.y1_=this.data.y1_+g*j,i.data.y2_=this.data.y1_+h*j}return i}}}),Object.keys(b.prototype).forEach(function(a){!b.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(a)<0&&(d.prototype[a]=b.prototype[a])}),d}),define("objects.views/charts/renderers/canvas/line",["objects.views/charts/shapes/line"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){c&&(a.beginPath(),a.moveTo(this.x1,this.y1),a.lineTo(this.x2,this.y2),a.stroke())}}}),define("objects.views/charts/renderers/canvas/polygon",["objects.views/charts/shapes/polygon"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){var d,e,f,g,h,i;for(a.beginPath(),h=0;h<this._polygons.length;h++){if(d=this._polygons[h].points,e=d?d.length:0,f=d[0],!f)return;for(i=f,a.moveTo(f.x,f.y),g=1;g<e;g+=1)f=d[g],a.lineTo(f.x,f.y);this.close===!1||!c||i.x===f.x&&i.y===f.y||a.lineTo(i.x,i.y)}this.close!==!1&&a.closePath(),b&&a.fill(),c&&a.stroke()}}}),define("objects.views/charts/renderers/canvas/arc",["objects.views/charts/shapes/arc"],function(a){
"use strict";return{displayObject:a,render:function(a,b,c){a.beginPath(),0===this.innerRadius?(a.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),a.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy)):this.end-this.start===2*Math.PI?(a.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),a.moveTo(this.cx+this.innerRadius*Math.cos(this.radianOffset+this.start),this.cy+this.innerRadius*Math.sin(this.radianOffset+this.start)),a.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0)):(a.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),a.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy),a.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0),a.lineTo(this.radius*Math.cos(this.start+this.radianOffset)+this.cx,this.radius*Math.sin(this.start+this.radianOffset)+this.cy)),b&&a.fill(),c&&(a.closePath(),a.stroke())}}}),define("objects.views/charts/shapes/text-helper",[],function(){function a(a,b,c,d){var e,f,g,i,j,k,l=a?a.split(/\n+|\r+|\r\n/):[],m=[],n=a?a.split(/\s+/):[],o=l[0];if("number"!=typeof b||b<=0)return[a];if("number"==typeof d&&l.length>=d)return l.slice(0,d);for(c&&(h.font=c),f=0;f<l.length;f++){for(k=l[f]||"",n=k.split(/\s+/),o=n[0],j="",e=1;e<n.length;e++)if(g=o+" "+n[e],i=h.measureText(g).width,i>b&&("number"!=typeof d||d>m.length)?(m.push(o),o=n[e]):o=g,"number"==typeof d&&m.length>=d){j=n.slice(e+1).join(" ");break}"number"!=typeof d||m.length<d?m.push(o):m[Math.max(0,m.length-1)]=(m[Math.max(0,m.length-1)]||"")+" "+o+" "+j}return m}function b(a,b,d,e,g){if(!a||!a.length)return[];d&&(h.font=d);var i,j,k,l,m=[],n=a.slice();if(n.filter(function(a){return!!a}),"number"!=typeof b||b<0)return a.slice();for(l=0;l<n.length;l++)k=n[l],j=null,k&&(k.length<=1||h.measureText(k).width<=b?m.push(k):(i=f(k,b,void 0,e-m.length),i.length<=1?m.push(i[0]):(j=i.pop(),m=m.concat(i),n[l+1]?h.measureText(j+" "+n[l+1]).width>b&&m.length+n.length-l<=e?n.splice(l+1,0,j):n[l+1]=j+" "+n[l+1]:n.push(j))));return m.forEach(function(a,b,c){c[b]=a?a.trim():a}),m.length>e?(m=m.splice(0,e),m[m.length-1]=c(m[m.length-1],b,d,g).text):(k=m[m.length-1],k&&k.length>1&&h.measureText(k).width>b&&(m[m.length-1]=c(k,b,d,g).text)),m}function c(a,b,c,d){var e,f,g,j,k=a,l=h.measureText("i").width,m=Math.ceil(b/l);if(d=d||i,c&&(h.font=c),a&&b){if(h.measureText(k).width>b){for(e=Math.min(m,k.length);e>0;e--)if(f=k.substring(0,e-1),g=f.trim()+d,h.measureText(g).width<=b){j=k.substring(e-1),k=g;break}e||(j=k,k=i)}}else j=void 0;return{text:k,rest:j}}function d(a){return"number"==typeof a&&isFinite(a)}function e(a,b,c,f){var g,i,k=a,l="",m=[];if(d(c)&&c<=1)return[a];var n=Math.ceil(b/f),o=Math.min(a.length,n);for(g=o;g>0&&(k=a.substring(0,g),i=a.substring(g-1,g)," "===i?k=a.substring(0,g-1):k+=j,l=a.substring(g),!(h.measureText(k).width<=b));g--);return(!g&&!k||h.measureText(k).width>b)&&(k=a.substring(0,1),l=a.substring(1)),m.push(k),l?(h.measureText(l).width>b?(l=e(l,b,c-1,f),m=m.concat(l)):m.push(l),m.filter(function(a){return""!==a.trim()})):m}function f(a,b,c,d){return a&&b?(c&&(h.font=c),e(a,b,d,Math.max(1,h.measureText("i").width))):[]}function g(c,d,e,f,g){var h;return isNaN(d)?[c]:(h=f>1?a(c,d,e,f):[c],h=b(h,d,e,f,g))}var h=document.createElement("canvas").getContext("2d"),i="",j="-";return{lineWrap:a,wordWrap:b,splitWord:f,wrap:g,truncate:c}}),define("objects.views/charts/shapes/text",["objects.views/charts/shapes/display-object","objects.views/charts/shapes/text-helper","general.utils/shapes/line"],function(a,b,c){"use strict";function d(a){return 1.5*a.measureText("m").width}function e(a){g.font=this.font;var c,e=d(g),f=(this.lineHeightMultiplicator||1)*e,h="maxWidth"in this?this.maxWidth:this.width,i="maxHeight"in this?this.maxHeight:this.height,j=this.maxNumLines,k=[],l=0,m=[];return this.lineHeight=f,i<e?[]:(c=i?Math.max(1,Math.floor(i/f)):j||1,Array.isArray(j)?(j.forEach(function(a){l+=isNaN(a)||a<=0?0:a}),j.forEach(function(a){k.push(isNaN(a)||a<=0?c-l:a)})):k=[isNaN(j)||j<=0?c:Math.min(c,j)],Array.isArray(a)?a.forEach(function(a,d){m.length<c&&(m=m.concat(b.wrap(a,h,this.font,k[d])))},this):m=b.wrap(a,h,this.font,k[0],this.ellipsis),m)}var f,g=document.createElement("canvas").getContext("2d");return f=a.extend("Text",{init:function(){this._super(),this.options={},this.x=0,this.y=0,this.lineHeightMultiplicator=1,this._dirtyMeasures=!0,this._measures={numLines:0,width:0,height:0}},setText:function(a){return this.text=a,this.invalidateBounds(),this},tokenize:function(){return this.lines=e.apply(this,[this.text]),this},measure:function(){if(this.preRender(),this._dirtyMeasures){var a,b=0,c=this.lines;for(g.font!==this.font&&(g.font=this.font),a=0;a<c.length;a++)b=Math.max(b,g.measureText(c[a]).width);this._measures.numLines=c.length,this._measures.width=b,this._measures.height=c.length*this.lineHeight,this._dirtyMeasures=!1}return{numLines:this._measures.numLines,width:this._measures.width,height:this._measures.height}},getHorizontalAnchor:function(){var a,b=this.x||0;if(this.width>0){if(a=this.attr("align"),"center"===a)return b+this.width/2;if("right"===a)return b+this.width}return b},getVerticalAnchorFirstLine:function(){var a,b=this.y||0,c=this.attr("baseline");return"middle"===c?(a=this.attr("lineHeight"),b-=(this.lines.length-1)*a/2,this.height>0&&(b+=this.height/2)):"bottom"===c&&(a=this.attr("lineHeight"),b-=(this.lines.length-1)*a,this.height>0&&(b+=this.height)),b},preRender:function(){var a,b="";Array.isArray(this.text)?this.text.forEach(function(a){b+=a+"__"}):b=this.text,a=this.attr("font"),this.font=a;var c=b+a+this.maxWidth+this.width+this.height;return c!==this._renderedID&&(this.tokenize(),this.invalidateBounds(),this._dirtyMeasures=!0,this._renderedID=c),this},getLocalBoundingRect:function(){var a=this.measure(),b=this.x,c=this.y,d=this.attr("align")||"left",e=this.attr("baseline")||"top";return this.height?"middle"===e?c+=this.height/2-a.height/2:"bottom"===e&&(c+=this.height-a.height):"middle"===e?c-=a.height/2:"bottom"===e&&(c-=a.height),this.width?"center"===d?b+=this.width/2-a.width/2:"right"===d&&(b+=this.width-a.width):"center"===d?b-=a.width/2:"right"===d&&(b-=a.width),{x:b,y:c,width:a.width,height:a.height}},containsPoint:function(a,b){var c=this.getLocalBoundingRect();return a>c.x&&a<c.x+c.width&&b>c.y&&b<c.y+c.height},getLocalPoints:function(){var a=this.getLocalBoundingRect();return[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}]},intersectsLocalRect:function(a){if(!a)return!1;var b=this.getLocalBoundingRect();return b.x<=a.x+a.width&&a.x<=b.x+b.width&&b.y<=a.y+a.height&&a.y<=b.y+b.height},intersectsLocalLine:function(a){if(this.containsPoint(a.x1,a.y1)||this.containsPoint(a.x2,a.y2))return!0;var b=this.getLocalBoundingRect();return a.intersectsLine(new c(b.x,b.y,b.x+b.width,b.y))||a.intersectsLine(new c(b.x+b.width,b.y,b.x+b.width,b.y+b.height))||a.intersectsLine(new c(b.x+b.width,b.y+b.height,b.x,b.y+b.height))||a.intersectsLine(new c(b.x,b.y+b.height,b.x,b.y))}})}),define("objects.views/charts/renderers/canvas/text",["objects.views/charts/shapes/text","client.utils/rtl/rtl-util"],function(a,b){"use strict";var c=!b.supportDirAuto();return{displayObject:a,render:function(a,d,e){var f,g,h,i=this.x||0,j=this.y||0,k=this.lines||[],l=k.length,m=[],n=this.lineHeight,o=a.textAlign,p="center"===o&&c;if(i=this.getHorizontalAnchor(),j=this.getVerticalAnchorFirstLine(),d&&m.push("fillText"),e&&(this.strokeFirst?m.unshift("strokeText"):m.push("strokeText")),m.length){for(f=0;f<l;f++)g=b.detectTextDirection(k[f]),a.canvas.dir=g,p&&"rtl"===g?(a.textAlign="left",h=i-a.measureText(k[f]).width/2):(a.textAlign=o,h=i),a[m[0]](k[f],h,j),m[1]&&a[m[1]](k[f],h,j),j+=n;a.textAlign=o}}}}),define("objects.views/charts/renderers/canvas-renderer",["jquery","core.utils/deferred","objects.views/charts/renderers/renderer","objects.views/charts/utils/matrix","objects.utils/animation-frame","general.utils/shapes/rect","objects.views/charts/renderers/canvas/rect","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/line","objects.views/charts/renderers/canvas/polygon","objects.views/charts/renderers/canvas/arc","objects.views/charts/renderers/canvas/text"],function(a,b,c,d,e,f){"use strict";function g(a,b){w.length>100&&delete v[w.shift()],w.push(a),v[a]=b}function h(){var a={dfd:b(),state:u.PENDING},c=a.dfd.promise;return c.then(function(){a.state=u.RESOLVED},function(){a.state=u.REJECTED}),a}function i(a,b,c,d,e){return d+e*(a-b)/c}var j,k=1,l=[].slice.call(arguments,6),m={},n=l.length,o=document.createElement("canvas"),p=o.getContext("2d"),q=["fill","stroke","strokeWidth","opacity","font","align","baseline","lineJoin","lineCap"],r=new RegExp(q.join("|")),s=q.length,t={fill:"fillStyle",stroke:"strokeStyle",strokeWidth:"lineWidth",opacity:"globalAlpha",align:"textAlign",baseline:"textBaseline"},u={PENDING:0,RESOLVED:1,REJECTED:2},v={},w=[],x=0;return j=c.extend("CanvasRenderer",{init:function(b,c){this._super(),this._id=++x,this._canvas=document.createElement("canvas"),this._canvas.width=this._size.width,this._canvas.height=this._size.height,this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._bufferCanvas=document.createElement("canvas"),this._bufferCanvas.width=this._canvas.width,this._bufferCanvas.height=this._canvas.height,this._mvMatrix=new d,this._wrapper=document.createElement("div"),this._wrapper.style.position="relative",this._wrapper.style.left="0",this._wrapper.style.top="0",this._wrapper.appendChild(this._canvas),c&&c.name&&a(this._wrapper).attr({tid:c.name}),a(this._wrapper).attr({tcl:"renderer"}).data("_renderer",this),this.container=b,this.container.appendChild(this._wrapper),this._isCompositingEnabled=!0,this._invalidObjects=[],this._transformMatrix=new d,this._storeNewImage=!0},setDimensions:function(a,b,c,d){this._super(a,b,c,d),this._wrapper.style.left=a+"px",this._wrapper.style.top=b+"px"},setCompositingEnabled:function(a){this._isCompositingEnabled=a},getCompositingEnabled:function(){return this._isCompositingEnabled},render:function(a){if(!this._rendering)return this._resetImage(),this._renderDfdObj&&this._renderDfdObj.state===u.PENDING||(this._renderDfdObj=h()),a?this._invalidate(!0,!1):(this._doClear=!1,this._doRender=!0,this._validate()),this._renderDfdObj.dfd.promise},clear:function(a){this._rendering||(a?this._invalidate(!1,!0):(this._doRender=!1,this._doClear=!0,this._validate()))},release:function(){this._super(),this._clearSchedule(),a(this._wrapper).removeData(),this._bufferCanvas=null,this._canvas=null,this.container&&(this.container.removeChild(this._wrapper),this.container=null)},invalidateObject:function(a){this._isCompositingEnabled&&this._invalidObjects.indexOf(a)<0&&this._invalidObjects.push(a),this.render(!0)},transformScene:function(a){return this._transformMatrix=a.clone(),this._invalidate(!0,!1),this},translateScene:function(a,b){return this._transformMatrix.translate(a,b),this._invalidate(!0,!1),this},scaleScene:function(a,b,c){return this._transformMatrix.translate(-a,-b),this._transformMatrix.scale(c,c),this._transformMatrix.translate(a,b),this._invalidate(!0,!1),this},setAttribute:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(this._wrapper[a][c]=b[c])},getTextWidth:function(a,b){return j.getTextWidth(a,b,this._canvas.getContext("2d"))},getFontHeight:function(a){return j.getFontHeight(a,this._canvas.getContext("2d"))},_render:function(){if(this._canvas){this._rendering=!0;var a=this._canvas,b=a.getContext("2d"),c=this._mvMatrix,d=[],e=this._isCompositingEnabled&&!this._transformMatrix.isIdentity(),g=j.getDevicePixelToBackingStoreRatio();if(e&&this._storeNewImage&&(this._storeImage(),this._storeNewImage=!1),this._updateSize()||(this._isCompositingEnabled&&(d=this._getInvalidViews().filter(function(a){return!a.hasNaN()}),d.length&&e?d=[]:e&&(b.clearRect(0,0,a.width,a.height),d=d.concat(this._getInvalidImageParts()).filter(function(a){return!a.hasNaN()}))),d.length||b.clearRect(0,0,a.width,a.height)),b.save(),c.save(),this.stage.matrix&&this.stage.matrix.identity(),this.stage.scale(this.scaling.x,this.scaling.y),this.stage.translate(-this._extendedSize.x,-this._extendedSize.y),this.stage.translate(this._transformMatrix.elements[0][2],this._transformMatrix.elements[1][2]),b.setTransform(g,0,0,g,0,0),d.length&&(e&&(b.save(),b.setTransform(1,0,0,1,0,0),this._patchImage(),this._transformMatrix.identity(),b.restore()),b.beginPath(),d.forEach(function(a){b.rect(a.x,a.y,a.width,a.height)}),b.clip(),b.clearRect(0,0,this._extendedSize.width,this._extendedSize.height)),!d.length){var h=new f(0,0,this.scaling.x*this._extendedSize.width,this.scaling.y*this._extendedSize.height);d.push(h)}j._updateTransforms([this.stage],c,{}),j._renderDisplayObjects(b,[this.stage],!!this._isCompositingEnabled&&d,g),c.restore(),b.restore(),this._invalidObjects=[],this._rendering=!1}},_updateSize:function(){var a,b,c,d=this._canvas,e=j.getDevicePixelToBackingStoreRatio(),g=this._extendedSize;return this.edgeBleed?g.set(-this.edgeBleed.left,-this.edgeBleed.top,this._size.width+this.edgeBleed.left+this.edgeBleed.right,this._size.height+this.edgeBleed.top+this.edgeBleed.bottom):g.set(this._size.x,this._size.y,this._size.width,this._size.height),c=new f(Math.round(g.x*this.scaling.x),Math.round(g.y*this.scaling.y),Math.round(g.width*this.scaling.x),Math.round(g.height*this.scaling.y)),a=Math.round(e*c.width),b=Math.round(e*c.height),this._canvas.style.left=c.x+"px",this._canvas.style.top=c.y+"px",(d.width!==a||d.height!==b)&&(d.width=a,d.height=b,d.style.width=c.width+"px",d.style.height=c.height+"px",this._bufferCanvas.width=a,this._bufferCanvas.height=b,!0)},_invalidate:function(a,b){if(this._doRender=a||this._doRender,this._doClear=b||this._doClear,!this._invalidated){var c=this;this._invalidated=!0,this._timer=e.request(function(){c._validate()},this._canvas)}},_validate:function(){this._doClear&&!this._doRender?this._clear():this._doRender&&this._render(),this._renderDfdObj&&this._renderDfdObj.state===u.PENDING&&this._renderDfdObj.dfd.resolve(),this._clearSchedule()},_clear:function(){this._canvas&&(this._canvas.width=this._canvas.width)},_clearSchedule:function(){this._timer&&(e.cancel(this._timer),this._timer=null),this._renderDfdObj&&this._renderDfdObj.state===u.PENDING&&this._renderDfdObj.dfd.reject(),this._doRender=!1,this._doClear=!1,this._invalidated=!1},_getInvalidViews:function(){var a,b,c,d,e,g,h,i,j,k,l,m=this._invalidObjects?this._invalidObjects.length:0,n=new f,o=!1,p=!1,q=new f;for(a=0;a<m;a++)b=this._invalidObjects[a].getVisualBounds(),c=this._invalidObjects[a].rData.oldVisualBounds,!o&&b?(d=b.x,g=b.x+b.width,e=b.y,h=b.y+b.height,o=!0):b&&(d=Math.min(d,b.x),g=Math.max(g,b.x+b.width),e=Math.min(e,b.y),h=Math.max(h,b.y+b.height)),!p&&c?(i=c.x,k=c.x+c.width,j=c.y,l=c.y+c.height,p=!0):c&&(i=Math.min(i,c.x),k=Math.max(k,c.x+c.width),j=Math.min(j,c.y),l=Math.max(l,c.y+c.height));return n.set(Math.floor(d)-1,Math.floor(e)-1,Math.ceil(g-d)+2,Math.ceil(h-e)+2),q.set(Math.floor(i)-1,Math.floor(j)-1,Math.ceil(k-i)+2,Math.ceil(l-j)+2),n.x!==q.x||n.y!==q.y||n.width!==q.width||n.height!==q.height?[n,q]:[n]},_getInvalidImageParts:function(){var a=[],b=this._transformMatrix.elements[0][0],c=this._transformMatrix.elements[0][2],d=this._transformMatrix.elements[1][2];return b&&b>1?a.push(new f(0,0,0,0)):b&&b<1?a.push(new f(0,0,0,0)):(0!==c&&this._size.width>Math.abs(c)&&a.push(new f(c>0?0:this._size.width+c,0,Math.abs(c),this._size.height)),0!==d&&this._size.height>Math.abs(d)&&a.push(new f(0,d>0?0:this._size.height+d,this._size.width,Math.abs(d)))),a},_storeImage:function(){var a=this._bufferCanvas.getContext("2d");a.clearRect(0,0,this._bufferCanvas.width,this._bufferCanvas.height),a.drawImage(this._canvas,0,0)},_patchImage:function(){var a=j.getDevicePixelToBackingStoreRatio(),b=this._transformMatrix.elements[0][0];if(1!==b){var c,d,e,f,g,h,k,l,m={x:0,y:this._size.height},n={x:this._size.width,y:0},o=this._transformMatrix.transformPoint(m),p=this._transformMatrix.transformPoint(n),q=p.x-o.x,r=p.y-o.y,s=o.x/q,t=p.y/r;if(b>1?(k=0,l=0,c=this._size.width,d=this._size.height,e=-s*this._size.width,f=t*this._size.height,g=this._size.width/b,h=this._size.height/b):(e=0,f=0,g=this._size.width,h=this._size.height,c=this._size.width*b,d=this._size.height*b,k=s*c,l=-t*d),g*=a,h*=a,e*=a,f*=a,k*=a,l*=a,c*=a,d*=a,e>this._bufferCanvas.width||e+g<0||f>this._bufferCanvas.height||f+h<0)this._canvas.getContext("2d").drawImage(this._bufferCanvas,0,0,0,0,0,0,0,0);else{var u,v,w,x,y,z,A,B,C,D,E,F;u=Math.max(e,0),v=Math.min(e+g,this._bufferCanvas.width),w=i(u,e,g,k,c),x=i(v,e,g,k,c),C=v-u,E=x-w,y=Math.max(f,0),z=Math.min(f+h,this._bufferCanvas.height),A=i(y,f,h,l,d),B=i(z,f,h,l,d),D=z-y,F=B-A,this._canvas.getContext("2d").drawImage(this._bufferCanvas,u,y,C,D,w,A,E,F)}}else this._canvas.getContext("2d").drawImage(this._bufferCanvas,this._transformMatrix.elements[0][2]*a,this._transformMatrix.elements[1][2]*a)},_resetImage:function(){this._transformMatrix.identity(),this._storeNewImage=!0}}),j.getFontHeightOfContext=function(a){return 1.5*a.measureText("m").width},j.getFontHeight=function(a,b){if("string"!=typeof a)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(a in v)return v[a];var c;return b=b||p,b.font!==a?(b.save(),b.font=a,c=1.5*b.measureText("m").width,b.restore()):c=1.5*b.measureText("m").width,g(a,c),c},j.getTextWidth=function(a,b,c){var d;return c=c||p,c.save(),c.font=b,d=void 0!==a?Math.ceil(c.measureText(a).width):0,c.restore(),d},j.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(p.webkitBackingStorePixelRatio||p.mozBackingStorePixelRatio||p.msBackingStorePixelRatio||p.oBackingStorePixelRatio||p.backingStorePixelRatio||1)},j.measureText=function(a,b,c){var d,e,f;return c=c||p,b&&c.font!==b&&(c.save(),c.font=b),e=c.measureText(a).width,b in v?d=v[b]:(d=1.5*c.measureText("m").width,g(b,d)),b&&c.restore(),f=void 0!==a?{width:e,height:d}:{width:0,height:0}},j._renderDisplayObjects=function(a,b,c,d){var e,f,g,h,i,k,l=c?c.length:0,m=[],n=!0,o=[];for(f=b?b.length:0,e=0;e<f;e++)if(g=b[e],g.visible!==!1&&g.data.isVisible!==!1){if(l){for(n=!1,i=0;i<l;i++)if(c[i].intersectsWith(g.getVisualBounds())){n=!0;break}if(!n)continue}h=j._getRenderFn(b[e]),k=g.children.length>0,("function"==typeof h||k)&&(g.zIndex>0?(m[g.zIndex]||(m[g.zIndex]={index:g.zIndex,objects:[]}),m[g.zIndex].objects.push({object:g,renderFn:h,hasChildren:k})):j._renderObject(a,g,h,k,c,d))}for(m=m.filter(function(a){return a&&a.objects.length}).sort(function(a,b){return a.index-b.index}),e=0;e<m.length;e++)for(o=m[e].objects,f=o.length,i=0;i<f;i++)j._renderObject(a,o[i].object,o[i].renderFn,o[i].hasChildren,c,d)},j._renderObject=function(a,b,c,d,e,f){var g,h,i,k,l;"function"==typeof c&&(h=b.attr("strokeWidth"),"undefined"==typeof h&&(h=1),i=!!b.attr("fill"),k=!!b.attr("stroke")&&h>0),a.save(),b.rData.stroke=k,b.rData.strokeWidth=h,e&&(l=b.getVisualBounds(),b.rData.oldVisualBounds={x:l.x,y:l.y,width:l.width,height:l.height}),j._applyAttributes(a,b),b.rData.vmTransform&&(g=b.rData.vmTransform,a.setTransform(f*g[0][0],f*g[1][0],f*g[0][1],f*g[1][1],f*g[0][2],f*g[1][2])),b.clip&&(a.beginPath(),a.rect(b.clip.x,b.clip.y,b.clip.width,b.clip.height),a.clip()),(i||k)&&(b.preRender&&b.preRender(),c.apply(b,[a,i,k])),d&&j._renderDisplayObjects(a,b.children,e,f),a.restore()},j._registerRenderFn=function(a,b){var c;if("function"!=typeof a)throw new TypeError("First parameter must be a function");c="function"!=typeof b&&"function"==typeof b.constructor?b.constructor:b,c.__renderFnId="_"+k++,m[c.__renderFnId]=a},j._getRenderFn=function(a){var b=a.__renderFnId||(a.constructor?a.constructor.__renderFnId:void 0);if(b)return m[b];for(var c=0;c<n;c++)if(l[c].displayObject===a.constructor)return j._registerRenderFn(l[c].render,a),l[c].render;for(c=0;c<n;c++)if(a instanceof l[c].displayObject)return j._registerRenderFn(l[c].render,a),l[c].render;a.constructor.__renderFnId="does not exist"},j._updateTransforms=function(a,b,c){var d,e,f,g,h,i={},k=a?a.length:0;for(h in c)r.test(h)&&(i[h]=c[h]);for(d=0;d<k;d++){e=a[d],e.clearModelView(),e.matrix&&(b.save(),b.multiply(e.matrix),e.rData.vmTransform=b.elements,e.rData.dirtyVMTransform=!0),e.rData.inherited={};for(h in i)e.rData.inherited[h]=i[h];if(g=e.children,g&&g.length){for(f=0;f<s;f++)e.hasOwnProperty(q[f])&&(i[h]=e[h]);j._updateTransforms(g,b,i)}e.matrix&&b.restore()}},j.Gradient={LINEAR:0,RADIAL:1},j._applyAttributes=function(a,b){var c,d;for(d=0;d<s;d++)c=q[d],c in b&&"undefined"!=typeof b[c]&&(("fill"===c||"stroke"===c)&&b[c]&&b[c].gradient?b[c].gradient.r?a[t[c]]=j._createGradient(a,b[c].gradient,j.Gradient.RADIAL)||"#000000":a[t[c]]=j._createLinearGradient(a,b[c].gradient)||"#000000":a[t[c]||c]=b[c])},j._createLinearGradient=function(a,b){return j._createGradient(a,b,j.Gradient.LINEAR)},j._createGradient=function(a,b,c){var d,e,f;if(!(isNaN(b.x0)||isNaN(b.y0)||isNaN(b.x1)||isNaN(b.y1))){for(d=c===j.Gradient.RADIAL?a.createRadialGradient(b.x0,b.y0,0,b.x1,b.y1,b.r):a.createLinearGradient(b.x0,b.y0,b.x1,b.y1),f=b.limits.length,e=0;e<f;e++)d.addColorStop(b.limits[e],b.colors[e]);return d}},j.registerRenderObject=function(a){l.push(a),n=l.length},j}),define("extensions.qliktech/barchart/layers/bar-helpers",["objects.views/charts/shapes/rect"],function(a){"use strict";function b(a,b,c,d,e,f,g){var h,i;return f?(h=b,i=c,c=e,b=d,e=h,d=i,c<b&&(h=c,c=b,b=h),b=Math.max(g.x,Math.min(g.x+g.width,b)),c=Math.max(g.x,Math.min(g.x+g.width,c))):(d<e&&(h=e,e=d,d=h),d=Math.max(g.y,Math.min(g.y+g.height,d)),e=Math.max(g.y,Math.min(g.y+g.height,e))),a.set(b,e,c-b,d-e),a}function c(a,b,c,d){var e=[{x:a.x,y:a.y},{x:a.x,y:a.y+a.height},{x:a.x+a.width,y:a.y+a.height},{x:a.x+a.width,y:a.y}];switch(b){case"left":d?e[0].x-=c:e[1].x+=c;break;case"right":d?e[2].x+=c:e[3].x-=c;break;case"top":d?e[3].y-=c:e[0].y+=c;break;case"bottom":d?e[1].y+=c:e[2].y-=c}return e}function d(b,d,e){var f,g=e.pad,h=e.gap,i=e.sharpness,j=b.clone(),k=c,l=[];return"right"===d?(f=new a(j.x+j.width+h,j.y,g-h,j.height),l.push(k(j,"right",i,!0)),l.push(k(f,"left",i,!1,!0)),b.width+=f.width+h):"left"===d?(f=new a(0,j.y,g-h,j.height),l.push(k(j,"left",i,!0)),l.push(k(f,"right",i,!1,!0)),b.x=f.x,b.width+=f.width+h):"down"===d?(f=new a(j.x,j.y+j.height+h,j.width,g-h),l.push(k(j,"bottom",i,!0)),l.push(k(f,"top",i,!1,!0)),b.height+=f.height+h):"up"===d&&(f=new a(j.x,0,j.width,g-h),l.push(k(j,"top",i,!0)),l.push(k(f,"bottom",i,!1,!0)),b.y=f.y,b.height+=f.height+h),l}function e(a,b,c){a.set(d(a.data.hitRect,b,c))}function f(a,b,c){a.set(h(a.data.hitRect,b,c))}function g(a,b,c,d,e){var f=[];return"left"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a-d,y:b})):"right"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a+d,y:b})):"up"===e?(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b-d})):"down"===e&&(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b+d})),f}function h(a,b,c){var d,e,f;return f=Math.min(a[["left","right"].contains(b)?"height":"width"]/2,8),e=Math.min(f,8),"left"===b?(d=g(c.x+e,a.y+a.height/2,f,e,b),a.width+=e):"right"===b?(d=g(c.x+c.width-e-1,a.y+a.height/2,f,e,b),a.width+=e,a.x-=e):"up"===b?(d=g(a.x+a.width/2,c.y+e,f,e,b),a.height+=e):"down"===b&&(d=g(a.x+a.width/2,c.y+c.height-e-1,f,e,b),a.height+=e,a.y-=e),d}return{updateRectangle:b,getSpike:d,getSlicedPolygon:c,getHint:h,updateSpike:e,updateHint:f}}),define("extensions.qliktech/barchart/layers/bar-layer",["core.utils/class","general.utils/shapes/rect","objects.views/charts/shapes/polygon","objects.views/charts/renderers/canvas-renderer","client.utils/property-resolver","extensions.qliktech/barchart/layers/bar-helpers"],function(a,b,c,d,e,f){"use strict";function g(){var a,d,e,g,h,i,j,k,l,m,n,o,p=this.style.shape,q=new b(0,0,0,0),r=this.widthRatio,s=this.isSpikingEnabled,t=this.isHintingEnabled,u=[],v=this.majorAxis.isDiscrete(),w=this.majorAxis.getDiscreteSpacing()*r,x=this.minorAxis.getPlotMax(),y=this.minorAxis.getPlotMin(),z=!this.majorAxis.isVertical(),A=this.minorAxis.getPadding(),B=this.minorAxis.getPositionOfValue(0)-1,C={pad:z?A.top:A.right},D={pad:z?A.bottom:A.left},E=new b;C.gap=.3*C.pad,C.sharpness=.3*C.pad,D.gap=.3*D.pad,D.sharpness=.3*D.pad,E.set(A.left,A.top,this.rect.width-A.left-A.right,this.rect.height-A.top-A.bottom),this._bounds=E;var F=0,G=z?this.rect.width:this.rect.height,H=-1,I=z?this.rect.height:this.rect.width;for(k=this.shapes?this.shapes.length:0,l=0;l<k;l++)if(i=this.shapes[l],o=i instanceof c||"Polygon"===i.type,j=this.majorAxis.getPositionOfId(i.data.axisId),h=v?w:this.majorAxis.getWidthOfId(i.data.axisId)*r,i.data.isNaN||isNaN(i.data.value)?(i.data.isNaN=!0,e=g=B):(e=this.minorAxis.getPositionOfValue(i.data.start)-1,g=this.minorAxis.getPositionOfValue(i.data.end)-1),a=j-h/2,d=j+h/2,f.updateRectangle(i.data.hitRect,a,d,e,g,!z,E),delete i.data.labelRect,delete i.data.isCutOff,delete i.data.hintDirection,d<F||a>G)i.data.isVisible=!1;else{i.data.isVisible=!0,o?i.set(i.data.hitRect.getPoints()):i.set(i.data.hitRect.x,i.data.hitRect.y,i.data.hitRect.width,i.data.hitRect.height),q.set(i.data.hitRect.x,i.data.hitRect.y,i.data.hitRect.width,i.data.hitRect.height),u.push(i),m=i.data.cacheItem;var J=m.selected;if(i.data.isFakeOtherCell&&i.data.highlightOnGroupSelect&&m.children[0].selected){J=!0;for(var K=0;K<m.children.length;K++)if(!m.children[K].selected){J=!1;break}}n=J?p.selected:{border:{color:0,width:0}},i.stroke=n.border.color,i.fill=i.data.isFakeOtherCell?this.othersFillPattern:i.data.fill,i.strokeWidth=n.border.width,i.opacity=J?1:this._globalAlpha;var L=!!t&&this._getHint(e,g,E,z),M=!(!o||L||!s)&&this._getSpike(i.data.end,e,g,E,z,y,x);M?(i.data.labelRect=q.clone(),f.updateSpike(i,z?i.data.end>=0?"up":"down":i.data.end>=0?"right":"left",i.data.end>=0?C:D),i.data.isCutOff=!0):L?(i.fill="#999999",f.updateHint(i,L,E),i.data.hintDirection=L):(e<H&&g<H||e>I&&g>I)&&(i.data.isVisible=!1)}this.nodesInView=u}var h;return h=a.extend("BarLayer",{init:function(a){this.renderer=new d(a,{name:"bar-layer"}),this.widthRatio=.7,this.isSpikingEnabled=!1,this.isHintingEnabled=!1,this.shapes=[],this._globalAlpha=1},release:function(){this.renderer.release(),this.shapes=null,this.minorAxis=null,this.majorAxis=null},update:function(){g.call(this)},render:function(){return this.renderer.render()},clear:function(){this.renderer.clear()},_getStyle:function(a){return{selected:{border:{color:e.getValue(a,"shape.selected.border.color","rgba(0,0,0,0.25)"),width:e.getValue(a,"shape.selected.border.width",1)}}}},_getHint:function(a,b,c,d){if(d){if(b+1<c.y&&a+1<=c.y)return"up";if(b+1>c.y+c.height&&a+1>=c.y+c.height)return"down"}else{if(b+1<c.x&&a+1<=c.x)return"left";if(b+1>c.x+c.width&&a+1>=c.x+c.width)return"right"}return!1},_getSpike:function(a,b,c,d,e,f,g){var h=a>g,i=a<f;return e?(h=h&&c<d.y&&b>d.y,i=i&&c>d.y+d.height&&b<d.y+d.height):(h=h&&c>d.x+d.width&&b<d.x+d.width,i=i&&c<d.x&&b>d.x),h||i}})}),define("objects.views/charts/utils/canvas-renderer",["core.utils/class","general.utils/shapes/rect","objects.utils/animation-frame","jquery","./matrix","core.utils/deferred","client.utils/rtl/rtl-util"],function(a,b,c,d,e,f,g){"use strict";function h(a,b){A.length>100&&delete z[A.shift()],A.push(a),z[a]=b}function i(a){if(a.font in z)return z[a.font];var b=1.5*a.measureText("m").width;return h(a.font,b),b}function j(a,b,c,d,e){var f,g,h=b.shape.points,i=h?h.length:0;if(a.beginPath(),f=h[0]){for(a.moveTo(f.x,f.y),g=1;g<i;g+=1)f=h[g],a.lineTo(f.x,f.y);e&&a.closePath(),c&&a.fill(),d&&a.stroke()}}function k(a,b,c){var d,e,f,g=a?a.replace(/^\s*|\s*$/,"").split(" "):[],h=[],i=g[0];if(!i)return[];for(d=1;d<g.length;d++)e=i+" "+g[d],f=v.measureText(e).width,f>b&&c>h.length?(h.push(i),i=g[d]):i=e;return h.length<c?h.push(i):h[Math.max(0,h.length-1)]?h[Math.max(0,h.length-1)]+=" "+i:h[Math.max(0,h.length-1)]=" "+i,h}function l(a,b,c){if(void 0!==a){var d,e,f,g,h,i,j,k,l="",m=v.measureText("i").width;for(d=0;d<a.length;d++){if(e=a[d],j=Math.ceil(Math.max(0,b/m))+1,j<e.length?(g=e.slice(j),e=e.slice(0,j)):g="",f=e,e&&e.length>1&&v.measureText(e).width>b){for(h=!1,i=e.length;i>0;i--)if(f=f.substring(0,f.length-1),k=f+(d+1<c?"-":l),v.measureText(k).width<b){g=e.substring(i-1)+g,e=k,h=!0;break}h||(g=e.substring(1),e=e.substring(0,1)),h||i||(g="",e=l)}a[d]=String(e).trim(),g&&d<a.length-1?a[d+1]=g+" "+a[d+1]:g&&a.length<c&&a.push(g)}}}function m(a,b,c){var d,e=c.maxWidth;return isNaN(e)?[a]:(d=b>1?k(a,e,b):[a],l(d,e,b),d)}function n(a,b,c){var d,e,f,h,j=b.text,k=(b.lineHeight||1)*i(a),l="maxWidth"in b?b.maxWidth:b.width,n="maxHeight"in b?b.maxHeight:b.height,o=b.width,p=b.height,q=b.maxNumLines,r=b.x||0,s=b.y||0,t=a.textAlign,u="center"===t&&B;if(v.font=a.font,isNaN(q)&&(q=n?Math.max(1,Math.floor(n/k)):1),d=m(j,q,{maxWidth:l,maxHeight:n}),c){for(o=0,e=0;e<d.length;e++)o=Math.max(o,a.measureText(d[e]).width);return{lines:d,numLines:d.length,width:o,height:d.length*k,truncated:Array.isArray(/$/.exec(d[d.length-1]))}}for("middle"===a.textBaseline?"undefined"!=typeof p?s+=p/2:d.length&&(s-=(d.length-1)*k/2):"bottom"===a.textBaseline&&("undefined"!=typeof p?s+=p:s-=(d.length-1)*k),"center"===a.textAlign&&o?r+=o/2:"right"===a.textAlign&&o&&(r+=o),e=0;e<d.length;e++)f=g.detectTextDirection(d[e]),a.canvas.dir=f,u&&"rtl"===f?(a.textAlign="left",h=r-a.measureText(d[e]).width/2):(a.textAlign=t,h=r),a.canvas.dir=g.detectTextDirection(d[e]),a.fillText(d[e],h,s),s+=k;a.textAlign=t}function o(a,b,c,d,e,f){var g,h,i,j,k,l,m;for(g=0;g<c.length;g+=1)if(j=c[g]){if(a.save(),i=j.transform,i&&(b.save(),b.multiply(i)),"opacity"in j&&(a.globalAlpha=j.opacity),j.fill)if(j.fill.gradient){if(m=j.fill.gradient,isNaN(m.x0)||isNaN(m.y0)||isNaN(m.x1)||isNaN(m.y1))return;for(l=a.createLinearGradient(m.x0,m.y0,m.x1,m.y1),h=0;h<m.limits.length;h++)l.addColorStop(m.limits[h],m.colors[h]);a.fillStyle=l}else a.fillStyle=j.fill;if(j.stroke&&0!==j.strokeWidth){if(j.stroke.gradient){for(m=j.stroke.gradient,l=a.createLinearGradient(m.x0,m.y0,m.x1,m.y1),h=0;h<m.limits.length;h++)l.addColorStop(m.limits[h],m.colors[h]);a.strokeStyle=l}else a.strokeStyle=j.stroke;a.lineWidth=j.strokeWidth||1,d>1&&"polygon"!==j.type&&(a.lineWidth/=d)}j.lineJoin&&(a.lineJoin=j.lineJoin),j.lineCap&&(a.lineCap=j.lineCap),k=b.elements,"group"===j.type?(b.save(),j.clip&&(a.beginPath(),a.setTransform(k[0][0],k[1][0],k[0][1],k[1][1],k[0][2],k[1][2]),a.rect(j.clip.rect.x,j.clip.rect.y,j.clip.rect.width,j.clip.rect.height),a.clip()),o(a,b,j.children,void 0,!!j.fill||!!e,!!j.stroke&&0!==j.strokeWidth||!!f),b.restore()):j.type in s&&(a.setTransform(k[0][0],k[1][0],k[0][1],k[1][1],k[0][2],k[1][2]),s[j.type](a,j,!!j.fill||!!e,!!j.stroke&&0!==j.strokeWidth||!!f)),a.globalAlpha=1,i&&b.restore(),a.restore()}}function p(a,b,c){if(c){var d=b.elements;switch(c.type){case"clip":a.save(),a.setTransform(d[0][0],d[1][0],d[0][1],d[1][1],d[0][2],d[1][2]),a.beginPath(),a.rect(c.rect.x,c.rect.y,c.rect.width,c.rect.height),a.clip();break;case"slice":}}}function q(a,b){b&&a.restore()}var r,s,t=window.devicePixelRatio||1,u=document.createElement("canvas"),v=u.getContext("2d"),w=document.createElement("span"),x=v.webkitBackingStorePixelRatio||v.mozBackingStorePixelRatio||v.msBackingStorePixelRatio||v.oBackingStorePixelRatio||v.backingStorePixelRatio||1,y=t/x,z={},A=[],B=!g.supportDirAuto();w.innerText="Wj",s={rect:function(a,b,c,d){c&&a.fillRect(b.shape.x||0,b.shape.y||0,b.shape.width||0,b.shape.height||0),d&&a.strokeRect(b.shape.x||0,b.shape.y||0,b.shape.width||0,b.shape.height||0)},roundRect:function(a,b,c,d){a.beginPath(),a.moveTo(b.shape.x+b.shape.radius,b.shape.y),a.lineTo(b.shape.x+b.shape.width-b.shape.radius,b.shape.y),a.quadraticCurveTo(b.shape.x+b.shape.width,b.shape.y,b.shape.x+b.shape.width,b.shape.y+b.shape.radius),
a.lineTo(b.shape.x+b.shape.width,b.shape.y+b.shape.height-b.shape.radius),a.quadraticCurveTo(b.shape.x+b.shape.width,b.shape.y+b.shape.height,b.shape.x+b.shape.width-b.shape.radius,b.shape.y+b.shape.height),a.lineTo(b.shape.x+b.shape.radius,b.shape.y+b.shape.height),a.quadraticCurveTo(b.shape.x,b.shape.y+b.shape.height,b.shape.x,b.shape.y+b.shape.height-b.shape.radius),a.lineTo(b.shape.x,b.shape.y+b.shape.radius),a.quadraticCurveTo(b.shape.x,b.shape.y,b.shape.x+b.shape.radius,b.shape.y),a.closePath(),c&&a.fill(),d&&a.stroke()},circle:function(a,b,c,d){if(b.shape&&b.shape.r&&!b.shape.radius&&(b.shape.radius=b.shape.r),!(isNaN(b.shape.cx)||isNaN(b.shape.cy)||isNaN(b.shape.radius)||b.shape.radius<=0)){var e=.551784;a.save(),a.translate(b.shape.cx,b.shape.cy),a.scale(b.shape.radius,b.shape.radius),a.beginPath(),a.moveTo(1,0),a.bezierCurveTo(1,-e,e,-1,0,-1),a.bezierCurveTo(-e,-1,-1,-e,-1,0),a.bezierCurveTo(-1,e,-e,1,0,1),a.bezierCurveTo(e,1,1,e,1,0),a.closePath(),a.restore(),c&&a.fill(),d&&a.stroke()}},line:function(a,b,c,d){d&&(a.beginPath(),a.moveTo(b.shape.x1,b.shape.y1),a.lineTo(b.shape.x2,b.shape.y2),a.stroke())},polygon:function(a,b,c,d){j(a,b,c,d,!0)},polyline:function(a,b,c,d){j(a,b,c,d)},polygons:function(a,b,c,d){var e,f,g,h,i,j,k=b.shape.polygons,l=k?k.length:0;for(a.beginPath(),i=0;i<l;i++)if(e=k[i],f=e.points,g=f?f.length:0,0!==g&&(h=f[0]))for(a.moveTo(h.x,h.y),j=1;j<g;j+=1)h=f[j],a.lineTo(h.x,h.y);c&&a.fill(),d&&a.stroke()},multipolygon:function(a,b,c,d){var e,f,g,h,i,j,k,l,m=b.shape.geopolygons,n=m?m.length:0;for(a.beginPath(),j=0;j<n;j++)for(e=m[j].getPolygons(),f=e?e.length:0,k=0;k<f;k++)if(g=e[k].points,h=g?g.length:0,0!==h&&(i=g[0]))for(a.moveTo(i.x,i.y),l=1;l<h;l+=1)i=g[l],a.lineTo(i.x,i.y);c&&a.fill(),d&&a.stroke()},arc:function(a,b,c,d){var e=b.shape;a.beginPath(),e.end-e.start===2*Math.PI?(a.arc(e.cx,e.cy,e.radius,e.start+e.radianOffset,e.end+e.radianOffset,!1),a.moveTo(e.cx+e.innerRadius*Math.cos(e.radianOffset+e.start),e.cy+e.innerRadius*Math.sin(e.radianOffset+e.start)),a.arc(e.cx,e.cy,e.innerRadius,e.end+e.radianOffset,e.start+e.radianOffset,!0)):(a.arc(e.cx,e.cy,e.radius,e.start+e.radianOffset,e.end+e.radianOffset,!1),isNaN(e.innerRadius)||e.innerRadius===e.radius||(a.lineTo(e.innerRadius*Math.cos(e.end+e.radianOffset)+e.cx,e.innerRadius*Math.sin(e.end+e.radianOffset)+e.cy),e.innerRadius>0&&a.arc(e.cx,e.cy,e.innerRadius,e.end+e.radianOffset,e.start+e.radianOffset,!0),a.lineTo(e.radius*Math.cos(e.start+e.radianOffset)+e.cx,e.radius*Math.sin(e.start+e.radianOffset)+e.cy))),a.closePath(),c&&a.fill(),d&&a.stroke()},text:function(a,b){b.shape&&b.shape.text&&b.fill&&(b.shape.font&&(a.font=b.shape.font),b.shape.align&&(a.textAlign=b.shape.align),b.shape.baseline&&(a.textBaseline=b.shape.baseline),n(a,b.shape))}},r=a.extend({init:function(a,c){var f=d.extend(!0,{storeObjects:!1},c);this._container=a,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.width=0,this._canvas.height=0,f.name&&this._canvas.setAttribute("name",f.name),this.storeRenderedObjects=f.storeObjects===!0,this.scaling={x:1,y:1},this._container&&this._container.appendChild(this._canvas),this.rect=new b(0,0,0,0),this.shapes=[],this._matrix=new e},setDimensions:function(a,b,c,d){this.rect.set(a,b,c,d)},setDimensionsToContainerRatio:function(a,b){this.scaling={x:a,y:b},this.ratios={x:a,y:b}},show:function(){this._canvas.style.display=""},hide:function(){this._canvas.style.display="none"},clear:function(a){if(a){if(!this._clearTimer){var b=this;this._clearTimer=c.request(function(){b._clearTimer&&(b._canvas.width=0,b._clearTimer=0)})}}else c.cancel(this._clearTimer),this._clearTimer=0,this._canvas.width=0,this._canvas.height=0,d(this._canvas).data("shapes",null),this.shapes=[]},render:function(){c.cancel(this._clearTimer),this._clearTimer=0,t=window.devicePixelRatio||1,x=v.webkitBackingStorePixelRatio||v.mozBackingStorePixelRatio||v.msBackingStorePixelRatio||v.oBackingStorePixelRatio||v.backingStorePixelRatio||1,y=t/x;var a,b,e=this._canvas,g=e.getContext("2d"),h=y,i=this._matrix,j=0,k=0;return b=this.rect.height*this.scaling.y,a=this.rect.width*this.scaling.x,this.edgeBleed&&(j=this.edgeBleed.left*this.scaling.x,k=this.edgeBleed.top*this.scaling.y,b+=this.edgeBleed.top*this.scaling.y+this.edgeBleed.bottom*this.scaling.y,a+=this.edgeBleed.left*this.scaling.x+this.edgeBleed.right*this.scaling.x),b=Math.round(b),a=Math.round(a),this._canvas.style.left=-j+"px",this._canvas.style.top=-k+"px",e.width!==a||e.height!==b?(e.width=h*a,e.height=h*b,this._canvas.style.width=a+"px",this._canvas.style.height=b+"px"):g.clearRect(0,0,e.width,e.height),g.save(),i.save(),i.scale(h*this.scaling.x,h*this.scaling.y),i.translate(j/this.scaling.x,k/this.scaling.y),p(g,i,this.viewBox),o(g,i,this.shapes,this.scaling.x),q(g,this.viewBox),g.restore(),i.restore(),this.storeRenderedObjects&&d(this._canvas).data("shapes",this.shapes),f.resolve()},setFont:function(a){this._canvas.getContext("2d").font=a},getFontHeight:function(a){if("string"!=typeof a)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(a in z)return z[a];var b,c=this._canvas.getContext("2d");return c.font!==a?(c.save(),c.font=a,b=1.5*c.measureText("m").width,c.restore()):b=1.5*c.measureText("m").width,h(a,b),b},getTextWidth:function(a,b){var c,d=this._canvas.getContext("2d");return d.save(),d.font=b,c=void 0!==a?Math.ceil(d.measureText(a).width):0,d.restore(),c},getEMFontWidth:function(a){var b,c="m",d=this._canvas.getContext("2d");return d.save(),d.font=a,b=d.measureText(c).width,d.restore(),b},getAverageLetterWidth:function(a){var b,c="eeeaaaiinnoorsstldumcph";return v.font=a||this._canvas.getContext("2d").font,b=v.measureText(c).width,b/c.length},release:function(){d(this._canvas).data("shapes",null),this.shapes=[],this._container&&(this._container.removeChild(this._canvas),this._container=null)},applyTransform:function(){var a;for(a=0;a<this.shapes.length;a+=1)this.shapes[a].type in C&&C[this.shapes[a].type](this.shapes[a].shape,this.ratios)}});var C={rect:function(a,b){a.x*=b.x,a.y*=b.y,a.width*=b.x,a.height*=b.y},line:function(a,b){a.x1*=b.x,a.y1*=b.y,a.x2*=b.x,a.y2*=b.y},circle:function(a,b){a.cx*=b.x,a.cy*=b.y,a.r*=Math.min(b.x,b.y)},polygon:function(a,b){var c,d;for(c=0;c<a.points.length;c++)d=a.points[c],d.x*=b.x,d.y*=b.y},text:function(a,b){a.x*=b.x,a.y*=b.y,a.width*=b.x,a.height*=b.y}};return r.getTextWidth=function(a){return Math.ceil(v.measureText(a).width)},r.setFont=function(a){v.font=a},r.getAverageLetterWidth=function(a){var b,c="eeeaaaiinnoorsstldumcph";return v.font=a,b=v.measureText(c).width,b/c.length},r.measureText=function(a,b){var c,d,e,f=v;return b&&f.font!==b&&(f.save(),f.font=b),d=f.measureText(a).width,b in z?c=z[b]:(c=1.5*f.measureText("m").width,h(b,c)),b&&f.restore(),e=void 0!==a?{width:d,height:c}:{width:0,height:0}},r.measureTextObject=function(a){return a.shape.font&&(v.font=a.shape.font),a.shape.align&&(v.textAlign=a.shape.align),a.shape.baseline&&(v.textBaseline=a.shape.baseline),n(v,a.shape,!0)},r.measureDisplayTextObject=function(a){return a.font&&(v.font=a.font),a.align&&(v.textAlign=a.align),a.baseline&&(v.textBaseline=a.baseline),n(v,a,!0)},r.getFontHeight=function(a){var b,c=v;return a in z?z[a]:(a&&(c.save(),c.font=a),b=1.5*c.measureText("m").width,h(a,b),a&&c.restore(),b)},r.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(v.webkitBackingStorePixelRatio||v.mozBackingStorePixelRatio||v.msBackingStorePixelRatio||v.oBackingStorePixelRatio||v.backingStorePixelRatio||1)},r}),define("general.utils/css-colors",[],function(){var a={aliceblue:{r:240,g:248,b:255},antiquewhite:{r:250,g:235,b:215},aqua:{r:0,g:255,b:255},aquamarine:{r:127,g:255,b:212},azure:{r:240,g:255,b:255},beige:{r:245,g:245,b:220},bisque:{r:255,g:228,b:196},black:{r:0,g:0,b:0},blanchedalmond:{r:255,g:235,b:205},blue:{r:0,g:0,b:255},blueviolet:{r:138,g:43,b:226},brown:{r:165,g:42,b:42},burlywood:{r:222,g:184,b:135},cadetblue:{r:95,g:158,b:160},chartreuse:{r:127,g:255,b:0},chocolate:{r:210,g:105,b:30},coral:{r:255,g:127,b:80},cornflowerblue:{r:100,g:149,b:237},cornsilk:{r:255,g:248,b:220},crimson:{r:220,g:20,b:60},cyan:{r:0,g:255,b:255},darkblue:{r:0,g:0,b:139},darkcyan:{r:0,g:139,b:139},darkgoldenrod:{r:184,g:134,b:11},darkgray:{r:169,g:169,b:169},darkgreen:{r:0,g:100,b:0},darkgrey:{r:169,g:169,b:169},darkkhaki:{r:189,g:183,b:107},darkmagenta:{r:139,g:0,b:139},darkolivegreen:{r:85,g:107,b:47},darkorange:{r:255,g:140,b:0},darkorchid:{r:153,g:50,b:204},darkred:{r:139,g:0,b:0},darksalmon:{r:233,g:150,b:122},darkseagreen:{r:143,g:188,b:143},darkslateblue:{r:72,g:61,b:139},darkslategray:{r:47,g:79,b:79},darkslategrey:{r:47,g:79,b:79},darkturquoise:{r:0,g:206,b:209},darkviolet:{r:148,g:0,b:211},deeppink:{r:255,g:20,b:147},deepskyblue:{r:0,g:191,b:255},dimgray:{r:105,g:105,b:105},dimgrey:{r:105,g:105,b:105},dodgerblue:{r:30,g:144,b:255},firebrick:{r:178,g:34,b:34},floralwhite:{r:255,g:250,b:240},forestgreen:{r:34,g:139,b:34},fuchsia:{r:255,g:0,b:255},gainsboro:{r:220,g:220,b:220},ghostwhite:{r:248,g:248,b:255},gold:{r:255,g:215,b:0},goldenrod:{r:218,g:165,b:32},gray:{r:128,g:128,b:128},green:{r:0,g:128,b:0},greenyellow:{r:173,g:255,b:47},grey:{r:128,g:128,b:128},honeydew:{r:240,g:255,b:240},hotpink:{r:255,g:105,b:180},indianred:{r:205,g:92,b:92},indigo:{r:75,g:0,b:130},ivory:{r:255,g:255,b:240},khaki:{r:240,g:230,b:140},lavender:{r:230,g:230,b:250},lavenderblush:{r:255,g:240,b:245},lawngreen:{r:124,g:252,b:0},lemonchiffon:{r:255,g:250,b:205},lightblue:{r:173,g:216,b:230},lightcoral:{r:240,g:128,b:128},lightcyan:{r:224,g:255,b:255},lightgoldenrodyellow:{r:250,g:250,b:210},lightgray:{r:211,g:211,b:211},lightgreen:{r:144,g:238,b:144},lightgrey:{r:211,g:211,b:211},lightpink:{r:255,g:182,b:193},lightsalmon:{r:255,g:160,b:122},lightseagreen:{r:32,g:178,b:170},lightskyblue:{r:135,g:206,b:250},lightslategray:{r:119,g:136,b:153},lightslategrey:{r:119,g:136,b:153},lightsteelblue:{r:176,g:196,b:222},lightyellow:{r:255,g:255,b:224},lime:{r:0,g:255,b:0},limegreen:{r:50,g:205,b:50},linen:{r:250,g:240,b:230},magenta:{r:255,g:0,b:255},maroon:{r:128,g:0,b:0},mediumaquamarine:{r:102,g:205,b:170},mediumblue:{r:0,g:0,b:205},mediumorchid:{r:186,g:85,b:211},mediumpurple:{r:147,g:112,b:219},mediumseagreen:{r:60,g:179,b:113},mediumslateblue:{r:123,g:104,b:238},mediumspringgreen:{r:0,g:250,b:154},mediumturquoise:{r:72,g:209,b:204},mediumvioletred:{r:199,g:21,b:133},midnightblue:{r:25,g:25,b:112},mintcream:{r:245,g:255,b:250},mistyrose:{r:255,g:228,b:225},moccasin:{r:255,g:228,b:181},navajowhite:{r:255,g:222,b:173},navy:{r:0,g:0,b:128},oldlace:{r:253,g:245,b:230},olive:{r:128,g:128,b:0},olivedrab:{r:107,g:142,b:35},orange:{r:255,g:165,b:0},orangered:{r:255,g:69,b:0},orchid:{r:218,g:112,b:214},palegoldenrod:{r:238,g:232,b:170},palegreen:{r:152,g:251,b:152},paleturquoise:{r:175,g:238,b:238},palevioletred:{r:219,g:112,b:147},papayawhip:{r:255,g:239,b:213},peachpuff:{r:255,g:218,b:185},peru:{r:205,g:133,b:63},pink:{r:255,g:192,b:203},plum:{r:221,g:160,b:221},powderblue:{r:176,g:224,b:230},purple:{r:128,g:0,b:128},red:{r:255,g:0,b:0},rosybrown:{r:188,g:143,b:143},royalblue:{r:65,g:105,b:225},saddlebrown:{r:139,g:69,b:19},salmon:{r:250,g:128,b:114},sandybrown:{r:244,g:164,b:96},seagreen:{r:46,g:139,b:87},seashell:{r:255,g:245,b:238},sienna:{r:160,g:82,b:45},silver:{r:192,g:192,b:192},skyblue:{r:135,g:206,b:235},slateblue:{r:106,g:90,b:205},slategray:{r:112,g:128,b:144},slategrey:{r:112,g:128,b:144},snow:{r:255,g:250,b:250},springgreen:{r:0,g:255,b:127},steelblue:{r:70,g:130,b:180},tan:{r:210,g:180,b:140},teal:{r:0,g:128,b:128},thistle:{r:216,g:191,b:216},tomato:{r:255,g:99,b:71},turquoise:{r:64,g:224,b:208},violet:{r:238,g:130,b:238},wheat:{r:245,g:222,b:179},white:{r:255,g:255,b:255},whitesmoke:{r:245,g:245,b:245},yellow:{r:255,g:255,b:0},yellowgreen:{r:154,g:205,b:50}};return a}),define("general.utils/color",["core.utils/class","./css-colors"],function(a,b){var c,d=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i,e=/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d+)?)\)$/i,f=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i,g=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i,h=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i,i=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i,j=Math.floor,k=Math.round;return c=a.extend({init:function(){var a,d,e,f,g,h,i,l,m,n,o,p,q=0,r=0,s=0,t=1;if(this._invalid=!1,arguments[0]instanceof c)q=arguments[0]._r,r=arguments[0]._g,s=arguments[0]._b,t=arguments[0]._a,this._invalid=arguments[0]._invalid;else if(arguments.length<3)if("string"==typeof arguments[0])if(p=arguments[0],o=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(p))q=parseInt(o[1],10),r=parseInt(o[2],10),s=parseInt(o[3],10);else if(o=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d+)?)\s*\)$/i.exec(p))q=parseInt(o[1],10),r=parseInt(o[2],10),s=parseInt(o[3],10),t=parseFloat(o[4]);else if(o=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(p))q=parseInt(o[1],16),r=parseInt(o[2],16),s=parseInt(o[3],16),t=1;else if(o=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(p))q=parseInt(o[1]+o[1],16),r=parseInt(o[2]+o[2],16),s=parseInt(o[3]+o[3],16),t=1;else if(o=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i.exec(p)){switch(a=parseFloat(o[1]),d=parseFloat(o[3]),f=parseFloat(o[5]),a%=360,d/=100,f/=100,a=a<0?0:a>360?360:a,d=d<0?0:d>1?1:d,f=f<0?0:f>1?1:f,h=f<=.5?2*f*d:(2-2*f)*d,i=a/60,l=h*(1-Math.abs(i%2-1)),m=[],i=Math.floor(i)){case 0:m=[h,l,0];break;case 1:m=[l,h,0];break;case 2:m=[0,h,l];break;case 3:m=[0,l,h];break;case 4:m=[l,0,h];break;case 5:m=[h,0,l];break;default:m=[0,0,0]}n=f-.5*h,q=m[0]+n,r=m[1]+n,s=m[2]+n,q=k(255*q),r=k(255*r),s=k(255*s),t=1}else if(o=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(p)){switch(a=parseFloat(o[1]),d=parseFloat(o[3]),f=parseFloat(o[5]),t=parseFloat(o[7]),a%=360,d/=100,f/=100,a=a<0?0:a>360?360:a,d=d<0?0:d>1?1:d,f=f<0?0:f>1?1:f,h=f<=.5?2*f*d:(2-2*f)*d,i=a/60,l=h*(1-Math.abs(i%2-1)),m=[],i=Math.floor(i)){case 0:m=[h,l,0];break;case 1:m=[l,h,0];break;case 2:m=[0,h,l];break;case 3:m=[0,l,h];break;case 4:m=[l,0,h];break;case 5:m=[h,0,l];break;default:m=[0,0,0]}n=f-.5*h,q=m[0]+n,r=m[1]+n,s=m[2]+n,q=k(255*q),r=k(255*r),s=k(255*s)}else if(o=/^hsv\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i.exec(p)){switch(a=parseFloat(o[1]),d=parseFloat(o[3]),g=parseFloat(o[5]),a%=360,d/=100,g/=100,a=a<0?0:a>360?360:a,d=d<0?0:d>1?1:d,g=g<0?0:g>1?1:g,h=g*d,i=a/60,l=h*(1-Math.abs(i%2-1)),m=[],i=Math.floor(i)){case 0:m=[h,l,0];break;case 1:m=[l,h,0];break;case 2:m=[0,h,l];break;case 3:m=[0,l,h];break;case 4:m=[l,0,h];break;case 5:m=[h,0,l];break;default:m=[0,0,0]}n=g-h,q=m[0]+n,r=m[1]+n,s=m[2]+n,q=k(255*q),r=k(255*r),s=k(255*s),t=1}else b[p.toLowerCase()]?(e=p.toLowerCase(),q=b[e].r,r=b[e].g,s=b[e].b,t=1):this._invalid=!0;else"number"==typeof arguments[0]&&arguments[0]>=0&&"argb"===arguments[1]?(t=(4278190080&arguments[0])>>>24,t/=255,q=(16711680&arguments[0])>>16,r=(65280&arguments[0])>>8,s=255&arguments[0]):"number"==typeof arguments[0]&&arguments[0]>=0?(q=(16711680&arguments[0])>>16,r=(65280&arguments[0])>>8,s=255&arguments[0]):this._invalid=!0;else arguments.length>=3?(q=arguments[0],r=arguments[1],s=arguments[2],t=arguments.length>=4?arguments[3]:1):this._invalid=!0;isNaN(q+r+s+t)&&(this._invalid=!0),this._r=j(q),this._g=j(r),this._b=j(s),this._a=t,this._spaces={}},isInvalid:function(){return this._invalid},setAlpha:function(a){this._a=a,this._spaces={}},getAlpha:function(){return this._a},toRGB:function(){return this._spaces.rgb||(this._spaces.rgb=c.toRGB(this)),this._spaces.rgb},toRGBA:function(){return this._spaces.rgba||(this._spaces.rgba=c.toRGBA(this)),this._spaces.rgba},toString:function(){return this._spaces.rgb||(this._spaces.rgb=c.toRGB(this)),this._spaces.rgb},toHex:function(){return this._spaces.hex||(this._spaces.hex=c.toHex(this)),this._spaces.hex},toHSL:function(a){return this._spaces.hsl||(this._spaces.hsl=c.toHSL(this,a)),this._spaces.hsl},toHSLA:function(a){return this._spaces.hsla||(this._spaces.hsla=c.toHSLA(this,a)),this._spaces.hsla},toHSV:function(){var a=this.toHSVComponents();return"hsv("+a.h+","+a.s+","+a.v+")"},toHSVComponents:function(){return this._spaces.hsvComp||(this._spaces.hsvComp=c.toHSVComponents(this)),this._spaces.hsvComp},toNumber:function(){return this._spaces.num||(this._spaces.num=c.toNumber(this)),this._spaces.num},isDark:function(){return this.isInvalid()||this.getLuminance()<125},getLuminance:function(){return"undefined"==typeof this._lumi&&(this._lumi=.299*this._r+.587*this._g+.114*this._b),this._lumi},shiftLuminance:function(a){var b,c,d,e,f,g=this.toHSLA();return f=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(g),b=parseFloat(f[1]),c=parseFloat(f[3]),d=parseFloat(f[5]),e=parseFloat(f[7]),d+=a,d=Math.max(0,Math.min(d,100)),"hsla("+b+","+c+","+d+","+e+")"},isEqual:function(a){return a instanceof c?this._r===a._r&&this._g===a._g&&this._b===a._b:(a=new c(a),this._r===a._r&&this._g===a._g&&this._b===a._b)},blend:function(a,b){var c=j(this._r+(a._r-this._r)*b),d=j(this._g+(a._g-this._g)*b),e=j(this._b+(a._b-this._b)*b),f=j(this._a+(a._a-this._a)*b);return"rgba("+[c,d,e,f].join(",")+")"},createShiftedColor:function(a){(void 0===a||isNaN(a))&&(a=1);var b=this.getLuminance(),d=this._g<126?1:1+this._g/512,e=this.shiftLuminance(20*(b*d<220?.8+4*(1/(b+1)):-(.8+1*(b/255)))*a);return new c(e)}}),c.toRGB=function(a){if(a instanceof c)return"rgb("+[a._r,a._g,a._b].join(",")+")";"string"==typeof a&&(a=c.toNumber(a));var b=(16711680&a)>>16,d=(65280&a)>>8,e=255&a;return"rgb("+b+","+d+","+e+")"},c.toRGBA=function(a,b){if(a instanceof c)return"rgba("+[a._r,a._g,a._b,"undefined"!=typeof b?b:a._a].join(",")+")";"string"==typeof a&&(a=c.toNumber(a));var d=(16711680&a)>>16,e=(65280&a)>>8,f=255&a;return"rgba("+d+","+e+","+f+","+("undefined"!=typeof b?b:a._a)+")"},c.toHex=function(a){var b,d,e;return a instanceof c?(b=a._r.toString(16),d=a._g.toString(16),e=a._b.toString(16),1===b.length&&(b="0"+b),1===d.length&&(d="0"+d),1===e.length&&(e="0"+e),"#"+[b,d,e].join("")):("string"==typeof a&&(a=c.toNumber(a)),b=((16711680&a)>>16).toString(16),d=((65280&a)>>8).toString(16),e=(255&a).toString(16),1===b.length&&(b="0"+b),1===d.length&&(d="0"+d),1===e.length&&(e="0"+e),"#"+b+d+e)},c.toHSL=function(a,b){var d,e,f,g,h,i,j,k,l=0;if("string"==typeof a&&(a=new c(a)),d=a._r/255,e=a._g/255,f=a._b/255,i=Math.max(d,e,f),j=Math.min(d,e,f),h=b?.21*d+.72*e+.07*f:(i+j)/2,i===j)l=g=0;else{switch(k=i-j,g=h>.5?k/(2-i-j):k/(i+j),i){case d:l=(e-f)/k+(e<f?6:0);break;case e:l=(f-d)/k+2;break;case f:l=(d-e)/k+4}l/=6}return"hsl("+360*l+","+100*g+","+100*h+")"},c.toHSLA=function(a,b){var d,e,f,g,h,i,j,k,l,m=0;if("string"==typeof a&&(a=new c(a)),d=a._r/255,e=a._g/255,f=a._b/255,g=a._a,j=Math.max(d,e,f),k=Math.min(d,e,f),i=b?.21*d+.72*e+.07*f:(j+k)/2,j===k)m=h=0;else{switch(l=j-k,h=i>.5?l/(2-j-k):l/(j+k),j){case d:m=(e-f)/l+(e<f?6:0);break;case e:m=(f-d)/l+2;break;case f:m=(d-e)/l+4}m/=6}return"hsla("+360*m+","+100*h+","+100*i+","+g+")"},c.toHSVComponents=function(a){var b,d,e,f,g,h,i,j,k=0;if("string"==typeof a&&(a=new c(a)),b=a._r/255,d=a._g/255,e=a._b/255,h=Math.max(b,d,e),i=Math.min(b,d,e),g=h,h===i)k=f=0;else{switch(j=h-i,f=0===j?0:j/g,h){case b:k=(d-e)/j+(d<e?6:0);break;case d:k=(e-b)/j+2;break;case e:k=(b-d)/j+4}k/=6}return{h:360*k%360,s:100*f,v:100*g}},c.toNumber=function(){if(1===arguments.length&&arguments[0]instanceof c)return(arguments[0]._r<<16)+(arguments[0]._g<<8)+arguments[0]._b;var a,b,d=0,e=0,f=0;return 1===arguments.length&&"string"==typeof arguments[0]&&(b=arguments[0],(a=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i.exec(b))?(d=parseInt(a[1],10),e=parseInt(a[2],10),f=parseInt(a[3],10)):(a=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(b))?(d=parseInt(a[1],16),e=parseInt(a[2],16),f=parseInt(a[3],16)):(a=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(b))&&(d=parseInt(a[1]+a[1],16),e=parseInt(a[2]+a[2],16),f=parseInt(a[3]+a[3],16))),(d<<16)+(e<<8)+f},c.blend=function(a,b,d){a=c.toNumber(a),b=c.toNumber(b);var e=(16711680&a)>>16,f=(65280&a)>>8,g=255&a,h=(16711680&b)>>16,i=(65280&b)>>8,j=255&b,k=e+(h-e)*d,l=f+(i-f)*d,m=g+(j-g)*d;return(k<<16)+(l<<8)+m},c.getBlend=function(a,b,d){var e=a._r+(b._r-a._r)*d,f=a._g+(b._g-a._g)*d,g=a._b+(b._b-a._b)*d,h=a._a+(b._a-a._a)*d;return new c(e,f,g,h)},c.isCSSColor=function(a){return!(arguments.length>1||"string"!=typeof a)&&(d.test(a)||e.test(a)||f.test(a)||g.test(a)||h.test(a)||i.test(a)||b[a.toLowerCase()])},c.getBestContrast=function(a,b,c){var d=a.getLuminance();return Math.abs(d-b.getLuminance())>Math.abs(d-c.getLuminance())?b:c},c.getContrast=function(a,b){if(a&&b){var c=a.getLuminance()/100,d=b.getLuminance()/100;return c>d?(c+.05)/(d+.05):(d+.05)/(c+.05)}},c.isDark=function(){var a={getLuminance:c.prototype.getLuminance};return c.prototype.init.apply(a,[].slice.call(arguments)),c.prototype.isDark.call(a)},c.useDarkLabel=function(a,b){return a._a>.5?!a.isDark():!b},c}),define("extensions.qliktech/barchart/layers/label-layer",["core.utils/class","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","general.utils/color","objects.views/charts/utils/tree-iterator"],function(a,b,c,d){"use strict";function e(a,b){return a?d.useDarkLabel(b,t)?q.label.dark.color:q.label.light.color:t?q.label.light.color:q.label.dark.color}function f(a,b,c,d,e,f,g){return{type:"text",fill:q.label.dark.color,opacity:d||1,data:{value:b,rect:c,labelRect:f,hintDirection:g,color:e},shape:{text:a,maxNumLines:1,align:"center",baseline:"middle"}}}function g(a){var b,c,d,e;if(b=a.descendants.filter(function(a){return!a.isBranch&&a.data.isVisible!==!1}),c=b.map(function(a){return a.data.hitRect}),c.length)return d=c[0],c.length>1&&(d=d.combineWith(c.slice(-1)[0])),e=f(a.data.valueLabel,a.data.sum,d,b[b.length-1].opacity,b[b.length-1].data.color,null,null),e.data.isFillPattern=window.CanvasPattern&&b[b.length-1].fill instanceof window.CanvasPattern,e.data.lastRect=c[c.length-1],e}function h(a,b){var c,d;a.forEach(function(a){c=a.children,a.data.isStack?(d=g(a),d&&(d.data.isStack=!0,b.push(d))):c&&c.length?h(c,b):a.data.isVisible!==!1&&b.push(f(a.data.valueLabel,a.data.value,a.data.hitRect,a.opacity,a.data.color,a.data.labelRect,a.data.hintDirection))})}function i(a,b){Object.keys(b).forEach(function(c){a[c]=b[c]})}function j(){var a,c,d,e,f=[],g=this.minorAxis.getPlotMin(),i=this.minorAxis.getPlotMax(),j=q.label.font,m=this.bounds;h(this._shapes,f),b.setFont(j),this.renderer.setFont(j),f=f.filter(function(a){return"NaN"===a.data.value||(!(!a.data.labelRect&&!a.data.showHintLabel)||(a.data.value>=0&&i>=a.data.value&&g<=a.data.value||(a.data.value<0&&g<=a.data.value&&i>=a.data.value||!!(a.data.rect.width&&a.data.rect.height&&m.intersectsWith(a.data.rect)))))});var o,p,s;for(this._shapes&&this._shapes.length?(p=this._shapes[0].descendants.filter(function(a){return!a.isBranch})[0],s=p?p.data.hitRect.width:this.majorAxis._discreteSpacing):s=0,o=0,a=f?f.length:0,d=0;d<a;d++)c=f[d],c.shape&&(c.shape.font=j,c.data.labelWidth=b.getTextWidth(c.shape.text),o=Math.max(o,c.data.labelWidth));this._longestLabel=o,e=this._longestLabel<s;var u;for(u=this.minorAxis.isVertical()?e?k:l:n,d=0;d<a;d++)u.call(this,f[d],s);f.slice().forEach(function(a){a.fill&&a.backdrop&&(f.unshift({opacity:a.opacity||1,type:"roundRect",fill:r,shape:a.backdrop}),a.fill=t?q.label.light.color:q.label.dark.color)}),this.renderer.shapes=f,this.renderer.render()}function k(a,b){for(var c,d=this.renderer.getFontHeight(q.label.font),f=m.apply(this,[a,!1,b]),g=0;g<f.length;g++)if(i(a.shape,f[g].rect),d<f[g].rect.height){c=f[g];break}if(c){var h=c.rect.width-a.data.labelWidth;i(a.shape,c.rect),a.shape.baseline=c.baseline,a.shape.align=c.align,a.data.isStack&&c.inline&&(a.data.lastRect.height<20||a.data.isFillPattern)?a.backdrop={x:c.rect.x+Math.min(h/2,4),y:"top"===c.baseline?c.rect.y:c.rect.y+c.rect.height-16,width:Math.max(c.rect.width-Math.min(h,8)),height:16,radius:4}:(a.fill=e(c.inline,a.data.color),a.backdrop=!1)}else a.fill=!1}function l(a,d){var f,g,h,j=m.apply(this,[a,!0,d]);f="labelWidth"in a.data?a.data.labelWidth:b.getTextWidth(a.shape.text);for(g=0;g<j.length;g++)if(j[g].rect.height>=f){h=j[g];break}if(h||(j.sort(function(a,b){return.8*b.rect.height-a.rect.height}),j[0].rect.height>=8&&(h=j[0])),h){var k=new c;k.translate(h.rect.x,h.rect.y+h.rect.height),k.rotate(-Math.PI/2),i(a.shape,{width:h.rect.height,height:h.rect.width,baseline:h.baseline,align:h.align,x:0,y:0}),a.transform=k.elements,a.data.isStack&&h.inline&&(a.data.lastRect.height<f+4||a.data.isFillPattern)?a.backdrop={radius:4,x:h.rect.x+h.rect.width/2-8,y:"right"===h.align?h.rect.y-4:h.rect.y+h.rect.height-f-4,width:16,height:f+8}:(a.fill=e(h.inline,a.data.color),a.backdrop=!1)}else a.fill=!1}function m(a,b,c){var d,e,f,g,h=b&&a.data.isStack?8:4,i=[];return d=a.data.rect.width,e=a.data.rect.height,f=a.data.rect.x,g=a.data.rect.y,"up"!==a.data.hintDirection&&a.data.value>=0||"down"===a.data.hintDirection?(g-this.bounds.y-2*h>4&&i.push({align:b?"left":"center",baseline:b?"middle":"bottom",rect:{x:f-.5*(c-d),y:this.bounds.y+h,width:c,height:g-this.bounds.y-2*h}}),a.data.labelRect&&(d=a.data.labelRect.width,e=a.data.labelRect.height,f=a.data.labelRect.x,g=a.data.labelRect.y),a.data.hintDirection||i.push({align:b?"right":"center",baseline:b?"middle":"top",inline:!0,rect:{x:f,y:g+h,width:d,height:e-2*h}})):(this.bounds.height-g-e-2*h>0&&i.push({align:b?"right":"center",baseline:b?"middle":"top",rect:{x:f-.5*(c-d),y:g+e+h,width:c,height:this.bounds.height-g-e-2*h}}),a.data.labelRect&&(d=a.data.labelRect.width,e=a.data.labelRect.height,f=a.data.labelRect.x,g=a.data.labelRect.y),a.data.hintDirection||i.push({align:b?"left":"center",baseline:b?"middle":"bottom",inline:!0,rect:{x:f,y:g+h,width:d,height:e-2*h}})),i}function n(a,c){var d,f,g,h;g=o.apply(this,[a,c]),d="labelWidth"in a.data?a.data.labelWidth:b.getTextWidth(a.shape.text);for(f=0;f<g.length;f++)if(g[f].rect.width>=d){h=g[f];break}!h&&g.length&&(g.sort(function(a,b){return.8*b.rect.width-a.rect.width}),g[0].rect.width>=8&&(h=g[0])),h?(a.shape.baseline="middle",a.shape.align=h.align,i(a.shape,h.rect),a.data.isStack&&h.inline&&(a.data.lastRect.width<d+8||a.data.isFillPattern)?a.backdrop={y:h.rect.y+h.rect.height/2-8,height:16,x:("right"===h.align?h.rect.x+h.rect.width-d:h.rect.x)-4,width:d+8,radius:4}:(a.fill=e(h.inline,a.data.color),a.backdrop=!1)):a.fill=!1}function o(a){var b,c,d,e,f=a.data.isStack?8:4,g=[];return b=a.data.rect.width,c=a.data.rect.height,d=a.data.rect.x,e=a.data.rect.y,"right"!==a.data.hintDirection&&(this.yMirrorMode?a.data.value<0:a.data.value>=0)||"left"===a.data.hintDirection?(this.bounds.width-d-b-2*f>0&&g.push({align:"left",rect:{x:d+b+f,y:e,width:this.bounds.width-d-b-2*f,height:c}}),a.data.labelRect&&(b=a.data.labelRect.width,c=a.data.labelRect.height,d=a.data.labelRect.x,e=a.data.labelRect.y),a.data.hintDirection||g.push({align:"right",inline:!0,rect:{x:d+f,y:e,width:b-2*f,height:c}})):(d-this.bounds.x-2*f&&g.push({align:"right",rect:{x:this.bounds.x+f,y:e,width:d-this.bounds.x-2*f,height:c}}),a.data.labelRect&&(b=a.data.labelRect.width,c=a.data.labelRect.height,d=a.data.labelRect.x,e=a.data.labelRect.y),a.data.hintDirection||g.push({align:"left",inline:!0,rect:{x:d+f,y:e,width:b-2*f,height:c}})),g}var p,q,r,s,t;return p=a.extend("LabelLayer",{init:function(a){this.renderer=new b(a)},setYMirrorMode:function(a){this.yMirrorMode=a},setData:function(a){this._data=a},setMeasureIndices:function(){},setBarData:function(a){this._barData=a},setShapes:function(a){this._shapes=a},show:function(){this.renderer.show()},hide:function(){this.renderer.hide()},clear:function(){this.renderer.clear()},release:function(){this.renderer.release()},render:function(){q=this.style.dataPoints,s=new d(this.style.backgroundColor),t=s.isDark(),r=d.toRGBA(s,.75),j.call(this)}})}),define("objects.views/charts/chart-style-service",["core.utils/class","client.utils/theme/theme","general.utils/responsive-state"],function(a,b,c){"use strict";function d(a,b){if("string"==typeof a&&"@"===a[0]){var c=a.substring(1);return b[c]?d(b[c],b):a}return a}function e(a,b,c,d,e){var g,h=b.split("."),i=a,j=e;for(void 0!==i[c]&&(j=i[c]),g=0;g<h.length;++g){if(void 0===i[h[g]])return j;i=i[h[g]],void 0!==i[c]&&(j=i[c])}return void 0!==i[c]&&(j=i[c]),["string","number","boolean","array"].contains(typeof j)?j:j?void 0!==j.default||void 0!==d?f(j,d,e):e:null}function f(a,b){var c,d,e=a,f=a.default;if(!b)return f;for(c=b.split("."),d=0;d<c.length;++d){if(void 0===e[c[d]])return f;e=e[c[d]],f=e}return f}function g(a){a=a||{};var b=a;return b}function h(a,b){return a=a.substring(0,a.length-2),a*=b,a+"px"}function i(a,b){return b?a+"."+b:a}var j,k;return j=a.extend("ChartStyleService",{init:function(){this._baseStyle=b,this._chartStyles=b,this._fontCache={},this._variables=g(b._variables);var a=this;b.ThemeChanged.bind(function(){a._variables=g(b._variables)})},getValue:function(a,b,c,f,g){return a=a||"",""===a||this._chartStyles[a]?(""!==a&&(a+="."),b&&(a+=b),d(e(this._chartStyles,a,c,f,g),this._variables)):g},getFont:function(a,b,c,d,f,g){if(a=a||"",g=g||1,""===a||this._chartStyles[a]){""!==a&&(a+="."),b&&(a+=b);var j=i(a,c);if(this._fontCache[j]&&1===g&&isNaN(f))return this._fontCache[j];var k=e(this._chartStyles,a,"lineHeight",c),l=e(this._chartStyles,a,"fontFamily",c),m=[e(this._chartStyles,a,"fontStyle",c)||"",e(this._chartStyles,a,"fontVariant",c)||"",e(this._chartStyles,a,"fontWeight",c)||"",e(this._chartStyles,a,"fontStretch",c)||"",f||0===f?f+"px":h(e(this._chartStyles,a,"fontSize",c)||"12px",g),k?"/"+k:"",l?"'"+l+"'":"'Qlikview Sans'"];return m=m.filter(function(a){return""!==a}),1===g?(this._fontCache[j]=m.join(" "),this._fontCache[j]):m.join(" ")}return d}}),k=new j,k.layoutMap={1:"spark",3:"xsmall",7:"small",15:"medium",31:"full",m:"mobile"},k.getLayoutKey=function(a){return c.isSmallDevice?this.layoutMap.m:this.layoutMap[a]},{getInstance:function(){return k}}}),define("extensions.qliktech/barchart/style",[],function(){return{dataPoint:{label:{dark:{color:"#666"},light:{color:"#eee"},font:"11px 'QlikView Sans'"}},shape:{selected:{border:{color:"#333",width:2}},unselected:{opacity:.5},highlighted:{border:{dark:{color:"rgba( 26, 26, 26, 0.75 )"},light:{color:"rgba( 230, 230, 230, 0.75)"},width:1}}}}}),define("extensions.qliktech/barchart/bararea",["objects.views/charts/components/chart-component","./layers/bar-layer","./layers/label-layer","general.utils/color","general.utils/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","objects.views/charts/chart-style-service","core.utils/deferred","./style"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){var b=1;return q.width=5*b,q.height=5*b,r.save(),r.fillStyle=d.toRGBA(a,.8),r.scale(b,b),r.fillRect(0,0,1,1),r.fillRect(0,1,1,1),r.fillRect(1,0,1,1),r.fillRect(4,1,1,1),r.fillRect(4,2,1,1),r.fillRect(3,2,1,1),r.fillRect(3,3,1,1),r.fillRect(2,3,1,1),r.fillRect(2,4,1,1),r.fillRect(1,4,1,1),r.restore(),r.createPattern(q,"repeat")}function l(a,b){var c=a.layoutMap[b]||"medium",d={shape:{selected:{border:{color:a.getValue(n,"shape.border","color","selected"),width:a.getValue(n,"shape.border","width","selected")}}},dataPoints:{label:{font:a.getFont(n,"value",c),dark:{color:a.getValue(n,"value","color","dark")},light:{color:a.getValue(n,"value","color","light")}}},backgroundColor:a.getValue(n,null,"backgroundColor")};return d}var m,n="barChart",o="stacked",p="grouped",q=document.createElement("canvas"),r=q.getContext("2d");return m=a.extend("BarArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._barData=[],this._showDataPoints=!0,this._colorMap=null,this._groupingMode=p,this._globalAlpha=1,
this._styleService=i.getInstance(),this._barLayer=new b(this.container),this._barLayer.isMini=this.isMini,this.layers=[this._barLayer],this.isMini||(this._labelLayer=new c(this.container),this.layers.push(this._labelLayer))},setYMirrorMode:function(a){this._super(a),this._labelLayer&&this._labelLayer.setYMirrorMode(a)},beforeBarsAddedToRenderer:function(){},barsAddedToRenderer:function(){},labelAddedToRenderer:function(){},afterPaint:function(){return j.resolve()},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setShowDataPoints:function(a){this._showDataPoints=a,this.invalidateDisplay("BarArea.setShowDataPoints")},getShowDataPoints:function(){return this._showDataPoints},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(a){this._measureIndices=a},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay("BarArea.setMajorAxis")},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this._localFormatting&&(this._areLabelsFormatted=!1),this.invalidateDisplay("BarArea.setMinorAxis")},this)},setDimensionTree:function(a){this._tree=a},setGroupingMode:function(a){this._groupingMode=a},_updateSize:function(){this.invalidateDisplay("BarArea._updateSize")},insertAdjacentTo:function(a,b){if(this._super(a,b),this._minorAxis&&this._minorAxis.isHorizontal())switch(this._minorAxis.dock){case"bottom":this.rect.height-=1}},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},setCacheItems:function(a){this._cacheItems=a},getCacheItems:function(){return this._cacheItems},createAxisData:function(a,b,c,d){d||(this._cacheIndex=0,this._outerCacheIndex=0);var e,f=b.stackLevel===d+1,g=a.children,h=b.numLevels-b.numMeasures;return"measure"===b.types[d]&&this._measureIndices&&(g=g.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),g.map(function(a){var g;if("dimension"===b.types[d]){if(g={label:a.data.qText,group:"dimension"===b.types[d+1]||"measure"===b.types[d+1]&&b.numMeasures>1,id:a.data.id,cacheIndex:[]},"measure"===b.types[d+1])for(e=0;e<b.numMeasures;e++)g.cacheIndex.push(this._cacheIndex++);else h>1&&0===d&&a.children.forEach(function(a){a.children[0].isBranch&&(a.data.qElemNo!==-2&&g.cacheIndex.push(this._outerCacheIndex),this._outerCacheIndex++)},this);!f&&("dimension"===b.types[d+1]||"measure"===b.types[d+1]&&b.numMeasures>1)&&(g.children=this.createAxisData(a,b,c,d+1))}else"measure"===b.types[d]&&(g={label:a.data.qText,id:a.data.id});return g},this)},_createMeasureDisplayNode:function(a,b){if(a.isBranch){var c=this.isMini===!0||this._isStacked?new h:new g,d=a.children,f=d[0].data,i=a.parent.cacheItem,j=new e(0,0,0,0),k=this.measureFormatters[b],l="undefined"!=typeof f.qValue?f.qValue:f.qNum,m=a.ancestors.filter(function(a){return"qElemNo"in a.data}).map(function(a){return a.data.qElemNo}).reverse();return c.data={qText:a.data.qText,measureIndex:b,value:l,start:0,end:l,valueLabel:a.children[0].data.qText,formatted:!k||"U"!==k.type,hitRect:j,cacheItem:i,color:this._colorMap.getColor(m,l,b,a.data.rowIndex)},i.addShape("dataArea",j,!0),i.calculateTooltipPosition=!0,c.data.fill=c.data.color.toRGBA(),c.fill=c.data.fill,c.data.isFillColorDark=c.data.color.isDark(),c}},_createDimensionDisplayNode:function(a){var b=new f;return b.data={qText:a.data.qText,qElemNo:a.data.qElemNo,qMaxPos:a.data.qMaxPos,qMinNeg:a.data.qMinNeg,qType:a.data.qType},b},_createStackNode:function(){var a=new f;return a.data={stack:!0},a},_createOtherNode:function(a,b){var c=new h,d=new e(0,0,0,0),f=this.measureFormatters[0];return c.data={measureIndex:0,value:b-a,start:a,end:b,isFakeOtherCell:!0,highlightOnGroupSelect:0===this._selectionIndices[0],valueLabel:"valueLabel",formatted:!f||"U"!==f.type,hitRect:d,cacheItem:{},color:this._colorMap.getColor([-3],b-a,0,0)},c.data.fill=c.data.color.toRGBA(),c.fill=c.data.fill,c.data.isFillColorDark=c.data.color.isDark(),c},_addOtherNode:function(a,b,c){var d=this._createDimensionDisplayNode({data:{qMaxPos:0,qMinNeg:0,qElemNo:-3,qType:"O"}}),e=this._createOtherNode(a.data.sum,b);return e.data.axisId=c.data.id,e.data.cacheItem=c.cacheItem,d.addChild(e),a.data.sum=b,a.addChild(d),e},_stackNodes:function(a,b,c,d){var e,f,g,h,i,j=this._createStackNode(),k=this._createStackNode(),l=!1,m=!1,n=0,o=0;j.data.isStack=!0,k.data.isStack=!0,a.forEach(function(a){e=b,g=a.children&&a.children[0]?a.children[0].data:a.data,g.value>=0?(e=j,g.start=n,n+=g.value,g.end=n,f=n,h=!0,e.addChild(a),"O"===a.data.qType&&(l=!0)):isNaN(g.value)||(e=k,g.start=o,o+=g.value,g.end=o,f=o,i=!0,e.addChild(a),"O"===a.data.qType&&(m=!0)),e.data.sum=f}),"undefined"==typeof b.data.qMaxPos||l||n===b.data.qMaxPos||(d.push(this._addOtherNode(j,b.data.qMaxPos,c)),n=j.data.sum,h=n>0),"undefined"==typeof b.data.qMinNeg||m||o===b.data.qMinNeg||(d.push(this._addOtherNode(k,b.data.qMinNeg,c)),o=k.data.sum,i=o<0),h&&(j.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(j.data.sum):j.data.sum+"",b.addChild(j)),i&&(k.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(k.data.sum):k.data.sum+"",b.addChild(k)),b.data.sum={positive:n,negative:o}},getRenderTree:function(a,b,c,d){var e,f,g,h,i,j,k,l=b.stackLevel===d+1,m=[];for(g=a.children,"measure"===b.types[d]&&this._measureIndices&&(g=g.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),i=g.length,h=0;h<i;h++)if(k=g[h],"dimension"===b.types[d])j=this._createDimensionDisplayNode(k),f=this.getRenderTree(k,b,c,d+1),l?(this._stackNodes(f,j,k,c.otherShapes),c.globalPositiveSum=Math.max(c.globalPositiveSum,j.data.sum.positive),c.globalNegativeSum=Math.min(c.globalNegativeSum,j.data.sum.negative)):j.addChildren(f),j.isBranch&&m.push(j);else if("measure"===b.types[d]){if(j=this._createMeasureDisplayNode(k,this._measureIndices?this._measureIndices[h]:h),!j)continue;e=k,b.numMeasures<=1&&(e=e.parent),b.stackLevel===d&&(e=e.parent),j.data.axisId=e.data.id,c.shapes.push(j),m.push(j)}return m},_applyIds:function(a,b,c,d){var e;a.children.forEach(function(f,g){e=a.data.id?a.data.id+";"||"":"","dimension"===c[d]?(f.data.id=e+b[d]+":"+f.data.qElemNo,this._applyIds(f,b,c,d+1)):"measure"===c[d]&&(f.data.id=e+b[d+g])}.bind(this))},_updateProperties:function(){if(this._data&&this._tree){this._barLayer.renderer.stage.removeChildren();var a=this._data.qHyperCube.qDimensionInfo.length,b=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,c=this._groupingMode===o&&(a>1||b>1),d=a+1,e=-2,f=[],g=new Array(a).join(",").split(",").map(function(){return"dimension"}),h=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(a){return a.cId}),i=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.qApprMaxGlyphCount});if(g.push("measure"),i.push(this._data.qHyperCube.qMeasureInfo.reduce(function(a,b){return Math.max(a,b.qApprMaxGlyphCount)},0)),c)e=b>1?a:a-1;else if(a>1){var j=this._data.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+this._data.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected,k=this._data.qHyperCube.qSize.qcy/j;f.push(k),f.push(b)}else f.push(b),f.push(1);this._isStacked=c;var l={columns:[],shapes:[],shapesToLabel:[],otherShapes:[],globalPositiveSum:0,globalNegativeSum:0},m={colIds:h,types:g,numLevels:d,numMeasures:b,stackLevel:e};a>1&&this._allowInnerSelection&&!this._data.qHyperCube.qDimensionInfo[1].qLocked?(this.setSelectionIndices([1]),this._majorAxis.setSelectionIndices([1]),this._majorAxis.setCurrentDataIndices([1])):(this.setSelectionIndices([0]),this._majorAxis.setSelectionIndices([0]),this._majorAxis.setCurrentDataIndices([0])),this._applyIds(this._tree,h,g,0);var n=this.getRenderTree(this._tree,m,l,0);this._objects=n,this._formatted=this._isStacked||this.measureFormatters.every(function(a,b){var c=!this._measureIndices||this._measureIndices.indexOf(b)>=0;return!c||"U"!==a.type},this),this._shapes=l.shapes;var p=l.shapes.map(function(a){return a.data.cacheItem});this._shapes=this._shapes.concat(l.otherShapes),n.forEach(function(a){this._barLayer.renderer.stage.addChild(a)}.bind(this));var q=this.createAxisData(this._tree,m,l,0),r=g.map(function(a,b){return{qApprMaxGlyphCount:i[b],show:b<g.length-1,groupSize:f[b]}});this._majorAxisData={data:q,info:r},this._numDimensions=a,this._numMeasures=b,this._minorAxisData=c?{min:l.globalNegativeSum,max:l.globalPositiveSum}:null,this.setSelectableShapes(p)}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree&&(this._data.qHyperCube.qStackedDataPages.length>0||this._data.qHyperCube.qDataPages.length>0)},updateSize:function(){this._super(),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y),a.renderer.setDimensions(0,0,this.rect.width,this.rect.height)},this)},paint:function(){this._super(this._layoutMode,this._data),this._majorAxis.updateNow(),this._minorAxis.updateNow();var a=this._minorAxis.getPadding(),b=new e,c=this;return this._style=l(this._styleService,this._layoutMode),b.set(a.left,a.top,this.rect.width-a.left-a.right,this.rect.height-a.top-a.bottom),this.layers.forEach(function(a){a.minorAxis=this._minorAxis,a.majorAxis=this._majorAxis,a.shapes=this._shapes,a.othersFillPattern=k(this._colorMap.getColor([-3])),a.groupingMode=this._groupingMode,a.widthRatio=this._numDimensions<=1&&this._numMeasures<=1||this._groupingMode===o?.7:.95,a.isSpikingEnabled=!(this.isMini||this._groupingMode===o&&(this._numDimensions>1||this._numMeasures>1)),a.isHintingEnabled=!this.isMini&&(this._groupingMode===p||this._groupingMode===o&&this._numDimensions+this._numMeasures<=2),a.style=this._style,a._globalAlpha=this._globalAlpha},this),this._barLayer.colorMap=this._colorMap,this._barLayer.update(),this.nodesInView=this._barLayer.nodesInView,this.barsAddedToRenderer(),this._labelLayer&&(this._labelLayer.setShapes(this._objects),this._labelLayer.bounds=b,this._labelLayer._longestLabel=20,this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPoints?(this._formatLabels(),this._labelLayer.show(),this._labelLayer.render()):this._labelLayer.hide()),this._barLayer.render().then(function(){return c.afterPaint()})},_formatLabels:function(){if(!this._isStacked&&!this._formatted){var a,b,c=this.nodesInView?this.nodesInView.length:0;for(a=0;a<c;a++)b=this.nodesInView[a].data,b.formatted||(b.formatted=!0,b.valueLabel=this.measureFormatters[b.measureIndex]?this.measureFormatters[b.measureIndex].formatValue(b.value):b.valueLabel)}},clear:function(){this._super(),this.layers.forEach(function(a){a.clear()})},release:function(){this.layers.forEach(function(a){a.release()}),this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this)}})}),define("extensions.qliktech/barchart/barchart-properties",["translator","client.utils/default-property-logic"],function(a,b){function c(a,b){return b?b.getMeasureLayouts():a.qHyperCubeDef.qMeasures.map(function(a){return a.qDef})}function d(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}var e,f,g,h=b.getLogicFor("hard","barchart");e={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(a){var b=a.qHyperCubeDef.qMeasures.length,c=a.qHyperCubeDef.qDimensions.length;return b+c>2},change:function(a,b){b.getDimensions().length>1&&"stacked"===a.barGrouping.grouping?(a.qHyperCubeDef.qMode="K",a.qHyperCubeDef.qAlwaysFullyExpanded=!0):a.qHyperCubeDef.qMode="S"}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},scrollStartPos:{ref:"scrollStartPos",type:"number",translation:"properties.ScrollAlignment",component:"dropdown",defaultValue:0,options:[{value:0,translation:"properties.ScrollAlignStart"},{value:1,translation:"properties.ScrollAlignEnd"}]},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a){return a.gridLine&&!a.gridLine.auto}}}},showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-dataPoints"}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-dropdown",translation:"properties.colorDimensionId",show:h.helpers.showDimensionIdOption}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var e,f="y",g=d(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return"vertical"===b.orientation&&(f="x"),e=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:function(b){return a.get("properties."+this.getXYAxis(b)+"Axis")},getXYAxis:function(a){return a&&"horizontal"===a?"y":"x"},group:!1,tid:function(a){return"property-"+this.getXYAxis(a)+"Axis"}}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a){return"vertical"===a.orientation&&a.dimensionAxis&&["all","labels"].contains(a.dimensionAxis.show)}},dock:{ref:"dimensionAxis.dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:function(a){var b,c;return"vertical"===a.orientation?(b="Common.Bottom",c="Common.Top"):(b="properties.dock.left",c="properties.dock.right"),[{value:"near",translation:b},{value:"far",translation:c}]},show:function(a){return a.dimensionAxis&&"none"!==a.dimensionAxis.show}}}},measureAxis:{uses:"measureAxis",label:function(b,d){var e,f="x",g=c(b,d).map(function(a){return a.qFallbackTitle}).join(", ");return"vertical"===b.orientation&&(f="y"),e=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{axis:{type:"items",items:{show:{snapshot:{title:function(b){return a.get("properties."+this.getXYAxis(b)+"Axis")},getXYAxis:function(a){return a&&"horizontal"===a?"x":"y"},group:!1,tid:function(a){return"property-"+this.getXYAxis(a)+"Axis"}}}}}}}}},f={uses:"sorting",items:{dimensions:{locked:function(a,b,c){return 1===c.getMeasures().length&&2===c.getDimensions().length&&0===a}}}},g={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"},refLines:{uses:"reflines"}}};var i={uses:"data",items:{dimensions:{}}};return{type:"items",component:"accordion",items:{data:i,sorting:f,addons:g,settings:e}}}),define("general.models/library/dimension",["core.models/base-object","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("Dimension",{clone:function(){return this._super("CloneDimension")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qDimensionListDef:{qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}}}),c.get=function(a,c){function d(){return c.enigmaModel.getDimension(a)}return c=c||b.current,this.getModel(a,c.session,d)},c.create=function(b,d){return a.create.call(c,b,"CreateDimension",d)},c.remove=function(b,c){return a.remove(b,"DestroyDimension",c)},c}),define("extensions.qliktech/barchart/barchart-data",["core.utils/deferred","client.utils/property-resolver","objects.utils/data-properties/library-utils","general.models/library/dimension"],function(a,b,c,d){function e(b){function e(a){a>10?1!==b.getSorting()[0]&&b.changeSorting(1,0):0!==b.getSorting()[0]&&b.changeSorting(1,0)}var f,g=b.getDimensions(),h=b.getMeasures();if(1===g.length&&1===h.length){var i=g[0];return i.qLibraryId?d.getLayout(i.qLibraryId).then(function(a){if(a&&a.qDimInfos&&a.qDimInfos[0]){var b=a.qDimInfos[0].qCardinal;e(b)}return i}):b.app.getFieldList().then(function(a){var b=c.findField(i.qDef.qFieldDefs[0],a);if(b){var d=b.qCardinal;e(d)}return i})}return g.length>1&&1===h.length&&(f=b.getSorting().indexOf(0),0!==f&&b.changeSorting(f,0)),a.resolve()}function f(a){var b;a.getDimensions().length>1&&1===a.getMeasures().length&&(b=a.getSorting().indexOf(0),0!==b&&a.changeSorting(b,0))}function g(a,c){var d=c.getDimensions(),e=c.getMeasures(),f=b.getValue(a,"color.mode");d.length>1&&a.color&&(a.color.persistent=!0),"byMeasure"===f&&e.length>1?b.setValue(a,"color.mode","byDimension"):"byExpression"===f&&0===e.length&&b.setValue(a,"color.mode","primary")}function h(a){return a>=2?1:15}var i={measures:{min:1,max:h,add:function(a,b,c){return e(c).then(function(){return a.qSortBy.qSortByNumeric=-1,g(b,c),a})},move:function(a,b,c){f(c),g(b,c)},remove:function(a,b,c){var d=c.getDimensions();g(b,c),d.length>1&&"stacked"===b.barGrouping.grouping?(b.qHyperCubeDef.qMode="K",b.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===d.length&&(b.qHyperCubeDef.qMode="S")}},dimensions:{min:1,max:function(a){return a>=2?1:2},add:function(a,b,c){return c.getDimensions().length>1&&"stacked"===b.barGrouping.grouping&&(b.qHyperCubeDef.qMode="K",b.qHyperCubeDef.qAlwaysFullyExpanded=!0),e(c).then(function(){return g(b,c),a})},move:function(a,b,c){c.getDimensions().length>1&&"stacked"===b.barGrouping.grouping&&(b.qHyperCubeDef.qMode="K",b.qHyperCubeDef.qAlwaysFullyExpanded=!0),f(c),g(b,c)},remove:function(a,b,c){var d=c.getDimensions();g(b,c),1===d.length&&(b.qHyperCubeDef.qMode="S")}}};return i}),define("extensions.qliktech/barchart/barchart-explore-properties",["client.utils/property-hypercube-helper"],function(a){return{type:"items",component:"accordion",items:{data:{uses:"data"},sort:{uses:"sort",items:{dimensions:{locked:function(b,c){return 1===a.getNumMeasures(c)&&2===a.getNumDimensions(c)&&0===b}}}},presentation:{uses:"presentation",items:{showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(a){var b=a.qHyperCubeDef.qMeasures.length,c=a.qHyperCubeDef.qDimensions.length;return b+c>2},change:function(a){var b=a.qHyperCubeDef.qDimensions.length;b>1&&"stacked"===a.barGrouping.grouping?(a.qHyperCubeDef.qMode="K",a.qHyperCubeDef.qAlwaysFullyExpanded=!0):a.qHyperCubeDef.qMode="S"}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]}}},color:{uses:"color",items:{dimension:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-radio-list",translation:"properties.colorDimensionId",show:function(b){return a.getNumDimensions(b)>1},change:function(a){a.color.mode="byDimension",a.color.auto=!1}}}}}}}}}),define("objects.views/charts/layout-engine",["general.utils/shapes/rect"],function(a){function b(){this._layoutComponents=[],this._componentSizes=[]}function c(a){var b=this._componentSizes.filter(function(b){return b.component===a})[0];b||(b={component:a},this._componentSizes.push(b)),b.rect=a.rect.clone()}function d(a){return this._componentSizes.filter(function(b){return b.component===a})[0]}function e(a,b,c,d,e){var f,g=this._layoutComponents.slice(),h=[{fn:"_reduceComponentRectBySpacingV",dock:["left","right"]},{fn:"_reduceComponentRectBySpacingH",dock:["top","bottom"]}];for("vertical"===d&&h.reverse(),g.sort(function(a,b){return(a.reductionOrder||1e3)-(b.reductionOrder||1e3)}),f=0;f<g.length;f++)g[f].perpendicularlyRelevantSpacing={top:0,left:0,right:0,bottom:0},g[f].preRelevantSizeCalculation&&g[f].preRelevantSizeCalculation();var i=a.clone();h.forEach(function(a){this._reducePreliminaryLayoutRectForComponents(g,i,b,c,function(b){return b&&a.dock.indexOf(b.dock)>=0}),this[a.fn](i,b,g,c)},this),e&&e()&&(i=a.clone(),h.forEach(function(a){this._reducePreliminaryLayoutRectForComponents(g,i,b,c,function(b){return b&&a.dock.indexOf(b.dock)>=0}),this[a.fn](i,b,g,c)},this)),h.forEach(function(d){this._reduceLayoutRectForComponents(g,a,b,i,c,function(a){return a&&d.dock.indexOf(a.dock)>=0}),this[d.fn](a,b,g,c)},this)}return b.prototype={addComponent:function(a){var b;b=this._layoutComponents,this.removeComponent(a),b.push(a)},removeComponent:function(a){var b,c;for(c=this._layoutComponents,b=0;b<c.length;++b)if(c[b]===a)return void c.splice(b,1)},_reduceLayoutRectForComponents:function(a,b,c,d,e,f){var g;for(g=0;g<a.length;++g)a[g]&&["left","right","bottom","top"].contains(a[g].dock)&&f(a[g])&&(a[g].calculateRelevantSize(b,c,d),a[g].isVisible(e)&&(a[g].relevantSize=Math.round(a[g].relevantSize),a[g].reduceLayoutRect(b)))},_reducePreliminaryLayoutRectForComponents:function(a,b,c,d,e){var f;for(f=0;f<a.length;++f)a[f]&&["left","right","bottom","top"].contains(a[f].dock)&&e(a[f])&&(a[f].calculatePreliminaryRelevantSize?a[f].calculatePreliminaryRelevantSize(b,c):a[f].calculateRelevantSize(b,c),a[f].isVisible(d)&&a[f].reduceLayoutRect(b))},_reduceComponentRectBySpacingH:function(a,b,c,d){var e,f;for(e=0;e<c.length;++e)f=c[e].perpendicularlyRelevantSpacing,f&&c[e].isVisible(d)&&(f.left>a.x&&a.x>=0&&(a.width-=f.left-a.x,a.x=f.left),f.right>b.width-a.x-a.width&&(a.width-=f.right-(b.width-a.x-a.width-b.x)))},_reduceComponentRectBySpacingV:function(a,b,c,d){var e,f;for(e=0;e<c.length;++e)f=c[e].perpendicularlyRelevantSpacing,f&&c[e].isVisible(d)&&(f.top>a.y&&a.y>=0&&(a.height-=f.top-a.y,a.y=f.top),f.bottom>b.height-a.y-a.height&&(a.height-=f.bottom-(b.height-a.y-a.height-b.y)))},_layoutComponent:function(a,b,c,d){a&&a.insertAdjacentTo(a.dock&&"center"!==a.dock?a.isVertical()?c.x:c.y:d,a.isVisible(b))},layout:function(b,f,g,h,i){var j=2;b=new a(b.x,b.y,b.width,b.height),g=new a(g.x,g.y,g.width,g.height);var k,l,m,n,o,p=g.width/b.width,q=g.height/b.height;for(l=this._layoutComponents,l.sort(function(a,b){return"center"===a.dock?"center"===b.dock?0:-1:"center"===b.dock?1:a.layoutOrder-b.layoutOrder}),b=new a(b.x,b.y,b.width-2*j,b.height-2*j),m=new a(b.x,b.y,b.width,b.height),n={x:new a,y:new a},e.apply(this,[m,b,f,h,i]),m.x+=j,m.y+=j,n.x.set(m.x,m.y,m.width,m.height),n.y.set(m.x,m.y,m.width,m.height),k=0;k<l.length;++k)l[k].setLayoutToContainerRatios(p,q),this._layoutComponent(l[k],f,n,m),o=d.call(this,l[k]),l[k].updateSize(!o||o.rect.width!==l[k].rect.width||o.rect.height!==l[k].rect.height),c.call(this,l[k])}},b}),define("objects.views/charts/components/data-area",["./chart-component"],function(a){var b;return b=a.extend({paint:function(a){this._super(a)}})}),define("objects.views/charts/components/axis/radial-axis-helper",["objects.views/charts/utils/matrix","general.utils/shapes/rect"],function(a){function b(b,e,j){var k,l,m,n,o,p,q,r,s=b.length>0?b[0].positions:[],t=e._style,u=e._radialOptions,v=new a,w=t.ticks.major.length*j,x=t.label.offset*j*20,y=1,z="far"===e.getAlignment()?"left":"right",A=[],B=Math.min(e.rect.height,e.rect.width),C=0,D=[],E=e._radius;if(m="left"===z?1:-1,w=m*w,k=m>0?0:e.rect.width,l=0,k+=m*y/2,l+=e._padding.top,e.getShowLine()&&A.push({stroke:t.line.color,shape:{cx:e._centerPoint.x,cy:e._centerPoint.y,radius:E,radianOffset:0,start:u.start,end:u.end},type:"arc"}),e.getShowLabels())for(r=0;r<s.length;r++)n=(s[r]-C)/(B-C),p=g(n,e),q=h(p),q.r=q.r+x,q=i(q,e._centerPoint),o=f(n,e),q.angle=o,D.push(q),v.save(),v.translate(p.x+e._centerPoint.x,p.y+e._centerPoint.y),v.rotate(o),A.push({stroke:t.ticks.major.color,opacity:e.ticks[r].opacity,transform:v.elements,shape:{x1:0,x2:-w,y1:0,y2:0},type:"line"}),v.restore();if(k+=t.ticks.major.length*m,e._showLabels&&e._layoutMode>1)for(r=0;r<b.length;r++)A=A.concat(c(b[r],D,k,e)),k+=b[r].labelSpace*m;e._showTitle&&e._layoutMode>1&&(A=A.concat(d(e,t))),e._renderer.shapes=A,e._renderer.render()}function c(a,b,c,d){var e,f,g,h,i,j,k,l,m,n=a.labels,o=b,p=a.opacities,q=[],r=d._style;if(h=n?n.length:0,0!==h){for(i=h-1,l=0;l<h;l++)j=d.yMirrorMode?n[i-l]:n[l],e=d._renderer.getTextWidth(j,r.label.font),k=o[l],g=k.angle,f=g-.1<3*Math.PI/2&&g+.1>3*Math.PI/2?"center":g<Math.PI/2||g>3*Math.PI/2?"left":"right",q.push({type:"text",fill:r.label.color,opacity:p?p[l]:1,shape:{text:j,x:k.x,y:k.y,maxWidth:k.x-e<0?k.x:k.x+e>d.rect.width?d.rect.width-k.x:e,height:m,maxNumLines:1,font:r.label.font,align:f,baseline:"middle"}});return q}}function d(a,b){var c=[],d=Math.min(a.rect.width,a.rect.height),f=e(a);return c.push({type:"text",fill:b.label.color,opacity:1,shape:{text:a._title,x:f.x,y:f.y+d*(.06+.04*(Math.min(d-300,0)/-300)),maxWidth:1.4*a._radius,maxNumLines:1,font:b.label.font,align:"center",baseline:"middle"}}),c}function e(a){var b={x:a.rect.width/2,y:a.rect.height/2};return b}function f(a,b){var c=b._radialOptions,d=Math.max(Math.min(a,1),0)*(c.end-c.start)+c.start;return d}function g(a,b,c){var d=b._radialOptions,e=a*(d.end-d.start)+d.start,f=b._radius;return i({a:e,r:f},c)}function h(a){return{r:Math.sqrt(a.x*a.x+a.y*a.y),a:Math.atan2(a.y,a.x)}}function i(a,b){return b||(b={x:0,y:0}),{x:b.x+a.r*Math.cos(a.a),y:b.y+a.r*Math.sin(a.a)}}return{renderRadial:b,getPointOfValue:g,getPolPos:h,getCartPos:i,getAngleOfNormalizedValue:f}}),define("objects.views/charts/components/axis/axis",["jquery","../chart-component","objects.views/charts/components/axis/radial-axis-helper","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","general.utils/shapes/rect","general.utils/shapes/polygon","objects.views/charts/chart-style-service"],function(a,b,c,d,e,f,g,h){"use strict";function i(){var a,b=this;return a=this.getLevels()||[],a.length||this._showTitle_internal?(this._cacheItems&&this._cacheItems.length&&(this._cacheItems[0].objectShapes?this._cacheItems.forEach(function(a){a.objectShapes[b.selectionIdentifier]=null}):this._cacheItems.forEach(function(a){a.clearShapes(b.selectionIdentifier)})),void(this.isRadial()?c.renderRadial(a,this,this._windowSizeMultiplier):this.isVertical()?n.apply(this,[a]):q.apply(this,[a,this.indicators]))):void this._renderer.clear()}function j(a,b,c,d){var f,h,i,j,k,l,m,n,o,p,q=a.labels,t=a.positions,u=Math.abs(this._fontHeight*Math.sin(c)),v=a.labelSpace,w=Math.abs(v/Math.sin(c)),x=Math.cos(c),y=this.yMirrorMode?-Math.PI/2:Math.PI/2,z=(new e).skew(y-c,0).scale(this._discreteSpacing*(this._groupSize||1)/this._fontHeight,1).translate(0,-d*this._fontHeight/2).rotate(-y),A=[],B=c<0?"right":"left";for(p="middle","near"===this.getAlignment()&&"center"!==B&&(B="left"===B?"right":"left"),o=0;o<q.length;o++)f=t[o],f<0||f>this.rect.width||(m=new e,m.translate(t[o],b+d*u/2),m.rotate(c),l="right"===B?Math.min((f+this._edgeBleed.left)/x,w):Math.min((this.rect.width-f+this._edgeBleed.right)/x,w),l-=2*u,A.push({type:"text",fill:this._style.label.color,opacity:a.opacities[o],transform:m.elements,shape:{text:q[o]||"",font:this._style.label.font,maxWidth:l,align:B,baseline:p}}),r(this._cacheItems,this.isDiscrete(),a.indecies,o)&&(h="left"===B?0:-Math.abs(v),i=this._fontHeight/2,j=[{x:h,y:-i},{x:h+v,y:-i},{x:h+v,y:i},{x:h,y:i}],n=new e,n.translate(t[o]-a.offsets[o],b+d*u/2),n.multiply(z),k=new g(n.transformPoints(j)),s(this._cacheItems,a.indecies[o],this.selectionIdentifier,k)));return A}function k(a,b){return a<b/2?a+=b/2-a:b/2>this._plotSize-a+this._padding.left&&(a-=b/2-(this._plotSize-a+this._padding.left)),a}function l(a,b,c){var e,g,h,i,j,l,m,n,o=20,p="near"===this.getAlignment()?"bottom":"top",q=a.align||"center",t=a.labels,u=a.positions,w=a.opacities,x=a.labelMode,y=this._style,z=a.widths,A=[];for(e=0;e<t.length;e++){if(n=z[e],a.labelsBetweenTicks){if(this.yMirrorMode&&(u[e+1]>this.rect.width||u[e]<0))continue;if(!this.yMirrorMode&&(u[e+1]<0||u[e]>this.rect.width))continue;if(l=Math.min(this.rect.width,Math.max(0,u[e])),m=Math.min(this.rect.width,Math.max(0,u[e+1]||(this.yMirrorMode?Number.MIN_VALUE:Number.MAX_VALUE))),g=l+("left"===q?this._labelPadding:-this._labelPadding),n=Math.min(n,Math.abs(l-m)-this._labelPadding),n<this._labelPadding+o)continue}else if(g=u[e],g<-.5||g>this.rect.width+.5)continue;!this.isDiscrete()||x!==v||0!==e&&e!==t.length-1||(h=d.measureTextObject({type:"text",shape:{text:t[e]||"",x:g,y:b,maxWidth:z[e]-this._labelPadding,font:this._style.label.font,align:q,baseline:p}}).width,0===e&&g<h/2?g+=h/2-g:e===t.length-1&&h/2>this._plotSize-g&&(g-=h/2-(this._plotSize-g))),j=b+(x===v?0:1.5*this._fontHeight*(e%2)*c),r(this._cacheItems,this.isDiscrete(),a.indecies,e)&&(i=new f(u[e]-a.offsets[e]-a.fullWidths[e]/2,j-("bottom"===p?this._fontHeight*y.label.lineHeight:0),a.fullWidths[e],this._fontHeight*y.label.lineHeight),s(this._cacheItems,a.indecies[e],this.selectionIdentifier,i)),A.push({type:"text",fill:this._style.label.color,opacity:w?w[e]:1,_index:e,shape:{text:t[e]||"",x:g,y:j,maxWidth:n-this._labelPadding,font:this._style.label.font,align:q,baseline:p}})}if(!this.isDiscrete()&&A.length>0&&!a.labelsBetweenTicks){var B=A[0];h=d.measureTextObject(B).width,B.shape.x=k.apply(this,[B.shape.x,h]),B=A[A.length-1],h=d.measureTextObject(B).width,B.shape.x=k.apply(this,[B.shape.x,h])}return A}function m(a,b,c){var d,e,g,h,i,j=a.labels,k=a.positions,l=a.opacities,m=a.labelSpace,n=[],o=this._style;for(d=this._renderer.getFontHeight(o.label.font),h=k.length>1?Math.abs(k[0]-k[1]):this.rect.height,this.isDiscrete()||(h=0),g=0;g<j.length;g++)e=k[g],e=Math.max(d/2,Math.min(this._padding.top+this._plotSize-d/2,e)),e-.5<0||e+.5>this.rect.height||(r(this._cacheItems,this.isDiscrete(),a.indecies,g)&&(i=new f(b-("right"===c?m:0),k[g]-a.fullWidths[g]/2-a.offsets[g],m,a.fullWidths[g]),s(this._cacheItems,a.indecies[g],this.selectionIdentifier,i)),n.push({type:"text",fill:o.label.color,opacity:l?l[g]:1,shape:{text:j[g],x:b,y:e-h/2,maxWidth:m,height:h,maxNumLines:1,font:o.label.font,align:c,baseline:"middle"}}));return n}function n(a){var b,c,d,f,g=a[0]?a[0].positions:[],h=a[0]?a[0].opacities:[],i=this._style,j=this.isDiscrete()?0:i.ticks.major.length,k=1,l=new e,n="far"===this.getAlignment()?"left":"right",o=[];
if(d="left"===n?1:-1,j=d*j,b=d>0?0:this.rect.width,c=0,b+=d*k/2,c+=this._padding.top,!this.isDiscrete()&&this._showLabels_internal){if(this._showLabels_internal)for(f=0;f<g.length;f++)g[f]>=0&&g[f]<=this.rect.height&&o.push({stroke:i.ticks.major.color,opacity:h[f],shape:{x1:b,x2:b+j,y1:g[f],y2:g[f]},type:"line"});this._showLine_internal&&o.push({stroke:i.line.color,shape:{x1:b,x2:b,y1:c-1,y2:c+this._plotSize},type:"line"}),b+=i.ticks.major.length*d}if(this._showLabels_internal){for(b+=i.label.margin*d,a.reverse(),f=0;f<a.length;f++)a[f].labelMode!==u&&(o=o.concat(m.apply(this,[a[f],b,n])),b+=a[f].labelSpace*d);a.reverse()}this._showTitle_internal&&(l=new e,l.translate((d>0?b:0)+(d>0?this.rect.width-b:b)/2,this._padding.top+this._plotSize/2),l.rotate(.5*Math.PI*("right"===n?-1:1)),o.push({type:"text",fill:i.title.color,transform:l.elements,shape:{text:this._title||"",maxWidth:this._plotSize,font:i.title.font,align:"center",baseline:"middle"}})),this._renderer.shapes=o,this._renderer.render()}function o(a,b,c,d,e){if(b)for(var f=0;f<b.positions.length;f++)b.positions[f]>=0&&b.positions[f]<=this.rect.width&&a.push({stroke:e,opacity:b.opacities[f],shape:{x1:b.positions[f],x2:b.positions[f],y1:c,y2:c+d},type:"line"})}function p(a,b){var c=this._padding.left||0;a.push({stroke:this._style.line.color,shape:{x1:c-1,x2:c+this._plotSize,y1:b,y2:b},type:"line"})}function q(a,b){var c,d,e,f,g,h=!!a[0]&&a[0].labelsBetweenTicks,i=this._style.ticks.major.length,k=1,m="far"===this.getAlignment()?1:-1,n=[];if(i*=m,c=this._padding.left||0,d="near"===this.getAlignment()?this.rect.height-1:0,d+=k/2*m,!this.isDiscrete()&&this._showLabels_internal&&(p.call(this,n,d),d+=k*m/2,h||(o.call(this,n,a[0],d,i,this._style.ticks.major.color),d+=i)),this._showLabels_internal)for(o.call(this,n,b,d,3,this._style.ticks.major.color),d+=this._style.label.margin*m,e=0;e<a.length;e++)a[e].labelMode!==u&&(h&&(i=a[0].labelSpace*m*(e+(a[e].outOfSyncWithLevelBelow?0:1)),f=d-this._style.label.margin*m-(a[e].outOfSyncWithLevelBelow?0:a[0].labelSpace*m*e),g=a.length>1&&e<a.length-1?this._style.ticks.minor.color:this._style.ticks.major.color,o.call(this,n,a[e],f,i,g)),n=a[e].labelMode===w?n.concat(j.apply(this,[a[e],d,a[e].radians,m])):n.concat(l.apply(this,[a[e],d,m])),a[e].labelSpace&&(d+=a[e].labelSpace*m));this._showTitle_internal&&n.push({type:"text",fill:this._style.title.color,shape:{x:c,y:m>0?d:0,width:this._plotSize,height:m>0?this.rect.height-d:d,text:this._title||"",font:this._style.title.font,align:"center",baseline:"middle"}}),this._renderer.shapes=n,this._renderer.render()}function r(a,b,c,d){return b&&a&&c&&a[c[d][0]]}function s(a,b,c,d){Array.isArray(b)?b.forEach(function(b){a[b].addShape(c,d)}):a[b].addShape(c,d)}var t,u=0,v=1,w=3;return t=b.extend("Axis",{init:function(b,c,e){this._super.apply(this,[b,a.extend(!0,{},{components:{title:{show:!0,showFlag:c.showFlag},labels:{show:!1,showFlag:c.showFlag}}},c),e]),this._fontHeight=20,this._titleShowFlag=c.titleShowFlag||null,this._showLabels=!0,this._showLabels_internal=!0,this._showLine=!0,this._showLine_internal=!0,this._showTitle=!1,this._dataIndex=0,this._radial=!1,this._relevantAngle=0,this._labelPadding=4,this._cacheItems=null,this._styleService=h.getInstance(),this._style=this._getStyleObject(this._styleService),this._padding={top:0,bottom:0,left:0,right:0},this._renderer=new d(this.container),this._$renderAreaWrap&&this._$renderAreaWrap.addClass("qv-chart-component-axis"),this.innerRect=new f(0,0,0,0),this.renderers={axis:this._renderer}},getLevels:function(){return[]},setSelectableShapes:function(a){this._cacheItems=a},calculateValuePositionMappingInfo:function(){},_calculatePlotSize:function(a){var b,c,d=0;this.isRadial()?(b=Math.min(a.height,a.width),c=.4*b,this._relevantAngle=Math.abs(this._radialOptions.end-this._radialOptions.start),d=Math.tan(-this._relevantAngle/4+Math.PI/2)*b*.02,this._radius=c+d,this._centerPoint={x:a.width/2,y:a.height/2+4*d}):b=this.isVertical()?a.height-this._padding.top-this._padding.bottom:a.width-this._padding.left-this._padding.right,0===this._plotSize&&0!==b?this._plotSize=b:this._plotSize=b},_calculateEdgeBleedAndPlotSize:function(a){this._edgeBleed={top:this.isVertical()?1:0,bottom:this.isVertical()?1:0,left:this.isVertical()?1:Math.max(a.x,1),right:this.isVertical()?0:Math.max(0,this.outerRect.width-a.width-a.x)},this._calculatePlotSize(a)},preRelevantSizeCalculation:function(){this._isSizing=!0,this.updateNow(["properties"]),this._isVertical=this.isVertical(),this._style=this._getStyleObject(this._styleService,this._layoutMode,this.isDiscrete()),this._fontHeight=Math.ceil(this._renderer.getFontHeight(this._style.label.font));var a=this._isVertical;this._showTitle_internal=b.prototype.isVisible.call({show:this._showTitle&&!!this._title,_verticalLayoutMode:this._verticalLayoutMode,_horizontalLayoutMode:this._horizontalLayoutMode,isVertical:function(){return a},showFlag:null!==this._titleShowFlag?this._titleShowFlag:this.showFlag<<1},this._layoutMode),this._showTitle_internal&&(this._titleFontHeight=this._renderer.getFontHeight(this._style.title.font),this.relevantSize+=this._titleFontHeight*this._style.title.lineHeight)},calculatePreliminaryRelevantSize:function(a,b){var c,d=0,e=0,f=a[this.isVertical()?"height":"width"];this._isSizing=!0,this.relevantSize=0,this.preliminaryRelevantSize=0,this._preliminaryStatics=0,f<=0||(c=this.calculatePreliminaryLabelSpace(a,b),d=c.relevantLabelSize||0,e=c.relevantSpacing||0,this.isDiscrete()||(this._preliminaryStatics+=this._style.ticks.major.length),d&&(this.preliminaryRelevantSize+=d,this.preliminaryRelevantSize+=this._style.label.margin),this._showTitle_internal&&(this._preliminaryStatics+=this._titleFontHeight*this._style.title.lineHeight),this.preliminaryRelevantSize+=this._preliminaryStatics,this.preliminaryRelevantSize=Math.ceil(this.preliminaryRelevantSize),this.perpendicularlyRelevantSpacing={top:0,left:this.yMirrorMode&&"near"===this.getAlignment()||!this.yMirrorMode&&"far"===this.getAlignment()?e:0,right:this.yMirrorMode&&"far"===this.getAlignment()||!this.yMirrorMode&&"near"===this.getAlignment()?e:0,bottom:0},this.relevantSize=this.preliminaryRelevantSize)},calculateRelevantSize:function(a,b,c){this._isSizing=!0,this._isVertical=this.isVertical(),this.relevantSize=0;var d=c?c:a,e=0,f=0;if(this.rect.set(d.x,d.y,d.width,d.height),this._calculationSize=d[this.isVertical()?"height":"width"],this.isVertical()?this._calculationSize-=this._padding.top+this._padding.bottom:this._calculationSize-=this._padding.left+this._padding.right,this._plotSize=this._calculationSize,0!==d.width){var g=this.calculateLabelSpace(a,b,c);return e=g.relevantLabelSize||0,f=g.relevantSpacing||0,e&&(this.relevantSize+=e,this.relevantSize+=this._style.label.margin),this.relevantSize+=this._preliminaryStatics,this.relevantSize=Math.ceil(this.relevantSize),this.perpendicularlyRelevantSpacing={top:0,left:this.yMirrorMode&&"near"===this.getAlignment()||!this.yMirrorMode&&"far"===this.getAlignment()?f:0,right:this.yMirrorMode&&"far"===this.getAlignment()||!this.yMirrorMode&&"near"===this.getAlignment()?f:0,bottom:0},this._isSizing=!1,this}},insertAdjacentTo:function(a,b){if(this._super(a,b),!this.isDiscrete())switch(this.dock){case"top":this.rect.y+=1;break;case"bottom":this.rect.y-=1}},_getStyleObject:function(a,b,c){var d="",e=a.layoutMap[b]||"medium",f=c?".discrete":"";return{backgroundColor:a.getValue(d,null,"backgroundColor"),label:{lineHeight:1.4,color:a.getValue(d,"axis.label","color"),margin:a.getValue(d,"axis.label","margin"),offset:1,font:a.getFont(d,"axis.label"+f,e)},ticks:{major:{color:a.getValue(d,"axis.tick.major","color"),length:a.getValue(d,"axis.tick.major","length")},minor:{color:a.getValue(d,"axis.tick.minor","color"),length:a.getValue(d,"axis.tick.minor","length")}},line:{color:a.getValue(d,"axis.line","color")},title:{lineHeight:1.4,font:a.getFont(d,"axis.title",e),color:a.getValue(d,"axis.title","color")}}},isVisible:function(){return this._super.apply(this,[].slice.call(arguments))&&this._showSubcomponents},setShowLabels:function(a){this._showLabels_internal=a,this._showLabels=a},getShowLabels:function(){return this._showLabels},getSpacingMode:function(){},setShowLine:function(a){this._showLine_internal=a,this._showLine=a},getShowLine:function(){return this._showLine},setShowStrategy:function(a){this._showSubcomponents="none"!==a,this._showTitle=["all","title"].contains(a),this._showTitle_internal=this._showTitle,this.components.title.show=this._showSubcomponents&&["all","title"].contains(a),this._showLabels=["all","labels"].contains(a),this._showLabels_internal=this._showLabels,this.components.labels.show=this._showSubcomponents&&["all","labels"].contains(a)},getShowStrategy:function(){return this._showSubcomponents},setTitle:function(a){this._title=a},setLabelMode:function(a){this._explicitLabelMode=a},setCurrentDataIndices:function(a){this._currentDataIndices=Array.isArray(a)?a:[a]},setDataIndices:function(a){this._dataIndices=Array.isArray(a)?a:[a]},setDataRange:function(){},setOffset:function(){},setInnerOffset:function(){},getInnerOffset:function(){},getNumDiscreteUnits:function(){},setNumDiscreteUnits:function(){},getNumDiscreteUnitsInView:function(){},setMaxDiscreteUnitSize:function(){},setMinDiscreteUnitSize:function(){},setUnitAlignment:function(){},_updateProperties:function(){var a=this.getType().indices;return this._formatter=1===a.length&&this.measureFormatters.length?this.measureFormatters[a[0]]:this.combinedMeasuresFormatter||this._defaultFormatter,this.container.setAttribute("data-type",this.isDiscrete()?"discrete":"continuous"),this},updateSize:function(){this._super(),this._calculateEdgeBleedAndPlotSize(this.rect),this._renderer.edgeBleed=this._edgeBleed,this.innerRect=new f(this.rect.x+this._padding.left,this.rect.y+this._padding.top,this.rect.width-this._padding.left-this._padding.right,this.rect.height-this._padding.top-this._padding.bottom),this._isVertical=this.isVertical()},paint:function(){return i.apply(this,[]),this.fire("rendered"),this},isDiscrete:function(){return!1},getPositionOfValue:function(){},getAngleOfValue:function(){},getValueOfPosition:function(){},getType:function(){return{type:this.isDimension||this.isDiscrete()?"dimension":"measure",indices:this._dataIndices||[0],current:this._currentDataIndices||[0]}},setPadding:function(a,b,c,d){this._padding={top:a>0?a:0,right:b>0?b:0,bottom:c>0?c:0,left:d>0?d:0}},getPadding:function(){return this._padding},isVertical:function(){var a=this.options.dock;switch(a){case"left":case"right":return!0;case"center":return"vertical"===this._orientation;default:return!1}},setOrientation:function(a){this._orientation=a},setAlignment:function(a){this._align=a},getAlignment:function(){var a=this.options.dock;switch(a){case"left":case"top":return"near";case"center":return this._align;default:return"far"}},setRadial:function(a,b){this._radial=a,this._radialOptions=b},isRadial:function(){return this._radial}})}),define("objects.views/charts/components/axis/discrete-axis",["./axis","general.utils/shapes/rect"],function(a,b){"use strict";function c(a){var b=this._cacheItems;return b&&a&&a.some(function(a){return b[a]&&b[a].selected})?1:this._globalAlpha}function d(a,b,d){var e,f,g=this.isHorizontal(),h=[],i=[],j=[],k=[],l=[],m=[],n=[];for(e=0;e<a.length;e+=1)if(f={center:this.getPositionOfValue(e,b),width:this.getWidthOfValue(e,b)},!(f.width>=2*this._discreteSpacing&&(f.center-this._discreteSpacing+f.width/2<0||f.center+this._discreteSpacing-f.width/2>d)||f.width<2*this._discreteSpacing&&(f.center<0||f.center>d))){if(k.push(f.width),g&&f.center+f.width/2>d?h.push(Math.min(d,d-(f.center-f.width/2))):g&&f.center-f.width/2<0?h.push(Math.min(d,f.width/2+f.center)):h.push(Math.min(d,f.width)),f.width>this._discreteSpacing){var o=Math.max(1,Math.min(f.center,d-1));i.push(o),j.push(o-f.center)}else i.push(f.center),j.push(0);l.push(a[e].label),m.push(a[e].cacheIndex?a[e].cacheIndex:0),n.push(c.apply(this,[a[e].cacheIndex]))}return{labels:l,widths:h,positions:i,indecies:m,opacities:n,offsets:j,fullWidths:k}}function e(a){var b=a.match(/[\u4E00-\u9FFF]/g);return b=b?b.length:0,{latin:a.length-b,cjk:b}}function f(a,b,c,d,g,h){if(!a||!a.length)return[];var i,j,k,l,m,n,o=[];for(i=0;i<a.length;i++)j=a[i],k={},l="",m=null,"object"==typeof j?(l=j.label,m=j.children?f(j.children,b,c+1,k,g,h):null,k.cacheIndex="cacheIndex"in a[i]?a[i].cacheIndex:[],k.group=j.group===!0,j.id&&(h[j.id]=k)):l=j,k.label=l||"",k.parent=d,n=e(k.label),m&&m.length&&(k.children=m),o.push(k),b[c]||(b[c]={data:[]},b[c].show=!(g&&g[c]&&g[c].show===!1||b[c].silo),b[c].qApprMaxGlyphCount=g&&g[c]&&g[c].qApprMaxGlyphCount||10,b[c].characterRatios={latin:0,cjk:0},b[c].groupSize=g&&g[c]?g[c].groupSize:void 0),b[c].data.push(k),b[c].characterRatios.latin+=n.latin,b[c].characterRatios.cjk+=n.cjk;return o}function g(a){for(var b=a.parent,c=[];b;)b.collapseChildren||c.push(b),b=b.parent;return c}function h(a,b){var c,d,e,f,h,i,j,k,l=a[a.length-1].data;for(l[0].distanceFrom=b/2,l[0].distanceTo=l[0].distanceFrom+1,c=g(l[0]),j=c.filter(function(a){return a.group})[0],f=1;f<l.length;f++){if(i=l[f-1].distanceTo,d=g(l[f]),k=d.filter(function(a){return a.group})[0],k!==j){for(h=0;h<d.length&&(d[h]!==c[h]||!(d[h]<0||d[h].group));h++);i+=b*h,j=k,c=d}l[f].distanceFrom=i,l[f].distanceTo=l[f].distanceFrom+1}if(a.length>1)for(f=a.length-2;f>=0;f--)for(e=a[f].data,h=0;h<e.length;h++)e[h].distanceFrom=e[h].children[0].distanceFrom,e[h].distanceTo=e[h].children[e[h].children.length-1].distanceTo}function i(a,b,c,d){var e=b.getTextWidth("",c),f=a<=24?b.getTextWidth("m",c):b.getAverageLetterWidth(c);return d?a*(e*d.cjk+f*d.latin):a*f}var j,k=0,l=1,m=3;return j=a.extend("DiscreteAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._unitsOffset=0,this._innerOffset=0,this._shrinkToFitThreshold=arguments[1]&&null!==arguments[1].shrinkToFitThreshold?arguments[1].shrinkToFitThreshold:.85,this._maxDiscreteUnitSize=null,this._minDiscreteUnitSize=null,this._alignmentOffset=0,this._unitAlignment="center",this._angle1=-40,this._angle2=-90},setYMirrorMode:function(a){this._super(a),a?(this._angle1=40,this._angle2=90):(this._angle1=-40,this._angle2=-90)},updateSize:function(){this._super(),1===this._numDiscrete?this._discreteSpacing=Math.min(this._discreteSpacing,this._plotSize/this._numDiscrete):this._discreteSpacing-=(this._preliminarySize-this._plotSize)/(this._numUnitsInView||1),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,this._plotSize),this.extendedRect=new b(this.rect.x-this._edgeBleed.left,this.rect.y-this._edgeBleed.top,this.rect.width+this._edgeBleed.left+this._edgeBleed.right,this.rect.height+this._edgeBleed.top+this._edgeBleed.bottom)},updateLevels:function(){var a=this._oldLevels;this._levels.forEach(function(b,c){b.labelSpace=a[c].labelSpace,b.labelMode=a[c].labelMode,b.radians=a[c].radians,b.show=a[c].show})},setLabelLevelVisibility:function(a){this._labelLevelVisibility=a,this._levels&&this._levels.forEach(function(b,c){b.show=a[c]!==!1})},_getPerpendicularExtensionForTiltedLabels:function(a,b,c,d){var e,f=this._angle1*Math.PI/180,g=Math.abs(Math.sin(f))*a.longestLabelWidth,h=0;return g=Math.min(d,g),e=Math.abs(Math.cos(f))*g,e=Math.max(e-this._discreteSpacing/2,0),"bottom"===this.dock?(e=Math.max(e-this._alignmentOffset,0),e>b.x&&(h=e-b.x)):"top"===this.dock&&(e=Math.max(e-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0),e>c.width-b.x-b.width&&(h=e-(c.width-c.x-b.x-b.width))),h},_getLabelMode:function(a,b,c){var d,e=a.qApprMaxGlyphCount;return this._showLabels&&"none"!==this._explicitLabelMode?this._explicitLabelMode&&"auto"!==this._explicitLabelMode?"none"===this._explicitLabelMode?k:"tilted"===this._explicitLabelMode?m:l:b&&this.isHorizontal()&&a.data&&a.data.length&&(d=i(e,this._renderer,this._style.label.font,a.characterRatios),a.groupSize&&(c*=a.groupSize),c<d)?m:l:k},preRelevantSizeCalculation:function(){this._super();var a,b=this._levels?this._levels.filter(function(a){return a.show!==!1}):[],c=b.length,d=this.outerRect[this.isVertical()?"width":"height"]/4,e=0,f=0;if(this.isVisible()){for(a=0;a<c;a++)b[a].longestLabelWidth=i(b[a].qApprMaxGlyphCount,this._renderer,this._style.label.font,b[a].characterRatios),e+=b[a].longestLabelWidth;for(a=0;a<c;a++)b[a].labelSizeRatio=Math.min(1/c,b[a].longestLabelWidth/Math.min(e,d)),f+=b[a].labelSizeRatio;f<1&&c>1?b[0].labelSizeRatio===1/c?b[0].labelSizeRatio+=1-f:b[1].labelSizeRatio===1/c&&(b[1].labelSizeRatio+=1-f):1===c&&(b[0].labelSizeRatio=1)}},calculatePreliminaryLabelSpace:function(a,b){var c,d=this._hideMyLabels,e=this._levels?this._levels.filter(function(a){return a.show!==!1&&!d}):[],f=e.length,g=this.outerRect[this._isVertical?"width":"height"]/4,h=this._fontHeight*this._style.label.lineHeight,i=0,j=0,n=0;if(this._preliminarySize=a[this._isVertical?"height":"width"],this._calculateDiscreteUnits(this._preliminarySize),this.isVisible())for(c=0;c<f;c++){e[c].labelMode=this._getLabelMode(e[c],c===e.length-1,this._discreteSpacing);var o=0;switch(e[c].labelMode){case l:var p=Math.min(e[c].labelSizeRatio*g,e[c].longestLabelWidth);e[c].labelSpace=this.isHorizontal()?h:Math.min(e[c].labelSizeRatio*g,e[c].longestLabelWidth),j=Math.max(0,p-e[c].labelSpace);break;case m:e[c].radians=this._angle1*Math.PI/180,o=this._getPerpendicularExtensionForTiltedLabels(e[c],a,b,g*e[c].labelSizeRatio),o>a.width/5&&(e[c].radians=this._angle2*Math.PI/180),e[c].labelSpace=Math.abs(Math.sin(e[c].radians))*e[c].longestLabelWidth+Math.abs(this._fontHeight*Math.sin(e[c].radians)*2),e[c].labelSpace=Math.min(j+e[c].labelSizeRatio*g+Math.abs(this._fontHeight*Math.sin(e[c].radians)/2),e[c].labelSpace);break;default:e[c].labelSpace=0}e[c].labelMode===m&&(i=Math.max(i,Math.min(a.width/3,Math.ceil(Math.cos(e[c].radians)*e[c].labelSpace))),i=Math.max(i-this._discreteSpacing/2,0),"bottom"===this.dock?i=Math.max(i-this._alignmentOffset,0):"top"===this.dock&&(i=Math.max(i-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0)),i=Math.ceil(i)),n+=e[c].labelSpace}return i>0&&("bottom"===this.dock&&i>a.x?this._preliminarySize=this._preliminarySize-(i-a.x):"top"===this.dock&&i>b.width-a.x-a.width&&(this._preliminarySize=this._preliminarySize-(i-(b.width-b.x-a.x-a.width))),this._calculateDiscreteUnits(this._preliminarySize)),this.fire("numDiscreteUnitsChanged"),this.fire("numDiscreteUnitsInViewChanged"),this._showLabels_internal=this._showLabels&&e&&e.some(function(a){return a.labelMode!==k}),this._preliminaryRelevantSize={relevantLabelSize:n,relevantSpacing:i},this._preliminaryRelevantSize},calculateLabelSpace:function(){return this.updateNow(["properties"]),this._preliminaryRelevantSize},setDataRange:function(a,b){var c,d,e,g;if(this._levels&&this._levels.length&&(this._oldLevels=this._levels.map(function(a){return{labelMode:a.labelMode,labelSpace:a.labelSpace,radians:a.radians,show:a.show,groupSize:a.groupSize}})),this._levels=[],this._labelIds={},f(a,this._levels,0,-1,b,this._labelIds),e=this._levels.length>1?1:0,this._levels&&this._levels.length){h(this._levels,e);for(var i=0;i<this._levels.length;i++)this._levels[i].characterRatios&&(g=this._levels[i].characterRatios.latin+this._levels[i].characterRatios.cjk||1,this._levels[i].characterRatios.latin=this._levels[i].characterRatios.latin/g,this._levels[i].characterRatios.cjk=this._levels[i].characterRatios.cjk/g);c=this._levels[this._levels.length-1].data,d=c[c.length-1].distanceTo+e/2,this._numDiscrete=c.length,this._numDiscrete=d||0,this._explicitNumDiscrete&&(this._numDiscrete=this._explicitNumDiscrete,this._numDiscrete=this._explicitNumDiscrete)}return this.invalidateProperties(),this.invalidateDisplay("setDataRange"),this},setOffset:function(a){if(this._unitsOffset!==a)return this._unitsOffset=a,this.invalidateProperties(),this.invalidateDisplay("setOffset"),this.fire("changed"),this},getOffset:function(){return this._unitsOffset},setInnerOffset:function(a){this._innerOffset=a},getInnerOffset:function(){return this._innerOffset||0},getNumDiscreteUnits:function(){return this._numDiscrete},setNumDiscreteUnits:function(a){this._explicitNumDiscrete=a},getNumDiscreteUnitsInView:function(){return this._numUnitsInView},setMaxDiscreteUnitSize:function(a){this._maxDiscreteUnitSize=a},setMinDiscreteUnitSize:function(a){this._minDiscreteUnitSize=a},setUnitAlignment:function(a){this._unitAlignment=a},isDiscrete:function(){return!0},setLockedInfo:function(a){this._lockedInfo=a},getLevels:function(){var a,b,c=[];if(this._levels&&this._levels.length)for(b=0;b<this._levels.length;b++)this._levels[b].show&&(a=d.call(this,this._levels[b].data,b,this._plotSize),a.labelMode=this._levels[b].labelMode,a.labelSpace=this._levels[b].labelSpace,a.radians=this._levels[b].radians,c.push(a));return c},calculateValuePositionMappingInfo:function(){this._calculateDiscreteUnits(this._plotSize)},getDiscreteSpacing:function(){return this._discreteSpacing},getPositionOfValue:function(a,b){var c,d,e=this._levels.length-1;"undefined"!=typeof b&&(e=Math.min(this._levels.length-1,Math.max(0,b))),c=this._levels[e].data,d=c[a];var f=d.distanceFrom+.5*(d.distanceTo-d.distanceFrom)+this._innerOffset-this._unitsOffset,g=f*this._discreteSpacing+this._alignmentOffset;return!this._isVertical&&this.yMirrorMode?this._plotSize-g:g},getWidthOfValue:function(a,b){var c,d=this._levels.length-1;return"undefined"!=typeof b&&(d=Math.min(this._levels.length-1,Math.max(0,b))),c=this._levels[d].data,(c[a].distanceTo-c[a].distanceFrom)*this._discreteSpacing},getPositionOfId:function(a){var b=this._labelIds[a]||this._labelIds[a.split(";").reverse().slice(-1).reverse().join(";")];if(!b)return 0;var c=b.distanceFrom+.5*(b.distanceTo-b.distanceFrom)+this._innerOffset-this._unitsOffset,d=c*this._discreteSpacing+this._alignmentOffset;return!this._isVertical&&this.yMirrorMode?this._plotSize-d:d},getWidthOfId:function(a){var b=this._labelIds[a]||this._labelIds[a.split(";").reverse().slice(-1).reverse().join(";")];return b?(b.distanceTo-b.distanceFrom)*this._discreteSpacing:0},getValueOfPosition:function(a){var b,c,d,e,f=this._levels[0].data,g=f.length;for(a=!this._isVertical&&this.yMirrorMode?this._plotSize-a:a,d=0;d<g;d+=1)if(e=f[d],b=(e.distanceFrom+this._innerOffset-this._unitsOffset)*this._discreteSpacing,c=b+(e.distanceTo-e.distanceFrom)*this._discreteSpacing,a>=b&&a<=c)return e.label;return""},_calculateDiscreteUnits:function(a){this._discreteSpacing=Math.max(null!==this._minDiscreteUnitSize?this._minDiscreteUnitSize:0,a/this._numDiscrete),null!==this._maxDiscreteUnitSize&&(this._discreteSpacing=Math.min(this._maxDiscreteUnitSize,this._discreteSpacing)),(1===this._numDiscrete||this._numDiscrete*this._discreteSpacing>a&&this._numDiscrete*this._discreteSpacing*this._shrinkToFitThreshold<a)&&(this._discreteSpacing=Math.min(this._discreteSpacing,a/this._numDiscrete)),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,a),this._numUnitsInView=Math.min(this._numDiscrete,Number((a/this._discreteSpacing).toFixed(5)))},_getAlignmentOffset:function(a,b){var c=null!==this._maxDiscreteUnitSize&&this._discreteSpacing<b/this._numDiscrete?.5*(b-this._numDiscrete*this._discreteSpacing):0;return"near"===a?0:"far"===a?2*c:c}})}),define("objects.views/charts/utils/scale-utils",[],function(){"use strict";function a(){var a,b,c,d;a=0===this.explicitPlotMax?1:y.getMagnitude(this.explicitPlotMax),b=this.explicitPlotMax,c=this.maxNumIntervals<2?b-a:b-2*a,c=Math.ceil(c/a)*a,d=b-c,this.tickDataSpacing=d/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a/10,y.getNiceNumber(this.tickDataSpacing)),this.plotMax=b,this.plotMin=c,this.plotRange=d,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMin)}function b(){var a,b,c,d;a=0===this.explicitPlotMin?1:y.getMagnitude(this.explicitPlotMin),c=this.explicitPlotMin,b=this.maxNumIntervals<2?c+a:c+2*a,b=Math.floor(b/a)*a,d=b-c,this.tickDataSpacing=d/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a/10,y.getNiceNumber(this.tickDataSpacing)),this.plotMax=b,this.plotMin=c,this.plotRange=d,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMax-this.tickDataSpacingNN)}function c(){null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin?a.call(this):null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax&&b.call(this)}function d(){this.plotMax=this.plotMin=this.tickBaseValue=this.usedDataMin,this.plotRange=0,this.tickDataSpacing=this.tickDataSpacingNN=0===this.usedDataMin?1:Math.abs(this.usedDataMin),this.tickMaxIndex=this.tickMinIndex=0}function e(){if(0===this.usedDataMax)this.maxNumIntervals<2?(this.plotMin=0,this.plotMax=1):(this.plotMin=-1,this.plotMax=1),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=this.plotRange/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.ceil(this.plotMin/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor(this.plotMax/this.tickDataSpacingNN);else{var a=h(Math.abs(this.usedDataMax),this.maxNumIntervals);this.usedDataMax>0?(this.plotMax=a.max,this.plotMin=a.min,this.tickBaseValue=a.tickBaseValue):(this.plotMax=-a.min,this.plotMin=-a.max,this.tickBaseValue=-a.tickBaseValue),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=this.plotRange/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a.magnitude/10,y.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.floor((this.plotMin-this.tickBaseValue)/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor((this.plotMax-this.tickBaseValue)/this.tickDataSpacingNN)}}function f(){0===this.explicitPlotMax?(this.plotMax=0,this.plotMin=-1,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.plotRange/this.maxNumIntervals))):a.call(this)}function g(){0===this.explicitPlotMin?(this.plotMax=1,this.plotMin=0,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.plotRange/this.maxNumIntervals))):b.call(this)}function h(a,b){var c,d,e=y.getMagnitude(a),f=a/e,g=Math.floor(f),h=Math.round(f),i=0;return b<2?(c=g*e,d=(g+1)*e,b<1&&(i=c)):(c=(h-1)*e,d=(h+1)*e),{min:c,max:d,tickBaseValue:i,magnitude:e}}function i(){null!==this.explicitPlotMin&&null!==this.explicitPlotMax?d.call(this):null===this.explicitPlotMin&&null===this.explicitPlotMax?e.call(this):null===this.explicitPlotMin&&null!==this.explicitPlotMax?f.call(this):g.call(this)}function j(a,b,c){void 0===a&&(a=null!==this.explicitPlotMin),void 0===b&&(b=null!==this.explicitPlotMax),this.tickDataSpacingNN=c?y.getGoodNumber(this.tickDataSpacing):y.getNiceNumber(this.tickDataSpacing),u.apply(this,[a,b])}function k(){var a,b,c,d;if(j.call(this),a=this.tickMaxIndex-this.tickMinIndex,b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,d&&this.maxNumIntervals>=5){for(c=0;this.tickDataSpacing<=this.absMax&&d;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.call(this),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c++;if(!d)return}for(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,(d||a<=2&&this.maxNumIntervals>=2*a)&&j.apply(this,[void 0,void 0,!0]),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c=0;this.tickDataSpacing<=this.absMax&&d;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.apply(this,[void 0,void 0,!0]),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c++}function l(a){a?(this.tickDataSpacingNN=y.getGoodNumber(this.absMax),this.tickBaseValue=-this.tickDataSpacingNN,this.plotMin=null===this.explicitPlotMin?-this.tickDataSpacingNN:this.explicitPlotMin,this.plotMax=null===this.explicitPlotMax?this.tickDataSpacingNN:this.explicitPlotMax,this.tickMinIndex=null===this.explicitPlotMin?0:1,this.tickMaxIndex=(null===this.explicitPlotMax,1),this.tickDataSpacingNN=2*this.tickDataSpacingNN):(this.plotMax=this.usedDataMax,this.plotMin=this.usedDataMin,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,this.tickDataSpacingNN=y.getNiceNumber(this.absMax),this.tickDataSpacingNN===this.absMax&&(this.tickDataSpacingNN=y.getNiceNumber(1.1*this.absMax)))}function m(){var a;this.tickDataSpacingNN=y.getNiceNumber(this.tickDataSpacing),this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,(this.usedDataMax<0||this.usedDataMin>0)&&(a=y.getSmallNiceNumber(this.plotRange),this.tickBaseValue=Math.ceil(this.plotMin/a)*a)}function n(){var a,b,c,d,e,f;for(c=this.usedDataMax>=-this.usedDataMin,a=c||null!==this.explicitPlotMin,b=!c||null!==this.explicitPlotMax,j.apply(this,[a,b,!0]),e=0,f=(this.absMax+(1-this.spaceUseLimit)*this.absMin)/this.spaceUseLimit*1.0001;this.tickDataSpacing<=f&&this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.apply(this,[a,b,!0]),e++;d=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=d/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&l.call(this)}function o(){k.call(this);var a=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin);this.spaceUseFactor=a/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,n.call(this))}function p(){var a,b,c,d,e,f,g,h,i,j=y.getNiceNumber(this.tickDataSpacingNN);this.tickDataSpacingNN!==j&&0===this.tickBaseValue&&(a=this.tickDataSpacingNN,d=this.tickMinIndex,e=this.tickMaxIndex,f=e-d,b=this.plotMin,c=this.plotMax,this.tickDataSpacingNN=j,u.apply(this,[null!==this.explicitPlotMin,null!==this.explicitPlotMax]),g=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=g/this.plotRange,h=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,i=this.tickMaxIndex-this.tickMinIndex,!h&&(i===f||i>=10||i>=3&&1.5*i>=f)||(this.tickDataSpacingNN=a,this.tickMinIndex=d,this.tickMaxIndex=e,this.plotMin=b,this.plotMax=c,this.plotRange=this.plotMax-this.plotMin))}function q(){this.niceNumberEnabled&&this.plotMax!==this.plotMin&&0!==this.plotSize?(this.minTickValue=this.tickBaseValue+this.tickMinIndex*this.tickDataSpacingNN,this.maxTickValue=this.tickBaseValue+this.tickMaxIndex*this.tickDataSpacingNN):(this.minTickValue=this.plotMin,this.maxTickValue=this.plotMax)}function r(){var a,b,c;if(this.mainTickValues=[],this.secondaryTickValues=[],q.call(this),0!==this.plotSize)if(this.niceNumberEnabled){if(a=this.tickBaseValue,c=this.tickMaxIndex-this.tickMinIndex,!(c<1)){for(b=0;b<=c;b++)this.mainTickValues.push(a+(b+this.tickMinIndex)*this.tickDataSpacingNN);for(a=this.tickBaseValue+this.tickDataSpacingNN/2,b=0;b<c;b++)this.secondaryTickValues.push(a+(b+this.tickMinIndex)*this.tickDataSpacingNN);
}}else{for(this.numIntervals=Math.floor(this.maxNumIntervals),this.tickDataSpacing=this.usedDataRange/this.numIntervals,a=this.usedDataMin,b=0;b<=this.numIntervals;b++)this.mainTickValues.push(a+b*this.tickDataSpacing);for(a=this.usedDataMin+this.tickDataSpacing/2,b=0;b<this.numIntervals;b++)this.secondaryTickValues.push(a+b*this.tickDataSpacing)}}function s(){var a,b,c,d,e,f=[.5];for(a=this.mainTickValues[0],e=0;e<f.length;e++)if(b=a-this.tickDataSpacingNN*f[e],c=this.plotMax-b,d=this.plotSize*this.tickDataSpacingNN/c,d>3*this.fontHeight)return this.plotMin=b,this.plotRange=c,void this.mainTickValues.splice(0,0,b)}function t(){var a,b,c,d,e,f=[.5];for(a=this.mainTickValues[this.mainTickValues.length-1],e=0;e<f.length;e++)if(b=a+this.tickDataSpacingNN*f[e],c=b-this.plotMin,d=this.plotSize*this.tickDataSpacingNN/c,d>3*this.fontHeight)return this.plotMax=b,this.plotRange=c,void this.mainTickValues.push(b)}function u(a,b){this.tickMinIndex=a?Math.ceil(this.usedDataMin/this.tickDataSpacingNN):Math.floor(this.usedDataMin/this.tickDataSpacingNN),this.tickMaxIndex=b?Math.floor(this.usedDataMax/this.tickDataSpacingNN):Math.ceil(this.usedDataMax/this.tickDataSpacingNN),this.plotMin=a?this.usedDataMin:this.tickMinIndex*this.tickDataSpacingNN,this.plotMax=b?this.usedDataMax:this.tickMaxIndex*this.tickDataSpacingNN,this.plotRange=this.plotMax-this.plotMin}function v(){var a,b,c,d,e,f=this.plotMin,g=this.plotMax,h=this.tickMinIndex,i=this.tickMaxIndex,j=this.tickDataSpacingNN,k=this.tickMaxIndex-this.tickMinIndex,l=null!==this.explicitPlotMin,m=null!==this.explicitPlotMax,n=!0,o=2*this.fontHeight,p=k;if(d=this.mainTickValues?this.mainTickValues.length:0,b=this.mainTickValues[0],c=this.mainTickValues[d-1],null===this.explicitPlotMin&&b>this.dataMin&&p++,null===this.explicitPlotMax&&c<this.dataMax&&p++,p!==k){for(e=0;n&&e<10;)this.tickDataSpacingNN=y.getSmallNiceNumber(.99*this.tickDataSpacingNN),u.apply(this,[l,m]),a=this.tickMaxIndex-this.tickMinIndex,a>p&&(n=!1),e++;for(n=!0,e=0;this.tickDataSpacingNN<j&&n&&e<10;)this.tickDataSpacingNN=y.getGoodNumber(1.1*this.tickDataSpacingNN),u.apply(this,[l,m]),a=this.tickMaxIndex-this.tickMinIndex,a===p&&this.plotSize*this.tickDataSpacingNN/this.plotRange>o&&(n=!1),e++;n?(this.plotMin=f,this.plotMax=g,this.tickMinIndex=h,this.tickMaxIndex=i,this.tickDataSpacingNN=j):r.call(this)}}function w(){var a,b,c;c=this.mainTickValues?this.mainTickValues.length:0,a=this.mainTickValues[0],b=this.mainTickValues[c-1],null===this.explicitPlotMin&&a>this.dataMin&&null===this.explicitPlotMax&&b<this.dataMax?Math.abs(this.dataMin)<=Math.abs(this.dataMax)?(s.call(this),t.call(this)):(t.call(this),s.call(this)):null===this.explicitPlotMin&&a>this.dataMin?s.call(this):null===this.explicitPlotMax&&b<this.dataMax&&t.call(this)}function x(){return{plotMin:this.plotMin,plotMax:this.plotMax,tickSpacing:this.tickDataSpacingNN,tickBaseValue:this.tickBaseValue,tickMinIndex:this.tickMinIndex,tickMaxIndex:this.tickMaxIndex,minTickValue:this.minTickValue,maxTickValue:this.maxTickValue,mainTickValues:this.mainTickValues,secondaryTickValues:this.secondaryTickValues}}var y,z=Math.log(10),A=1e-12;return y={log:function(a,b){return a<=0||b<=0?NaN:Math.log(a)/Math.log(b)},log10:function(a){return a<=0?NaN:Math.log(a)/z},eliminateFloatingError:function(a){var b=Math.round(a);return Math.abs(a-b)<A&&(a=b),a},getNiceNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),d=c<=1?1:c<=2?2:c<=5?5:10,d*Math.pow(10,b)*(a<0?-1:1))},getSmallNiceNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),c<1?(d=5,b--):d=c<2?1:c<5?2:5,d*Math.pow(10,b)*(a<0?-1:1))},getMagnitude:function(a){var b;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),Math.pow(10,b))},getFraction:function(a){var b;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),a/Math.pow(10,b))},getGoodNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),d=Math.ceil(c),7!==d&&9!==d||d++,c>1&&c<=1.5?d=1.5:c>2&&c<=2.5&&(d=2.5),d*Math.pow(10,b)*(a<0?-1:1))},calculateTicks:function(a,b,d,e,f,g,h,j,q,s,t){var u,y=!1;return void 0===t&&(t=!1),isNaN(e)&&(e=null),isNaN(f)&&(f=null),b>d&&(u=b,b=d,d=u),null!==e&&null!==f&&e>f&&(u=e,e=f,f=u),this.plotSize=a,this.dataMin=b,this.dataMax=d,this.explicitPlotMin=e,this.explicitPlotMax=f,this.minTickSpacingInPixel=g,this.usedDataMin=null===this.explicitPlotMin?this.dataMin:this.explicitPlotMin,this.usedDataMax=null===this.explicitPlotMax?this.dataMax:this.explicitPlotMax,this.absMax=Math.max(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.absMin=Math.min(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=this.plotSize/this.minTickSpacingInPixel,this.maxNumTicks=this.maxNumIntervals+1,this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,this.fontHeight=h,this.niceNumberEnabled=j,this.tickBaseValue=0,this.spaceUseLimit=void 0===s?.6:s,this.spaceOptimizingEnabled=q,this.plotMaxCanBeTuned=null===this.explicitPlotMax&&this.usedDataMax>0,this.plotMinCanBeTuned=null===this.explicitPlotMin&&this.usedDataMin<0,j&&0!==a?(null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin||null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax?(y=!0,c.call(this)):0===this.usedDataRange?i.call(this):this.maxNumIntervals<1?m.call(this):(this.usedDataMax>0&&this.usedDataMin<0?1===this.maxNumIntervals?l.call(this,!0):this.maxNumIntervals>=5?k.call(this):this.maxNumIntervals<2?n.call(this):o.call(this):k.call(this),this.tickMaxIndex<this.tickMinIndex?(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,m.call(this)):p.call(this)),r.call(this),t&&this.maxNumIntervals>=1&&!y&&(v.call(this),w.call(this)),x.call(this)):(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.tickDataSpacingNN=this.tickDataSpacing,r.call(this),x.call(this))}}}),define("objects.views/charts/components/axis/linear-scale",["core.utils/class","../../utils/scale-utils"],function(a,b){"use strict";var c=a.extend("LinearScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(a){this._plotSize=a},getPositionOfValue:function(a){return(a-this.plotMin)/this.plotRange*this._plotSize},getValueOfPosition:function(a){return this.plotMin+this.plotRange*a/this._plotSize},getNormalizedValue:function(a){return(a-this.plotMin)/this.plotRange},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin},calculateTicks:function(){var a,c,d,e,f;d=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,c=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,a=b.calculateTicks(this._calculationSize,d,c,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled,.6,this._showExplicitMinMax),this._tickSpacing=a.tickSpacing,this.plotMin=a.plotMin,this.plotMax=a.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=a.tickMinValue,this.tickMax=a.tickMaxValue,this.mainValues=a.mainTickValues,this.secondaryValues=a.secondaryTickValues,0===this.mainValues.length&&this.mainValues.push(a.minTickValue),0===this._tickSpacing&&(this._tickSpacing=1),this._showExplicitMinMax&&(f=this.mainValues[0],this.mainValues[0]=a.plotMin,f-a.plotMin>=a.tickSpacing/2&&this.mainValues.splice(1,0,f),e=a.mainTickValues[a.mainTickValues.length-1],a.plotMax-e<=a.tickSpacing/2?this.mainValues[a.mainTickValues.length-1]=a.plotMax:this.mainValues.push(a.plotMax))},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}});return c}),define("objects.views/charts/utils/time-scale-utils",[],function(){var a=25569,b=86400,c=1440,d={dateToQlikTimestamp:function(b){return b.getTime()/1e3/86400-b.getTimezoneOffset()/60/24+a},getUnixDate:function(a){return new Date(1899,11,30+a)},calculateTicks:function(a,d,e,f,g){var h,i,j=this.getUnixDate(d),k=j.getFullYear(),l=j.getMonth(),m=j.getDate(),n=e-d,o=f-e,p=a/o,q=p/1440,r=p/b,s=366*p,t=3*p*30,u=g.second/r,v=g.minute/q,w=g.date/t,x=g.year/s,y=0,z=0,A=null,B=null,C=null,D=null,E=null,F=null,G={plotMin:e,plotMax:f,tickMin:0,tickMax:0,mainTickValues:[],mainDates:[],secondaryTickValues:[],secondaryDates:[]};for(u<1?(A=1,z=1/b):u<2?(A=2,z=1/b*2):u<5?(A=5,z=1/b*5):u<10?(A=10,z=1/b*10):u<30?(A=30,z=1/b*30):v<1?(B=1,z=1/c):v<2?(B=2,z=1/c*2):v<5?(B=5,z=1/c*5):v<10?(B=10,z=1/c*10):v<30?(B=30,z=1/c*30):v<60?(C=1,z=1/24):v<120?(C=2,z=2/24):v<360?(C=6,z=.25):v<720?(C=12,z=.5):w<1/90?z=D=1:w<2/90?z=D=2:w<7/90?z=D=7:w<31/90?(E=1,z=31):w<1?(E=3,z=90):x<1?(F=1,z=366):x<2?(F=2,z=732):x<5?(F=5,z=1826.25):(F=10,z=3652.5),i=Math.floor((n+d%1)/z);y<f&&(h=F?new Date(k+i*F,0,1):E?new Date(k,l+i*E,1):D?new Date(k,l,m+i*D):C?new Date(k,l,m,0+i*C):B?new Date(k,l,m,0,0+i*B):new Date(k,l,m,0,0,0+i*A),y=this.dateToQlikTimestamp(h),!(y>f));){G.secondaryDates.push(h),G.secondaryTickValues.push(y);var H=Math.floor(y);F||E||D||G.mainTickValues[G.mainTickValues.length-1]===H||(G.mainDates.push(this.getUnixDate(H)),G.mainTickValues.push(H)),i++}return G.tickSpacing=z,G.tickMinValue=G.secondaryTickValues[0],G.tickMaxValue=G.secondaryTickValues[G.secondaryTickValues.length-1],G}};return d}),define("objects.views/charts/components/axis/time-scale",["./linear-scale","../../utils/time-scale-utils"],function(a,b){"use strict";var c=a.extend("TimeScale",{init:function(){this._super.apply(this,arguments),this.mainDates=[],this.secondaryDates=[]},calculateTicks:function(a){var c,d,e,f,g;d=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,c=b.calculateTicks(this._calculationSize,d,this._explicitPlotMin,this._explicitPlotMax,a),this._mergeResult(c),0===this.secondaryValues.length&&(this.secondaryValues=[this.plotMin],this.secondaryDates=[b.getUnixDate(this.plotMin)]),0===this._tickSpacing&&(this._tickSpacing=1),this._showExplicitMinMax&&(f=this.secondaryValues[0],g=this.secondaryDates[0],this.secondaryValues[0]=c.plotMin,this.secondaryDates[0]=b.getUnixDate(c.plotMin),f-c.plotMin>=c.tickSpacing/2&&(this.secondaryValues.splice(1,0,f),this.secondaryDates.splice(1,0,g)),e=c.mainTickValues[c.mainTickValues.length-1],c.plotMax-e<=c.tickSpacing/2?(this.secondaryValues[c.mainTickValues.length-1]=c.plotMax,this.secondaryDates[c.secondaryDates.length-1]=b.getUnixDate(c.plotMax)):(this.secondaryValues.push(c.plotMax),this.secondaryDates.push(b.getUnixDate(c.plotMax))))},_mergeResult:function(a){this._tickSpacing=a.tickSpacing,this.plotMin=a.plotMin,this.plotMax=a.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=a.tickMinValue,this.tickMax=a.tickMaxValue,this.mainValues=a.mainTickValues,this.mainDates=a.mainDates,this.secondaryValues=a.secondaryTickValues,this.secondaryDates=a.secondaryDates},getValues:function(){return{mainValues:this.mainValues,mainDates:this.mainDates,secondaryValues:this.secondaryValues,secondaryDates:this.secondaryDates}}});return c}),define("objects.views/charts/utils/scale-log-utils",["objects.views/charts/utils/scale-utils"],function(a){"use strict";function b(a,b,c){var d,e=a?a.length:0,f=void 0===b?Number.MAX_VALUE:a[0]/b;for(d=1;d<e;d++)f=Math.min(f,a[d]/a[d-1]);void 0!==c&&(f=Math.min(f,c/a[e-1])),a.splice(0,0,f)}function c(a,c,d){var e,f=a?a.length:0;for(e=0;e<f;e++)b(a[e],c,d)}function d(){var a,b;for(c(E,1,10),a=0;a<F.length;a++)if(F[a])for(b=0;b<F[a].length;b++)F[a][b]instanceof Array&&c(F[a][b])}function e(){var a,b,c,d,e,f,g,h=!0,i=0;for(a=this.tickDataSpacingLog,g=0;h&&i<5;)a=0===i?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*a),b=this.minIsStrict?Math.ceil(this.usedDataMinLog/a):Math.floor(this.usedDataMinLog/a),c=this.maxIsStrict?Math.floor(this.usedDataMaxLog/a):Math.ceil(this.usedDataMaxLog/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a,f=e-d,h=a/f*this.plotSize<this.minTickSpacingInPixel,i++;return h&&(a=Math.ceil(this.tickDataSpacingLog),b=this.minIsStrict?Math.ceil(this.usedDataMinLog/a):Math.floor(this.usedDataMinLog/a),c=this.maxIsStrict?Math.floor(this.usedDataMaxLog/a):Math.ceil(this.usedDataMaxLog/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a),{plotMinLog:d,plotMaxLog:e,tickMinIndex:b,tickMaxIndex:c,tickDataSpacingNNLog:a,tickBaseValueLog:g,success:!h}}function f(){var a,b,c,d,e,f,g,h=!0,i=0;for(a=this.tickDataSpacingLog,b=0,g=this.usedDataMinLogFloor;h&&i<5;)a=0===i?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*a),b=this.minIsStrict?Math.ceil((this.usedDataMinLog-g)/a):Math.floor((this.usedDataMinLog-g)/a),c=this.maxIsStrict?Math.floor((this.usedDataMaxLog-g)/a):Math.ceil((this.usedDataMaxLog-g)/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a+g,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a+g,f=e-d,h=a/f*this.plotSize<this.minTickSpacingInPixel,i++;return h&&(a=0===i?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*a),b=this.minIsStrict?Math.ceil((this.usedDataMinLog-g)/a):Math.floor((this.usedDataMinLog-g)/a),c=this.maxIsStrict?Math.floor((this.usedDataMaxLog-g)/a):Math.ceil((this.usedDataMaxLog-g)/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a+g,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a+g),{plotMinLog:d,plotMaxLog:e,tickMinIndex:b,tickMaxIndex:c,tickDataSpacingNNLog:a,tickBaseValueLog:g,success:!h}}function g(){var a,b,c,d,g,h,i;return b=f.call(this),b.success?(c=this.usedDataMaxLog-this.usedDataMinLog,g=c/(b.plotMaxLog-b.plotMinLog),1===g?b:(a=e.call(this),a.success?(d=c/(a.plotMaxLog-a.plotMinLog),h=a.tickMaxIndex-a.tickMinIndex,i=b.tickMaxIndex-b.tickMinIndex,i>h||i===h&&g>d||i===h&&g===d&&b.plotMinLog<a.plotMinLog?b:a):b)):a=e.call(this)}function h(b,c,d,e,f){var g=a.getNiceNumber(1.1*f),h=b?Math.ceil(d/g):Math.floor(d/g),i=c?Math.floor(e/g):Math.ceil(e/g),j=b||0===h?d:h*g,k=c?e:i*g;return{plotMin:j,plotMax:k,tickSpacing:g,tickBaseValue:0}}function i(a,b){var c;for(c=0;c<a.length;c++)if(a[c]>=b)return c-1}function j(a,b){var c;for(c=a.length-1;c>=0;c--)if(a[c]<=b)return c+1}function k(a,b,c,d,e){var f,g;f=i(a,b),g=j(a,c),!d&&void 0!==a[f+1]&&a[f+1]>b&&(f-=1),!e&&g>0&&void 0!==a[g-1]&&a[g-1]<c&&(g+=1),g<a.length&&a.splice(g,a.length-g),f>=0&&a.splice(0,f+1)}function l(b,c,d,e){var f,g,h,i,j=Number.MAX_VALUE,k=-Number.MAX_VALUE,l=a.log10(d),m=a.log10(c),n=l-m;for(g=b?b.length:0,h=new Array(g),(null===e||isNaN(e))&&(e=1.71),f=0;f<g;f++)h[f]=a.log10(b[f]);for(f=1;f<g;f++)i=h[f]-h[f-1],j=Math.min(j,i),k=Math.max(k,i);return k=Math.max(k,Math.abs(h[0]-m)),k=Math.max(k,Math.abs(l-h[g-1])),j/n*this.plotSize>=this.minTickSpacingInPixel-C&&k/j<=e&&b.length-1<=this.maxNumIntervals}function m(b){var c,d,e,f,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=b.mainTickValues;for(d=i?i.length:0,e=new Array(d),c=0;c<d;c++)e[c]=a.log10(i[c]);for(c=1;c<d;c++)f=e[c]-e[c-1],g=Math.min(g,f),h=Math.max(h,f);b.maxTickSpacing=h,b.minTickSpacing=g,b.tickSpacingRatio=h/g,b.spaceUseFactor=this.usedDataRange/(b.plotMax-b.plotMin),b.factor=b.spaceUseFactor/(b.tickSpacingRatio*b.tickSpacingRatio)}function n(b,c,d,e,f){var g,h,i,j,k;return g=(e+d)/2,void 0===f?(h=Math.round(g),h>=d&&h<=e?Math.pow(10,h):(i=Math.floor(g),i>=d&&i<=e?Math.pow(10,i):(j=Math.ceil(g),j>=d&&j<=e?Math.pow(10,j):(k=a.getSmallNiceNumber(Math.max(1,c-b)),Math.ceil(b/k)*k)))):(i=Math.pow(10,Math.floor(g)),j=Math.pow(10,Math.ceil(g)),Math.abs(i-f)<Math.abs(j-f)?i:j)}function o(a,b,c,d,e,f){var g,h,i=e?Math.ceil((a-c)/d):Math.floor((a-c)/d),j=f?Math.floor((b-c)/d):Math.ceil((b-c)/d),k=[];for(g=i;g<=j;g++)h=g*d+c,h>0&&k.push(g*d+c);return k}function p(a,b,c,d){a.mainTickValues=b,a.plotMin=c,a.plotMax=d}function q(){return this.usedDataMax>=10*this.usedDataMin?1:this.usedDataMaxLogFloor===this.usedDataMinLogFloor?this.maxIsStrict&&this.minIsStrict?2:3:1}function r(a){a.sort(function(a,b){return a-b})}function s(a,b,c,d,e,f,g){var h,i,j,m,n,o,p,q=0,s=[];for(q=0;q<a.length;q++)if(b<=a[q][0]+C){for(n=c.concat(),h=d;h<e;h++)for(i=1;i<a[q].length;i++)n.push(a[q][i]*Math.pow(10,h*f+g));r(n),k(n,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),o=this.minIsStrict?this.explicitPlotMin:n[0],p=this.maxIsStrict?this.explicitPlotMax:n[n.length-1],l.apply(this,[n,o,p])&&s.push({mainTickValues:n,plotMin:o,plotMax:p})}if(0===s.length)return n=c,k(n,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),o=this.minIsStrict?this.explicitPlotMin:n[0],p=this.maxIsStrict?this.explicitPlotMax:n[n.length-1],{mainTickValues:n,plotMin:o,plotMax:p};if(1===s.length)return s[0];for(m=c.length-1,q=0;q<s.length;q++)if(j=s[q].mainTickValues.length-1,s[q].mainTickValues[0]===c[0]&&s[q].mainTickValues[j]===c[m])return s[q];return s[0]}function t(a,b){var c,d,e,f,g,h,i=!0,j=Math.ceil(this.fractionMinLog),k=Math.floor(this.fractionMaxLog),m=0;if(a[j]&&a[j][k])for(g=a[j][k],g instanceof Array||(g=a[j][g]),h=g.length;m<h&&i;){if(b<=g[m][0]+C&&g[m].length-2<=this.maxNumIntervals){for(d=[],c=1;c<g[m].length;c++)d.push(g[m][c]*this.dataMinMagnitude);i=!l.apply(this,[d,this.usedDataMin,this.usedDataMax])}i&&m++}return i&&(d=[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),e=this.minIsStrict?this.explicitPlotMin:d[0],f=this.maxIsStrict?this.explicitPlotMax:d[d.length-1],{mainTickValues:d,plotMin:e,plotMax:f}}function u(a,b){var c,d,e,f,g,h,i,j,m,o,q,r,s,t,u,v=this.minIsStrict?Math.ceil(this.fractionMinLog):Math.floor(this.fractionMinLog),w=this.maxIsStrict?Math.floor(this.fractionMaxLog):Math.ceil(this.fractionMaxLog),x={};if(G[v]&&G[v][w])for(i=G[v][w],j=i instanceof Array?i.length/2:0,x.mainTickValues=[],c=0;c<j;c++)if(m=i[2*c],o=i[2*c+1],a[m]&&a[m][o])for(q=a[m][o],r=q.length,d=0;d<r;d++)if(s=b<=q[d][0]+C&&q[d].length-2<=this.maxNumIntervals,t=q[d][1]*this.dataMinMagnitude,u=q[d][q[d].length-1]*this.dataMinMagnitude,s=this.minIsStrict?s&&t>=this.usedDataMin:s&&t<=this.usedDataMin,s=this.maxIsStrict?s&&u<=this.usedDataMax:s&&u>=this.usedDataMax){for(f=[],e=1;e<q[d].length;e++)f.push(q[d][e]*this.dataMinMagnitude);if(k(f,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),g=this.minIsStrict?this.explicitPlotMin:f[0],h=this.maxIsStrict?this.explicitPlotMax:f[f.length-1],l.apply(this,[f,g,h])){x.mainTickValues.length<f.length&&p(x,f,g,h);break}}return x.mainTickValues&&0!==x.mainTickValues.length||(x.mainTickValues=[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),f=x.mainTickValues,x.plotMin=this.minIsStrict?this.explicitPlotMin:f[0],x.plotMax=this.maxIsStrict?this.explicitPlotMax:f[f.length-1],x}function v(a,b,c){var d,e=a.length;if(c){for(d=e-1;d>=0;d--)if(Math.abs(a[d]-b[d]*this.dataMinMagnitude)>C)return!1;return!0}for(d=0;d<e;d++)if(Math.abs(a[d]-b[d]*this.dataMinMagnitude)>C)return!1;return!0}function w(a){var b,c,d=a.mainTickValues,e=d.length;if(!(e<2||e>4))return c=5*this.dataMinMagnitude,(this.minIsStrict&&this.usedDataMin<=c||!this.minIsStrict&&this.usedDataMin>=c)&&(v.apply(this,[d,[6,10,20,40]])||v.apply(this,[d,[4,10,20,40]]))?(b=d[0],d[0]=c,a.plotMin=this.minIsStrict?this.explicitPlotMin:d[0],void(l.apply(this,[d,a.plotMin,a.plotMax])||(d[0]=b,a.plotMin=this.minIsStrict?this.explicitPlotMin:d[0]))):(c=80*this.dataMinMagnitude,(this.maxIsStrict&&this.usedDataMax>=c||!this.maxIsStrict&&this.usedDataMax<=c)&&v.apply(this,[d,[10,20,40,60],!0])?(b=d[e-1],d[e-1]=c,a.plotMax=this.maxIsStrict?this.explicitPlotMax:d[e-1],void(l.apply(this,[d,a.plotMin,a.plotMax])||(d[e-1]=b,a.plotMax=this.maxIsStrict?this.explicitPlotMax:d[e-1]))):void 0)}function x(b,c,d,e,f,g,i,j,k,m){var n,p,q,r,s=a.calculateTicks(b,c,d,e,f,g,i,j,k,m),t=null!==e,u=null!==f,v=t?e:c,w=u?f:d,x=1;for(0===s.plotMin&&(s.plotMin=t?e:c),n=s.mainTickValues,p=t?e:Math.min(c,n[0]),q=u?f:Math.max(n[n.length-1],d);!l.apply(this,[n,p,q])&&x<=20;)s=h(t||s.tickSpacing>v,u,v,w,s.tickSpacing),n=o(v,w,s.tickBaseValue,s.tickSpacing,t,u),p=t?e:Math.min(c,n[0]),q=u?f:Math.max(n[n.length-1],d),x++;return l.apply(this,[n,p,q])?(r=a.getFraction(n[0])/2,2===n.length&&n[1]/n[0]===2&&n[0]/2>=p&&r===Math.floor(r)&&(n.splice(0,0,n[0]/2),r=a.getFraction(n[0])/2,n[0]/2>=p&&r===Math.floor(r)&&n.splice(0,0,n[0]/2))):n=[],s.mainTickValues=n,s.numLoops=x,s}function y(){var a,b,c,d,e,f,h,i,j,m,o,r,v,x,y,z={};if(this.maxIsStrict&&this.explicitPlotMax<=this.usedDataMin?(this.dataMinLog=Math.ceil(this.explicitPlotMaxLog-(this.maxNumIntervals<2?1:2)),this.dataMin=Math.pow(10,this.dataMinLog)):this.minIsStrict&&this.explicitPlotMin>=this.usedDataMax?(this.dataMaxLog=Math.floor(this.explicitPlotMinLog+(this.maxNumIntervals<2?1:2)),this.dataMax=Math.pow(10,this.dataMaxLog)):this.usedDataMin===this.usedDataMax&&(c=this.usedDataMin,this.dataMinLog=Math.floor(this.dataMinLog),this.dataMaxLog=this.dataMinLog+1,this.dataMin=Math.pow(10,this.dataMinLog),this.dataMax=Math.pow(10,this.dataMaxLog)),this.usedDataMin=this.minIsStrict?this.explicitPlotMin:this.dataMin,this.usedDataMax=this.maxIsStrict?this.explicitPlotMax:this.dataMax,this.usedDataMinLog=this.minIsStrict?this.explicitPlotMinLog:this.dataMinLog,this.usedDataMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:this.dataMaxLog,this.maxNumIntervals<1)return p(z,[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog,c)],this.usedDataMin,this.usedDataMax),z;if(this.tickDataSpacingLog=(this.usedDataMaxLog-this.usedDataMinLog)/this.maxNumIntervals,this.usedDataMinLogFloor=Math.floor(this.usedDataMinLog),this.usedDataMaxLogFloor=Math.floor(this.usedDataMaxLog),this.dataMinMagnitude=Math.pow(10,this.usedDataMinLogFloor),this.fractionMinLog=this.usedDataMin/this.dataMinMagnitude,this.fractionMaxLog=this.usedDataMax/this.dataMinMagnitude,a=Math.ceil(this.usedDataMaxLog),this.usedDataMinLog===this.usedDataMinLogFloor&&this.usedDataMaxLog===a&&this.maxNumIntervals>=2&&this.maxNumIntervals<3&&this.tickDataSpacingLog>1&&this.tickDataSpacingLog-Math.floor(this.tickDataSpacingLog)<D&&(b=Math.floor((this.usedDataMinLogFloor+a)/2),v=[Math.pow(10,this.usedDataMinLogFloor),3*Math.pow(10,b),Math.pow(10,a)],k(v,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),x=this.minIsStrict?this.explicitPlotMin:v[0],y=this.maxIsStrict?this.explicitPlotMax:v[v.length-1],v.length>=2&&l.apply(this,[v,x,y])))return p(z,v,x,y),z;if(h=g.call(this),!h.success)return p(z,[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)],this.usedDataMin,this.usedDataMax),z;for(i=h.tickMinIndex,j=h.tickMaxIndex,e=h.tickDataSpacingNNLog,f=h.tickBaseValueLog,this.minIsStrict&&i--,this.maxIsStrict&&j++,o=[],m=i;m<=j;m++)o.push(Math.pow(10,m*e+f));return d=Math.pow(10,this.tickDataSpacingLog),r=q.call(this),2===r?t.apply(this,[F,d]):3===r?u.apply(this,[F,d]):(z=s.apply(this,[E,d,o,i,j,e,f]),w.call(this,z),z)}function z(){var a,b,c,d,e={};for(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,b=Math.floor(this.maxNumIntervals),c=(this.dataMaxLog-this.dataMinLog)/b,d=[this.usedDataMin],a=0;a<b;a++)d.push(Math.pow(10,this.dataMinLog+(a+1)*c));return p(e,d,this.plotMin,this.plotMax),e}var A,B=Math.log(10),C=1e-12,D=Math.log(3)/B,E=[[2,4,6],[2,4],[3]],F=[,[,,[[1,2]],[[1,2,3],[1,3]],[[1,2,4],[1,4]],[[1,2,4],[1,5]],[[1,2,4,6],[2,4,6],[1,3,6],[1,6]],[[1,2,4,6],[2,4,6],[1,3,6],[1,7]],[[1,2,4,8],[2,4,8],[1,8]],[[1,2,4,8],[2,4,8],[1,3,9],[1,9]],[[1,2,4,6,10],[1,2,4,10],[1,3,10],[3,10],[1,10]]],[,,,[[2,3]],[[2,3,4],[2,4]],[[2,3,4],[2,4],[2,5]],[[2,4,6],[2,6]],[[2,4,6],[2,6],[2,7]],[[2,4,8],[2,8]],[[2,4,8],[2,8],[2,9]],[[2,4,6,10],[2,4,10],[5,10],[3,10]]],[,,,,[[3,4]],[[3,4,5],[3,5]],[[3,4,5,6],[3,6]],[[3,4,5,6],[3,5,7],[3,7]],[[3,4,5,6,8],[3,5,7],[4,8],[3,8]],[[3,4,5,6,8],[3,4,6,9],[3,4,6,8],[3,6,9],[4,8],[3,9]],[[4,6,10],[5,10],[3,10]]],[,,,,,[[4,5]],[[4,5,6],[4,6]],[[4,5,6,7],[4,5,6],[4,6]],[[4,5,6,7,8],[4,5,6,7],[4,6,8],[4,8]],[[4,5,6,7,8],[4,6,9],[4,6,8],[4,8]],[[4,6,10],[5,7,9],[5,10],[4,10]]],[,,,,,,[[5,6]],[[5,6,7],[5,7]],[[5,6,7,8],[5,6,7],[6,8]],[[5,6,7,8,9],[5,6,7,8],[5,7,9],[5,9]],[[6,8,10],[5,10]]],[,,,,,,,[[6,7]],[[6,7,8],[6,8]],[[6,7,8,9],[6,7,8],[6,9]],[[6,7,8,9,10],[6,8,10],[6,10]]],[,,,,,,,,[[7,8]],[[7,8,9],[7,9]],[[7,8,9,10],[8,10],[7,10],[7,9]]],[,,,,,,,,,[[8,9]],[[8,9,10],[8,10]]],[,,,,,,,,,,[[9,10]]]],G=[,[,,[1,2],[1,3],[1,4],[1,5,1,6],[1,6],[1,10,1,8,1,7],[1,8,1,10],[1,10,1,9]],[,,,[2,3],[2,4],[2,6,2,5],[2,6,2,8],[2,8,2,7],[2,8,1,10],[1,10,2,10,2,9],[1,10,2,10]],[,,,,[3,4,2,4],[3,6,3,5],[3,6,2,6],[2,8,3,8,3,7],[2,8,3,8,3,9],[2,10,3,10,3,9]],[,,,,,[4,5,4,6,3,5],[4,6],[4,8,4,7],[4,8],[4,10,4,9,3,9],[4,10]],[,,,,,[5,6,4,6],[5,7,4,8],[4,8,5,8,5,10],[5,10,4,10,5,9],[5,10,4,10]],[,,,,,,[6,7,6,8],[6,8],[6,10,5,10,6,9],[6,10,5,10]],[,,,,,,,[7,8,6,8],[7,9,6,10],[6,10,7,10]],[,,,,,,,,[8,10,8,9],[8,10]],[,,,,,,,,,[9,10]]];return d(),A={calculateTicksLogPositive:function(b,c,d,e,f,g,h,i,j){var k,l,n,o={};return isNaN(e)&&(e=null),isNaN(f)&&(f=null),c>d&&(k=c,c=d,d=k),null!==e&&null!==f&&e>f&&(k=e,e=f,f=k),this.plotSize=b,this.dataMin=c,this.dataMax=d,this.explicitPlotMin=e,this.explicitPlotMax=f,this.minTickSpacingInPixel=g,this.minIsStrict=null!==e,this.maxIsStrict=null!==f,this.usedDataMin=this.minIsStrict?e:c,this.usedDataMax=this.maxIsStrict?f:d,this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=b/g,this.maxNumTicks=this.maxNumIntervals+1,this.explicitPlotMinLog=this.minIsStrict?a.eliminateFloatingError(a.log10(e)):null,this.explicitPlotMaxLog=this.maxIsStrict?a.eliminateFloatingError(a.log10(f)):null,this.dataMinLog=a.eliminateFloatingError(a.log10(c)),this.dataMaxLog=a.eliminateFloatingError(a.log10(d)),i&&0!==b?this.minIsStrict&&this.maxIsStrict&&this.explicitPlotMin===this.explicitPlotMax?(p(o,[this.explicitPlotMin],this.explicitPlotMin,this.explicitPlotMax),o):(n=y.call(this),this.usedDataMax>=10*this.usedDataMin?n:(l=x.apply(this,[b,c,d,e,f,g,h,i,j]),l.mainTickValues.length<2?n:n.mainTickValues.length<2?l:l.mainTickValues.length===n.mainTickValues.length?(m.call(this,l),m.call(this,n),l.factor>n.factor?l:n):l.mainTickValues.length-1>=1.5*(n.mainTickValues.length-1)&&l.mainTickValues.length>n.mainTickValues.length?l:n)):z.call(this)},calculateTicks:function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p;if(isNaN(d)&&(d=null),isNaN(e)&&(e=null),b>c&&(j=b,b=c,c=j),null!==d&&null!==e&&d>e&&(j=d,d=e,e=j),b*c<=0&&(b=null===d?b:d,c=null===e?c:e),b>0&&c>0&&(null===d||d>0)&&(null===e||e>0))return k=A.calculateTicksLogPositive(a,b,c,d,e,f,g,h,i),k.sign=1,k;if(b<0&&c<0&&(null===d||d<0)&&(null===e||e<0)){for(l=A.calculateTicksLogPositive(a,-c,-b,null===e?null:-e,null===d?null:-d,f,g,h,i),k={},k.plotMin=-l.plotMax,k.plotMax=-l.plotMin,n=l.mainTickValues,o=n?n.length:0,m=new Array(o),p=0;p<o;p++)m[p]=-n[o-1-p];return k.mainTickValues=m,k.sign=-1,k}return{plotMin:null===d?b:d,plotMax:null===e?c:e,mainTickValues:[]}}}}),define("objects.views/charts/components/axis/log-scale",["core.utils/class","../../utils/scale-utils","../../utils/scale-log-utils"],function(a,b,c){var d=a.extend("LogScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(a){this._plotSize=a},getPositionOfValue:function(a){var c;return 0===a?this._usedDataMin>0?0:this._plotSize:(c=a>0?b.log10(a):-b.log10(-a),(c-this._plotMinLog10)/this._plotRangeLog10*this._plotSize)},getNormalizedValue:function(a){var c;return 0===a?this._usedDataMin>0?0:1:(c=a>0?b.log10(a):-b.log10(-a),(c-this._plotMinLog10)/this._plotRangeLog10)},getValueOfPosition:function(a){var b;return 0===a?0:(b=this._plotMinLog10+this._plotRangeLog10*a/this._plotSize,this._usedDataMin>0?Math.pow(10,b):-Math.pow(10,-b))},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin,this._plotMinLog10=b.log10(Math.abs(this.plotMin))*(this.plotMin<0?-1:1),this._plotMaxLog10=b.log10(Math.abs(this.plotMax))*(this.plotMax<0?-1:1),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10},calculateTicks:function(){var a;a=c.calculateTicks(this._calculationSize,this._usedDataMin,this._usedDataMax,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled),this.plotMin=a.plotMin,this.plotMax=a.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=a.tickMin,this.tickMax=a.tickMax,this.mainValues=a.mainTickValues,this.secondaryValues=[],this._dataSign=a.sign,this._tickSpacing=this.mainValues.length>1?this.mainValues[1]-this.mainValues[0]:this.plotMax-this.plotMin,this._plotMinLog10=this._dataSign*b.log10(Math.abs(this.plotMin)),this._plotMaxLog10=this._dataSign*b.log10(Math.abs(this.plotMax)),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10,0===this.mainValues.length&&this.mainValues.push(a.minTickValue),0===this._tickSpacing&&(this._tickSpacing=1)},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}});return d}),define("objects.views/charts/utils/tween",["core.utils/class","objects.utils/animation-frame"],function(a,b){"use strict";function c(){i.tick()&&(j=b.request(c))}function d(a){k.push(a),a._isRunning=!0,null===j&&(j=b.request(c))}function e(a,b){for(var c in a)this._props[c]||(this._props[c]={}),this._props[c][b]=Array.isArray(a[c])?a[c].slice():a[c]}function f(){var a,b,c,d;for(a in this._props)if(d=this._props[a],b="from"in d?d.from:this._target[a],c=d.to,d.from=b,Array.isArray(b)){var e=b.map(function(a){return a.value}),f=c.map(function(a){return a.value});d.fresh=c.filter(function(a){return e.indexOf(a.value)<0}),d.rotten=b.filter(function(a){return f.indexOf(a.value)<0}),d.ripe=c.filter(function(a){return e.indexOf(a.value)>=0}),d.combined=d.rotten.concat(d.ripe).concat(d.fresh),d.isArray=!0}else isNaN(b)||isNaN(d.to)||(d.change=d.to-b)}function g(a){var b;for(b in a)if(a[b].isArray){if(a[b].fresh.length||a[b].rotten.length)return!0}else if(a[b].change)return!0;return!1}function h(a,b,c){var d,e,f,g,h,i,j;for(e in a){if(f=a[e],g=f.to,h=f.from,f.isArray){for(i=f.fresh,j=f.rotten,f.value=c?f.to:f.combined,d=0;d<i.length;d++)i[d].opacity=b;for(d=0;d<j.length;d++)j[d].opacity=1-b;c&&(delete f.combined,delete f.fresh,delete f.rotten,delete f.ripe)}else!c&&"change"in f?f.value=h+f.change*b:f.value=g;c&&delete a[e].from}}var i,j=null,k=[],l=!0,m=Math.PI,n=Math.cos;i=a.extend("Tween",{init:function(a,b,c,e){var h,j,k,l={},m=!0;this._target=a,this._enabled=!0;for(h in b)j=Array.isArray(a[h])?a[h].slice():a[h],k=Array.isArray(b[h])?b[h].slice():b[h],l[h]={from:j,to:k};this._props=l,f.call(this),"object"==typeof c?(this._duration=c.duration||200,this._easing="function"==typeof c.easing?c.easing:i.easing[c.easing||"linear"],m=c.autoStart!==!1):(this._duration=c||200,this._easing="function"==typeof e?e:i.easing[e||"linear"]),this._dfd=new o,this._pos=0,this._isRunning=!1,m&&(g(this._props)?(this._startTime=Date.now(),d(this)):this._step(!0))},from:function(a){return this._isRunning||e.call(this,a,"from"),this},to:function(a){return this._isRunning||e.call(this,a,"to"),this},start:function(){return!this._isRunning&&this._enabled&&l&&(f.call(this),g(this._props)?this._start():this._dfd.resolve()),
this},willStart:function(){return!(this._isRunning||!this._enabled||!l||(f.call(this),!g(this._props)))},stop:function(){return this._isRunning&&(this._isRunning=!1,k.splice(k.indexOf(this),1)),this},end:function(){return this._isRunning&&this._step(!0),this},then:function(){return this._dfd.then.apply(this._dfd,[].slice.call(arguments)),this},progress:function(){return this._dfd.progress.apply(this._dfd,[].slice.call(arguments)),this},isRunning:function(){return this._isRunning},on:function(){this._enabled=!0},off:function(){this._enabled=!1},destroy:function(){this.stop(),this._dfd.destroy()},_update:function(){var a;for(a in this._props)this._target[a]=this._props[a].value},_step:function(a){var b,c=Date.now()-this._startTime;return c>=this._duration||a?(this._pos=1,this._isRunning=!1,b=k.indexOf(this),b>=0&&k.splice(b,1),h(this._props,this._pos,!0),this._update(),this._dfd.notify(c,c/this._duration,this._pos),void this._dfd.resolve()):(this._pos=this._easing(c/this._duration),h(this._props,this._pos,!1),this._update(),void this._dfd.notify(c,c/this._duration,this._pos))},_start:function(){this._startTime=Date.now(),d(this),this._step()}}),i.off=function(){l=!1},i.on=function(){l=!0},i.tick=function(){var a,c,d=k.slice(),e=d.length;for(a=0;a<e;a++)c=d[a],c._step();return!!k.length||(b.cancel(j),j=null,!1)},i.clear=function(){},i.easing={linear:function(a){return a},easeInOut:function(a){return.5*(1-n(a*m))}},i.tweens=k;var o=function(){this._onSuccess=[],this._onProgress=[],this._isResolved=!1};return o.prototype={then:function(a){this._onSuccess.push(a),this._isResolved&&a.call(null,[].slice.apply(arguments))},progress:function(a){this._onProgress.push(a)},resolve:function(){this._isResolved=!0;var a,b=this._onSuccess.length;for(a=0;a<b;a++)this._onSuccess[a].apply(null,[].slice.call(arguments))},notify:function(){var a,b=this._onProgress.length;for(a=0;a<b;a++)this._onProgress[a].apply(null,[].slice.call(arguments))},destroy:function(){this._onSuccess=[],this._onProgress=[]}},i}),define("objects.views/charts/components/axis/continuous-axis",["./axis","./linear-scale","./time-scale","./log-scale","objects.views/charts/components/axis/radial-axis-helper","util","objects.views/charts/utils/tween","general.utils/shapes/rect","general.utils/shapes/polygon"],function(a,b,c,d,e,f,g){"use strict";function h(a){var b=Math.round(a);return b-a>=0?b-.5:b+.5}function i(a){var b,c,d=[],e=a?a.length:0;for(b=0;b<e;b++)c=a[b],d.push({position:0,value:c,opacity:1});return d}function j(a,b){var c,d,e,f=a?a.length:0,g=[],i=[],j=[],k=[],l=[],m=[];if(a.forEach(function(a){d=this.getPositionOfValue(a.value),d=h(d),k.push(d),j.push(a.value),l.push("opacity"in a?a.opacity:1),g.push(a.value+""),i.push(a.qualifiedLabel)},this),f<=1)m=[this._plotSize];else if(b){for(e=this.yMirrorMode?this._padding.left+this._plotSize-k[0]:k[0],m[0]=Math.abs(k[1]-k[0])+e,c=1;c<a.length-1;c++)m.push(Math.abs(k[c]-k[c-1]));m[c]=this.yMirrorMode?k[c]:this._padding.left+this._plotSize-k[c]}else{for(e=this.yMirrorMode?this._padding.left+this._plotSize-k[0]:k[0],m[0]=Math.abs(k[1]-k[0])/2+e,c=1;c<a.length-1;c++)m.push(Math.abs(k[c]-k[c-1])/2+Math.abs(k[c+1]-k[c])/2);e=this.yMirrorMode?k[c]:this._padding.left+this._plotSize-k[c],m[c]=Math.abs(k[c]-k[c-1])/2+e}return{values:j,widths:m,positions:k,opacities:l,labels:g,labelMode:u,labelSpace:this._wantedLabelSpacePerLevel,qualifiedLabels:i[0]?i:null,labelsBetweenTicks:b}}function k(a,b){var c,d,e=0,f=a[this._isVertical?"height":"width"],g=0,h=this._style;if(f-=this._isVertical?this._padding.top+this._padding.bottom:this._padding.left+this._padding.right,this.isRadial())e=2*Math.sin(this._relevantAngle/4)*this._fontHeight*h.label.lineHeight;else if(this._isVertical){if(this._calculateScale(f),c=this._formatter,d=this._renderer,c){var i=this._scale.getValues().mainValues.map(function(a){return d.getTextWidth(c.formatValue(a)+"ml",h.label.font)});g=Math.max.apply(null,i.length?i:[0])}e=Math.min(b[this._isVertical?"width":"height"]/3,g<this.outerRect.width/2?g:this.outerRect.width/3)}else if(e=this._fontHeight*h.label.lineHeight,this._explicitLabels.length>0||this._useTimeScaling)return this._wantedLabelSpacePerLevel=e,e*=2;return this._wantedLabelSpacePerLevel=e,e}function l(a,b,c,d){for(var e=c.length*d,f=0,g=a._formatter,h=a._renderer,i=a._style.label.font,j=0,k=0;k<c.length;k++)if(b[k]<v?f++:b[k]<w&&g&&(j=h.getTextWidth(g.formatValue(c[k]),i),j>b[k]-2*a._labelPadding&&f++),f>e)return!1;return!0}function m(a,b){var c;for(c=0;c<a.length;++c){var d=a[c],e=l(b,d.widths,d.labels,.1);if(e)break;var f=1.1,g=d.widths.map(function(a){return a*f}),h=l(b,g,d.labels,.1);if(h){++c;break}}if(b.indicators=c>0&&c<a.length?a[c-1]:null,b.indicators){var i=p.call(b,b.indicators.positions),j=p.call(b,a[c].positions);i<x||j<y?b.indicators=null:b._snapTicksAvgWidth=i}return a.slice(c,c+2)}function n(a,b){var c=a.map(function(a){var c,d,e=a.qTicks,f=[],g=[],i=[],j=[],k=[],l=[],m=!0;return e.forEach(function(a){c=a.qStart,f.push(c),j.push(b.isLabelSelected(a.qStart,a.qEnd)?1:b._globalAlpha),k.push(a.qText),l.push(a.qualifiedText),d=b.getPositionOfValue(c),g.push(Math.abs(d-b.getPositionOfValue(a.qEnd))),d=h(d),i.push(d),a.qStart!==a.qEnd-1&&(m=!1)}),e.length>0&&(c=e[e.length-1].qEnd,f.push(c),d=b.getPositionOfValue(c),d=h(d),i.push(d)),{align:b.yMirrorMode?"right":"left",labelsBetweenTicks:!0,values:f,widths:g,positions:i,opacities:j,labels:k,qualifiedLabels:l[0]?l:null,labelMode:u,labelSpace:b._wantedLabelSpacePerLevel,dayLevel:m,rangeLabels:!0,explicitLabels:!0}});return c=m(c,b)}function o(a){var b,c,d,e,f,g=[];for(b=0;b<a.length;b++)for(e=a[b].qTicks,c=0;c<a.length;c++)f=a[c].qTicks,b!==c&&e[0]&&f[0]&&"string"!=typeof e[0].qualifiedText&&"string"!=typeof f[0].qualifiedText&&e.length===f.length&&(d=e.every(function(a,b){return a.qStart===f[b].qStart&&a.qEnd===f[b].qEnd}),d&&(a[b].qTags.contains("$qualified")?(f.forEach(function(a,b){a.qualifiedText=e[b].qText}),g.push(b)):(e.forEach(function(a,b){a.qualifiedText=f[b].qText}),g.push(c))));g.sort(function(a,b){return b-a}),g.forEach(function(b){a.splice(b,1)})}function p(a){return!a||a.length<2?this._plotSize:Math.abs(a[a.length-1]-a[0])/(a.length-1)}function q(){var a=/t+/gi.test(this._formatter.localeInfo.qTimestampFmt);this._timeformatPatterns.minuteLevel=a?"h:mm tt":"hh:mm",this._timeformatPatterns.secondLevel=a?"h:mm:ss tt":"hh:mm:ss"}function r(){this._levelFormattingPatterns=[],this._labelGranularity===A.YEAR?this._levelFormattingPatterns.push("YYYY"):this._labelGranularity===A.DATE?this._levelFormattingPatterns.push(this._formatter.localeInfo.qDateFmt):this._labelGranularity===A.MINUTE?this._levelFormattingPatterns.push(this._timeformatPatterns.minuteLevel):this._labelGranularity===A.SECOND&&this._levelFormattingPatterns.push(this._timeformatPatterns.secondLevel),this._levelFormattingPatterns.push(this._formatter.localeInfo.qDateFmt)}function s(a,b){var c=b/a,d=3*c*30,e=c/2,f=c/24/60/2;f>this._approxLabelWidths.second?this._labelGranularity=A.SECOND:e>this._approxLabelWidths.minute?this._labelGranularity=A.MINUTE:d>this._approxLabelWidths.date?this._labelGranularity=A.DATE:this._labelGranularity=A.YEAR}var t,u=1,v=30,w=150,x=5,y=80,z=60,A={YEAR:1,DATE:2,MINUTE:3,SECOND:4},B={autoStart:!1,duration:500,easing:"easeInOut"},C={onProgress:function(){this._updateTickPositions(),this.invalidateDisplay(),this.fire("changed")},on:function(){this._tickTween.on(),this._linearTween.on()},off:function(){this._tickTween.off(),this._linearTween.off()},to:function(){this._linearTween.stop().to({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().to({ticks:this.ticks})},from:function(){this._linearTween.stop().from({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().from({ticks:this.ticks})},start:function(){this._scale!==this._linearScale&&this._scale!==this._timeScale||this._linearTween.willStart()&&(this._tickTween.start(),this._linearTween.start())},end:function(){this._scale!==this._linearScale&&this._scale!==this._timeScale||(this._tickTween.end(),this._linearTween.end())},stop:function(){this._tickTween.stop(),this._linearTween.stop()}};return t=a.extend("ContinuousAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._scaleDetails={showExplicitMinMax:!0,niceNumberEnabled:!0,tickMultiplier:1},this.ticks=[],this.minorTicks=null,this._tickDates=[],this._minorTickDates=[],this._explicitLabels=[],this._defaultFormatter={formatValue:function(a){return String(a)},format:function(a){return String(a)}},this._formatter=this._defaultFormatter,this._useLogScaleIfPossible=!1,this._linearScale=new b,this._timeScale=new c,this._logarithmicScale=new d,this._scale=this._linearScale,this._cacheItems=null,this._useTransition=!1,this._selectedRanges=[],this._approxLabelWidths=null,this._useTimeScaling=!1,this._levelFormattingPatterns=["YYYY","YYYY-mm-yy"],this._labelGranularity=A.YEAR,this._timeformatPatterns={minuteLevel:"hh:mm",secondLevel:"hh:mm:ss"},this._linearTween=new g(this._linearScale,{},B).progress(C.onProgress.bind(this)),this._tickTween=new g(this,{},B)},setSelectableShapes:function(a){this._cacheItems=a},getDiscreteSpacing:function(){return 4},updateSize:function(){this._super(),this._calculationSize=this._plotSize,this._updateScaleAndTicks(),this._scale.setSize(this._plotSize),this._updateTickPositions(),C.to.call(this),this._changed?(this._changed=!1,C.start.call(this)):C.end.call(this)},getPlotSize:function(){return this._plotSize},calculateValuePositionMappingInfo:function(){this._scale.setSize(this._plotSize),this._scale._calculationSize=this._plotSize,this._scale.calculateLimits()},setUseTransition:function(a){this._super(a),C[a?"on":"off"].call(this)},preRelevantSizeCalculation:function(){this._super(),this._areLabelsVisible=this.isVisible(this._layoutMode)&&this._showLabels},calculatePreliminaryLabelSpace:function(a){var b=0;return this._areLabelsVisible&&(b=k.call(this,a,a)),{relevantLabelSize:b||0,relevantSpacing:0}},calculateLabelSpace:function(a,b,c){var d=0;return this._calculateScale(this._calculationSize),this._areLabelsVisible&&(d=k.call(this,c||a,a)),{relevantLabelSize:d||0,relevantSpacing:0}},_generateExplicitLabels:function(){var a=!1;return this._explicitLabels.length&&(this._levels=n(this._explicitLabels,this),this._levels.length&&(this._useTimeScaling&&this._calculationSize/(this._scaleDetails.explicitPlotMax-this._scaleDetails.explicitPlotMin)/2>this._approxLabelWidths.minute&&this._generateTimeTicks(),a=!0,this._levels.length>1&&(this._levels[1].qualifiedLabels&&(this._levels[1].labels=this._levels[1].qualifiedLabels),this._levels[1].outOfSyncWithLevelBelow=!this._levels[1].dayLevel&&!this._levels[1].values.every(function(a){return a<this._scale._dataMin||a>this._scale._dataMax||this._levels[0].values.indexOf(a)>-1}.bind(this))),this.ticks=i.call(this,this._levels[0].values,this._padding,this._plotSize),this.minorTicks=[],this._levels.length>1&&(this.minorTicks=this.ticks.filter(function(a){return this._levels[1].values.indexOf(a.value)===-1},this),this.ticks=this.ticks.filter(function(a){return this._levels[1].values.indexOf(a.value)!==-1},this)))),a},_updateLabelPositions:function(){for(var a=0;a<this._levels.length;++a)for(var b=this._levels[a],c=0;c<b.values.length;++c){var d=b.values[c],e=this.getPositionOfValue(d);if(b.positions[c]=h(e),c<b.values.length-1){var f=this.isLabelSelected(d,b.values[c+1]);b.opacities[c]=f?1:this._globalAlpha}}},_updateTickPositions:function(){var a,b,c;for(c=0;c<this.ticks.length;c++)a=this.getPositionOfValue(this.ticks[c].value),b=Math.round(a),this.ticks[c].position=b-a>=0?b-.5:b+.5;for(c=0;c<this.minorTicks.length;c++)a=this.getPositionOfValue(this.minorTicks[c].value),b=Math.round(a),this.minorTicks[c].position=b-a>=0?b-.5:b+.5;if(this.useExplicitLabels?(this._updateLabelPositions(),this._levels[0].formatPattern=this._levelFormattingPatterns[0]):this._useTimeScaling?(this._levels=[j.call(this,this.minorTicks,!0)],this._levels[0].labelsBetweenTicks=!0,this._levels[0].align=this.yMirrorMode?"right":"left",this._levels[0].dates=this._minorTickDates,this._levels[0].formatPattern=this._levelFormattingPatterns[0],this.ticks.length&&(this._levels.push(j.call(this,this.ticks,!0)),this._levels[1].labelsBetweenTicks=!0,this._levels[1].align=this.yMirrorMode?"right":"left",this._levels[1].dates=this._tickDates,this._levels[1].formatPattern=this._levelFormattingPatterns[1])):this._levels=[j.call(this,this.ticks,!1)],this._updateTickFormatting(this._levels,this._formatter),this.indicators)for(c=0;c<this.indicators.positions.length;c++)a=this.getPositionOfValue(this.indicators.values[c]),b=Math.round(a),this.indicators.positions[c]=b-a>=0?b-.5:b+.5;this._snapTicksAvgWidth=p.call(this,this.indicators?this.indicators.positions:this._levels[0].positions),this.show&&this.fire("changed")},_generateTimeTicks:function(){var a,b=this._scale.getValues(),c=b.secondaryValues,d=b.secondaryDates,e=[];for(a=0;a<c.length;a++)e.push({position:0,value:c[a],opacity:1,label:c[a]});var f=j.call(this,e,!0);f.labelsBetweenTicks=!0,f.align=this.yMirrorMode?"right":"left",f.dates=d,this._levels.splice(1),this._levels.unshift(f)},_calculateScale:function(a){if(0!==a){var b,c=this._scaleDetails,d=isNaN(c.realDataMin)?c.dataMin:c.realDataMin,e=isNaN(c.realDataMax)?c.dataMax:c.realDataMax,f=isNaN(c.explicitPlotMin)||null===c.explicitPlotMin?d:c.explicitPlotMin,h=isNaN(c.explicitPlotMax)||null===c.explicitPlotMax?e:c.explicitPlotMax;b=this.isRadial()?96:this._useTimeScaling?Math.max(z,this._getApproximateLabelWidth(f,h,this._levelFormattingPatterns[0])+this._labelPadding):Math.max(96,this._getApproximateLabelWidth(f,h));var i=this.isVertical()?4*this._fontHeight:b,j=Math.max(2,a/i/c.tickMultiplier+1);i=a/(j-1),this._useLogScaleIfPossible&&f*h>0&&d*e>0?this._scale=this._logarithmicScale:this._useTimeScaling?this._useTimeScaling&&this._scale!==this._timeScale&&(this._scale=this._timeScale,this._linearTween.destroy(),this._linearTween=new g(this._timeScale,{},B).progress(C.onProgress.bind(this))):this._scale=this._linearScale,c.usedDataMin=d,c.usedDataMax=e,c.minTickSpacingInPixel=i,c.plotSize=this._plotSize,c.calculationSize="undefined"!=typeof a?a:this._calculationSize,c.fontHeight=this._fontHeight,this._useTimeScaling&&(c.showExplicitMinMax=!1),Object.keys(c).forEach(function(a){this._scale["_"+a]=c[a]},this),this._scale.calculateTicks(this._approxLabelWidths)}},_getApproximateLabelWidth:function(a,b,c){var d=this._formatter,e=this._renderer,f=this._style.label.font;return d?Math.max.apply(null,[a,b,(b-a)/2].map(function(a){return e.getTextWidth(d.formatValue(a,c),f)})):0},_generateTickObjects:function(a,b){if(this.useExplicitLabels=this._generateExplicitLabels(),!this.useExplicitLabels){var c=a.getValues();this.ticks=i.call(this,c.mainValues,this._padding,b),this.minorTicks=i.call(this,c.secondaryValues,this._padding,b),this._tickDates=c.mainDates,this._minorTickDates=c.secondaryDates}},_updateTickFormatting:function(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(!a[c].explicitLabels)for(e=a[c].dates&&a[c].values.length!==a[c].dates.length,f=a[c].dates&&a[c].dates.length&&!e,d=0;d<a[c].values.length;d++)f?a[c].labels[d]=b._dateFormatter.format(a[c].dates[d],a[c].formatPattern):a[c].labels[d]=b.formatValue(a[c].values[d])},setPlotMin:function(a){this._scaleDetails.explicitPlotMin="number"==typeof a?a:null,this.invalidateProperties("setPlotMin")},getPlotMin:function(){return this._scale.plotMin},setPlotMax:function(a){this._scaleDetails.explicitPlotMax="number"==typeof a?a:null,this.invalidateProperties("setPlotMax")},getPlotMax:function(){return this._scale.plotMax},setTickMultiplier:function(a){this._scaleDetails.tickMultiplier=a||1,this.invalidateProperties("setTickMultiplier")},setSpacingMode:function(a){this._scaleDetails.spacingMode=a,this.invalidateProperties("setSpacingMode")},getSpacingMode:function(){return this._scaleDetails.spacingMode},setShowExplicitMinMax:function(a){this._scaleDetails.showExplicitMinMax=a,this.invalidateProperties("setShowExplicitMinMax")},setLogScale:function(a){this._useLogScaleIfPossible=a,this.invalidateProperties("setLogScale")},getLogScale:function(){return this._scale===this._logarithmicScale},numberFormat:function(a,b){return this._discrete?a:f.numberFormat(a,b?b:this._precision,this._exponentUsed)},format:function(a){return this._discrete||!this._formatter?a+"":this._formatter.format(a,this._formatPattern)},formatValue:function(a){if(this._discrete||!this._formatter)return a+"";var b="YYYY"===this._levels[0].formatPattern?void 0:this._levels[0].formatPattern;return this._formatter.formatValue(a,b)},_transition:function(){this._onAnimatitonEnd()},setDataRangeTransition:function(a){this._transitionEnabled=a},setDataRange:function(a,b){return this._scaleDetails.dataMin=a,this._scaleDetails.dataMax=b,this.invalidateDisplay("setDataRange"),this.invalidateProperties("setDataRange"),this},setRealDataRange:function(a,b){this._scaleDetails.realDataMin=a,this._scaleDetails.realDataMax=b,this.invalidateProperties("setRealDataRange")},getDataMin:function(){return this._scaleDetails.dataMin},getDataMax:function(){return this._scaleDetails.dataMax},setNiceNumberEnabled:function(a){this._scaleDetails.niceNumberEnabled!==a&&(this._scaleDetails.niceNumberEnabled=a,this.invalidateProperties("setNiceNumberEnabled"))},setWhiteSpaceOptimizingEnabled:function(a){this._scaleDetails.whiteSpaceOptimizingEnabled=a,this.invalidateProperties("setWhiteSpaceOptimizingEnabled")},getLevels:function(){return this._levels},setLabels:function(a){this._explicitLabels=f.extend(!0,[],a).reverse(),o(this._explicitLabels)},updateFormatter:function(){if(this.isDimension)this._formatter=this.dimensionFormatter||this._defaultFormatter;else{var a=this.getType().indices;this._formatter=1===a.length&&this.measureFormatters.length?this.measureFormatters[a[0]]:this.combinedMeasuresFormatter||this._defaultFormatter}if(this._formatter.prepare&&this._formatter.prepare(),this.isDimension&&["D","TS","T"].contains(this._formatter.type)){this._useTimeScaling=!0,q.call(this);var b=41000.2343433;this._approxLabelWidths={year:Math.max(z,this._renderer.getTextWidth(this._formatter.formatValue(b,"YYYY"),this._style.label.font)+this._labelPadding+20),date:Math.max(z,this._renderer.getTextWidth(this._formatter.formatValue(b,this._formatter.localeInfo.qDateFmt),this._style.label.font)+this._labelPadding+20),minute:Math.max(z,this._renderer.getTextWidth(this._formatter.formatValue(b,this._timeformatPatterns.minuteLevel),this._style.label.font)+this._labelPadding+20),second:Math.max(z,this._renderer.getTextWidth(this._formatter.formatValue(b,this._timeformatPatterns.secondLevel),this._style.label.font)+this._labelPadding+20)}}},_onAnimatitonEnd:function(){this._super(),this.rect.width>0&&this.calculateLabelSpace(this.rect)},_updateProperties:function(){C.from.call(this),this._changed=this._oldIsVertical===this.isVertical()&&"number"==typeof this._scale.plotRange&&!isNaN(this._scale.plotRange),this._oldIsVertical=this.isVertical(),this.updateFormatter(),this._isSizing||this._updateScaleAndTicks()},_updateScaleAndTicks:function(){this._useTimeScaling&&(s.call(this,this._scaleDetails.explicitPlotMax-this._scaleDetails.explicitPlotMin,this._scaleDetails.calculationSize),r.call(this)),this._calculateScale(this._calculationSize),this._generateTickObjects(this._scale,this._plotSize),this._updateTickPositions()},clear:function(){this._linearTween.end(),this._tickTween.end(),this._super()},getWidthOfValue:function(){return 1},getSnapTicksAvgWidth:function(){return this._snapTicksAvgWidth},getPositionOfValue:function(a){var b,c=this._scale.plotMin,d=this._scale.plotRange;return b=0===d?a>c?100*this._plotSize:a<c?100*-this._plotSize:this._plotSize/2:this._scale.getPositionOfValue(a),(this._isVertical&&!this._reverse||!this._isVertical&&(this._reverse||this.yMirrorMode))&&(b=this._plotSize-b),b+this._padding[this._isVertical?"top":"left"]},getNormalizedValue:function(a){var b=this._scale.plotMin,c=this._scale.plotRange;return 0===c?a>b?1:a<b?0:.5:this._scale.getNormalizedValue(a)},getPositionOfNormalizedValue:function(a){var b=this._scale.plotMin,c=this._scale.plotMax;return this.getPositionOfValue(a*(c-b)+b)},getValueOfPosition:function(a){return this._plotSize<=0?NaN:(a-=this._padding[this._isVertical?"top":"left"],(this._isVertical&&!this._reverse||!this._isVertical&&(this._reverse||this.yMirrorMode))&&(a=this._plotSize-a),this._scale.getValueOfPosition(a))},getAngleOfValue:function(a){return e.getAngleOfNormalizedValue((a-this._scale.plotMin)/(this._scale.plotMax-this._scale.plotMin),this)},getAngleOfNormalizedValue:function(a){return e.getAngleOfNormalizedValue(a,this)},isLabelSelected:function(a,b){return this._selectedRanges.some(function(c){return c.min<=a&&c.max>=b})},setSelectedRanges:function(a){this._selectedRanges=a,this._updateTickPositions()},getLabelFromPoint:function(a){if(this.isVertical())return null;var b=1,c="far"===this.getAlignment()?1:-1,d=(b+this._style.label.margin)*c,e="near"===this.getAlignment()?this.rect.height-1:0;e+=d;for(var f=null,g=0;g<this._levels.length;++g)if(e+=this._levels[g].labelSpace*c,a.y*c<e*c){f=this._levels[g];break}if(!f)return null;for(g=0;g<f.labels.length;++g){var h=f.positions[g],i=f.positions[g+1],j=a.x>=h&&a.x<i||a.x<=h&&a.x>i;if(j)return{label:f.labels[g],start:f.values[g],end:f.values[g+1]}}return null}})}),define("objects.views/charts/components/legend/legend-data",["objects.views/charts/utils/canvas-renderer"],function(a){function b(a){return a.label?a.label:a.min&&a.max?a.min+" - "+(a.isMax?"":"<")+a.max:a.max?"<"+a.max:">"+a.min}function c(a){for(var b=0;a&&a.parent;)b++,a=a.parent;return b}function d(a,b,d){var e={};if(a){var f,g,h,i,j=a.length,k=c(a[0])-b;for(f=0;f<j;f++)if(h=a[f]){for(g=0;g<k&&h.parent;)h=h.parent,g--;i=!isNaN(d)&&d>=0?h.getAttributeDimensions(d):h.id,e[i]?e[i].push(a[f]):e[i]=[a[f]]}}return e}function e(c,e,f,g,m,n,q){var r,s,t,u,v,w,x=[],y=0,z=i,A=Math.min(p,c.length);n=n||0,w=d(e,n,q),f=f||{font:"13px 'QlikView Sans'"},v=a.getAverageLetterWidth(f.font)*l,g>(v+h)*c.length&&(v=g/c.length-h-o);var B={type:"text",fill:0,opacity:1,shape:{text:null,font:f.font,maxWidth:v,align:"left",baseline:"middle",maxNumLines:2}};for(r=0;r<A;r++){var C=c[r];s=C.color.toHex(),B.shape.text=b(C);var D=a.measureTextObject(B);D.height=Math.ceil(D.height),y=Math.max(y,D.width),z=Math.max(z,D.height),"range"===C.type?x.push({text:D.lines.join(" "),height:Math.max(D.height,i)*m,tipText:C.label,marker:"rect",color:s,isDimensionValue:!0,locked:!1,id:C.id,index:C.index,isMax:C.isMax,type:C.type}):x.push({text:D.lines.join(" "),tipText:C.label,height:Math.max(D.height,i)*m,marker:C.marker||"rect",color:s,isDimensionValue:!0,locked:!1,id:C.id,index:C.index,cacheItems:w[C.id],type:C.type})}return t=z,u=Math.max(y+h,j),{viewItems:x,cellHeight:t,cellWidth:u+o+2*k}}function f(b,c,d){var e,f=[],g=0;for(a.setFont(c.font),e=b.length-1;e>=0;e--){var h=b[e],i={colorFrom:h.grad[0].toHex(),colorTo:h.grad[1].toHex(),maxText:d.formatValue(h.max),minText:d.formatValue(h.min),max:h.id[0],min:h.id[1]};f.push(i),g=Math.max(g,a.getTextWidth(i.maxText.substr(0,n)),a.getTextWidth(i.minText.substr(0,n)))}return{viewItems:f,labelHeight:a.getFontHeight(c.font),maxLabelWidth:g+1}}function g(b,c){var d=a.getAverageLetterWidth(c.font)*m,e={type:"text",fill:0,opacity:1,shape:{text:b,font:c.font,maxWidth:d,align:"left",baseline:"middle",maxNumLines:2}},f=a.measureTextObject(e);return{text:f.lines.join(" "),fullText:b,height:f.height,width:f.width+o}}var h=26,i=26,j=54,k=4,l=20,m=15,n=10,o=1,p=100;return{prepareDiscreteData:e,prepareContinousData:f,prepareLegendTitle:g,Modes:{DISCRETE:"discrete",CONTINOUS:"continous"},constants:{PADDING:k}}}),define("objects.views/charts/components/chart-component-angular",["jquery","qvangular","./chart-component"],function(a,b,c){"use strict";var d;return d=c.extend({init:function(c,d,e,f){this._super(c,d,e);var g=b.getService("$compile");this._innerContainer=a(f).appendTo(a(this.container)),g(this._innerContainer)(a(this.container).scope().$new()),this._innerScope=this._innerContainer.scope()},getInnerContainer:function(){return this._innerContainer},setYMirrorMode:function(a){this._super(a),this._innerScope.options.direction=this.readDirection},getInnerContainerScope:function(){return this._innerScope},release:function(){this._super(),this._innerContainer.remove(),this._innerContainer=null,this._innerScope.$destroy(),this._innerScope=null}})}),define("text!objects.views/charts/components/legend/color-legend.ng.html",[],function(){return'<div qva-direction x-dir-setting="{{options.yMirrorMode ? \'rtl\' : \'ltr\'}}" class="color-legend">\n    <div qv-discrete-legend\n         ng-if="discrete && visible"\n         view-items="viewItems"\n         options="options">\n    </div>\n\n\t<div qv-continous-legend\n\t\t ng-if="!discrete && visible"\n\t\t view-items="viewItems"\n\t\t options="options"></div>\n</div>\n'}),/**
 * @preserve IntegraXor Web SCADA - JavaScript Number Formatter
 * http://www.integraxor.com/
 * author: KPL, KHL
 * (c)2011 ecava
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
define("assets/external/numberformatter/format",[],function(){return function(a,b){if(!a||isNaN(+b))return b;var b="-"==a.charAt(0)?-b:+b,c=b<0?b=-b:0,d=a.match(/[^\d\-\+#]/g),e=d&&d[d.length-1]||".",f=d&&d[1]&&d[0]||",",a=a.split(e);b=b.toFixed(a[1]&&a[1].length),b=+b+"";var g=a[1]&&a[1].lastIndexOf("0"),h=b.split(".");(!h[1]||h[1]&&h[1].length<=g)&&(b=(+b).toFixed(g+1));var i=a[0].split(f);a[0]=i.join("");var j=a[0]&&a[0].indexOf("0");if(j>-1)for(;h[0].length<a[0].length-j;)h[0]="0"+h[0];else 0==+h[0]&&(h[0]="");b=b.split("."),b[0]=h[0];var k=i[1]&&i[i.length-1].length;if(k){for(var l=b[0],m="",n=l.length%k,o=0,p=l.length;o<p;o++)m+=l.charAt(o),!((o-n+1)%k)&&o<p-k&&(m+=f);b[0]=m}return b[1]=a[1]&&b[1]?e+b[1]:"",(c?"-":"")+b[0]+b[1]}}),define("objects.utils/number-formatter",["core.utils/class","util","assets/external/numberformatter/format"],function(a,b,c){"use strict";function d(a,b,c,d){return a=a.toString(b),c[1]===c[1].toUpperCase()&&(a=a.toUpperCase()),a.length-a.indexOf(".")>10&&(a=a.slice(0,a.indexOf(".")+11)),a.replace(".",d||".")}function e(a,b,c){var e;return m.test(b)?a=d(a,Number(/\d{2}/.exec(b)[0]),b,c):n.test(b)?a=d(a,8,b,c):o.test(b)?a=d(a,10,b,c):p.test(b)?a=d(a,16,b,c):q.test(b)?a=d(a,2,b,c):r.test(b)&&(e="",a<0&&(e="-",a=-a),a=Math.floor(a),0===a?a="0":a<=5e5?(a=f(a,b),a=e+a):a=b+e+a.toExponential(0)),a}function f(a,b){for(var c,d="",e=Number(String(a).slice(-3)),f=(a-e)/1e3,g=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),h=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();e>0;)for(c=0;c<g.length;c++)if(g[c]<=e){d+=h[c],e-=g[c];break}for(c=0;c<f;c++)d="M"+d;return b[1]!==b[1].toUpperCase()&&(d=d.toLowerCase()),d}function g(a,b,c){var d,e,f,g,j,k,m,n,o,p=a.pattern;p.indexOf("A")>=0&&(p=p.replace("A",""),a.abbreviate=!0),o=i(b,c),f=p.match(o),f=f?f[0]:"",g=f?p.substr(0,p.indexOf(f)):p,j=f?p.substring(p.indexOf(f)+f.length):"",f||(f=p?"#":"##########"),b&&b===c&&(d=f.split(c),e=d.pop(),f=d.join("")+c+e,b=""),k=b,b=/,/.test(c)?"":",",k&&(f=f.replace(h(k,"g"),b)),m=c,c=".",m&&(f=f.replace(h(m,"g"),c)),n=f.match(/#/g),n=n?n.length:0,a.prefix=g||"",a.postfix=j||"",a.pattern=p,a.percentage=l.test(p),a.numericPattern=f||"",a.numericRegex=new RegExp(h(b,null,!0)+"|"+h(c,null,!0),"g"),a.groupTemp=k,a.decTemp=m,a.t=b,a.d=c,a.temp=n}function h(a,c,d){var e=b.escapeRegExp(a);return d?e:new RegExp(e||"",c)}function i(a,c){return c&&(c=b.escapeRegExp(c)),a&&(a=b.escapeRegExp(a)),new RegExp("(?:[#0]+"+a+")?[#0]+(?:"+c+"[#0]+)?")}var j,k={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},l=/%$/,m=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,n=/^\(oct\)/i,o=/^\(dec\)/i,p=/^\(hex\)/i,q=/^\(bin\)/i,r=/^\(rom\)/i,s=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i;return j=a.extend("NumberFormatter",{init:function(a,b,c,d,e){this.localeInfo=a,this.pattern=b,this.thousandDelimiter=c||",",this.decimalDelimiter=d||".",this.type=e||"numeric",this.prepare()},clone:function(){var a=new j(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);return a.subtype=this.subtype,a},format:function(a,b,c,d){return this.prepare(b,c,d),this.formatValue(a)},prepare:function(a,b,c){var d,e;return"undefined"==typeof a&&(a=this.pattern),"undefined"==typeof b&&(b=this.thousandDelimiter),"undefined"==typeof c&&(c=this.decimalDelimiter),a?(this._prepared={positive:{d:c,t:b,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},negative:{d:c,t:b,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""}},d=this._prepared,a=a.split(";"),d.positive.pattern=a[0],d.negative.pattern=a[1],s.test(a[0])&&(d.positive.isFunctional=!0),a[1]?s.test(a[1])&&(d.negative.isFunctional=!0):d.negative=!1,e=d.positive.isFunctional&&(!d.negative||d.negative&&d.negative.isFunctional),void(e||(g(d.positive,b,c),d.negative&&g(d.negative,b,c)))):void(this._prepared={pattern:!1})},formatValue:function(a){var b,d,f,g,h,i,j,l,m,n=this._prepared,o="",p="";if(isNaN(a))return a;if(n.pattern===!1)return a.toString();if(a<0&&n.negative?(n=n.negative,a=-a):n=n.positive,h=n.d,i=n.t,n.isFunctional)a=e(a,n.pattern,h);else{if(n.percentage&&(a*=100),n.abbreviate&&(d=Number(Number(a).toExponential().split("e")[1]),d-=d%3,d in k&&(o=k[d],a/=Math.pow(10,d))),f=Math.abs(a),b=n.temp,l=n.numericPattern,m=l.split(h)[1],"I"===this.type&&(a=Math.round(a)),g=a,m||"#"!==l.slice(-1)[0])if(f>=1e15||f>0&&f<=1e-14)a=f?f.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var q=Number(a.toFixed(Math.min(20,m?m.length:0)).split(".")[0]),r=l.split(h)[0];if(r+=h,a=c(r,q)||"0",m){var s=Math.max(0,Math.min(14,m.length)),t=m.replace(/#+$/,"").length,u=(f%1).toFixed(s).slice(2).replace(/0+$/,"");for(j=u.length;j<t;j++)u+="0";u&&(a+=h+u)}else 0===q&&(g=0)}else if(f>=Math.pow(10,b)||f<1||f<1e-4)0===a?a="0":f<1e-4||f>=1e20?(a=g.toExponential(Math.max(1,Math.min(14,b))-1),a=a.replace(/\.?0+(?=e)/,""),p=""):(a=a.toPrecision(Math.max(1,Math.min(14,b))),a.indexOf(".")>=0&&(a=a.replace(a.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,""),a=a.replace(".",h)));else{for(l+=h,b=Math.max(0,Math.min(20,b-Math.ceil(Math.log(f)/Math.log(10)))),j=0;j<b;j++)l+="#";a=c(l,a)}a=a.replace(n.numericRegex,function(a){return a===i?n.groupTemp:a===h?n.decTemp:""}),g<0&&!/^\-/.test(a)&&(a="-"+a)}return n.prefix+a+p+o+n.postfix}}),window.NumberFormatter=j,j.getStaticFormatter=function(){return{prepare:function(){},formatValue:function(a){return a+""}}},j}),define("text!objects.views/charts/components/legend/continous-legend.ng.html",[],function(){return'<div class="qv-continous-color-legend"\n\t ng-class="cclOrientationClass"\n\t ng-style="options.titleStyle">\n\t<div class="cl-title ccl-title"\n\t\t ng-if="options.legendTitle"\n\t\t ng-class="cclOrientationClass">\n\t\t<div qva-direction x-dir-text="{{options.legendTitle}}" x-dir-setting="{{options.yMirrorMode ? \'rtl\' : \'ltr\'}}" class="ccl-title-inner"\n\t\t\t title="{{options.legendTitleTooltip}}">{{options.legendTitle}}</div>\n\t</div>\n    <div class="ccl-gradient"\n\t\t ng-class="cclOrientationClass"\n\t\t tid="ccl.gradient">\n        <div class="ccl-axis" ng-class="cclOrientationClass"  ng-style="options.labelStyle">\n\t\t\t<div ng-repeat="axisVal in axisValues track by $index" class="ccl-axis-value" ng-class="{\'first\': $first, \'last\':$last}" dir="ltr">{{axisVal}}</div>\n            <!--\n                <div class="ccl-axis-top-value">{{axisValues[1]}}</div>\n                <div class="ccl-axis-bottom-value">{{axisValues[0]}}</div>\n                -->\n        </div>\n\t\t<div class="ccl-gradient-color"\n\t\t\t ng-class="cclOrientationClass"\n\t\t\t qva-apply-style="cclGradientStyle">\n\t\t</div>\n\t\t<div dir="ltr" class="ccl-range"\n\t\t\t ng-show="selectionEnabled && !isLocked"\n\t\t\t ng-style="cclRangeStyle"\n\t\t\t ng-class="cclOrientationClass">\n\t\t\t<div ng-show="active" class="ccl-range-inner"\n\t\t\t\t ng-class="cclOrientationClass"\n\t\t\t\t ng-style="rangeStyle">\n\t\t\t\t<div class="ccl-axis-cover"\n\t\t\t\t\t ng-style="active && cclCoverStyle"\n\t\t\t\t\t tid="ccl.cover"\n\t\t\t\t\t ng-class="{\'active\' : activeOptions.cover}"></div>\n\t\t\t\t<div class="ccl-far-edge"\n\t\t\t\t\t tid="ccl.edge.far"\n\t\t\t\t\t ng-class="{\'active\' : activeOptions.far}">\n\t\t\t\t</div>\n\t\t\t\t<div class="ccl-near-edge"\n\t\t\t\t\t tid="ccl.edge.near"\n\t\t\t\t\t ng-class="{\'active\' : activeOptions.near}">\n\t\t\t\t</div>\n\t\t\t\t<div class="ccl-outer-bubble-wrapper"\n\t\t\t\t\t ng-class="active && cclOrientationClass">\n                    <qva-range-selection-bubble visible="active" active-component="fakeAxis" handle-points="handlePoints" horizontal="!options.vertical" far="false" data="values.start" active="activeOptions.near" tid="ccl.bubble.near"> </qva-range-selection-bubble>\n                    <qva-range-selection-bubble visible="active" active-component="fakeAxis" handle-points="handlePoints" horizontal="!options.vertical" far="true" data="values.end" active="activeOptions.far" tid="ccl.bubble.far"> </qva-range-selection-bubble>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'}),define("general.directives/apply-style",["jquery","qvangular"],function(a,b){b.directive("qvaApplyStyle",function(){return{restrict:"A",link:function(b,c,d){b.$watch(d.qvaApplyStyle,function(b){"string"===a.type(b)&&c.attr("style",b)},!1)}}})}),define("objects.views/charts/components/legend/qv-continous-legend",["touche","qvangular","text!./continous-legend.ng.html","general.utils/shapes/point","general.directives/apply-style"],function(a,b,c,d){function e(a,b,c){var d,e,f,g=c?o:p;if(e="",f=")",b)for(d=a.length-1;d>0;d--)e+=", "+a[d]+" "+100/(a.length-1)*(a.length-1-d)+"%";else for(d=0;d<a.length;d++)e+=", "+a[d]+" "+100/(a.length-1)*d+"%";return"background:"+a[a.length/2]+"; background:"+g.moz+e+f+"; background:"+g.webkit+e+f+"; background:"+g.opera+e+f+"; background:"+g.ie+e+f+"; background:"+g.w3c+e+f}function f(a,b,c){return b?a[0][c]>a[1][c]?0:1:a[0][c]<a[1][c]?0:1}function g(a){return["left","bottom"].contains(a)}function h(a,b,c){var d=c?b.height():b.width(),e=c?"y":"x";a[0][e]=m(n(a[0][e],0),d),a[1][e]=m(n(a[1][e],0),d)}function i(a,b,c,e){var f=[];return c?(f[b]=new d(a[b].x,a[b].y+e),f[1^b]=a[1^b]):(f[b]=new d(a[b].x+e,a[b].y),f[1^b]=a[1^b]),f}function j(a,b){var c=a.find(".ccl-axis");return b?c.outerWidth():c.outerHeight()}function k(a,b){return{vertical:a.options.vertical,direction:a.options.vertical?"y":"x",grt:a.options.vertical?b:!b}}var l=".legendRangeSelection",m=Math.min,n=Math.max,o={moz:"-moz-linear-gradient(bottom",webkit:"-webkit-linear-gradient(bottom",opera:" -o-linear-gradient(bottom",ie:"-ms-linear-gradient(bottom",w3c:"linear-gradient(to top"},p={moz:"-moz-linear-gradient(left",webkit:"-webkit-linear-gradient(left",opera:" -o-linear-gradient(left",ie:"-ms-linear-gradient(left",w3c:"linear-gradient(to right"};b.directive("qvContinousLegend",function(){return{template:c,replace:!0,scope:!0,link:function(b,c){function m(a){if(b.positionToFormattedValue&&a){var c,d;return b.options.vertical?(c=y.rangeElement.height(),d=1-a.y/c):(c=y.rangeElement.width(),d=a.x/c),b.positionToFormattedValue(d)}return a+""}function n(){if(!x&&b.selectionEnabled){x=!0;var c,e="hey";a(y.gradient[0]).swipe({id:l,options:{preventDefault:!0},start:function(d,e){if(!b.isLocked){var f=e.pagePoints[0];c=u(f.x,f.y),a.preventGestures(this.gestureHandler),q(d,e)}},update:function(a,d){if(!b.isLocked){b.active=!0,b.swiping=!0;var e=d.pagePoints[0];b.handlePoints=[c,u(e.x,e.y)],b.updateHandlePoints(b.handlePoints),b.$digest()}},end:function(){return b.isLocked?void r():(b.swiping=!1,void t())}}),a(y.axisCover[0]).tap({id:l,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:l,options:{preventDefault:!0},start:function(c,d){e=b.handlePoints,a.preventGestures(this.gestureHandler),q(c,d),b.activeOptions.cover=!0},update:function(a,c){var f=b.options.vertical?c.swipe.deltaY:0,g=b.options.vertical?0:c.swipe.deltaX;b.handlePoints=[new d(e[0].x+g,e[0].y+f),new d(e[1].x+g,e[1].y+f)],b.updateHandlePoints(b.handlePoints),b.$digest()},end:function(){t(),b.activeOptions.cover=!1}}),a.utils.touch||(o(y.farEdge[0],!1),o(y.nearEdge[0],!0)),b.$broadcast("on")}}function o(c,d){var e,g,h,j=k(b,d);a(c).tap({id:l,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:l,options:{radiusThreshold:0},start:function(c,h){j=k(b,d),g=f(b.handlePoints,j.grt,j.direction),e=b.handlePoints,a.preventGestures(this.gestureHandler),q(c,h)},update:function(a,c){b.handlePoints=i(e,g,j.vertical,j.vertical?c.swipe.deltaY:c.swipe.deltaX),b.updateHandlePoints(b.handlePoints),b.activeOptions.near=b.activeOptions.far=!1,h=f(b.handlePoints,j.grt,j.direction)?"far":"near",b.activeOptions[h]=!0,b.$digest()},end:function(){t(b.handlePoints),b.activeOptions.near=b.activeOptions.far=!1,b.$digest()}})}function p(){b.active=!1,Object.keys(y).forEach(function(b){a(y[b][0]).off("*",l)}),x=!1,b.$broadcast("off")}function q(a,c){b.$emit("rangeStart",a,c)}function r(){b.$emit("selectWhileLocked")}function s(a,c){b.$emit("rangeUpdate",a,b.options.vertical?y.rangeElement.height():y.rangeElement.width(),c)}function t(){var a;b.options.vertical&&b.handlePoints[0].y<b.handlePoints[1].y?(a=[],a[1]=b.handlePoints[0],a[0]=b.handlePoints[1],b.handlePoints=a):!b.options.vertical&&b.handlePoints[0].x>b.handlePoints[1].x&&(a=[],a[1]=b.handlePoints[0],a[0]=b.handlePoints[1],b.handlePoints=a),b.$emit("rangeEnd")}function u(a,b){var c=y.rangeElement.offset();return new d(a-c.left,b-c.top)}function v(a,d,e){y.nearBubbleWrapper||(y.nearBubbleWrapper=c.find(".ccl-outer-bubble-wrapper .bubble-wrapper.near"),y.nearBubble=c.find(".ccl-outer-bubble-wrapper .bubble-wrapper.near .bubble"),y.farBubbleWrapper=c.find(".ccl-outer-bubble-wrapper .bubble-wrapper.far"),y.farBubble=c.find(".ccl-outer-bubble-wrapper .bubble-wrapper.far .bubble")),y.nearBubbleWrapper.css(b.cclBubbleNearStyle),y.farBubbleWrapper.css(b.cclBubbleFarStyle);var f=w(a,e);f=f>0?f:0,e?y.nearBubble.css({"margin-left":Math.round(f)+"px"}):y.farBubble.css({"margin-right":Math.round(f)+"px"})}function w(a,b){return a?0:b?c.offset().left-(y.nearBubbleWrapper.offset().left-.5*y.nearBubbleWrapper.width()-5):y.farBubbleWrapper.offset().left-c.offset().left+1.5*y.farBubbleWrapper.width()+5-c.width()}var x=!1,y={gradient:c.find(".ccl-gradient"),rangeElement:c.find(".ccl-range"),rangeInner:c.find(".ccl-range-inner"),axisCover:c.find(".ccl-axis-cover"),nearEdge:c.find(".ccl-near-edge"),farEdge:c.find(".ccl-far-edge")};b.fakeAxis={getPositionOfValue:function(a){var c=b.viewItems[0].min,d=b.viewItems[b.viewItems.length-1].max,e=(a-c)/(d-c),f=b.options.vertical?y.rangeElement.height():y.rangeElement.width(),g=b.options.vertical||!b.options.vertical&&b.options.yMirrorMode;return g&&(e=1-e),e*f},isDiscrete:function(){return!1}},b.activeOptions={far:!1,near:!1,cover:!1},b.values={start:{},end:{}},b.setRangeStyle=function(a){if(a&&2===a.length){b.relevantSize=j(c,b.options.vertical);var d=a[0],e=a[1],f=b.options.vertical?"y":"x";b.options.vertical?b.rangeStyle={height:Math.abs(d[f]-e[f]),top:Math.min(d[f],e[f])}:b.rangeStyle={width:Math.abs(d[f]-e[f]),left:Math.min(d[f],e[f])}}},b.updateHandleValues=function(a,c){if(h(a,y.rangeElement,b.options.vertical),b.setRangeStyle(a),b.active){var d=b.options.vertical?"y":"x",e=b.options.vertical?y.rangeElement.height():y.rangeElement.width(),i=a[f(b.handlePoints,b.options.vertical,d)],j=a[f(b.handlePoints,!b.options.vertical,d)];if(b.values.start.text=b.cclNearValueLabel=m(i),b.values.end.text=b.cclFarValueLabel=m(j),c){if(c.switch){var k=b.values.start.value;b.values.start.value=b.values.end.value,b.values.end.value=k}var l=b.viewItems[0].min,n=b.viewItems[b.viewItems.length-1].max;0===c.index?b.values.start.value=Math.max(Math.min(c.value,n),l):b.values.end.value=Math.max(Math.min(c.value,n),l)}else b.options.vertical?(b.values.start.value=b.positionToValue((e-i[d])/e),b.values.end.value=b.positionToValue((e-j[d])/e)):(b.values.start.value=b.positionToValue(i[d]/e),b.values.end.value=b.positionToValue(j[d]/e))}if(b.active&&b.options){var o=g(b.options.dock);v(b.options.vertical,o,!1),v(b.options.vertical,o,!0)}},b.updateHandlePoints=function(a){a&&(b.updateHandleValues(a),s(b.handlePoints))},b.$on("rangeUpdate",function(a,c,d,e){isNaN(d)&&(b.handlePoints=[c[0],c[1]],b.updateHandleValues(b.handlePoints,e),b.$digest(),s(c,e),a.stopPropagation())}),b.$watchCollection("[viewItems, options.yMirrorMode, options.vertical]",function(a){var c=a[0],d=a[1],f=a[2],g=d&&!f;if(c&&c.length){for(var h=[c[0].colorTo],i=0;i<c.length;i++)h.push(c[i].colorFrom);b.cclGradientStyle=e(h,g,f);var j=[c[0].minText,c[c.length-1].maxText];f&&j.reverse(),b.axisValues=j}});var z={right:"",bottom:""},A={right:"0px",bottom:""},B={bottom:"0px",right:""};b.$watchCollection("[options.vertical, options.dock, relevantSize]",function(a){var c=a[0],d=g(a[1]),e=a[2];b.cclOrientationClass={vertical:c,horizontal:!c,near:d,far:!d},d?(b.cclCoverStyle=c?{left:"0px",width:e+"px"}:{bottom:"0px",height:e+"px"},b.cclBubbleNearStyle=c?z:B,b.cclBubbleFarStyle=c?z:B):(b.cclCoverStyle=c?{right:"0px",width:e+"px"}:{top:"0px",height:e+"px"},b.cclBubbleNearStyle=c?A:z,b.cclBubbleFarStyle=c?A:z)}),n.call(this),b.$watch("selectionEnabled",function(a){a?n.call():p.call()}),b.$on("$destroy",function(){p.call()}),b.$on("cancelSelection",function(){b.active=!1})}}})}),define("text!objects.views/charts/components/legend/discrete-legend.ng.html",[],function(){return'<div class="qv-discrete-color-legend"\n\t ng-class="{ \'vertical\': options.vertical }"\n\t ng-style="options.labelStyle">\n\t<div class="cl-title dcl-title"\n\t\t ng-if="options.legendTitle && options.legendTitle.length"\n\t\t ng-style="options.titleStyle"\n\t\t ng-class="{\'vertical\': options.vertical }">\n\t\t<div class="dcl-title-inner" title="{{options.legendTitleTooltip}}" qva-direction x-dir-text="{{options.legendTitle}}" x-dir-setting="{{options.yMirrorMode ? \'rtl\' : \'ltr\'}}">{{options.legendTitle}}</div>\n\t</div>\n\t<div class="dcl-flex" ng-class="{\'align\': align, \'vertical\': options.vertical, \'in-selections\': selectionsApi.active }"\n\t\t qv-selections-toggle-dimension-value="{ selector: \'.color-item\', itemKey: \'item\' }"\n\t\t qv-selections-on-toggle-dimension-value="selectionEnabled && !isScrolling && select($event, item)">\n\t\t<div ng-repeat="item in viewItems track by $index"\n\t\t\t ng-style="{\'height\':item.height,  \'width\': (options.vertical ? \'auto\' : options.cellWidth)}"\n\t\t\t class="color-item" ng-class="{\'selected\': item.selected}"\n\t\t\t tid="dcl.item">\n\t\t\t<div class="marker">\n\t\t\t\t<div ng-style="item.markerClass[\'glyph-triangle\']  ? {\'border-bottom-color\': item.color} : ( item.markerClass[\'glyph-inverse-triangle\'] ? {\'border-top-color\': item.color} : {background: item.color} )" ng-class="item.markerClass"></div>\n\t\t\t</div>\n\t\t\t<div qva-direction x-dir-text="{{item.text}}" class="text"\n\t\t\t\t title="{{item.tipText}}">{{item.text}}</div>\n\t\t</div>\n\t</div>\n\t<div class="dcl-buttons-v" ng-show="options.vertical && overflow">\n\t\t<!--DOWN-->\n\t\t<button class="dcl-down qui-plainbuttonicon" ng-disabled="!interactionEnabled || scrollAtEnd" tid="dcl.down">\n\t\t\t<span class="lui-button__icon lui-icon lui-icon--triangle-bottom"></span>\n\t\t</button>\n\n\t\t<!--UP-->\n\t\t<button class="dcl-up qui-plainbuttonicon" ng-disabled="!interactionEnabled || scrollAtStart" tid="dcl.up">\n\t\t\t<span class="lui-button__icon lui-icon lui-icon--triangle-top"></span>\n\t\t</button>\n\t</div>\n\t<div class="dcl-buttons-h" ng-show="!options.vertical && overflow">\n\t\t<!--RIGHT-->\n\t\t<button class="dcl-right qui-plainbuttonicon" ng-disabled="!interactionEnabled || scrollAtEnd" tid="dcl.right">\n\t\t\t<span class="lui-button__icon lui-icon lui-icon--triangle-right"></span>\n\t\t</button>\n\t\t<!--LEFT-->\n\t\t<button class="dcl-left qui-plainbuttonicon" ng-disabled="!interactionEnabled || scrollAtStart" tid="dcl.left">\n\t\t\t<span class="lui-button__icon lui-icon lui-icon--triangle-left"></span>\n\t\t</button>\n\t</div>\n</div>\n'}),define("objects.grid/directives/selections",["qvangular","jquery","touche"],function(a,b,c){"use strict";a.directive("qvSelectionsToggleValue",["$parse",function(a){return{restrict:"A",link:function(c,d,e){var f=a(e.qvSelectionsToggleValue)(),g=f.selector,h="."+c.$id+"-toggle-value",i=f.itemKey||"cell";d.on("qv-activate"+h,g,function(a){var d=b(a.target).closest(g),f=d.scope()[i];d.length&&f&&c.$apply(function(){var b={$event:a};b[i]=f,c.$eval(e.qvSelectionsOnToggleValue,b)})}),c.$on("$destroy",function(){d.off(h)})}}}]),a.directive("qvSelectionsToggleDimensionValue",["$parse",function(a){return{restrict:"A",link:function(c,d,e){var f=a(e.qvSelectionsToggleDimensionValue)(),g=f.selector,h="."+c.$id+"-toggle-dimension-value",i=f.itemKey||"cell";d.on("qv-activate"+h,g,function(a){var d=b(a.target).closest(g),f=d.scope()[i];if(!c.$eval(e.qvSelectionsExcludeToggleDimensionValue,{$event:a})&&f&&f.isDimensionValue)return f.locked?void c.$eval(e.qvSelectionsSelectWhileLocked):void c.$apply(function(){var b={$event:a};b[i]=f,c.$eval(e.qvSelectionsOnToggleDimensionValue,b)})}),c.$on("$destroy",function(){d.off(h)})}}}]),a.directive("qvSelectionsMultiselect",["$parse",function(a){return{restrict:"A",controller:function(){},link:function(d,e,f,g){function h(){return c(e[0]).tap({id:q,options:{preventDefault:!1},start:function(a){l=b(a.target).closest(o)}}),c(e[0]).swipe({id:q,options:{radiusThreshold:4,preventDefault:!1},start:function(a){var b,e;return c.utils.isMouse(a)&&l.length?(b=l.scope()[p],b.isDimensionValue?b.locked?(d.$eval(f.qvSelectionsSelectWhileLocked),void this.cancel()):(m=b,e={$event:a},e[p]=b,void d.$apply(d.$eval(f.qvSelectionsStartMultiselect,e))):void this.cancel()):void this.cancel()},update:function(a){var c,e=b(a.target).closest(o);e.length&&(c=e.scope()[p],d.$apply(d.$eval(f.qvSelectionsUpdateMultiselect,{start:m,current:c,dataColIx:c.dataColIx})))},end:function(a){d.$apply(d.$eval(f.qvSelectionsEndMultiselect,{$event:a}))}}),function(){c(e[0]).off("*",q)}}function i(){return c(e[0]).tap({id:r,options:{touches:2,preventDefault:!1},end:function(a,c){var e,g=c.pagePoints[0],h=c.pagePoints[1],i=b(document.elementFromPoint(g.x,g.y)),j=b(document.elementFromPoint(h.x,h.y)),k=i.closest(o).scope()[p],l=j.closest(o).scope()[p];if(k.isDimensionValue&&l.isDimensionValue)return k.locked||l.locked?void d.$eval(f.qvSelectionsSelectWhileLocked):void d.$apply(function(){e={offsetLeft:i[0].offsetLeft,width:i[0].clientWidth,$event:a},e[p]=k,d.$eval(f.qvSelectionsStartMultiselect,e),d.$eval(f.qvSelectionsUpdateMultiselect,{start:k,current:l,dataColIx:k.dataColIx}),d.$eval(f.qvSelectionsEndMultiselect,{$event:a})})}}),function(){c(e[0]).off("*",r)}}var j,k,l,m,n=a(f.qvSelectionsMultiselect)(),o=n.selector,p=n.itemKey||"cell",q=d.$id+"-multiselect",r=d.$id+"-2finger-multiselect";g.on=function(){j||(j=h()),k||(k=i())},g.off=function(){j&&(j(),j=void 0),k&&(k(),k=void 0)},d.$watch("interactive",function(a){void 0!==a&&(a?g.on():g.off())}),d.$on("$destroy",function(){g.off()})}}}])}),define("objects.views/charts/components/legend/qv-discrete-legend",["assets/qvangular/qvangular-core","text!./discrete-legend.ng.html","touche","objects.utils/event-utils","client.utils/rtl/rtl-util","objects.grid/directives/selections"],function(a,b,c,d,e){var f=5,g=10,h=".discretelegend";a.directive("qvDiscreteLegend",["$timeout",function(a){return{template:b,replace:!0,scope:!0,link:function(b,i){function j(a,c){var d,e=b.viewItems,f=0,g=0;if(c)for(;g!==a&&g<e.length;)d=e[g],f+=d.height,g++;else f=a*b.options.cellWidth;return f}function k(){return b.options.vertical?t.scrollTop():t.scrollLeft()}function l(a){m(k(),a*(b.options.vertical?1:-1))}function m(a,c,d){var f;f=b.options.vertical?{scrollTop:a+c+"px"}:{scrollLeft:e.getScrollPos("rtl"===b.options.direction,a,c)+"px"},t.animate(f,d?200:0)}function n(a,c){var d,f,g=b.viewItems,h=g[0],i=0,j=0;if(c){for(;i<a&&j<g.length;)h=g[j],i+=h.height,j++;a+t.height()>=t[0].scrollHeight?i=a:Math.abs(a-i)>Math.abs(a-(i-h.height))&&(j--,i-=h.height),d=t.height()/h.height>=g.length-j,f=0===j}else i=Math.round(a/b.options.cellWidth)*b.options.cellWidth,j=Math.abs(Math.round(a/b.options.cellWidth)),a+t.width()>=t[0].scrollWidth&&(i=a,j++),"rtl"!==b.options.direction||"default"===e.scrollImplementation?(d=t.width()/b.options.cellWidth>=g.length/Math.floor(t.height()/b.options.cellHeight)-j,f=0===j):(f=t.width()/b.options.cellWidth>=g.length/Math.floor(t.height()/b.options.cellHeight)-j,d=0===j);return{position:i,index:j,end:d,start:f}}function o(c,d,e){e=e||0;var f=k(),g=n(f+e,c);g.position!==f&&(t.stop(!0),m(g.position,0,d)),a(function(){b.scrollAtEnd=g.end,b.scrollAtStart=g.start}),b.$emit("scrollPositionChanged",g.index)}function p(a,d,e){var j=!1,k=i.find(a).first();c(i.find(a)[0]).longtap({id:h,options:{timeThreshold:1e4},update:function(a,h){h.percentage>2&&b.interactionEnabled&&(q(d*(e?f:g)),j=!0,k.addClass("qui-active"),c.preventGestures(this.gestureHandler))},end:function(){j=!1,k.removeClass("qui-active"),c.preventGestures(this.gestureHandler)},cancel:function(){k.removeClass("qui-active"),c.preventGestures(this.gestureHandler)}}).tap({end:function(){b.interactionEnabled&&(j?o(e,!0):(q(d*(e?b.options.cellHeight:b.options.cellWidth)),o(e,!1)),j=!1)}})}function q(a){l(a)}function r(a,b){var e=null,f=d.throttle(function(a){if(b.interactionEnabled){var c,e=d.getMouseWheelData(a.originalEvent);c=(e.delta>0?-1:1)*(b.options.vertical?b.options.cellHeight:b.options.cellWidth),b.options.yMirrorMode&&!b.options.vertical&&(c=-c),o(b.options.vertical,!1,c)}},20);t.on("mousewheel"+h+" DOMMouseScroll"+h,function(a){f(a),a.preventDefault(),a.stopPropagation()}),p(".dcl-up",-1,!0),p(".dcl-down",1,!0),p(".dcl-left",-1,!1),p(".dcl-right",1,!1),c(t[0]).swipe({options:{useMomentum:!0,inertia:.7,preventDefault:!0},start:function(a){b.interactionEnabled&&(e=k(),b.isScrolling=!0,c.preventGestures(this.gestureHandler),a.preventDefault())},update:function(a,c){if(null!==e&&c.swipe){var d=c.swipe.distance;b.options.vertical?"up"===c.swipe.direction?m(e,-d):"down"===c.swipe.direction&&m(e,d):"left"===c.swipe.direction?m(e,d):"right"===c.swipe.direction&&m(e,-d)}},end:function(){null!==e&&(o(b.options.vertical,!0),b.isScrolling=!1,e=null)}})}function s(a){c(a.find(".dcl-up").off("*",h)),c(a.find(".dcl-down").off("*",h)),c(a.find(".dcl-left").off("*",h)),c(a.find(".dcl-right").off("*",h))}var t=i.find(".dcl-flex");b.$watch("viewItems",function(a){a.forEach(function(a){for(var b={},c=Array.isArray(a.marker)?a.marker:[a.marker],d=0;d<c.length;d++)switch(c[d]){case"line":case"!line":b["glyph-line"]=!0;break;case"triangle":case"!triangle":b["glyph-triangle"]=!0;break;case"inverse-triangle":case"!inverse-triangle":b["glyph-inverse-triangle"]=!0;break;case"diamond":case"!diamond":b["glyph-diamond"]=!0;break;case"circle":case"!circle":b["glyph-circle"]=!0;break;case"rect":case"!rect":default:b["glyph-rect"]=!0}a.markerClass=b})}),b.$on("clearSelection",function(){if(b.viewItems){b.selectedValues=[];for(var a=0;a<b.viewItems.length;a++){var c=b.viewItems[a];c.selected=!1}}}),b.$on("invalidateSelections",function(){if(b.viewItems){b.selectedValues=[];for(var a=0;a<b.viewItems.length;a++){var c=b.viewItems[a];"dimension"===c.type&&(b.selectionsCache?c.selected=b.selectionsCache.isValueSelected(c.id[0]):"dimension"===c.type&&c.cacheItems&&c.cacheItems[0]&&(c.selected=c.cacheItems[0].selected))}}b.$digest()}),b.select=function(a,c){"others"!==c.type&&("range"===c.type&&(c.selected=!c.selected),b.$emit("toggleSelect",a,[c]),"dimension"===c.type&&b.selectionsCache&&(c.selected=b.selectionsCache.isValueSelected(c.id[0])))},b.$on("$destroy",function(){s(i)}),b.$watch("explicitScrollPosition",function(a){b.explicitScrollPosition=a}),b.$on("updateSize",function(){if(o(b.options.vertical,!0),void 0!==b.explicitScrollPosition){var a=j(b.explicitScrollPosition,b.options.vertical);b.options.vertical?t.scrollTop(a):t.scrollLeft(a)}}),r(i,b)}}}])}),define("objects.views/charts/components/legend/basic-color-legend",["jquery","translator","./legend-data","client.utils/state","../chart-component-angular","text!./color-legend.ng.html","objects.utils/number-formatter","objects.views/charts/chart-style-service","./qv-continous-legend","./qv-discrete-legend"],function(a,b,c,d,e,f,g,h){function i(a,b){var c={backgroundColor:a.getValue(r,null,"backgroundColor"),label:{font:a.getFont(r,"label"),lineHeight:"1em"},scaledLabel:{font:a.getFont(r,"label",null,null,null,b),color:a.getValue(r,"label","color"),lineHeight:"1em"},ticks:{color:"#a6a6a6",length:8},line:{color:"#666666"},title:{font:a.getFont(r,"title"),lineHeight:"1em"},scaledTitle:{font:a.getFont(r,"title",null,null,null,b),color:a.getValue(r,"title","color"),lineHeight:"1.2em"}};return c}function j(a){return a&&"primary"!==a.colorMode}function k(a,b,c){var d={};return d.maxItemsPerRow=Math.floor((a.width-(c.show?c.width:0))/b.cellWidth),d.numRows=Math.ceil(b.viewItems.length/d.maxItemsPerRow),d.itemsPerRow=Math.ceil(b.viewItems.length/d.numRows),d.w=d.itemsPerRow*b.cellWidth,d.h=Math.ceil(Math.max(c.height,Math.min(b.cellHeight*o,d.numRows*b.cellHeight))),d}function l(a,b,c){return(c?Math.max(a.width,b.maxLabelWidth+p):Math.max(b.labelHeight+p,a.height))+20}function m(a){return d.state===d.States.analysis||d.state===d.States.play&&(!a||!a.isSnapshot)}var n,o=2,p=17,q=12,r="legend";return n=e.extend("BasicColorLegend",{init:function(){var a=Array.prototype.slice.call(arguments);a.push(f),this._super.apply(this,a),this._styleService=h.getInstance(),this._legendContainer=this.getInnerContainer(),this._dataInvalid=!0,this.$scope=this.getInnerContainerScope(),this._scrollPosition=0,this._mode={}},release:function(){this._super(),this.$scope=null,this._legendContainer=null},setColorMap:function(a){this._colorMap=a,this.invalidateProperties("Legend.setColorMap"),this.invalidateDisplay("Legend.setColorMap")},getColorMap:function(){return this._colorMap},setProperties:function(a){return this._legendProperties=a,this._dataInvalid=!0,this.invalidateProperties("BasicColorMap.setProperties")},setExternalColorItems:function(a){if(a&&a[0]&&a[0].qMatrix&&this._colorMap){this._externalDataPage=a;var c=a[0].qMatrix,d=[];this._colorDataInfo=this._colorMap.getColorDataInfo(),c.forEach(function(a,b){d.push({id:[a[1].qNum],index:b,label:a[0].qText,type:"dimension"})},this),this._colorDataInfo&&this._colorDataInfo.hasOthers&&d.push({id:[-3],index:d.length,label:b.get("properties.dimensionLimits.others"),type:"others"}),this._externalColorItems=d}else this._externalColorItems=null;this.invalidateProperties("Legend.setExternalColorItems")},getExternalDataPage:function(){return this._externalDataPage},isVisible:function(a){return this._super(a)&&this.hasValidData()&&j(this._mode)&&this._legendProperties&&this._legendProperties.show},updateSize:function(){this._super(),this.invalidateProperties("LegendLight.calculateRelevantSize"),this.updateNow(["properties"]),this._dataInvalid=!0},_updateProperties:function(){if(!this._colorMap||!this._legendProperties)return this._clearScope(this.$scope),!1;if(this._colorDataInfo=this._colorMap.getColorDataInfo(),this._mode=this._colorDataInfo.legendMode||{},this._marker=this._colorMap.getLegendDataProvider()?this._colorMap.getLegendDataProvider().getLegendMarker():"rect",!this._mode.colorMode||this._colorDataInfo.altMode&&!this._externalColorItems&&"dimension"===this._mode.colorMode)return this._clearScope(this.$scope),!1;var b,d=i(this._styleService,this.chartScale);return this._externalColorItems&&"dimension"===this._mode.colorMode?(b=this._externalColorItems,b.forEach(function(a){a.color=this._colorMap.getColorFromPreScaledValue(a.id[0]),a.marker=this._marker}.bind(this)),b=b.filter(function(a){return!a.color.isInvalid()})):b=this._colorMap.getColorMapping().concat(),this._mode.showTitle=this._data.legend.showTitle,this.isVisible()&&b&&b.length?(this.$scope.visible=!0,this.$scope.selectionEnabled=!1,this.$scope.interactionEnabled=m(this.backendApi),this._mode.showTitle?(this._titleMetrics=c.prepareLegendTitle(this._colorMap.getLegendTitle(),d.title),this._titleMetrics.show=this._mode.showTitle):this._titleMetrics={show:!1,width:0,height:0},this._mode.discrete?(this._legendMetrics=c.prepareDiscreteData(b,this._selectableShapes,d.label,this.rect.width-(this._mode.showTitle&&this.isHorizontal()?this._titleMetrics.width:0),this.chartScale,this._colorMap.getDimensionIndex()[0],this._colorDataInfo.attrIndex),this.$scope.viewItems=this._legendMetrics.viewItems):(this._formatter=this._colorMap.getValueFormatter()||g.getStaticFormatter(),this._formatter.prepare(),this._legendMetrics=c.prepareContinousData(b,d.label,this._formatter),this.$scope.viewItems=this._legendMetrics.viewItems),this.isHorizontal()?(this._horizontalMetrics=k(this.rect,this._legendMetrics,this._titleMetrics),
this.$scope.align=this._horizontalMetrics.numRows>=o,this.$scope.overflow=this._horizontalMetrics.numRows>o):this.$scope.overflow=this._legendMetrics.cellHeight*this._legendMetrics.viewItems.length>this.rect.height,this.$scope.discrete=this._mode.discrete,this.$scope.options.vertical=this.isVertical(),this.$scope.options.labelStyle=d.scaledLabel,this.isDiscrete()?(this.$scope.options.titleStyle=a.extend(!0,{width:Math.ceil(this._titleMetrics.width*this.chartScale)+"px"},d.scaledTitle),this.$scope.options.titleHeight=(Math.max(this._titleMetrics.height,q)+q)*this.chartScale,this.$scope.options.legendTitle=this._titleMetrics.show?this._titleMetrics.text:null):(this.$scope.options.titleStyle=d.scaledTitle,this.$scope.options.legendTitle=this._titleMetrics.text),this.$scope.options.legendTitleTooltip=this._titleMetrics.fullText,this.$scope.options.cellWidth=Math.ceil(this._legendMetrics.cellWidth*this.chartScale),this.$scope.options.cellHeight=Math.ceil(this._legendMetrics.cellHeight*this.chartScale),this.$scope.options.yMirrorMode=this.yMirrorMode,this.$scope.options.dock=this.dock,this.$scope.isLocked=this.isSelectionLocked(),this._dataInvalid=!1,!0):(this._clearScope(this.$scope),!1)},paint:function(){this.$scope.$broadcast("invalidateSelections"),this.$scope.$broadcast("updateSize")},calculateRelevantSize:function(a){if(this._super(),this.relevantSize=0,this.invalidateProperties("Legend.calculateRelevantSize"),this.updateNow(["properties"]),this.isVisible()&&this._titleMetrics&&this._legendMetrics)if(this.isDiscrete())if(this.isHorizontal()){var b=k(a,this._legendMetrics,this._titleMetrics);this.relevantSize=b.h+(b.numRows>o?o:b.numRows)+2*c.constants.PADDING}else this.relevantSize=Math.max(this._legendMetrics.cellWidth,this._titleMetrics.width);else this.relevantSize=l(this._titleMetrics,this._legendMetrics,this.isVertical(),this._values)},isDiscrete:function(){return this._mode.discrete},clear:function(){this._super()},isSelectionLocked:function(){return this._colorDataInfo.altMode&&this._colorDataInfo.internalMode===(this._colorMap?this._colorMap.DIMENSION:"dimension")?this._colorDataInfo.altLocked:this._super()},getAttributeDimensionInfo:function(){return this._colorMap&&this._colorMap.hasAttributeDimension()?this._colorMap.getAttributeDimensionInfo():[]},_clearScope:function(a){a.visible=!1,a.viewItems=null,this._titleMetrics=null,this._legendMetrics=null},on:function(){this._super(),this.$scope.interactionEnabled=m(this.backendApi)},off:function(){this._super(),this.$scope.interactionEnabled=!1}}),Object.defineProperty(n.prototype,"className",{value:"BasicColorLegend"}),n}),define("objects.views/charts/components/legend/color-legend",["./basic-color-legend","objects.utils/number-formatter"],function(a,b){function c(a,b,c,d,e,f){var g,h,i=d[0].min,j=d[d.length-1].max,k=j-i;return c?(g=1-Math.max(a[0].y,a[1].y)/b,h=1-Math.min(a[0].y,a[1].y)/b):e?(g=1-Math.min(a[0].x,a[1].x)/b,h=1-Math.max(a[0].x,a[1].x)/b):(g=Math.min(a[0].x,a[1].x)/b,h=Math.max(a[0].x,a[1].x)/b),g=0===g?i:g*k+i,h=1===h?j:h*k+i,{idx:f,startVal:g,updateVal:h,isMax:!0}}function d(a,b,c){var d,e=b[0].min,f=b[b.length-1].max,g=f-e;return c&&(a=1-a),d=0===a?e:1===a?f:a*g+e}function e(a,b,c){for(var d,e=[],f=0;f<b.length;f++)d=b[f],e.push({idx:c,startVal:d.id[0],updateVal:d.id[1],isMax:d.isMax});return e}function f(a){return!("measure"===a.colorMode&&"item"===a.boxType)}function g(a,d,g){return d.selectionEnabled=!!a._mode.selectionEnabled&&!!g&&a._on&&!g.handler._disableSelections,g&&d.selectionEnabled?void(a._watchers||(a._watchers=[],a._watchers.push(d.$on("toggleSelect",function(b,c,h){if(g.initComponent(null,a),f(a._mode)){if("range"===a._mode.boxType){g.rangeStart();var i=e(d.viewItems,h,a._mode.rangeSelectionIndex);g.indices=[a._mode.rangeSelectionIndex],g.rangeUpdate(i,!0),g.rangeEnd()}else{if(a.$scope.isLocked)a.selections.selectWhileLocked(a._mode.altMode?g.activeComponent.getAttributeDimensionInfo():void 0);else{var j,k=h.map(function(a){return a.id[0]}),l=[],m=h.length;for(j=0;j<m;j++)h[j].cacheItems&&(l=l.concat(h[j].cacheItems));g.updateFromItems(c,l,a._mode.altMode,k)}a._mode.altMode||a.selections._selectedShapes.length||a.selectionsApi.clear()}b.preventDefault()}})),a._watchers.push(d.$on("rangeStart",function(c,d,e){e&&g.initComponent(e.pagePoints[0]),a._formatter=a._colorMap.getValueFormatter()||b.getStaticFormatter(),a._formatter.prepare(),g.rangeStart(!0),c.preventDefault()})),a._watchers.push(d.$on("rangeUpdate",function(b,d,e,f){var h=c(d,e,a.isVertical(),a.$scope.viewItems,a.yMirrorMode,a._mode.rangeSelectionIndex);g.indices=[a._mode.rangeSelectionIndex],f&&(0===f.index?h.startVal=f.value:h.updateVal=f.value),g.rangeUpdate([h]),b.preventDefault()})),a._watchers.push(d.$on("rangeEnd",function(a){g.rangeEnd(),a.preventDefault()})),a._watchers.push(d.$on("rangeEditChanged",function(b,c){a._nrEditing=c?a._nrEditing+1:a._nrEditing-1,a._nrEditing>1&&(g.confirmEdit(),a._nrEditing=1,b.targetScope.onEditBubble()),a._editing=a._nrEditing>0,g.setIsEditing(a._editing,a.$scope)})),a._watchers.push(d.$on("scrollPositionChanged",function(b,c){a._scrollPosition=c})),a._watchers.push(d.$on("selectWhileLocked",function(){a.selections&&a.selections.selectWhileLocked()})))):(a._watchers&&a._watchers.forEach(function(a){a()}),void(a._watchers=null))}var h;return h=a.extend("ColorLegend",{init:function(){var a=Array.prototype.slice.call(arguments);this._super.apply(this,a),this._nrEditing=0,this.$scope.options={};var b=this;this.formatValue=function(a){return b._formatter.formatValue(a)},this.$scope.positionToFormattedValue=function(a){return b.formatValue(d(a,b.$scope.viewItems,b.yMirrorMode&&!b.isVertical()))},this.$scope.positionToValue=function(a){return d(a,b.$scope.viewItems,b.yMirrorMode&&!b.isVertical())}},setData:function(a){this._super(a),this.setProperties(a.legend)},getSelectionIndices:function(){return this._colorMap.getSelectionIndices()},setSelectableShapes:function(a){this._super(a),this._dataInvalid=!0,this.invalidateProperties("Legend.setSelectableShapes")},setHasValidData:function(a){this._super(a),a||(this.clear(),this._clearScope(this.$scope))},_updateProperties:function(){return!!this._super()&&(this.$scope.selectionEnabled=!this.options._disableSelections&&this._mode.selectionEnabled&&this.$scope.interactionEnabled&&!!this.selections,this.$scope.selectionsApi=this.selectionsApi,this.$scope.selectionsCache=this._colorDataInfo&&this._colorDataInfo.altMode&&this.attributeSelectionsCache,void g(this,this.$scope,this.selections))},on:function(){this._super(),g(this,this.$scope,this.selections)},off:function(){this._super(),g(this,this.$scope,this.selections)},getType:function(){return this.selections},getSelectionMode:function(){return this._mode.legend},clearSelection:function(){this.$scope.$broadcast("clearSelection"),this.$scope.$broadcast("cancelSelection")},cancelSelection:function(){this.$scope.$broadcast("cancelSelection")},getScrollPosition:function(){return this._scrollPosition},setScrollPosition:function(a){this.$scope.explicitScrollPosition=a}}),Object.defineProperties(h.prototype,{selections:{get:function(){return this._selections},set:function(a){this._selections=a,g(this,this.$scope,this.selections)}}}),Object.defineProperty(h.prototype,"className",{value:"ColorLegend"}),h}),define("objects.views/selections/cache-item-combo",["./cache-item-base"],function(a){"use strict";var b=a.extend({addShape:function(a,b,c,d){this._super(a,b,c),void 0!==d&&(this._shapeMeasures||(this._shapeMeasures=[]),this._shapeMeasures.push(d))},getMeasuresIndecies:function(a){if(this._shapeMeasures&&void 0!==this._shapeMeasures[this._shapes.indexOf(a)]){var b=this._shapeMeasures[this._shapes.indexOf(a)];return void 0!==b?[b]:[]}return this._super()}});return b}),define("objects.views/charts/chart-data-helper",["objects.views/charts/utils/tree-node","objects.views/selections/cache-item-combo"],function(a,b){function c(a,b){var c=a?d(a):null;if(c){var e=c.getDimensions();if(e.length)return b.qText+","+e.join(",")}return b.qText}function d(a){return"P"===a.data.qType&&a.parent?a.parent.cacheItem:a.cacheItem}function e(b,c,d){var e,l=new a,m=[],n=[];return b&&b.length?(g=0,h=0,i=c&&c.length<2,j=c,k=d,l.data.qApprMaxGlyphCount=k[0]?k[0].qApprMaxGlyphCount:0,e=f(b[0].qSubNodes,l,m,n,0),{dimensionTree:e,cacheItems:m}):{dimensionTree:l,cacheItems:[]}}function f(e,m,n,o,p){var q,r,s,t,u,v;for(o[h]||(o[h]={}),s=0;s<e.length;s++){var w=[];if("T"!==e[s].qType){if(q=new a,q.data.qType=e[s].qType,q.data.qMaxPos=e[s].qMaxPos,q.data.qMinNeg=e[s].qMinNeg,"P"===e[s].qType&&(l=e[s]),"V"===e[s].qType||"E"===e[s].qType||"P"===e[s].qType?(q.data.qText=e[s].qText,q.data.qNum=e[s].qNum,q.data.qValue=e[s].qValue,q.data.rowIndex=0,i?(r=new a,r.data.qType="_M",r.data.qMaxPos=q.data.qMaxPos,r.data.qMinNeg=q.data.qMinNeg,r.data.qText=j[0].qFallbackTitle,r.data.rowIndex=e[s].qRow,r.addChild(q),q=r):q.data.rowIndex=e[s].qRow):(q.data.qText="O"===e[s].qType&&k[p]?k[p].othersLabel||"":e[s].qText,k[p+1]&&(q.data.qApprMaxGlyphCount=k[p+1].qApprMaxGlyphCount),q.data.qElemNo=e[s].qElemNo,q.data.rowIndex=e[s].qRow),m.addChild(q),"V"!==e[s].qType&&"P"!==e[s].qType){var x=c(m,e[s]);if(o[h][x]&&l)u=o[h][x],q.cacheItem=u;else{u=new b(null,null,null,null,e[s].qRow,h),q.cacheItem=u,u.addDimension(q.data.qText),u.id=e[s].qElemNo,"U"!==e[s].qType&&(e[s].qAttrDims&&e[s].qAttrDims.qValues.forEach(function(a,b){u.addAttributeDimension(a.qElemNo,a.qText,k[p].qAttrDimInfo[b].label)}),e[s].qAttrExps&&e[s].qAttrExps.qValues.forEach(function(a,b){w.push({value:a.qNum,label:k[p].qAttrExprInfo[b].label})}));var y=d(m);if(y){u=q.cacheItem,u.parent=y,y.children.push(u),v=u.parent.getDimensions();for(t in v)u.addDimension(v[t])}o[h][x]=u}}"V"===e[s].qType&&(u=d(m),u&&(u.addMeasure(l?l.qText:q.data.qText,e[s].qValue,e[s].qText),n.contains(u)||n.push(u))),e[s].qSubNodes&&e[s].qSubNodes.length>0&&(h++,q=f(e[s].qSubNodes,q,n,o,p+("V"!==e[s].qType?1:0))),w.forEach(function(a){u.addMeasure(a.label,a.value)})}}return 0===--h&&g++,m}var g,h,i,j,k,l;return{prepareData:e}}),define("objects.views/charts/chart-context",["./events/event-launcher","objects.views/charts/utils/tree-node","objects.views/charts/chart-data-helper","objects.views/selections/cache-item-combo"],function(a,b,c,d){"use strict";function e(a,c,d,e){var f=new b;return f.text=a,f.title=c,f.id=d,f.idx=e,f}function f(a,c){var d,e=new b;e.data.qApprMaxGlyphCount=0;for(d in c)e.data[d]=c[d];return a&&a.addChild(e),e}var g;return g=a.extend({init:function(a){this._super(),this._properties={},a&&this.refresh(a)},refresh:function(a){this._data=a,this._qDataObject=a.qHyperCube?a.qHyperCube:a.qListObject;var b;if("K"===this._qDataObject.qMode&&this._qDataObject.qStackedDataPages&&this._qDataObject.qStackedDataPages.length>0)b=this._generatePivotTree();else{if(!("S"===this._qDataObject.qMode&&this._qDataObject.qDataPages&&this._qDataObject.qDataPages.length>0))return;b=this._generateDimensionTree()}this._dimensionTree=b?b.dimensionTree:null,this._cacheItems=b?b.cacheItems:null,this.fire("dimensionTreeChanged")},bindProperty:function(){throw new Error("ChartContext bindProperty: Deprecated")},unBindProperty:function(){throw new Error("ChartContext unBindProperty: Deprecated")},releaseAll:function(){throw new Error("ChartContext releaseAll: Deprecated")},release:function(){this._data=null,this._dimensionTree=null,this._cacheItems=null,this._qDataObject=null},_generateDimensionTree:function(){var a,c,g,h,i,j,k,l,m,n,o,p,q,r,s=e(),t=this.getDataMatrix(),u=this._qDataObject,v=u.qMeasureInfo,w=u.qDimensionInfo,x=u.qDataPages[0].qArea.qTop,y=u.qDataPages[0].qTails,z=v.length,A=w.length,B=t&&t[0]?t[0].length:0,C=[],D=[];for(l=0,k=0;k<A;k++)w[k].qError||(C[l]=k,l++);if(A=l,0===A)return null;for(o=function(a,b){for(var c=0;c<a.length;c++)if(a[c].data.qElemNo===b)return c;return-1},k=0;k<t.length;k++){a=t[k],h=s;var E=[];for(l=0;l<A;l++){if(c=a[l],g=w[C[l]],!c)return;if(n=c.qIsOtherCell?void 0===h.data.othersIndex?-1:h.data.othersIndex:o(h.children,c.qElemNumber),n===-1){if(i=f(h,{qElemNo:a[l].qElemNumber,qText:a[l].qText,rowIndex:x+k,type:"dimension"}),void 0!==typeof a[l].qNum&&(i.data.qNum=a[l].qNum),c.qIsOtherCell&&(i.data.qIsOtherCell=!0,i.data.qText=g.othersLabel||""),c.qIsTotalCell&&(i.data.qIsTotalCell=!0),h.data.qApprMaxGlyphCount=g.qApprMaxGlyphCount,c.qIsOtherCell&&(h.data.othersIndex=h.children.length-1),p=new d([i.data.qText],null,null,null,x+k,l,i.data.qElemNo),c.qAttrDims&&g.qAttrDimInfo&&g.qAttrDimInfo.length&&c.qAttrDims.qValues.forEach(function(a,b){p.addAttributeDimension(a.qElemNo,a.qText,g.qAttrDimInfo[b].label)}),c.qAttrExps&&g.qAttrExprInfo&&g.qAttrExprInfo.length&&c.qAttrExps.qValues.forEach(function(a,b){E.push({value:a.qNum,label:g.qAttrExprInfo[b].label})}),h.cacheItem){p.parent=h.cacheItem,p.parent.children.push(p),q=p.parent.getDimensions();for(r in q)p.addDimension(q[r])}i.cacheItem=p,h=i}else h=h.children[n]}for(p=h.cacheItem,D.push(p),m=0;m<z&&A+m<B;m++)i=f(h,{qText:v[m].qFallbackTitle,qNum:a[A+m].qNum,rowIndex:x+k,type:"measure"}),h.data.qApprMaxGlyphCount=Math.max(h.qApprMaxGlyphCount,v[m].qApprMaxGlyphCount),p.addMeasure(i.data.qText,i.data.qNum,a[A+m].qText),j=new b,j.data={qText:a[A+m].qText,qNum:a[A+m].qNum,qElemNo:a[A+m].qElemNumber,qState:a[A+m].qState},i.addChild(j);E.forEach(function(a){p.addMeasure(a.label,a.value)})}return y&&y[0]&&(y[0].qUp>0||y[0].qDown>0)&&(s.children[s.children.length-1].incomplete=!0),{dimensionTree:s,cacheItems:D}},_generatePivotTree:function(){return c.prepareData(this._qDataObject.qStackedDataPages[0].qData,this._qDataObject.qMeasureInfo,this._qDataObject.qDimensionInfo)},_extractProperties:function(){throw new Error("ChartContext _extractProperties: Deprecated")},_updateProperty:function(){throw new Error("ChartContext _updateProperty: Deprecated")},getDataMatrix:function(){return this._qDataObject.qDataPages[0].qMatrix},getDimensionTree:function(){return this._dimensionTree},getCacheItems:function(){return this._cacheItems}})}),define("objects.views/charts/representation/legend-data-provider",["translator","../events/event-launcher","objects.views/charts/utils/tree-iterator"],function(a,b,c){function d(b,d){var e,f,g,h,i,j,k,l=[],m={},n=this._qDataObject,o=this._legendMarker?this._legendMarker:"rect",p=n?n.qDimensionInfo instanceof Array?n.qDimensionInfo:[n.qDimensionInfo]:null,q=this._colorMap;if(d=void 0===d?p.length-1:d[0],e=this._dimensionTree,b)for(i=n.qMeasureInfo,j=i.length,g=0;g<j;g++)l.push({label:i[g].qFallbackTitle,color:q.getColor(0,0,g),id:[-1],type:"measure",marker:this._legendMarker?this._legendMarker:this._measureLegendTypes?this._measureLegendTypes[g]||"box":"box"});else c.each.call(e,function(b){k=c.getLevel.call(b),k-1===d&&b.data.qElemNo!==-2&&void 0!==b.data.qText&&void 0===m[b.data.qText]&&(h=[],h[d]=b.data.qElemNo,f={label:b.data.qElemNo!==-3?b.data.qText:a.get("properties.dimensionLimits.others"),color:q.getColorFromPreScaledValue(b.data.qElemNo),id:[b.data.qElemNo],index:b.data.rowIndex,type:b.data.qElemNo!==-3?"dimension":"others",marker:o},l.push(f),m[b.data.qText]=f)});return l}function e(a,b){var c,d,e,f,g,h,i,j=[],k={},l=this._data.qListObject.qDataPages[0].qMatrix,m=this._qDataObject,n=m?m.qDimensionInfo instanceof Array?m.qDimensionInfo:[m.qDimensionInfo]:null,o=this._colorMap;if(b=void 0===b?n.length-1:b[0],a)for(c=this._data.qListObject.qMeasureInfo,d=c.length,f=0;f<d;f++)j.push({label:c[f].qFallbackTitle,color:o.getColor(0,0,f),id:[-1],type:"measure"});else for(e=0;e<l.length;e++)g=l[e][b],g.qElemNumber!==-3&&g.qElemNumbero!==-2&&void 0===k[g.qText]&&(h=[],h[b]=g.qElemNumber,i={label:g.qText,color:o.getColor(h,0,0,e),id:[g.qElemNumber],type:"dimension"},j.push(i),k[g.qText]=i);return j}function f(a){return a.discrete+","+a.boxType+","+a.colorMode}var g;return g=b.extend({init:function(a){this._data=a,this._colorMappings={}},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getColorMapping:function(){if(!this._colorMap||!this._data)return[];var a,b=this._colorMap.getColorDataInfo().legendMode;return"primary"===b.colorMode?[]:this._colorMappings[f(b)]?this._colorMappings[f(b)]:(a=b.discrete&&"range"===b.boxType||!b.discrete?this._colorMap.generateScaleBasedMapping():this._data.qListObject?e.apply(this,["measure"===b.colorMode,this._colorMap.getDimensionIndex()]):d.apply(this,["measure"===b.colorMode,this._colorMap.getDimensionIndex()]),this._colorMappings[f(b)]=a,a)},setData:function(a){var b=a.qHyperCube?a.qHyperCube:a.qListObject,c=a.qHyperCube?a.qHyperCube.qDimensionInfo:[a.qListObject.qDimensionInfo];this._qDataObject=b,this._data=a,a&&b.qDataPages.length?this._others=b.qDataPages[0].qMatrix.some(function(a){return c&&c.length&&a[c.length-1].qIsOtherCell===!0}):this._others=!1,this._colorMappings={}},setDimensionTree:function(a){this._dimensionTree=a,this._colorMappings={}},setMeasureLegendTypes:function(a){this._measureLegendTypes=a},setLegendMarker:function(a){this._legendMarker=a},getLegendMarker:function(){return this._legendMarker},release:function(){this._colorMap=null,this._dimensionTree=null,this._data=null,this._qDataObject=null}})}),define("general.utils/color-cache",["./color"],function(a){function b(a,b){return function(){var c,d,e=function(){};return e.prototype=a.prototype,c=new e,d=a.apply(c,b),Object(d)===d?d:c}}function c(){j++}function d(){var d,e,f,k;if(arguments.length<3)"string"==typeof arguments[0]?d=arguments[0]:"number"==typeof arguments[0]&&arguments[0]>=0&&(d=arguments[0]+"");else if(arguments.length>=3)for(d=arguments[0],f=0;f>arguments.length;f++)d+=","+arguments[f];if(d&&g[d])return g[d];if(k=b(a,arguments)(),e=k.isInvalid()?"INVALID":k._r+","+k._g+","+k._b+","+k._a,h[e])k=h[e];else{if(j>=i)return k;h[e]=k,c()}return d&&(g[d]=k),k}function e(d,e,f){var g,l,m=k(d._r+(e._r-d._r)*f),n=k(d._g+(e._g-d._g)*f),o=k(d._b+(e._b-d._b)*f),p=k(d._a+(e._a-d._a)*f);if(g=m+","+n+","+o+","+p,h[g])l=h[g];else{if(l=b(a,[m,n,o,p])(),j>=i)return l;h[g]=l,c()}return l}function f(){g={},h={},j=0}var g={},h={},i=5e3,j=0,k=Math.floor;return{retriveColor:d,retriveBlend:e,clear:f}}),define("objects.views/charts/representation/color-scale",["core.utils/class","general.utils/color-cache"],function(a,b){"use strict";function c(a,b,c){var d;if(a=h(g(a,1e-12),.999999999999),c){for(var e=0;e<c.length&&c[e]<=a;)e++;d=c.length-(e+(a-c[e-1])/(c[e]-c[e-1]))}else d=b-a*b;return d}function d(a){return a=a?a:this._startLevel,h(a,this._colorParts.length-1)}function e(a){a.forEach(function(a){a.forEach(function(a){a.reverse()}),a.reverse()})}var f,g=Math.max,h=Math.min,i=b.retriveColor(13816530);return f=a.extend({init:function(){this._colorParts=[],this._startLevel=0,this._reverse=!1,this._max=1,this._min=0,this._span=1,this._invalidSpan=!1},addColorPart:function(a,c,d){d=d||0,this._startLevel=g(d,this._startLevel),this._colorParts[d]||(this._colorParts[d]=[]),this._colorParts[d].push([b.retriveColor(a),b.retriveColor(c)])},setLimits:function(a){return a?(this._limits=a,void(this._expandedLimits=[0].concat(a,[1]))):(this._limits=null,void(this._expandedLimits=null))},setMaxMinValues:function(a,b){if(!(a>=b)||isNaN(a)||isNaN(b))throw"Incorrect arguments to color-scale->setMaxMinValues";this._max=a,this._min=b,this._span=a-b},setReverse:function(a){this._reverse!==a&&(this._reverse=a,e(this._colorParts))},getColor:function(a,e){var f,g,h,j,k,l,m,n=0===this._span?.5:(a-this._min)/this._span;return isNaN(n)?i:(e=d.apply(this,[e]),f=c(n,this._colorParts[e].length,this._expandedLimits),g=Math.floor(f),g=g===f?g-1:g,j=this._colorParts[e][g],k=j[0],l=j[1],h=f-g,m=b.retriveBlend(k,l,h))},getColors:function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(this.getColor(a[b]));return c},getLegendParts:function(a){var b,c,e,f=[];for(a=d.apply(this,[a]),c=this._colorParts[a].length,b=0;b<c;++b)e=this._colorParts[a][b],f.push({grad:e,color:e[0],solid:e[0]===e[1],index:b});return f}}),f._limitFunction=c,f}),define("objects.views/charts/representation/sequential-color-map",["jquery","client.utils/theme/theme","general.utils/color-cache","objects.views/charts/events/event-launcher","objects.views/charts/representation/color-scale"],function(a,b,c,d,e){"use strict";function f(a,b){var c,d,f,g=new e;if(b){for(d=0;d<a.length;d++)if(f=a[d])for(c=0;c<f.length;c+=2)g.addColorPart(f[c],f[c+1],d)}else for(c=0;c<a.length;c+=2)g.addColorPart(a[c],a[c+1]);return g}function g(a,b,c,d,e){var f,h,i,j,k=0,l=[];if(f=(a-b)/(d+1),0===f)return 1;for(h=0;h<c.length;h++)i=.99*(c[h]-b),j=c[h]>a?Math.floor(a/f):c[h]<b?0:Math.floor(i/f),isNaN(j)||(l[j]?l[j]++:l[j]=1);for(h=0;h<l.length;h++)l[h]&&k++;return k<=d||k>=e?Math.max(k,d):g(a,b,c,++d,e)}function h(a){var b,c=[];for(b=0;b<a.length;b++)a[b]?c.push(i(a[b],!1)):c.push(null);return c}function i(a,b){var c=1,d=[];for(d.push(a[0]),b||d.push(a[0]);c<a.length-1;c++)d.push(a[c]),d.push(a[c]);return c<a.length&&(d.push(a[c]),b||d.push(a[c])),d}function j(a){var b=this._sequentialScales={},c=0;a.colorSchemes.ordinalScales.forEach(function(a){b[a.propertyValue]={type:a.type,scale:f("class-pyramid"===a.type?h(a.scale):i(a.scale,"gradient"===a.type),"class-pyramid"===a.type)},c=l(a.scale.length,c)}),this._largestScaleSize=c,this._wrangled=[],this._activeScale=this._sequentialScales[a.colorSchemes.ordinalScales[0].propertyValue].scale}var k,l=Math.max;return k=d.extend({init:function(a){j.call(this,b),b.ThemeChanged.bind(function(){j.call(this,b)}.bind(this)),this._measure=0,this.setData(a)},setData:function(a,b){if(this._data=a,this._colorDataInfo=b,a){if(!b.valid)return this._legendTitle="",void(this._wrangled=[]);var c=a.color||{},d=a.qHyperCube?a.qHyperCube:a.qListObject;if(this._qDataObject=d,this._validColorInformation=this._colorDataInfo.valid&&!this._colorDataInfo.allNaN,this._byExpression="byExpression"===c.mode,this._legendTitle=this._colorDataInfo.legendTitle,void 0!==c.measureScheme){this._classes=!1,this._invalidSpan=!1,this._activeScale=this._sequentialScales[c.measureScheme].scale,this._classes="class-pyramid"===this._sequentialScales[c.measureScheme].type,void 0!==c.reverseScheme&&this._activeScale.setReverse(c.reverseScheme===!0);var e=this._getMinMax();this._invalidSpan=!e,!this._invalidSpan&&this._validColorInformation&&(this._activeScale.setMaxMinValues(e.max,e.min),this._wrangled=this._colorDataInfo.wrangled,this._numUsedColors=this._colorDataInfo.persistentColors?[Math.min(this.getLargestScaleSize(),this._colorDataInfo.dimSize)]:[g(e.max,e.min,this._wrangled,1,this.getLargestScaleSize())])}}},getColor:function(a,d,e,f){var g=Array.isArray(a)?a[this._colorDataInfo.dimIndex]:a;return f=this._byExpression||void 0===this._wrangled[d]?f:this._wrangled[d],g===-3||Array.isArray(a)&&a.indexOf(-3)!==-1?c.retriveColor(b.colorSchemes.othersColor):g===-2?c.retriveColor(b.colorSchemes.nullColor):this._byExpression||!this._invalidSpan&&!isNaN(f)&&this._validColorInformation?this._activeScale.getColor(f,this._getNumUsedColors(0)):c.retriveColor(b.colorSchemes.nullColor)},getColorFromPreScaledValue:function(a){return this._activeScale.getColor(a,this._getNumUsedColors(0))},getActiveScale:function(){return this._activeScale},getLargestScaleSize:function(){return this._largestScaleSize||0},generateScaleBasedMapping:function(){var b,c,d,e,f,g,h,i,j,k,l=this.getValueFormatter();if(k=this._activeScale,j=[],h=k.getLegendParts(this._getNumUsedColors(0)),b=this._getMinMax(),!b)return j;if(c=b.max-b.min,isNaN(c))return j;for(f=h.length,e=c/f,g=b.max,!isNaN(b.measureMax)&&this._classes&&(i=a.extend(!0,{},h[0]),i.isMax=!0,i.min=l.formatValue(g),i.id=[b.measureMax,g],i.type="range",j.push(i)),d=0;d<f-1;d++)i=h[d],i.isMax=0===d,i.max=l.formatValue(g),i.min=l.formatValue(g-e),i.id=[g,g-e],i.type="range",g-=e,j.push(i);return i=h[d],i.max=l.formatValue(g),i.min=l.formatValue(b.min),i.id=[g,b.min],i.type="range",j.push(i),!isNaN(b.measureMin)&&this._classes&&(i=a.extend(!0,{},h[d]),i.max=l.formatValue(b.min),i.min=void 0,i.id=[b.min,b.measureMin],i.type="range",j.push(i)),j},getColorMapping:function(){return this.generateScaleBasedMapping()},getLegendMode:function(){return[this._classes?"box":"scale",this._classes?"range":"item","measure"]},getLegendTitle:function(){return this._legendTitle},setMeasureFormatters:function(a){this._measureFormatters=a},setGenericFormatter:function(a){this._formatter=a},getValueFormatter:function(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:{formatValue:function(a){return a}}},_getMinMax:function(){var a;return this._data.color.autoMinMax===!1?(a={min:this._data.color.measureMin||0,max:this._data.color.measureMax||10},a.max>=a.min?a:null):this._validColorInformation&&this._colorDataInfo.minMax?a=this._colorDataInfo.minMax:null},_getNumUsedColors:function(a){return this._numUsedColors?this._numUsedColors[a]:0},calculateNumberOfUsedColors:g})}),define("objects.views/charts/representation/color-map-data-wrangler",[],function(){function a(b,c,d){if(c===d)return[b];var e=[];return"U"!==b.qType&&"O"!==b.qType&&"T"!==b.qType&&b.qSubNodes.forEach(function(b){e=e.concat(a(b,c+1,d))}),e}function b(a){return a.some(function(a){return a.qIsNull||a.qElemNumber===-2||a.qElemNumber===-3})}function c(c,d,e,f,g,h,i){d=d||0,e=e||0,h=h||e,i=i!==!1;var j,k=0,l=[],m=[];if(c){if(c.qDataPages[0]){var n=c.qDataPages[0].qMatrix;k=c.qDataPages[0].qArea.qTop||k,n.forEach(function(a,c){!g&&b(a)||(m[c]=a[e])}),j=g?f?"qElemNo":"qElemNumber":"qNum"}else if(c.qStackedDataPages[0]){var o=c.qStackedDataPages[0].qData[0];m=a(o,0,e+1);var p=[];h>e?m.forEach(function(b){var c=a(b,0,h-e);c.forEach(function(a){p[a.qRow]=b})}):(p=[],m.forEach(function(a){p[a.qRow]=a})),m=p,j=g?"qElemNo":f?"qNum":"qValue"}f?i?m.forEach(function(a,b){l[k+b]=a[f].qValues[d][j]}):m.forEach(function(a,b){l[k+b]=a[f].qValues[d]}):i?m.forEach(function(a,b){l[k+b]=a[j]}):m.forEach(function(a,b){l[k+b]=a})}return l}return{wrangleData:c}}),define("objects.utils/date-formatter",["core.utils/class"],function(a){"use strict";function b(a,b){for(var c=a.length;c<b;c++)a="0"+a;return a}function c(a,b){var c=a.getHours(),d=a.getDay()-1;return b&&(c%=12,c||(c=12)),d<0&&(d=6),{year:a.getFullYear(),month:a.getMonth(),day:d,date:a.getDate(),h:c,m:a.getMinutes(),s:a.getSeconds(),f:a.getMilliseconds(),t:a.getHours()>=12?"pm":"am"}}function d(a){var b=a.toString().split(".");return b[1]?b=Number("0."+b[1]):0}function e(a){var b=a,c=24*d(b),e=60*d(c),f=60*d(e),g=1e3*d(f);return{d:Math.floor(b),h:Math.floor(c),m:Math.floor(e),s:Math.floor(f),f:Math.round(g)}}function f(a,b){var c,d=e(a),f=d.d,g=d.h,h=d.m,i=d.s,j=d.f,k=0;return/w+|t+/gi.test(b)&&(c=new Date(1899,11,30+Math.floor(a),0,0,86400*(a-Math.floor(a))),isNaN(c.getTime())&&(c=null)),/D+/gi.test(b)||(g+=24*f),/h+/gi.test(b)||(h+=60*g),/m+/gi.test(b)||(i+=60*h),/w+/gi.test(b)&&(k=c?c.getDay()-1:0,k<0&&(k=6)),{year:0,month:0,day:k,date:f,h:g,m:h,s:i,f:j,t:c?c.getHours()>=12?"pm":"am":""}}function g(a,c){return{"Y+|y+":{Y:Number((c.year+"").slice(-2))+"",YY:b((c.year+"").slice(-2),2),YYY:b((c.year+"").slice(-3),3),def:function(a){return b(c.year+"",a.length)}},"M+":{M:c.month+1,MM:b(c.month+1+"",2),MMM:a.locale_months_abbr[c.month],def:a.locale_months[c.month]},"W+|w+":{W:c.day,WW:b(c.day+"",2),WWW:a.locale_days_abbr[c.day],def:a.locale_days[c.day]},"D+|d+":{D:c.date,def:function(a){return b(c.date+"",a.length)}},"h+|H+":{h:c.h,def:function(a){return b(c.h+"",a.length)}},"m+":{m:c.m,def:function(a){return b(c.m+"",a.length)}},"s+|S+":{s:c.s,def:function(a){return b(c.s+"",a.length)}},"f+|F+":{def:function(a){var b=c.f+"",d=a.length-b.length;if(d>0)for(var e=0;e<d;e++)b+="0";else d<0&&(b=b.slice(0,a.length));return b}},"t{1,2}|T{1,2}":{def:function(a){var b=c.t;return a[0].toUpperCase()===a[0]&&(b=b.toUpperCase()),b=b.slice(0,a.length)}}}}var h,i=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],j=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],k=["January","February","March","April","May","June","July","August","September","October","November","December"],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return h=a.extend({init:function(a,b){var c=a||{};c.qCalendarStrings||(c.qCalendarStrings={qLongDayNames:i,qDayNames:j,qLongMonthNames:k,qMonthNames:l}),this.localeInfo=c,this.locale_days=c.qCalendarStrings.qLongDayNames.slice(),this.locale_days_abbr=c.qCalendarStrings.qDayNames.slice(),this.locale_months=c.qCalendarStrings.qLongMonthNames.slice(),this.locale_months_abbr=c.qCalendarStrings.qMonthNames.slice(),this.pattern=b},clone:function(){var a=new h(this.localeInfo,this.pattern);return a.subtype=this.subtype,a},format:function(a,b){b||(b=this.pattern?this.pattern:"YYYY-MM-DD hh:mm:ss"),b=b.replace(/\[.+\]|\[|\]/g,"");var d,e=/t+/gi.test(b);d=a instanceof Date?c(a,e):f(a,b);var h=g(this,d),i=[];for(var j in h)i.push(j);var k=new RegExp(i.join("|"),"g"),l=b.replace(k,function(a){var b;for(var c in h)if(b=new RegExp(c),b.test(a))break;if(!b)return"";var d;for(var e in h[c])if(e===a||e.toLowerCase()===a){d=h[c][e],"undefined"==typeof d&&(d=h[c][e.toLowerCase()]);break}return"undefined"==typeof d&&(d=h[c].def),"function"==typeof d&&(d=d(a)),d});return l}}),h.parseInterval=e,h}),define("objects.utils/num-date-time-formatter",["objects.utils/number-formatter","objects.utils/date-formatter"],function(a,b){"use strict";function c(a){if(isNaN(a)||!isFinite(a))return 1;var b=Number(a).toExponential(),c=b.split("e"),d=1;return"+"===c[1][0]&&(d+=Number(c[1])),d}function d(a){if(isNaN(a)||!isFinite(a))return 0;var b,c=Number(a).toExponential(),d=c.split("e"),e=0;return"-"===d[1][0]?(e=Math.abs(Number(d[1])),d=d[0].split("."),d[1]&&(e+=d[1].length)):(b=Number(d[1]),d=d[0].split("."),e=d[1]?d[1].length-b:0),e}var e,f={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"};return e=a.extend("QFormatter",{init:function(c,d,e,g,h){var i=c||{};this.localeInfo=i,this.pattern=d||"",this.decimalDelimiter="string"==typeof g?g:"string"==typeof i.qDecimalSep?i.qDecimalSep:".",this.thousandDelimiter="string"==typeof e?e:"string"==typeof i.qThousandSep&&this.decimalDelimiter!==i.qThousandSep?i.qThousandSep:"",this.type=h||f.AUTO,h===f.AUTO&&(this.pattern="#"+this.decimalDelimiter+"##A"),this._numberFormatter=new a(c),this._dateFormatter=new b(c),this.prepare()},clone:function(){return new e(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type)},prepare:function(a,b,c){if(a||(a=this.pattern),!a)switch(this.type){case f.INTEGER:a="##############";break;case f.NUMBER:a=Array(this.localeInfo.qnDec||11).join("#");break;case f.FIXED_TO:a="#"+this.localeInfo.qDecimalSep||"."+Array(this.localeInfo.qnDec||4).join("#");break;case f.MONEY:a=this.localeInfo.qMoneyFmt,c||(c=this.localeInfo.qMoneyDecimalSep||"."),b||c===this.localeInfo.qMoneyThousandSep||(b=this.localeInfo.qMoneyThousandSep);break;case f.DATE:a=this.localeInfo.qDateFmt||"YYYY-MM-DD";break;case f.DATE_TIME:a=this.localeInfo.qTimestampFmt||"YYYY-MM-DD hh:mm:ss";break;case f.TIME:case f.INTERVAL:a=this.localeInfo.qTimeFmt||"hh:mm:ss";break;default:a="##########"}this._numberFormatter.pattern=this.pattern,this._dateFormatter.pattern=this.pattern,this._numberFormatter.thousandDelimiter=this.thousandDelimiter,this._numberFormatter.decimalDelimiter=this.decimalDelimiter,this._numberFormatter.type=this.type,this._numberFormatter.prepare(a,b,c),this._prepared={pattern:a,t:b,d:c}},formatValue:function(a,b){var c,d=this._prepared;if("NaN"===a||"number"==typeof a&&isNaN(a))return"-";if(isNaN(a)||"number"!=typeof a)return a+"";switch(this.type){case f.DATE:case f.TIME:case f.DATE_TIME:return c=new Date(1899,11,30+Math.floor(a),0,0,86400*(a-Math.floor(a))),isNaN(c.getTime())?this._numberFormatter.format(a,"0",d.t,d.d):this._dateFormatter.format(c,b||d.pattern);case f.INTERVAL:return this._dateFormatter.format(a,d.pattern);default:return this._numberFormatter.formatValue(a)}},format:function(a,b,c,d){return"NaN"===a||"number"==typeof a&&isNaN(a)?"-":isNaN(a)||"number"!=typeof a?a+"":(this.prepare(b,c,d),
this.formatValue(a))},createPatternFromRange:function(a,b,c){var d,e,f,g="",h=Number(Number(a).toExponential().split("e")[1]),i=Number(Number(b).toExponential().split("e")[1]),j=Math.min(Math.abs(h),Math.abs(i)),k=Math.abs(b-a),l=Number(Number(k/50).toExponential().split("e")[1]);if(f=Math.abs(l),0===k)return"0"+this.decimalDelimiter+"##"+(c?"A":"");if(l>=0?f=c?Math.max(2,j-l):0:(e=(c?j-j%3:0)*(i<0?1:-1),f-=e),g+=this.thousandDelimiter?"#"+this.thousandDelimiter+"##0":"0",f)for(g+=this.decimalDelimiter,d=0;d<f;d++)g+="#";return g+(c?"A":"")}}),e.getSignificantIntegers=function(a){return c(a)},e.getSignificantDecimals=function(a){return d(a)},e}),define("objects.views/charts/representation/expression-color-map",["client.utils/theme/theme","general.utils/color-cache","objects.views/charts/representation/sequential-color-map","objects.views/charts/representation/color-map-data-wrangler","general.utils/attribute-expression-util","objects.utils/num-date-time-formatter","translator"],function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c,d=-Number.MAX_VALUE,e=Number.MAX_VALUE,f=!0;return b.color.autoMinMax===!1?{min:b.color.measureMin||0,max:b.color.measureMax||10}:a?(a.forEach(function(a){c=a.value,isNaN(c)||(d=Math.max(d,c),e=Math.min(e,c),f=!1)}),f?null:{min:e,max:d}):null}function i(a){var c=[];return a.forEach(function(a,d){c[d]={color:b.retriveColor(isNaN(a.qNum)?a.qText:a.qNum,"argb"),value:a.qNum}}),c}var j;return j=c.extend({init:function(a){this._formatter=new f(null),this._super(a)},setData:function(a,b){if(this._super(a,b),this._wrangledMapping=[],a){var c=a.color||{},f=a.qHyperCube?a.qHyperCube:a.qListObject;if(this._qDataObject=f,this._data=a,this._isColorExpression=c.expressionIsColor!==!1,this._byExpression="byExpression"===c.mode,this._expressionLabel=c.expressionLabel&&""!==c.expressionLabel?c.expressionLabel:g.get("Object.ChartTooltip.ColorExpression"),this._byExpression){var j=-1,k=-1;if(f.qDimensionInfo.concat(f.qMeasureInfo).forEach(function(a,b){a.qAttrExprInfo&&a.qAttrExprInfo.every(function(a,c){a.id===e.IDMAP.COLOR_BY_EXPRESSION&&(j=b,k=c)})}),!(j>=0&&k>=0))return;var l=d.wrangleData(f,k,j,"qAttrExps",j<f.qDimensionInfo.length,f.qDimensionInfo.length-1,!1);if(this._wrangledMapping=i(l),this._minMax=h(this._wrangledMapping,a),!this._minMax)return;var m=this._wrangledMapping;this._numUsedColors=[this.calculateNumberOfUsedColors(this._minMax.max,this._minMax.min,m.map(function(a){return a.value}),1,this.getLargestScaleSize())],this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare(),this._activeScale.setMaxMinValues(this._minMax.max,this._minMax.min)}else this._minMax=null,this._mapping=null,this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()}},getColor:function(c,d,e,f){if(!this._byExpression)return this._super(c,d,e,f);var g,h;if(h=Array.isArray(c)?this._dimIndex>=0?c[this._dimIndex]:void 0:c,h===-3||void 0===h&&Array.isArray(c)&&c.indexOf(-3)!==-1)return b.retriveColor(a.colorSchemes.othersColor);if(h===-2)return b.retriveColor(a.colorSchemes.nullColor);var i=this._wrangledMapping?this._wrangledMapping[d]:null;return!i||i.color.isInvalid()&&this._isColorExpression?b.retriveColor(a.colorSchemes.nullColor):g=this._isColorExpression?i.color:this._super(c,d,0,i.value)},getExpressionValue:function(a){return!this._wrangledMapping[a]||this._isColorExpression?void 0:this._wrangledMapping[a].value},getLegendTitle:function(){return this._byExpression?this._expressionLabel:this._super()},getLegendMode:function(){return this._byExpression?this._isColorExpression?["box","item","primary",!0]:[this._classes?"box":"scale",this._classes?"range":"item","measure",!0]:this._super()},getValueFormatter:function(){return this._byExpression||this._colorDataInfo&&this._colorDataInfo.altMode?this._formatter:this._measureFormatters&&this._measureFormatters[0]?this._measureFormatters[0]:this._formatter},setGenericFormatter:function(a){this._super(a),this._byExpression&&this._minMax?(this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare()):this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()},getGenericFormatter:function(){return this._formatter},_getMinMax:function(a,b){return this._byExpression?this._minMax?{min:this._minMax.min,max:this._minMax.max}:null:this._super(a,b)}})}),define("objects.views/charts/representation/qualitative-color-map",["translator","client.utils/theme/theme","general.utils/color-cache","objects.views/charts/events/event-launcher"],function(a,b,c,d){"use strict";function e(a){return b.palette[a]?b.palette[a]:a}function f(a,b){var c=b||0,d=[];return a.forEach(function(a){void 0===d[a]&&a>=0&&(d[a]=c,c++)}),d}function g(a){return this._persistColors||this._measureMode?a:this._reMappedIndeces[a]}function h(){j={},b.colorSchemes.qualitativeScales.forEach(function(a){j[a.propertyValue]={type:a.type,scale:a.scale}})}var i,j,k,l,m="auto",n="primary",o="measure",p="multiple";return i=d.extend({init:function(a,c){c=c||{},this._primaryColorMode=c.colorBy||m,this._autoMode=c.autoMode||m,this._primaryColor=b.colorSchemes.primaryColor,this._persistColors=!0,this._wrangled=[],this._dimIndex=0,h(),b.ThemeChanged.bind(function(){h()}),k=j[b.colorSchemes.qualitativeScales[0].propertyValue],l=k.scale,this._qualitativeScale=l[l.length-1],a&&this.setData(a)},setData:function(b,c){if(this._data=b,this._colorDataInfo=c,!c.valid)return this._dimLabel="",void(this._wrangled=[]);var d=b.color||{},g=b.qHyperCube?b.qHyperCube:b.qListObject,h=g&&g.qMeasureInfo?g.qMeasureInfo.length:0;this._colorMode=d.auto?m:d.mode||n,this._internalMode=this._colorDataInfo.internalMode,this._measureMode=this._internalMode===p||"byMultiple"===this._colorMode,this._persistColors=this._colorDataInfo.persistentColors,this._dimIndex=this._colorDataInfo.dimIndex||0,this._measureMode?this._dimLabel=a.get("Common.Measures"):this._dimLabel=this._colorDataInfo.legendTitle,this._wrangled=this._colorDataInfo.wrangled,this._dimSize=this._measureMode?h:this._colorDataInfo.dimSize,this._persistColors||(this._reMappedIndeces=f(this._wrangled,this._colorDataInfo.top)),void 0!==d.singleColor&&(this._primaryColor=e(d.singleColor));var i=d.dimensionScheme&&j[d.dimensionScheme]||k;this._dimSize>l.length||!this._dimSize?this._qualitativeScale="pyramid"===i.type?i.scale[i.scale.length-1]:i.scale:"pyramid"===i.type?this._qualitativeScale=i.scale[(this._dimSize-1)%i.scale.length]:this._qualitativeScale=l[(this._dimSize-1)%l.length]},getColor:function(a,d,e){var f=Array.isArray(a)?this._dimIndex>=0?a[this._dimIndex]:void 0:a,h=this._measureMode?e:this._wrangled[d];return f===-3||Array.isArray(a)&&a.indexOf(-3)!==-1?c.retriveColor(b.colorSchemes.othersColor):f===-2?c.retriveColor(b.colorSchemes.nullColor):this._internalMode===n&&this._colorMode===m?c.retriveColor(b.colorSchemes.primaryColor):this._internalMode===n?c.retriveColor(this._primaryColor):isNaN(h)||h===-2?c.retriveColor(b.colorSchemes.nullColor):(h=g.call(this,h),c.retriveColor(this._qualitativeScale[h%this._qualitativeScale.length]))},getLegendMode:function(){var a=this._internalMode===n?n:this._autoMode===o||this._primaryColorMode===o||this._measureMode?"measure":"dimension";return["box","item",a,"measure"===a]},getColorFromPreScaledValue:function(a){return isNaN(a)?c.retriveColor(b.colorSchemes.errorColor):a===-3?c.retriveColor(b.colorSchemes.othersColor):a===-2?c.retriveColor(b.colorSchemes.nullColor):(a=g.call(this,a),c.retriveColor(this._qualitativeScale[a%this._qualitativeScale.length]))},getDimensionIndex:function(){return this._colorDataInfo?this._dimIndex:0},getLegendTitle:function(){return this._dimLabel}})}),define("objects.views/charts/representation/combo-color-map-tooltip-util",[],function(){function a(a,b){return'<div class="color-template-wrapper"><div class="color-dot" style="background:'+b+'"></div><span>'+a+"</span></div>"}return{createLegendTemplate:a}}),define("objects.views/charts/representation/combo-color-map",["translator","objects.views/charts/events/event-launcher","objects.views/charts/representation/legend-data-provider","objects.views/charts/representation/expression-color-map","objects.views/charts/representation/qualitative-color-map","objects.views/charts/representation/combo-color-map-tooltip-util","objects.views/charts/representation/color-map-data-wrangler","general.utils/attribute-expression-util"],function(a,b,c,d,e,f,g,h){function i(a,b,c,d){var e=Array.isArray(d.qDimensionInfo)?d.qDimensionInfo.length:1,f=d.qMeasureInfo?d.qMeasureInfo.length:0;return a&&a!==u?"byMultiple"===a?a=z:"byDimension"===a?a=w:"byMeasure"===a?a=x:"byExpression"===a&&(a=y):a=b===v||c===u&&e<=1&&f<=1?v:f>1&&c!==w&&a!==v?z:w,a}function j(a){var b=Number.MIN_VALUE,c=Number.MAX_VALUE,d=!0;return a.forEach(function(a){isNaN(a)||(b=Math.max(a,b),c=Math.min(a,c),d=!1)}),{min:d?0:c,max:d?10:b}}function k(a){return a&&a.length?(a=a.filter(function(a){return"N"===a.qType}),a.length>1||"V"===a[0].qSubNodes[0].qType&&1===a.length?0:1===a.length?1+k(a[0].qSubNodes):void 0):0}function l(a,b,c,d,e){var f,g=0,h=Array.isArray(b),i=h?b.length:1;if(c&&!a)for(g;g<i;++g)if(f=h?b[g].cId:b.cId,f===c)return g;var j=e.qStackedDataPages&&e.qStackedDataPages.length&&e.qStackedDataPages[0].qData&&e.qStackedDataPages[0].qData.length?e.qStackedDataPages[0].qData[0].qSubNodes:null;return d===B?k(j):i-1}function m(a,b,c,d,e){return b===w?a||c.qDimensionInfo.length>1||e&&c.qSize.qcy>d.qArea.qHeight:b===x&&("K"===c.qMode||c.qSize.qcy>d.qMatrix.length)}function n(a,b,c){var d=0;if(0===c){for(;a&&a.parent;)a=a.parent;return a}for(;b;){if(a.getDimensions().length-1===c)return a;if(a.getDimensions().length-1-d===c)return b;b=b.parent,d++}}var o,p="auto",q="qualitative",r="primary",s="expression",t="measure",u="auto",v="primary",w="dimension",x="measure",y="expression",z="multiple",A="error",B="first",C="last";return o=b.extend({init:function(a,b){b=b||{},this._primaryColorMode=b.colorBy||u,this._autoMode=b.autoMode||u,this._multiDimScheme=b.multiDimScheme||C,this._qualitativeMap=new e(null,b),this._sequentialMap=new d(null,b),this._legendDataProvider=new c(a),this._legendDataProvider.setColorMap(this),this._enableAltMode=!0,this._colorDataInfo={dimIndex:0,wrangled:[],valid:!1},this._title="DEBUG",a&&this.setData(a)},getColor:function(a,b,c,d){return this._colorDataInfo.internalMode===A?this._qualitativeMap.getColor(-2):this._colorMode===t||this._colorMode===s?this._sequentialMap.getColor(a,d,c,b):this._qualitativeMap.getColor(a,d,c,b)},getColorFromPreScaledValue:function(a){return this._colorMode===t||this._colorMode===s?this._sequentialMap.getColorFromPreScaledValue(a):this._qualitativeMap.getColorFromPreScaledValue(a)},getTooltipContent:function(b){var c,d,e,g,h=null;if(this._colorDataInfo.valid)if(this._colorMode===s&&(c=this._sequentialMap.getExpressionValue(b.row),void 0!==c&&(this._sequentialMap.getValueFormatter&&(d=this._sequentialMap.getValueFormatter())&&(c=d.formatValue(c)),h={label:this.getLegendTitle(),template:f.createLegendTemplate(c,this._sequentialMap.getColor(b.id,b.row,0,c))})),this._colorDataInfo.altMode){if("dimension"===this._colorDataInfo.internalMode){var i=b._attrDims[this._colorDataInfo.attrIndex];if(!i)return;if(b.id===-3)g=b.id===-3?a.get("properties.dimensionLimits.others"):i.label?i.label:"",e=this._qualitativeMap.getColorFromPreScaledValue(-3);else{if(i.value===-2)return;g=i.label?i.label:"",e=this._qualitativeMap.getColorFromPreScaledValue(i.value)}}else"measure"===this._colorDataInfo.internalMode&&(c=b.values[this._colorDataInfo.legendMode.rangeSelectionIndex],g=this._sequentialMap.getGenericFormatter&&(d=this._sequentialMap.getGenericFormatter())?d.formatValue(c):c,e=this._sequentialMap.getColorFromPreScaledValue(c));h={label:this.getLegendTitle(),template:f.createLegendTemplate(g,e)}}else if("dimension"===this._colorDataInfo.internalMode){var j=b.getDimensions(),k=j[j.length-this._colorDataInfo.dimIndex-1];if(!k)return;g=k;var l=n(b,b,this._colorDataInfo.dimIndex);e=this._qualitativeMap.getColorFromPreScaledValue(l.id),h={label:this.getLegendTitle(),template:f.createLegendTemplate(g,e)}}return h},getColorMapping:function(){return this._legendDataProvider.getColorMapping()},generateScaleBasedMapping:function(){return this._sequentialMap.generateScaleBasedMapping()},getSelectionIndices:function(){return this.getDimensionIndex()},getLegendTitle:function(){return this._colorMode===t||this._colorMode===s?this._sequentialMap.getLegendTitle():this._qualitativeMap.getLegendTitle()},getDimensionIndex:function(){return this._colorMode===t?[0]:[this._qualitativeMap.getDimensionIndex()]},setData:function(a){if(this._colorMode=q,this._data=a,this._colorDataInfo={dimIndex:0,wrangled:[],valid:!1},a.color){var b=a.color,c=a.qHyperCube;this._colorDataInfo.internalMode=i(b.auto?u:b.mode||u,this._autoMode,this._primaryColorMode,c);var d,e,f=this._data.qHyperCube.qDimensionInfo.length-1,k=this._data.qHyperCube.qDataPages[0]||this._data.qHyperCube.qStackedDataPages[0]||{qArea:{qHeight:0}},n=a.qHyperCube.qDimensionInfo[f],o=a.qHyperCube.qMeasureInfo[0],z=f,B=f,C=-1;if(this._colorDataInfo.internalMode===w?(C=h.getIndexById(n.qAttrDimInfo,h.IDMAP.COLOR_BY_ALTERNATIVE),d=C!==-1?n.qAttrDimInfo[C]:null,e="qAttrDims"):this._colorDataInfo.internalMode===x&&(C=h.getIndexById(n.qAttrExprInfo,h.IDMAP.COLOR_BY_ALTERNATIVE),d=C!==-1?n.qAttrExprInfo[C]:null,e="qAttrExps"),this._colorDataInfo.altMode=this._enableAltMode&&!!d&&f>=0&&C>=-1,this._colorDataInfo.valid=this._colorDataInfo.altMode&&d&&!d.qError||!this._colorDataInfo.altMode&&!!n,!this._colorDataInfo.valid)return this._colorDataInfo.internalMode=A,void(this._colorDataInfo.allNaN=!0);if(this._colorDataInfo.dimIndex=f,this._colorDataInfo.attrIndex=C,this._colorDataInfo.hasOthers=!!a.qHyperCube.qHasOtherValues,this._colorDataInfo.persistentColors=m(b.persistent,this._colorDataInfo.internalMode,c,k,this._colorDataInfo.altMode),this._colorDataInfo.top=k.qArea.qTop,this._colorDataInfo.altMode?(this._colorDataInfo.internalMode===x?(this._colorDataInfo.minMax={min:d.qMin||0,max:d.qMax||10},this._colorDataInfo.dimSize=b.autoMinMax===!1?n.qCardinal:a.qHyperCube.qSize.qcy):this._colorDataInfo.internalMode===w&&(this._colorDataInfo.dimSize=this._colorDataInfo.persistentColors?d.qCardinal:d.qSize.qcy),this._colorDataInfo.legendTitle=d.label||d.qFallbackTitle):this._colorDataInfo.internalMode===x?(z=f+1,this._colorDataInfo.minMax=isNaN(o.qMin)||isNaN(o.qMax)?null:{min:o.qMin||0,max:o.qMax||10},this._colorDataInfo.legendTitle=o.qFallbackTitle,this._colorDataInfo.dimSize=b.autoMinMax===!1?n.qCardinal:a.qHyperCube.qSize.qcy):this._colorDataInfo.internalMode===w?(this._colorDataInfo.dimIndex=f=z=l(b.auto,c.qDimensionInfo,b.dimensionId,this._multiDimScheme,c),n=a.qHyperCube.qDimensionInfo[f],this._colorDataInfo.legendTitle=n.qFallbackTitle,this._colorDataInfo.dimSize=this._colorDataInfo.persistentColors?n.qCardinal:a.qHyperCube.qSize.qcy):this._colorDataInfo.internalMode===y&&(this._colorDataInfo.dimSize=b.autoMinMax===!1?n.qCardinal:a.qHyperCube.qSize.qcy),this._colorDataInfo.internalMode!==x&&this._colorDataInfo.internalMode!==w||(this._colorDataInfo.wrangled=g.wrangleData(a.qHyperCube,C,z,!(!this._colorDataInfo.altMode||!this._colorDataInfo.valid)&&e,this._colorDataInfo.internalMode===w,B),this._colorDataInfo.allNaN=this._colorDataInfo.altMode&&0===this._colorDataInfo.wrangled.filter(function(a){return a!==-2&&!isNaN(a)}).length),this._colorDataInfo.internalMode!==x||this._colorDataInfo.persistentColors||(this._colorDataInfo.minMax=j(this._colorDataInfo.wrangled)),a.color.auto)this._colorMode=p;else switch(this._colorDataInfo.internalMode){case x:this._colorMode=t;break;case y:this._colorMode=s;break;case v:this._colorMode=r}var D;this._colorMode===t||this._colorMode===s?(this._sequentialMap.setData(a,this._colorDataInfo),D=this._sequentialMap.getLegendMode()):(this._qualitativeMap.setData(a,this._colorDataInfo),D=this._qualitativeMap.getLegendMode()),this._colorDataInfo.legendMode={discrete:"scale"!==D[0],boxType:D[1],colorMode:D[2],selectionEnabled:!D[3],altMode:this._colorDataInfo.altMode,rangeSelectionIndex:this._colorDataInfo.altMode?this._data.qHyperCube.qMeasureInfo.length:0},this._colorDataInfo.altMode&&this._colorDataInfo.internalMode===w&&this._colorDataInfo.valid&&"dimension"===this._colorDataInfo.legendMode.colorMode&&(this._colorDataInfo.legendPath="/qHyperCubeDef/qDimensions/"+f+"/qAttributeDimensions/"+C,this._colorDataInfo.legendPages=[{qTop:0,qLeft:0,qWidth:2,qHeight:99}],this._colorDataInfo.altLocked=d.qLocked,this._colorDataInfo.attrInfo=d),this._legendDataProvider.setData(a)}},hasAttributeDimension:function(){return this._colorDataInfo.altMode&&!!this._colorDataInfo.legendPath},getAttributeDimensionInfo:function(){return this.hasAttributeDimension()?[this._colorDataInfo.attrInfo]:[]},getColorDataInfo:function(){return this._colorDataInfo},setAltModeEnabled:function(a){this._enableAltMode=a},setMeasureFormatters:function(a){this._measureFormatters=a,this._sequentialMap.setMeasureFormatters(a)},setGenericFormatter:function(a){this._sequentialMap.setGenericFormatter(a)},getValueFormatter:function(){return this._measureFormatters?this._measureFormatters[0]:null},setDimensionTree:function(a){this._dimensionTree=a,this._legendDataProvider.setDimensionTree(a)},getLegendDataProvider:function(){return this._legendDataProvider},release:function(){this._qualitativeMap.release&&this._qualitativeMap.release(),this._sequentialMap.release&&this._sequentialMap.release(),this._legendDataProvider.release&&this._legendDataProvider.release(),this._dimensionTree=null,this._legendDataProvider=null,this._sequentialMap=null,this._qualitativeMap=null}}),Object.defineProperties(o.prototype,{mode:{get:function(){return this._colorMode}}}),Object.defineProperties(o,{AUTO:{value:p,writable:!1},PRIMARY:{value:r,writable:!1},MEASURE:{value:t,writable:!1},EXPRESSION:{value:s,writable:!1},QUALITATIVE:{value:q,writable:!1},DIMENSION:{value:w,writable:!1}}),Object.defineProperties(o.prototype,{AUTO:{value:p,writable:!1},PRIMARY:{value:r,writable:!1},MEASURE:{value:t,writable:!1},EXPRESSION:{value:s,writable:!1},QUALITATIVE:{value:q,writable:!1},DIMENSION:{value:w,writable:!1}}),o}),define("objects.views/charts/events/chart-event",["core.utils/class"],function(a){"use strict";return a.extend({init:function(a){this._type=a},getType:function(){return this._type}})}),define("objects.views/charts/events/property-change-event",["objects.views/charts/events/chart-event"],function(a){"use strict";return a.extend({init:function(a,b,c){this._super("propertyChange"),this.property=a,this.oldValue=b,this.newValue=c}})}),define("objects.views/charts/utils/binding",["core.utils/class","objects.views/charts/events/event-launcher","objects.views/charts/events/property-change-event"],function(a,b,c){function d(){var a,b,c,d,f,j,k,l;for(4===arguments.length?(c=new h(arguments[0]),a=arguments[1],b=arguments[2],j=arguments[3]):(c=new h(arguments[0],arguments[1]),a=arguments[2],b=arguments[3],j=arguments[4]),d=b.split("."),f=d[0],l=0;l<d.length;l++)k=new g(a,f),c.add(k),a=a&&"function"==typeof a[e(f)]?a[e(f)]():void 0,f=d[l+1];return c.startObserving(j),new i(c)}function e(a){return"get"+a.substring(0,1).toUpperCase()+a.substring(1)}function f(a,b){var d,e,f=b.substring(0,1).toUpperCase()+b.substring(1);"function"==typeof a["set"+f]&&(a[k]||(a[k]={}),void 0===a[k][b]?(d=a["set"+f],e=a.hasOwnProperty("set"+f),a["set"+f]=function(e){var g="function"==typeof a["get"+f]?a["get"+f]():void 0;return"function"==typeof a["get"+f]&&e===g?void d.call(a,e):(d.call(a,e),void a.fire(new c(b,g,e)))},a[k][b]={observers:1,original:d,isOriginalOwn:e,keep:!1}):a[k][b].observers++)}var g,h,i,j,k="__setters";return g=b.extend("Link",{init:function(a,b){this._super(),this._property=b,this._host=a},setHost:function(a){this._host===a&&this._hostObserved||(this.unobserve(),this._host=a,this.observe())},observe:function(a){if(!this._host)return void this.fire("hostPropertyValueChanged",[void 0]);f(this._host,this._property);var b=this,c=e(this._property);this._callback=function(a){a.property===b._property&&b.fire("hostPropertyValueChanged",[a.newValue])},this._callbackSimple=function(){"function"==typeof this[c]&&b.fire("hostPropertyValueChanged",[this[c]()])},a||"function"!=typeof this._host[c]||b.fire("hostPropertyValueChanged",[this._host[c]()]),this._host.listen("propertyChange",this._callback),this._host.listen(this._property+"Changed",this._callbackSimple),this._hostObserved=!0},unobserve:function(){if(this._host){if(this._callback&&this._host.stopListen("propertyChange",this._callback),this._callbackSimple&&this._host.stopListen(this._property+"Changed",this._callbackSimple),this._host[k]&&this._host[k][this._property]){var a,b=this._host[k][this._property];b.observers--,b.observers<=0&&(a="set"+this._property.substring(0,1).toUpperCase()+this._property.substring(1),b.isOriginalOwn?this._host[a]=b.original:(this._host[a]=null,delete this._host[a]),b.original=null,this._host[k][this._property]=null,delete this._host[k][this._property])}this._host=void 0,this._callback=void 0,this._callbackSimple=void 0,this._hostObserved=!1}}}),h=a.extend("Chain",{init:function(a,b){this._links=[],1===arguments.length&&"function"==typeof a?this._setter=a:(this._wannabe=a,this._wannabeProp=b)},add:function(a){var b,c=this;a.listen("hostPropertyValueChanged",function(a){if(b=c._links.indexOf(this),b===c._links.length-1)if(c._setter)c._setter(a);else{var d="set"+c._wannabeProp.substring(0,1).toUpperCase()+c._wannabeProp.substring(1);"function"==typeof c._wannabe[d]&&c._wannabe[d](a)}else c._links[b+1].setHost(a)}),this._links.push(a)},startObserving:function(a){this._links[0].observe(a)},isBroken:function(){return this._isBroken},unwatch:function(){for(var a=this._links.pop();a;)a.unobserve(),a.stopListen("hostPropertyValueChanged"),a=this._links.pop();this._setter=void 0,this._wannabe=void 0,this._wannabeProp=void 0}}),i=a.extend("ChangeWatcher",{init:function(a){this._chain=a},unbind:function(){this._chain.unwatch()}}),j={},j.bindProperty=function(a,b,c,e,f){return d(a,b,c,e,f)},j.bindSetter=function(a,b,c,e){return d(a,b,c,e)},j.getter=e,j}),define("objects.views/charts/components/mini-chart",["./chart-component","../components/axis/continuous-axis","../components/data-area","../chart-context","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","general.utils/color","core.utils/deferred"],function(a,b,c,d,e,f,g,h){function i(a,b){var c,d={};if(b)for(c in a)"qHyperCube"===c?d[c]={qDataPages:[],qDimensionInfo:a.qHyperCube.qDimensionInfo.slice(),qMeasureInfo:a.qHyperCube.qMeasureInfo.slice(),qStackedDataPages:[],qMode:"S",qSize:{qcx:2,qcy:0}}:d[c]=a[c];else{if(!a.reducedHyperCube)return a;d={};for(c in a)"qHyperCube"===c?d[c]=a.reducedHyperCube:d[c]=a[c]}return d}var j;return j=a.extend("MiniChart",{init:function(a,b){this._super.apply(this,Array.prototype.slice.call(arguments)),this.components={},this.options=b,this._chartContext=new d,this._createComponents();var c=12303291;this._colorMap=void 0,this._constantColorMap={getColorByNode:function(){return new g(c)},getColor:function(){return new g(c)}},this.components.dataArea.setColorMap&&this.components.dataArea.setColorMap(this._constantColorMap),this.components.timeAxis&&this.components.dataArea.setTimeAxis(this.components.timeAxis),this.components.dataArea.setLayoutMode(3),f.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree"),this._logScale=!1},setYMirrorMode:function(a){if(this.yMirrorMode!==a){this.yMirrorMode=a;for(var b in this.components)this.components[b].setYMirrorMode(a)}},setData:function(a,b){if(!a||!a.qHyperCube)return h.resolve();if(this.isDimensionContinuous=b,this.components.dataArea.isDimensionContinuous=b,b)return this._data=a,this.invalidateProperties();this._data=null;var c,d,e=a.qHyperCube,f=this,g=Math.min(2e3,1e4/(e.qMeasureInfo.length+1)),j=-1,k=("linechart"===a.visualization||"barchart"===a.visualization&&a.barGrouping&&"stacked"===a.barGrouping.grouping)&&e.qDimensionInfo.length>1&&"K"===e.qMode?1:0;return"function"!=typeof this.backendApi.getReducedData?(this._data=i(a),this.invalidateProperties()):(c=i(a,!0),a.reducedHyperCube=c.qHyperCube,d=a.reducedHyperCube,this.backendApi.getReducedData([{qTop:0,qLeft:k,qWidth:a.qHyperCube.qDimensionInfo.length+a.qHyperCube.qMeasureInfo.length+k,qHeight:g}],j).then(function(a){return d.qDataPages=a,f._data=c,k&&a&&(a[0].isReduced||a[0].qIsReduced)&&(d.qDimensionInfo=e.qDimensionInfo.slice(0,1),d.qMeasureInfo=[e.qMeasureInfo[0],e.qMeasureInfo[0]]),f.invalidateProperties()}))},calculateRelevantSize:function(){this.relevantSize=Math.max(30,Math.min(40,this.outerRect[this.isVertical()?"width":"height"]/8))},setRect:function(a,b,c,d){this.rect.width===c&&this.rect.height===d||this.invalidateDisplay(),this._super(a,b,c,d);for(var e in this.components)this.components[e].setRect(0,0,c,d);this.updateSize()},setOuterRect:function(a,b,c,d){this._super(a,b,c,d);for(var e in this.components)this.components[e].setOuterRect(a,b,c,d)},setLayoutToContainerRatios:function(a,b){this._super(a,b);for(var c in this.components)this.components[c].setLayoutToContainerRatios(a,b)},setContainerRect:function(a,b,c,d){this._super(a,b,c,d);for(var e in this.components)this.components[e].setContainerRect(a,b,c,d)},updateSize:function(){this._super();for(var a in this.components)this.components[a].updateSize()},isVisible:function(a){return this._super(a)&&this.rect&&this.rect.width>0&&this.rect.height>0},setLogScale:function(a){this._logScale=a,this._logScale!==!0&&(this._logScale=!1)},getLogScale:function(){return this._logScale},setHasValidData:function(a){this._super(a),Object.keys(this.components).forEach(function(b){this.components[b].setHasValidData(a)},this)},setDock:function(a){this._super(a),this.isVertical()?(this.components.measureAxis.setDock("top"),this.components.dimensionAxis.setDock("left")):(this.components.measureAxis.setDock("left"),this.components.dimensionAxis.setDock("bottom"))},paint:function(a,b){if(!b||!this.isVisible())return h.resolve();this._super(a,b);var c,d=[];this.components.dataArea.rect=this.rect.clone(),this.components.dimensionAxis.rect=this.components.dataArea.rect,this.components.measureAxis.rect=this.components.dataArea.rect,this.components.dataArea.rect.x=0,this.components.dataArea.rect.y=0,this.components.dimensionAxis.invalidateProperties("MiniChart.paint"),this.components.dimensionAxis.updateNow(["properties"]),this.components.measureAxis.invalidateProperties("MiniChart.paint"),this.components.measureAxis.updateNow(["properties"]),this.components.dimensionAxis.calculateValuePositionMappingInfo(),this.components.measureAxis.calculateValuePositionMappingInfo();for(c in this.components)d.push(this.components[c].invalidateDisplay("MiniChart.paint"));return h.all(d)},_createComponents:function(){var a=this.components,d=this.options;Object.keys(d.components).forEach(function(e){var f,g=[this.testId||"component",e].join("."),h=d.components[e];if(h.label=e,"function"==typeof d.components[e].clazz)f=d.components[e].clazz;else switch(e){case"dataArea":f=c;break;case"yAxis":case"measureAxis":f=b}f&&(a[e]=new f(this.container,h,g)),a[e].setUseTransition&&a[e].setUseTransition(!1)},this)},updateColorMap:function(a){if(a&&a.qHyperCube&&a.qHyperCube.qDimensionInfo[0]){var b=a.qHyperCube.qDataPages[0]&&a.qHyperCube.qDataPages[0].qIsReduced;this.components.dataArea.setColorMap&&(this.isDimensionContinuous||!b&&(a.color.auto||"byExpression"!==a.color.mode)?(this._miniColorMap||(this._miniColorMap=new e),this._colorMap&&(a.color.persistent=!!this._colorMap.getColorDataInfo().persistentColors),this._miniColorMap.setDimensionTree(this._chartContext.getDimensionTree()),this._miniColorMap.setData(a),this.components.dataArea.setColorMap(this._miniColorMap)):this.components.dataArea.setColorMap(this._constantColorMap))}},updateAxis:function(a){var b,c,d,e,f,g,h;g=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),h=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),b=this.components.measureAxis,c=this.components.dimensionAxis,d=this.components.timeAxis,b.setNiceNumberEnabled(!1),b.setLogScale(this._logScale),"barchart"===a.visualization&&(h=Math.max(0,h),g=Math.min(0,g)),f=this.components.dataArea.getMinorAxisData(),f&&(h=f.max,g=f.min),g===h&&0===h||isNaN(g)&&isNaN(h)?(h=10,g=-10,b.setDataRange(g,h)):(f||this.isDimensionContinuous)&&b.setDataRange(g,h),this.isDimensionContinuous?a.qHyperCube.qDimensionInfo&&(g=a.qHyperCube.qDimensionInfo[0].qMin,h=a.qHyperCube.qDimensionInfo[0].qMax,d.setDataRange(g,h),d.setPlotMin(g),d.setPlotMax(h)):(e=this.components.dataArea.getMajorAxisData(),e?c.setDataRange(e.data,e.info):c.setDataRange([],[]))},setBackendApi:function(a){this.backendApi=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setOrientation:function(a){this._orientation=a||"horizontal"},_updateProperties:function(){if(this._data){var a=this._data;this._chartContext.refresh(a),this.updateColorMap(a),this.components.dataArea.setData(a),this.components.dataArea.updateNow(["properties"]),this.updateAxis(a),this.invalidateDisplay("MiniChart._updateProperties")}},clear:function(){Object.keys(this.components).forEach(function(a){this.components[a].clear()},this)},release:function(){this._super(),Object.keys(this.components).forEach(function(a){this.components[a].release()},this)},showComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var a in this.components.dataArea.renderers)this.components.dataArea.renderers[a].show()},hideComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var a in this.components.dataArea.renderers)this.components.dataArea.renderers[a].hide()}}),Object.defineProperty(j.prototype,"className",{value:"MiniChart"}),j}),define("objects.views/charts/utils/chart-formatting",["core.utils/class","objects.utils/num-date-time-formatter","objects.utils/number-formatter"],function(a,b){"use strict";function c(a){return!!a.qIsAutoFormat&&["M","D","T","TS","IV"].indexOf(a.qNumFormat.qType)<0}var d=a.extend("ChartFormatting",{init:function(a,b){this.localeInfo=a,this.measureFormatters=this.getFormattersForMeasures(b),this.combinedMeasuresFormatter=this.getFormatterFromFormatters(this.measureFormatters)},createFormatter:function(){return new b(this.localeInfo)},getLocaleInfo:function(){return this.localeInfo||{}},getFormatters:function(){return this.measureFormatters||[]},getMeasureFormatter:function(a){if(this.measureFormatters[a])return this.measureFormatters[a]},getCombinedMeasuresFormatter:function(){return this.combinedMeasuresFormatter},formatMeasure:function(a,b){var c=this.measureFormatters[b];return c?c.format(a):a},getFormatterFromFormatters:function(a){var c,d,e,f,g,h=0,i=0,j=0,k=a?a.filter(function(a){return!!a.values&&!isNaN(a.values.range)}):[];return a&&a.length&&(a.forEach(function(a){return"U"===a.type||a.values&&isNaN(a.values.range)?i++:["D","T","TS","IV"].contains(a.type)?h=1:j=1,a.prepare(),a}),k.length&&(c=k.reduce(function(a,b){return Math.min(b.values.min,a)},k[0].values.min),d=k.reduce(function(a,b){return Math.max(b.values.max,a)},k[0].values.max),e=Math.abs(d-c)),h+j>1?(g=a.filter(function(a){return"datetime"!==a.type})[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,"U"),isNaN(e)||(f.pattern=f.createPatternFromRange(c,d,!0))):h+j===1&&0===i?(g=a[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,g.type)):(g=a.filter(function(a){return"U"!==a.type;
}),g=g.length?g[0]:a[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,g.type),isNaN(e)||"U"!==g.type||(f.pattern=f.createPatternFromRange(c,d,!0))),f.prepare()),f||(f=new b(this.localeInfo,"0")),f},getFormattersForMeasures:function(a,d){var e,f=[];return a&&a.length&&(e=d?a.filter(function(a,b){return d.indexOf(b)>=0}):a,f=e.map(function(a){var d=c(a),e=new b(this.localeInfo,a.qNumFormat.qFmt,a.qNumFormat.qThou,a.qNumFormat.qDec,d?"U":a.qNumFormat.qType),f=Math.abs(a.qMax-a.qMin),g=isNaN(f);return e.values={min:a.qMin,max:a.qMax,range:f},!g&&d&&(e.pattern=e.createPatternFromRange(a.qMin,a.qMax,!0)),e.prepare(),e},this)),f}});return d}),define("objects.views/selections/selections-cache",["core.utils/class"],function(a){function b(a,b,c){var d=b.indexOf(a);d===-1&&c!==!1?b.push(a):d===-1||c||b.splice(d,1)}function c(a){var b,c=[];return a.forEach(function(a){a.split(";").forEach(function(a){b=a.split(":"),c[+b[0]]||(c[+b[0]]=[]),c[b[0]].indexOf(+b[1])===-1&&c[b[0]].push(+b[1])})}),c}function d(a){a._dirty&&(a.columns=c(a.values)),a._dirty=!1}function e(a,b){var c=[];do b&&b.indexOf(a.col)===-1||c.push(a.col+":"+a.id);while((a=a.parent)&&"undefined"!=typeof a.col&&"undefined"!=typeof a.id);return c.join(";")}var f,g={ROW:1,VALUE:2};return f=a.extend({init:function(){this.rows=[],this.values=[],this.columns=[],this.indicesToTrack=null,this._dirty=!1,this.selectionMode=g.ROW|g.VALUE},clear:function(){this.clearRows(),this.clearValues()},toggle:function(a,b){this.toggleRow(a.row,b),this.toggleValue(a.value,a.col,b)},toggleByCacheItem:function(a){this.toggleRow(a.rowIndex||a.row||0,a.selected);var c=e(a,this.indicesToTrack);c&&b(c,this.values,a.selected),this._dirty=!0},toggleRow:function(a,c){b(a,this.rows,c)},toggleValue:function(a,c,d){b((c||0)+":"+a,this.values,d),this._dirty=!0},isRowSelected:function(a){return!!(this.selectionMode&g.ROW)&&this.rows.indexOf(a)!==-1},isValueSelected:function(a,b){return!!(this.selectionMode&g.VALUE)&&(d(this),"undefined"!=typeof this.columns[b||0]&&this.columns[b||0].indexOf(a)!==-1)},isValueChainSelected:function(a){if(!(this.selectionMode&g.VALUE))return!1;if(this.indicesToTrack){d(this);var b=e(a,this.indicesToTrack).split(";");return b.length&&!b.some(function(a){var b=a.split(":");return!("undefined"!=typeof this.columns[+b[0]||0]&&this.columns[+b[0]||0].indexOf(+b[1])!==-1)},this)}return this.values.indexOf("string"==typeof a?a:e(a,this.indicesToTrack))!==-1},isCacheItemSelected:function(a){return this.isValueChainSelected(a)||this.isRowSelected(a.rowIndex||a.row||0)},hasSelections:function(){return!!(this.selectionMode&g.ROW)&&this.rows.length>0||!!(this.selectionMode&g.VALUE)&&this.values.length>0},setRows:function(a){this.rows=a.slice()},setValues:function(a,b){this.values=a.map(function(a){return""+(b||0)+":"+a}),this._dirty=!0},getSelectedColumns:function(){d(this);var a=this.columns;return a.filter(function(a){return"undefined"!=typeof a}).map(function(b){return a.indexOf(b)})},getSelectedValuesInColumn:function(a){return d(this),this.columns[a||0]||[]},getSelectedValues:function(){return d(this),this.columns},clearRows:function(){this.rows.length=0},clearValues:function(){this.values=[],this.columns.length=0,this._dirty=!1},setSelectionMode:function(a){this.selectionMode=a},trackByIndices:function(a){this.indicesToTrack=Array.isArray(a)?a.slice():null}}),f.SELECTION_MODE=f.prototype.SELECTION_MODE=g,f}),define("objects.views/selections/attribute-selections-cache",["objects.views/selections/selections-cache"],function(a){var b=a.extend("AttributeSelectionsCache",{isCacheItemSelected:function(a){var b=a.getAttributeDimensions();return b&&1===b.length&&this.isValueSelected(b[0])}});return b}),define("objects.views/selections/cache-collection",[],function(){function a(a){this.collection=a||[]}return a.prototype={clear:function(){this.collection.forEach(function(a){a.clear()})},add:function(a){this.collection.indexOf(a)===-1&&this.collection.push(a)},remove:function(a){var b=this.collection.indexOf(a);b!==-1&&this.collection.splice(b,1)},isCacheItemSelected:function(a){return this.collection.some(function(b){return b.isCacheItemSelected(a)})}},a}),define("text!objects.views/charts/disclaimers/chart-disclaimer.ng.html",[],function(){return'<div class="qv-viz-disclaimer"\n\t ng-if="visible && (attributes.limitedData || attributes.onlyNullColor || attributes.hasNegativeOrZeroData || attributes.hasDataRangeIncludingZero) && !attributes.doesNotFit"\n\t ng-style="getDisclaimerStyle(attributes.chartScale)"\n\t qva-direction x-dir-setting="{{direction}}" x-dir-text="{{languageString}}">\n\t<span class="ltr-star">*</span>\n\t<span ng-if="attributes.limitedData" q-translation="Object.Disclaimer.LimitedData" q-title-translation="Object.Disclaimer.LimitedData"></span>\n\t<span ng-if="attributes.onlyNullColor" q-translation="Object.Disclaimer.OnlyNanColor" q-title-translation="Object.Disclaimer.OnlyNanColor"></span>\n\t<span ng-if="attributes.hasNegativeOrZeroData" q-translation="Object.Disclaimer.NegativeOrZeroValues" q-title-translation="Object.Disclaimer.NegativeOrZeroValues"></span>\n\t<span ng-if="attributes.hasDataRangeIncludingZero" q-translation="Object.Disclaimer.DataRangeIncludingZero" q-title-translation="Object.Disclaimer.DataRangeIncludingZero"></span>\n\t<span class="rtl-star">*</span>\n</div>\n'}),define("objects.views/charts/disclaimers/chart-disclaimer-directive",["qvangular","text!./chart-disclaimer.ng.html","translator"],function(a,b,c){a.directive("qvaChartDisclaimer",function(){return{template:b,scope:{attributes:"=",visible:"=",direction:"="},link:function(a){a.getDisclaimerStyle=function(a){return a=Math.min(1,a||1),{"font-size":1*a+"em"}},a.languageString=c.get("Object.Disclaimer.LimitedData")}}})}),define("objects.views/charts/chart",["jquery","./events/event-launcher","./layout-engine","./components/data-area","./components/axis/axis","./components/axis/discrete-axis","./components/axis/continuous-axis","./components/legend/color-legend","./components/legend/basic-color-legend","./components/mini-chart","./representation/combo-color-map","./chart-context","general.utils/shapes/rect","objects.utils/layout","objects.views/charts/utils/binding","objects.views/charts/utils/chart-formatting","objects.extension/default-view","objects.utils/event-utils","core.utils/deferred","objects.views/selections/selections-cache","objects.views/selections/attribute-selections-cache","objects.views/selections/cache-collection","objects.views/charts/disclaimers/chart-disclaimer-directive"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";function w(a){this._chartScale!==a&&(this._chartScale=a,this.$scope.dataAttributes.chartScale=a,Object.keys(this.components).forEach(function(a){this.components[a].chartScale=this._chartScale},this))}function x(){var a,b,c,d,e,f,g,h,i=this.container.parentElement,j="",k="";if(i.style.height="100%",i.style.width="",i.style.left="",i.style.top="",!this._readStoredData||!this._data.snapshotData.content.size)return void w.call(this,1);a=this.container.clientWidth,b=this.container.clientHeight,g=this._data.snapshotData.content.size,c=g.w,d=g.h;var l=c/d,m=a/b;l<=m?(h=b/d,e=b*l/a,a=100*e+"%",b="100%",j=50*(1-e)+"%"):(h=a/c,f=a/l/b,b=100*f+"%",a="",k=50*(1-f)+"%"),w.call(this,h),i.style.width=a,i.style.height=b,i.style.left=j,i.style.top=k}function y(){this._sizeChanged=!1,x.call(this);var a,b,c=this.rect,d=this.container.clientWidth,e=this.container.clientHeight,f=new m(0,0,d,e);if(this.containerRect=new m(0,0,d,e),this._readStoredData&&this._data.snapshotData.content.size&&(b={width:this._data.snapshotData.content.size.w,height:this._data.snapshotData.content.size.h}),b&&(f=new m(0,0,b.width,b.height)),!c||c.width!==f.width||c.height!==f.height){for(a in this.components)this.components[a].setOuterRect(f.x+1,f.y+1,f.width-2,f.height-2);this.rect=f,this._updateLayoutMode(this.rect.width,this.rect.height),this._sizeChanged=!0}}function z(a,b){Object.keys(this.components).forEach(function(c){["colorLegend","xAxis","dimensionAxis","timeAxis","dataArea"].contains(c)&&this.components[c].setGlobalOpacity(a,b||!1)},this)}function A(){var a;this.chartFormatter=new p(this.backendApi.localeInfo,this._data.qHyperCube.qMeasureInfo);for(a in this.components)this.components[a].chartFormatter=this.chartFormatter,this.components[a].measureFormatters=this.chartFormatter.getFormatters(),this.components[a].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter()}function B(){var a,c={};for(a in b.prototype)b.prototype.hasOwnProperty(a)&&"init"!==a&&(c[a]=b.prototype[a]);return c}function C(){var a=this;this.backendApi.clearSelections();var b=this.components.dataArea.getSelectableShapes();b.forEach(function(b){b.selected=!1,a.onSelection.ToggleShape.call(a,b)}),this.selectionsCacheCollection.clear(),this.onSelection.scheduleInvalidation.call(this)}var D,E,F;return E={debug:!0,components:{}},F=q.extend(B()),D=F.extend({refreshSelections:function(){this.specialCaseForSingleSelect=!1},initialize:function(){this._super(),this._initiateBindings()},init:function(d,e,f,g,h){b.prototype.init.call(this),f=a.extend(!0,f||{},{},E);var i=e.find(".qv-viz");this._super(d,i,f,g),this.container=i[0],this.backendApi=g,this.selectionsApi=h,this.layoutEngine=new c,this.components={},this.providers={},this._changeWatchers=[],this._createComponents(),this._createProviders(),this._chartScale=1,this.chartFormatter=new p(this.backendApi.localeInfo),this.selectionsCache=new t,this.attributeSelectionsCache=new u,this.selectionsCacheCollection=new v([this.selectionsCache,this.attributeSelectionsCache]),this.selectionsCache.setSelectionMode(t.SELECTION_MODE.VALUE),this._chartContext=new l,this._layoutMode=n.LayoutMode.FULL,this.$scope.dataAttributes={},this.resize(),this.specialCaseForSingleSelect=!1,this._navigation=f.navigation},selectionModeAlpha:.5,getVerticalComponents:function(){var a=[];return this._data&&this._data.legend&&this.components&&this.components.colorLegend&&this.components.colorLegend.isVertical()&&a.push({comp:this.components.colorLegend,dock:this._data.legend.dock}),a},setDirection:function(a){this._super(a),this._data&&(this.setYMirrorMode("rtl"===a&&!(this._data&&this._data.reverseRtl)),this.paint(this._data))},setYMirrorMode:function(a){if(this.yMirrorMode!==a){this.yMirrorMode=a;for(var b in this.components)this.components[b].setYMirrorMode(a);this.tooltips&&(this.tooltips.yMirrorMode=a),this.updateVerticalComponentsDock()}},updateVerticalComponentsDock:function(){var a,b,c,d,e;for(this._verticalComponents=this.getVerticalComponents(),b=this._verticalComponents?this._verticalComponents.length:0,a=0;a<b;a++)c=this._verticalComponents[a],d=c.comp,"far"!==c.dock&&"near"!==c.dock&&"auto"!==c.dock||(e="far"===c.dock||"auto"===c.dock,d.setDock(this.yMirrorMode?e?"left":"right":e?"right":"left"))},setMinimumRequirements:function(a,b){this._requirements={dimensions:{min:a},measures:{min:b}}},onToggleLasso:function(a){this.toggleLasso=a},isLassoDisabled:function(){return!this.selections.allowLasso},onSelection:{ToggleShape:function(a){var b=this.$scope.layout.layers?this.$scope.layout.layers[0]:this.$scope.layout,c=b.qListObject?b.qListObject:b.qHyperCube;return a.selected||1!==c.qSize.qcy?(this.toggleCacheItem?this.toggleCacheItem(a):this.onSelection.scheduleInvalidation.call(this),(a.id===-3||a.id>=0)&&(this.selections.getActiveType().activeComponent&&this.selectionsCache.trackByIndices(this.selections.getActiveType().activeComponent.getSelectionIndices()),this.selectionsCache.toggleByCacheItem(a)),this.specialCaseForSingleSelect=!1,void(this._haveToggledShapes=this.selectionsCache.hasSelections())):void(this.specialCaseForSingleSelect=!0)},Activated:function(){z.apply(this,[this.selectionModeAlpha]),this._haveToggledShapes=!1},Deactivated:function(){z.apply(this,[1]),this.selectionsCacheCollection.clear(),this.toggleLasso=!1},Select:function(a,b,c,d){var e=this;if(!this.specialCaseForSingleSelect){var f=Array.isArray(c)?c:[c||0];if(this.selectionsCache.hasSelections()){var g,h=this.selectionsCache.getSelectedValuesInColumn(f[0]),i=-1;"K"===this._data.qHyperCube.qMode&&(i=h.indexOf(-3)),g=1===f.length&&i===-1?this.backendApi.selectValues(f[0],h,!1):this.backendApi.select(this.selectionsCache.rows,f,d),g.then(function(a){a.qSuccess||C.call(e)}).catch(function(a){a.isHandled=!0})}else a.length&&a.every(function(a){return!a.selected})&&this.selectionsApi.clear()}},SelectAttributeDim:function(a,b){var c,d,e=this;a.forEach(function(a){this.attributeSelectionsCache.toggleValue(a,!!b&&void 0)},this),c=this.attributeSelectionsCache.getSelectedValuesInColumn(0),d=this.providers.colorMap&&this.providers.colorMap.getColorDataInfo(),d&&d.legendPath&&this.backendApi.selectValues(0,c,!1,d.legendPath).then(function(a){a.qSuccess||C.call(e)})},SelectRange:function(a,b){var c=this;a&&0!==a.length?"dimension"===a[0].type?this.backendApi.selectDimensionRange(a).then(function(a){a.qSuccess||C.call(c)}):this.backendApi.selectRange(a,b).then(function(a){a.qSuccess||C.call(c)}):this.selectionsApi.clear()},Confirm:function(){},Cancel:function(){this.selectionsCacheCollection.clear()},Clear:function(){this.selectionsCacheCollection.clear()},scheduleInvalidation:function(){var a=this;this._invalidationTimer||(this._invalidationTimer=setTimeout(function(){a.onSelection.invalidate.call(a),a._invalidationTimer=null},10))},cancelInvalidation:function(){clearTimeout(this._invalidationTimer),this._invalidationTimer=null},invalidate:function(){this.components.dataArea.invalidateDisplay("Chart.onSelection.invalidate"),this.components.colorLegend&&this.components.colorLegend.invalidateDisplay("Chart.onSelection.invalidate"),Object.keys(this.components).forEach(function(a){(this.components[a]instanceof f||this.components[a]instanceof g&&this.components[a].isDimension)&&this.components[a].invalidateDisplay("Chart.onSelection.invalidate")},this)}},getLayoutMode:function(){return this._layoutMode},getVerticalLayoutMode:function(){return this._verticalLayoutMode},getHorizontalLayoutMode:function(){return this._horizontalLayoutMode},setLayoutMode:function(a){this._explicitLayoutMode=a,this._layoutMode!==a&&(this._layoutMode=a,this.fire("layoutModeChanged"))},getSnapshotSize:function(){return this.rect?{w:this.rect.width,h:this.rect.height}:{w:0,h:0}},_updateLayoutMode:function(a,b){this._explicitLayoutMode||(this._layoutMode=n.getLayoutMode(a,b),this._horizontalLayoutMode=n.getHorizontalLayoutMode(a),this._verticalLayoutMode=n.getVerticalLayoutMode(b),this.fire("layoutModeChanged"),this.fire("verticalLayoutModeChanged"),this.fire("horizontalLayoutModeChanged"))},_createProviders:function(){var a=this.options;a.providers.colorMap&&(this.providers.colorMap="function"==typeof a.providers.colorMap.clazz?new a.providers.colorMap.clazz(void 0,a.providers.colorMap):new k,this.components.dataArea&&this.components.dataArea.setColorMap(this.providers.colorMap),this.components.colorLegend&&this.components.colorLegend.setColorMap(this.providers.colorMap))},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]),Object.keys(this.components).forEach(function(a){this._changeWatchers.push(o.bindProperty(this.components[a],"layoutMode",this,"layoutMode")),this._changeWatchers.push(o.bindProperty(this.components[a],"verticalLayoutMode",this,"verticalLayoutMode")),this._changeWatchers.push(o.bindProperty(this.components[a],"horizontalLayoutMode",this,"horizontalLayoutMode"))},this),this.components.dataArea&&this._changeWatchers.push(o.bindSetter(this._updateSelectionCache.bind(this),this.components.dataArea,"selectableShapes"))},_updateSelectionCache:function(a){var b=this.selections&&this.selections.cache||this.tooltips&&this.tooltips.cache;if(b){a=a||this.components.dataArea.getSelectableShapes();var c=this.selectionsCacheCollection,d=!(!this.selections||!this.selections.getActiveType)&&this.selections.getActiveType(),f=!!d;b.clear(),a.forEach(function(a){b.add(a)}),f&&(/^item/.test(d.getActiveMode())?a.forEach(function(a){a.selected=c.isCacheItemSelected(a)}):(d.activeComponent instanceof e&&"range.measure"===d.getActiveMode()||d.activeComponent instanceof h&&"range"===d.getActiveMode())&&d.updateShapesState()),Object.keys(this.components).forEach(function(b){["colorLegend","xAxis","dimensionAxis"].contains(b)&&this.components[b].setSelectableShapes(a)},this)}},_createComponents:function(){var a,b,c,e=this,f=this.components,g=this.options;Object.keys(g.components).map(function(a){return{sortKey:g.components[a].sortKey||0,cmpKey:a}}).sort(function(a,b){return a.sortKey-b.sortKey}).forEach(function(k){var l=k.cmpKey;if(a=["component",l].join("."),b=g.components[l],b.label=l,c=null,"function"==typeof g.components[l].clazz)c=g.components[l].clazz;else switch(l){case"dataArea":case"dataArea2":c=d;break;case"colorLegend":c=h;break;case"basicColorLegend":c=i}c&&(b._disableSelections=g._disableSelections,f[l]=new c(this.container,b,a),f[l].selectionsApi=e.selectionsApi,f[l].backendApi=e.backendApi,f[l]instanceof j||this.layoutEngine.addComponent(f[l]))},this)},preLayout:function(){},layout:function(a,b){this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect,a,b)},resize:function(){return this._data&&this.isDataValid(this._data)?(this.prePaint(this._data),this._paint()):s.resolve()},setSnapshotData:function(a,b){var c=this.getSnapshotSize(),d={};Object.keys(this.components).forEach(function(a){d[a]={visible:this.components[a].isVisible(),dock:this.components[a].dock,size:{w:this.components[a].rect.width,h:this.components[a].rect.height}}},this),a.snapshotData.content={chartData:this.getSnapshotChartData(b),size:{w:c.w,h:c.h},components:d,v:.96}},getSnapshotChartData:function(){var a={};if(this.components.colorLegend){a.legendScrollOffset=this.components.colorLegend.getScrollPosition();var b=this.components.colorLegend.getExternalDataPage();b&&(a.legendDataPage=b)}return a},getSnapshotStoredChartData:function(){if(this._data&&this._data.snapshotData&&this._data.snapshotData.content)return this._data.snapshotData.content.chartData},setInteractionState:function(a,b){this._super(a,b);var c=this;Object.keys(this.components).forEach(function(a){c.components[a].setUseTransition(c._navigation&&(c._inAnalysisState||c._inEditState))})},_postResize:function(){this._data.legend&&this.components.colorLegend&&this._updateLegendDock(this.components.colorLegend,this._data)},_paint:function(){if(!this.isValid(this._data))return this.clear().then(function(){return{invalid:!0}});var a=this.getSnapshotStoredChartData();return this.components.colorLegend&&(this.components.colorLegend.pagingMode=this._pagingMode||0,this._readStoredData&&a&&this.components.colorLegend.setScrollPosition(a.legendScrollOffset||0)),y.call(this),this.$scope.dataAttributes.doesNotFit=this.rect.height<10,this._sizeChanged&&this._postResize(),s.resolve()},paint:function(a){return a.qSelectionInfo&&a.qSelectionInfo.qInSelections||!this.isValid(this._data)?s.resolve():this._paint()},suppressOnPaint:function(a){var b=this._super(a);return b&&this.prePaint(a),b},prePaint:function(){return this.$scope.dataAttributes.layoutMode=this._layoutMode,this.$scope.dataAttributes.layoutMode=this._layoutMode,this.$scope.dataAttributes.onlyNullColor=!1,this._super()},updateData:function(a){this._data=a;var b,c=this.isValid(a);for(b in this.components)this.components[b].setHasValidData(c);if(!c)return this.updateSelectableState(a),this._updateSelectionCache([]),this.clear();var d=this._updateData(a);this.setYMirrorMode(this.options&&"rtl"===this.options.direction&&!(this._data&&this._data.reverseRtl));var e=this,f=function(){if(this.providers.colorMap){var a=this.providers.colorMap.getColorDataInfo();return this.components.colorLegend&&a&&a.legendPath?this._readStoredData?(e.components.colorLegend.setExternalColorItems(e._data.snapshotData.content.chartData.legendDataPage),s.resolve()):s.all([this.backendApi.getData(a.legendPages,a.legendPath).then(function(a){e.components.colorLegend.setExternalColorItems(a)})]):(this.components.colorLegend.setExternalColorItems(null),s.resolve())}}.bind(this);return d&&"function"==typeof d.then?d.then(f):(d=f(),s.when(d))},_updateData:function(a){var b;this._data=a,this._readStoredData=this.options._readStoredData||a&&a.snapshotData&&a.snapshotData.content&&!this.isEffect,this.selectionsCacheCollection.clear(),a.legend&&this.components.colorLegend&&(this.components.colorLegend[(a.legend.auto||a.legend.show?"show":"hide")+"Component"](),this.components.colorLegend.attributeSelectionsCache=this.attributeSelectionsCache,this._updateLegendDock(this.components.colorLegend,a)),A.call(this),this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.tooltips&&(this.tooltips.measureFormatters=this.chartFormatter.getFormatters(),this.tooltips.parentScope=this.$scope,this.tooltips.colorMap=this.providers.colorMap),this._chartContext.refresh(a);var c=this.isValid(this._data);for(b in this.components)this.components[b]._hasValidData=c;this.updateSelectableState()},_updateLegendDock:function(a,b){b.legend&&b.legend.dock&&"auto"!==b.legend.dock?a.setDock(b.legend.dock):a.setDock(a.outerRect.height/a.outerRect.width<1?this.yMirrorMode?"left":"right":"bottom")},destroy:function(){for(this.off();this._changeWatchers.length;)this._changeWatchers.pop().unbind();var a;for(a in this.components)this.components[a].release();for(a in this.providers)this.providers[a].release&&this.providers[a].release();this.$scope.dataAttributes={},this.selections&&(this.selections.cache.clear(),this.selections.release(),this.selections=null),this.tooltips&&(this.tooltips.release(),this.tooltips=null),this._chartContext.release(),this._super.apply(this,arguments)},clear:function(){var a=[];return Object.keys(this.components).forEach(function(b){a.push(this.components[b].clear())},this),s.all(a)},isValid:function(a){return this.isDataValid(a)},isDataValid:function(a){var b=!!a&&!!a.qHyperCube&&a.qHyperCube.qDimensionInfo.length&&!a.qHyperCube.qDimensionInfo.some(function(a){return!!a.qError})&&a.qHyperCube.qMeasureInfo.length&&!a.qHyperCube.qMeasureInfo.some(function(a){return!!a.qError});return b},isDataSelectable:function(a,b){return!(!this.isValid(this._data)||!this._inAnalysisState)&&(void 0!==b?a.qHyperCube.qDimensionInfo[b].qLocked!==!0:a.qHyperCube.qDimensionInfo.some(function(a){return a.qLocked!==!0}))},updateSelectableState:function(a){if(this.selections){var b=!this.isDataSelectable(a||this._data);Object.keys(this.components).forEach(function(a){this.components[a].setSelectionLocked(b)},this),this.selections&&this.selections.setLocked(b)}},on:function(){this._navigation&&Object.keys(this.components).forEach(function(a){this.components[a].on()},this),this._super(),this.updateSelectableState(this._data)},off:function(){this._navigation&&Object.keys(this.components).forEach(function(a){this.components[a].off()},this),this._super()},selectWhileLocked:function(a){r.showLockedFeedback(a||this._data.qHyperCube.qDimensionInfo)},getPreferredSize:function(){return this._super()}})}),define("objects.views/charts/components/ref-lines",["./chart-component","client.utils/theme/theme","objects.views/charts/utils/canvas-renderer"],function(a,b,c){"use strict";function d(a){return Number(void 0!==a.value?a.value:a)}function e(a){return b.palette[a]?b.palette[a]:a}function f(){if(!this._numRefLinesDataAxes||!this._numAxes)return!1;var a,b,c,e,f,g,h;for(a=0;a<this._numAxes;a+=1)for(c=this._axes[a],g=c.getPlotMin(),h=c.getPlotMax(),this._axisPlotMinValues[a]=g,this._axisPlotMaxValues[a]=h,e=this._data[a]||[],b=0;b<e.length;b+=1)if(f=d(e[b].refLineExpr),e[b]&&e[b].show&&void 0!==e[b].refLineExpr&&null!==f&&!isNaN(f)&&f>=g&&f<=h)return!0;return!1}function g(){var a,b,c,d;for(a=0;a<this._numAxes;a+=1)if(b=this._axes[a],c=b.getPlotMin(),d=b.getPlotMax(),this._axisPlotMinValues[a]!==c||this._axisPlotMaxValues[a]!==d)return!0;return!1}function h(){var a,b;for(a=0;a<this._numAxes;a+=1)b=this._axes[a],this._axisPlotMinValues[a]=b.getPlotMin(),this._axisPlotMaxValues[a]=b.getPlotMax()}var i,j="#333";return i=a.extend("RefLines",{init:function(){this._super.apply(this,arguments),this.renderer=new c(this.container),this.renderer.edgeBleed={top:1,left:1,right:0,bottom:0},this._$renderAreaWrap.addClass("qv-chart-component-reflines"),this._hasVisibleRefLines=!1,this._numAxes=0,this.renderers={lines:this.renderer}},setData:function(){this._super.apply(this,arguments),this._numRefLinesDataAxes=void 0===this._data?0:this._data.length,this._hasVisibleRefLines=f.call(this),h.call(this)},setAxes:function(a){var b=this;this._axes=a,this._axes.forEach(function(a){a.listen("changed",function(){this.invalidateDisplay()},b)}),this._numAxes=void 0===a?0:a.length,void 0!==this._axisPlotMinValues&&this._axisPlotMinValues.length===this._numAxes||(this._axisPlotMinValues=new Array(this._numAxes)),void 0!==this._axisPlotMaxValues&&this._axisPlotMaxValues.length===this._numAxes||(this._axisPlotMaxValues=new Array(this._numAxes))},isVisible:function(){var a=this._super.apply(this,arguments);return!!(a&&this._numAxes&&this._numRefLinesDataAxes)},hasValidData:function(){return this._super()&&this._numRefLinesDataAxes&&this._numAxes},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),g.call(this)&&(this._hasVisibleRefLines=f.call(this),h.call(this)),!this._hasVisibleRefLines)return this.renderer.shapes=[],void this.renderer.clear();var a,b,c,d,i,k,l,m,n,o,p,q,r,s=[];for(a=0;a<this._numRefLinesDataAxes;a+=1)for(c=this._data[a],d=this._axes[a],i=this._axisPlotMinValues[a],k=this._axisPlotMaxValues[a],b=0;b<c.length;b+=1)c[b].show&&void 0!==c[b].refLineExpr&&(l=this._currentProperties["value"+a+b],null===l||isNaN(l)||l>k||l<i||(m=d.getPositionOfValue(l),m=Math.floor(m)-.5,d.isVertical()?(n=0,o=m,p=this.rect.width,q=m):(n=m,o=0,p=m,q=this.rect.height),r=void 0!==c[b].color?e(c[b].color):j,s.push({type:"line",stroke:r,strokeWidth:1,shape:{x1:n,y1:o,x2:p,y2:q}})));this.renderer.shapes=s,this.renderer.render()},_updateProperties:function(){if(this._data){var a,b,c=this._data,d=c.length;for(a=0;a<d;a++)if(void 0!==c[a])for(b=0;b<c[a].length;b++)this._transitionProperties["value"+a+b]=c[a][b].refLineExpr.value;this._super()}}})}),define("objects.views/charts/components/data-title/data-title-handler",["core.models/generic-object","objects.views/charts/renderers/canvas-renderer","core.utils/deferred"],function(a,b,c){function d(a,b,c){var d,e,f,g=[],h="dimension"===b?a.qDimensionInfo:a.qMeasureInfo,i=!1;if(b){for(f=0;f<h.length;f++)d=h[f],i=d.qGroupFallbackTitles&&d.qGroupFallbackTitles.length>1,e=i?d.qGroupFallbackTitles.slice(0,d.qGroupPos+1):[d.qFallbackTitle],g.push({labels:e,label:e[e.length-1],locked:d.qLocked&&c,isDrill:i&&c,currentDrillDownLevels:d.qGroupPos,wrapperStyle:{},index:f});return g}}function e(b,d){if(!b||!b.getProperties)return c.resolve();var e="dimension"===d?"qDimensions":"qMeasures",f=b.getProperties().then(function(b){return b.qExtendsId?a.get(b.qExtendsId).then(function(a){return a.getProperties()}):b});return f.then(function(a){return i.hasAlternatives(a.qHyperCubeDef&&a.qHyperCubeDef.qLayoutExclude,e)})}function f(a,b){return a&&a.qHyperCubeDef&&a.qHyperCubeDef[b].length>0}function g(a,b,c,d){if(b.width()){"top-to-bottom"===c||"bottom-to-top"===c?(a.width=b.height(),a.height=b.width(),"top-to-bottom"===c?(a.marginTop=-a.width+a.height,a.marginLeft=a.height):(a.marginTop=a.width+a.height,a.marginLeft=0)):(a.width=b.width(),a.height=b.height(),a.marginLeft=0,a.marginTop=0);var e=d?d.map(function(a){return a.label}):[],f=i.getTitlesApproxWidth(e,a.font);f>a.width?(a.justifyContent="flex-start",a.minWidth=70):(a.justifyContent="center",a.minWidth="auto")}}function h(a,c){var d=0;return a.forEach(function(a){"string"==typeof a&&(d+=b.getTextWidth(a,c))}),d?d:null}var i={hasAlternatives:f,getTitlesApproxWidth:h};return{getTitleDataFromHyperCube:d,modelHasAlternatives:e,setWrapperStyle:g,getTitlesApproxWidth:h,hasAlternatives:f}}),define("text!objects.views/charts/components/data-title/data-title.ng.html",[],function(){return'<div ng-show="visible"\n     class="qva-chart-data-title">\n     <div class="qva-chart-data-title-rotate" ng-style="fontStyle" ng-class="direction" qva-direction x-dir-setting="{{options.direction}}">\n          <div class="qva-chart-data-title-align ellips-text">\n               <div class="qva-chart-data-title-wrapper ellips-text" ng-repeat-start="titleData in titles" ng-style="titleData.wrapperStyle" >\n                    <qva-breadcrumb-bar ng-if="titleData.isDrill" data="titleData" model="model" disabled="disabled" type="type" dock="dock" column-index="$index" options="options"></qva-breadcrumb-bar>\n                    <qva-default-data-title ng-if="!titleData.isDrill" data="titleData" model="model" disabled="disabled" type="type" dock="dock" options="options"></qva-default-data-title>\n               </div>\n               <span ng-repeat-end ng-if="!$last">, &nbsp;</span>\n          </div>\n\n     </div>\n</div>\n'}),define("text!objects.views/charts/components/data-title/default-data-title.ng.html",[],function(){return'<div class="default-data-title-wrapper ellips-text">\n     <qva-simple-data-title ng-if="!data.hasAlternatives" label="data.label" locked="data.locked" options="options"></qva-simple-data-title>\n     <qva-dropdown-data-title ng-if="data.hasAlternatives" data="data" model="model" disabled="disabled" type="type" dock="dock" options="options"></qva-dropdown-data-title>\n</div>'}),define("text!objects.views/charts/components/data-title/simple-data-title.ng.html",[],function(){return'<div class="chart-data-title ellips-text" qva-direction x-dir-text="{{label}}" x-dir-setting="{{options.direction}}" >\n     <i ng-if="locked" class="icon-toolbar-locked" title="{{lockedTooltip}}"></i>\n     <span class="chart-data-title-label" title="{{label}}" qva-direction x-dir-text="{{label}}" x-dir-setting="{{options.direction}}">{{label}}</span>\n</div>'}),define("text!objects.views/charts/components/data-title/dropdown-data-title/dropdown-data-title.ng.html",[],function(){return'<div class="qva-dropdown-data-title">\n     <div class="dropdown-data-title-wrapper" ng-class="{\'interactive\' : !disabled, \'active\': isMenuOpen}" qva-activate="openAlternativePopover()" qva-outside-ignore-for="{{\'dataTitle-\' + $id}}">\n          <qva-simple-data-title locked="data.locked" label="data.label" options="options"></qva-simple-data-title>\n          <span class="dropdown-arrow"></span>\n     </div>\n</div>'}),define("text!objects.views/charts/components/data-title/dropdown-data-title/dropdown-data-title-popover.ng.html",[],function(){return'<immidiate-contextual class="qva-alternative-data-picker"\n\t\t\t\t\t  align-to="alignTo"\n\t\t\t\t\t  position="position"\n\t\t\t\t\t  collision="\'flip fit\'"\n\t\t\t\t\t  height="\'auto\'"\n\t\t\t\t\t  on-close-view="closePopover();"\n\t\t\t\t\t  qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<div class="em-section-content em-alternative-data qva-alternative-data-picker-list" qva-direction x-dir-setting="{{options.direction}}">\n\t\t<div hypercube-data-item ng-repeat="alternative in item.alternatives" item="item"></div>\n\t</div>\n</immidiate-contextual>\n'}),define("assets/client/soft-property-panel/soft-property-handler",["core.utils/class","util","core.utils/json-patch","core.utils/deferred"],function(a,b,c,d){var e;return e=a.extend({init:function(a){this._model=a},setModel:function(a){this._model=a},saveSoftProperties:function(a,d){if(!this._model)return!1;var e=c.generate(a,d);return b.extend(!0,a,d),!(!e||!e.length)&&(e=e.map(function(a){return{qOp:a.op,qValue:JSON.stringify(a.value),qPath:a.path}}),this._model.applyPatches(e,!0),!0)},mergeSoftPatches:function(){if(!this._model)return d.resolve();
var a=this;return d.all({properties:this._model.getProperties(),effective:this._model.getEffectiveProperties()}).then(function(b){if(!b.properties.qExtendsId){var d=c.generate(b.properties,b.effective);c.apply(b.properties,d),a._model.save().then(function(){a._model.clearSoftPatches()})}})}})}),define("text!client.soft-property-panel/components/hypercube-data/hypercube-data-item.ng.html",[],function(){return'<li class="em-item lui-list__item" qva-activate="alternativeItemClicked($event,item,alternative);">\n\t<i ng-if="alternative.hasIcon" class="em-item-icon lui-icon icon-tick" ng-class="{\'em-invisible\': !alternative.selected}"></i>\n\t<span class="lui-list__text lui-list__text--ellipsis" qva-direction x-dir-text="{{alternative.title()}}"  title="{{alternative.title()}}">{{alternative.title()}}&nbsp;</span>\n</li>'}),define("client.soft-property-panel/components/hypercube-data/hypercube-data-handler",["qvangular","core.utils/class","client.utils/property-resolver","client.utils/property-hypercube-helper","objects.utils/data-properties/library-utils","general.utils/attribute-expression-util","translator","text!./hypercube-data-item.ng.html"],function(a,b,c,d,e,f,g,h){var i;return a.directive("hypercubeDataItem",function(){return{restrict:"A",template:h,replace:!0}}),i=b.extend({init:function(a,b){this._props=a,this._app=b,this.libraryTitles={}},setProperties:function(a){this._props=a},updateAlternativeItem:function(a,b,d,e,g){var h=c.getValue(this._props,e,[]),i=c.getValue(this._props,d,[]),j=h[b.index];if(!b.selected){b.original&&(j=c.getValue(this._props,d,[])[b.index]),j.qAttributeExpressions=f.moveById(a.data.qAttributeExpressions,j.qAttributeExpressions,f.IDMAP.COLOR_BY_EXPRESSION),j.qAttributeExpressions=f.moveById(a.data.qAttributeExpressions,j.qAttributeExpressions,f.IDMAP.COLOR_BY_ALTERNATIVE),j.qAttributeDimensions=f.moveById(a.data.qAttributeDimensions,j.qAttributeDimensions,f.IDMAP.COLOR_BY_ALTERNATIVE);var k,l,m,n;if(g)for(k=0;k<g.length;k++)n=g[k],l=c.getValue(i[a.index],n.path,[]),m=c.getValue(h[b.index],n.path,[]),l&&l.hasOwnProperty(n.property)&&m&&m.hasOwnProperty(n.property)&&(m[n.property]=l[n.property]);h.splice(b.index,1,i[a.index]),i.splice(a.index,1,j)}},getDimensionOptions:function(a,b,c,e,f){var g=this;return a.concat(b).filter(function(a){return a.qDef.cId===c.qDef.cId||!d.getDimensionLayout(a.qDef.cId,e)}).map(function(d){return{id:d.qDef.cId,index:a.indexOf(d)!==-1?a.indexOf(d):b.indexOf(d),original:a.indexOf(d)!==-1,ref:"dimensions",selected:d.qDef.cId===c.qDef.cId,hasIcon:f,title:function(){return g.getTitle(d,!0)}}})},getMeasureOptions:function(a,b,c,e,f){var g=this;return a.concat(b).filter(function(a){return a.qDef.cId===c.qDef.cId||!d.getMeasureLayout(a.qDef.cId,e)}).map(function(d){return{id:d.qDef.cId,index:a.indexOf(d)!==-1?a.indexOf(d):b.indexOf(d),original:a.indexOf(d)!==-1,ref:"measures",selected:d.qDef.cId===c.qDef.cId,hasIcon:f,title:function(){return g.getTitle(d,!1)}}})},getTitle:function(a,b){function c(){return b?f._app.getDimensionList().then(function(a){return e.findLibraryDimension(d,a)}):f._app.getMeasureList().then(function(a){return e.findLibraryMeasure(d,a)})}var d=a.qLibraryId,f=this,h=g.get(b?"Object.ErrorMessage.MissingDimension":"Object.ErrorMessage.MissingMeasure");return d?"undefined"!=typeof this.libraryTitles[d]?null===this.libraryTitles[d]?h:"string"!=typeof this.libraryTitles[d]?"":this.libraryTitles[d]:(this.libraryTitles[d]=c().then(function(a){return a?(f.libraryTitles[d]=a.qData.title,f.libraryTitles[d]):(f.libraryTitles[d]=null,h)}),this.libraryTitles[d]):b?a.qDef.qFieldLabels[0]||a.qDef.qFieldDefs[0]:a.qDef.qLabel||a.qDef.qDef}})}),define("client.property-panel/component-utils",["qvangular","client.utils/property-resolver","core.utils/deferred","util","translator"],function(a,b,c,d,e){var f={defineValue:function(c,d,e,g){function h(a){var c=b.getValue(e(),d.ref);return"undefined"==typeof c?"undefined"!=typeof d.undefinedValue?d.undefinedValue:b.getDefaultValue(a,d):c}function i(c,g,h){var i=b.getTypeValue(c,g,h),j=e();d.rollbackInvalid?f.validateType(i,d,j)?b.setValue(j,d.ref,i):a.getService("$timeout")(function(){a.$rootScope.$broadcast("pp-revalidate")}):b.setValue(j,d.ref,i)}var j,k,l;d.resolveFunctions?"object"==typeof d.resolveFunctions?(k=function(){return d.resolveFunctions.get(h,d)},l=function(a){return d.resolveFunctions.set(a,i,d)}):(k=function(){return b.resolveFunctions[d.resolveFunctions].get(h,d)},l=function(a){return b.resolveFunctions[d.resolveFunctions].set(a,i,d)}):(k=function(){return h(d.type)},l=function(a){var c=b.getDefaultValue(d.type,d);i(d.type,a,c)}),j="undefined"!=typeof g?g:"value",Object.defineProperty(c,j,{get:k,set:l})},defineExpression:function(a,c){var d=a.definition.expression,e=a.definition.expressionType,f="optional"===d||"always"===d,g=c?"qValueExpression":"qStringExpression";!e&&f&&(e=c?"ValueExpression":"StringExpression"),a.expressionType=e,a.isExpressionDefinition=f,Object.defineProperty(a,"displayValue",{get:function(){var b=a.value;return b&&"object"==typeof b&&(b=b[g].qExpr,b&&"="!==b[0]&&(b="="+b)),b},set:function(b){var c,d=f&&b&&0===b.indexOf("=");b&&d?(c={},c[g]={qExpr:b.substr(1)}):c=b,a.value=c}}),a.isExpression=function(){if("always"===d)return!0;if("optional"===d){var c=b.getValue(a.data,a.definition.ref);return"object"==typeof c}return!!e},a.isLocked=function(){if(f){var b=a.value;return"object"==typeof b&&(b=b[g].qExpr),!(!b||c&&"number"==typeof b)&&(b&&(b.indexOf("\n")!==-1||b.length>a.maxlength))}return!1}},defineChange:function(a,b){function c(){a.$emit("saveProperties",a.data)}a.change=function(){if("function"==typeof a.definition.change){var d=a.definition.change(a.data,b,a.args.properties,a.args);"object"==typeof d&&d.then?d.then(function(a){a!==!1&&c()}):d!==!1&&c()}else c()}},defineVisible:function(a,b){var c=a.definition.show;"function"==typeof c?Object.defineProperty(a,"visible",{get:function(){return c(a.data,b,a.args)}}):"boolean"==typeof c?a.visible=c:a.visible=!0},defineReadOnly:function(a,b){var c=a.definition.readOnly;"function"==typeof c?Object.defineProperty(a,"readOnly",{get:function(){return c(a.data,b,a.args)}}):"boolean"==typeof c?a.readOnly=c:a.readOnly=!1},definePlaceholder:function(a,b){b.placeholderTranslation?a.placeholder=e.get(b.placeholderTranslation):b.placeholder&&(a.placeholder=b.placeholder)},defineLabel:function(a,b,c,d){return b.translation?a.label=e.get(b.translation):"function"==typeof b.label?Object.defineProperty(a,"label",{get:function(){return b.label(c(),d)}}):b.label&&(a.label=b.label),""},defineCustom:function(a,b,c){var d=a.definition[c];"function"==typeof d?Object.defineProperty(a,c,{get:function(){return d(a.data,b,a.args)}}):d&&(a[c]=d)},fillOptions:function(a,b,d,f,g){function h(){var e=a.options;return"function"==typeof e&&(e=a.options.call(null,b,d,g)),"object"==typeof e&&"function"==typeof e.then?e:c.resolve(e)}function i(a){return a.map(function(a){var b={value:a.value};return a.translation?b.label=e.get(a.translation):a.label?b.label=a.label:b.label=a.value,a.tooltipTranslation?b.tooltip=e.get(a.tooltipTranslation):a.tooltip&&(b.tooltip=a.tooltip),b})}return h().then(function(a){a=i(a),f.splice(0,f.length);for(var b=0;b<a.length;++b)f.push(a[b])})},validateType:function(a,b,c,e){var f=!1;return"boolean"==typeof b.invalid&&(f=f||b.invalid),"function"==typeof b.invalid&&(f=f||b.invalid.call(null,c,e.properties,e)),"number"===b.type&&(d.isNumeric(a)?("number"==typeof b.max&&a>b.max&&(f=!0),"number"==typeof b.min&&a<b.min&&(f=!0)):f=!0),"integer"===b.type&&(d.isInteger(a)?("number"==typeof b.max&&a>b.max&&(f=!0),"number"==typeof b.min&&a<b.min&&(f=!0)):f=!0),"string"===b.type&&("undefined"!=typeof b.maxlength&&(f=f||a.length>b.maxlength),"undefined"!=typeof b.minlength&&(f=f||a.length<b.minlength)),!f}};return f}),define("general.utils/expression-validator",["core.utils/notification","core.utils/class","core.models/app"],function(a,b,c){var d={Expression:0,NumberOrExpression:1},e=b.extend("ExpressionValidator",{init:function(b,e){this.currentExpr=null,this.nextExpr=null,this.hasOutstandingCall=!1,this.app=b||c.current,this.mode=e||d.Expression,a.create(this,"Update")},onResponse:function(a){var b,c,d,e,f;if(this.hasOutstandingCall=!1,this.nextExpr)b=this.nextExpr,c=this.nextLabels,this.nextExpr=null,this.nextLabels=null,this.callEngine(b,c);else{for(b=this.currentExpr,d=!a.qErrorMsg&&0===a.qBadFieldNames.length,e=0;e<a.qBadFieldNames.length;e++)f=a.qBadFieldNames[e],f.name=b.substr(f.qFrom||0,f.qCount);this.Update.emit({valid:d,data:{error:a.qErrorMsg,bad:a.qBadFieldNames}})}},callEngine:function(a,b){var c=this;if(this.hasOutstandingCall)throw new Error("Invalid state");this.currentExpr=a,this.hasOutstandingCall=!0;var e;e=this.mode===d.NumberOrExpression?this.app.checkNumberOrExpression(a):this.app.checkExpression(a,b),e.then(function(a){c.onResponse(a)},function(){c.onResponse({qErrorMsg:"Error",qBadFieldNames:[]})})},validate:function(a,b){this.hasOutstandingCall?(this.nextExpr=a,this.nextLabels=b):this.callEngine(a,b)}});return{ExpressionValidator:e,Modes:d}}),define("general.models/field",["core.models/base-object","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("Field",{clear:function(){return this.rpc("Clear","qReturn")},lock:function(){return this.rpc("Lock","qReturn")},unlock:function(){return this.rpc("Unlock","qReturn")},clearOther:function(a){return this.rpc("ClearAllButThis","qReturn",[a||!1])},selectPossible:function(a){return this.rpc("SelectPossible","qReturn",[a||!1])},selectExcluded:function(a){return this.rpc("SelectExcluded","qReturn",[a||!1])},selectAll:function(a){return this.rpc("SelectAll","qReturn",[a||!1])},selectAlternative:function(a){return this.rpc("SelectAlternative",null,[a||!1])},selectMatch:function(a,b){return this.rpc("Select","qReturn",[a||"",b||!1])},toggleSelect:function(a,b){return this.rpc("ToggleSelect","qReturn",[a||"",b||!1])},select:function(a,b,c){return this.rpc("LowLevelSelect","qReturn",[a,b||!1,c||!1])},selectValues:function(a,b,c){return this.rpc("SelectValues","qReturn",[a,b||!1,c||!1])}},{listProperties:{qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0}}}),c.get=function(a,c,d){function e(){return d.enigmaModel.getField(a,c)}c=c||"$";var f="FIELD_"+a+"_"+c;return d=d||b.current,this.getModel(f,d.session,e)},c}),define("text!general.components/info-popover/info-popover.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" position="position" collision="fit" on-close-view="closeView()" qv-dialog-escape="closeView()">\n\t<span class="info-popover-message" ng:show="translationKey" q-translation="{{translationKey}}"></span>\n\t<span class="info-popover-message" ng:show="text">{{text}}</span>\n</immidiate-contextual>\n'}),define("general.components/info-popover/info-popover",["text!./info-popover.ng.html"],function(a){var b={scope:{translationKey:"=",text:"=",alignTo:"=",position:"="},template:a,controller:["$scope",function(a){a.closeView=function(){a.destroyComponent(),a.onClose()}}]};return b}),define("text!assets/client/dialogs/expression-dialog/expression-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="expression-editor-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\n\t<div id="expression-editor-wrapper">\n\t\t<section id="expression-editor-content">\n\t\t\t<h1 class="dm-header" q-translation="{{input.title}}"></h1>\n\t\t\t<main class="dm-main">\n\n\t\t\t\t<div id="expression-editor-container">\n\t\t\t\t\t<div qv-extract="resizeCounter" id="expression-editor-stage" data-help="Panel.Stage" ng-class="{ invalid: !validity.expression }">\n\t\t\t\t\t\t<qv-codearea\n\t\t\t\t\t\t\t\tdata-show-breakpoint-gutter="false"\n\t\t\t\t\t\t\t\tdata-disabled="false"\n\t\t\t\t\t\t\t\tdata-resize-trigger="resizeCounter"\n\t\t\t\t\t\t\t\tdata-mode="qlikviewReloadScriptMode"\n\t\t\t\t\t\t\t\tqv-codearea-code-container="codearea"\n\t\t\t\t\t\t\t\tqv-codearea-exposed-context-api="codearea.contextApi"\n\t\t\t\t\t\t\t\tqv-codearea-function-tip="functionTipOptions"\n\t\t\t\t\t\t\t\tqv-codearea-limit="stringLimits.expression"\n\t\t\t\t\t\t\t\tqv-codearea-autocomplete="autocompleteOptions"\n\t\t\t\t\t\t\t\tqv-codearea-help-mode="false"\n\t\t\t\t\t\t\t\tqv-codearea-help-mode-options="helpModeOptions"\n\t\t\t\t\t\t\t></qv-codearea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div id="expression-editor-status" ng-class="info.status" >\n\t\t\t\t\t<i ng-class="{ disabled: !info.extraErrorMsg }"\n\t\t\t\t\t\tclass="icon-info"\n\t\t\t\t\t\tqva-activate="showErrorMessage( info.extraErrorMsg, $event )"></i>\n\t\t\t\t\t<span translate="info.errorMsg" ng-show="info.errorMsg"></span>\n\t\t\t\t</div>\n\n\t\t\t</main>\n\t\t</section>\n\t\t<section id="expression-editor-panel" class="qribby-accordion-pp">\n\t\t\t<section class="qribby-accordion-section">\n\t\t\t\t<header class="qribby-accordion-section-header">\n\t\t\t\t\t<h1 q-translation="Common.Fields"></h1>\n\t\t\t\t</header>\n\t\t\t\t<div class="qribby-accordion-section-content">\n\n\t\t\t\t\t<div id="expression-editor-toolbar-table">\n\t\t\t\t\t\t<label q-translation="Assets.FieldsTab.Table"></label>\n\t\t\t\t\t\t<lui-select\n\t\t\t\t\t\t\tid="expression-dialog-fields-tab-select-field"\n\t\t\t\t\t\t\tx-model="controller.selectedTable"\n\t\t\t\t\t\t\tx-options="table for table in controller.tableNames">\n\t\t\t\t\t\t</lui-select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id="expression-editor-toolbar-field">\n\t\t\t\t\t\t<label q-translation="Common.Field"></label>\n\t\t\t\t\t\t<lui-select\n\t\t\t\t\t\t\tid="expression-dialog-functions-common-select-field"\n\t\t\t\t\t\t\tx-model="controller.selectedField"\n\t\t\t\t\t\t\tx-options="field for field in controller.fieldNames">\n\t\t\t\t\t\t</lui-select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id="expression-editor-toolbar-functions">\n\t\t\t\t\t\t<lui-select id="expression-dialog-fields-tab-select-aggregation" x-model="controller.selectedCommonFunction">\n\t\t\t\t\t\t\t<option q-translation="ExpressionEditor.FieldsTab.SelectAggregationHint" value=""></option>\n\t\t\t\t\t\t\t<option ng-repeat="func in controller.commonFunctions" value="{{func}}">{{func}}</option>\n\t\t\t\t\t\t</lui-select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id="expression-editor-toolbar-insert">\n\t\t\t\t\t\t<lui-button\n\t\t\t\t\t\t\tng-disabled="!controller.previewText()"\n\t\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\t\tqva-activate="insertTextHandler($event)"\n\t\t\t\t\t\t\tq-title-translation="Tooltip.ExpressionEditor.InsertExpression">\n\t\t\t\t\t\t\t<span q-translation="ExpressionEditor.Insert"></span>\n\t\t\t\t\t\t</lui-button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>\n\t\t</section>\n\t</div>\n\t<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="Common.Apply"></qv-confirm-cancel-footer>\n</qv-modal-dialog>\n'}),define("assets/client/dialogs/expression-dialog/expression-dialog-controller",["util"],function(a){"use strict";function b(){return["Sum","Count","Avg","Min","Max"]}function c(){var b;return b=this.selectedField||"",b=a.escapeField(b),this.selectedCommonFunction?this.selectedCommonFunction+"("+b+")":b}function d(a){return a.map(function(a){return a.qName})}function e(a,b){return a.filter(function(a){return a.qSrcTables.indexOf(b)!==-1})}function f(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())}function g(a){var b,c,d=[];for(b=0;b<a.length;++b)for(c=0;c<a[b].qSrcTables.length;++c)d.indexOf(a[b].qSrcTables[c])===-1&&d.push(a[b].qSrcTables[c]);return d.sort(f),d}function h(a,b,c){c!==a.allTablesText&&(b=e(b,c)),a.fieldNames=d(b),i(a)}function i(a){a.fieldNames.indexOf(a.selectedField)===-1&&(a.selectedField=a.fieldNames[0])}function j(a){var e=a.translator,f=a.fields.slice();f.sort(function(a,b){return a.qName.toLowerCase().localeCompare(b.qName.toLowerCase())});var j=e.get("Common.All.Tables"),k={allTablesText:j,commonFunctions:b(),selectedCommonFunction:"",setTableFilter:function(a){h(k,f,a)},selectedTable:j,tableNames:[j].concat(g(f)),fieldNames:d(f),selectedField:"",previewText:c};return i(k),k}return{create:j}}),define("assets/client/dialogs/expression-dialog/expression-validation-info",[],function(){"use strict";function a(a,b){if(a.status=b.valid?e:f,a.errorMsg=b.valid?"Common.OK":"Expression.Validation.InvalidExpression",a.extraErrorMsg="",b.data)if(b.data.bad.length>0){var c=b.data.bad.map(function(a){return a.name});a.errorMsg={id:"Expression.Validation.BadFieldName",value:[c.join(", ")]}}else b.data.error&&(a.extraErrorMsg=b.data.error)}function b(a,b,c,e){""!==c.replace(/\s+/g,"")?(a.status=d,b.validate(c,e)):(a.status=f,a.errorMsg="",a.extraErrorMsg="")}function c(c){var e=c.validator,f={errorMsg:"",extraErrorMsg:"",status:d,setExpr:function(a){b(f,e,a,c.labels)}};return e.Update.bind(function(b){a(f,b)}),f}var d="validating",e="valid",f="invalid";return{create:c}}),define("client.services/validation",[],function(){function a(a){return a.replace(/^=+/,"")}function b(a,b){return a.validity.name=!!a.name&&!!a.name.trim()&&a.name.length<=b.name,a.description?a.validity.description=a.description.length<=b.description:a.validity.description=!0,a.validity.name&&a.validity.description}function c(b,c){var d=b.expression,e="string"==typeof d&&d.trim().length>0&&d.length<=c.expression;return d&&(b.expression=a(d)),b.validity.expression=e,e}function d(a){var b=a.selectedFields,c=!1;return!!b&&("single"===a.type?c=1===b.length:"drilldown"===a.type&&(c=b.length>1),a.validity.selectedFields=c,c)}return{validateMetadata:b,validateExpr:c,validateFieldsInDimension:d}}),define("text!general.components/function-tip-view/function-tip-view.html",[],function(){return'<qui-float qui-offset="offset" qui-resize-on-change="content" class="qv-function-tip-container">\n\t<div class=\'qv-function-tip-view\' ng-show=\'content\'>{{content}}</div>\n</qui-float>\n'}),define("general.components/function-tip-view/function-tip-view",["text!./function-tip-view.html"],function(a){"use strict";return{scope:{offset:"=",content:"="},template:a,controller:[function(){}]}}),define("lz-string",[],function(){var a={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(b){if(null==b)return"";var c,d,e,f,g,h,i,j="",k=0;for(b=a.compress(b);k<2*b.length;)k%2==0?(c=b.charCodeAt(k/2)>>8,d=255&b.charCodeAt(k/2),e=k/2+1<b.length?b.charCodeAt(k/2+1)>>8:NaN):(c=255&b.charCodeAt((k-1)/2),(k+1)/2<b.length?(d=b.charCodeAt((k+1)/2)>>8,e=255&b.charCodeAt((k+1)/2)):d=e=NaN),k+=3,f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+a._keyStr.charAt(f)+a._keyStr.charAt(g)+a._keyStr.charAt(h)+a._keyStr.charAt(i);return j},decompressFromBase64:function(b){if(null==b)return"";var c,d,e,f,g,h,i,j,k="",l=0,m=0,n=a._f;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");m<b.length;)g=a._keyStr.indexOf(b.charAt(m++)),h=a._keyStr.indexOf(b.charAt(m++)),i=a._keyStr.indexOf(b.charAt(m++)),j=a._keyStr.indexOf(b.charAt(m++)),d=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,l%2==0?(c=d<<8,64!=i&&(k+=n(c|e)),64!=j&&(c=f<<8)):(k+=n(c|d),64!=i&&(c=e<<8),64!=j&&(k+=n(c|f))),l+=3;return a.decompress(k)},compressToUTF16:function(b){if(null==b)return"";var c,d,e,f="",g=0,h=a._f;for(b=a.compress(b),c=0;c<b.length;c++)switch(d=b.charCodeAt(c),g++){case 0:f+=h((d>>1)+32),e=(1&d)<<14;break;case 1:f+=h(e+(d>>2)+32),e=(3&d)<<13;break;case 2:f+=h(e+(d>>3)+32),e=(7&d)<<12;break;case 3:f+=h(e+(d>>4)+32),e=(15&d)<<11;break;case 4:f+=h(e+(d>>5)+32),e=(31&d)<<10;break;case 5:f+=h(e+(d>>6)+32),e=(63&d)<<9;break;case 6:f+=h(e+(d>>7)+32),e=(127&d)<<8;break;case 7:f+=h(e+(d>>8)+32),e=(255&d)<<7;break;case 8:f+=h(e+(d>>9)+32),e=(511&d)<<6;break;case 9:f+=h(e+(d>>10)+32),e=(1023&d)<<5;break;case 10:f+=h(e+(d>>11)+32),e=(2047&d)<<4;break;case 11:f+=h(e+(d>>12)+32),e=(4095&d)<<3;break;case 12:f+=h(e+(d>>13)+32),e=(8191&d)<<2;break;case 13:f+=h(e+(d>>14)+32),e=(16383&d)<<1;break;case 14:f+=h(e+(d>>15)+32,(32767&d)+32),g=0}return f+h(e+32)},decompressFromUTF16:function(b){if(null==b)return"";for(var c,d,e="",f=0,g=0,h=a._f;g<b.length;){switch(d=b.charCodeAt(g)-32,f++){case 0:c=d<<1;break;case 1:e+=h(c|d>>14),c=(16383&d)<<2;break;case 2:e+=h(c|d>>13),c=(8191&d)<<3;break;case 3:e+=h(c|d>>12),c=(4095&d)<<4;break;case 4:e+=h(c|d>>11),c=(2047&d)<<5;break;case 5:e+=h(c|d>>10),c=(1023&d)<<6;break;case 6:e+=h(c|d>>9),c=(511&d)<<7;break;case 7:e+=h(c|d>>8),c=(255&d)<<8;break;case 8:e+=h(c|d>>7),c=(127&d)<<9;break;case 9:e+=h(c|d>>6),c=(63&d)<<10;break;case 10:e+=h(c|d>>5),c=(31&d)<<11;break;case 11:e+=h(c|d>>4),c=(15&d)<<12;break;case 12:e+=h(c|d>>3),c=(7&d)<<13;break;case 13:e+=h(c|d>>2),c=(3&d)<<14;break;case 14:e+=h(c|d>>1),c=(1&d)<<15;break;case 15:e+=h(c|d),f=0}g++}return a.decompress(e)},compress:function(b){if(null==b)return"";var c,d,e,f={},g={},h="",i="",j="",k=2,l=3,m=2,n="",o=0,p=0,q=a._f;for(e=0;e<b.length;e+=1)if(h=b.charAt(e),Object.prototype.hasOwnProperty.call(f,h)||(f[h]=l++,g[h]=!0),i=j+h,Object.prototype.hasOwnProperty.call(f,i))j=i;else{if(Object.prototype.hasOwnProperty.call(g,j)){if(j.charCodeAt(0)<256){for(c=0;c<m;c++)o<<=1,15==p?(p=0,n+=q(o),o=0):p++;for(d=j.charCodeAt(0),c=0;c<8;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}else{for(d=1,c=0;c<m;c++)o=o<<1|d,15==p?(p=0,n+=q(o),o=0):p++,d=0;for(d=j.charCodeAt(0),c=0;c<16;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}k--,0==k&&(k=Math.pow(2,m),m++),delete g[j]}else for(d=f[j],c=0;c<m;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;k--,0==k&&(k=Math.pow(2,m),m++),f[i]=l++,j=String(h)}if(""!==j){if(Object.prototype.hasOwnProperty.call(g,j)){if(j.charCodeAt(0)<256){for(c=0;c<m;c++)o<<=1,15==p?(p=0,n+=q(o),o=0):p++;for(d=j.charCodeAt(0),c=0;c<8;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}else{for(d=1,c=0;c<m;c++)o=o<<1|d,15==p?(p=0,n+=q(o),o=0):p++,d=0;for(d=j.charCodeAt(0),c=0;c<16;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}k--,0==k&&(k=Math.pow(2,m),m++),delete g[j]}else for(d=f[j],c=0;c<m;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;k--,0==k&&(k=Math.pow(2,m),m++)}for(d=2,c=0;c<m;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;for(;;){if(o<<=1,15==p){n+=q(o);break}p++}return n},decompress:function(b){if(null==b)return"";if(""==b)return null;var c,d,e,f,g,h,i,j,k=[],l=4,m=4,n=3,o="",p="",q=a._f,r={string:b,val:b.charCodeAt(0),position:32768,index:1};for(d=0;d<3;d+=1)k[d]=d;for(f=0,h=Math.pow(2,2),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;switch(c=f){case 0:for(f=0,h=Math.pow(2,8),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;j=q(f);break;case 1:for(f=0,h=Math.pow(2,16),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;j=q(f);break;case 2:return""}for(k[3]=j,e=p=j;;){if(r.index>r.string.length)return"";for(f=0,h=Math.pow(2,n),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;switch(j=f){case 0:for(f=0,h=Math.pow(2,8),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;k[m++]=q(f),j=m-1,l--;break;case 1:for(f=0,h=Math.pow(2,16),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;k[m++]=q(f),j=m-1,l--;break;case 2:return p}if(0==l&&(l=Math.pow(2,n),n++),k[j])o=k[j];else{if(j!==m)return null;o=e+e.charAt(0)}p+=o,k[m++]=e+o.charAt(0),l--,e=o,0==l&&(l=Math.pow(2,n),n++)}}};return a}),define("general.models/bnf-model",["core.models/engine","lz-string","core.utils/deferred"],function(a,b,c){"use strict";function d(a){function b(a){return a.replace(/\s+/g," ").replace(/\s+(\)|\]|,)/g,"$1").replace(/(\(|\[|,)\s+/g,"$1")}function c(){a.forEach(e);var b=[{qStr:"must_include",qBnfLiteral:!0}];b.forEach(e)}function d(){function a(a,b){return{text:b,type:a}}u.functions.length<1&&c();var b=u.notFunctions.map(a.bind(null,"keyword")),d=u.functions.map(a.bind(null,"function"));u.autocompleteList=b.concat(d)}function e(a){a.qBnfLiteral===!0&&(u.keywords.indexOf(a.qStr)===-1&&u.keywords.push(a.qStr),a.qStr&&(u.keywordsAsLowerCase.push(a.qStr.toLowerCase()),u.mapping[a.qStr.toLowerCase()]=a.qNbr,a.qAggrFunc||a.qQvFunc?(u.functions.indexOf(a.qStr)===-1&&u.functions.push(a.qStr),t[a.qStr.toLowerCase()]="function"):a.qFieldFlag||(u.notFunctions.indexOf(a.qStr)===-1&&u.notFunctions.push(a.qStr),t[a.qStr.toLowerCase()]="keyword")))}function f(b){if(b=parseInt(b,10),u.bnfEntries[b])return u.bnfEntries[b];var c=a.filter(function(a){return parseInt(a.qNbr,10)===b});return u.bnfEntries[b]=c[0],c[0]||!1}function g(a){u.keywords.length<1&&c(),a=a.toLowerCase();var b=u.mapping[a];return f(b)}function h(a){var b="",c=f(a);return a>=0&&a<=56?b=c.qStr||"":c&&(b=c.qStr||c.qName),b}function i(a){return a&&!a.signature&&(a.qBnf&&a.qBnf.length>0?a.signature=a.qBnf.map(h).join(" ").trim():a.qPNbr&&(a.signature=i(f(a.qPNbr))),a.signature=b(a.signature)),a.signature||""}function j(){return u.keywords.length<1&&c(),u.keywords}function k(){return u.keywordsAsLowerCase.length<1&&c(),u.keywordsAsLowerCase}function l(){return u.autocompleteList||d(),u.autocompleteList}function m(a){var b=g(a);return b!==!1?i(b):""}function n(){return a.filter(function(a){return a.qHelpId&&a.qHelpId>0}).map(function(a){return a.qStr})}function o(a){return"function"===t[a.toLowerCase()]}function p(){return!1}function q(){return!1}function r(a){return!!t[a.toLowerCase()]}function s(){return u.functions.length<1&&c(),u.functions}var t={},u={keywords:[],keywordsAsLowerCase:[],functions:[],notFunctions:[],bnfEntries:[],mapping:{}};return c(),{getBnfEntry:f,getLiteralString:h,getAllKeywords:j,getAllKeywordsAsLowerCase:k,getAutocompleteList:l,getKeywordsWithHelp:n,getSignatureFromKeyword:m,getFunctionTip:m,isFunction:o,isField:p,isKeyword:r,isVariable:q,getAllFunctions:s}}function e(e){var f="BNF_CACHE_DATA_"+e,g="BNF_CACHE_VERSION_"+e;return a.global.qvVersion().then(function(h){var i=new c,j=localStorage.getItem(g),k=j===h,l=k?localStorage.getItem(f):void 0;if(l)try{var m=JSON.parse(b.decompressFromUTF16(l));return i.resolve(d(m)),i.promise}catch(n){}return a.global.getBNF(e).then(function(a){var c=a.qBnfDefs;localStorage.setItem(f,b.compressToUTF16(JSON.stringify(c))),localStorage.setItem(g,h),i.resolve(d(c))}),i.promise})}function f(a){return i[a]||(i[a]=e(a)),i[a]}function g(){return f("S")}function h(){return f("E")}var i={};return{createBnfModel:d,getReloadScriptBnfModel:g,getExpressionBnfModel:h}}),define("assets/client/dialogs/expression-dialog/expression-bnf",["core.utils/deferred","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","general.models/bnf-model","util"],function(a,b,c,d,e){function f(a,b){return"field"===a?{text:b,type:a,value:e.escapeField(b)}:{text:b,type:a}}function g(a){function b(a){return j.isFunction(a)}function c(a){return j.getFunctionTip(a)}function d(a){return!!k[a.toLowerCase()]||b(a)}function e(a){return!!m[a]}function g(a){return!!n[a]}function i(){return s}var j=a.bnf,k=h(),m=a.fields,n=a.variables,o=l.map(f.bind(null,"keyword")),p=Object.keys(n).map(f.bind(null,"variable")),q=Object.keys(m).map(f.bind(null,"field")),r=j.getAllFunctions().map(f.bind(null,"function")),s=o.concat(p,q,r),t={getAutocompleteList:i,getFunctionTip:c,isFunction:b,isField:e,isKeyword:d,isVariable:g};return t}function h(){for(var a={},b=0;b<l.length;++b){var c=l[b];a[c]=!0}return a}function i(a){return b.getListLayout(a).then(function(a){a=c.expand(a);for(var b={},d=0;d<a.length;++d){var e=a[d].qName;b[e]=!0}return b})}function j(a){return a.enigmaModel.getVariableList().then(function(a){for(var b={},c=0;c<a.length;++c){var d=a[c].qName;b[d]=!0}return b})}function k(b){return a.all({bnf:d.getExpressionBnfModel(),fields:i(b),variables:j(b)}).then(g)}var l=["like","not","and","or","xor","follows","precedes","bitnot","bitand","bitor","bitxor","$","$1","$2","$3","$4","$5","$_1","$_2","$_3","$_4","$_5","total","distinct","nodistinct","all","include","must_include"];return{get:k}}),define("general.components/extract",["jquery","qvangular","core.utils/resize","general.services/aligner/aligner"],function(a,b,c,d){b.directive("qvExtract",["$timeout","$parse",function(b,e){return{restrict:"A",transclude:!0,link:function(f,g,h,i,j){function k(){l.update(),++n,m.assign&&m.assign(f,n)}var l=new d({container:a("<div style='position:absolute'>"),body:document.body,alignAgainst:g}),m=e(h.qvExtract),n=0;l.showTranscluded(j),l.update(),b(function(){k()}),c.on("end",k),f.$on("$destroy",function(){l.hide(),c.off("end",k)})}}}])}),function(a){if("object"==typeof exports&&"object"==typeof module)module.exports=a();else{if("function"==typeof define&&define.amd)return define("cm",[],a);(this||window).CodeMirror=a()}}(function(){"use strict";function a(c,d){if(!(this instanceof a))return new a(c,d);this.options=d=d?Ke(d):{},Ke($f,d,!1),n(d);var e=d.value;"string"==typeof e&&(e=new wg(e,d.mode,null,d.lineSeparator)),this.doc=e;var f=new a.inputStyles[d.inputStyle](this),g=this.display=new b(c,e,f);g.wrapper.CodeMirror=this,j(this),h(this),d.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),d.autofocus&&!Cf&&g.input.focus(),r(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new De,keySeq:null,specialChars:null};var i=this;sf&&tf<11&&setTimeout(function(){i.display.input.reset(!0)},20),Qb(this),We(),ub(this),this.curOp.forceUpdate=!0,Xd(this,e),d.autofocus&&!Cf||i.hasFocus()?setTimeout(Le(qc,this),20):rc(this);for(var k in _f)_f.hasOwnProperty(k)&&_f[k](this,d[k],ag);w(this),d.finishInit&&d.finishInit(this);for(var l=0;l<eg.length;++l)eg[l](this);wb(this),uf&&d.lineWrapping&&"optimizelegibility"==getComputedStyle(g.lineDiv).textRendering&&(g.lineDiv.style.textRendering="auto")}function b(a,b,c){var d=this;this.input=c,d.scrollbarFiller=Pe("div",null,"CodeMirror-scrollbar-filler"),d.scrollbarFiller.setAttribute("cm-not-content","true"),d.gutterFiller=Pe("div",null,"CodeMirror-gutter-filler"),d.gutterFiller.setAttribute("cm-not-content","true"),d.lineDiv=Pe("div",null,"CodeMirror-code"),d.selectionDiv=Pe("div",null,null,"position: relative; z-index: 1"),d.cursorDiv=Pe("div",null,"CodeMirror-cursors"),d.measure=Pe("div",null,"CodeMirror-measure"),d.lineMeasure=Pe("div",null,"CodeMirror-measure"),d.lineSpace=Pe("div",[d.measure,d.lineMeasure,d.selectionDiv,d.cursorDiv,d.lineDiv],null,"position: relative; outline: none"),d.mover=Pe("div",[Pe("div",[d.lineSpace],"CodeMirror-lines")],null,"position: relative"),d.sizer=Pe("div",[d.mover],"CodeMirror-sizer"),d.sizerWidth=null,d.heightForcer=Pe("div",null,null,"position: absolute; height: "+Hg+"px; width: 1px;"),d.gutters=Pe("div",null,"CodeMirror-gutters"),d.lineGutter=null,d.scroller=Pe("div",[d.sizer,d.heightForcer,d.gutters],"CodeMirror-scroll"),d.scroller.setAttribute("tabIndex","-1"),d.wrapper=Pe("div",[d.scrollbarFiller,d.gutterFiller,d.scroller],"CodeMirror"),sf&&tf<8&&(d.gutters.style.zIndex=-1,d.scroller.style.paddingRight=0),uf||pf&&Cf||(d.scroller.draggable=!0),a&&(a.appendChild?a.appendChild(d.wrapper):a(d.wrapper)),d.viewFrom=d.viewTo=b.first,d.reportedViewFrom=d.reportedViewTo=b.first,d.view=[],d.renderedView=null,d.externalMeasured=null,d.viewOffset=0,d.lastWrapHeight=d.lastWrapWidth=0,d.updateLineNumbers=null,d.nativeBarWidth=d.barHeight=d.barWidth=0,d.scrollbarsClipped=!1,d.lineNumWidth=d.lineNumInnerWidth=d.lineNumChars=null,d.alignWidgets=!1,d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null,d.maxLine=null,d.maxLineLength=0,d.maxLineChanged=!1,d.wheelDX=d.wheelDY=d.wheelStartX=d.wheelStartY=null,d.shift=!1,d.selForContextMenu=null,
d.activeTouch=null,c.init(d)}function c(b){b.doc.mode=a.getMode(b.options,b.doc.modeOption),d(b)}function d(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null)}),a.doc.frontier=a.doc.first,Na(a,100),a.state.modeGen++,a.curOp&&Jb(a)}function e(a){a.options.lineWrapping?(Yg(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(Xg(a.display.wrapper,"CodeMirror-wrap"),m(a)),g(a),Jb(a),hb(a),setTimeout(function(){s(a)},100)}function f(a){var b=sb(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/tb(a.display)-3);return function(e){if(vd(a.doc,e))return 0;var f=0;if(e.widgets)for(var g=0;g<e.widgets.length;g++)e.widgets[g].height&&(f+=e.widgets[g].height);return c?f+(Math.ceil(e.text.length/d)||1)*b:f+b}}function g(a){var b=a.doc,c=f(a);b.iter(function(a){var b=c(a);b!=a.height&&_d(a,b)})}function h(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-"),hb(a)}function i(a){j(a),Jb(a),setTimeout(function(){v(a)},20)}function j(a){var b=a.display.gutters,c=a.options.gutters;Qe(b);for(var d=0;d<c.length;++d){var e=c[d],f=b.appendChild(Pe("div",null,"CodeMirror-gutter "+e));"CodeMirror-linenumbers"==e&&(a.display.lineGutter=f,f.style.width=(a.display.lineNumWidth||1)+"px")}b.style.display=d?"":"none",k(a)}function k(a){var b=a.display.gutters.offsetWidth;a.display.sizer.style.marginLeft=b+"px"}function l(a){if(0==a.height)return 0;for(var b,c=a.text.length,d=a;b=od(d);){var e=b.find(0,!0);d=e.from.line,c+=e.from.ch-e.to.ch}for(d=a;b=pd(d);){var e=b.find(0,!0);c-=d.text.length-e.from.ch,d=e.to.line,c+=d.text.length-e.to.ch}return c}function m(a){var b=a.display,c=a.doc;b.maxLine=Yd(c,c.first),b.maxLineLength=l(b.maxLine),b.maxLineChanged=!0,c.iter(function(a){var c=l(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function n(a){var b=Ge(a.gutters,"CodeMirror-linenumbers");b==-1&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):b>-1&&!a.lineNumbers&&(a.gutters=a.gutters.slice(0),a.gutters.splice(b,1))}function o(a){var b=a.display,c=b.gutters.offsetWidth,d=Math.round(a.doc.height+Sa(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+Ua(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function p(a,b,c){this.cm=c;var d=this.vert=Pe("div",[Pe("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),e=this.horiz=Pe("div",[Pe("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");a(d),a(e),Cg(d,"scroll",function(){d.clientHeight&&b(d.scrollTop,"vertical")}),Cg(e,"scroll",function(){e.clientWidth&&b(e.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,sf&&tf<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function q(){}function r(b){b.display.scrollbars&&(b.display.scrollbars.clear(),b.display.scrollbars.addClass&&Xg(b.display.wrapper,b.display.scrollbars.addClass)),b.display.scrollbars=new a.scrollbarModel[b.options.scrollbarStyle](function(a){b.display.wrapper.insertBefore(a,b.display.scrollbarFiller),Cg(a,"mousedown",function(){b.state.focused&&setTimeout(function(){b.display.input.focus()},0)}),a.setAttribute("cm-not-content","true")},function(a,c){"horizontal"==c?ec(b,a):dc(b,a)},b),b.display.scrollbars.addClass&&Yg(b.display.wrapper,b.display.scrollbars.addClass)}function s(a,b){b||(b=o(a));var c=a.display.barWidth,d=a.display.barHeight;t(a,b);for(var e=0;e<4&&c!=a.display.barWidth||d!=a.display.barHeight;e++)c!=a.display.barWidth&&a.options.lineWrapping&&F(a),t(a,o(a)),c=a.display.barWidth,d=a.display.barHeight}function t(a,b){var c=a.display,d=c.scrollbars.update(b);c.sizer.style.paddingRight=(c.barWidth=d.right)+"px",c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px",c.heightForcer.style.borderBottom=d.bottom+"px solid transparent",d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="",d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d.bottom+"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function u(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop;d=Math.floor(d-Ra(a));var e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight,f=be(b,d),g=be(b,e);if(c&&c.ensure){var h=c.ensure.from.line,i=c.ensure.to.line;h<f?(f=h,g=be(b,ce(Yd(b,h))+a.wrapper.clientHeight)):Math.min(i,b.lastLine())>=g&&(f=be(b,ce(Yd(b,i))-a.wrapper.clientHeight),g=i)}return{from:f,to:Math.max(g,f+1)}}function v(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&a.options.fixedGutter){for(var d=y(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,f=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&c[g].gutter&&(c[g].gutter.style.left=f);var h=c[g].alignable;if(h)for(var i=0;i<h.length;i++)h[i].style.left=f}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function w(a){if(!a.options.lineNumbers)return!1;var b=a.doc,c=x(a.options,b.first+b.size-1),d=a.display;if(c.length!=d.lineNumChars){var e=d.measure.appendChild(Pe("div",[Pe("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),f=e.firstChild.offsetWidth,g=e.offsetWidth-f;return d.lineGutter.style.width="",d.lineNumInnerWidth=Math.max(f,d.lineGutter.offsetWidth-g)+1,d.lineNumWidth=d.lineNumInnerWidth+g,d.lineNumChars=d.lineNumInnerWidth?c.length:-1,d.lineGutter.style.width=d.lineNumWidth+"px",k(a),!0}return!1}function x(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function y(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function z(a,b,c){var d=a.display;this.viewport=b,this.visible=u(d,a.doc,b),this.editorIsHidden=!d.wrapper.offsetWidth,this.wrapperHeight=d.wrapper.clientHeight,this.wrapperWidth=d.wrapper.clientWidth,this.oldDisplayWidth=Va(a),this.force=c,this.dims=H(a),this.events=[]}function A(a){var b=a.display;!b.scrollbarsClipped&&b.scroller.offsetWidth&&(b.nativeBarWidth=b.scroller.offsetWidth-b.scroller.clientWidth,b.heightForcer.style.height=Ua(a)+"px",b.sizer.style.marginBottom=-b.nativeBarWidth+"px",b.sizer.style.borderRightWidth=Ua(a)+"px",b.scrollbarsClipped=!0)}function B(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return Lb(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==Pb(a))return!1;w(a)&&(Lb(a),b.dims=H(a));var e=d.first+d.size,f=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(e,b.visible.to+a.options.viewportMargin);c.viewFrom<f&&f-c.viewFrom<20&&(f=Math.max(d.first,c.viewFrom)),c.viewTo>g&&c.viewTo-g<20&&(g=Math.min(e,c.viewTo)),Jf&&(f=td(a.doc,f),g=ud(a.doc,g));var h=f!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||c.lastWrapWidth!=b.wrapperWidth;Ob(a,f,g),c.viewOffset=ce(Yd(a.doc,c.viewFrom)),a.display.mover.style.top=c.viewOffset+"px";var i=Pb(a);if(!h&&0==i&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo))return!1;var j=Se();return i>4&&(c.lineDiv.style.display="none"),I(a,c.updateLineNumbers,b.dims),i>4&&(c.lineDiv.style.display=""),c.renderedView=c.view,j&&Se()!=j&&j.offsetHeight&&j.focus(),Qe(c.cursorDiv),Qe(c.selectionDiv),c.gutters.style.height=c.sizer.style.minHeight=0,h&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,Na(a,400)),c.updateLineNumbers=null,!0}function C(a,b){for(var c=b.viewport,d=!0;(d&&a.options.lineWrapping&&b.oldDisplayWidth!=Va(a)||(c&&null!=c.top&&(c={top:Math.min(a.doc.height+Sa(a.display)-Wa(a),c.top)}),b.visible=u(a.display,a.doc,c),!(b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)))&&B(a,b);d=!1){F(a);var e=o(a);Ia(a),s(a,e),E(a,e)}b.signal(a,"update",a),a.display.viewFrom==a.display.reportedViewFrom&&a.display.viewTo==a.display.reportedViewTo||(b.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo)}function D(a,b){var c=new z(a,b);if(B(a,c)){F(a),C(a,c);var d=o(a);Ia(a),s(a,d),E(a,d),c.finish()}}function E(a,b){a.display.sizer.style.minHeight=b.docHeight+"px",a.display.heightForcer.style.top=b.docHeight+"px",a.display.gutters.style.height=b.docHeight+a.display.barHeight+Ua(a)+"px"}function F(a){for(var b=a.display,c=b.lineDiv.offsetTop,d=0;d<b.view.length;d++){var e,f=b.view[d];if(!f.hidden){if(sf&&tf<8){var g=f.node.offsetTop+f.node.offsetHeight;e=g-c,c=g}else{var h=f.node.getBoundingClientRect();e=h.bottom-h.top}var i=f.line.height-e;if(e<2&&(e=sb(b)),(i>.001||i<-.001)&&(_d(f.line,e),G(f.line),f.rest))for(var j=0;j<f.rest.length;j++)G(f.rest[j])}}}function G(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b)a.widgets[b].height=a.widgets[b].node.parentNode.offsetHeight}function H(a){for(var b=a.display,c={},d={},e=b.gutters.clientLeft,f=b.gutters.firstChild,g=0;f;f=f.nextSibling,++g)c[a.options.gutters[g]]=f.offsetLeft+f.clientLeft+e,d[a.options.gutters[g]]=f.clientWidth;return{fixedPos:y(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function I(a,b,c){function d(b){var c=b.nextSibling;return uf&&Df&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b),c}for(var e=a.display,f=a.options.lineNumbers,g=e.lineDiv,h=g.firstChild,i=e.view,j=e.viewFrom,k=0;k<i.length;k++){var l=i[k];if(l.hidden);else if(l.node&&l.node.parentNode==g){for(;h!=l.node;)h=d(h);var m=f&&null!=b&&b<=j&&l.lineNumber;l.changes&&(Ge(l.changes,"gutter")>-1&&(m=!1),J(a,l,j,c)),m&&(Qe(l.lineNumber),l.lineNumber.appendChild(document.createTextNode(x(a.options,j)))),h=l.node.nextSibling}else{var n=R(a,l,j,c);g.insertBefore(n,h)}j+=l.size}for(;h;)h=d(h)}function J(a,b,c,d){for(var e=0;e<b.changes.length;e++){var f=b.changes[e];"text"==f?N(a,b):"gutter"==f?P(a,b,c,d):"class"==f?O(b):"widget"==f&&Q(a,b,d)}b.changes=null}function K(a){return a.node==a.text&&(a.node=Pe("div",null,null,"position: relative"),a.text.parentNode&&a.text.parentNode.replaceChild(a.node,a.text),a.node.appendChild(a.text),sf&&tf<8&&(a.node.style.zIndex=2)),a.node}function L(a){var b=a.bgClass?a.bgClass+" "+(a.line.bgClass||""):a.line.bgClass;if(b&&(b+=" CodeMirror-linebackground"),a.background)b?a.background.className=b:(a.background.parentNode.removeChild(a.background),a.background=null);else if(b){var c=K(a);a.background=c.insertBefore(Pe("div",null,b),c.firstChild)}}function M(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):Ld(a,b)}function N(a,b){var c=b.text.className,d=M(a,b);b.text==b.node&&(b.node=d.pre),b.text.parentNode.replaceChild(d.pre,b.text),b.text=d.pre,d.bgClass!=b.bgClass||d.textClass!=b.textClass?(b.bgClass=d.bgClass,b.textClass=d.textClass,O(b)):c&&(b.text.className=c)}function O(a){L(a),a.line.wrapClass?K(a).className=a.line.wrapClass:a.node!=a.text&&(a.node.className="");var b=a.textClass?a.textClass+" "+(a.line.textClass||""):a.line.textClass;a.text.className=b||""}function P(a,b,c,d){if(b.gutter&&(b.node.removeChild(b.gutter),b.gutter=null),b.gutterBackground&&(b.node.removeChild(b.gutterBackground),b.gutterBackground=null),b.line.gutterClass){var e=K(b);b.gutterBackground=Pe("div",null,"CodeMirror-gutter-background "+b.line.gutterClass,"left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px; width: "+d.gutterTotalWidth+"px"),e.insertBefore(b.gutterBackground,b.text)}var f=b.line.gutterMarkers;if(a.options.lineNumbers||f){var e=K(b),g=b.gutter=Pe("div",null,"CodeMirror-gutter-wrapper","left: "+(a.options.fixedGutter?d.fixedPos:-d.gutterTotalWidth)+"px");if(a.display.input.setUneditable(g),e.insertBefore(g,b.text),b.line.gutterClass&&(g.className+=" "+b.line.gutterClass),!a.options.lineNumbers||f&&f["CodeMirror-linenumbers"]||(b.lineNumber=g.appendChild(Pe("div",x(a.options,c),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+d.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+a.display.lineNumInnerWidth+"px"))),f)for(var h=0;h<a.options.gutters.length;++h){var i=a.options.gutters[h],j=f.hasOwnProperty(i)&&f[i];j&&g.appendChild(Pe("div",[j],"CodeMirror-gutter-elt","left: "+d.gutterLeft[i]+"px; width: "+d.gutterWidth[i]+"px"))}}}function Q(a,b,c){b.alignable&&(b.alignable=null);for(var d,e=b.node.firstChild;e;e=d){var d=e.nextSibling;"CodeMirror-linewidget"==e.className&&b.node.removeChild(e)}S(a,b,c)}function R(a,b,c,d){var e=M(a,b);return b.text=b.node=e.pre,e.bgClass&&(b.bgClass=e.bgClass),e.textClass&&(b.textClass=e.textClass),O(b),P(a,b,c,d),S(a,b,d),b.node}function S(a,b,c){if(T(a,b.line,b,c,!0),b.rest)for(var d=0;d<b.rest.length;d++)T(a,b.rest[d],b,c,!1)}function T(a,b,c,d,e){if(b.widgets)for(var f=K(c),g=0,h=b.widgets;g<h.length;++g){var i=h[g],j=Pe("div",[i.node],"CodeMirror-linewidget");i.handleMouseEvents||j.setAttribute("cm-ignore-events","true"),U(i,j,c,d),a.display.input.setUneditable(j),e&&i.above?f.insertBefore(j,c.gutter||c.text):f.appendChild(j),xe(i,"redraw")}}function U(a,b,c,d){if(a.noHScroll){(c.alignable||(c.alignable=[])).push(b);var e=d.wrapperWidth;b.style.left=d.fixedPos+"px",a.coverGutter||(e-=d.gutterTotalWidth,b.style.paddingLeft=d.gutterTotalWidth+"px"),b.style.width=e+"px"}a.coverGutter&&(b.style.zIndex=5,b.style.position="relative",a.noHScroll||(b.style.marginLeft=-d.gutterTotalWidth+"px"))}function V(a){return Kf(a.line,a.ch)}function W(a,b){return Lf(a,b)<0?b:a}function X(a,b){return Lf(a,b)<0?a:b}function Y(a){a.state.focused||(a.display.input.focus(),qc(a))}function Z(a,b,c,d,e){var f=a.doc;a.display.shift=!1,d||(d=f.sel);var g=a.state.pasteIncoming||"paste"==e,h=f.splitLines(b),i=null;if(g&&d.ranges.length>1)if(Mf&&Mf.join("\n")==b){if(d.ranges.length%Mf.length==0){i=[];for(var j=0;j<Mf.length;j++)i.push(f.splitLines(Mf[j]))}}else h.length==d.ranges.length&&(i=He(h,function(a){return[a]}));for(var j=d.ranges.length-1;j>=0;j--){var k=d.ranges[j],l=k.from(),m=k.to();k.empty()&&(c&&c>0?l=Kf(l.line,l.ch-c):a.state.overwrite&&!g&&(m=Kf(m.line,Math.min(Yd(f,m.line).text.length,m.ch+Fe(h).length))));var n=a.curOp.updateInput,o={from:l,to:m,text:i?i[j%i.length]:h,origin:e||(g?"paste":a.state.cutIncoming?"cut":"+input")};zc(a.doc,o),xe(a,"inputRead",a,o)}b&&!g&&_(a,b),Lc(a),a.curOp.updateInput=n,a.curOp.typing=!0,a.state.pasteIncoming=a.state.cutIncoming=!1}function $(a,b){var c=a.clipboardData&&a.clipboardData.getData("text/plain");if(c)return a.preventDefault(),b.isReadOnly()||b.options.disableInput||Db(b,function(){Z(b,c,0,null,"paste")}),!0}function _(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,d=c.ranges.length-1;d>=0;d--){var e=c.ranges[d];if(!(e.head.ch>100||d&&c.ranges[d-1].head.line==e.head.line)){var f=a.getModeAt(e.head),g=!1;if(f.electricChars){for(var h=0;h<f.electricChars.length;h++)if(b.indexOf(f.electricChars.charAt(h))>-1){g=Nc(a,e.head.line,"smart");break}}else f.electricInput&&f.electricInput.test(Yd(a.doc,e.head.line).text.slice(0,e.head.ch))&&(g=Nc(a,e.head.line,"smart"));g&&xe(a,"electricInput",a,e.head.line)}}}function aa(a){for(var b=[],c=[],d=0;d<a.doc.sel.ranges.length;d++){var e=a.doc.sel.ranges[d].head.line,f={anchor:Kf(e,0),head:Kf(e+1,0)};c.push(f),b.push(a.getRange(f.anchor,f.head))}return{text:b,ranges:c}}function ba(a){a.setAttribute("autocorrect","off"),a.setAttribute("autocapitalize","off"),a.setAttribute("spellcheck","false")}function ca(a){this.cm=a,this.prevInput="",this.pollingFast=!1,this.polling=new De,this.inaccurateSelection=!1,this.hasSelection=!1,this.composing=null}function da(){var a=Pe("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none"),b=Pe("div",[a],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return uf?a.style.width="1000px":a.setAttribute("wrap","off"),Bf&&(a.style.border="1px solid black"),ba(a),b}function ea(a){this.cm=a,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new De,this.gracePeriod=!1}function fa(a,b){var c=_a(a,b.line);if(!c||c.hidden)return null;var d=Yd(a.doc,b.line),e=Ya(c,d,b.line),f=de(d),g="left";if(f){var h=jf(f,b.ch);g=h%2?"right":"left"}var i=cb(e.map,b.ch,g);return i.offset="right"==i.collapse?i.end:i.start,i}function ga(a,b){return b&&(a.bad=!0),a}function ha(a,b,c){var d;if(b==a.display.lineDiv){if(d=a.display.lineDiv.childNodes[c],!d)return ga(a.clipPos(Kf(a.display.viewTo-1)),!0);b=null,c=0}else for(d=b;;d=d.parentNode){if(!d||d==a.display.lineDiv)return null;if(d.parentNode&&d.parentNode==a.display.lineDiv)break}for(var e=0;e<a.display.view.length;e++){var f=a.display.view[e];if(f.node==d)return ia(f,b,c)}}function ia(a,b,c){function d(b,c,d){for(var e=-1;e<(k?k.length:0);e++)for(var f=e<0?j.map:k[e],g=0;g<f.length;g+=3){var h=f[g+2];if(h==b||h==c){var i=ae(e<0?a.line:a.rest[e]),l=f[g]+d;return(d<0||h!=b)&&(l=f[g+(d?1:0)]),Kf(i,l)}}}var e=a.text.firstChild,f=!1;if(!b||!Ug(e,b))return ga(Kf(ae(a.line),0),!0);if(b==e&&(f=!0,b=e.childNodes[c],c=0,!b)){var g=a.rest?Fe(a.rest):a.line;return ga(Kf(ae(g),g.text.length),f)}var h=3==b.nodeType?b:null,i=b;for(h||1!=b.childNodes.length||3!=b.firstChild.nodeType||(h=b.firstChild,c&&(c=h.nodeValue.length));i.parentNode!=e;)i=i.parentNode;var j=a.measure,k=j.maps,l=d(h,i,c);if(l)return ga(l,f);for(var m=i.nextSibling,n=h?h.nodeValue.length-c:0;m;m=m.nextSibling){if(l=d(m,m.firstChild,0))return ga(Kf(l.line,l.ch-n),f);n+=m.textContent.length}for(var o=i.previousSibling,n=c;o;o=o.previousSibling){if(l=d(o,o.firstChild,-1))return ga(Kf(l.line,l.ch+n),f);n+=m.textContent.length}}function ja(a,b,c,d,e){function f(a){return function(b){return b.id==a}}function g(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");if(null!=c)return""==c&&(c=b.textContent.replace(/\u200b/g,"")),void(h+=c);var k,l=b.getAttribute("cm-marker");if(l){var m=a.findMarks(Kf(d,0),Kf(e+1,0),f(+l));return void(m.length&&(k=m[0].find())&&(h+=Zd(a.doc,k.from,k.to).join(j)))}if("false"==b.getAttribute("contenteditable"))return;for(var n=0;n<b.childNodes.length;n++)g(b.childNodes[n]);/^(pre|div|p)$/i.test(b.nodeName)&&(i=!0)}else if(3==b.nodeType){var o=b.nodeValue;if(!o)return;i&&(h+=j,i=!1),h+=o}}for(var h="",i=!1,j=a.doc.lineSeparator();g(b),b!=c;)b=b.nextSibling;return h}function ka(a,b){this.ranges=a,this.primIndex=b}function la(a,b){this.anchor=a,this.head=b}function ma(a,b){var c=a[b];a.sort(function(a,b){return Lf(a.from(),b.from())}),b=Ge(a,c);for(var d=1;d<a.length;d++){var e=a[d],f=a[d-1];if(Lf(f.to(),e.from())>=0){var g=X(f.from(),e.from()),h=W(f.to(),e.to()),i=f.empty()?e.from()==e.head:f.from()==f.head;d<=b&&--b,a.splice(--d,2,new la(i?h:g,i?g:h))}}return new ka(a,b)}function na(a,b){return new ka([new la(a,b||a)],0)}function oa(a,b){return Math.max(a.first,Math.min(b,a.first+a.size-1))}function pa(a,b){if(b.line<a.first)return Kf(a.first,0);var c=a.first+a.size-1;return b.line>c?Kf(c,Yd(a,c).text.length):qa(b,Yd(a,b.line).text.length)}function qa(a,b){var c=a.ch;return null==c||c>b?Kf(a.line,b):c<0?Kf(a.line,0):a}function ra(a,b){return b>=a.first&&b<a.first+a.size}function sa(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=pa(a,b[d]);return c}function ta(a,b,c,d){if(a.cm&&a.cm.display.shift||a.extend){var e=b.anchor;if(d){var f=Lf(c,e)<0;f!=Lf(d,e)<0?(e=c,c=d):f!=Lf(c,d)<0&&(c=d)}return new la(e,c)}return new la(d||c,c)}function ua(a,b,c,d){Aa(a,new ka([ta(a,a.sel.primary(),b,c)],0),d)}function va(a,b,c){for(var d=[],e=0;e<a.sel.ranges.length;e++)d[e]=ta(a,a.sel.ranges[e],b[e],null);var f=ma(d,a.sel.primIndex);Aa(a,f,c)}function wa(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c,Aa(a,ma(e,a.sel.primIndex),d)}function xa(a,b,c,d){Aa(a,na(b,c),d)}function ya(a,b,c){var d={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new la(pa(a,b[c].anchor),pa(a,b[c].head))},origin:c&&c.origin};return Fg(a,"beforeSelectionChange",a,d),a.cm&&Fg(a.cm,"beforeSelectionChange",a.cm,d),d.ranges!=b.ranges?ma(d.ranges,d.ranges.length-1):b}function za(a,b,c){var d=a.history.done,e=Fe(d);e&&e.ranges?(d[d.length-1]=b,Ba(a,b,c)):Aa(a,b,c)}function Aa(a,b,c){Ba(a,b,c),ke(a,a.sel,a.cm?a.cm.curOp.id:NaN,c)}function Ba(a,b,c){(Be(a,"beforeSelectionChange")||a.cm&&Be(a.cm,"beforeSelectionChange"))&&(b=ya(a,b,c));var d=c&&c.bias||(Lf(b.primary().head,a.sel.primary().head)<0?-1:1);Ca(a,Ea(a,b,d,!0)),c&&c.scroll===!1||!a.cm||Lc(a.cm)}function Ca(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,Ae(a.cm)),xe(a,"cursorActivity",a))}function Da(a){Ca(a,Ea(a,a.sel,null,!1),Jg)}function Ea(a,b,c,d){for(var e,f=0;f<b.ranges.length;f++){var g=b.ranges[f],h=b.ranges.length==a.sel.ranges.length&&a.sel.ranges[f],i=Ga(a,g.anchor,h&&h.anchor,c,d),j=Ga(a,g.head,h&&h.head,c,d);(e||i!=g.anchor||j!=g.head)&&(e||(e=b.ranges.slice(0,f)),e[f]=new la(i,j))}return e?ma(e,b.primIndex):b}function Fa(a,b,c,d,e){var f=Yd(a,b.line);if(f.markedSpans)for(var g=0;g<f.markedSpans.length;++g){var h=f.markedSpans[g],i=h.marker;if((null==h.from||(i.inclusiveLeft?h.from<=b.ch:h.from<b.ch))&&(null==h.to||(i.inclusiveRight?h.to>=b.ch:h.to>b.ch))){if(e&&(Fg(i,"beforeCursorEnter"),i.explicitlyCleared)){if(f.markedSpans){--g;continue}break}if(!i.atomic)continue;if(c){var j,k=i.find(d<0?1:-1);if((d<0?i.inclusiveRight:i.inclusiveLeft)&&(k=Ha(a,k,-d,k&&k.line==b.line?f:null)),k&&k.line==b.line&&(j=Lf(k,c))&&(d<0?j<0:j>0))return Fa(a,k,b,d,e)}var l=i.find(d<0?-1:1);return(d<0?i.inclusiveLeft:i.inclusiveRight)&&(l=Ha(a,l,d,l.line==b.line?f:null)),l?Fa(a,l,b,d,e):null}}return b}function Ga(a,b,c,d,e){var f=d||1,g=Fa(a,b,c,f,e)||!e&&Fa(a,b,c,f,!0)||Fa(a,b,c,-f,e)||!e&&Fa(a,b,c,-f,!0);return g?g:(a.cantEdit=!0,Kf(a.first,0))}function Ha(a,b,c,d){return c<0&&0==b.ch?b.line>a.first?pa(a,Kf(b.line-1)):null:c>0&&b.ch==(d||Yd(a,b.line)).text.length?b.line<a.first+a.size-1?Kf(b.line+1,0):null:new Kf(b.line,b.ch+c)}function Ia(a){a.display.input.showSelection(a.display.input.prepareSelection())}function Ja(a,b){for(var c=a.doc,d={},e=d.cursors=document.createDocumentFragment(),f=d.selection=document.createDocumentFragment(),g=0;g<c.sel.ranges.length;g++)if(b!==!1||g!=c.sel.primIndex){var h=c.sel.ranges[g];if(!(h.from().line>=a.display.viewTo||h.to().line<a.display.viewFrom)){var i=h.empty();(i||a.options.showCursorWhenSelecting)&&Ka(a,h.head,e),i||La(a,h,f)}}return d}function Ka(a,b,c){var d=nb(a,b,"div",null,null,!a.options.singleCursorHeightPerLine),e=c.appendChild(Pe("div","","CodeMirror-cursor"));if(e.style.left=d.left+"px",e.style.top=d.top+"px",e.style.height=Math.max(0,d.bottom-d.top)*a.options.cursorHeight+"px",d.other){var f=c.appendChild(Pe("div","","CodeMirror-cursor CodeMirror-secondarycursor"));f.style.display="",f.style.left=d.other.left+"px",f.style.top=d.other.top+"px",f.style.height=.85*(d.other.bottom-d.other.top)+"px"}}function La(a,b,c){function d(a,b,c,d){b<0&&(b=0),b=Math.round(b),d=Math.round(d),h.appendChild(Pe("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+b+"px; width: "+(null==c?k-a:c)+"px; height: "+(d-b)+"px"))}function e(b,c,e){function f(c,d){return mb(a,Kf(b,c),"div",l,d)}var h,i,l=Yd(g,b),m=l.text.length;return _e(de(l),c||0,null==e?m:e,function(a,b,g){var l,n,o,p=f(a,"left");if(a==b)l=p,n=o=p.left;else{if(l=f(b-1,"right"),"rtl"==g){var q=p;p=l,l=q}n=p.left,o=l.right}null==c&&0==a&&(n=j),l.top-p.top>3&&(d(n,p.top,null,p.bottom),n=j,p.bottom<l.top&&d(n,p.bottom,null,l.top)),null==e&&b==m&&(o=k),(!h||p.top<h.top||p.top==h.top&&p.left<h.left)&&(h=p),(!i||l.bottom>i.bottom||l.bottom==i.bottom&&l.right>i.right)&&(i=l),n<j+1&&(n=j),d(n,l.top,o-n,l.bottom)}),{start:h,end:i}}var f=a.display,g=a.doc,h=document.createDocumentFragment(),i=Ta(a.display),j=i.left,k=Math.max(f.sizerWidth,Va(a)-f.sizer.offsetLeft)-i.right,l=b.from(),m=b.to();if(l.line==m.line)e(l.line,l.ch,m.ch);else{var n=Yd(g,l.line),o=Yd(g,m.line),p=rd(n)==rd(o),q=e(l.line,l.ch,p?n.text.length+1:null).end,r=e(m.line,p?0:null,m.ch).start;p&&(q.top<r.top-2?(d(q.right,q.top,null,q.bottom),d(j,r.top,r.left,r.bottom)):d(q.right,q.top,r.left-q.right,q.bottom)),q.bottom<r.top&&d(j,q.bottom,null,r.top)}c.appendChild(h)}function Ma(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="",a.options.cursorBlinkRate>0?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):a.options.cursorBlinkRate<0&&(b.cursorDiv.style.visibility="hidden")}}function Na(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,Le(Oa,a))}function Oa(a){var b=a.doc;if(b.frontier<b.first&&(b.frontier=b.first),!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=gg(b.mode,Qa(a,b.frontier)),e=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(f){if(b.frontier>=a.display.viewFrom){var g=f.styles,h=f.text.length>a.options.maxHighlightLength,i=Hd(a,f,h?gg(b.mode,d):d,!0);f.styles=i.styles;var j=f.styleClasses,k=i.classes;k?f.styleClasses=k:j&&(f.styleClasses=null);for(var l=!g||g.length!=f.styles.length||j!=k&&(!j||!k||j.bgClass!=k.bgClass||j.textClass!=k.textClass),m=0;!l&&m<g.length;++m)l=g[m]!=f.styles[m];l&&e.push(b.frontier),f.stateAfter=h?d:gg(b.mode,d)}else f.text.length<=a.options.maxHighlightLength&&Jd(a,f.text,d),f.stateAfter=b.frontier%5==0?gg(b.mode,d):null;if(++b.frontier,+new Date>c)return Na(a,a.options.workDelay),!0}),e.length&&Db(a,function(){for(var b=0;b<e.length;b++)Kb(a,e[b],"text")})}}function Pa(a,b,c){for(var d,e,f=a.doc,g=a.doc.mode.preciseStartState||c?-1:b-(a.doc.mode.innerMode?1e3:100),h=b;h>g;--h){if(h<=f.first)return f.first;var i=Yd(f,h-1);if(i.stateAfter&&(!c||h<=f.frontier))return h;var j=Mg(i.text,null,a.options.tabSize);(null==e||d>j)&&(e=h-1,d=j)}return e}function Qa(a,b,c){var d=a.doc,e=a.display;if(!d.mode.startState)return!0;var f=Pa(a,b,c),g=f>d.first&&Yd(d,f-1).stateAfter;return g=g?gg(d.mode,g):hg(d.mode),d.iter(f,b,function(c){Jd(a,c.text,g);var h=f==b-1||f%5==0||f>=e.viewFrom&&f<e.viewTo;c.stateAfter=h?gg(d.mode,g):null,++f}),c&&!a.doc.mode.noUpdateFrontier&&(d.frontier=f),g}function Ra(a){return a.lineSpace.offsetTop}function Sa(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function Ta(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=Re(a.measure,Pe("pre","x")),c=window.getComputedStyle?window.getComputedStyle(b):b.currentStyle,d={left:parseInt(c.paddingLeft),right:parseInt(c.paddingRight)};return isNaN(d.left)||isNaN(d.right)||(a.cachedPaddingH=d),d}function Ua(a){return Hg-a.display.nativeBarWidth}function Va(a){return a.display.scroller.clientWidth-Ua(a)-a.display.barWidth}function Wa(a){return a.display.scroller.clientHeight-Ua(a)-a.display.barHeight}function Xa(a,b,c){var d=a.options.lineWrapping,e=d&&Va(a);if(!b.measure.heights||d&&b.measure.width!=e){var f=b.measure.heights=[];if(d){b.measure.width=e;for(var g=b.text.firstChild.getClientRects(),h=0;h<g.length-1;h++){var i=g[h],j=g[h+1];Math.abs(i.bottom-j.bottom)>2&&f.push((i.bottom+j.top)/2-c.top)}}f.push(c.bottom-c.top)}}function Ya(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(var d=0;d<a.rest.length;d++)if(ae(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}function Za(a,b){b=rd(b);var c=ae(b),d=a.display.externalMeasured=new Hb(a.doc,b,c);d.lineN=c;var e=d.built=Ld(a,d);return d.text=e.pre,Re(a.display.lineMeasure,e.pre),d}function $a(a,b,c,d){return bb(a,ab(a,b),c,d)}function _a(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[Mb(a,b)];var c=a.display.externalMeasured;return c&&b>=c.lineN&&b<c.lineN+c.size?c:void 0}function ab(a,b){var c=ae(b),d=_a(a,c);d&&!d.text?d=null:d&&d.changes&&(J(a,d,c,H(a)),a.curOp.forceUpdate=!0),d||(d=Za(a,b));var e=Ya(d,b,c);return{line:b,view:d,rect:null,map:e.map,cache:e.cache,before:e.before,hasHeights:!1}}function bb(a,b,c,d,e){b.before&&(c=-1);var f,g=c+(d||"");return b.cache.hasOwnProperty(g)?f=b.cache[g]:(b.rect||(b.rect=b.view.text.getBoundingClientRect()),b.hasHeights||(Xa(a,b.view,b.rect),b.hasHeights=!0),f=db(a,b,c,d),f.bogus||(b.cache[g]=f)),{left:f.left,right:f.right,top:e?f.rtop:f.top,bottom:e?f.rbottom:f.bottom}}function cb(a,b,c){for(var d,e,f,g,h=0;h<a.length;h+=3){var i=a[h],j=a[h+1];if(b<i?(e=0,f=1,g="left"):b<j?(e=b-i,f=e+1):(h==a.length-3||b==j&&a[h+3]>b)&&(f=j-i,e=f-1,b>=j&&(g="right")),null!=e){if(d=a[h+2],i==j&&c==(d.insertLeft?"left":"right")&&(g=c),"left"==c&&0==e)for(;h&&a[h-2]==a[h-3]&&a[h-1].insertLeft;)d=a[(h-=3)+2],g="left";if("right"==c&&e==j-i)for(;h<a.length-3&&a[h+3]==a[h+4]&&!a[h+5].insertLeft;)d=a[(h+=3)+2],g="right";break}}return{node:d,start:e,end:f,collapse:g,coverStart:i,coverEnd:j}}function db(a,b,c,d){var e,f=cb(b.map,c,d),g=f.node,h=f.start,i=f.end,j=f.collapse;if(3==g.nodeType){for(var k=0;k<4;k++){for(;h&&Oe(b.line.text.charAt(f.coverStart+h));)--h;for(;f.coverStart+i<f.coverEnd&&Oe(b.line.text.charAt(f.coverStart+i));)++i;if(sf&&tf<9&&0==h&&i==f.coverEnd-f.coverStart)e=g.parentNode.getBoundingClientRect();else if(sf&&a.options.lineWrapping){var l=Qg(g,h,i).getClientRects();e=l.length?l["right"==d?l.length-1:0]:Qf}else e=Qg(g,h,i).getBoundingClientRect()||Qf;if(e.left||e.right||0==h)break;i=h,h-=1,j="right"}sf&&tf<11&&(e=eb(a.display.measure,e))}else{h>0&&(j=d="right");var l;e=a.options.lineWrapping&&(l=g.getClientRects()).length>1?l["right"==d?l.length-1:0]:g.getBoundingClientRect()}if(sf&&tf<9&&!h&&(!e||!e.left&&!e.right)){var m=g.parentNode.getClientRects()[0];e=m?{left:m.left,right:m.left+tb(a.display),top:m.top,bottom:m.bottom}:Qf}for(var n=e.top-b.rect.top,o=e.bottom-b.rect.top,p=(n+o)/2,q=b.view.measure.heights,k=0;k<q.length-1&&!(p<q[k]);k++);var r=k?q[k-1]:0,s=q[k],t={left:("right"==j?e.right:e.left)-b.rect.left,right:("left"==j?e.left:e.right)-b.rect.left,top:r,bottom:s};return e.left||e.right||(t.bogus=!0),a.options.singleCursorHeightPerLine||(t.rtop=n,t.rbottom=o),t}function eb(a,b){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!$e(a))return b;var c=screen.logicalXDPI/screen.deviceXDPI,d=screen.logicalYDPI/screen.deviceYDPI;return{left:b.left*c,right:b.right*c,top:b.top*d,bottom:b.bottom*d}}function fb(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function gb(a){a.display.externalMeasure=null,Qe(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)fb(a.display.view[b])}function hb(a){gb(a),a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null,a.options.lineWrapping||(a.display.maxLineChanged=!0),a.display.lineNumChars=null}function ib(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function jb(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function kb(a,b,c,d){if(b.widgets)for(var e=0;e<b.widgets.length;++e)if(b.widgets[e].above){var f=yd(b.widgets[e]);c.top+=f,c.bottom+=f}if("line"==d)return c;d||(d="local");var g=ce(b);if("local"==d?g+=Ra(a.display):g-=a.display.viewOffset,"page"==d||"window"==d){var h=a.display.lineSpace.getBoundingClientRect();g+=h.top+("window"==d?0:jb());var i=h.left+("window"==d?0:ib());c.left+=i,c.right+=i}return c.top+=g,c.bottom+=g,c}function lb(a,b,c){if("div"==c)return b;var d=b.left,e=b.top;if("page"==c)d-=ib(),e-=jb();else if("local"==c||!c){var f=a.display.sizer.getBoundingClientRect();d+=f.left,e+=f.top}var g=a.display.lineSpace.getBoundingClientRect();return{left:d-g.left,
top:e-g.top}}function mb(a,b,c,d,e){return d||(d=Yd(a.doc,b.line)),kb(a,d,$a(a,d,b.ch,e),c)}function nb(a,b,c,d,e,f){function g(b,g){var h=bb(a,e,b,g?"right":"left",f);return g?h.left=h.right:h.right=h.left,kb(a,d,h,c)}function h(a,b){var c=i[b],d=c.level%2;return a==af(c)&&b&&c.level<i[b-1].level?(c=i[--b],a=bf(c)-(c.level%2?0:1),d=!0):a==bf(c)&&b<i.length-1&&c.level<i[b+1].level&&(c=i[++b],a=af(c)-c.level%2,d=!1),d&&a==c.to&&a>c.from?g(a-1):g(a,d)}d=d||Yd(a.doc,b.line),e||(e=ab(a,d));var i=de(d),j=b.ch;if(!i)return g(j);var k=jf(i,j),l=h(j,k);return null!=eh&&(l.other=h(j,eh)),l}function ob(a,b){var c=0,b=pa(a.doc,b);a.options.lineWrapping||(c=tb(a.display)*b.ch);var d=Yd(a.doc,b.line),e=ce(d)+Ra(a.display);return{left:c,right:c,top:e,bottom:e+d.height}}function pb(a,b,c,d){var e=Kf(a,b);return e.xRel=d,c&&(e.outside=!0),e}function qb(a,b,c){var d=a.doc;if(c+=a.display.viewOffset,c<0)return pb(d.first,0,!0,-1);var e=be(d,c),f=d.first+d.size-1;if(e>f)return pb(d.first+d.size-1,Yd(d,f).text.length,!0,1);b<0&&(b=0);for(var g=Yd(d,e);;){var h=rb(a,g,e,b,c),i=pd(g),j=i&&i.find(0,!0);if(!i||!(h.ch>j.from.ch||h.ch==j.from.ch&&h.xRel>0))return h;e=ae(g=j.to.line)}}function rb(a,b,c,d,e){function f(d){var e=nb(a,Kf(c,d),"line",b,j);return h=!0,g>e.bottom?e.left-i:g<e.top?e.left+i:(h=!1,e.left)}var g=e-ce(b),h=!1,i=2*a.display.wrapper.clientWidth,j=ab(a,b),k=de(b),l=b.text.length,m=cf(b),n=df(b),o=f(m),p=h,q=f(n),r=h;if(d>q)return pb(c,n,r,1);for(;;){if(k?n==m||n==lf(b,m,1):n-m<=1){for(var s=d<o||d-o<=q-d?m:n,t=d-(s==m?o:q);Oe(b.text.charAt(s));)++s;var u=pb(c,s,s==m?p:r,t<-1?-1:t>1?1:0);return u}var v=Math.ceil(l/2),w=m+v;if(k){w=m;for(var x=0;x<v;++x)w=lf(b,w,1)}var y=f(w);y>d?(n=w,q=y,(r=h)&&(q+=1e3),l=v):(m=w,o=y,p=h,l-=v)}}function sb(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==Nf){Nf=Pe("pre");for(var b=0;b<49;++b)Nf.appendChild(document.createTextNode("x")),Nf.appendChild(Pe("br"));Nf.appendChild(document.createTextNode("x"))}Re(a.measure,Nf);var c=Nf.offsetHeight/50;return c>3&&(a.cachedTextHeight=c),Qe(a.measure),c||1}function tb(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=Pe("span","xxxxxxxxxx"),c=Pe("pre",[b]);Re(a.measure,c);var d=b.getBoundingClientRect(),e=(d.right-d.left)/10;return e>2&&(a.cachedCharWidth=e),e||10}function ub(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Sf},Rf?Rf.ops.push(a.curOp):a.curOp.ownsGroup=Rf={ops:[a.curOp],delayedCallbacks:[]}}function vb(a){var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c].call(null);for(var d=0;d<a.ops.length;d++){var e=a.ops[d];if(e.cursorActivityHandlers)for(;e.cursorActivityCalled<e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++].call(null,e.cm)}}while(c<b.length)}function wb(a){var b=a.curOp,c=b.ownsGroup;if(c)try{vb(c)}finally{Rf=null;for(var d=0;d<c.ops.length;d++)c.ops[d].cm.curOp=null;xb(c)}}function xb(a){for(var b=a.ops,c=0;c<b.length;c++)yb(b[c]);for(var c=0;c<b.length;c++)zb(b[c]);for(var c=0;c<b.length;c++)Ab(b[c]);for(var c=0;c<b.length;c++)Bb(b[c]);for(var c=0;c<b.length;c++)Cb(b[c])}function yb(a){var b=a.cm,c=b.display;A(b),a.updateMaxLine&&m(b),a.mustUpdate=a.viewChanged||a.forceUpdate||null!=a.scrollTop||a.scrollToPos&&(a.scrollToPos.from.line<c.viewFrom||a.scrollToPos.to.line>=c.viewTo)||c.maxLineChanged&&b.options.lineWrapping,a.update=a.mustUpdate&&new z(b,a.mustUpdate&&{top:a.scrollTop,ensure:a.scrollToPos},a.forceUpdate)}function zb(a){a.updatedDisplay=a.mustUpdate&&B(a.cm,a.update)}function Ab(a){var b=a.cm,c=b.display;a.updatedDisplay&&F(b),a.barMeasure=o(b),c.maxLineChanged&&!b.options.lineWrapping&&(a.adjustWidthTo=$a(b,c.maxLine,c.maxLine.text.length).left+3,b.display.sizerWidth=a.adjustWidthTo,a.barMeasure.scrollWidth=Math.max(c.scroller.clientWidth,c.sizer.offsetLeft+a.adjustWidthTo+Ua(b)+b.display.barWidth),a.maxScrollLeft=Math.max(0,c.sizer.offsetLeft+a.adjustWidthTo-Va(b))),(a.updatedDisplay||a.selectionChanged)&&(a.preparedSelection=c.input.prepareSelection())}function Bb(a){var b=a.cm;null!=a.adjustWidthTo&&(b.display.sizer.style.minWidth=a.adjustWidthTo+"px",a.maxScrollLeft<b.doc.scrollLeft&&ec(b,Math.min(b.display.scroller.scrollLeft,a.maxScrollLeft),!0),b.display.maxLineChanged=!1),a.preparedSelection&&b.display.input.showSelection(a.preparedSelection),(a.updatedDisplay||a.startHeight!=b.doc.height)&&s(b,a.barMeasure),a.updatedDisplay&&E(b,a.barMeasure),a.selectionChanged&&Ma(b),b.state.focused&&a.updateInput&&b.display.input.reset(a.typing),!a.focus||a.focus!=Se()||document.hasFocus&&!document.hasFocus()||Y(a.cm)}function Cb(a){var b=a.cm,c=b.display,d=b.doc;if(a.updatedDisplay&&C(b,a.update),null==c.wheelStartX||null==a.scrollTop&&null==a.scrollLeft&&!a.scrollToPos||(c.wheelStartX=c.wheelStartY=null),null==a.scrollTop||c.scroller.scrollTop==a.scrollTop&&!a.forceScroll||(d.scrollTop=Math.max(0,Math.min(c.scroller.scrollHeight-c.scroller.clientHeight,a.scrollTop)),c.scrollbars.setScrollTop(d.scrollTop),c.scroller.scrollTop=d.scrollTop),null==a.scrollLeft||c.scroller.scrollLeft==a.scrollLeft&&!a.forceScroll||(d.scrollLeft=Math.max(0,Math.min(c.scroller.scrollWidth-c.scroller.clientWidth,a.scrollLeft)),c.scrollbars.setScrollLeft(d.scrollLeft),c.scroller.scrollLeft=d.scrollLeft,v(b)),a.scrollToPos){var e=Hc(b,pa(d,a.scrollToPos.from),pa(d,a.scrollToPos.to),a.scrollToPos.margin);a.scrollToPos.isCursor&&b.state.focused&&Gc(b,e)}var f=a.maybeHiddenMarkers,g=a.maybeUnhiddenMarkers;if(f)for(var h=0;h<f.length;++h)f[h].lines.length||Fg(f[h],"hide");if(g)for(var h=0;h<g.length;++h)g[h].lines.length&&Fg(g[h],"unhide");c.wrapper.offsetHeight&&(d.scrollTop=b.display.scroller.scrollTop),a.changeObjs&&Fg(b,"changes",b,a.changeObjs),a.update&&a.update.finish()}function Db(a,b){if(a.curOp)return b();ub(a);try{return b()}finally{wb(a)}}function Eb(a,b){return function(){if(a.curOp)return b.apply(a,arguments);ub(a);try{return b.apply(a,arguments)}finally{wb(a)}}}function Fb(a){return function(){if(this.curOp)return a.apply(this,arguments);ub(this);try{return a.apply(this,arguments)}finally{wb(this)}}}function Gb(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);ub(b);try{return a.apply(this,arguments)}finally{wb(b)}}}function Hb(a,b,c){this.line=b,this.rest=sd(b),this.size=this.rest?ae(Fe(this.rest))-c+1:1,this.node=this.text=null,this.hidden=vd(a,b)}function Ib(a,b,c){for(var d,e=[],f=b;f<c;f=d){var g=new Hb(a.doc,Yd(a.doc,f),f);d=f+g.size,e.push(g)}return e}function Jb(a,b,c,d){null==b&&(b=a.doc.first),null==c&&(c=a.doc.first+a.doc.size),d||(d=0);var e=a.display;if(d&&c<e.viewTo&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b),a.curOp.viewChanged=!0,b>=e.viewTo)Jf&&td(a.doc,b)<e.viewTo&&Lb(a);else if(c<=e.viewFrom)Jf&&ud(a.doc,c+d)>e.viewFrom?Lb(a):(e.viewFrom+=d,e.viewTo+=d);else if(b<=e.viewFrom&&c>=e.viewTo)Lb(a);else if(b<=e.viewFrom){var f=Nb(a,c,c+d,1);f?(e.view=e.view.slice(f.index),e.viewFrom=f.lineN,e.viewTo+=d):Lb(a)}else if(c>=e.viewTo){var f=Nb(a,b,b,-1);f?(e.view=e.view.slice(0,f.index),e.viewTo=f.lineN):Lb(a)}else{var g=Nb(a,b,b,-1),h=Nb(a,c,c+d,1);g&&h?(e.view=e.view.slice(0,g.index).concat(Ib(a,g.lineN,h.lineN)).concat(e.view.slice(h.index)),e.viewTo+=d):Lb(a)}var i=e.externalMeasured;i&&(c<i.lineN?i.lineN+=d:b<i.lineN+i.size&&(e.externalMeasured=null))}function Kb(a,b,c){a.curOp.viewChanged=!0;var d=a.display,e=a.display.externalMeasured;if(e&&b>=e.lineN&&b<e.lineN+e.size&&(d.externalMeasured=null),!(b<d.viewFrom||b>=d.viewTo)){var f=d.view[Mb(a,b)];if(null!=f.node){var g=f.changes||(f.changes=[]);Ge(g,c)==-1&&g.push(c)}}}function Lb(a){a.display.viewFrom=a.display.viewTo=a.doc.first,a.display.view=[],a.display.viewOffset=0}function Mb(a,b){if(b>=a.display.viewTo)return null;if(b-=a.display.viewFrom,b<0)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,b<0)return d}function Nb(a,b,c,d){var e,f=Mb(a,b),g=a.display.view;if(!Jf||c==a.doc.first+a.doc.size)return{index:f,lineN:c};for(var h=0,i=a.display.viewFrom;h<f;h++)i+=g[h].size;if(i!=b){if(d>0){if(f==g.length-1)return null;e=i+g[f].size-b,f++}else e=i-b;b+=e,c+=e}for(;td(a.doc,c)!=c;){if(f==(d<0?0:g.length-1))return null;c+=d*g[f-(d<0?1:0)].size,f+=d}return{index:f,lineN:c}}function Ob(a,b,c){var d=a.display,e=d.view;0==e.length||b>=d.viewTo||c<=d.viewFrom?(d.view=Ib(a,b,c),d.viewFrom=b):(d.viewFrom>b?d.view=Ib(a,b,d.viewFrom).concat(d.view):d.viewFrom<b&&(d.view=d.view.slice(Mb(a,b))),d.viewFrom=b,d.viewTo<c?d.view=d.view.concat(Ib(a,d.viewTo,c)):d.viewTo>c&&(d.view=d.view.slice(0,Mb(a,c)))),d.viewTo=c}function Pb(a){for(var b=a.display.view,c=0,d=0;d<b.length;d++){var e=b[d];e.hidden||e.node&&!e.changes||++c}return c}function Qb(a){function b(){e.activeTouch&&(f=setTimeout(function(){e.activeTouch=null},1e3),g=e.activeTouch,g.end=+new Date)}function c(a){if(1!=a.touches.length)return!1;var b=a.touches[0];return b.radiusX<=1&&b.radiusY<=1}function d(a,b){if(null==b.left)return!0;var c=b.left-a.left,d=b.top-a.top;return c*c+d*d>400}var e=a.display;Cg(e.scroller,"mousedown",Eb(a,Vb)),sf&&tf<11?Cg(e.scroller,"dblclick",Eb(a,function(b){if(!ze(a,b)){var c=Ub(a,b);if(c&&!$b(a,b)&&!Tb(a.display,b)){zg(b);var d=a.findWordAt(c);ua(a.doc,d.anchor,d.head)}}})):Cg(e.scroller,"dblclick",function(b){ze(a,b)||zg(b)}),Hf||Cg(e.scroller,"contextmenu",function(b){sc(a,b)});var f,g={end:0};Cg(e.scroller,"touchstart",function(b){if(!ze(a,b)&&!c(b)){clearTimeout(f);var d=+new Date;e.activeTouch={start:d,moved:!1,prev:d-g.end<=300?g:null},1==b.touches.length&&(e.activeTouch.left=b.touches[0].pageX,e.activeTouch.top=b.touches[0].pageY)}}),Cg(e.scroller,"touchmove",function(){e.activeTouch&&(e.activeTouch.moved=!0)}),Cg(e.scroller,"touchend",function(c){var f=e.activeTouch;if(f&&!Tb(e,c)&&null!=f.left&&!f.moved&&new Date-f.start<300){var g,h=a.coordsChar(e.activeTouch,"page");g=!f.prev||d(f,f.prev)?new la(h,h):!f.prev.prev||d(f,f.prev.prev)?a.findWordAt(h):new la(Kf(h.line,0),pa(a.doc,Kf(h.line+1,0))),a.setSelection(g.anchor,g.head),a.focus(),zg(c)}b()}),Cg(e.scroller,"touchcancel",b),Cg(e.scroller,"scroll",function(){e.scroller.clientHeight&&(dc(a,e.scroller.scrollTop),ec(a,e.scroller.scrollLeft,!0),Fg(a,"scroll",a))}),Cg(e.scroller,"mousewheel",function(b){fc(a,b)}),Cg(e.scroller,"DOMMouseScroll",function(b){fc(a,b)}),Cg(e.wrapper,"scroll",function(){e.wrapper.scrollTop=e.wrapper.scrollLeft=0}),e.dragFunctions={enter:function(b){ze(a,b)||Bg(b)},over:function(b){ze(a,b)||(bc(a,b),Bg(b))},start:function(b){ac(a,b)},drop:Eb(a,_b),leave:function(b){ze(a,b)||cc(a)}};var h=e.input.getField();Cg(h,"keyup",function(b){nc.call(a,b)}),Cg(h,"keydown",Eb(a,lc)),Cg(h,"keypress",Eb(a,oc)),Cg(h,"focus",Le(qc,a)),Cg(h,"blur",Le(rc,a))}function Rb(b,c,d){var e=d&&d!=a.Init;if(!c!=!e){var f=b.display.dragFunctions,g=c?Cg:Eg;g(b.display.scroller,"dragstart",f.start),g(b.display.scroller,"dragenter",f.enter),g(b.display.scroller,"dragover",f.over),g(b.display.scroller,"dragleave",f.leave),g(b.display.scroller,"drop",f.drop)}}function Sb(a){var b=a.display;b.lastWrapHeight==b.wrapper.clientHeight&&b.lastWrapWidth==b.wrapper.clientWidth||(b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize())}function Tb(a,b){for(var c=ue(b);c!=a.wrapper;c=c.parentNode)if(!c||1==c.nodeType&&"true"==c.getAttribute("cm-ignore-events")||c.parentNode==a.sizer&&c!=a.mover)return!0}function Ub(a,b,c,d){var e=a.display;if(!c&&"true"==ue(b).getAttribute("cm-not-content"))return null;var f,g,h=e.lineSpace.getBoundingClientRect();try{f=b.clientX-h.left,g=b.clientY-h.top}catch(b){return null}var i,j=qb(a,f,g);if(d&&1==j.xRel&&(i=Yd(a.doc,j.line).text).length==j.ch){var k=Mg(i,i.length,a.options.tabSize)-i.length;j=Kf(j.line,Math.max(0,Math.round((f-Ta(a.display).left)/tb(a.display))-k))}return j}function Vb(a){var b=this,c=b.display;if(!(ze(b,a)||c.activeTouch&&c.input.supportsTouch())){if(c.shift=a.shiftKey,Tb(c,a))return void(uf||(c.scroller.draggable=!1,setTimeout(function(){c.scroller.draggable=!0},100)));if(!$b(b,a)){var d=Ub(b,a);switch(window.focus(),ve(a)){case 1:b.state.selectingText?b.state.selectingText(a):d?Wb(b,a,d):ue(a)==c.scroller&&zg(a);break;case 2:uf&&(b.state.lastMiddleDown=+new Date),d&&ua(b.doc,d),setTimeout(function(){c.input.focus()},20),zg(a);break;case 3:Hf?sc(b,a):pc(b)}}}}function Wb(a,b,c){sf?setTimeout(Le(Y,a),0):a.curOp.focus=Se();var d,e=+new Date;Pf&&Pf.time>e-400&&0==Lf(Pf.pos,c)?d="triple":Of&&Of.time>e-400&&0==Lf(Of.pos,c)?(d="double",Pf={time:e,pos:c}):(d="single",Of={time:e,pos:c});var f,g=a.doc.sel,h=Df?b.metaKey:b.ctrlKey;a.options.dragDrop&&$g&&!a.isReadOnly()&&"single"==d&&(f=g.contains(c))>-1&&(Lf((f=g.ranges[f]).from(),c)<0||c.xRel>0)&&(Lf(f.to(),c)>0||c.xRel<0)?Xb(a,b,c,h):Yb(a,b,c,d,h)}function Xb(a,b,c,d){var e=a.display,f=+new Date,g=Eb(a,function(h){uf&&(e.scroller.draggable=!1),a.state.draggingText=!1,Eg(document,"mouseup",g),Eg(e.scroller,"drop",g),Math.abs(b.clientX-h.clientX)+Math.abs(b.clientY-h.clientY)<10&&(zg(h),!d&&+new Date-200<f&&ua(a.doc,c),uf||sf&&9==tf?setTimeout(function(){document.body.focus(),e.input.focus()},20):e.input.focus())});uf&&(e.scroller.draggable=!0),a.state.draggingText=g,e.scroller.dragDrop&&e.scroller.dragDrop(),Cg(document,"mouseup",g),Cg(e.scroller,"drop",g)}function Yb(a,b,c,d,e){function f(b){if(0!=Lf(q,b))if(q=b,"rect"==d){for(var e=[],f=a.options.tabSize,g=Mg(Yd(j,c.line).text,c.ch,f),h=Mg(Yd(j,b.line).text,b.ch,f),i=Math.min(g,h),n=Math.max(g,h),o=Math.min(c.line,b.line),p=Math.min(a.lastLine(),Math.max(c.line,b.line));o<=p;o++){var r=Yd(j,o).text,s=Ng(r,i,f);i==n?e.push(new la(Kf(o,s),Kf(o,s))):r.length>s&&e.push(new la(Kf(o,s),Kf(o,Ng(r,n,f))))}e.length||e.push(new la(c,c)),Aa(j,ma(m.ranges.slice(0,l).concat(e),l),{origin:"*mouse",scroll:!1}),a.scrollIntoView(b)}else{var t=k,u=t.anchor,v=b;if("single"!=d){if("double"==d)var w=a.findWordAt(b);else var w=new la(Kf(b.line,0),pa(j,Kf(b.line+1,0)));Lf(w.anchor,u)>0?(v=w.head,u=X(t.from(),w.anchor)):(v=w.anchor,u=W(t.to(),w.head))}var e=m.ranges.slice(0);e[l]=new la(pa(j,u),v),Aa(j,ma(e,l),Kg)}}function g(b){var c=++s,e=Ub(a,b,!0,"rect"==d);if(e)if(0!=Lf(e,q)){a.curOp.focus=Se(),f(e);var h=u(i,j);(e.line>=h.to||e.line<h.from)&&setTimeout(Eb(a,function(){s==c&&g(b)}),150)}else{var k=b.clientY<r.top?-20:b.clientY>r.bottom?20:0;k&&setTimeout(Eb(a,function(){s==c&&(i.scroller.scrollTop+=k,g(b))}),50)}}function h(b){a.state.selectingText=!1,s=1/0,zg(b),i.input.focus(),Eg(document,"mousemove",t),Eg(document,"mouseup",v),j.history.lastSelOrigin=null}var i=a.display,j=a.doc;zg(b);var k,l,m=j.sel,n=m.ranges;if(e&&!b.shiftKey?(l=j.sel.contains(c),k=l>-1?n[l]:new la(c,c)):(k=j.sel.primary(),l=j.sel.primIndex),b.altKey)d="rect",e||(k=new la(c,c)),c=Ub(a,b,!0,!0),l=-1;else if("double"==d){var o=a.findWordAt(c);k=a.display.shift||j.extend?ta(j,k,o.anchor,o.head):o}else if("triple"==d){var p=new la(Kf(c.line,0),pa(j,Kf(c.line+1,0)));k=a.display.shift||j.extend?ta(j,k,p.anchor,p.head):p}else k=ta(j,k,c);e?l==-1?(l=n.length,Aa(j,ma(n.concat([k]),l),{scroll:!1,origin:"*mouse"})):n.length>1&&n[l].empty()&&"single"==d&&!b.shiftKey?(Aa(j,ma(n.slice(0,l).concat(n.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),m=j.sel):wa(j,l,k,Kg):(l=0,Aa(j,new ka([k],0),Kg),m=j.sel);var q=c,r=i.wrapper.getBoundingClientRect(),s=0,t=Eb(a,function(a){ve(a)?g(a):h(a)}),v=Eb(a,h);a.state.selectingText=v,Cg(document,"mousemove",t),Cg(document,"mouseup",v)}function Zb(a,b,c,d){try{var e=b.clientX,f=b.clientY}catch(b){return!1}if(e>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&zg(b);var g=a.display,h=g.lineDiv.getBoundingClientRect();if(f>h.bottom||!Be(a,c))return te(b);f-=h.top-g.viewOffset;for(var i=0;i<a.options.gutters.length;++i){var j=g.gutters.childNodes[i];if(j&&j.getBoundingClientRect().right>=e){var k=be(a.doc,f),l=a.options.gutters[i];return Fg(a,c,a,k,l,b),te(b)}}}function $b(a,b){return Zb(a,b,"gutterClick",!0)}function _b(a){var b=this;if(cc(b),!ze(b,a)&&!Tb(b.display,a)){zg(a),sf&&(Tf=+new Date);var c=Ub(b,a,!0),d=a.dataTransfer.files;if(c&&!b.isReadOnly())if(d&&d.length&&window.FileReader&&window.File)for(var e=d.length,f=Array(e),g=0,h=function(a,d){if(!b.options.allowDropFileTypes||Ge(b.options.allowDropFileTypes,a.type)!=-1){var h=new FileReader;h.onload=Eb(b,function(){var a=h.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(a)&&(a=""),f[d]=a,++g==e){c=pa(b.doc,c);var i={from:c,to:c,text:b.doc.splitLines(f.join(b.doc.lineSeparator())),origin:"paste"};zc(b.doc,i),za(b.doc,na(c,Zf(i)))}}),h.readAsText(a)}},i=0;i<e;++i)h(d[i],i);else{if(b.state.draggingText&&b.doc.sel.contains(c)>-1)return b.state.draggingText(a),void setTimeout(function(){b.display.input.focus()},20);try{var f=a.dataTransfer.getData("Text");if(f){if(b.state.draggingText&&!(Df?a.altKey:a.ctrlKey))var j=b.listSelections();if(Ba(b.doc,na(c,c)),j)for(var i=0;i<j.length;++i)Fc(b.doc,"",j[i].anchor,j[i].head,"drag");b.replaceSelection(f,"around","paste"),b.display.input.focus()}}catch(a){}}}}function ac(a,b){if(sf&&(!a.state.draggingText||+new Date-Tf<100))return void Bg(b);if(!ze(a,b)&&!Tb(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!yf)){var c=Pe("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",xf&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop),b.dataTransfer.setDragImage(c,0,0),xf&&c.parentNode.removeChild(c)}}function bc(a,b){var c=Ub(a,b);if(c){var d=document.createDocumentFragment();Ka(a,c,d),a.display.dragCursor||(a.display.dragCursor=Pe("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),a.display.lineSpace.insertBefore(a.display.dragCursor,a.display.cursorDiv)),Re(a.display.dragCursor,d)}}function cc(a){a.display.dragCursor&&(a.display.lineSpace.removeChild(a.display.dragCursor),a.display.dragCursor=null)}function dc(a,b){Math.abs(a.doc.scrollTop-b)<2||(a.doc.scrollTop=b,pf||D(a,{top:b}),a.display.scroller.scrollTop!=b&&(a.display.scroller.scrollTop=b),a.display.scrollbars.setScrollTop(b),pf&&D(a),Na(a,100))}function ec(a,b,c){(c?b==a.doc.scrollLeft:Math.abs(a.doc.scrollLeft-b)<2)||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,v(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function fc(a,b){var c=Wf(b),d=c.x,e=c.y,f=a.display,g=f.scroller,h=g.scrollWidth>g.clientWidth,i=g.scrollHeight>g.clientHeight;if(d&&h||e&&i){if(e&&Df&&uf)a:for(var j=b.target,k=f.view;j!=g;j=j.parentNode)for(var l=0;l<k.length;l++)if(k[l].node==j){a.display.currentWheelTarget=j;break a}if(d&&!pf&&!xf&&null!=Vf)return e&&i&&dc(a,Math.max(0,Math.min(g.scrollTop+e*Vf,g.scrollHeight-g.clientHeight))),ec(a,Math.max(0,Math.min(g.scrollLeft+d*Vf,g.scrollWidth-g.clientWidth))),(!e||e&&i)&&zg(b),void(f.wheelStartX=null);if(e&&null!=Vf){var m=e*Vf,n=a.doc.scrollTop,o=n+f.wrapper.clientHeight;m<0?n=Math.max(0,n+m-50):o=Math.min(a.doc.height,o+m+50),D(a,{top:n,bottom:o})}Uf<20&&(null==f.wheelStartX?(f.wheelStartX=g.scrollLeft,f.wheelStartY=g.scrollTop,f.wheelDX=d,f.wheelDY=e,setTimeout(function(){if(null!=f.wheelStartX){var a=g.scrollLeft-f.wheelStartX,b=g.scrollTop-f.wheelStartY,c=b&&f.wheelDY&&b/f.wheelDY||a&&f.wheelDX&&a/f.wheelDX;f.wheelStartX=f.wheelStartY=null,c&&(Vf=(Vf*Uf+c)/(Uf+1),++Uf)}},200)):(f.wheelDX+=d,f.wheelDY+=e))}}function gc(a,b,c){if("string"==typeof b&&(b=ig[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,e=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),c&&(a.display.shift=!1),e=b(a)!=Ig}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function hc(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var e=kg(b,a.state.keyMaps[d],c,a);if(e)return e}return a.options.extraKeys&&kg(b,a.options.extraKeys,c,a)||kg(b,a.options.keyMap,c,a)}function ic(a,b,c,d){var e=a.state.keySeq;if(e){if(lg(b))return"handled";Xf.set(50,function(){a.state.keySeq==e&&(a.state.keySeq=null,a.display.input.reset())}),b=e+" "+b}var f=hc(a,b,d);return"multi"==f&&(a.state.keySeq=b),"handled"==f&&xe(a,"keyHandled",a,b,c),"handled"!=f&&"multi"!=f||(zg(c),Ma(a)),e&&!f&&/\'$/.test(b)?(zg(c),!0):!!f}function jc(a,b){var c=mg(b,!0);return!!c&&(b.shiftKey&&!a.state.keySeq?ic(a,"Shift-"+c,b,function(b){return gc(a,b,!0)})||ic(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return gc(a,b)}):ic(a,c,b,function(b){return gc(a,b)}))}function kc(a,b,c){return ic(a,"'"+c+"'",b,function(b){return gc(a,b,!0)})}function lc(a){var b=this;if(b.curOp.focus=Se(),!ze(b,a)){sf&&tf<11&&27==a.keyCode&&(a.returnValue=!1);var c=a.keyCode;b.display.shift=16==c||a.shiftKey;var d=jc(b,a);xf&&(Yf=d?c:null,!d&&88==c&&!bh&&(Df?a.metaKey:a.ctrlKey)&&b.replaceSelection("",null,"cut")),18!=c||/\bCodeMirror-crosshair\b/.test(b.display.lineDiv.className)||mc(b)}}function mc(a){function b(a){18!=a.keyCode&&a.altKey||(Xg(c,"CodeMirror-crosshair"),Eg(document,"keyup",b),Eg(document,"mouseover",b))}var c=a.display.lineDiv;Yg(c,"CodeMirror-crosshair"),Cg(document,"keyup",b),Cg(document,"mouseover",b)}function nc(a){16==a.keyCode&&(this.doc.sel.shift=!1),ze(this,a)}function oc(a){var b=this;if(!(Tb(b.display,a)||ze(b,a)||a.ctrlKey&&!a.altKey||Df&&a.metaKey)){var c=a.keyCode,d=a.charCode;if(xf&&c==Yf)return Yf=null,void zg(a);if(!xf||a.which&&!(a.which<10)||!jc(b,a)){var e=String.fromCharCode(null==d?c:d);kc(b,a,e)||b.display.input.onKeyPress(a)}}}function pc(a){a.state.delayingBlurEvent=!0,setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,rc(a))},100)}function qc(a){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1),"nocursor"!=a.options.readOnly&&(a.state.focused||(Fg(a,"focus",a),a.state.focused=!0,Yg(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),uf&&setTimeout(function(){a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),Ma(a))}function rc(a){a.state.delayingBlurEvent||(a.state.focused&&(Fg(a,"blur",a),a.state.focused=!1,Xg(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function sc(a,b){Tb(a.display,b)||tc(a,b)||ze(a,b,"contextmenu")||a.display.input.onContextMenu(b)}function tc(a,b){return!!Be(a,"gutterContextMenu")&&Zb(a,b,"gutterContextMenu",!1)}function uc(a,b){if(Lf(a,b.from)<0)return a;if(Lf(a,b.to)<=0)return Zf(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;return a.line==b.to.line&&(d+=Zf(b).ch-b.to.ch),Kf(c,d)}function vc(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var e=a.sel.ranges[d];c.push(new la(uc(e.anchor,b),uc(e.head,b)))}return ma(c,a.sel.primIndex)}function wc(a,b,c){return a.line==b.line?Kf(c.line,a.ch-b.ch+c.ch):Kf(c.line+(a.line-b.line),a.ch)}function xc(a,b,c){for(var d=[],e=Kf(a.first,0),f=e,g=0;g<b.length;g++){var h=b[g],i=wc(h.from,e,f),j=wc(Zf(h),e,f);if(e=h.to,f=j,"around"==c){var k=a.sel.ranges[g],l=Lf(k.head,k.anchor)<0;d[g]=new la(l?j:i,l?i:j)}else d[g]=new la(i,i)}return new ka(d,a.sel.primIndex)}function yc(a,b,c){var d={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};return c&&(d.update=function(b,c,d,e){b&&(this.from=pa(a,b)),c&&(this.to=pa(a,c)),d&&(this.text=d),void 0!==e&&(this.origin=e)}),Fg(a,"beforeChange",a,d),a.cm&&Fg(a.cm,"beforeChange",a.cm,d),d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function zc(a,b,c){if(a.cm){if(!a.cm.curOp)return Eb(a.cm,zc)(a,b,c);if(a.cm.state.suppressEdits)return}if(!(Be(a,"beforeChange")||a.cm&&Be(a.cm,"beforeChange"))||(b=yc(a,b,!0))){var d=If&&!c&&hd(a,b.from,b.to);if(d)for(var e=d.length-1;e>=0;--e)Ac(a,{from:d[e].from,to:d[e].to,text:e?[""]:b.text});else Ac(a,b)}}function Ac(a,b){if(1!=b.text.length||""!=b.text[0]||0!=Lf(b.from,b.to)){var c=vc(a,b);ie(a,b,c,a.cm?a.cm.curOp.id:NaN),Dc(a,b,c,ed(a,b));var d=[];Wd(a,function(a,c){c||Ge(d,a.history)!=-1||(se(a.history,b),d.push(a.history)),Dc(a,b,null,ed(a,b))})}}function Bc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var d,e=a.history,f=a.sel,g="undo"==b?e.done:e.undone,h="undo"==b?e.undone:e.done,i=0;i<g.length&&(d=g[i],c?!d.ranges||d.equals(a.sel):d.ranges);i++);if(i!=g.length){for(e.lastOrigin=e.lastSelOrigin=null;d=g.pop(),d.ranges;){if(le(d,h),c&&!d.equals(a.sel))return void Aa(a,d,{clearRedo:!1});f=d}var j=[];le(f,h),h.push({changes:j,generation:e.generation}),e.generation=d.generation||++e.maxGeneration;for(var k=Be(a,"beforeChange")||a.cm&&Be(a.cm,"beforeChange"),i=d.changes.length-1;i>=0;--i){var l=d.changes[i];if(l.origin=b,k&&!yc(a,l,!1))return void(g.length=0);j.push(fe(a,l));var m=i?vc(a,l):Fe(g);Dc(a,l,m,gd(a,l)),!i&&a.cm&&a.cm.scrollIntoView({from:l.from,to:Zf(l)});var n=[];Wd(a,function(a,b){b||Ge(n,a.history)!=-1||(se(a.history,l),n.push(a.history)),Dc(a,l,null,gd(a,l))})}}}}function Cc(a,b){if(0!=b&&(a.first+=b,a.sel=new ka(He(a.sel.ranges,function(a){return new la(Kf(a.anchor.line+b,a.anchor.ch),Kf(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){Jb(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)Kb(a.cm,d,"gutter")}}function Dc(a,b,c,d){if(a.cm&&!a.cm.curOp)return Eb(a.cm,Dc)(a,b,c,d);if(b.to.line<a.first)return void Cc(a,b.text.length-1-(b.to.line-b.from.line));if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);Cc(a,e),b={from:Kf(a.first,0),to:Kf(b.to.line+e,b.to.ch),text:[Fe(b.text)],origin:b.origin}}var f=a.lastLine();b.to.line>f&&(b={from:b.from,to:Kf(f,Yd(a,f).text.length),text:[b.text[0]],origin:b.origin}),b.removed=Zd(a,b.from,b.to),c||(c=vc(a,b)),a.cm?Ec(a.cm,b,d):Td(a,b,d),Ba(a,c,Jg)}}function Ec(a,b,c){var d=a.doc,e=a.display,g=b.from,h=b.to,i=!1,j=g.line;a.options.lineWrapping||(j=ae(rd(Yd(d,g.line))),d.iter(j,h.line+1,function(a){if(a==e.maxLine)return i=!0,!0})),d.sel.contains(b.from,b.to)>-1&&Ae(a),Td(d,b,c,f(a)),a.options.lineWrapping||(d.iter(j,g.line+b.text.length,function(a){var b=l(a);b>e.maxLineLength&&(e.maxLine=a,e.maxLineLength=b,e.maxLineChanged=!0,i=!1)}),i&&(a.curOp.updateMaxLine=!0)),d.frontier=Math.min(d.frontier,g.line),Na(a,400);var k=b.text.length-(h.line-g.line)-1;b.full?Jb(a):g.line!=h.line||1!=b.text.length||Sd(a.doc,b)?Jb(a,g.line,h.line+1,k):Kb(a,g.line,"text");var m=Be(a,"changes"),n=Be(a,"change");if(n||m){var o={from:g,to:h,text:b.text,removed:b.removed,origin:b.origin};n&&xe(a,"change",a,o),m&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(o)}a.display.selForContextMenu=null}function Fc(a,b,c,d,e){if(d||(d=c),Lf(d,c)<0){var f=d;d=c,c=f}"string"==typeof b&&(b=a.splitLines(b)),zc(a,{from:c,to:d,text:b,origin:e})}function Gc(a,b){if(!ze(a,"scrollCursorIntoView")){var c=a.display,d=c.sizer.getBoundingClientRect(),e=null;if(b.top+d.top<0?e=!0:b.bottom+d.top>(window.innerHeight||document.documentElement.clientHeight)&&(e=!1),null!=e&&!Af){var f=Pe("div","",null,"position: absolute; top: "+(b.top-c.viewOffset-Ra(a.display))+"px; height: "+(b.bottom-b.top+Ua(a)+c.barHeight)+"px; left: "+b.left+"px; width: 2px;");a.display.lineSpace.appendChild(f),f.scrollIntoView(e),a.display.lineSpace.removeChild(f)}}}function Hc(a,b,c,d){null==d&&(d=0);for(var e=0;e<5;e++){var f=!1,g=nb(a,b),h=c&&c!=b?nb(a,c):g,i=Jc(a,Math.min(g.left,h.left),Math.min(g.top,h.top)-d,Math.max(g.left,h.left),Math.max(g.bottom,h.bottom)+d),j=a.doc.scrollTop,k=a.doc.scrollLeft;if(null!=i.scrollTop&&(dc(a,i.scrollTop),Math.abs(a.doc.scrollTop-j)>1&&(f=!0)),null!=i.scrollLeft&&(ec(a,i.scrollLeft),Math.abs(a.doc.scrollLeft-k)>1&&(f=!0)),!f)break}return g}function Ic(a,b,c,d,e){var f=Jc(a,b,c,d,e);null!=f.scrollTop&&dc(a,f.scrollTop),null!=f.scrollLeft&&ec(a,f.scrollLeft)}function Jc(a,b,c,d,e){var f=a.display,g=sb(a.display);c<0&&(c=0);var h=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:f.scroller.scrollTop,i=Wa(a),j={};e-c>i&&(e=c+i);var k=a.doc.height+Sa(f),l=c<g,m=e>k-g;if(c<h)j.scrollTop=l?0:c;else if(e>h+i){var n=Math.min(c,(m?k:e)-i);n!=h&&(j.scrollTop=n)}var o=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:f.scroller.scrollLeft,p=Va(a)-(a.options.fixedGutter?f.gutters.offsetWidth:0),q=d-b>p;return q&&(d=b+p),b<10?j.scrollLeft=0:b<o?j.scrollLeft=Math.max(0,b-(q?0:10)):d>p+o-3&&(j.scrollLeft=d+(q?0:10)-p),j}function Kc(a,b,c){null==b&&null==c||Mc(a),null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b),null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function Lc(a){Mc(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?Kf(b.line,b.ch-1):b,d=Kf(b.line,b.ch+1)),a.curOp.scrollToPos={from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function Mc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=ob(a,b.from),d=ob(a,b.to),e=Jc(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(e.scrollLeft,e.scrollTop)}}function Nc(a,b,c,d){var e,f=a.doc;null==c&&(c="add"),"smart"==c&&(f.mode.indent?e=Qa(a,b):c="prev");var g=a.options.tabSize,h=Yd(f,b),i=Mg(h.text,null,g);h.stateAfter&&(h.stateAfter=null);var j,k=h.text.match(/^\s*/)[0];if(d||/\S/.test(h.text)){if("smart"==c&&(j=f.mode.indent(e,h.text.slice(k.length),h.text),j==Ig||j>150)){if(!d)return;c="prev"}}else j=0,c="not";"prev"==c?j=b>f.first?Mg(Yd(f,b-1).text,null,g):0:"add"==c?j=i+a.options.indentUnit:"subtract"==c?j=i-a.options.indentUnit:"number"==typeof c&&(j=i+c),j=Math.max(0,j);var l="",m=0;if(a.options.indentWithTabs)for(var n=Math.floor(j/g);n;--n)m+=g,l+="\t";if(m<j&&(l+=Ee(j-m)),l!=k)return Fc(f,l,Kf(b,0),Kf(b,k.length),"+input"),h.stateAfter=null,!0;for(var n=0;n<f.sel.ranges.length;n++){var o=f.sel.ranges[n];if(o.head.line==b&&o.head.ch<k.length){var m=Kf(b,k.length);wa(f,n,new la(m,m));break}}}function Oc(a,b,c,d){var e=b,f=b;return"number"==typeof b?f=Yd(a,oa(a,b)):e=ae(b),null==e?null:(d(f,e)&&a.cm&&Kb(a.cm,e,c),f)}function Pc(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;e<c.length;e++){for(var f=b(c[e]);d.length&&Lf(f.from,Fe(d).to)<=0;){var g=d.pop();if(Lf(g.from,f.from)<0){f.from=g.from;break}}d.push(f)}Db(a,function(){for(var b=d.length-1;b>=0;b--)Fc(a.doc,"",d[b].from,d[b].to,"+delete");Lc(a)})}function Qc(a,b,c,d,e){function f(){var b=h+c;return!(b<a.first||b>=a.first+a.size)&&(h=b,k=Yd(a,b))}function g(a){var b=(e?lf:mf)(k,i,c,!0);if(null==b){if(a||!f())return!1;i=e?(c<0?df:cf)(k):c<0?k.text.length:0}else i=b;return!0}var h=b.line,i=b.ch,j=c,k=Yd(a,h);if("char"==d)g();else if("column"==d)g(!0);else if("word"==d||"group"==d)for(var l=null,m="group"==d,n=a.cm&&a.cm.getHelper(b,"wordChars"),o=!0;!(c<0)||g(!o);o=!1){var p=k.text.charAt(i)||"\n",q=Me(p,n)?"w":m&&"\n"==p?"n":!m||/\s/.test(p)?null:"p";if(!m||o||q||(q="s"),l&&l!=q){c<0&&(c=1,g());break}if(q&&(l=q),c>0&&!g(!o))break}var r=Ga(a,Kf(h,i),b,j,!0);return Lf(b,r)||(r.hitSide=!0),r}function Rc(a,b,c,d){var e,f=a.doc,g=b.left;if("page"==d){var h=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);e=b.top+c*(h-(c<0?1.5:.5)*sb(a.display))}else"line"==d&&(e=c>0?b.bottom+3:b.top-3);for(;;){var i=qb(a,g,e);if(!i.outside)break;if(c<0?e<=0:e>=f.height){i.hitSide=!0;break}e+=5*c}return i}function Sc(b,c,d,e){a.defaults[b]=c,d&&(_f[b]=e?function(a,b,c){c!=ag&&d(a,b,c)}:d)}function Tc(a){for(var b,c,d,e,f=a.split(/-(?!$)/),a=f[f.length-1],g=0;g<f.length-1;g++){var h=f[g];if(/^(cmd|meta|m)$/i.test(h))e=!0;else if(/^a(lt)?$/i.test(h))b=!0;else if(/^(c|ctrl|control)$/i.test(h))c=!0;else{if(!/^s(hift)$/i.test(h))throw new Error("Unrecognized modifier name: "+h);d=!0}}return b&&(a="Alt-"+a),c&&(a="Ctrl-"+a),e&&(a="Cmd-"+a),d&&(a="Shift-"+a),a}function Uc(a){return"string"==typeof a?jg[a]:a}function Vc(a,b,c,d,e){
if(d&&d.shared)return Wc(a,b,c,d,e);if(a.cm&&!a.cm.curOp)return Eb(a.cm,Vc)(a,b,c,d,e);var f=new pg(a,e),g=Lf(b,c);if(d&&Ke(d,f,!1),g>0||0==g&&f.clearWhenEmpty!==!1)return f;if(f.replacedWith&&(f.collapsed=!0,f.widgetNode=Pe("span",[f.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||f.widgetNode.setAttribute("cm-ignore-events","true"),d.insertLeft&&(f.widgetNode.insertLeft=!0)),f.collapsed){if(qd(a,b.line,b,c,f)||b.line!=c.line&&qd(a,c.line,b,c,f))throw new Error("Inserting collapsed marker partially overlapping an existing one");Jf=!0}f.addToHistory&&ie(a,{from:b,to:c,origin:"markText"},a.sel,NaN);var h,i=b.line,j=a.cm;if(a.iter(i,c.line+1,function(a){j&&f.collapsed&&!j.options.lineWrapping&&rd(a)==j.display.maxLine&&(h=!0),f.collapsed&&i!=b.line&&_d(a,0),bd(a,new $c(f,i==b.line?b.ch:null,i==c.line?c.ch:null)),++i}),f.collapsed&&a.iter(b.line,c.line+1,function(b){vd(a,b)&&_d(b,0)}),f.clearOnEnter&&Cg(f,"beforeCursorEnter",function(){f.clear()}),f.readOnly&&(If=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory()),f.collapsed&&(f.id=++og,f.atomic=!0),j){if(h&&(j.curOp.updateMaxLine=!0),f.collapsed)Jb(j,b.line,c.line+1);else if(f.className||f.title||f.startStyle||f.endStyle||f.css)for(var k=b.line;k<=c.line;k++)Kb(j,k,"text");f.atomic&&Da(j.doc),xe(j,"markerAdded",j,f)}return f}function Wc(a,b,c,d,e){d=Ke(d),d.shared=!1;var f=[Vc(a,b,c,d,e)],g=f[0],h=d.widgetNode;return Wd(a,function(a){h&&(d.widgetNode=h.cloneNode(!0)),f.push(Vc(a,pa(a,b),pa(a,c),d,e));for(var i=0;i<a.linked.length;++i)if(a.linked[i].isParent)return;g=Fe(f)}),new qg(f,g)}function Xc(a){return a.findMarks(Kf(a.first,0),a.clipPos(Kf(a.lastLine())),function(a){return a.parent})}function Yc(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=d.find(),f=a.clipPos(e.from),g=a.clipPos(e.to);if(Lf(f,g)){var h=Vc(a,f,g,d.primary,d.primary.type);d.markers.push(h),h.parent=d}}}function Zc(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];Wd(c.primary.doc,function(a){d.push(a)});for(var e=0;e<c.markers.length;e++){var f=c.markers[e];Ge(d,f.doc)==-1&&(f.parent=null,c.markers.splice(e--,1))}}}function $c(a,b,c){this.marker=a,this.from=b,this.to=c}function _c(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function ad(a,b){for(var c,d=0;d<a.length;++d)a[d]!=b&&(c||(c=[])).push(a[d]);return c}function bd(a,b){a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b],b.marker.attachLine(a)}function cd(a,b,c){if(a)for(var d,e=0;e<a.length;++e){var f=a[e],g=f.marker,h=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);if(h||f.from==b&&"bookmark"==g.type&&(!c||!f.marker.insertLeft)){var i=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);(d||(d=[])).push(new $c(g,f.from,i?null:f.to))}}return d}function dd(a,b,c){if(a)for(var d,e=0;e<a.length;++e){var f=a[e],g=f.marker,h=null==f.to||(g.inclusiveRight?f.to>=b:f.to>b);if(h||f.from==b&&"bookmark"==g.type&&(!c||f.marker.insertLeft)){var i=null==f.from||(g.inclusiveLeft?f.from<=b:f.from<b);(d||(d=[])).push(new $c(g,i?null:f.from-b,null==f.to?null:f.to-b))}}return d}function ed(a,b){if(b.full)return null;var c=ra(a,b.from.line)&&Yd(a,b.from.line).markedSpans,d=ra(a,b.to.line)&&Yd(a,b.to.line).markedSpans;if(!c&&!d)return null;var e=b.from.ch,f=b.to.ch,g=0==Lf(b.from,b.to),h=cd(c,e,g),i=dd(d,f,g),j=1==b.text.length,k=Fe(b.text).length+(j?e:0);if(h)for(var l=0;l<h.length;++l){var m=h[l];if(null==m.to){var n=_c(i,m.marker);n?j&&(m.to=null==n.to?null:n.to+k):m.to=e}}if(i)for(var l=0;l<i.length;++l){var m=i[l];if(null!=m.to&&(m.to+=k),null==m.from){var n=_c(h,m.marker);n||(m.from=k,j&&(h||(h=[])).push(m))}else m.from+=k,j&&(h||(h=[])).push(m)}h&&(h=fd(h)),i&&i!=h&&(i=fd(i));var o=[h];if(!j){var p,q=b.text.length-2;if(q>0&&h)for(var l=0;l<h.length;++l)null==h[l].to&&(p||(p=[])).push(new $c(h[l].marker,null,null));for(var l=0;l<q;++l)o.push(p);o.push(i)}return o}function fd(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&c.marker.clearWhenEmpty!==!1&&a.splice(b--,1)}return a.length?a:null}function gd(a,b){var c=oe(a,b),d=ed(a,b);if(!c)return d;if(!d)return c;for(var e=0;e<c.length;++e){var f=c[e],g=d[e];if(f&&g)a:for(var h=0;h<g.length;++h){for(var i=g[h],j=0;j<f.length;++j)if(f[j].marker==i.marker)continue a;f.push(i)}else g&&(c[e]=g)}return c}function hd(a,b,c){var d=null;if(a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&Ge(d,c)!=-1||(d||(d=[])).push(c)}}),!d)return null;for(var e=[{from:b,to:c}],f=0;f<d.length;++f)for(var g=d[f],h=g.find(0),i=0;i<e.length;++i){var j=e[i];if(!(Lf(j.to,h.from)<0||Lf(j.from,h.to)>0)){var k=[i,1],l=Lf(j.from,h.from),m=Lf(j.to,h.to);(l<0||!g.inclusiveLeft&&!l)&&k.push({from:j.from,to:h.from}),(m>0||!g.inclusiveRight&&!m)&&k.push({from:h.to,to:j.to}),e.splice.apply(e,k),i+=k.length-1}}return e}function id(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function jd(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function kd(a){return a.inclusiveLeft?-1:0}function ld(a){return a.inclusiveRight?1:0}function md(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;var d=a.find(),e=b.find(),f=Lf(d.from,e.from)||kd(a)-kd(b);if(f)return-f;var g=Lf(d.to,e.to)||ld(a)-ld(b);return g?g:b.id-a.id}function nd(a,b){var c,d=Jf&&a.markedSpans;if(d)for(var e,f=0;f<d.length;++f)e=d[f],e.marker.collapsed&&null==(b?e.from:e.to)&&(!c||md(c,e.marker)<0)&&(c=e.marker);return c}function od(a){return nd(a,!0)}function pd(a){return nd(a,!1)}function qd(a,b,c,d,e){var f=Yd(a,b),g=Jf&&f.markedSpans;if(g)for(var h=0;h<g.length;++h){var i=g[h];if(i.marker.collapsed){var j=i.marker.find(0),k=Lf(j.from,c)||kd(i.marker)-kd(e),l=Lf(j.to,d)||ld(i.marker)-ld(e);if(!(k>=0&&l<=0||k<=0&&l>=0)&&(k<=0&&(Lf(j.to,c)>0||i.marker.inclusiveRight&&e.inclusiveLeft)||k>=0&&(Lf(j.from,d)<0||i.marker.inclusiveLeft&&e.inclusiveRight)))return!0}}}function rd(a){for(var b;b=od(a);)a=b.find(-1,!0).line;return a}function sd(a){for(var b,c;b=pd(a);)a=b.find(1,!0).line,(c||(c=[])).push(a);return c}function td(a,b){var c=Yd(a,b),d=rd(c);return c==d?b:ae(d)}function ud(a,b){if(b>a.lastLine())return b;var c,d=Yd(a,b);if(!vd(a,d))return b;for(;c=pd(d);)d=c.find(1,!0).line;return ae(d)+1}function vd(a,b){var c=Jf&&b.markedSpans;if(c)for(var d,e=0;e<c.length;++e)if(d=c[e],d.marker.collapsed){if(null==d.from)return!0;if(!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&wd(a,b,d))return!0}}function wd(a,b,c){if(null==c.to){var d=c.marker.find(1,!0);return wd(a,d.line,_c(d.line.markedSpans,c.marker))}if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var e,f=0;f<b.markedSpans.length;++f)if(e=b.markedSpans[f],e.marker.collapsed&&!e.marker.widgetNode&&e.from==c.to&&(null==e.to||e.to!=c.from)&&(e.marker.inclusiveLeft||c.marker.inclusiveRight)&&wd(a,b,e))return!0}function xd(a,b,c){ce(b)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Kc(a,null,c)}function yd(a){if(null!=a.height)return a.height;var b=a.doc.cm;if(!b)return 0;if(!Ug(document.body,a.node)){var c="position: relative;";a.coverGutter&&(c+="margin-left: -"+b.display.gutters.offsetWidth+"px;"),a.noHScroll&&(c+="width: "+b.display.wrapper.clientWidth+"px;"),Re(b.display.measure,Pe("div",[a.node],null,c))}return a.height=a.node.parentNode.offsetHeight}function zd(a,b,c,d){var e=new rg(a,c,d),f=a.cm;return f&&e.noHScroll&&(f.display.alignWidgets=!0),Oc(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);if(null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e),e.line=b,f&&!vd(a,b)){var d=ce(b)<a.scrollTop;_d(b,b.height+yd(e)),d&&Kc(f,null,e.height),f.curOp.forceUpdate=!0}return!0}),e}function Ad(a,b,c,d){a.text=b,a.stateAfter&&(a.stateAfter=null),a.styles&&(a.styles=null),null!=a.order&&(a.order=null),id(a),jd(a,c);var e=d?d(a):1;e!=a.height&&_d(a,e)}function Bd(a){a.parent=null,id(a)}function Cd(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:new RegExp("(?:^|s)"+c[2]+"(?:$|s)").test(b[d])||(b[d]+=" "+c[2])}return a}function Dd(b,c){if(b.blankLine)return b.blankLine(c);if(b.innerMode){var d=a.innerMode(b,c);return d.mode.blankLine?d.mode.blankLine(d.state):void 0}}function Ed(b,c,d,e){for(var f=0;f<10;f++){e&&(e[0]=a.innerMode(b,d).mode);var g=b.token(c,d);if(c.pos>c.start)return g}throw new Error("Mode "+b.name+" failed to advance stream.")}function Fd(a,b,c,d){function e(a){return{start:l.start,end:l.pos,string:l.current(),type:f||null,state:a?gg(g.mode,k):k}}var f,g=a.doc,h=g.mode;b=pa(g,b);var i,j=Yd(g,b.line),k=Qa(a,b.line,c),l=new ng(j.text,a.options.tabSize);for(d&&(i=[]);(d||l.pos<b.ch)&&!l.eol();)l.start=l.pos,f=Ed(h,l,k),d&&i.push(e(!0));return d?i:e()}function Gd(a,b,c,d,e,f,g){var h=c.flattenSpans;null==h&&(h=a.options.flattenSpans);var i,j=0,k=null,l=new ng(b,a.options.tabSize),m=a.options.addModeClass&&[null];for(""==b&&Cd(Dd(c,d),f);!l.eol();){if(l.pos>a.options.maxHighlightLength?(h=!1,g&&Jd(a,b,d,l.pos),l.pos=b.length,i=null):i=Cd(Ed(c,l,d,m),f),m){var n=m[0].name;n&&(i="m-"+(i?n+" "+i:n))}if(!h||k!=i){for(;j<l.start;)j=Math.min(l.start,j+5e4),e(j,k);k=i}l.start=l.pos}for(;j<l.pos;){var o=Math.min(l.pos,j+5e4);e(o,k),j=o}}function Hd(a,b,c,d){var e=[a.state.modeGen],f={};Gd(a,b.text,a.doc.mode,c,function(a,b){e.push(a,b)},f,d);for(var g=0;g<a.state.overlays.length;++g){var h=a.state.overlays[g],i=1,j=0;Gd(a,b.text,h.mode,!0,function(a,b){for(var c=i;j<a;){var d=e[i];d>a&&e.splice(i,1,a,e[i+1],d),i+=2,j=Math.min(a,d)}if(b)if(h.opaque)e.splice(c,i-c,a,"cm-overlay "+b),i=c+2;else for(;c<i;c+=2){var f=e[c+1];e[c+1]=(f?f+" ":"")+"cm-overlay "+b}},f)}return{styles:e,classes:f.bgClass||f.textClass?f:null}}function Id(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=Qa(a,ae(b)),e=Hd(a,b,b.text.length>a.options.maxHighlightLength?gg(a.doc.mode,d):d);b.stateAfter=d,b.styles=e.styles,e.classes?b.styleClasses=e.classes:b.styleClasses&&(b.styleClasses=null),c===a.doc.frontier&&a.doc.frontier++}return b.styles}function Jd(a,b,c,d){var e=a.doc.mode,f=new ng(b,a.options.tabSize);for(f.start=f.pos=d||0,""==b&&Dd(e,c);!f.eol();)Ed(e,f,c),f.start=f.pos}function Kd(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?ug:tg;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function Ld(a,b){var c=Pe("span",null,null,uf?"padding-right: .1px":null),d={pre:Pe("pre",[c],"CodeMirror-line"),content:c,col:0,pos:0,cm:a,splitSpaces:(sf||uf)&&a.getOption("lineWrapping")};b.measure={};for(var e=0;e<=(b.rest?b.rest.length:0);e++){var f,g=e?b.rest[e-1]:b.line;d.pos=0,d.addToken=Nd,Ze(a.display.measure)&&(f=de(g))&&(d.addToken=Pd(d.addToken,f)),d.map=[];var h=b!=a.display.externalMeasured&&ae(g);Rd(g,d,Id(a,g,h)),g.styleClasses&&(g.styleClasses.bgClass&&(d.bgClass=Ue(g.styleClasses.bgClass,d.bgClass||"")),g.styleClasses.textClass&&(d.textClass=Ue(g.styleClasses.textClass,d.textClass||""))),0==d.map.length&&d.map.push(0,0,d.content.appendChild(Ye(a.display.measure))),0==e?(b.measure.map=d.map,b.measure.cache={}):((b.measure.maps||(b.measure.maps=[])).push(d.map),(b.measure.caches||(b.measure.caches=[])).push({}))}return uf&&/\bcm-tab\b/.test(d.content.lastChild.className)&&(d.content.className="cm-tab-wrap-hack"),Fg(a,"renderLine",a,b.line,d.pre),d.pre.className&&(d.textClass=Ue(d.pre.className,d.textClass||"")),d}function Md(a){var b=Pe("span","","cm-invalidchar");return b.title="\\u"+a.charCodeAt(0).toString(16),b.setAttribute("aria-label",b.title),b}function Nd(a,b,c,d,e,f,g){if(b){var h=a.splitSpaces?b.replace(/ {3,}/g,Od):b,i=a.cm.state.specialChars,j=!1;if(i.test(b))for(var k=document.createDocumentFragment(),l=0;;){i.lastIndex=l;var m=i.exec(b),n=m?m.index-l:b.length-l;if(n){var o=document.createTextNode(h.slice(l,l+n));sf&&tf<9?k.appendChild(Pe("span",[o])):k.appendChild(o),a.map.push(a.pos,a.pos+n,o),a.col+=n,a.pos+=n}if(!m)break;if(l+=n+1,"\t"==m[0]){var p=a.cm.options.tabSize,q=p-a.col%p,o=k.appendChild(Pe("span",Ee(q),"cm-tab"));o.setAttribute("role","presentation"),o.setAttribute("cm-text","\t"),a.col+=q}else if("\r"==m[0]||"\n"==m[0]){var o=k.appendChild(Pe("span","\r"==m[0]?"":"","cm-invalidchar"));o.setAttribute("cm-text",m[0]),a.col+=1}else{var o=a.cm.options.specialCharPlaceholder(m[0]);o.setAttribute("cm-text",m[0]),sf&&tf<9?k.appendChild(Pe("span",[o])):k.appendChild(o),a.col+=1}a.map.push(a.pos,a.pos+1,o),a.pos++}else{a.col+=b.length;var k=document.createTextNode(h);a.map.push(a.pos,a.pos+b.length,k),sf&&tf<9&&(j=!0),a.pos+=b.length}if(c||d||e||j||g){var r=c||"";d&&(r+=d),e&&(r+=e);var s=Pe("span",[k],r,g);return f&&(s.title=f),a.content.appendChild(s)}a.content.appendChild(k)}}function Od(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"";return b+=" "}function Pd(a,b){return function(c,d,e,f,g,h,i){e=e?e+" cm-force-border":"cm-force-border";for(var j=c.pos,k=j+d.length;;){for(var l=0;l<b.length;l++){var m=b[l];if(m.to>j&&m.from<=j)break}if(m.to>=k)return a(c,d,e,f,g,h,i);a(c,d.slice(0,m.to-j),e,f,null,h,i),f=null,d=d.slice(m.to-j),j=m.to}}}function Qd(a,b,c,d){var e=!d&&c.widgetNode;e&&a.map.push(a.pos,a.pos+b,e),!d&&a.cm.display.input.needsContentAttribute&&(e||(e=a.content.appendChild(document.createElement("span"))),e.setAttribute("cm-marker",c.id)),e&&(a.cm.display.input.setUneditable(e),a.content.appendChild(e)),a.pos+=b}function Rd(a,b,c){var d=a.markedSpans,e=a.text,f=0;if(d)for(var g,h,i,j,k,l,m,n=e.length,o=0,p=1,q="",r=0;;){if(r==o){i=j=k=l=h="",m=null,r=1/0;for(var s,t=[],u=0;u<d.length;++u){var v=d[u],w=v.marker;"bookmark"==w.type&&v.from==o&&w.widgetNode?t.push(w):v.from<=o&&(null==v.to||v.to>o||w.collapsed&&v.to==o&&v.from==o)?(null!=v.to&&v.to!=o&&r>v.to&&(r=v.to,j=""),w.className&&(i+=" "+w.className),w.css&&(h=(h?h+";":"")+w.css),w.startStyle&&v.from==o&&(k+=" "+w.startStyle),w.endStyle&&v.to==r&&(s||(s=[])).push(w.endStyle,v.to),w.title&&!l&&(l=w.title),w.collapsed&&(!m||md(m.marker,w)<0)&&(m=v)):v.from>o&&r>v.from&&(r=v.from)}if(s)for(var u=0;u<s.length;u+=2)s[u+1]==r&&(j+=" "+s[u]);if(!m||m.from==o)for(var u=0;u<t.length;++u)Qd(b,0,t[u]);if(m&&(m.from||0)==o){if(Qd(b,(null==m.to?n+1:m.to)-o,m.marker,null==m.from),null==m.to)return;m.to==o&&(m=!1)}}if(o>=n)break;for(var x=Math.min(n,r);;){if(q){var y=o+q.length;if(!m){var z=y>x?q.slice(0,x-o):q;b.addToken(b,z,g?g+i:i,k,o+z.length==r?j:"",l,h)}if(y>=x){q=q.slice(x-o),o=x;break}o=y,k=""}q=e.slice(f,f=c[p++]),g=Kd(c[p++],b.cm.options)}}else for(var p=1;p<c.length;p+=2)b.addToken(b,e.slice(f,f=c[p]),Kd(c[p+1],b.cm.options))}function Sd(a,b){return 0==b.from.ch&&0==b.to.ch&&""==Fe(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Td(a,b,c,d){function e(a){return c?c[a]:null}function f(a,c,e){Ad(a,c,e,d),xe(a,"change",a,b)}function g(a,b){for(var c=a,f=[];c<b;++c)f.push(new sg(j[c],e(c),d));return f}var h=b.from,i=b.to,j=b.text,k=Yd(a,h.line),l=Yd(a,i.line),m=Fe(j),n=e(j.length-1),o=i.line-h.line;if(b.full)a.insert(0,g(0,j.length)),a.remove(j.length,a.size-j.length);else if(Sd(a,b)){var p=g(0,j.length-1);f(l,l.text,n),o&&a.remove(h.line,o),p.length&&a.insert(h.line,p)}else if(k==l)if(1==j.length)f(k,k.text.slice(0,h.ch)+m+k.text.slice(i.ch),n);else{var p=g(1,j.length-1);p.push(new sg(m+k.text.slice(i.ch),n,d)),f(k,k.text.slice(0,h.ch)+j[0],e(0)),a.insert(h.line+1,p)}else if(1==j.length)f(k,k.text.slice(0,h.ch)+j[0]+l.text.slice(i.ch),e(0)),a.remove(h.line+1,o);else{f(k,k.text.slice(0,h.ch)+j[0],e(0)),f(l,m+l.text.slice(i.ch),n);var p=g(1,j.length-1);o>1&&a.remove(h.line+1,o-1),a.insert(h.line+1,p)}xe(a,"change",a,b)}function Ud(a){this.lines=a,this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function Vd(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var e=a[d];b+=e.chunkSize(),c+=e.height,e.parent=this}this.size=b,this.height=c,this.parent=null}function Wd(a,b,c){function d(a,e,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=a.linked[g];if(h.doc!=e){var i=f&&h.sharedHist;c&&!i||(b(h.doc,i),d(h.doc,a,i))}}}d(a,null,!0)}function Xd(a,b){if(b.cm)throw new Error("This document is already in use.");a.doc=b,b.cm=a,g(a),c(a),a.options.lineWrapping||m(a),a.options.mode=b.modeOption,Jb(a)}function Yd(a,b){if(b-=a.first,b<0||b>=a.size)throw new Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var e=c.children[d],f=e.chunkSize();if(b<f){c=e;break}b-=f}return c.lines[b]}function Zd(a,b,c){var d=[],e=b.line;return a.iter(b.line,c.line+1,function(a){var f=a.text;e==c.line&&(f=f.slice(0,c.ch)),e==b.line&&(f=f.slice(b.ch)),d.push(f),++e}),d}function $d(a,b,c){var d=[];return a.iter(b,c,function(a){d.push(a.text)}),d}function _d(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function ae(a){if(null==a.parent)return null;for(var b=a.parent,c=Ge(b.lines,a),d=b.parent;d;b=d,d=d.parent)for(var e=0;d.children[e]!=b;++e)c+=d.children[e].chunkSize();return c+b.first}function be(a,b){var c=a.first;a:do{for(var d=0;d<a.children.length;++d){var e=a.children[d],f=e.height;if(b<f){a=e;continue a}b-=f,c+=e.chunkSize()}return c}while(!a.lines);for(var d=0;d<a.lines.length;++d){var g=a.lines[d],h=g.height;if(b<h)break;b-=h}return c+d}function ce(a){a=rd(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var e=c.lines[d];if(e==a)break;b+=e.height}for(var f=c.parent;f;c=f,f=c.parent)for(var d=0;d<f.children.length;++d){var g=f.children[d];if(g==c)break;b+=g.height}return b}function de(a){var b=a.order;return null==b&&(b=a.order=fh(a.text)),b}function ee(a){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=a||1}function fe(a,b){var c={from:V(b.from),to:Zf(b),text:Zd(a,b.from,b.to)};return me(a,c,b.from.line,b.to.line+1),Wd(a,function(a){me(a,c,b.from.line,b.to.line+1)},!0),c}function ge(a){for(;a.length;){var b=Fe(a);if(!b.ranges)break;a.pop()}}function he(a,b){return b?(ge(a.done),Fe(a.done)):a.done.length&&!Fe(a.done).ranges?Fe(a.done):a.done.length>1&&!a.done[a.done.length-2].ranges?(a.done.pop(),Fe(a.done)):void 0}function ie(a,b,c,d){var e=a.history;e.undone.length=0;var f,g=+new Date;if((e.lastOp==d||e.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>g-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))&&(f=he(e,e.lastOp==d))){var h=Fe(f.changes);0==Lf(b.from,b.to)&&0==Lf(b.from,h.to)?h.to=Zf(b):f.changes.push(fe(a,b))}else{var i=Fe(e.done);for(i&&i.ranges||le(a.sel,e.done),f={changes:[fe(a,b)],generation:e.generation},e.done.push(f);e.done.length>e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift()}e.done.push(c),e.generation=++e.maxGeneration,e.lastModTime=e.lastSelTime=g,e.lastOp=e.lastSelOp=d,e.lastOrigin=e.lastSelOrigin=b.origin,h||Fg(a,"historyAdded")}function je(a,b,c,d){var e=b.charAt(0);return"*"==e||"+"==e&&c.ranges.length==d.ranges.length&&c.somethingSelected()==d.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}function ke(a,b,c,d){var e=a.history,f=d&&d.origin;c==e.lastSelOp||f&&e.lastSelOrigin==f&&(e.lastModTime==e.lastSelTime&&e.lastOrigin==f||je(a,f,Fe(e.done),b))?e.done[e.done.length-1]=b:le(b,e.done),e.lastSelTime=+new Date,e.lastSelOrigin=f,e.lastSelOp=c,d&&d.clearRedo!==!1&&ge(e.undone)}function le(a,b){var c=Fe(b);c&&c.ranges&&c.equals(a)||b.push(a)}function me(a,b,c,d){var e=b["spans_"+a.id],f=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[f]=c.markedSpans),++f})}function ne(a){if(!a)return null;for(var b,c=0;c<a.length;++c)a[c].marker.explicitlyCleared?b||(b=a.slice(0,c)):b&&b.push(a[c]);return b?b.length?b:null:a}function oe(a,b){var c=b["spans_"+a.id];if(!c)return null;for(var d=0,e=[];d<b.text.length;++d)e.push(ne(c[d]));return e}function pe(a,b,c){for(var d=0,e=[];d<a.length;++d){var f=a[d];if(f.ranges)e.push(c?ka.prototype.deepCopy.call(f):f);else{var g=f.changes,h=[];e.push({changes:h});for(var i=0;i<g.length;++i){var j,k=g[i];if(h.push({from:k.from,to:k.to,text:k.text}),b)for(var l in k)(j=l.match(/^spans_(\d+)$/))&&Ge(b,Number(j[1]))>-1&&(Fe(h)[l]=k[l],delete k[l])}}}return e}function qe(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function re(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e],g=!0;if(f.ranges){f.copied||(f=a[e]=f.deepCopy(),f.copied=!0);for(var h=0;h<f.ranges.length;h++)qe(f.ranges[h].anchor,b,c,d),qe(f.ranges[h].head,b,c,d)}else{for(var h=0;h<f.changes.length;++h){var i=f.changes[h];if(c<i.from.line)i.from=Kf(i.from.line+d,i.from.ch),i.to=Kf(i.to.line+d,i.to.ch);else if(b<=i.to.line){g=!1;break}}g||(a.splice(0,e+1),e=0)}}}function se(a,b){var c=b.from.line,d=b.to.line,e=b.text.length-(d-c)-1;re(a.done,c,d,e),re(a.undone,c,d,e)}function te(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function ue(a){return a.target||a.srcElement}function ve(a){var b=a.which;return null==b&&(1&a.button?b=1:2&a.button?b=3:4&a.button&&(b=2)),Df&&a.ctrlKey&&1==b&&(b=3),b}function we(a,b,c){var d=a._handlers&&a._handlers[b];return c?d&&d.length>0?d.slice():Dg:d||Dg}function xe(a,b){function c(a){return function(){a.apply(null,f)}}var d=we(a,b,!1);if(d.length){var e,f=Array.prototype.slice.call(arguments,2);Rf?e=Rf.delayedCallbacks:Gg?e=Gg:(e=Gg=[],setTimeout(ye,0));for(var g=0;g<d.length;++g)e.push(c(d[g]))}}function ye(){var a=Gg;Gg=null;for(var b=0;b<a.length;++b)a[b]()}function ze(a,b,c){return"string"==typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}}),Fg(a,c||b.type,a,b),te(b)||b.codemirrorIgnore}function Ae(a){var b=a._handlers&&a._handlers.cursorActivity;if(b)for(var c=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]),d=0;d<b.length;++d)Ge(c,b[d])==-1&&c.push(b[d])}function Be(a,b){return we(a,b).length>0}function Ce(a){a.prototype.on=function(a,b){Cg(this,a,b)},a.prototype.off=function(a,b){Eg(this,a,b)}}function De(){this.id=null}function Ee(a){for(;Og.length<=a;)Og.push(Fe(Og)+" ");return Og[a]}function Fe(a){return a[a.length-1]}function Ge(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function He(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function Ie(){}function Je(a,b){var c;return Object.create?c=Object.create(a):(Ie.prototype=a,c=new Ie),b&&Ke(b,c),c}function Ke(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||c===!1&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function Le(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Me(a,b){return b?!!(b.source.indexOf("\\w")>-1&&Sg(a))||b.test(a):Sg(a)}function Ne(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function Oe(a){return a.charCodeAt(0)>=768&&Tg.test(a)}function Pe(a,b,c,d){var e=document.createElement(a);if(c&&(e.className=c),d&&(e.style.cssText=d),"string"==typeof b)e.appendChild(document.createTextNode(b));else if(b)for(var f=0;f<b.length;++f)e.appendChild(b[f]);return e}function Qe(a){for(var b=a.childNodes.length;b>0;--b)a.removeChild(a.firstChild);return a}function Re(a,b){return Qe(a).appendChild(b)}function Se(){for(var a=document.activeElement;a&&a.root&&a.root.activeElement;)a=a.root.activeElement;return a}function Te(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function Ue(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d]&&!Te(c[d]).test(b)&&(b+=" "+c[d]);return b}function Ve(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function We(){Zg||(Xe(),Zg=!0)}function Xe(){var a;Cg(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null,Ve(Sb)},100))}),Cg(window,"blur",function(){Ve(rc)})}function Ye(a){if(null==Vg){var b=Pe("span","");Re(a,Pe("span",[b,document.createTextNode("x")])),0!=a.firstChild.offsetHeight&&(Vg=b.offsetWidth<=1&&b.offsetHeight>2&&!(sf&&tf<8))}var c=Vg?Pe("span",""):Pe("span","",null,"display: inline-block; width: 1px; margin-right: -1px");return c.setAttribute("cm-text",""),c}function Ze(a){if(null!=Wg)return Wg;var b=Re(a,document.createTextNode("AA")),c=Qg(b,0,1).getBoundingClientRect();if(!c||c.left==c.right)return!1;var d=Qg(b,1,2).getBoundingClientRect();return Wg=d.right-c.right<3}function $e(a){if(null!=ch)return ch;var b=Re(a,Pe("span","x")),c=b.getBoundingClientRect(),d=Qg(b,0,1).getBoundingClientRect();return ch=Math.abs(c.left-d.left)>1}function _e(a,b,c,d){if(!a)return d(b,c,"ltr");for(var e=!1,f=0;f<a.length;++f){var g=a[f];(g.from<c&&g.to>b||b==c&&g.to==b)&&(d(Math.max(g.from,b),Math.min(g.to,c),1==g.level?"rtl":"ltr"),e=!0)}e||d(b,c,"ltr")}function af(a){return a.level%2?a.to:a.from}function bf(a){return a.level%2?a.from:a.to}function cf(a){var b=de(a);return b?af(b[0]):0}function df(a){var b=de(a);return b?bf(Fe(b)):a.text.length}function ef(a,b){var c=Yd(a.doc,b),d=rd(c);d!=c&&(b=ae(d));var e=de(d),f=e?e[0].level%2?df(d):cf(d):0;return Kf(b,f)}function ff(a,b){for(var c,d=Yd(a.doc,b);c=pd(d);)d=c.find(1,!0).line,b=null;var e=de(d),f=e?e[0].level%2?cf(d):df(d):d.text.length;return Kf(null==b?ae(d):b,f)}function gf(a,b){var c=ef(a,b.line),d=Yd(a.doc,c.line),e=de(d);if(!e||0==e[0].level){var f=Math.max(0,d.text.search(/\S/)),g=b.line==c.line&&b.ch<=f&&b.ch;return Kf(c.line,g?0:f)}return c}function hf(a,b,c){var d=a[0].level;return b==d||c!=d&&b<c}function jf(a,b){eh=null;for(var c,d=0;d<a.length;++d){var e=a[d];if(e.from<b&&e.to>b)return d;if(e.from==b||e.to==b){if(null!=c)return hf(a,e.level,a[c].level)?(e.from!=e.to&&(eh=c),d):(e.from!=e.to&&(eh=d),c);c=d}}return c}function kf(a,b,c,d){if(!d)return b+c;do b+=c;while(b>0&&Oe(a.text.charAt(b)));return b}function lf(a,b,c,d){var e=de(a);if(!e)return mf(a,b,c,d);for(var f=jf(e,b),g=e[f],h=kf(a,b,g.level%2?-c:c,d);;){if(h>g.from&&h<g.to)return h;if(h==g.from||h==g.to)return jf(e,h)==f?h:(g=e[f+=c],c>0==g.level%2?g.to:g.from);if(g=e[f+=c],!g)return null;h=c>0==g.level%2?kf(a,g.to,-1,d):kf(a,g.from,1,d)}}function mf(a,b,c,d){var e=b+c;if(d)for(;e>0&&Oe(a.text.charAt(e));)e+=c;return e<0||e>a.text.length?null:e}var nf=navigator.userAgent,of=navigator.platform,pf=/gecko\/\d/i.test(nf),qf=/MSIE \d/.test(nf),rf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nf),sf=qf||rf,tf=sf&&(qf?document.documentMode||6:rf[1]),uf=/WebKit\//.test(nf),vf=uf&&/Qt\/\d+\.\d+/.test(nf),wf=/Chrome\//.test(nf),xf=/Opera\//.test(nf),yf=/Apple Computer/.test(navigator.vendor),zf=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(nf),Af=/PhantomJS/.test(nf),Bf=/AppleWebKit/.test(nf)&&/Mobile\/\w+/.test(nf),Cf=Bf||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(nf),Df=Bf||/Mac/.test(of),Ef=/win/i.test(of),Ff=xf&&nf.match(/Version\/(\d*\.\d*)/);Ff&&(Ff=Number(Ff[1])),Ff&&Ff>=15&&(xf=!1,uf=!0);var Gf=Df&&(vf||xf&&(null==Ff||Ff<12.11)),Hf=pf||sf&&tf>=9,If=!1,Jf=!1;p.prototype=Ke({update:function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;if(c){this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0";var e=a.viewHeight-(b?d:0);this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+e)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(b){this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=a.barLeft+"px";var f=a.viewWidth-a.barLeft-(c?d:0);this.horiz.firstChild.style.width=a.scrollWidth-a.clientWidth+f+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&a.clientHeight>0&&(0==d&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:c?d:0,bottom:b?d:0}},setScrollLeft:function(a){this.horiz.scrollLeft!=a&&(this.horiz.scrollLeft=a),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz)},setScrollTop:function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert)},zeroWidthHack:function(){var a=Df&&!zf?"12px":"18px";this.horiz.style.height=this.vert.style.width=a,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new De,this.disableVert=new De},enableZeroWidthBar:function(a,b){function c(){var d=a.getBoundingClientRect(),e=document.elementFromPoint(d.left+1,d.bottom-1);e!=a?a.style.pointerEvents="none":b.set(1e3,c)}a.style.pointerEvents="auto",b.set(1e3,c)},clear:function(){var a=this.horiz.parentNode;a.removeChild(this.horiz),a.removeChild(this.vert)}},p.prototype),q.prototype=Ke({update:function(){return{bottom:0,right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},q.prototype),a.scrollbarModel={native:p,null:q},z.prototype.signal=function(a,b){Be(a,b)&&this.events.push(arguments)},z.prototype.finish=function(){for(var a=0;a<this.events.length;a++)Fg.apply(null,this.events[a])};var Kf=a.Pos=function(a,b){return this instanceof Kf?(this.line=a,void(this.ch=b)):new Kf(a,b)},Lf=a.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch},Mf=null;ca.prototype=Ke({init:function(a){function b(a){if(!ze(d,a)){if(d.somethingSelected())Mf=d.getSelections(),c.inaccurateSelection&&(c.prevInput="",c.inaccurateSelection=!1,f.value=Mf.join("\n"),Pg(f));else{if(!d.options.lineWiseCopyCut)return;var b=aa(d);Mf=b.text,"cut"==a.type?d.setSelections(b.ranges,null,Jg):(c.prevInput="",f.value=b.text.join("\n"),Pg(f))}"cut"==a.type&&(d.state.cutIncoming=!0)}}var c=this,d=this.cm,e=this.wrapper=da(),f=this.textarea=e.firstChild;a.wrapper.insertBefore(e,a.wrapper.firstChild),Bf&&(f.style.width="0px"),Cg(f,"input",function(){sf&&tf>=9&&c.hasSelection&&(c.hasSelection=null),c.poll()}),Cg(f,"paste",function(a){ze(d,a)||$(a,d)||(d.state.pasteIncoming=!0,c.fastPoll())}),Cg(f,"cut",b),Cg(f,"copy",b),Cg(a.scroller,"paste",function(b){Tb(a,b)||ze(d,b)||(d.state.pasteIncoming=!0,c.focus())}),Cg(a.lineSpace,"selectstart",function(b){Tb(a,b)||zg(b)}),Cg(f,"compositionstart",function(){var a=d.getCursor("from");c.composing&&c.composing.range.clear(),c.composing={start:a,range:d.markText(a,d.getCursor("to"),{className:"CodeMirror-composing"})}}),Cg(f,"compositionend",function(){c.composing&&(c.poll(),c.composing.range.clear(),c.composing=null)})},prepareSelection:function(){var a=this.cm,b=a.display,c=a.doc,d=Ja(a);if(a.options.moveInputWithCursor){var e=nb(a,c.sel.primary().head,"div"),f=b.wrapper.getBoundingClientRect(),g=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,e.top+g.top-f.top)),d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,e.left+g.left-f.left))}return d},showSelection:function(a){var b=this.cm,c=b.display;Re(c.cursorDiv,a.cursors),Re(c.selectionDiv,a.selection),null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},reset:function(a){if(!this.contextMenuPending){var b,c,d=this.cm,e=d.doc;if(d.somethingSelected()){this.prevInput="";var f=e.sel.primary();b=bh&&(f.to().line-f.from().line>100||(c=d.getSelection()).length>1e3);var g=b?"-":c||d.getSelection();this.textarea.value=g,d.state.focused&&Pg(this.textarea),sf&&tf>=9&&(this.hasSelection=g)}else a||(this.prevInput=this.textarea.value="",sf&&tf>=9&&(this.hasSelection=null));this.inaccurateSelection=b}},getField:function(){return this.textarea},supportsTouch:function(){return!1},focus:function(){if("nocursor"!=this.cm.options.readOnly&&(!Cf||Se()!=this.textarea))try{this.textarea.focus()}catch(a){}},blur:function(){this.textarea.blur()},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0},receivedFocus:function(){this.slowPoll()},slowPoll:function(){var a=this;a.pollingFast||a.polling.set(this.cm.options.pollInterval,function(){a.poll(),a.cm.state.focused&&a.slowPoll()})},fastPoll:function(){function a(){var d=c.poll();d||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0,c.polling.set(20,a)},poll:function(){var a=this.cm,b=this.textarea,c=this.prevInput;
if(this.contextMenuPending||!a.state.focused||ah(b)&&!c&&!this.composing||a.isReadOnly()||a.options.disableInput||a.state.keySeq)return!1;var d=b.value;if(d==c&&!a.somethingSelected())return!1;if(sf&&tf>=9&&this.hasSelection===d||Df&&/[\uf700-\uf7ff]/.test(d))return a.display.input.reset(),!1;if(a.doc.sel==a.display.selForContextMenu){var e=d.charCodeAt(0);if(8203!=e||c||(c=""),8666==e)return this.reset(),this.cm.execCommand("undo")}for(var f=0,g=Math.min(c.length,d.length);f<g&&c.charCodeAt(f)==d.charCodeAt(f);)++f;var h=this;return Db(a,function(){Z(a,d.slice(f),c.length-f,null,h.composing?"*compose":null),d.length>1e3||d.indexOf("\n")>-1?b.value=h.prevInput="":h.prevInput=d,h.composing&&(h.composing.range.clear(),h.composing.range=a.markText(h.composing.start,a.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},ensurePolled:function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},onKeyPress:function(){sf&&tf>=9&&(this.hasSelection=null),this.fastPoll()},onContextMenu:function(a){function b(){if(null!=g.selectionStart){var a=e.somethingSelected(),b=""+(a?g.value:"");g.value="",g.value=b,d.prevInput=a?"":"",g.selectionStart=1,g.selectionEnd=b.length,f.selForContextMenu=e.doc.sel}}function c(){if(d.contextMenuPending=!1,d.wrapper.style.cssText=l,g.style.cssText=k,sf&&tf<9&&f.scrollbars.setScrollTop(f.scroller.scrollTop=i),null!=g.selectionStart){(!sf||sf&&tf<9)&&b();var a=0,c=function(){f.selForContextMenu==e.doc.sel&&0==g.selectionStart&&g.selectionEnd>0&&""==d.prevInput?Eb(e,ig.selectAll)(e):a++<10?f.detectingSelectAll=setTimeout(c,500):f.input.reset()};f.detectingSelectAll=setTimeout(c,200)}}var d=this,e=d.cm,f=e.display,g=d.textarea,h=Ub(e,a),i=f.scroller.scrollTop;if(h&&!xf){var j=e.options.resetSelectionOnContextMenu;j&&e.doc.sel.contains(h)==-1&&Eb(e,Aa)(e.doc,na(h),Jg);var k=g.style.cssText,l=d.wrapper.style.cssText;d.wrapper.style.cssText="position: absolute";var m=d.wrapper.getBoundingClientRect();if(g.style.cssText="position: absolute; width: 30px; height: 30px; top: "+(a.clientY-m.top-5)+"px; left: "+(a.clientX-m.left-5)+"px; z-index: 1000; background: "+(sf?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",uf)var n=window.scrollY;if(f.input.focus(),uf&&window.scrollTo(null,n),f.input.reset(),e.somethingSelected()||(g.value=d.prevInput=" "),d.contextMenuPending=!0,f.selForContextMenu=e.doc.sel,clearTimeout(f.detectingSelectAll),sf&&tf>=9&&b(),Hf){Bg(a);var o=function(){Eg(window,"mouseup",o),setTimeout(c,20)};Cg(window,"mouseup",o)}else setTimeout(c,50)}},readOnlyChanged:function(a){a||this.reset()},setUneditable:Ie,needsContentAttribute:!1},ca.prototype),ea.prototype=Ke({init:function(a){function b(a){if(!ze(d,a)){if(d.somethingSelected())Mf=d.getSelections(),"cut"==a.type&&d.replaceSelection("",null,"cut");else{if(!d.options.lineWiseCopyCut)return;var b=aa(d);Mf=b.text,"cut"==a.type&&d.operation(function(){d.setSelections(b.ranges,0,Jg),d.replaceSelection("",null,"cut")})}if(a.clipboardData&&!Bf)a.preventDefault(),a.clipboardData.clearData(),a.clipboardData.setData("text/plain",Mf.join("\n"));else{var c=da(),e=c.firstChild;d.display.lineSpace.insertBefore(c,d.display.lineSpace.firstChild),e.value=Mf.join("\n");var f=document.activeElement;Pg(e),setTimeout(function(){d.display.lineSpace.removeChild(c),f.focus()},50)}}}var c=this,d=c.cm,e=c.div=a.lineDiv;ba(e),Cg(e,"paste",function(a){ze(d,a)||$(a,d)}),Cg(e,"compositionstart",function(a){var b=a.data;if(c.composing={sel:d.doc.sel,data:b,startData:b},b){var e=d.doc.sel.primary(),f=d.getLine(e.head.line),g=f.indexOf(b,Math.max(0,e.head.ch-b.length));g>-1&&g<=e.head.ch&&(c.composing.sel=na(Kf(e.head.line,g),Kf(e.head.line,g+b.length)))}}),Cg(e,"compositionupdate",function(a){c.composing.data=a.data}),Cg(e,"compositionend",function(a){var b=c.composing;b&&(a.data==b.startData||/\u200b/.test(a.data)||(b.data=a.data),setTimeout(function(){b.handled||c.applyComposition(b),c.composing==b&&(c.composing=null)},50))}),Cg(e,"touchstart",function(){c.forceCompositionEnd()}),Cg(e,"input",function(){c.composing||!d.isReadOnly()&&c.pollContent()||Db(c.cm,function(){Jb(d)})}),Cg(e,"copy",b),Cg(e,"cut",b)},prepareSelection:function(){var a=Ja(this.cm,!1);return a.focus=this.cm.state.focused,a},showSelection:function(a){a&&this.cm.display.view.length&&(a.focus&&this.showPrimarySelection(),this.showMultipleSelections(a))},showPrimarySelection:function(){var a=window.getSelection(),b=this.cm.doc.sel.primary(),c=ha(this.cm,a.anchorNode,a.anchorOffset),d=ha(this.cm,a.focusNode,a.focusOffset);if(!c||c.bad||!d||d.bad||0!=Lf(X(c,d),b.from())||0!=Lf(W(c,d),b.to())){var e=fa(this.cm,b.from()),f=fa(this.cm,b.to());if(e||f){var g=this.cm.display.view,h=a.rangeCount&&a.getRangeAt(0);if(e){if(!f){var i=g[g.length-1].measure,j=i.maps?i.maps[i.maps.length-1]:i.map;f={node:j[j.length-1],offset:j[j.length-2]-j[j.length-3]}}}else e={node:g[0].measure.map[2],offset:0};try{var k=Qg(e.node,e.offset,f.offset,f.node)}catch(l){}k&&(!pf&&this.cm.state.focused?(a.collapse(e.node,e.offset),k.collapsed||a.addRange(k)):(a.removeAllRanges(),a.addRange(k)),h&&null==a.anchorNode?a.addRange(h):pf&&this.startGracePeriod()),this.rememberSelection()}}},startGracePeriod:function(){var a=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){a.gracePeriod=!1,a.selectionChanged()&&a.cm.operation(function(){a.cm.curOp.selectionChanged=!0})},20)},showMultipleSelections:function(a){Re(this.cm.display.cursorDiv,a.cursors),Re(this.cm.display.selectionDiv,a.selection)},rememberSelection:function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode,this.lastAnchorOffset=a.anchorOffset,this.lastFocusNode=a.focusNode,this.lastFocusOffset=a.focusOffset},selectionInEditor:function(){var a=window.getSelection();if(!a.rangeCount)return!1;var b=a.getRangeAt(0).commonAncestorContainer;return Ug(this.div,b)},focus:function(){"nocursor"!=this.cm.options.readOnly&&this.div.focus()},blur:function(){this.div.blur()},getField:function(){return this.div},supportsTouch:function(){return!0},receivedFocus:function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=this;this.selectionInEditor()?this.pollSelection():Db(this.cm,function(){b.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,a)},selectionChanged:function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},pollSelection:function(){if(!this.composing&&!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),b=this.cm;this.rememberSelection();var c=ha(b,a.anchorNode,a.anchorOffset),d=ha(b,a.focusNode,a.focusOffset);c&&d&&Db(b,function(){Aa(b.doc,na(c,d),Jg),(c.bad||d.bad)&&(b.curOp.selectionChanged=!0)})}},pollContent:function(){var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),e=c.to();if(d.line<b.viewFrom||e.line>b.viewTo-1)return!1;var f;if(d.line==b.viewFrom||0==(f=Mb(a,d.line)))var g=ae(b.view[0].line),h=b.view[0].node;else var g=ae(b.view[f].line),h=b.view[f-1].node.nextSibling;var i=Mb(a,e.line);if(i==b.view.length-1)var j=b.viewTo-1,k=b.lineDiv.lastChild;else var j=ae(b.view[i+1].line)-1,k=b.view[i+1].node.previousSibling;for(var l=a.doc.splitLines(ja(a,h,k,g,j)),m=Zd(a.doc,Kf(g,0),Kf(j,Yd(a.doc,j).text.length));l.length>1&&m.length>1;)if(Fe(l)==Fe(m))l.pop(),m.pop(),j--;else{if(l[0]!=m[0])break;l.shift(),m.shift(),g++}for(var n=0,o=0,p=l[0],q=m[0],r=Math.min(p.length,q.length);n<r&&p.charCodeAt(n)==q.charCodeAt(n);)++n;for(var s=Fe(l),t=Fe(m),u=Math.min(s.length-(1==l.length?n:0),t.length-(1==m.length?n:0));o<u&&s.charCodeAt(s.length-o-1)==t.charCodeAt(t.length-o-1);)++o;l[l.length-1]=s.slice(0,s.length-o),l[0]=l[0].slice(n);var v=Kf(g,n),w=Kf(j,m.length?Fe(m).length-o:0);return l.length>1||l[0]||Lf(v,w)?(Fc(a.doc,l,v,w,"+input"),!0):void 0},ensurePolled:function(){this.forceCompositionEnd()},reset:function(){this.forceCompositionEnd()},forceCompositionEnd:function(){this.composing&&!this.composing.handled&&(this.applyComposition(this.composing),this.composing.handled=!0,this.div.blur(),this.div.focus())},applyComposition:function(a){this.cm.isReadOnly()?Eb(this.cm,Jb)(this.cm):a.data&&a.data!=a.startData&&Eb(this.cm,Z)(this.cm,a.data,0,a.sel)},setUneditable:function(a){a.contentEditable="false"},onKeyPress:function(a){a.preventDefault(),this.cm.isReadOnly()||Eb(this.cm,Z)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0)},readOnlyChanged:function(a){this.div.contentEditable=String("nocursor"!=a)},onContextMenu:Ie,resetPosition:Ie,needsContentAttribute:!0},ea.prototype),a.inputStyles={textarea:ca,contenteditable:ea},ka.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=Lf(c.anchor,d.anchor)||0!=Lf(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new la(V(this.ranges[b].anchor),V(this.ranges[b].head));return new ka(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(Lf(b,d.from())>=0&&Lf(a,d.to())<=0)return c}return-1}},la.prototype={from:function(){return X(this.anchor,this.head)},to:function(){return W(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var Nf,Of,Pf,Qf={left:0,right:0,top:0,bottom:0},Rf=null,Sf=0,Tf=0,Uf=0,Vf=null;sf?Vf=-.53:pf?Vf=15:wf?Vf=-.7:yf&&(Vf=-1/3);var Wf=function(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;return null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail),null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta),{x:b,y:c}};a.wheelEventPixels=function(a){var b=Wf(a);return b.x*=Vf,b.y*=Vf,b};var Xf=new De,Yf=null,Zf=a.changeEnd=function(a){return a.text?Kf(a.from.line+a.text.length-1,Fe(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};a.prototype={constructor:a,focus:function(){window.focus(),this.display.input.focus()},setOption:function(a,b){var c=this.options,d=c[a];c[a]==b&&"mode"!=a||(c[a]=b,_f.hasOwnProperty(a)&&Eb(this,_f[a])(this,b,d))},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](Uc(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:Fb(function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:d,modeSpec:b,opaque:c&&c.opaque}),this.state.modeGen++,Jb(this)}),removeOverlay:Fb(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a)return b.splice(c,1),this.state.modeGen++,void Jb(this)}}),indentLine:Fb(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract"),ra(this.doc,a)&&Nc(this,a,b,c)}),indentSelection:Fb(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&(Nc(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&Lc(this));else{var f=e.from(),g=e.to(),h=Math.max(c,f.line);c=Math.min(this.lastLine(),g.line-(g.ch?0:1))+1;for(var i=h;i<c;++i)Nc(this,i,a);var j=this.doc.sel.ranges;0==f.ch&&b.length==j.length&&j[d].from().ch>0&&wa(this.doc,d,new la(f,j[d].to()),Jg)}}}),getTokenAt:function(a,b){return Fd(this,a,b)},getLineTokens:function(a,b){return Fd(this,Kf(a),b,!0)},getTokenTypeAt:function(a){a=pa(this.doc,a);var b,c=Id(this,Yd(this.doc,a.line)),d=0,e=(c.length-1)/2,f=a.ch;if(0==f)b=c[2];else for(;;){var g=d+e>>1;if((g?c[2*g-1]:0)>=f)e=g;else{if(!(c[2*g+1]<f)){b=c[2*g+2];break}d=g+1}}var h=b?b.indexOf("cm-overlay "):-1;return h<0?b:0==h?null:b.slice(0,h-1)},getModeAt:function(b){var c=this.doc.mode;return c.innerMode?a.innerMode(c,this.getTokenAt(b).state).mode:c},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!fg.hasOwnProperty(b))return c;var d=fg[b],e=this.getModeAt(a);if("string"==typeof e[b])d[e[b]]&&c.push(d[e[b]]);else if(e[b])for(var f=0;f<e[b].length;f++){var g=d[e[b][f]];g&&c.push(g)}else e.helperType&&d[e.helperType]?c.push(d[e.helperType]):d[e.name]&&c.push(d[e.name]);for(var f=0;f<d._global.length;f++){var h=d._global[f];h.pred(e,this)&&Ge(c,h.val)==-1&&c.push(h.val)}return c},getStateAfter:function(a,b){var c=this.doc;return a=oa(c,null==a?c.first+c.size-1:a),Qa(this,a+1,b)},cursorCoords:function(a,b){var c,d=this.doc.sel.primary();return c=null==a?d.head:"object"==typeof a?pa(this.doc,a):a?d.from():d.to(),nb(this,c,b||"page")},charCoords:function(a,b){return mb(this,pa(this.doc,a),b||"page")},coordsChar:function(a,b){return a=lb(this,a,b||"page"),qb(this,a.left,a.top)},lineAtHeight:function(a,b){return a=lb(this,{top:a,left:0},b||"page").top,be(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c,d=!1;if("number"==typeof a){var e=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>e&&(a=e,d=!0),c=Yd(this.doc,a)}else c=a;return kb(this,c,{top:0,left:0},b||"page").top+(d?this.doc.height-ce(c):0)},defaultTextHeight:function(){return sb(this.display)},defaultCharWidth:function(){return tb(this.display)},setGutterMarker:Fb(function(a,b,c){return Oc(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});return d[b]=c,!c&&Ne(d)&&(a.gutterMarkers=null),!0})}),clearGutter:Fb(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&(c.gutterMarkers[a]=null,Kb(b,d,"gutter"),Ne(c.gutterMarkers)&&(c.gutterMarkers=null)),++d})}),lineInfo:function(a){if("number"==typeof a){if(!ra(this.doc,a))return null;var b=a;if(a=Yd(this.doc,a),!a)return null}else{var b=ae(a);if(null==b)return null}return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var f=this.display;a=nb(this,pa(this.doc,a));var g=a.bottom,h=a.left;if(b.style.position="absolute",b.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(b),f.sizer.appendChild(b),"over"==d)g=a.top;else if("above"==d||"near"==d){var i=Math.max(f.wrapper.clientHeight,this.doc.height),j=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>i)&&a.top>b.offsetHeight?g=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=i&&(g=a.bottom),h+b.offsetWidth>j&&(h=j-b.offsetWidth)}b.style.top=g+"px",b.style.left=b.style.right="","right"==e?(h=f.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(f.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px"),c&&Ic(this,h,g,h+b.offsetWidth,g+b.offsetHeight)},triggerOnKeyDown:Fb(lc),triggerOnKeyPress:Fb(oc),triggerOnKeyUp:nc,execCommand:function(a){if(ig.hasOwnProperty(a))return ig[a].call(null,this)},triggerElectric:Fb(function(a){_(this,a)}),findPosH:function(a,b,c,d){var e=1;b<0&&(e=-1,b=-b);for(var f=0,g=pa(this.doc,a);f<b&&(g=Qc(this.doc,g,e,c,d),!g.hitSide);++f);return g},moveH:Fb(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?Qc(c.doc,d.head,a,b,c.options.rtlMoveVisually):a<0?d.from():d.to()},Lg)}),deleteH:Fb(function(a,b){var c=this.doc.sel,d=this.doc;c.somethingSelected()?d.replaceSelection("",null,"+delete"):Pc(this,function(c){var e=Qc(d,c.head,a,b,!1);return a<0?{from:e,to:c.head}:{from:c.head,to:e}})}),findPosV:function(a,b,c,d){var e=1,f=d;b<0&&(e=-1,b=-b);for(var g=0,h=pa(this.doc,a);g<b;++g){var i=nb(this,h,"div");if(null==f?f=i.left:i.left=f,h=Rc(this,i,e,c),h.hitSide)break}return h},moveV:Fb(function(a,b){var c=this,d=this.doc,e=[],f=!c.display.shift&&!d.extend&&d.sel.somethingSelected();if(d.extendSelectionsBy(function(g){if(f)return a<0?g.from():g.to();var h=nb(c,g.head,"div");null!=g.goalColumn&&(h.left=g.goalColumn),e.push(h.left);var i=Rc(c,h,a,b);return"page"==b&&g==d.sel.primary()&&Kc(c,null,mb(c,i,"div").top-h.top),i},Lg),e.length)for(var g=0;g<d.sel.ranges.length;g++)d.sel.ranges[g].goalColumn=e[g]}),findWordAt:function(a){var b=this.doc,c=Yd(b,a.line).text,d=a.ch,e=a.ch;if(c){var f=this.getHelper(a,"wordChars");(a.xRel<0||e==c.length)&&d?--d:++e;for(var g=c.charAt(d),h=Me(g,f)?function(a){return Me(a,f)}:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!Me(a)};d>0&&h(c.charAt(d-1));)--d;for(;e<c.length&&h(c.charAt(e));)++e}return new la(Kf(a.line,d),Kf(a.line,e))},toggleOverwrite:function(a){null!=a&&a==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?Yg(this.display.cursorDiv,"CodeMirror-overwrite"):Xg(this.display.cursorDiv,"CodeMirror-overwrite"),Fg(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==Se()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:Fb(function(a,b){null==a&&null==b||Mc(this),null!=a&&(this.curOp.scrollLeft=a),null!=b&&(this.curOp.scrollTop=b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-Ua(this)-this.display.barHeight,width:a.scrollWidth-Ua(this)-this.display.barWidth,clientHeight:Wa(this),clientWidth:Va(this)}},scrollIntoView:Fb(function(a,b){if(null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:Kf(a,0),to:null}:null==a.from&&(a={from:a,to:null}),a.to||(a.to=a.from),a.margin=b||0,null!=a.from.line)Mc(this),this.curOp.scrollToPos=a;else{var c=Jc(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:Fb(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var d=this;null!=a&&(d.display.wrapper.style.width=c(a)),null!=b&&(d.display.wrapper.style.height=c(b)),d.options.lineWrapping&&gb(this);var e=d.display.viewFrom;d.doc.iter(e,d.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Kb(d,e,"widget");break}++e}),d.curOp.forceUpdate=!0,Fg(d,"refresh",this)}),operation:function(a){return Db(this,a)},refresh:Fb(function(){var a=this.display.cachedTextHeight;Jb(this),this.curOp.forceUpdate=!0,hb(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),k(this),(null==a||Math.abs(a-sb(this.display))>.5)&&g(this),Fg(this,"refresh",this)}),swapDoc:Fb(function(a){var b=this.doc;return b.cm=null,Xd(this,a),hb(this),this.display.input.reset(),this.scrollTo(a.scrollLeft,a.scrollTop),this.curOp.forceScroll=!0,xe(this,"swapDoc",this,b),b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Ce(a);var $f=a.defaults={},_f=a.optionHandlers={},ag=a.Init={toString:function(){return"CodeMirror.Init"}};Sc("value","",function(a,b){a.setValue(b)},!0),Sc("mode",null,function(a,b){a.doc.modeOption=b,c(a)},!0),Sc("indentUnit",2,c,!0),Sc("indentWithTabs",!1),Sc("smartIndent",!0),Sc("tabSize",4,function(a){d(a),hb(a),Jb(a)},!0),Sc("lineSeparator",null,function(a,b){if(a.doc.lineSep=b,b){var c=[],d=a.doc.first;a.doc.iter(function(a){for(var e=0;;){var f=a.text.indexOf(b,e);if(f==-1)break;e=f+b.length,c.push(Kf(d,f))}d++});for(var e=c.length-1;e>=0;e--)Fc(a.doc,b,c[e],Kf(c[e].line,c[e].ch+b.length))}}),Sc("specialChars",/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(b,c,d){b.state.specialChars=new RegExp(c.source+(c.test("\t")?"":"|\t"),"g"),d!=a.Init&&b.refresh()}),Sc("specialCharPlaceholder",Md,function(a){a.refresh()},!0),Sc("electricChars",!0),Sc("inputStyle",Cf?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),Sc("rtlMoveVisually",!Ef),Sc("wholeLineUpdateBefore",!0),Sc("theme","default",function(a){h(a),i(a)},!0),Sc("keyMap","default",function(b,c,d){var e=Uc(c),f=d!=a.Init&&Uc(d);f&&f.detach&&f.detach(b,e),e.attach&&e.attach(b,f||null)}),Sc("extraKeys",null),Sc("lineWrapping",!1,e,!0),Sc("gutters",[],function(a){n(a.options),i(a)},!0),Sc("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?y(a.display)+"px":"0",a.refresh()},!0),Sc("coverGutterNextToScrollbar",!1,function(a){s(a)},!0),Sc("scrollbarStyle","native",function(a){r(a),s(a),a.display.scrollbars.setScrollTop(a.doc.scrollTop),a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0),Sc("lineNumbers",!1,function(a){n(a.options),i(a)},!0),Sc("firstLineNumber",1,i,!0),Sc("lineNumberFormatter",function(a){return a},i,!0),Sc("showCursorWhenSelecting",!1,Ia,!0),Sc("resetSelectionOnContextMenu",!0),Sc("lineWiseCopyCut",!0),Sc("readOnly",!1,function(a,b){"nocursor"==b?(rc(a),a.display.input.blur(),a.display.disabled=!0):a.display.disabled=!1,a.display.input.readOnlyChanged(b)}),Sc("disableInput",!1,function(a,b){b||a.display.input.reset()},!0),Sc("dragDrop",!0,Rb),Sc("allowDropFileTypes",null),Sc("cursorBlinkRate",530),Sc("cursorScrollMargin",0),Sc("cursorHeight",1,Ia,!0),Sc("singleCursorHeightPerLine",!0,Ia,!0),Sc("workTime",100),Sc("workDelay",100),Sc("flattenSpans",!0,d,!0),Sc("addModeClass",!1,d,!0),Sc("pollInterval",100),Sc("undoDepth",200,function(a,b){a.doc.history.undoDepth=b}),Sc("historyEventDelay",1250),Sc("viewportMargin",10,function(a){a.refresh()},!0),Sc("maxHighlightLength",1e4,d,!0),Sc("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()}),Sc("tabindex",null,function(a,b){a.display.input.getField().tabIndex=b||""}),Sc("autofocus",null);var bg=a.modes={},cg=a.mimeModes={};a.defineMode=function(b,c){a.defaults.mode||"null"==b||(a.defaults.mode=b),arguments.length>2&&(c.dependencies=Array.prototype.slice.call(arguments,2)),bg[b]=c},a.defineMIME=function(a,b){cg[a]=b},a.resolveMode=function(b){if("string"==typeof b&&cg.hasOwnProperty(b))b=cg[b];else if(b&&"string"==typeof b.name&&cg.hasOwnProperty(b.name)){var c=cg[b.name];"string"==typeof c&&(c={name:c}),b=Je(c,b),b.name=c.name}else if("string"==typeof b&&/^[\w\-]+\/[\w\-]+\+xml$/.test(b))return a.resolveMode("application/xml");return"string"==typeof b?{name:b}:b||{name:"null"}},a.getMode=function(b,c){var c=a.resolveMode(c),d=bg[c.name];if(!d)return a.getMode(b,"text/plain");var e=d(b,c);if(dg.hasOwnProperty(c.name)){var f=dg[c.name];for(var g in f)f.hasOwnProperty(g)&&(e.hasOwnProperty(g)&&(e["_"+g]=e[g]),e[g]=f[g])}if(e.name=c.name,c.helperType&&(e.helperType=c.helperType),c.modeProps)for(var g in c.modeProps)e[g]=c.modeProps[g];return e},a.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}}),a.defineMIME("text/plain","null");var dg=a.modeExtensions={};a.extendMode=function(a,b){var c=dg.hasOwnProperty(a)?dg[a]:dg[a]={};Ke(b,c)},a.defineExtension=function(b,c){a.prototype[b]=c},a.defineDocExtension=function(a,b){wg.prototype[a]=b},a.defineOption=Sc;var eg=[];a.defineInitHook=function(a){eg.push(a)};var fg=a.helpers={};a.registerHelper=function(b,c,d){fg.hasOwnProperty(b)||(fg[b]=a[b]={_global:[]}),fg[b][c]=d},a.registerGlobalHelper=function(b,c,d,e){a.registerHelper(b,c,e),fg[b]._global.push({pred:d,val:e})};var gg=a.copyState=function(a,b){if(b===!0)return b;if(a.copyState)return a.copyState(b);var c={};for(var d in b){var e=b[d];e instanceof Array&&(e=e.concat([])),c[d]=e}return c},hg=a.startState=function(a,b,c){return!a.startState||a.startState(b,c)};a.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state,a=c.mode}return c||{mode:a,state:b}};var ig=a.commands={selectAll:function(a){a.setSelection(Kf(a.firstLine(),0),Kf(a.lastLine()),Jg)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Jg)},killLine:function(a){Pc(a,function(b){if(b.empty()){var c=Yd(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:Kf(b.head.line+1,0)}:{from:b.head,to:Kf(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){Pc(a,function(b){return{from:Kf(b.from().line,0),to:pa(a.doc,Kf(b.to().line+1,0))}})},delLineLeft:function(a){Pc(a,function(a){return{from:Kf(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){Pc(a,function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:0,top:c},"div");return{from:d,to:b.from()}})},delWrappedLineRight:function(a){Pc(a,function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:d}})},undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(Kf(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(Kf(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return ef(a,b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return gf(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){return ff(a,b.head.line)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div")},Lg)},goLineLeft:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:c},"div")},Lg)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=a.charCoords(b.head,"div").top+5,d=a.coordsChar({left:0,top:c},"div");return d.ch<a.getLine(d.line).search(/\S/)?gf(a,b.head):d},Lg)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;e<c.length;e++){var f=c[e].from(),g=Mg(a.getLine(f.line),f.ch,d);b.push(new Array(d-g%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){Db(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var e=b[d].head,f=Yd(a.doc,e.line).text;if(f)if(e.ch==f.length&&(e=new Kf(e.line,e.ch-1)),e.ch>0)e=new Kf(e.line,e.ch+1),a.replaceRange(f.charAt(e.ch-1)+f.charAt(e.ch-2),Kf(e.line,e.ch-2),e,"+transpose");else if(e.line>a.doc.first){var g=Yd(a.doc,e.line-1).text;g&&a.replaceRange(f.charAt(0)+a.doc.lineSeparator()+g.charAt(g.length-1),Kf(e.line-1,g.length-1),Kf(e.line,1),"+transpose")}c.push(new la(e,e))}a.setSelections(c)})},newlineAndIndent:function(a){Db(a,function(){for(var b=a.listSelections().length,c=0;c<b;c++){var d=a.listSelections()[c];a.replaceRange(a.doc.lineSeparator(),d.anchor,d.head,"+input"),a.indentLine(d.from().line+1,null,!0)}Lc(a)})},toggleOverwrite:function(a){a.toggleOverwrite()}},jg=a.keyMap={};jg.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},jg.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},jg.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},jg.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},jg.default=Df?jg.macDefault:jg.pcDefault,a.normalizeKeyMap=function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if(/^(name|fallthrough|(de|at)tach)$/.test(c))continue;if("..."==d){delete a[c];continue}for(var e=He(c.split(" "),Tc),f=0;f<e.length;f++){var g,h;f==e.length-1?(h=e.join(" "),g=d):(h=e.slice(0,f+1).join(" "),g="...");var i=b[h];if(i){if(i!=g)throw new Error("Inconsistent bindings for "+h)}else b[h]=g}delete a[c]}for(var j in b)a[j]=b[j];return a};var kg=a.lookupKey=function(a,b,c,d){b=Uc(b);var e=b.call?b.call(a,d):b[a];if(e===!1)return"nothing";if("..."===e)return"multi";if(null!=e&&c(e))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return kg(a,b.fallthrough,c,d);for(var f=0;f<b.fallthrough.length;f++){var g=kg(a,b.fallthrough[f],c,d);if(g)return g}}},lg=a.isModifierKey=function(a){var b="string"==typeof a?a:dh[a.keyCode];return"Ctrl"==b||"Alt"==b||"Shift"==b||"Mod"==b},mg=a.keyName=function(a,b){if(xf&&34==a.keyCode&&a.char)return!1;var c=dh[a.keyCode],d=c;return null!=d&&!a.altGraphKey&&(a.altKey&&"Alt"!=c&&(d="Alt-"+d),(Gf?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d),(Gf?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d="Cmd-"+d),!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+d),d)};a.fromTextArea=function(b,c){function d(){b.value=j.getValue()}if(c=c?Ke(c):{},c.value=b.value,!c.tabindex&&b.tabIndex&&(c.tabindex=b.tabIndex),
!c.placeholder&&b.placeholder&&(c.placeholder=b.placeholder),null==c.autofocus){var e=Se();c.autofocus=e==b||null!=b.getAttribute("autofocus")&&e==document.body}if(b.form&&(Cg(b.form,"submit",d),!c.leaveSubmitMethodAlone)){var f=b.form,g=f.submit;try{var h=f.submit=function(){d(),f.submit=g,f.submit(),f.submit=h}}catch(i){}}c.finishInit=function(a){a.save=d,a.getTextArea=function(){return b},a.toTextArea=function(){a.toTextArea=isNaN,d(),b.parentNode.removeChild(a.getWrapperElement()),b.style.display="",b.form&&(Eg(b.form,"submit",d),"function"==typeof b.form.submit&&(b.form.submit=g))}},b.style.display="none";var j=a(function(a){b.parentNode.insertBefore(a,b.nextSibling)},c);return j};var ng=a.StringStream=function(a,b){this.pos=this.start=0,this.string=a,this.tabSize=b||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};ng.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a)var c=b==a;else var c=b&&(a.test?a.test(b):a(b));if(c)return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){var b=this.string.indexOf(a,this.pos);if(b>-1)return this.pos=b,!0},backUp:function(a){this.pos-=a},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Mg(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Mg(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return Mg(this.string,null,this.tabSize)-(this.lineStart?Mg(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"!=typeof a){var d=this.string.slice(this.pos).match(a);return d&&d.index>0?null:(d&&b!==!1&&(this.pos+=d[0].length),d)}var e=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);if(e(f)==e(a))return b!==!1&&(this.pos+=a.length),!0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}}};var og=0,pg=a.TextMarker=function(a,b){this.lines=[],this.type=b,this.doc=a,this.id=++og};Ce(pg),pg.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;if(b&&ub(a),Be(this,"clear")){var c=this.find();c&&xe(this,"clear",c.from,c.to)}for(var d=null,e=null,f=0;f<this.lines.length;++f){var g=this.lines[f],h=_c(g.markedSpans,this);a&&!this.collapsed?Kb(a,ae(g),"text"):a&&(null!=h.to&&(e=ae(g)),null!=h.from&&(d=ae(g))),g.markedSpans=ad(g.markedSpans,h),null==h.from&&this.collapsed&&!vd(this.doc,g)&&a&&_d(g,sb(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(var f=0;f<this.lines.length;++f){var i=rd(this.lines[f]),j=l(i);j>a.display.maxLineLength&&(a.display.maxLine=i,a.display.maxLineLength=j,a.display.maxLineChanged=!0)}null!=d&&a&&this.collapsed&&Jb(a,d,e+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&Da(a.doc)),a&&xe(a,"markerCleared",a,this),b&&wb(a),this.parent&&this.parent.clear()}},pg.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,e=0;e<this.lines.length;++e){var f=this.lines[e],g=_c(f.markedSpans,this);if(null!=g.from&&(c=Kf(b?f:ae(f),g.from),a==-1))return c;if(null!=g.to&&(d=Kf(b?f:ae(f),g.to),1==a))return d}return c&&{from:c,to:d}},pg.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&Db(c,function(){var d=a.line,e=ae(a.line),f=_a(c,e);if(f&&(fb(f),c.curOp.selectionChanged=c.curOp.forceUpdate=!0),c.curOp.updateMaxLine=!0,!vd(b.doc,d)&&null!=b.height){var g=b.height;b.height=null;var h=yd(b)-g;h&&_d(d,d.height+h)}})},pg.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&Ge(b.maybeHiddenMarkers,this)!=-1||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)},pg.prototype.detachLine=function(a){if(this.lines.splice(Ge(this.lines,a),1),!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;(b.maybeHiddenMarkers||(b.maybeHiddenMarkers=[])).push(this)}};var og=0,qg=a.SharedTextMarker=function(a,b){this.markers=a,this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};Ce(qg),qg.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();xe(this,"clear")}},qg.prototype.find=function(a,b){return this.primary.find(a,b)};var rg=a.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.doc=a,this.node=b};Ce(rg),rg.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=ae(c);if(null!=d&&b){for(var e=0;e<b.length;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var f=yd(this);_d(c,Math.max(0,c.height-f)),a&&Db(a,function(){xd(a,c,-f),Kb(a,d,"widget")})}},rg.prototype.changed=function(){var a=this.height,b=this.doc.cm,c=this.line;this.height=null;var d=yd(this)-a;d&&(_d(c,c.height+d),b&&Db(b,function(){b.curOp.forceUpdate=!0,xd(b,c,d)}))};var sg=a.Line=function(a,b,c){this.text=a,jd(this,b),this.height=c?c(this):1};Ce(sg),sg.prototype.lineNo=function(){return ae(this)};var tg={},ug={};Ud.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;c<d;++c){var e=this.lines[c];this.height-=e.height,Bd(e),xe(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c,this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(var d=0;d<b.length;++d)b[d].parent=this},iterN:function(a,b,c){for(var d=a+b;a<d;++a)if(c(this.lines[a]))return!0}},Vd.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(a<e){var f=Math.min(b,e-a),g=d.height;if(d.removeInner(a,f),this.height-=g-d.height,e==f&&(this.children.splice(c--,1),d.parent=null),0==(b-=f))break;a=0}else a-=e}if(this.size-b<25&&(this.children.length>1||!(this.children[0]instanceof Ud))){var h=[];this.collapse(h),this.children=[new Ud(h)],this.children[0].parent=this}},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length,this.height+=c;for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(a<=f){if(e.insertInner(a,b,c),e.lines&&e.lines.length>50){for(;e.lines.length>50;){var g=e.lines.splice(e.lines.length-25,25),h=new Ud(g);e.height-=h.height,this.children.splice(d+1,0,h),h.parent=this}this.maybeSpill()}break}a-=f}},maybeSpill:function(){if(!(this.children.length<=10)){var a=this;do{var b=a.children.splice(a.children.length-5,5),c=new Vd(b);if(a.parent){a.size-=c.size,a.height-=c.height;var d=Ge(a.parent.children,a);a.parent.children.splice(d+1,0,c)}else{var e=new Vd(a.children);e.parent=a,a.children=[e,c],a=e}c.parent=a.parent}while(a.children.length>10);a.parent.maybeSpill()}},iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var e=this.children[d],f=e.chunkSize();if(a<f){var g=Math.min(b,f-a);if(e.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=f}}};var vg=0,wg=a.Doc=function(a,b,c,d){if(!(this instanceof wg))return new wg(a,b,c,d);null==c&&(c=0),Vd.call(this,[new Ud([new sg("",null)])]),this.first=c,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=c;var e=Kf(c,0);this.sel=na(e),this.history=new ee(null),this.id=++vg,this.modeOption=b,this.lineSep=d,this.extend=!1,"string"==typeof a&&(a=this.splitLines(a)),Td(this,{from:e,to:e,text:a}),Aa(this,na(e),Jg)};wg.prototype=Je(Vd.prototype,{constructor:wg,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=$d(this,this.first,this.first+this.size);return a===!1?b:b.join(a||this.lineSeparator())},setValue:Gb(function(a){var b=Kf(this.first,0),c=this.first+this.size-1;zc(this,{from:b,to:Kf(c,Yd(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0),Aa(this,na(b))}),replaceRange:function(a,b,c,d){b=pa(this,b),c=c?pa(this,c):b,Fc(this,a,b,c,d)},getRange:function(a,b,c){var d=Zd(this,pa(this,a),pa(this,b));return c===!1?d:d.join(c||this.lineSeparator())},getLine:function(a){var b=this.getLineHandle(a);return b&&b.text},getLineHandle:function(a){if(ra(this,a))return Yd(this,a)},getLineNumber:function(a){return ae(a)},getLineHandleVisualStart:function(a){return"number"==typeof a&&(a=Yd(this,a)),rd(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return pa(this,a)},getCursor:function(a){var b,c=this.sel.primary();return b=null==a||"head"==a?c.head:"anchor"==a?c.anchor:"end"==a||"to"==a||a===!1?c.to():c.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Gb(function(a,b,c){xa(this,pa(this,"number"==typeof a?Kf(a,b||0):a),null,c)}),setSelection:Gb(function(a,b,c){xa(this,pa(this,a),pa(this,b||a),c)}),extendSelection:Gb(function(a,b,c){ua(this,pa(this,a),b&&pa(this,b),c)}),extendSelections:Gb(function(a,b){va(this,sa(this,a),b)}),extendSelectionsBy:Gb(function(a,b){var c=He(this.sel.ranges,a);va(this,sa(this,c),b)}),setSelections:Gb(function(a,b,c){if(a.length){for(var d=0,e=[];d<a.length;d++)e[d]=new la(pa(this,a[d].anchor),pa(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex)),Aa(this,ma(e,b),c)}}),addSelection:Gb(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new la(pa(this,a),pa(this,b||a))),Aa(this,ma(d,d.length-1),c)}),getSelection:function(a){for(var b,c=this.sel.ranges,d=0;d<c.length;d++){var e=Zd(this,c[d].from(),c[d].to());b=b?b.concat(e):e}return a===!1?b:b.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var e=Zd(this,c[d].from(),c[d].to());a!==!1&&(e=e.join(a||this.lineSeparator())),b[d]=e}return b},replaceSelection:function(a,b,c){for(var d=[],e=0;e<this.sel.ranges.length;e++)d[e]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:Gb(function(a,b,c){for(var d=[],e=this.sel,f=0;f<e.ranges.length;f++){var g=e.ranges[f];d[f]={from:g.from(),to:g.to(),text:this.splitLines(a[f]),origin:c}}for(var h=b&&"end"!=b&&xc(this,d,b),f=d.length-1;f>=0;f--)zc(this,d[f]);h?za(this,h):this.cm&&Lc(this.cm)}),undo:Gb(function(){Bc(this,"undo")}),redo:Gb(function(){Bc(this,"redo")}),undoSelection:Gb(function(){Bc(this,"undo",!0)}),redoSelection:Gb(function(){Bc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(var d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new ee(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){return a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:pe(this.history.done),undone:pe(this.history.undone)}},setHistory:function(a){var b=this.history=new ee(this.history.maxGeneration);b.done=pe(a.done.slice(0),null,!0),b.undone=pe(a.undone.slice(0),null,!0)},addLineClass:Gb(function(a,b,c){return Oc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[d]){if(Te(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:Gb(function(a,b,c){return Oc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",e=a[d];if(!e)return!1;if(null==c)a[d]=null;else{var f=e.match(Te(c));if(!f)return!1;var g=f.index+f[0].length;a[d]=e.slice(0,f.index)+(f.index&&g!=e.length?" ":"")+e.slice(g)||null}return!0})}),addLineWidget:Gb(function(a,b,c){return zd(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return Vc(this,pa(this,a),pa(this,b),c,c&&c.type||"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&b.handleMouseEvents};return a=pa(this,a),Vc(this,a,a,c,"bookmark")},findMarksAt:function(a){a=pa(this,a);var b=[],c=Yd(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},findMarks:function(a,b,c){a=pa(this,a),b=pa(this,b);var d=[],e=a.line;return this.iter(a.line,b.line+1,function(f){var g=f.markedSpans;if(g)for(var h=0;h<g.length;h++){var i=g[h];null!=i.to&&e==a.line&&a.ch>i.to||null==i.from&&e!=a.line||null!=i.from&&e==b.line&&i.from>b.ch||c&&!c(i.marker)||d.push(i.marker.parent||i.marker)}++e}),d},getAllMarks:function(){var a=[];return this.iter(function(b){var c=b.markedSpans;if(c)for(var d=0;d<c.length;++d)null!=c[d].from&&a.push(c[d].marker)}),a},posFromIndex:function(a){var b,c=this.first;return this.iter(function(d){var e=d.text.length+1;return e>a?(b=a,!0):(a-=e,void++c)}),pa(this,Kf(c,b))},indexFromPos:function(a){a=pa(this,a);var b=a.ch;return a.line<this.first||a.ch<0?0:(this.iter(this.first,a.line,function(a){b+=a.text.length+1}),b)},copy:function(a){var b=new wg($d(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);return b.scrollTop=this.scrollTop,b.scrollLeft=this.scrollLeft,b.sel=this.sel,b.extend=!1,a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory())),b},linkedDoc:function(a){a||(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from),null!=a.to&&a.to<c&&(c=a.to);var d=new wg($d(this,b,c),a.mode||this.modeOption,b,this.lineSep);return a.sharedHist&&(d.history=this.history),(this.linked||(this.linked=[])).push({doc:d,sharedHist:a.sharedHist}),d.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}],Yc(d,Xc(this)),d},unlinkDoc:function(b){if(b instanceof a&&(b=b.doc),this.linked)for(var c=0;c<this.linked.length;++c){var d=this.linked[c];if(d.doc==b){this.linked.splice(c,1),b.unlinkDoc(this),Zc(Xc(this));break}}if(b.history==this.history){var e=[b.id];Wd(b,function(a){e.push(a.id)},!0),b.history=new ee(null),b.history.done=pe(this.history.done,e),b.history.undone=pe(this.history.undone,e)}},iterLinkedDocs:function(a){Wd(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?a.split(this.lineSep):_g(a)},lineSeparator:function(){return this.lineSep||"\n"}}),wg.prototype.eachLine=wg.prototype.iter;var xg="iter insert remove copy getEditor constructor".split(" ");for(var yg in wg.prototype)wg.prototype.hasOwnProperty(yg)&&Ge(xg,yg)<0&&(a.prototype[yg]=function(a){return function(){return a.apply(this.doc,arguments)}}(wg.prototype[yg]));Ce(wg);var zg=a.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},Ag=a.e_stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},Bg=a.e_stop=function(a){zg(a),Ag(a)},Cg=a.on=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,c);else{var d=a._handlers||(a._handlers={}),e=d[b]||(d[b]=[]);e.push(c)}},Dg=[],Eg=a.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else for(var d=we(a,b,!1),e=0;e<d.length;++e)if(d[e]==c){d.splice(e,1);break}},Fg=a.signal=function(a,b){var c=we(a,b,!0);if(c.length)for(var d=Array.prototype.slice.call(arguments,2),e=0;e<c.length;++e)c[e].apply(null,d)},Gg=null,Hg=30,Ig=a.Pass={toString:function(){return"CodeMirror.Pass"}},Jg={scroll:!1},Kg={origin:"*mouse"},Lg={origin:"+move"};De.prototype.set=function(a,b){clearTimeout(this.id),this.id=setTimeout(b,a)};var Mg=a.countColumn=function(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),b==-1&&(b=a.length));for(var f=d||0,g=e||0;;){var h=a.indexOf("\t",f);if(h<0||h>=b)return g+(b-f);g+=h-f,g+=c-g%c,f=h+1}},Ng=a.findColumn=function(a,b,c){for(var d=0,e=0;;){var f=a.indexOf("\t",d);f==-1&&(f=a.length);var g=f-d;if(f==a.length||e+g>=b)return d+Math.min(g,b-e);if(e+=f-d,e+=c-e%c,d=f+1,e>=b)return d}},Og=[""],Pg=function(a){a.select()};Bf?Pg=function(a){a.selectionStart=0,a.selectionEnd=a.value.length}:sf&&(Pg=function(a){try{a.select()}catch(b){}});var Qg,Rg=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Sg=a.isWordChar=function(a){return/\w/.test(a)||a>""&&(a.toUpperCase()!=a.toLowerCase()||Rg.test(a))},Tg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;Qg=document.createRange?function(a,b,c,d){var e=document.createRange();return e.setEnd(d||a,c),e.setStart(a,b),e}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(e){return d}return d.collapse(!0),d.moveEnd("character",c),d.moveStart("character",b),d};var Ug=a.contains=function(a,b){if(3==b.nodeType&&(b=b.parentNode),a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)};sf&&tf<11&&(Se=function(){try{return document.activeElement}catch(a){return document.body}});var Vg,Wg,Xg=a.rmClass=function(a,b){var c=a.className,d=Te(b).exec(c);if(d){var e=c.slice(d.index+d[0].length);a.className=c.slice(0,d.index)+(e?d[1]+e:"")}},Yg=a.addClass=function(a,b){var c=a.className;Te(b).test(c)||(a.className+=(c?" ":"")+b)},Zg=!1,$g=function(){if(sf&&tf<9)return!1;var a=Pe("div");return"draggable"in a||"dragDrop"in a}(),_g=a.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var e=a.indexOf("\n",b);e==-1&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");g!=-1?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},ah=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return!(!b||b.parentElement()!=a)&&0!=b.compareEndPoints("StartToEnd",b)},bh=function(){var a=Pe("div");return"oncopy"in a||(a.setAttribute("oncopy","return;"),"function"==typeof a.oncopy)}(),ch=null,dh=a.keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};!function(){for(var a=0;a<10;a++)dh[a+48]=dh[a+96]=String(a);for(var a=65;a<=90;a++)dh[a]=String.fromCharCode(a);for(var a=1;a<=12;a++)dh[a+111]=dh[a+63235]="F"+a}();var eh,fh=function(){function a(a){return a<=247?c.charAt(a):1424<=a&&a<=1524?"R":1536<=a&&a<=1773?d.charAt(a-1536):1774<=a&&a<=2220?"r":8192<=a&&a<=8203?"w":8204==a?"b":"L"}function b(a,b,c){this.level=a,this.from=b,this.to=c}var c="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",d="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,f=/[stwN]/,g=/[LRr]/,h=/[Lb1n]/,i=/[1n]/,j="L";return function(c){if(!e.test(c))return!1;for(var d,k=c.length,l=[],m=0;m<k;++m)l.push(d=a(c.charCodeAt(m)));for(var m=0,n=j;m<k;++m){var d=l[m];"m"==d?l[m]=n:n=d}for(var m=0,o=j;m<k;++m){var d=l[m];"1"==d&&"r"==o?l[m]="n":g.test(d)&&(o=d,"r"==d&&(l[m]="R"))}for(var m=1,n=l[0];m<k-1;++m){var d=l[m];"+"==d&&"1"==n&&"1"==l[m+1]?l[m]="1":","!=d||n!=l[m+1]||"1"!=n&&"n"!=n||(l[m]=n),n=d}for(var m=0;m<k;++m){var d=l[m];if(","==d)l[m]="N";else if("%"==d){for(var p=m+1;p<k&&"%"==l[p];++p);for(var q=m&&"!"==l[m-1]||p<k&&"1"==l[p]?"1":"N",r=m;r<p;++r)l[r]=q;m=p-1}}for(var m=0,o=j;m<k;++m){var d=l[m];"L"==o&&"1"==d?l[m]="L":g.test(d)&&(o=d)}for(var m=0;m<k;++m)if(f.test(l[m])){for(var p=m+1;p<k&&f.test(l[p]);++p);for(var s="L"==(m?l[m-1]:j),t="L"==(p<k?l[p]:j),q=s||t?"L":"R",r=m;r<p;++r)l[r]=q;m=p-1}for(var u,v=[],m=0;m<k;)if(h.test(l[m])){var w=m;for(++m;m<k&&h.test(l[m]);++m);v.push(new b(0,w,m))}else{var x=m,y=v.length;for(++m;m<k&&"L"!=l[m];++m);for(var r=x;r<m;)if(i.test(l[r])){x<r&&v.splice(y,0,new b(1,x,r));var z=r;for(++r;r<m&&i.test(l[r]);++r);v.splice(y,0,new b(2,z,r)),x=r}else++r;x<m&&v.splice(y,0,new b(1,x,m))}return 1==v[0].level&&(u=c.match(/^\s+/))&&(v[0].from=u[0].length,v.unshift(new b(0,0,u[0].length))),1==Fe(v).level&&(u=c.match(/\s+$/))&&(Fe(v).to-=u[0].length,v.push(new b(0,k-u[0].length,k))),2==v[0].level&&v.unshift(new b(1,v[0].to,v[0].to)),v[0].level!=Fe(v).level&&v.push(new b(v[0].level,k,k)),v}}();return a.version="5.13.2",a}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("cm")):"function"==typeof define&&define.amd?define("cm.matchbrackets",["cm"],a):a(CodeMirror)}(function(a){function b(a,b,d,e){var f=a.getLineHandle(b.line),i=b.ch-1,j=i>=0&&h[f.text.charAt(i)]||h[f.text.charAt(++i)];if(!j)return null;var k=">"==j.charAt(1)?1:-1;if(d&&k>0!=(i==b.ch))return null;var l=a.getTokenTypeAt(g(b.line,i+1)),m=c(a,g(b.line,i+(k>0?1:0)),k,l||null,e);return null==m?null:{from:g(b.line,i),to:m&&m.pos,match:m&&m.ch==j.charAt(0),forward:k>0}}function c(a,b,c,d,e){for(var f=e&&e.maxScanLineLength||1e4,i=e&&e.maxScanLines||1e3,j=[],k=e&&e.bracketRegex?e.bracketRegex:/[(){}[\]]/,l=c>0?Math.min(b.line+i,a.lastLine()+1):Math.max(a.firstLine()-1,b.line-i),m=b.line;m!=l;m+=c){var n=a.getLine(m);if(n){var o=c>0?0:n.length-1,p=c>0?n.length:-1;if(!(n.length>f))for(m==b.line&&(o=b.ch-(c<0?1:0));o!=p;o+=c){var q=n.charAt(o);if(k.test(q)&&(void 0===d||a.getTokenTypeAt(g(m,o+1))==d)){var r=h[q];if(">"==r.charAt(1)==c>0)j.push(q);else{if(!j.length)return{pos:g(m,o),ch:q};j.pop()}}}}}return m-c!=(c>0?a.lastLine():a.firstLine())&&null}function d(a,c,d){for(var e=a.state.matchBrackets.maxHighlightLineLength||1e3,h=[],i=a.listSelections(),j=0;j<i.length;j++){var k=i[j].empty()&&b(a,i[j].head,!1,d);if(k&&a.getLine(k.from.line).length<=e){var l=k.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";h.push(a.markText(k.from,g(k.from.line,k.from.ch+1),{className:l})),k.to&&a.getLine(k.to.line).length<=e&&h.push(a.markText(k.to,g(k.to.line,k.to.ch+1),{className:l}))}}if(h.length){f&&a.state.focused&&a.focus();var m=function(){a.operation(function(){for(var a=0;a<h.length;a++)h[a].clear()})};if(!c)return m;setTimeout(m,800)}}function e(a){a.operation(function(){i&&(i(),i=null),i=d(a,!1,a.state.matchBrackets)})}var f=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),g=a.Pos,h={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},i=null;a.defineOption("matchBrackets",!1,function(b,c,d){d&&d!=a.Init&&b.off("cursorActivity",e),c&&(b.state.matchBrackets="object"==typeof c?c:{},b.on("cursorActivity",e))}),a.defineExtension("matchBrackets",function(){d(this,!0)}),a.defineExtension("findMatchingBracket",function(a,c,d){return b(this,a,c,d)}),a.defineExtension("scanForBracket",function(a,b,d,e){return c(this,a,b,d,e)})}),define("general.components/codearea/qlikview-script-mode-constants",[],function(){var a=/[^\s\(\)\"\'\,\+\$\*\-\<\>\=\&\/\!\{\}\;\.\:\@\`\\[\]]/,b=/[\s\(\)\"\'\,\+\$\*\-\<\>\=\&\/\!\{\}\;\.\:\@\`\\[\]]/;return{REGEXP_WORD:a,REGEXP_WORD_SEPARATOR:b}}),define("general.components/codearea/qlikview-script-mode",["./qlikview-script-mode-constants","cm"],function(a,b){var c=a.REGEXP_WORD;return b.defineMode("qlikviewscript",function(a,b){function d(a,b,c){return b.tokenize=c,c(a,b)}function e(a,b){for(var c;null!=(c=a.next());)if(c==b)return!1;return!1}function f(a,b,c){return v=a,w=c,b}function g(a,e){if(a.eatSpace())return v="whitespace",null;v="any";var g=a.next();if(y.test(g))return"["===g?d(a,e,i("]")):d(a,e,i(g));if(/[\[\]{}\(\),;\:]/.test(g))return f(g);if("0"==g&&a.eat(/x/i))return a.eatWhile(/[\da-f]/i),f("number","number");if(/[\.\d]/.test(g))return a.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),!a.eol()&&(g=a.peek(),/[A-z]/.test(g))?"normaltext":"number";if("/"===g)return a.eat("*")?d(a,e,j):a.eat("/")?(a.skipToEnd(),"comment"):(a.eatWhile(x),"operator");if(x.test(g))return a.eatWhile(x),f(g,"operator");if("$"===g&&a.match(/^\(=/,!1,!0))return f("$");if("$"===g&&a.match(/^\((MUST_INCLUDE|INCLUDE)=/i,!1,!0))return f("$");if("$"===g&&a.match(/^\(/,!1,!0))return e.tokenize=l,f("$(");a.eatWhile(c);var h=a.current(),m=h.toLowerCase();return"rem"===m?d(a,e,k):b.service.isFunction(m)&&a.match(/(^\s*\()/,!1,!0)?f("function","keyword",m):b.service.isField(h)?f("field","field"):b.service.isVariable(h)?f("variable","variable"):b.service.isKeyword(m)?f("keyword","keyword"):"normaltext"}function h(a){return a.substr(1,a.length-2)}function i(a){return function(c,d){if(!e(c,a)&&(d.tokenize=g,"'"!==a)){var i=h(c.current(),a);if(b.service.isField(i))return f("field","field");if(b.service.isVariable(i))return f("variable","variable")}return f("string","string")}}function j(a,b){for(var c,d=!1;c=a.next();){if("/"==c&&d){b.tokenize=g;break}d="*"==c}return f("comment","comment")}function k(a,b){for(var c;c=a.next();)if(";"==c){b.tokenize=g;break}return f("comment","comment")}function l(a,c){v="any";var d=a.next();if(")"==d&&(c.tokenize=g),/[\(\),]/.test(d))return f(d);a.eatWhile(/[^(),]/);var e=a.current();return!/^\d/.test(e)&&b.service.isVariable(e)?f("variable","variable"):"normaltext"}function m(a,b,c,d){this.type=a,this.prev=b,this.info=c,this.pos=d}function n(a,b,c,d,e){var f=a.cc;for(z.state=a,z.stream=e,z.marked=null,z.cc=f;;){var g=f.length?f.pop():u;if(g(c,d)){for(;f.length&&f[f.length-1].lex;)f.pop()();return z.marked?z.marked:b}}}function o(){for(var a=arguments.length-1;a>=0;a--)z.cc.push(arguments[a])}function p(){return o.apply(null,arguments),!0}function q(a,b){var c=function(){var c=z.state;c.lexical=new m(a,c.lexical,b,z.stream.pos)};return c.lex=!0,c}function r(){var a=z.state;a.lexical.prev&&(a.lexical=a.lexical.prev)}function s(a){return function(b){return b==a?p():";"==a?o():p(arguments.callee)}}function t(a,b){return function c(d){return d==b?p():o(a,c)}}function u(a){return"function"==a?p(q("qvfunction",w),s("("),t(u,")"),r):"("===a?p(t(u,")")):"$("===a?p(s("("),t(u,")")):p()}var v,w,x=/[+\-*&=<>]/,y=/[\u0022\u0027\u0060\u00b4[]/,z={state:null,column:null,marked:null,cc:null};return r.lex=!0,{startState:function(){return{tokenize:g,lastType:null,cc:[],lexical:new m("block")}},token:function(a,b){var c=b.tokenize(a,b);return"comment"==v?c:(b.lastType=v,n(b,c,v,w,a))},lineComment:"//"}}),{REGEXP_WORD:c}}),define("general.components/codearea/codearea-function-tip",["qvangular","general.services/show-service/show-service"],function(a,b){"use strict";a.directive("qvCodeareaFunctionTip",function(){return{restrict:"A",require:"qvCodearea",link:function(c,d,e,f){var g,h,i=22,j=c.$watch(e.qvCodeareaFunctionTip,function(d){function e(){var a=f.codemirror.getCursor(),b=f.codemirror.getTokenAt(a,!0);if("comment"!==b.type){for(var c=0,d=b.state.lexical;d&&"qvfunction"!==d.type||0===c&&d.info&&b.string.toLowerCase()===d.info.toLowerCase();)d=d.prev,c++;return d}}function k(a,b){for(var c,d,e=f.codemirror.getCursor(),g={line:e.line,ch:e.ch};g.line>=0;){if(c=f.codemirror.getLine(g.line).toLowerCase(),d=c.substring(a.pos-b.length,a.pos),d===b){g.ch=a.pos-b.length;break}g.line-=1}var h=f.codemirror.charCoords(g);return h.top-=f.codemirror.defaultTextHeight()+i,h}function l(){var c=e(),f=c?c.info:void 0,h=f?d.service.getFunctionTip(f):void 0;a.$apply(function(){if(m(),h){var a=k(c,f);p(),g=b.show(d.view,{content:h,offset:a})}})}function m(){q(),g&&(g.destroy(),g=void 0)}function n(){clearTimeout(h),h=setTimeout(l,250)}function o(){m()}function p(){f.codemirror.addKeyMap(r)}function q(){f.codemirror.removeKeyMap(r)}var r={Esc:function(){c.$apply(function(){m()})}};d&&(f.codemirror.on("blur",o),f.codemirror.on("cursorActivity",n),c.$on("$destroy",function(){f.codemirror.off("blur",o),f.codemirror.off("cursorActivity",n),m()}),j())},!0)}}})}),define("text!general.components/autocomplete-view/autocomplete-view.ng.html",[],function(){return'<div class="qv-autocomplete-container">\n\t<ul class="codearea-autocomplete-hints">\n\t\t<li ng-repeat="item in state.hints track by item.text"\n\t\t\tqva-scroll-into-view="{ scroll: state.selectedHint == $index, scrollSelector: \'.codearea-autocomplete-hints\' }"\n\t\t\tclass="codearea-autocomplete-hint"\n\t\t\tng-class="{ \'codearea-autocomplete-hint-active\': state.selectedHint == $index }"\n\t\t\tng-mouseover="state.selectedHint = $index;"\n\t\t\tqva-activate="state.choose( $index )">\n\n\t\t\t<div class="codearea-autocomplete-hint-text">{{item.text}}</div>\n\t\t\t<div ng-repeat="type in item.types track by $index"\n\t\t\t\t class="codearea-autocomplete-hint-type {{type.id}}"\n\t\t\t\t q-translation="{{type.key}}"></div>\n\t\t</li>\n\t</ul>\n</div>\n';
}),define("general.components/autocomplete-view/autocomplete-view",["text!./autocomplete-view.ng.html","jquery"],function(a,b){"use strict";function c(a,b,c){var d=c.bottom+a.height<=b.height,e=d?c.bottom:c.top-a.height,f=Math.max(0,c.left+a.width-b.width),g=c.left-f;return{top:e,left:g}}function d(a,b){a.$$postDigest(function(){a.$$postDigest(b)})}return{scope:{state:"="},template:a,controller:["$scope","$element",function(a,e){function f(){var b={width:h.width(),height:h.height()},d=g[0].getBoundingClientRect(),e=a.state.cursorPos,f=c(d,b,e);g.css({left:f.left,top:f.top})}var g=e.find(".qv-autocomplete-container"),h=b(window);a.$watch("state.hints.length",function(){d(a,f)})}]}}),define("general.components/codearea/codearea-autocomplete",["jquery","qvangular","general.services/show-service/show-service","general.components/autocomplete-view/autocomplete-view","core.utils/resize","general.components/codearea/qlikview-script-mode-constants"],function(a,b,c,d,e,f){"use strict";function g(a){var b=a.getTokenAt(a.getCursor()).type;return"keyword"===b||"field"===b||"variable"===b}function h(a,b,c){if(a.somethingSelected()||g(a)&&!c||b.disabled)return null;var d=b.getHints(a),e=d.list;if(0===e.length)return null;e.length>n&&(e=e.slice(0,n));var f=a.cursorCoords(b.alignWithWord!==!1?d.from:null);return{from:d.from,to:d.to,hints:e,selectedHint:c?c.selectedHint:0,cursorPos:f}}function i(a,c){function d(){return 8}this.dialogHandle=null,this.dialogOptions={},this.state=null,this.options=c,this.cm=a,this.currentOptions=null,this.once=null,this.closingOnBlur=null,this.bound={cursorActivity:this.cursorActivity.bind(this),pick:this.pick.bind(this),close:this.close.bind(this),onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),choose:this.choose.bind(this),showHint:this.showHint.bind(this)};var e=this;this.ourMap={Up:function(){e.changeActive(e.state.selectedHint-1),b.$rootScope.$apply()},Down:function(){e.changeActive(e.state.selectedHint+1),b.$rootScope.$apply()},PageUp:function(){e.changeActive(e.state.selectedHint-d()),b.$rootScope.$apply()},PageDown:function(){e.changeActive(e.state.selectedHint+d()),b.$rootScope.$apply()},Home:function(){e.changeActive(0),b.$rootScope.$apply()},End:function(){e.changeActive(e.state.hints.length-1),b.$rootScope.$apply()},Enter:this.bound.pick,Tab:this.bound.pick,Esc:this.bound.close}}function j(a){return"["+a.replace(/\]/g,"]]")+"]"}function k(a,b){function c(a){"string"==typeof a&&(a={text:a});var b=a.text;if(h){if(!p[a.type]||!p[a.type].allowQuote)return;b=j(b)}b&&0===b.toLowerCase().indexOf(g)&&(e[b]||(e[b]={text:a.text,types:[],value:a.value||b},f.push(e[b])),p[a.type]&&e[b].types.push({id:a.type,key:p[a.type].translation}))}function d(a,b){var c=a.text.toLowerCase(),d=b.text.toLowerCase();return c===d?0:c>d?1:-1}var e={},f=[],g=a.toLowerCase(),h="["===a[0];return!h&&o.test(a)||/^\d+$/.test(a)?[]:(""!==a&&(b.forEach(c),f.sort(d)),1===f.length&&a===f[0].value&&(f=[]),f)}function l(a,b){var c=a.getCursor(),d=a.getTokenAt(c),e=k(d.string,b);return{list:e,from:{line:c.line,ch:d.start},to:{line:c.line,ch:d.end}}}var m=b.getService("$timeout"),n=100,o=f.REGEXP_WORD_SEPARATOR;i.prototype.cursorActivity=function(){m.cancel(this.once),this.once=null;var a=this.cm.getCursor();a.line!==this.startLine||this.cm.somethingSelected()?this.close():this.once=m(this.bound.showHint,70)},i.prototype.choose=function(a){this.changeActive(a),this.pick()},i.prototype.pick=function(){this.cm.replaceRange(this.state.hints[this.state.selectedHint].value,this.state.from,this.state.to),this.close(),b.$apply(b.$rootScope)},i.prototype.onBlur=function(){this.closingOnBlur=m(this.bound.close,300)},i.prototype.onFocus=function(){m.cancel(this.closingOnBlur),this.closingOnBlur=null},i.prototype.changeActive=function(a){this.state&&(a=Math.max(0,Math.min(a,this.state.hints.length-1)),this.state.selectedHint!==a&&(this.state.selectedHint=a))},i.prototype.close=function(){m.cancel(this.once),m.cancel(this.startTimeout),this.dialogHandle&&(this.dialogHandle.destroy(),this.dialogHandle=null,this.cm.removeKeyMap(this.ourMap),this.cm.off("cursorActivity",this.bound.cursorActivity),this.cm.off("blur",this.bound.onBlur),this.cm.off("focus",this.bound.onFocus),this.cm.off("scroll",this.bound.close),this.state=null,b.$apply(b.$rootScope))},i.prototype.open=function(){this.dialogHandle=c.show(this.options.view,this.dialogOptions),this.startLine=this.cm.getCursor().line,this.cm.addKeyMap(this.ourMap),this.cm.on("cursorActivity",this.bound.cursorActivity),this.cm.on("blur",this.bound.onBlur),this.cm.on("focus",this.bound.onFocus),this.cm.on("scroll",this.bound.close)},i.prototype.showHint=function(){var a=this.state;return this.state=h(this.cm,this.options,a),this.state?(this.state.choose=this.bound.choose,this.dialogOptions.state=this.state,void(a||this.open())):void(a&&this.close())},i.prototype.start=function(){this.state||(this.startTimeout&&m.cancel(this.startTimeout),this.startTimeout=m(this.bound.showHint,500))};var p={keyword:{translation:"Common.Keyword",allowQuote:!1},variable:{translation:"Common.Variable",allowQuote:!0},field:{translation:"Common.Field",allowQuote:!0},function:{translation:"Common.Function",allowQuote:!1}};return b.directive("qvCodeareaAutocomplete",function(){return{restrict:"A",require:"qvCodearea",link:function(b,c,f,g){var h=[37,38,39,40,33,34,27],j=b.$watch(f.qvCodeareaAutocomplete,function(c){function f(a){return l(a,c.service.getAutocompleteList())}function k(){n.start()}function m(b,c){a.inArray(c.which,h)===-1&&k()}if(c){c.view||(c.view=d),c.getHints||(c.getHints=f);var n=new i(g.codemirror,c),o=n.close.bind(n);g.codemirror.on("focus",k),g.codemirror.on("keyup",m),e.off("end",o),b.$on("$destroy",function(){g.codemirror.off("focus",k),g.codemirror.off("keyup",m),e.on("end",o),n.close()}),j()}},!0)}}}),{getCompletions:k}}),define("general.components/codearea/search-cursor",["cm"],function(a){function b(a,b,c,e){if(this.atOccurrence=!1,this.cm=a,null==e&&"string"==typeof b&&(e=!0),c=c?a.clipPos(c):d(0,0),this.pos={from:c,to:c},b||(b=""),"string"!=typeof b)b.global||(b=new RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(c,e){var f,g,h;if(c){for(b.lastIndex=0,f=a.getLine(e.line).slice(0,e.ch),g=b.exec(f),h=0;g;){h+=g.index+1,f=f.slice(h),b.lastIndex=0;var i=b.exec(f);if(!i)break;g=i}h--}else b.lastIndex=e.ch,f=a.getLine(e.line),g=b.exec(f),h=g&&g.index;if(g&&g[0])return{from:d(e.line,h),to:d(e.line,h+g[0].length),match:g}};else{e&&(b=b.toLowerCase());var f=e?function(a){return a.toLowerCase()}:function(a){return a},g=b.split("\n");1==g.length?b.length?this.matches=function(c,e){var g,h=f(a.getLine(e.line)),i=b.length;if(c?e.ch>=i&&(g=h.lastIndexOf(b,e.ch-i))!=-1:(g=h.indexOf(b,e.ch))!=-1)return{from:d(e.line,g),to:d(e.line,g+i)}}:this.matches=function(){}:this.matches=function(b,c){var e=c.line,h=b?g.length-1:0,i=g[h],j=f(a.getLine(e)),k=b?j.indexOf(i)+i.length:j.lastIndexOf(i);if(!(b?k>=c.ch||k!=i.length:k<=c.ch||k!=j.length-i.length))for(;;){if(b?!e:e==a.lineCount()-1)return;if(j=f(a.getLine(e+=b?-1:1)),i=g[b?--h:++h],!(h>0&&h<g.length-1)){var l=b?j.lastIndexOf(i):j.indexOf(i)+i.length;if(b?l!=j.length-i.length:l!=i.length)return;var m=d(c.line,k),n=d(e,l);return{from:b?n:m,to:b?m:n}}if(j!=i)return}}}}function c(a,c,d,e){return new b(a,c,d,e)}var d=a.Pos;return b.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function b(a){var b=d(a,0);return c.pos={from:b,to:b},c.atOccurrence=!1,!1}for(var c=this,e=this.cm.clipPos(a?this.pos.from:this.pos.to);;){if(this.pos=this.matches(a,e))return this.pos.from&&this.pos.to||window.console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(a){if(!e.line)return b(0);e=d(e.line-1,this.cm.getLine(e.line-1).length)}else{var f=this.cm.lineCount();if(e.line==f-1)return b(f);e=d(e.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(b){if(this.atOccurrence){var c=a.splitLines(b);this.cm.replaceRange(c,this.pos.from,this.pos.to),this.pos.to=d(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}},{getSearchCursor:c}}),define("general.utils/string-util",["jquery"],function(){"use strict";function a(a){var b=/^[^\\/:*?\"<>|\x00-\x1f]+$/;return"undefined"!=typeof a&&b.test(a)&&a.length>=x&&a.length<=y}function b(a){return!/[\\\*\?"\(\)<>\|' &\$\^\/+\-]+/.test(a)}function c(a){return/^(ftp|http|https):\/\/[^ "]+$/.test(a.toLowerCase())}function d(a){return/^.*:\/\//.test(a)?a:"http://"+a}function e(a,b){return 0===a.indexOf(b)}function f(a,b){return a.indexOf(b,a.length-b.length)!==-1}function g(a,b){return b||(b=""),a.length>0?a.reduce(function(a,c){return a+b+c}):""}function h(a){var b=a.replace(/.*\[|\]/gi,""),c=b.match(/"[^=]*"|[^;]+/g);return c}function i(a,b){var c,d=h(a);if(d)for(c=0;c<d.length;c++)if(d[c].toLowerCase().indexOf(b.toLowerCase())!==-1)return d[c].split("=")[1];return""}function j(a,b){function c(){return(a+"\\"+b).replace("\\\\","\\")}function d(){if("\\\\"===a.substring(0,2))return"\\"+c()}return d()||c()}function k(a){var b,c=h(a),d=[];return c&&c.forEach(function(a){b=a.split("="),b&&d.push({key:b[0],value:b.length>1?b[1]:""})}),d}function l(a){return"\\"===a.charAt(0)&&(a=a.substring(1)),"\\"===a.charAt(a.length-1)&&(a=a.slice(0,-1)),a}function m(a){return"\\"!==a.charAt(a.length-1)&&(a+="\\"),a}function n(a){var b;return"\\\\"===a.substring(0,2)?(b=l(a.substring(2)).split("\\"),b.pop(),"\\\\"+g(b,"\\")):(b=l(a).split("\\"),b.pop(),1===b.length?b[0]+"\\":g(b,"\\"))}function o(a){return a.replace(/[0-9]+/g,function(a){var b=a.length,c=""+b,d="000",e=d.substring(0,d.length-c.length)+c;return e+""+a})}function p(a,b){a.sort(function(a,c){return q(a[b],c[b])})}function q(a,b){var c=o(a).toLowerCase(),d=o(b).toLowerCase();return c.localeCompare(d)}function r(a,b){if(!a)throw new Error("Haystack is undefined.");if(!b)throw new Error("Needle is undefined.");return a.indexOf(b)!==-1}function s(a,b){if(a+="",b+="",!b)return 0;var c=b.match(/^\/(.*)\/([a-z]*)$/);if(!c){a=a.toLowerCase(),b=b.toLowerCase();for(var d=0,e=0,f=b.length,g=!1;!g;)e=a.indexOf(b,e),e>=0?(d++,e+=f):g=!0;return d}try{var h=new RegExp(c[1],c[2].indexOf("i")===-1?"":"i");return a.split(h).length-1}catch(i){return 0}}function t(a){return a.substring(a.lastIndexOf("\\")+1,a.length)}function u(a){return a.substring(0,a.lastIndexOf("\\")+1)}function v(a){var b=a.match(/.*\\(.*)\\.*$/);return b||(b=a.match(/^(.*)\\.*$/)),b?b[1]:null}function w(a){return!(!a||"false"===a)}var x=1,y=256,z={MIN_CONNECTION_NAME_LENGTH:x,MAX_CONNECTION_NAME_LENGTH:y,isValidConnectionName:a,isValidFieldName:b,isValidUrl:c,prefixHttpToUrl:d,endsWith:f,startsWith:e,goUpOneFolderLevel:n,removeSurroundingSlashes:l,arrayToString:g,formatDirectoryPathForEngine:m,sortSlightlyMoreNaturallyArray:p,sortSlightlyMoreNaturallySingle:q,_expandNumbersForNaturalSorting:o,getValueFromConnectionString:i,tokenizeConnectionString:k,contains:r,occurrencesRE:s,combinePath:j,fileNameFromPath:t,fileDirectoryFromPath:u,lastFolderFromPath:v,bool:w};return z}),define("general.components/codearea/search-util",["general.utils/string-util"],function(a){"use strict";function b(b,d){var e=a.occurrencesRE(b,d),f=e>=c?c:e;return f}var c=2e3;return{MAX_NBR_OF_HITS:c,getMaxNumberOfHits:b}}),define("general.components/codearea/searcher",["./search-cursor","./search-util"],function(a,b){"use strict";function c(){this.posFrom=this.posTo=this.query=null,this.marked=[]}function d(d){function e(b,c){return a.getSearchCursor(d,b,c)}function f(a){s.validQuery=!0;var b=!1;try{return b?new RegExp(b[1],b[2].indexOf("i")===-1?"":"i"):a}catch(c){return s.validQuery=!1,a}}function g(){d.operation(function(){var a;if(r.query){for(r.query=null,a=0;a<r.marked.length;++a)r.marked[a].clear();r.marked.length=0}}),i()}function h(a,c){var h=2e3,i=0;return g(),a?(d.operation(function(){r.query=f(a);var g={line:0,ch:0};if(!c&&p&&p.from()&&(g=p.from()),p=e(r.query,{line:0,ch:0}),i=b.getMaxNumberOfHits(d.getValue(),a),d.lineCount()<h)for(;p.findNext();)r.marked.push(d.markText(p.from(),p.to(),{className:"cm-searching"}));r.posFrom=r.posTo=d.getCursor(),p=e(r.query,g)}),k(),s.hits=i,i):(s.hits=0,0)}function i(){q&&q.clear()}function j(){i(),q=d.markText(p.from(),p.to(),{className:"cm-current"}),r.posFrom=p.from(),r.posTo=p.to()}function k(a,b){var c=p.find(a);return c?(j(),d.scrollIntoView(p.from(),d.getScrollInfo().clientHeight/2)):b&&b(),c}function l(){return p=e(r.query,{line:0,ch:0}),k(!1)}function m(){var a=d.lastLine(),b=d.getLine(a).length;return p=e(r.query,{line:a,ch:b}),k(!0)}function n(a,b,c){var d="string"==typeof r.query?b:p.pos.match[0].replace(r.query,b);p.replace(d),s.hits--;var e=p.find(a);e?j():c&&c()}function o(a,b){if(a){var c=0;return a=f(a),d.operation(function(){for(p=e(a);p.findNext();){c++;var d="string"==typeof r.query?b:p.pos.match[0].replace(r.query,b);p.replace(d)}}),s.hits=0,c}}var p,q,r=new c,s={doSearch:h,clearMarkedSearch:g,doFindNext:k,doFindFirst:l,doFindLast:m,doReplaceAll:o,doReplace:n,hits:0,validQuery:!0};return s}return{createSingleCodeareaSearcher:d}}),function(a){"object"==typeof exports&&"object"==typeof module?a(require("cm")):"function"==typeof define&&define.amd?define("cm.comment",["cm"],a):a(CodeMirror)}(function(a){"use strict";function b(a){var b=a.search(d);return b==-1?0:b}var c={},d=/[^\s\u00a0]/,e=a.Pos;a.commands.toggleComment=function(a){a.toggleComment()},a.defineExtension("toggleComment",function(a){a||(a=c);for(var b=this,d=1/0,f=this.listSelections(),g=null,h=f.length-1;h>=0;h--){var i=f[h].from(),j=f[h].to();i.line>=d||(j.line>=d&&(j=e(d,0)),d=i.line,null==g?b.uncomment(i,j,a)?g="un":(b.lineComment(i,j,a),g="line"):"un"==g?b.uncomment(i,j,a):b.lineComment(i,j,a))}}),a.defineExtension("lineComment",function(a,f,g){g||(g=c);var h=this,i=h.getModeAt(a),j=g.lineComment||i.lineComment;if(!j)return void((g.blockCommentStart||i.blockCommentStart)&&(g.fullLines=!0,h.blockComment(a,f,g)));var k=h.getLine(a.line);if(null!=k){var l=Math.min(0!=f.ch||f.line==a.line?f.line+1:f.line,h.lastLine()+1),m=null==g.padding?" ":g.padding,n=g.commentBlankLines||a.line==f.line;h.operation(function(){if(g.indent){for(var c=null,f=a.line;f<l;++f){var i=h.getLine(f),k=i.slice(0,b(i));(null==c||c.length>k.length)&&(c=k)}for(var f=a.line;f<l;++f){var i=h.getLine(f),o=c.length;(n||d.test(i))&&(i.slice(0,o)!=c&&(o=b(i)),h.replaceRange(c+j+m,e(f,0),e(f,o)))}}else for(var f=a.line;f<l;++f)(n||d.test(h.getLine(f)))&&h.replaceRange(j+m,e(f,0))})}}),a.defineExtension("blockComment",function(a,b,f){f||(f=c);var g=this,h=g.getModeAt(a),i=f.blockCommentStart||h.blockCommentStart,j=f.blockCommentEnd||h.blockCommentEnd;if(!i||!j)return void((f.lineComment||h.lineComment)&&0!=f.fullLines&&g.lineComment(a,b,f));var k=Math.min(b.line,g.lastLine());k!=a.line&&0==b.ch&&d.test(g.getLine(k))&&--k;var l=null==f.padding?" ":f.padding;a.line>k||g.operation(function(){if(0!=f.fullLines){var c=d.test(g.getLine(k));g.replaceRange(l+j,e(k)),g.replaceRange(i+l,e(a.line,0));var m=f.blockCommentLead||h.blockCommentLead;if(null!=m)for(var n=a.line+1;n<=k;++n)(n!=k||c)&&g.replaceRange(m+l,e(n,0))}else g.replaceRange(j,b),g.replaceRange(i,a)})}),a.defineExtension("uncomment",function(a,b,f){f||(f=c);var g,h=this,i=h.getModeAt(a),j=Math.min(0!=b.ch||b.line==a.line?b.line:b.line-1,h.lastLine()),k=Math.min(a.line,j),l=f.lineComment||i.lineComment,m=[],n=null==f.padding?" ":f.padding;a:if(l){for(var o=k;o<=j;++o){var p=h.getLine(o),q=p.indexOf(l);if(q>-1&&!/comment/.test(h.getTokenTypeAt(e(o,q+1)))&&(q=-1),q==-1&&(o!=j||o==k)&&d.test(p))break a;if(q>-1&&d.test(p.slice(0,q)))break a;m.push(p)}if(h.operation(function(){for(var a=k;a<=j;++a){var b=m[a-k],c=b.indexOf(l),d=c+l.length;c<0||(b.slice(d,d+n.length)==n&&(d+=n.length),g=!0,h.replaceRange("",e(a,c),e(a,d)))}}),g)return!0}var r=f.blockCommentStart||i.blockCommentStart,s=f.blockCommentEnd||i.blockCommentEnd;if(!r||!s)return!1;var t=f.blockCommentLead||i.blockCommentLead,u=h.getLine(k),v=j==k?u:h.getLine(j),w=u.indexOf(r),x=v.lastIndexOf(s);if(x==-1&&k!=j&&(v=h.getLine(--j),x=v.lastIndexOf(s)),w==-1||x==-1||!/comment/.test(h.getTokenTypeAt(e(k,w+1)))||!/comment/.test(h.getTokenTypeAt(e(j,x+1))))return!1;var y=u.lastIndexOf(r,a.ch),z=y==-1?-1:u.slice(0,a.ch).indexOf(s,y+r.length);if(y!=-1&&z!=-1&&z+s.length!=a.ch)return!1;z=v.indexOf(s,b.ch);var A=v.slice(b.ch).lastIndexOf(r,z-b.ch);return y=z==-1||A==-1?-1:b.ch+A,(z==-1||y==-1||y==b.ch)&&(h.operation(function(){h.replaceRange("",e(j,x-(n&&v.slice(x-n.length,x)==n?n.length:0)),e(j,x+s.length));var a=w+r.length;if(n&&u.slice(a,a+n.length)==n&&(a+=n.length),h.replaceRange("",e(k,w),e(k,a)),t)for(var b=k+1;b<=j;++b){var c=h.getLine(b),f=c.indexOf(t);if(f!=-1&&!d.test(c.slice(0,f))){var g=f+t.length;n&&c.slice(g,g+n.length)==n&&(g+=n.length),h.replaceRange("",e(b,f),e(b,g))}}}),!0)})}),define("general.components/codearea/codearea-exposed-context-api",["qvangular","cm","cm.comment"],function(a,b){var c="\r\n";a.directive("qvCodeareaExposedContextApi",["$parse","$timeout",function(a,d){return{require:["qvCodearea","qvCodeareaExposedContextApi"],link:function(b,c,d,e){var f=e[0],g=e[1];g._connectCodeArea(f);var h=a(d.qvCodeareaExposedContextApi);h.assign(b,g),b.$on("$destroy",function(){h.assign(b,void 0),g._connectCodeArea(void 0)})},controller:function(){function a(a){q=a}function e(){for(var a=q.codemirror.getTokenAt(q.codemirror.getCursor()),b=0,c=a.state.lexical;c&&"qvfunction"!==c.type||0===b&&c.info&&a.string.toLowerCase()===c.info.toLowerCase();)c=c.prev,b++;return!!c&&c.info}function f(){q.focus()}function g(){q.codemirror.undo()}function h(){q.codemirror.redo()}function i(){b.commands.toggleComment(q.codemirror),f()}function j(){q.codemirror.indentSelection("add"),f()}function k(){q.codemirror.indentSelection("subtract"),f()}function l(){return q.codemirror.options.readOnly}function m(a){var b=q.codemirror.getDoc().getSelection(),c=a(b);q.codemirror.replaceSelection(c)}function n(a){q.codemirror.setCursor(q.codemirror.getCursor("end"));var b=q.codemirror.getCursor().line,d=q.codemirror.getCursor().ch,e=q.codemirror.getLine(b).length;e>0&&(d===e?(q.codemirror.setCursor(b,e),q.codemirror.replaceSelection(c)):(q.codemirror.setCursor(q.codemirror.lineCount(),0),a=c+c+a)),q.codemirror.setCursor(q.codemirror.getCursor("end")),q.codemirror.replaceSelection(a),q.focus()}function o(a){q.codemirror.replaceSelection(a,"end"),q.focus()}function p(a){d(function(){var b=q.codemirror.lineCount();a<b?q.codemirror.setCursor(a-1,0):q.codemirror.setCursor(b-2,0),q.focus()})}var q,r={applyToSelection:m,focus:f,undo:g,redo:h,comment:i,indent:j,outdent:k,insertCode:n,replaceSelection:o,getFunctionNameUnderCursor:e,gotoLine:p,isReadOnly:l,_connectCodeArea:a,codemirror:void 0};return Object.defineProperty(r,"canUndo",{get:function(){return q&&q.codemirror&&q.codemirror.historySize().undo>0},enumerable:!0}),Object.defineProperty(r,"canRedo",{get:function(){return q&&q.codemirror&&q.codemirror.historySize().redo>0},enumerable:!0}),r}}}])}),define("general.components/codearea/codearea-exposed-touch-api",["jquery","qvangular"],function(a,b){function c(a,b){var c,d=a.length,e=b.length,f=Math.min(a.length,b.length);for(c=0;c<f&&a.charAt(c)===b.charAt(c);c++);if(c!==a.length||c!==b.length){var g,h,i=c;for(c=0;c<f&&(g=d-c-1,h=e-c-1,!(g<i||h<i))&&a.charAt(d-c-1)===b.charAt(e-c-1);c++);var j=d-c-1,k=e-c-1;return{start:i,targetRange:{from:i,to:j+1},sourceRange:{from:i,to:k+1}}}}b.directive("qvCodeareaExposedTouchApi",["$parse","$timeout",function(b,d){return{require:["qvCodearea","qvCodeareaExposedTouchApi"],link:function(a,c,e,f){var g=f[0],h=f[1];h._connectCodeArea(g);var i=b(e.qvCodeareaExposedTouchApi);i.assign(a,h),a.$on("$destroy",function(){i.assign(a,void 0),d(function(){h._connectCodeArea(void 0)})})},controller:["$scope",function(b){function e(a){o=a}function f(a,b){o.codemirror.scrollTo(b,a)}function g(a){o.setCustomFocusFn(a)}function h(c){function d(){var b=a(o.codemirror.getScrollerElement());c(b.scrollTop(),b.scrollLeft())}o.codemirror.on("scroll",d),b.$on("$destroy",function(){o.codemirror.off("scroll",d),c=void 0})}function i(a){function c(){var b={anchor:o.codemirror.indexFromPos(o.codemirror.getCursor("anchor")),head:o.codemirror.indexFromPos(o.codemirror.getCursor("head"))};a(o.codemirror.getValue(),b)}function d(){p||c()}c(),o.codemirror.on("change",d),b.$on("$destroy",function(){o.codemirror.off("change",d),a=void 0})}function j(c){b.$watch(function(){return String(o.codemirror.lineCount()).length},function(){d(function(){var b=a(o.codemirror.getGutterElement()).outerWidth(),d={top:0,left:b,bottom:0,right:0};c(d)})}),b.$on("$destroy",function(){c=void 0})}function k(a,b,c){o&&o.codemirror.setSelection(a,b,c)}function l(a,b){var d=o.codemirror.getValue("\n"),e=c(d,b);if(e){var f=b.substring(e.sourceRange.from,e.sourceRange.to),g=o.codemirror.posFromIndex(e.targetRange.from),h=o.codemirror.posFromIndex(e.targetRange.to);p=!0,o.codemirror.replaceRange(f,g,h),p=!1}}function m(){o.cssClasses["qv-codearea-disable-selection"]=!0}function n(){o.cssClasses["qv-codearea-disable-selection"]=!1}var o,p,q={_connectCodeArea:e,scrollTo:f,onScroll:h,setOverlayFocuser:g,replicateSelection:k,replicateContent:l,onNewContent:i,onResize:j,disableSelections:m,restoreSelections:n};return q}]}}]);var d={diff:c};return d}),define("general.components/codearea/codearea-exposed-search-api",["qvangular","general.components/codearea/searcher"],function(a,b){a.directive("qvCodeareaExposedSearchApi",["$parse",function(a){return{require:"qvCodearea",link:function(c,d,e,f){var g=a(e.qvCodeareaExposedSearchApi);g.assign(c,b.createSingleCodeareaSearcher(f.codemirror)),c.$on("$destroy",function(){g.assign(c,void 0)})},controller:function(){}}}])}),define("general.components/codearea/codearea-accelerators",["qvangular"],function(a){a.directive("qvCodeareaAccelerators",function(){return{require:["qvCodearea","qvCodeareaExposedContextApi"],link:function(b,c,d,e){function f(a,b){return a.keyCode===b.keyCode&&a.ctrlKey===(b.ctrlKey||!1)&&a.shiftKey===(b.shiftKey||!1)}function g(c,e){var g=b.$eval(d.qvCodeareaAccelerators);for(var h in g){var k=g[h];if(f(e,k)&&(!k.previous||f(j,k.previous)))return a.$apply(function(){k.fn(i)}),j={keyCode:void 0,ctrlKey:void 0,shiftKey:void 0},void e.preventDefault()}j={keyCode:e.keyCode,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}}var h=e[0],i=e[1],j={keyCode:void 0,ctrlKey:void 0,shiftKey:void 0};h.codemirror.on("keydown",g),b.$on("$destroy",function(){h.codemirror.off("keydown",g)})}}})}),define("general.components/codearea/codearea-breakpoints",["jquery","qvangular"],function(a,b){function c(b){var c=a("<div class='qv-codearea-breakpoint-marker' data-icon='debugger-breakpoint'></div>");return c.data("breakpoint",b),c[0]}function d(b,c){c.enabled?(a(b).addClass("qv-codearea-breakpoint-marker-enabled"),a(b).removeClass("qv-codearea-breakpoint-marker-disabled")):(a(b).addClass("qv-codearea-breakpoint-marker-disabled"),a(b).removeClass("qv-codearea-breakpoint-marker-enabled"))}b.directive("qvCodeareaBreakpoints",function(){return{require:"qvCodearea",link:function(e,f,g,h){function i(a){if(a){n=a;for(var b=h.codemirror.getDoc().lineCount(),e=0;e<b;e++){var f=e+1,g=a[f],i=h.codemirror.lineInfo(e).gutterMarkers,j=i&&i["qv-codearea-breakpoint"];g?(j||(j=c(g),h.codemirror.setGutterMarker(e,"qv-codearea-breakpoint",j)),d(j,g)):j&&h.codemirror.setGutterMarker(e,"qv-codearea-breakpoint",null)}}}function j(a){for(var b=h.codemirror.getDoc().lineCount(),c=a.from.line;c<b;c++){var d=h.codemirror.lineInfo(c).gutterMarkers;if(d&&d["qv-codearea-breakpoint"])return!0}return!1}function k(a){return a.text.length!==a.removed.length}function l(c,d){!h.supressChangeEvent&&k(d)&&j(d)&&b.$apply(function(){var b=n;for(var c in b)b.hasOwnProperty(c)&&delete b[c];for(var d=h.codemirror.getDoc().lineCount(),e=0;e<d;e++){var f=e+1,g=h.codemirror.lineInfo(e).gutterMarkers,i=g&&g["qv-codearea-breakpoint"];if(i){var j=a(i),k=j.data("breakpoint");k.lineNbr=f,b[f]=k}}})}function m(a,b){h.disabled||e.$apply(function(){var a=b+1,c=n[a];c?delete n[a]:n[a]={enabled:!0,lineNbr:a}})}var n;e.$watch(g.qvCodeareaBreakpoints,i),e.$watch(g.qvCodeareaBreakpoints,i,!0),h.codemirror.on("change",l),h.codemirror.on("gutterClick",m),e.$on("$destroy",function(){h.codemirror.off("change",l),h.codemirror.off("gutterClick",m)})}}})}),define("general.components/codearea/codearea-debug-location",["qvangular"],function(a){a.directive("qvCodeareaDebugLocation",function(){return{require:"qvCodearea",link:function(a,b,c,d){var e;a.$watch(c.qvCodeareaDebugLocation,function(a){if(a){var b=d.codemirror.lastLine()+1,c=a.lineNbr;c>b&&(c=b),e&&(d.codemirror.removeLineClass(e,"background","qv-codearea-current-debug-line"),d.codemirror.removeLineClass(e,"background","qv-codearea-current-debug-line-error")),c>0&&c<=b&&(d.codemirror.addLineClass(c-1,"background","qv-codearea-current-debug-line"),a.errorMessage&&d.codemirror.addLineClass(c-1,"background","qv-codearea-current-debug-line-error"),d.codemirror.scrollIntoView({line:c-1,ch:0},200),e=d.codemirror.getLineHandle(c-1))}},!0)}}})}),define("general.components/codearea/codearea-errors",["qvangular"],function(a){a.directive("qvCodeareaErrors",function(){return{require:"qvCodearea",link:function(a,b,c,d){var e=[];a.$watch(c.qvCodeareaErrors+".content",function(a){if(a){var b;for(b=0;b<e.length;b++)e[b].clear();for(b=0;b<a.length;b++){var c=a[b],f={line:c.qLineInTab,ch:c.qColInLine},g={line:c.qLineInTab,ch:c.qColInLine+c.qErrLen},h=d.codemirror.markText(f,g,{className:"cm-servererror"});e.push(h)}}},!0),a.$on("$destroy",function(){e=[]})}}})}),define("general.components/codearea/codemirror-change-limiter",[],function(){function a(a,b,c){var d=b.text.join("\n"),e=a.getRange(b.from,b.to).length,f=d.length,g=f-e,h=a.getValue().length;h>=c&&0===e?b.cancel():h+g>c&&(f=Math.max(0,c-h+e),d=d.substr(0,f),b.update(null,null,d.split("\n")))}return a}),define("general.components/codearea/codearea-limit",["qvangular","general.components/codearea/codemirror-change-limiter"],function(a,b){a.directive("qvCodeareaLimit",function(){return{require:"qvCodearea",link:function(a,c,d,e){function f(c,e){var f=a.$eval(d.qvCodeareaLimit);f&&f>0&&b(c,e,f)}e.codemirror.on("beforeChange",f),a.$on("$destroy",function(){e.codemirror.off("beforeChange",f)})}}})}),define("general.components/codearea/codearea-help-mode",["qvangular","jquery","core.utils/help-url","underscore"],function(a,b,c,d){function e(a,b){var c,d,e,f=[];for(d=0;d<a.length;d++)for(c=a[d].split(" "),e=0;e<c.length;e++)c[e].toLowerCase()===b.toLowerCase()&&(k||(k=c.length>1,l=e>0),f.push(a[d]));return f}function f(a,b,c){if(" "===c.string){var d=a.getTokenAt({ch:c.end+1,line:b.line});if(d.string.length>1)return d}return c}function g(a,b,c,d){var e=d?b.end-(b.string.length+1):b.end+2,f=a.getTokenAt({ch:e,line:c.line});return f}function h(a,b,c,d){var e={left:b.pageX,top:b.pageY},f=a.coordsChar(e,"window"),g=a.getTokenAt(f);return j(a,g,c,d)}function i(a,b,c,d){var e=a.getTokenAt(a.getCursor());return j(a,e,c,d)}function j(a,b,h,i){k=!1,l=!1,h=h?h:"scriptsyntax";var j,n,o,p=c.path+h+".",q=[];return("keyword"===b.type||"function"===b.type)&&(b=f(a,a.getCursor(),b),q=e(d.pluck(i.getAutocompleteList(),"text"),b.string),k?(n=g(a,b,a.getCursor(),l),o=e(q,n.string),j=o.length>0&&n.string!==b.string?l?n.string+"_"+b.string:b.string+"_"+n.string:b.string):j=b.string,p+=j,/firefox/.test(window.navigator.userAgent.toLocaleLowerCase())&&m&&m.close(),m=window.open(p,"__qlikviewhelp"),!0)}var k,l,m;a.directive("qvCodeareaHelpMode",["$parse",function(a){return{require:"qvCodearea",link:function(c,d,e,f){var g,j=c.$watch(e.qvCodeareaHelpModeOptions,function(k){function l(b){if(g){b.preventDefault();var d=h(f.codemirror,b,k.syntax,k.service);d&&c.$apply(function(){a(e.qvCodeareaHelpMode).assign(c,!1)})}}function m(a,b){72!==b.keyCode&&104!==b.keyCode||!b.ctrlKey||(b.preventDefault(),i(f.codemirror,b,k.syntax,k.service))}j(),c.$watch(e.qvCodeareaHelpMode,function(a){g=a,f.cssClasses["qv-codearea-help-mode"]=a}),b(d).on("click",l),f.codemirror.on("keydown",m),c.$on("$destroy",function(){b(d).off("click",l),f.codemirror.off("keydown",m)})})}}}])}),define("general.components/codearea/codearea-touch-overlay",["qvangular"],function(a){a.directive("qvCodeareaTouchOverlay",function(){return{restrict:"E",replace:!0,scope:{codeareaTouchApi:"=",enabled:"=",helpMode:"="},template:'<div class="qv-codearea-touch-overlay-container" ng-style="containerStyle"><textarea class="qv-codearea-touch-overlay" autocorrect="off" autocapitalize="off" autocomplete="off" spellcheck="false" wrap="off"></textarea></div>',link:function(a,b){function c(b){function c(a,b){var c=a.substring(0,b).split("\n"),d=c.length-1,e=c[c.length-1].length;return{line:d,ch:e}}function f(){var a=d.val(),e=d[0].selectionStart,f=d[0].selectionEnd,g=c(a,e),h=c(a,f);b.replicateSelection(g,h,{scroll:!1})}function g(){e||(d[0].selectionStart===i&&d[0].selectionEnd===j||(i=d[0].selectionStart,j=d[0].selectionEnd,f()),setTimeout(g,200))}var h=/iPad|iPhone|iPod/.test(navigator.userAgent);h&&d.css("padding-left","1px"),b.disableSelections(),a.$on("$destroy",function(){b.restoreSelections()}),b.onNewContent(function(a,b){d.val(a),d[0]===document.activeElement&&(d[0].selectionStart===b.anchor&&d[0].selectionEnd===b.head||(d[0].selectionStart=b.anchor,d[0].selectionEnd=b.head))}),b.setOverlayFocuser(function(){}),b.onResize(function(b){a.containerStyle.left=b.left}),b.onScroll(function(a,b){d.scrollTop(a),d.scrollLeft(b),document.activeElement===d[0]&&(""===d[0].style.textShadow?d[0].style.textShadow="rgba(0,0,0,0) 0 0 0":d[0].style.textShadow="")}),d.on("scroll",function(){b.scrollTo(d.scrollTop(),d.scrollLeft())}),d.on("input",function(a){var c=d.val();b.replicateContent(a,c)});var i,j;setTimeout(g,200)}var d=b.find("textarea"),e=!1;a.containerStyle={},a.$watch("helpMode",function(a){a?b.hide():b.show()});var f=a.$watch("codeareaTouchApi",function(a){a&&(c(a),f())});a.$on("$destroy",function(){e=!0,d=void 0})}}})}),define("general.components/codearea/codearea-block-large-pastes",["qvangular"],function(a){"use strict";a.directive("qvCodeareaBlockLargePastes",function(){var a=function(a){return""===a||isNaN(a)?1e6:a},b=function(a){return a.originalEvent.clipboardData?a.originalEvent.clipboardData.getData("text/plain").length:window.clipboardData.getData("Text").length};return{restrict:"A",controller:["$scope","$element","$attrs",function(c,d,e){d.find("textarea").on("paste",function(c){b(c)>a(e.qvCodeareaBlockLargePastes)&&c.preventDefault()}),c.$on("$destroy",function(){d.find("textarea").off("paste")})}]}})}),define("general.components/codearea/codearea-exposed-gutter-width",["jquery","qvangular"],function(a,b){b.directive("qvCodeareaExposedGutterWidth",["$parse","$timeout",function(b,c){return{require:"qvCodearea",link:function(d,e,f,g){var h=b(f.qvCodeareaExposedGutterWidth);d.$watch(function(){return String(g.codemirror.lineCount()).length},function(){var b=a(g.codemirror.getGutterElement()).outerWidth();h.assign(d,b),c(function(){var b=a(g.codemirror.getGutterElement()).outerWidth();h.assign(d,b)})}),d.$on("$destroy",function(){h.assign(d,void 0)})},controller:function(){}}}])}),define("general.components/codearea/codearea-composition-event",["qvangular","jquery","cm"],function(a,b,c){"use strict";function d(a){var b,c,d,e;for(c=a.getAllMarks(),d=0,e=c.length;d<e;d++)b=c[d],null!=b&&b.className===q&&b.clear();return!0}function e(a,e){function q(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");return b>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)}var s=e;a.options.enableCompositionMod=!0,j=function(){k&&k(),a.display.input.blur(),a.display.input.focus()},i=function(b){if(l=b.char,k&&k(),a.display.inCompositionMode){var c=a.getCursor(),d=a.display.compositionHead,e=a.charCoords(c).left-a.charCoords(d).left;
e+=void 0!==l?30:1,a.display.input.style.width=e+"px"}},f=function(){a.options.enableCompositionMod&&(p.disabled=!0,a.display.inCompositionMode=!0,n=s.offset(),a.display.inputDiv.classList.add("CodeMirror-input-wrapper"),a.display.inputDiv.classList.add("in-composition"),a.setOption("readOnly",!0),a.somethingSelected()&&a.replaceSelection(""),a.display.compositionHead=a.getCursor(),void 0===l?a.display.input.value="":" "===l&&g({data:" "}))},g=function(b){var c,d;if(a.options.enableCompositionMod&&a.display.inCompositionMode){var e=a.display.compositionHead;a.display.textMarkerInComposition?(c=a.display.textMarkerInComposition.find(),c&&(a.replaceRange(b.data,e,c.to),a.display.textMarkerInComposition.clear(),a.display.textMarkerInComposition=void 0)):a.replaceRange(b.data,e,e);var f=a.getCursor();d=a.charCoords(f).left-a.charCoords(e).left,void 0===l&&(d+=1),a.display.input.style.width=d+"px",a.display.textMarkerInComposition=a.markText(e,f,r),m()}},h=function(b){var e;a.options.enableCompositionMod&&a.display.inCompositionMode&&(q()?"\b"===l&&g(b):g(b),a.display.inCompositionMode=!1,a.display.compositionHead=void 0,null!=(e=a.display.textMarkerInComposition)&&e.clear(),a.display.textMarkerInComposition=void 0,a.setOption("readOnly",!1),a.display.inputDiv.classList.remove("in-composition"),a.display.inputDiv.classList.remove("CodeMirror-input-wrapper"),d(a),k=function(){p.disabled=!1,c.off(a.display.input,"input",k),a.display.inCompositionMode||(a.display.input.value="",a.display.input.style.width="0px",k=void 0)},c.on(a.display.input,"input",k))},m=function(){if(a.display.inCompositionMode){var b=a.charCoords(a.display.compositionHead).top-n.top;void 0!==l&&(b-=1),a.display.inputDiv.style.top=b+"px";var c=a.charCoords(a.display.compositionHead).left-n.left;a.display.inputDiv.style.left=c+"px"}},o=function(c){var d=b(a.display.scroller);d.scrollTop(d.scrollTop()-c.wheelDelta)}}var f,g,h,i,j,k,l,m,n,o,p,q="CodeMirror-text-in-composition",r={inclusiveLeft:!0,inclusiveRight:!0,className:q};a.directive("qvCodeareaCompositionEvent",function(){return{restrict:"A",require:"qvCodearea",link:function(a,d,l,n){e(n.codemirror,d);var q=n.codemirror.display.input,r=a.$watch(l.qvCodeareaAutocomplete,function(a){p=a,r()});r=a.$watch("codeareaTouchApi",function(a){a&&(a.onResize(function(){m()}),a.onScroll(function(){m()}),r())}),b(window).on("resize",m),c.on(n.codemirror,"mousedown",j),c.on(q,"keydown",i),c.on(q,"compositionstart",f),c.on(q,"compositionupdate",g),c.on(q,"compositionend",h),c.on(q,"mousedown",j),c.on(q,"mousewheel",o),a.$on("$destroy",function(){b(window).off("resize",m),c.off(n.codemirror,"mousedown",j),c.off(q,"compositionstart",f),c.off(q,"keydown",i),c.off(q,"compositionupdate",g),c.off(q,"compositionend",h),c.off(q,"input",k),c.off(q,"mousedown",j),c.off(q,"mousewheel",o)})}}})}),define("general.components/codearea/codearea",["jquery","qvangular","cm","cm.matchbrackets","general.components/codearea/qlikview-script-mode","general.components/codearea/codearea-function-tip","general.components/codearea/codearea-autocomplete","general.components/codearea/searcher","general.components/codearea/codearea-exposed-context-api","general.components/codearea/codearea-exposed-touch-api","general.components/codearea/codearea-exposed-search-api","general.components/codearea/codearea-accelerators","general.components/codearea/codearea-breakpoints","general.components/codearea/codearea-debug-location","general.components/codearea/codearea-errors","general.components/codearea/codearea-limit","general.components/codearea/codearea-help-mode","general.components/codearea/codearea-touch-overlay","general.components/codearea/codearea-block-large-pastes","general.components/codearea/codearea-exposed-gutter-width","general.components/codearea/codearea-composition-event"],function(){}),define("assets/client/dialogs/expression-dialog/expression-dialog",["jquery","core.models/app","core.utils/deferred","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","general.utils/expression-validator","general.components/info-popover/info-popover","general.services/show-service/show-service","text!assets/client/dialogs/expression-dialog/expression-dialog.ng.html","client.utils/state","assets/client/dialogs/expression-dialog/expression-dialog-controller","assets/client/dialogs/expression-dialog/expression-validation-info","general.utils/string-limits","client.services/validation","translator","general.components/function-tip-view/function-tip-view","touche","assets/client/dialogs/expression-dialog/expression-bnf","general.components/extract","general.components/codearea/codearea"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(a,b){b.preventDefault();var c=a.controller.previewText();a.codearea.contextApi.replaceSelection(c)}function t(a,b){a.functionTipOptions={service:b,view:p}}function u(b,c,d,e){function f(){h(),c.codearea.contextApi.focus()}function h(){a(document).off("keydown",f),i.remove()}if(d){var i=a("<div />").appendTo(document.body);d=d.replace(/\n/g," "),/^(input|textarea)$/i.test(document.activeElement.tagName)&&a.support.touch&&document.activeElement.blur(),i.showComponent(g,{alignTo:e.target,text:d,onClose:h,position:"top"}),a(document).one("keydown",{self:this},f)}}function v(a,b){var c={expression:a,validity:b.validity};return n.validateExpr(c,m)}function w(a){var f=a.app||b.current;return c.all({bnf:r.get(f),fields:d.getListLayout(f)}).then(function(b){if(x)return c.reject();var d=b.bnf,f=e.expand(b.fields),g=String(a.expr||"");g=g.replace(/^=+/,"");var i={title:a.title,allowEmpty:a.allowEmpty,labels:a.labels,expr:g,mode:a.mode,controller:k.create({fields:f,translator:o}),expressionBnfModel:d};x=!0;var j=h.show(y,i);return j.resultPromise})}var x=!1,y={template:i,controller:["$scope","$element",function(a,b){function c(b){a.info.setExpr(b),a.validity.expression||v(b,a)}a.stringLimits=m,a.controller=a.input.controller,a.codearea={content:a.input.expr};var d=new f.ExpressionValidator(null,a.input.mode);a.validity={expression:!0},a.enableTouchOverlay=q.utils.touch,a.insertTextHandler=s.bind(null,a),a.$watch("controller.selectedTable",function(b){a.controller.setTableFilter(b)}),a.info=l.create({validator:d,labels:a.input.labels}),a.info.setExpr(a.input.expr),a.showErrorMessage=u.bind(null,b,a),a.qlikviewReloadScriptMode={name:"qlikviewscript",service:a.input.expressionBnfModel},a.helpModeOptions={syntax:"chartsyntax",service:a.input.expressionBnfModel},a.autocompleteOptions={completeSingle:!1,service:a.input.expressionBnfModel},t(a,a.input.expressionBnfModel),a.cancel=function(){a.destroyComponent(),a.deferredResult.reject()},a.confirm=function(){var b=a.codearea.content,c=v(b,a);(c||a.input.allowEmpty&&""===b)&&(a.destroyComponent(),a.deferredResult.resolve(b))},j.StateChanged.bind(a.cancel),a.$watch("codearea.content",c),a.$on("$destroy",function(){x=!1,j.StateChanged.unbind(a.cancel)})}]};return{_insertTextHandler:s,show:w}}),define("client.property-panel/property-panel-directives",["jquery","angular","qvangular","core.utils/resize","client.property-panel/component-utils","general.utils/expression-validator","assets/client/dialogs/expression-dialog/expression-dialog","util","general.utils/dom-util","general.utils/support","jqueryui"],function(a,b,c,d,e,f,g,h,i,j){function k(a){return"ValueExpr"===a||"ValueExpression"===a?f.Modes.NumberOrExpression:f.Modes.Expression}return c.directive("ppSortable",[function(){return{scope:"=",link:function(b,c,d){b.$watch(d.ppSortable,function(d){if(d){var e;d=h.extend({},{handle:"[pp-sortable-handle]",start:function(a,b){b.item.data("startPos",b.item.index())},scrollSpeed:j.treatAsDesktop()?25:60,distance:j.treatAsDesktop()?10:0,items:"> :not(.locked)",cancel:".locked",update:function(a,c){var e=c.item.index(),f=c.item.data("startPos");b.$apply(function(){d.onMove(f,e)})},stop:function(){j.treatAsDesktop()||c.sortable("option","disabled",!0)}},d),e=c.closest(".pp-section"),e.length&&(d.containment=e),c.sortable(d),j.treatAsDesktop()||c.sortable("option","disabled",!0),b.enableTouchDrag=function(){var b;c.sortable("option","disabled",!1),b=a.Event(window.event,{type:"mousedown"}),b.which=1,b.pageX=window.event.pageX,b.pageY=window.event.pageY,b.target=window.event.target,a.ui.mouse.prototype._touchStart.call(c.data("ui-sortable"),b)}}})}}}]),c.directive("ppSlider",[function(){return{require:"?ngModel",link:function(a,d,e,f){a.$watch(e.ppSlider,function(e){e&&(e.range?(e=h.extend({},{min:0,max:10,step:1,values:f.$modelValue,stop:function(b,d){c.$apply(a,function(){f.$setViewValue(d.values)})}},e),a.$watchCollection(function(){return f.$modelValue},function(a,c){b.equals(a,c)||d.slider("values",a)})):(e=h.extend({},{min:0,max:10,step:1,value:f.$modelValue,stop:function(b,d){c.$apply(a,function(){f.$setViewValue(d.value)})}},e),a.$watch(function(){return f.$modelValue},function(a,b){a!==b&&d.slider("value",a)})),d.slider(e))})}}}]),c.directive("ppModelOnkeyup",function(){return{require:"ngModel",link:function(a,b,c,d){b.bind("keyup",function(c){27===c.which?(c.stopPropagation(),d.$rollbackViewValue(),b.trigger("blur")):13===c.which&&b.trigger("blur"),"function"==typeof a.onkeyup&&a.onkeyup(b)})}}}),c.directive("ppPlaceholder",function(){return{link:function(a,b,c){function d(){var d=a.$eval(c.ppPlaceholder),e=a.$eval(c.ppPlaceholderSuppressEqual);e&&"="===d[0]&&(d=d.substr(1)),b.attr("placeholder",d)}b.on("focus",function(){b.attr("placeholder","")}),b.on("blur",function(){d()}),a.$watch(c.ppPlaceholder,function(){d()})}}}),c.directive("ppAccordion",function(){return{template:"<div ng-transclude></div>",transclude:!0,scope:{ppAccordion:"=",definition:"=",args:"="},controller:["$scope","$element","$timeout",function(b,c,e){function f(){i=e(function(){c.accordion("refresh"),i=null})}function g(a){var c=-1;return a=a.split(".")[0],Object.keys(b.definition.items||{}).filter(function(a){var c=b.definition.items[a];return c.show!==!1}).forEach(function(b,d){if(b===a)return c=d,!1}),c}var h=b.args.cache,i=null;this.loadit=function(e){var i=h.get("accordion_path"),k=-1;i&&(k=g(i)),e===b.ppAccordion.length-1&&(c.accordion({header:".pp-section-header",active:k,heightStyle:"fill",animate:!!j.treatAsDesktop()&&"swing",activate:function(b,c){var d=a(c.newPanel).attr("x-path");h.put("accordion_path",d)}}),d.on("end",f))},b.$on("pp-open-path",function(a,b){var d=g(b);d>=0&&c.accordion("option","active",d)}),b.$on("$destroy",function(){i&&(e.cancel(i),i=null),d.off("end",f)})}]}}),c.directive("ppAccordionItem",function(){return{require:"^ppAccordion",link:function(a,b,c,d){d.loadit(a.$index)}}}),c.directive("ppInputValidator",["$parse",function(a){return{require:"ngModel",link:function(b,c,d,g){function i(a,b){if(void 0===a)return!1;switch(b){case"StringExpression":return 0===a.indexOf("=");case"ValueExpression":return"string"==typeof a&&0===a.indexOf("=");case"StringExpr":return 0===a.indexOf("=");case"ValueExpr":return!0;case"dimension":return!0;case"measure":return!0;default:return!1}}function j(c){d.ppValidationOnResult?a(d.ppValidationOnResult)(b,{isValid:c}):b.invalid=!c}function l(a){j(a.valid)}function m(a){"measure"===q?""===a?j(!0):o.validate(a):"dimension"===q?""===a?j(!1):(a&&"="!==a[0]&&(a="="+h.escapeField(a)),o.validate(a)):o.validate(a)}function n(a){i(a,q)?m(a):j(e.validateType(a,p,b.data,b.args))}var o=null,p=b.definition,q=d.expressionType;q&&(o=new f.ExpressionValidator(null,k(q)),o.Update.bind(l)),b.$on("datachanged",function(){n(g.$modelValue)}),b.$on("pp-revalidate",function(){n(g.$modelValue)}),b.$watch(function(){return g.$modelValue},function(a){n(a)}),b.$on("$destroy",function(){o&&o.Update.unbind(l)})}}}]),c.directive("ppExpressionEditor",["$parse","$timeout",function(c,d){return{link:function(e,f,j){function l(a,b){if(void 0===a)return!1;switch(b){case"StringExpression":return"object"==typeof a;case"ValueExpression":return"object"==typeof a;case"StringExpr":return"object"==typeof a&&0===a.qv.indexOf("=");case"ValueExpr":return"object"==typeof a;case"dimension":return!0;case"measure":return!0;default:return!1}}function m(a){return"'"!==a[0]&&"'"!==a[a.length-1]&&a.indexOf("(")===-1&&a.indexOf(")")===-1&&!h.isNumeric(a)}function n(){var a=c(j.ppExpressionEditor)(e),d=j.expressionType,f=k(d),i=a,n=l(a,d);"object"==typeof a&&("StringExpression"===d?a=a.qStringExpression.qExpr:"ValueExpression"===d?a=a.qValueExpression.qExpr:"StringExpr"===d?a=a.qv:"ValueExpr"===d&&(a=a.qv)),"dimension"===d&&a.length?"="!==a[0]&&(a="="+h.escapeField(a)):n||"StringExpr"!==d&&"StringExpression"!==d||("StringExpr"===d&&a.qv&&(a=a.qv),a&&m(a)&&(a="'"+a.replace(/'/g,"''")+"'")),g.show({expr:a,title:a?"Dimension.Expression.Dialog.Edit.Title":"Dimension.Expression.Dialog.Add.Title",allowEmpty:!0,mode:f}).then(function(a){"ValueExpression"===d&&a.length?a={qValueExpression:{qExpr:a}}:"StringExpression"===d&&a.length?a={qStringExpression:{qExpr:a}}:"ValueExpr"===d?a={qv:a}:"StringExpr"===d?("="!==a[0]&&(a="="+a),a={qv:a}):"dimension"===d&&a.length&&"="!==a[0]&&(a="="+a),j.ppExpressionEditorOnApply?c(j.ppExpressionEditorOnApply)(e,{value:a}):b.equals(i,a)||(e.value=a,e.change())},function(){})}f.on("keypress.pp-expression",function(b){13!==b.which&&32!==b.which||a(b.target).trigger("qv-activate")}),f.on("qv-activate.pp-expression",function(){var b,f=null;j.editorDisabled&&(f=c(j.editorDisabled)(e))||(i.isInput(document.activeElement)?(b=a(document.activeElement),b.on("blur.pp-expression",function(){d(function(){n()}),b.off("blur.pp-expression")}),b.blur()):n())}),e.$on("$destroy",function(){f.off(".pp-expression")})}}}]),c.componentDirective("includePpComponent",{definition:"=",data:"=",args:"="}),{}}),define("objects.views/charts/components/data-title/dropdown-data-title/dropdown-data-title",["qvangular","util","text!./dropdown-data-title.ng.html","text!./dropdown-data-title-popover.ng.html","general.services/show-service/show-service","client.soft-property-panel/default-explore-properties","assets/client/soft-property-panel/soft-property-handler","client.soft-property-panel/components/hypercube-data/hypercube-data-handler","client.utils/property-resolver","core.utils/deferred","core.models/generic-object","core.utils/resize","client.property-panel/property-panel-directives"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a){var b={left:"right",right:"left",top:"bottom",bottom:"top"};return b[a]}var n,o;n={template:d,controller:["$scope",function(a){a.position||(a.position="right");var b=new h(a.args.effectiveProperties,a.args.model.enigmaModel.app),c=new g(a.args.model);a.alternativeItemClicked=function(d,e,f){d.stopPropagation(),b.updateAlternativeItem(e,f,a.definition.items[f.ref].ref,a.definition.items[f.ref].alternativeRef,[{path:"qDef",property:"series"}]),c.saveSoftProperties(a.args.prevEffectiveProperties,a.args.effectiveProperties),a.closePopover()}}],scope:{alignTo:"=",position:"=",args:"=",definition:"=",item:"=",type:"=",closePopover:"=",qvaOutsideIgnoreFor:"=",options:"="}},a.directive("qvaDropdownDataTitle",[function(){return{replace:!0,template:c,restrict:"E",scope:{model:"=",type:"=",data:"=",disabled:"=",dock:"=",options:"="},link:function(c,d){var g=a.getService("$cacheFactory"),p=g.get("em-object"),q={},r=c.model,s=new h(null,r.enigmaModel.app);c.closePopover=function(){c.isMenuOpen&&(c.isMenuOpen=!1,o&&(o.destroy(),o=null))},c.openAlternativePopover=function(){if(!c.disabled){if(c.isMenuOpen)return void c.closePopover();c.isMenuOpen=!0,o=e.show(n,c.popoverSettings)}},c.refreshItems=function(){j.all({effectiveProperties:r.getEffectiveProperties(),properties:r.getProperties().then(function(a){return a.qExtendsId?k.get(a.qExtendsId).then(function(a){return a.getProperties()}):a}),layout:r.getLayout()}).then(function(a){if(!c.destroyed){q.args={layout:a.layout,model:r,properties:a.properties,effectiveProperties:b.extend(!0,{},a.effectiveProperties),prevEffectiveProperties:b.extend(!0,{},a.effectiveProperties),cache:p},q.data=a.effectiveProperties,q.definition=f.data,q.item=c.getAlternativeItem(q);var e=m(c.dock);c.popoverSettings={alignTo:d,position:e,args:q.args,item:q.item,type:q.type,definition:q.definition,closePopover:c.closePopover,qvaOutsideIgnoreFor:"dataTitle-"+c.$id,options:c.options},c.isMenuOpen&&c.closePopover()}})},c.refreshItems(),c.$on("datachanged",function(){c.refreshItems()}),c.getAlternativeItem=function(a){var b,d,e,f,g,h=c.data.index;if("dimension"===c.type?(g=a.data.qHyperCubeDef.qDimensions[h],f=s.getDimensionOptions,e="dimensions"):(g=a.data.qHyperCubeDef.qMeasures[h],f=s.getMeasureOptions,e="measures"),g)return b=i.getValue(a.data,a.definition.items[e].alternativeRef,[]),d=i.getValue(a.data,a.definition.items[e].ref,[]),b=f.call(s,d,b,g,a.args.layout,!0),{alternatives:b,index:isNaN(c.data.index)?0:c.data.index,data:g}},l.on("end",c.closePopover),c.$on("$destroy",function(){l.off("end",c.closePopover),c.destroyed=!0,c.closePopover()})}}}])}),define("text!objects.views/charts/components/data-title/breadcrumb-bar/breadcrumb-bar.ng.html",[],function(){return'<div class="qv-breadcrumb">\n\t<div class="qv-breadcrumb-container">\n\t\t<span class="icon-dimension-drilldown" title="{{drillDownTooltip}}"></span>\n\t\t\t<span class="crumb-item" ng-repeat="label in data.labels track by $index">\n\n\t\t\t\t<div ng-style="getCrumbStyle(hoverIndex === $index, $last, disabled)"\n\t\t\t\t\t ng-mouseover="hoverIndex = $index"\n\t\t\t\t\t ng-mouseout="hoverIndex = -1"\n\t\t\t\t\t ng-class="{\'crumb-button\' : !$last, \'disabled\' : disabled}"\n\t\t\t\t\t qva-activate="onClick($event, $index, $last)">\n\n\t\t\t\t\t<div ng-if="!$last" class="chart-data-title" >\n\t\t\t\t\t\t<span qva-direction x-dir-text="{{label}}" class="chart-data-title-label" title="{{label}}">{{label}}</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<qva-default-data-title ng-if="$last" data="data" model="model" disabled="disabled" type="type" direction="direction" dock="dock" options="options"></qva-default-data-title>\n\n\t\t\t\t\t<span class="lui-icon lui-icon--triangle-left" ng-if="!$last"></span>\n\t\t\t\t\t<span class="lui-icon lui-icon--triangle-right" ng-if="!$last"></span>\n\t\t\t\t</div>\n\t\t\t</span>\n\t</div>\n</div>'}),define("objects.views/charts/components/data-title/breadcrumb-bar/breadcrumb-bar",["qvangular","general.utils/color","text!./breadcrumb-bar.ng.html","objects.views/charts/chart-style-service","translator","touche"],function(a,b,c,d,e){function f(a){var c=g.getValue("",null,"backgroundColor","#ffffff"),d=b.toRGBA(c,0),e=b.toRGBA(c,1);a.faderStyle={background:"linear-gradient(to right, "+e+", "+d+")"},h.crumbColor={color:g.getValue("","axis.title","color")},h.crumbButtonColor={color:g.getValue("","axis.title","color","inactive")},h.crumbButtonHoverColor={color:g.getValue("","axis.title","color","active")},h.crumbButtonLockedColor={color:g.getValue("","axis.title","color","locked")},h.crumbButtonDisabledColor={color:g.getValue("","axis.title","color","disabled")}}var g=d.getInstance(),h={};a.directive("qvaBreadcrumbBar",function(){return{template:c,restrict:"E",replace:!0,scope:{data:"=",type:"=?",model:"=?",disabled:"=?",dock:"=?",columnIndex:"=",options:"="},link:function(a,b){a.hoverIndex=-1,a.height=b.width(),a.singleLabelMode=!0,a.onClick=function(b,c,d){a.disabled||d||(a.$emit("drill-up",a.columnIndex,c),b.stopImmediatePropagation())},a.drillDownTooltip=e.get("Tooltip.dimensions.drilldown"),a.getCrumbStyle=function(a,b,c){return c?h.crumbButtonDisabledColor:b?{}:a?h.crumbButtonHoverColor:h.crumbButtonColor},f(a)}}})}),define("objects.views/charts/components/data-title/data-title",["qvangular","translator","objects.views/charts/components/chart-component-angular","objects.views/charts/utils/canvas-renderer","objects.views/charts/components/data-title/data-title-handler","text!./data-title.ng.html","text!./default-data-title.ng.html","text!./simple-data-title.ng.html","objects.views/charts/chart-style-service","objects.views/charts/components/data-title/dropdown-data-title/dropdown-data-title","objects.views/charts/components/data-title/breadcrumb-bar/breadcrumb-bar"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){this.relevantSize=this._titleFontHeight+m+(a?this._extraSizeWhenAlternatives:0)}function k(){var a=n.layoutMap[this._layoutMode]||"medium";this._innerScope.fontStyle.font=n.getFont("","axis.title",a,null,null,this._innerScope.fontScale),this._titleFontHeight=d.getFontHeight(n.getFont("","axis.title",a,null,null))}var l,m=3,n=i.getInstance();return a.directive("qvaSimpleDataTitle",[function(){return{replace:!0,template:h,restrict:"E",scope:{label:"=",locked:"=?",options:"="},link:function(a){a.lockedTooltip=b.get("Tooltip.selections.locked")}}}]),a.directive("qvaDefaultDataTitle",[function(){return{replace:!0,template:g,restrict:"E",scope:{data:"=",type:"=?",model:"=?",disabled:"=?",dock:"=?",options:"="}}}]),l=c.extend("DataTitle",{init:function(){var a=Array.prototype.slice.call(arguments),b=this;a.push(f),this._super.apply(this,a),this._showTitle=!0,this._innerScope.fontScale=1,this._currentDrillDownLevels=[],this._innerScope.disabled=!0,this._selectionsEnabled=!0,this._innerScope.fontStyle={font:"12px 'QlikView Sans'"},k.call(this),this._extraSizeWhenAlternatives=10,this.drillUpRef=this._innerScope.$on("drill-up",function(a,c,d){b._currentDrillDownLevels[c]-d>0&&b.fire("drill-up",[a,c,b._currentDrillDownLevels[c]-d])})},calculateRelevantSize:function(){this._super();var a=this;k.call(this),void 0===a._hasAlternatives?e.modelHasAlternatives(this._innerScope.model,this._innerScope.type).then(function(b){a._innerScope&&j.call(a,b)}):j.call(this,this._hasAlternatives)},setShowStrategy:function(a){this._showTitle=["all","title"].contains(a)},setDock:function(a){this._super(a),"right"===a?this._innerScope.direction="top-to-bottom":"left"===a?this._innerScope.direction="bottom-to-top":this._innerScope.direction="",this._innerScope.dock=a},setType:function(a){this._innerScope.type=a},setModel:function(a){this._innerScope.model=a},setSelectionsEnabled:function(a){this._selectionsEnabled=a,this._changed=!0,this.invalidateProperties("dataTitle.setData")},setData:function(a){this._super(a),a&&(this._changed=!0,this.invalidateProperties("dataTitle.setData"))},_updateProperties:function(){if(this._super(),this._changed&&this._data){var a=this,b=this._data;b.qHyperCube&&this._innerScope.type&&(b=e.getTitleDataFromHyperCube(b.qHyperCube,this._innerScope.type,this._selectionsEnabled),this._currentDrillDownLevels=b.map(function(a){return a.currentDrillDownLevels})),e.modelHasAlternatives(this._innerScope.model,this._innerScope.type).then(function(c){a._innerScope&&(a._hasAlternatives=c,b.forEach(function(a){a.hasAlternatives=c}),a._innerScope.titles=b,a._innerScope.$broadcast("datachanged"),e.setWrapperStyle(a._innerScope.fontStyle,a._innerContainer,a._innerScope.direction,a._innerScope.titles))})}this._changed=!1},isVisible:function(){return this._super.apply(this,arguments)&&this._showTitle},on:function(){this._innerScope.disabled=!1},off:function(){this._innerScope.disabled=!0},paint:function(){this._innerScope.visible=!0,this._innerScope.fontScale=this.chartScale,k.call(this),this._innerScope.$digest(),e.setWrapperStyle(this._innerScope.fontStyle,this._innerContainer,this._innerScope.direction,this._innerScope.titles)},release:function(){this._super(),this.drillUpRef()},clear:function(){this._super(),this._innerScope.visible=!1}})}),define("objects.views/charts/components/grid",["./chart-component","objects.views/charts/utils/canvas-renderer","objects.views/charts/chart-style-service"],function(a,b,c){function d(a,b,c,d,e,f,g){var h,i,j,k;return g?(h=0,i=d,j=a,k=a):(h=a,i=a,j=0,k=e),{type:"line",opacity:c,strokeWidth:f,shape:{x1:h,x2:i,y1:j,y2:k},stroke:b}}function e(a,b){var c,e,f,g,h=a.ticks,j=a.minorTicks,k=h?h.length:0,l=j?j.length:0,m=a.getSpacingMode()===i.DENSE||a.isDimension,n=a.getSpacingMode()===i.SPARSE?2:1,o=b.rect.height,p=b.rect.width,q=b.style,r=[];if(a.getSpacingMode()===i.NONE||!h)return[];for(g=0;g<k;g+=1)e=h[g].position,c=h[g].value,f=h[g].opacity,g%n!==0&&0!==c||(0===c?r.push(d(e,q.zero.color,f,p,o,q.zero.width,a.isVertical())):r.push(d(e,q.major.color,f,p,o,q.major.width,a.isVertical())));if(m&&j)for(g=0;g<l;g+=1)e=j[g].position,r.push(d(e,q.minor.color,1,p,o,q.minor.width,a.isVertical()));return r}function f(a,b){var c="",d=a.layoutMap[b]||"medium",e={ticks:{major:{color:a.getValue(c,"axis.grid.major","color",d),width:a.getValue(c,"axis.grid.major","width",d)},minor:{color:a.getValue(c,"axis.grid.minor","color",d),width:a.getValue(c,"axis.grid.major","width",d)},zero:{color:a.getValue(c,"axis.grid.zero","color",d),width:a.getValue(c,"axis.grid.major","width",d)}}};return e}function g(){this.invalidateDisplay("Grid.setAxes")}var h,i={NONE:0,SPARSE:1,NORMAL:1,DENSE:3};return h=a.extend("Grid",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._styleService=c.getInstance(),this._style=f(this._styleService,this._layoutMode),this._renderer=new b(this.container),this._renderer.edgeBleed={top:1,left:1,bottom:0,right:0},this._$renderAreaWrap.addClass("qv-chart-component-grid"),this.renderers={gridlines:this._renderer}},afterRenderLines:function(){},setAxes:function(a,b){this._primaryHorizontalAxis!==a&&(this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",g,this),this._primaryHorizontalAxis=a,this._primaryHorizontalAxis&&this._primaryHorizontalAxis.listen("changed",g,this)),this._primaryVerticalAxis!==b&&(this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",g,this),this._primaryVerticalAxis=b,this._primaryVerticalAxis&&this._primaryVerticalAxis.listen("changed",g,this))},hasValidData:function(){return this._super()&&(this._primaryVerticalAxis||this._primaryHorizontalAxis)},paint:function(a,b){this._super(a,b);var c=[];return this._primaryVerticalAxis&&(this._primaryVerticalAxis.updateNow(),c=e(this._primaryVerticalAxis,{rect:this.rect,style:this._style.ticks})),this._primaryHorizontalAxis&&(this._primaryHorizontalAxis.updateNow(),c=c.concat(e(this._primaryHorizontalAxis,{rect:this.rect,style:this._style.ticks}))),this.afterRenderLines(c),this._renderer.shapes=c,this._renderer.render(),this},release:function(){this._super(),this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",null,this),this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",null,this)}})}),define("objects.views/charts/axis-chart",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.views/charts/components/ref-lines","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/data-title/data-title","objects.views/charts/components/grid"],function(a,b,c,d,e,f,g){"use strict";var h;return h=b.extend({init:function(b,h,i,j,k){var l=a.extend(!0,{components:{grid:{show:!0,dock:"center",showFlag:c.prototype.ShowFlags.XSMALL,clazz:g},refLines:{clazz:d},colorLegend:{show:!0,order:4,reductionOrder:1,dock:"right",relevantSize:126,showFlag:c.prototype.ShowFlags.MEDIUM},xAxis:{show:!0,order:1,dock:"bottom",relevantSize:120,showFlag:c.prototype.ShowFlags.XSMALL,clazz:e},yAxis:{show:!0,order:1,dock:"left",relevantSize:90,reductionOrder:2,showFlag:c.prototype.ShowFlags.XSMALL,clazz:e},yAxisTitle:{show:!0,order:1.1,dock:"left",relevantSize:30,reductionOrder:1,showFlag:c.prototype.ShowFlags.SMALL,clazz:f},xAxisTitle:{show:!0,order:1.1,dock:"bottom",relevantSize:30,reductionOrder:1,showFlag:c.prototype.ShowFlags.SMALL,clazz:f}}},i||{});this._super(b,h,l,j,k)},getVerticalComponents:function(){var a=this._super();return this._data&&this.components&&(this.components.xAxis&&this.components.xAxis.isVertical()&&this._data.xAxis&&(a.push({comp:this.components.xAxis,dock:this._data.xAxis.dock}),this.components.xAxisTitle&&a.push({comp:this.components.xAxisTitle,dock:this._data.xAxis.dock})),this.components.yAxis&&this.components.yAxis.isVertical()&&this._data.yAxis&&(a.push({comp:this.components.yAxis,dock:this._data.yAxis.dock}),this.components.yAxisTitle&&a.push({comp:this.components.yAxisTitle,dock:this._data.yAxis.dock}))),a},_updateData:function(a,b){this._super.apply(this,[].slice.call(arguments)),this.updateDataArea(a,b),this.updateAxis(a,b),this.updateGrid(a,b),this.updateRefLines(a,b),this.updateVerticalComponentsDock()},updateDataArea:function(a,b){var c,d;for(c in b.axes)d=b.axes[c],d.component.setDataIndices(d.dataIndices||[d.dataIndex||0]),d.component.setCurrentDataIndices(d.currentDataIndices||d.dataIndices||[d.dataIndex||0])},setAxisDataRange:function(a,b,c,d,e,f){var g,h;null!==d&&null!==e||null===d&&null===e?(g=c,h=b):null!==d&&d<=c?(g=d-f,h=b):null!==e&&e>=b?(g=c,h=e+f):(g=c,h=b),a.setDataRange(g,h),this.components.miniChart&&this.components.miniChart.components.measureAxis.setDataRange(g,h)},updateAxis:function(a,b){var c,d,e,f=b.axes,g=this.components.miniChart;for(c in b.axes)d=f[c],d.component.setTitle(d.title),d.component.setShowStrategy(d.data.show),d.component.setLabelMode(d.data.label),d.component.setLockedInfo&&d.component.setLockedInfo(a.qHyperCube.qDimensionInfo.map(function(a){return a.qLocked===!0})),d.component.setPlotMin&&!d.component.isDimension&&(e=this.getAxisOptions(d),d.component.setPlotMin(e.min),d.component.setPlotMax(e.max),d.component.setTickMultiplier(d.data.spacing),d.component.setLogScale(d.data.logarithmic),g&&(e=this.getAxisOptions(d),g.components.measureAxis.setPlotMin(e.min),g.components.measureAxis.setPlotMax(e.max))),d.component.isVertical()?d.component.setDock("far"===d.data.dock?"right":"left"):d.component.setDock("far"===d.data.dock?"top":"bottom");for(c in b.axisTitles)d=b.axisTitles[c],d.component.setShowStrategy(d.data.show),d.component.isVertical()?d.component.setDock("far"===d.data.dock?"right":"left"):d.component.setDock("far"===d.data.dock?"top":"bottom")},getAxisOptions:function(a){if(a&&a.data)return a.data.autoMinMax?{min:null,max:null}:{min:["min","minMax"].contains(a.data.minMax)?Number(a.data.min):null,max:["max","minMax"].contains(a.data.minMax)?Number(a.data.max):null}},updateGrid:function(a,b){if(this.components.grid){var c,d;if(a.gridLine&&"number"==typeof a.gridLine.spacing){d=a.gridLine.auto?2:a.gridLine.spacing;for(c in b.axes)b.axes[c].component.setSpacingMode&&b.axes[c].component.setSpacingMode(d)}}},updateRefLines:function(a,b){var c,d=b.refLineLabels,e=[],f=[];for(c in d)d[c].component&&(d[c].component.setData(d[c].data),d[c].component.setAxis(d[c].axis),d[c].component.setDock(d[c].axis.getOppositeDock()),f.push(d[c].axis),e.push(d[c].data));b.refLines&&b.refLines.component&&(b.refLines.component.setAxes(f),b.refLines.component.setData(e))}})}),define("objects.views/charts/components/scroll-area",["./chart-component","general.utils/shapes/rect","jquery","touche"],function(a,b,c,d){function e(a){var c,d,e,f=this,g=this.isVertical(),h={size:g?"height":"width",pos:g?"y":"x",coord:g?"pageY":"pageX"},i=new b(0,0,0,0),j=f._$renderAreaWrap.offset();i.x=j.left,i.y=j.top,i.width=f._$renderAreaWrap.width(),i.height=f._$renderAreaWrap.height(),this.fire("scrollStart"),e=f.scrollRect[h.size]*i[h.size],d=a.points[0][h.pos]-i[h.pos],this.yMirrorMode&&!g&&(d=i.width-d),c=d-e/2,f.scrollRect[h.pos]=Math.max(0,Math.min(i[h.size]*(1-f.scrollRect[h.size]),c))/i[h.size],f.setOffset(f.scrollRect[h.pos]*f.fullState.max)}function f(a){var c=this,d=this.isVertical(),e={size:d?"height":"width",pos:d?"y":"x",coord:d?"pageY":"pageX"},f=this.yMirrorMode&&!d,g=c._$renderAreaWrap.offset();this._containerRect=new b(0,0,0,0),this._containerRect.x=g.left,this._containerRect.y=g.top,this._containerRect.width=c._$renderAreaWrap.width(),this._containerRect.height=c._$renderAreaWrap.height(),c.scrollRect[e.size]=c.viewState.range/c.fullState.max,this._rp=a.points[0][e.pos]-this._containerRect[e.pos]-c.scrollRect[e.pos]*this._containerRect[e.size],f&&(this._rp=c.scrollRect[e.size]*this._containerRect[e.size]-this._rp),c.startScrollPos=c.scrollRect[e.pos],
c.startScrollSize=c.scrollRect[e.size],this._rp<0?(c.scrollRect[e.pos]=Math.max(0,c.scrollRect[e.pos]-this._rp/this._containerRect[e.size]),this._rp=0):this._rp/this._containerRect[e.size]>c.scrollRect[e.size]&&(c.scrollRect[e.pos]=Math.min(1,this._rp/this._containerRect[e.size])-c.scrollRect[e.size],this._rp=c.scrollRect[e.size]*this._containerRect[e.size]),this.fire("scrollStart")}function g(a){var b=this,c=this.options,d=this.isVertical(),e="function"==typeof c.onScroll?c.onScroll:function(){},f={size:d?"height":"width",pos:d?"y":"x",coord:d?"pageY":"pageX"},g=a.points[0][f.pos]-this._containerRect[f.pos],h=this.yMirrorMode&&!d,i=1e-5;if(this.allowResize){var j=(g-this._rp)/this._containerRect[f.size]-b.startScrollPos,k=b.startScrollPos,l=k+b.startScrollSize;/start/.test(a.relatedTarget.className)?(a.relatedTarget.classList.add("active"),k=Math.max(0,Math.min(l-i,k+j))):/end/.test(a.relatedTarget.className)?(a.relatedTarget.classList.add("active"),l=Math.min(1,Math.max(k+i,l+j))):(k=Math.min(1-b.startScrollSize,Math.max(0,k+j)),l=Math.min(1,Math.max(0+b.startScrollSize,l+j))),b.setViewRange((l-k)*b.fullState.max),h?b.setOffset((1-l)*b.fullState.max):b.setOffset(k*b.fullState.max),b.fire("offsetChanged")}else h&&(g=this.rect.width-g),b.scrollRect[f.pos]=Math.max(0,Math.min(this._containerRect[f.size]*(1-b.scrollRect[f.size]),g-this._rp))/this._containerRect[f.size],b.setOffset(b.scrollRect[f.pos]*b.fullState.max);e()}function h(){if(this.miniChart){var a=this;d(this.miniChart.container).tap({id:n,end:function(b,c){e.call(a,c)}}),d(this.miniChart.container).swipe({id:n,options:{radiusThreshold:1},start:function(b,c){f.call(a,c)},update:function(b,c){g.call(a,c)},end:function(a,b){b.relatedTarget.classList.remove("active")}})}}function i(){this.miniChart&&(c(this.miniChart.container).off(n),d(this.miniChart.container).off("*",n))}function j(){this.miniChart&&(this._internalUseMiniChart?this.miniChart.showComponent():this.miniChart.hideComponent())}function k(a,b){var c=this.viewState.min,d=this._relativeOffset?this._explicitOffset*(this.fullState.max-this.viewState.range):this._explicitOffset||0;this.viewState.min=Math.max(0,Math.min(d||0,(this.fullState.max||0)-(this.viewState.range||0))),this.viewState.min!==c&&(this.invalidateDisplay(a),b&&this.fire("offsetChanged"))}function l(a,b,c){var d=Array.isArray(a)?a:[a];d.forEach(function(a){c.forEach(function(b){a.style[b]=""}),a.className=b})}var m,n=".scrollarea";return m=a.extend("ScrollArea",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._useMiniChart=!0,this._internalUseMiniChart=!0,this._miniChartThreshold=.5,this._miniChartMinimunNumberOfBars=3,this.scrollRect=new b(0,0,0,0),this.fullState={min:0,max:20},this.viewState={min:0,range:10},this.allowResize=!1,this._$renderAreaWrap.addClass("qv-chart-component-scroll-area"),this.before=document.createElement("div"),this.bar=document.createElement("div"),this.after=document.createElement("div"),this.before.style.position="absolute",this.bar.style.position="absolute",this.after.style.position="absolute",this.before.style.backgroundColor=this.after.style.backgroundColor="rgba(0,0,0,0.1)",this.bar.style.marginTop="-1px",c(this.before).attr("tid","component.scrollArea.before"),c(this.bar).attr("tid","component.scrollArea.bar"),c(this.after).attr("tid","component.scrollArea.after"),c(this.bar).append('<div class="q-resize-handle q-resize-handle-start">'),c(this.bar).append('<div class="q-resize-handle q-resize-handle-end">'),this.container.appendChild(this.before),this.container.appendChild(this.after),this.container.appendChild(this.bar)},on:function(){var a=this;this._super(),d(this.container).tap({id:n,end:function(b,c){e.call(a,c)}}),d(this.container).swipe({id:n,options:{radiusThreshold:1},start:function(b,c){f.call(a,c)},update:function(b,c){g.call(a,c)},end:function(a,b){b.relatedTarget.classList.remove("active")}}),h.call(this),this._on&&this.allowResize&&this.container.classList.add("q-allow-resize")},off:function(){this._super(),c(this.container).off(n),d(this.container).off("*",n),i.call(this),this.container.classList.remove("q-allow-resize")},setAllowResize:function(a){this.allowResize=a,this.container.classList[a&&this._on?"add":"remove"]("q-allow-resize")},calculateRelevantSize:function(){var a,b=d.utils.touch?32:16;this.miniChart&&this._useMiniChart&&(this.miniChart.calculateRelevantSize(),a=this.miniChart.relevantSize,this._internalUseMiniChart=!0,j.apply(this)),this.relevantSize=this._internalUseMiniChart?a||16:b},insertAdjacentTo:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setRect:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setDock:function(a){this._super(a),this.miniChart&&this.miniChart.setDock(a)},getOffset:function(){return this.viewState.min},setRelativeOffset:function(a){this._explicitOffset=a,this._relativeOffset=!0,k.call(this,"ScrollArea.setOffset",!0)},setOffset:function(a){this._explicitOffset=a,this._relativeOffset=!1,k.call(this,"ScrollArea.setOffset")},setMiniChart:function(a){this.miniChart&&i.call(this),this.miniChart=a,this.miniChart.setDock(this.options.dock),j.apply(this),this._on&&h.call(this),this.invalidateDisplay("ScrollArea.setMiniChart")},setUseMiniChart:function(a){this._useMiniChart=a,this._internalUseMiniChart=a,j.apply(this),this.invalidateDisplay("ScrollArea.setUseMiniChart")},getUseMiniChart:function(){return this._useMiniChart},setViewRange:function(a){this.viewState.range=a,k.call(this,"ScrollArea.setViewRange",!0),this.invalidateDisplay("ScrollArea.setViewRange")},getViewRange:function(){return this.viewState.range},setSpaces:function(a){this._spaces=a},setDataRange:function(a){this.dataRange=a,this.invalidateDisplay("ScrollArea.setDataRange")},getDataRange:function(){return this.dataRange},setFullRange:function(a){this.fullState.max=a,k.apply(this,["ScrollArea.setFullRange",!0]),this.invalidateDisplay("ScrollArea.setFullRange")},getFullRange:function(){return this.fullState.max},isVisible:function(a){return this._super(a)&&(this.viewState.range<this.fullState.max||this.allowResize)},setOuterRect:function(a,b,c,d){this._super(a,b,c,d),this.miniChart&&this.miniChart.setOuterRect(a,b,c,d)},setLayoutToContainerRatios:function(a,b){this._super(a,b),this.miniChart&&this.miniChart.setLayoutToContainerRatios(a,b)},setContainerRect:function(a,b,c,d){this._super(a,b,c,d),this.miniChart&&this.miniChart.setContainerRect(a,b,c,d)},updateSize:function(){this._super(),this.miniChart&&this._internalUseMiniChart&&this.miniChart.isVisible()?(this.before.style.display="block",this.bar.style.border="1px solid rgba(0,0,0,0.4)",this.bar.style.backgroundColor="transparent",this.after.style.display="block",this.isVertical()?l.apply(this,[[this.before,this.bar,this.after],"qv-chart-scrollable-mini-chart-vertical",["width","left"]]):(l.apply(this,[[this.before,this.after],"qv-chart-scrollable-mini-chart-horizontal",["height","top"]]),l.apply(this,[this.bar,"qv-chart-scrollable-mini-chart-bar-horizontal",["height","top"]]))):(this.before.style.display="none",this.bar.style.backgroundColor="rgba(0,0,0,0.2)",this.bar.style.boxShadow="none",this.bar.style.border="none",this.after.style.display="none",this.isVertical()?l.apply(this,[this.bar,"qv-chart-scrollable-vertical",["width","left"]]):l.apply(this,[this.bar,"qv-chart-scrollable-horizontal",["height","top"]]))},paint:function(a,b){var d;this.container.style.display="block",this._super(a,b),this.scrollRect[this.isVertical()?"height":"width"]=this.viewState.range/this.fullState.max,this.scrollRect[this.isVertical()?"y":"x"]=this.viewState.min/this.fullState.max,this.yMirrorMode&&!this.isVertical()&&(this.scrollRect.x=1-this.scrollRect.width-this.scrollRect.x),d=this.scrollRect[this.isVertical()?"height":"width"]*this.rect[this.isVertical()?"height":"width"],d=d<1?1:d,d=100*d/this.rect[this.isVertical()?"height":"width"],this.isVertical()?(c(this.before).css({height:100*this.scrollRect.y+"%",top:"0%"}),c(this.bar).css({top:100*this.scrollRect.y+"%",height:d+"%"}),c(this.after).css({top:100*this.scrollRect.y+d+"%",height:100-(100*this.scrollRect.y+d)+"%"})):(c(this.before).css({width:100*this.scrollRect.x+"%",left:"0%"}),c(this.bar).css({left:100*this.scrollRect.x+"%",width:d+"%"}),c(this.after).css({left:100*this.scrollRect.x+d+"%",width:100-(100*this.scrollRect.x+d)+"%"}))},clear:function(){this.container.style.display="none"}}),Object.defineProperty(m.prototype,"className",{value:"ScrollArea"}),m}),define("objects.views/charts/utils/label-positioner",[],function(){"use strict";var a;return a={positionRectanglesAlongAxis:function(a,b,c,d,e){function f(){if(0===r)return s=[],void(t=0);var c,d,e,f,g;for(s=[[0]],c=1;c<r;c++)d=a[c].position,e=a[c].size,f=a[c-1].position,g=a[c-1].size,f+g/2+b>d-e/2?s[s.length-1].push(c):s.push([c]);t=s?s.length:0}function g(){0!==r&&(h(),i(),k(),u=j(),u||l())}function h(){var d,e,f,g,h;for(e=a[0].position,f=a[0].size,e=Math.max(c,e-f/2)+f/2,a[0].newPosition=e,d=1;d<r;d++)g=a[d-1].newPosition,h=a[d-1].size,e=a[d].position,f=a[d].size,e=Math.max(g+h/2+b,e-f/2)+f/2,a[d].newPosition=e}function i(){var e,f,g,h,i;if(f=a[r-1].newPosition,g=a[r-1].size,f+g/2>d)for(a[r-1].newPosition=d-g/2-c,e=r-2;e>=0;e--)h=a[e+1].newPosition,i=a[e+1].size,f=a[e].newPosition,g=a[e].size,f=Math.min(h-i/2-b,f+g/2)-g/2,a[e].newPosition=f}function j(){var d,e,f,g=a[0].newPosition,h=a[0].size;if(g-h/2<c)return!0;if(g-h/2>c)return!1;for(d=1;d<r;d++)if(e=a[d-1].newPosition,f=a[d-1].size,g=a[d].newPosition,h=a[d].size,e+f/2+b<g-h/2)return!1;return!0}function k(){var b,c,d,e,f,g,h,i,j,k,l,m;for(v&&v.length===t||(v=new Array(t)),b=0;b<t;b+=1)c=s[b],d=c[0],e=c[c.length-1],f=a[d],g=a[e],j=f.position,h=f.size,l=f.newPosition-h/2,k=g.position,i=g.size,m=g.newPosition+i/2,v[b]={firstPosition:j,lastPosition:k,minPosition:l,maxPosition:m}}function l(){m(0,c);for(var a=1;a<t;a++)m(a,v[a-1].maxPosition+b)}function m(a,b){var c=s[a];c.length%2===0?n(a,b):o(a,b)}function n(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,q;d=s[b],e=d[0],f=d[d.length/2-1],g=d[d.length/2],h=a[e],i=a[f],j=a[g],l=h.newPosition,k=h.size,n=(i.position+j.position)/2,o=(i.newPosition+j.newPosition)/2,q=o-n,m=l-q,p(b,l,m,k,c)}function o(b,c){var d,e,f,g,h,i,j,k,l,m,n;d=s[b],e=d[0],f=d[(d.length-1)/2],g=a[e],h=a[f],i=g.newPosition,j=g.size,k=h.position,l=h.newPosition,m=l-k,n=i-m,p(b,i,n,j,c)}function p(a,b,c,d,e){if(!(c>=b)){c=Math.max(e+d/2,c);var f=b-c;v[a].minPosition-=f,v[a].maxPosition-=f,q(a,f)}}function q(b,c){var d,e,f,g=s[b],h=g?g.length:0;for(d=0;d<h;d++)e=g[d],f=a[e],f.newPosition-=c}var r,s,t,u,v;r=a?a.length:0,e!==!0&&a.sort(function(a,b){return a.position>b.position?1:-1}),f(),g()}}}),define("objects.views/charts/components/ref-line-label-tooltip",["jquery","qvangular","core.utils/class","general.utils/support","general.utils/shapes/point"],function(a,b,c,d,e){"use strict";function f(a,b,c){var d=a.offset();return new e(b-d.left,c-d.top)}function g(a,b,c){var d=a.offset();return new e(d.left+b,d.top+c)}function h(a,b){var c=a.shapeWrapper.getBoundingRect();return c.pointInside(b.x,b.y)}function i(a,b){return a.filter(function(a){return h(a,b)})[0]}function j(a,b){return{positions:[g(b,a.x+a.width/2,a.y),g(b,a.x+a.width,a.y+a.height/2),g(b,a.x,a.y+a.height/2),g(b,a.x+a.width/2,a.y+a.height)],directions:["top","right","left","bottom"]}}function k(){l&&(l=null)}var l,m=a(document),n=c.extend("RefLineLabelTooltip",{init:function(b){this.$container=a(b)},setLabelObjects:function(a){this._labelObjects=a},on:function(){var a=this;this._onMouseMove=function(c){if(a._labelObjects){var d=f(a.$container,c.pageX,c.pageY),e=i(a._labelObjects,d);if(e&&l!==e){l=e;var g=j(e.shapeWrapper.getLocalBoundingRect(),a.$container);b.getService("qvChartTooltipService").open({content:[{rows:e.tooltipRows}],position:g.positions,direction:g.directions,hideCallback:k},7e3,500)}else e||(l=null,b.getService("qvChartTooltipService").close())}},this._onMouseLeave=function(){l=null,b.getService("qvChartTooltipService").close()},d.treatAsDesktop()&&(this.$container.on("mousemove",this._onMouseMove),this.$container.on("mouseleave",this._onMouseLeave),m.on("mouseleave.refLineLabels",this._onMouseLeave))},off:function(){this.$container.off("mousemove",this._onMouseMove),this.$container.off("mouseleave",this._onMouseLeave),m.off("mouseleave.refLineLabels",this._onMouseLeave)},release:function(){this.$container=null}});return n}),define("objects.views/charts/components/ref-line-labels",["./chart-component","client.utils/theme/theme","objects.views/charts/renderers/canvas-renderer","objects.views/charts/utils/label-positioner","objects.views/charts/chart-style-service","./ref-line-label-tooltip","objects.views/charts/shapes/text","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","util","client.utils/rtl/rtl-util"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a){a.forEach(function(a){a.size=a.shapeWrapper.measure().height})}function m(a){return b.palette[a]?b.palette[a]:a}function n(a,b,c,d,e,f){void 0===e&&(e=Number.MAX_VALUE),void 0===f&&(f=1);var h=new g;return h.setText(a),h.font=b,h.x=c,h.y=d,h.maxWidth=e,h.maxNumLines=f,h.align=O,h.baseline=P,h}function o(a){return void 0===a||""===a?0:(J.setText(a),J.measure().width)}function p(a){return void 0===a||""===a?0:(L.setText(a),L.measure())}function q(a){return void 0===a||""===a?0:(K.setText(a),K.measure().width)}function r(a,b){return void 0===a||""===a?{numLines:0,width:0,height:0,lines:[]}:(K.setText(a),K.maxWidth=b,K.measure())}function s(a,b){if(void 0===a||""===a)return{index:-1,width1:0,width2:0,width:0};void 0===b&&(b=o(a));for(var c,d,e,f,g=Number.MAX_VALUE,h=a.length,i=Math.floor(h/2),j=a.substring(0,i),k=0,l=!0,m=j.lastIndexOf(" ");m>-1&&l;)j=a.substring(0,m),c=o(j),d=b-c-M,e=Math.max(c,d),g<e?l=!1:(g=e,k++,f={index:m,width1:c,width2:d,width:g},m=j.lastIndexOf(" "));if(k>1)return f;for(m=a.indexOf(" ",i),k=0;m>-1;){if(j=a.substring(m+1),d=o(j),c=b-d-M,e=Math.max(c,d),g<e)return f;g=e,k++,f={index:m,width1:c,width2:d,width:g},m=a.indexOf(" ",m+1)}return void 0===f&&(f={index:-1,width1:0,width2:b,width:b}),f}function t(a,b){if(void 0===a||""===a)return{index1:-1,index2:-1,width1:0,width2:0,width3:0,width:0};void 0===b&&(b=o(a));for(var c,d,e,f,g,h,i,j=Number.MAX_VALUE,k=a.length,l=Math.floor(k/3),m=a.substring(0,l),n=0,p=!0,q=m.lastIndexOf(" ");q>-1&&p;)m=a.substring(0,q),c=a.substring(q+1),e=o(c),d=b-e-M,h=s(c,e),g=h.width,f=Math.max(d,g),j<f?p=!1:(j=f,n++,i={index1:q,index2:h.index,width1:d,width2:h.width1,width3:h.width2,width:j},q=m.lastIndexOf(" "));if(n>1)return i;for(q=a.indexOf(" ",l),n=0;q>-1;){if(c=a.substring(q+1),e=o(c),d=b-e-M,h=s(c,e),g=h.width,f=Math.max(d,g),j<f)return i;j=f,n++,i={index1:q,index2:h.index,width1:d,width2:h.width1,width3:h.width2,width:j},q=a.indexOf(" ",q+1)}return void 0===i&&(i={index1:-1,index2:-1,width1:0,width2:0,width3:b,width:b}),i}function u(a,b,c){var d;if(b<=c)return{minTextWidth:b,level:1};if(b<=2*c){if(d=s(a,b),d.width<=c)return{minTextWidth:d.width,level:0===d.width1?3:2};if(0===d.width1)return{minTextWidth:Math.ceil(d.width/2)+N,level:3}}return b<3*c?(d=t(a,b),0===d.width1&&0===d.width2?{minTextWidth:Math.min(Math.ceil(d.width/3)+Math.ceil(3*N/2),c),level:3}:{minTextWidth:Math.min(d.width,c),level:3}):{minTextWidth:c,level:3}}function v(a,b,c,d,e){a.size=b,a.size2=c,a.numLines=d,a.level=e}function w(a,b,c){if(!(a.size/2<=b||3===a.numLines||3===a.level)){var d,e;if(2===a.numLines)return d=t(a.text,a.singleLineTextWidth),e=r(a.text,d.width),void v(a,d.width,e.height,e.numLines,3);if(d=s(a.text,a.singleLineTextWidth),0!==d.width1){if(d.width/2<=b||c===!0)return e=r(a.text,d.width),void v(a,d.width,e.height,e.numLines,2);d=t(a.text,a.singleLineTextWidth),e=r(a.text,d.width),v(a,d.width,e.height,e.numLines,3)}}}function x(a,b,c){var d,e;a.position+a.size/2+c>b.position-b.size/2&&(a.size>b.size?(d=a,e=b.position-b.size/2-c-a.position):(d=b,e=b.position-(a.position+a.size/2+c)),w(d,e,!0))}function y(a,b,c,d,e,f){a.singleLineTextWidth=b,a.size=c,a.size2=d,a.numLines=e,a.level=f}function z(a){return String(void 0!==a.label?a.label:a)}function A(a,b){var c=a,d=j.escapeRegExp("+-"+(this.chartFormatter.getLocaleInfo().qDecimalSep||"")+(this.chartFormatter.getLocaleInfo().qThousandSep||"")),e=c.replace(new RegExp("[0-9e"+d+"]","g"),"");return e=e.length?c:this._axis.format(b)}function B(a){if(this._axis&&this._data){this._axis.updateFormatter();var b,c,d,e,f,g,h,i=this._data?this._data.length:0,j=[],l=this._axis.getPlotMin(),m=this._axis.getPlotMax(),n=[],o=[],p=-Number.MAX_VALUE,q=Number.MAX_VALUE,r=0,s=0;for(this._plotMinValueForRelevantSize=l,this._plotMaxValueForRelevantSize=m,this._maxLowerLabelIndex=void 0,this._minUpperLabelIndex=void 0,b=0;b<i;b+=1)this._data[b]&&this._data[b].show&&void 0!==this._data[b].refLineExpr&&(c=z(this._data[b].refLineExpr),d=a?this._currentProperties["value"+b]:this._data[b].refLineExpr.value,null===d||isNaN(d)||(e=this._data[b].label,f=A.apply(this,[c,d]),g=" "+k.lrm+"("+f+")"+k.lrm,d<l?(r++,o.push({label:e,value:f}),p<d&&(this._maxLowerLabelIndex=b)):d>m?(s++,n.push({label:e,value:f}),q>d&&(this._minUpperLabelIndex=b)):(h=e+g,j.push({index:b,text:h,value:d,text1:e,text2:g,tooltipRows:[{label:e,value:f}]}))));s>0&&j.push({index:-1,text:s<10?s.toString():"9+",value:"max",type:1,tooltipRows:n}),r>0&&j.push({index:-2,text:r<10?r.toString():"9+",value:"min",type:-1,tooltipRows:o}),this._labelObjects=j,this._numLabelObjects=this._labelObjects?this._labelObjects.length:0,this._labelsMaxWidthNeedToUpdate=!0,this._labelsMaxHeightNeedToUpdate=!0,this._labelObjectsNeedToUpdate=!1,this._numLowerLabels=r,this._numUpperLabels=s}}function C(){if(this._labelsMaxWidthNeedToUpdate){this._labelsMaxWidthNeedToUpdate=!1;var a,b,c,d=0;for(K.maxWidth=this._labelMaxWidthForYAxis,a=0;a<this._numLabelObjects;a++)if(void 0!==this._labelObjects[a].type?(b=p(this._labelObjects[a].text),c=F(b),d=Math.max(d,c+4)):d=Math.max(d,q(this._labelObjects[a].text)+4),d>=this._labelMaxWidthForYAxis)return void(this._labelsMaxWidth=this._labelMaxWidthForYAxis);this._labelsMaxWidth=d}}function D(a){return"max"===a?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.5+(this.isVertical()?-.1:.1):"min"===a?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.5+(this.isVertical()?.1:-.1):Math.floor(this._axis.getPositionOfValue(a))-.5}function E(){var a,b,c;for(a=0;a<this._numLabelObjects;a+=1)b=this._labelObjects[a],c=D.call(this,b.value),b.position=c}function F(a){return Math.sqrt(a.width*a.width+a.height*a.height)}function G(){if(this._labelsMaxHeightNeedToUpdate){this._labelsMaxHeightNeedToUpdate=!1,E.call(this);var a,b,c,e=0;for(this.calculateLabelWidths(this._labelObjects,this._componentWidth,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),d.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this._componentWidth,!0),a=0;a<this._numLabelObjects;a+=1)void 0!==this._labelObjects[a].type?(b=p(this._labelObjects[a].text),c=F(b),e=Math.max(e,c)):e=Math.max(e,this._labelObjects[a].size2);this._labelsMaxHeight=e}}function H(a,b){var c="",d=a.layoutMap[b]||"medium",e={label:{color:a.getValue(c,"referenceLine.label","color"),font:a.getFont(c,"referenceLine.label",d)},outOfBounds:{color:a.getValue(c,"referenceLine.outOfBounds","color"),backgroundColor:a.getValue(c,"referenceLine.outOfBounds","backgroundColor"),font:a.getFont(c,"referenceLine.outOfBounds",d)}};return J=n("",e.label.font,0,0,Number.MAX_VALUE,1),K=n("",e.label.font,0,0,Number.MAX_VALUE,3),L=n("",e.outOfBounds.font,0,0,Number.MAX_VALUE,1),M=o("m m")-o("mm"),N=o("m"),e}var I,J,K,L,M,N,O="center",P="bottom",Q=2;return I=a.extend("RefLineLabels",{init:function(){this._super.apply(this,arguments),this.renderer=new c(this.container),this._tooltips=new f(this.container),this._currentProperties={},this._transitionProperties={},this.renderers={labels:this.renderer},this._$renderAreaWrap.addClass("qv-chart-component-reflinelabels"),this._hasVisibleRefLines=!1,this._styleService=e.getInstance(),this._style=H(this._styleService),this._labelMargin=4,this._labelMaxWidthForYAxis=70,this._labelMaxWidthForXAxis=100,this._labelMaxHeightForXAxis=50,this._verticaLabelGap=4,this._horizontalLabelGap=6,this._boundaryGap=4},calculateRelevantSize:function(){if(this._super(),B.call(this),this.isVertical())C.call(this),this.relevantSize=this._labelsMaxWidth+this._labelMargin;else{var a=this.rect.width?this.rect.width:this._axis._plotSize;this._componentWidth!==a&&(this._componentWidth=a,this._labelsMaxHeightNeedToUpdate=!0),G.call(this),this.relevantSize=this._labelsMaxHeight+this._labelMargin}},calculatePreliminaryRelevantSize:function(){this.relevantSize=this.isVertical()?this._labelMaxWidthForYAxis:this._labelMaxHeightForXAxis},setData:function(){this._super.apply(this,arguments),this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues(),this._labelObjectsNeedToUpdate=!0},setAxis:function(a){var b=this;this._axis=a,this._axis.listen("changed",function(){this.invalidateDisplay()},b),this._labelObjectsNeedToUpdate=!0},isVisible:function(){var a=this._super.apply(this,arguments);return!!a&&(this._axis&&(this._plotMinValue===this._axis.getPlotMin()&&this._plotMaxValue===this._axis.getPlotMax()||(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues())),this._hasVisibleRefLines)},calculateLabelWidths:function(a,b,c,d,e){var f,g,h,i,j,k,l,m=a?a.length:0;if(0!==m){for(f=0;f<m;f++)h=a[f],i=h.text,void 0===i||""===i?y(h,0,0,0,0,0,void 0):(j=o(i),k=u(i,j,e),l=r(i,k.minTextWidth),y(h,j,k.minTextWidth,l.height,l.numLines,k.level,l));for(a.sort(function(a,b){return a.position>b.position?1:-1}),h=a[m-1],void 0!==h.text&&""!==h.text&&w(h,b-h.position-d),h=a[0],void 0!==h.text&&""!==h.text&&w(h,h.position-d),f=0;f<m-1;f++)if(void 0!==a[f].text&&""!==a[f].text&&void 0!==a[f+1].text&&""!==a[f+1].text)for(g=0;g<4;g++)x(a[f],a[f+1],c)}},checkIfHavingVisibleRefLines:function(){if(!this._data||0===this._data.length||!this._axis)return!1;var a;for(a=0;a<this._data.length;a+=1)if(this._data[a]&&this._data[a].show&&void 0!==this._data[a].refLineExpr){if("value"in this._data[a].refLineExpr&&(null===this._data[a].refLineExpr.value||isNaN(this._data[a].refLineExpr.value)))continue;return!0}return!1},updateLocalPlotMaxMinValues:function(){this._axis&&(this._plotMinValue=this._axis.getPlotMin(),this._plotMaxValue=this._axis.getPlotMax())},setLabelMargin:function(a){this._labelMargin=void 0===a?4:a},hasValidData:function(){return this._super()&&this._data&&this._axis},paint:function(){if(this._super.apply(this,arguments),this._plotMinValue===this._axis.getPlotMin()&&this._plotMaxValue===this._axis.getPlotMax()||(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues()),!this._hasVisibleRefLines)return void this._clearLabels();B.call(this,!0);var a,b,c,e,f,j,k,n,o,p,q,r,s,t,u,v,w,x,y,z=this.isVertical()?"middle":"top"===this.dock?"bottom":"top",A="middle",C=this.rect.width,E=this.rect.height,G="top"===this.dock?E-this._labelMargin:this._labelMargin,H=new Array(this._numLabelObjects),I=this._labelMaxWidthForYAxis,J=this._style.label.font,K="top"===this.dock?(E-this._labelMargin)/2:(E+this._labelMargin)/2;for(this.yMirrorMode?(n=.7,o=.3,p=C/2-(this._labelMargin/2+1)):(n=.3,o=.7,p=C/2+this._labelMargin/2+1),y=p,a=0;a<this._numLabelObjects;a+=1)w=this._labelObjects[a],b=w.index,c=D.call(this,w.value),this.isVertical()?(e=p,f=c):(e=c,f=void 0!==w.type?K:G),q=b>-1&&void 0!==this._data[b].color?m(this._data[b].color):this._style.label.color,void 0!==w.type?(J=this._style.outOfBounds.font,x=A,q="white"):(J=this._style.label.font,x=z),r=new g,r.fill=q,r.x=e,r.y=f,r.align=O,r.baseline=x,r.font=J,r.maxWidth=I,r.maxHeight=92,r.maxNumLines=3,r.ellipsis=" "+w.text2,r.setText(w.text),H[a]=r,w.position=c,w.shapeWrapper=r;if(0===this._numLabelObjects)return void this._clearLabels();if(this.isVertical()){for(l(this._labelObjects),this._numUpperLabels>0&&(c=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.7,this._labelObjects.push({position:c,size:Q})),this._numLowerLabels>0&&(c=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.3,this._labelObjects.push({position:c,size:Q})),d.positionRectanglesAlongAxis(this._labelObjects,this._verticaLabelGap,this._boundaryGap,this.rect.height,!1),a=this._labelObjects.length-1;a>-1;a--)void 0===this._labelObjects[a].shapeWrapper&&this._labelObjects.splice(a,1);for(a=0;a<this._numLabelObjects;a+=1)w=this._labelObjects[a],s=w.shapeWrapper,s.y=w.newPosition,1===w.type&&(t=w.shapeWrapper.measure(),u={cx:s.x,cy:s.y,r:F(t)/2}),w.type===-1&&(t=w.shapeWrapper.measure(),v={cx:s.x,cy:s.y,r:F(t)/2})}else{for(this.calculateLabelWidths(this._labelObjects,this.rect.width,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),this._numUpperLabels>0&&(c=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-n,this._labelObjects.push({position:c,size:Q})),this._numLowerLabels>0&&(c=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-o,this._labelObjects.push({position:c,size:Q})),d.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this.rect.width,!1),a=this._labelObjects.length-1;a>-1;a--)void 0===this._labelObjects[a].shapeWrapper&&this._labelObjects.splice(a,1);for(a=0;a<this._numLabelObjects;a+=1)w=this._labelObjects[a],s=w.shapeWrapper,s.x=w.newPosition,s.maxWidth=w.size,1===w.type&&(t=w.shapeWrapper.measure(),u={cx:s.x,cy:K,r:F(t)/2}),w.type===-1&&(t=w.shapeWrapper.measure(),v={cx:s.x,cy:K,r:F(t)/2})}this._numLowerLabels>0&&(this.isVertical()?r=new i([{x:y-3,y:E-5.2},{x:y,y:E},{x:y+3,y:E-5.2}]):(j=this.yMirrorMode?C-5.2:5.2,k=this.yMirrorMode?C:0,r=new i([{x:j,y:K-3},{x:k,y:K},{x:j,y:K+3}])),r.fill=this._style.label.color,H.push(r),r=new h(v.cx,v.cy,v.r),r.fill=this._style.outOfBounds.backgroundColor,H.splice(0,0,r)),this._numUpperLabels>0&&(this.isVertical()?r=new i([{x:y-3,y:5.2},{x:y,y:0},{x:y+3,y:5.2}]):(j=this.yMirrorMode?5.2:C-5.2,k=this.yMirrorMode?0:C,r=new i([{x:j,y:K-3},{x:k,y:K},{x:j,y:K+3}])),r.fill=this._style.label.color,H.push(r),r=new h(u.cx,u.cy,u.r),r.fill=this._style.outOfBounds.backgroundColor,H.splice(0,0,r)),this.renderer.stage.removeChildren(),this.renderer.stage.addChildren(H),this.renderer.render(),this._tooltips.setLabelObjects(this._labelObjects)},release:function(){this._super(),this._axis&&this._axis.stopListen("changed",null,this),this._tooltips.release(),this._tooltips=null},on:function(){this._super(),this._tooltips.on()},off:function(){this._super(),this._tooltips.off()},_updateProperties:function(){if(this._data){var a,b,c=this._data,d=c.length;for(b=0;b<d;b++)a="value"+b,this._transitionProperties[a]=c[b].refLineExpr.value;this.calculateRelevantSize(),this._super()}},_clearLabels:function(){this.renderer.stage.removeChildren(),this.renderer.clear()}})}),define("objects.backend-api/stacked-cube-slicer",["core.utils/class","general.utils/shapes/rect"],function(a,b){"use strict";var c,d=new b(0,0,0,0),e=new b(0,0,0,0);return c=a.extend("StackedCubeSlicer",{init:function(){this.pages=[]},get:function(a){return a.map(function(a){return this.getPage(a)}.bind(this))},getPage:function(a){var c,f,g,h=[];for(f=0;f<this.pages.length;f++)if(c=this.pages[f].qArea,d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(c.qLeft,c.qTop,c.qWidth,c.qHeight),g=e.intersection(d,!0),h.push({coverage:g?g.clone():new b(0,0,0,0),idx:f}),c.qLeft<=a.qLeft&&c.qLeft+c.qWidth>=a.qLeft+a.qWidth&&c.qTop<=a.qTop&&c.qTop+c.qHeight>=a.qTop+a.qHeight)return this._extract(a,this.pages[f]);return h.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),h[0].coverage.height>0&&h[0].coverage.width>0?this._extract(a,this.pages[h[0].idx]):{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qData:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(a){this.pages=a},containsArea:function(a){for(var b,c=0;c<this.pages.length;c++)if(b=this.pages[c].qArea,b.qLeft<=a.qLeft&&b.qLeft+b.qWidth>=a.qLeft+a.qWidth&&b.qTop<=a.qTop&&b.qTop+b.qHeight>=a.qTop+a.qHeight)return!0;return!1},contains:function(a){return!(!this.pages||!this.pages.length)&&0===a.filter(function(a){return!this.containsArea(a)}.bind(this)).length},_extract:function(a,b){d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(b.qArea.qLeft,b.qArea.qTop,b.qArea.qWidth,b.qArea.qHeight);var c,f,g=d.intersection(e,!0);if(!g)return{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qData:[]};f=Math.max(0,a.qTop-b.qArea.qTop);var h=b.qData[0],i=h.qSubNodes;c={};for(var j in h)h.hasOwnProperty(j)&&("qSubNodes"===j?c[j]=i.slice(f,f+g.height):c[j]=h[j]);return c.qUp+=f,c.qDown+=b.qArea.qHeight-g.height-f,{qArea:{qTop:g.y,qLeft:g.x,qWidth:g.width,qHeight:g.height},qData:[c]}}})}),define("objects.views/charts/utils/pan-scroll-controller",["core.utils/notification","objects.utils/event-utils","general.utils/shapes/point","objects.views/selections/interaction-handler","objects.views/selections/interaction-type"],function(a,b,c,d,e){"use strict";var f=3,g=e.extend("PanScrollController",{init:function(d,e){function g(a,b){l._panning=!0,l._panX=b.points[0].x,l._panY=b.points[0].y,l.PanStart.emit()}function h(a){l._panning=!0,l._panX=a.pageX,l._panY=a.pageY,l.PanStart.emit()}function i(a,b){l._panning||(l._panning=!0,l._panX=b.points[0].x,l._panY=b.points[0].y);var d=b.swipe&&b.swipe.currentPoint?b.swipe.currentPoint:new c(a.pageX,a.pageY),e=new c(d.x-l._panX,d.y-l._panY);l._panX=d.x,l._panY=d.y,l.PanUpdate.emit(e)}function j(){l._panning=!1,l.PanEnd.emit()}function k(a){var c=b.getMouseWheelData(a.originalEvent),d=c.delta>0?f:-f;l.PanWheel.emit(d)}a.mixin(this),this.notification("PanStart"),this.notification("PanUpdate"),this.notification("PanWheel"),this.notification("PanEnd"),this._$dataAreaContainer=d,this._$fullContainer=e;var l=this;this._eventHandlers={swipe:{start:g,update:i,end:j},swipetwo:{start:g,update:i,end:j},mousewheel:b.throttle(k,20),wheelswipe:{start:h,update:i,end:j},exclusive:function(){return!1},active:function(){return!0}}},on:function(){this._isOn||(d.addInteraction(this._eventHandlers,this._$dataAreaContainer,2,["swipe","swipetwo"],!0),d.addInteraction(this._eventHandlers,this._$fullContainer,2,["mousewheel","wheelswipe"],!0),this._isOn=!0)},off:function(){this._isOn&&(d.removeInteraction(this._eventHandlers),this._isOn=!1)}});return g}),define("objects.views/charts/utils/unit-projection",["core.utils/class"],function(a){var b;return b=a.extend("UnitProjection",{init:function(){},getProjectionType:function(){return"Unit"},project:function(a){return a},invProject:function(a){return a}})}),define("objects.views/charts/utils/viewport-projection",["objects.views/charts/events/event-launcher","general.utils/shapes/point","general.utils/shapes/rect","objects.views/charts/utils/unit-projection","objects.views/charts/utils/matrix"],function(a,b,c,d,e){function f(a){return this._originalProjectedDataCenterIsZeroPoint?a:new b(a.x-this._originalProjectedDataCenter.x,a.y-this._originalProjectedDataCenter.y)}function g(a){return this._originalProjectedDataCenterIsZeroPoint?a:new b(a.x+this._originalProjectedDataCenter.x,a.y+this._originalProjectedDataCenter.y)}function h(a,c){var d=Math.pow(2,c+8)/this._projectedDataSize;return new b(a.x*d,a.y*d)}function i(a,c){var d=Math.pow(2,c+8)/this._projectedDataSize;return new b(a.x/d,a.y/d)}function j(){if(this._projection&&this._projectedDataBoundingBox){var a,b,c,d,e;(!this._currentProjectedDataDataCenter||this._projectionChanged||this._currentDataCenterChanged)&&(this._currentProjectedDataDataCenter=void 0===this._currentDataCenter?this._originalProjectedDataCenter:this._projection.project(this._currentDataCenter)),
this._transformMatrixForZoomLevel.identity(),this._transformMatrixForZoomLevel.translate(this._viewportSize.x/2,this._viewportSize.y/2),this._mirrorYAxis&&this._transformMatrixForZoomLevel.scale(1,-1),a=Math.pow(2,this._zoomLevel+8)/this._projectedDataSize,this._transformMatrixForZoomLevel.scale(a,a),this._transformMatrixForZoomLevel.translate(-this._originalProjectedDataCenter.x,-this._originalProjectedDataCenter.y),b=this._transformMatrixForZoomLevel.transformPoint(this._originalProjectedDataCenter),c=this._transformMatrixForZoomLevel.transformPoint(this._currentProjectedDataDataCenter),d=b.x-c.x,e=b.y-c.y,this._transformMatrix.identity(),this._transformMatrix.translate(d,e),this._transformMatrix.multiply(this._transformMatrixForZoomLevel.elements),this._invTransformMatrix=this._transformMatrix.clone(),this._invTransformMatrix.invert(),this._projectionChanged=!1,this._currentDataCenterChanged=!1,this.enabledChangeEvent&&this.fire("changed")}}function k(){var a,b,d,e,f,g;a={x:this._boundingBox.x,y:this._boundingBox.y},b={x:this._boundingBox.x+this._boundingBox.width,y:this._boundingBox.y+this._boundingBox.height},d=this._projection.project(a),e=this._projection.project(b),f=Math.min(d.x,e.x),g=Math.min(d.y,e.y),this._projectedDataBoundingBox=new c(f,g,Math.abs(e.x-d.x),Math.abs(e.y-d.y)),this._projectedDataSize=Math.max(this._projectedDataBoundingBox.width,this._projectedDataBoundingBox.height),this._originalProjectedDataCenter=this._projectedDataBoundingBox.getCenterPoint(),this._originalProjectedDataCenterIsZeroPoint=0===this._originalProjectedDataCenter.x&&0===this._originalProjectedDataCenter.y}var l,m=22,n=0,o=1e-9,p=.001,q=new b(0,0),r=Math.log(2);return l=a.extend("ViewportProjection",{init:function(){this._super(),n++,this._fractionalZoomMode=!0,this._viewportSize=new b(256,256),this._zoomLevel=0,this._maxZoomLevel=m,this._minZoomLevel=0,this._translation=new b(0,0),this._unitProjection=new d,this._projection=this._unitProjection,this._originalProjectedDataCenter=new b(0,0),this._boundingBox=new c(0,0,256,256),k.call(this),this._originalProjectedDataCenterIsZeroPoint=!0,this._transformMatrixForZoomLevel=new e,this._transformMatrix=new e,this._invTransformMatrix=new e,this.enabledChangeEvent=!0,this._mirrorYAxis=!1,this.helpFunctions={translateProjectedDataCenterToZeroPoint:f,invTranslateProjectedDataCenterToZeroPoint:g,scaleProjectedDataToZoomLevel:h,invScaleProjectedDataToZoomLevel:i,updateProjectedDataBoundingBox:k}},setProjection:function(a){return(!this._projection||!a||this._projection.getProjectionType()!==a.getProjectionType())&&(this._projection=a,this._projection||(this._projection=this._unitProjection),k.call(this),this._projectionChanged=!0,j.call(this),!0)},getProjection:function(){return this._projection},getUnitProjection:function(){return this._unitProjection},setBoundingBox:function(a){this._boundingBox&&this._boundingBox.equal&&this._boundingBox.equal(a)||(this._boundingBox=new c(a.x,a.y,a.width,a.height),k.call(this),j.call(this))},getBoundingBox:function(){return this._boundingBox},setSize:function(a){return!(this._viewportSize&&this._viewportSize.equal&&this._viewportSize.equal(a))&&(this._viewportSize=new b(a.x,a.y),j.call(this),!0)},getSize:function(){return this._viewportSize},setZoomLevel:function(a){return!isNaN(a)&&(this._fractionalZoomMode||(a=Math.round(a)),a=Math.max(Math.min(a,this._maxZoomLevel),this._minZoomLevel),Math.abs(a-this._minZoomLevel)<p?a=this._minZoomLevel:Math.abs(a-this._maxZoomLevel)<p&&(a=this._maxZoomLevel),!(Math.abs(this._zoomLevel-a)<p)&&(this._zoomLevel=a,j.call(this),!0))},getZoomLevel:function(){return this._zoomLevel},setDataCenter:function(a){return!!a&&(!(this._currentDataCenter&&this._currentDataCenter.closeTo&&this._currentDataCenter.closeTo(a,o))&&(this._currentDataCenterChanged=!0,this._currentDataCenter=new b(a.x,a.y),j.call(this),!0))},getDataCenter:function(){return this._currentDataCenter},setFractionalZoomMode:function(a){this._fractionalZoomMode=a},getFractionalZoomMode:function(){return this._fractionalZoomMode},project:function(a){var b,c;return b=this._projection.project(a),c=this.transform(b)},fromDataRectToViewportRect:function(a){var d,e,f;return d=this.project(new b(a.x,a.y)),e=this.project(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},invProject:function(a){var b,c;return b=this.invTransform(a),c=this._projection.invProject(b)},fromViewportRectToDataRect:function(a){var d,e,f;return d=this.invProject(new b(a.x,a.y)),e=this.invProject(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},getDataRectOfViewport:function(){var a,b,d;return a=this.invProject(q),b=this.invProject(this._viewportSize),d=new c(a.x,a.y,b.x-a.x,b.y-a.y)},getDataRectOfViewportIfZoomOnADataRect:function(a){var b=this.enabledChangeEvent;this.enabledChangeEvent=!1;var c=this.getZoomLevel(),d=this.getDataCenter();this.zoomOnDataRectangle(a);var e=this.getDataRectOfViewport();return this.setZoomLevel(c),this.setDataCenter(d),this.enabledChangeEvent=b,e},transform:function(a){var c=this._transformMatrix.transformPoint(a);return new b(c.x,c.y)},invTransform:function(a){var c=this._invTransformMatrix.transformPoint(a);return new b(c.x,c.y)},fromDataPointToPixel:function(a,c){var d,e,g,i,j=Math.pow(2,c+7);return d=this._projection.project(a),e=f.call(this,d),g=h.apply(this,[e,c]),i=new b(g.x+j,j-g.y)},fromPixelToDataPoint:function(a,c){var d,e,f,h,j=Math.pow(2,c+7);return h=new b(a.x-j,j-a.y),f=i.apply(this,[h,c]),e=g.call(this,f),d=this._projection.invProject(e)},calculateZoomLevelForDataRectangle:function(a){if(a){var c,d,e,f,g,h,i,j,k,l;return c=new b(a.x,a.y),d=new b(a.x+a.width,a.y+a.height),e=this.fromDataPointToPixel(c,0),f=this.fromDataPointToPixel(d,0),g=Math.abs(e.x-f.x),h=Math.abs(e.y-f.y),i=0===g?Number.MAX_VALUE:this._viewportSize.x/g,j=0===h?Number.MAX_VALUE:this._viewportSize.y/h,k=Math.min(i,j),k===Number.MAX_VALUE?20:l=Math.log(k)/Math.LN2}},calculateCenterPointForDataRectangle:function(a){if(a){var c,d,e,f,g,h;return c=new b(a.x,a.y),d=new b(a.x+a.width,a.y+a.height),e=this.fromDataPointToPixel(c,0),f=this.fromDataPointToPixel(d,0),g=new b((e.x+f.x)/2,(e.y+f.y)/2),h=this.fromPixelToDataPoint(g,0)}},moveViewport:function(a,c){this.setDataCenter(this.invProject(new b(this._viewportSize.x/2-a,this._viewportSize.y/2-c)))},zoom:function(a){a>0&&this.setZoomLevel(this.getZoomLevel()+Math.log(a)/Math.LN2)},zoomOnPixel:function(a,b){if(b>0){var c,d,e;c=this.invTransform(a),e=Math.log(b)/Math.LN2,this.setZoomLevel(this.getZoomLevel()+e),d=this.transform(c),this.moveViewport(a.x-d.x,a.y-d.y)}},zoomOnDataRectangle:function(a,b){if(a){var c,d;c=this.calculateZoomLevelForDataRectangle(a),this._fractionalZoomMode||(c=b?Math.round(c):Math.floor(c)),this.setZoomLevel(c),d=this.calculateCenterPointForDataRectangle(a),this.setDataCenter(d)}},setMaxZoomLevel:function(a){this._maxZoomLevel=a},setMinZoomLevel:function(a){this._minZoomLevel=a},getTransformMatrix:function(){return this._transformMatrix},setTransformMatrix:function(a){var c,d,e;this._invTransformMatrix=a.clone().invert(),c=Math.abs(a.elements[0][0]),d=Math.log(c*this._projectedDataSize)/r-8,e=this.invProject(new b(this._viewportSize.x/2,this._viewportSize.y/2)),this.setZoomLevel(d),this.setDataCenter(e)},getInvTransformMatrix:function(){return this._invTransformMatrix}})}),define("objects.views/charts/utils/pan-zoom-controller",["core.utils/class","objects.utils/event-utils","general.utils/shapes/point","general.utils/shapes/rect","objects.views/charts/utils/matrix","objects.views/charts/utils/viewport-projection","objects.views/selections/interaction-type","objects.views/selections/interaction-handler","touche"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){a=Math.min(Math.max(a,this._minZoomLevel),this._maxZoomLevel),this._viewportProjection.setZoomLevel(a)}function j(a,b,c,d){var f,g,h,i,j,k=new e,m=c/d;h=b.x-a.x,i=b.y-a.y,f=this._localMatrix.clone().invert().transformPoint(a),k.translate(f.x,f.y),k.scale(m,m),k.translate(-f.x,-f.y),this._localMatrix=this._localMatrix.multiply(k),j=this._localMatrix.elements,this._localMatrix.translate(h/j[0][0],i/j[1][1]),l.call(this),k.identity(),g=this._globalMatrix.clone().invert().transformPoint(a),k.translate(g.x,g.y),k.scale(m,m),k.translate(-g.x,-g.y),this._globalMatrix=this._globalMatrix.multiply(k),j=this._globalMatrix.elements,this._globalMatrix.translate(h/j[0][0],i/j[1][1])}function k(a){if(!this._setTransformOrigin){var b="top left";a.style["-webkit-transform-origin"]=b,a.style["-moz-transform-origin"]=b,a.style["-o-transform-origin"]=b,a.style["-ms-transform-origin"]=b,a.style["transform-origin"]=b,this._setTransformOrigin=!0}}function l(){var a=this._localMatrix.elements,b="matrix("+a[0][0]+",0,0,"+a[1][1]+","+a[0][2]+","+a[1][2]+")";this.helpFunctions.setTransform(this._$element[0],b)}function m(a,b){this.helpFunctions.onInteractionStart(),n.call(this,a,b)}function n(a,b){if(!this._disableZoomOnMouseWheel){this._disableZoomOnMouseWheel=!0;var c,d=this,f=new e;if(setTimeout(function(){d._disableZoomOnMouseWheel=!1},d._mouseWheelTimeoutPeriod),this._zoomPanByWebkitTransform){var g;this._zooming=!0,g=this._localMatrix.clone().invert().transformPoint(a),f.translate(g.x,g.y),f.scale(b,b),f.translate(-g.x,-g.y),this._localMatrix=this._localMatrix.multiply(f),l.call(this)}else t.call(this,a,b);this._zoomCancelled||(f.identity(),c=this._globalMatrix.clone().invert().transformPoint(a),f.translate(c.x,c.y),f.scale(b,b),f.translate(-c.x,-c.y),this._globalMatrix=this._globalMatrix.multiply(f),this._updateCallback()),this._zoomCancelled=!1}}function o(){this._zooming=!1,this.helpFunctions.onInteractionEnd()}function p(a,b){this.helpFunctions.onInteractionStart(),q.call(this,a,b)}function q(a,b){var c;this._zoomPanByWebkitTransform?(this._panning=!0,c=this._localMatrix.elements,this._localMatrix.translate(a/c[0][0],b/c[1][1]),l.call(this)):s.call(this,a,b),c=this._globalMatrix.elements,this._globalMatrix.translate(a/c[0][0],b/c[1][1]),this._updateCallback()}function r(){this._panning=!1,this.helpFunctions.onInteractionEnd()}function s(a,b){this._viewportProjection.enabledChangeEvent=!1,this.moveViewport(a,b),this._viewportProjection.enabledChangeEvent=!0}function t(a,b){this._viewportProjection.enabledChangeEvent=!1,this.zoomOnPixel(a,b),this._viewportProjection.enabledChangeEvent=!0}var u=22,v=200,w=1e-6,x=a.extend("PanZoomController",{init:function(a,b,c,g){var h=this;this._minZoomLevel=-3,this._maxZoomLevel=u,this._interactionStarted=!1,this._zoomPanByWebkitTransform=!1,this._fractionalZoomMode=!0,this._defaultScale=Math.pow(2,.5),this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=50,this._viewportProjection=g?g:new f,this._viewportProjection.setMinZoomLevel(this._minZoomLevel),this._viewportProjection.setMaxZoomLevel(this._maxZoomLevel),this._localMatrix=new e,this._$element=a,this._offset=a.offset(),this._startCallback=function(){b.start&&b.start(this._viewportProjection._transformMatrix)},this._updateCallback=function(){b.update&&b.update(this._viewportProjection._transformMatrix)},this._endCallback=function(){b.end&&b.end(this._viewportProjection._transformMatrix)},this._resetCallback=function(){b.reset&&b.reset(this._viewportProjection._transformMatrix)},this._defaultBounds=this._viewportProjection.getBoundingBox(),this._dataBounds=c?new d(c.x,c.y,c.width,c.height):this._defaultBounds,this.helpFunctions={setTransform:function(a,b){a.style["-webkit-transform"]=b,a.style["-moz-transform"]=b,a.style["-o-transform"]=b,a.style["-ms-transform"]=b,a.style.transform=b},onInteractionStart:function(){h._interactionStarted||(h._startCallback(),h.reset(),h._interactionStarted=!0)},onInteractionEnd:function(){h._zooming||h._panning||h._pinching||!h._interactionStarted||(h.helpFunctions.setTransform(h._$element[0],"matrix(1,0,0,1,0,0)"),h._viewportProjection.enabledChangeEvent=!1,h._viewportProjection.setTransformMatrix(h._globalMatrix),h._endCallback(),h._viewportProjection.enabledChangeEvent=!0,h._interactionStarted=!1)}}},reset:function(){this._localMatrix.identity(),this._globalMatrix=this._viewportProjection.getTransformMatrix().clone(),this._zoomPanByWebkitTransform&&this.helpFunctions.setTransform(this._$element[0],"matrix(1,0,0,1,0,0)")},setOffset:function(a){this._offset=a},navigate:function(a,b){var c,d=this;switch(a){case"resetZoom":d.zoomOnDataBounds();break;case"zoomIn":if(c=d.getZoomLevel(),void 0===c||null===c||c===d._maxZoomLevel)return;m.call(d,{x:this._$element.width()/2,y:this._$element.height()/2},d._defaultScale),o.call(d);break;case"zoomOut":if(c=d.getZoomLevel(),void 0===c||null===c||c===d._minZoomLevel)return;m.call(d,{x:this._$element.width()/2,y:this._$element.height()/2},d._invDefaultScale),o.call(d);break;case"navUp":p.call(d,0,v),r.call(d);break;case"navDown":p.call(d,0,-v),r.call(d);break;case"navLeft":p.call(d,v,0),r.call(d);break;case"navRight":p.call(d,-v,0),r.call(d);break;case"jumpTo":p.call(d,b.x,b.y),r.call(d);break;case"startAt":p.call(d,b.x,b.y);break;case"moveTo":q.call(d,b.x,b.y);break;case"endAt":r.call(d)}},onPan:function(a,b,c){var d=this;switch(a){case"start":p.call(d,c.swipe.deltaX,c.swipe.deltaY);break;case"update":q.call(d,c.swipe.curDeltaX,c.swipe.curDeltaY);break;case"end":r.call(d)}},on:function(a,d){var e,f,i,l,s=this,t=!1,u=d?d:this._$element[0],v=!1;this.container=u,this.namespace=a,k.call(this,this._$element[0]);var w=function(a){var d,e,f,g,h=b.getMouseWheelData(a.originalEvent);d=h.x-s._offset.left,e=h.y-s._offset.top,f=new c(d,e),g=h.delta>0?s._defaultScale:s._invDefaultScale,v?n.call(s,f,g):m.call(s,f,g),v=!0,null!==l&&clearTimeout(l),l=setTimeout(function(){l=null,o.call(s),v=!1},250)},x=function(a,b){2===b.pagePoints.length?(this.pinch={start:{},current:{}},this.pinch.start.point1=b.pagePoints[0],this.pinch.start.point2=b.pagePoints[1],b.centerPoint=new c((this.pinch.start.point1.x+this.pinch.start.point2.x)/2,(this.pinch.start.point1.y+this.pinch.start.point2.y)/2),b.scale=1,f={},f.x=(this.pinch.start.point1.x+this.pinch.start.point2.x)/2-s._offset.left,f.y=(this.pinch.start.point1.y+this.pinch.start.point2.y)/2-s._offset.top,i={x:b.centerPoint.x-s._offset.left,y:b.centerPoint.y-s._offset.top},s.helpFunctions.onInteractionStart(),e=b.scale,f=i):s.onPan("start",a,b),Touche.preventGestures(this.gestureHandler)},y=function(a,b){2===b.pagePoints.length?this.pinch.start.point2?(b.centerPoint||(b.centerPoint=new c((this.pinch.start.point1.x+this.pinch.start.point2.x)/2,(this.pinch.start.point1.y+this.pinch.start.point2.y)/2)),this.pinch.current.point1=b.pagePoints[0],this.pinch.current.point2=b.pagePoints[1],this.startDistance=this.pinch.start.point2.distanceTo(this.pinch.start.point1),this.lastDistance=this.currentDistance,this.currentDistance=this.pinch.current.point2.distanceTo(this.pinch.current.point1),this.pinchLength=Math.abs(this.startDistance-this.currentDistance),this.scale=this.currentDistance/this.startDistance,b.scale=this.scale,b.delta=this.currentDistance-this.lastDistance,b.centerPoint.x=(this.pinch.current.point1.x+this.pinch.current.point2.x)/2,b.centerPoint.y=(this.pinch.current.point1.y+this.pinch.current.point2.y)/2,i={x:b.centerPoint.x-s._offset.left,y:b.centerPoint.y-s._offset.top},s._pinching=!0,s._zoomPanByWebkitTransform?(j.call(s,f,i,b.scale,e),e=b.scale):(Math.abs(b.scale-e)>.1&&(n.call(s,i,1+(b.scale-e)),e=b.scale),q.call(s,i.x-f.x,i.y-f.y)),f=i):this.pinch.start.point2=b.pagePoints[1]:s.onPan("update",a,b),Touche.preventGestures(this.gestureHandler)},z=function(a,b){s._pinching=!1,this._zoomPanByWebkitTransform||(this._zooming=!1),s.onPan("end",a,b)},A=b.throttle(function(a){w(a)},20);this._eventHandlers=g.extend({mousewheel:function(a){A(a),a.preventDefault()},swipe:{start:function(a,b){x.call(this,a,b)},update:function(a,b){y.call(this,a,b)},end:function(a,b){z.call(this,a,b)}},swipetwo:{start:function(a,b){x.call(this,a,b)},update:function(a,b){y.call(this,a,b)},end:function(a,b){z.call(this,a,b)}},tapthree:{end:function(){s.zoomOnDataBounds(),h.preventGestures(this)}},wheelswipe:{start:function(a){s._panX=a.pageX,s._panY=a.pageY,t=!1},update:function(a){var b,c,d,e,f;b=a.pageX,c=a.pageY,d=b-s._panX,e=c-s._panY,f=t,!t&&(Math.abs(d)>3||Math.abs(e)>3)&&(t=!0),t&&(s._panX=b,s._panY=c,f?q.call(s,d,e):p.call(s,d,e))},end:function(){t?r.call(s):s.zoomOnDataBounds(),t=!1}}}),h.addInteraction(this._eventHandlers,u,2,["tapthree","swipe","swipetwo","wheelswipe","mousewheel"],!1)},off:function(){h.removeInteraction(this._eventHandlers)},setMaxZoomLevel:function(a){this._maxZoomLevel=a,this._viewportProjection&&this._viewportProjection.setMaxZoomLevel(a)},setMinZoomLevel:function(a){this._minZoomLevel=a,this._viewportProjection&&this._viewportProjection.setMinZoomLevel(a)},setCenter:function(a){this._viewportProjection&&this._viewportProjection.setDataCenter(a)},getCenter:function(){return this._viewportProjection?this._viewportProjection.getDataCenter():null},setZoomLevel:function(a){!isNaN(a)&&isFinite(a)&&(Math.abs(a-Math.round(a))<w&&(a=Math.round(a)),i.call(this,a))},getZoomLevel:function(){return this._viewportProjection?this._viewportProjection.getZoomLevel():0},moveViewport:function(a,b){var d=this._viewportProjection.getSize();this.setCenter(this._viewportProjection.invProject(new c(d.x/2-a,d.y/2-b)))},zoom:function(a){if(a>0){var b=Math.log(a)/Math.LN2;Math.abs(b-Math.round(b))<w&&(b=Math.round(b)),this.setZoomLevel(this.getZoomLevel()+b)}},zoomOnPixel:function(a,b){var c,d,e=this.getZoomLevel();return e<=this._minZoomLevel&&b<=1||e>=this._maxZoomLevel&&b>=1?void(this._zoomCancelled=!0):(c=Math.pow(2,this._minZoomLevel-e),d=Math.pow(2,this._maxZoomLevel-e),b=Math.min(Math.max(b,c),d),void this._viewportProjection.zoomOnPixel(a,b))},zoomOnDataRectangle:function(a,b){this._viewportProjection.zoomOnDataRectangle(a,b)},zoomOnViewportRectangle:function(a,b){var c=this._viewportProjection.fromViewportRectToDataRect(a);this.zoomOnDataRectangle(c,b)},setBounds:function(a,b,c,e){isNaN(a)||isNaN(b)||isNaN(c)||isNaN(e)||(this._dataBounds=new d(a,b,c,e))},setBoundsRect:function(a){!a||this._dataBounds&&this._dataBounds.equal(a)||(this._dataBounds=a.clone())},zoomOnDataBounds:function(){var a=this._dataBounds&&!this._dataBounds.hasNaN()?this._dataBounds:this._defaultBounds;if(a)return this.zoomOnDataRectangle(a,!1),this._resetCallback(),this._viewportProjection.fire("resetZoomFinished"),!0},setFractionalZoomMode:function(a){this._fractionalZoomMode=a,this._defaultScale=this._fractionalZoomMode?Math.pow(2,.5):2,this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=this._fractionalZoomMode?50:100,this._viewportProjection&&this._viewportProjection.setFractionalZoomMode(a)},getFractionalZoomMode:function(){return this._fractionalZoomMode},setZoomPanByWebkitTransform:function(a){this._zoomPanByWebkitTransform=a},getZoomPanByWebkitTransform:function(){return this._zoomPanByWebkitTransform},release:function(){this._viewportProjection=null,this._$element=null}});return x}),define("objects.views/charts/scrollable-chart",["jquery","./axis-chart","objects.views/charts/components/axis/discrete-axis","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/chart-component","objects.views/charts/components/scroll-area","objects.views/charts/components/mini-chart","objects.views/charts/components/ref-line-labels","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","general.utils/shapes/rect","objects.utils/event-utils","core.utils/deferred","objects.backend-api/stacked-cube-slicer","objects.views/charts/utils/pan-scroll-controller","objects.views/charts/utils/pan-zoom-controller"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){var b=this.components.scrollArea.getOffset()-a/(this.components.dimensionAxis._discreteSpacing||28);b=b<0?0:b,this.components.scrollArea.setOffset(b)}function r(){if(!this._disableZoom){var a=this._panZoomController._viewportProjection,b=this.components.timeAxis.getDataMin(),c=this.components.timeAxis.getDataMax(),d=c-b,e=this.components.timeAxis.getPlotSize();a.setSize({x:e,y:1}),a.setBoundingBox(new k(b,0,c-b,1)),this._panZoomController.setOffset(this._panZoomController._$element.offset());var f=this.components.scrollArea.getOffset(),g=this.components.scrollArea.getViewRange();this.yMirrorMode&&(f=d-g-f);var h=a.getTransformMatrix();h.identity(),h.scale(e/g,1),h.translate(-f,0),a.setTransformMatrix(h),v(this.selections)}}function s(a,b){var c=this.components.scrollArea.getOffset(),d=this.components.scrollArea.getViewRange(),e=Math.abs(a-c)>E||Math.abs(b-d)>E;e&&(this.components.scrollArea.setViewRange(b),this.components.scrollArea.setOffset(a),this.components.scrollArea.fire("offsetChanged"))}function t(){if(!this._disableZoom){var a=this._panZoomController._viewportProjection,b=this.components.timeAxis.getPlotSize(),c=this.components.timeAxis.getDataMin(),d=this.components.timeAxis.getDataMax(),e=d-c,f=a.invTransform({x:0,y:0}).x,g=a.invTransform({x:b,y:0}).x,h=Math.min(g-f,e),i=Math.min(Math.max(f,0),e-h);this.yMirrorMode&&(i=e-h-i),s.call(this,i,h)}}function u(){var a=this.components.timeAxis.getDataMin(),b=this.components.timeAxis.getDataMax();s.call(this,0,b-a)}function v(a,b){var c=a&&a.getActiveType();c&&"range.discrete"===c.getActiveMode()&&c.cancel(!0),b&&b.clearSelection()}function w(a,b,e,f){var g,h,i=[],j=[];Object.keys(this.components).forEach(function(a){this.components[a]instanceof c||this.components[a].isDimension?i.push(this.components[a]):this.components[a]instanceof d&&!this.components[a].isStacked&&j.push(this.components[a])}.bind(this)),g=["top","bottom"].contains(i[0].dock)?"x":"y",h="x"===g?"y":"x",this.selections.types.range.setComponent(g,i),this.tooltips.setComponent(g,i),this.selections.types.range.setComponent(h,j),e&&(a>1||b>1)?(this.selections.types.range.setComponent(h,[]),"byMeasure"===f?this.selections.types.colorLegend.removeComponent("colorLegend",this.components.colorLegend):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)}function x(){this._isPagingTransitionEnabled&&(this.components.measureAxis.setDataRangeTransition(!1),this.components.measureAxis.stopListen("endTransition",y,this),this.components.measureAxis.stopListen("startTransition",z,this),clearTimeout(this._pagingTransitionTimer),delete this.components.measureAxis.setDataRange,this._isPagingTransitionEnabled=!1)}function y(){this.components.refLineLabels&&this.layout();for(var a in this.components)this.components[a].invalidateDisplay("ScrollableChart.onAxisTransitionEnded")}function z(){this._visibleRefLines=this.components.refLineLabels.isVisible()}function A(){if(!this._isPagingTransitionEnabled){this._isPagingTransitionEnabled=!0;var a=this,b=this.components.measureAxis,c=b.setDataRange;b.listen("endTransition",y,this),b.listen("startTransition",z,this),this._pagingTransitionTimer=null,this.components.measureAxis.setDataRange=function(d,e){clearTimeout(a._pagingTransitionTimer),a._pagingTransitionTimer=setTimeout(function(){var f;b.setDataRangeTransition(!0),c.apply(b,[d,e]),a.layout();for(f in a.components)a.components[f].invalidateDisplay()},500)}}}function B(){var a,b,c,d,e,f=this.components.scrollArea,g=this.yMirrorMode,h=this._scrollableHint,i=[];this._scrollAffordance||(this._scrollAffordance={canIncrease:!1,canDecrease:!1,yMirrorMode:g}),c=f.getOffset(),e=f.getViewRange(),d=f.fullState.max,b=c>E,a=c+e<d-E,b===this._scrollAffordance.canDecrease&&a===this._scrollAffordance.canIncrease&&g===this._scrollAffordance.yMirrorMode||(this._scrollAffordance.canIncrease=a,this._scrollAffordance.canDecrease=b,this._scrollAffordance.yMirrorMode=g,b&&i.push(f.isVertical()?"up":this.yMirrorMode?"right":"left"),a&&i.push(f.isVertical()?"down":this.yMirrorMode?"left":"right"),this.yMirrorMode&&i.reverse(),h.attr("class",function(a,b){return b.replace(/\bqv-chart-scrollable-\S+/g,"")}),h.addClass("qv-chart-scrollable-"+i.join("-")))}var C,D={NONE:0,ONE_DIM:1,TWO_DIM:2},E=1e-6;return C=b.extend("ScrollableChart",{init:function(b,d,m,n,s){var w=this,x=a.extend(!0,{providers:{colorMap:{clazz:i,multiDimScheme:"last"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:e.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",showFlag:e.prototype.ShowFlags.SPARK},miniChart:{show:!0,clazz:g,components:{dimensionAxis:{show:!1,clazz:c},measureAxis:{show:!1},dataArea:{isMini:!0,show:!0}}},xAxis:{clazz:c,reductionOrder:10,shrinkToFitThreshold:.85,showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:e.prototype.ShowFlags.SMALL,horizontal:e.prototype.ShowFlags.XSMALL}},titleShowFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}}},xAxisTitle:{showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}},reductionOrder:1},scrollArea:{sortKey:2,show:!0,dock:"bottom",order:2,relevantSize:20,reductionOrder:10.1,showFlag:e.prototype.ShowFlags.XSMALL,clazz:f},refLineLabels:{show:!0,dock:"right",order:3,reductionOrder:3,showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}},clazz:h}}},m||{});this._super(b,d,x,n,s),this._scrollableHint=a("<div class='qv-chart-scrollable'>").appendTo(this.components.dataArea.container),this._changeWatchers=this._changeWatchers||[],this._pagingInfo=new k(0,0,0,0),this.components.measureAxis=this.components.yAxis,this.components.dimensionAxis=this.components.xAxis,this.components.dimensionAxisTitle=this.components.xAxisTitle,this.components.measureAxisTitle=this.components.yAxisTitle,delete this.components.xAxisTitle,delete this.components.yAxisTitle,delete this.components.xAxis,delete this.components.yAxis,this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.listen("drill-up",function(a,b,c){w.backendApi.drillUp(b,c)}),this.components.dimensionAxisTitle.setModel(b.ext.model),this.components.measureAxisTitle.setType("measure"),this.components.measureAxisTitle.setModel(b.ext.model),this.components.scrollArea.listen("scrollStart",function(){v(this.selections,this.tooltips)}.bind(this)),this._showLegend=!1,this.scrollMultiplicator=1,this.components.dataArea.setMinorAxis(this.components.measureAxis),this.components.dataArea.setMajorAxis(this.components.dimensionAxis),this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis),this.components.dimensionAxis.setMinDiscreteUnitSize(28),this._changeWatchers.push(j.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(j.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(j.bindSetter(function(){w.isDimensionContinuous||w.components.dimensionAxis.setOffset(w.components.scrollArea.getOffset())},this.components.scrollArea,"offset")),this._changeWatchers.push(j.bindSetter(function(a){w.isDimensionContinuous||w.components.scrollArea.setFullRange(a)},this.components.dimensionAxis,"numDiscreteUnits")),this._changeWatchers.push(j.bindSetter(function(a){w.isDimensionContinuous||w.components.scrollArea.setViewRange(w._pagingMode===D.TWO_DIM?a/2:a)},this.components.dimensionAxis,"numDiscreteUnitsInView")),this.components.timeAxis&&(w.components.timeAxis.listen("rendered",function(){var a=w.selections&&w.selections.getActiveType&&w.selections.getActiveType();a&&"range.dimension"===a.getActiveMode()&&(a.refreshContainer(),a.updateRangeProjection(),a.updateRangeDisplay())}),this._debounceUpdateHandle={},this._debouncedUpdate=l.debounce(function(){var a=w.components.timeAxis.getPlotMin(),b=Math.ceil(w.components.timeAxis.getPlotMax());w.updateTimeData(a,b).then(function(){w.partialUpdate(w._data)})},400,this._debounceUpdateHandle),this._changeWatchers.push(j.bindSetter(function(){if(w.isDimensionContinuous){var a=w.components.timeAxis.getDataMin()+w.components.scrollArea.getOffset(),b=a+w.components.scrollArea.getViewRange();w.components.timeAxis.setPlotMin(a),w.components.timeAxis.setPlotMax(b),w.components.timeAxis.invalidateDisplay(),w._debouncedUpdate()}},this.components.scrollArea,"offset"))),this._changeWatchers.push(j.bindSetter(function(){w._checkPage!==!1&&w.checkPage(),B.call(w)},this.components.dimensionAxis,"offset")),this._scrollController=new o(this.components.dataArea.container,this.container,this.components.scrollArea),this._scrollController.PanStart.bind(function(){v(w.selections)}),this._scrollController.PanUpdate.bind(function(a){var b=w.components.scrollArea.isHorizontal()?"x":"y";w.yMirrorMode&&(a.x=-a.x),q.call(w,a[b])}),this._scrollController.PanWheel.bind(function(a){v(w.selections),q.call(w,a*w.components.dimensionAxis._discreteSpacing)}),this._panZoomController=new p(a(this.components.dataArea.container),{start:function(){r.call(w)},update:function(){t.call(w)},end:function(){t.call(w)},reset:function(){u.call(w)}}),this._panZoomController.setZoomPanByWebkitTransform(!1),this.components.timeAxis&&this._panZoomController.setMaxZoomLevel(27)},setYMirrorMode:function(a){this._super(a),this.updateVerticalComponentsDock()},getVerticalComponents:function(){var a,b=this._super();return this._data&&this.components&&(this.components.dimensionAxis&&this.components.dimensionAxis.isVertical()&&this._data.dimensionAxis&&(b.push({comp:this.components.dimensionAxis,dock:this._data.dimensionAxis.dock}),this.components.dimensionAxisTitle&&b.push({comp:this.components.dimensionAxisTitle,dock:this._data.dimensionAxis.dock})),this.components.measureAxis&&this.components.measureAxis.isVertical()&&this._data.measureAxis&&(a=this._data.measureAxes&&this._data.measureAxes[0]?this._data.measureAxes[0].dock:this._data.measureAxis.dock,b.push({comp:this.components.measureAxis,dock:a}),this.components.measureAxisTitle&&b.push({comp:this.components.measureAxisTitle,dock:a})),this.components.refLineLabels&&this.components.refLineLabels.isVertical()&&this._data.measureAxis&&b.push({comp:this.components.refLineLabels,dock:"far"===this._data.measureAxis.dock?"near":"far"}),this.components.scrollArea&&this.components.scrollArea.isVertical()&&b.push({comp:this.components.scrollArea,dock:"far"})),b},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.options._disableSelections||(this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.Clear.bind(this.onSelection.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},initTooltips:function(){this.tooltips.setComponent("dataArea",this.components.dataArea)},getSnapshotSize:function(){var a=0,b=0;this.rect&&(a=this.rect.width,b=this.rect.height);var c=this.getSnapshotChartData();
return!c.hasMiniChart&&this.components.scrollArea.isVisible()&&(this.components.scrollArea.isVertical()?a-=this.components.scrollArea.rect.width:b-=this.components.scrollArea.rect.height),{w:a,h:b}},getSnapshotChartData:function(b){var c=a.extend(!0,this._super()||{},{scrollOffset:b&&b.ignoreReducedData?0:this.components.scrollArea.getOffset(),discreteSpacing:this.components.dimensionAxis.getDiscreteSpacing(),axisInnerOffset:b&&b.ignoreReducedData?0:this.components.dimensionAxis.getInnerOffset(),hasMiniChart:this.components.miniChart&&!!this.components.miniChart.isVisible(),viewRange:this.components.scrollArea.getViewRange()});return b&&b.ignoreReducedData&&this.components.measureAxis.isStacked&&(c.dataRanges=[{min:this.components.measureAxis.getPlotMin(),max:this.components.measureAxis.getPlotMax()}]),c},setSnapshotData:function(b,c){function d(){var a=this.components.scrollArea,c=a.getOffset()/this.scrollMultiplicator,d=Math.round(c),e=this.components.dimensionAxis._discreteSpacing,f=a.getViewRange()/this.scrollMultiplicator,g=Math.round(f-(d-c)),h=Math.min(8,e/2),i=this._pagingInfo.y;if(isNaN(g)&&(g=10),this._data.barGrouping&&"grouped"===this._data.barGrouping.grouping&&this._data.qHyperCube.qMeasureInfo.length>1){d=Math.floor(c),g=Math.ceil(f-(d-c)),b.snapshotData.content.chartData.scrollOffset=a.getOffset()%this.scrollMultiplicator;var j=(Math.ceil(c)-c)*e*this.scrollMultiplicator-e/2;d=j<h?Math.ceil(c):Math.floor(c),g=Math.round(c+f);var k=c+f,l=(k-Math.floor(k))*e*this.scrollMultiplicator-e/2;k=l<h?Math.floor(k):Math.ceil(k),g=k-d}else if(this._data.barGrouping&&"grouped"===this._data.barGrouping.grouping&&this._data.qHyperCube.qDimensionInfo.length>1){var m=this.components.dataArea._tree;if(d=Math.max(Math.round(c-.5),i),g=Math.round(this.components.dimensionAxis.getNumDiscreteUnitsInView()-(d-(c-.5))),m){var n,o=0,p=0,q=0,r=i;if(i!==d){for(o=0;o<m.children.length&&r<d;o++,r++)for(n=m.children[o],p=0;p<n.children.length&&r<d;p++,++r)q++;d=i+q,o=Math.max(0,o-1),p=Math.max(0,p-1)}for(q=0,r=0;o<m.children.length&&r<g;o++,r++){for(n=m.children[o],p;p<n.children.length&&r<g;p++,++r)q++;p=0}g=q}else g*=2}return{qTop:d,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:g?g:0}}this._super(b,c);var e,f=m();if(!c||!c.ignoreReducedData)return this.isDimensionContinuous&&(b.qHyperCube.qDataPages=this._data.qHyperCube.qDataPages,b.qHyperCube.qAxisData=this._data.qHyperCube.qAxisData),this.components.miniChart.isVisible()||delete b.reducedHyperCube,f.resolve(b),f.promise;if(delete b.reducedHyperCube,this.isDimensionContinuous)return e=b.qHyperCube,e.qDataPages=[a.extend(!0,{},this._data.qHyperCube.qDataPages[0])],this._upperFocusIndex?e.qDataPages[0].qMatrix=e.qDataPages[0].qMatrix.slice(this._lowerFocusIndex,this._upperFocusIndex+1):e.qDataPages[0].qMatrix=e.qDataPages[0].qMatrix,e.qAxisData=this._cachedFocusAxisData,e.qDimensionInfo[0].qMin=this.components.timeAxis.getPlotMin(),e.qDimensionInfo[0].qMax=this.components.timeAxis.getPlotMax(),f.resolve(b),f.promise;if(e=b.qHyperCube,this.providers.colorMap&&this.providers.colorMap.getColorDataInfo()&&(b.color.persistent=!!this.providers.colorMap.getColorDataInfo().persistentColors),"K"===e.qMode){var g=new n;g.store(e.qStackedDataPages);var h=g.get([d.call(this)]);e.qSize.qcy=h[0].qArea.qHeight,h[0]&&h[0].qData[0]&&(h[0].qData[0].qDown=0,h[0].qData[0].qUp=0),e.qStackedDataPages=h,f.resolve(b)}else this.backendApi.getData([d.call(this)]).then(function(a){"S"===e.qMode?e.qDataPages=a:e.qStackedDataPages=a,e.qSize.qcy=a[0].qArea.qHeight,e.qDimensionInfo[0].qStateCounts&&(e.qDimensionInfo[0].qStateCounts.qOption=e.qSize.qcy,e.qDimensionInfo[0].qStateCounts.qSelected=0),f.resolve(b)});return f.promise},getViewState:function(){return this.isDimensionContinuous?null:{scrollOffset:this.components.scrollArea.getOffset(),axisInnerOffset:this.components.dimensionAxis.getInnerOffset()}},checkPage:function(a){if(!this.isValid(this._data)||!this._pagingMode)return!1;var b=this.components.scrollArea,c=Math.floor(b.getOffset()/this.scrollMultiplicator),d=this._pagingInfo.y,e=this._pagingInfo.height,f=this._pagingMode===D.TWO_DIM?0:20,g=Math.ceil(b.getViewRange()/this.scrollMultiplicator);return isNaN(g)&&(g=500),this._pagingMode===D.TWO_DIM&&(g*=2),c+g>d+e||Math.max(0,c)<d?this.pageData(Math.floor(Math.max(0,c-f)),g+2*f,a):void 0},pageData:function(a,b,c){if("function"!=typeof this.backendApi.getReducedData)return!1;var d=m();if(this._data.qHyperCube){var e,f=this;e="K"===this._data.qHyperCube.qMode?this._data.qHyperCube.qStackedDataPages[0]&&this._data.qHyperCube.qStackedDataPages[0].qData&&this._data.qHyperCube.qStackedDataPages[0].qData.length>0:this._data.qHyperCube.qDataPages[0]&&this._data.qHyperCube.qDataPages[0].qMatrix.length>0,b<=0?("S"===f._data.qHyperCube.qMode?f._data.qHyperCube.qDataPages=[]:f._data.qHyperCube.qStackedDataPages=[],f._pagingInfo.set(a,0,this._data.qHyperCube.qSize.qcx,b)):this.backendApi.getData([{qTop:a,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:b}]).then(function(g){if("S"===f._data.qHyperCube.qMode){f._data.qHyperCube.qDataPages=g;var h=g[0].qArea;f._pagingInfo.set(h.qLeft,h.qTop,h.qWidth,h.qHeight)}else f._data.qHyperCube.qStackedDataPages=g,f._pagingInfo.set(0,a,f._data.qHyperCube.qSize.qcx,b);c||!e?(f._chartContext.refresh(f._data),f.paint(f._data).then(function(){d.resolve()})):f.partialUpdate(f._data).then(function(){d.resolve()})})}else d.resolve();return d.promise},partialUpdate:function(a){var b,c,d,e,f=[];A.call(this),this._chartContext.refresh(a),this.providers.colorMap.setData(a),c=a.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:a.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(c*this.scrollMultiplicator);for(b in this.components)"miniChart"!==b&&this.components[b].invalidateProperties("ScrollableChart.partialUpdate");return this.components.dataArea.updateNow(["properties"]),d=this.components.dataArea.getMajorAxisData(),e=this.components.dataArea.getMinorAxisData(),!e||this._readStoredData&&this.getSnapshotStoredChartData().dataRanges||this.components.measureAxis.setDataRange(e.min,e.max),this.components.dimensionAxis.setDataRange(d.data,d.info),this.components.colorLegend.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),f.push(this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate")),f.push(this.components.colorLegend.invalidateDisplay("ScrollableChart.partialUpdate")),this.isDimensionContinuous?(f.push(this.components.timeAxis.invalidateDisplay("ScrollableChart.partialUpdate")),f.push(this.components.measureAxis.invalidateDisplay("ScrollableChart.partialUpdate")),this.layout()):f.push(this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate")),m.all(f)},_updateData:function(a){if(this._super.apply(this,[].slice.call(arguments)),this._pagingInfo.set(0,0,0,0),this.isValid(a)){var b,c=a.qHyperCube.qStackedDataPages[a.qHyperCube.qStackedDataPages.length-1];b=c&&c.qData?c.qData.length?{qLeft:0,qTop:0,qWidth:a.qHyperCube.qSize.qcx,qHeight:c.qData[0].qSubNodes.length}:c.qArea:a.qHyperCube.qDataPages[0].qArea,this._pagingInfo.set(b.qLeft,b.qTop,b.qWidth,b.qHeight),this.components.dimensionAxis.setInnerOffset(b.qTop*this.scrollMultiplicator)}},updateAxis:function(a){if(this._super.apply(this,[].slice.call(arguments)),this._readStoredData&&this.options.hideChartScrollWithoutMiniChart&&!this.components.scrollArea.getUseMiniChart()?this.components.scrollArea.hideComponent():this.components.scrollArea.showComponent(),this.selections){var b="S"!==a.qHyperCube.qMode||this.isDimensionContinuous&&a.qHyperCube.qDimensionInfo.length>1;w.apply(this,[a.qHyperCube.qDimensionInfo.length,a.qHyperCube.qMeasureInfo.length,b,a.color?a.color.mode:null])}this.tooltips&&this.tooltips.setComponent(["top","bottom"].contains(this.components.dimensionAxis.dock)?"y":"x",this.components.dimensionAxis),this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_disablePagingTransitions:function(){x.call(this)},_enablePagingTransitions:function(){A.call(this)},_postResize:function(){this._super(),this.components.dimensionAxis&&this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_updateMinDiscreteUnitSize:function(a){var b=this._data.qHyperCube.qSize.qcy,c=this._data.qHyperCube,d="S"===c.qMode?"qDataPages":"qStackedDataPages",f=c[d]&&c[d][0]?c[d][0].qArea.qHeight:0;return f>=b&&this.options.components.scrollArea.show===!1?void a.setMinDiscreteUnitSize(null):void(!a.isVisible(this._layoutMode)||"title"===this._data.dimensionAxis.show||"all"===this._data.dimensionAxis.show&&"none"===this._data.dimensionAxis.label?this._layoutMode===e.prototype.ShowFlags.SPARK?a.setMinDiscreteUnitSize(7):a.setMinDiscreteUnitSize(20):a.setMinDiscreteUnitSize(28))},layout:function(){var a;if(this.options.components.scrollArea.show===!1){var b=this.components.dimensionAxis;b._hideMyLabels=!1,a=function(){if(b._discreteSpacing*(b._groupSize||1)<20)return b._hideMyLabels=!0,!0}}this._super(this.components.dimensionAxis.isVertical()?"vertical":"horizontal",a),B.call(this)},setIsDimensionContinuous:function(a){this.isDimensionContinuous!==a&&(this.isDimensionContinuous=a,this.components.scrollArea.setAllowResize(a),this._on&&this._navigation&&(this.isDimensionContinuous?(this._scrollController.off(),this._panZoomController.on(this.namespace)):(this._panZoomController.off(),this._scrollController.on())))},on:function(){this._on||(this._super(),this._navigation&&(this.isDimensionContinuous?this._panZoomController.on(this.namespace):this._scrollController.on()))},off:function(){this._on&&(this._navigation&&(this._scrollController.off(),this._panZoomController.off()),this._super())},destroy:function(){this._super(),this._disablePagingTransitions(),this.components.scrollArea.stopListen("scrollStart"),this.components.dimensionAxisTitle.stopListen("drill-up"),this._panZoomController.release(),this.components.timeAxis&&this.components.timeAxis.stopListen("rendered")}})}),define("objects.backend-api/hypercube-api",["./backend-api"],function(a){"use strict";var b;return b=a.extend("HyperCube",{init:function(a){this._super(a,"/qHyperCubeDef"),this.cacheCube.setMethodName("GetHyperCubeData")},updateCache:function(a){a&&a.qHyperCube?(this.cacheCube.set(a.qHyperCube.qDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear()},getData:function(a,b){return b?this.model.rpc("GetHyperCubeData","qDataPages",[b,a]):this.cacheCube.getData(a)},getHyperCubeBinnedData:function(a,b,c,d){return this.model.rpc("GetHyperCubeBinnedData","qDataPages",[this.path,a,{width:0,height:0},b,c,d,0])},getHyperCubeContinousData:function(a,b){return this.model.rpc("GetHyperCubeContinuousData",null,[this.path,a,b])},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},selectDimensionRange:function(a){var b=a.map(function(a){return{qDimIx:a.idx,qRange:{qMin:a.range.min,qMax:a.range.max,qMinInclEq:!0,qMaxInclEq:!a.range.maxNotIncluded}}});return this.model.rpc("SelectHyperCubeContinuousRange",null,[this.path,b])},selectRange:function(a,b,c){var d;return b=!!b,c=c||[],d=a.map(function(a){return{qMeasureIx:a.idx,qRange:{qMin:a.range.min,qMax:a.range.max,qMinInclEq:a.range.minInclEq!==!1,qMaxInclEq:a.range.maxInclEq!==!1}}}),this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,d,c,b])},select:function(a,b){return this.model.rpc("SelectHyperCubeCells",null,[this.path,a,b])},selectValues:function(a,b,c,d){return this.model.rpc("SelectHyperCubeValues",null,[d||this.path,a,b,c])},getProperties:function(){return this.model.getProperties()},save:function(){return this.model.save()},getDimensionInfos:function(){return this.model.layout.qHyperCube.qDimensionInfo},getMeasureInfos:function(){return this.model.layout.qHyperCube.qMeasureInfo},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections}})}),define("objects.backend-api/stacked-api",["./hypercube-api"],function(a){"use strict";function b(a,b,c){var d,e,f,g=[];for(e=0;e<b.length;e++)for(d=0;d<a.length;d++)f={qType:c,qCol:b[e],qRow:a[d]},g.push(f);return g}var c;return c=a.extend("StackedApi",{init:function(){this._super.apply(this,arguments),this.backendStackThrottle.setMethodName("GetHyperCubeStackData")},updateCache:function(a){a&&a.qHyperCube&&"S"===a.qHyperCube.qMode?(this.cacheCube.set(a.qHyperCube.qDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(a,b){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.rpc("GetHyperCubePivotData","qDataPages",[this.path,a]);case"S":return this._super(a,b);case"K":return b?this._super(a,b):this.backendStackThrottle.getData(a);default:return this._super(a,b)}},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},select:function(a,c,d){switch(this.model.layout.qHyperCube.qMode){case"P":case"K":return this.model.rpc("SelectPivotCells",null,[this.path,b(a,c,d)]);default:return this.model.rpc("SelectHyperCubeCells",null,[this.path,a,c])}}})}),define("objects.views/charts/disclaimers/chart-utils",["util"],function(a){function b(a,b){var c,d,e,f,g,h=b.length;for(a&&(d=!(a.autoMinMax||"min"!==a.minMax&&"minMax"!==a.minMax||null===a.min||isNaN(a.min)),e=!(a.autoMinMax||"max"!==a.minMax&&"minMax"!==a.minMax||null===a.max||isNaN(a.max))),f=Number.MAX_VALUE,g=-Number.MAX_VALUE,c=0;c<h;c++)if(f=Math.min(f,b[c].qMin),g=Math.max(g,b[c].qMax),f<=0&&g>=0)return!0;return f=d?a.min:f,g=e?a.max:g,f<=0&&g>=0}var c={applyDisclaimerAttributes:function(c,d,e,f,g){d||(d={});var h=a.extend({limitedData:!1,hasNegativeOrZeroData:!1,onlyNegativeOrZero:!1,onlyNanData:!1,onlyNullColor:!1,hasDataRangeIncludingZero:!1},d);return a.extend(d,h),d.noDataExist=g.qHyperCube.qSize.qcy*g.qHyperCube.qSize.qcx===0,d.noDataExist?(e.toggleClass("qv-viz-with-disclaimer",!1),d):(c=c||{},c.overlay=c.overlay||!1,c.supportNegative=void 0===c.supportNegative||c.supportNegative,c.supportRangeOverZero=void 0===c.supportRangeOverZero||c.supportRangeOverZero,g.qHyperCube.qDataPages[0]?d.limitedData=!c.paging&&g.qHyperCube.qSize.qcy>g.qHyperCube.qDataPages[0].qMatrix.length:d.limitedData=c.explicitLimitedData===!0,d.hasNegativeOrZeroData=!c.supportNegative&&g.qHyperCube.qMeasureInfo.some(function(a){return a.qMin<=0}),d.onlyNegativeOrZero=!c.supportNegative&&g.qHyperCube.qMeasureInfo.every(function(a){return a.qMax<=0&&a.qMax>=a.qMin})||0===g.qHyperCube.qSize.qcy,d.onlyNanData=g.qHyperCube.qMeasureInfo.every(function(a){return a.qMax<a.qMin||"NaN"===a.qMax}),d.hasDataRangeIncludingZero=!c.supportRangeOverZero&&b(g.measureAxis,g.qHyperCube.qMeasureInfo,g.lineType),d.onlyNegativeOrZero&&c.overlay||!(d.limitedData||d.hasNegativeOrZeroData&&!c.supportNegative||d.hasDataRangeIncludingZero||d.onlyNullColor)?(e.toggleClass("qv-viz-with-disclaimer",!1),f.options.showDisclaimerStar=!1):(e.toggleClass("qv-viz-with-disclaimer",c.bottom),f.options.showDisclaimerStar=!0),d)}};return c}),define("objects.views/charts/components/axis/axis-utils",[],function(){var a={getAxisUnitAlignment:function(a,b){return["near","far"].contains(a)?b?a:"near"===a?"far":"near":b?"left"===a?"near":"far":"bottom"===a?"far":"near"}};return a}),define("text!extensions.qliktech/barchart/barchart.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.noDataExist" direction="options.direction"></div>'}),define("extensions.qliktech/barchart/barchart",["jquery","util","core.utils/deferred","extensions.qliktech/barchart/bararea","extensions.qliktech/barchart/barchart-properties","extensions.qliktech/barchart/barchart-data","extensions.qliktech/barchart/barchart-explore-properties","objects.views/charts/scrollable-chart","objects.backend-api/stacked-api","objects.views/charts/disclaimers/chart-utils","objects.views/charts/components/axis/axis-utils","text!./barchart.ng.html","objects.extension/object-conversion"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a,b,c,d,e,f,g){var h,i=["bottom","top"],j=["left","right"];"horizontal"===g?(h=i,i=j,j=h,e.setDock("right")):e.setDock("bottom"),a.setDock("far"===f.dimensionAxis.dock?i[1]:i[0]),b.setDock("far"===f.dimensionAxis.dock?i[1]:i[0]),d.setDock("far"===f.measureAxis.dock?j[1]:j[0]),c.setDock("far"===f.measureAxis.dock?j[1]:j[0])}var o,p,q=500,r={NONE:0,ONE_DIM:1,TWO_DIM:2};return o=h.extend("BarChart",{namespace:".barchart",init:function(b,c,e,f,g){var h,i=a.extend(!0,{},e);this.$scope=b,e=a.extend(!0,e||{},{components:{dataArea:{clazz:d},miniChart:{components:{dataArea:{clazz:d}}}}},i),this._super(b,c,e,f,g),this._data={},this._tree=null,this.components.dimensionAxis.setMaxDiscreteUnitSize(64),h=this.components.miniChart,this.components.miniChart&&(this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setUseMiniChart(!0),this.components.scrollArea.setMiniChart(this.components.miniChart),h.components.measureAxis.setDock("left"),h.components.dimensionAxis.setDock("bottom"),h.components.dataArea.setMinorAxis(h.components.measureAxis),h.components.dataArea.setMajorAxis(h.components.dimensionAxis),h.components.dataArea.setShowDataPoints(!1),h.setColorMap(this.providers.colorMap)),this._orientation="vertical"},initSelections:function(){this.options._disableSelections||this.selections.Select.bind(function(a,b){var c=this.selections.getActiveType().activeComponent.getSelectionIndices()||[];this.onSelection.Select.apply(this,[a,b,c,"L"])}.bind(this)),this._super()},isValid:function(a){return this._super(a)&&!this.supressChartRendering},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var a,b=this._data,d=this.components.scrollArea,e=this.getSnapshotStoredChartData(),f="vertical"===b.orientation?this.rect.height:this.rect.width,g=0,h=[];this._cutMode?((this._cutMode.positive||this._cutMode.negative)&&(g=this._layoutMode>=15?32:this._layoutMode>=7?16:8),"vertical"===b.orientation?this.components.measureAxis.setPadding(this._cutMode.positive?g:0,0,this._cutMode.negative?g:0,0):this.components.measureAxis.setPadding(0,this._cutMode.positive?g:0,0,this._cutMode.negative?g:0)):this.components.measureAxis.setPadding(0,0,0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(f/4)));var i=this.components.dataArea.getMajorAxisData().info.map(function(a){return a.show});if(this.components.colorLegend.updateNow(["properties"]),b.qHyperCube.qDimensionInfo.length>1&&"grouped"===b.barGrouping.grouping&&this.components.colorLegend.isVisible(this._layoutMode)&&this.providers.colorMap){var j=this.providers.colorMap.getColorDataInfo();j&&"dimension"===j.legendMode.colorMode&&(i[this.providers.colorMap.getDimensionIndex()]=!1)}this.components.dimensionAxis.setLabelLevelVisibility(i),this.layout(),this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(h.push(this.components.miniChart.setData(b)),this._dataForMiniChartChanged=!1),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(e.axisInnerOffset),this.components.scrollArea.setOffset(e.scrollOffset)):this.options.viewState&&(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset));var k=this.checkPage();if(k)h.push(k);else{for(a in this.components)h.push(this.components[a].invalidateDisplay("BarChart.paint"));d.viewState.min+d.viewState.range>d.fullState.max&&d.setOffset(d.fullState.max-d.viewState.range)}return c.all(h)},prePaint:function(a){this._super(a),j.applyDisclaimerAttributes({paging:!0,bottom:!0},this.$scope.dataAttributes,this.$element,this.$scope,a),this.supressChartRendering=this.$scope.dataAttributes.noDataExist},_updateData:function(a){this._checkPage=!1,this._disablePagingTransitions.call(this),this._data=a,this._dataForMiniChartChanged=!0,this.isStacked="stacked"===a.barGrouping.grouping&&(a.qHyperCube.qDimensionInfo.length>1||a.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,this.components.scrollArea.setUseMiniChart(!0),this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.colorLegend.setData(a),this.components.dimensionAxisTitle.setData(a),this.components.measureAxisTitle.setData(a),a.orientation&&this.components.miniChart?(this._orientation!==a.orientation&&(this.components.miniChart.clear(),this._orientation=a.orientation),this.components.miniChart.setOrientation(a.orientation)):this._orientation=a.orientation;var b={axes:{measureAxis:{component:this.components.measureAxis},dimensionAxis:{component:this.components.dimensionAxis}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle},measureAxisTitle:{component:this.components.measureAxisTitle}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.refLineLabels}},refLines:{component:this.components.refLines}},c=null,d=this.getSnapshotStoredChartData();this.scrollMultiplicator=a.qHyperCube.qDimensionInfo.length<2&&"grouped"===a.barGrouping.grouping&&a.qHyperCube.qMeasureInfo.length>1?a.qHyperCube.qMeasureInfo.length+1:1,this._pagingMode=r.NONE,this.components.dataArea._allowInnerSelection=!1,a.qHyperCube.qDimensionInfo.length<2&&a.qHyperCube.qSize.qcy>q?(c=a.qHyperCube.qSize.qcy,"grouped"===a.barGrouping.grouping&&a.qHyperCube.qMeasureInfo.length>1&&(this.scrollMultiplicator=a.qHyperCube.qMeasureInfo.length+1,c*=this.scrollMultiplicator),this._pagingMode=r.ONE_DIM):a.qHyperCube.qDimensionInfo.length>1&&"grouped"===a.barGrouping.grouping?(a.qHyperCube.qSize.qcy>q&&(this._pagingMode=r.TWO_DIM,c=a.qHyperCube.qSize.qcy),this.components.dataArea._allowInnerSelection=a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1):a.qHyperCube.qDimensionInfo.length>1&&(this.components.dataArea._allowInnerSelection=a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1,c=this.isStacked?a.qHyperCube.qStackedDataPages&&a.qHyperCube.qStackedDataPages.length&&a.qHyperCube.qStackedDataPages[0].qData&&a.qHyperCube.qStackedDataPages[0].qData.length?a.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+a.qHyperCube.qStackedDataPages[0].qData[0].qDown:a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected:a.qHyperCube.qDataPages[0].qMatrix.length+a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected,this._pagingMode=r.ONE_DIM),this.components.dimensionAxis.isDiscrete()||(this._pagingMode=r.NONE),this.components.dimensionAxis.setNumDiscreteUnits(c),this._super(a,b),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(d.axisInnerOffset),this.components.scrollArea.setOffset(d.scrollOffset)):this.options.viewState?(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset)):isNaN(a.scrollStartPos)?(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)):this.components.scrollArea.setRelativeOffset(a.scrollStartPos),this._checkPage=!0},updateDataArea:function(a){this.components.dataArea.setShowDataPoints(a.dataPoint.showLabels),this.components.dataArea.setGroupingMode(a.barGrouping.grouping),this.components.miniChart&&this.components.miniChart.components.dataArea.setGroupingMode(a.barGrouping.grouping),this.components.dataArea.updateNow(["properties"])},updateAxis:function(c,d){var e,f,g,h,i,j,l,m,o,q,r,s,t=this.getSnapshotStoredChartData(),u=c.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return{min:a.qMin,max:a.qMax,index:c.qHyperCube.qMeasureInfo.indexOf(a)}});m=u.reduce(function(a,b){return a.min<b.min?a:b},u[0]),o=u.reduce(function(a,b){return a.max>b.max?a:b},u[0]),q=m?m.min:p,r=o?o.max:p,b.isNumeric(q)||(q=0),b.isNumeric(r)||(r=1),e=this.components.measureAxis,f=this.components.dimensionAxis,g=this.components.dimensionAxisTitle,h=this.components.measureAxisTitle;var v=this.components.dataArea.getMajorAxisData(),w=this.components.dataArea.getMinorAxisData();f.setDataRange(v.data,v.info),g.setSelectionsEnabled(!!this.selections),h.setSelectionsEnabled(!!this.selections),a.extend(d.axes.measureAxis,{data:a.extend(!0,{},c.measureAxis,{logarithmic:!1}),dataIndices:c.qHyperCube.qMeasureInfo.map(function(a,b){return b})}),a.extend(d.axes.dimensionAxis,{data:c.dimensionAxis,dataIndices:c.qHyperCube.qDimensionInfo.map(function(a,b){return b}),currentDataIndices:[0]}),a.extend(d.axisTitles.dimensionAxisTitle,{data:c.dimensionAxis}),a.extend(d.axisTitles.measureAxisTitle,{data:c.measureAxis}),l=d.axes.measureAxis,s=this.getAxisOptions(l),d.refLineLabels.labels.axis=e,n.apply(this,[f,g,e,h,this.components.scrollArea,c,this._orientation]),this._super(c,d);for(j in d.axes)i=d.axes[j],i.component.setDataIndices(i.dataIndices||[i.dataIndex||0]),i.component.setCurrentDataIndices(i.currentDataIndices||i.dataIndices||[i.dataIndex||0]);r<q?(r=10,q=-10):q===r&&0===r&&(r=10,q=-10),r=Math.max(0,r),q=Math.min(0,q),m&&o?(this._cutMode=this.getSpikeSettings(c,m,o,q,r,s),r=this._cutMode.max,q=this._cutMode.min):this._cutMode={positive:!1,negative:!1},this._readStoredData&&t.dataRanges&&t.dataRanges[0]?this.setAxisDataRange(e,t.dataRanges[0].max,t.dataRanges[0].min,s.max,s.min,1):w?this.setAxisDataRange(e,w.max,w.min,s.max,s.min,1):this.setAxisDataRange(e,r,q,s.max,s.min,1),"none"===c.measureAxis.show?f.setUnitAlignment("center"):this.components.dimensionAxis.setUnitAlignment(k.getAxisUnitAlignment(c.measureAxis.dock,f.isHorizontal()))},getSpikeSettings:function(a,b,c,d,e,f){for(var g,h,i=0,j=0,k=0,l=0,m=!1,n=!1,o=c.index+a.qHyperCube.qDimensionInfo.length,p=b.index+a.qHyperCube.qDimensionInfo.length,q=a.qHyperCube.qDataPages[0]?a.qHyperCube.qDataPages[0].qMatrix:[],r=0;r<q.length;r++)g=q[r],h=g[o].qNum,h>0&&!isNaN(h)&&(g[0].qIsOtherCell||g[1].qIsOtherCell?k=Math.max(h,k):i=Math.max(h,i)),h=g[p].qNum,h<0&&!isNaN(h)&&(g[0].qIsOtherCell||g[1].qIsOtherCell?l=Math.min(h,l):j=Math.min(h,j));return this.isStacked&&a.qHyperCube.qMeasureInfo.length+a.qHyperCube.qDimensionInfo.length>2||(null!==f.max&&f.max<e?m=f.max>0:i>0&&k/i>5&&(e=i,m=e>=0),null!==f.min&&f.min>d?n=f.min<0:j<0&&l/j>5&&(d=j,n=d<0)),{max:e,min:d,positive:m,negative:n}},getPreferredSize:function(){return this._super()},setOrientation:function(a){this._orientation=a||"horizontal"},getOrientation:function(){return this._orientation}}),{type:"barchart",BackendApi:i,template:l,View:o,definition:e,softDefinition:g,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:q,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0},options:{selections:{dataArea:{},range:{},colorLegend:{}},tooltips:{}},data:f,importProperties:function(a,b,c){var d=m.axisChart.importProperties.apply(m,[a,b,c]),e=d.qProperty;return e.qHyperCubeDef.qDimensions.length>1&&"stacked"===e.barGrouping.grouping&&(e.qHyperCubeDef.qMode="K"),d},exportProperties:m.axisChart.exportProperties.bind(m)}}),define("extensions.qliktech/piechart/piechart-label-modes",[],function(){"use strict";var a={NONE:0,SHARE:1,VALUE:2};return a}),define("extensions.qliktech/piechart/piearea-helper",["objects.views/charts/renderers/canvas-renderer","objects.views/charts/components/axis/radial-axis-helper","general.utils/color","extensions.qliktech/piechart/piechart-label-modes"],function(a,b,c,d){function e(a,b){return Math.round(100*a*Math.pow(10,b))/Math.pow(10,b)}function f(a){return a/360*Math.PI*2%(2*Math.PI)}function g(b,c,d,e,f,g,j,k){if(k)return h(b,c,d,f,g);var l,m,n,o,p,q=d.end-d.start,r=d.radius,s=.4,t=(d.arcCenter+e)%(2*Math.PI),u=(t+Math.PI)%(2*Math.PI);return p=b.font===f&&b.text===c?b.pieLabelMeasures:a.measureText(c,f),q<0&&(q+=2*Math.PI),l=i(q>s&&p.width<q*r,u),m="center"===l,n=r*Math.cos(t)+(m?Math.cos(t)*p.width/2:0)+(m?-p.width/2:"right"===l?-p.width:0),o=r*Math.sin(t)+(m?Math.sin(t)*p.height/2:0),b.baseline="middle",b.align="left",b.fill=g,b.font=f,b.text=c,b.textAlign=l,b.x=n,b.y=o,b.width=p.width,b.laHeight=p.height,b.arcCenter=u,b.arcLength=q,b.pieLabelMeasures=p,b}function h(b,c,d,e,f){var g=d.radius,h=e.split("px"),i=h[1],j=a.measureText(c,e),k=Math.min(2*g/j.width,8),l=11,m=Math.min(100,Math.max(g/10*k*.3,l)),n=m+"px"+i;return b.fill=f,b.text=c,b.font=n,b.align="center",b.baseline="bottom",b.x=0,b.y=0,b.maxWidth=1.3*g,b.visible=!0,b}function i(a,b){return a?"center":b<Math.PI/2||b>1.5*Math.PI?"right":"left"}function j(b,c,d,e,f,g,h,i,j,l){if(j)return k(b,c,e,l,d);var m,n,o,p,q,r,s=(e.arcCenter+f)%(2*Math.PI),t=(s+Math.PI)%(2*Math.PI),u=i?i:a.measureText(c,h);return q=g?e.innerRadius:e.radius,m=t<Math.PI/2||t>1.5*Math.PI,n=t>Math.PI,r=.07*(m?1:-1)*(n?1:-1)*Math.abs(Math.sin(t)),o=.95*q*Math.cos(s)+e.cx-(m?-1:1)*(Math.abs(Math.cos(t))*u.width/2),p=.95*q*Math.sin(s+r)+e.cy-(n?1:-1)*(Math.abs(Math.sin(t))*u.height/2),b.fill=d,b.x=o,b.y=p,b.text=c,b.font=h,b.align="center",b.baseline="middle",b.maxWidth=1.4*u.width,b}function k(b,c,d,e,f){if(!e)return b;var g,h=d.radius,i=e.split("px"),j=i[0],k=i[1],l=.8*j,m=10,n=l+"px"+k,o=a.measureText(c,n);return o.width>1.2*h&&(g=1.2*h/o.width,l=Math.max(l*g,m),n=l+"px"+k),b.fill=f,b.text=c,b.font=n,b.align="center",b.baseline="top",b.maxWidth=1.3*h,b.x=d.cx,b.y=d.cy,b}function l(a,b,d,e,f){return d||c.useDarkLabel(e,f)?b:a}function m(a,b,c){if(a.length<2)return[];var d,e,f,g,h=Math.min(c.width,c.height),i=[],j=[],k=[],l=[],m=[],o=[];for(f=0;f<a.length;f++)o.push({label:a[f],line:b[f]});for(o.sort(function(a,b){return a.label.arcCenter>b.label.arcCenter?1:-1}),f=0;f<a.length;f++)switch(e=o[f],d=e.label,g=d.arcCenter,d.quartile=t(g),d.quartile){case 1:i.push(e);break;case 2:j.push(e);break;case 3:k.push(e);break;case 4:l.push(e)}return m=i.concat(j.reverse()).concat(k).concat(l.reverse()),m=n(m,h,c)}function n(a,c,d){var e,f,g,h,i,j,k,l,m,n,t,u,v,w,x=10,y=20;for(m=0;m<a.length;m++){e=a[m].label,j=e.x,k=e.y,g=b.getPolPos({x:j,y:k}),h=e.arcCenter<Math.PI/2||e.arcCenter>3*Math.PI/2,y=Math.max(Math.min(y,g.r/15),5),i=b.getCartPos({r:g.r+y,a:g.a}),j=i.x,k=i.y,0!==m&&(f=a[m-1].label,l=f.y),f&&r(e.quartile,f.quartile)?(u=q(k,l,e.quartile,f.quartile,h,e.laHeight),v=Math.abs(u),l=k+u+2*(u>0?1:-1)):(t=e.arcLength*c/3,v=e.laHeight-t,l=k+(v>0?v*(1===e.quartile||2===e.quartile?1:-1):0)),v>x?(w={x:e.x,y:e.y},o(a[m],w,{x:j,y:l})):a[m].line.strokeWidth=0,e.x=j,e.y=l,e=p(e,d),e.maxWidth=e.width,e.width=null,"center"===a[m].label.textAlign&&v>x&&(a[m].line.x1+=Math.cos(a[m].label.arcLength)*(h?1:-1)*a[m].label.maxWidth/2,a[m].line.x2+=(h?1:-1)*a[m].label.maxWidth/4,a[m].line.y1+=Math.sin(a[m].label.arcLength)*(h?1:-1)*e.laHeight/2,a[m].line.y2+=(h?1:-1)*e.laHeight/2,a[m].line.strokeWidth=1),n=e.y+d.height/2+e.laHeight*(s(e.quartile)?.5:-.5);var z=-n>0||n-d.height>0;a[m].label.visible=!z,a[m].line.visible=!z}return a}function o(a,b,c){var d,e,f,g,h={r:Math.sqrt(b.x*b.x+b.y*b.y),a:Math.atan2(b.y,b.x)},i={r:Math.sqrt(c.x*c.x+c.y*c.y),a:Math.atan2(c.y,c.x)},j=a.label.textAlign,k=2,l=3;return d=(h.r+k)*Math.cos(h.a),e=(h.r+k)*Math.sin(h.a),f=(i.r-l)*Math.cos(i.a),g=(i.r-l)*Math.sin(i.a),a.line.x1=d+("right"===j?a.label.width:0),a.line.y1=e,a.line.x2=f+("right"===j?a.label.width:0),a.line.y2=g,a}function p(a,b){var c={x:b.width/2,y:b.height/2
};switch(a.textAlign){case"left":a.x+a.width>b.width-c.x&&(a.width-=a.x+a.width-(b.width-c.x));break;case"right":a.x<-c.x&&(a.width+=a.x+c.x,a.x=-c.x);break;case"center":a.x<-c.x?(a.width+=a.x+c.x,a.x=-c.x):a.x+a.width>b.width-c.x&&(a.width-=a.x+a.width-(b.width-c.x))}return a}function q(a,b,c,d,e,f){var g;return g=(a-b)*(1===d||2===c?1:-1)<f?b-a+f*(e&&3===c||!e&&4===c?-1:1):0}function r(a,b){return a===b||3===a&&2===b}function s(a){return 1===a||2===a}function t(a){var b=1;return a>=1.5*Math.PI?b=2:a<=Math.PI/2?b=3:a>Math.PI/2&&a<Math.PI&&(b=4),b}function u(a,d,e,f,g){var h,i;return h=b.getCartPos({r:g.radius-1,a:g.start+g.radianOffset},{x:g.cx,y:g.cy}),i=b.getCartPos({r:g.innerRadius+1,a:g.start+g.radianOffset},{x:g.cx,y:g.cy}),a.x1=h.x,a.y1=h.y,a.x2=i.x,a.y2=i.y,a.strokeWidth=1,e&&c.getContrast(d,e)>1.2?a.stroke=d.toHex():a.stroke=d.isDark()?"#ccc":"#333",a}function v(a,b,c,e){var f;return f=b&&e||c===d.VALUE?a.pieData.label:a.pieData.formattedShare.toString()+" %"}return{getFormattedPercentageValue:e,getRadianOffset:f,updateNameLabel:g,updateValueLabel:j,getLabelColor:l,improveNameLabelPositions:m,updateLabel:o,checkQuartile:t,isBottomQuartile:s,checkRelevantQuartile:r,checkInterference:q,checkEllipsis:p,updateDivider:u,getValueText:v}}),define("extensions.qliktech/piechart/piearea",["objects.views/charts/components/chart-component","objects.views/charts/shapes/arc","objects.views/charts/shapes/circle","objects.views/charts/shapes/line","objects.views/charts/shapes/text","objects.views/charts/shapes/container","objects.views/charts/utils/tree-iterator","objects.views/charts/renderers/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/piechart/piearea-helper","translator","general.utils/color","extensions.qliktech/piechart/piechart-label-modes","core.utils/deferred"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(a,b){var c={backgroundColor:a.getValue(v,null,"backgroundColor"),dataPoint:{},dataValue:{},shape:{},line:{}};return c.dataPoint.label={font:a.getFont(v,"item.name",b),color:{dark:a.getValue(v,"item.name","color","dark"),light:a.getValue(v,"item.name","color","light")}},c.dataValue.label={font:a.getFont(v,"item.value",b),color:{dark:a.getValue(v,"item.value","color","dark"),light:a.getValue(v,"item.value","color","light")}},c.shape={border:{width:a.getValue(v,"item.shape.border","width")},selected:{border:{width:a.getValue(v,"item.shape.border","width","selected"),color:a.getValue(v,"item.shape.border","color","selected")}}},c.line={color:a.getValue(v,"item.line","color"),width:a.getValue(v,"item.line","width")},c}function p(a,b,c,d,e,f){a?(c.strokeWidth=b.shape.selected.border.width,c.stroke=b.shape.selected.border.color,c.opacity=w,c.zIndex=1,d.opacity=1,f.opacity=1,e.opacity=1):(c.opacity=void 0,c.strokeWidth=void 0,c.stroke=void 0,c.zIndex=void 0,d.opacity=void 0,f.opacity=void 0,e.opacity=void 0)}function q(a){a>300?this._fontSize="large":a>200?this._fontSize="medium":a>100?this._fontSize="small":this._fontSize="tiny"}function r(a,b,c){return a.set(0,0,this._showAsDonut?this._innerRadius:0,this._radius,b,b+c,this._radianOffset),a}function s(){if(!this._data||!this._tree)return n.resolve();var a,b,c,d,e,f,g,i,k,o,p,q,s,t,u,v,w,x,y,z,A,B,C=this._tree,D=this._itemData.length,E=C.children.length,F=0,G=0,H=[],I=[],J=this._styles,K=this,L=new l(J.backgroundColor).isDark();this.beforeRenderPie(this._tree,m),this._radianOffset=j.getRadianOffset(this._currentProperties.rotation+90);var M=(this._radianOffset<0?this._radianOffset+2*Math.PI:this._radianOffset)%(2*Math.PI);if(y={nameLabel:{font:J.dataPoint.label.font,color:"#f00"},dataLabel:{font:J.dataValue.label.font,color:"#f00"}},E){for(u=1===this._numSlices,b=0;b<D;b++){if(c=this._itemData[b],!c.pieData||c.pieData.value<=0)return n.resolve();G=Math.min(2*Math.PI*c.pieData.share,2*Math.PI),f=K._arcs[c.pieData.shpIndex],g=c.parent.cacheItem.selected,r.apply(K,[f,F-Math.PI,G]),x={border:{color:"white",width:0}},u&&!K._showAsDonut?(p=K._singleItemCircle,p.set(0,0,f.radius)):p=f,s=K._dividers[c.pieData.shpIndex],s.visible=!1,g||u||(s=K._dividers[c.pieData.shpIndex],s.visible=!0,j.updateDivider.call(this,s,c.pieData.color,e,x.border,p),K.dividerAddedToRender(s)),K.pieAddedToRender(c,p),K._showDimensionValues&&(d=u?j.getLabelColor(J.dataPoint.label.color.light,J.dataPoint.label.color.dark,K._showAsDonut,c.pieData.color,L):L?J.dataPoint.label.color.light:J.dataPoint.label.color.dark,i=j.updateNameLabel(K._nameLabels[c.pieData.shpIndex],c.pieData.title,f,M,y.nameLabel.font,d,K.rect,u),H.push(i),q=K._lines[c.pieData.shpIndex],q.stroke=J.line.color,q.strokeWidth=J.line.width,q.x1=0,q.y1=0,q.x2=0,q.y2=0,I.push(q)),F+=G,e=c.pieData.color}if(this._valueLabelContainer.removeChildren(),!this._data.dataPoint.auto||this._layoutMode>3)for(a=0;a<this._sortedIndices.length;a++){if(t=this._itemData[this._sortedIndices[a].idx],!t.pieData||t.pieData.value<=0)return n.resolve();f=K._arcs[t.pieData.shpIndex],v=f.start,w=f.end,w+=v*w<0?2*Math.PI:0,o=j.getValueText(t,this._data.dataPoint.auto,this._dataPointsLabelMode,u),k=K._valueLabels[t.pieData.shpIndex],k.text!==o||y.dataLabel.font!==k.font?(k.text=o,z=h.measureText(o,y.dataLabel.font)):z=k.pieLabelMeasures,k.pieLabelMeasures=z,B=(f.arcCenter+f.radianOffset)%(2*Math.PI),A=(B+Math.PI)%(2*Math.PI);var N=w===v?2*Math.PI:w>=v?w-v:v-w,O=Math.abs(Math.cos(A))*z.height*2+Math.abs(Math.sin(A))*z.width*2;if(!(this._dataPointsLabelMode!==m.NONE&&f.radius*N>O))break;d=j.getLabelColor(J.dataValue.label.color.light,J.dataValue.label.color.dark,this._showAsDonut,t.pieData.color,L),k=j.updateValueLabel(k,o,d,f,M,this._showAsDonut,y.dataLabel.font,z,u,i?i.font:null),k.maxWidth<(this._showAsDonut?f.innerRadius:f.radius)*(u?2:1)&&this._valueLabelContainer.addChild(k)}}j.improveNameLabelPositions(H.concat(),I,K.rect),this._nameLabelContainer.removeChildren(),this._lineContainer.removeChildren();var P=[],Q=[];for(a=0;a<H.length;a++)H[a].visible!==!1&&P.push(H[a]),I[a].visible!==!1&&Q.push(I[a]);return this._nameLabelContainer.addChildren(P),this._lineContainer.addChildren(Q),this._prevRect&&this._prevRect.w===this.rect.width&&this._prevRect.w===this.rect.height||(this._prevRect={w:this.rect.width,h:this.rect.height},this._renderRoot.clearTransform(),this._renderRoot.translate(this.rect.width/2,this.rect.height/2)),this.renderers.pie.render(!0)}var t,u=1,v="pieChart",w=1;return t=a.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._arcs=[],this._nameLabels=[],this._valueLabels=[],this._lines=[],this._dividers=[],this._itemData=[],this._labelRects=[],this._cacheItems=[],this.renderers={pie:new h(this.container,{name:"pie"})},this.renderers.pie.setCompositingEnabled(!1),this._renderRoot=new f,this._rotationContainer=new f,this._arcContainer=new f,this._dividerContainer=new f,this._nameLabelContainer=new f,this._valueLabelContainer=new f,this._lineContainer=new f,this._rowToShapeMapping={},this._dividerContainer.strokeWidth=1,this._arcContainer.lineJoin="round",this._rotationContainer.addChildren([this._arcContainer,this._dividerContainer]),this._renderRoot.addChildren([this._rotationContainer,this._nameLabelContainer,this._valueLabelContainer,this._lineContainer]),this.renderers.pie.stage.addChild(this._renderRoot),this._singleItemCircle=new c(0,0,0),this._singleItemCircle.type="circle",this._fontSize="large",this._styles={},this._styleService=i.getInstance(),this._transitionHelper.setTransitionCurve("easeout"),this._maxSizeRatio=.8,this._showValueTextInsideSlice=!1,this._showDimensionValues=!0,this._showAsDonut=!1,this._showLabels=!0,this._recalculcating=!1,this._currentProperties.rotation=0,this._transitionProperties.rotation=0,this._hasNegativeValues=!1,this._innerRadiusRatio=.7},beforeRenderPie:function(){},pieAddedToRender:function(){},dividerAddedToRender:function(){},afterPaint:function(){return n.resolve()},setShowDimensionValues:function(a){this._showDimensionValues=a,this.invalidateDisplay("setShowDimensionValues")},getShowDimensionValues:function(){return this._showDimensionValues},setRotation:function(a){this._transitionProperties.rotation=a,this._transition()},getRotation:function(){return this._transitionProperties.rotation},setScaleRatio:function(a){this._maxSizeRatio=a,this.invalidateDisplay("setScaleRatio")},getScaleRatio:function(){return this._maxSizeRatio},setShowAsDonut:function(a){this._showAsDonut=a,this.invalidateDisplay("setShowAsDonut")},getShowAsDonut:function(){return this._showAsDonut},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setDataPointsLabelMode:function(a){switch(a){case"value":this._dataPointsLabelMode=m.VALUE;break;case"share":this._dataPointsLabelMode=m.SHARE;break;default:this._dataPointsLabelMode=m.NONE}this.invalidateDisplay("setDataPointsLabelMode")},getDataPointsLabelMode:function(){return this._dataPointsLabelMode},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay("setDimensionTree")},updateSize:function(){this._super()},_updateProperties:function(){if(this._data&&this._tree){this._itemData=[];var a,c,f,h,i,l,m=[],n=this._data.qHyperCube.qDimensionInfo.length,o=this._tree,q=n+1,r=0,s=this._arcs.length,t=o.children.length,v=this.measureFormatters[0],w=this,x=this.selectionIdentifier?this.selectionIdentifier:"dataArea";this._numSlices=0,this._arcContainer.removeChildren(),this._dividerContainer.removeChildren(),this._rowToShapeMapping={};var y,z,A,B,C,D=this._arcContainer,E=this._dividerContainer;t&&(g.each.call(o,function(j,k){if(c=g.getLevel.call(j),j.idx=k,c===q){if(f=j.data.qNum,isNaN(f)||f<=0)return void((n<=1||k<=0)&&(a=j.parent.cacheItem,m.push(a)));w._numSlices++,i=j.parent.data.qText,l="U"!==v.type?j.children[0].data.qText:v.formatValue(j.data.qNum),j.pieData={value:f,title:i,color:null,label:l},j.pieData.shpIndex=r++,h=null!=w._colorMap?w._colorMap.getColor(j.parent.data.qElemNo,f,0,j.parent.idx):null,j.pieData.color=h,s<r?(y=new b(0,0,0,0,0,0,0),C=new d(0,0,0,0),z=new e,A=new e,B=new d(0,0,0,0),w._arcs.push(y),w._nameLabels.push(z),w._valueLabels.push(A),w._lines.push(B),w._dividers.push(C)):(y=w._arcs[j.pieData.shpIndex],z=w._nameLabels[j.pieData.shpIndex],A=w._valueLabels[j.pieData.shpIndex],B=w._lines[j.pieData.shpIndex],C=w._dividers[j.pieData.shpIndex]),w._rowToShapeMapping[j.data.rowIndex]=j.pieData.shpIndex,p(!1,w._styles,y,z,A,B),y.fill=h.toRGBA(),D.addChild(y),E.addChild(C),a=j.parent.cacheItem,t>1||w._showAsDonut?(a.addShape(x,y),a.addShape(x,z)):a.addShape(x,w._singleItemCircle),m.push(a),w._itemData.push(j)}}),this._singleItemCircle.opacity=void 0,this._singleItemCircle.strokeWidth=0,this._singleItemCircle.stroke="white",1!==w._itemData.length||w._showAsDonut||(this._singleItemCircle.fill=w._itemData[0].pieData.color.toRGBA(),D.removeChildren(),D.addChild(this._singleItemCircle),E.removeChildren())),this.setSelectableShapes(m),this._sortedIndices=this._itemData.map(function(a,b){return{value:a.pieData.value,idx:b}}),this._sortedIndices.sort(function(a,b){return a.value<b.value?1:-1});var F,G,H=0;this._numNonZero=0,this._itemData.forEach(function(a){H+=a.pieData.value,w._numNonZero+=a.pieData.value>0?1:0}),this._itemData.forEach(function(a){F=a.pieData.value/H,a.pieData.share=F,G=j.getFormattedPercentageValue(F,w._data.dataPoint.sharePrecision?w._data.dataPoint.sharePrecision:u),a.pieData.formattedShare=G,a.parent.cacheItem.addMeasure(k.get("properties.dataPoints.labelmode.share"),G+" %",G+" %")}),this._super()}},hasValidData:function(){return this._super()&&this._data&&this._tree},_onAnimatitonEnd:function(){this._super(),this.getRotation()%360===0&&(this._currentProperties.rotation=this._transitionProperties.rotation=0)},paint:function(){return this._super(this._layoutMode,this._data),this._radius=this._maxSizeRatio*Math.min(this.rect.width,this.rect.height)/2,this.renderers.pie.stage.opacity=this._globalAlpha||1,this._dividerContainer.opacity=.4*this._globalAlpha,q.apply(this,[this._radius]),this._styles=o(this._styleService,this._fontSize),this._innerRadius=this._innerRadiusRatio*this._radius,s.call(this).then(function(){return this.afterPaint()}.bind(this))},toggleCacheItem:function(a){var b=!0,c=this._styles;this.renderers.pie.stage.opacity!==this._globalAlpha&&(b=!1,this.renderers.pie.stage.opacity=this._globalAlpha);var d=this._rowToShapeMapping[a.row],e=this._arcs[d],f=this._nameLabels[d],g=this._valueLabels[d],h=this._lines[d];e&&(p(a.selected,c,e,f,g,h),b&&(e.invalidate(),f.invalidate(),h.invalidate(),g.invalidate())),1===this._itemData.length&&(a.selected?(this._singleItemCircle.opacity=w,this._singleItemCircle.strokeWidth=c.shape.selected.border.width,this._singleItemCircle.stroke=c.shape.selected.border.color):(this._singleItemCircle.opacity=void 0,this._singleItemCircle.strokeWidth=0,this._singleItemCircle.stroke="white"),b&&this._singleItemCircle.invalidate()),b||this.renderers.pie.render(!0)}})}),define("extensions.qliktech/piechart/piechart-properties",["client.utils/property-resolver","client.utils/default-property-logic"],function(a,b){var c,d,e=b.getLogicFor("hard","piechart");c={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showAsDonut:{ref:"donut.showAsDonut",type:"boolean",component:"item-selection-list",defaultValue:!1,horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.pie",value:!1},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.donut",value:!0}]},labels:{type:"items",snapshot:{tid:"property-labels"},items:{dimensionTitle:{ref:"dimensionTitle",type:"boolean",component:"switch",translation:"properties.dataPoints.dimensionlabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},valuesAuto:{ref:"dataPoint.auto",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},labelMode:{ref:"dataPoint.labelMode",type:"string",component:"dropdown",options:[{value:"none",translation:"Common.None"},{value:"share",translation:"properties.dataPoints.labelmode.share"},{value:"value",translation:"properties.dataPoints.labelmode.value"}],defaultValue:"share",show:function(b){return!a.getValue(b,"dataPoint.auto")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{colorMode:{defaultValue:"byDimension"}},legend:{items:{show:{defaultValue:!1,show:e.legend.show,snapshot:{tid:"property-legend"}},showTitle:{show:e.legend.showTitle.show},dock:{show:e.legend.dock.show}}}}}}};var f={uses:"data",items:{dimensions:{uses:"dimensions"},measures:{uses:"measures",items:{numberFormatting:{items:{percentOfPieMessage:{component:"text",translation:"properties.numberFormatting.pieMessage",show:function(b,c){return c&&(a.getValue(c,"properties.dataPoint.auto")||"share"===a.getValue(c,"properties.dataPoint.labelMode"))}}}}}}}};d={uses:"sorting"};var g={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:f,sorting:d,addons:g,settings:c}}}),define("extensions.qliktech/piechart/piechart-data",["client.utils/property-resolver"],function(a){function b(a){1===a.getDimensions().length&&1===a.getMeasures().length&&(a.getMeasures()[0].qSortBy.qSortByNumeric=-1,1!==a.getSorting()[0]&&a.changeSorting(1,0))}function c(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byExpression"===e&&0===d.length&&a.setValue(b,"color.mode","primary")}function d(a,c){a.qOtherTotalSpec.qOtherMode="OTHER_COUNTED",a.qOtherTotalSpec.qOtherCounted={qv:"10"},b(c)}return{dimensions:{add:function(a,b,c){d(a,c)},move:function(a,b,c){d(a,c)},replace:function(a,b,c,e,f){d(a,f)},min:1,max:1},measures:{min:1,max:1,add:function(a,c,d){b(d)},remove:function(a,b,d){c(b,d)}}}}),define("extensions.qliktech/piechart/piechart-explore-properties",[],function(){return{type:"items",component:"accordion",items:{data:{uses:"data"},sort:{uses:"sort"},presentation:{uses:"presentation",items:{showAsDonut:{ref:"donut.showAsDonut",type:"boolean",component:"item-selection-list",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.pie",value:!1},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.donut",value:!0}]},labelMode:{type:"items",items:{labelMode:{type:"string",component:"radio-list",translation:"properties.dataPoints.labelmode",diffs:["dataPoint.auto:false","dataPoint.labelMode"],options:function(){return[{value:"none",translation:"Common.None"},{value:"share",translation:"properties.dataPoints.labelmode.share"},{value:"value",translation:"properties.dataPoints.labelmode.value"}]},setPropertyValue:function(a,b){a.dataPoint.auto=!1,a.dataPoint.labelMode=b},getValue:function(a){return a.dataPoint.auto?"":a.dataPoint.labelMode}}}}}},color:{uses:"color"}}}}),define("text!extensions.qliktech/piechart/piechart.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero" direction="options.direction"></div>'}),define("extensions.qliktech/piechart/piechart",["jquery","core.utils/deferred","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.views/charts/components/data-title/data-title","./piearea","objects.views/charts/representation/combo-color-map","objects.backend-api/hypercube-api","extensions.qliktech/piechart/piechart-properties","extensions.qliktech/piechart/piechart-data","extensions.qliktech/piechart/piechart-explore-properties","text!./piechart.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/selections/interaction-handler","objects.views/selections/interaction-type"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){var b=a.getRotation(),c=b%360,d=c>180?b+360-c:b-c;a.setRotation(d)}function s(a){void 0!==a&&this.components.dataArea.setRotation(a)}function t(a){return a&&!(a.qHyperCube.qMeasureInfo.every(function(a){return a.qMax<=0&&a.qMax>=a.qMin})||0===a.qHyperCube.qSize.qcy)}var u;return u=c.extend("PieChart",{init:function(b,c,h,i,j){var k=this,l=a.extend(!0,{},h);h=a.extend(!0,h||{},{debug:!0,providers:{colorMap:{clazz:g,colorBy:"dimension"}},components:{xAxisTitle:{show:!0,order:1,dock:"top",relevantSize:30,showFlag:d.prototype.ShowFlags.SMALL,clazz:e},dataArea:{sortKey:1e3,show:!0,dock:"center",clazz:f,showFlag:d.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:d.prototype.ShowFlags.MEDIUM}}},l),this._super(b,c,h,i,j),this.components.dimensionAxisTitle=this.components.xAxisTitle,this.components.dimensionAxisTitle.listen("drill-up",function(a,b,c){k.backendApi.drillUp(b,c)}),this.components.dimensionAxisTitle.setModel(this.$scope.ext.model),this.components.dimensionAxisTitle.setDock(this.components.xAxisTitle.dock),delete this.components.xAxisTitle,this._lastRotation=0},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.options._disableSelections||(this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.onSelection.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},initTooltips:function(){this.tooltips&&this.tooltips.setComponent("dataArea",this.components.dataArea)},on:function(){if(this._super(),this._navigation){var a=this;this._eventHandlers=q.extend({mousewheel:function(b){var c=m.getMouseWheelData(b.originalEvent);s.apply(a,[a.components.dataArea.getRotation()+5*c.delta]),b.preventDefault()},rotate:{start:function(){a._lastRotation=0,a.components.dataArea.setUseTransition(!1),p.preventGestures(this)},update:function(b,c){s.apply(a,[a.components.dataArea.getRotation()+c.rotation-a._lastRotation]),a._lastRotation=c.rotation,p.preventGestures(this)},end:function(){a.components.dataArea.setUseTransition(!0),p.preventGestures(this)}},tapthree:{end:function(){r(a.components.dataArea),p.preventGestures(this)}},mouseup:function(b){2===b.which&&(b.preventDefault(),r(a.components.dataArea))},exclusive:function(){return!1},active:function(){return!0}}),p.addInteraction(this._eventHandlers,this.components.dataArea.container,2,["mousewheel","tapthree","rotate","mouseup"])}this._on=!0},off:function(){this._navigation&&p.removeInteraction(this._eventHandlers),this._super()},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{rotation:this.components.dataArea._currentProperties.rotation})},getViewState:function(){return{rotation:this.components.dataArea._currentProperties.rotation}},_paint:function(){var a,c=[];if(!this.isValid(this._data))return this.clear();this._super(),this.layout(),this.components.dataArea.setShowDimensionValues(this._layoutMode>d.prototype.ShowFlags.SPARK);for(a in this.components)c.push(this.components[a].invalidateDisplay("PieChart._paint"));return b.all(c)},isValid:function(a){return this._super(a)&&!this.supressChartRendering},prePaint:function(a){this._super(a),n.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,a),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist||this.$scope.dataAttributes.onlyNegativeOrZero},_updateData:function(a){this._data=a;var b=this.getSnapshotStoredChartData();this._super(a),this.isDataSelectable(a)&&(this.selections&&this.selections.on(),!this._on&&this.inAnalysisState()&&this.on()),this.providers.colorMap.setData(a),this.components.dataArea.setData(a),this.components.colorLegend.setData(a),this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.setData(a),this.providers.colorMap.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.setDimensionTree(this._chartContext.getDimensionTree()),a.dataPoint&&this.components.dataArea.setDataPointsLabelMode(a.dataPoint.auto?"share":a.dataPoint.labelMode),a.donut&&this.components.dataArea.setShowAsDonut(a.donut.showAsDonut),a.scale&&this.components.dataArea.setScaleRatio(a.scale),this._readStoredData&&b?this.components.dataArea.setRotation(b.rotation):this.options.viewState?this.components.dataArea.setRotation(this.options.viewState.rotation):a.rotation?this.components.dataArea.setRotation(a.rotation):r(this.components.dataArea),a.dimensionTitle!==!1?this.components.dimensionAxisTitle.showComponent():this.components.dimensionAxisTitle.hideComponent()},toggleCacheItem:function(a){this.components.dataArea.toggleCacheItem(a),this.components.colorLegend.invalidateDisplay("PieChart#toggleCacheItem")},getPreferredSize:function(){return this._super()},destroy:function(){this._super(),this.components.dimensionAxisTitle&&this.components.dimensionAxisTitle.stopListen("drill-up")}}),{type:"piechart",BackendApi:h,template:l,View:u,definition:i,softDefinition:k,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:500}],qSuppressZero:!1,qSuppressMissing:!0}},data:j,support:{cssScaling:!1,snapshot:t,export:t,exportData:!0,sharing:t},options:{selections:{dataArea:{},colorLegend:{}},tooltips:{}},importProperties:o.colorChart.importProperties.bind(o),exportProperties:o.colorChart.exportProperties.bind(o)}}),define("extensions.qliktech/scatterplot/scatter-helper",["general.utils/shapes/circle","general.utils/shapes/rect","general.utils/shapes/polygon"],function(a,b,c){function d(d,e){var f;switch(d){case"circle":f=new a(e[0],e[1],e[2],e[3]);break;case"rect":f=new b(e[0],e[1],e[2],e[3]);break;case"polygon":f=new c}return f}function e(a,b){return a?[]:b}function f(a){return!(!a.dotData||"NaN"===a.dotData.xValue||"NaN"===a.dotData.yValue)}function g(a){return!!(a&&a.cacheItem&&a.cacheItem.selected)}function h(a,b){return!b||!!a.selected||!!a.highlighted}function i(a,b,c,d){var e;return e=b?j(a,c.sizeDataMin,c.sizeDataMax,c._minDotSize,c._maxDotSize):c._minDotSize,e*d}function j(a,b,c,d,e){var f,g;return isNaN(a)||null===a?NaN:b===c?(d+e)/2:a<=b?d:a>=c?e:(f=(a-b)/(c-b),g=d+(e-d)*Math.sqrt(f))}function k(a,b,c,d,e){var f=isNaN(c)||void 0===c,g=f?0:c;return a<-g||a>d+g||b<-g||b>e+g}function l(a,b,c){return a<0?-10+c:a>b?b-c+10:a}function m(a,b,c){var d;for(d=0;d<c.length;d++)if(a[c[d]]!==b[c[d]])return!1;return!0}function n(a,b,c,d,e){return 13!==a.length?null:(a[0].x=b-d+e/2,a[0].y=c-d-e/2,a[1].x=b-d-e/2,a[1].y=c-d+e/2,a[2].x=b-e,a[2].y=c,a[3].x=b-d-e/2,a[3].y=c+d-e/2,a[4].x=b-d+e/2,a[4].y=c+d+e/2,a[5].x=b,a[5].y=c+e,a[6].x=b+d-e/2,a[6].y=c+d+e/2,a[7].x=b+d+e/2,a[7].y=c+d-e/2,a[8].x=b+e,a[8].y=c,a[9].x=b+d+e/2,a[9].y=c-d+e/2,a[10].x=b+d-e/2,a[10].y=c-d-e/2,a[11].x=b,a[11].y=c-e,a[12].x=b-d+e/2,a[12].y=c-d-e/2,a)}function o(a,b){var c,d,e=!1;for(d=0;d<a.length;d++)if(c=a[d],"circle"===c.type){if(m(c,b,["cx","cy","r"])){e=!0;break}}else if(m(c,b,["cx","cy"])){e=!0;break}return e}function p(a,b){var c,d;return c=a.cacheItem.getShapes("dataArea")[0],d=b.cacheItem.getShapes("dataArea")[0],c.cy-c.r>d.cy-d.r?1:c.cy-c.r<d.cy-d.r?-1:c.cx-c.r>d.cx-d.r?1:c.cx-c.r<d.cx-d.r?-1:c.r>d.r?-1:c.r<d.r?1:a.cacheItem.id<b.cacheItem.id?-1:1}function q(a,b){return 0===b?a[1]?a[1]:null:a[b-1]}function r(a,b,c,d){var e,f,g={x:!1,y:!1};return isNaN(d.cx)||isNaN(d.cy)?(g.y=!0,g):(e=-(b.y-a.y),e<0?g:(e<2*a.height+d.r+c.r&&(g.y=!0,f=Math.abs(b.x-a.x),f<a.width/2+b.width/2&&(g.x=!0)),g))}function s(a,b){var c=a.x-a.width/2;return a.maxWidth=a.width,c<0&&(a.maxWidth+=2*c,a.x=a.maxWidth/2),c=a.x+a.width/2-b,c>0&&(a.maxWidth-=2*c),a.maxWidth=Math.max(a.maxWidth,0),a}function t(a,b){return a.x=b.x-b.width/2,a.y=b.y-b.height,a.width=b.maxWidth,a.height=b.height,a}return{createShape:d,checkClearNodes:e,checkNodeValid:f,checkSelected:g,checkShouldRender:h,getRadius:i,getDotRadius:j,outOfBounds:k,outOfBoundsPosition:l,isSame:m,updateCross:n,checkOverlapping:o,sortObjectsForLabels:p,getComparableObject:q,checkLabelInterference:r,checkEllipsis:s,centerLabel:t}}),define("extensions.qliktech/scatterplot/scatter-circle",["objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/polygon","objects.views/charts/shapes/circle"],function(a,b,c,d){function e(a,d,e){"saltire"===this.type?c.render.apply(this,[a,d,e]):b.render.apply(this,[a,d,e])}function f(a){var b,c=[];for(b=0;b<a;b++)c.push(g());return c}function g(){return{x:0,y:0}}function h(a,b,c,d,e){return 13!==a.length?null:(a[0].x=b-d+e/2,a[0].y=c-d-e/2,a[1].x=b-d-e/2,a[1].y=c-d+e/2,a[2].x=b-e,a[2].y=c,a[3].x=b-d-e/2,a[3].y=c+d-e/2,a[4].x=b-d+e/2,a[4].y=c+d+e/2,a[5].x=b,a[5].y=c+e,a[6].x=b+d-e/2,a[6].y=c+d+e/2,a[7].x=b+d+e/2,a[7].y=c+d-e/2,a[8].x=b+e,a[8].y=c,a[9].x=b+d+e/2,a[9].y=c-d+e/2,a[10].x=b+d-e/2,a[10].y=c-d-e/2,a[11].x=b,a[11].y=c-e,a[12].x=b-d+e/2,a[12].y=c-d-e/2,a)}var i=d.extend("ScatterCircle",{init:function(a,b,c,d,e){this._super(a,b,c),this.type="circle",this.saltireSize=d,this.saltireWidth=e},set:function(a,b,c,d,e){this.saltireSize=this.saltireSize||d,this.saltireWidth=this.saltireWidth||e,this._saltire=h(this._saltire||f(13),a,b,this.saltireSize,this.saltireWidth),this._polygons=[{points:this._saltire}],this._super(a,b,c)}});return a._registerRenderFn(e,i),i}),define("extensions.qliktech/scatterplot/heat-map-light",["core.utils/class","objects.views/charts/shapes/rect","objects.views/charts/shapes/text","general.utils/color","objects.utils/number-formatter","objects.views/charts/renderers/canvas-renderer"],function(a,b,c,d,e,f){function g(a){var c=new b(this._xAxis.getPositionOfValue(a.qText[0])-1,this._yAxis.getPositionOfValue(a.qText[1])-1,this._xAxis.getPositionOfValue(a.qText[2])-this._xAxis.getPositionOfValue(a.qText[0])+this._extraPixel,this._yAxis.getPositionOfValue(a.qText[3])-this._yAxis.getPositionOfValue(a.qText[1])+1),e=new d(this._colorMap.getColor(null,a.qNum/this._maxNrInBin));c.fill=e.toRGBA(),this._heatContainer.addChild(c),c.width>40&&c.height>15&&h.call(this,c,a.qNum,e.isDark())}function h(a,b,d){var e=new c;e.x=a.x+a.width/2,e.y=a.y+a.height/2+4,e.text=this._numberFormatter.format(b,this._defaultPattern),e.align="center",e.fill=d?"#fff":"#444",e.font="11px 'QlikView Sans'",this._heatContainer.addChild(e)}var i=a.extend("HeatMapLight",{init:function(a,b,c){this._renderer=a,this._heatContainer=b,this._selectedRenderer=c,this._numberFormatter=new e,this._defaultPattern="#.#A",this._extraPixel=1},setYMirrorMode:function(a){this.yMirrorMode=a,this._extraPixel=this.yMirrorMode?-1:1},setData:function(a){this._data=a[0].concat(),this._metaData=this._data.splice(0,1)[0],this._maxNrInBin=this._metaData.qNum},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},hasValidData:function(){return this._data&&this._metaData},setXAxis:function(a){this._xAxis=a},setYAxis:function(a){this._yAxis=a},draw:function(){if(this._data&&this._data.length&&!(this._data.length<1)){this._pixelRatio=f.getDevicePixelToBackingStoreRatio(),this._heatContainer.removeChildren(),this._selectedRenderer&&(this._selectedRenderer.stage.removeChildren(),this._selectedRenderer.clear());var a;for(a=0;a<this._data.length;a++)g.call(this,this._data[a]);return this._renderer.render()}},copyHeatMap:function(){return this._renderer._canvas.width&&this._renderer._canvas.height&&(this._imageData=this._renderer._canvas.getContext("2d").getImageData(0,0,this._renderer._canvas.width,this._renderer._canvas.height),this._selectedRenderer&&this._selectedRenderer._updateSize()),this._imageData},getHeatMapCanvas:function(){return this._renderer._canvas},clipSelected:function(a){this._renderer._canvas.width&&this._renderer._canvas.height&&(this._selectedRenderer.clear(),this._selectedRenderer._canvas.getContext("2d").putImageData(this._imageData,0,0,a.x*this._pixelRatio,a.y*this._pixelRatio,a.width*this._pixelRatio,a.height*this._pixelRatio))},clearSelection:function(){this._selectedRenderer.stage.removeChildren(),this._selectedRenderer.clear()},release:function(){this._renderer=null,this._heatContainer=null,this._selectedRenderer=null}});return i}),define("extensions.qliktech/scatterplot/scatterarea",["objects.views/charts/components/chart-component","extensions.qliktech/scatterplot/scatter-helper","objects.views/charts/renderers/canvas-renderer","./scatter-circle","objects.views/charts/shapes/text","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/utils/tree-iterator","objects.views/charts/chart-style-service","general.utils/color","core.utils/deferred","extensions.qliktech/scatterplot/heat-map-light","objects.views/charts/shapes/container"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){
"use strict";function n(a,b,c,d){return a.set(b,c,d),a}function o(a){var b,c=a.length;for(b=0;b<c;b++)a[b].renderer.setAttribute("style",{opacity:a[b].visible?1:0});setTimeout(function(){for(b=0;b<c;b++)a[b].renderer.setAttribute("style",{visibility:a[b].visible?"":"hidden"})},500)}function p(a){var b="scatterPlot",c={backgroundColor:a.getValue(b,null,"backgroundColor"),dataPoint:{label:{color:a.getValue(b,"value","color"),font:a.getFont(b,"value"),background:a.getValue(b,"value","background")}},shape:{border:{width:a.getValue(b,"shape.border","width")},selected:{border:{color:a.getValue(b,"shape.border","color"),width:a.getValue(b,"shape.border","width","selected")}},outOfBounds:{opacity:a.getValue(b,"shape.outOfBounds","opacity")}},line:{color:a.getValue(b,"line","color"),width:a.getValue(b,"line","width")}};return c}function q(a){var c,e,f,g,h,i,j,l,m,p,q,r,s,t,u,v=this._tree,w=this._tree.children.length,x=b.createShape("circle",[0,0,0,0]),y=this.rect.width,z=this.rect.height,A=this._dots,B=this,C=[],D=[],E=3,F=1,G=3,H=this._canvasShapes,I=this._data.qHyperCube.qMeasureInfo.length>2&&!this._data.qHyperCube.qIsReduced,J=Math.min(this.rect.height,this.rect.width)/300,K=this.selectionIdentifier?this.selectionIdentifier:"dataArea",L=this._styles;if(!w)return void this.clear();if(this._renderedNodes=b.checkClearNodes(!a,this._renderedNodes),v.children.forEach(function(k){if(b.checkNodeValid(k)&&(j=!1,g=b.checkSelected(k),k.selected=g,k.highlighted=k.cacheItem.highlighted,p=g?L.shape.selected.border.width:L.shape.border.width,q=g?.9:void 0,"dimension"===k.data.type)){if(!b.checkShouldRender(k,a)||!B._currentProperties.values)return;if(r=B._currentProperties.values[k.data.qElemNo],!r)return;if(c=B._xAxis.getPositionOfValue(r.xValue),e=B._yAxis.getPositionOfValue(r.yValue),f=b.getRadius(r.rValue,I,B._currentProperties,J),isNaN(c)||isNaN(e))return;f=f<.5?.5:f,G=f<G?f:G,l=isNaN(f)||void 0===f,k.dotData.outOfBounds=j=b.outOfBounds(c,e,f,y,z),j&&(f=G,c=b.outOfBoundsPosition(c,y,f),e=b.outOfBoundsPosition(e,z,f)),m=l&&!j,x=n(A[k.dotData.dotIndex],c,e,m?2*E:f),i=k.cacheItem,i.clearShapes(K),i.addShape(K,x,!0),h=i.highlighted,k.dotData.color=B._colorMap.getColor(k.data.qElemNo,k._children[0].data.qNum,0,k.data.rowIndex),t=k.dotData.color.isDark()?"light":"dark",u=!1,k.selected||(u=b.checkOverlapping(j?D:C,x,c,e,F)),u||(s=H[k.idx],s?s.fill=k.dotData.color.toRGBA():(s=new d(0,0,0,E,F),s.fill=k.dotData.color.toRGBA(),s.strokeWidth=p,s.opacity=q,s.stroke=h?L.shape.highlighted.border[t].color:g?L.shape.selected.border.color:B._sheetBackgroundColor.toRGBA(),s.data.label=k.data.qText?k.data.qText.substr(0,128):"",H[k.idx]=s),j?B._isBigData||(s.set(x.cx,x.cy,x.r),s.type="circle",D.push(s)):(s.set(x.cx,x.cy,x.r),l?s.type="saltire":s.type="circle",a||(C.push(s),B._renderedNodes.push(k))))}}),!a){var M=[];return this.renderers.dots.stage.removeChildren(),this.renderers.dots.stage.addChildren(C),M.push(this.renderers.dots.render()),this._isBigData?o.call(this,[{renderer:this.renderers.oob,visible:!1}]):(o.call(this,[{renderer:this.renderers.oob,visible:!0}]),this.renderers.oob.stage.removeChildren(),this.renderers.oob.stage.addChildren(D),M.push(this.renderers.oob.render())),k.all(M)}}function r(){var a,c,d,h,i,j,k,l,m,n,o,p,q,r=this._renderedNodes.length,s=this,u=[],v=this._labelShapes,w=this.renderers.labels,x=this._styles,y=this.selectionIdentifier?this.selectionIdentifier:"dataArea";return r&&(j=this._renderedNodes.sort(b.sortObjectsForLabels),j.forEach(function(r,w){if(v[r.data.rowIndex]&&(v[r.data.rowIndex].visible=!1),h=r.cacheItem,c=r.dotData.label,a=h.getShapes(y)[0],i=h.toggleShapes[0],n=w-1,k=b.getComparableObject(j,w),c.x=a.cx,c.y=a.cy-a.r-5,!c||r.dotData.outOfBounds)return void i.set(0,0,0,0);if(s._labelMode===t.AUTO&&k){if(l=k.cacheItem.getShapes(y)[0],d=k.dotData.label,m=b.checkLabelInterference(c,d,a,l),m.x&&m.y)return void(i.width=0);for(;m.y&&n>0;)if(n--,k=0!==w?j[n]:null,l=k.cacheItem.getShapes(y)[0],d=k.dotData.label,m=b.checkLabelInterference(c,d,a,l),m.x&&m.y)return void(i.width=0)}return c.y-c.height<0||c.y>s.rect.height?void i.set(0,0,0,0):(c=b.checkEllipsis(c,s.rect.width),i=b.centerLabel(i,c),void(i.width&&(v[r.data.rowIndex]?(p=v[r.data.rowIndex].rect,o=v[r.data.rowIndex].text,q=v[r.data.rowIndex].line,v[r.data.rowIndex].visible=!0):(p=new f,o=new e,q=new g,v[r.data.rowIndex]={visible:!0,rect:p,text:o,line:q},p.fill=x.dataPoint.label.background,o.fill=x.dataPoint.label.color,o.align="center",o.font=x.dataPoint.label.font,o.baseline="bottom",q.stroke=x.line.color),o.setText(c.text),o.x=c.x,o.y=c.y,o.maxWidth=c.maxWidth,p.x=o.x-o.maxWidth/2-2,p.y=i.y,p.width=i.width+4,p.height=i.height,q.set(c.x,c.y-2,c.x,c.y+3),u.push(p),u.push(o),u.push(q))))})),w.stage.removeChildren(),w.stage.addChildren(u),w.render()}var s,t;return t={NONE:0,AUTO:1,ALL:2},s=a.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._dots=[],this._labelRects=[],this._cacheItems=[],this._renderedNodes=[],this._showDataPoints=!0,this._colorMap=null,this._navigationVisible=!1,this._globalAlpha=1,this._canvasShapes={},this._labelMode=t.AUTO,this._savedCacheItems={},this._transitionProperties._minDotSize=2,this._transitionProperties._maxDotSize=10,this._style={dataPoints:{color:"#666",font:"12px 'QlikView Sans'"}},this._styles={},this._styleService=i.getInstance(),this._styles=p(this._styleService),this._sheetBackgroundColor=new j(this._styles.backgroundColor),this._sheetBackgroundColor.setAlpha(.3),this.renderers={heat:new c(this.container,{name:"heat"}),selectedHeat:new c(this.container,{name:"selectedHeat"}),dots:new c(this.container,{name:"dots"}),labels:new c(this.container,{name:"labels"}),oob:new c(this.container,{name:"oob"})},this._heatContainer=new m,this.renderers.heat.stage.addChild(this._heatContainer),this._heatMap=new l(this.renderers.heat,this._heatContainer,this.renderers.selectedHeat);var a="opacity 0.5s linear";this.renderers.heat.setAttribute("style",{webkitTransition:a,mozTransition:a,transition:a}),this.renderers.dots.setAttribute("style",{webkitTransition:a,mozTransition:a,transition:a}),this.renderers.labels.setAttribute("style",{webkitTransition:a,mozTransition:a,transition:a}),this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10},this._transitionHelper.setTransitionTime(500,0)},setYMirrorMode:function(a){this.yMirrorMode=a,this._heatMap&&this._heatMap.setYMirrorMode(a)},setIsBigData:function(a){this._isBigData=a},getIsBigData:function(){return this._isBigData},setIsReduced:function(a){a!==this._isReduced&&(this._reducedModeChanged=!0,this._isReduced=a)},getIsReduced:function(){return this._isReduced},setHeatMap:function(a){this._heatMap.setData(a)},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setHeatColorMap:function(a){this._heatColorMap=a,this._heatMap.setColorMap(this._heatColorMap)},getHeatColorMap:function(){return this._heatColorMap},setXAxis:function(a){this._xAxis=a,this._heatMap.setXAxis(a),this._xAxis.listen("changed",function(){this.invalidateDisplay()},this)},setYAxis:function(a){this._yAxis=a,this._heatMap.setYAxis(a),this._yAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay()},setMinDotSize:function(a){this._transitionProperties._minDotSize=a,this.invalidateDisplay()},setMaxDotSize:function(a){this._transitionProperties._maxDotSize=a,this.invalidateDisplay()},setLabelMode:function(a){this._labelMode=a,this.invalidateDisplay()},setNavigation:function(a){this._navigationVisible=a,this.invalidateDisplay()},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10}},_updateSize:function(){this.invalidateDisplay()},setData:function(a){this._super(a)},_updateProperties:function(){if(this._data&&this._tree){this._canvasShapes={},this._labelShapes={};var a,c,d,e,f,g,i,j=[],k=this._data.qHyperCube.qDimensionInfo.length,l=this._data.qHyperCube.qMeasureInfo.length,m=this._tree,n=this,o=this._dots,p=this._labelRects,q=m.children.length,r=0,s=this._dots.length,u=k+1,v=this.renderers.dots,w=this._style.dataPoints,x=this.selectionIdentifier?this.selectionIdentifier:"dataArea";return this._onlySelected=!1,n._transitionProperties.values={},n._transitionProperties.nodes={},l>2&&(n._transitionProperties.sizeDataMin=this._data.qHyperCube.qMeasureInfo[2].qMin,n._transitionProperties.sizeDataMax=this._data.qHyperCube.qMeasureInfo[2].qMax),q&&h.each.call(m,function(l,m){if(i=h.getLevel.call(l),l.idx=m,i===u-1){if(k>1&&m>0)return;e=l.children[0].data.qNum,f=l.children[1].data.qNum,g=l.children.length>2?l.children[2].data.qNum:.5,l.dotData={color:null,label:null},k<=1&&(l.dotData.dotIndex=r++,s<r?(a=b.createShape("circle",[0,0,0,0]),c=b.createShape("rect",[0,0,0,0]),o.push(a),p.push(c)):(a=n._dots[l.dotData.dotIndex],a.cx=NaN,a.cy=NaN,c=n._labelRects[l.dotData.dotIndex]),n._labelMode===t.NONE&&(c.width=NaN,c.height=NaN),d=l.cacheItem,d.addShape(x,a,!0),d.toggleShapes=[c],j.push(d),n._transitionProperties.values[l.data.qElemNo]={xValue:e,yValue:f,rValue:g}),l.dotData.label={x:0,y:0,width:0,height:0,text:l.data.qText},l.dotData.label.width=v.getTextWidth(l.dotData.label.text,w.font),l.dotData.label.height=v.getFontHeight(w.font)}}),this._dots.length>r&&(this._dots=this._dots.slice(0,r),this._labelRects=this._labelRects.slice(0,r)),this.setSelectableShapes(j),this._super()}},hasValidData:function(){return this._super()&&this._data&&(this._tree||this._isReduced&&this._heatMap.hasValidData())&&this._xAxis&&this._yAxis},paint:function(){var a=this;if(this._super(this._layoutMode,this._data),this._xAxis&&this._yAxis&&this._data&&this.renderers){if(this._xAxis.updateNow(),this._yAxis.updateNow(),this.renderers.oob.edgeBleed={left:10,right:10,bottom:10,top:10},this._styles=p(this._styleService),!this._renderData)return this.clear();if(this.renderers.dots.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this.renderers.heat.setAttribute("style",{opacity:this._globalAlpha||1}),this._isReduced)return this._heatContainer.removeChildren(),this.renderers.heat.clear(),this._reducedModeChanged?(this._reducedModeChanged=!1,this.setSelectableShapes([]),o.call(this,[{renderer:this.renderers.heat,visible:!0},{renderer:this.renderers.selectedHeat,visible:!0},{renderer:this.renderers.dots,visible:!1},{renderer:this.renderers.labels,visible:!1},{renderer:this.renderers.oob,visible:!1}]),this._heatMap.draw()):(this.renderers.labels.stage.removeChildren(),this.renderers.labels.clear(),this.renderers.dots.stage.removeChildren(),this.renderers.dots.clear(),this.renderers.oob.stage.removeChildren(),this.renderers.oob.clear(),this.setSelectableShapes([]),this._heatMap.draw());if(this._tree.children.length>0){var b=function(){var b,c,d=[];return b=q.apply(a,[a._onlySelected]),b&&d.push(b),a._onlySelected=!1,a._labelMode>t.NONE&&a._layoutMode>a.ShowFlags.XSMALL?(c=r.apply(a,[]),c&&d.push(c)):(a.renderers.labels.stage.removeChildren(),d.push(a.renderers.labels.clear())),k.all(d)};return this._reducedModeChanged?(this._reducedModeChanged=!1,o.call(this,[{renderer:this.renderers.heat,visible:!1},{renderer:this.renderers.selectedHeat,visible:!1},{renderer:this.renderers.dots,visible:!0},{renderer:this.renderers.labels,visible:!0}]),b()):(this.renderers.heat.clear(),this._heatContainer.removeChildren(),this.renderers.selectedHeat.clear(),this.renderers.selectedHeat.stage.removeChildren(),b())}}},clear:function(){return this._transitionHelper.clear(),this._super()},toggleCacheItem:function(a){var b=!0,c=this._styles,d=.9,e=this;this.renderers.dots.stage.opacity!==this._globalAlpha&&(b=!1,this.renderers.dots.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha);var f=this._canvasShapes[a.row],g=this._labelShapes[a.row];f&&(a.selected?(f.strokeWidth=c.shape.selected.border.width,f.stroke=c.shape.selected.border.color,f.opacity=d,f.zIndex=1,g&&g.visible&&(g.text.opacity=1,g.line.opacity=1,g.zIndex=1)):(f.opacity=void 0,f.stroke=e._sheetBackgroundColor.toRGBA(),f.strokeWidth=c.shape.border.width,f.zIndex=void 0,g&&g.visible&&(g.text.opacity=void 0,g.line.opacity=void 0,g.zIndex=void 0)),b&&(f.invalidate(),g&&g.visible&&g.text.invalidate())),b||(this.renderers.dots.render(),this.renderers.labels.render(),this.renderers.oob.render())},updateRangeSelection:function(a){this._heatMap.copyHeatMap(a),this._heatMap.clipSelected(a)},startRangeSelection:function(a){this._heatMap.copyHeatMap(a)},copyHeatMap:function(){return this._heatMap.copyHeatMap()},getHeatMapCanvas:function(){return this._heatMap.getHeatMapCanvas()},clearSelection:function(){this._heatMap.clearSelection()},setRenderData:function(a){this._renderData=a},release:function(){this._super(),this._styleService=null,this._styles=null,this._sheetBackgroundColor=null,this._heatMap.release(),this._heatContainer.removeChildren(),this.renderers=null,this._heatContainer=null,this._heatMap=null}})}),define("objects.views/charts/representation/color-globals",[],function(){var a={};return a.qualitativeColors=[["#4477aa"],["#4477aa","#cc6677"],["#4477aa","#ddcc77","#cc6677"],["#4477aa","#117733","#ddcc77","#cc6677"],["#332288","#88ccee","#117733","#ddcc77","#cc6677"],["#332288","#88ccee","#117733","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#cc6677","#882255","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#661100","#cc6677","#882255","#aa4499"],["#332288","#6699cc","#44aa99","#88ccee","#117733","#999933","#ddcc77","#661100","#cc6677","#882255","#aa4499"],["#332288","#6699cc","#88ccee","#44aa99","#117733","#999933","#ddcc77","#661100","#cc6677","#aa4466","#882255","#aa4499"]],a.largeQualitativeColors=["#99c867","#e43cd0","#e2402a","#66a8db","#3f1a20","#e5aa87","#3c6b59","#aa2a6b","#e9b02e","#7864dd","#65e93c","#5ce4ba","#d0e0da","#d796dd","#64487b","#e4e72b","#6f7330","#932834","#ae6c7d","#986717","#e3cb70","#408c1d","#dd325f","#533d1c","#2a3c54","#db7127","#72e3e2","#e2c1da","#d47555","#7d7f81","#54ae9b","#e9daa6","#3a8855","#5be66e","#ab39a4","#a6e332","#6c469d","#e39e51","#4f1c42","#273c1c","#aa972e","#8bb32a","#bdeca5","#63ec9b","#9c3519","#aaa484","#72256d","#4d749f","#9884df","#e590b8","#44b62b","#ad5792","#c65dea","#e670ca","#e38783","#29312d","#6a2c1e","#d7b1aa","#b1e7c3","#cdc134","#9ee764","#56b8ce","#2c6323","#65464a","#b1cfea","#3c7481","#3a4e96","#6493e1","#db5656","#747259","#bbabe4","#e33f92","#d0607d","#759f79","#9d6b5e","#8574ae","#7e304c","#ad8fac","#4b77de","#647e17","#b9c379","#8da8b0","#b972d9","#786279","#7ec07d","#916436","#2d274f","#dce680","#759748","#dae65a","#459c49","#b7934a","#51c671","#9ead3f","#969a5c","#b9976a","#46531a","#c0f084","#76c146","#bad0ad"],a.divColors=["#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e"].reverse(),a.divColorPyramid=[null,["#4477aa","#4477aa"].reverse(),["#99c7ec","#99c7ec","#f5a275","#f5a275"].reverse(),["#99c7ec","#99c7ec","#fffad2","#fffad2","#f5a275","#f5a275"].reverse(),["#008bce","#008bce","#b4ddf7","#b4ddf7","#f9bd7e","#f9bd7e","#d03232","#d03232"].reverse(),["#008bce","#008bce","#b4ddf7","#b4ddf7","#fffad2","#fffad2","#f9bd7e","#f9bd7e","#d03232","#d03232"].reverse(),["#3a89c9","#3a89c9","#99c7ec","#99c7ec","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f5a275","#f5a275","#d24d3e","#d24d3e"].reverse(),["#3a89c9","#3a89c9","#99c7ec","#99c7ec","#e6f5fe","#e6f5fe","#fffad2","#fffad2","#ffe3aa","#ffe3aa","#f5a275","#f5a275","#d24d3e","#d24d3e"].reverse(),["#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e"].reverse(),["#3d52a1","#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e","#ae1c3e"].reverse(),["#3d52a1","#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e","#ae1c3e"].reverse()],a.seqColorPyramid=[null,["#d95f0e","#d95f0e"],["#fec44f","#fec44f","#d95f0e","#d95f0e"].reverse(),["#fed98e","#fed98e","#fb9a29","#fb9a29","#cc4c02","#cc4c02"].reverse(),["#fed98e","#fed98e","#fe9929","#fe9929","#d95f0e","#d95f0e","#993404","#993404"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fe9929","#fe9929","#d95f0e","#d95f0e","#993404","#993404"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fe9929","#fe9929","#ec7014","#ec7014","#cc4c02","#cc4c02","#8c2d04","#8c2d04"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fb9a29","#fb9a29","#ec7014","#ec7014","#cc4c02","#cc4c02","#993404","#993404","#662506","#662506"].reverse()],a.seqColors=["#fff7bc","#fee391","#fee391","#fec44f","#fec44f","#fb9a29","#fb9a29","#ec7014","#ec7014","#cc4c02","#cc4c02","#993404","#993404","#662506"].reverse(),a.primaryColor="#4477aa",a.othersColor="#a5a5a5",a.nullColor="#d2d2d2",a}),define("objects.views/charts/representation/basic-color-map",["core.utils/class","general.utils/color-cache","objects.views/charts/representation/color-scale","objects.views/charts/representation/color-globals"],function(a,b,c,d){function e(a,b){return a&&a.length>1&&b&&b.length&&(a.length===b.length+1||a.length/2===b.length+1)}function f(a,c,d){return a.gradient?[b.retriveBlend(c,d,.5),d]:[d,d]}function g(a,c){var d=c.map(function(a){return b.retriveColor(a)});if(void 0!==a[0].value){var e=[];a[0].gradient?Array.prototype.push.apply(e,[d[0],b.retriveBlend(d[0],d[1],.5)]):Array.prototype.push.apply(e,[d[0],d[0]]);for(var g=1;g<d.length;g++)Array.prototype.push.apply(e,f(a[g-1],d[g-1],d[g]));return{colors:e,limits:a.map(function(a){return a.value})}}return{colors:d,limits:a}}var h=a.extend("BasicColorMap",{init:function(a){if(this._valid=e(a.colors,a.limits),this._max=isNaN(a.max)?1:a.max,this._min=a.min||0,this._valid){var b=g(a.limits.reverse(),a.colors.reverse());this._colorScale=new c,this._colorScale.setMaxMinValues(this._max,this._min),this._colorScale.setLimits(b.limits);for(var d=0;d<b.colors.length;d+=2)this._colorScale.addColorPart(b.colors[d],b.colors[d+1])}},setMaxMin:function(a,b){this._max=a,this._min=b},getColor:function(a,c){return this._valid?this._colorScale.getColor(c):b.retriveColor(d.nullColor)},getColorMapping:function(){var a,b,c=this._colorScale.getLegendParts(),d=this._max-this._min,e=c.length,f=d/e,g=this._max,h=[];for(b=0;b<e-1;b++)a=c[b],a.isMax=0===b,a.max=g,a.min=g-f,a.id=[g,g-f],a.type="range",g-=f,h.push(a);return a=c[b],a.max=g,a.min=this._min,a.id=[g,this._min],a.type="range",h.push(a),h},getSelectionIndices:function(){return[0]},getValueFormatter:function(){return null},getColorDataInfo:function(){return{legendMode:{discrete:!1,boxType:null,colorMode:"expression",selectionEnabled:!1,altMode:!1}}},getColorFromPreScaledValue:function(a){return this._colorScale.getColor(a)},getLegendDataProvider:function(){return null},setLegendTitle:function(a){this._legendTitle=a},getLegendTitle:function(){return this._legendTitle},getLegendMode:function(){return["scale",null,"expression",!0]}});return h}),define("extensions.qliktech/scatterplot/scatterplot-properties",["translator","client.utils/default-property-logic"],function(a,b){var c,d,e,f=b.getLogicFor("hard","scatterplot");e={component:"text",translation:"properties.compression.willNotAffect",show:function(a,b){return f.helpers.showCompressionResolution(b.layout)}},c={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},bubbleSizeItems:{type:"items",items:{bubbleSizes:{type:"integer",component:"slider",ref:"dataPoint.bubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:5,show:function(a){return a.qHyperCubeDef.qMeasures.length<3}},rangeBubbleSizes:{type:"array",component:"slider",ref:"dataPoint.rangeBubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:[2,8],show:function(a){return a.qHyperCubeDef.qMeasures.length>=3}},rangeBubbleCompressionNote:e}},label:{type:"items",items:{labelMode:{ref:"labels.mode",translation:"properties.labels",type:"string",component:"dropdown",defaultValue:1,options:[{value:1,translation:"Common.Auto"},{value:2,translation:"Common.All"},{value:0,translation:"Common.None"}],snapshot:{tid:"property-labels"}},labelModeCompressionNote:e}},queryLevel:{type:"integer",component:"slider",ref:"compressionResolution",translation:"properties.compression.resolution",min:4,max:8,step:1,defaultValue:5,show:function(a,b){return f.helpers.showCompressionResolution(b.layout)}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a){return!a.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{autoColor:{},colorsAnLegendCompressionNote:e,colorMode:{defaultValue:"primary",options:f.color.colorMode.options},persistentColors:{show:f.color.persistentColors.show}}},legend:{items:{show:{show:f.legend.show,snapshot:{tid:"property-legend"}},showTitle:{show:f.legend.showTitle.show},dock:{show:f.legend.dock.show}}}}},xAxis:{type:"items",uses:"measureAxis",label:function(b,c){var d,e=c.getMeasureLayouts()[0];return d=e&&!e.qError?a.get("properties.xAxisWithInfo",[e.qFallbackTitle]):a.get("properties.xAxis")},items:{axis:{items:{show:{ref:"xAxis.show",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},dock:{ref:"xAxis.dock",show:function(a){return"none"!==a.xAxis.show},options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}]},spacing:{ref:"xAxis.spacing",show:function(a){return"none"!==a.xAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"xAxis.autoMinMax"},minMax:{ref:"xAxis.minMax",show:function(a){return!a.xAxis.autoMinMax}},min:{ref:"xAxis.min",show:function(a){return["min","minMax"].contains(a.xAxis.minMax)&&!a.xAxis.autoMinMax},invalid:function(a){return"minMax"===a.xAxis.minMax&&a.xAxis.min>=a.xAxis.max}},max:{ref:"xAxis.max",show:function(a){return["max","minMax"].contains(a.xAxis.minMax)&&!a.xAxis.autoMinMax},invalid:function(a){return"minMax"===a.xAxis.minMax&&a.xAxis.min>=a.xAxis.max}}}}}},yAxis:{type:"items",uses:"measureAxis",label:function(b,c){var d,e=c.getMeasureLayouts()[1];return d=e&&!e.qError?a.get("properties.yAxisWithInfo",[e.qFallbackTitle]):a.get("properties.yAxis")},items:{axis:{items:{show:{ref:"yAxis.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"yAxis.dock",show:function(a){return"none"!==a.yAxis.show}},spacing:{ref:"yAxis.spacing",show:function(a){return"none"!==a.yAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"yAxis.autoMinMax"},minMax:{ref:"yAxis.minMax",show:function(a){return!a.yAxis.autoMinMax}},min:{ref:"yAxis.min",show:function(a){return["min","minMax"].contains(a.yAxis.minMax)&&!a.yAxis.autoMinMax},invalid:function(a){return"minMax"===a.yAxis.minMax&&a.yAxis.min>=a.yAxis.max}},max:{ref:"yAxis.max",show:function(a){return["max","minMax"].contains(a.yAxis.minMax)&&!a.yAxis.autoMinMax},invalid:function(a){return"minMax"===a.yAxis.minMax&&a.yAxis.min>=a.yAxis.max}}}}}}}};var g={uses:"data"};return d={type:"items",component:"expandable-items",translation:"properties.addons",items:{refLinesX:{uses:"reflines",ref:"refLine.refLinesX",translation:"properties.referenceLinesX"},refLinesY:{uses:"reflines",ref:"refLine.refLinesY",translation:"properties.referenceLinesY"},dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:g,addons:d,settings:c}}}),define("extensions.qliktech/scatterplot/scatterplot-explore-properties",["client.utils/default-property-logic","client.utils/property-hypercube-helper"],function(a,b){var c=a.getLogicFor("explore","scatterplot");return{type:"items",component:"accordion",items:{data:{uses:"data"},presentation:{uses:"presentation",items:{showNavigation:{type:"boolean",translation:"Common.Navigation",component:"switch",ref:"navigation",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},showLabels:{component:"radio-list",translation:"properties.labels",type:"number",ref:"labels.mode",options:function(){return[{value:1,translation:"Common.Auto"},{value:2,translation:"Common.All"},{value:0,translation:"Common.None"}]}},bubbleSizes:{type:"integer",component:"slider",ref:"dataPoint.bubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,show:function(a){return b.getNumMeasures(a)<3}},rangeBubbleSizes:{type:"array",component:"slider",ref:"dataPoint.rangeBubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,show:function(a){return b.getNumMeasures(a)>2}},queryLevel:{type:"integer",component:"slider",ref:"compressionResolution",translation:"properties.compression.resolution",min:4,max:8,step:1,show:function(a,b){return c.helpers.showCompressionResolution(b)}}}},color:{uses:"color",items:{mode:{options:c.color.colorMode.options},dimension:{items:{colorScheme:{show:function(a,c){var d=b.getDimensionLayouts(c)[0];return!(d&&d.qCardinal<=12)}},persistentColors:{show:!0}}}}}}}}),define("extensions.qliktech/scatterplot/scatterplot-data",["client.utils/property-resolver"],function(a){function b(a){var b=a.getMeasures();2===b.length?a.setSorting([2,1,0]):3===b.length&&a.setSorting([3,2,1,0])}function c(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byExpression"===e&&0===d.length&&a.setValue(b,"color.mode","primary")}var d={dimensions:{min:1,max:1},measures:{min:2,max:3,add:function(a,c,d){b(d),a.qSortBy.qSortByNumeric=-1},remove:function(a,d,e){b(e),c(d,e)}}};return d}),define("text!extensions.qliktech/scatterplot/scatterplot.ng.html",[],function(){return'<div class="qv-viz" style="position: relative;"></div>\n<span class="qv-viz-disclaimer"\n\t  ng-if="dataAttributes.reduceDataDisc  && dataAttributes.layoutMode > 2"\n\t  qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{reducedDataNote}}">\n\t<span class="ltr-star">*</span>\n\t<span>{{ reducedDataNote }}</span>\n\t<span class="rtl-star">*</span>\n</span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData" dir="ltr"></span>\n<div qva-scatter-navigation>\n\t<!--on-navigation="onNavigation"\n\tnavigation-disabled="navigationDisabled"\n\tnavigation-home-only="navigationHomeOnly"\n\tnavigation-visible="navigationVisible"\n\tnavigation-style="navigationPosition"-->\n</div>\n<div qva-scatter-mini-map ng-show="showMiniMap" ng-style="miniMapStyle" colorMap="colorMap"></div>\n'}),define("text!extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation.ng.html",[],function(){return'<div class="qv-scatter-nav" ng-style="navigationStyle">\n\t<div ng-show="navigationHomeOnly && navigationVisible" class="qv-scatter-nav-homeonly">\n\t\t<button class="qv-scatter-nav-home qui-plainbuttonicon" data-icon="" qva-activate="onHomePressed()" ng-disabled="navigationDefaultPosition || navigationDisabled" q-title-translation="Object.Navigation.ResetZoom" />\n\t</div>\n\t<div ng-show="!navigationHomeOnly && navigationVisible" class="qv-scatter-nav-fullnav">\n\t\t<div class="qv-scatter-nav-top">\n\t\t\t<button class="qv-scatter-nav-up qui-plainbuttonicon" data-icon="R" qva-activate="onNavigationPressed(\'navUp\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanUp" />\n\t\t</div>\n\t\t<div class="qv-scatter-nav-middle">\n\t\t\t<button class="qv-scatter-nav-left qui-plainbuttonicon" data-icon="T" qva-activate="onNavigationPressed(\'navLeft\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanLeft" />\n\t\t\t<button class="qv-scatter-nav-home qui-plainbuttonicon" data-icon="" qva-activate="onHomePressed()" ng-disabled="navigationDefaultPosition || navigationDisabled" q-title-translation="Object.Navigation.ResetZoom" />\n\t\t\t<button class="qv-scatter-nav-right qui-plainbuttonicon" data-icon="U" qva-activate="onNavigationPressed(\'navRight\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanRight" />\n\t\t</div>\n\t\t<div class="qv-scatter-nav-bottom">\n\t\t\t<button class="qv-scatter-nav-down qui-plainbuttonicon" data-icon="S" qva-activate="onNavigationPressed(\'navDown\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanDown" />\n\t\t\t<button class="qv-scatter-nav-in qui-plainbuttonicon" data-icon="Y" qva-activate="onNavigationPressed(\'zoomIn\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomIn" />\n\t\t\t<button class="qv-scatter-nav-out qui-plainbuttonicon" data-icon="Z" qva-activate="onNavigationPressed(\'zoomOut\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomOut" />\n\t\t</div>\n\t</div>\n</div>'}),define("extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation",["qvangular","text!./scatterplot-navigation.ng.html"],function(a,b){a.directive("qvaScatterNavigation",function(){return{template:b,replace:!0,link:function(a){a.onHomePressed=function(){a.$broadcast("navigationPressed","resetZoom")},a.onNavigationPressed=function(b){a.$broadcast("navigationPressed",b)}}}})}),define("extensions.qliktech/scatterplot/axis-light",["core.utils/class"],function(a){var b=a.extend("AxisLight",{init:function(a,b,c,d){this._values={min:a,max:b},this._positions={min:c,max:d}},setYMirrorMode:function(a){this.yMirrorMode=a},setValues:function(a){this._values=a},getValues:function(){return this._values},setPositions:function(a){this._positions=a},getPositions:function(){return this._positions},getPositionOfValue:function(a){var b=(a-this._values.min)/(this._values.max-this._values.min),c=this._positions.max-this._positions.min;return this.yMirrorMode?this._positions.max-c*b:this._positions.min+c*b}});return b});define("text!extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map.ng.html",[],function(){return'<div class="qv-scatter-mini-map">\n\t<div class="scatter-mini-map"></div>\n\t<div class="scatter-mini-map-focus" ng-style="focusStyle"></div>\n</div>'});define("extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map",["qvangular","objects.views/charts/renderers/canvas-renderer","extensions.qliktech/scatterplot/axis-light","extensions.qliktech/scatterplot/heat-map-light","text!./scatterplot-mini-map.ng.html","objects.views/charts/shapes/container","touche"],function(a,b,c,d,e,f){a.directive("qvaScatterMiniMap",function(){return{template:e,replace:!0,link:function(a,e){function g(b){if(m){var c=q.getPositionOfValue(m.xMin),d=r.getPositionOfValue(m.yMax),e=q.getPositionOfValue(m.xMax)-q.getPositionOfValue(m.xMin),f=r.getPositionOfValue(m.yMin)-r.getPositionOfValue(m.yMax),g=b.width-2,h=b.height-2;
c<0?(e+=c,c=0):c>g&&(c=g,e=0),d<0?(f+=d,d=0):d>h&&(d=h,f=0),c+e>g&&(e=g-c),d+f>h&&(f=h-d),f=f>h?h:f,e=e>g?g:e,a.focusStyle={left:c,top:d,width:e,height:f}}}function h(b,c){n=e.offset();var d=a.focusStyle.width,f=a.focusStyle.height,g={x:c.pagePoints[0].x-n.left,y:c.pagePoints[0].y-n.top},h={x:a.focusStyle.left+d/2,y:a.focusStyle.top+f/2},i=(g.x-h.x)/(m.scale*e.width()),j=(g.y-h.y)/(m.scale*e.height());a.$broadcast("navigationPressed","jumpTo",{x:-i*l.width,y:-j*l.height})}function i(){Touche(e[0]).tap({id:p,end:function(a,b){h(a,b)}});var b;Touche(e[0]).swipe({id:p,start:function(){n=e.offset();var c=a.focusStyle.width,d=a.focusStyle.height;b={x:a.focusStyle.left+c/2,y:a.focusStyle.top+d/2},a.$broadcast("navigationPressed","startAt",{x:0,y:0})},update:function(c,d){var f={x:d.pagePoints[0].x-n.left,y:d.pagePoints[0].y-n.top},g=(f.x-b.x)/(m.scale*e.width()),h=(f.y-b.y)/(m.scale*e.height());a.$broadcast("navigationPressed","moveTo",{x:-g*l.width,y:-h*l.height}),b=f},end:function(){a.$broadcast("navigationPressed","endAt")}})}function j(){Touche(e[0]).off("*",p)}var k,l,m,n,o=e.find(".scatter-mini-map"),p=".scatterplot-mini-map",q=new c,r=new c,s=new b(o[0],{name:"overview"}),t=new f;s.stage.addChild(t),k=new d(s,t),k.setXAxis(q),k.setYAxis(r),k.setColorMap(a.colorMap);var u=[];u.push(a.$on("onUpdateMiniMapData",function(a,b){k.setData(b)})),u.push(a.$on("onYMirrorModeChange",function(a,b){k.setYMirrorMode(b),q.setYMirrorMode(b)})),u.push(a.$on("onResizeMiniMap",function(a,b,c){q.setPositions({min:0,max:b.width}),r.setPositions({min:b.height,max:0}),s.setDimensions(0,0,b.width,b.height),g({width:b.width,height:b.height}),l=c,k.draw()})),u.push(a.$on("onUpdateMiniMap",function(a,b){var c=e.width(),d=e.height();q.setValues(b.x),q.setPositions({min:0,max:c}),r.setValues(b.y),r.setPositions({min:d,max:0}),s.setDimensions(0,0,e.width(),e.height()),k.draw()})),u.push(a.$on("onUpdateMiniMapFocus",function(a,b,c,d,f){var h=q.getValues();m={xMin:b,yMin:d,xMax:c,yMax:f,scale:(c-b)/(h.max-h.min)},k.yMirrorMode&&(m.scale=-m.scale),g({width:e.width(),height:e.height()})})),u.push(a.$on("onResetMiniMapFocus",function(){a.focusStyle={left:0,top:0,width:e.width(),height:e.height()}})),a.$on("$destroy",function(){for(j();u.length;)u.pop()();t.removeChildren(),s.release(),k.release(),q=null,r=null,p=null,s=null,t=null,k=null}),a.$watch("interactive",function(a){a?i():j()})}}})}),define("extensions.qliktech/scatterplot/scatterplot",["jquery","core.utils/deferred","translator","objects.views/charts/axis-chart","objects.views/charts/components/chart-component","objects.views/charts/components/ref-line-labels","objects.views/charts/utils/binding","./scatterarea","objects.views/charts/representation/combo-color-map","objects.views/charts/representation/basic-color-map","objects.backend-api/hypercube-api","extensions.qliktech/scatterplot/scatterplot-properties","extensions.qliktech/scatterplot/scatterplot-explore-properties","extensions.qliktech/scatterplot/scatterplot-data","text!./scatterplot.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.utils/number-formatter","objects.views/charts/utils/pan-zoom-controller","extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation","extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){"use strict";function u(){}function v(a){var b,c=[],d=a[0].qMatrix;if(c.push(d[0][0]),a[0].reformatted)for(b=1;b<d.length;b++)try{c.push(d[b][0])}catch(e){}else{for(b=1;b<d.length;b++)try{d[b][0].qText=JSON.parse(d[b][0].qText),c.push(d[b][0])}catch(e){}a[0].reformatted=!0}return[c]}function w(a,b){var c=a&&a.getActiveType();c&&!/^item/.test(c.getActiveMode())&&c.clearSelection(),b&&b.clearSelection()}function x(a,b,c){return void 0===c&&(c=0),0===a?Math.abs(b)<=c:Math.abs(b/a-1)<=c}function y(a,b,c,d,e){void 0===e&&(e=0);var f=Math.abs(b-a)*e;return Math.abs(c-a)<=f&&Math.abs(d-b)<=f}function z(a,b,c,d,e,f,g){return this._axisInfoAtHomeState&&y(this._axisInfoAtHomeState.x.min,this._axisInfoAtHomeState.x.max,a,b,g)&&y(this._axisInfoAtHomeState.y.min,this._axisInfoAtHomeState.y.max,c,d,g)&&(void 0===e||void 0===f||x(this._axisInfoAtHomeState.x.size,e,g)&&x(this._axisInfoAtHomeState.y.size,f,g))}function A(){var a=this.components.xAxis,b=this.components.yAxis;if(this._isHomeState=z.call(this,a.getPlotMin(),a.getPlotMax(),b.getPlotMin(),b.getPlotMax(),a.getPlotSize(),b.getPlotSize(),X),this.rect&&this._data){var c=this.rect.width>=400&&this.rect.height>=400,d=this._layoutMode>=3,e=this.inAnalysisState()||this.inEditState(),f=this._data.navigation?d&&!c:d,g=this._navigation&&(!this._isHomeState||e&&d&&!!this._data.navigation),h=this;this.$scope.navigationHomeOnly=f,this.$scope.navigationVisible=g,this.$scope.navigationDefaultPosition=this._isHomeState,this.yMirrorMode?this.$scope.navigationStyle={top:this.components.dataArea.rect.y+5+"px",left:this.components.dataArea.rect.x+17+"px"}:this.$scope.navigationStyle={top:this.components.dataArea.rect.y+5+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+5+"px"},setTimeout(function(){h.$scope.$apply()})}}function B(){var a=this.components.dataArea,b=a._xAxis,c=a._yAxis;this._axisInfo.x.min=!this._data.xAxis.autoMinMax&&["min","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.min):null,this._axisInfo.x.max=!this._data.xAxis.autoMinMax&&["max","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.max):null,this._axisInfo.y.min=!this._data.yAxis.autoMinMax&&["min","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.min):null,this._axisInfo.y.max=!this._data.yAxis.autoMinMax&&["max","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.max):null,b.setPlotMin(this._axisInfo.x.min),b.setPlotMax(this._axisInfo.x.max),c.setPlotMin(this._axisInfo.y.min),c.setPlotMax(this._axisInfo.y.max)}function C(){var a=this.components.dataArea,b=a._xAxis,c=a._yAxis;this._axisInfoAtHomeState={x:{size:b.getPlotSize(),max:b.getPlotMax(),min:b.getPlotMin()},y:{size:c.getPlotSize(),max:c.getPlotMax(),min:c.getPlotMin()}}}function D(){var a=this.components.dataArea,b=a._xAxis,c=a._yAxis,d=this;w(this.selections,this.tooltips),b.setUseTransition(this._oldUseTransition),c.setUseTransition(this._oldUseTransition),B.call(this),this._axisInfoAtHomeStateNeedToUpdate=!0,this._isHomeState=!0,u.call(this),this._paint(),setTimeout(function(){d._debouncedUpdateLayout.call(d),d.$scope.$emit("onResetMiniMapFocus"),d.$scope.showMiniMap=!1},1e3)}function E(){this._cancelDebounce(this),this._inPanZoom=!0,this._axisInfoAtHomeStateNeedToUpdate&&C.call(this),this._axisInfoAtHomeStateNeedToUpdate=!1,this.components.xAxis.setUseTransition(!1),this.components.yAxis.setUseTransition(!1),w(this.selections)}function F(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this,s=this.components.xAxis,t=this.components.yAxis;this._isHomeState&&this._needUpdateMiniMap&&Q.call(this),a.identityIfClose(W),this._plotMaxMinNeedToUpdate&&(this._xAxisMin=s.getPlotMin(),this._xAxisMax=s.getPlotMax(),this._yAxisMin=t.getPlotMin(),this._yAxisMax=t.getPlotMax(),this._plotMaxMinNeedToUpdate=!1),p=s.getPlotSize(),q=t.getPlotSize(),this.yMirrorMode?(d={x:p,y:q},e={x:0,y:0}):(d={x:0,y:q},e={x:p,y:0}),f=a.transformPoint(d),g=a.transformPoint(e),h=g.x-f.x,i=g.y-f.y,j=this._xAxisMax-this._xAxisMin,k=this._yAxisMax-this._yAxisMin,l=this._xAxisMin-f.x/h*j,m=this._xAxisMin+(p-f.x)/h*j,n=this._yAxisMax-(g.y-q)/i*k,o=this._yAxisMax-g.y/i*k,b&&this._axisInfoAtHomeState&&z.call(this,l,m,n,o,void 0,void 0,Y)&&(l=this._axisInfoAtHomeState.x.min,m=this._axisInfoAtHomeState.x.max,n=this._axisInfoAtHomeState.y.min,o=this._axisInfoAtHomeState.y.max),s.setPlotMin(l),s.setPlotMax(m),t.setPlotMin(n),t.setPlotMax(o),this.components.dataArea.clearSelection(),this.components.dataArea.getIsReduced()&&this.components.dataArea.renderers.heat.transformScene(a),r.$scope.$emit("onUpdateMiniMapFocus",l,m,n,o);for(c in this.components)"dataArea"===c&&this.components.dataArea.getIsReduced()||this.components[c].invalidateDisplay();A.call(this)}function G(){this._inPanZoom=!1,this._debouncedUpdateLayout()}function H(a){a?!this.toggleLasso&&this._oldToggleLasso&&(this.toggleLasso=!0,this._oldToggleLasso=!1):this.toggleLasso&&(this._oldToggleLasso=!0,this.toggleLasso=!1),this.selections&&(this.selections.allowLasso=a)}function I(){var a=this._panZoomController._viewportProjection.getTransformMatrix();if(!a.isIdentity()){var b=this._xAxisOldSize,c=this._yAxisOldSize;if(b&&c){var d=this.components.xAxis,e=this.components.yAxis,f=d.getPlotSize(),g=e.getPlotSize();if(b!==f||c!==g){var h,i,j,k;this.yMirrorMode?(h=this._xAxisMax,i=this._xAxisMin,j=d.getPlotMax(),k=d.getPlotMin()):(h=this._xAxisMin,i=this._xAxisMax,j=d.getPlotMin(),k=d.getPlotMax());var l=this._yAxisMin,m=this._yAxisMax,n=e.getPlotMin(),o=e.getPlotMax(),p=a.clone(),q=a.clone(),r=i-h,s=m-l,t=k-j,u=o-n;p.set([[f/r,0,-f*h/r],[0,-g/s,g*m/s],[0,0,1]]),q.set([[f/t,0,-f*j/t],[0,-g/u,g*o/u],[0,0,1]]),p.invert(),a=q.multiply(p),a.identityIfClose(W),this._panZoomController._viewportProjection.setTransformMatrix(a),this._panZoomController.reset()}}}}function J(){this._plotMaxMinNeedToUpdate=!0;var a=this._panZoomController._viewportProjection;a.setTransformMatrix(a.getTransformMatrix().identity())}function K(a,d,e,f,g){if(!this._inPanZoom){if(this._dataDfd=b(),this._ready=this._dataDfd.promise,!this._data||isNaN(a)||isNaN(d)||isNaN(e)||isNaN(f))return this._fetchedData=!0,this.$scope.throbberApi.hide(),b.resolve();var h=this,i=this._data.compressionResolution?this._data.compressionResolution:U,j=1e3,k=g?g-1:0,l=function(){return h._fetchedData=!0,h.prePaint(h._data),b.all([h._updateData(h._data)]).then(function(){h._dataDfd.resolve(),h.$scope.throbberApi.hide(),h.backendApi.isSnapshot&&(h._isBigData=h._data.dataPages&&h._data.dataPages.length>0&&h._data.dataPages[0].qMatrix.length>0,h.components.dataArea.setIsBigData(h._isBigData))})};return this.backendApi.getHyperCubeBinnedData(void 0===h._data?void 0:[{qTop:0,qLeft:0,qWidth:h._data.qHyperCube.qSize.qcx,qHeight:h._data.qHyperCube.qSize.qcy}],[{qLeft:a,qTop:d,qWidth:e,qHeight:f}],j,Math.min(i+k,V)).then(function(a){if(!h._inPanZoom){if(!h._data||!a||h._destroyed)return h._fetchedData=!0,void h.$scope.throbberApi.hide();if(J.call(h),h.components.dataArea.setIsBigData(!0),a[0].qMatrix.length>0){h._isReducedMode=!0,h._data.qHyperCube.isReduced=!0;var b=v([a[0]]);return h.components.dataArea.setHeatMap(b),h._heatColorMap.setMaxMin(b[0][0].qNum,0),h._needUpdateMiniMap&&h.$scope.$emit("onUpdateMiniMapData",b),h.components.dataArea.setIsReduced(!0),h.$scope.reducedDataNote=c.get("properties.compression.providingOverviewOf",[h._numberFormatter.format(h._data.qHyperCube.qSize.qcy,h._defaultPattern)]),H.call(h,!1),l()}return h._isReducedMode=!1,h._data.qHyperCube.isReduced=!1,h._data.qHyperCube.qDataPages=[a[1]],h.components.dataArea.setIsReduced(!1),H.call(h,!0),l()}})}}function L(){var a;if(this._dataUpdatedOnPanOrZoom&&!this._isReducedMode&&this._selectedElemNumbers){var b,c,d=this._data&&this._data.qHyperCube&&this._data.qHyperCube.qDataPages&&this._data.qHyperCube.qDataPages[0]?this._data.qHyperCube.qDataPages[0].qMatrix:void 0,e=d?d.length:0,f={},g=this._selectedElemNumbers.length;for(a=[],this._selectedElemNumbersWithoutRowIndex=[],b=0;b<e;b++)c=d[b][0].qElemNumber,f[c]=b;for(b=0;b<g;b++)c=this._selectedElemNumbers[b],void 0===f[c]?this._selectedElemNumbersWithoutRowIndex[this._selectedElemNumbersWithoutRowIndex.length]=c:a[a.length]=f[c]}return a}function M(){var a=.15,b=10;this._layoutMode<=3?this.$scope.miniMapStyle={display:"none"}:this.$scope.miniMapStyle={display:"block",left:this.yMirrorMode?this.components.dataArea.rect.x+b:this.components.dataArea.rect.x+this.components.dataArea.rect.width*(1-a)-b,top:this.components.dataArea.rect.y+this.components.dataArea.rect.height*(1-a)-b,width:this.components.dataArea.rect.width*a,height:this.components.dataArea.rect.height*a}}function N(){this.$scope.showMiniMap=!(!this._isBigData||this._isHomeState||this.components.xAxis.getPlotMin()<=this._resettedAxisInfo.x.min&&this.components.xAxis.getPlotMax()>=this._resettedAxisInfo.x.max&&this.components.yAxis.getPlotMin()<=this._resettedAxisInfo.y.min&&this.components.yAxis.getPlotMax()>=this._resettedAxisInfo.y.max)}function O(){var a=this.components.dataArea.rect.width,b=this.components.dataArea.rect.height;M.call(this),N.call(this),this.$scope.$emit("onResizeMiniMap",this.$scope.miniMapStyle,{width:a,height:b})}function P(){var a={colors:["rgba(111,153,197,1.0)","rgba(29,51,72,1.0)"],limits:[{value:.5,gradient:!0}],min:0,max:1};this._heatColorMap=new j(a),this._heatColorMap.setLegendTitle(c.get("properties.compression.density")),this.components.dataArea&&this.components.dataArea.setHeatColorMap(this._heatColorMap)}function Q(){this._resettedAxisInfo.x.min=this.components.xAxis.getPlotMin(),this._resettedAxisInfo.x.max=this.components.xAxis.getPlotMax(),this._resettedAxisInfo.y.min=this.components.yAxis.getPlotMin(),this._resettedAxisInfo.y.max=this.components.yAxis.getPlotMax(),this.$scope.$emit("onUpdateMiniMap",this._resettedAxisInfo),this.$scope.showMiniMap=!1,this._needUpdateMiniMap=!1}var R,S=".scatterplot",T=1e3,U=6,V=8,W=1e-9,X=1e-5,Y=1e-4;return R=d.extend("ScatterPlot",{init:function(b,c,d,j,k){var l=this;d=a.extend(!0,d||{},{providers:{colorMap:{clazz:i,colorBy:"dimension",autoMode:"primary"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:e.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",clazz:h,showFlag:e.prototype.ShowFlags.SPARK},grid:{showFlag:e.prototype.ShowFlags.XSMALL},refLineLabelsX:{show:!0,dock:"top",order:3,showFlag:e.prototype.ShowFlags.XSMALL,clazz:f},refLineLabelsY:{show:!0,dock:"right",order:3,showFlag:e.prototype.ShowFlags.XSMALL,clazz:f}}}),this._resettedAxisInfo={x:{min:0,max:0},y:{min:0,max:0}},this._axisInfo={x:{min:null,max:null},y:{min:null,max:null}},this._super(b,c,d,j,k),this.backendApi.setCacheOptions({enabled:!1}),this._numberFormatter=new s,this._defaultPattern="#.#A",this._oldUseTransition=this.components.xAxis.getUseTransition(),this.components.dataArea.setYAxis(this.components.yAxis),this.components.dataArea.setXAxis(this.components.xAxis),this.components.xAxisTitle.setType("measure"),this.components.yAxisTitle.setType("measure"),this.components.xAxisTitle.setModel(b.ext.model),this.components.yAxisTitle.setModel(b.ext.model),this.components.yAxis.setShowExplicitMinMax(!1),this.components.xAxis.setShowExplicitMinMax(!1),this.components.grid.setAxes(this.components.xAxis,this.components.yAxis);var m=this.providers.colorMap.getLegendDataProvider();m.setLegendMarker("circle"),P.call(this),b.colorMap=this._heatColorMap,this.components.xAxis.getTransitionHelper().setTransitionTime(700),this.components.yAxis.getTransitionHelper().setTransitionTime(700),this.components.dataArea.getTransitionHelper().setTransitionTime(700),this._changeWatchers.push(g.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(g.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._panZoomController=new t(a(this.components.dataArea.container),{start:function(){E.call(l)},update:function(a){F.call(l,a)},end:function(a){F.call(l,a,!0),G.call(l)},reset:function(){D.call(l)}}),this._panZoomController.setZoomPanByWebkitTransform(!1),this._debouncedUpdateLayout=p.debounce(function(){if(!l._inPanZoom){var a=l._data.qHyperCube.qSize.qcy>T&&!this.backendApi.isSnapshot,b=l.components.xAxis.getPlotMin(),c=l.components.xAxis.getPlotMax(),d=l.components.yAxis.getPlotMin(),e=l.components.yAxis.getPlotMax(),f=Math.floor(Math.sqrt((l._data.qHyperCube.qMeasureInfo[1].qMax-l._data.qHyperCube.qMeasureInfo[1].qMin)/(e-d)));a?(l._dataUpdatedOnPanOrZoom=!0,K.call(this,b,e,c-b,e-d,f).then(function(){u.call(l),l._paint().then(function(){l.components.xAxis.setUseTransition(l._oldUseTransition),l.components.yAxis.setUseTransition(l._oldUseTransition)})})):(u.call(l),l._paint().then(function(){l.components.xAxis.setUseTransition(l._oldUseTransition),l.components.yAxis.setUseTransition(l._oldUseTransition)}))}},400,this),this._cancelDebounce=p.cancelDebounce,this.onNavigationPressed=b.$on("navigationPressed",function(a,b,c){a.preventDefault(),l._panZoomController.navigate(b,c)}),this.$scope.navigationDisabled=!0},getVerticalComponents:function(){var a=this._super();return this.components&&this.components.refLineLabelsY&&this._data&&this._data.yAxis&&a.push({comp:this.components.refLineLabelsY,dock:"far"===this._data.yAxis.dock?"near":"far"}),a},setYMirrorMode:function(a){this.yMirrorMode!==a&&(this._super(a),this.$scope.$emit("onYMirrorModeChange",a),this.updateVerticalComponentsDock())},initSelections:function(){var a=this,b=this.components.dataArea;this.selections._disableSelections=this.options._disableSelections,this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.options._disableSelections||(this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.types.range.setComponent("x",this.components.xAxis),this.selections.types.range.setComponent("y",this.components.yAxis),this.selections.Activated.bind(function(){b.getIsReduced()&&b.copyHeatMap(),a._inSelectionMode=!0,a.onSelection.Activated.call(a)}),this.selections.Deactivated.bind(function(){a._inSelectionMode=!1,a.onSelection.Deactivated.call(a)}),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(a.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)),this.selections.ResetSelections.bind(function(){b.getIsReduced()&&b.clearSelection()}))},initTooltips:function(){this.tooltips.setComponent("dataArea",this.components.dataArea)},Select:function(a,b){this._selectedElemNumbers=this.selectionsCache.getSelectedValuesInColumn(0).slice(),this.onSelection.Select.apply(this,[a,b,0,"",this._data.qHyperCube.qSize.qcy>T])},Clear:function(){this.onSelection.Clear.call(this),this._selectedElemNumbers=void 0,this.components.dataArea.getIsReduced()&&this.components.dataArea.clearSelection()},Confirm:function(){this.onSelection.Confirm.call(this),this._selectedElemNumbers=void 0},_paint:function(){var c=this;return this._super().then(function(d){if(!d||!d.invalid)return c._ready.then(function(){if(c._destroyed)return b.resolve();var d,e=[];this.components.dataArea&&(this._offset=a(this.components.dataArea.container).offset());var f=this.components.xAxis,g=this.components.yAxis;this._xAxisOldSize=f?f.getPlotSize():void 0,this._yAxisOldSize=g?g.getPlotSize():void 0,this.layout(),this.components.dataArea&&this._panZoomController.setOffset(a(this.components.dataArea.container).offset());for(d in this.components)e.push(this.components[d].invalidateDisplay());return this._axisInfoAtHomeStateNeedToUpdate&&C.call(this),A.call(this),I.call(this),O.call(this),b.all(e)}.bind(this))}.bind(this))},on:function(){if(!this._on&&(this._super(),this._navigation)){if(A.call(this),this.supressDotRendering)return void(this.selections&&this.selections.off());this._panZoomController.on(S),this.$scope.interactive=!0,this.$scope.navigationDisabled=!1}},off:function(){this.$scope.navigationDisabled=!0,this.$scope.interactive=!1,this._on&&(this._navigation&&(A.call(this),this._panZoomController.off(),Touche(this.components.dataArea.container).off("*",S),Touche(this.container).off("*",S),a(this.components.dataArea.container).off(S),a(this.container).off(S)),this._super())},isValid:function(a){return this._super(a)&&a.qHyperCube.qMeasureInfo.length>=2&&!this.supressChartRendering},resize:function(){var a=new b,c=this;return this._isHomeState&&!this.backendApi.isSnapshot&&(B.call(this),this._axisInfoAtHomeStateNeedToUpdate=!0),this._super().then(function(){c.rect&&u.call(c),a.resolve()}),a.promise},prePaint:function(a){this._super(a),this.$scope.dataAttributes.limitedData=a.qHyperCube.qSize.qcy>T,this.$scope.dataAttributes.reduceDataDisc=this.$scope.dataAttributes.limitedData,q.applyDisclaimerAttributes({title:!1,bottom:!0,overlay:!1,explicitLimitedData:this.$scope.dataAttributes.limitedData,direction:this.$scope.options.direction},this.$scope.dataAttributes,this.$element,this.$scope,a),this.$scope.dataAttributes.noDataExist||(this.$scope.dataAttributes.onlyNanData=a.qHyperCube.qMeasureInfo.slice(0,2).some(function(a){return a.qMax<a.qMin||"NaN"===a.qMax})),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist,this.supressDotRendering=this.supressChartRendering},setInteractionState:function(a,b){this._super(a,b),this._oldUseTransition=this.components.xAxis.getUseTransition()},_updateHyperCube:function(a){var b;this._dataUpdatedOnPanOrZoom||(this._isHomeState=!0),this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.colorLegend.setData(a),this.components.xAxisTitle.setData([{label:a.qHyperCube.qMeasureInfo[0].qFallbackTitle,index:0}]),this.components.yAxisTitle.setData([{label:a.qHyperCube.qMeasureInfo[1].qFallbackTitle,index:1}]),b=this.getSnapshotStoredChartData(),this._readStoredData&&b?(this.components.xAxis.setPlotMin(b.xAxisMin),this.components.xAxis.setPlotMax(b.xAxisMax),this.components.yAxis.setPlotMin(b.yAxisMin),this.components.yAxis.setPlotMax(b.yAxisMax)):this.options.viewState&&(this.components.xAxis.setPlotMin(this.options.viewState.xAxisMin),this.components.xAxis.setPlotMax(this.options.viewState.xAxisMax),this.components.yAxis.setPlotMin(this.options.viewState.yAxisMin),this.components.yAxis.setPlotMax(this.options.viewState.yAxisMax)),a.legend&&this.components.colorLegend[(this.supressDotRendering||!a.legend.auto&&!a.legend.show?"hide":"show")+"Component"]()},_updateData:function(a){var c,d=this;this._data=a;var e=L.call(this),f=this.selectionsCache.getSelectedValuesInColumn(0).slice();if(!this._fetchedData){if(this._dataUpdatedOnPanOrZoom=!1,this._axisInfoAtHomeStateNeedToUpdate=!0,this._isBigData=a.qHyperCube.qSize.qcy>T,this._needUpdateMiniMap=!0,this._isBigData){var g=a.xAxis.autoMinMax||"min"!==a.xAxis.minMax&&"minMax"!==a.xAxis.minMax?a.qHyperCube.qMeasureInfo[0].qMin:a.xAxis.min,h=a.xAxis.autoMinMax||"max"!==a.xAxis.minMax&&"minMax"!==a.xAxis.minMax?a.qHyperCube.qMeasureInfo[0].qMax:a.xAxis.max,i=a.yAxis.autoMinMax||"min"!==a.yAxis.minMax&&"minMax"!==a.yAxis.minMax?a.qHyperCube.qMeasureInfo[1].qMin:a.yAxis.min,j=a.yAxis.autoMinMax||"max"!==a.yAxis.minMax&&"minMax"!==a.yAxis.minMax?a.qHyperCube.qMeasureInfo[1].qMax:a.yAxis.max;this.$scope.throbberApi.show(),K.call(this,g,j,h-g,j-i)}else this._dataDfd=b(),this._ready=this._dataDfd.promise,this._isReducedMode=!1,a.qHyperCube.isReduced=!1,this._selectedElemNumbers=void 0,this._selectedElemNumbersWithoutRowIndex=void 0,this.backendApi.getData([{qTop:0,qLeft:0,qWidth:a.qHyperCube.qSize.qcx,qHeight:1e3}]).then(function(a){return d._destroyed?void d._dataDfd.resolve():(d._data.qHyperCube.qDataPages=a,d._fetchedData=!0,H.call(d,!0),d.components.dataArea.setIsBigData(!1),d.components.dataArea.setIsReduced(!1),J.call(d),d.prePaint(d._data),void b.all([d._updateData(d._data)]).then(function(){d._dataDfd.resolve()}))});return this._ready}c={axes:{xAxis:{component:this.components.xAxis,data:a.xAxis,title:"",dataIndices:[0]},yAxis:{component:this.components.yAxis,data:a.yAxis,title:"",dataIndices:[1]}},refLineLabels:{x:{axis:this.components.xAxis,data:a.refLine?a.refLine.refLinesX:"",component:this.components.refLineLabelsX},y:{axis:this.components.yAxis,data:a.refLine?a.refLine.refLinesY:"",component:this.components.refLineLabelsY}},axisTitles:{xAxisTitle:{component:this.components.xAxisTitle},yAxisTitle:{component:this.components.yAxisTitle}},refLines:{component:this.components.refLines}},this._super(a,c),e&&this.selectionsCache.setRows(e),f&&this.selectionsCache.setValues(f),this._updateHyperCube(a),this._fetchedData=!1,this.components.colorLegend.setColorMap(this._isReducedMode?this._heatColorMap:this.providers.colorMap)},updateDataArea:function(a,b){this._super(a,b),a.qHyperCube.qMeasureInfo.length>2&&a.dataPoint.rangeBubbleSizes?a.dataPoint.rangeBubbleSizes.length>0&&(this.components.dataArea.setMinDotSize(a.dataPoint.rangeBubbleSizes[0]),a.dataPoint.rangeBubbleSizes.length>1&&this.components.dataArea.setMaxDotSize(a.dataPoint.rangeBubbleSizes[1])):a.dataPoint.bubbleSizes&&this.components.dataArea.setMinDotSize(a.dataPoint.bubbleSizes),null!==a.labels.mode&&this.components.dataArea.setLabelMode(a.labels.mode),this.components.dataArea.setRenderData(!this.supressDotRendering),this.supressDotRendering?(this.selections&&this.selections.off(),this._on&&this.off()):!this.supressDotRendering&&this.isDataSelectable(a)&&(this.selections&&this.selections.on(),this._on||this.inEditState()||this.on())},updateAxis:function(b,c){if(!this._dataUpdatedOnPanOrZoom){a.extend(c.axisTitles.xAxisTitle,{data:b.xAxis}),a.extend(c.axisTitles.yAxisTitle,{data:b.yAxis}),this._super(b,c);var d,e,f,g,h,i,j,k,l=0;for(g in c.axes)d=c.axes[g],f=d.dataIndices[0],e=d.component,h=b.qHyperCube.qMeasureInfo[f].qMin,i=b.qHyperCube.qMeasureInfo[f].qMax,j=!d.data.autoMinMax&&["min","minMax"].contains(d.data.minMax)?Number(d.data.min):null,k=!d.data.autoMinMax&&["max","minMax"].contains(d.data.minMax)?Number(d.data.max):null,i<h?(i=10,h=-10):h===i&&0===i||isNaN(h)&&isNaN(i)?(i=10,h=-10):l=Math.abs(i!==h?.02*(i-h):.1*i),this.setAxisDataRange(e,Math.max(h,i+l),h-l,k,j,l)}},updateRefLines:function(a,b){this._super(a,b);for(var c in b.refLineLabels)b.refLineLabels[c].component.setLabelMargin(10)},toggleCacheItem:function(a){this.components.dataArea.toggleCacheItem(a),this.components.colorLegend.invalidateDisplay("ScatterPlot#toggleCacheItem")},getSnapshotData:function(a,b,c,d,e,f){var g=this._data&&this._data.compressionResolution?this._data.compressionResolution:U,h=1e3,i=f?f-1:0;return this.backendApi.getHyperCubeBinnedData([{qTop:0,qLeft:0,qWidth:a.qHyperCube.qSize.qcx,qHeight:a.qHyperCube.qSize.qcy}],[{qLeft:b,qTop:c,qWidth:d,qHeight:e}],h,Math.min(g+i,V)).then(function(b){a.dataPages=b,a.foo="custom"})},setSnapshotData:function(a){if(this._super(a),!(this._isReducedMode||a.qHyperCube.qSize.qcy>T))return b.resolve();var c=this.components.xAxis.getPlotMin(),d=this.components.xAxis.getPlotMax(),e=this.components.yAxis.getPlotMin(),f=this.components.yAxis.getPlotMax(),g=Math.floor(Math.sqrt((this._data.qHyperCube.qMeasureInfo[1].qMax-this._data.qHyperCube.qMeasureInfo[1].qMin)/(f-e)));return this.getSnapshotData(a,c,f,d-c,f-e,g)},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{xAxisMin:this.components.xAxis.getPlotMin(),xAxisMax:this.components.xAxis.getPlotMax(),yAxisMin:this.components.yAxis.getPlotMin(),yAxisMax:this.components.yAxis.getPlotMax()})},getViewState:function(){return{xAxisMin:this.components.xAxis.getPlotMin(),xAxisMax:this.components.xAxis.getPlotMax(),yAxisMin:this.components.yAxis.getPlotMin(),yAxisMax:this.components.yAxis.getPlotMax()}},getPreferredSize:function(){return this._super()},clear:function(){return this.$scope.navigationVisible=!1,this._super()},destroy:function(){this._super(),this.onNavigationPressed(),this._panZoomController.release(),this._destroyed=!0}}),{type:"scatterplot",BackendApi:k,template:o,View:R,definition:l,softDefinition:m,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0}},data:n,support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0},options:{selections:{dataArea:{},range:{},colorLegend:{}},tooltips:{}},importProperties:r.colorChart.importProperties.bind(r),exportProperties:r.colorChart.exportProperties.bind(r)}}),define("extensions.qliktech/linechart/line-objects-model",["core.utils/class","util"],function(a,b){function c(a,b,c,d){return c<a||d>b}var d,e={LINE:"line",AREA:"area",STACKED:"stackedArea"},f={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return d=a.extend("LineObjectsModel",{init:function(){this._lineObjectSettings=[]},update:function(a,c){this._updateLineObjectsSettings(a,b.extend({selections:this._getSelected(a,c.numDimensions)},c))},getLineObjectsSettings:function(){return this._lineObjectSettings},getPointsOutOfRange:function(){return this._outOfRange.points},_updateLineObjectsSettings:function(a,c){var d,e,f,g,h,i,j,k=a?a.length:0;for(this._outOfRange={up:{},down:{},points:[]},this._lineObjectSettings=[],d=0;d<k;d++)e=a[d],f=c.minorAxes[c.measureToAxisIndex[e.measureIdx]],g=c.axesSettings[c.measureToAxisIndex[e.measureIdx]],h=this._getColorSettings(c.colorMap,g,f),i=[],this._updateLinePoints(a[d].points,i,this._outOfRange,b.extend({majorAxis:c.majorAxis,minorAxis:f,measureIdx:e.measureIdx,axisSettings:g,isLineSelected:c.selections.lines.indexOf(d)>=0},c)),j=b.extend({info:a.info,colors:h,clippings:this._getClippings(f,c.rect),idx:a.idx,points:i},c),this._lineObjectSettings.push(j)},_updateLinePoints:function(a,b,d,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u=g.style.line.width%2===0?0:.5,v=a?a.length:0,w=1===v,x=g.yMirrorMode,y=g.rect.width,z=g.rect.height;for(n=0,i=0;i<v;i++)if(a[i]&&(h=a[i],j=h.idx,k={x:g.isNumeric?g.numericAxis.getPositionOfValue(h.dimValue):g.majorAxis.getPositionOfValue(j,0),y:g.minorAxis.zeroPos},l=h.cacheCircle,l&&(l.cx=k.x,l.cy=k.y),!w||!(k.x<0||k.x>y))){if(h.isNaN&&!h.hasRightNeighbour&&"number"!=typeof h.nearestRightNeighbour)break;if(h.isNaN&&g.lineType===e.STACKED&&g.nullMode===f.CONNECT&&h.isInterpolationOffset!==!0);else if(h.isNaN&&h.isInterpolationOffset!==!0){b.push(!1);continue}if(o=h.hasRightNeighbour?a[i+1].idx:h.nearestRightNeighbour,m="undefined"!=typeof o?g.isNumeric?a[o]?g.numericAxis.getPositionOfValue(a[o].dimValue):NaN:g.majorAxis.getPositionOfValue(o,0):NaN,!x&&c(0,y,m,n)||x&&c(0,y,n,m))b.push(!1);else{p=h.cacheItem&&h.cacheItem.selected;var A=!p&&g.isLineSelected&&g.selections.synqronize&&this._isSelectedIndirectly(j,g.selections.lines,g.selections.points),B=g.minorAxis.getPositionOfValue(h.aggregated.end);k.y=Math.floor(B)-u,k.y<-1e5&&(k.y=-1e5),k.y>z+1e5&&(k.y=z+1e5),l&&(l.r=Math.max(g.style.dataPoints.size.normal/2,8),l.cy=Math.max(g.axisSettings.topCutoff,Math.min(g.axisSettings.bottomCutoff,k.y))),h.isNaN||(n=k.x),q=h.cacheItem&&(h.cacheItem.parent?[h.cacheItem.parent.id,h.cacheItem.id]:h.cacheItem.id),r=g.colorMap.getColor(q,h.aggregated.end,g.measureIdx,h.rowIndex).toRGBA(),w?t=!0:(t=!h.hasLeftNeighbour&&!h.hasRightNeighbour&&g.nullMode===f.GAP,t&&g.isNumeric&&(t=(0==i||a[i-1])&&(i===v-1||a[i+1]))),s={size:p?g.style.dataPoints.size.selected:g.style.dataPoints.size.normal,selected:p||A,selectedIndirectly:A,text:h.cacheItem?h.cacheItem.getDimensions()[0]:"",measureIdx:h.measureIdx,label:h.label,value:h.aggregated.end,isNaN:h.isNaN,isInterpolationOffset:h.isInterpolationOffset,color:r,outOfRangeUp:B<g.axisSettings.topCutoff,outOfRangeDown:B>g.axisSettings.bottomCutoff,outOfDimensionBounds:k.x<0||k.x>y,outOfBounds:k.x<0||k.x>y||h.aggregated.end>g.axisSettings.plotMax||h.aggregated.end<g.axisSettings.plotMin,dataIndex:j,isSingle:t,hidden:h.hidePoint,x:k.x,y:k.y,y1:0===h.aggregated.start?g.axisSettings.areaStartBase:g.minorAxis.getPositionOfValue(h.aggregated.start),cacheItem:h.cacheItem,isNull:h.cacheItem&&h.cacheItem.id===-2},(s.outOfRangeUp||s.outOfRangeDown)&&(s.outOfRangeUp&&!d.up[s.x]?(d.points.push(s),d.up[s.x]=!0):s.outOfRangeDown&&!d.down[s.x]&&(d.points.push(s),
d.down[s.x]=!0)),b[j]=s}}},_getSelected:function(a,b){var c,d,e,f=[],g=[],h=a.length;if(b)for(c=0;c<h;c++)for(e=a[c].points,d=0;d<e.length;d++)e[d]&&e[d].cacheItem&&e[d].cacheItem.selected&&(f.indexOf(c)===-1?(f.push(c),g[c]=[e[d].idx]):g[c].push(e[d].idx));return{lines:f,points:g,synqronize:f.length>1}},_isSelectedIndirectly:function(a,b,c){var d,e,f,g=b?b.length:0,h=!1;for(d=0;d<g;d++)for(f=c[b[d]],e=0;e<f.length;e++)if(a===f[e]){h=!0;break}return h},_getMeasureGradient:function(a,b,c){var d={gradient:{colors:[],limits:[],x0:0,x1:0,y0:a.posMin,y1:a.posMax}};return b.getColorMapping().slice().reverse().forEach(function(a){d.gradient.colors.push(a.grad[1].toRGBA()),d.gradient.colors.push(a.grad[0].toRGBA()),d.gradient.limits.push(Math.min(1,Math.max(0,c.getNormalizedValue(a.id[1])))),d.gradient.limits.push(Math.min(1,Math.max(0,c.getNormalizedValue(a.id[0]))))}),d},_getClippings:function(a,b){var c=a.getPadding(),d=c.top-1,e=a.rect.height-c.bottom;return{areaClip:{x:0,y:d,width:b.width,height:e-d},lineClip:{x:0,y:d,width:b.width,height:e-d-.5}}},_getColorSettings:function(a,b,c){var d=.3,e=!1,f=!1;return a.mode&&a.mode===a.MEASURE&&!isNaN(b.posMin)?(d=.6,f=this._getMeasureGradient(b,a,c)):a.mode&&a.mode===a.EXPRESSION&&(e=!0,d=.6),{isExpression:e,areaAlpha:d,varyingPointColors:e,//!( colorMap.mode === colorMap.AUTO || colorMap.mode === colorMap.PRIMARY ),
gradient:f}}})}),define("extensions.qliktech/linechart/layers/layer",["core.utils/class","objects.views/charts/renderers/canvas-renderer","core.utils/deferred"],function(a,b,c){var d;return d=a.extend("layer",{init:function(a,c){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new b(this.wrapper,c),this.minorAxis=null,this.majorAxis=null,a.appendChild(this.wrapper)},update:function(){},release:function(){this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null,this.renderer.release(),this.minorAxis=null,this.majorAxis=null},show:function(){this.wrapper.style.display="block"},hide:function(){this.wrapper.style.display="none"},render:function(){return"none"!==this.wrapper.style.display?this.renderer.render():c.resolve()},clear:function(){this.renderer.clear()}})}),define("extensions.qliktech/linechart/layers/shapes/points",["objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect"],function(a,b,c,d){function e(a){switch(a){case"diamond":case"triangle":return new c;case"circle":return new b;case"line":return new d;default:return new d}}function f(a,b,c,d,e){var f=d;switch(e){case"circle":a.set(b,c,.5*f);break;case"diamond":a.set([{x:b,y:c-f/2},{x:b-f/2,y:c},{x:b,y:c+f/2},{x:b+f/2,y:c}]);break;case"triangle":a.set([{x:b,y:c-f/2},{x:b-f/2,y:c+f/2},{x:b+f/2,y:c+f/2}]);break;default:f=d,a.set(b-f/2,c-f/2,f,f)}}var g;return g=a.extend("Points",{init:function(a){this._super(),this._symbol=a||"circle"},update:function(a){var b,c,d,g=a.points?a.points:[],h=0,i=!1,j=g?g.length:0;for(c=0;c<j;c++)d=g[c],!d||d.outOfDimensionBounds||d.isNaN||(b=this._children[h++],b||(b=e(this._symbol),this.addChild(b)),f(b,d.x,d.y,d.size,this._symbol),b.fill=d.selectedIndirectly?"white":d.color,b.stroke=d.selectedIndirectly?d.color:!!d.selected&&"white",b.opacity=d.selected||d.selectedIndirectly?1:a.globalAlpha,b.strokeWidth=1.5,b.visible=!d.outOfBounds&&!d.isNaN&&!d.hidden&&(a.showDataPoints||d.isSingle||d.keep||d.selected),b.visible&&!i&&(i=b.true),b.data.outOfBounds=d.outOfBounds,b.data.value=d.value,b.data.label=d.label,b.data.dataIndex=d.dataIndex,b.data.text=d.text);return h<this._children.length&&this.removeChildren(this._children.slice(h-this._children.length)),this.visible=i,this._selectedSize=a.style.dataPoints.size.selected,this},getFromRange:function(a,c,d){return this.children.filter(function(b){return d?b.cx>=a&&b.cx<c&&b.visible:b.cx>=a&&b.cx<=c&&b.visible}).map(function(a){var c=new b(a.cx,a.cy,.5*this._selectedSize);return c.fill=a.fill,c.stroke="white",c.opacity=1,c.strokeWidth=1.5,c},this)}})}),define("extensions.qliktech/linechart/layers/shapes/poly-line",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(a,b,c){"use strict";function d(a){var b,c=[];for(b=0;b<a.length;b++)c=c.concat(e(a[b]));return c}function e(a){var b,c,d,g,h,i,j,k=[],l=a._polygons[0].points;if(!l||l.length<2)return k;for(a.data.selected=l[0].selected&&l[1].selected,i=null,j=l.length-1,h=1;h<l.length;h++)if(l[h-1].selected&&l[h].selected){i=h-1;break}if(null!==i){for(h=i;h<l.length;h++)if(!l[h].selected){j=h-1;break}c=l.slice(0,i+1),d=l.slice(i,j+1),g=l.slice(j),c&&c.length>1&&(b=f(c,a),k.push(b)),d&&d.length>1&&(b=f(d,a),b.data.selected=!0,k.push(b)),g&&g.length>1&&(b=f(g,a),k=k.concat(e(b)))}else k.push(a);return k}function f(a,c){var d=new b(a);return d.opacity=c.opacity,d.close=!1,d.stroke=c.stroke,d.strokeWidth=c.strokeWidth,d.lineJoin=c.lineJoin,d.lineCap=c.lineCap,d}function g(a,c,e,f){var g,h,i,k,l,m,n=[];for(k=c?c.length:0,l=[],g=0;g<k;g++)if(m=c[g],!m||m.isNaN&&m.isInterpolationOffset!==!0)void 0===m&&a.isNumeric||e!==j.GAP||!i||!n.length||(i.set(n),l.push(i),i=null,n=[]);else{if(!i&&(i=new b,i.close=!1,i.stroke=f||m.color||"#333333",i.lineJoin="round",i.lineCap="round",i.opacity=1,n=[],m.isNull&&!f&&c[g+1]&&(i.stroke=c[g+1].color||"#333333"),m.hidden&&!f))for(h=1;h<k-g;++h)if(c[g+h]&&!c[g+h].hidden){i.stroke=c[g+h].color||"#333333";break}n.push({x:m.x,y:m.y,selected:m.selected,dataIndex:m.dataIndex,y_:m.y1})}for(i&&n.length>1&&(i.set(n),l.push(i)),l=d(l),k=l.length,g=0;g<k;g++)l[g].strokeWidth=a.style.line.width*(l[g].data.selected?2:1),l[g].opacity=l[g].data.selected?1:a.globalAlpha;return l}function h(a,b,c,d){var e,f,g,h=b?b.length:0,i=a.interpolateVaryingColors,k=[],l=null;for(e=0;e<h;e++)f=b[e],!f||f.isNaN&&f.isInterpolationOffset!==!0?void 0===f&&a.isNumeric||c!==j.GAP||(g=null):g?(l=new d(g.x,g.y,f.x,f.y),l.data.selected=g.selected&&f.selected,l.data.y1_=g.y1,l.data.y2_=f.y1,g.color!==f.color?l.stroke={gradient:{x0:g.x,y0:0,x1:f.x,y1:0,limits:i?[0,1]:[0,.5,.5,1],colors:i?[g.color||"#333333",f.color||"#333333"]:[g.color||"#333333",g.color||"#333333",f.color||"#333333",f.color||"#333333"]}}:l.stroke=f.color,l.opacity=l.data.selected?1:a.globalAlpha,l.strokeWidth=a.style.line.width*(l.data.selected?2:1),k.push(l),g=f):g=f;return k}var i,j={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return i=a.extend("PolyLine",{init:function(){this._super(),this.lineJoin="round",this.lineCap="round"},update:function(a){this.clip=a.clippings.lineClip,this.removeChildren(),a.colors.varyingPointColors?this.addChildren(i.getLines(a,a.points,a.nullMode,c)):this.addChildren(g.call(this,a,a.points,a.nullMode,a.colors.gradient))},getLineInRange:function(a,b){var c=new i;return this.children.forEach(function(d){var e=d.getPartialFromRange(a,b);e&&(e.stroke=d.stroke,e.strokeWidth=3,e.close=d.close,c.addChildren([e]))}),c}}),i.getLines=h,i}),define("extensions.qliktech/linechart/layers/shapes/poly-area",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(a,b,c){function d(a){return{x:a.x,y:a.y_}}function e(a,e){var f,g,h,i,j,k=[],l=e?e.length:0;for(f=0;f<l;f++)e[f]instanceof b?(h=e[f]._polygons[0].points,g=new b(h.concat(h.map(d).reverse())),g.fill=a.colors.gradient||e[f].stroke,g.opacity=a.colors.areaAlpha*(e[f].data.selected?1:a.globalAlpha)):e[f]instanceof c&&(i=Math.floor(e[f].x1),j=Math.floor(e[f].x2),h=[{x:i,y:e[f].y1},{x:i,y:e[f].data.y1_},{x:j,y:e[f].data.y2_},{x:j,y:e[f].y2}],g=new b(h),e[f].stroke.gradient?g.fill={gradient:{colors:e[f].stroke.gradient.colors,limits:e[f].stroke.gradient.limits,x0:e[f].stroke.gradient.x0,x1:e[f].stroke.gradient.x1,y0:0,y1:0}}:e[f].stroke?g.fill=e[f].stroke||"#eeeeee":g.fill=a.colors.gradient||"#eeeeee",g.opacity=a.colors.areaAlpha*(e[f].data.selected?1:a.globalAlpha)),g&&k.push(g);return k}var f;return f=a.extend("PolyArea",{getAreaFromSegments:function(b){var c=new a;return c.addChildren(e(this.__data,b)),c},update:function(a,b){this.__data=a,this.clip=a.clippings.areaClip,this.removeChildren(),this.addChildren(e(a,b))}})}),define("extensions.qliktech/linechart/layers/shapes/line-object",["objects.views/charts/shapes/container","./points","./poly-line","./poly-area"],function(a,b,c,d){var e;return e=a.extend("LineObject",{init:function(a,e){this._super(),this.data.label=a.info.label,e.showArea&&(this._areaLayer=new d,this.addChild(this._areaLayer)),this._lineLayer=new c,this.addChild(this._lineLayer),this._pointLayer=new b("circle"),this.addChild(this._pointLayer)},update:function(a){this._pointLayer.update(a),this._lineLayer.update(a),this.visible=this._pointLayer.visible||this._lineLayer.visible,this._areaLayer&&(this._areaLayer.update(a,this._lineLayer.children),this._areaLayer.visible&&(this.visible=!0))},getLinesInRange:function(b,c,d){var e=new a,f=this._lineLayer.getLineInRange(b,c);if(this._areaLayer){var g=this._areaLayer.getAreaFromSegments(f.children);e.addChildren([g])}return e.addChildren([f]),e.addChildren(this._pointLayer.getFromRange(b,c,d)),e}})}),define("extensions.qliktech/linechart/layers/line-objects-layer",["./layer","./shapes/line-object"],function(a,b){var c;return c=a.extend("LineObjectLayer",{init:function(a){this._super(a,{name:"line-objects-layer"})},updateInstances:function(a,c){var d,e=a?a.length:0,f=[];for(this.renderer.stage.removeChildren(),d=0;d<e;d++)f.push(new b(a[d],{showArea:c.showArea}));this.renderer.stage.addChildren(f),this._lineObjects=f},getLineObjects:function(){return this._lineObjects},getPolyLinesInRange:function(a,b,c){return this._lineObjects.map(function(d){return d.getLinesInRange(a,b,c)})},update:function(a){var b,c=this._lineObjects?this._lineObjects.length:0;for(b=0;b<c;b++)this._lineObjects[b].update(a[b])}})}),define("extensions.qliktech/linechart/layers/oob-layer",["./layer","objects.views/charts/shapes/polygon"],function(a,b){function c(a,b,c,d,e){var f=[];return"left"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a-d,y:b})):"right"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a+d,y:b})):"up"===e?(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b-d})):"down"===e&&(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b+d})),f}var d;return d=a.extend("OutOfBoundsLayer",{init:function(a){this._super(a,{name:"out-of-bounds-layer"}),this._markerSize=8},update:function(a,d){var e,f,g,h,i,j,k=this.renderer.stage,l=k.children,m=d.markerSize||this._markerSize,n=a?a.length:0;for(j=0;j<n;j++)e=l[j],f=a[j],h=f,f.data&&(h=f.data),i=d.axesSettings[d.measureToAxisIndex[h.measureIdx]],g=c(h.x,h.outOfRangeUp?i.topCutoff+m:i.bottomCutoff-m,m,m,h.outOfRangeUp?"up":"down"),e?e.set(g):(e=new b(g),k.addChild(e)),e.fill="#999999",e.opacity=h.selected?1:d.globalAlpha;n<l.length&&k.removeChildren(l.slice(n-l.length))}})}),define("extensions.qliktech/linechart/layers/label-layer",["./layer","objects.views/charts/utils/canvas-renderer","general.utils/shapes/geometry-math"],function(a,b,c){function d(){var a,b,c,d,e,f,g,h,i,j,k=this.renderer.scaling.x,l=this.renderer.scaling.y,m={},n=this.combinedMeasuresFormatter;for(this._allDataLineObjectsLength=this._allDataLineObjects?this._allDataLineObjects.length:0,this._dataLabelsOfLines=new Array(this._allDataLineObjectsLength),this._allDataPointLabels=[],a=0;a<this._allDataLineObjectsLength;a++)for(this._dataLabelsOfLines[a]=[],c=this._allDataLineObjects[a],f=c.find("Points [visible='true']"),e=f?f.length:0,b=0;b<e;b++)g=f[b].getBoundingRect(),h=g.x/k+g.width/(2*k),i=g.y/l+g.height/(2*l),j=h+";"+i,j in m||(m[j]=!0,d={text:this._lineType===E.STACKED&&this._allDataLineObjectsLength>1?n.formatValue(f[b].value):f[b].data.label,x0:h,y0:i,align:"center",font:this._style.dataPoints.font,maxWidth:512,maxNumLines:1,line:a},this._dataLabelsOfLines[a].push(d),this._allDataPointLabels.push(d));this._numAllDataPointLabels=this._allDataPointLabels.length}function e(){var a;for(a=0;a<this._numAllDataPointLabels;a++)this._allDataPointLabels[a].size=b.measureTextObject({type:"text",shape:this._allDataPointLabels[a]})}function f(){e.call(this);var a,b,c,d,f,g,h,i=this._discreteSpacing/2,j="leftDx",k="leftDy",l="rightDx",m="rightDy",n=1;for(this.yMirrorMode&&(j="rightDx",k="rightDy",l="leftDx",m="leftDy",n=-1),a=0;a<this._allDataLineObjectsLength;a++)if(d=this._dataLabelsOfLines[a],c=d.length,0!==c)if(1!==c){for(f=d[0],f.priority=6,h=d[1],f[j]=i,f[k]=0,f[l]=(h.x0-f.x0)*n,f[m]=f.y0-h.y0,b=1;b<c-1;b++)f=d[b],g=d[b-1],h=d[b+1],f[j]=g[l],f[k]=-g[m],f[l]=(h.x0-f.x0)*n,f[m]=f.y0-h.y0,g.y0<f.y0?f.y0<h.y0?f.priority=1:f.y0===h.y0?f.priority=2:f.priority=3:g.y0===f.y0?f.y0<h.y0?f.priority=2:f.y0===h.y0?f.priority=0:f.priority=2:f.y0<h.y0?f.priority=4:f.y0===h.y0?f.priority=2:f.priority=1;f=d[c-1],g=d[c-2],f[j]=g[l],f[k]=-g[m],f[l]=i,f[m]=0,f.priority=5}else f=d[0],f[j]=i,f[k]=0,f[l]=i,f[m]=0}function g(){void 0!==this._usedDataMax&&this._usedDataMax===this._usedDataMin?this._allDataPointLabels.sort(function(a,b){return a.x0<b.x0?-1:1}):this._allDataPointLabels.sort(function(a,b){return a.priority>b.priority?-1:a.priority===b.priority?6===a.priority?a.x0===b.x0?a.y0>b.y0?1:-1:a.x0>b.x0?1:-1:5===a.priority?a.x0===b.x0?a.y0>b.y0?1:-1:a.x0>b.x0?-1:1:4===a.priority?a.y0>b.y0?1:-1:3===a.priority?a.y0>b.y0?-1:1:a.y0===b.y0?a.x0>b.x0?-1:1:a.y0<b.y0?-1:1:1})}function h(){var a,b,c,d,e,f,g,h,i,j,k,l,m=[],n=this.renderer.scaling.x,o=this.renderer.scaling.y;for(a=0;a<this._allDataLineObjectsLength;a++)for(c=this._allDataLineObjects[a],d=c.find("PolyLine [stroke]"),e=d?d.length:0,b=0;b<e;b++)f=d[b],k=f.getLocalPoints(),l=f.getPoints(),l.forEach(function(a,b){a.y_=k[b].y_}),m.push(l);for(i=m.length,a=0;a<i;a++)for(j=m[a],g=j?j.length:0,b=0;b<g;b++)h=j[b],h.x=h.x/n,h.y=h.y/o;return m}function i(a,b){return!(a.minX2>b.maxX2||a.maxX2<b.minX2||a.minY2>b.maxY2||a.maxY2<b.minY2)}function j(a){var b=this._allDataPointLabels[a],c=0,d=this.rect.width,e=1,f=this.rect.height-1;return b.x0>c&&b.x0<d&&b.minX>=c&&b.maxX<=d&&b.minY>=e&&b.maxY<=f}function k(a){return!c.checkPolylinesIntersectingRectDefinedByMaxMin(this._polylines,this._allDataPointLabels[a])}function l(a){var b,c,d=this._allDataPointLabels[a],e=(d.minX+d.maxX)/2,f=(d.minY+d.maxY)/2,g=Math.pow(e-d.x0,2)+Math.pow(f-d.y0,2);for(c=0;c<this._numAllDataPointLabels;c++)if(b=this._allDataPointLabels[c],c!==a&&g>=Math.pow(e-b.x0,2)+Math.pow(f-b.y0,2))return!1;return!0}function m(a){var b,c=this._allDataPointLabels[a];for(b=0;b<a;b++)if(this._allDataPointLabels[b].status&&i(c,this._allDataPointLabels[b]))return!1;return!0}function n(a){return!!j.call(this,a)&&(!!l.call(this,a)&&(!!k.call(this,a)&&m.call(this,a)))}function o(a){var b,c,d,e=this._dataLabelHorizontalGap/2,f=this._dataLabelVerticalGap/2;b=a.size.width/2,c=b+e,a.minX=a.x-b,a.maxX=a.x+b,a.minX2=a.x-c,a.maxX2=a.x+c,d=a.size.height,"top"===a.baseline&&(a.minY=a.y,a.maxY=a.y+d,a.maxY2=a.maxY+f,a.minY2=a.minY-f),"bottom"===a.baseline&&(a.maxY=a.y,a.minY=a.y-d,a.maxY2=a.maxY+f,a.minY2=a.minY-f),"middle"===a.baseline&&(a.maxY=a.y+d/2,a.minY=a.y-d/2,a.maxY2=a.maxY+f,a.minY2=a.minY-f)}function p(a){6===a.priority&&a.x-a.size.width/2<0&&(a.x=a.size.width/2+1),5===a.priority&&a.x+a.size.width/2>this.rect.width&&(a.x=this.rect.width-a.size.width/2-1)}function q(a){return a.baseline="middle",a.x=a.x0-a.size.width/2-this._dataLabelHorizontalGap,a.y=a.y0,!0}function r(a){return a.baseline="middle",a.x=a.x0+a.size.width/2+this._dataLabelHorizontalGap,a.y=a.y0,!0}function s(a){return a.baseline="bottom",a.x=a.x0,a.y=a.y0-this._dataLabelMargin,p.call(this,a),!0}function t(a){return a.baseline="top",a.x=a.x0,a.y=a.y0+this._dataLabelMargin,p.call(this,a),!0}function u(a){var b,c,d,e,f,g=a.leftDx,h=a.rightDx,i=a.leftDy,j=a.rightDy,k=1e-9;return(i>0||j>0)&&(i=Math.max(i,k),j=Math.max(j,k),b=a.size.width+2*this._horizontalDistanceFromLine,d=b/(g/i+h/j),d<=this._maxDataLabelMargin)&&(a.baseline="bottom",d=Math.max(d,this._dataLabelMargin),a.y=a.y0-d,e=d*g/i,f=d*h/j,c=b/2,e<c?a.x=a.x0+(c-e):f<c&&(a.x=a.x0-(c-f)),!0)}function v(a){var b,c,d,e,f,g=a.leftDx,h=a.rightDx,i=-a.leftDy,j=-a.rightDy,k=1e-9;return(i>0||j>0)&&(i=Math.max(i,k),j=Math.max(j,k),b=a.size.width+2*this._horizontalDistanceFromLine,d=b/(g/i+h/j),d<=this._maxDataLabelMargin)&&(a.baseline="top",d=Math.max(d,this._dataLabelMargin),a.y=a.y0+d,e=d*g/i,f=d*h/j,c=b/2,e<c?a.x=a.x0+(c-e):f<c&&(a.x=a.x0-(c-f)),!0)}function w(a){var b,c,d=a.leftDx,e=a.leftDy;return a.baseline="middle",b=a.size.height/2+this._horizontalDistanceFromLine,c=Math.abs(this._dataLabelHorizontalGap*e/d),a.x=a.x0-a.size.width/2-this._dataLabelHorizontalGap,a.y=a.y0+(c>=b?0:e>0?b-c:c-b),!0}function x(a){var b,c,d=a.rightDx,e=a.rightDy;return a.baseline="middle",b=a.size.height/2+this._horizontalDistanceFromLine,c=Math.abs(this._dataLabelHorizontalGap*e/d),a.x=a.x0+a.size.width/2+this._dataLabelHorizontalGap,a.y=a.y0+(c>=b?0:e>0?b-c:c-b),!0}function y(a){var b,c,d,e,f=0,g=this.rect.width,h=9;return a.priority>3?(a.baseline="middle",a.x0-f<=g-a.x0?(a.x=a.x0+h+a.size.width/2,a.y=a.y0):(a.x=a.x0-h-a.size.width/2,a.y=a.y0)):3===a.priority&&(b=a.leftDy/a.leftDx,c=a.rightDy/a.rightDx,c>=b?(d=(a.size.height/2+1)/c,d<=2*h?(a.baseline="middle",a.y=a.y0,a.x=a.x0+Math.max(d,h)+a.size.width/2):(e=2*h*c-1,a.baseline="top",a.y=a.y0-e,a.x=a.x0+2*h+a.size.width/2)):(d=(a.size.height/2+1)/b,d<=2*h?(a.baseline="middle",a.y=a.y0,a.x=a.x0-Math.max(d,h)-a.size.width/2):(e=2*h*b-1,a.baseline="top",a.y=a.y0-e,a.x=a.x0-2*h-a.size.width/2))),!0}function z(a,b){var c=this._allDataPointLabels[b];!c.status&&a.call(this,c)&&(o.call(this,c),c.status=n.call(this,b))}function A(a){var b=this._allDataPointLabels[a];this._allDataLineObjectsLength>1?(6===b.priority&&z.apply(this,[q,a]),5===b.priority&&z.apply(this,[r,a]),z.apply(this,[s,a]),z.apply(this,[t,a])):(z.apply(this,[s,a]),z.apply(this,[t,a]),6===b.priority&&z.apply(this,[q,a]),5===b.priority&&z.apply(this,[r,a])),b.status||(b.rightDy+Math.abs(b.rightDx)*b.leftDy/Math.abs(b.leftDx)>=0?(z.apply(this,[v,a]),z.apply(this,[u,a])):(z.apply(this,[u,a]),z.apply(this,[v,a]))),b.status||(b.rightDy+Math.abs(b.rightDx)*b.leftDy/Math.abs(b.leftDx)>=0?(z.apply(this,[w,a]),z.apply(this,[x,a])):(z.apply(this,[x,a]),z.apply(this,[w,a]))),z.apply(this,[y,a])}function B(){var a;for(a=0;a<this._numAllDataPointLabels;a++)A.call(this,a)}function C(){var a,b,c,d=[];for(a=0;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],b.status&&(c={type:"text",fill:this._style.dataPoints.color,shape:b},d.push(c));this.renderer.shapes=d}var D,E={LINE:"line",AREA:"area",STACKED:"stackedArea"};return D=a.extend("LabelLayer",{init:function(a){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new b(this.wrapper),this.minorAxis=null,this.majorAxis=null,a.appendChild(this.wrapper),this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2},setYMirrorMode:function(a){this.yMirrorMode=a},update:function(a,b){this.combinedMeasuresFormatter=b.combinedMeasuresFormatter,this._allDataLineObjects=a,this._lineType=b.lineType,this._discreteSpacing=b.majorAxis.getDiscreteSpacing(),this._style=b.style,this.rect=b.rect,this.renderer.shapes=[],d.call(this),f.call(this),g.call(this),this._polylines=h.call(this),B.call(this),C.call(this)}})}),define("extensions.qliktech/linechart/layers/line-highlight-layer",["./layer","./shapes/line-object"],function(a){var b;return b=a.extend("LineHighlightLayer",{init:function(){this._super.apply(this,arguments),this.ranges=[]},getLineObjects:function(){return this._lineObjects},setRanges:function(a){this.ranges=a},update:function(a,b){var c=[];this.ranges.forEach(function(d){var e=a.getPositionOfValue(d.min),f=a.getPositionOfValue(d.max);c=c.concat(b.getPolyLinesInRange(e,f,d.maxNotIncluded))},this),this.renderer.stage.removeChildren(),c.length?(this.renderer.stage.addChildren(c),this.show()):this.hide()}})}),define("extensions.qliktech/linechart/layers/selection-highlight-layer",["./layer","objects.views/charts/shapes/rect","client.utils/theme/theme","general.utils/color"],function(a,b,c,d){var e;return e=a.extend("SelectionHighlightLayer",{init:function(){this._super.apply(this,arguments),this.ranges=[],this.color=d.toRGBA(c.colorSchemes.selectionColor,.2)},setRanges:function(a){this.ranges=a},update:function(a){var c=this.ranges.map(function(c){var d=a.getPositionOfValue(c.min),e=a.getPositionOfValue(c.max),f=new b(d,0,e-d,this.rect.height);return f.fill=this.color,f},this);this.renderer.stage.removeChildren(),c.length?(this.renderer.stage.addChildren(c),this.show()):this.hide()}})}),define("extensions.qliktech/linechart/linearea",["objects.views/charts/components/chart-component","general.utils/shapes/circle","./line-objects-model","./layers/line-objects-layer","./layers/oob-layer","./layers/label-layer","./layers/line-highlight-layer","./layers/selection-highlight-layer","objects.views/charts/chart-style-service","core.utils/deferred"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){return!!a}function l(a,b){for(var c,d=Object.keys(a),e=d.length,f=d.map(function(b){return a[b].points}),g=Math.max.apply(null,f.map(function(a){return a.length})),h=0;h<g;++h){var i=!1,j=!1;for(c=0;c<e;++c)i=i||f[c][h],j=j||!f[c][h];if(i&&j)for(c=0;c<e;++c)f[c][h]||(f[c][h]={idx:i.idx,dimValue:i.dimValue,measureIdx:i.measureIdx,aggregated:{start:0,end:0},hasLeftNeighbour:!!f[c][h-1]&&!f[c][h-1].isNaN,hasRightNeighbour:!!f[c][h+1]&&!f[c][h+1].isNaN,isNaN:!b,value:b?0:NaN,text:b?"0":"",hidePoint:!0,color:null,label:""})}}function m(a){var b,c,d,e,f,g=a?a.length:0;for(b=0;b<g;b++)if(f=a[b],f&&!f.hasRightNeighbour){for(c=b+1;c<g;c++)if(a[c]&&!a[c].isNaN){f.nearestRightNeighbour=c;break}if(!f.isNaN){if(!isNaN(f.nearestRightNeighbour))for(e=c-b,d=1;d<e;d++)a[b+d]&&(a[b+d].nearestRightNeighbour=f.nearestRightNeighbour,a[b+d].nearestLeftNeighbour=b);b=c-1}}}function n(a){var b,c,d,e,f,g,h,i,j,k=a?a.length:0,l=this.isDimensionContinuous;for(b=0;b<k;b++)if(j=a[b],j&&!j.hasRightNeighbour&&!j.isNaN&&!isNaN(j.nearestRightNeighbour))for(c=j.nearestRightNeighbour,f=j.value,g=a[c].value,i=c-b,h=l?a[c].dimValue-j.dimValue:c-b,d=1;d<i;d++)e=(l?a[b+d].dimValue-j.dimValue:d)/h,a[b+d]&&(a[b+d].interpolatedValue=f*(1-e)+g*e)}function o(a,b){var c,d,e,f,g,h=[],i=a?a.length:0;for(c=0;c<i;c++)d=a[c].points,Object.keys(d).forEach(function(a){var c=!1;g=d[a].idx,h[g]||(h[g]={pos:0,neg:0,total:0}),f=d[a],f&&(e=f.isNaN?isNaN(f.interpolatedValue)?0:f.interpolatedValue:f.value,isNaN(e)||(b?(0===e?f.hasLeftNeighbour&&d[a-1]?c=d[a-1].aggregated.end<0:f.hasRightNeighbour&&d[a+1]&&(c=d[a+1].aggregated.end<0):c=e<0,c?(f.aggregated.start=h[g].neg,h[g].neg+=e,f.aggregated.end=h[g].neg):(f.aggregated.start=h[g].pos,h[g].pos+=e,f.aggregated.end=h[g].pos)):(f.aggregated.start=h[g].total,h[g].total+=e,h[g].pos=Math.max(h[g].pos,h[g].total),h[g].neg=Math.min(h[g].neg,h[g].total),f.aggregated.end=h[g].total),"number"==typeof f.interpolatedValue&&(f.interpolatedValue=f.aggregated.end,f.isInterpolationOffset=!0)))});return{pos:Math.max.apply(null,h.filter(function(a){return!!a}).map(function(a){return a.pos})),neg:Math.min.apply(null,h.filter(function(a){return!!a}).map(function(a){return a.neg}))}}function p(a,b){var c=a.layoutMap[b]||"medium",d={dataPoints:{color:a.getValue(s,"item.value","color"),font:a.getFont(s,"item.value",c),size:{normal:a.getValue(s,"item.shape","size"),selected:a.getValue(s,"item.shape","size","selected")}},outOfRange:{color:a.getValue(s,"item.outOfRange","color")},line:{width:a.getValue(s,"item.line","width",c)}};return d}function q(){if(!this._data||!this._tree)return[];var a,b=this._data.qHyperCube.qDimensionInfo,c=b.length,d=[],e=0;return this._tree.children.forEach(function(f){f.id=b[0].cId+"_"+f.data.qElemNo,a={label:f.data.qText||"",cacheIndex:[],id:f.id},d.push(a),1===c&&(a.cacheIndex[0]=e++),c>1&&f.children.forEach(function(b){b.children[0].isBranch&&(b.data.qElemNo!==-2&&a.cacheIndex.push(e),e++)},this)},this),{data:d,info:[{qApprMaxGlyphCount:this._tree.data.qApprMaxGlyphCount}],groupSize:null}}var r,s="lineChart",t={LINE:"line",AREA:"area",STACKED:"stackedArea"},u={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return r=a.extend("LineArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._generatedCacheItems=[],this._showDataPoints=!0,this._colorMap=null,this._showDataPoints=!1,this._lineType=t.LINE,this._nullMode=u.GAP,this._separateStacking=!0,this._globalAlpha=1,this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2,this.interpolateVaryingColors=!0,this._styleService=i.getInstance(),this._lineObjectsModel=new c,this._lineLayer=new d(this.container),this.layers=[this._lineLayer],this.isMini?(this._rangeSelectionLayer=new h(this.container),this.layers.push(this._rangeSelectionLayer)):(this._oobLayer=new e(this.container),this.layers.push(this._oobLayer),this._labelLayer=new f(this.container),this.layers.push(this._labelLayer),this._rangeSelectionLayer=new g(this.container),this.layers.push(this._rangeSelectionLayer))},setYMirrorMode:function(a){this.yMirrorMode=a,this._labelLayer&&this._labelLayer.setYMirrorMode(a)},preRender:function(){},afterPaint:function(){return j.resolve()},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setShowDataPoints:function(a){this._showDataPoints=a},getShowDataPoints:function(){return this._showDataPoints},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setTimeAxis:function(a){this.timeAxis=a,this.timeAxis.listen("changed",function(){this.invalidateDisplay()},this)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties()},setLineType:function(a){this._lineType=a},setNullMode:function(a){this._nullMode=a},setSeparateStacking:function(a){this._separateStacking=a},setShowDataPointLabels:function(a){this._showDataPointLabels=a},getShowDataPointLabels:function(){return this._showDataPointLabels},freezeZOrdering:function(){this._zOrderFreezed=!0},unFreezeZOrdering:function(){this._zOrderFreezed=!1},setColorMappings:function(a){this._colorMappings=a},_updateSize:function(){this.invalidateDisplay()},getCacheItems:function(){return this._cacheItems},setCacheItems:function(a){this._cacheItems=a},getGeneratedCacheItems:function(){return this._generatedCacheItems||[]},setMeasureIndices:function(a){this._measureIndices=a},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},renderRangeSelections:function(){return this._rangeSelectionLayer.update(this.timeAxis,this._lineLayer),this._rangeSelectionLayer.render()},updateRangeSelection:function(a){this._rangeSelectionLayer.setRanges(a),this.renderRangeSelections()},_updateProperties:function(){if(this._data&&this._tree){this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis),this._majorAxisData=q.call(this),this._minorAxisData=null;var a,c,d,e,f,g,h,i=[],j=this._data.qHyperCube.qDimensionInfo,p=j.length,r=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,s=this._data.qHyperCube.qMeasureInfo,v=this._tree,w=this._shapes,x=v.children.length,y=0,z=this._shapes.length,A={},B=this.measureFormatters,C=this.selectionIdentifier?this.selectionIdentifier:"dataArea",D=this._minorAxes,E=[],F=[];if(this._measureIndices)F=this._measureIndices;else if(r>0&&r<20)for(;F.length<r;)F.push(F.slice(-1)[0]+1||0);if(F.forEach(function(a){E[a]=D.filter(function(b){return!b._dataIndices||b._dataIndices.indexOf(a)>=0})[0]}),this._measureToAxis=E,this._measureToAxisIndex=E.map(function(a){return D.indexOf(a)}),this._polysData=[],x&&F||F.length){v.children.forEach(function(k,l){k.id=j[0].cId+"_"+k.data.qElemNo,k.children.forEach(function(m,n){if(p>1)a=k.id+";"+j[1].cId+"_"+m.data.qElemNo,h=A[m.data.qText],h||(A[m.data.qText]={info:{label:m.data.qText},points:[],values:[],measureIdx:p>1?0:n},h=A[m.data.qText]),m=m.children[0],g=B[0];else{if(this._measureIndices&&this._measureIndices.indexOf(n)<0)return;a=k.id,h=A[n],h||(A[n]={info:{label:s[n].qFallbackTitle},measureIdx:n,points:[],values:[]},h=A[n]),g=B[n]}d=m.children[0],d&&(c=void 0!==d.data.qValue?d.data.qValue:d.data.qNum,f=isNaN(c),this._nullMode===u.ZERO&&f&&(c=0,f=!1),m.chartData={value:c,isNaN:f,idx:l,measureIdx:p>1?0:n,hasLeftNeighbour:!!h.points[l-1]&&!h.points[l-1].isNaN,hasRightNeighbour:!1,color:null,text:d.data.qText,label:d.data.qText?g&&("U"===g.type||isNaN(d.data.qNum))?g.formatValue(c):d.data.qText:"",rowIndex:m.data.rowIndex,dimValue:k.data.qNum,id:a,aggregated:{}},m.chartData.isNaN||(m.chartData.aggregated.start=0,m.chartData.aggregated.end=c,h.values.push(c)),h.points[l]=m.chartData,h.points[l-1]&&(h.points[l-1].hasRightNeighbour=!m.chartData.isNaN),m.chartData.shapeIndex=y++,z<y&&w.push(new b(NaN,NaN,NaN)),m.chartData.cacheCircle=w[m.chartData.shapeIndex],e=m.parent,e.cacheItem&&(i.indexOf(e.cacheItem)<0&&i.push(e.cacheItem),m.chartData.cacheItem=e.cacheItem,e.cacheItem.addShape(C,m.chartData.cacheCircle,!0),e.cacheItem.calculateTooltipPosition=!0))},this)},this);var G=[],H=r>1||p>1,I=(this._nullMode===u.CONNECT||this.isDimensionContinuous)&&this._lineType===t.STACKED&&H,J=this._nullMode===u.ZERO&&H&&!this.isDimensionContinuous;if((I||J)&&l.call(this,A,J),Object.keys(A).forEach(function(a){(I||this._nullMode!==u.ZERO)&&m.call(this,A[a].points),I&&n.call(this,A[a].points),this.isDimensionContinuous||(A[a].points=A[a].points.filter(k)),G.push(A[a])},this),this._polysData=G,this._zOrderFreezed){var K=this._sortedOrder;this._polysData.forEach(function(a,b){a.idx=b}),this._polysData.sort(function(a,b){return K.indexOf(a.idx)-K.indexOf(b.idx)})}else this._lineType===t.AREA?(this._polysData.forEach(function(a,b){a.idx=b,a.values.sort(function(a,b){return b-a}),a.absMedian=Math.abs(a.values[Math.floor(a.values.length/2)])}),this._polysData.sort(function(a,b){return b.absMedian-a.absMedian})):this._polysData.forEach(function(a,b){a.idx=b}),this._sortedOrder=this._polysData.map(function(a){return a.idx});if(this._lineType===t.STACKED&&(r>1||p>1)){var L=o.apply(this,[G,this._separateStacking]);this._minorAxisData={min:L.neg>=0?0:L.neg,max:L.pos<0?0:L.pos}}}this._shapes.length>y&&(this._shapes=this._shapes.slice(0,y)),this.setSelectableShapes(i),this._lineLayer.updateInstances(this._polysData,{showArea:[t.AREA,t.STACKED].contains(this._lineType)})}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree},updateSize:function(){this._super(),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensions(0,-1,this.rect.width,this.rect.height+1),a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this),this._style=p(this._styleService,this._layoutMode)},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={top:1,left:0,right:0,bottom:0}},release:function(){this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this),this.timeAxis&&this.timeAxis.stopListen("changed",null,this)},beforeLayerUpdates:function(){},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow(),this.timeAxis&&this.timeAxis.updateNow();var a={numDimensions:this._data.qHyperCube.qDimensionInfo.length,showDataPoints:this._showDataPoints&&this._layoutMode>this.ShowFlags.SPARK,nullMode:this._nullMode,globalAlpha:this._globalAlpha,majorAxis:this._majorAxis,minorAxes:this._minorAxes,numericAxis:this.timeAxis,isNumeric:this.isDimensionContinuous,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails),combinedMeasuresFormatter:this.combinedMeasuresFormatter,interpolateVaryingColors:this.interpolateVaryingColors,colorMap:this._colorMap,rect:this.rect,style:this._style,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2),yMirrorMode:this.yMirrorMode},b=this,c=[];return this._lineObjectsModel.update(this._polysData,a),this.beforeLayerUpdates(this._lineObjectsModel.getLineObjectsSettings()),this._lineLayer.update(this._lineObjectsModel.getLineObjectsSettings()),this.preRender(this._lineLayer._lineObjects),c.push(this._lineLayer.render()),this._oobLayer&&(this._oobLayer.update(this._lineObjectsModel.getPointsOutOfRange(),a),c.push(this._oobLayer.render())),this._labelLayer&&(this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPointLabels&&this._showDataPoints?(this._labelLayer.update(this._lineLayer.getLineObjects(),a),this._labelLayer.show(),c.push(this._labelLayer.render())):this._labelLayer.hide()),this._rangeSelectionLayer&&c.push(this.renderRangeSelections()),
j.all(c).then(function(){return b.afterPaint(a.axesSettings[0].topCutoff,a.axesSettings[0].bottomCutoff)})},clear:function(){this._super(),this.layers.forEach(function(a){a.clear()})},_getAxisDetails:function(a){var b=a.getPlotMin(),c=a.getPlotMax(),d=c-b,e=a.getPadding(),f=e.top,g=a.rect.height-e.bottom,h=0;return h=b>0?g:c<0?f:Math.ceil(a.getPositionOfValue(0)+1e-5),{plotMin:b,plotMax:c,posMin:a.getPositionOfValue(b),posMax:a.getPositionOfValue(c),plotRange:d,topCutoff:f,bottomCutoff:g,areaStartBase:h,zeroPos:Math.floor(a.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/linechart/linechart-util",["core.utils/feature-flags"],function(a){return{isContinuousChart:function(a){return a.preferContinuousAxis&&this.canBeContinuousChart(a)},canBeContinuousChart:function(b){if(!a.TALC||b.qHyperCube.qDimensionInfo.length<1)return!1;if(2===b.qHyperCube.qDimensionInfo.length&&!a.TALC2D)return!1;var c=b.qHyperCube.qDimensionInfo[0].qTags||[];return b.qHyperCube.qDimensionInfo[0].qContinuousAxes&&c.indexOf("$numeric")>=0},getFocusRange:function(a,b,c,d){var e,f={},g=b<1?0:b-1,h=a.length-c-1;if(d<2)f[a[0][1].qElemNumber]={lower:null,upper:null};else for(var i=0;i<a.length;i++)f[a[i][1]]||(f[a[i][1].qElemNumber]={lower:null,upper:null});for(i=b-1;i>=0;i--)e=f[a[i][1].qElemNumber],e&&!e.lower&&(e.lower=i);for(i=a.length-c;i<a.length;i++)e=f[a[i][1].qElemNumber],e&&!e.upper&&(e.upper=i);return Object.keys(f).forEach(function(a){f[a].lower<g&&(g=f[a].lower),f[a].upper>h&&(h=f[a].upper)}),{lower:g,upper:h}}}}),define("extensions.qliktech/linechart/linechart-properties",["translator","client.utils/default-property-logic","./linechart-util"],function(a,b,c){function d(a,b){var c=b.getDimensions(),d=b.getMeasures();return"area"===a.lineType&&c.length+d.length>2}function e(a,b){return b?b.getMeasureLayouts():a.qHyperCubeDef.qMeasures.map(function(a){return a.qDef})}function f(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}var g,h,i,j=b.getLogicFor("hard","linechart");g={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{lineType:{ref:"lineType",type:"string",component:"item-selection-list",defaultValue:"line",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.area",value:"area"}]},stackedProps:{type:"items",grouped:!1,items:{stackedArea:{ref:"stackedArea",translation:"properties.style.stackedArea",type:"boolean",defaultValue:!1,show:function(a,b){return d(a,b)}},separateStacking:{ref:"separateStacking",translation:"properties.separateStacking",type:"boolean",defaultValue:!0,readOnly:function(a){return!a.stackedArea},show:function(a,b){return d(a,b)}}}},scrollStartPos:{ref:"scrollStartPos",type:"number",translation:"properties.ScrollAlignment",component:"dropdown",defaultValue:0,options:[{value:0,translation:"properties.ScrollAlignStart"},{value:1,translation:"properties.ScrollAlignEnd"}],show:function(a,b,d){return!c.isContinuousChart(d.layout)}},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap"},dataPointSettings:{type:"items",grouped:!1,snapshot:{tid:"property-dataPoint"},items:{dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1},showDataPointLabels:{ref:"dataPoint.showLabels",translation:"properties.dataPoints.labelmode",type:"boolean",component:"switch",defaultValue:!1,show:function(a){return a.dataPoint&&a.dataPoint.show},options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(a,b,d){return!c.isContinuousChart(d.layout)}},gridSpacing:{type:"number",component:"dropdown",ref:"gridLine.spacing",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a,b,d){return a.gridLine&&!a.gridLine.auto&&!c.isContinuousChart(d.layout)}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:j.color.colorMode.options}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var d,e=f(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return d=e?a.get("properties.xAxisWithInfo",[e]):a.get("properties.xAxis")},grouped:!0,items:{group:{type:"items",items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a,b,d){return a.dimensionAxis&&["all","labels"].contains(a.dimensionAxis.show)&&!c.isContinuousChart(d.layout)}},dock:{type:"string",component:"dropdown",ref:"dimensionAxis.dock",translation:"Common.Position",options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}],show:function(a){return a.dimensionAxis&&"none"!==a.dimensionAxis.show},defaultValue:"near"}}},continuous:{type:"boolean",ref:"preferContinuousAxis",translation:"properties.axis.preferContinuous",defaultValue:!0,undefinedValue:!1,show:function(a,b,d){return c.canBeContinuousChart(d.layout)}}}},measureAxis:{uses:"measureAxis",label:function(b,c){var d,f=e(b,c).map(function(a){return a.qFallbackTitle}).join(", ");return d=f?a.get("properties.yAxisWithInfo",[f]):a.get("properties.yAxis")},items:{axis:{type:"items",items:{show:{snapshot:{title:"properties.yAxis",tid:"property-yAxis"}}}},scale:{type:"items",items:{logScale:{ref:"measureAxis.logarithmic",translation:"properties.axis.logarithmicScale",type:"boolean"},label:{component:"text",translation:"properties.axis.logarithmicScaleNote",show:function(a){return a.measureAxis&&a.measureAxis.logarithmic}}}}}}}},h={type:"items",translation:"properties.sorting",items:{noContinuousSortingMessage:{component:"text",translation:"properties.sorting.noContinuousSortingMessage",show:function(a,b,d){return c.isContinuousChart(d.layout)}},defaultSorting:{uses:"sorting",show:function(a,b,d){return!c.isContinuousChart(d.layout)},items:{dimensions:{locked:function(a,b,c){return 1===c.getMeasures().length&&2===c.getDimensions().length}},measures:{locked:function(a,b,c){return 1===c.getMeasures().length&&2===c.getDimensions().length}}}}}},i={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"},refLines:{uses:"reflines"}}};var k={uses:"data",items:{dimensions:{items:{nullSuppression:{show:function(a,b,d){return!c.isContinuousChart(d.layout)}}}}}};return{type:"items",component:"accordion",items:{data:k,sorting:h,addons:i,settings:g}}}),define("extensions.qliktech/linechart/linechart-data",["client.utils/property-resolver"],function(a){function b(a){var b,c=a.getDimensions(),d=a.getMeasures();1===c.length&&1===d.length?0!==a.getSorting()[0]&&a.changeSorting(1,0):c.length>1&&1===d.length&&(b=a.getSorting().indexOf(0),0!==b&&a.changeSorting(b,0))}function c(b,c){var d=c.getDimensions(),e=c.getMeasures(),f=a.getValue(b,"color.mode");d.length>1&&a.setValue(b,"color.persistent",!0),"byMeasure"===f&&(d.length>1||e.length>1)?a.setValue(b,"color.mode","byDimension"):"byDimension"===f&&d.length<=1&&e.length<=1?a.setValue(b,"color.mode","primary"):"byExpression"===f&&0===e.length&&a.setValue(b,"color.mode","primary")}function d(a){return a>=2?1:15}return{dimensions:{min:1,max:function(a){return a>=2?1:2},add:function(a,d,e){e.getDimensions().length>1&&(d.qHyperCubeDef.qMode="K",d.qHyperCubeDef.qAlwaysFullyExpanded=!0),b(e),c(d,e)},move:function(a,d,e){e.getDimensions().length>1&&(d.qHyperCubeDef.qMode="K",d.qHyperCubeDef.qAlwaysFullyExpanded=!0),b(e),c(d,e)},remove:function(a,b,d){var e=d.getDimensions();c(b,d),1===e.length&&(b.qHyperCubeDef.qMode="S")},autoSort:function(a,b,c,d){c&&(c.indexOf("$numeric")!==-1||c.indexOf("$date")!==-1||c.indexOf("$timestamp")!==-1?d.qSortByNumeric=1:c.indexOf("$text")===-1&&c.indexOf("$ascii")===-1||(d.qSortByAscii=1))}},measures:{min:1,max:d,add:function(a,d,e){b(e),c(d,e)},move:function(a,d,e){b(e),c(d,e)},remove:function(a,b,d){var e=d.getDimensions();c(b,d),e.length>1?(b.qHyperCubeDef.qMode="K",b.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===e.length&&(b.qHyperCubeDef.qMode="S")}}}}),define("extensions.qliktech/linechart/linechart-explore-properties",["client.utils/default-property-logic","client.utils/property-hypercube-helper","./linechart-util"],function(a,b,c){var d=a.getLogicFor("explore","linechart");return{type:"items",component:"accordion",items:{data:{uses:"data"},sort:{uses:"sort",show:function(a,b){return!c.isContinuousChart(b)},items:{dimensions:{locked:function(a,c){return 1===b.getNumMeasures(c)&&2===b.getNumDimensions(c)&&0===a}}}},presentation:{uses:"presentation",items:{valueLabels:{type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",diffs:["dataPoint.show","dataPoint.showLabels"],options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],setPropertyValue:function(a,b){a.dataPoint.show=b,a.dataPoint.showLabels=b},getValue:function(a){return a.dataPoint.show&&a.dataPoint.showLabels}},lineType:{ref:"lineType",type:"string",component:"item-selection-list",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.area",value:"area"}]},logarithmic:{type:"boolean",component:"switch",translation:"properties.axis.logarithmicScale",ref:"measureAxis.logarithmic",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},color:{uses:"color",items:{mode:{options:d.color.colorMode.options}}}}}}),define("text!extensions.qliktech/linechart/linechart.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="!dataAttributes.noDataExist && dataAttributes.onlyNanDim && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.noDataExist" direction="options.direction"></div>\n'}),define("extensions.qliktech/linechart/linechart",["jquery","util","core.utils/deferred","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","./linearea","extensions.qliktech/linechart/linechart-properties","extensions.qliktech/linechart/linechart-data","extensions.qliktech/linechart/linechart-explore-properties","objects.backend-api/stacked-api","text!./linechart.ng.html","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.utils/event-utils","./linechart-util","objects.utils/num-date-time-formatter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){var b,c,d=0,f=0;b=this.components.measureAxis,!a.dataPoint.show||this._layoutMode<=e.prototype.ShowFlags.XSMALL?(d=0,f=0):a.dataPoint.show&&(c=15,a.dataPoint.showLabels&&(d=c+7,f=0)),["near","bottom"].contains(this.components.dimensionAxis.dock)?b.setPadding(d,0,f,0):b.setPadding(f,0,d,0)}function s(a,b,c){return a===b&&(a>0&&(a+=c),b<0&&(b-=c)),b>=1?b=1:b>0?b=Math.pow(10,Math.floor(Math.log(b)/Math.log(10))):a<=-1?a=-1:a<0&&(a=-Math.pow(10,Math.floor(Math.log(-a)/Math.log(10)))),{max:a,min:b}}function t(a,b,c,d){for(var e,f,g=0;g<c.length;g++)for(var h=0;h<d.length;h++)if(c[g].qName===d[h].qName){e=d[h].qTicks.filter(function(b){return b.qEnd+1<a}),f=d[h].qTicks.filter(function(a){return a.qStart+1>b}),c[g].qTicks=e.concat(c[g].qTicks,f);break}}var u,v={NONE:0,ONE_DIM:1,TWO_DIM:2};return u=d.extend("LineChart",{namespace:".linechart",init:function(b,c,d,h,i){var j,k=a.extend(!0,{},d);d=a.extend(!0,d||{},{components:{dataArea:{clazz:g},miniChart:{components:{dataArea:{clazz:g},timeAxis:{show:!1,clazz:f,dock:"bottom"}}},timeAxis:{show:!0,order:1,dock:"bottom",relevantSize:90,reductionOrder:2,clazz:f,showFlag:{whenHorizontal:{vertical:e.prototype.ShowFlags.SMALL,horizontal:e.prototype.ShowFlags.XSMALL},whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.SMALL}}}}},k),this._super(b,c,d,h,i),this.components.miniChart&&(j=this.components.miniChart,this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setMiniChart(j),j.setColorMap(this.providers.colorMap),j.components.measureAxis.setDock("left"),j.components.dimensionAxis.setDock("bottom"),j.components.dataArea.setMinorAxis(j.components.measureAxis),j.components.dataArea.setMajorAxis(j.components.dimensionAxis),j.setOrientation("vertical")),this.components.timeAxis.isDimension=!0,this.components.dataArea.setTimeAxis(this.components.timeAxis)},initSelections:function(){if(!this.options._disableSelections){this.selections.types.range.setComponent("x",this.components.dimensionAxis),this.selections.types.range.setComponent("y",this.components.measureAxis),this.selections.Select.bind(function(a,b){this.onSelection.Select.apply(this,[a,b,this.selections.getActiveType().activeComponent.getSelectionIndices(),"L"])}.bind(this));var a=function(a){this.onSelection.scheduleInvalidation.call(this),this.components.timeAxis.setSelectedRanges(a),this.components.dataArea.updateRangeSelection(a),this.components.miniChart.components.dataArea.updateRangeSelection(a)};this.selections.UpdateRanges.bind(a.bind(this)),this.selections.Clear.bind(a.bind(this,[])),this.selections.Deactivated.bind(a.bind(this,[]))}this._super()},_postResize:function(){this.components.measureAxis.setNiceNumberEnabled(this._layoutMode>e.prototype.ShowFlags.XSMALL),this._super()},partialUpdate:function(){return this.components.dataArea.freezeZOrdering(),this._super.apply(this,[].slice.call(arguments))},isValid:function(a){return this._super(a)&&!this.supressChartRendering},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var a,b=this.components.scrollArea,d=[];r.call(this,this._data),this.layout(),!this.isDimensionContinuous&&this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(d.push(this.components.miniChart.setData(this._data)),this._dataForMiniChartChanged=!1);var e=this.checkPage();if(e)d.push(e);else{for(a in this.components)d.push(this.components[a].invalidateDisplay("LineChart.paint"));b.viewState.min+b.viewState.range>b.fullState.max&&b.setOffset(b.fullState.max-b.viewState.range)}return c.all(d)},prePaint:function(a){this._super(a);var b=!1;if(2===a.qHyperCube.qDimensionInfo.length&&a.qHyperCube.qStackedDataPages[0]){var c=a.qHyperCube.qStackedDataPages[0].qData[0];b=c&&(0!==c.qSubNodes[0].qUp||0!==c.qSubNodes[c.qSubNodes.length-1].qDown)}m.applyDisclaimerAttributes({title:a.qHyperCube.qDimensionInfo.length>1,bottom:!0,supportRangeOverZero:!a.measureAxis.logarithmic,paging:1===a.qHyperCube.qDimensionInfo.length,explicitLimitedData:b},this.$scope.dataAttributes,this.$element,this.$scope,a);var d=p.isContinuousChart(a),e=a.qHyperCube.qDimensionInfo[0];this.$scope.dataAttributes.onlyNanDim=!!d&&!!e&&(e.qMax<e.qMin||"NaN"===e.qMax),this.supressChartRendering=this.$scope.dataAttributes.noDataExist||this.$scope.dataAttributes.onlyNanDim},getApproriateNrOfBins:function(a){var b=4,c=a.qHyperCube.qMeasureInfo.length||1,d=b+2*(c-1);return a.qHyperCube.qDimensionInfo.length>1&&(c=Math.max(1,Math.min(12,a.qHyperCube.qDimensionInfo[1].qStateCounts.qLocked+a.qHyperCube.qDimensionInfo[1].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[1].qStateCounts.qSelected)),b=2,d=b*c),Math.ceil(2e3/(c*d))},getHyperCubeContinousData:function(a){if(a.qStart>a.qEnd)return c.resolve({qAxisData:{qAxis:[]},qDataPages:[{qMatrix:[],qTails:!1,qArea:{qLeft:0,qTop:0,qRight:0,qBottom:0}}]});var b=this;return this.backendApi.getHyperCubeContinousData(a,!1).then(function(a){return b.cancelPromises?c.reject():a})},getFullContinousData:function(a,c,d){return this.getHyperCubeContinousData({qStart:c,qEnd:d,qNbrPoints:this.getApproriateNrOfBins(a),qMaxNbrTicks:300,qMaxNumberLines:12}).then(function(c){return this._cachedContinousMatrix=c.qDataPages[0].qMatrix,a.qHyperCube.qDimensionInfo[0].qIsCyclic||(this._cachedContinousAxisData=c.qAxisData),this._cachedFocusAxisData=b.extend(!0,{},c.qAxisData),this._lowerFocusIndex=null,this._upperFocusIndex=null,c}.bind(this))},getFocusedContinousData:function(a,c,d){return this.getHyperCubeContinousData({qStart:a,qEnd:c,qNbrPoints:this.getApproriateNrOfBins(d),qMaxNbrTicks:300,qMaxNumberLines:12}).then(function(d){if(this._cachedContinousMatrix&&!this._readStoredData){d.qDataPages[0]&&d.qDataPages[0].qMatrix.length&&(a=Math.min(a,d.qDataPages[0].qMatrix[0][0].qNum),c=Math.max(c,d.qDataPages[0].qMatrix[d.qDataPages[0].qMatrix.length-1][0].qNum));var e=this._cachedContinousMatrix.filter(function(b){return b[0].qNum<a}),f=this._cachedContinousMatrix.filter(function(a){return a[0].qNum>c});d.qDataPages[0].qMatrix=e.concat(d.qDataPages[0].qMatrix,f);var g=p.getFocusRange(d.qDataPages[0].qMatrix,e.length,f.length,this._data.qHyperCube.qDimensionInfo.length);this._lowerFocusIndex=g.lower,this._upperFocusIndex=g.upper}return this._cachedContinousAxisData&&!this._readStoredData&&(this._cachedFocusAxisData=b.extend(!0,{},d.qAxisData),t(a,c,d.qAxisData.qAxis,this._cachedContinousAxisData.qAxis)),d}.bind(this))},updateTimeData:function(a,b){var c=this,d=this._data;return this.getFocusedContinousData(a,b+1,d).then(function(a){d.qHyperCube.qDataPages=a.qDataPages,d.qHyperCube.qAxisData=a.qAxisData;var b=0===d.qHyperCube.qDataPages[0].qMatrix.length;c.components.timeAxis.setLabels(b?[]:d.qHyperCube.qAxisData.qAxis);var e=c.components.timeAxis.getUseTransition();c.components.timeAxis.setUseTransition(!1),c.components.timeAxis.updateSize(),c.components.timeAxis.setUseTransition(e)})},updateData:function(c){var d=this;if(this.setIsDimensionContinuous(p.isContinuousChart(c)),this.selectionsCache.setSelectionMode(this.isDimensionContinuous?this.selectionsCache.SELECTION_MODE.VALUE:this.selectionsCache.SELECTION_MODE.VALUE|this.selectionsCache.SELECTION_MODE.ROW),this.isDimensionContinuous){var e=c.qHyperCube.qDimensionInfo[0].qMin,f=c.qHyperCube.qDimensionInfo[0].qMax;f<e||"NaN"===f?e=f="NaN":e===f&&(e-=.5,f+=.5);var g=a.extend(!0,{},c,{qHyperCube:{qMode:"S"}}),h=this._super;return this.getFullContinousData(c,e,f).then(function(a){return g.qHyperCube.qDataPages=a.qDataPages,g.qHyperCube.qAxisData=a.qAxisData,d.components.miniChart.setData(g,!0),c=b.extend({},c),c.qHyperCube=b.extend({},c.qHyperCube,{qMode:"S"}),c.qHyperCube.qDataPages=a.qDataPages,c.qHyperCube.qAxisData=a.qAxisData,d.components.timeAxis.setDataRange(e,f),d.components.scrollArea.setFullRange(f-e),d.components.scrollArea.setViewRange(f-e),d.components.timeAxis.setPlotMin(e),d.components.timeAxis.setPlotMax(f),o.cancelDebounce(d._debounceUpdateHandle),h.call(d,c)})}return this._super(c)},_updateData:function(a){this._checkPage=!1,this._data=a,this.isDimensionContinuous||(this._dataForMiniChartChanged=!0),this._disablePagingTransitions(),this.components.dataArea.unFreezeZOrdering(),this.isStacked=("stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea)&&(a.qHyperCube.qDimensionInfo.length>1||a.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,!this.isDimensionContinuous&&a.qHyperCube.qDimensionInfo.length>1&&!this.isStacked?this.components.scrollArea.setUseMiniChart(!1):this.components.scrollArea.setUseMiniChart(!0);var b=null;if(this._pagingMode=v.NONE,this.components.dataArea.setSelectionIndices([0]),a.qHyperCube.qDimensionInfo.length>1){var c=a.qHyperCube.qDimensionInfo[1].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[1].qStateCounts.qSelected;b=a.qHyperCube.qStackedDataPages&&a.qHyperCube.qStackedDataPages.length&&a.qHyperCube.qStackedDataPages[0].qData&&a.qHyperCube.qStackedDataPages[0].qData[0]?a.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+a.qHyperCube.qStackedDataPages[0].qData[0].qDown+a.qHyperCube.qStackedDataPages[0].qData[0].qUp:null,this.components.dimensionAxis.setSelectionIndices([0]),!a.qHyperCube.qDimensionInfo[1].qLocked&&c>1?this.components.dataArea.setSelectionIndices([1]):this.components.dataArea.setSelectionIndices([0]),this._pagingMode=v.ONE_DIM,this.isStacked=!0}else a.qHyperCube.qSize.qcy>a.qHyperCube.qDataPages[0].qArea.qHeight&&(b=a.qHyperCube.qSize.qcy,this._pagingMode=v.ONE_DIM);this.components.dataArea.isDimensionContinuous=this.isDimensionContinuous,this.isDimensionContinuous?this._pagingMode=v.NONE:(this.components.dimensionAxis.isDiscrete()||(this._pagingMode=v.NONE),this.components.dimensionAxis.setNumDiscreteUnits(b));var d,e={axes:{measureAxis:{component:this.components.measureAxis,data:a.measureAxis,dataIndices:a.qHyperCube.qMeasureInfo.map(function(a,b){return b})},dimensionAxis:{component:this.components.dimensionAxis,data:a.dimensionAxis,dataIndices:a.qHyperCube.qDimensionInfo.map(function(a,b){return b})},timeAxis:{component:this.components.timeAxis,data:a.dimensionAxis}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.refLineLabels,axis:this.components.measureAxis}},refLines:{component:this.components.refLines},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:a.dimensionAxis},measureAxisTitle:{component:this.components.measureAxisTitle,data:a.measureAxis}}},f=this.components.dimensionAxisTitle,g=this.components.measureAxisTitle;this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.colorLegend.setData(a);var h=this.providers.colorMap.getLegendDataProvider();h.setLegendMarker(a.dataPoint.show?["line","circle"]:["line"]),f.setData(a),g.setData(a),this._super(a,e),d=this.getSnapshotStoredChartData(),this._readStoredData&&d?(this.components.dimensionAxis.setInnerOffset(d.axisInnerOffset),this.components.scrollArea.setOffset(d.scrollOffset),this.components.scrollArea.setViewRange(d.viewRange)):this.options.viewState?(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset)):isNaN(a.scrollStartPos)?this.isDimensionContinuous||(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)):this.components.scrollArea.setRelativeOffset(a.scrollStartPos),this.isDimensionContinuous||(this._checkPage=!0)},updateDataArea:function(a){var b="stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea?"stackedArea":a.lineType;this._super.apply(this,[].slice.call(arguments)),this.components.dataArea.setLineType(b),"byExpression"===a.color.mode?this.components.dataArea.interpolateVaryingColors=!a.color.expressionIsColor&&["sg","dg"].indexOf(a.color.measureScheme)!==-1:this.components.dataArea.interpolateVaryingColors=!1,this.components.miniChart&&(this.components.miniChart.components.dataArea.setLineType(b),this.components.miniChart.components.dataArea.setNullMode(a.nullMode),this.components.miniChart.components.dataArea.setSeparateStacking(a.separateStacking),this.components.miniChart.setLogScale(a.measureAxis.logarithmic)),this.components.dataArea.setShowDataPoints(a.dataPoint.show),this.components.dataArea.setNullMode(a.nullMode),this.components.dataArea.setSeparateStacking(a.separateStacking),this.components.dataArea.setShowDataPointLabels(a.dataPoint.showLabels),this.components.dataArea.updateNow(["properties"])},updateGrid:function(a,b){this._super(a,b),this.components.grid.setAxes(this.isDimensionContinuous?this.components.timeAxis:this.components.dimensionAxis,this.isDimensionContinuous?void 0:this.components.measureAxis)},updateAxis:function(a,c){this._super(a,c);var d,e,f,g,h,i,j,k=this.getSnapshotStoredChartData();this.components.dimensionAxis.setData(a),this.components.timeAxis.setData(a),f=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),g=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),b.isNumeric(f)||(f=-1),b.isNumeric(g)||(g=1),h=c.axes.measureAxis,i=!h.data.autoMinMax&&["min","minMax"].contains(h.data.minMax)?Number(h.data.min):null,j=!h.data.autoMinMax&&["max","minMax"].contains(h.data.minMax)?Number(h.data.max):null,this._dataMaxPositive=g>0,this._dataMinNegative=f<0,d=this.components.measureAxis,d.setWhiteSpaceOptimizingEnabled(!0),d.setRealDataRange(void 0,void 0);var l=this.components.dataArea.getMajorAxisData(),m=this.components.dataArea.getMinorAxisData();if(this.components.dimensionAxis.setDataRange(l.data,l.info),e=0,g<f?(g=10,f=-10):g===f&&(g?e=Math.abs(g?.2*g:0):(g=10,f=-10)),this._readStoredData&&k&&k.dataRanges)this.setAxisDataRange(d,k.dataRanges[0].max,k.dataRanges[0].min,j,i,e);else if(m&&("stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea)&&(a.qHyperCube.qMeasureInfo.length>1||a.qHyperCube.qDimensionInfo.length>1))this.setAxisDataRange(d,m.max,m.min,j,i,e);else if("line"!==a.lineType)if(this._data.measureAxis.logarithmic){var n=s(g,f,e);this.setAxisDataRange(d,n.max,n.min,j,i,e)}else this.setAxisDataRange(d,g>0?g+e:0,f<0?f-e:0,j,i,e);else this.setAxisDataRange(d,g>0?g+e:Math.min(0,g+e),f<0?f-e:Math.max(0,f-e),j,i,e);if(this.isDimensionContinuous){var o=this._data.qHyperCube.qDataPages[0]&&this._data.qHyperCube.qDataPages[0].qMatrix.length>1;this._disableZoom=!o,this.components.timeAxis.showComponent(),this.components.timeAxis.setLabels(this._data.qHyperCube.qAxisData?this._data.qHyperCube.qAxisData.qAxis:null);var p=this._data.qHyperCube.qDimensionInfo[0].qTags,t=p.indexOf("$date")>-1||p.indexOf("$timestamp")>-1;t?this.components.timeAxis.dimensionFormatter=new q(this.backendApi.localeInfo,this.backendApi.localeInfo.qDateFmt,null,null,"TS"):this.components.timeAxis.dimensionFormatter=this.chartFormatter.getFormattersForMeasures(this._data.qHyperCube.qDimensionInfo,[0])[0],o?this.components.scrollArea.showComponent():this.components.scrollArea.hideComponent(),this.components.dimensionAxis.hideComponent()}else this.components.dimensionAxis.showComponent(),this.components.timeAxis.hideComponent();r.call(this,a),this.components.dimensionAxisTitle.setSelectionsEnabled(!!this.selections),this.components.measureAxisTitle.setSelectionsEnabled(!!this.selections)},getPreferredSize:function(){return this._super()},destroy:function(){return this.cancelPromises=!0,this._super()}}),{type:"linechart",BackendApi:k,template:l,View:u,definition:h,softDefinition:j,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:500,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},data:i,support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0},options:{selections:{dataArea:{},range:{},colorLegend:{}},tooltips:{}},importProperties:function(a,b,c){var d=n.axisChart.importProperties.apply(n,[a,b,c]),e=d.qProperty;return e.qHyperCubeDef.qDimensions.length>1&&(e.qHyperCubeDef.qMode="K"),e.color&&"byDimension"===e.color.mode&&e.qHyperCubeDef.qDimensions.length<=1&&e.qHyperCubeDef.qMeasures.length<=1&&n.changeProperty("color.mode","primary",d),d},exportProperties:n.axisChart.exportProperties.bind(n)}}),define("extensions.qliktech/treemap/treemap-node",["objects.views/charts/shapes/container","objects.views/charts/shapes/display-object","objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/rect","objects.views/charts/shapes/rect","general.utils/shapes/rect"],function(a,b,c,d,e,f){var g=a.extend("TreemapNode",{init:function(a,b,c){this._super(),this.x=0,this.y=0,this.width=0,this.height=0,this.data.area=0,this.data.value=b||0,this.data.label=a||"",this.data.valueLabel=c||"",f.apply(this,[0,0,0,0])},pointInside:b.prototype.pointInside,containsPoint:e.prototype.containsPoint,intersectsLocalLine:e.prototype.intersectsLocalLine,getLocalPoints:e.prototype.getLocalPoints,getLocalBoundingRect:e.prototype.getLocalBoundingRect,_calculateBounds:b.prototype._calculateBounds});return Object.keys(e.prototype).forEach(function(a){!g.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(a)<0&&(g.prototype[a]=e.prototype[a])}),c._registerRenderFn(d.render,g),g}),define("extensions.qliktech/treemap/treemap-layout",["core.utils/class","extensions.qliktech/treemap/treemap-node","translator"],function(a,b,c){function d(a,b){var c,e;for(c=0;c<a.length;c++)e=a[c],e.x=b-e.x-e.width,e._children&&e._children.length&&d(e._children,b)}function e(a,b){var c,d;for(c=0;c<a.length;c++)d=a[c],d.y=b-d.y-d.height,d._children&&d._children.length&&e(d._children,b)}var f,g=24,h=4,i=8e3,j=4e3,k={NONE:0,NONE_COLLAPSED:.1,LEAF:1,HEADER:2,OVERLAY:3};return f=a.extend("TreemapLayout",{init:function(){this.cellPadding=2,this.collapseHeadersOnSmallBranches=!0,this.labeling={},this.othersLabel=c.get("properties.dimensionLimits.others")},sort:function(){return this},weigh:function(a,c,d){if(!a||!a.length)return this;d=d||0;for(var e,f,g=a.length,h=0,i=0,j=a[0].parent.data.value;g;)h+=a[--g].data.value;for(g=a.length,e=Math.max(h,j);g;)a[--g].data.weight=e?a[g].data.value/e:0,i+=a[g].data.weight,a[g].isBranch&&this.weigh(a[g].children,c,d+1);return 1-i>1e-5&&(f=new b,f.data.label="",f.data.weight=1-i,f.x=0,f.y=0,f.width=0,f.height=0,f.data.qElemNo=-3,f.data.qType="O",f.data.isFakeOthers=!0,f.data.value=j-h,f.data.depth=(a[0].parent.data.depth||0)+1,a[0].parent.addChild(f),a[0].parent.children!==a&&a.push(f)),this},layout:function(){return this},arrange:function(a,b,c,f,i,j,l,m){if(!a||!a.length)return this;this.layout(a,b,c,f,i);var n,o,p,q=this.cellPadding;for(p=0;p<a.length;p++)n=a[p],n.visible=n.width>0&&n.height>0,n.isBranch?(n.width=Math.max(0,n.width-q),n.height=Math.max(0,n.height-q),n.x+=.5*q,n.y+=.5*q,n.visible=n.width>0&&n.height>0,n.data.labelType=this._getLabelType(j,!0,n.data.area),o=n.data.labelType!==k.HEADER?0:g,n.data.labelType===k.NONE_COLLAPSED&&(o=h,n.data.labelType=k.NONE),this.arrange(n.children,n.width,n.height-o,n.x,n.y+o,j+1)):n.data.labelType=this._getLabelType(j,!1,n.data.area);return 0===j&&(1===l&&d(a,b),1===m&&e(a,c)),this},_getLabelType:function(a,b,c){return b?a>this.labeling.headers.numLevels?k.NONE:a===this.labeling.headers.numLevels?this.labeling.overlay.show&&c>=j?k.OVERLAY:k.NONE:this.collapseHeadersOnSmallBranches&&c<i?k.NONE_COLLAPSED:c<j?k.NONE:k.HEADER:c<j||"none"===this.labeling.leaves.type?k.NONE:k.LEAF;
}}),f.LABEL=k,f}),define("extensions.qliktech/treemap/treemap-squarified-layout",["extensions.qliktech/treemap/treemap-layout"],function(a){"use strict";function b(a,b,c){var d,f,g,h=c.x,i=c.y,j=c.shortSide,k=a.length,l=0;if(c.direction===e){for(;l<k;l++)g=a[l],g.data.area<=0?(f=0,d=j):(f=j*g.data.area/b,d=g.data.area/f),g.x=Number(h.toFixed(5)),g.y=Number(i.toFixed(5)),g.width=Number(d.toFixed(5)),g.height=Number(f.toFixed(5)),i+=f;c.x+=d,c.width-=d}else{for(;l<k;l++)g=a[l],g.data.area<=0?(d=0,f=j):(d=j*g.data.area/b,f=g.data.area/d),g.x=Number(h.toFixed(5)),g.y=Number(i.toFixed(5)),g.width=Number(d.toFixed(5)),g.height=Number(f.toFixed(5)),h+=d;c.y+=f,c.height-=f}}function c(a,b,c,d){for(var e,f,g=Number.MAX_VALUE,h=0,i=b*b,j=c*c,k=a.length;k;)a[--k].data.area<g&&(g=a[k].data.area),a[k].data.area>h&&(h=a[k].data.area);return e=Math.max(i*h/j,j/(i*g)),d.data.area<g&&(g=d.data.area),d.data.area>h&&(h=d.data.area),j=(c+d.data.area)*(c+d.data.area),f=Math.max(i*h/j,j/(i*g)),f<=e}var d,e=0,f=1;return d=a.extend({init:function(){this._super()},sort:function(a){var b,c;if(!a||!a.length)return this;for(a.sort(function(a,b){return"O"===b.data.qType?-1:"O"===a.data.qType?1:b.data.weight-a.data.weight}),c=a.length,b=0;b<c;b++)a[b].isBranch&&this.sort(a[b].children);return this},layout:function(a,d,g,h,i){if(!a||!a.length)return this;var j,k,l,m,n={x:h,y:i,width:d,height:g,direction:g<=d?e:f,shortSide:Math.min(g,d)},o=0,p=[],q=d*g;for(k=a.length;k;)a[--k].data.area=q*a[k].data.weight;for(k=0;k<a.length;)j=a[k],n.direction===e?(m=n.height*j.data.area/(o+j.data.area),l=j.data.area/m):(l=n.width*j.data.area/(o+j.data.area),m=j.data.area/l),!p.length||c(p,n.shortSide,o,j)?(o+=j.data.area,p.push(j),k++):(b(p,o,n),o=0,p=[],n.shortSide=Math.min(n.width,n.height),n.direction=n.height<=n.width?e:f);return p.length&&b(p,o,n),this}})}),define("extensions.qliktech/treemap/treemap-hierarchy",["core.utils/class","extensions.qliktech/treemap/treemap-node"],function(a,b){"use strict";function c(a,d,e,g,h,i,j){var k,l,m,n,o,p=d?d.length:0;for(g=g||0,j=j||0,o=0;o<p;o++)k=null,m=d[o],l=m.children,m.data.qType===f.PSEUDO&&(j=o),m.data.qType!==f.TOTAL&&(l.length||"N"===m.data.qType?1===l.length&&l[0].data.qType===f._MEASURE?(n=l[0].children,n=n?n[0]:null,n&&!isNaN(n.data.qValue)&&n.data.qValue>0&&(k=new b(m.data.qText,n.data.qValue,i?i.formatValue(n.data.qValue):n.data.qText),k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem)):1===l.length&&l[0].data.qType===f.VALUE?!isNaN(l[0].data.qValue)&&l[0].data.qValue>0&&(k=new b(m.data.qText,l[0].data.qValue,i?i.formatValue(l[0].data.qValue):l[0].data.qText),k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem):m.data.qMaxPos>0&&(k=new b(m.data.qText,m.data.qMaxPos),k.data.qElemNo=m.data.qElemNo,k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.cacheItem=m.cacheItem,k.data.addMeasures=!0,m.cacheItem&&m.cacheItem.addShape("dataArea",k),l.length&&c(k,l,e,g+1,h,i,j)):!isNaN(m.data.qValue)&&m.data.qValue>0&&(k=new b(m.data.qText,m.data.qValue,m.data.qText),k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,k.data.row=m.data.rowIndex,k.data.isMeasure=g===e,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem),k&&(k.data.depth=g,isNaN(j)||(k.data.measureIndex=j),a.addChild(k)))}function d(a){var b=[];return a.forEach(function(a){b=b.concat(a.children)}),b}var e,f={PSEUDO:"P",TOTAL:"T",VALUE:"V",NORMAL:"N",OTHERS:"O",ROOT:"R",_MEASURE:"_M"};return e=a.extend("TreemapHierarchy",{init:function(a){this.root=a||new b,this._pseudoDimPos=0,this.labeling={values:{show:!1}}},setData:function(a,b){this._pseudoDimPos=a.pseudoDimPos||0,this._numMeasures=a.qHyperCube.qMeasureInfo.length,this._numDimensions=a.qHyperCube.qDimensionInfo.length,this._dimensionLocks=a.qHyperCube.qDimensionInfo.map(function(a){return a.qLocked}),this._selectionStates=a.qHyperCube.qDimensionInfo.map(function(a){return a.qStateCounts});var d=this.labeling.values.show&&this.measureFormatters&&this.measureFormatters[0]&&"U"===this.measureFormatters[0].type?this.measureFormatters[0]:null,e=a.qHyperCube.qStackedDataPages[0].qData,g=a.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}),h=a.qHyperCube.qMeasureInfo.length>1?this._pseudoDimPos:-1;this.root.removeChildren(),e&&e.length&&(this.root.data.value=e[0].qMaxPos,this.root.data.qType=f.ROOT,c(this.root,b.children,h,0,g,d))},getDimensionIndexFromNode:function(a){var b,c,d=0;if(!a)return-2;if(a.data.qType===f.PSEUDO)return-1;for(b=a,c=b.parent;b&&c&&c!==this.root;)b=c,c=b.parent,b.data.qType!==f.PSEUDO&&d++;return d},getSelectableCacheItems:function(a){if(!a||!a.length)return[];var b,c=a[0],e=c.children,g=this.getDimensionIndexFromNode(c);return c.data.qType===f.PSEUDO?e.length?this.getSelectableCacheItems(d(a)):[]:this._dimensionLocks[g]?e.length?this.getSelectableCacheItems(d(a)):[]:(b=this.getCacheItemsFromNodes(a),b.length<=1&&this._selectionStates[g].qSelected&&!this._selectionStates[g].qOption&&e.length?this.getSelectableCacheItems(d(a)):b)},getCacheItemsFromNodes:function(a){var b,c=a?a.length:0,d=[];for(b=0;b<c;b++)a[b].data.cacheItem&&d.indexOf(a[b].data.cacheItem)<0&&d.push(a[b].data.cacheItem);return d}})}),define("extensions.qliktech/treemap/treemap-area",["general.utils/color","./treemap-squarified-layout","./treemap-hierarchy","client.utils/property-resolver","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/text","objects.views/charts/components/chart-component","objects.views/charts/chart-style-service","core.utils/deferred"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(b,c){var d=1;return w.width=8*d,w.height=8*d,x.save(),x.fillStyle=a.toRGBA(b),x.strokeStyle=a.toRGBA(b,c),x.lineWidth=2,x.scale(d,d),x.beginPath(),x.moveTo(5,-1),x.lineTo(-1,5),x.moveTo(9,3),x.lineTo(3,9),x.stroke(),x.restore(),x.createPattern(w,"repeat")}function m(b,c){var d,e,f,g,i,j,k,l=b?b.length:0,n="leaf",o=new a(this._style.overlay.label.color.light),p=new a(this._style.overlay.label.color.dark),q=function(a,b){return b.data.isColorDark?a+b.data.value:a};for(d=0;d<l;d++)if(e=b[d],n=e.data.labelType,e.isBranch?(m.apply(this,[b[d].children,c+1]),j=this._branchLabelContainer):j=this._leafLabelContainer,e.data.labelType){switch(g=e.data.label,g&&g.length>512&&(g=g.substr(0,256)),this.labeling.values.show&&1===n&&e.data.valueLabel&&(g=[g,e.data.valueLabel]),e.data.labelShape?e.data.labelShape.parent||j.addChild(e.data.labelShape):(e.data.labelShape=new h,e.data.labelShape.setText(g),j.addChild(e.data.labelShape)),i={x:e.x,y:e.y,width:e.width,height:e.height,maxHeight:e.height-4,maxWidth:e.width-8,align:this.yMirrorMode?"right":"left",baseline:"top"},n){case 3:e.data.labelFill||(k=e.descendants,e.data.labelFill=k.reduce(q,0)>e.data.value/2?o:p,e.data.labelStroke=e.data.labelFill===o?"rgba(33, 33, 33, 0.4)":"rgba(230, 230, 230, 0.4)",e.data.labelFill=e.data.labelFill.toRGBA(),e.data.labelShape.strokeFirst=!0),i.fill=e.data.labelFill,i.stroke=e.data.labelStroke,i.maxNumLines=/\s+/.test(e.data.label)?2:1,f=Math.round(.1*Math.sqrt(2*e.data.area)),i.font=this._styleService.getFont(r,"overlay.label",null,null,f),i.strokeWidth=f>64?2:1,i.align="center",i.baseline="middle";break;case 2:i.fill=this._style.branch.label.color,i.stroke=void 0,i.x+=4,i.width-=8,i.font=this._style.branch.label.font,i.baseline="middle",i.maxNumLines=1,i.height=s;break;default:i.fill=e.data.isColorDark?this._style.leaf.label.color.light:this._style.leaf.label.color.dark,i.x+=4,i.y+=4,i.width-=8,i.height-=8,i.font=this.labeling.leaves.type===t.DYNAMIC?this._styleService.getFont(r,"leaf.label",null,null,Math.round(.1*Math.sqrt(2*e.area))):this._style.leaf.label.font,i.baseline="top",i.maxNumLines=this.labeling.values.show?[-1,1]:[-1]}e.data.labelShape.attrs(i)}else e.data.labelShape&&e.data.labelShape.detach()}function n(b){var c,d,e,f=b?b.length:0,g=this._colorMap;for(c=0;c<f;c++)b[c].isBranch?(b[c].fill=this._style.branch.fill,b[c].stroke=null,n.call(this,b[c].children)):b[c].data.isInitiated||(e=[],"P"!==b[c].data.qType&&"undefined"!=typeof b[c].data.qElemNo&&e.push(b[c].data.qElemNo),b[c].ancestors.forEach(function(a){["A","N"].contains(a.data.qType)&&e.push(a.data.qElemNo)}),e.reverse(),b[c].data.isInitiated=!0,b[c].data.color=g.getColor(e,b[c].data.value,b[c].data.measureIndex||0,b[c].data.row),d=b[c].data.isFakeOthers?this._branchColorAtDepth[b[c].data.depth]:b[c].data.color,b[c].data.isColorDark=a.getBestContrast(d,u,v)===u,b[c].fill=b[c].data.isFakeOthers?this._fakeOthersPatternAtDepth[b[c].data.depth]:b[c].data.color.toRGBA(),b[c].stroke=this._sheetBackgroundStroke,b[c].strokeWidth=1)}function o(a){var b={backgroundColor:a.getValue(r,null,"backgroundColor"),branch:{fill:a.getValue(r,"branch","fill"),label:{color:a.getValue(r,"branch.label","color"),font:a.getFont(r,"branch.label")}},leaf:{border:{width:{default:a.getValue(r,"leaf.border","width"),selected:a.getValue(r,"leaf.border","width","selected")},color:{default:a.getValue(r,"leaf.border","color"),selected:a.getValue(r,"leaf.border","color","selected")}},label:{font:a.getFont(r,"leaf.label"),color:{light:a.getValue(r,"leaf.label","color","light"),dark:a.getValue(r,"leaf.label","color","dark")}}},overlay:{label:{color:{light:a.getValue(r,"overlay.label","color","light"),dark:a.getValue(r,"overlay.label","color","dark")}}}};return b}function p(b,c){var d=b._a+c._a*(1-b._a),e=(b._r*b._a+c._r*c._a*(1-b._a))/d,f=(b._g*b._a+c._g*c._a*(1-b._a))/d,g=(b._b*b._a+c._b*c._a*(1-b._a))/d;return 0===d&&(e=f=g=0),new a(e,f,g,1)}var q,r="treemap",s=24,t={NONE:"none",STATIC:"static",DYNAMIC:"dynamic"},u=new a("#eee"),v=new a("#666"),w=document.createElement("canvas"),x=w.getContext("2d");return q=i.extend("TreeMapArea",{init:function(){this._super.apply(this,arguments),this.renderers={cells:new e(this.container,{name:"cell-layer"}),labels:new e(this.container,{name:"label-layer"}),selections:new e(this.container,{name:"selection-layer"})},this._layout=new b,this._hierarchy=new c(this.renderers.cells.stage),this._pseudoDimPos=0,this._labelSettings={values:{show:!1},headers:{show:!0,numLevels:1},overlay:{show:!0},leaves:{show:!0,type:"static"}},this._styleService=j.getInstance(),this._style=o(this._styleService),this._sheetBackgroundColor=new a(this._style.backgroundColor),this._sheetBackgroundStroke=a.toRGBA(this._sheetBackgroundColor,.5),this.labeling=this._labelSettings},cellPadding:2,setYMirrorMode:function(a){this.yMirrorMode!==a&&(this.yMirrorMode=a,this._yMirrorModeChanged=!0)},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setPseudoDimPos:function(a){this._pseudoDimPos=a},setGlobalOpacity:function(a,b){a<1?(this._globalAlpha=a,this.toggleCacheItem()):this._super(a,b)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay()},_updateSize:function(){this.invalidateDisplay()},_updateProperties:function(){if(this._data){d.getValue(this._data,"labels.auto")?(this.labeling.overlay.show=!0,this.labeling.headers.numLevels=0,this.labeling.leaves.type=t.STATIC):(this.labeling.overlay.show=d.getValue(this._data,"labels.overlay",!0),this.labeling.headers.numLevels=d.getValue(this._data,"labels.headers")&&this._layoutMode>3?1:0,this.labeling.leaves.type=d.getValue(this._data,"labels.leaves")?t.STATIC:t.NONE),this.labeling.values.show=d.getValue(this._data,"labels.values",!1),this._layout.labeling=this.labeling,this._hierarchy.measureFormatters=this.measureFormatters;var b=this._hierarchy.root.children;this._hierarchy.labeling=this.labeling,this._hierarchy.setData(this._data,this._tree),this._dimension=0;var c=this.renderers.labels.stage;c.removeChildren();var e=new g;c.addChild(e);var f=new g;c.addChild(f);var h=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.supressOthers});this._layout.othersLabelByDimension=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.othersLabel}),this._layout.weigh(b,h).sort(b),this._leafLabelContainer=e,this._branchLabelContainer=f;var i=this._hierarchy.getSelectableCacheItems(b),j=this.selectionIdentifier?this.selectionIdentifier:"dataArea",k=0,m=0,o=i[0]?i[0].getShapes(j)[0]:null;o&&o.ancestors.forEach(function(a){a.parent&&("N"===a.data.qType&&k++,m++)}),this.setSelectionIndices([k]),this._dimension=m,this.setSelectableShapes(i);var q=new a(this._style.branch.fill),r=this._data.qHyperCube.qDimensionInfo.length+1;this._branchColorAtDepth=[p(q,this._sheetBackgroundColor)],this._fakeOthersPatternAtDepth=[];for(var s=1;s<r;s++)this._branchColorAtDepth.push(p(q,this._branchColorAtDepth[s-1]));for(s=0;s<r;s++)this._fakeOthersPatternAtDepth.push(l(this._colorMap.getColor([-3]),.1));this._dataChanged=!0,n.call(this,b),this.renderers.selections.stage.doInvalidate=!1,this.renderers.selections.stage.removeChildren()}},hasValidData:function(){return this._super()&&this._data},paint:function(){this._super(this._layoutMode,this._data);var a=this._hierarchy.root.children;return this.renderers.cells.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this.renderers.selections.stage.opacity=1,this._layout.cellPadding=this.cellPadding*Math.sqrt(this.rect.width*this.rect.height)/500,this.labeling.headers.numLevels=(d.getValue(this._data,"labels.auto",!0)||d.getValue(this._data,"labels.headers"))&&this._layoutMode>3?1:0,a.length&&(this._dataChanged||this._yMirrorModeChanged||this._oldW!==this.rect.width||this._oldH!==this.rect.height)&&(this._layout.arrange(a,this.rect.width-4,this.rect.height-4,this.yMirrorMode?-2:2,2,0,this.yMirrorMode?1:0),m.apply(this,[a,0])),this._dataChanged=!1,this._yMirrorModeChanged=!1,this._oldW=this.rect.width,this._oldH=this.rect.height,k.all([this.renderers.cells.render(!0),this.renderers.labels.render(!0),this.renderers.selections.render(!0)])},release:function(){for(var a in this.renderers)this.renderers[a].release();this._selectableShapes=[],this.renderers={},this._hierarchy=null,this._layout=null,this._super()},toggleCacheItem:function(a){var b=!0;this.renderers.cells.stage.opacity!==this._globalAlpha?(b=!1,this.renderers.cells.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha,this.renderers.selections.stage.doInvalidate=!1):this.renderers.selections.stage.doInvalidate=!0,a&&a.getShapes(this.selectionIdentifier?this.selectionIdentifier:"dataArea").forEach(function(c){a.selected?(c.data.borderShape||(c.data.borderShape=new f(c.x,c.y,c.width,c.height),c.data.borderShape.strokeWidth=this._style.leaf.border.width.selected,c.data.borderShape.stroke=this._style.leaf.border.color.selected,this.renderers.selections.stage.addChild(c.data.borderShape)),c.opacity=1,c.find("[data.labelShape]").forEach(function(a){a.data.labelShape.opacity=1,b&&a.data.labelShape.invalidate()}),c.data.labelShape&&(c.data.labelShape.opacity=1,b&&c.data.labelShape.invalidate())):(c.data.borderShape&&(c.data.borderShape.detach(),c.data.borderShape=null),c.opacity=void 0,c.data.labelShape&&(c.data.labelShape.opacity=void 0,b&&c.data.labelShape.invalidate()),c.find("[data.labelShape]").forEach(function(a){a.data.labelShape.opacity=void 0,b&&a.data.labelShape.invalidate()})),b&&c.invalidate()},this),b||(this.renderers.cells.render(),this.renderers.labels.render(),this.renderers.selections.render())}})}),define("text!extensions.qliktech/treemap/treemap.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero" direction="options.direction"></div>'}),define("extensions.qliktech/treemap/treemap-properties",["client.utils/property-resolver","client.utils/default-property-logic"],function(a,b){function c(a,b){var c=b.getDimensions(),d=b.getMeasures();return d.length+c.length>2}var d,e=b.getLogicFor("hard","treemap");d={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!1,items:{labels:{type:"items",items:{auto:{ref:"labels.auto",type:"boolean",translation:"properties.dataPoints.headersAndLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],snapshot:{tid:"property-dataPoints"}},headers:{ref:"labels.headers",translation:"properties.dataPoints.headers",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b,d){return!a.getValue(b,"labels.auto")&&c(b,d)}},overlay:{ref:"labels.overlay",type:"boolean",component:"switch",translation:"properties.dataPoints.overlayLabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b,c){return!a.getValue(b,"labels.auto")&&c.getDimensions().length-(a.getValue(b,"labels.headers")?1:0)>1}},leaves:{ref:"labels.leaves",type:"string",translation:"properties.dataPoints.leafLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b){return!a.getValue(b,"labels.auto")},snapshot:{tid:"property-leafLabels"}},values:{ref:"labels.values",type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b){return a.getValue(b,"labels.auto")||a.getValue(b,"labels.leaves")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-dropdown",translation:"properties.colorDimensionId",show:e.helpers.showDimensionIdOption}}},legend:{items:{show:{defaultValue:!1}}}}}}};var f={uses:"data",items:{dimensions:{},measures:{}}},g={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:f,addons:g,settings:d}}}),define("extensions.qliktech/treemap/treemap-explore-properties",["client.utils/property-resolver","client.utils/default-property-logic"],function(a,b){var c=b.getLogicFor("explore","treemap");return{type:"items",component:"accordion",items:{data:{uses:"data"},presentation:{uses:"presentation",type:"items",translation:"properties.presentation",grouped:!1,items:{labels:{type:"items",items:{auto:{ref:"labels.auto",type:"boolean",translation:"properties.dataPoints.headersAndLabels",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},headers:{ref:"labels.headers",translation:"properties.dataPoints.headers",type:"boolean",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b,c){return!a.getValue(b,"labels.auto")&&c.qHyperCube.qMeasureInfo.length+c.qHyperCube.qDimensionInfo.length>2}},overlay:{ref:"labels.overlay",type:"boolean",component:"switch",translation:"properties.dataPoints.overlayLabels",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b,c){return!a.getValue(b,"labels.auto")&&c.qHyperCube.qDimensionInfo.length-(a.getValue(b,"labels.headers")?1:0)>1}},leaves:{ref:"labels.leaves",type:"string",translation:"properties.dataPoints.leafLabels",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b){return!a.getValue(b,"labels.auto")}},values:{ref:"labels.values",type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b){return a.getValue(b,"labels.auto")||a.getValue(b,"labels.leaves")}}}}}},color:{uses:"color",items:{dimension:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-radio-list",translation:"properties.colorDimensionId",show:function(a){return c.helpers.showDimensionIdOption(a)}}}}}}}}}),define("extensions.qliktech/treemap/treemap-data",["client.utils/property-resolver"],function(a){function b(b,c){var d=c.getDimensions(),e=c.getMeasures(),f=a.getValue(b,"color.mode");d.length>1&&b.color&&(b.color.persistent=!0),"byMeasure"===f&&e.length>1?a.setValue(b,"color.mode","byDimension"):"byExpression"===f&&0===e.length&&a.setValue(b,"color.mode","primary")}function c(a){var b;a.getDimensions().length>1&&(b=a.getSorting().indexOf(0),0!==b&&a.changeSorting(b,0))}function d(b,c){a.setValue(c,"color.dimensionId",void 0)}var e={dimensions:{min:1,max:15,add:function(a,c,d){b(c,d)},move:function(a,d,e){c(e),b(d,e)},remove:function(a,c,e){d(a,c,e),b(c,e)},replace:function(b,c,d,e){a.getValue(e,"color.dimensionId")===c.qDef.cId&&a.setValue(e,"color.dimensionId",b.qDef.cId)}},measures:{min:1,max:1,add:function(a,c,d){b(c,d)},move:function(a,c,d){b(c,d)},remove:function(a,c,d){b(c,d)}}};return e}),define("extensions.qliktech/treemap/treemap",["jquery","./treemap-area","text!./treemap.ng.html","objects.views/charts/chart","objects.backend-api/stacked-api","objects.views/charts/disclaimers/chart-utils","extensions.qliktech/treemap/treemap-properties","extensions.qliktech/treemap/treemap-explore-properties","extensions.qliktech/treemap/treemap-data","objects.views/charts/components/chart-component","objects.views/charts/representation/combo-color-map","core.utils/deferred","objects.extension/object-conversion","objects.views/charts/utils/tree-node","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(a){return a&&!(a.qHyperCube.qMeasureInfo.every(function(a){return a.qMax<=0&&a.qMax>=a.qMin})||0===a.qHyperCube.qSize.qcy)}function p(a){if(a&&a.length)for(var b=0;b<=a.length;)a[b]&&0===a[b].data.qMaxPos&&0===a[b].data.qMinNeg&&"N"===a[b].data.qType?(a.splice(b,1),b--):b++;if(1===a.length){if("undefined"===a||!a.length||"undefined"===a[0]._children||"_M"===a[0].data.qType)return}else if("undefined"===a||!a.length||"undefined"===a[0]||"undefined"===a[0]._children||0===a[0]._children.length||"undefined"===a[0]._children[0]||"undefined"===a[0].data||"undefined"===a[0]._children[0].data||"_M"===a[0].data.qType)return;for(var c=0;c<a.length;c++)p(1===a.length?a[0]._children:a[c]._children)}var q,r=".treemap";return q=d.extend("Treemap",{init:function(c,d,e,f,g){this._data={},e=a.extend(!0,e||{},{debug:!0,providers:{colorMap:{clazz:k,multiDimScheme:"first"}},components:{dataArea:{clazz:b,show:!0,dock:"center",showFlag:j.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:j.prototype.ShowFlags.MEDIUM}}}),this._super(c,d,e,f,g)},off:function(){Touche(this.container).off("*",r),this._super()},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.options._disableSelections||(this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(function(a){var b=this.components.dataArea.getSelectionIndices(),c=this.selections.getActiveType();c.components.colorLegend&&(b=b.concat(this.components.colorLegend.getSelectionIndices())),this.selectionsCache.hasSelections()?this.onSelection.Select.apply(this,[a,!0,b,"L"]):a.length&&a.every(function(a){return!a.selected})&&this.selectionsApi.clear()}.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},initTooltips:function(){this.tooltips.setComponent("dataArea",this.components.dataArea)},_updateSelectionCache:function(a){this._super(a),a=a||this.components.dataArea.getSelectableShapes();var b=[],c=this.providers.colorMap.getDimensionIndex()[0],d=this.providers.colorMap.getColorDataInfo().attrIndex>=0;if(c>0&&d)for(;c>0;){for(var e=0;e<a.length;e++)b=b.concat(a[e].children);a=b,c--}this.components.colorLegend.setSelectableShapes(a)},_paint:function(){var a=this;return this._super().then(function(b){if(!b||!b.invalid){a.layout();var c,d=[];for(c in a.components)d.push(a.components[c].invalidateDisplay("Treemap.paint"));return l.all(d)}})},isValid:function(a){return this._super(a)&&!this.supressChartRendering},prePaint:function(a){this._super(a),f.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,a),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist||this.$scope.dataAttributes.onlyNegativeOrZero},_updateData:function(b){this._data=b,this._super(b),this.providers.colorMap.setData(b),this.components.dataArea.setData(b),this.components.colorLegend.setData(b),b.color&&"byMeasure"!==b.color.mode?this.selections&&this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend):this.selections&&this.selections.types.colorLegend.removeComponent("colorLegend",this.components.colorLegend);for(var c=a.extend(!0,{},this._chartContext.getDimensionTree()),d=new n;c._children&&c._children.length;)d._children.push(c._children.shift());p(d._children),this.providers.colorMap.setDimensionTree(d),this.components.dataArea.setDimensionTree(d),this.components.dataArea.cellPadding=2,this.components.dataArea.setPseudoDimPos(0)},toggleCacheItem:function(a){for(var b in this.components)this.components[b].toggleCacheItem?this.components[b].toggleCacheItem(a):this.components[b].invalidateDisplay("Treemap#toggleCacheItem")},getPreferredSize:function(){return this._super()}}),{type:"treemap",BackendApi:e,template:c,View:q,definition:g,softDefinition:h,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"K",qNoOfLeftDims:-1,qSortbyYValue:-1,qIndentMode:!0,qShowTotalsAbove:!0,qMaxStackedCells:3e3,qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:3e3,qLeft:0,qWidth:30}],qSuppressZero:!1,qSuppressMissing:!0}},data:i,support:{cssScaling:!1,snapshot:o,export:o,exportData:!0,sharing:o},options:{selections:{dataArea:{},colorLegend:{}},tooltips:{}},importProperties:m.colorChart.importProperties.bind(m),exportProperties:m.colorChart.exportProperties.bind(m)}}),define("objects.utils/font-manager",["core.utils/class"],function(a){function b(a,b,c){return a<b?0:a>c?1:(a-b)/(c-b)}var c;return c=a.extend("FontManager",{init:function(){this._minFontSize=10,this._maxFontSize=20,this._minRectSize=100,this._maxRectSize=900,this._fontWeight="normal",this._fontFamily="QlikView Sans",this._fontSize=10},setFontWeight:function(a){this._fontWeight=a},setFontFamily:function(a){this._fontFamily=a},setRectLimits:function(a,b){this._minRectSize=a,this._maxRectSize=b},getFont:function(a,c){var d=Math.min(a.height,a.width),e=c&&c.minFontSize?c.minFontSize:this._minFontSize,f=c&&c.maxFontSize?c.maxFontSize:this._maxFontSize,g=b(d,this._minRectSize,this._maxRectSize);return this._fontSize=e+Math.round(g*(f-e)),this._fontWeight+" "+this._fontSize+"px "+this._fontFamily},getFontSize:function(a,c){var d=Math.min(a.height,a.width),e=c&&c.minFontSize?c.minFontSize:this._minFontSize,f=c&&c.maxFontSize?c.maxFontSize:this._maxFontSize,g=b(d,this._minRectSize,this._maxRectSize);return e+Math.round(g*(f-e))}})}),define("extensions.qliktech/gauge/gauge-helper",["core.utils/class","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/shapes/arc","objects.views/charts/shapes/polygon","objects.views/charts/shapes/text","general.utils/color","objects.views/charts/components/axis/radial-axis-helper","objects.utils/font-manager"],function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return{x0:a.x0,y0:a.y0,x1:a.x1,y1:a.y1,limits:b,colors:c}}var k,l=[0,1],m=[0,.5,1];return k=a.extend("GaugeHelper",{init:function(){this._padding=0,this._colorWidth=50,this._maxWidth=50,this._labelPadding=10,this._fontManager=new i,this._fontManager.setRectLimits(100,1e3),this._bigValuesSettings={minFontSize:12,maxFontSize:60}},createBarSegments:function(a,c,d,e,f,h){if(!a||0===a.colors.length)return{shapes:[]};var i,k,n,o,p,q,r,s,t,u,v,w,x=[],y=a.colors,z=a.limits,A=this._colorWidth,B={},C=!1,D={value:0,gradient:!1},E=new g,F=h&&!d;for(f=Math.min(Math.max(f,0),1),z=z.map(function(a){return{value:(a.value-c.getPlotMin())/(c.getPlotMax()-c.getPlotMin()),gradient:a.gradient}}),i=0;i<y.length;i++)s=z[i]?z[i]:{value:1,gradient:!1},n=s.value,o=0===i?0:z[i-1].value,t=c.getPositionOfNormalizedValue(n),v=c.getPositionOfNormalizedValue(o),B.current=new g(y[i].color),B.next=new g(y[i+1]?y[i+1].color:y[i].color),u=(f-o)/(n-o),C=u>=0&&u<=1,d?(A=e.width<10?e.width:this._colorWidth,k=new b(this._relevantPos,t,A,v-t)):(A=this._colorWidth,k=new b(v,this._relevantPos,t-v,A)),w={x0:k.x,y0:k.y+(d?k.height:0),x1:k.x+(d?0:k.width),y1:k.y},D&&D.gradient&&!s.gradient?(B.last=g.getBlend(B.current,B.last,.5),p={gradient:j(w,l,F?[B.current.toRGBA(),B.last.toRGBA()]:[B.last.toRGBA(),B.current.toRGBA()])},q=B.last,r=B.current):s.gradient?(B.next=g.getBlend(B.current,B.next,.5),D.gradient?(B.last=g.getBlend(B.current,B.last,.5),p={gradient:j(w,m,F?[B.next.toRGBA(),B.current.toRGBA(),B.last.toRGBA()]:[B.last.toRGBA(),B.current.toRGBA(),B.next.toRGBA()])},u>.5?(u=(u-.5)/.5,q=B.last,r=B.current):(u/=.5,q=B.current,r=B.next)):(p={gradient:j(w,l,F?[B.next,B.current]:[B.current,B.next])},q=B.current,r=B.next)):p=B.current.toRGBA(),C&&(E=p.gradient?g.getBlend(q,r,u):B.current),k.opacity=1,k.fill=p,k.stroke=p,x.push(k),B.last=B.current,D=s;return{shapes:x,pointerBgColor:E}},createBarProgress:function(a,c,d,e,f){var h,i,j,k,l,m,n=[],o=new g(d),p=new g(this.style.area.color);return a=isNaN(a)?0:a>1?1:a<0?0:a,i=c.getPositionOfValue(c.getPlotMin()),j=c.getPositionOfValue(c.getPlotMax()),k=c.getPositionOfValue((c.getPlotMax()-c.getPlotMin())*a+c.getPlotMin()),this._labelPadding=this._colorWidth/2,l=this._colorWidth,m=this._relevantPos,h=e?new b(m,k,l,f.height):new b(i,m,k-i,l),h.opacity=1,h.fill=o.toHex(),h.stroke=o.createShiftedColor().toHex(),h.strokeWidth=1,n.push(h),h=e?new b(m,0,l,k):new b(k,m,j-k,l),h.opacity=1,h.fill=p.toHex(),h.stroke=p.createShiftedColor(.1).toHex(),h.strokeWidth=1,n.push(h),n},createGaugeMeterValue:function(a,b,c,d,e,g,h,i){var j=new f;return j.text=b,j.ColorWidth=200,j.font=h,j.opacity=1,j.fill=this.style.value.color,d?(a+g/2>e.height?(j.baseline="bottom",a=e.height):a<g/2?(j.baseline="top",a=0):j.baseline="middle",j.x=i?this._relevantPos-this._labelPadding:this._relevantPos+this._colorWidth+this._labelPadding,j.maxWidth=e.width-j.x,j.y=a,j.align=i?"right":"left"):(j.y=this._relevantPos+this._colorWidth+this._labelPadding+g,
j.x=Math.max(Math.min(e.width-c/2,a),c/2),j.align="center",j.baseline="bottom"),j},createGaugeMeterPointer:function(a,b,d,f,g){var h,i=a>1?1:a<0?-1:0,j=[],k=this._relevantPos,l=Math.max(Math.round(this._colorWidth/25),2),m=50,n=k<m?10:this._colorWidth,o=Math.max(n,10)/6,p=f.isDark()?this.style.pointer.color.light:this.style.pointer.color.dark,q=new e,r=new c,s=!d&&g?1:-1;return r.opacity=1,r.stroke=p,r.strokeWidth=l,q.opacity=1,q.fill=p,q.strokeWidth=l,a=a>1?1:a<0?0:a,h=b.getPositionOfValue((b.getPlotMax()-b.getPlotMin())*a+b.getPlotMin()),d?(0!==i&&(q.set([{x:k+n/2,y:h},{x:k-o+n/2,y:i*o*2+h},{x:k+o+n/2,y:i*o*2+h}]),j.push(q)),r.set(k,h,k+n,h)):(0!==i&&(q.set([{y:k+n/2,x:h},{y:k-o+n/2,x:s*i*o*2+h},{y:k+o+n/2,x:s*i*o*2+h}]),j.push(q)),r.set(h,k,h,k+n)),j.push(r),j},updateLabelStyle:function(a,b,c,d,e){this._bigValuesSettings={minFontSize:this.style.value.minFontSize,maxFontSize:this.style.value.maxFontSize},a.value.font=c.getFont(d,e,null,null,this._fontManager.getFontSize(b,this._bigValuesSettings))},createRadialSegments:function(a,b){if(!a||a.colors.length<1)return[];var c,e,f,h,i,k,n,o,p=[],q=a.limits,r=a.colors,s=this._colorWidth,t=r[0].color,u={value:0,gradient:!1},v=b.getAngleOfNormalizedValue(0),w=this._paddingToAxis;if(q=q.map(function(a){return{value:(a.value-b.getPlotMin())/(b.getPlotMax()-b.getPlotMin()),gradient:a.gradient}}),s=this._colorWidth*(b._relevantAngle>Math.PI?1:Math.sin(b._relevantAngle/4)),this._colorWidth=s,b._radius-s-w<0)return p;for(c=0;c<a.colors.length;c++)f=q[c]?q[c]:{value:1,gradient:!1},k=r[c+1]?r[c+1].color:r[c].color,e=r[c].color,i=b.getAngleOfNormalizedValue(f.value),h=new d(b._centerPoint.x,b._centerPoint.y,b._radius-s-w,b._radius-w,Math.min(v,i),Math.max(v,i),0),o={x0:h.x3,y0:h.y3,x1:h.x4,y1:h.y4},u&&u.gradient&&!f.gradient?(k=new g(e).blend(new g(t),.5),n={gradient:j(o,l,[k,e])}):f.gradient?(k=new g(e).blend(new g(k),.5),u.gradient?(t=new g(e).blend(new g(t),.5),n={gradient:j(o,m,[t,e,k])}):n={gradient:j(o,l,[e,k])}):n=e,h.opacity=1,h.fill=n,h.stroke=n,p.push(h),v=i,u=f,t=e;return p},createRadialGaugeMeter:function(a,b){var c,d,f,g=h.getAngleOfNormalizedValue(a,b),i=Math.max(this._colorWidth,10)/6,j=2,k=a>1?-1:1;return a>1||a<0?(d=this._colorWidth*(b._relevantAngle>Math.PI?1:Math.sin(b._relevantAngle/4)),this._colorWidth=d,c=-d*k/2,f=new e([{x:2*i+j,y:c},{x:j,y:i+c},{x:j,y:-i+c}])):f=new e([{x:.5*-i+4,y:0},{x:8*-i,y:i},{x:8*-i,y:-i}]),f.opacity=1,f.translate(b._centerPoint.x+Math.cos(g)*b._radius,b._centerPoint.y+Math.sin(g)*b._radius),f.rotate(g),(a>1||a<0)&&f.rotate(-k*Math.PI/2),f.fill=this.style.pointer.color.dark,f},createRadialProgress:function(a,b,c,f){var i,j,k,l,m=Math.min(c._radialOptions.start,c._radialOptions.end),n=isNaN(a)?m:h.getAngleOfNormalizedValue(a,c),o=Math.max(c._radialOptions.start,c._radialOptions.end),p=Math.min(f.width,f.height),q=[],r=(p>500?this._maxWidth:Math.max(p/500*this._maxWidth,10))/6,s=2,t=this._paddingToAxis,u=new g(this.style.area.color);return b=new g(b),j=this._colorWidth*(c._relevantAngle>Math.PI?1:Math.sin(c._relevantAngle/4)),this._colorWidth=j,c._radius-j-t<0?q:((a>1||a<0)&&(l=a>1?-1:1,k=-j*l/2,i=new e([{x:2*r+s,y:k},{x:s,y:r+k},{x:s,y:-r+k}]),i.opacity=1,i.translate(c._centerPoint.x+Math.cos(n)*c._radius,c._centerPoint.y+Math.sin(n)*c._radius),i.rotate(n-l*Math.PI/2),i.fill=b.toHex(),q.push(i)),m<n&&(i=new d(0,0,c._radius-j-t,c._radius-t,m,n,0),i.opacity=1,i.translate(c._centerPoint.x,c._centerPoint.y),i.fill=b.toHex(),i.stroke=b.createShiftedColor().toHex(),q.push(i)),o>n&&(i=new d(0,0,c._radius-j-t,c._radius-t,n,o,0),i.opacity=1,i.translate(c._centerPoint.x,c._centerPoint.y),i.fill=u.toHex(),i.stroke=u.createShiftedColor(.1).toHex(),q.push(i)),q)},createRadialGaugeValue:function(a,b,c,d,e,g){var h=new f;return h.text=b,h.x=d.width/2,h.y=.5*d.height-g/2+.05*Math.min(d.width,d.height),h.align="center",h.font=e,h.baseline="middle",h.maxWidth=1.4*c._radius,h.opacity=1,h.fill=this.style.value.color,[h]},createRadialSpark:function(a,b,c,d){var f,g,i=.4*Math.min(d.width,d.height),j=h.getAngleOfNormalizedValue(a,c)+Math.PI/2,k=0,l=new e;if(l.opacity=1,"string"!=typeof b)if(1===b.colors.length)l.fill=b.colors[0].color;else for(f=0;f<b.colors.length;f++){if(g=b.limits[f]?(b.limits[f].value-c.getPlotMin())/(c.getPlotMax()-c.getPlotMin()):1,a>=k&&a<g){l.fill=b.colors[f].color;break}k=g}else l.fill=b;return d.width<d.height?l.set([{x:0,y:-i},{x:-i/2,y:+i/2},{x:i/2,y:+i/2},{x:0,y:-i}]):l.set([{x:-i/2,y:i/2},{x:0,y:-i},{x:+i/2,y:i/2},{x:-i/2,y:i/2}]),l.translate(c._centerPoint.x,c._centerPoint.y),l.rotate(j),[l]},getGaugeWidth:function(a,b){var c;return a&&(c=b?"width":"height",this._colorWidth=a[c]>500?this._maxWidth:Math.max(a[c]/500*this._maxWidth,10)),this._colorWidth},updateSize:function(a,b,c){var d,e=Math.min(a.width,a.height);d=c?e:b?a.width:a.height,this._colorWidth=d>500?this._maxWidth:Math.max(d/500*this._maxWidth,10),this._relevantPos=(d-this._colorWidth)/2,this._paddingToAxis=Math.min(6,e/200)},getPaddingToAxis:function(){return this._paddingToAxis},getRelevantPos:function(){return this._relevantPos},getPadding:function(){return this._padding}})}),define("extensions.qliktech/gauge/gaugearea",["jquery","objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/gauge/gauge-helper","client.utils/theme/theme","general.utils/color","core.utils/deferred"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,b){if(!this._axis||!this._segmentInfo||void 0===this._axis.getPlotMin()||void 0===this._axis.getPlotMax())return h.resolve();var d,e=this._axis,f=this._style.value.font,i=e.isVertical(),j=c.getFontHeight(f),k=this.renderers.gauge.getTextWidth(a,f),l=this._axis.getPositionOfValue(b),m=(b-e.getPlotMin())/(e.getPlotMax()-e.getPlotMin()),n=[];return this._data.useSegments?(d=this._gaugeHelper.createBarSegments(this._segmentInfo,e,i,this.rect,m,this.yMirrorMode),n=d.shapes,n=n.concat(this._gaugeHelper.createGaugeMeterPointer(m,e,i,d.pointerBgColor,this.yMirrorMode))):(n=this._gaugeHelper.createBarProgress(m,e,this._progressColor,i,this.rect),(m>1||m<0)&&(n=n.concat(this._gaugeHelper.createGaugeMeterPointer(m,e,i,new g(m>1?this._progressColor:this._style.area.color),this.yMirrorMode)))),!isNaN(m)&&(i&&this.rect.width>100||!i&&this.rect.height>100)&&n.push(this._gaugeHelper.createGaugeMeterValue(l,a,k,i,this.rect,j,f,this.yMirrorMode)),this.renderers.gauge.stage.removeChildren(),this.renderers.gauge.stage.addChildren(n),this.renderers.gauge.render()}function j(a,b){if(!this._axis||!this._segmentInfo&&this._data.useSegments||this._axis._radius<=0)return h.resolve();var d=this._axis,e=this._style.value.font,f=c.getFontHeight(e),g=Math.min(this.rect.height,this.rect.width),i=(b-d.getPlotMin())/(d.getPlotMax()-d.getPlotMin()),j=[];return g<50?j=this._gaugeHelper.createRadialSpark(i,this._data.useSegments?this._segmentInfo:this._progressColor,d,this.rect):(this._data.useSegments?(j=this._gaugeHelper.createRadialSegments(this._segmentInfo,d),isNaN(i)||j.push(this._gaugeHelper.createRadialGaugeMeter(i,d))):j=this._gaugeHelper.createRadialProgress(i,this._progressColor,d,this.rect),j=j.concat(this._gaugeHelper.createRadialGaugeValue(b,a,d,this.rect,e,f))),this.renderers.gauge.stage.removeChildren(),this.renderers.gauge.stage.addChildren(j),this.renderers.gauge.render()}function k(a){return f.palette[a]?f.palette[a]:"number"==typeof a?"#000":a}function l(a){var b={value:{color:a.getValue(n,"value","color"),font:a.getFont(n,"value"),minFontSize:a.getValue(n,"value","minFontSize"),maxFontSize:a.getValue(n,"value","maxFontSize")},area:{color:a.getValue(n,"area","backgroundColor")},pointer:{color:{light:a.getValue(n,"pointer","color","light"),dark:a.getValue(n,"pointer","color","dark")}}};return b}var m,n="gauge";return m=b.extend({init:function(){this._super.apply(this,arguments),this._gaugeHelper=new e,this._type="bar",this._currentProperties={},this._transitionProperties={},this._inTransition=!1,this._cacheItems=[],this.renderers={gauge:new c(this.container)},this._styleService=d.getInstance(),this._style=l(this._styleService),this._gaugeHelper.style=this._style},_updateSize:function(){this.invalidateDisplay("Gauge._updateSize")},_updateProperties:function(){if(this._data){var b=this._data;this._segmentInfo=a.extend(!0,{},b.segmentInfo),this._segmentInfo&&this._segmentInfo.limits&&(this._segmentInfo.limits=this._segmentInfo.limits.concat().sort(function(a,b){return a.value-b.value})),this._segmentInfo&&this._segmentInfo.colors&&(this._segmentInfo.colors=this._segmentInfo.colors.concat().map(function(a){return{color:k(a.color)}})),this._progressColor=k(this._data.progressColor),this._orientation=b.orientation,this._type=b.gaugetype,this._transitionProperties={value:b.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,text:b.qHyperCube.qDataPages[0].qMatrix[0][0].qText},this._super()}},hasValidData:function(){return this._super()&&this._data},setAxis:function(a){this._axis=a,this._axis.listen("changed",function(){this.invalidateDisplay()},this)},setRefLines:function(a){this._refLines=a},setRefLineLabels:function(a){this._refLineLabels=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},paint:function(){if(!this._axis)return h.resolve();var a=[];this._gaugeHelper.updateSize(this.rect,this._axis.isVertical(),this._axis.isRadial()),this._refLines&&(this._refLines.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLines.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._refLineLabels&&(this._refLineLabels.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLineLabels.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._gaugeHelper.updateLabelStyle(this._style,this.rect,this._styleService,n,"value");var b=this._data.qHyperCube.qDataPages[0].qMatrix[0][0],c=this.measureFormatters[0],d="U"!==c.type?b.qText:c.formatValue(b.qNum),e=this._currentProperties.value;return this._inTransition&&(d=c.format(e)),this._axis.isRadial()?a.push(j.apply(this,[d,e])):a.push(i.apply(this,[d,e])),this._currentValue=e,this._refLines&&this._refLineLabels&&(this._refLines.setGaugeWidth(this._gaugeHelper.getGaugeWidth()),this._refLineLabels.setGaugeWidth(this._gaugeHelper.getGaugeWidth())),h.all(a)},afterPaint:function(){},clear:function(){},getGaugeWidth:function(a,b){return this._gaugeHelper.getGaugeWidth(a,b)}}),Object.defineProperty(m.prototype,"className",{value:"GaugeArea"}),m}),define("extensions.qliktech/gauge/gauge-ref-lines",["objects.views/charts/components/ref-lines","client.utils/theme/theme"],function(a,b){"use strict";function c(a){return b.palette[a]?b.palette[a]:a}var d;return d=a.extend("GaugeRefLines",{namespace:".gaugereflines",init:function(){this._super.apply(this,arguments),this._width=50},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),this._hasVisibleRefLines){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[],r=this._paddingToAxis,s=this._relevantPos;for(a=0;a<this._numRefLinesDataAxes;a+=1)for(d=this._data[a],e=this._axes[a],f=this._axisPlotMinValues[a],g=this._axisPlotMaxValues[a],b=0;b<d.length;b+=1)d[b].show&&void 0!==d[b].refLineExpr&&(h=this._currentProperties["value"+a+b],h>g||h<f||(e.isRadial()?(o=e._radius,p=e.getAngleOfValue(h),j=e._centerPoint.x+Math.cos(p)*(o-r),k=e._centerPoint.y+Math.sin(p)*(o-r),l=e._centerPoint.x+Math.cos(p)*(o-r-this._width),m=e._centerPoint.y+Math.sin(p)*(o-r-this._width)):(i=e.getPositionOfValue(h),i=Math.floor(i)-.5,e.isVertical()?(j=s,k=i,l=s+this._width,m=i):(j=i,k=s,l=i,m=s+this._width)),n=void 0!==d[b].color?c(d[b].color):"#000000",q.push({type:"line",stroke:n,strokeWidth:1,shape:{x1:j,y1:k,x2:l,y2:m}})));this.renderer.shapes=q,this.renderer.render()}},setGaugeWidth:function(a){this._width=a,this.updateSize(),this.invalidateDisplay()},setPaddingToAxis:function(a){this._paddingToAxis=a},setRelevantPos:function(a){this._relevantPos=a}})}),define("extensions.qliktech/gauge/gauge-ref-line-labels",["objects.views/charts/components/ref-line-labels","objects.views/charts/shapes/text","client.utils/theme/theme"],function(a,b,c){"use strict";function d(a){return String(void 0!==a.label?a.label:a)}function e(a){return c.palette[a]?c.palette[a]:a}var f;return f=a.extend("GaugeRefLineLabels",{init:function(){this._super.apply(this,arguments)},paint:function(){if(!this._axis)return void this._clearLabels();if(this._axis.updateNow(["properties"]),this._plotMinValue===this._axis.getPlotMin()&&this._plotMaxValue===this._axis.getPlotMax()||(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues.call(this)),!this._hasVisibleRefLines)return void this._clearLabels();var a,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w="bottom",x=this._relevantPos,y=[],z=[],A=this._axis;for(a=0;a<this._data.length;a+=1)this._data[a].show&&void 0!==this._data[a].refLineExpr&&(c=this._currentProperties["value"+a],f=d(this._data[a].refLineExpr),void 0===c||isNaN(c)||c<this._axis.getPlotMin()||c>this._axis.getPlotMax()||(r=new b,r.font=this._style.label.font,r.maxWidth=this._labelMaxWidthForYAxis,r.maxNumLines=3,n=f,m=n.replace(/[0-9]|\.|\-|\+|e/g,""),m=m.length?n:A.format(c),j=this._data[a].label+" ("+m+")",k=void 0!==this._data[a].color?e(this._data[a].color):"#000000",r.setText(j),r.ellipsis=" ("+m+")",t=r.measure(),A.isRadial()?(p=A._radius,q=A.getAngleOfValue(c),h=A._centerPoint.x+Math.cos(q)*p,i=A._centerPoint.y+Math.sin(q)*p,o=q>Math.PI/2&&q<3*Math.PI/2?"right":"left",w=q>Math.PI&&q<2*Math.PI?"bottom":"top",s=t.width,h-s<0?(r.maxWidth+=h-s,h=r.maxWidth):h+s>this.rect.width&&(r.maxWidth=s+(this.rect.width-(h+s)))):(g=A.getPositionOfValue(c),g=Math.floor(g)-.5,v=t.height/2,A.isVertical()?(o=this.yMirrorMode?"right":"left",w="middle",h=this.yMirrorMode?x-4:x+this._width+4,i=g<v?g+(v-g+4):g>this.rect.height-v?g-(g-(this.rect.height-v-4)):g):(o="center",i=x+this._width,w="top",u=t.width/2,h=g<u?g+(u-g+4):g>this.rect.width-u?g-(g-(this.rect.width-u-4)):g)),r.x=h,r.y=i,r.align=o,r.baseline=w,r.fill=k,z.push(r),y.push({position:g,shapeWrapper:r,tooltipRows:[{label:this._data[a].label,value:m}]})));return l=y?y.length:0,0===l?void this._clearLabels():(this.renderer.stage.removeChildren(),this.renderer.stage.addChildren(z),this.renderer.render(),void this._tooltips.setLabelObjects(y))},setGaugeWidth:function(a){this._width=a,this.invalidateDisplay()},setPaddingToAxis:function(a){this._paddingToAxis=a},setRelevantPos:function(a){this._relevantPos=a}})}),define("text!extensions.qliktech/gauge/gauge.ng.html",[],function(){return'<div class="qv-viz"></div>\n<div qva-popup-disclaimer ng-if="!!dataAttributes.popupDisclaimer.show" pop-close="dataAttributes.popupDisclaimer.onPopClose" pop-message="dataAttributes.popupDisclaimer.message" pop-title="dataAttributes.popupDisclaimer.title" />\n'}),define("extensions.qliktech/gauge/gauge-properties",["translator","client.utils/property-resolver"],function(a,b){var c,d,e;c={uses:"data",items:{measures:{disabledRef:""},dimensions:{disabledRef:""}}},d={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{rangeLimits:{type:"items",items:{text:{component:"text",translation:"properties.axis.rangeLimits",style:"sHeader"},min:{ref:"measureAxis.min",translation:"properties.axis.min",type:"number",expression:"optional",invalid:function(a){return a.measureAxis&&a.measureAxis.min>=a.measureAxis.max},change:function(a){b.setValue(a,"disclaimerClosed",!0)}},max:{ref:"measureAxis.max",translation:"Common.Max",type:"number",expression:"optional",defaultValue:100,invalid:function(a){return a.measureAxis&&a.measureAxis.min>=a.measureAxis.max},change:function(a){b.setValue(a,"disclaimerClosed",!0)}}}},type:{ref:"gaugetype",type:"string",component:"item-selection-list",defaultValue:"radial",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.radial",value:"radial"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.bar",value:"bar"}],change:function(a){"radial"===a.gaugetype?(e=a.orientation,a.orientation="horizontal"):a.orientation=e}},autoOrientation:{ref:"autoOrientation",translation:"properties.orientation",type:"boolean",defaultValue:!0,component:"switch",undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(a){return"bar"===a.gaugetype}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"horizontal",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}],show:function(a){return"bar"===a.gaugetype&&!a.autoOrientation}},angle:{ref:"angle",translation:"properties.gauge.angle",type:"number",component:"slider",min:.2,max:.98,step:.1,defaultValue:.7,show:function(){return!1}},segments:{type:"items",items:{useSegments:{ref:"useSegments",type:"boolean",defaultValue:!1,translation:"properties.gauge.useSegments",change:function(a){a.useSegments&&1===a.segmentInfo.colors.length?a.segmentInfo.colors=[{color:a.progressColor}]:a.progressColor=a.segmentInfo.colors[0].color}},progressColor:{component:"color-picker",translation:"properties.color",ref:"progressColor",type:"integer",defaultValue:3,show:function(a){return!a.useSegments}},valueMode:{ref:"valueMode",translation:"properties.value",type:"string",component:"dropdown",options:[{value:"absolute",translation:"properties.gauge.absolute"},{value:"relative",translation:"properties.gauge.relative"}],show:function(){return!1},defaultValue:"absolute"},maxSegments:{ref:"maxSegments",type:"number",defaultValue:6,show:!1},segmentInfo:{ref:"segments",type:"items",component:"color-scale-creator",show:function(a){return a.useSegments},items:{limits:{ref:"segmentInfo.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(a,b){return"number"==typeof a.value&&(a.value<b.measureAxis.min||a.value>b.measureAxis.max)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},colors:{items:{color:{ref:"color",component:"color-picker",translation:"properties.color",type:"integer",defaultValue:3}},type:"array",ref:"segmentInfo.colors"}}}}},disclaimerClosed:{ref:"disclaimerClosed",type:"boolean",defaultValue:!1,show:!1}}},measureAxis:{type:"items",label:function(b,c){var d,e=c.getMeasureLayouts()[0];return d=e?a.get("properties.measureAxisWithInfo",[e.qFallbackTitle]):a.get("properties.measureAxis")},grouped:!0,items:{axis:{type:"items",snapshot:{title:"properties.measureAxis",tid:"property-yAxis"},items:{show:{ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",type:"string",component:"dropdown",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show&&"title"!==a.measureAxis.show},options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}]}}}}}}};var f={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}},refLines:{uses:"reflines"}}};return{type:"items",component:"accordion",items:{data:c,addons:f,settings:d}}}),define("text!extensions.qliktech/gauge/popup-disclaimer.ng.html",[],function(){return'<div class="qv-popup-disclaimer">\n\t<div class="icon-close-button" qva-activate="onClose()"></div>\n\t<header class="dm-header">{{popTitle}}</header>\n\t<main class="dm-main">\n\t\t<p class="dm-p">{{popMessage}}</p>\n\t</main>\n</div>'}),define("extensions.qliktech/gauge/popup-disclaimer",["assets/qvangular/qvangular-core","text!extensions.qliktech/gauge/popup-disclaimer.ng.html"],function(a,b){a.directive("qvaPopupDisclaimer",function(){return{template:b,replace:!0,scope:{popMessage:"=",popTitle:"=",popClose:"="},link:function(a){a.onClose=function(){a.popClose()}}}})}),define("extensions.qliktech/gauge/gauge",["jquery","translator","objects.views/charts/chart","core.utils/deferred","extensions.qliktech/gauge/gaugearea","extensions.qliktech/gauge/gauge-ref-lines","extensions.qliktech/gauge/gauge-ref-line-labels","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","objects.backend-api/hypercube-api","text!./gauge.ng.html","extensions.qliktech/gauge/gauge-properties","objects.extension/object-conversion","extensions.qliktech/gauge/popup-disclaimer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(){var a,b,c;a=-Math.PI*(this._data.angle+.5),b=Math.PI*(this._data.angle-.5),b+=a<0?2*Math.PI:0,a+=a<0?2*Math.PI:0,c=this.yMirrorMode&&"radial"!==this._type,this.components.axis.setRadial("radial"===this._type,c?{start:b,end:a}:{start:a,end:b})}function o(){var b=this.components.dataArea,c=b.rect,d=80,e=a.extend({},c),f=this.components.axis,g=f.relevantSize,h=b.getGaugeWidth(b.rect,"vertical"===this._orientation)/2;f.setAlignment("near"),"vertical"===this._orientation?(this.yMirrorMode?(e.x=c.width/2+h,f.setAlignment("far")):e.x=c.width/2-h-g,e.x<0?(e.width=g+e.x,e.x=0):e.width=g):(e.y=c.height/2-h-g,e.y<0?(e.height=g+e.y,e.y=0):e.height=g),(c.width<d||c.height<d)&&(e["vertical"===this._orientation?"width":"height"]=0),f.rect=e}var p;return p=c.extend("Gauge",{namespace:".gauge",init:function(c,d,j,k){var l=this;j=a.extend(!0,j||{},{providers:{},components:{axis:{show:!0,order:0,dock:"center",showFlag:h.prototype.ShowFlags.SPARK,clazz:i},dataArea:{show:!0,order:1,dock:"center",clazz:e,showFlag:h.prototype.ShowFlags.SPARK},gaugeRefLines:{sortKey:5,show:!0,dock:"center",showFlag:h.prototype.ShowFlags.XSMALL},gaugeRefLineLabels:{show:!0,dock:"center",order:3,showFlag:h.prototype.ShowFlags.XSMALL}}}),this._type="vertical",this._orientation="horizontal",this._super(c,d,j,k),this.components.dataArea.setAxis(this.components.axis),this.components.axis.setAlignment("near"),this.components.axis.setDataRangeTransition(!0),this.components.axis.setShowLine(!1),this.components.gaugeRefLines=new f(this.container),this.components.gaugeRefLines.showFlag=h.prototype.ShowFlags.XSMALL,this.components.gaugeRefLines.setUseTransition(!0),this.components.dataArea.setRefLines(this.components.gaugeRefLines),this.layoutEngine.addComponent(this.components.gaugeRefLines),this.components.gaugeRefLineLabels=new g(this.container),this.components.gaugeRefLineLabels.showFlag=h.prototype.ShowFlags.SMALL,this.components.gaugeRefLineLabels.setUseTransition(!0),this.components.dataArea.setRefLineLabels(this.components.gaugeRefLineLabels),this.layoutEngine.addComponent(this.components.gaugeRefLineLabels),this.$scope.dataAttributes.popupDisclaimer={show:!1,message:b.get("Object.Gauge.RangeIsDefault"),title:b.get("Object.Gauge.RangeIsDefaultTitle"),onPopClose:function(){l.$scope.backendApi.model.getProperties().then(function(a){a.disclaimerClosed=!0,l.$scope.backendApi.model.save()})}}},_updateData:function(a){if(this._type=a.gaugetype,this._orientation=a.autoOrientation&&"bar"===a.gaugetype?this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal":a.orientation,a.refLine){var b={axes:{axis:{component:this.components.axis,data:a.axis,dataIndices:a.qHyperCube.qMeasureInfo.map(function(a,b){return b})}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.gaugeRefLineLabels,axis:this.components.axis}},refLines:{component:this.components.gaugeRefLines}};this._super(a,b),this.components.dataArea.setData(a),this.updateAxis(a,this.options),this.updateRefLines(a,b)}else this.components.dataArea.setData(a),this.updateAxis(a,this.options),this._super(a)},updateRefLines:function(a,b){var c,d=b.refLineLabels,e=[],f=[];for(c in d)d[c].component&&(d[c].component.setData(d[c].data),d[c].component.setAxis(d[c].axis),d[c].component.setDock(d[c].axis.getOppositeDock()),f.push(d[c].axis),e.push(d[c].data));b.refLines&&b.refLines.component&&(b.refLines.component.setAxes([b.axes.axis.component]),b.refLines.component.setData([a.refLine.refLines]))},isValid:function(a){var b,c=this.isDataValid(a);for(b in this.components)this.components[b].setHasValidData(c);return c},isDataValid:function(a){var b=!!a&&!!a.qHyperCube&&a.qHyperCube.qMeasureInfo.length&&!a.qHyperCube.qMeasureInfo.some(function(a){return!!a.qError});return b},updateAxis:function(a){var b,c,d,e,f=a.measureAxis,g=this.components.axis;b=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),c=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),d=a.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}).join(", "),g.setData(a),g.setTitle(d),g.setShowStrategy(f.show),g.setLabelMode(f.label),g.setOrientation("bar"===this._type?this._orientation:"horizontal"),g.setPlotMin&&(e=this.getAxisOptions(f),g.setPlotMin(e.min),g.setPlotMax(e.max),g.setTickMultiplier(f.spacing),g.setLogScale(f.logarithmic)),b===c&&0===c&&(c=1,b=0),c=Math.max(0,c),b=Math.min(0,b),this.setAxisDataRange(g,c,b,e.max,e.min,1),n.call(this)},getAxisOptions:function(a){if(a)return{min:Number(a.min),max:Number(a.max)}},setAxisDataRange:function(a,b,c,d,e,f){null!==d&&null!==e||null===d&&null===e?a.setDataRange(c,b):null!==d&&d<=c?a.setDataRange(d-f,b):null!==e&&e>=b?a.setDataRange(c,e+f):a.setDataRange(c,b)},_paint:function(){var a,b=[];if(!this.isValid(this._data))return this.clear();if(this._super(),n.call(this),this.layout(),this.$scope.dataAttributes.popupDisclaimer){var c=this._data.disclaimerClosed||this._data.maxMinChanged;!this.inEditState()||this._layoutMode<7||c?this.$scope.dataAttributes.popupDisclaimer.show=!1:this.$scope.dataAttributes.popupDisclaimer.show=!0}for(a in this.components)b.push(this.components[a].invalidateDisplay());return d.all(b)},layout:function(){var a=this.components.axis,b=a.updateSize;a.updateSize=function(){},this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect),a.updateSize=b,this._data&&this._data.autoOrientation&&"bar"===this._data.gaugetype&&(this._orientation=this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal",this.components.axis.setOrientation(this._orientation)),a.preRelevantSizeCalculation(),a.calculatePreliminaryRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),a.calculateRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),this.components.axis.isRadial()||o.call(this),a.updateSize()},getPreferredSize:function(){return this._super()}}),{type:"gauge",BackendApi:j,template:k,View:p,definition:l,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:1,qHeight:1}],qSuppressMissing:!0},segmentInfo:{limits:[],colors:[{color:3}]}},data:{measures:{min:1,max:1}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0},getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()},importProperties:m.axisChart.importProperties.bind(m),exportProperties:m.axisChart.exportProperties.bind(m)}}),define("text!extensions.qliktech/kpi/kpi.ng.html",[],function(){return'<div class="qv-viz" ng-class="{link : linkInteractionOn}">\n\t<div class="kpi-data" qva-activate="onShowVerifyDialog()">\n\t\t<div ng-show="baseLayoutInfo.components[0].show" class="measure-wrapper" ng-class="textAlign" ng-style="measureTitleStyle">\n\t\t\t<div class="measure-title ellips-text" title="{{measureTitle}}">\n\t\t\t\t<span ng-bind="measureTitle"></span>\n\t\t\t\t<i class="info-icon  lui-icon  lui-icon--link" ng-if="linkInteractionOn" title="{{sheetLinkTitle}}"></i>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="value-wrapper" ng-class="textAlign">\n\t\t\t<div class="ellips-text" ng-class="{ \'no-shrink\' : secondaryValues.length && baseLayoutInfo.components[1].components[1].components[0].show}">\n\t\t\t\t<qv-kpi-value value="mainValue.value" formatted-value="mainValue.formattedValue" value-style="mainValue.style" formatter="mainValue.formatter" glyph="mainValue.glyph" show-glyph="mainValue.showGlyph" />\n\t\t\t</div>\n\t\t\t<div ng-show="baseLayoutInfo.components[1].components[1].components[0].show" class="secondary-wrapper ellips-text" ng-repeat="secondaryValue in secondaryValues">\n\t\t\t\t<qv-kpi-value value="secondaryValue.value" formatted-value="secondaryValue.formattedValue" value-style="secondaryValue.style" title-style="secondaryValue.titleStyle" formatter="secondaryValue.formatter" glyph="secondaryValue.glyph" show-glyph="secondaryValue.showGlyph" measure-title="secondaryValue.measureTitle" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<!--\n\t<div ng-show="useViz" class="visualization">\n\t\t<qv-object class="cell-content" model="viz.model" options="viz.options"></qv-object>\n\t</div>\n\t-->\n\n\t<div class="click-again-overlay" ng-class="{show : showVerifyDialog}" ng-style="verifyDialogStyle" qva-activate="linkToSheet()">\n\t\t<span ng-if="!sheetIsMissing" q-translation="properties.kpi.verifyToGoSheet"></span>\n\t\t<span class="sheetLinkTitle ellips-text" ng-bind="sheetLinkTitle"></span>\n\t</div>\n\n</div>\n'}),define("extensions.qliktech/kpi/kpi-properties",[],function(){var a,b;a={uses:"data",addTranslation:"Properties.AddData",items:{dimensions:{disabledRef:""},measures:{disabledRef:"",items:{conditionalColoringContainer:{type:"items",grouped:!1,items:{conditionalColoring:{type:"items",ref:"qDef.conditionalColoring",show:function(){return!0},items:{useConditionalColoring:{ref:"qDef.conditionalColoring.useConditionalColoring",component:"switch",type:"boolean",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],translation:"properties.kpi.conditionalColoring",defaultValue:!1,change:function(a){a.qDef.conditionalColoring&&a.qDef.conditionalColoring.useConditionalColoring&&1===a.qDef.conditionalColoring.segments.colors.length?a.qDef.conditionalColoring.segments.colors[0].color=a.qDef.conditionalColoring.singleColor:a.qDef.conditionalColoring.singleColor=a.qDef.conditionalColoring.segments.colors[0].color}},singleColorColoring:{component:"color-picker",translation:"properties.color",ref:"qDef.conditionalColoring.singleColor",type:"integer",defaultValue:3,show:function(a){return a.qDef.conditionalColoring&&!a.qDef.conditionalColoring.useConditionalColoring}},rangeLimits:{type:"items",items:{min:{ref:"qDef.measureAxis.min",translation:"properties.axis.min",type:"number"},max:{ref:"qDef.measureAxis.max",translation:"Common.Max",type:"number",defaultValue:100}},show:function(){return!1}},segmentInfo:{ref:"qDef.conditionalColoring.segments",type:"items",component:"color-scale-creator",conditionalColoringRef:{props:"qHyperCubeDef.qMeasures",layout:"qHyperCube.qMeasureInfo"},useGlyph:!0,useAutoMinMax:!0,show:function(a){return a.qDef.conditionalColoring.useConditionalColoring},items:{limits:{ref:"qDef.conditionalColoring.segments.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(a){return isNaN(a.value)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},colors:{type:"array",ref:"qDef.conditionalColoring.segments.colors",defaultValue:[{color:2}],items:{color:{ref:"color",component:"color-picker",translation:"properties.color",type:"integer",defaultValue:2},icon:{ref:"icon",
type:"string",defaultValue:"",show:!1}}}}}}}}}}}}},b={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{showMeasureTitle:{ref:"showMeasureTitle",component:"checkbox",translation:"properties.ShowTitle",defaultValue:!0},textAlign:{ref:"textAlign",type:"string",component:"dropdown",translation:"properties.Alignment",options:[{value:"left",translation:"properties.dock.left"},{value:"center",translation:"Common.Center"},{value:"right",translation:"properties.dock.right"}],defaultValue:"center"},fontSize:{ref:"fontSize",type:"string",component:"dropdown",translation:"MediaTool.Toolbar.FontSize",options:[{value:"S",translation:"Common.Small"},{value:"M",translation:"Common.Medium"},{value:"L",translation:"Common.Large"}],defaultValue:"M"},linkToSheet:{type:"items",items:{useLink:{ref:"useLink",type:"boolean",component:"switch",translation:"properties.kpi.linkToSheet",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},kpiLink:{ref:"sheetLink",type:"string",component:"sheet-dropdown",show:function(a){return a.useLink}}}}}}}};var c={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:a,addons:c,settings:b}}}),define("client.property-panel/components/color-scale-creator/color-scale-creator-utils",["client.utils/theme/theme","general.utils/color","jquery"],function(a,b,c){function d(a,b,d){var e;return e=c.extend(!0,{},a),e&&e.limits&&(e.limits=e.limits.concat().sort(function(a,b){return a.value-b.value}),e.limits.forEach(function(a){a.value=(a.value-b)/(d-b)})),e&&e.colors&&(e.colors=e.colors.concat().map(function(a){return{color:j.resolveColor(a.color)}})),e}function e(a,b){if(0!==a.limits.length){var c;return c=0===b?a.limits[b].gradient:b===a.colors.length-1?a.limits[b-1].gradient:a.limits[b].gradient||a.limits[b-1].gradient}}function f(a,b,c){if(isNaN(b))return 0;var d,e,f=c?Math.min(c,b):0,g=a.segments.limits.concat().sort(function(a,b){return a.value-b.value}),h=a.segments.colors;for(e=0;e<h.length;e++){if(e===h.length-1)return e;if(d=g[e].value,b<d&&b>=f)return e;f=d}return 0}function g(a,b,c){var d,e,f=a.limits.concat().sort(function(a,b){return a.value-b.value}),g=b>0?f[b-1]:{value:0,gradient:!1},h=a.colors[b-(b>0?1:0)],i=f[b]?f[b]:{value:1,gradient:!1},j=a.colors[b+(b<a.colors.length-1?1:0)],k=c===i.value?1:(c-g.value)/(i.value-g.value);return g&&g.gradient&&i&&i.gradient?c-g.value<i.value-c?(d=h.color,e=.5-k):(d=j.color,e=k-.5):g&&g.gradient?(d=h.color,e=1-(.5+k/2)):i&&i.gradient?(d=j.color,e=k/2):(d=a.colors[b].color,e=c),{color:d,t:e}}function h(b){return a.palette[b]?a.palette[b]:"number"==typeof b?"#000":b}function i(a,c,e,f){var g,h,i,j,k=0,l=d.call(this,a,e,f);if(c<=0)return l.colors[0].color;if(c>=1)return l.colors[l.colors.length-1].color;for(i=0;i<l.colors.length;i++){if(h=l.limits[i]?l.limits[i].value:1,c>=k&&c<h){g=this.getBlendInfo(l,i,c,e,f),j=new b(l.colors[i].color).blend(new b(g.color),g.t);break}k=h}return j}var j={blendValue:i,shouldBlend:e,getBlendInfo:g,resolveColor:h,getSegmentIndex:f};return j}),define("extensions.qliktech/kpi/kpi-layout",["objects.views/charts/utils/canvas-renderer"],function(a){function b(a,b,c){var d,e=a.ratio?a.ratio:1,f=b/c;return d=a.direction===m.ROW?e>f?m.COLUMN:m.ROW:e>f?m.ROW:m.COLUMN}function c(a){if(!a.components||0===a.components.length)return a;var d,e,f,g,h,i=0,j=a.boundingBox.height,k=a.boundingBox.width,l=a.direction,n=b(a,j,k);for(a.components.forEach(function(a){a.direction=a.direction?a.direction:n,d=a.size.min?a.size.min:a.size?a.size:0,"function"==typeof a.isVisible&&!a.isVisible()||d*j<(a.size.treshold&&a.size.treshold.height?a.size.treshold.height:10)||k<(a.size.treshold&&a.size.treshold.width?a.size.treshold.width:10)?a.show=!1:(i+=d,a.show=!0)}),f=a.components.length-1;f>=0;f--)g=a.components[f],i<1?g.size.stretch&&(g.size.value=g.size.min+(1-i)):g.size.value=null;return a.components.forEach(function(a){e=a.size.value?a.size.value:a.size.min?a.size.min:a.size,h={},l===m.ROW?(h.height=j,h.width=k*e):(h.width=k,h.height=j*e),a.boundingBox=h}),a.components.forEach(function(a){c(a)}),a}function d(a,b,c,g,h,i){var j,m,n;m=a.boundingBox.width,n=a.boundingBox.height,a.components&&a.components.forEach(function(b){d(b,a,m,n,h,i)}),"function"==typeof a.getText&&(h===l.MAX?j=f(a.getText(),m,n):h===l.SCALE&&(j=e(a,m,n)),i===k.ADJUSTTOTEXT&&(a.boundingBox={height:j.height,width:j.width}),a.fontSizes||(a.fontSizes={}),a.fontSizes.fontSize=10*j.fontSize+"%")}function e(a,b,c){if(!a.fontSizes)return{fontSize:"10px"};var d=a.getText(),e=a.fontSizes.min,g=a.fontSizes.max,h=a.fontSizes.maxNrChars,i=f(d,b,c,h),j=Math.min((c-e.height)/(g.height-e.height),1),k=e.fontSize+j*(g.fontSize-e.fontSize),l=Math.max(Math.min(i.fontSize,k),e.fontSize);return{fontSize:l}}function f(a,b,c,d){var e=d?d*j:g.getTextWidth(a,h),f=1.2*i,k=Math.min(b/e,c/f);return{fontSize:9*k}}var g=new a,h="10px 'QlikView Sans'",i=g.getFontHeight(h)+1,j=g.getTextWidth("M",h),k={NONE:0,ADJUSTTOTEXT:1},l={NONE:0,SCALE:1,MAX:2},m={ROW:"row",COLUMN:"column"},n={checkLayout:c,getDirection:b,sizeComponent:d,TextScaleMode:l,ElementScaleMode:k,Direction:m,FixedMobileHeight:150};return n}),define("client.utils/routing",["general.controllers/route-controller","util"],function(a,b){"use strict";var c={getUrlForSheet:function(c,d,e){var f=["sheet",c,"state",d];return e&&f.splice(0,0,!0,"sense","app",b.getParameterByName("app")),a.buildUrl.apply(a,f)},goToOverview:function(){a.setUrl(a.buildUrl())},goToDataManager:function(b){a.setUrl(a.buildUrl(!0,"sense","app",b,"datamanager","datamanager"))},goToSheet:function(b,d){a.setUrl(c.getUrlForSheet(b,d,!1))},goToStory:function(b,c,d){var e=["story",b,"state",c];d&&e.push("slide",d),a.setUrl(a.buildUrl.apply(a,e))}};return c}),define("client.models/sheet",["jquery","core.models/generic-object","general.utils/visualizations","util","core.utils/deferred"],function(a,b,c,d,e){"use strict";function f(a,b){var c,d;for(c=0;c<a.cells.length;++c)if(d=a.cells[c],d.col===b.col&&d.row===b.row)return c;return-1}function g(a,b,c){var d=f(a,b);if(d===-1){if(c)return null;throw new Error("invalid pos")}return a.cells[d]}function h(a,b){a.col=b.col,a.row=b.row,a.colspan=b.colspan,a.rowspan=b.rowspan}function i(a,b,c,d){var e=g(a,b,!0),f=e?e.name:null;return e?(e.name=c,e.type=d):a.cells.push({name:c,type:d,col:b.col,row:b.row,colspan:b.colspan,rowspan:b.rowspan}),f}function j(a,b){var c={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan},d={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan};if("left"===b||"right"===b){var e=Math.ceil(a.colspan/2);c.colspan-=e,d.col+=a.colspan-e,d.colspan=e}if("top"===b||"bottom"===b){var f=Math.ceil(a.rowspan/2);c.rowspan-=f,d.row+=a.rowspan-f,d.rowspan=f}if("top"===b||"left"===b){var g=c;c=d,d=g}return{pos1:c,pos2:d}}function k(a,b,c){var d=g(a,b,!1);if(!d||d.colspan!==b.colspan||d.rowspan!==b.rowspan)return!1;var e=j(d,c);return h(d,e.pos1),e.pos2}function l(a,b){return b.filter(function(b){return b.name===a})[0]}function m(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.qInfo.qId=d.generateId(),a.qChildren.push({qChildren:[],qProperty:e})}}var n;return n=b.extend("Sheet",{edit:function(a){var b=this;return b.getProperties().then(function(c){return a(c),b.save()})},getObject:function(a,b){return this.getLayout().then(function(c){return g(c,a,b)})},moveObject:function(a,b){return this.edit(function(c){var d=g(c,a);return b.split&&(b=k(c,b.pos,b.split),!b)?e.reject():void h(d,b)})},swapObjects:function(a,b){return this.edit(function(c){var d=g(c,a),e=g(c,b,!0);h(d,b),e&&h(e,a)})},addObject:function(a){var b,f=this,g=a.template,h=a.cell.pos,j=c.getType(g),l=a.init,n=a.children||[];return b=l.qExtendsId?e.resolve(d.extend({qInfo:{qType:g}},l)):j.getInitialProperties(l),e.all({initProps:b,props:f.getFullPropertyTree()}).then(function(a){var b=a.initProps,c=a.props;if(h.split&&(h=k(c.qProperty,h.pos,h.split),!h))return e.reject();b.qInfo.qId=d.generateId();var g=i(c.qProperty,h,b.qInfo.qId,b.qInfo.qType);if(g){for(var j=0;j<c.qChildren.length;j++)if(c.qChildren[j].qProperty.qInfo.qId===g){c.qChildren[j].qProperty=b,c.qChildren[j].qChildren=[],m(c.qChildren[j],n);break}}else{var l=c.qChildren.push({qChildren:[],qProperty:b});m(c.qChildren[l-1],n)}return f.saveTree()})},getObjectById:function(a){var b,c,d=this.layout.cells;for(b=0;b<d.length;++b)if(c=d[b],a===c.name)return c;return null},removeObject:function(a){var b=this;return b.getProperties().then(function(c){c=d.extend(!0,{},c);var e=f(c,a),g=c.cells[e].name;if(e===-1)throw new Error("invalid pos");return c.cells.splice(e,1),b.removeChild(g,c)})},setCloneChildrenInfos:function(a){var b=this;return e.all([b.getChildInfos(),a.getChildInfos(),a.getProperties()]).then(function(b){var c=b[0],d=b[1],e=b[2];return c.forEach(function(a,b){var c=l(a.qId,e.cells);c&&(c.name=d[b].qId)}),a.save().then(function(){return a})})},clone:function(){var a=this;return this._super().then(function(b){return a.setCloneChildrenInfos(b)})},draft:function(a){var b=this;return a.rpc("CreateDraft","qDraftId",[this.id]).then(function(a){return n.get(a).then(function(a){return b.setCloneChildrenInfos(a)})})}},{listProperties:{qAppObjectListDef:{qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}}}),n.create=function(c,d){var e={qMetaDef:{title:"",description:""},rank:-1,thumbnail:{qStaticContentUrlDef:null},columns:24,rows:12,cells:[]};return b.create.call(n,a.extend(!0,e,c),d)},n.splitPos=j,n}),define("text!extensions.qliktech/kpi/value.ng.html",[],function(){return'<div class="ellips-text">\n\t<div class="kpi-value" ng-style="valueStyle">\n\t\t<div class="ellips-text">\n\t\t\t<span ng-bind="currentFormattedValue" title="{{currentFormattedValue}}"></span>\n\t\t</div>\n\t\t<div class="glyph-wrapper" ng-if="showGlyph">\n\t\t\t<span class="kpi-icon" ng-bind="glyph"></span>\n\t\t</div>\n\t</div>\n\t<div class="kpi-title ellips-text" ng-style="titleStyle" ng-bind="measureTitle"></div>\n</div>\n'}),define("extensions.qliktech/kpi/value",["qvangular","text!./value.ng.html","util","objects.views/charts/utils/tween"],function(a,b,c,d){a.directive("qvKpiValue",[function(){return{replace:!0,template:b,restrict:"E",scope:{value:"=",formattedValue:"=",valueStyle:"=",formatter:"=",glyph:"=",showGlyph:"=",measureTitle:"=",titleStyle:"="},link:function(a){function b(b,c,e,f){g&&g.destroy(),g=new d(b,{currentValue:c},400).progress(function(){b.currentFormattedValue=f?f.formatValue(b.currentValue):b.currentValue,a.$digest()}).then(function(){b.currentFormattedValue="U"!==f.type?e:f.formatValue(b.currentValue)})}function e(){isNaN(a.formattedValue)||!a.formatter?a.currentFormattedValue=a.formattedValue:"U"===a.formatter.type?(a.tweenFormatter||(a.tweenFormatter=a.formatter.clone()),a.tweenFormatter.pattern=f(a.formattedValue,!0),a.tweenFormatter.prepare(),b(a,a.value,a.formattedValue,a.tweenFormatter)):b(a,a.value,a.formattedValue,a.formatter)}function f(a,b){var d,e,f="0",g=a.match(/(?:-?\d+)([^\d](?=\d))/),h=g?g[1]:"",i=0;if(h&&(e=new RegExp("(?:"+c.escapeRegExp(h)+")(\\d+)"),g=a.match(e),i=g?g[1].length:0),i)for(f+=h,d=0;d<i;d++)f+="0";return b&&(f+="A"),f}var g;a.$watchCollection("[formattedValue,formatter]",function(){e()})}}}])}),define("extensions.qliktech/kpi/kpi",["jquery","qvangular","translator","core.utils/environment","objects.extension/default-view","objects.backend-api/hypercube-api","text!./kpi.ng.html","extensions.qliktech/kpi/kpi-properties","objects.views/charts/utils/chart-formatting","client.property-panel/components/color-scale-creator/color-scale-creator-utils","core.utils/deferred","objects.models/visualization-object","extensions.qliktech/kpi/kpi-layout","client.utils/routing","client.models/sheet","objects.extension/object-conversion","core.models/rpc-base","extensions.qliktech/kpi/value"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){var b=this.$scope,d=this;o.get(a).then(function(a){b.sheet=a,q.bindLayout(b,"sheet",function(a){b.sheetLinkTitle=a&&a.qMeta?a.qMeta.title:"",b.sheetIsMissing=!1,d.updateStyles()})}).catch(function(){b.sheetLinkTitle=c.get("Bookmarks.SheetMissingDialogTitle"),b.sheetIsMissing=!0,d.updateStyles()})}var s,t=b.getService("$timeout");return s=e.extend("kpi",{namespace:".kpi",init:function(a,d,e,f){var g,h=this,i=function(){b.$apply(a,function(){a.showVerifyDialog=!1})};this._super(a,d,e,f);var j=d.find(".qv-viz");this._$element=j,this.$scope.mainValueStyle={},this.$scope.measureTitleStyle={},this.$scope.viz={},this.$scope.secondaryValues=[],this.$scope.secondaryLayouts=[],this.$scope.showSecondaryValues=!1,this.$scope.mainValue={formattedValue:"",value:null,style:null},a.showVerifyDialog=!1,a.onShowVerifyDialog=function(){a.linkInteractionOn&&(b.$apply(a,function(){a.showVerifyDialog=!0,a.updateVerifyDialogFontSize()}),g=t(i,3e3))},a.linkToSheet=function(){a.linkInteractionOn&&!a.sheetIsMissing&&a.showVerifyDialog&&(window.open(n.getUrlForSheet(a.layout.sheetLink,"analysis")),t.cancel(g),i())},a.updateVerifyDialogFontSize=function(){if(a.showVerifyDialog){var b=a.verifyDialogLayoutInfo.components[0];m.checkLayout(a.verifyDialogLayoutInfo),m.sizeComponent(b,a.verifyDialogLayoutInfo,a.verifyDialogLayoutInfo.boundingBox.width,a.verifyDialogLayoutInfo.boundingBox.height,m.TextScaleMode.SCALE,m.ElementScaleMode.NONE),a.verifyDialogStyle={fontSize:b.fontSizes.fontSize}}},this.$scope.baseLayoutInfo={direction:m.Direction.COLUMN,ratio:1e9,boundingBox:{width:j.width(),height:j.height()},components:[{size:{min:.2,treshold:{width:150,height:12}},getText:function(){return a.measureTitle},fontSizes:{maxNrChars:15,min:{fontSize:10,height:15},max:{fontSize:40,height:80}},isVisible:function(){return a.showMeasureTitle}},{size:{min:.8,stretch:!0},ratio:1,components:[{size:{min:.5,stretch:!0},getText:function(){return h.$scope.mainValue.formattedValue+(h.$scope.mainValue.glyph?h.$scope.mainValue.glyph:"")},fontSizes:{maxNrChars:4,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:.5,components:this.$scope.secondaryLayouts,isVisible:function(){return h.$scope.secondaryLayouts.length>0}}]}]},this.$scope.secondaryLayoutInfo={size:{min:1,treshold:{width:100,height:30}},direction:m.Direction.COLUMN,components:[{size:{min:.6,stretch:!0},fontSizes:{maxNrChars:8,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:{min:.4},fontSizes:{maxNrChars:15,min:{fontSize:10,height:20},max:{fontSize:30,height:500}}}]},this.$scope.verifyDialogLayoutInfo={size:{min:1,width:20,height:20},boundingBox:{width:0,height:0},components:[{size:{min:.2,treshold:{width:100,height:100}},getText:function(){return c.get("properties.kpi.verifyToGoSheet")},fontSizes:{maxNrChars:16,min:{fontSize:10,height:20},max:{fontSize:13,height:50}}}]},a.$on("$destroy",function(){g&&t.cancel(g)})},isValid:function(a){return!!a&&!!a.qHyperCube&&a.qHyperCube.qMeasureInfo.length&&!a.qHyperCube.qMeasureInfo.some(function(a){return!!a.qError})},updateData:function(a){if(!this.isValid(a))return k.resolve();this._data=a;var b,c,e,f,g,h,i,j=a.qHyperCube.qDataPages[0].qMatrix[0],l=a.qHyperCube.qMeasureInfo.length,m=d.inClient(),n=l-1,o=this.getFormatterForMeasures(a.qHyperCube.qMeasureInfo.length),p=this.$scope.secondaryValues,q=this.$scope.secondaryLayouts,s=this.$scope.sheet&&this.$scope.sheet.qMetaDef&&this.$scope.sheet.qMetaDef.title?this.$scope.sheet.qMetaDef.title:null,t=function(){return f},u=function(){return h};for(this.$scope.useViz=a.useViz,this.$scope.showMeasureTitle=a.showMeasureTitle,this.$scope.textAlign=a.textAlign,this.$scope.baseLayoutInfo.components[1].components[0].fontSizes.maxNrChars="S"===a.fontSize?7:"L"===a.fontSize?3:4,this.$scope.useLink=a.useLink,m&&this.$scope.useLink&&a.sheetLink&&(!s||a.sheetLink!==s)&&r.call(this,a.sheetLink),this.$scope.mainValue.value=a.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,this.$scope.mainValue.formattedValue="U"!==o[0].type||isNaN(a.qHyperCube.qDataPages[0].qMatrix[0][0].qNum)?a.qHyperCube.qDataPages[0].qMatrix[0][0].qText:o[0].formatValue(this.$scope.mainValue.value),this.$scope.mainValue.formatter=o[0],i=0;i<n;i++)e=j[i+1].qText,g=j[i+1].qNum,f="U"!==o[i+1].type?e:o[i+1].formatValue(g),h=a.qHyperCube.qMeasureInfo[i+1].qFallbackTitle,p[i]||(c=this.createSecondaryValue(t,u),b={style:c.layoutInfo.components[0].fontSizes.value,titleStyle:c.layoutInfo.components[1].fontSizes.value},p.push(b),q.push(c.layoutInfo)),b=p[i],b.value=g,b.formattedValue=f,b.formatter=o[i+1],b.measureTitle=h,q[i].components[0].fontSizes.maxNrChars="S"===a.fontSize?14:"L"===a.fontSize?6:8;return p.length>n&&(q.splice(n,p.length-n),p.splice(n,p.length-n)),this.$scope.measureTitle=a.qHyperCube.qMeasureInfo[0].qFallbackTitle,this.$scope.showSecondaryValues=p.length>0,a.useViz&&(this._vizCreated?!this._vizBound&&a.qChildList&&a.qChildList.qItems&&(this.bindVisualization(a.qChildList.qItems[0]),this._vizBound=!0):(this.createVisualization(a.vizType),this._vizCreated=!0)),k.resolve()},updateStyles:function(){if(!this._data)return k.resolve();var a,b,c=this,e=this._data,f=d.inClient(),g=function(a,b){var c=e.qHyperCube.qMeasureInfo[b].conditionalColoring,d=e.qHyperCube.qMeasureInfo[b].measureAxis,f=(a-d.min)/(d.max-d.min),g=j.getSegmentIndex(c,a,d.min),h=c.segments.colors[g]?c.segments.colors[g].icon:"",i=c.useConditionalColoring?j.shouldBlend(c.segments,g)?j.blendValue(c.segments,f,d.min,d.max):j.resolveColor(c.segments.colors[g].color):j.resolveColor(c.singleColor);return{color:i,icon:h,useCondColor:c.useConditionalColoring}};this.$scope.linkInteractionOn=f&&this._navigation&&this.$scope.layout.useLink&&!!this.$scope.layout.sheetLink,this.$scope.verifyDialogLayoutInfo.boundingBox.width=this._$element.width(),this.$scope.verifyDialogLayoutInfo.boundingBox.height=this._$element.height(),this.$scope.baseLayoutInfo.boundingBox=this.getBoundingBox(),m.checkLayout(this.$scope.baseLayoutInfo),this.$scope.baseLayoutInfo.components.forEach(function(a){var b=c.backendApi.isSnapshot&&c._data&&!c._data.snapshotData.object.freeResize,d=b?c._data.snapshotData.isZoomed:c.options.isZoomed;m.sizeComponent(a,c.$scope.baseLayoutInfo,c.$scope.baseLayoutInfo.boundingBox.width,c.$scope.baseLayoutInfo.boundingBox.height,0===c.$scope.secondaryValues.length&&d?m.TextScaleMode.MAX:m.TextScaleMode.SCALE,0===c.$scope.secondaryValues.length&&d?m.ElementScaleMode.ADJUSTTOTEXT:m.ElementScaleMode.NONE)}),b=g(this.$scope.mainValue.value,0),this.$scope.mainValue.glyph=b.icon,this.$scope.mainValue.showGlyph=b.useCondColor&&b.icon&&""!==b.icon,a=this.$scope.baseLayoutInfo.components[1].components[0],this.$scope.mainValue.style={color:b.color,fontSize:a.fontSizes.fontSize},a=this.$scope.baseLayoutInfo.components[0],this.$scope.measureTitleStyle={fontSize:a.fontSizes.fontSize};for(var h=1;h<e.qHyperCube.qMeasureInfo.length;h++)a=this.$scope.baseLayoutInfo.components[1].components[1].components[h-1].components[0],b=g(this.$scope.secondaryValues[h-1].value,h),this.$scope.secondaryValues[h-1].style={color:b.color,fontSize:a.fontSizes.fontSize},a=this.$scope.baseLayoutInfo.components[1].components[1].components[h-1].components[1],this.$scope.secondaryValues[h-1].titleStyle={fontSize:a.fontSizes.fontSize},this.$scope.secondaryValues[h-1].glyph=b.icon,this.$scope.secondaryValues[h-1].showGlyph=b.useCondColor&&b.icon&&""!==b.icon;this.$scope.updateVerifyDialogFontSize();var i=k();return t(function(){i.resolve()},0,!1),i.promise},bindVisualization:function(a){var b=this;l.get(a.qInfo.qId).then(function(a){b.$scope.viz.model=a})},createSecondaryValue:function(b,c){var d=a.extend({},this.$scope.secondaryLayoutInfo);return d.components[0].getText=b,d.components[1].getText=c,{layoutInfo:d,text:b()}},paint:function(){return this.updateStyles()},resize:function(a,b){return this.paint(a,b)},getFormatterForMeasures:function(a){for(var b,c,d=this._data,e=new i(this.backendApi.localeInfo,d.qHyperCube.qMeasureInfo),f=[],g=0;g<a;g++)b=d.qHyperCube.qMeasureInfo[g],c=e.getMeasureFormatter(g),"U"===c.type&&(c.pattern=c.createPatternFromRange(b.qMax,b.qMax,!0),Math.floor(Math.log(Math.abs(b.qMax))/Math.log(10))%3===2&&(c.pattern=c.pattern.substr(0,c.pattern.length-2),c.pattern+="A")),c.prepare(),f.push(c);return f},on:function(){this.options.navigation&&(this._navigation=!0),this._super(),this.updateStyles()},off:function(){this.options.navigation&&(this._navigation=!1),this._super(),this.updateStyles()},getBoundingBox:function(){var a=this.backendApi.isSnapshot&&this._data&&!this._data.snapshotData.object.freeResize;return a&&this._data.snapshotData.elementRatio?{width:this._data.snapshotData.object.size.w,height:this._data.snapshotData.object.size.w*this._data.snapshotData.elementRatio}:{width:this._$element.width(),height:this._$element.height()}},setSnapshotData:function(a){this._super(),a.snapshotData.isZoomed=this.options.isZoomed,a.snapshotData.elementRatio=this._$element.height()/this._$element.width()},getPreferredSize:function(){var a=k();return a.resolve({w:this._$element.width(),h:m.FixedMobileHeight}),a.promise}}),{type:"kpi",BackendApi:f,template:g,View:s,definition:h,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:500,qHeight:10}],qSuppressMissing:!0},showTitles:!1},data:{measures:{min:1,max:2}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!1},getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()},importProperties:function(a,b,c){var d,e,f,g=p.hypercube.importProperties.apply(p,[a,b,c]),h=g.qProperty.qHyperCubeDef.qMeasures;if(h)for(e=0,d=h.length;e<d;e++)f=h[e].qDef,f.measureAxis||(f.measureAxis={min:0,max:100}),f.conditionalColoring||(f.conditionalColoring={useConditionalColoring:!1,singleColor:3,segments:{limits:[],colors:[{color:2}]}});return g},exportProperties:p.hypercube.exportProperties.bind(p)}}),define("objects.backend-api/map-api",["./backend-api","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("MapApi",{init:function(a){this._super(a)},select:function(a,b,c,d){if(b)return this.model.rpc(a,null,[b,c,d])},selectRange:function(a,b,c){if(!(this.path.indexOf("qHyperCubeDef")<0)){var d,e=this.path.replace("/geodata","");return b=!!b,c=c||[0],d=a.map(function(a){return{qMeasureIx:a.measure,qRange:{qMin:a.range.min,qMax:a.range.max,qMinInclEq:a.range.minInclEq!==!1,qMaxInclEq:a.range.maxInclEq!==!1}}}),this.model.rpc("RangeSelectHyperCubeValues",null,[e,d,c,b])}},selectValues:function(a,b,c,d){return this.model.rpc("SelectHyperCubeValues",null,[d||this.path,a,b,c])},updateCache:function(){},setInitialData:function(){},getData:function(a,b){return this.model.rpc("GetHyperCubeData","qDataPages",[b,a])},evaluateExpression:function(a){return b.current.evaluateExpression(a)},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},beginSelections:function(){var a,c,d,e=this.model,f=[];for(a=0;a<e.layout.layers.length;++a)if(c="/layers/"+a+"/","polygon"===e.layout.layers[a].type)d=c+"geodata/",c+="qHyperCubeDef",d+="qHyperCubeDef",f.push(c),f.push(d);else{if(!e.layout.layers[a].qHyperCube)continue;c+="qHyperCubeDef",f.push(c)}return b.current.switchModal(e,f)}})}),define("text!extensions.qliktech/map/map.ng.html",[],function(){return'<div class="qv-viz"></div>\n<div qva-scatter-navigation></div>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="true" direction="options.direction"></div>'}),define("text!client.services/media-tool/media-tool.ng.html",[],function(){return'<div class="qv-st-container">\n\t<form class="qv-st-form">\n\t\t<textarea class="qv-st-instance">{{data}}</textarea>\n\t</form>\n</div>'}),define("client.services/media-tool/theme",[],function(){var a=["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],b={1:"XS",2:"S",3:"M",4:"L",5:"XL"},c={10:"1",13:"2",16:"3",22:"4",32:"5"},d={1:1,2:2,3:3,4:4,5:5,6:5},e={1:1,2:2,3:3,4:4,5:5};return{palette:a,fontSizes:b,fontSizesPx:c,htmlSizeToMarkdownSize:d,markdownSizeToHtmlSize:e}}),define("text!client.services/media-tool/toolbar.ng.html",[],function(){return'<immidiate-contextual ng-if="options.style === \'popover\'" align-to="alignTo" position="\'top\'" collision="\'collision\'" width="options.width" height="48" class="qui-immidiateContextual qv-texttool-toolbar"\n\t\t\t\t\t  on-close-view="closeToolbar(event)" ondragstart="return false">\n\t<div qv-media-tool-buttons class="qv-texttool-toolbar"></div>\n</immidiate-contextual>\n\n<div ng-if="options.style === \'inline\'" qv-media-tool-buttons class="qv-texttool-toolbar"></div>\n'}),define("client.services/media-tool/text-selection",[],function(){function a(){return window.getSelection()}var b={};return b.createRange=function(a,b,c){var d=document.createRange();return b=b||0,c="undefined"==typeof c?a.childNodes.length:c,d.setStart(a,b),d.setEnd(a,c),d},b.createRangeForElement=function(a){var b=document.createRange();return b.selectNode(a),b},b.addRange=function(b,c){var d=a();c&&d.removeAllRanges(),d.addRange(b)},b.getRange=function(b){var c=window.getSelection();return b=b||0,c.rangeCount>b?a().getRangeAt(b):null},b.rangeEquals=function(a,b){return null===a&&null===b||null!==a&&null!==b&&(0===a.compareBoundaryPoints(window.Range.START_TO_START,b)&&0===a.compareBoundaryPoints(window.Range.END_TO_END,b))},b}),define("text!client.services/media-tool/link-foldout/link-foldout.ng.html",[],function(){return'<immidiate-contextual width="400" align-to="options.alignTo" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFoldout(event)"\n\t\t\t\t\t  class="qv-link-foldout qui-immidiateContextual" tid="link-foldout">\n\n\t<div class="link-header">\n\t\t<h1 class="link-header-text" ng-if="linkActive" q-translation="MediaTool.Toolbar.InsertUrlLink.Title"></h1>\n\t\t<h1 class="link-header-text" ng-if="!linkActive" q-translation="Common.Bookmarks"></h1>\n\t\t<div class="link-submenu" ng-if="inStorytelling()">\n\t\t\t<ul>\n\t\t\t\t<li class="lui-button" ng-if="!linkActive" qva-activate="toggleLink(true)" q-translation="Common.URL" ></li>\n\t\t\t\t<li class="lui-button" ng-if="linkActive" qva-activate="toggleLink(false)" q-translation="Common.Bookmarks" ></li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n\n\t<div class="link-content" ng-if="linkActive">\n\t\t<span class="link-label" q-translation="MediaTool.Toolbar.InsertUrlLink.Label"></span>\n\t\t<input class="link-input lui-input" maxlength="255" ng-model="link.url" style="margin-bottom: 10px" qv-enter="onEnter($event)"/>\n\t\t<div class="link-remove-container" ng-if="showRemove">\n\t\t\t<button class="lui-button" qva-activate="removeLink($event)" q-title-translation="MediaTool.Toolbar.RemoveLink">\n\t\t\t\t<span class="lui-button__icon  lui-icon  lui-icon--bin"></span>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t<div class="bookmark-content" ng-if="!linkActive">\n\t\t<ul>\n\t\t\t<li ng-if="bookmarks.length < 1" class="bookmark-link-row">\n\t\t\t\t<span class="bookmark-link-row-content no-bookmarks" q-translation="Bookmarks.NoBookmarks"></span>\n\t\t\t</li>\n\t\t\t<li class="bookmark-link-row" ng-repeat="bookmark in bookmarks" ng-class="{ active: bookmark.active}">\n\t\t\t\t<span class="bookmark-link-row-content" qva-activate="insertBookmark($event, bookmark.qInfo.qId)" data-bookmark-id="{{bookmark.qInfo.qId}}">{{bookmark.qData.title}}</span>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n<!--</div>-->\n</immidiate-contextual>\n'}),define("client.models/bookmark",["jquery","core.models/base-object","core.models/app"],function(a,b,c){"use strict";var d;return d=b.extend("Bookmark",{clone:function(){return this._super("CloneBookmark")},apply:function(){return d.apply(this.id,this.app)}},{listProperties:{qBookmarkListDef:{qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",sheetId:"/sheetId",selectionFields:"/selectionFields",creationDate:"/creationDate"}}}}),d.get=function(a,b){function d(){return b.enigmaModel.getBookmark(a)}return b=b||c.current,this.getModel(a,b.session,d)},d.apply=function(a,b){b=b||c.current;var d=b.rpc("ApplyBookmark","qSuccess",[a]);return d},d.create=function(c,d){var e={qMetaDef:{title:"",description:""},sheetId:c.sheetId||null,selectionFields:c.selectionFields,creationDate:(new Date).toISOString()};return b.create.call(this,a.extend(!0,{},e,c),"CreateBookmark",d)},d.remove=function(a,c){return b.remove(a,"DestroyBookmark",c)},d.extend=function(a,c,e){var f=b.extend.call(this,a,c,e);return f.extend=d.extend,f.create=d.create,f.remove=d.remove,f.get=d.get,f},d}),define("client.services/media-tool/link-foldout/link-foldout",["jquery","text!./link-foldout.ng.html","client.utils/state","client.models/bookmark"],function(a,b,c,d){var e={template:b,scope:{alignTo:"=",options:"="},controller:["$scope","$timeout","$element",function(b,e,f){function g(){!b.link.url&&b.link.bookmark?(b.toggleLink(!1),h()):b.toggleLink(!0)}function h(){d.getList().then(function(a){a.getLayout().then(function(a){b.bookmarks=a,i()})})}function i(){b.bookmarks.forEach(function(a){a.qInfo.qId===b.link.bookmark?a.active=!0:a.active=!1})}b.link=b.options.link,b.link.url&&"#"!==b.link.url||(b.link.url=""),b.link.url=decodeURIComponent(b.link.url);var j=b.link.url;b.alignTo=b.options.alignTo,b.linkActive=!0,b.closeFoldout=function(a){var c=encodeURI(b.link.url),d=b.link.$node;return b.closed=!0,c===j?void b.options.onCancel(a):void(c&&c.length>0&&c.indexOf("javascript:")===-1?(0!==c.search("[a-zA-Z0-9]+:")&&(c="http://"+c),b.options.onSave(a,c,d,{cmd:"createLink",formatter:"link"})):b.options.onCancel(a))},b.onEnter=function(a){b.closeFoldout(a)},b.showRemove=!!j,b.removeLink=function(a){b.options.onRemove(a,b.link.$node)},b.inStorytelling=function(){return c.state===c.States.editstory},b.insertBookmark=function(a,c){b.options.onSave(a,c,b.link.$node,{cmd:"createLink",formatter:"bookmark"})},b.toggleLink=function(c){b.linkActive=c,c&&setTimeout(function(){a(".link-input").focus()})},b.exposedApi.closing=function(){b.closed||b.closeFoldout()},b.$on("$destroy",function(){b.closed||b.closeFoldout()}),g(),b.$watch("linkActive",function(){b.linkActive&&h()}),e(function(){f.find(".link-input").focus()})}]};return e}),define("general.utils/paths",["util"],function(a){var b={};return b.stripBasePath=function(b){return b=b.replace(a.baseURI,"").replace(/^\.\.\//i,"/"),b=b.replace(location.protocol+"//"+location.host,"")},b.addBasePath=function(b){return a.baseURI+".."+b},b.getUrl=function(a){return require.toUrl(".."+a)},b}),define("general.models/media-library",["core.models/base-object","util","general.utils/paths"],function(a,b,c){"use strict";function d(a,b,c){var d={name:a,type:b};return c&&(d.path=c.qUrl,d.pathDef=c.qUrlDef),"folder"===b&&(d.children=[]),d}function e(a,b){a=a.substring(1).split("/").reverse().slice(1).reverse();var c=b;return a.forEach(function(a){var b=!1;if(c.children.forEach(function(d){if(d.name===a)return c=d,void(b=!0)}),!b){var e=d(a,"folder");c.children.push(e),c=e}}),c}function f(a){a.sort(function(a,b){return a.name.localeCompare(b.name)}).reverse(),a.sort(function(a,b){return"folder"===a.type&&"folder"!==b.type?-1:"folder"===a.type&&"folder"===b.type?a.name.localeCompare(b.name):"folder"!==a.type&&"folder"!==b.type?a.name.localeCompare(b.name):1}),a.forEach(function(a){"undefined"!=typeof a.children&&f(a.children)})}var g;return g=a.extend("MediaLibrary",{},{listProperties:{qMediaListDef:{}}}),g.createTree=function(a,b,g){b=(b||[]).join("|")||".+?";var h=d("/","folder"),i=new RegExp("\\.("+b+")$","i");return a.forEach(function(a){var b,f=a,j=f.qUrl;if(j=c.stripBasePath(j),
b=decodeURIComponent((j+"").replace(/\+/g,"%20")),b=b.split("/").splice(-1)[0],b.match(i)){var k,l=h;g||(k=decodeURIComponent(j).replace(/^(\/content\/default)|(\/content\/Default)/,"").replace(/^(^\/media\/([a-z0-9-])+\/([a-z0-9-])+\/)/,"/media/"),l=e(k,h)),l.children.push(d(b,"file",f))}}),f(h.children),h},g.filterList=function(a){var b,c,d=[],e=a.sort(function(a,b){var c=a.qName.toLowerCase(),d=b.qName.toLowerCase();return c.localeCompare(d)});for(b=0;b<a.length;b++)if(c=a[b],c.qAppSpecific){d.push(c),c.qMeta&&c.qMeta.privileges.indexOf("update")!==-1&&(g.canUpdate=!0);break}for(b=0;b<e.length;b++)c=a[b],c.qAppSpecific||d.push(c);return d},g.getRemainingSpace=function(a){for(var b=0,c=0;c<a.length;c++)if(a[c].qAppSpecific){b=parseInt(a[c].qMeta.remainingLibrarySpace||0,10);break}return b},g}),define("text!general.components/media-library/media-library.ng.html",[],function(){return'<qv-modal-dialog qv-id="media-library-modal" tid="media-library" qv-cancel="cancel($event)" qv-confirm="confirm()" qva-stop-prop>\n\t<header class="dm-head">\n\t\t<span class="dm-title" q-translation="MediaLibrary.Header"></span>\n\t</header>\n\t<main class="dm-main medialib">\n\t\t<div class="q-section-list" ng-if="lists.length">\n\t\t\t<ul class="qui-menu" tid="menu-list">\n\t\t\t\t<li ng-repeat="list in lists track by list.qName"\n\t\t\t\t\tng-class="{\'qui-menu-item\': true, \'selected\': !isUpload && view === list.qName}"\n\t\t\t\t\tqva-activate="goTo(list.qName, false)">\n\t\t\t\t\t<span ng-if="list.qAppSpecific" q-translation="MediaLibrary.InApp" tid="goto-inapp"></span>\n\t\t\t\t\t<span ng-if="!list.qAppSpecific" tid="goto-library">{{ list.qName }}</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div class="q-section-upload qui-menu-item"\n\t\t\t\tng-if="canUpdate"\n\t\t\t\tng-class="{\'selected\': isUpload}"\n\t\t\t\ttid="goto-upload"\n\t\t\t\tqva-activate="goTo(\'\', true)">\n\t\t\t\t<div class="q-section-upload-text" q-translation="MediaLibrary.UploadMedia"></div>\n\t\t\t\t<div class="qv-loader" ng-if="updateExp.isUploading"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="q-empty" ng-if="state === contentState.isEmpty && !isUpload">\n\t\t\t<p q-translation="MediaLibrary.NoFilesFound" class="nff"></p>\n\t\t</div>\n\t\t<qve-media-list ng-if="state === contentState.hasFiles && !isUpload" ng-class="{\'q-image-library\': !isUpload}" class="q-images-cont" tid="media-lib-items-list"></qve-media-list>\n\t\t<div class="q-media-preview" ng-if="selectedFile && !isUpload">\n\t\t\t<div class="q-media-preview-toolbar" ng-if="canDeleteInView()">\n\t\t\t\t<qui-button-outline-round\n\t\t\t\t\tlight\n\t\t\t\t\ttid="delete"\n\t\t\t\t\tclass-icon="icon-bin"\n\t\t\t\t\tdata-name="delete"\n\t\t\t\t\tq-title-translation="Common.Delete"\n\t\t\t\t\tqva-activate="onDelete($event)">\n\t\t\t\t</qui-button-outline-round>\n\t\t\t</div>\n\t\t\t<div class="q-media-preview-img-wrapper">\n\t\t\t\t<img ng-src="{{ getSrc(selectedFile) }}" class="q-media-img-list"/>\n\t\t\t</div>\n\t\t\t<div class="q-media-preview-bottom-toolbar">\n\t\t\t\t<button class="lui-button"\n\t\t\t\t\t\ttid="insert"\n\t\t\t\t\t\tdata-name="insert"\n\t\t\t\t\t\tq-translation="MediaLibrary.Insert"\n\t\t\t\t\t\tq-title-translation="MediaLibrary.Insert"\n\t\t\t\t\t\tqva-activate="confirm()">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="q-images-cont" ng-if="canUpdate" ng-show="isUpload">\n\t\t\t<qv-media-update update-exp="updateExp" select-file="selectFile" selected-file="selectedFile" confirm="confirm"></qv-media-update>\n\t\t</div>\n\t</main>\n\t<div class="q-media-zoomed" ng-if="inZoom" qva-stop-prop>\n\t\t<div class="q-media-z-wrapper">\n\t\t\t<div class="q-media-z-cont">\n\t\t\t\t<img class="q-media-z-img" ng-src="{{ getSrc(zoomSrc) }}">\n\t\t\t</div>\n\n\t\t\t<div class="q-media-zoom-footer">\n\t\t\t\t<qv-confirm-cancel-footer light qv-confirm="confirm()" qv-cancel="closeZoom()" qv-confirm-label="Common.Apply" qv-confirm-disabled="updateExp.isUploading"></qv-confirm-cancel-footer>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<footer class="dm-footer">\n\t\t<lui-button x-variant="inverse" qva-activate="cancel($event)"q-translation="Common.Close" tid="cancel" ng-disabled="updateExp.isUploading"></lui-button>\n\t</footer>\n</qv-modal-dialog>\n'}),define("text!general.components/media-library/media-library-grid.ng.html",[],function(){return'<div>\n\t<qv-bouncy-grid min-width="140" padding="15" selector=".q-media-grid" list-len="rootEntry.children.length">\n\t\t<div ng-repeat="entry in rootEntry.children"\n\t\t\t title="{{entry.name}}"\n\t\t\t tid="media-item"\n\t\t\t ng-class="{\'q-media-grid\': true, \'selected-img\': isSelectedImg(entry, $last, \'.q-media-inuse\')}"\n\t\t\t qva-activate="selectFile($event, entry.path, entry.pathDef)">\n\t\t\t<div class="q-media-wrap-img">\n\t\t\t\t<img ng-src="{{staticSrc}}" class="q-media-img" width="100%" height="100%"/>\n\n\t\t\t\t<div class="overlay"></div>\n\t\t\t\t<div class="q-media-inuse" ng-if="input.selectedFile === entry.path">\n\t\t\t\t\t<i class="icon-tick"></i>\n\t\t\t\t</div>\n\t\t\t\t<div class="q-media-buttons" ng-if="selectedFile === entry.path">\n\t\t\t\t\t<qui-button-outline-round small\n\t\t\t\t\t\t\t\t\t\t\t  tid="media-view"\n\t\t\t\t\t\t\t\t\t\t\t  class-icon="icon-hub-view"\n\t\t\t\t\t\t\t\t\t\t\t  data-name="view"\n\t\t\t\t\t\t\t\t\t\t\t  q-title-translation="Common.View"\n\t\t\t\t\t\t\t\t\t\t\t  qva-activate="zoomImage($event, entry)"\n\t\t\t\t\t\t\t></qui-button-outline-round>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="q-media-name">{{entry.name}}</div>\n\t\t</div>\n\t</qv-bouncy-grid>\n</div>'}),define("text!general.components/media-library/media-library-list.ng.html",[],function(){return'<div>\n\t<!--\n\t\t<img ng-src="{{staticSrc}}" class="q-media-img" width="100%" height="100%"/>\n\t-->\n\t<div class="q-media-list-cont" qva-context-menu="onContextMenu($event)">\n\t\t<div ng-repeat="entry in rootEntry.children"\n\t\t\t ng-class="{\'qui-menu-item\': true, \'selected\': isSelectedImg(entry, $last, \'.selected\')}"\n\t\t\t tid="media-item" title="{{entry.name}}"\n\t\t\t qva-activate="selectFile($event, entry.path, entry.pathDef)">\n\t\t\t<div class="list-name">{{entry.name}}</div>\n\t\t</div>\n\t</div>\n</div>'}),define("text!general.services/loader/default-loader.ng.html",[],function(){return'<div class="qv-block-ui" ng-class="{\'qv-fade-out\': fadeOut}">\n\t<div class="qv-loader-container" ng-class="ngClasses">\n\t\t<div class="qv-loader"></div>\n\t</div>\n\t<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\n\t\t<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\n\t\t<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\n\t</div>\n</div>\n'}),define("general.views/bouncy-grid/bouncy-grid",["jquery","qvangular","core.utils/resize"],function(a,b,c){function d(a){return parseInt(a||0,10)}b.directive("qvBouncyGrid",[function(){return{restrict:"E",template:'<div class="qv-bouncy" ng-transclude></div>',transclude:!0,replace:!0,scope:{minWidth:"@",maxWidth:"@",padding:"@",selector:"@",listLen:"="},controller:["$scope","$element",function(b,e){function f(a){clearTimeout(h),h=setTimeout(g,a||50)}function g(){var a,c,g,h,m=d(b.padding);l?(a=l,c=Math.ceil(e.width()/a),g=Math.floor(e.width()/c),h=(c>b.listLen?a:g)-m+"px!important;"):(a=k,c=Math.floor(e.width()/a),g=Math.ceil(e.width()/c),h=(c>b.listLen?a:g)-m+"px!important;"),isNaN(g-m)&&j<20?(j++,f()):i&&i.length&&i.text(b.selector+" { width: "+h+"height: "+h+"}")}var h,i=a("<style></style>").appendTo("body"),j=0,k=d(b.minWidth),l=d(b.maxWidth);c.on("end",f),f(0),b.$watch("listLen",f),b.$on("$destroy",function(){clearTimeout(h),i&&i.remove(),h=null,i=null,c.off("end",f)})}]}}])}),define("text!general.components/media-library/update/media-update.ng.html",[],function(){return'<div id="media-library-upload">\n\t<div class="bouncy-wrap" ng-class="{\'empty\' : isEmpty}">\n\t\t<qv-bouncy-grid min-width="140" padding="15" selector=".preview-media-grid" list-len="previewCounter">\n\t\t\t<div class="media-library-preview-container" ng-hide="isEmpty"></div>\n\t\t</qv-bouncy-grid>\n\t</div>\n\t<div id="media-library-dropzone" class="dropzone" ng-class="{\'empty\' : isEmpty}">\n\t\t<div class="dz-message">\n\t\t\t<div class="upload-drop-text" q-translation="MediaLibrary.ClickOrDropHere"></div>\n\t\t\t<div class="upload-drop-icon-wrap">\n\t\t\t\t<div class="upload-drop-icon" data-icon="upload"></div>\n\t\t\t</div>\n\t\t\t<div class="upload-drop-quota">{{quotaInfo}}</div>\n\t\t</div>\n\t</div>\n</div>\n'}),define("text!general.components/media-library/update/preview-item.ng.html",[],function(){return'<div tid="preview-item"\n\t class="q-media-grid preview-media-grid"\n\t ng-class="{\'selected-img\': selectedFile === file.qUrl}"\n\t qva-activate="onSelectImage( $event, file )"\n\t qva-context-menu="onContextMenu( $event, file, file.name, file.qUrl )">\n\t<div class="q-media-wrap-img">\n\t\t<img class="q-media-img" width="100%" height="100%" data-dz-thumbnail />\n\t\t<div class="overlay"></div>\n\t\t<div class="preview-area">\n\t\t\t<div class="touch-area cancel-upload-area" q-title-translation="Common.Cancel" data-dz-remove qva-activate="onCancelUpload( $event, file )">\n\t\t\t\t<button class="qui-btn-overlay-action-small cancel-upload">\n\t\t\t\t\t<span class="lui-icon  lui-icon--close"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div ng-if="selectedFile === file.qUrl" class="preview-area-edit">\n\t\t\t\t<div class="touch-area delete-image-area" q-title-translation="Common.Delete" qva-activate="onDelete( $event, file, file.name, file.qUrl )">\n\t\t\t\t\t<button class="qui-btn-overlay-action-small delete-image">\n\t\t\t\t\t\t<span class="lui-icon  lui-icon--bin"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<qui-button-outline-round\n\t\t\t\t\ttid="insert"\n\t\t\t\t\tclass-icon="icon-add-section"\n\t\t\t\t\tdata-name="insert"\n\t\t\t\t\tq-title-translation="MediaLibrary.Insert"\n\t\t\t\t\tqva-activate="onInsert( $event )">\n\t\t\t\t</qui-button-outline-round>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="error-wrapper" ng-if="showError">\n\t\t\t<div class="error-icon" data-icon="warning-triangle"></div>\n\t\t\t<div class="error-text">{{errorMsg}}</div>\n\t\t</div>\n\t\t<div class="preview-progress">\n\t\t\t<div class="preview-progressbar-wrapper">\n\t\t\t\t<span class="preview-progressbar" data-dz-uploadprogress></span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="q-media-name" q-title-translation="{{file.name}}">{{file.name}}</div>\n</div>\n'}),function(){var a,b,c,d,e,f,g,h,i=[].slice,j={}.hasOwnProperty,k=function(a,b){function c(){this.constructor=a}for(var d in b)j.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};g=function(){},b=function(){function a(){}return a.prototype.addEventListener=a.prototype.on,a.prototype.on=function(a,b){return this._callbacks=this._callbacks||{},this._callbacks[a]||(this._callbacks[a]=[]),this._callbacks[a].push(b),this},a.prototype.emit=function(){var a,b,c,d,e,f;if(d=arguments[0],a=2<=arguments.length?i.call(arguments,1):[],this._callbacks=this._callbacks||{},c=this._callbacks[d])for(e=0,f=c.length;e<f;e++)b=c[e],b.apply(this,a);return this},a.prototype.removeListener=a.prototype.off,a.prototype.removeAllListeners=a.prototype.off,a.prototype.removeEventListener=a.prototype.off,a.prototype.off=function(a,b){var c,d,e,f,g;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(d=this._callbacks[a],!d)return this;if(1===arguments.length)return delete this._callbacks[a],this;for(e=f=0,g=d.length;f<g;e=++f)if(c=d[e],c===b){d.splice(e,1);break}return this},a}(),a=function(a){function c(a,b){var e,f,g;if(this.element=a,this.version=c.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(c.instances.push(this),this.element.dropzone=this,e=null!=(g=c.optionsForElement(this.element))?g:{},this.options=d({},this.defaultOptions,e,null!=b?b:{}),this.options.forceFallback||!c.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(f=this.getExistingFallback())&&f.parentNode&&f.parentNode.removeChild(f),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=c.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=c.getElements(this.options.clickable,"clickable")),this.init()}var d,e;return k(c,a),c.prototype.Emitter=b,c.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],c.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(a,b){return b()},init:function(){return g},forceFallback:!1,fallback:function(){var a,b,d,e,f,g;for(this.element.className=""+this.element.className+" dz-browser-not-supported",g=this.element.getElementsByTagName("div"),e=0,f=g.length;e<f;e++)a=g[e],/(^| )dz-message($| )/.test(a.className)&&(b=a,a.className="dz-message");return b||(b=c.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(b)),d=b.getElementsByTagName("span")[0],d&&(d.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(a){var b,c,d;return b={srcX:0,srcY:0,srcWidth:a.width,srcHeight:a.height},c=a.width/a.height,b.optWidth=this.options.thumbnailWidth,b.optHeight=this.options.thumbnailHeight,null==b.optWidth&&null==b.optHeight?(b.optWidth=b.srcWidth,b.optHeight=b.srcHeight):null==b.optWidth?b.optWidth=c*b.optHeight:null==b.optHeight&&(b.optHeight=1/c*b.optWidth),d=b.optWidth/b.optHeight,a.height<b.optHeight||a.width<b.optWidth?(b.trgHeight=b.srcHeight,b.trgWidth=b.srcWidth):c>d?(b.srcHeight=a.height,b.srcWidth=b.srcHeight*d):(b.srcWidth=a.width,b.srcHeight=b.srcWidth/d),b.srcX=(a.width-b.srcWidth)/2,b.srcY=(a.height-b.srcHeight)/2,b},drop:function(a){return this.element.classList.remove("dz-drag-hover")},dragstart:g,dragend:function(a){return this.element.classList.remove("dz-drag-hover")},dragenter:function(a){return this.element.classList.add("dz-drag-hover")},dragover:function(a){return this.element.classList.add("dz-drag-hover")},dragleave:function(a){return this.element.classList.remove("dz-drag-hover")},paste:g,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(a.previewElement=c.createElement(this.options.previewTemplate.trim()),a.previewTemplate=a.previewElement,this.previewsContainer.appendChild(a.previewElement),l=a.previewElement.querySelectorAll("[data-dz-name]"),f=0,i=l.length;f<i;f++)b=l[f],b.textContent=a.name;for(m=a.previewElement.querySelectorAll("[data-dz-size]"),g=0,j=m.length;g<j;g++)b=m[g],b.innerHTML=this.filesize(a.size);for(this.options.addRemoveLinks&&(a._removeLink=c.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),a.previewElement.appendChild(a._removeLink)),d=function(b){return function(d){return d.preventDefault(),d.stopPropagation(),a.status===c.UPLOADING?c.confirm(b.options.dictCancelUploadConfirmation,function(){return b.removeFile(a)}):b.options.dictRemoveFileConfirmation?c.confirm(b.options.dictRemoveFileConfirmation,function(){return b.removeFile(a)}):b.removeFile(a)}}(this),n=a.previewElement.querySelectorAll("[data-dz-remove]"),o=[],h=0,k=n.length;h<k;h++)e=n[h],o.push(e.addEventListener("click",d));return o}},removedfile:function(a){var b;return a.previewElement&&null!=(b=a.previewElement)&&b.parentNode.removeChild(a.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(a,b){var c,d,e,f;if(a.previewElement){for(a.previewElement.classList.remove("dz-file-preview"),f=a.previewElement.querySelectorAll("[data-dz-thumbnail]"),d=0,e=f.length;d<e;d++)c=f[d],c.alt=a.name,c.src=b;return setTimeout(function(b){return function(){return a.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(a,b){var c,d,e,f,g;if(a.previewElement){for(a.previewElement.classList.add("dz-error"),"String"!=typeof b&&b.error&&(b=b.error),f=a.previewElement.querySelectorAll("[data-dz-errormessage]"),g=[],d=0,e=f.length;d<e;d++)c=f[d],g.push(c.textContent=b);return g}},errormultiple:g,processing:function(a){if(a.previewElement&&(a.previewElement.classList.add("dz-processing"),a._removeLink))return a._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:g,uploadprogress:function(a,b,c){var d,e,f,g,h;if(a.previewElement){for(g=a.previewElement.querySelectorAll("[data-dz-uploadprogress]"),h=[],e=0,f=g.length;e<f;e++)d=g[e],"PROGRESS"===d.nodeName?h.push(d.value=b):h.push(d.style.width=""+b+"%");return h}},totaluploadprogress:g,sending:g,sendingmultiple:g,success:function(a){if(a.previewElement)return a.previewElement.classList.add("dz-success")},successmultiple:g,canceled:function(a){return this.emit("error",a,"Upload canceled.")},canceledmultiple:g,complete:function(a){if(a._removeLink&&(a._removeLink.textContent=this.options.dictRemoveFile),a.previewElement)return a.previewElement.classList.add("dz-complete")},completemultiple:g,maxfilesexceeded:g,maxfilesreached:g,queuecomplete:g,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},d=function(){var a,b,c,d,e,f,g;for(d=arguments[0],c=2<=arguments.length?i.call(arguments,1):[],f=0,g=c.length;f<g;f++){b=c[f];for(a in b)e=b[a],d[a]=e}return d},c.prototype.getAcceptedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],a.accepted&&e.push(a);return e},c.prototype.getRejectedFiles=function(){var a,b,c,d,e;for(d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],a.accepted||e.push(a);return e},c.prototype.getFilesWithStatus=function(a){var b,c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;c<d;c++)b=e[c],b.status===a&&f.push(b);return f},c.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(c.QUEUED)},c.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(c.UPLOADING)},c.prototype.getActiveFiles=function(){var a,b,d,e,f;for(e=this.files,f=[],b=0,d=e.length;b<d;b++)a=e[b],a.status!==c.UPLOADING&&a.status!==c.QUEUED||f.push(a);return f},c.prototype.init=function(){var a,b,d,e,f,g,h;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(c.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(d=function(a){return function(){return a.hiddenFileInput&&document.body.removeChild(a.hiddenFileInput),a.hiddenFileInput=document.createElement("input"),a.hiddenFileInput.setAttribute("type","file"),(null==a.options.maxFiles||a.options.maxFiles>1)&&a.hiddenFileInput.setAttribute("multiple","multiple"),a.hiddenFileInput.className="dz-hidden-input",null!=a.options.acceptedFiles&&a.hiddenFileInput.setAttribute("accept",a.options.acceptedFiles),null!=a.options.capture&&a.hiddenFileInput.setAttribute("capture",a.options.capture),a.hiddenFileInput.style.visibility="hidden",a.hiddenFileInput.style.position="absolute",a.hiddenFileInput.style.top="0",a.hiddenFileInput.style.left="0",a.hiddenFileInput.style.height="0",a.hiddenFileInput.style.width="0",document.body.appendChild(a.hiddenFileInput),a.hiddenFileInput.addEventListener("change",function(){var b,c,e,f;if(c=a.hiddenFileInput.files,c.length)for(e=0,f=c.length;e<f;e++)b=c[e],a.addFile(b);return d()})}}(this))(),this.URL=null!=(g=window.URL)?g:window.webkitURL,h=this.events,e=0,f=h.length;e<f;e++)a=h[e],this.on(a,this.options[a]);return this.on("uploadprogress",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(a){return function(){return a.updateTotalUploadProgress()}}(this)),this.on("canceled",function(a){return function(b){return a.emit("complete",b)}}(this)),this.on("complete",function(a){return function(b){if(0===a.getUploadingFiles().length&&0===a.getQueuedFiles().length)return setTimeout(function(){return a.emit("queuecomplete")},0)}}(this)),b=function(a){return a.stopPropagation(),a.preventDefault?a.preventDefault():a.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(a){return function(b){return a.emit("dragstart",b)}}(this),dragenter:function(a){return function(c){return b(c),a.emit("dragenter",c)}}(this),dragover:function(a){return function(c){var d;try{d=c.dataTransfer.effectAllowed}catch(e){}return c.dataTransfer.dropEffect="move"===d||"linkMove"===d?"move":"copy",b(c),a.emit("dragover",c)}}(this),dragleave:function(a){return function(b){return a.emit("dragleave",b)}}(this),drop:function(a){return function(c){return b(c),a.drop(c)}}(this),dragend:function(a){return function(b){return a.emit("dragend",b)}}(this)}}],this.clickableElements.forEach(function(a){return function(b){return a.listeners.push({element:b,events:{click:function(d){if(b!==a.element||d.target===a.element||c.elementInside(d.target,a.element.querySelector(".dz-message")))return a.hiddenFileInput.click()}}})}}(this)),this.enable(),this.options.init.call(this)},c.prototype.destroy=function(){var a;return this.disable(),this.removeAllFiles(!0),(null!=(a=this.hiddenFileInput)?a.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,c.instances.splice(c.instances.indexOf(this),1)},c.prototype.updateTotalUploadProgress=function(){var a,b,c,d,e,f,g,h;if(d=0,c=0,a=this.getActiveFiles(),a.length){for(h=this.getActiveFiles(),f=0,g=h.length;f<g;f++)b=h[f],d+=b.upload.bytesSent,c+=b.upload.total;e=100*d/c}else e=100;return this.emit("totaluploadprogress",e,c,d)},c.prototype._getParamName=function(a){return"function"==typeof this.options.paramName?this.options.paramName(a):""+this.options.paramName+(this.options.uploadMultiple?"["+a+"]":"")},c.prototype.getFallbackForm=function(){var a,b,d,e;return(a=this.getExistingFallback())?a:(d='<div class="dz-fallback">',this.options.dictFallbackText&&(d+="<p>"+this.options.dictFallbackText+"</p>"),d+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',b=c.createElement(d),"FORM"!==this.element.tagName?(e=c.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),e.appendChild(b)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=e?e:b)},c.prototype.getExistingFallback=function(){var a,b,c,d,e,f;for(b=function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)if(b=a[c],/(^| )fallback($| )/.test(b.className))return b},f=["div","form"],d=0,e=f.length;d<e;d++)if(c=f[d],a=b(this.element.getElementsByTagName(c)))return a},c.prototype.setupEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;d<e;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.addEventListener(b,c,!1));return e}());return g},c.prototype.removeEventListeners=function(){var a,b,c,d,e,f,g;for(f=this.listeners,g=[],d=0,e=f.length;d<e;d++)a=f[d],g.push(function(){var d,e;d=a.events,e=[];for(b in d)c=d[b],e.push(a.element.removeEventListener(b,c,!1));return e}());return g},c.prototype.disable=function(){var a,b,c,d,e;for(this.clickableElements.forEach(function(a){return a.classList.remove("dz-clickable")}),this.removeEventListeners(),d=this.files,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(this.cancelUpload(a));return e},c.prototype.enable=function(){return this.clickableElements.forEach(function(a){return a.classList.add("dz-clickable")}),this.setupEventListeners()},c.prototype.filesize=function(a){var b,c,d,e,f,g,h,i;for(g=["TB","GB","MB","KB","b"],d=e=null,c=h=0,i=g.length;h<i;c=++h)if(f=g[c],b=Math.pow(this.options.filesizeBase,4-c)/10,a>=b){d=a/Math.pow(this.options.filesizeBase,4-c),e=f;break}return d=Math.round(10*d)/10,"<strong>"+d+"</strong> "+e},c.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},c.prototype.drop=function(a){var b,c;a.dataTransfer&&(this.emit("drop",a),b=a.dataTransfer.files,b.length&&(c=a.dataTransfer.items,c&&c.length&&null!=c[0].webkitGetAsEntry?this._addFilesFromItems(c):this.handleFiles(b)))},c.prototype.paste=function(a){var b,c;if(null!=(null!=a&&null!=(c=a.clipboardData)?c.items:void 0))return this.emit("paste",a),b=a.clipboardData.items,b.length?this._addFilesFromItems(b):void 0},c.prototype.handleFiles=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;c<d;c++)b=a[c],e.push(this.addFile(b));return e},c.prototype._addFilesFromItems=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;d<e;d++)c=a[d],null!=c.webkitGetAsEntry&&(b=c.webkitGetAsEntry())?b.isFile?f.push(this.addFile(c.getAsFile())):b.isDirectory?f.push(this._addFilesFromDirectory(b,b.name)):f.push(void 0):null!=c.getAsFile&&(null==c.kind||"file"===c.kind)?f.push(this.addFile(c.getAsFile())):f.push(void 0);return f},c.prototype._addFilesFromDirectory=function(a,b){var c,d;return c=a.createReader(),d=function(a){return function(c){var d,e,f;for(e=0,f=c.length;e<f;e++)d=c[e],d.isFile?d.file(function(c){if(!a.options.ignoreHiddenFiles||"."!==c.name.substring(0,1))return c.fullPath=""+b+"/"+c.name,a.addFile(c)}):d.isDirectory&&a._addFilesFromDirectory(d,""+b+"/"+d.name)}}(this),c.readEntries(d,function(a){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(a):void 0})},c.prototype.accept=function(a,b){return a.size>1024*this.options.maxFilesize*1024?b(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(a.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):c.isValidFile(a,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(b(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",a)):this.options.accept.call(this,a,b):b(this.options.dictInvalidFileType)},c.prototype.addFile=function(a){return a.upload={progress:0,total:a.size,bytesSent:0},this.files.push(a),a.status=c.ADDED,
this.emit("addedfile",a),this._enqueueThumbnail(a),this.accept(a,function(b){return function(c){return c?(a.accepted=!1,b._errorProcessing([a],c)):(a.accepted=!0,b.options.autoQueue&&b.enqueueFile(a)),b._updateMaxFilesReachedClass()}}(this))},c.prototype.enqueueFiles=function(a){var b,c,d;for(c=0,d=a.length;c<d;c++)b=a[c],this.enqueueFile(b);return null},c.prototype.enqueueFile=function(a){if(a.status!==c.ADDED||a.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(a.status=c.QUEUED,this.options.autoProcessQueue)return setTimeout(function(a){return function(){return a.processQueue()}}(this),0)},c.prototype._thumbnailQueue=[],c.prototype._processingThumbnail=!1,c.prototype._enqueueThumbnail=function(a){if(this.options.createImageThumbnails&&a.type.match(/image.*/)&&a.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(a),setTimeout(function(a){return function(){return a._processThumbnailQueue()}}(this),0)},c.prototype._processThumbnailQueue=function(){if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(a){return function(){return a._processingThumbnail=!1,a._processThumbnailQueue()}}(this))},c.prototype.removeFile=function(a){if(a.status===c.UPLOADING&&this.cancelUpload(a),this.files=h(this.files,a),this.emit("removedfile",a),0===this.files.length)return this.emit("reset")},c.prototype.removeAllFiles=function(a){var b,d,e,f;for(null==a&&(a=!1),f=this.files.slice(),d=0,e=f.length;d<e;d++)b=f[d],(b.status!==c.UPLOADING||a)&&this.removeFile(b);return null},c.prototype.createThumbnail=function(a,b){var c;return c=new FileReader,c.onload=function(d){return function(){return"image/svg+xml"===a.type?(d.emit("thumbnail",a,c.result),void(null!=b&&b())):d.createThumbnailFromUrl(a,c.result,b)}}(this),c.readAsDataURL(a)},c.prototype.createThumbnailFromUrl=function(a,b,c){var d;return d=document.createElement("img"),d.onload=function(b){return function(){var e,g,h,i,j,k,l,m;if(a.width=d.width,a.height=d.height,h=b.options.resize.call(b,a),null==h.trgWidth&&(h.trgWidth=h.optWidth),null==h.trgHeight&&(h.trgHeight=h.optHeight),e=document.createElement("canvas"),g=e.getContext("2d"),e.width=h.trgWidth,e.height=h.trgHeight,f(g,d,null!=(j=h.srcX)?j:0,null!=(k=h.srcY)?k:0,h.srcWidth,h.srcHeight,null!=(l=h.trgX)?l:0,null!=(m=h.trgY)?m:0,h.trgWidth,h.trgHeight),i=e.toDataURL("image/png"),b.emit("thumbnail",a,i),null!=c)return c()}}(this),null!=c&&(d.onerror=c),d.src=b},c.prototype.processQueue=function(){var a,b,c,d;if(b=this.options.parallelUploads,c=this.getUploadingFiles().length,a=c,!(c>=b)&&(d=this.getQueuedFiles(),d.length>0)){if(this.options.uploadMultiple)return this.processFiles(d.slice(0,b-c));for(;a<b;){if(!d.length)return;this.processFile(d.shift()),a++}}},c.prototype.processFile=function(a){return this.processFiles([a])},c.prototype.processFiles=function(a){var b,d,e;for(d=0,e=a.length;d<e;d++)b=a[d],b.processing=!0,b.status=c.UPLOADING,this.emit("processing",b);return this.options.uploadMultiple&&this.emit("processingmultiple",a),this.uploadFiles(a)},c.prototype._getFilesWithXhr=function(a){var b,c;return c=function(){var c,d,e,f;for(e=this.files,f=[],c=0,d=e.length;c<d;c++)b=e[c],b.xhr===a&&f.push(b);return f}.call(this)},c.prototype.cancelUpload=function(a){var b,d,e,f,g,h,i;if(a.status===c.UPLOADING){for(d=this._getFilesWithXhr(a.xhr),e=0,g=d.length;e<g;e++)b=d[e],b.status=c.CANCELED;for(a.xhr.abort(),f=0,h=d.length;f<h;f++)b=d[f],this.emit("canceled",b);this.options.uploadMultiple&&this.emit("canceledmultiple",d)}else(i=a.status)!==c.ADDED&&i!==c.QUEUED||(a.status=c.CANCELED,this.emit("canceled",a),this.options.uploadMultiple&&this.emit("canceledmultiple",[a]));if(this.options.autoProcessQueue)return this.processQueue()},e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?i.call(arguments,1):[],"function"==typeof b?b.apply(this,a):b},c.prototype.uploadFile=function(a){return this.uploadFiles([a])},c.prototype.uploadFiles=function(a){var b,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;for(w=new XMLHttpRequest,x=0,B=a.length;x<B;x++)b=a[x],b.xhr=w;p=e(this.options.method,a),u=e(this.options.url,a),w.open(p,u,!0),w.withCredentials=!!this.options.withCredentials,s=null,g=function(c){return function(){var d,e,f;for(f=[],d=0,e=a.length;d<e;d++)b=a[d],f.push(c._errorProcessing(a,s||c.options.dictResponseError.replace("{{statusCode}}",w.status),w));return f}}(this),t=function(c){return function(d){var e,f,g,h,i,j,k,l,m;if(null!=d)for(f=100*d.loaded/d.total,g=0,j=a.length;g<j;g++)b=a[g],b.upload={progress:f,total:d.total,bytesSent:d.loaded};else{for(e=!0,f=100,h=0,k=a.length;h<k;h++)b=a[h],100===b.upload.progress&&b.upload.bytesSent===b.upload.total||(e=!1),b.upload.progress=f,b.upload.bytesSent=b.upload.total;if(e)return}for(m=[],i=0,l=a.length;i<l;i++)b=a[i],m.push(c.emit("uploadprogress",b,f,b.upload.bytesSent));return m}}(this),w.onload=function(b){return function(d){var e;if(a[0].status!==c.CANCELED&&4===w.readyState){if(s=w.responseText,w.getResponseHeader("content-type")&&~w.getResponseHeader("content-type").indexOf("application/json"))try{s=JSON.parse(s)}catch(f){d=f,s="Invalid JSON response from server."}return t(),200<=(e=w.status)&&e<300?b._finished(a,s,d):g()}}}(this),w.onerror=function(b){return function(){if(a[0].status!==c.CANCELED)return g()}}(this),r=null!=(G=w.upload)?G:w,r.onprogress=t,j={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&d(j,this.options.headers);for(h in j)i=j[h],w.setRequestHeader(h,i);if(f=new FormData,this.options.params){H=this.options.params;for(o in H)v=H[o],f.append(o,v)}for(y=0,C=a.length;y<C;y++)b=a[y],this.emit("sending",b,w,f);if(this.options.uploadMultiple&&this.emit("sendingmultiple",a,w,f),"FORM"===this.element.tagName)for(I=this.element.querySelectorAll("input, textarea, select, button"),z=0,D=I.length;z<D;z++)if(l=I[z],m=l.getAttribute("name"),n=l.getAttribute("type"),"SELECT"===l.tagName&&l.hasAttribute("multiple"))for(J=l.options,A=0,E=J.length;A<E;A++)q=J[A],q.selected&&f.append(m,q.value);else(!n||"checkbox"!==(K=n.toLowerCase())&&"radio"!==K||l.checked)&&f.append(m,l.value);for(k=F=0,L=a.length-1;0<=L?F<=L:F>=L;k=0<=L?++F:--F)f.append(this._getParamName(k),a[k],a[k].name);return w.send(f)},c.prototype._finished=function(a,b,d){var e,f,g;for(f=0,g=a.length;f<g;f++)e=a[f],e.status=c.SUCCESS,this.emit("success",e,b,d),this.emit("complete",e);if(this.options.uploadMultiple&&(this.emit("successmultiple",a,b,d),this.emit("completemultiple",a)),this.options.autoProcessQueue)return this.processQueue()},c.prototype._errorProcessing=function(a,b,d){var e,f,g;for(f=0,g=a.length;f<g;f++)e=a[f],e.status=c.ERROR,this.emit("error",e,b,d),this.emit("complete",e);if(this.options.uploadMultiple&&(this.emit("errormultiple",a,b,d),this.emit("completemultiple",a)),this.options.autoProcessQueue)return this.processQueue()},c}(b),a.version="4.0.1",a.options={},a.optionsForElement=function(b){return b.getAttribute("id")?a.options[c(b.getAttribute("id"))]:void 0},a.instances=[],a.forElement=function(a){if("string"==typeof a&&(a=document.querySelector(a)),null==(null!=a?a.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return a.dropzone},a.autoDiscover=!0,a.discover=function(){var b,c,d,e,f,g;for(document.querySelectorAll?d=document.querySelectorAll(".dropzone"):(d=[],b=function(a){var b,c,e,f;for(f=[],c=0,e=a.length;c<e;c++)b=a[c],/(^| )dropzone($| )/.test(b.className)?f.push(d.push(b)):f.push(void 0);return f},b(document.getElementsByTagName("div")),b(document.getElementsByTagName("form"))),g=[],e=0,f=d.length;e<f;e++)c=d[e],a.optionsForElement(c)!==!1?g.push(new a(c)):g.push(void 0);return g},a.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],a.isBrowserSupported=function(){var b,c,d,e,f;if(b=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(f=a.blacklistedBrowsers,d=0,e=f.length;d<e;d++)c=f[d],c.test(navigator.userAgent)&&(b=!1);else b=!1;else b=!1;return b},h=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;d<e;d++)c=a[d],c!==b&&f.push(c);return f},c=function(a){return a.replace(/[\-_](\w)/g,function(a){return a.charAt(1).toUpperCase()})},a.createElement=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.childNodes[0]},a.elementInside=function(a,b){if(a===b)return!0;for(;a=a.parentNode;)if(a===b)return!0;return!1},a.getElement=function(a,b){var c;if("string"==typeof a?c=document.querySelector(a):null!=a.nodeType&&(c=a),null==c)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector or a plain HTML element.");return c},a.getElements=function(a,b){var c,d,e,f,g,h,i,j;if(a instanceof Array){e=[];try{for(f=0,h=a.length;f<h;f++)d=a[f],e.push(this.getElement(d,b))}catch(k){c=k,e=null}}else if("string"==typeof a)for(e=[],j=document.querySelectorAll(a),g=0,i=j.length;g<i;g++)d=j[g],e.push(d);else null!=a.nodeType&&(e=[a]);if(null==e||!e.length)throw new Error("Invalid `"+b+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return e},a.confirm=function(a,b,c){return window.confirm(a)?b():null!=c?c():void 0},a.isValidFile=function(a,b){var c,d,e,f,g;if(!b)return!0;for(b=b.split(","),d=a.type,c=d.replace(/\/.*$/,""),f=0,g=b.length;f<g;f++)if(e=b[f],e=e.trim(),"."===e.charAt(0)){if(a.name.toLowerCase().indexOf(e.toLowerCase(),a.name.length-e.length)!==-1)return!0}else if(/\/\*$/.test(e)){if(c===e.replace(/\/.*$/,""))return!0}else if(d===e)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(b){return this.each(function(){return new a(this,b)})}),"undefined"!=typeof module&&null!==module?module.exports=a:window.Dropzone=a,a.ADDED="added",a.QUEUED="queued",a.ACCEPTED=a.QUEUED,a.UPLOADING="uploading",a.PROCESSING=a.UPLOADING,a.CANCELED="canceled",a.ERROR="error",a.SUCCESS="success",e=function(a){var b,c,d,e,f,g,h,i,j,k;for(h=a.naturalWidth,g=a.naturalHeight,c=document.createElement("canvas"),c.width=1,c.height=g,d=c.getContext("2d"),d.drawImage(a,0,0),e=d.getImageData(0,0,1,g).data,k=0,f=g,i=g;i>k;)b=e[4*(i-1)+3],0===b?f=i:k=i,i=f+k>>1;return j=i/g,0===j?1:j},f=function(a,b,c,d,f,g,h,i,j,k){var l;return l=e(b),a.drawImage(b,c,d,f,g,h,i,j,k/l)},d=function(a,b){var c,d,e,f,g,h,i,j,k;if(e=!1,k=!0,d=a.document,j=d.documentElement,c=d.addEventListener?"addEventListener":"attachEvent",i=d.addEventListener?"removeEventListener":"detachEvent",h=d.addEventListener?"":"on",f=function(c){if("readystatechange"!==c.type||"complete"===d.readyState)return("load"===c.type?a:d)[i](h+c.type,f,!1),!e&&(e=!0)?b.call(a,c.type||c):void 0},g=function(){var a;try{j.doScroll("left")}catch(b){return a=b,void setTimeout(g,50)}return f("poll")},"complete"!==d.readyState){if(d.createEventObject&&j.doScroll){try{k=!a.frameElement}catch(l){}k&&g()}return d[c](h+"DOMContentLoaded",f,!1),d[c](h+"readystatechange",f,!1),a[c](h+"load",f,!1)}},a._autoDiscoverFunction=function(){if(a.autoDiscover)return a.discover()},d(window,a._autoDiscoverFunction)}.call(this),define("dropzone",function(a){return function(){var b;return b||a.Dropzone}}(this)),define("text!general.components/context-menu/context-menu.ng.html",[],function(){return'<div class="qui-immidiateContextual qv-contextmenu" tid="context-menu" qva-outside="close($event)">\n\t<div class="content">\n\t\t<ul class="qui-textlist">\n\t\t\t<li ng-if="levels.length" class="qv-contextmenu-item-container back">\n\t\t\t\t<div class="qv-contextmenu-item" qva-activate="goBack();" tcl="context-menu-item">\n\t\t\t\t\t<i class="back-icon  lui-icon  lui-icon--triangle-left"></i>\n\t\t\t\t\t<span class="qui-textlist-text" q-translation="Common.Back" tid="context-menu-back"></span>\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t\t<li ng-repeat="item in currentItems" class="qv-contextmenu-item-container" ng-class="{ \'disabled\': item.disabled }" qva-activate="item.disabled || selectItem($event,item)">\n\t\t\t\t<div class="qv-contextmenu-item" ng-class="{ \'qv-contextmenu-has-submenu\': item.hasSubmenu(), \'has-icon\': item.hasIcon() }" tcl="context-menu-item">\n\t\t\t\t\t<i class="item-icon {{item.icon}}" ng-if="item.hasIcon()"></i>\n\t\t\t\t\t<span class="qui-textlist-text" title="{{item.getLabel()}}" tid="{{item.tid}}">{{item.getLabel()}}<span class="fader"></span></span>\n\t\t\t\t\t<i ng-show="item.hasSubmenu()" class="lui-icon  lui-icon--triangle-right"></i>\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n</div>\n'}),define("general.components/context-menu/context-menu",["jquery","general.utils/window-positioner","core.utils/resize","text!./context-menu.ng.html"],function(a,b,c,d){"use strict";function e(a,b,c,d){switch(b){case"BottomLeft":c-=a.outerWidth();break;case"Bottom":c-=a.outerWidth()/2;break;case"BottomRight":break;case"Left":c-=a.outerWidth(),d-=a.outerHeight()/2;break;case"Center":c-=a.outerWidth()/2,d-=a.outerHeight()/2;break;case"Right":d-=a.outerHeight()/2;break;case"Top":d-=a.outerHeight(),c-=a.outerWidth()/2;break;case"TopRight":default:d-=a.outerHeight()}return{left:c,top:d}}function f(b,c){var d=a(window),e=10,f=e,g=d.outerWidth()-b.outerWidth()-e,h=Math.max(f,Math.min(g,c.left)),i=e,j=d.outerHeight()-b.outerHeight()-e,k=Math.max(i,Math.min(j,c.top));return{left:h,top:k}}function g(a,b,c){var d=e(a,b,c.x,c.y);return d=f(a,d),a.offset(d),d}function h(a,b){return b=f(a,b),a.offset(b),b}function i(a,b){a.$$postDigest(function(){a.$$postDigest(b)})}var j={template:d,scope:{menu:"=",options:"="},controller:["$scope","$element","$timeout",function(d,e){function f(a){i(d,function(){d.options.alignTo?b.align(l(),d.options.alignTo,{collision:d.options.collision||"flip",position:d.options.docking||"top"}):(a=a||m,m=a?h(l(),a):g(l(),d.options.docking,d.options.position))})}function j(){if(d.levels.length){var a=d.levels.pop();d.currentItems=a.items,f(a.offset)}}function k(a){var b=a.items;d.levels.push({items:d.currentItems,offset:m}),d.currentItems=b,f()}function l(){return e.children().first()}var m=null;d.levels=[],d.currentItems=d.menu.items,d.goBack=function(){j()},d.selectItem=function(a,b){a.stopPropagation(),b.hasSubmenu()?k(b):(b.select(b.args),d.close())},d.close=function(){"function"==typeof d.menu.onClosing&&d.menu.onClosing.call(null),d.destroyComponent(),c.off("start",d.close)},c.on("start",d.close),e.find(".content").css("max-height",a(window).outerHeight()-40),f(),"function"==typeof d.menu.onOpen&&d.menu.onOpen.call(null)}]};return j}),define("general.components/context-menu/context-menu-service",["qvangular","general.components/context-menu/context-menu","general.services/show-service/show-service","translator"],function(a,b,c,d){"use strict";var e=function(a){var b=this;Object.keys(a||{}).forEach(function(c){b[c]=a[c]}),this.items=[]};e.prototype.addItem=function(a){var b=new e(a);return this.items.push(b),b},e.prototype.hasSubmenu=function(){return this.items.length>0},e.prototype.hasIcon=function(){return!!this.icon},e.prototype.getLabel=function(){function a(a){return Array.isArray(a)?d.get(a[0],a.slice(1).join(",")):d.get(a)}return"function"==typeof this.translation?a(this.translation()):this.translation?a(this.translation):"function"==typeof this.label?this.label():this.label?this.label:"Missing translation/label"},a.service("qvContextMenu",function(){var a,d={};return d.show=function(e,f){if(d.close(),0!==e.items.length){var g=f.component||b;return a=c.show(g,{menu:e,options:f})}},d.close=function(){a&&(a.destroy(),a=null)},d.menu=function(){var a=new e,b={addItem:function(b){return a.addItem(b)}};return Object.defineProperty(b,"items",{get:function(){return a.items}}),b},d})}),define("general.components/media-library/update/media-update",["jquery","qvangular","translator","text!general.components/media-library/update/media-update.ng.html","text!general.components/media-library/update/preview-item.ng.html","general.models/media-library","core.models/app","xsrfplugin","general.utils/dom-util","general.controllers/error-handler-controller","dropzone","core.utils/deferred","util","general.components/context-menu/context-menu-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a,b){b.getContentLibraries().then(function(b){var d=f.getRemainingSpace(b)/1024/1024;d=d.toString().split("e"),d=Math.floor(+(d[0]+"e"+(d[1]?+d[1]+1:1))),d=d.toString().split("e"),d=+(d[0]+"e"+(d[1]?+d[1]-1:-1)),a.quotaInfo=c.get("MediaLibrary.QuotaInfo",[d])})}function o(a,b,c){return g.get().then(function(d){var e={params:{externalpath:c,xrfkey:p},headers:{"X-Qlik-XrfKey":p}},f=m.basePath+"qrs/appcontent/"+d.id+"/deletecontent";return b.delete(f,e).success(function(){n(a,d)}).error(function(a,b){var c=b;0===b&&(c=500),j.showDialog({code:c})})})}var p=h.getRandomString(16);b.directive("qvMediaUpdate",function(){return{restrict:"E",replace:!0,scope:{updateExp:"=",selectedFile:"=",selectFile:"&",confirm:"&"},template:d,controller:["$scope","$element","$compile","$timeout","$http","$delayedModal","qvContextMenu",function(b,d,f,h,j,q,r){function s(c,d){var e=b.$new();e.file=d,f(a(c))(e)}function t(a,d,e,f){var g=new l,h=e.split("\\").splice(-1)[0];return b.updateExp.deleteDialogShown=!0,q.open({title:"MediaLibrary.Confirm.Delete.Title",content:c.get("MediaLibrary.Confirm.Delete.Description",[h]),buttons:[{name:"Common.Cancel",callback:function(){b.updateExp.deleteDialogShown=!1,g.reject()}},{name:"Common.Delete",defaultButton:!0,callback:function(){o(b,j,e).then(function(){b.selectedFile===f&&b.selectFile()(a,null,null),d&&u.removeFile(d),g.resolve()},function(){g.reject()}),b.updateExp.deleteDialogShown=!1}}]}),g.promise}var u;b.isEmpty=!0,b.previewCounter=0,k.autoDiscover=!1,k.confirm=function(a,b,c){if(null!=c)return c()},b.updateExp.deleteFile=function(a,b,c){for(var d=u.getFilesWithStatus(k.SUCCESS),e=null,f=0;f<d.length;f++)if(b===d[f].name){e=d[f];break}return t(a,e,b,c)},b.onCancelUpload=function(a,b){a.preventDefault(),a.stopPropagation(),u.cancelUpload(b)},b.onDelete=function(a,b,c,d){a.preventDefault(),a.stopPropagation(),t(a,b,c,d)},b.onInsert=function(a){a.preventDefault(),a.stopPropagation(),b.confirm()()},b.onSelectImage=function(c,d){return i.scrollElmentIntoView(a(d.previewElement),".media-library-preview-container",!1,!0),d.status!==k.SUCCESS?(c.preventDefault(),void c.stopPropagation()):void b.selectFile()(c,d.qUrl,d.qUrlDef)},b.onContextMenu=function(a,c,d,e){if(a.preventDefault(),a.stopPropagation(),c.status===k.SUCCESS){var f=r.menu();b.updateExp.isUploading||f.addItem({translation:"MediaLibrary.Insert",tid:"insert",select:function(){b.selectedFile!==c.qUrl&&b.selectFile()(a,c.qUrl,c.qUrlDef),b.onInsert(a)}}),f.addItem({translation:"Common.Delete",tid:"delete",select:function(){b.onDelete(a,c,d,e)}}),r.show(f,{position:{x:a.pageX,y:a.pageY},docking:"BottomRight"})}},g.get().then(function(d){var f=m.basePath+"qrs/appcontent/"+d.id+"/uploadfile?",g="/appcontent/"+d.id+"/";n(b,d),u=new k("#media-library-dropzone",{url:f,headers:{"X-Qlik-XrfKey":p},acceptedFiles:".png,.gif,.jpg,.jpeg",maxFilesize:5,parallelUploads:4,filesizeBase:1024,thumbnailWidth:200,thumbnailHeight:200,previewTemplate:e,previewsContainer:".media-library-preview-container",dictInvalidFileType:c.get("ErrorCode.3004"),dictFileTooBig:c.get("MediaLibrary.Error.MaxFileSizeExceeded"),dictResponseError:c.get("ErrorCode.500")}),u.on("processing",function(a){this.options.url=f+"externalpath="+encodeURIComponent(a.name)+"&overwrite=false&xrfkey="+p}),u.on("addedfile",function(c){s(c.previewElement,c),h(function(){b.isEmpty=!1,b.previewCounter++,b.updateExp.isUploading=!0,i.scrollElmentIntoView(a(c.previewElement),".media-library-preview-container",!1,!0);try{encodeURIComponent(c.name)}catch(d){c.qErrorMsg="MediaLibrary.Error.IllegalCharsInFilename",u.cancelUpload(c)}})}),u.on("removedfile",function(){h(function(){b.previewCounter--,0===b.previewCounter&&(b.isEmpty=!0)})}),u.on("success",function(a){a.qUrl=g+encodeURIComponent(a.name).replace(/[!'()*]/g,function(a){return"%"+a.charCodeAt(0).toString(16).toUpperCase()}),a.qUrlDef=g+a.name,n(b,d)}),u.on("queuecomplete",function(){h(function(){b.updateExp.isUploading=!1})}),u.on("error",function(b,d,e){var f=a(b.previewElement).scope();f.showError=!0,e&&e.status?409===e.status?f.errorMsg=c.get("MediaLibrary.Error.FileAlreadyExists"):413===e.status?f.errorMsg=c.get("MediaLibrary.Error.MaxFileSizeExceeded"):f.errorMsg=c.get("ErrorCode."+e.status):f.errorMsg=c.get(b.qErrorMsg?b.qErrorMsg:d)})}),b.$on("$destroy",function(){u.destroy(),b.updateExp.deleteDialogShown&&q.close()})}]}})}),define("text!general.services/loader/rain/rain-loader.ng.html",[],function(){return'<div class="rain rain-loader qv-block-ui" ng-class="{\'qv-fade-out\': fadeOut, \'qv-transparent-background\': transparentBackground}" tid="3e1f54">\n\t<div class="qv-animate progress-loader qv-loader-container" ng-class="ngClasses">\n\t\t<div class="one">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\n\t\t\t\t<g>\n\t\t\t\t\t<path class="path"\n\t\t\t\t\t\t  d="M105,205c-26.7,0-51.8-10.4-70.7-29.3C15.4,156.8,5,131.7,5,105s10.4-51.8,29.3-70.7C53.2,15.4,78.3,5,105,5 c55.1,0,100,44.9,100,100S160.1,205,105,205z M105,23.7c-44.8,0-81.3,36.5-81.3,81.3c0,44.8,36.5,81.3,81.3,81.3 c44.8,0,81.3-36.5,81.3-81.3C186.3,60.2,149.8,23.7,105,23.7z"/>\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="two">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\n\t\t\t\t<g>\n\t\t\t\t\t<path class="path"\n\t\t\t\t\t\t  d="M105,205C49.9,205,5,160.1,5,105C5,49.9,49.9,5,105,5c55.1,0,100,44.9,100,100C205,160.1,160.1,205,105,205z M105,19.4c-47.2,0-85.6,38.4-85.6,85.6c0,47.2,38.4,85.6,85.6,85.6c47.2,0,85.6-38.4,85.6-85.6C190.6,57.8,152.2,19.4,105,19.4z"/>\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="three">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\n\t\t\t\t<g>\n\t\t\t\t\t<path class="path"\n\t\t\t\t\t\t  d="M105,205c-26.7,0-51.8-10.4-70.7-29.3C15.4,156.8,5,131.7,5,105s10.4-51.8,29.3-70.7C53.2,15.4,78.3,5,105,5 c55.1,0,100,44.9,100,100S160.1,205,105,205z"/>\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="four">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\n\t\t\t\t<g>\n\t\t\t\t\t<path class="path"\n\t\t\t\t\t\t  d="M105,205C49.9,205,5,160.1,5,105C5,49.9,49.9,5,105,5c55.1,0,100,44.9,100,100C205,160.1,160.1,205,105,205z M105,19.4c-47.2,0-85.6,38.4-85.6,85.6c0,47.2,38.4,85.6,85.6,85.6c47.2,0,85.6-38.4,85.6-85.6C190.6,57.8,152.2,19.4,105,19.4z"/>\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="five">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\n\t\t\t\t<g>\n\t\t\t\t\t<path class="path"\n\t\t\t\t\t\t  d="M105 205C49.9 205 5 160.1 5 105C5 49.9 49.9 5 105 5c55.1 0 100 44.9 100 100C205 160.1 160.1 205 105 205z M105 10.5c-52.1 0-94.5 42.4-94.5 94.5c0 52.1 42.4 94.5 94.5 94.5c52.1 0 94.5-42.4 94.5-94.5C199.5 52.9 157.1 10.5 105 10.5z"/>\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="six">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\n\t\t\t\t<g>\n\t\t\t\t\t<path class="path"\n\t\t\t\t\t\t  d="M105,205c-26.7,0-51.8-10.4-70.7-29.3C15.4,156.8,5,131.7,5,105s10.4-51.8,29.3-70.7C53.2,15.4,78.3,5,105,5 c55.1,0,100,44.9,100,100S160.1,205,105,205z"/>\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="seven">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0px" y="0px" viewBox="0 0 210 210" xml:space="preserve" >\n\t\t\t\t<g>\n\t\t\t\t\t<path class="path"\n\t\t\t\t\t\t  d="M105,205C49.9,205,5,160.1,5,105C5,49.9,49.9,5,105,5c55.1,0,100,44.9,100,100C205,160.1,160.1,205,105,205z M105,19.4c-47.2,0-85.6,38.4-85.6,85.6c0,47.2,38.4,85.6,85.6,85.6c47.2,0,85.6-38.4,85.6-85.6C190.6,57.8,152.2,19.4,105,19.4z"/>\n\t\t\t\t</g>\n\t\t\t</svg>\n\t\t</div>\n\t</div>\n\t<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\n\t\t<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\n\t\t<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\n\t</div>\n</div>\n'}),define("general.services/loader/loader",["qvangular","text!general.services/loader/rain/rain-loader.ng.html","core.utils/deferred","angular"],function(a,b,c){var d=!1;a.service("qvLoader",["$compile","$rootScope","$document","$timeout",function(a,e,f,g){function h(){n.template=b,n.hugeLoader=!0,n.bigLoader=!1,n.mediumLoader=!1,n.normalLoader=!1,n.smallLoader=!1,n.tinyLoader=!1}function i(){for(var a in p)n[a]=null,delete n[a];h(),n.ngClasses["qv-fade-in"]=!1,j&&j.off().remove(),j=null,k=null,l&&(l.remove(),l=null)}var j,k,l,m,n=e.$new(),o=f.find("body"),p={};return h(),l=o.find("#qv-init-ui-blocker"),{show:function(b){d=!0;var c;n.fadeOut=!1,g.cancel(m),p=b||{};for(var e in b)n[e]=b[e];n.ngClasses={"qv-loader-huge":n.hugeLoader,"qv-loader-big":n.bigLoader,"qv-loader-medium":n.mediumLoader,"qv-loader-normal":n.normalLoader,"qv-loader-small":n.smallLoader,"qv-loader-tiny":n.tinyLoader,"qv-fade-in":!1},c=n.appendTo?n.appendTo:o,k=angular.element(n.template),j=a(k)(n).appendTo(c),n.appendTo=null,delete n.appendTo,m=g(function(){n.ngClasses["qv-fade-in"]=!0}),l&&l.length>0&&l.fadeOut(800,function(){l=null})},setMessageObj:function(a){n.messageObj.task=a},isOpen:function(){return d},close:function(a){var b=new c,e=750;return g.cancel(m),a?(n.fadeOut=!0,i(),d=!1,b.resolve()):g(function(){n.fadeOut=!0,m=g(function(){return i(),d=!1,b.resolve()},e+200)},e),b.promise}}}])}),define("general.components/media-library/media-library",["jquery","qvangular","require","core.models/app","general.models/media-library","general.utils/paths","text!./media-library.ng.html","text!./media-library-grid.ng.html","text!./media-library-list.ng.html","text!general.services/loader/default-loader.ng.html","general.services/show-service/show-service","general.utils/dom-util","general.views/bouncy-grid/bouncy-grid","general.components/media-library/update/media-update","general.components/context-menu/context-menu-service","general.services/loader/loader"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){var b={onCancel:a.onCancel,onConfirm:a.onConfirm,selectedFile:a.selectedFile,filter:["png","gif","jpg","jpeg"]};k.show(q,b),p.isShown=!0}function n(){if(p.isShown){var b=a('[qv-id="media-library-modal"]');b.length&&b.scope().cancel(null,!0)}}function o(){return p.isShown}var p={isShown:!1};b.directive("qveMediaList",function(){return{replace:!0,restrict:"E",template:i}}),b.directive("qveMediaGrid",function(){return{replace:!0,restrict:"E",template:h}});var q={template:g,controller:["$scope","$element","qvLoader","qvContextMenu",function(b,g,h,i){function k(a){clearTimeout(r),h.close(a)}function m(a,c){a=a||null,c=c||null,b.selectedFile=a,b.selectedFileDef=c}function n(){var a=b.view;d.get().then(function(c){c.getLibraryContent(b.view).then(function(c){var d=e.createTree(c,b.input.filter,!0);b.rootEntry=d,a===b.view&&(h.isOpen()?h.close().then(function(){b.state=d.children.length>0?u.hasFiles:u.isEmpty}):(clearTimeout(r),b.state=d.children.length>0?u.hasFiles:u.isEmpty))})})}function o(a){return a.split("/").slice(3).join("\\")}function q(a){n(),b.input.selectedFile&&a===b.input.selectedFile&&(t=!0)}var r,s=c.toUrl("img/medialibrary/thumb.png"),t=!1,u={notReady:0,isLoading:1,isEmpty:2,hasFiles:3};b.inZoom=!1,b.firstTimeRenderCheck=!0,b.lists=[],b.selectedFile=null,b.contentState=u,b.state=u.notReady,b.view=null,s=f.stripBasePath(s),s=f.addBasePath(s),b.staticSrc=s,b.updateExp={},b.getSrc=function(a){return a=f.stripBasePath(a),a=f.addBasePath(a)},b.zoomImage=function(a,c){a.preventDefault(),a.stopPropagation(),b.zoomSrc=c.path,b.inZoom=!0},b.closeZoom=function(){b.inZoom=!1,b.zoomSrc=null},b.goTo=function(a,c){var d;b.view!==a&&(m(null,null),k(!0),b.state=u.notReady,b.isUpload=c,b.view=a,b.isUpload||(r=setTimeout(function(){b.state=u.isLoading,h.show({template:j,messageObj:{task:"MediaLibrary.LoadingFiles"},appendTo:g.find(".medialib")[0],bigLoader:!0})},1e3),d=g.find(".q-images-cont"),d.length&&(d[0].scrollTop=0),n(),b.firstTimeRenderCheck=!0,d=null))},b.isSelectedImg=function(a,c,d){return c&&b.firstTimeRenderCheck&&d&&setTimeout(function(){var a=g.find(d);b.firstTimeRenderCheck=!1,a.length&&l.scrollElmentIntoView(a,".q-images-cont",!0),a=null},250),b.selectedFile===a.path},b.selectFile=function(c,d,e){var f=a(c.target).closest(".q-media-grid, .qui-menu-item");c.preventDefault(),c.stopPropagation(),l.scrollElmentIntoView(f,".q-images-cont",!1),b.selectedFile===d&&(d=null,e=null),f=null,m(d,e)},b.confirm=function(){b.selectedFile&&!b.updateExp.isUploading&&(b.input.onConfirm(b.selectedFile,b.selectedFileDef),b.destroyComponent())},b.inInAppView=function(){return b.view===b.lists[0].qName},b.canDeleteInView=function(){return b.inInAppView()&&b.canUpdate},b.onDelete=function(a){var c=b.selectedFile,d=o(b.selectedFileDef);a.preventDefault(),a.stopPropagation(),b.updateExp.deleteFile(a,d,b.selectedFile).then(function(){q(c)})},b.onContextMenu=function(c){c.preventDefault(),c.stopPropagation();var d=i.menu();b.updateExp.isUploading||d.addItem({translation:"MediaLibrary.Insert",tid:"insert",select:function(){var d=a(c.target).closest(".qui-menu-item").scope().entry;m(d.path,d.pathDef),b.confirm()}}),b.canDeleteInView()&&d.addItem({translation:"Common.Delete",tid:"delete",select:function(){var d=a(c.target).closest(".qui-menu-item").scope().entry,e=d.path,f=o(d.pathDef);b.updateExp.deleteFile(c,f,d.path).then(function(){q(e)})}}),i.show(d,{position:{x:c.pageX,y:c.pageY},docking:"BottomRight"})},b.cancel=function(a,c){if(a&&(a.preventDefault(),a.stopPropagation()),!c){if(b.inZoom)return void b.closeZoom();if(b.updateExp.deleteDialogShown)return void(b.updateExp.deleteDialogShown=!1)}!c&&b.updateExp.isUploading||(b.input.onCancel(t),b.destroyComponent())},d.get().then(function(a){a.getContentLibraries().then(function(a){b.lists=e.filterList(a),!b.view&&b.lists.length&&(b.view=b.lists[0].qName,n()),b.canUpdate=!b.$root.isPersonalMode&&!!e.canUpdate})}),b.$watch("updateExp.isUploading",function(a){a===!1&&b.inInAppView()&&n()}),b.$on("$destroy",function(){p.isShown=!1,b.closeZoom(),k(!0)})}]};return{show:m,hide:n,isShown:o}}),define("general.services/media-library/media-library",["general.components/media-library/media-library"],function(a){function b(b){a.show(b)}function c(){a.hide()}function d(){return a.isShown()}return{show:b,hide:c,isShown:d}}),define("text!client.services/media-tool/media-tool-buttons.ng.html",[],function(){return'<div>\n\t<div ng-if="textTool.showUsage" class="usage"><span q-translation="MediaTool.YouHaveUsed"></span> <span>{{textTool.usage}}%</span></div>\n\n\t<div class="lui-buttongroup" ng-show="buttons.color">\n\t\t<div id="qv-toolbar-colorpicker" tid="colorpicker" q-title-translation="MediaTool.Toolbar.FontColor">\n\t\t\t<div qv-color-picker-button x-variant="inverse" on-close="closecolorpickerfoldout" ng-model="color" ng-disabled="!haveSelection()"></div>\n\t\t</div>\n\t</div><div class="lui-buttongroup" ng-show="buttons.fontSize">\n\t\t<button id="qv-toolbar-fontsize" qva-activate="setActiveFoldout(\'fontSizes\',$event)" tid="fontSize" ng-disabled="!haveSelection()"\n\t\t\t\tng-class="{\'active\':foldouts.fontSizes}" q-title-translation="MediaTool.Toolbar.FontSize" class="lui-fade-button lui-fade-button--inverse">\n\t\t\t<span class="lui_button__text">{{shortFontSize(textTool.fontSize)}}</span><span class="lui-button__caret  lui-caret"></span>\n\t\t</button>\n\t\t<immidiate-contextual class="qv-toolbar-fontsize-foldout" ng-if="foldouts.fontSizes" width="48" align-to="\'#qv-toolbar-fontsize\'" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFontsizeFoldout(event)">\n\t\t\t<ul class="qui-icontextlist qv-media-tool-fontsize">\n\t\t\t\t<li ng-repeat="size in fontSizes" qva-activate="setFontSize($event, size)" ng-class="{\'active\':textTool.fontSize == size}"><span class="qui-textlist-text">{{shortFontSize(size)}}</span></li>\n\t\t\t</ul>\n\t\t</immidiate-contextual>\n\t</div><div class="lui-buttongroup" ng-show="buttonGroup1">\n\t\t<div ng-class="{\'lui-active\':textTool.states.bold}" ng-show="buttons.bold" tid="bold" ng-disabled="!haveSelection()"\n\t\t\t q-title-translation="MediaTool.Toolbar.Bold" class="lui-fade-button lui-fade-button--inverse" qva-press="exec($event,\'bold\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--bold"></span>\n\t\t</div>\n\t\t<div ng-class="{\'lui-active\':textTool.states.italic}"  ng-show="buttons.italic" tid="italic" ng-disabled="!haveSelection()"\n\t\t\t q-title-translation="MediaTool.Toolbar.Italic" class="lui-fade-button lui-fade-button--inverse" qva-press="exec($event,\'italic\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--italic"></span>\n\t\t</div>\n\t\t<div ng-class="{\'lui-active\':textTool.states.underline}"  ng-show="buttons.underline" tid="underline" ng-disabled="!haveSelection()"\n\t\t\t q-title-translation="MediaTool.Toolbar.Underline" class="lui-fade-button lui-fade-button--inverse" qva-press="exec($event,\'underline\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--underline"></span>\n\t\t</div>\n\t</div><div class="lui-buttongroup" ng-show="buttonGroup2">\n\t\t<button ng-class="{\'lui-active\':textTool.states.justifyLeft}" ng-show="buttons.justifyLeft" tid="justifyLeft"\n\t\t\t\tclass="lui-fade-button lui-fade-button--inverse" q-title-translation="Common.Text.AlignLeft" qva-activate="exec($event,\'justifyLeft\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--align-left"></span>\n\t\t</button>\n\t\t<button ng-class="{\'lui-active\':textTool.states.justifyCenter}" ng-show="buttons.justifyCenter" tid="justifyCenter"\n\t\t\t\tclass="lui-fade-button lui-fade-button--inverse" q-title-translation="Common.Text.AlignCenter" qva-activate="exec($event,\'justifyCenter\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--align-center"></span>\n\t\t</button>\n\t\t<button ng-class="{\'lui-active\':textTool.states.justifyRight}" ng-show="buttons.justifyRight" tid="justifyRight"\n\t\t\t\tclass="lui-fade-button lui-fade-button--inverse" q-title-translation="Common.Text.AlignRight" qva-activate="exec($event,\'justifyRight\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--align-right"></span>\n\t\t</button>\n\t</div><div class="lui-buttongroup" ng-show="buttons.link">\n\t\t<button id="qv-toolbar-link" qva-activate="openLinkFoldout($event)" tid="link"\n\t\t\t\tclass="lui-fade-button lui-fade-button--inverse" q-title-translation="{{ textTool.states.link ? \'MediaTool.Toolbar.EditURLLink\' : \'MediaTool.Toolbar.CreateURLLink\' }}"\n\t\t\t\tng-disabled="linkDisabled()">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--link" ng-class="{\'lui-active\':textTool.states.link}"></span><span class="lui-button__caret  lui-caret"></span>\n\t\t</button>\n\t</div><div class="lui-buttongroup" ng-show="buttons.image">\n\t\t<button id="qv-toolbar-image" qva-activate="openMediaLibrary($event)" ng-class="{\'lui-active\':foldouts.mediaLibrary}" tid="image"\n\t\t\t\tclass="lui-fade-button lui-fade-button--inverse" q-title-translation="MediaTool.Toolbar.InsertImage">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--image"></span>\n\t\t</button>\n\t</div>\n</div>\n';
}),define("client.services/media-tool/media-tool-buttons",["qvangular","text!./media-tool-buttons.ng.html"],function(a,b){a.directive("qvMediaToolButtons",function(){return{restrict:"A",replace:!0,template:b}})}),define("client.services/media-tool/toolbar",["jquery","touche","text!./toolbar.ng.html","client.services/media-tool/theme","client.services/media-tool/text-selection","client.services/media-tool/link-foldout/link-foldout","general.services/media-library/media-library","general.services/show-service/show-service","client.services/media-tool/media-tool-buttons"],function(a,b,c,d,e,f,g,h){var i=d.palette,j=d.fontSizes,k={fontSizes:!1,link:!1,mediaLibrary:!1,colorpicker:!1},l={color:!0,fontSize:!0,bold:!0,italic:!0,underline:!0,justifyLeft:!0,justifyCenter:!0,justifyRight:!0,link:!0,image:!0},m={template:c,scope:{textTool:"=",options:"=",alignTo:"="},controller:["$scope","$timeout",function(c,m){c.palette=i,c.fontSizes=Object.keys(j),c.foldouts=k,"all"===c.options.buttons?(c.buttons=l,c.buttonGroup1=!0,c.buttonGroup2=!0):"object"==typeof c.options.buttons&&(c.buttons=c.options.buttons,c.buttonGroup1=c.buttons.bold||c.buttons.italic||c.buttons.underline,c.buttonGroup2=c.buttons.justifyLeft||c.buttons.justifyCenter||c.buttons.justifyRight),c.exec=function(a,d){a.preventDefault(),a.stopPropagation(),b.preventGestures(),0===d.indexOf("justify")?c.textTool.setJustify(d):c.haveSelection()&&c.textTool.setBIU(d)},c.setActiveFoldout=function(a){Object.keys(c.foldouts).forEach(function(b){b===a&&c.foldouts[b]?c.foldouts[b]=!1:c.foldouts[b]=b===a})},c.shortFontSize=function(a){return j[a]||a},c.openMediaLibrary=function(){c.textTool.saveRange(),c.setActiveFoldout("mediaLibrary"),g.show({onCancel:function(){c.setActiveFoldout(),c.textTool.restoreRange(),c.textTool.focus()},onConfirm:function(a,b){c.setActiveFoldout(),m(function(){b?c.textTool.insertImage(a,b):(c.textTool.restoreRange(),c.textTool.focus())},100)},selectedFile:null})},c.closeColorpickerFoldout=function(d){a(d.target).closest("#qv-toolbar-colorpicker").length&&b.preventGestures(),c.setActiveFoldout()},c.closeFontsizeFoldout=function(d){a(d.target).closest("#qv-toolbar-fontsize").length&&b.preventGestures(),c.setActiveFoldout()};var n=null;c.openLinkFoldout=function(){var b,d=c.textTool.currentRange,g={};d&&(b=a(d.commonAncestorContainer).closest("a"),b.length&&(g.url=b.attr("href"),g.bookmark=b.attr("data-bookmark-id"),g.$node=b),c.textTool.saveRange(),n=h.show(f,{options:{toolbarScope:c,alignTo:a("#qv-toolbar-link"),link:g,onSave:function(a,b,d,e){var f;d?(f=document.createRange(),f.setStartBefore(d[0]),f.setEndAfter(d[0]),c.textTool.insertLink(b,f,e)):m(function(){c.textTool.insertLink(b,null,e)}),c.closeLinkFoldout(a)},onCancel:function(a){c.closeLinkFoldout(a)},onRemove:function(a,b){if(b){var d=e.createRangeForElement(b[0]);c.textTool.removeLink(d)}c.closeLinkFoldout(a)}}}),c.setActiveFoldout("link"))},c.setFontSize=function(a,b){a.preventDefault(),c.setActiveFoldout(),c.textTool.setFontSize(b)},c.closeLinkFoldout=function(d){d&&a(d.target).closest("#qv-toolbar-link").length&&b.preventGestures(),c.setActiveFoldout(),n&&(n.destroy(),n=null)},c.linkDisabled=function(){var a=c.textTool.currentRange,b=!!c.textTool.states.link;return!b&&(!a||a.collapsed)},c.haveSelection=function(){var a=c.textTool.currentRange;return!(!a||a.collapsed)},Object.defineProperty(c,"color",{get:function(){var a=10;return c.haveSelection()?d.palette.indexOf(c.textTool.color):d.palette[a]},set:function(a){c.textTool.setColor(d.palette[a])}}),c.$on("$destroy",function(){c.setActiveFoldout(),n&&(n.destroy(),n=null)}),m(function(){c.textTool.refreshState()})}]};return m}),define("client.services/media-tool/command-queue",[],function(){var a=function(){this.queue=[]};return a.prototype.push=function(a){this.queue.push(a)},a.prototype.execAll=function(a){this.queue.forEach(a)},a.prototype.remove=function(a){var b,c,d=!1;for(b=this.queue.length-1;b>=0;b--)c=this.queue[b],c.cmd===a&&(d=!0,this.queue.splice(b,1));return d},a.prototype.clear=function(){this.queue=[]},a}),define("client.services/media-tool/feature-detection",["angular","client.services/media-tool/text-selection"],function(a,b){function c(a,c){var e=document.activeElement;return document.body.appendChild(d),d.innerHTML="Feature detection.",d.focus(),b.addRange(b.createRange(d),!0),document.execCommand(a,!1,c),document.activeElement=e,document.body.removeChild(d),d.innerHTML}var d=a.element("<div contenteditable style='position:absolute;top: -999999px;'>")[0],e=c("justifyCenter").indexOf(" align=")>-1;return{usesAlign:e}}),define("client.services/media-tool/markdown-html-parser",["util"],function(a){function b(){var b=g.formatters.map(function(b){return b.character?a.escapeRegExp(b.character):""}),c="("+b.join("|")+"){1}\\[",d="\\]\\(([^\\\\)]*(?:\\\\.[^\\\\)]*)*)\\)",e="((?![\\s\\S]*?"+c+"[\\s\\S]*?)[\\s\\S]*?)";g.markdownRegex=new RegExp(c+e+d,"mg")}function c(a,b,d){for(var e=a.exec(b),f=[];e&&!(f.indexOf(e.index)>-1);)f.push(e.index),b=d(b,e),e=a.exec(b);return f.length?c(a,b,d):b}function d(a){return a.split("").reverse().join("")}function e(){var a=g.formatters.filter(function(a){return!!a.toHTML});return a.sort(function(a,b){var c=a.toHTML.priority||0,d=b.toHTML.priority||0;return d-c}),a}function f(){var a=g.formatters.filter(function(a){return!!a.toMarkdown});return a.sort(function(a,b){var c=a.toMarkdown.priority||0,d=b.toMarkdown.priority||0;return d-c}),a}var g={};return g.register=function(a){g.formatters.push(a),b()},g.toHTML=function(a,b){var f=b||e(),h=!1;return a=a.replace(/\$\&amp;/g,"&#36;&amp;"),a=c(g.markdownRegex,a,function(a,b){return a.replace(b[0],function(){return g.getFormatter(b[1]).toHTML.callback(b[2],b[4])})}),f.forEach(function(b){b.toHTML&&b.toHTML.regex&&(b.toHTML.reverse&&(a=d(a)),a=c(b.toHTML.regex,a,function(a,c){var d=c.splice(0,1)[0];return h=!0,a.replace(d,b.toHTML.callback.apply(b.toHTML.callback,c))}),b.toHTML.reverse&&(a=d(a)))}),h?g.toHTML(a,b):a},g.toMarkdown=function(a,b){var c=b||f(),d=new Option;return d.innerHTML=a,c.forEach(function(a){a.toMarkdown.tags.forEach(function(b){var c=Array.prototype.slice.call(d.getElementsByTagName(b.name)).reverse();c.forEach(function(c){var d=!b.attr.length||b.attr.some(function(a){return c.hasAttribute(a)}),e=b.dontMatchAttr&&b.dontMatchAttr.some(function(a){return c.hasAttribute(a)});if("img"===b.name&&c.hasAttribute("src")&&!c.hasAttribute("data\\-measure")){var f=c.getAttribute("src");c.setAttribute("src",f.replace(/\\/g,""))}var g;if(g=a.toMarkdown.regex?d&&!e&&a.toMarkdown.regex.exec(c.outerHTML.trim()):[c.outerHTML.trim()],!e&&d&&g){var h=document.createElement("span");h.innerHTML=a.toMarkdown.callback.apply(c,g.slice(1)),c.parentNode.replaceChild(h,c)}})})}),d.innerHTML.replace(/<(\/)?span>/g,"")},g.getFormatter=function(a){var b,c=g.formatters;for(b=0;b<c.length;b++)if(c[b].character===a)return c[b];return null},g.escapeMarkdown=function(a){return a.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\~/g,"\\~").replace(/\-/g,"\\-")},g.unescapeMarkdown=function(a){return a.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\~/g,"~").replace(/\\\-/g,"-")},g.reset=function(){g.formatters=[],g.markdownRegex=null},g.reset(),g}),define("client.services/media-tool/formatters/font-color",["sirtrevor","client.utils/theme/theme","client.services/media-tool/theme","client.services/media-tool/markdown-html-parser"],function(a,b,c,d){var e=b.palette;return d.register({name:"font-color",character:"#",toHTML:{callback:function(a,b){return'<font color="'+e[b]+'">'+a+"</font>"}},toMarkdown:{priority:2,regex:/^<font(?: size="([0-7]|undefined)")? color="(#[a-f0-9]{3,6})"(?: size="([0-7]|undefined)")?.*?>([\s\S]+)<\/font>$/,callback:function(a,b,d,f){if(""===f)return"";var g=a||d;return null!==g&&void 0!==g&&(g=c.htmlSizeToMarkdownSize[g],f="%["+f+"]("+g+")"),e.indexOf(b)===-1?f:"#["+f+"]("+e.indexOf(b)+")"},tags:[{name:"font",attr:["color"]}]}}),a.Formatter.extend({title:"color",cmd:"foreColor",text:"color",onClick:function(a){document.execCommand(a.cmd,!1,a.param)}})}),define("client.services/media-tool/formatters/font-size",["sirtrevor","client.services/media-tool/theme","client.services/media-tool/markdown-html-parser"],function(a,b,c){return c.register({name:"font-size",character:"%",toHTML:{callback:function(a,c){return"<font size='"+b.markdownSizeToHtmlSize[c]+"'>"+a+"</font>"}},toMarkdown:{regex:/^<font size="([0-7])".*?>([\s\S]+)<\/font>$/,callback:function(a,c){return""===c?"":(a>7&&(a=b.fontSizesPx[a]),null!==a&&void 0!==a?(a=b.htmlSizeToMarkdownSize[a],"%["+c+"]("+a+")"):c)},tags:[{name:"font",attr:["size"]}]}}),a.Formatter.extend({title:"fontsize",cmd:"fontSize",text:"fontsize"})}),define("client.services/media-tool/formatters/justify",["sirtrevor","qvangular","encoder","client.services/media-tool/markdown-html-parser","client.services/media-tool/feature-detection","client.utils/rtl/rtl-util"],function(a,b,c,d,e,f){var g=e.usesAlign;d.register({name:"justify",character:"^",toHTML:{callback:function(a,b){var d=f.supportDirAuto()?"auto":f.detectTextDirection(a.replace(/<\/?[^>]+(>|$)/g,""));return a||(a="&nbsp;"),g?"<div dir="+d+' align="'+c.encodeForAttr2(b)+'">'+a+"</div>":"<div dir="+d+' style="text-align: '+c.encodeForAttr2(b)+';">'+a+"</div>"}},toMarkdown:{regex:/^<(?:div|p).*?(?:style="text(?:\\)?-)?align(?:="|: )(left|center|right|justified|inherit)(?:"|;).*?>([\s\S]+)<\/(?:div|p)>$/,callback:function(a,b){return"^["+b+"]("+a+")"},tags:[{name:"div",attr:["align","style"]},{name:"p",attr:["align"]}]}});var h=a.Formatter.extend({title:"align left",cmd:"justifyLeft",text:"left",isActive:function(a){var b=a.getParentParagraph(),c=window.getComputedStyle(b);return!!/left/.test(c.textAlign)||!(!c||"ltr"!==c.direction||/right/.test(c.textAlign)||/center/.test(c.textAlign))},onClick:function(){var a=b.getService("qvMediaTool").getParagraph().el.style,c=a.direction;"ltr"!==c&&c||(c="ltr",a.direction="rtl"),document.execCommand("justifyLeft",!1),"ltr"===c&&(a.direction="ltr")}}),i=a.Formatter.extend({title:"align center",cmd:"justifyCenter",text:"center",onClick:function(){document.execCommand("justifyCenter",!1)}}),j=a.Formatter.extend({title:"align right",cmd:"justifyRight",text:"right",isActive:function(a){var b=a.getParentParagraph(),c=window.getComputedStyle(b);return!!/right/.test(c.textAlign)||!(!c||"rtl"!==c.direction||/left/.test(c.textAlign)||/center/.test(c.textAlign))},toMarkdown:function(a){return d.toMarkdown(a)},toHTML:function(a){return d.toHTML(a)},onClick:function(){var a=b.getService("qvMediaTool").getParagraph().el.style,c=a.direction;"rtl"===c&&(a.direction="ltr"),document.execCommand("justifyRight",!1),"rtl"===c&&(a.direction="rtl")}});return{Left:h,Right:j,Center:i}}),define("client.services/media-tool/formatters/bold",["sirtrevor","client.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"bold",character:"**",toHTML:{priority:5,regex:/\*\*(?!\\)([\s\S]+?(?!\*\\))\*\*/g,callback:function(a){return">b/<"+a+">b<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:b|strong)>([\s\S]+)<\/(?:b|strong)>$/,callback:function(a){return""===a?"":"**"+a+"**"},tags:[{name:"b",attr:[]},{name:"strong",attr:[]}]}}),a.Formatter.extend({title:"bold",cmd:"bold",text:"B",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag(["b","strong"])||a.hasEndAncestorTag(["b","strong"]):a.hasStartAncestorTag(["b","strong"])&&a.hasEndAncestorTag(["b","strong"])},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("client.services/media-tool/formatters/italic",["sirtrevor","client.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"italic",character:"_",toHTML:{priority:5,regex:/\_(?!\\)([\s\S]+?(?!\_\\))\_/g,callback:function(a){return">i/<"+a+">i<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:i|em)>([\s\S]+)<\/(?:i|em)>$/,callback:function(a){return""===a?"":"_"+a+"_"},tags:[{name:"i",attr:[]},{name:"em",attr:[]}]}}),a.Formatter.extend({title:"italic",cmd:"italic",text:"I",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag(["i","em"])||a.hasEndAncestorTag(["i","em"]):a.hasStartAncestorTag(["i","em"])&&a.hasEndAncestorTag(["i","em"])},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("client.services/media-tool/formatters/underline",["sirtrevor","client.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"underline",character:"~",toHTML:{priority:5,regex:/~(?!\\)([\s\S]+?(?!~\\))~/g,callback:function(a){return">u/<"+a+">u<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<u>([\s\S]+)<\/u>$/,callback:function(a){return""===a?"":"~"+a+"~"},tags:[{name:"u",attr:[]}]}}),a.Formatter.extend({title:"underline",cmd:"underline",text:"U",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("u")||a.hasEndAncestorTag("u"):a.hasStartAncestorTag("u")&&a.hasEndAncestorTag("u")},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("client.services/media-tool/formatters/bookmark",["jquery","qvangular","sirtrevor","encoder","client.services/media-tool/markdown-html-parser"],function(a,b,c,d,e){function f(c,d){var e=b.getService("qvMediaTool"),f=e.getRange().commonAncestorContainer,g=a(f).find("a[href="+d+"]");return"#text"===f.nodeName&&(g="A"!==c.nodeName?a(c).find("a[href="+d+"]"):a(c)),0===g.length&&(g=a(f).find("a:not([href])")),g}return e.register({name:"bookmark",character:"$",toHTML:{callback:function(a,b){return'<a href="#" class="bookmark-link" data-bookmark-id="'+d.encodeForAttr2(b)+'">'+a+"</a>"}},toMarkdown:{regex:/^<a (?=.*data\\-bookmark\\-id="([^"]+)").*?>([\s\S]+?)<\/a>$/,callback:function(a,b){return"$["+b+"]("+a+")"},tags:[{name:"a",attr:["data\\-bookmark\\-id"]}]}}),c.Formatter.extend({title:"bookmark",cmd:"createLink",text:"Bookmark",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("a")||a.hasEndAncestorTag("a"):a.hasStartAncestorTag("a")&&a.hasEndAncestorTag("a")},onClick:function(b){var c=b.url;a(document).on("DOMNodeInserted.bookmark",function(b){var d=f(b.target,c);a.each(d,function(b,d){a(d).hasClass("bookmark-link")||setTimeout(function(){d.setAttribute("href","#"),d.removeAttribute("_moz_dirty"),d.className+="bookmark-link",d.setAttribute("data-bookmark-id",c)})}),setTimeout(function(){a(document).off("DOMNodeInserted.bookmark")},250)}),document.execCommand(this.cmd,!1,c)}})}),define("client.services/media-tool/formatters/link",["sirtrevor","client.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"link",character:"@",toHTML:{callback:function(a,b){0===b.indexOf("javascript:")&&(b=""),0!==b.search("[a-zA-Z0-9]+:")&&(b="http://"+b),b=b.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24");var c="<a href='"+decodeURI(b)+"' target='\\_blank' title='"+decodeURI(b)+"'>"+a+"</a>";return c}},toMarkdown:{regex:/^<a.*?href="(?!#)([^"]+)".*?>([\s\S]+?)<\/a>$/,callback:function(a,b){return"@["+b+"]("+a+")"},tags:[{name:"a",attr:["href"]}]}}),a.Formatter.extend({title:"link",cmd:"createLink",text:"Link",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("a")||a.hasEndAncestorTag("a"):a.hasStartAncestorTag("a")&&a.hasEndAncestorTag("a")},onClick:function(a){var b=a.url;document.execCommand(this.cmd,!1,b)}})}),define("client.services/media-tool/formatters/unlink",["sirtrevor"],function(a){return a.Formatter.extend({title:"unlink",cmd:"unlink",text:"Unlink",onClick:function(a){var b=a.url;document.execCommand(this.cmd,!1,b)}})}),define("client.services/media-tool/formatters/measure",["qvangular","sirtrevor","util","translator","lz-string","general.utils/array-util","objects.views/charts/utils/canvas-renderer","client.services/media-tool/markdown-html-parser","general.utils/string-limits"],function(a,b,c,d,e,f,g,h,i){function j(a,b){var c,d=a.qHyperCube.qMeasureInfo;for(c=0;c<d.length;++c)if(d[c].cId===b)return d[c];return null}function k(a,b){var c,d,e=a.qHyperCube.qMeasureInfo;for(c=0;c<e.length;++c)if(e[c].cId===b)return d=a.qHyperCube.qGrandTotalRow[c],!d||!d.qText||"NaN"===d.qNum&&"-"===d.qText?"":h.escapeMarkdown(d.qText);return""}function l(a){var b,c=30,d=g.getDevicePixelToBackingStoreRatio(),e=150,f=.35,h="13px 'QlikView Sans'",i=m.getContext("2d"),j=g.measureTextObject({shape:{text:a,width:112,font:h}});b=Math.ceil(Math.min(j.width+50,e)),m.height=c*d,m.width=b*d,m.style.height=c+"px",m.style.width=b+"px",i.clearRect(0,0,m.width,m.height),i.save(),i.scale(d,d),i.font="15px 'LUI icons'",i.globalAlpha=f,i.fillText("3",2,c/2+8),i.globalAlpha=1,i.font="13px 'QlikView Sans'",i.fillText(j.lines[0],32,c/2+5),i.restore();var k=m.toDataURL("image/png"),l=document.createElement("img");return l.setAttribute("src",k),l.setAttribute("class","tokenized-measure"),l.setAttribute("width",b+"px"),l.setAttribute("height",c+"px"),l}var m=document.createElement("canvas");return h.register({name:"measure",character:"=",toHTML:{callback:function(b,c){var f,g,h=a.getService("qvMediaTool");if(h.isActive()){var m=h.getOptions();if(!m.useMeasures)return"";var n,o=m.propertyHandler.getMeasure(c),p=!1;if(o){var q=j(m.layout,c);!q||q.qError?(p=!0,n=d.get("Object.ErrorMessage.MissingMeasure")):n=q.qFallbackTitle||""}else n=m.copiedMeasures[c];var r=JSON.stringify(o);g=l(n),g.setAttribute("data-measure-id",c),g.setAttribute("data-measure-name",e.compressToBase64(n)),g.setAttribute("data-measure",e.compressToBase64(r)),g.setAttribute("data-tid","ti-measure"),p&&g.classList.add("invalid-measure")}else{f=h.getCurrentLayout();var s=k(f,c);if(null===s)return"";s.length>i.textImage&&(s=s.substr(0,i.textImage-1)+""),g=document.createElement("span"),g.setAttribute("data-tid","ti-measure"),g.appendChild(document.createTextNode(s))}return g.outerHTML}},toMarkdown:{callback:function(){var b="",d=this.getAttribute("data\\-measure\\-id"),g=a.getService("qvMediaTool").getOptions();if(!j(g.layout,d)&&!g.copiedMeasures[d]){var h=e.decompressFromBase64(this.getAttribute("data\\-measure")),i=JSON.parse(h);d=c.generateId(),i.qDef.cId=d;var k=g.properties;k.qHyperCubeDef.qMeasures.push(i),f.indexAdded(k.qHyperCubeDef.qInterColumnSortOrder,k.qHyperCubeDef.qDimensions.length+k.qHyperCubeDef.qMeasures.length-1);var l=e.decompressFromBase64(this.getAttribute("data\\-measure\\-name"));g.copiedMeasures[d]=l}return"=["+b+"]("+d+")"},tags:[{name:"img",attr:["data\\-measure\\-id"]}]}}),b.Formatter.extend({title:"measure",cmd:"",text:"measure",toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("client.services/media-tool/formatters/image",["qvangular","sirtrevor","client.services/media-tool/markdown-html-parser","general.utils/paths"],function(a,b,c,d){function e(a,b,c){for(var d=c?"qStaticContentUrl":"qStaticContentUrlDef",e=0;e<b.length;e++)if(b[e].id===a)return b[e].url[d].qUrl;return""}function f(a){return a.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24")}return c.register({name:"image",character:"!",toHTML:{callback:function(b,g){var h=a.getService("qvMediaTool");if(h.useImageArray()){var i,j=g;i=h.isActive()?h.getOptions().layout:h.getCurrentLayout(),g=e(b,i.images,!0),g=g?c.escapeMarkdown(g):j}return g=d.stripBasePath(g),g=f(g),g=d.getUrl(g),b||(b="image"),b=f(b),"<img src='"+g+"' data-image-id='"+b+"'>"}},toMarkdown:{priority:1,regex:/^<img.*?src="([^"]+)".*?>$/,callback:function(a){var b=this.getAttribute("data\\-image\\-id")||"";return b||(b=""),a=c.unescapeMarkdown(a),a=d.stripBasePath(a),a=c.escapeMarkdown(a),"!["+b+"]("+a+")"},tags:[{name:"img",attr:["src"],dontMatchAttr:["data\\-measure\\-id"]}]}}),b.Formatter.extend({title:"image",cmd:"insertImage",text:"image",onClick:function(a){document.execCommand(a.cmd,!1,a.param)}})}),define("client.services/media-tool/formatters/paste",["client.services/media-tool/markdown-html-parser","util"],function(a,b){var c=/color: rgb\\\((\d{1,3}), (\d{1,3}), (\d{1,3})/i,d=/font\\\-size: (\d+)px/i,e=/text\\\-decoration: underline/i,f=/font\\\-weight: bold/i;a.register({name:"paste",character:"`",toMarkdown:{regex:/^<(span|font|i|b|u) style="(.+?)">(.+?)<\/(?:span|font|i|b|u)>$/,callback:function(g,h,i){var j;return c.test(h)&&(h=h.replace(/rgb\\\(/g,"rgb(").replace(/\\\);/g,");"),i=a.getFormatter("#").toMarkdown.callback(null,b.normalizeToHex(h),null,i)),j=d.exec(h),j&&(i=a.getFormatter("%").toMarkdown.callback(j[1],i)),j=e.exec(h),j&&(i=a.getFormatter("~").toMarkdown.callback(i)),j=f.exec(h),j&&(i=a.getFormatter("**").toMarkdown.callback(i)),this.innerHTML=i,this.removeAttribute("style"),a.toMarkdown(this.outerHTML.trim())},tags:[{name:"span",attr:["style"]},{name:"font",attr:["style"]},{name:"b",attr:["style"]},{name:"i",attr:["style"]},{name:"u",attr:["style"]}]}}),a.register({name:"word",character:"``",toMarkdown:{regex:/^.+$/i,callback:function(){return" "},tags:[{name:"style",attr:[]},{name:"w:WordDocument",attr:[]}]}})}),define("client.services/media-tool/sir-trevor-extensions",["sirtrevor","underscore","client.services/media-tool/text-selection","client.services/media-tool/formatters/font-color","client.services/media-tool/formatters/font-size","client.services/media-tool/formatters/justify","client.services/media-tool/formatters/bold","client.services/media-tool/formatters/italic","client.services/media-tool/formatters/underline","client.services/media-tool/formatters/bookmark","client.services/media-tool/formatters/link","client.services/media-tool/formatters/unlink","client.services/media-tool/formatters/measure","client.services/media-tool/formatters/image","general.utils/string-limits","client.services/media-tool/formatters/paste"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){for(var b=[],c=0;c<a.childNodes.length;c++)3===a.childNodes[c].nodeType?b.push(a.childNodes[c]):b.push.apply(b,p(a.childNodes[c]));return b}function q(){var a=this,b=a.textContent.length-o.textImage;if(b>0){var d=c.getRange(),e=d.commonAncestorContainer;if(3===e.nodeType){var f=p(document.activeElement),g=f.indexOf(e);f=f.splice(0,g+1),f.reverse().forEach(function(a){return!(b<=0)&&(a.nodeValue.length>b?(a.splitText(a.nodeValue.length-b),a.parentNode.removeChild(a.nextSibling),c.addRange(d,!0)):a.parentNode.removeChild(a),void(b-=a.nodeValue.length))})}}}delete a.Formatters.Bold,delete a.Formatters.Italic,delete a.Formatters.Link,delete a.Formatters.Unlink,a.Formatters.bold=new g,a.Formatters.italic=new h,a.Formatters.underline=new i,a.Formatters.justifyLeft=new f.Left,a.Formatters.justifyCenter=new f.Center,a.Formatters.justifyRight=new f.Right,a.Formatters.fontSize=new e,a.Formatters.foreColor=new d,a.Formatters.bookmark=new j,a.Formatters.link=new k,a.Formatters.unlink=new l,a.Formatters.measure=new m,a.Formatters.insertImage=new n,a.Blocks.Paragraph=function(){return a.Block.extend({type:"paragraph",className:"st-block",icon_name:"paragraph",editorHTML:'<div class="st-required st-text-block" contenteditable="true" autocomplete="off" autocorrect="off"></div>',attributes:function(){return b.extend(a.SimpleBlock.fn.attributes.call(this),{})},title:function(){return"Paragraph"},loadData:function(b){this.getTextBlock().html(a.toHTML(b.text,this.type))},focus:function(){var a=this.getTextBlock();a.focus()},_initTextBlocks:function(){var a=this.getTextBlock();a.bind("input",q).bind("paste",this._handleContentPaste).bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter)},_initUIComponents:function(){this.onFocus(),this.onBlur()},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready")},toData:function(){a.log("toData for "+this.blockID);var b=this.getTextBlock().html();this.setData({text:a.toMarkdown(b,this.type)})}})}(),a.FloatingBlockControls=function(){return a.FloatingBlockControls.extend({className:"",bound:[],initialize:function(){},attributes:function(){}})}(),a.BlockControls=function(){return a.FloatingBlockControls.extend({className:"",bound:[],html:"",initialize:function(){},hide:function(){},show:function(){},handleControlButtonClick:function(){}})}(),a.FormatBar=function(){return a.FormatBar.extend({className:"",initialize:function(){}})}()}),define("client.services/media-tool/media-tool",["jquery","underscore","util","general.utils/dom-util","qvangular","sirtrevor","text!./media-tool.ng.html","client.services/media-tool/theme","client.services/media-tool/toolbar","client.services/media-tool/command-queue","client.services/media-tool/text-selection","general.utils/string-limits","general.utils/paths","general.services/show-service/show-service","general.utils/support","client.services/media-tool/feature-detection","client.utils/rtl/direction-service","client.utils/rtl/rtl-util","./sir-trevor-extensions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t=e.getService("$sce"),u={bold:!1,italic:!1,underline:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,link:!1,fontSize:!1};return s={controller:["$scope","$element","$timeout",function(g,s,v){function w(){x(),B="inline"===g.options.toolbar.style?g.options.target.showComponent(i,{textTool:g,options:g.options.toolbar||{}}):n.show(i,{textTool:g,options:g.options.toolbar||{},alignTo:g.options.target||s})}function x(){B&&(g.editor.formatBar.$el.remove(),B=null)}function y(){function a(a){return g.getEditorElement()[0]===a}function b(a,c){return Array.isArray(a)?a.some(function(a){return b(a,c)}):c.some(function(b){return b.nodeName.toLowerCase()===a})}function c(){for(var a=g.currentRange.startContainer;a.parentNode&&"DIV"!==a.tagName&&"P"!==a.tagName;)a=a.parentNode;return a}var e=d.getAncestorsUntil(g.currentRange.startContainer,a),f=d.getAncestorsUntil(g.currentRange.endContainer,a);return{rangeCollapsed:g.currentRange.collapsed,hasStartAncestorTag:function(a){return b(a,e)},hasEndAncestorTag:function(a){return b(a,f)},getParentParagraph:c}}function z(b){function c(a){g.saveRange(),g.cmdQueue.clear(),a&&g.refreshState()}var e=!o.treatAsDesktop();a("body").on("mouseup.texttool",function(b){var f=a(b.target);f.closest(".qv-texttool-toolbar, .qui-immidiateContextual, .qv-modal-container-centered").length?d.isInput(document.activeElement)||(g.focus(),g.restoreRange()):e||document.activeElement===g.getEditorElement()[0]&&v(function(){c(!0),g.$apply()})}),e&&a(document).on("selectionchange.texttool",function(){if(document.activeElement===g.getEditorElement()[0]){var a=k.getRange();a&&!k.rangeEquals(a,g.currentRange)&&c(!0)}}),b.on("qv-activate","img",function(a){var b=k.createRangeForElement(a.target);g.focus(),k.addRange(b,!0),g.saveRange(),g.refreshState()}),b.on("scroll",function(){g.saveScroll()}),b.on("keydown input",function(a){13!==a.which&&(g.cmdQueue.execAll(function(a){g.execCustom(a)}),g.cmdQueue.clear()),v(function(){g.$apply()})}),e||b.on("keyup",function(){v(c.bind(this,!0),0)}),b.on("DOMNodeInserted.autoDirection",function(c){var d=a(c.target);"x-auto-direction-for-paragraphs"in b[0].attributes&&d.is("div,p")&&d[0]!==b[0]&&(r.supportDirAuto()&&d.attr("dir","auto"),d.is("[align],[style]")||(p.usesAlign?d.attr("align","inherit"):d.css("text-align","inherit"),""===d[0].textContent&&d.css("direction",q.direction)))})}var A=t.getTrustedHtml(f.toHTML(g.options.markdown));g.data={data:[{type:"paragraph",data:{text:f.toMarkdown(A)}}]},g.states=u,g.cmdQueue=new j;var B;this.scope=function(){return g},this.closing=function(){var a=this.scope().options;B&&("inline"===a.toolbar.style?a.target.empty():B.destroy())},g.getParagraph=function(){return g.editor.blocks[0]},g.getEditorElement=function(){return g.getParagraph().getTextBlock()},g.destroy=function(){x(),g.destroyComponent()},g.calculateUsage=function(){var a=g.getEditorElement()[0];g.usage=Math.min(100,(a.textContent.length/l.textImage*100).toFixed(0)),g.showUsage=g.usage>=90},g.refreshState=function(){g.currentRange&&e.$apply(g,function(){g.calculateUsage();var a=y();Object.keys(g.states).forEach(function(b){g.states[b]=f.Formatters[b].isActive(a)});var b;g.currentRange&&(b=document.queryCommandValue("foreColor"),"undefined"!=typeof b&&(b=c.normalizeToHex(b))),g.color=b||"#545352";var e,i;g.currentRange&&(i=d.getParentElementWithAttribute(g.currentRange.endContainer,"font","size"),i&&(e=i.getAttribute("size"),e=h.htmlSizeToMarkdownSize[e],e=h.markdownSizeToHtmlSize[e]),"undefined"===e&&(e=null)),g.fontSize=e||3})},g.saveRange=function(){var a=k.getRange();a?g.currentRange=a.cloneRange():g.currentRange=null},g.restoreRange=function(){if(g.currentRange){var a=k.getRange();a?a&&(k.rangeEquals(a,g.currentRange)||k.addRange(g.currentRange,!0)):k.addRange(g.currentRange,!0)}},g.saveScroll=function(){g.currentScrollTop=g.getEditorElement()[0].scrollTop},g.restoreScroll=function(){g.currentScrollTop&&(g.getEditorElement()[0].scrollTop=g.currentScrollTop)},g.setJustify=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.execCustom({cmd:a}),g.saveRange(),g.refreshState()},g.setBIU=function(a){if(g.focus(),g.restoreScroll(),g.restoreRange(),g.states[a]=!g.states[a],g.currentRange.collapsed){var b=g.cmdQueue.remove(a);b||g.cmdQueue.push({cmd:a})}else g.execCustom({cmd:a});g.saveRange()},g.setFontSize=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.currentRange.collapsed?(g.cmdQueue.remove("fontSize"),g.cmdQueue.push({param:a,cmd:"fontSize"})):g.execCustom({param:a,cmd:"fontSize"}),g.saveRange(),g.fontSize=a},g.setColor=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.currentRange.collapsed?(g.cmdQueue.remove("foreColor"),g.cmdQueue.push({param:a,cmd:"foreColor"})):g.execCustom({param:a,cmd:"foreColor"}),g.saveRange(),g.color=a},g.insertImage=function(a,b){a=m.addBasePath(a),b=m.addBasePath(b),g.focus(),g.restoreRange(),g.execCustom({param:a,cmd:"insertImage"}),g.options.insertedImages.push({url:a,urlDef:b}),g.saveRange(),g.focus()},g.insertLink=function(a,b,c){b?k.addRange(b,!0):g.restoreRange(),g.focus(),g.execCustom({url:a,cmd:c.cmd,formatter:c.formatter}),g.saveRange(),g.refreshState()},g.removeLink=function(a){k.addRange(a,!0),g.execCustom({cmd:"unlink",range:a}),g.saveRange(),g.refreshState(),g.focus()},g.execCustom=function(a){var c=f.Formatters[a.formatter||a.cmd];b.isUndefined(c)||(!b.isUndefined(c.onClick)&&b.isFunction(c.onClick)?c.onClick(a):document.execCommand(a.cmd,!1,a.param))},g.focus=function(){g.getEditorElement().focus()},v(function(){g.editor=new f.Editor({el:s.find("textarea"),defaultType:"paragraph",onEditorRender:function(){var a=s.find(".st-text-block");z(a),"function"==typeof g.options.onOpen&&g.options.onOpen(g),g.options.toolbar&&w(),v(function(){g.refreshState()})}})}),g.$on("$destroy",function(){x(),a(s.find(".st-text-block")).off("DOMNodeInserted.autoDirection"),a("body").off(".texttool"),a(document).off(".texttool")})}],template:g}}),define("client.services/media-tool/media-tool-service",["qvangular","sirtrevor","client.services/media-tool/media-tool"],function(a,b,c){var d=a.getService("$sce"),e=a.service("qvMediaTool",[function(){var a,e,f,g,h={};return h.show=function(b,d){g=d,a=b.showComponent(c,{options:d})},h.hide=function(){a&&(a.scope().destroy(),a=null,g=null)},h.closing=function(){a&&a.closing()},h.isActive=function(){return g&&"function"==typeof g.isActive?g.isActive():!!a},h.getCurrentLayout=function(){return e},h.useImageArray=function(){return f},h.getOptions=function(){return g||{}},h.getMarkdown=function(){var b,c=a.scope().getParagraph();return c&&(b=c.saveAndGetData())?b.text:null},h.hasContent=function(a){return a&&"^[\n](left)"!==a},h.getParagraph=function(){return a.scope().getParagraph()},h.getEditorElement=function(){return a.scope().getEditorElement()},h.getRange=function(){return a.scope().currentRange},h.toHTML=function(a,c,g){if(e=c,f=g,a){var h=b.toHTML(a);return a=b.toMarkdown(h),d.getTrustedHtml(b.toHTML(a))}return""},h.toMarkdown=function(a){
return a?b.toMarkdown(a):""},h}]);return e}),define("extensions.qliktech/map/map-properties",["client.utils/property-resolver","client.services/media-tool/media-tool-service","core.utils/help-url","client.property-panel/default-properties","client.utils/default-property-logic"],function(a,b,c,d,e){function f(a){if(!a||a.qLibraryId)return!1;var b=a.qDef.qFieldDefs[0];return b&&b.length&&"="===b[0]}function g(b){var c=a.getValue(b,"color.auto"),d=a.getValue(b,"color.mode"),e=a.getValue(b,"color.expressionIsColor");return c||"primary"===d||"byExpression"===d&&(e||void 0===e)}function h(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!1}function i(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!0}var j=1,k=[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"}],l=k.concat({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),m=l.concat({value:"byExpression",translation:"properties.colorMode.byExpression"}),n={component:"text",translation:"Common.Dimension",style:"sHeader"},o={component:"text",translation:"Common.Measure",style:"sHeader"},p={ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"Common.Field",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return!b||!b.qLibraryId},readOnly:!0},q={type:"string",ref:"qHyperCubeDef.qDimensions.0.qLibraryId",component:"library-item",libraryItemType:"dimension",translation:"Common.Dimension",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return b&&b.qLibraryId}},r={type:"string",ref:"qHyperCubeDef.qMeasures.0.qLibraryId",component:"library-item",libraryItemType:"measure",translation:"Common.Measure",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&b.qLibraryId}},s={ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},t={type:"items",items:{firstMeasureScope:{ref:"qHyperCubeDef.qMeasures.0",component:"scope",item:d.data.items.measures.items.numberFormatting}},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!!b}},u={type:"boolean",ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",inverted:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!!b}},v={ref:"layers",type:"array",translation:"Common.Data",addTranslation:"properties.layers.add",component:"layers",allowMove:!0,max:j,items:{polygon3Layer:{type:"items",component:"expandable-items",sourceType:"polygon3Layer",grouped:!0,items:{dimensions:{type:"items",items:{text:n,field:p,libraryDimension:q,geodata:{ref:"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&f(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0,change:function(b){var c=a.getValue(b,"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression");a.setValue(b,"qHyperCubeDef.qDimensions.0.qNullSuppression",c)}},showExcluded:{type:"boolean",ref:"showExcluded",defaultValue:!0,translation:"properties.dimensions.showExcluded",change:function(b){var c=b.showExcluded,d=a.getValue(b,"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef");d.indexOf("GeoReduceGeometry(")!==-1&&(c&&d.indexOf("{1}")===-1?d=d.replace("GeoReduceGeometry(","GeoReduceGeometry({1}"):c||d.indexOf("{1}")===-1||(d=d.replace("GeoReduceGeometry({1}","GeoReduceGeometry(")),a.setValue(b,"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",d))}}}},measure:{type:"items",items:{text:o,expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(b,c,d){var e=b.qHyperCubeDef.qMeasures[0],f=d.layers.indexOf(b);if(e&&""===e.qDef.qDef)"byMeasure"!==a.getValue(d,"color.mode")&&"byExpression"!==a.getValue(d,"color.mode")||(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{e.qSortBy={qSortByLoadOrder:1};var g=d.layers[f].measureDef;g=void 0!==g?g.trim():"",d.color.auto&&"primary"===d.color.mode&&""===g&&(d.color.auto=!1,d.color.mode="byMeasure")}d.layers[f].measureDef=b.qHyperCubeDef.qMeasures[0].qDef.qDef},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},libraryMeasure:r,label:s,numberFormatting:t,suppressZero:u}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{type:"boolean",ref:"show",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}},pointLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{text:n,field:p,libraryDimension:q,geodata:{ref:"qHyperCubeDef.qDimensions.1.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"properties.layers.pointData",change:function(a){var b=a.qHyperCubeDef.qDimensions[1].qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]},show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&f(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0}}},measure:{type:"items",items:{text:o,expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(b,c,d,e){var f=b.qHyperCubeDef.qMeasures[0];if(f&&""===f.qDef.qDef)b.qHyperCubeDef.qMeasures.length=0,2===b.qHyperCubeDef.qInterColumnSortOrder[0]&&b.qHyperCubeDef.qInterColumnSortOrder.splice(0,1),"byMeasure"!==a.getValue(d,"color.mode")&&"byExpression"!==a.getValue(d,"color.mode")||(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{f.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},2!==b.qHyperCubeDef.qInterColumnSortOrder[0]&&b.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2);var g=d.layers.indexOf(b),h=e.layout.layers[g],i=h.qHyperCube.qMeasureInfo?h.qHyperCube.qMeasureInfo.length:0;d.color.auto&&"primary"===d.color.mode&&0===i&&(d.color.auto=!1,d.color.mode="byMeasure")}},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},libraryMeasure:r,label:s,numberFormatting:t,suppressZero:u,useSize:{ref:"useSize",type:"boolean",translation:"properties.map.useSize",defaultValue:!0,show:function(a){return a.qHyperCubeDef.qMeasures[0]}},bubbleSizes:{ref:"bubbleSizes",type:"integer",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:8,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!(b&&a.useSize)}},rangeBubbleSizes:{ref:"rangeBubbleSizes",type:"array",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:[1,32],show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize}},customRange:{type:"items",items:{autoMinMax:{ref:"autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize}},customMin:{ref:"customMin",translation:"properties.axis.min",expression:"optional",type:"number",defaultValue:0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize&&a.autoMinMax===!1},invalid:function(b){return"minMax"===a.getValue(b,"minMax")&&a.getValue(b,"customMin")>=a.getValue(b,"customMax")}},customMax:{ref:"customMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize&&a.autoMinMax===!1},invalid:function(b){return"minMax"===a.getValue(b,"minMax")&&a.getValue(b,"customMin")>=a.getValue(b,"customMax")}}}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}}}},w={component:"items",type:"items",translation:"properties.background",grouped:!0,items:{show:{ref:"background.show",type:"boolean",translation:"properties.show",component:"switch",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],defaultValue:!1,change:function(b){b.layers.length&&!b.background.show&&(b.layers[0].show=!0),b.background&&b.background.show&&void 0===b.background.defaultMapService&&a.setValue(b,"background.defaultMapService",!0)}},baseLayers:{type:"items",show:function(b){return a.getValue(b,"background.show")},items:{defaultMapService:{ref:"background.defaultMapService",type:"boolean",translation:"properties.mapService",component:"switch",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},customMapService:{type:"items",items:{type:{ref:"background.layers.0.type",type:"string",translation:"properties.type",component:"dropdown",options:[{translation:"properties.layers.type.slippy",value:"XYZ"}],defaultValue:"XYZ"},urls:{ref:"background.layers.0.urls.0",type:"string",translation:"Common.URL",minlength:1},attribution:{ref:"background.layers.0.attribution",type:"string",translation:"properties.attribution",component:"textarea",maxlength:1024,resolveFunctions:{get:function(a,c){var d=a(c.type);return b.toHTML(d)},set:function(a,c,d){var e=b.toMarkdown(a);c(d.type,e)}}},helpLink:{component:"link",url:function(){return c.path+"map.htm"},translation:"properties.background.help"}},show:function(b){var c=a.getValue(b,"background.defaultMapService");return!c}}}}}},x=e.getLogicFor("hard","default"),y={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},autoZoomOnSelection:{ref:"autoZoomOnSelection",type:"boolean",defaultValue:!0,translation:"properties.autoZoomOnSelection",show:function(a){return a&&a.layers&&a.layers[0]&&"point"===a.layers[0].type}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorByDimension:{ref:"color.byDimDef",translation:"properties.colorBy.selectDimension",type:"object",defaultValue:{},component:"color-by-dropdown",libraryItemType:"dimension",show:x.color.colorBy.dimension.show},colorByMeasure:{ref:"color.byMeasureDef",translation:"properties.colorBy.selectMeasure",type:"object",defaultValue:{},component:"color-by-dropdown",libraryItemType:"measure",show:x.color.colorBy.measure.show},colorMode:{options:function(a,b){var c=b.getMeasures(),d=c?c.length:0,e=b.getLayerTypeAndVersion();switch(e[0]){case"point":return d>0?m:k;case"polygon":return d>0?m:k}return k},globalChange:function(a,b){x.color.colorBy.globalChange(a,b,"layers.0.qHyperCubeDef.")}},persistentColors:{show:function(b){return!(a.getValue(b,"color.auto")||"byDimension"!==a.getValue(b,"color.mode")||"point"===b.layers[0].type||"polygon"===b.layers[0].type&&"2"===b.layers[0].version)}},attributeExpression:{ref:"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:function(b){var c=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.id="colorByExpression",d&&(d.colorExpression=c.qExpression))},globalChange:function(b){var c,d,e,f=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures",[]),g=a.getValue(b,"layers.0.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),h=null,i=function(a,b){"colorByExpression"===a.id&&(d=b)};if(f.length+g.length>1){for(c=g.length-1;c>=0;--c)e=g[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);for(c=f.length-1;c>=0;--c)e=f[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);!f[0].qAttributeExpressions&&h&&(f[0].qAttributeExpressions=[]),h&&f[0].qAttributeExpressions.splice(0,0,h)}var j=a.getValue(b,"color.colorExpression");1!==f.length||f[0].qAttributeExpressions&&0!==f[0].qAttributeExpressions.length||!j||(f[0].qAttributeExpressions=[{qExpression:j,id:"colorByExpression"}])},show:function(b,c){return!a.getValue(b,"color.auto")&&"byExpression"===a.getValue(b,"color.mode")&&c.getMeasures().length>0}},expressionIsColor:{show:function(b,c){return!a.getValue(b,"color.auto")&&"byExpression"===a.getValue(b,"color.mode")&&c.getMeasures().length>0}},expressionLabel:{change:function(b){var c=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.label=a.getValue(b,"color.expressionLabel"),d&&(d.colorExpression=c.qExpression))},show:function(b,c){return!a.getValue(b,"color.auto")&&h(b)&&c.getMeasures().length>0}}}},legend:{items:{show:{show:function(a){return!g(a)}},showTitle:{show:function(b){return a.getValue(b,"legend.show")&&!g(b)&&!i(b)}},dock:{show:function(b){return a.getValue(b,"legend.show")&&!g(b)}}}}}}}},z={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{items:{expr:{ref:"calcCond",expressionType:"measure",change:function(a,b){b.rippleToHyperCubes("qCalcCond",a.calcCond)}},customErrorMessage:{ref:"customErrorMessage.calcCond",show:function(b){return""!==a.getValue(b,"calcCond")},change:function(a,b){b.rippleToHyperCubes("customErrorMessage.calcCond",a.customErrorMessage.calcCond)}}}},suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:v,background:w,addons:z,settings:y}}}),define("extensions.qliktech/map/colorby-map-properties",["client.utils/property-resolver","client.services/media-tool/media-tool-service","core.utils/help-url","client.property-panel/default-properties","client.utils/default-property-logic"],function(a,b,c,d,e){function f(a){if(!a||a.qLibraryId)return!1;var b=a.qDef.qFieldDefs[0];return b&&b.length&&"="===b[0]}function g(b){var c=a.getValue(b,"color.auto"),d=a.getValue(b,"color.mode"),e=a.getValue(b,"color.expressionIsColor");return c||"primary"===d||"byExpression"===d&&(e||void 0===e)}function h(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!1}function i(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!0}var j=1,k=[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"}],l=k.concat({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),m=l.concat({value:"byExpression",translation:"properties.colorMode.byExpression"}),n={component:"text",translation:"Common.Dimension",style:"sHeader"},o={component:"text",translation:"Common.Measure",style:"sHeader"},p={ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"Common.Field",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return!b||!b.qLibraryId},readOnly:!0},q={type:"string",ref:"qHyperCubeDef.qDimensions.0.qLibraryId",component:"library-item",libraryItemType:"dimension",translation:"Common.Dimension",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return b&&b.qLibraryId}},r={type:"string",ref:"qHyperCubeDef.qMeasures.0.qLibraryId",component:"library-item",libraryItemType:"measure",translation:"Common.Measure",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&b.qLibraryId}},s={ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},t={type:"items",items:{firstMeasureScope:{ref:"qHyperCubeDef.qMeasures.0",component:"scope",item:d.data.items.measures.items.numberFormatting}},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!!b}},u={type:"boolean",ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",inverted:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!!b}},v={ref:"layers",type:"array",translation:"Common.Data",addTranslation:"properties.layers.add",component:"layers",allowMove:!0,max:j,items:{polygon3Layer:{type:"items",component:"expandable-items",sourceType:"polygon3Layer",grouped:!0,items:{dimensions:{type:"items",items:{text:n,field:p,libraryDimension:q,geodata:{ref:"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&f(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0,change:function(b){var c=a.getValue(b,"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression");a.setValue(b,"qHyperCubeDef.qDimensions.0.qNullSuppression",c)}},showExcluded:{type:"boolean",ref:"showExcluded",defaultValue:!0,translation:"properties.dimensions.showExcluded",change:function(b){var c=b.showExcluded,d=a.getValue(b,"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef");d.indexOf("GeoReduceGeometry(")!==-1&&(c&&d.indexOf("{1}")===-1?d=d.replace("GeoReduceGeometry(","GeoReduceGeometry({1}"):c||d.indexOf("{1}")===-1||(d=d.replace("GeoReduceGeometry({1}","GeoReduceGeometry(")),a.setValue(b,"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",d))}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{type:"boolean",ref:"show",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}},pointLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{text:n,field:p,libraryDimension:q,geodata:{ref:"qHyperCubeDef.qDimensions.1.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"properties.layers.pointData",change:function(a){var b=a.qHyperCubeDef.qDimensions[1].qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]},show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&f(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0}}},measure:{type:"items",items:{text:o,expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(a){var b=a.qHyperCubeDef.qMeasures[0];b&&""===b.qDef.qDef?(a.qHyperCubeDef.qMeasures.length=0,2===a.qHyperCubeDef.qInterColumnSortOrder[0]&&a.qHyperCubeDef.qInterColumnSortOrder.splice(0,1)):(b.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},2!==a.qHyperCubeDef.qInterColumnSortOrder[0]&&a.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2))},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},libraryMeasure:r,label:s,numberFormatting:t,suppressZero:u,bubbleSizes:{ref:"bubbleSizes",type:"integer",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:8,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b}},rangeBubbleSizes:{ref:"rangeBubbleSizes",type:"array",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:[1,32],show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b}},customRange:{type:"items",items:{autoMinMax:{ref:"autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b}},customMin:{ref:"customMin",translation:"properties.axis.min",expression:"optional",type:"number",defaultValue:0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.autoMinMax===!1},invalid:function(b){return"minMax"===a.getValue(b,"minMax")&&a.getValue(b,"customMin")>=a.getValue(b,"customMax")}},customMax:{ref:"customMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.autoMinMax===!1},invalid:function(b){return"minMax"===a.getValue(b,"minMax")&&a.getValue(b,"customMin")>=a.getValue(b,"customMax")}}}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}}}},w={component:"items",type:"items",translation:"properties.background",grouped:!0,items:{show:{ref:"background.show",type:"boolean",translation:"properties.show",component:"switch",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],defaultValue:!1,change:function(b){b.layers.length&&!b.background.show&&(b.layers[0].show=!0),b.background&&b.background.show&&void 0===b.background.defaultMapService&&a.setValue(b,"background.defaultMapService",!0)}},baseLayers:{type:"items",show:function(b){return a.getValue(b,"background.show")},items:{defaultMapService:{ref:"background.defaultMapService",type:"boolean",translation:"properties.mapService",component:"switch",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},customMapService:{type:"items",items:{type:{ref:"background.layers.0.type",type:"string",translation:"properties.type",component:"dropdown",options:[{translation:"properties.layers.type.slippy",value:"XYZ"}],defaultValue:"XYZ"},urls:{ref:"background.layers.0.urls.0",type:"string",translation:"Common.URL",minlength:1},attribution:{ref:"background.layers.0.attribution",type:"string",translation:"properties.attribution",component:"textarea",maxlength:1024,resolveFunctions:{get:function(a,c){var d=a(c.type);return b.toHTML(d)},set:function(a,c,d){var e=b.toMarkdown(a);c(d.type,e)}}},helpLink:{component:"link",url:function(){return c.path+"map.htm"},translation:"properties.background.help"}},show:function(b){var c=a.getValue(b,"background.defaultMapService");return!c}}}}}},x=e.getLogicFor("hard","default"),y={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},autoZoomOnSelection:{ref:"autoZoomOnSelection",type:"boolean",defaultValue:!0,translation:"properties.autoZoomOnSelection",show:function(a){return a&&a.layers&&a.layers[0]&&"point"===a.layers[0].type}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:function(a,b){var c=b.getDimensions(),d=c?c.length:0,e=b.getLayerTypeAndVersion();switch(e[0]){case"point":return d>0?m:k;case"polygon":return d>0?m:k}return k},globalChange:function(a,b){x.color.colorBy.globalChange(a,b,"layers.0.qHyperCubeDef.")}},persistentColors:{show:function(b){return!(a.getValue(b,"color.auto")||"byDimension"!==a.getValue(b,"color.mode")||"point"===b.layers[0].type||"polygon"===b.layers[0].type&&"2"===b.layers[0].version)}},attributeExpression:{ref:"layers.0.qHyperCubeDef.qDimensions.0.qAttributeExpressions.0.qExpression",change:function(b){var c=a.getValue(b,"layers.0.qHyperCubeDef.qDimensions.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.id="colorByExpression",d&&(d.colorExpression=c.qExpression))},globalChange:function(b){var c,d,e,f=a.getValue(b,"layers.0.qHyperCubeDef.qDimensions",[]),g=a.getValue(b,"layers.0.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",[]),h=null,i=function(a,b){"colorByExpression"===a.id&&(d=b)};if(f.length+g.length>1){for(c=g.length-1;c>=0;--c)e=g[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);for(c=f.length-1;c>=0;--c)e=f[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);!f[0].qAttributeExpressions&&h&&(f[0].qAttributeExpressions=[]),h&&f[0].qAttributeExpressions.splice(0,0,h)}var j=a.getValue(b,"color.colorExpression");1!==f.length||f[0].qAttributeExpressions&&0!==f[0].qAttributeExpressions.length||!j||(f[0].qAttributeExpressions=[{qExpression:j,id:"colorByExpression"}])},show:function(b,c){return!a.getValue(b,"color.auto")&&"byExpression"===a.getValue(b,"color.mode")&&c.getDimensions().length>0}},expressionIsColor:{show:function(b,c){return!a.getValue(b,"color.auto")&&"byExpression"===a.getValue(b,"color.mode")&&c.getDimensions().length>0}},expressionLabel:{change:function(b){var c=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.label=a.getValue(b,"color.expressionLabel"),d&&(d.colorExpression=c.qExpression))},show:function(b,c){return!a.getValue(b,"color.auto")&&h(b)&&c.getDimensions().length>0}}}},legend:{items:{show:{show:function(a){return!g(a)}},showTitle:{show:function(b){return a.getValue(b,"legend.show")&&!g(b)&&!i(b)}},dock:{show:function(b){return a.getValue(b,"legend.show")&&!g(b)}}}}}}}},z={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{items:{expr:{ref:"calcCond",expressionType:"measure",change:function(a,b){b.rippleToHyperCubes("qCalcCond",a.calcCond)}},customErrorMessage:{ref:"customErrorMessage.calcCond",show:function(b){return""!==a.getValue(b,"calcCond")},change:function(a,b){b.rippleToHyperCubes("customErrorMessage.calcCond",a.customErrorMessage.calcCond)}}}},suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:v,background:w,addons:z,settings:y}}}),define("extensions.qliktech/map/projection/mercator-projection",["core.utils/class","general.utils/shapes/point"],function(a,b){var c,d=Math.PI,e=d/2,f=d/4,g=d/180,h=Math.max,i=Math.min,j=85.0511287798059*g,k=180/d;return c=a.extend("MercatorProjection",{init:function(){},getProjectionType:function(){return"Mercator"},project:function(a){if(a){var c=h(i(a.y*g,j),-j),d=a.x*g,e=0,l=d-e,m=Math.log(Math.tan(f+c/2));return l*=k,m*=k,new b(l,m)}},invProject:function(a){if(a){var c=a.x*g,d=a.y*g,f=0,h=c+f,i=2*Math.atan(Math.pow(Math.E,d))-e;return h*=k,i*=k,new b(h,i)}}})}),define("extensions.qliktech/map/projection/viewport-projection-mercator",["objects.views/charts/utils/viewport-projection","general.utils/shapes/point","extensions.qliktech/map/projection/mercator-projection","general.utils/shapes/rect"],function(a,b,c,d){var e,f=new b(0,0);return e=a.extend("ViewportProjectionMercator",{init:function(){this._super(),this._boundingBox=new d(-180,-180,360,360),this.helpFunctions.updateProjectedDataBoundingBox.call(this),this._mercatorProjection=new c,this._mirrorYAxis=!0},getMercatorProjection:function(){return this._mercatorProjection},setMapCenterInLatLong:function(a){if(!a)return!1;var b,c;return b=this._mercatorProjection.project(a),c=this._projection.invProject(b),this.setDataCenter(c)},getMapCenterInLatLong:function(){var a,b;return a=this._projection.project(this._currentDataCenter),b=this._mercatorProjection.invProject(a)},fromLatLongToViewport:function(a){var b,c;return b=this._mercatorProjection.project(a),c=this.transform(b)},fromLatLongRectToViewportRect:function(a){var c,e,f;return c=this.fromLatLongToViewport(new b(a.x,a.y)),e=this.fromLatLongToViewport(new b(a.x+a.width,a.y+a.height)),f=new d(c.x,c.y,e.x-c.x,e.y-c.y)},fromViewportToLatLong:function(a){var b,c;return b=this.invTransform(a),c=this._mercatorProjection.invProject(b)},fromViewportRectToLatLongRect:function(a){var c,e,f;return c=this.fromViewportToLatLong(new b(a.x,a.y)),e=this.fromViewportToLatLong(new b(a.x+a.width,a.y+a.height)),f=new d(c.x,c.y,e.x-c.x,e.y-c.y)},fromLatLongToPixel:function(a,c){var d,e,f,g,h=Math.pow(2,c+7);return d=this._mercatorProjection.project(a),e=this.helpFunctions.translateProjectedDataCenterToZeroPoint.call(this,d),f=this.helpFunctions.scaleProjectedDataToZoomLevel.apply(this,[e,c]),g=new b(f.x+h,h-f.y)},fromPixelToLatLong:function(a,c){var d,e,f,g,h=Math.pow(2,c+7);return g=new b(a.x-h,h-a.y),f=this.helpFunctions.invScaleProjectedDataToZoomLevel.apply(this,[g,c]),e=this.helpFunctions.invTranslateProjectedDataCenterToZeroPoint.call(this,f),d=this._mercatorProjection.invProject(e)},getViewRectangleInLatLong:function(){var a,b;return a=this.fromViewportToLatLong(f),b=this.fromViewportToLatLong(this._viewportSize),new d(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.abs(a.x-b.x),Math.abs(a.y-b.y))}})}),define("extensions.qliktech/map/map-layer",["objects.views/charts/components/chart-component","objects.views/charts/utils/canvas-renderer"],function(a,b){"use strict";function c(){this._viewportProjectionChanged=!0,this._shouldPaintOnDataChanged||this.invalidateDisplay("onViewportProjectionChanged")}function d(){this._viewportProjectionChanged=!0,this.paint()}function e(){void 0!==this._layerData.opacity&&(this.container.style.opacity=this._layerData.opacity,this.container.style.filter="alpha(opacity="+100*this._layerData.opacity+")")}function f(){this._toggledOnCacheItems.forEach(function(a){a.selected=!1}),this._toggledOnCacheItems=[],this._selectedRows=[]}function g(a){var b=this,c=this._toggledOnCacheItems.map(function(a){return a.row});this.updateBackendApi(),this.backendApi.select("SelectHyperCubeCells",this._layerPath,c,a).then(function(a){b._selectionFailed=!a.qSuccess,b._selectionFailed&&f.call(b)})}var h;return h=a.extend("MapLayer",{init:function(){this._super.apply(this,arguments),this._viewportProjectionChanged=!1,this._data=void 0,this._layerData=void 0,this._qData=void 0,this._qMatrix=void 0,this._qSelectionInfo=void 0,this._numItems=0,this._layoutMode=void 0,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=void 0,this._layerS2Bounds=void 0,this._cacheItems=null,this._renderer=new b(this.container),this._firstAutoZoomed=!1,this._numPoints=0,this._toggledOnCacheItems=[],this._selectedRows=[]},setData:function(a,b){var c;this._skipInvalidateOnGlobalOpacityChange=!0,this._data=a,this._layerData=b,this._toggledOnCacheItems=[],this._selectedRows=[],c=!!this._layerData&&this._layerData.show,c?this.showComponent():this.hideComponent(),this._qSelectionInfo=this._data?this._data.qSelectionInfo:void 0,e.call(this)},getData:function(){return this._data},getLayerData:function(){return this._layerData},setLayerIndex:function(a){this._layerIndex=a},getLayerIndex:function(){return this._layerIndex},setLayerType:function(a){this._layerType=a},getLayerType:function(){return this._layerType},setVersion:function(a){this._version=a},getVersion:function(){return this._version},setFirstAutoZoomed:function(a){this._firstAutoZoomed=a},getFirstAutoZoomed:function(){return this._firstAutoZoomed},getLayerPath:function(){return this._layerPath},getNumPoints:function(){return this._numPoints},getLayerBounds:function(){return this._layerS2Bounds},setViewportProjection:function(a){this._viewportProjection!==a&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",c,this),this._viewportProjection.stopListen("changedByInteraction",d,this)),this._viewportProjection=a,this._viewportProjection&&(this._viewportProjection.listen("changed",c,this),
this._viewportProjection.listen("changedByInteraction",d,this)))},setBackendApi:function(a){this.backendApi=a},setSelectionsApi:function(a){this.selectionsApi=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getLayerOutputData:function(){return this._layerData?{color:this._data.color,legend:this._data.legend,qSelectionInfo:this._data.qSelectionInfo,qHyperCube:this._layerData.qHyperCube}:void 0},getMeasureInfo:function(){if(this._layerData)return this._layerData.qHyperCube.qMeasureInfo},getSelectedRows:function(){return this._toggleOnCacheItemsChanged&&(this._selectedRows=this._toggledOnCacheItems.map(function(a){return a.row}),this._toggleOnCacheItemsChanged=!1),this._selectedRows},setGlobalOpacity:function(a,b){var c=this;this._skipInvalidateOnGlobalOpacityChange=!1,this._globalAlpha=a,b||setTimeout(function(){c._skipInvalidateOnGlobalOpacityChange||(f.call(c),c.invalidateDisplay("MapLayer.setGlobalOpacity"),c._skipInvalidateOnGlobalOpacityChange=!0)},100)},setPreselectionMode:function(a){this._preselectionMode=a},toggleShapes:function(a){var b,c,d,e=a?a.length:0;if(this.isVisible()&&0!==e)for(this._skipInvalidateOnGlobalOpacityChange=!0,b=0;b<e;b++)d=a[b],(d.id===-3||d.id>=0)&&(d.selected&&this._toggledOnCacheItems.indexOf(d)<0?(this._toggledOnCacheItems[this._toggledOnCacheItems.length]=d,this._toggleOnCacheItemsChanged=!0):d.selected||(c=this._toggledOnCacheItems.indexOf(d),c>=0&&(this._toggledOnCacheItems.splice(c,1),this._toggleOnCacheItemsChanged=!0)))},selectOnLayer:function(a,b){this.isVisible()&&(this._toggledOnCacheItems.length?g.call(this,b):a&&a.length&&a.every(function(a){return!a.selected})&&this.clearSelections())},clearSelections:function(){this.updateBackendApi(),this.selectionsApi.clear()},updateBackendApi:function(){this.backendApi&&this.backendApi.path!==this._layerPath&&(this.backendApi.path=this._layerPath,this.backendApi.path&&(this.backendApi.dataPath=this.backendApi.path.slice(1,-3)))},afterPaint:function(){},clear:function(){this._renderer&&this._renderer.shapes&&this._renderer.shapes.length&&(this._renderer.shapes=[],this._renderer.render(),this.afterPaint())},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},release:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this._viewportProjection=null,this.backendApi=null}})}),define("extensions.qliktech/map/geo-region",["general.utils/shapes/rect","general.utils/shapes/geometry-math"],function(a,b){"use strict";function c(a,b){var c=a?a.length:0,d=[];return this._id=b,0===c?void this.setGeoPolygons(d):void this.setGeoPolygons(a)}return c.prototype={setId:function(a){this._id=a},getId:function(){return this._id},setGeoPolygons:function(a){this.geopolygons!==a&&(this.geopolygons=a,this._numGeoPolygons=this.geopolygons?this.geopolygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validateGeoPolygons:function(){var a;for(a=0;a<this._numGeoPolygons;a++)this.geopolygons[a].validatePolygons()},getGeoPolygons:function(){return this.geopolygons},getNumGeoPolygons:function(){return this._numGeoPolygons},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numGeoPolygons;a++)b+=this.geopolygons[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var a;for(a=0;a<this._numGeoPolygons;a++)this.geopolygons[a]&&(this.points=this.points.concat(this.geopolygons[a].getPoints()))}return this.points},pointInside:function(a,b){if(this.calculateBounds(),void 0===this._bounds||a<=this._bounds.x||a>=this._bounds.x+this._bounds.width||b<=this._bounds.y||b>=this._bounds.y+this._bounds.height)return!1;var c;for(c=0;c<this._numGeoPolygons;c++)if(this.geopolygons[c].pointInside(a,b))return!0;return!1},intersectsLine:function(a){if(!a)return!1;var b;for(b=0;b<this._numGeoPolygons;b++)if(this.geopolygons[b].intersectsLine(a))return!0;return!1},intersectsRect:function(a){if(!a)return!1;var b;for(b=0;b<this._numGeoPolygons;b++)if(this.geopolygons[b].intersectsRect(a))return!0;return!1},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numGeoPolygons)return null;var c=b.calculateBounds(this.geopolygons);this._bounds=new a(c.x,c.y,c.width,c.height)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="";for(a=0;a<this._numGeoPolygons-1;a++)b+=this.geopolygons[a].toString()+";";return b+=this.geopolygons[this._numGeoPolygons-1].toString()}},c}),define("extensions.qliktech/map/geo-regions-data",["core.utils/class","general.utils/shapes/point","general.utils/shapes/rect","general.utils/shapes/geometry-math","objects.views/charts/utils/unit-projection"],function(a,b,c,d,e){function f(){var a,b,c,d,e,f,g,h,i,j;for(this._projectedGeoRegions&&this._projectedGeoRegions.length===this._numGeoRegions||(this._projectedGeoRegions=new Array(this._numGeoRegions)),a=0;a<this._numGeoRegions;a++)for(e=this._geoRegions[a].getGeoPolygons(),f=e?e.length:0,this._projectedGeoRegions[a]&&this._projectedGeoRegions[a].length===f||(this._projectedGeoRegions[a]=new Array(f)),b=0;b<f;b++)for(g=e[b].getPolygons(),h=g?g.length:0,this._projectedGeoRegions[a][b]&&this._projectedGeoRegions[a][b].length===h||(this._projectedGeoRegions[a][b]=new Array(h)),c=0;c<h;c++)for(i=g[c].points,j=i?i.length:0,this._projectedGeoRegions[a][b][c]&&this._projectedGeoRegions[a][b][c].length===j||(this._projectedGeoRegions[a][b][c]=new Array(j)),d=0;d<j;d++)this._projectedGeoRegions[a][b][c][d]=this._projection.project(i[d])}function g(){var a;for(this._regionIdToRegionIndexMapping={},a=0;a<this._numGeoRegions;a++)this._regionIdToRegionIndexMapping[this._geoRegions[a].getId()]=a}var h;return h=a.extend("GeoRegionsData",{init:function(){this._numGeoRegions=0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0,this._projectedGeoRegionsNeedToUpdate=!1,this._projection=new e,this._numPointsNeedToUpdate=!0},getNumGeoRegions:function(){return this._numGeoRegions},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numGeoRegions;a++)b+=this._geoRegions[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},setGeoRegions:function(a){this._geoRegions=a,this._numGeoRegions=this._geoRegions?this._geoRegions.length:0,this._projectedGeoRegionsNeedToUpdate=!0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0},getGeoRegions:function(){return this._geoRegions},getGeoRegionById:function(a){this._regionIdToRegionIndexMappingNeedToUpdate&&(g.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1);var b=this._regionIdToRegionIndexMapping[a];return this._geoRegions[b]},setProjection:function(a){this._projection&&a&&this._projection.getProjectionType()===a.getProjectionType()||(this._projection=a,this._projectedGeoRegionsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0)},getProjection:function(){return this._projection},getProjectedGeoRegions:function(){return this._projectedGeoRegionsNeedToUpdate&&this._projection&&(f.call(this),this._projectedGeoRegionsNeedToUpdate=!1),this._projectedGeoRegions},getProjectedGeoRegionById:function(a){this._regionIdToRegionIndexMappingNeedToUpdate&&(g.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1),this._projectedGeoRegionsNeedToUpdate&&this._projection&&(f.call(this),this._projectedGeoRegionsNeedToUpdate=!1);var b=this._regionIdToRegionIndexMapping[a];return this._projectedGeoRegions[b]},calculateBounds:function(){if(this._mapBoundsNeedToUpdate){this._mapBoundsNeedToUpdate=!1;var a=d.calculateBounds(this._geoRegions);a?this._mapBounds=new c(a.x,a.y,a.width,a.height):this._mapBounds=null}return this._mapBounds},calculateProjectedBounds:function(){if(this._projectedMapBoundsNeedToUpdate){this._projectedMapBoundsNeedToUpdate=!1;var a,d,e=this.calculateBounds();e?(a=this._projection.project(new b(e.x,e.y)),d=this._projection.project(new b(e.x+e.width,e.y+e.height)),this._projectedMapBounds=new c(a.x,a.y,d.x-a.x,d.y-a.y)):this._projectedMapBounds=null}return this._projectedMapBounds},calculateBoundsOfRegionIds:function(a){var b,e,f,g=a?a.length:0,h=new Array(g);for(b=0;b<g;b++)h[b]=this.getGeoRegionById(a[b]);return e=d.calculateBounds(h),f=e?new c(e.x,e.y,e.width,e.height):null},calculateProjectedBoundsOfRegionIds:function(a){var d,e,f,g=this.calculateBoundsOfRegionIds(a);return g?(d=this._projection.project(new b(g.x,g.y)),e=this._projection.project(new b(g.x+g.width,g.y+g.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)):f=null,f}})}),define("extensions.qliktech/map/geo-polygon",["general.utils/shapes/polygon","general.utils/shapes/rect","general.utils/shapes/line","general.utils/shapes/point","general.utils/shapes/geometry-math"],function(a,b,c,d,e){"use strict";function f(a){var b,c=a?a.length:0,e=Math.floor(c/2),f=new Array(e);for(b=0;b<e;b++)f[b]=new d(a[2*b],a[2*b+1]);return f}function g(a,b){var c,d=b-1;if(0===b)return-1;for(c=0;c<d;)if(a[c].x+180<o){if(a[c+1].x+180<o)return c;c+=2}else c++;return-1}function h(a,b,c){var d,e;return d=a[c],e=a[c+1],180-Math.abs(d.x)<o&&180-Math.abs(e.x)<o}function i(a,b){return b<0?b+a:b>=a?b-a:b}function j(a,b,c){var d=b-1;if(h(a,b,i(d,c+2))){if(0===c){if(a[b-2].x>=0)return!0}else if(c===b-2){if(a[b-3].x>=0)return!0}else if(a[c-1].x>=0)return!0}else if(h(a,b,i(d,c-2))){if(0===c){if(a[2].x>=0)return!0}else if(c===b-2){if(a[1].x>=0)return!0}else if(a[c+2].x>=0)return!0}else if(0===c){if(a[b-2].x>=0&&a[2].x>=0)return!0}else if(c===b-2){if(a[b-3].x>=0&&a[1].x>=0)return!0}else if(a[c-1].x>=0&&a[c+2].x>=0)return!0;return!1}function k(a,b,c){0===c?(a[c].x=180,a[c+1].x=180,a[b-1].x=180):c===b-2?(a[c].x=180,a[c+1].x=180,a[0].x=180):(a[c].x=180,a[c+1].x=180)}function l(a){var b,c=a?a.points:null,d=c?c.length:0;b=g(c,d),b<0||j(c,d,b)&&k(c,d,b)}function m(a){var b,c=a?a.length:0;for(b=0;b<c;b++)l(a[b])}function n(b){var c,d=b?b.length:0,e=[];if(0===d)return void this.setPolygons(e);if(b[0].getPoints)this.setPolygons(b);else{for(c=0;c<d;c++)b[c]&&b[c].length&&e.push(new a(f(b[c])));this.setPolygons(e)}}var o=1e-5;return n.prototype={setPolygons:function(a){this.polygons!==a&&(this.polygons=a,this._numPolygons=this.polygons?this.polygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validatePolygons:function(){m(this.polygons)},getPolygons:function(){return this.polygons},getNumPolygons:function(){return this._numPolygons},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var a;for(a=0;a<this._numPolygons;a++)this.polygons[a]&&(this.points=this.points.concat(this.polygons[a].getPoints()))}return this.points},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numPolygons;a++)b+=this.polygons[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},pointInside:function(a,b){if(this.calculateBounds(),void 0===this._bounds||a<=this._bounds.x||a>=this._bounds.x+this._bounds.width||b<=this._bounds.y||b>=this._bounds.y+this._bounds.height)return!1;var c,d,e;if(0===this._numPolygons)return!1;if(this.polygons[0].pointInside(a,b)){for(d=this._innerPolygons?this._innerPolygons.length:0,c=0;c<d;c++)if(this.polygons[this._innerPolygons[c]].pointInside(a,b))return!1;return!0}for(e=this._outerPolygons?this._outerPolygons.length:0,c=0;c<e;c++)if(this.polygons[this._outerPolygons[c]].pointInside(a,b))return!0;return!1},intersectsLine:function(a){if(!a)return!1;if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var b;for(b=0;b<this._numPolygons;b++)if(this.polygons[b].intersectsLine(a))return!0;return!1},intersectsLines:function(a){var b,c=a?a.length:0;for(b=0;b<c;b++)if(this.intersectsLine(a[b]))return!0;return!1},intersectsRect:function(a){if(!a)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(a.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(a))return!1;var b,d,e,f,g;return b=a.x,d=a.getRight(),e=a.y,f=a.getBottom(),!!(this.pointInside(b,e)||this.pointInside(d,e)||this.pointInside(d,f)||this.pointInside(b,f))||(g=[new c(b,e,d,e),new c(b,f,d,f),new c(b,e,b,f),new c(d,e,d,f)],this.intersectsLines(g))},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numPolygons)return null;var a,c,d,f=e.calculateBounds(this.polygons);for(this._bounds=new b(f.x,f.y,f.width,f.height),a=this.polygons[0].calculateBounds(),this._innerPolygons=[],this._outerPolygons=[],d=1;d<this._numPolygons;d++)c=this.polygons[d].calculateBounds(),a.rectInside(c)&&this.polygons[0].pointInside(this.polygons[d].points[0].x,this.polygons[d].points[0].y)?this._innerPolygons.push(d):this._outerPolygons.push(d)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="";for(a=0;a<this._numPolygons-1;a++)b+=this.polygons[a].toString()+";";return b+=this.polygons[this._numPolygons-1].toString()}},n}),define("extensions.qliktech/map/map-polygon3-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","general.utils/shapes/point","general.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon","core.utils/deferred"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){return this._showExcluded?this._allItemsS2Bounds:k.call(this)}function k(){var a,b=new Array(this._numItems);for(a=0;a<this._numItems;a++)b[a]=this._qMatrix[a][0].qText;return"$mercator"!==this._geoData.qMeasureInfo[0].projection?this._geoRegionsData.calculateProjectedBoundsOfRegionIds(b):this._geoRegionsData.calculateBoundsOfRegionIds(b)}function l(){return this._qData&&this._qData.qDimensionInfo&&this._qData.qDimensionInfo[0]?this._dimensionTitle!==this._qData.qDimensionInfo[0].qFallbackTitle&&(this._dimensionTitle=this._qData.qDimensionInfo[0].qFallbackTitle,!0):void 0!==this._dimensionTitle&&(this._dimensionTitle=void 0,!0)}function m(){var a=this._geoData.qMeasureInfo.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._geoData.qMeasureInfo[a-1])?(this._geometryMeasureInfo=this._geoData.qMeasureInfo[a-1],!0):!this._rawGeoRegions&&!this._loadingGeometryData}function n(a){var b,c=a?a.length:0;for(b=0;b<c;b++)a[b]=new d(a[b][0],a[b][1]);return new e(a)}function o(a){var b,c=a?a.length:0,d=new Array(c);for(b=0;b<c;b++)d[b]=n(a[b]);return new h(d)}function p(a,b){var c,d,e="-"===b?[]:JSON.parse(b),g=e.length;for(c=0;c<g;c++)e[c]=o(e[c]);return d=new f(e,a)}function q(a){this._rawGeoRegions=a,this._geoRegionsData.setGeoRegions(a),"$mercator"!==this._geoData.qMeasureInfo[0].projection&&this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._allItemsS2Bounds=this._geoRegionsData.calculateProjectedBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function r(){var a=this,b=this._layerIndex,c=Math.min(this._geoData.qSize.qcy||w,w),d=[{qTop:0,qLeft:0,qWidth:2,qHeight:c}];this._loadingGeometryData=!0;var e=i();return this.backendApi.getData(d,"/layers/"+b+"/geodata/qHyperCubeDef").then(function(b){if(!a.backendApi||!a._viewportProjection)return void e.resolve();a._loadingGeometryData=!1,a._rawGeoRegions={};var c,d,f,g,h,j=0,k=b?b instanceof Array&&b[0]?b[0].qMatrix:b.qMatrix:void 0;for(h=k?k.length:0,a._geoDataCubeMatrix=k,a._numRegions=h,a._geometryDimensionIdx=1,f=new Array(h),c=0;c<h;c++)g=k[c][0].qText,d=k[c][a._geometryDimensionIdx].qText,f[c]=p(g,d),f[c].validateGeoPolygons(),j+=f[c].getNumPoints();q.call(a,f),a._dataChanged=!0,a.fire("dataChanged"),a._numPoints!==j&&(a._numPoints=j,a.fire("numPointsChanged",[a])),i.all([a.invalidateProperties("MapPolygonLayer.setGeoRegionsData"),a.invalidateDisplay("MapPolygonLayer.setGeoRegionsData")]).then(function(){e.resolve()})}),e.promise}function s(a,b){var c,d,f,g,i,j,k,l,m,n=a?a.length:0,o=new Array(n);for(j=0;j<n;j++){for(c=a[j],d=c?c.length:0,m=new Array(d),k=0;k<d;k++){for(f=c[k],i=f?f.length:0,g=new Array(i),l=0;l<i;l++)g[l]=this._viewportProjection.project(f[l]);m[k]=new e(g)}o[j]=new h(m)}b.setGeoPolygons(o)}function t(a){return void 0===a||null===a||""===a}function u(a,c,d,e,f){var g=new b([a],[],[],[],c,0,d);return g.selected=!1,g.layerIndex=f,g.addShape("dataArea",e,!0),g}var v,w=3333,x="#ddd",y=new c(x),z="#333",A="#333";return v=a.extend("MapPolygonLayer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new g,this.renderers={polygonlayer:this._renderer},this._numRegions=0},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/geodata/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(a,b){return this._super(a,b),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._geoData=this._layerData?this._layerData.geodata.qHyperCube:void 0,this._qMatrix=this._qData&&this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._numItems=this._qMatrix?this._qMatrix.length:0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._hasMeasure=this._qMeasureInfo&&this._qMeasureInfo.length>0,this._geoDataHeight=this._geoData&&this._geoData.qSize?this._geoData.qSize.qcy:0,this._showExcluded=void 0===b.showExcluded||b.showExcluded,this.show&&(this._geoDataHeight!==this._numRegions||l.call(this)||m.call(this))?r.call(this):(this._dataChanged=!0,this.fire("dataChanged"),this.invalidateProperties("MapPolygonLayer.setData"))},hasValidData:function(){return this._super()&&this._layerData},getNumSelectedItems:function(){return this._numSelectedItems},getSelectedCacheItem:function(){return this._selectedCacheItem},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||!this._geoData||!this._geoData.qMeasureInfo||0===this._geoData.qMeasureInfo.length||t(this._geoData.qMeasureInfo[0].qFallbackTitle))return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),0!==this._numRegions){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=this._geoDataCubeMatrix,p=this._hasMeasure?0:-1,q=[],r=[],u=0,v=0;for(n=this._rowIndexList?this._rowIndexList.length:0,this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections||this._nodes.some(function(a){return a.cacheItem.selected}),a=0;a<n;a++)b=this._rowIndexList[a],isNaN(b)||null===b||(c=o[b],d=c[0],e=d.qText,f=this._nodeMap[e],g=f.shapeWrapper,h=g.shape,i=this._geoRegionsData.getProjectedGeoRegionById(e),s.apply(this,[i,h]),j=f.cacheItem,k=f.index!==-1,m=f.color,!k&&j.selected&&(m=this._colorMap.getColor(d.qElemNumber,NaN,p,b)),g.fill=m.toRGBA(),this._selectionByLayer?(l=j.selected,g.stroke=l?A:z,g.strokeWidth=l?2:1):(l=k,g.stroke=z,g.strokeWidth=1),l?(g.opacity=1,r[v++]=g):(g.opacity=this._globalAlpha,q[u++]=g));this._rendererShapes=q.concat(r),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1}}},getSnapshotLayerData:function(a){var b=Math.min(this._geoData.qSize.qcy||w,w);return this.backendApi.getData([{qTop:0,qLeft:0,qWidth:2,qHeight:b}],"/layers/"+this._layerIndex+"/geodata/qHyperCubeDef").then(function(b){a.geodata.qHyperCube.qDataPages=b})},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var a,b,c,d,e,g,h,i,k,l,m,n,o,p,q=this._geoDataCubeMatrix,r=this._qData&&this._qData.qDimensionInfo&&this._qData.qDimensionInfo[0],s=this._hasMeasure?0:-1,t=this._hasMeasure?this._qMeasureInfo[0].qFallbackTitle:"";if(this._regionsChanged=!0,this._numSelectedItems=0,this._regionIdDictionary={},this._nodeMap={},this._showExcluded)for(this._nodes=new Array(this._numRegions),m=new Array,this._rowIndexList=new Array(this._numRegions),a=0;a<this._numRegions;a++)c=q[a],d=c[0],g=d.qText,h=d.qElemNumber||0,i=new f(void 0,g),i.rowIndex=a,l=u(g,a,h,i,this._layerIndex),m[a]=l,k={type:"multipolygon",shape:i},this._nodeMap[g]=this._nodes[a]={shapeWrapper:k,cacheItem:l,color:y,index:-1},this._rowIndexList[a]=a;else{for(q=this._qMatrix,a=0;a<this._numItems;a++)g=q[a][0].qText,this._regionIdDictionary[g]=!0;for(this._nodes=new Array(this._numItems),m=new Array,this._rowIndexList=new Array(this._numItems),b=0,q=this._geoDataCubeMatrix,a=0;a<this._numRegions;a++)c=q[a],d=c[0],g=d.qText,this._regionIdDictionary[g]&&(h=d.qElemNumber||0,i=new f(void 0,g),i.rowIndex=a,l=u(g,a,h,i,this._layerIndex),m[b]=l,k={type:"multipolygon",shape:i},this._nodeMap[g]=this._nodes[b]={shapeWrapper:k,cacheItem:l,color:y,index:-1},this._rowIndexList[b]=a,b++)}for(q=this._qMatrix,a=0;a<this._numItems;a++)c=q[a],d=c[0],e=c[1],g=d.qText,o=this._nodeMap[g],o&&(l=o.cacheItem,n=this._hasMeasure?e.qNum:null,o.color=this._colorMap.getColor(d.qElemNumber,n,s,a),this._hasMeasure&&l.addMeasure(t,n,e.qText),d.qAttrDims&&r.qAttrDimInfo&&r.qAttrDimInfo.length&&d.qAttrDims.qValues.forEach(function(a,b){l.addAttributeDimension(a.qElemNo,a.qText,r.qAttrDimInfo[b].qFallbackTitle)}),d.qAttrExps&&r.qAttrExprInfo&&r.qAttrExprInfo.length&&d.qAttrExps.qValues.forEach(function(a,b){l.addMeasure(r.qAttrExprInfo[b].label,a.qNum)}),o.index=a,this._selectedCacheItem=l);this._numSelectedItems=this._numItems,this.setSelectableShapes(m),this.fire("selectableShapesChanged"),this._dataChanged=!1,p=j.call(this),p&&p.equal(this._layerS2Bounds)||(this._layerS2Bounds=p,!this._layerS2Bounds||0===this._layerS2Bounds.width&&0===this._layerS2Bounds.height||this.fire("boundsChanged",[this]))}}})}),define("core.models/session-object",["core.models/generic-object","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("SessionObject",{remove:function(){return c.remove(this.id,b.current)}}),c.get=function(a,c){function d(){return c.enigmaModel.createSessionObject(a)}var e=a.qInfo.qId||a.qInfo.qType;if(!e)throw new Error("no id");return a.qInfo.qId=e,c=c||b.current,this.getModel(e,c.session,d)},c.remove=function(b,c){return a.remove(b,"DestroySessionObject",c)},c.extend=function(){var b=a.extend.apply(this,arguments);return b.get=c.get,b.remove=c.remove,b},c}),define("extensions.qliktech/map/map-glyph-layer",["extensions.qliktech/map/map-layer","extensions.qliktech/scatterplot/scatter-helper","objects.views/selections/cache-item-combo","general.utils/shapes/rect","core.models/session-object"],function(a,b,c,d,e){"use strict";function f(){var a,b,c,e,f,g=Number.MAX_VALUE,h=Number.MAX_VALUE,i=-Number.MAX_VALUE,j=-Number.MAX_VALUE;for(a=0;a<this._numItems;a++)b=this._nodes[a].shapeWrapper.shape,c=b.position,!c||isNaN(c.x)||isNaN(c.y)||(g=Math.min(g,c.x),h=Math.min(h,c.y),i=Math.max(i,c.x),j=Math.max(j,c.y));return g===Number.MAX_VALUE||h===Number.MAX_VALUE||i===-Number.MAX_VALUE||j===-Number.MAX_VALUE?void 0:(e=i-g,f=j-h,0===e&&this._wholeBoundingBox&&this._totalNumPoints&&(e=Math.abs(this._wholeBoundingBox.qRight-this._wholeBoundingBox.qLeft)/this._totalNumPoints,g-=e/2),0===f&&this._wholeBoundingBox&&this._totalNumPoints&&(f=Math.abs(this._wholeBoundingBox.qTop-this._wholeBoundingBox.qBottom)/this._totalNumPoints,h-=f/2),new d(g,h,e,f))}function g(){var a,c,d,e,f,g=3,h=1;for(a=0;a<this._numItems;a++)if(d=this._nodes[a].shapeWrapper.shape)if(0===d.type)d.position?(e=this._viewportProjection.project(d.position),d.setPosition(e.x,e.y)):d.setPosition(NaN,NaN);else if(d.position){if(e=this._viewportProjection.project(d.position),f=d.points,!f||13!==f.length)for(f=new Array(13),c=0;c<13;c++)f[c]={};f=b.updateCross(f,e.x,e.y,g,h),d.set(f)}else d.set([])}function h(){this._hasMeasure?void 0===this._layerData.autoMinMax||this._layerData.autoMinMax===!0?(this._qMin=this._qMeasureInfo[0].qMin,this._qMax=this._qMeasureInfo[0].qMax):(this._qMin=void 0===this._layerData.customMin?0:this._layerData.customMin,this._qMax=void 0===this._layerData.customMax?10:this._layerData.customMax):(this._qMin=void 0,this._qMax=void 0)}function i(){return!isNaN(this._qMin)&&void 0!==this._qMin&&null!==this._qMin&&(!isNaN(this._qMax)&&void 0!==this._qMax&&null!==this._qMax&&!(this._qMax<this._qMin))}function j(){if(!this.backendApi||!this.backendApi.isSnapshot){var a=this,b=a._layerS2Bounds.x,c=a._layerS2Bounds.y,f=a._layerS2Bounds.width,g=a._layerS2Bounds.height;if(f>0||g>0)return f>0?(g=f/2,c-=g/2):g>0&&(f=g/2,b-=f/2),a._layerS2Bounds=new d(b,c,f,g),void a.fire("boundsChanged",[a]);var h=this._qDimensionInfo[1].qFallbackTitle;"="===h.substr(0,1)&&(h=h.substr(1)),"geomakepoint"!==h.substr(0,12).toLowerCase()&&(h="["+h+"]"),e.get({qInfo:{qId:h,qType:"PointStats"},pointsStatistic:{boundingBox:{qStringExpression:"GeoBoundingBox({1}"+h+")"},numPoints:{qValueExpression:"Count({1}"+h+")"}}}).then(function(b){return b.getLayout().then(function(b){var c=JSON.parse(b.pointsStatistic.boundingBox);if(!a._geoDataIsProjectedToS2){var e,f,g;e=a._viewportProjection.getMercatorProjection(),f=e.project({x:c.qLeft,y:c.qBottom}),g=e.project({x:c.qRight,y:c.qTop}),c.qLeft=f.x,c.qRight=g.x,c.qBottom=f.y,c.qTop=g.y}if(a._wholeBoundingBox=c,a._totalNumPoints=b.pointsStatistic.numPoints,a._layerS2Bounds&&(0===a._layerS2Bounds.width||0===a._layerS2Bounds.height)){var h,i,j,k;j=Math.abs(a._wholeBoundingBox.qRight-a._wholeBoundingBox.qLeft)/a._totalNumPoints,h=a._layerS2Bounds.x-j/2,k=Math.abs(a._wholeBoundingBox.qTop-a._wholeBoundingBox.qBottom)/a._totalNumPoints,i=a._layerS2Bounds.y-k/2,a._layerS2Bounds=new d(h,i,j,k),a.fire("boundsChanged",[a])}})})}}var k,l=3333,m="#333";return k=a.extend("MapPointLayer",{init:function(){this._super.apply(this,arguments),this.renderers={pointlayer:this._renderer},this._layerS2Bounds=void 0,this._useSize=!0},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(a,b){return this._super(a,b),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._qMatrix=this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._qDimensionInfo=this._qData?this._qData.qDimensionInfo:void 0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._numMeasures=this._qMeasureInfo?this._qMeasureInfo.length:0,this._hasMeasure=!!(this._numMeasures>0&&this._qMeasureInfo[0].qFallbackTitle),this._data&&this._data.color&&!this._data.color.persistent&&(this._data.color.persistent=!0),h.call(this),this._isValidMinMax=i.call(this),this._qRange=this._qMax-this._qMin,this._numItems=this._qMatrix?this._qMatrix.length:0,this._needUpdateProperties=!0,this._needPaint=!0,this._hasMeasure&&this._useSize?this._maxDotSize=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32:this._maxDotSize=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this.fire("dataChanged"),this.invalidateProperties("MapPointLayer.setData")},hasValidData:function(){return this._super()&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle},getNumSelectedItems:function(){return this._numItems},getLayerBounds:function(){var a,b,c,d,e;return a=this._viewportProjection.getSize(),this._layerS2Bounds?(this._layerS2Bounds2=this._layerS2Bounds.clone(),a&&(e=2*(this._maxDotSize+1),c=a.x-e,d=a.y-e,b=Math.min(c/this._layerS2Bounds.width,d/this._layerS2Bounds.height),c=b*this._layerS2Bounds.width,d=b*this._layerS2Bounds2.height,b=Math.min(a.x/c,a.y/d),this._layerS2Bounds2.scale(b)),this._layerS2Bounds2):this._layerS2Bounds},paint:function(){if(this._super(this._layoutMode,this._data),!(this.show&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle&&this._viewportProjection&&0!==this._qMatrix.length&&void 0!==this._qMatrix[0][1]))return this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,this.clear();if(void 0===this._nodes&&this._updateProperties(),void 0!==this._nodes){var a,b,c,d,e,f,h,i,j,k=[],l=[],n=0,o=0;for((this._glyphsChanged||this._viewportProjectionChanged)&&g.call(this),a=0;a<this._numItems;a++)b=this._nodes[a],i=b.shapeWrapper,j=i.shape,j&&j.position&&(c=b.color,d=b.cacheItem.selected,d?(e=m,f=2,h=1,l[o++]=i):(e=c.createShiftedColor().toRGBA(),f=1,h=this._globalAlpha,k[n++]=i),i.stroke=e,i.strokeWidth=f,i.opacity=h);this._rendererShapes=0===this._numItems?[]:k.concat(l),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,this.afterPaint()}},setRect:function(a,b,c,d){this._super(a,b,c,d),this.rect&&this.rect.x===a&&this.rect.y===b&&this.rect.width===c&&this.rect.height===d||!this._layerS2Bounds||0===this._layerS2Bounds.width&&0===this._layerS2Bounds.height||this.fire("boundsChanged",[this])},getSnapshotLayerData:function(a){var b=Math.min(this._qData.qSize.qcy||l,l);return this.backendApi.getData([{qTop:0,qLeft:0,qWidth:3,qHeight:b}],"/layers/"+this._layerIndex+"/qHyperCubeDef").then(function(b){a.qHyperCube.qDataPages=b})},_updateProperties:function(){if(this.show&&this._needUpdateProperties&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle){var a,d,e,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=this._qMatrix,A=this._hasMeasure?0:-1,B=this._qDimensionInfo&&this._qDimensionInfo[1],C="polygon",D="circle";for(v=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[0]?this._layerData.rangeBubbleSizes[0]:2,w=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32,u=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this._useSize=this._layerData.useSize,this._glyphsChanged=!0,this._nodes=new Array(this._numItems),n=[],o={},p=0,this._geoDataIsProjectedToS2=this._qDimensionInfo&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qTags&&this._qDimensionInfo[1].qTags.indexOf("$mercator")>-1,s=this._viewportProjection.getMercatorProjection(),x=this._hasMeasure&&this._useSize,d=0;d<this._numItems;d++)g=z[d][0].qText,h=z[d][0].qElemNumber||0,i=z[d][2]?z[d][2].qNum:void 0,a=z[d][1],x?this._isValidMinMax?(t=b.getDotRadius(i,this._qMin,this._qMax,v,w),isNaN(t)?(k=b.createShape(C),k.type=1,l=C):(k=b.createShape(D,[0,0,t,0]),k.type=0,l=D)):(k=b.createShape(C),k.type=1,l=C):(k=b.createShape(D,[0,0,u,0]),k.type=0,l=D),"-"===z[d][1].qText?k.position=void 0:(e=z[d][1].qText.replace(/^\[|\]$/g,"").split(","),k.position=this._geoDataIsProjectedToS2?{x:e[0],y:e[1]}:s.project({x:Number(e[0]),y:Number(e[1])})),k.rowIndex=d,o[g]?m=o[g].cacheItem:(m=new c([g],[],[],[],d,0,h),m.selected=!1,m.layerIndex=this._layerIndex,o[g]={cacheItem:m,numShapes:0},n[p++]=m),m.addShape("dataArea",k,!0,[o[g].numShapes]),o[g].numShapes++,this._hasMeasure&&m.addMeasure(this._qMeasureInfo[0].qFallbackTitle,z[d][2].qNum,z[d][2].qText),a.qAttrDims&&B.qAttrDimInfo&&B.qAttrDimInfo.length&&a.qAttrDims.qValues.forEach(function(a,b){m.addAttributeDimension(a.qElemNo,a.qText,B.qAttrDimInfo[b].qFallbackTitle);
}),a.qAttrExps&&B.qAttrExprInfo&&B.qAttrExprInfo.length&&a.qAttrExps.qValues.forEach(function(a,b){m.addMeasure(B.qAttrExprInfo[b].label,a.qNum)}),r=this._colorMap.getColor([z[d][0].qElemNumber,a.qElemNumber],i,A,d),q={type:l,fill:r.toRGBA(),shape:k},this._nodes[d]={shapeWrapper:q,cacheItem:m,color:r};this.setSelectableShapes(n),this.fire("selectableShapesChanged"),this._geofieldName!==this._qDimensionInfo[1].qFallbackTitle&&(this._geofieldName=this._qDimensionInfo[1].qFallbackTitle,this._wholeBoundingBox=void 0,this._totalNumPoints=void 0),this._dimensionTitle=this._qDimensionInfo[0].qFallbackTitle,this._needUpdateProperties=!1,y=f.call(this),y&&y.equal(this._layerS2Bounds)||(this._layerS2Bounds=y,!this._layerS2Bounds||0!==this._layerS2Bounds.width&&0!==this._layerS2Bounds.height||this._wholeBoundingBox?this.fire("boundsChanged",[this]):j.call(this))}}})}),define("extensions.qliktech/map/wmts-provider",[],function(){"use strict";var a={getTileUrl:function(a){return"https://cartobase-"+(a?a:"a")+".global.ssl.fastly.net/light_all/${z}/${x}/${y}.png?api_key=837eb4e1cc983921567462bd3557215b06cccaea"},getAttributionLink:function(){return"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors, &copy; <a href='http://cartodb.com/attributions'>CartoDB</a>"}};return a}),define("extensions.qliktech/map/base-map-layer",["jquery","angular","objects.views/charts/components/chart-component","general.utils/shapes/rect","general.utils/shapes/point","openlayers","client.services/media-tool/media-tool-service","./wmts-provider","core.utils/deferred"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a,b,c,d;a=this._viewportProjection?this._viewportProjection.getViewRectangleInLatLong():void 0,a&&(b=new f.Geometry.Point(a.x,a.y),b.transform(A,z),c=new f.Geometry.Point(a.x+a.width,a.y+a.height),c.transform(A,z),d=new f.Bounds,d.extend(b),d.extend(c),d.toBBOX(),this._openLayers.zoomToExtent(d))}function k(){f.Map.prototype.adjustZoom=function(a){return a};var a=f.Element.hasClass;f.Element.hasClass=function(b,c){return b&&a(b,c)};var b=f.Event.observe;f.Event.observe=function(a,c,d,e){var g=f.Util.getElement(a);g&&b.apply(this,[a,c,d,e])},z=new f.Projection("EPSG:900913"),A=new f.Projection("EPSG:4326")}function l(a){this._attribution=g.toHTML(a),this.fire("attributionChanged",[a])}function m(){var a,b;a=this._viewportProjection.getZoomLevel(),b=this._viewportProjection.getMapCenterInLatLong(),this.setMapCenter(b),this.setZoomLevel(a)}function n(){if(this._viewportProjection&&this.show){var a,b,c,d,e=!1;a=this.getZoomLevel(),b=this.getMapCenter(),c=this._viewportProjection.getZoomLevel(),d=this._viewportProjection.getMapCenterInLatLong(),b||(b=d),Math.abs(a-c)<.001&&(!d||d.closeTo(b,1e-6))||(this._viewportProjection.enabledChangeEvent=!1,e=e||this._viewportProjection.setZoomLevel(a),e=e||this._viewportProjection.setMapCenterInLatLong(b),this._viewportProjection.inResetZoomMode&&(this._viewportProjection.inResetZoomMode=!1,this._viewportProjection.fire("resetZoomFinished")),e&&this._viewportProjection.fire("changed"),this._viewportProjection.enabledChangeEvent=!0)}}function o(){this._dfd&&(this._dfd.resolve(),this._dfdResolved=!0),this._dfdPaint&&this._dfdPaint.resolve()}function p(){clearTimeout(this._safeGuardTimer)}function q(){if(this._openLayers&&this._openLayers.tileManager){var a=this._openLayers.tileManager.tileQueue[this._openLayers.id];if(a&&a.length)return}o.call(this)}function r(){clearTimeout(this._safeGuardTimer);var a=this;this._safeGuardTimer=setTimeout(function(){o.call(a)},500)}function s(){clearTimeout(this._safeGuardTimer);var a=this;this._safeGuardTimer=setTimeout(function(){o.call(a)},500)}function t(a){u.call(this),a.events.register("loadend",this,n),a.events.register("loadstart",this,p),a.events.register("loadend",this,q),a.events.register("moveend",this,r),this._openLayers.events.register("updatesize",this,s),this._openLayers.addLayer(a),this._openLayers.setBaseLayer(a),this._baseLayer=a}function u(){this._baseLayer&&(this._openLayers.removeLayer(this._baseLayer),this._baseLayer.events.unregister("loadend",this,n),this._baseLayer.events.unregister("loadstart",this,p),this._baseLayer.events.unregister("loadend",this,q),this._baseLayer.events.unregister("moveend",this,r)),this._openLayers.events.unregister("updatesize",this,s),this._baseLayer=void 0}function v(a,c){var d,e=a.urls,g=a.attribution||"";this._urls===e&&this._attribution===g||(b.equals(this._urls,e)||(this._urls=e,this._urls&&this._urls.some(function(a){return a&&a.trim()})?(d=new f.Layer.XYZ("XYZ",this._urls,{numZoomLevels:c,wrapDateLine:!0}),t.call(this,d)):u.call(this)),this._attribution!==g&&l.call(this,g))}function w(a){var c,d=a.urls,e=a.params||"";try{e=JSON.parse(e)}catch(g){return}this._urls===d&&this._params===e||(this._params=e,b.equals(this._urls,d)||(this._urls=d,this._urls?(c=new f.Layer.WMS("WMS",this._urls,this._params),t.call(this,c)):u.call(this)))}function x(a){var c,d=a.urls,e=a.params||"";try{e=JSON.parse(e)}catch(g){return}b.equals(this._urls,d)||(this._params=e,this._urls!==d&&(this._urls=d,this._urls?(c=new f.Layer.TMS("TMS",this._urls?this._urls:"blank",this._params),t.call(this,c)):u.call(this)))}var y,z,A,B,C=1e-9,D=1e-4,E=19,F=0;return k(),y=c.extend("BaseMapLayer",{init:function(){function b(){B=new f.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}}),c._openLayers=new f.Map({div:c.container,transitionEffect:null,zoomMethod:null,controls:[B],projection:new f.Projection("EPSG:900913"),displayProjection:new f.Projection("EPSG:4326"),maxExtent:new f.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),displayOutsideMaxExtent:!0,numZoomLevels:E+1,wrapDateLine:!0}),!c._on&&c._openLayers.controls.length&&B.deactivate(),c._minZoomLevel=0,c._maxZoomLevel=E,j.call(c),c._zoomCenterInitialized=!1,c._viewportProjection&&(c.updateViewportToBaseMap(!1),c._zoomCenterInitialized=!0),c._ready=!0}this._super.apply(this,arguments),this._attribution=null,this._mapCenter=null,this._zoomLevel=null,this._layerNames=["OSM","MQ-OSM","MQSatellite"],this._selectedLayerName="OSM",this._googleMapLayersAdded=!1,this._isBingMapUsed=!1,this._needToSetBackgroundMapType=!1;var c=this;a(this.container).css({width:"100%",height:"100%"}),b()},getAttribution:function(){return void 0===this._attribution?"":this._attribution},setViewportProjection:function(a){this._viewportProjection!==a&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",m,this),this._viewportProjection.stopListen("changedByInteraction",m,this)),this._viewportProjection=a,this._viewportProjection&&(this._viewportProjection.listen("changed",m,this),this._viewportProjection.listen("changedByInteraction",m,this)),this.updateViewportToBaseMap(!0))},setRect:function(a,b,c,e){this._super(a,b,c,e),this._viewport=new d(a,b,c,e)},getViewport:function(){return this._viewport},setFirstAutoZoomed:function(a){this._firstAutoZoomed=a},getFirstAutoZoomed:function(){return this._firstAutoZoomed},hasValidSize:function(){if(!this._openLayers)return!1;var a=this._openLayers.getSize();return a&&a.w>0&&a.h>0},isReady:function(){return this._ready&&this._openLayers&&this._openLayers.layers&&this._openLayers.layers.length>0&&this._baseLayer},on:function(){this._on=!0},off:function(){this._on=!1,this._openLayers&&0!==this._openLayers.controls.length&&B.deactivate()},showComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!0),this.updateViewportToBaseMap(!0)},hideComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!1)},getMapCenter:function(){if(this.show&&this.isReady()&&this.hasValidSize()){var a=this._openLayers.getCenter();if(a)return a.transform(this._openLayers.getProjectionObject(),A),new e(a.lon,a.lat)}},setMapCenter:function(a){if(!(a&&this.show&&this.isReady()&&this.hasValidSize()))return!1;var b,c;return b=this.getMapCenter(),(!b||!b.closeTo(a,C))&&(this._mapCenter=a,c=new f.LonLat(a.x,a.y),c.transform(A,this._openLayers.getProjectionObject()),this._openLayers.setCenter(c),!0)},getZoomLevel:function(){return this.show&&this.isReady()&&this.hasValidSize()?this._openLayers.zoom:0},setZoomLevel:function(a){return!(!(this.show&&this._openLayers&&this.hasValidSize())||Math.abs(this.getZoomLevel()-a)<D||!this.isReady())&&(this._zoomLevel=a,this._openLayers.zoomTo(a),!0)},panBy:function(a,b){return!!(this.show&&this.isReady()&&this.hasValidSize())&&(this._openLayers.moveByPx(a,b),!0)},fromLatLongToViewport:function(a){if(this.show&&this.isReady()&&this.hasValidSize()){var b,c;return b=new f.LonLat(a.x,a.y),b.transform(A,this._openLayers.getProjectionObject()),c=this._openLayers.getViewPortPxFromLonLat(b),new e(c.x,c.y)}},fromViewportToLatLong:function(a){if(this.show&&this.isReady()&&this.hasValidSize()){var b,c,d;return b=new f.Pixel(a.x,a.y),c=this._openLayers.getLonLatFromViewPortPx(b),d=this._openLayers.getProjectionObject(),c.transform(d,A),new e(c.lon,c.lat)}},updateViewportToBaseMap:function(a){var b,c,d,e,f=!1;return this._viewportProjection&&this.isReady()?(c=this._viewportProjection.getZoomLevel(),b=this._viewportProjection.getMapCenterInLatLong(),b=b?b:{x:0,y:0},c=Math.min(E,Math.max(F,c)),this.setMapCenter(b),this.setZoomLevel(c),a&&(d=this.getMapCenter(),e=this.getZoomLevel(),this._viewportProjection.enabledChangeEvent=!1,Math.abs(e-c)>D&&(f=f||this._viewportProjection.setZoomLevel(e)),d&&b&&!d.closeTo(b)&&(f=f||this._viewportProjection.setMapCenterInLatLong(d)),f&&(this._viewportProjection.fire("changedByBaseMap"),this._viewportProjection.fire("changedByInteraction")),this._viewportProjection.enabledChangeEvent=!0),f):f},setData:function(a){this._super(a),this._dfdResolved||(clearTimeout(this._safeGuardTimer),o.call(this)),this._dfd=i(),this._dfdResolved=!1;var b,c,d,e;if(d=this._data.background.defaultMapService,d?(b={urls:[h.getTileUrl("a"),h.getTileUrl("b"),h.getTileUrl("c"),h.getTileUrl("d")],type:"XYZ",attribution:h.getAttributionLink()},c="XYZ"):(b=this._data.background.layers?this._data.background.layers[0]:{},c=b.type||"XYZ"),b&&(this._urls||b.urls))switch(c){case"XYZ":v.call(this,b,d?23:E+1);break;case"WMS":w.call(this,b);break;case"TMS":x.call(this,b)}if(this._openLayers&&this._baseLayer&&(F=this._openLayers.getMinZoom(),E=this._openLayers.getNumZoomLevels()+F-1,this._minZoomLevel===F&&this._maxZoomLevel===E||(this._minZoomLevel=F,this._maxZoomLevel=E,this.fire("maxMinZoomLevelChanged",[E,F]))),e=this._data&&this._data.background&&this._data.background.show&&(d||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(a){return a&&a.trim()}))){this.showComponent();var f=this;clearTimeout(this._safeGuardTimer),this._safeGuardTimer=setTimeout(function(){o.call(f)},500)}else this.hideComponent(),o.call(this);return this.fire("baseLayerChanged"),this.invalidateProperties("BaseMapLayer.setData"),this._dfd.promise},hasValidData:function(){return!0},paint:function(){this._super(this._layoutMode);var a,b,c;return this._openLayers&&(a=this._openLayers.getSize(),b=a.w,c=a.h,b!==this.rect.width||c!==this.rect.height)?(this._dfdPaint=i(),this._openLayers.updateSize(),this._dfdPaint.promise):i.resolve()},afterPaint:function(){},release:function(){this._super(),clearTimeout(this._safeGuardTimer),u.call(this),B.destroy(),this._openLayers.destroy()}})}),define("extensions.qliktech/map/layer-dependency",["objects.views/charts/events/event-launcher"],function(a){"use strict";function b(){this._layer&&(this._colorMapData=this._layer.getLayerOutputData(),this.fire("changed"))}var c;return c=a.extend("LayerDependency",{init:function(){this._super()},setLayer:function(a){this._layer!==a&&(this._layer&&this._layer.stopListen("dataChanged",b,this),this._layer=a,this._layer&&this._layer.listen("dataChanged",b,this))},getColorMapData:function(){return this._colorMapData},release:function(){this._layer&&this._layer.stopListen("dataChanged",b,this),this._layer=null}})}),define("extensions.qliktech/map/map-area",["jquery","objects.views/charts/components/chart-component","general.utils/shapes/rect","core.utils/deferred","extensions.qliktech/map/map-polygon3-layer","extensions.qliktech/map/map-glyph-layer","extensions.qliktech/map/base-map-layer","extensions.qliktech/map/layer-dependency","objects.views/charts/utils/chart-formatting","touche"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){switch(a.type){case"polygon":return e;case"point":return f}return null}function k(a){var b;a.setLayoutMode(this._layoutMode),b=this.rect,a.setRect(b.x,b.y,b.width,b.height),b=this.outerRect,a.setOuterRect(b.x,b.y,b.width,b.height),b=this.containerRect,a.setContainerRect(b.x,b.y,b.width,b.height),b=this.layoutToContainerRatios,a.setLayoutToContainerRatios(b.x,b.y),a.setViewportProjection(this._viewportProjection)}function l(a,b,c,d){var e="layer."+d+"."+b+(void 0===c?"":c),f=new a(this.layersContainer,{clazz:a},e);return f.setLayerType(b),f.setVersion(c),f}function m(){var a,b,c,d,e,f,h,i;for(b=this._data?this._data.layers:null,d=b?b.length:0,d=Math.min(d,this._maxNumLayers),!this.baseMapLayer&&this._data&&this._data.background&&this._data.background.show&&(this._data.background.defaultMapService||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(a){return a&&a.trim()}))&&(this.addBaseMapLayer(new g(this.layersContainer,{clazz:g},"BaseMapLayer")),this.addAttributionLayer(document.createElement("div"))),a=0;a<d;a++)c=b[a],f=c.type,h=c.version,i=j(c),i&&(e=this.layers[a],e?e.getLayerType()===f&&e.getVersion()===h||this.removeLayer(e,!0):(e=l.apply(this,[i,f,h,a]),this.addLayer(e,a)));if(this._numLayers>d)for(a=d;a<this._numLayers;a++)e=this._layers[a],e&&this.removeLayer(e);this._numLayers=d,this.attributionLayer&&this.container.appendChild(this.attributionLayer)}function n(){for(var a=[],b=0;b<this._numLayers;b++)a.push(this.layers[b].setData(this._data,this._data.layers[b]));return this.baseMapLayer&&(a.push(this.baseMapLayer.setData(this._data)),u.call(this)),d.all(a)}function o(){this._numLayers<1||this.layers[this._numLayers-1].updateBackendApi()}function p(a,b){var c,d,e,f,g,h,i,j;a&&(c=a.x,d=a.x+a.width,e=a.y,f=a.y+a.height,g=b.x,h=b.x+b.width,i=b.y,j=b.y+b.height,c<g&&(c=g),d>h&&(d=h),e<i&&(e=i),f>j&&(f=j),a.set(c,e,d-c,f-e))}function q(){var a,b;for(a=0;a<this._numLayers;a++)b=this.layers[a],b&&!b.hasValidData()&&b.clear()}function r(){var a,b,c=Math.min(this._numLayers,this._maxNumLayers);for(a=0;a<c;a++)if(b=this._data.layers[a],b&&b.qHyperCube&&b.qHyperCube.qDimensionInfo&&b.qHyperCube.qDimensionInfo.length>0)return this.layers[a]}function s(){var a=this._colorMap.getLegendDataProvider();a.setLegendMarker("point"===this.coloredLayer.getLayerData().type?"circle":"rect")}function t(a,b){this._interactionController.setMaxZoomLevel(a),this._interactionController.setMinZoomLevel(b)}function u(){this.attributionLayer.innerHTML=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady()?this.baseMapLayer.getAttribution():""}function v(){var a=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady();this.map.setFractionalZoomMode(!a)}function w(){this.updateSelectableShapes()}function x(){var a,b,c,d,e,f,g=!1,h=!1,i=this._changedBoundsLayers?this._changedBoundsLayers.length:0;if(this.layersReady&&0!==i){for(b=0;b<this._numLayers;b++)this.layers[b].isVisible()&&(c=this.layers[b].getLayerBounds(),c&&(d=d?d.union(c):c.clone()));if(p.apply(this,[d,this._worldBounds]),void 0===d&&void 0===this._unionBounds?this._unionBounds=this._worldBounds:this._unionBounds=d,this._unionBounds&&this._unionBounds.hasNaN()&&(this._unionBounds=this._worldBounds),this.map.isSnapshot()||this.map.options.viewState)try{e=(this.map.options.viewState||this.map.getSnapshotStoredChartData()).mapRect}catch(j){}if(f=e&&void 0!==e.width&&void 0!==e.height&&void 0!==e.x&&void 0!==e.y,this._unionBounds&&void 0!==d){for(b=0;b<i;b++)a=this._changedBoundsLayers[b],a&&(g=!0,a.getFirstAutoZoomed()&&!this.map.getAutoZoomOnDataChange()||(this._unionBounds.width||this._unionBounds.height)&&(h=!0,a.setFirstAutoZoomed(!0)));g&&this.map.setMapBounds(this._unionBounds),h&&!f&&this.map.zoomOnMapBounds()}else 0===i&&this.baseMapLayer&&void 0===d&&!this.baseMapLayer.getFirstAutoZoomed()&&((void 0===this._unionBounds||this._unionBounds.hasNaN())&&(this._unionBounds=this._worldBounds),this.map.setMapBounds(this._unionBounds),!this._unionBounds.width||!this._unionBounds.height||this.map.isSnapshot()&&f||(this.map.zoomOnMapBounds(),this.baseMapLayer.setFirstAutoZoomed(!0)));this._changedBoundsLayers=[]}}function y(a){this._changedBoundsLayers.indexOf(a)===-1&&(this._changedBoundsLayers.push(a),x.call(this))}function z(){var a,b,c,d=0;for(a=0;a<this._numLayers;a++)b=this.layers[a],c=b&&b.getNumPoints?b.getNumPoints():0,d+=c;this.map.setZoomPanByWebkitTransform(d>E)}function A(){var a=this._layerDependency.getColorMapData();this._colorMap.setData(a);var b=this._colorMap.getColorDataInfo();b.valid&&b.legendPath&&(b.legendPath="/layers/0"+b.legendPath),this._legend.setData(a),this._chartContext.refresh(a),s.call(this),this.layersReady=!0,this.map.layersReadyDfd.resolve(),x.call(this)}function B(){this.attributionLayer&&(this.yMirrorMode?(this.attributionLayer.style.left="0",this.attributionLayer.style.right=""):(this.attributionLayer.style.left="",this.attributionLayer.style.right="0"))}var C,D=".maparea",E=3e4,F=0;return C=b.extend("MapArea",{init:function(a,b){this._super.apply(this,Array.prototype.slice.call(arguments)),this.id="MapArea"+F++,this.layers=[],this._maxNumLayers=1,this._numLayers=0,this.options=b,this._unionBounds=void 0,this._worldBounds=new c(-180,-180,360,360),this._changedBoundsLayers=[],this._layerDependency=new h,this._layerDependency.listen("changed",A,this)},setYMirrorMode:function(a){this.yMirrorMode=a,B.call(this)},setMaxNumLayers:function(a){isNaN(a)&&(a=0),this._maxNumLayers=a},getMaxNumLayers:function(){return this._maxNumLayers},setData:function(a){var b=[];return this.layersReady=!1,this._data=a,m.call(this),o.call(this),this.coloredLayer=r.call(this),this._layerDependency.setLayer(this.coloredLayer),b.push(n.call(this)),q.call(this),this.map.setFormatter(new i(this.backendApi.localeInfo,this.coloredLayer.getMeasureInfo())),d.all(b)},addLayer:function(a,b){a&&(a.setLayerIndex(b),a.setBackendApi(this.backendApi),a.setSelectionsApi(this.selectionsApi),a.listen("selectableShapesChanged",w,this),a.listen("boundsChanged",y,this),a.listen("numPointsChanged",z,this),a.setColorMap(this._colorMap),k.call(this,a),this.layers[b]=a)},removeLayer:function(a,b){if(a){var c,d,e=this.layers.indexOf(a);a.stopListen("selectableShapesChanged",w,this),a.stopListen("boundsChanged",y,this),a.stopListen("numPointsChanged",z,this),a.clear(),a.release(),a.off(),a.container&&a.container.parentElement&&(c=a.container,d=c.parentElement,d.removeChild(c)),!b&&e>-1&&this.layers.splice(e,1)}},addBaseMapLayer:function(a){this.baseMapLayer||(this.baseMapLayer=a,this.layersContainer.insertBefore(a.container,this.layersContainer.firstChild),k.call(this,a),a.listen("maxMinZoomLevelChanged",t,this),a.listen("attributionChanged",u,this),a.listen("baseLayerChanged",v,this),this._on?a.on():a.off())},removeBaseMapLayer:function(){if(this.baseMapLayer){var a,b;this.baseMapLayer.stopListen("maxMinZoomLevelChanged",t,this),this.baseMapLayer.stopListen("attributionChanged",u,this),this.baseMapLayer.stopListen("baseLayerChanged",v,this),this.baseMapLayer.container&&this.baseMapLayer.container.parentElement&&(a=this.baseMapLayer.container,b=a.parentElement,b.removeChild(a))}},addAttributionLayer:function(a){this.attributionLayer||(this.attributionLayer=a,a.style.position="absolute",a.style.bottom="0",B.call(this),Touche(a).tap({id:D,options:{preventDefault:!1},start:function(){Touche.preventGestures(this.gestureHandler)}}),this.container.appendChild(a))},removeAttributionLayer:function(){this.attributionLayer&&this.container.removeChild(this.attributionLayer)},setBackendApi:function(a){this.backendApi=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setBackendApi(a)},setSelectionsApi:function(a){this.selectionsApi=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setSelectionsApi(a)},setMap:function(a){this.map=a},getMap:function(){return this.map},setViewportProjection:function(a){if(this._viewportProjection!==a){this._viewportProjection=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setViewportProjection(this._viewportProjection);this.baseMapLayer&&this.baseMapLayer.setViewportProjection(this._viewportProjection)}},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setLegend:function(a){this._legend=a},setChartContext:function(a){this._chartContext=a},setInteractionController:function(a){this._interactionController=a},setHasValidData:function(a){this._super(a);for(var b=0;b<this._numLayers;b++)this.layers[b].setHasValidData(a)},hasValidData:function(){return this._super()&&this._data},setLayoutMode:function(a){this._super(a);for(var b=0;b<this._numLayers;b++)this.layers[b].setLayoutMode(a);this.baseMapLayer&&this.baseMapLayer.setLayoutMode(a)},setRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setRect(0,0,c,d)},setOuterRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setOuterRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setOuterRect(0,0,c,d)},setLayoutToContainerRatios:function(a,b){this._super(a,b);for(var c=0;c<this._numLayers;c++)this.layers[c].setLayoutToContainerRatios(a,b);this.baseMapLayer&&this.baseMapLayer.setLayoutToContainerRatios(a,b)},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1);for(var b=0;b<this._numLayers;b++)this.layers[b].updateSize();this.chartScale=1},setContainerRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setContainerRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setContainerRect(0,0,c,d)},showComponent:function(){this._super();var a,b;for(a=0;a<this._numLayers;a++)for(b=0;b<this.layers[a].renderers.length;b++)this.layers[a].renderers[b].show();this.baseMapLayer&&(this.baseMapLayer.showComponent(),u.call(this))},hideComponent:function(){this._super();var a,b;for(a=0;a<this._numLayers;a++)for(b=0;b<this.layers[a].renderers.length;b++)this.layers[a].renderers[b].hide();this.baseMapLayer&&(this.baseMapLayer.hideComponent(),u.call(this))},hasVisibleLayer:function(){for(var a=0;a<this._numLayers;a++)if(this.layers[a].show)return!0;return!1},hasVisibleBaseLayer:function(){return this.baseMapLayer&&this.baseMapLayer.show},isVisible:function(a){return this._super(a)&&this.rect&&this.rect.width>0&&this.rect.height>0},clear:function(){for(var a=0;a<this._numLayers;a++)this.layers[a].clear()},release:function(){for(var a=0;a<this._numLayers;a++)this.layers[a].release();this.baseMapLayer&&(this.baseMapLayer.release(),this.baseMapLayer.stopListen("attributionChanged"),this.baseMapLayer.stopListen("baseLayerChanged")),this.map=null,this.baseMapLayer=null,this.backendApi=null},setGlobalOpacity:function(a,b){this._globalAlpha=a;for(var c=0;c<this._numLayers;c++)this.layers[c].setGlobalOpacity(a,b)},updateSelectableShapes:function(){if(0!==this._numLayers){var a,b,c;for(c=this.layers[0].getSelectableShapes(),a=1;a<this._numLayers;a++)b=this.layers[a].getSelectableShapes(),b&&b.length>0&&(c=c.concat(b));this.setSelectableShapes(c)}},paint:function(a,b){var c=[];if(!this.layersReady||!b)return d.resolve();this._super(a,b);for(var e=0;e<this._numLayers;e++)this.layers[e].invalidateProperties("MapArea.paint"),c.push(this.layers[e].invalidateDisplay("MapArea.paint"));return this.baseMapLayer&&c.push(this.baseMapLayer.invalidateDisplay("MapArea.paint")),d.all(c)},isSelectionLocked:function(){return this._selectionLocked},setPreselectionMode:function(a){this._preselectionMode=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setPreselectionMode(a)},_updateProperties:function(){this._data&&this.invalidateDisplay("MapArea._updateProperties")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=a(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute",overflow:"hidden"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container),this.layersContainer=document.createElement("div"),this._$layersContainerWrap=a(this.layersContainer),this._$layersContainerWrap.css({position:"absolute",width:"100%",height:"100%"}),this.container.appendChild(this.layersContainer))}}),Object.defineProperty(C.prototype,"className",{value:"MapArea"}),C}),define("extensions.qliktech/map/map-handler",["objects.utils/data-properties/data-property-handler","core.utils/deferred","general.utils/array-util","util","core.utils/feature-flags"],function(a,b,c,d,e){"use strict";function f(){var a=d.generateId(),b={type:"polygon",version:"3",cId:a,show:!0,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:2,qHeight:o}],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage},geodata:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage}},measureDef:""};return this.properties.layers.push(b),b}function g(a){var b,c,d=a?a.length:0;for(b=0;b<d;b++){if(c=a[b],c.qHyperCubeDef&&c.qHyperCubeDef.qDimensions&&1===c.qHyperCubeDef.qDimensions.length&&c.qHyperCubeDef.qDimensions[0].qDef&&(c.qHyperCubeDef.qDimensions[0].qLibraryId||c.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0]))return c;if(c.qHyperCubeDef&&c.qHyperCubeDef.qDimensions&&2===c.qHyperCubeDef.qDimensions.length&&c.qHyperCubeDef.qDimensions[0].qDef&&(c.qHyperCubeDef.qDimensions[0].qLibraryId||c.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0])&&c.qHyperCubeDef.qDimensions[1].qDef&&c.qHyperCubeDef.qDimensions[1].qDef.qFieldDefs[0])return c}}function h(){var a=this.properties.color;a.auto&&"primary"===a.mode&&(a.auto=!1,a.mode="byMeasure",this.updateGlobalChangeListeners())}function i(a){var b,c,d="";return b=void 0===a.tags?a.qTags:a.tags,c=void 0===a.name?a.qName:a.name,c="["+c+"]",b&&b.indexOf("$mercator")>-1&&(d="$mercator"),{qExpr:"GeoReduceGeometry({1}"+c+")",geoType:"polygon",projection:d}}function j(a){var b=i(a),c=b.qExpr,d=this.createExpressionMeasure(c,c);return d.qDef.projection=b.projection,d.qDef.qAggrFunc="None",d.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},d}function k(a,b,c){var d,e;for(d=0;d<b.length&&(e=b[d],d!==b.length-1);++d)a&&(a[e]||(a[e]={}),a=a[e]);a&&(a[e]=c)}var l,m,n,o=3333;return n=[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}],m={qDef:{qFieldDefs:[],qFieldLabels:[],qSortCriterias:[]}},l=a.extend({init:function(a){this._super(a),this.dimensionProperties=this.autoSortDimension(m)},rippleToHyperCubes:function(a,b){var c,d,e=a.split(".");for(c=0;c<this.properties.layers.length;++c)d=this.properties.layers[c],k(d.qHyperCubeDef,e,b),d.geodata&&k(d.geodata.qHyperCubeDef,e,b)},setProperties:function(a){a&&a.layers&&a.layers[0]&&"point"===a.layers[0].type&&a.color&&a.color.persistent===!1&&(a.color.persistent=!0),this._super(a)},getDimensions:function(a){return a||(a=g(this.properties.layers)),a&&a.qHyperCubeDef?a.qHyperCubeDef.qDimensions:[]},getMeasures:function(a){if(a||(a=g(this.properties.layers)),!a)return[];if(a.qHyperCubeDef){if("polygon"!==a.type)return a.qHyperCubeDef.qMeasures;var b=a.qHyperCubeDef.qMeasures;if(b&&b[0]&&(b[0].qLibraryId||b[0].qDef&&void 0!==b[0].qDef.qDef&&""!==b[0].qDef.qDef.trim()))return[b[0]]}return[]},getLayerType:function(a){return a||(a=g(this.properties.layers)),a?a.type:void 0},getLayerTypeAndVersion:function(a){return a||(a=g(this.properties.layers)),a?[a.type,a.version]:[void 0,void 0]},addPointLayer:function(){var a=d.generateId(),b={type:"point",cId:a,show:!0,opacity:1,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:3,qHeight:o}],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage},useSize:!0,bubbleSizes:8,rangeBubbleSizes:[2,32],autoMinMax:!0,customMin:0,customMax:10};return this.properties.layers.push(b),void 0===this.properties.background&&(this.properties.background={}),this.properties.background.show=!0,void 0===this.properties.color&&(this.properties.color={}),this.properties.color.persistent=!0,b},canColorBy:function(){return this._super(this.properties&&this.properties.layers&&this.properties.layers.length?{qHyperCubeDef:this.properties.layers[0].qHyperCubeDef}:{qHyperCubeDef:{qDimensions:[],qMeasures:[]}})},addPolygonLayer:f,autoSortDimension:function(a){return b.resolve(l.autoSortDimension(a))},createFieldDimension:function(a){var b=d.extend(!0,{},m);return b.qDef.qFieldDefs[0]=a,b.qDef.qFieldLabels[0]="",b},getLayers:function(){return this.properties.layers},getLayersWithoutMeasure:function(){var a=this;return this.properties.layers.filter(function(b){switch(b.type){case"polygon":var c=a.getMeasures(b);return!(c&&c[0]&&(c[0].qDef&&c[0].qDef.qDef||c[0].qLibraryId));case"point":return!b.qHyperCubeDef.qMeasures.length}return!1})},addHypercubeDimension:function(a,e){var f=this.getDimensions(e);return a.qDef.cId||(a.qDef.cId=d.generateId()),f.length<2&&(f.push(a),c.indexAdded(e.qHyperCubeDef.qInterColumnSortOrder,f.length-1)),"polygon"===e.type&&(f=e.geodata.qHyperCubeDef.qDimensions,a=d.extend(!0,{},a),a.qDef.cId=d.generateId(),f.length<2&&f.push(a)),b.resolve(a)},addDimension:function(a){var c,d=this.properties.layers.length;return d>0&&(c=this.properties.layers[d-1],c.qHyperCubeDef)?this.addHypercubeDimension(a,c):b.resolve(a)},replaceDimension:function(a,c){var e,f,g,h=this.properties.layers.length;return h>0&&(e=this.properties.layers[h-1],e.qHyperCubeDef&&(f=this.getDimensions(e),g=f[a],c.qDef.cId=d.generateId(),f[a]=c,"function"==typeof this.dimensionDefinition.replace&&this.dimensionDefinition.replace.call(null,c,g,a,this.properties,this))),b.resolve(c)},removeDimension:function(){},getDimensionLayout:function(){return""},addFieldAsGeoPolygonField:function(a){var b=this.properties.layers[this.properties.layers.length-1];b.geodata.qHyperCubeDef.qMeasures[0]=j.call(this,a)},addMeasureToPolygonLayer:function(a,b){b.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.qDef.qAggrFunc="None",a.qHyperCubeDef.qMeasures[0]=b,a.measureDef=b.qDef.qDef,h.call(this)},addMeasureToPointLayer:function(a,b){b.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},a.qHyperCubeDef.qMeasures.length?a.qHyperCubeDef.qMeasures[0]=b:(a.qHyperCubeDef.qMeasures.push(b),a.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2)),e.COLORBY||h.call(this)}}),l.autoSortDimension=function(a){return a.qDef.qSortCriterias=d.extend(!0,[],n),a},l}),define("extensions.qliktech/map/map-util",["general.utils/array-util"],function(a){function b(a){var b,c,d,e=[],f=[];if(b=a.split("["),b.length>1){for(d=0;d<b.length;d++)c=b[d].split("]"),
c.length>1&&(e=e.concat(c.splice(0,1))),f=f.concat(c);f=f.join(" ")}else f=a;return{fields:e,rest:f}}function c(a,b){for(var c in b)(!a[c]||a[c].distance>b[c].distance)&&(a[c]=b[c])}var d={extract2FieldNamesOfGeoMakePoint:function(a){var c,d,e,f,g,h,i,j,k,l;for(c=b(a),d=c.fields,e=c.rest,f=e.replace("("," ( "),g=f.split(" "),h=0;h<g.length;)""===g[h]?g.splice(h,1):h++;for(h=0;h<g.length-1;)"("===g[h+1]?g.splice(h,1):h++;for(f=g.join(""),i=[",","\\+","-","\\(","\\)","\\*","/","=","\\>","\\<"],i.join("|"),g=f.split(new RegExp(i.join("|"),"g")),h=0;h<g.length;)""===g[h]?g.splice(h,1):h++;for(j=d.concat(g),h=0;h<j.length;h++)k=j[h],l=k.substring(0,1),'"'!==l&&"'"!==l||(k=k.substring(1)),l=k.substring(k.length-1),'"'!==l&&"'"!==l||(k=k.substring(0,k.length-1)),j[h]=k;return j},findFieldsInGeoMakePointFunction:function(a,b){var c,d=this.extract2FieldNamesOfGeoMakePoint(a),e=b?b.length:0,f=d?d.length:0,g=[],h={};for(c=0;c<e;c++)h[b[c].qName]=c;for(c=0;c<f;c++)void 0!==h[d[c]]&&(g[g.length]=b[h[d[c]]]);return g},isGeoMakePointField:function(a){return this.isGeoMakePointExpression(a.qName)},isGeoMakePointExpression:function(a){var b,c,d=a.split("(")[0],e=["="," "];for(e.join("|"),b=d.split(new RegExp(e.join("|"),"g")),c=0;c<b.length;)""===b[c]?b.splice(c,1):c++;return b&&1===b.length&&"geomakepoint"===b[0].toLowerCase()},isNormalGeoField:function(a){return d.isNormalGeoPointField(a)||d.isGeoPolygonField(a)},isNormalGeoPointField:function(a){return a.qTags.indexOf("$geopoint")>-1||a.qTags.indexOf("$geotag")>-1},isGeoField:function(a){return d.isGeoPointField(a)||d.isGeoPolygonField(a)},isGeoPointField:function(a){return this.isNormalGeoPointField(a)||this.isGeoMakePointField(a)},isGeoPolygonField:function(a){return a.qTags.indexOf("$geomultipolygon")>-1||a.qTags.indexOf("$geopolygon")>-1},getFieldsInTable:function(b,c){var d,e,f=[];for(d=0;d<c.length;d++)e=c[d],a.contains(e.qSrcTables,b)&&f.push(e);return f},simplifyGeoMakePointExpression:function(a){var b,c,e,f,g,h,i,j;return b=d.extract2FieldNamesOfGeoMakePoint(a),c=b[0],e=b[1],f=a.indexOf(c),g=a.indexOf(e),h=a.substring(0,f),i=a.substring(f+c.length,g),j=a.substring(g+e.length),h.trim()+c+i.trim()+e+j.trim()},getFieldsInArchipelagoForGeoMakePointField:function(a,b){var d,e=this.findFieldsInGeoMakePointFunction(a.qName,b),f=e?e.length:0,g={};for(d=0;d<f;d++)c(g,this.getFieldsInArchipelago(e[d],b));return g},getFieldsInArchipelago:function(a,b){function c(a,g){var h,i,j,k,l;for(h=0;h<a.length;h++)if(j=a[h],!f[j])for(f[j]=!0,k=d.getFieldsInTable(j,b),i=0;i<k.length;i++)l=k[i],e[l.qName]||(e[l.qName]={field:l,distance:g},c(l.qSrcTables,++g))}var e={},f={};return c(a.qSrcTables,0),e},filterFields:function(a,b){function c(a,b){return Array.isArray(b)?b.some(function(b){return c(a,b)}):a.qTags.indexOf(b)>-1}var d,e,f=a?a.length:0,g=[];for(d=0;d<f;d++)e=a[d],c(e,b)&&g.push(e);return g},findGeoAssociatedFields:function(a,b){var c,e,f,g,h,i,j,k={};for(c=0;c<b.length;c++)for(f=b[c],i=d.getFieldsInArchipelago(f,a),g=Object.keys(i),e=0;e<g.length;e++)h=g[e],j=i[h].field,k[h]?k[h].geoFields.push(f):k[h]={field:j,geoFields:[f],distance:i[h]};return Object.keys(k).map(function(a){return k[a]})},addLayer:function(a,b,c){var e,f,g=a.geoField;return f="field"===a.type?c.createFieldDimension(a.value):c.createLibraryDimension(a.libraryId),d.isGeoPointField(g)?(e=c.addPointLayer(),c.addDimension(f),c.addDimension(c.createFieldDimension(g.qName))):(e=c.addPolygonLayer(),c.addDimension(f),c.addFieldAsGeoPolygonField(g)),e}};return d}),define("extensions.qliktech/map/map-autocomplete",["extensions.qliktech/map/map-util","translator"],function(a,b){function c(a){return a.sort(function(a,b){var c;return c=a.distance<b.distance?-1e3:a.distance>b.distance?1e3:0,a.value<b.value?c-=10:a.value>b.value&&(c+=10),c})}return{getFieldSuggestions:function(d,e){var f=b.get("Common.Fields"),g=e.map(function(b){var c=b.field.qName,e={label:c,value:c,field:b.field,geoFields:b.geoFields,associatedFields:[],distance:b.distance,category:f,type:"field"};if(a.isGeoField(b.field)){var g=a.getFieldsInArchipelago(b.field,d),h=a.isGeoPointField(b.field),i=d.filter(function(c){var d=c.qName;return g[d]&&(!a.isGeoField(c)||h&&d===b.field.qName)});e.associatedFields=i,e.hasAlternatives=i.length>1}else e.hasAlternatives=b.geoFields.length>1;return e});return c(g)},getDimensionSuggestions:function(d,e,f){function g(b,c,d){var e,f,g;if(e=a.isGeoMakePointExpression(c),e&&(c=a.simplifyGeoMakePointExpression(c)),b&&c)for(f=0;f<b.length;f++)if(g=b[f],g.field.qName===c)return g;if(e&&d)return{geoFields:[d.qData.info[0]],field:d.qData.info[0],distance:{distance:Math.MAX_VALUE,field:d.qData.info[0]}}}var h=b.get("Common.Dimensions"),i=d.map(function(a){var b=a&&a.qData&&a.qData.info&&a.qData.info[0]?a.qData.info[0].qName:"",c=""===b?null:g(f,b,a);if(c)return{dimension:a,associatedField:c}}).filter(function(a){return!!a}),j=i.map(function(b){var c,d,f=b.dimension.qData.title,g=b.associatedField,i={label:f,value:f,field:g.field,libraryId:b.dimension.qInfo.qId,geoFields:g.geoFields,associatedFields:[],distance:b.distance,category:h,type:"dimension"},j=a.isGeoMakePointField(g.field);if(j)c=a.getFieldsInArchipelagoForGeoMakePointField(g.field,e),d=e.filter(function(b){var d=b.qName;return c[d]&&(!a.isGeoField(b)||d===g.field.qName)}),i.associatedFields=d,i.hasAlternatives=d.length>1;else{var k=a.isNormalGeoPointField(g.field),l=a.isGeoPolygonField(g.field);k||l?(c=a.getFieldsInArchipelago(g.field,e),d=e.filter(function(b){var d=b.qName;return c[d]&&(!a.isGeoField(b)||k&&d===g.field.qName)}),i.associatedFields=d,i.hasAlternatives=d.length>1):i.hasAlternatives=g.geoFields.length>1}return i});return c(j)}}}),define("general.models/field-on-fly",["general.models/field"],function(a){"use strict";var b;return b=a.extend("FieldOnFly",{},{listProperties:{qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0,qShowDefinitionOnly:!0}}})}),define("text!extensions.qliktech/map/add-popover/add-layer-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)" qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<div class="object-add-popover" ng-show="!step2">\n\t\t<object-add-typeahead>\n\t\t\t<div class="object-add-popover-header">\n\t\t\t\t<input class="lui-input" type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\n\t\t\t\t\t   object-add-typeahead-input on-escape="onEscape($event)" maxlength="255"/>\n\t\t\t</div>\n\t\t\t<div class="object-add-popover-content" object-add-typeahead-menu>\n\t\t\t\t<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="dimension in dimensions" tid="dimension-item"\n\t\t\t\t\t\tobject-add-typeahead-item="dimension" on-select="selectItem(dimension)">\n\t\t\t\t\t\t<span qve-highlight text="{{dimension.label}}" title="{{dimension.label}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t\t<i class="object-add-popover-toogle-step2-icon  lui-list__aside  lui-icon  lui-icon--triangle-right" ng-if="dimension.hasAlternatives"></i>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="field in fields" tid="field-item"\n\t\t\t\t\t\tobject-add-typeahead-item="field" on-select="selectItem(field)">\n\t\t\t\t\t\t<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery lui-list__aside" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\n\t\t\t\t\t\t<span qve-highlight text="{{field.label}}" title="{{field.label}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t\t<i class="object-add-popover-toogle-step2-icon  lui-list__aside  lui-icon  lui-icon--triangle-right" ng-if="field.hasAlternatives"></i>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\n\t\t\t</div>\n\t\t</object-add-typeahead>\n\t</div>\n\t<div class="object-add-popover back" ng-show="step2">\n\t\t<div class="object-add-popover-header">\n\t\t\t<div qva-activate="goBack($event);">\n\t\t\t\t<i class="object-add-popover-back-icon  lui-icon  lui-icon--triangle-left"></i>\n\t\t\t\t<span q-translation="Visualization.Requirements.Back"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="object-add-popover-content">\n\t\t\t<div class="object-add-popover-list-header">{{headerLabel}}</div>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="suggestedItem in suggestedItems"\n\t\t\t\t\tqva-activate="selectItem(suggestedItem)" tid="from-field-item">\n\t\t\t\t\t<span class="lui-list__text lui-list__text--ellipsis" title="{{getSuggestionLabel(suggestedItem)}}">{{getSuggestionLabel(suggestedItem)}}</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</immidiate-contextual>\n'}),define("extensions.qliktech/map/add-popover/add-layer-popover",["core.utils/deferred","general.utils/string-normalization","translator","general.utils/array-util","general.utils/support","extensions.qliktech/map/map-util","extensions.qliktech/map/map-autocomplete","general.models/field-on-fly","general.models/library/dimension","text!./add-layer-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,c){return""===c?a:a.filter(function(a){return"undefined"!=typeof a.value&&b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var m=100,n={template:j,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=k.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=k.getTypeTranslationKey,b.autoFocus=e.treatAsDesktop(),b.suggestedItems=[],b.position||(b.position="right"),b.getSuggestionLabel=function(a){return f.isGeoPointField(a.geoFields[0])?c.get("properties.layers.autocomplete.pointSuggestion",[a.label]):c.get("properties.layers.autocomplete.regionSuggestion",[a.label])},b.selectItem=function(a){1!==a.geoFields.length||a.field&&f.isGeoField(a.field)?f.isGeoField(a.field)?(b.headerLabel=f.isGeoPointField(a.field)?c.get("Visualization.Requirements.SelectFieldForPointLayer"):c.get("Visualization.Requirements.SelectFieldForAreaLayer"),b.suggestedItems=a.associatedFields.map(function(b){return{label:b.qName,value:b.qName,type:"field",geoFields:[a.field]}}),b.step2=!0):(b.headerLabel=c.get("Visualization.Requirements.SelectGeoFieldForLayer"),b.suggestedItems=a.geoFields.map(function(b){return{label:b.qName,value:a.value,libraryId:a.libraryId,type:a.type,geoFields:[b]}}),b.step2=!0):"dimension"===a.type?b.addLibraryDimension({libraryId:a.libraryId,type:a.type,geoField:a.geoFields[0]}):b.addFieldDimension({value:a.value,type:a.type,geoField:a.geoFields[0]})},b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.goBack=function(a){a.preventDefault(),b.suggestedItems=[],b.step2=!1};var j=null;b.$watch("search.term",function(c){function e(){var a=l(j.fields,c),e=l(j.dimensions,c);e.length>m?(e=d.limit(e,m),a=[]):a.length+e.length>m&&(a=d.limit(a,m-e.length)),b.fields=a,b.dimensions=e}j?e():a.all({fields:h.getListLayout(),dimensions:i.getListLayout()}).then(function(a){var b=f.filterFields(a.fields,["$geomultipolygon","$geopolygon","$geopoint"]),c=f.findGeoAssociatedFields(a.fields,b),d=c.filter(function(a){return!a.field.qIsDefinitionOnly});j={fields:g.getFieldSuggestions(a.fields,d),dimensions:g.getDimensionSuggestions(a.dimensions,a.fields,c)},e()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",closeAddPopover:"=",position:"=",qvaOutsideIgnoreFor:"="}};return n}),define("extensions.qliktech/map/map-layer-creation",["translator","qvangular","core.models/app","extensions.qliktech/map/map-util","general.models/field","util","core.utils/feature-flags"],function(a,b,c,d,e,f,g){"use strict";function h(a,b,c,d){c.addPolygonLayer(),c.addDimension(a),c.addFieldAsGeoPolygonField(b),d.save()}function i(a,b,c,d){c.addPointLayer(),c.addDimension(a),c.addDimension(b),d.save()}function j(a,c,d,e,f,g){c.addItem({translation:d,tid:"add-as-polygon-layer",select:function(){h(e,a,f,g),b.$rootScope.$broadcast("pp-open-path","data."+f.properties.layers[0].cId)}})}function k(a,c,d,e,f,g){c.addItem({translation:d,tid:"add-as-point-layer",select:function(){var c=f.createFieldDimension(a.qName);i(e,c,f,g),b.$rootScope.$broadcast("pp-open-path","data."+f.properties.layers[0].cId)}})}function l(a,b,c,d,e){var f;1===b.length?k(a,c.menu,"Object.Map.DropActions.AddAsPointLayer",b[0].dimension,d,e):b.length>1&&(f=c.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),b.forEach(function(b){k(a,f,["properties.layers.autocomplete.pointSuggestion",b.name],b.dimension,d,e)}))}function m(a,b,c,d,e){var f;1===b.length?j(a,c.menu,"Object.Map.DropActions.AddAsRegionLayer",b[0].dimension,d,e):b.length>1&&(f=c.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),b.forEach(function(b){j(a,f,["properties.layers.autocomplete.regionSuggestion",b.name],b.dimension,d,e)}))}function n(a,b,c,e,f){d.isGeoPointField(a)?l(a,b,c,e,f):m(a,b,c,e,f)}function o(a,b,c,e,f){var g=[],h=[];b.forEach(function(a){d.isGeoPointField(a)?g.push(a):h.push(a)});var i;1===h.length?j(h[0],c.menu,"Object.Map.DropActions.AddAsRegionLayer",a,e,f):h.length>1&&(i=c.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),h.forEach(function(b){j(b,i,["properties.layers.autocomplete.regionSuggestion",b.qName],a,e,f)})),1===g.length?k(g[0],c.menu,"Object.Map.DropActions.AddAsPointLayer",a,e,f):g.length>1&&(i=c.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),g.forEach(function(b){k(b,i,["properties.layers.autocomplete.pointSuggestion",b.qName],a,e,f)}))}function p(b,c,d,e){b.forEach(function(b){if(!g.COLORBY||"polygon"!==b.type){var h=c.properties.layers.indexOf(b),i=q>1?"Add as measure in layer "+(h+1):a.get("contextMenu.addFieldAsMeasure"),j=f.escapeField(d.item.name),k=d.menu.addItem({translation:i,tid:"add-as-measure"});["Sum","Count","Avg","Min","Max"].forEach(function(a){var d=a+"("+j+")";k.addItem({label:d,tid:a.toLowerCase(),select:function(){var a;switch(b.type){case"polygon":a=b.qHyperCubeDef?c.createExpressionMeasure(d,d):{qExpr:d,qLabel:d},c.addMeasureToPolygonLayer(b,a);break;case"point":a=c.createExpressionMeasure(d,d),c.addMeasureToPointLayer(b,a);break;default:return}e.save()}})})}})}var q=1;return{getDropFieldOptions:function(a,b,f,g,j){var k=a.item,l=b.getLayers(),m=b.getLayersWithoutMeasure();a.ColorBy(f,b,j);var r={qTags:k.tags,qSrcTables:k.srcTables,qName:k.name},s=d.isGeoPointField(r),t=d.isGeoPolygonField(r),u=s||t;u?m.length?(p(m,b,a,f),g()):l.length>=q?g():e.getListLayout().then(function(c){var e=d.getFieldsInArchipelago(r,c),h=c.filter(function(a){var b=a.qName;return e[b]&&(!d.isGeoField(a)||s&&b===r.qName)}),i=h.map(function(a){var c=b.createFieldDimension(a.qName);return{name:a.qName,dimension:c}});n(r,i,a,b,f),g()}):c.current.findMatchingFields(a.item.name,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(c){var e,j,n=c.qFieldNames;m.length?(p(m,b,a,f),g()):l.length>=q||0===n.length?g():1===n.length?(e=b.createFieldDimension(k.name),d.isGeoPointField(n[0])?(j=b.createFieldDimension(n[0].qName),i(e,j,b,f)):h(e,n[0],b,f)):(e=b.createFieldDimension(k.name),o(e,n,a,b,f),g())})},getDropDimensionOptions:function(a,b,f,g,j){if(b.getLayers().length>0)return a.ColorBy(f,b,j),void g();var k=a.item;d.isGeoMakePointField(k.info[0])?e.getListLayout().then(function(c){var e=d.getFieldsInArchipelagoForGeoMakePointField(k.info[0],c);if(e){var h=c.filter(function(a){var b=a.qName;return e[b]&&!d.isGeoField(a)}),i=h.map(function(a){var c=b.createFieldDimension(a.qName);return{name:a.qName,dimension:c}});l(k.info[0],i,a,b,f)}g()}):d.isGeoField(k.info[0])?e.getListLayout().then(function(c){for(var e,h=0;h<c.length;h++)if(c[h].qName===k.info[0].qName){e=c[h];break}if(e){var i=d.getFieldsInArchipelago(e,c),j=d.isGeoPointField(e),l=c.filter(function(a){var b=a.qName;return i[b]&&(!d.isGeoField(a)||j&&b===e.qName)}),m=l.map(function(a){var c=b.createFieldDimension(a.qName);return{name:a.qName,dimension:c}});n(e,m,a,b,f)}g()}):c.current.findMatchingFields(k.info[0].qName,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(c){var e,j,k=a.item,l=c.qFieldNames;0===l.length?g():1===l.length?(e=b.createLibraryDimension(k.id),d.isGeoPointField(l[0])?(j=b.createFieldDimension(l[0].qName),i(e,j,b,f)):h(e,l[0],b,f)):(e=b.createLibraryDimension(k.id),o(e,l,a,b,f),g())})},getDropMeasureOptions:function(a,c,d,e,f){a.ColorBy(d,c,f);var h=a.item,i=c.getLayersWithoutMeasure();i.length&&i.forEach(function(e){g.COLORBY&&"polygon"===e.type||a.menu.addItem({translation:["contextMenu.add",h.name],tid:"add",select:function(){var a;switch(e.type){case"polygon":a=e.qHyperCubeDef?c.createLibraryMeasure(h.id):{qLibraryId:h.id},c.addMeasureToPolygonLayer(e,a);break;case"point":a=c.createLibraryMeasure(h.id),c.addMeasureToPointLayer(e,a);break;default:return}d.save(),b.$rootScope.$broadcast("pp-open-path","data."+e.cId)}})}),e()},addFieldDimension:function(a,c){return c.model.getProperties().then(function(e){if(!(e.layers.length>=q)){var f=c.getCreatePropertyHandler();f.setProperties(e),d.addLayer(a,e,f),b.$rootScope.$broadcast("pp-open-path","data."+e.layers[0].cId)}})},addLibraryDimension:function(a,c){return c.model.getProperties().then(function(e){if(!(e.layers.length>=q)){var f=c.getCreatePropertyHandler();f.setProperties(e),d.addLayer(a,e,f),b.$rootScope.$broadcast("pp-open-path","data."+e.layers[0].cId)}})}}}),define("extensions.qliktech/map/interaction-controller",["jquery","objects.views/charts/utils/pan-zoom-controller","general.utils/shapes/point","general.utils/shapes/rect"],function(a,b,c,d){"use strict";function e(){var a,b,c,d,e,f,g,h,i,j,k,l;a={x:this._dataBounds.x,y:this._dataBounds.y},b={x:this._dataBounds.x+this._dataBounds.width,y:this._dataBounds.y+this._dataBounds.height},c=this._viewportProjection.project(a),d=this._viewportProjection.project(b),e=Math.max(c.x,d.x),f=Math.min(c.x,d.x),g=this._viewportProjection.getSize(),(e<0||f>g.x)&&(h=this._viewportProjection.invProject({x:0,y:0}),i=this._viewportProjection.invProject({x:g.x,y:0}),j=Math.abs(i.x-h.x),l=this._viewportProjection.getMapCenterInLatLong(),j>=360?(k=Math.floor(j/360),l.x=l.x+360*k*(l.x<0?1:-1),this._viewportProjection.setMapCenterInLatLong(l)):Math.abs(l.x)>180&&(l.x=l.x%360,l.x>180?l.x-=360:l.x<-180&&(l.x+=360),this._viewportProjection.setMapCenterInLatLong(l)))}var f;return f=b.extend("InteractionController",{init:function(b,c){var f=this,g=function(){this.getZoomPanByWebkitTransform()||this._viewportProjection.fire("changedByInteraction")};this._minZoomLevel=0,this.chart=b,this.dataArea=this.chart.components.dataArea,this._worldBounds=new d(-180,-180,360,360),this._super(a(this.dataArea.layersContainer),{update:function(){g.call(f)},end:function(){g.call(f)}},null,c),this.helpFunctions.onInteractionStart=function(){f._interactionStarted||(f._localMatrix.identity(),f._globalMatrix=f._viewportProjection.getTransformMatrix().clone(),f._interactionStarted=!0)},this.helpFunctions.onInteractionEnd=function(){if(!(f._zooming||f._panning||f._pinching)){var a=!1;f.helpFunctions.setTransform(f.dataArea.layersContainer,"matrix(1,0,0,1,0,0)"),f._viewportProjection.enabledChangeEvent=!1,f._viewportProjection.setTransformMatrix(f._globalMatrix),f.dataArea.hasVisibleBaseLayer()&&(e.call(f),a=f.dataArea.baseMapLayer.updateViewportToBaseMap(f)),a||f._viewportProjection.fire("changedByInteraction"),f._viewportProjection.enabledChangeEvent=!0,f._interactionStarted=!1}}},setMapCenter:function(a,b){this._viewportProjection&&(b?this._viewportProjection.setMapCenterInLatLong(a):this._viewportProjection.setDataCenter(a))},getMapCenter:function(){return this._viewportProjection?this._viewportProjection.getDataCenter():null},moveViewport:function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p;d={x:this._dataBounds.x,y:this._dataBounds.y},e={x:this._dataBounds.x+this._dataBounds.width,y:this._dataBounds.y+this._dataBounds.height},h=this._viewportProjection.project(d),i=this._viewportProjection.project(e),j=Math.max(h.x,i.x),k=Math.min(h.x,i.x),l=this._viewportProjection.getSize(),a>0&&k+a<=l.x||a<0&&j+a>=0||!(this.dataArea.baseMapLayer&&this.dataArea.baseMapLayer.isReady()&&this.dataArea.baseMapLayer.show)?this.setMapCenter(this._viewportProjection.invProject(new c(l.x/2-a,l.y/2-b))):(f=this._viewportProjection.invProject({x:0,y:0}),g=this._viewportProjection.invProject({x:l.x,y:0}),n=Math.abs(g.x-f.x),n>=360?(o=l.x/n*360,p=Math.floor(n/360),a>0&&k+a>l.x?a-=o*p:a<0&&j+a<0&&(a=o*p-a),this.setMapCenter(this._viewportProjection.invProject(new c(l.x/2-a,l.y/2-b)))):(this.dataArea.baseMapLayer.panBy(-a,-b),m=this.dataArea.baseMapLayer.getMapCenter(),this.setMapCenter(m,!0)))},zoomOnPixel:function(a,b){var c,d,f=this.getZoomLevel();f<=this._minZoomLevel&&b<=1||f>=this._maxZoomLevel&&b>=1||(c=Math.pow(2,this._minZoomLevel-f),d=Math.pow(2,this._maxZoomLevel-f),b=Math.min(Math.max(b,c),d),this._viewportProjection.zoomOnPixel(a,b),this.dataArea.hasVisibleBaseLayer()&&e.call(this))},zoomOnDataRectangle:function(a,b){this._viewportProjection.zoomOnDataRectangle(a,b)},zoomOnMapBounds:function(){var a=this._dataBounds&&!this._dataBounds.hasNaN()?this._dataBounds:this._worldBounds;if(a)return this.zoomOnDataRectangle(a,!1),this.dataArea.hasVisibleBaseLayer()&&(this._viewportProjection.inResetZoomMode=!0),this._viewportProjection.fire("resetZoomFinished"),!0},release:function(){this._super(),this.chart=null,this.dataArea=null}})}),define("extensions.qliktech/map/map",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.backend-api/map-api","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","text!./map.ng.html","extensions.qliktech/map/map-properties","extensions.qliktech/map/colorby-map-properties","extensions.qliktech/map/projection/viewport-projection-mercator","objects.views/charts/utils/unit-projection","extensions.qliktech/map/map-area","general.utils/shapes/rect","objects.utils/event-utils","client.utils/property-mapper","extensions.qliktech/map/map-handler","objects.views/charts/components/axis/axis","objects.views/charts/components/legend/color-legend","extensions.qliktech/map/add-popover/add-layer-popover","extensions.qliktech/map/map-layer-creation","extensions.qliktech/map/interaction-controller","core.utils/deferred","general.utils/support","core.utils/feature-flags","extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){"use strict";function y(a){var b=a&&a.qDimensionInfo.length&&!a.qDimensionInfo.some(function(a){return!!a.qError});return a.qMeasureInfo&&a.qMeasureInfo.length&&(b=b&&!a.qMeasureInfo.some(function(a){return!!a.qError})),b}function z(a){if(!(a&&(a.layers&&0!==a.layers.length||a.background&&a.background.show)))return!1;var b,c,d=Math.min(a.layers.length,O);for(b=0;b<d;b++){if(c=a.layers[b],!c.qHyperCube)return!1;if(y(c.qHyperCube))return!0}return a.background&&a.background.show}function A(a){var b=a&&a.qDimensionInfo.every(function(a){return a.qLocked!==!0});return b}function B(a){this._projection&&a&&this._projection.getProjectionType()===a.getProjectionType()||(this._projection=a,this._projection||(this._projection=this._unitProjection),this._viewportProjection.setProjection(this._projection))}function C(a){this._inZoomOnMapBoundsMode&&(this._mapRectInZoomOnMapBoundsModeNeedToUpdate=!0),this._viewportProjection.setSize(a)}function D(){this._inZoomOnMapBoundsMode&&(this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getDataRectOfViewport(),this._mapRect=this._mapRectInZoomOnMapBoundsMode.clone())}function E(){this._mapRect=this._viewportProjection.getDataRectOfViewport(),this._mapRectInZoomOnMapBoundsModeNeedToUpdate&&(this._mapRectInZoomOnMapBoundsMode=this._mapRect.clone(),this._mapRectInZoomOnMapBoundsModeNeedToUpdate=!1),this.updateNavigation()}function F(){var a=this.selections&&this.selections.cache||this.tooltips&&this.tooltips.cache;if(a){var b=this.components.dataArea.getSelectableShapes(),c=this.components.dataArea.layers,d=!(!this.selections||!this.selections.getActiveType)&&this.selections.getActiveType(),e=!!d;a.clear(),b.forEach(function(b){a.add(b)}),e&&(/^item/.test(d.getActiveMode())?b.forEach(function(a){var b=c[a.layerIndex].getSelectedRows();a.selected=b&&b.indexOf(a.rowIndex)>=0}):(d.activeComponent instanceof q&&!d.activeComponent.isDiscrete()||d.activeComponent instanceof r&&"range"===d.getActiveMode())&&d.updateShapesState()),Object.keys(this.components).forEach(function(a){["colorLegend","xAxis","dimensionAxis"].contains(a)&&this.components[a].setSelectableShapes(b)},this)}}function G(a){var b,c,d,e=a?a.length:0,f=[];for(b=0;b<e;b++)c=a[b],d=c.layerIndex,void 0===f[d]&&(f[d]=[]),f[d][f[d].length]=c;return f}function H(a,b,c){var d,e,f,g,h;for(d=c;d>-1;d--)for(e=b[d],f=e?e.length:0,g=0;g<f;g++)h=e[g],h.selected=!1}function I(){this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getDataRectOfViewport(),this._mapRect=this._mapRectInZoomOnMapBoundsMode.clone(),this.updateNavigation()}function J(){if(!this._mapRectInZoomOnMapBoundsMode)return!1;var a=this._mapRectInZoomOnMapBoundsMode.x-this._mapRect.x,b=this._mapRectInZoomOnMapBoundsMode.y-this._mapRect.y,c=this._mapRect.width-this._mapRectInZoomOnMapBoundsMode.width,d=this._mapRect.height-this._mapRectInZoomOnMapBoundsMode.height;return Math.abs(a)<N&&Math.abs(c)<N&&Math.abs(b)<N&&Math.abs(d)<N}function K(a,b,c){var d=this;this.$scope.navigationVisible=a,this.$scope.navigationHomeOnly=b,this.$scope.navigationDefaultPosition=c,this.yMirrorMode?this.$scope.navigationStyle={top:this.components.dataArea.rect.y+13+"px",left:this.components.dataArea.rect.x+15+"px"}:this.$scope.navigationStyle={top:this.components.dataArea.rect.y+13+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+13+"px"},void 0===this._timeoutID&&(this._timeoutID=setTimeout(function(){d._timeoutID=void 0,d.$scope.$digest()}))}var L,M=".map",N=1e-9,O=1;return L=b.extend("Map",{namespace:M,init:function(b,d,g,h,i){var n=this;g=a.extend(!0,g||{},{providers:{colorMap:{clazz:e,multiDimScheme:"first",colorBy:"primary",autoMode:"primary"}},components:{dataArea:{show:!0,dock:"center",clazz:l,showFlag:c.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:c.prototype.ShowFlags.MEDIUM}}}),this._super(b,d,g,h,i),this.backendApi=h,this.components.colorLegend.hideComponent(),this._autoZoomOnDataChange=!0,this._worldBounds=new m(-180,-180,360,360),this._unitProjection=new k,this.setViewportProjection(new j),B.call(this,this._unitProjection),this.interactionController=new u(this,this._viewportProjection),this.interactionController.setZoomPanByWebkitTransform(!w.treatAsDesktop()),this.components.dataArea.setMaxNumLayers(O),this.components.dataArea.setMap(this),this.components.dataArea.setBackendApi(this.backendApi),this.components.dataArea.setSelectionsApi(this.selectionsApi),this.components.dataArea.setLegend(this.components.colorLegend),this.components.dataArea.setChartContext(this._chartContext),this.components.dataArea.setInteractionController(this.interactionController),this._changeWatchers=this._changeWatchers||[],this._changeWatchers.push(f.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(f.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this.onNavigationPressed=b.$on("navigationPressed",function(a,b){a.preventDefault(),n.interactionController.navigate(b)}),this.$scope.navigationDisabled=!0,this.$scope.dataAttributes={},this._scaleMapOnResize=!0},setFormatter:function(a){var b;if(this.chartFormatter=a,this.chartFormatter){for(b in this.components)this.components[b].chartFormatter=this.chartFormatter,this.components[b].measureFormatters=this.chartFormatter.getFormatters(),this.components[b].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter();this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.tooltips&&(this.tooltips.measureFormatters=this.chartFormatter.getFormatters())}},setViewportProjection:function(a){this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished",I,this),this._viewportProjection.stopListen("changedByBaseMap",D,this),this._viewportProjection.stopListen("changed",E,this),this._viewportProjection.stopListen("changedByInteraction",E,this)),this._viewportProjection=a,this.components.dataArea.setViewportProjection(this._viewportProjection),this._viewportProjection&&(this._viewportProjection.listen("resetZoomFinished",I,this),this._viewportProjection.listen("changedByBaseMap",D,this),this._viewportProjection.listen("changed",E,this),this._viewportProjection.listen("changedByInteraction",E,this))},getViewportProjection:function(){return this._viewportProjection},suppressOnPaint:function(a){var b;return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,b=!1):b=a.qSelectionInfo&&a.qSelectionInfo.qInSelections,b&&this.prePaint(a),b},prePaint:function(a){this._super(a);var b=this,c=!1;a.layers.forEach(function(a){var d=a.qHyperCube,e=d&&d.qDataPages&&d.qDataPages[0]&&d.qDataPages[0].qMatrix?d.qDataPages[0].qMatrix.length:0;b.$scope.dataAttributes.limitedData=e>0&&d.qSize.qcy>e,b.$scope.dataAttributes.limitedData&&(c=!0)}),this.$scope.options.showDisclaimerStar=c,this.$element.toggleClass("qv-viz-with-disclaimer",c)},_updateData:function(a,b){var c=[];this.layersReadyDfd=v(),this.layersReady=this.layersReadyDfd.promise,c.push(this.layersReady),this._data=a,this._readStoredData=a&&a.snapshotData&&a.snapshotData.content&&!this.isEffect&&this.backendApi.isSnapshot,this.setAutoZoomOnDataChange(this._data.autoZoomOnSelection||void 0===this._data.autoZoomOnSelection),this.updateSelectableState(a),c.push(this.components.dataArea.setData(a)),this.tooltips&&(this.tooltips.enabled=this.components.dataArea.hasVisibleLayer(),this.tooltips.parentScope=this.$scope,this.tooltips.colorMap=this.providers.colorMap),this.updateLegend(a,b);var d=v.all(c);return this._dfdUpdatingData=d,this._dfdUpdatingData},updateLegend:function(a){if(this.components.colorLegend){this.components.colorLegend.attributeSelectionsCache=this.attributeSelectionsCache,this._updateLegendDock(this.components.colorLegend,a);var b=a&&a.legend&&a.legend.show;b=b&&this.components.dataArea.hasVisibleLayer(),b?this.components.colorLegend.showComponent():this.components.colorLegend.hideComponent()}},isValid:function(a){return this.isDataValid(a)},isDataValid:function(a){var b,c=z(a);for(b in this.components)this.components[b].setHasValidData(c);return c},isDataSelectable:function(a){if(!this.isValid(a)||!this.inAnalysisState())return!1;var b,c=Math.min(a.layers.length,O);for(b=0;b<c;b++)if(a.layers[b].qHyperCube&&A(a.layers[b].qHyperCube))return!0;return!1},setAutoZoomOnDataChange:function(a){this._autoZoomOnDataChange=!!a},getAutoZoomOnDataChange:function(){return this._autoZoomOnDataChange;
},setScaleMapOnResize:function(a){this._scaleMapOnResize=a},getScaleMapOnResize:function(){return this._scaleMapOnResize},setMapCenter:function(a){this.interactionController.setMapCenter(a)},getMapCenter:function(){return this.interactionController.getMapCenter()},setZoomLevel:function(a){this.interactionController.setZoomLevel(a)},getZoomLevel:function(){return this.interactionController.getZoomLevel()},setMapBounds:function(a){this._mapBounds=a.clone(),this.interactionController.setBoundsRect(a),this._autoZoomOnDataChange||(this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getDataRectOfViewportIfZoomOnADataRect(this._mapBounds),this.updateNavigation())},zoomOnMapBounds:function(){this._inZoomOnMapBoundsMode=!0,this._mapRectInZoomOnMapBoundsModeNeedToUpdate=!0;var a=this.interactionController.zoomOnDataBounds();return this._mapRectInZoomOnMapBoundsModeNeedToUpdate=!1,a},setFractionalZoomMode:function(a){this.interactionController.setFractionalZoomMode(a)},getFractionalZoomMode:function(){return this.interactionController.getFractionalZoomMode()},setZoomPanByWebkitTransform:function(a){this.interactionController.setZoomPanByWebkitTransform(a||!w.treatAsDesktop())},getZoomPanByWebkitTransform:function(){return this.interactionController.getZoomPanByWebkitTransform()},on:function(){return this._on?void this._super():(this._navigation&&(this.interactionController.on(M,this.components.dataArea.container),this.$scope.navigationDisabled=!1),void this._super())},off:function(){this.$scope.navigationDisabled=!0,this._on&&(this._navigation&&(this.interactionController.off(),Touche(this.components.dataArea.container).off("*",M),Touche(this.container).off("*",M),a(this.components.dataArea.container).off(M),a(this.container).off(M)),this._super())},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.options._disableSelections||(this.selections.Activated.bind(this.Activated.bind(this)),this.selections.Deactivated.bind(this.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.ToggleShapes.bind(this.ToggleShapes.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},initTooltips:function(){this.tooltips.setComponent("dataArea",this.components.dataArea)},selectWhileLocked:function(a){var b,c=[];this._data.layers.forEach(function(a){b=a.qHyperCube.qDimensionInfo,c.push(b instanceof Array?b[0]:b)}),n.showLockedFeedback(a||c)},ToggleShapes:function(a,b){if(a&&0!==a.length){var c,d,e,f,g,h,i,j=this;for(this._haveToggledShapes=!1,this._renderOnToggleShapes=!0,setTimeout(function(){j._renderOnToggleShapes&&j.onSelection.scheduleInvalidation.call(j,!0),j._renderOnToggleShapes=!1},50),e=this._data&&this._data.layers?Math.min(this._data.layers.length,O):0,d=G(a),h=4===(4&b),this._layerIndexOfClick=-1,f=e-1;f>-1;f--)if(c=this.components.dataArea.layers[f],g=d[f],i=g?g.length:0,c.isVisible()&&0!==i&&(c.toggleShapes(g),h))return this._layerIndexOfClick=f,void H(a,d,f-1)}},Activated:function(){this.onSelection.Activated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!0)},Deactivated:function(){this._renderOnToggleShapes=!1,this.onSelection.Deactivated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Cancel:function(){this.onSelection.Cancel.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Clear:function(){this.onSelection.Clear.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Select:function(a,b,c){var d,e=G(a),f=Array.isArray(c)?c:[c||0],g=this.components.dataArea.layers,h=g?g.length:0;if(this._layerIndexOfClick===-1){for(d=0;d<h;d++)"hyperCube"===g[d].getDataType()&&g[d].selectOnLayer(e[d],f);for(d=0;d<h;d++)"listObject"===g[d].getDataType()&&g[d].selectOnLayer(e[d],f)}else d=this._layerIndexOfClick,g[d].selectOnLayer(e[d],f)},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]);var a;for(a in this.components)this._changeWatchers.push(f.bindProperty(this.components[a],"layoutMode",this,"layoutMode"));this.components.dataArea&&this._changeWatchers.push(f.bindSetter(F.bind(this),this.components.dataArea,"selectableShapes"))},resize:function(){return this._resizing=!0,this._super().then(function(){this._resizing=!1}.bind(this))},layout:function(){this._super();var b=this.components.dataArea?this.components.dataArea.rect:this.rect;C.call(this,{x:b.width,y:b.height}),this.components.dataArea.setRect(b.x,b.y,b.width,b.height),this.components.dataArea.updateSize(),this.components.dataArea&&this.interactionController.setOffset(a(this.components.dataArea.container).offset())},setPreselectionMode:function(a){this._preselectionMode=a,this.components.dataArea.setPreselectionMode(a)},_paint:function(){var a=this._super.bind(this);return this.layersReady.then(function(){return a().then(function(a){if(!a||!a.invalid){var b,c=[];if(this.layout(),this.options.viewState||this.backendApi.isSnapshot&&this._readStoredData){var d=this.options.viewState||this.getSnapshotStoredChartData(),e=d.mapRect;d.inZoomOnMapBoundsMode||!e||void 0===e.width||void 0===e.height||void 0===e.x||void 0===e.y?this.zoomOnMapBounds():this._viewportProjection.zoomOnDataRectangle(e,!0)}else!this._inZoomOnMapBoundsMode||this._firstTimeZoomOnMapBound&&!this._autoZoomOnDataChange?this._scaleMapOnResize&&this._mapRect&&this._viewportProjection.zoomOnDataRectangle(this._mapRect,!0):this._firstTimeZoomOnMapBound=this.zoomOnMapBounds();for(b in this.components)c.push(this.components[b].invalidateDisplay("Map._paint"));return this._dfdUpdatingData&&c.push(this._dfdUpdatingData),this.updateNavigation(),this._dataChanged=!1,v.all(c)}}.bind(this))}.bind(this))},updateNavigation:function(a){if(this._data&&this.rect&&this._mapRect&&this._navigation){var b,c=this.rect.width>=400&&this.rect.height>=400,d=this._layoutMode>=3,e=this.inAnalysisState()||this.inEditState(),f=this._data.navigation?d&&!c:d;this._inZoomOnMapBoundsMode=J.call(this),b=void 0===a?!this._inZoomOnMapBoundsMode||e&&d&&!!this._data.navigation:!a,K.apply(this,[b,f,this._inZoomOnMapBoundsMode])}},getContextMenu:function(a,b){var c=a,d=c.model,e=this.inEditState(),f=d.layout;c.isReadonly&&e||b.addItem({translation:"Common.Navigation",tid:"navigation",icon:"icon-hub-home",select:function(){if(e)d.getProperties().then(function(a){a.navigation=!a.navigation,d.save()});else{var a=[[],!0];a[0][0]={qPath:"/navigation",qOp:void 0===f.navigation?"add":"replace",qValue:f.navigation?"false":"true"},c.backendApi.applyPatches(a)}}})},destroy:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished"),this._viewportProjection.stopListen("changedByBaseMap"),this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this.onNavigationPressed(),this.interactionController.release()},setSnapshotData:function(a){var b=[];if(this._super(a),this.isSnapshot())return v.resolve();for(var c=0;c<this._data.layers.length;c++)this.components.dataArea.layers[c]&&(b[c]=this.components.dataArea.layers[c].getSnapshotLayerData(a.layers[c]));return v.all(b)},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{inZoomOnMapBoundsMode:this._inZoomOnMapBoundsMode,mapRect:this._viewportProjection.getDataRectOfViewport()})},getViewState:function(){return{inZoomOnMapBoundsMode:this._inZoomOnMapBoundsMode,mapRect:this._viewportProjection.getDataRectOfViewport()}},isSnapshot:function(){return this.backendApi&&this.backendApi.isSnapshot},getPreferredSize:function(){return this._super()},setInteractionState:function(a){this._super(a),this.components.dataArea.baseMapLayer&&(this.updateNavigation(),this.inAnalysisState()?this.components.dataArea.baseMapLayer.on():this.components.dataArea.baseMapLayer.off())}}),{type:"map",BackendApi:d,template:g,View:L,definition:x.COLORBY?i:h,initialProperties:{layers:[]},exportProperties:null,importProperties:null,getDimensionInfo:function(){return[]},getMeasureInfo:function(){return[]},mapProperties:function(){this.mappedDefinition=o.mapDefinition(this.definition,this.type),this.globalChangeListeners=o.findGlobalListeners(this.mappedDefinition),this.dimensionDefinition={min:1,max:1,ppPath:"data"}},addFieldDimension:t.addFieldDimension,addLibraryDimension:t.addLibraryDimension,addDimensionPopoverComponent:s,getDropFieldOptions:t.getDropFieldOptions,getDropDimensionOptions:t.getDropDimensionOptions,getDropMeasureOptions:t.getDropMeasureOptions,getCreatePropertyHandler:function(a){return new p({app:a,dimensionDefinition:this.dimensionDefinition,globalChangeListeners:this.globalChangeListeners})},hasError:function(a){var b,c,d=a.layout;for(b=0;b<d.layers.length;++b){if(c=d.layers[b],c.qHyperCube&&c.qHyperCube.qError)return c.qHyperCube.qError;if(c.geodata&&c.geodata.qHyperCube&&c.geodata.qHyperCube.qError)return c.geodata.qHyperCube.qError}return!1},showRequirements:function(a){var b=a.layout;return!b.layers||!b.layers.length},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!1,sharing:!0},options:{selections:{dataArea:{},colorLegend:{}},tooltips:{}}}}),define("extensions.qliktech/combochart/markerarea",["core.utils/deferred","objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","extensions.qliktech/linechart/layers/oob-layer"],function(a,b,c,d,e,f,g,h){function i(a){switch(a){case"diamond":case"triangle":return new f;case"circle":return new e;case"line":return new g;default:return new g}}function j(a,b,c,d,e,f){var g,h=e.type,i=e.rgb,j=e.shiftedRgb,k=.5,l=e.isFilled,m=!0;switch(h){case"circle":a.set(b,c,Math.max(2,Math.min(6,.125*d)));break;case"diamond":g=Math.max(2,Math.min(12,.25*d)),a.set([{x:b,y:c-g/2},{x:b-g/2,y:c},{x:b,y:c+g/2},{x:b+g/2,y:c}]);break;case"triangle":g=Math.max(2,Math.min(12,.25*d)),a.set([{x:b,y:c-g/2},{x:b-g/2,y:c+g/2},{x:b+g/2,y:c+g/2}]);break;case"line":g=Math.max(2,.5*d),g<24?a.set(b-g/2,Math.floor(c)-k,g,Math.min(3,Math.max(2,Math.round(g/4)))):a.set(Math.floor(b-g/2)-k,Math.floor(c)-k,Math.ceil(g),Math.min(3,Math.max(2,Math.round(g/4)))),l=!0;break;default:g=Math.max(2,Math.min(12,.25*d)),a.set(b-g/2,c-g/2,g,g)}m&&l!==!1?(a.fill=i,a.stroke=j):(a.stroke=i,delete a.fill),f&&(a.stroke="#000000")}function k(a){var b,c,d,e,f,g,h,i=this._shapes?this._shapes.length:0,k=this.rect.width,l=this._majorAxis;for(this._outOfRange={up:{},down:{},points:[]},b=0;b<i;b++)h=this._shapes[b],e=this._minorAxes[h.data.axisIdx],f=a[this._measureToAxisIndex[h.data.measureIdx]],g=l.getWidthOfId(h.data.axisId),c=l.getPositionOfId(h.data.axisId),d=e.getPositionOfValue(h.data.end),h.data.x=c,h.data.y=d,h.data.outOfRangeUp=d<f.topCutoff,h.data.outOfRangeDown=d>f.bottomCutoff,h.data.selected=h.data.cacheItem&&h.data.cacheItem.selected,h.opacity=h.data.outOfRangeUp||h.data.outOfRangeDown?0:h.data.selected?1:this._globalAlpha,d=h.data.outOfRangeUp?f.topCutoff+4:h.data.outOfRangeDown?f.bottomCutoff-4:Math.floor(d),j(h,c,d,g,h.data,h.data.cacheItem&&h.data.cacheItem.selected),h.data.isVisible=c>0&&c<k,h.data.isVisible&&(h.data.outOfRangeUp||h.data.outOfRangeDown)&&(h.data.outOfRangeUp&&!this._outOfRange.up[c]?(this._outOfRange.points.push(h),this._outOfRange.up[c]=!0):h.data.outOfRangeDown&&!this._outOfRange.down[c]&&(this._outOfRange.points.push(h),this._outOfRange.down[c]=!0))}var l;return l=b.extend("MarkerArea",{init:function(){this._super.apply(this,arguments),this.renderers={markers:new c(this.container,{name:"marker-layer"})},this._oobLayer=new h(this.container),this.layers=[this._oobLayer],this._markerRenderer=this.renderers.markers},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(a){this._measureIndices=a},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMajorAxis")},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMinorAxis")},this)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setSecondaryMinorAxis")},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties()},hasValidData:function(){return this._super()&&this._data},getMajorAxisData:function(){return this._majorAxisData},createAxisData:function(a,b,c,d){d||(this._cacheIndex=0);var e=a.children;return e.map(function(a){var c;return"dimension"===b.types[d]&&(c={label:a.data.qText,group:!1,id:a.data.id,cacheIndex:[]},"measure"===b.types[d+1]&&c.cacheIndex.push(this._cacheIndex++)),c},this)},_createMeasureDisplayNode:function(a,b,c,d){var e=i(c),f=a.children[0].data,g=a.parent.cacheItem,h=this.measureFormatters[b],j="undefined"!=typeof f.qValue?f.qValue:f.qNum,k=a.ancestors.filter(function(a){return"qElemNo"in a.data}).map(function(a){return a.data.qElemNo}).reverse();return e.data={qText:a.data.qText,qNum:j,start:0,end:j,valueLabel:h&&"U"===h.type?h.formatValue(j):a.data.qText,cacheItem:g,type:c,isFilled:d,measureIdx:b,color:this._colorMap.getColor(k,j,b,a.data.rowIndex)},g.addShape("dataArea",e,!0),e.fill=e.data.color.toHex(),e.data.rgb=e.data.color.toRGBA(),e.data.shiftedRgb=e.data.color.createShiftedColor().toRGBA(),e},_createDimensionDisplayNode:function(a){var b=new d;return b.data={qText:a.data.qText},b},_applyIds:function(a,b,c,d){var e;a.children.forEach(function(f,g){e=a.data.id?a.data.id+";"||"":"","dimension"===c[d]?(f.data.id=e+b[d]+":"+f.data.qElemNo,this._applyIds(f,b,c,d+1)):"measure"===c[d]&&(f.data.id=e+b[d+g])},this)},getRenderTree:function(a,b,c,d){var e,f,g;return f=a.children,"measure"===b.types[d]&&this._measureIndices&&(f=f.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),f.map(function(a,f){var h;return"dimension"===b.types[d]?(h=this._createDimensionDisplayNode(a),e=this.getRenderTree(a,b,c,d+1),e.forEach(function(a){h.addChild(a)})):"measure"===b.types[d]&&(g=this._measureIndices?this._measureIndices[f]:f,h=this._createMeasureDisplayNode(a,g,this._data.qHyperCube.qMeasureInfo[g].series.marker||"circle",this._data.qHyperCube.qMeasureInfo[g].series.markerFill),h.data.axisId=a.parent.data.id,h.data.axisIdx=b.measureToAxisIndex[g],c.shapes.push(h)),h},this)},_updateProperties:function(){if(this._markerRenderer.stage.removeChildren(),this._data&&this._tree){var a,b,c=this._data.qHyperCube.qDimensionInfo.length,d=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,e=c+1,f=new Array(c).join(",").split(",").map(function(){return"dimension"}),g=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(a){return a.cId}),h=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.qApprMaxGlyphCount});h.push(this._data.qHyperCube.qMeasureInfo.reduce(function(a,b){return Math.max(a,b.qApprMaxGlyphCount)},0)),this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis);var i=this._minorAxes,j=[],k=[];if(this._measureIndices)k=this._measureIndices;else if(d>0&&d<20)for(;k.length<d;)k.push(k.slice(-1)[0]+1||0);k.forEach(function(a){j[a]=i.filter(function(b){return!b._dataIndices||b._dataIndices.indexOf(a)>=0})[0]}),this._measureToAxis=j,this._measureToAxisIndex=j.map(function(a){return i.indexOf(a)}),f.push("measure"),a={shapes:[],shapesToLabel:[],globalPositiveSum:0,globalNegativeSum:0},b={colIds:g,types:f,numLevels:e,numMeasures:d,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails)},this._applyIds(this._tree,g,f,0);var l=this.getRenderTree(this._tree,b,a,0);this._objects=l,this._shapes=a.shapes,l.forEach(function(a){this._markerRenderer.stage.addChild(a)},this);var m=this.createAxisData(this._tree,b,a,0),n=f.map(function(a,b){return{qApprMaxGlyphCount:h[b],show:b<f.length-1}});this._majorAxisData={data:m,info:n},this.setSelectableShapes(a.shapes.map(function(a){return a.data.cacheItem}))}},paint:function(){this._super(this._layoutMode,this._data);var b=this._minorAxes.map(this._getAxisDetails),c=[];return k.call(this,b),this._oobLayer&&(this._oobLayer.update(this._outOfRange.points,{measureToAxisIndex:this._measureToAxisIndex,axesSettings:b,globalAlpha:this._globalAlpha,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2)}),c.push(this._oobLayer.render())),c.push(this._markerRenderer.render()),a.all(c)},updateSize:function(){this._super(),this.renderers.markers.setDimensions(0,-1,this.rect.width,this.rect.height),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensions(0,0,this.rect.width,this.rect.height),a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this)},release:function(){this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this)},clear:function(){this._super(),this.layers.forEach(function(a){a.clear()})},_getAxisDetails:function(a){var b=a.getPlotMin(),c=a.getPlotMax(),d=c-b,e=a.getPadding(),f=e.top-1,g=a.rect.height-e.bottom,h=0;return h=b>0?g:c<0?f:Math.floor(a.getPositionOfValue(0))-.5,{plotMin:b,plotMax:c,posMin:a.getPositionOfValue(b),posMax:a.getPositionOfValue(c),plotRange:d,topCutoff:f,bottomCutoff:g,areaStartBase:h,zeroPos:Math.floor(a.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/combochart/comboarea",["objects.views/charts/components/chart-component","extensions.qliktech/linechart/linearea","extensions.qliktech/barchart/bararea","extensions.qliktech/combochart/markerarea","core.utils/deferred"],function(a,b,c,d,e){"use strict";var f;return f=a.extend("ComboArea",{init:function(){var a=new(Function.prototype.bind.apply(c,[null].concat([].slice.call(arguments)))),e=new(Function.prototype.bind.apply(b,[null].concat([].slice.call(arguments)))),f=new(Function.prototype.bind.apply(d,[null].concat([].slice.call(arguments))));this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=null,e.setShowDataPoints(!0),e.setShowDataPointLabels(!1),a.setShowDataPoints(!1),this.subComponents=[a,e,f],this.lineArea=e,this.barArea=a,this.markerArea=f},setYMirrorMode:function(a){this.yMirrorMode=a,this.subComponents.forEach(function(b){b.setYMirrorMode(a)})},setColorMap:function(a){this._colorMap=a,this.subComponents.forEach(function(b){b.setColorMap(a)})},getColorMap:function(){return this._colorMap},setShowDataPoints:function(){},setMajorAxis:function(a){this.subComponents.forEach(function(b){b.setMajorAxis(a)}),this._majorAxis=a},setMinorAxis:function(a){this._minorAxis=a,this.subComponents[0].setMinorAxis(this._minorAxis),this.subComponents[2].setMinorAxis(this._minorAxis)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a},setDimensionTree:function(a){this._tree=a,this.subComponents.forEach(function(b){b.setDimensionTree(a)})},setData:function(a){this._super(a);for(var b=[],c=[],d=[],e=0;e<a.qHyperCube.qMeasureInfo.length;e++)a.qHyperCube.qMeasureInfo[e].series&&"line"===a.qHyperCube.qMeasureInfo[e].series.type?b.push(e):a.qHyperCube.qMeasureInfo[e].series&&"marker"===a.qHyperCube.qMeasureInfo[e].series.type?d.push(e):c.push(e);this.subComponents[0].setHasValidData(c.length>0),this.subComponents[1].setHasValidData(b.length>0),this.subComponents[2].setHasValidData(d.length>0),this.lineArea.setMeasureIndices(b),this.barArea.setMeasureIndices(c),this.markerArea.setMeasureIndices(d),this.subComponents.forEach(function(b){b.setData(a)}),this.barArea.setMinorAxis(this._minorAxis),this.lineArea.setMinorAxis(this._secondaryMinorAxis),this.lineArea.setSecondaryMinorAxis(this._minorAxis),this.markerArea.setMinorAxis(this._minorAxis),this.markerArea.setSecondaryMinorAxis(this._secondaryMinorAxis),this.invalidateProperties()},setHasValidData:function(a){this.subComponents.forEach(function(b){b.setHasValidData(a)})},setLayoutMode:function(a){this._super(a),this.subComponents.forEach(function(b){b.setLayoutMode(a)})},setRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setRect(a,b,c,d)})},setOuterRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setOuterRect(a,b,c,d)})},setLayoutToContainerRatios:function(a,b){this._super(a,b),this.subComponents.forEach(function(c){c.setLayoutToContainerRatios(a,b)})},setContainerRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setContainerRect(a,b,c,d)})},insertAdjacentTo:function(){this._super.apply(this,[].slice.call(arguments)),this.subComponents.forEach(function(a){a.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},this)},setGlobalOpacity:function(a,b){this._super(a,b),this.subComponents.forEach(function(c){c.setGlobalOpacity(a,b)},this)},setLineType:function(){},updateSize:function(){this._super(),this.subComponents.forEach(function(a){a.updateSize()},this)},_updateDisplay:function(){var a=[];return this.subComponents.forEach(function(b){a.push(b.invalidateDisplay())}),e.all(a)},_updateSize:function(){},_updateProperties:function(){if(this._data&&this._tree){this.subComponents[0].updateNow(["properties"]),this.subComponents[1].updateNow(["properties"]),this.subComponents[2].updateNow(["properties"]);var a=this.subComponents[0].getSelectableShapes();a&&a.length||(a=this.subComponents[1].getSelectableShapes()),a&&a.length||(a=this.subComponents[2].getSelectableShapes()),this.setSelectableShapes(a)}},invalidateProperties:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this.subComponents.forEach(function(a){a.invalidateProperties("ComboArea.invalidateProperties")})},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow()},release:function(){this.subComponents.forEach(function(a){a.release()})}})}),define("extensions.qliktech/combochart/combochart-properties",["translator","client.utils/property-resolver"],function(a,b){function c(a,c,d){var e,f=d||0;e=c?c.getMeasureLayouts():b.getValue(a,"qHyperCubeDef.qMeasures",[]).map(function(a){return a.qDef});var g=e.filter(function(a){return b.getValue(a,"series.axis",0)===f||0===f&&"bar"===b.getValue(a,"series.type","bar")});return g}function d(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}function e(a,b){return b.getMeasures().filter(function(a){return a.qDef.series&&"line"===a.qDef.series.type}).length>0}function f(a,b,c){return b.getMeasures().filter(function(a){return!a.qDef.series||"bar"===a.qDef.series.type}).length>c}var g,h,i,j;return g={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,show:function(a,b){return e(a,b)||f(a,b,0)},items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(a,b){return f(a,b,1)}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,show:!1,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},scrollStartPos:{ref:"scrollStartPos",type:"number",translation:"properties.ScrollAlignment",component:"dropdown",defaultValue:0,options:[{value:0,translation:"properties.ScrollAlignStart"},{value:1,translation:"properties.ScrollAlignEnd"}]},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap",show:function(a,b){return e(a,b)&&b.getMeasures().length>1}},dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1,show:function(a,b){return e(a,b)}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var e,f="x",g=d(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return e=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a){return["all","labels"].contains(a.dimensionAxis.show)}},dock:{ref:"dimensionAxis.dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}],show:function(a){return"none"!==a.dimensionAxis.show}}}},measureAxis:{uses:"measureAxis",label:function(b,d){var e,f=c(b,d,0).map(function(a){return a.qFallbackTitle});return e=f.length?a.get("properties.yAxisWithInfo",[f.join(",")]):a.get("properties.yAxis")},show:function(a){return c(a,null,0).length>0},items:{axis:{items:{show:{ref:"measureAxes.0.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"measureAxes.0.dock",show:function(a){return"none"!==a.measureAxes[0].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.0.spacing",show:function(a){return a.measureAxes[0]&&"none"!==a.measureAxes[0].show}}}},minMax:{items:{autoMinMax:{ref:"measureAxes.0.autoMinMax"},minMax:{ref:"measureAxes.0.minMax",defaultValue:"min",show:function(a){return!a.measureAxes[0].autoMinMax}},min:{ref:"measureAxes.0.min",show:function(a){return["min","minMax"].contains(a.measureAxes[0].minMax)&&!a.measureAxes[0].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[0].minMax&&a.measureAxes[0].min>=a.measureAxes[0].max}},max:{ref:"measureAxes.0.max",show:function(a){return["max","minMax"].contains(a.measureAxes[0].minMax)&&!a.measureAxes[0].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[0].minMax&&a.measureAxes[0].min>=a.measureAxes[0].max}}}}}},secondaryMeasureAxis:{uses:"measureAxis",label:function(b,d){var e,f=c(b,d,1).map(function(a){return a.qFallbackTitle});return e=f.length?a.get("properties.yAxisWithInfo",[f.join(",")]):a.get("properties.yAxis")},show:function(a){return c(a,null,1).length>0},items:{axis:{items:{show:{ref:"measureAxes.1.show"},dock:{ref:"measureAxes.1.dock",defaultValue:"far",show:function(a){return"none"!==a.measureAxes[1].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.1.spacing",show:function(a){return a.measureAxes[1]&&"none"!==a.measureAxes[1].show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxes.1.autoMinMax"},minMax:{ref:"measureAxes.1.minMax",defaultValue:"min",show:function(a){return!a.measureAxes[1].autoMinMax}},min:{ref:"measureAxes.1.min",show:function(a){return["min","minMax"].contains(a.measureAxes[1].minMax)&&!a.measureAxes[1].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[1].minMax&&a.measureAxes[1].min>=a.measureAxes[1].max}},max:{ref:"measureAxes.1.max",show:function(a){return["max","minMax"].contains(a.measureAxes[1].minMax)&&!a.measureAxes[1].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[1].minMax&&a.measureAxes[1].min>=a.measureAxes[1].max}}}}}}}},h={uses:"data",items:{dimensions:{},measures:{items:{series:{type:"items",items:{seriesType:{ref:"qDef.series.type",type:"string",component:"item-selection-list",defaultValue:"bar",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.bar",value:"bar"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.marker",value:"marker"}],change:function(){}},seriesAxis:{ref:"qDef.series.axis",type:"integer",component:"dropdown",defaultValue:0,options:[{translation:"properties.axis.primary",value:0},{translation:"properties.axis.secondary",value:1}],show:function(a){return a.qDef.series&&a.qDef.series.type&&"bar"!==a.qDef.series.type}},seriesMarker:{ref:"qDef.series.marker",type:"string",component:"dropdown",defaultValue:"circle",options:[{translation:"properties.marker.circle",value:"circle"},{translation:"properties.marker.rect",value:"rect"},{translation:"properties.marker.diamond",value:"diamond"},{translation:"properties.marker.triangle",value:"triangle"},{translation:"properties.marker.line",value:"line"}],show:function(a){return a.qDef.series&&"marker"===a.qDef.series.type}},seriesMarkerFill:{ref:"qDef.series.markerFill",translation:"properties.series.fill",type:"boolean",defaultValue:!0,show:function(a){return a.qDef.series&&"marker"===a.qDef.series.type&&!["line"].contains(a.qDef.series.marker)}}}}}}}},j={uses:"sorting"},i={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:h,sorting:j,addons:i,settings:g}}}),define("extensions.qliktech/combochart/combochart-explore-properties",[],function(){function a(a){return a.qHyperCubeDef.qMeasures.filter(function(a){return a.qDef.series&&"line"===a.qDef.series.type}).length>0}function b(a){return a.qHyperCubeDef.qMeasures.filter(function(a){return!a.qDef.series||"bar"===a.qDef.series.type}).length>1}return{type:"items",component:"accordion",items:{data:{uses:"data"},sort:{uses:"sort"},presentation:{uses:"presentation",type:"items",translation:"properties.presentation",grouped:!0,show:function(c,d){return a(c,d)||b(c,d)},items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(a,c){return b(a,c)}},nullMode:{type:"string",component:"radio-list",ref:"nullMode",
translation:"properties.nullMode",options:function(){return[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}]},show:function(b){return a(b)&&b.qHyperCubeDef.qMeasures.length>1}},dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",show:function(b){return a(b)}}}},color:{uses:"color"}}}}),define("extensions.qliktech/combochart/combochart-data",["client.utils/property-resolver"],function(a){function b(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byMeasure"===e&&d.length>1?a.setValue(b,"color.mode","byDimension"):"byDimension"===e&&1===d.length&&"line"===a.getValue(d[0].qDef,"series.type")&&a.setValue(b,"color.mode","primary")}return{dimensions:{min:1,max:1,add:function(a,c,d){b(c,d)},move:function(a,c,d){b(c,d)}},measures:{min:1,max:15,add:function(a,c,d){b(c,d)},move:function(a,c,d){b(c,d)},replace:function(a,b){b.qDef.series&&(a.qDef.series.type=b.qDef.series.type||"bar")}}}}),define("text!extensions.qliktech/combochart/combochart.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.noDataExist" direction="options.direction"></div>'}),define("extensions.qliktech/combochart/combochart",["jquery","util","qvangular","core.utils/deferred","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/data-title/data-title","extensions.qliktech/combochart/comboarea","extensions.qliktech/combochart/combochart-properties","extensions.qliktech/combochart/combochart-explore-properties","extensions.qliktech/combochart/combochart-data","objects.views/charts/disclaimers/chart-utils","objects.views/charts/components/axis/axis-utils","objects.backend-api/hypercube-api","objects.extension/default-extension","objects.extension/object-conversion","text!./combochart.ng.html","core.utils/feature-flags"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(a){var b=[],c=[];return a.qHyperCube.qMeasureInfo.forEach(function(a){a.series&&"bar"!==a.series.type&&1===a.series.axis?c.push(a):b.push(a)}),{primaryMeasures:b,secondaryMeasures:c}}function u(a,c,d,e,f,g){if(c.length){var h,i,j;f?(h=f.min,i=f.max):(h=Math.min.apply(this,c.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),i=Math.max.apply(this,c.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax}))),b.isNumeric(h)||(h=-1),b.isNumeric(i)||(i=1),j=this.getAxisOptions(d),e&&(i=Math.max(0,i),h=Math.min(0,h)),g&&(g.min=h,g.max=i,g.minMeasure&&g.maxMeasure?(this._cutMode=this.getSpikeSettings(g,j),h=this._cutMode.min,i=this._cutMode.max):this._cutMode={positive:!1,negative:!1}),a.setRealDataRange(void 0,void 0),this.setAxisDataRange(a,i,h,j.max,j.min,1)}}function v(a,b){var d,e=this.item,f=["contextMenu.add",e.name];b.canAddMeasure()&&(d=this.menu.addItem({translation:f,tid:"add-as"}),d.addItem({translation:"contextMenu.asBar",tid:"as-bar",icon:"icon-bar-chart-vertical",select:function(){b.addLibraryMeasure(e.id).then(function(d){d.qDef.series.type="bar",b.updateGlobalChangeListeners(),a.save(),c.$rootScope.$broadcast("pp-open-path","data."+d.qDef.cId)})}}),d.addItem({translation:"contextMenu.asLine",tid:"as-line",icon:"icon-line-chart",select:function(){b.addLibraryMeasure(e.id).then(function(d){d.qDef.series.type="line",d.qDef.series.axis=1,b.updateGlobalChangeListeners(),a.save(),c.$rootScope.$broadcast("pp-open-path","data."+d.qDef.cId)})}}),d.addItem({translation:"contextMenu.asMarker",tid:"as-marker",icon:"icon-shapes",select:function(){b.addLibraryMeasure(e.id).then(function(c){c.qDef.series.type="marker",c.qDef.series.axis=1,b.updateGlobalChangeListeners(),a.save()})}})),s.COLORBY&&b.canColorBy().byMeasure&&this.menu.addItem({translation:["contextMenu.colorBy",e.name],tid:"colorby",select:function(){b.setColorByDef(e),a.save()}})}var w,x={NONE:0,ONE_DIM:1,TWO_DIM:2};return w=e.extend("ComboChart",{namespace:".combochart",init:function(b,c,d,e,j){d=a.extend(!0,{components:{dataArea:{clazz:i},axis:{show:!0,order:1.1,reductionOrder:2.1,dock:"right",relevantSize:90,showFlag:f.prototype.ShowFlags.XSMALL,clazz:g},secondaryMeasureAxisTitle:{show:!0,order:1.2,dock:"right",relevantSize:30,reductionOrder:1,showFlag:f.prototype.ShowFlags.SMALL,clazz:h}}},d||{}),this._super(b,c,d,e,j),this.components.scrollArea.setUseMiniChart(!1),this.components.axis.setShowStrategy("all"),this.components.dataArea.setSecondaryMinorAxis(this.components.axis),this.components.secondaryMeasureAxisTitle.setType("measure"),this.components.secondaryMeasureAxisTitle.setModel(b.ext.model)},getVerticalComponents:function(){var a,b=this._super();return this._data&&this.components&&(this.components.measureAxis&&this.components.measureAxis.isVertical()&&this._data.measureAxes&&(a=this._data.measureAxes[0].dock,b.push({comp:this.components.measureAxis,dock:a}),this.components.measureAxisTitle&&b.push({comp:this.components.measureAxisTitle,dock:a})),this.components.axis&&this.components.axis.isVertical()&&this._data.measureAxes&&this._data.measureAxes.length>1&&(a=this._data.measureAxes[1].dock,b.push({comp:this.components.axis,dock:a}),this.components.secondaryMeasureAxisTitle&&b.push({comp:this.components.secondaryMeasureAxisTitle,dock:a}))),b},partialUpdate:function(a){var b,c,e,f=[];this._enablePagingTransitions(),this._chartContext.refresh(a),this.providers.colorMap.setData(a),c=a.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:a.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(c*this.scrollMultiplicator);for(b in this.components)"miniChart"!==b&&this.components[b].invalidateProperties("ScrollableChart.partialUpdate");this.components.dataArea.updateNow(["properties"]),e=this.components.dataArea.barArea.getMeasureIndices().length?this.components.dataArea.barArea.getMajorAxisData():this.components.dataArea.markerArea.getMeasureIndices().length?this.components.dataArea.markerArea.getMajorAxisData():this.components.dataArea.lineArea.getMajorAxisData(),this.components.dimensionAxis.setDataRange(e.data,e.info);var g=this.components.dataArea.barArea.getMinorAxisData();return g&&this._dataOptions.primary.forEach(function(a){this._dataOptions.barSeries.indexOf(a)<0&&!isNaN(a.qMin)&&(g.min=Math.min(a.qMin,g.min),g.max=Math.max(a.qMax,g.max))},this),u.apply(this,[this.components.measureAxis,this._dataOptions.primary,this._dataOptions.axes.measureAxis,!!g,g,g?this.getPrimaryMeasureSettings(a,this._dataOptions):null]),this.components.dimensionAxis.updateNow(["properties"]),this.components.colorLegend.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),f.push(this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate")),f.push(this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate")),f.push(this.components.colorLegend.invalidateDisplay("ScrollableChart.partialUpdate")),d.all(f)},isValid:function(a){return this._super(a)&&!this.supressChartRendering},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var a,b=this.components.scrollArea,c=this.rect.height,e=this.getSnapshotStoredChartData(),f=0,g=[];(this._cutMode.positive||this._cutMode.negative)&&(this._layoutMode>=31&&(f=48),f=this._layoutMode>=15?32:this._layoutMode>=7?16:8),this.components.measureAxis.setPadding(this._cutMode.positive?f:0,0,this._cutMode.negative?f:0,0),this.components.axis.setPadding(this._cutMode.positive?f:0,0,this._cutMode.negative?f:0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(c/4))),this.components.dataArea.updateNow(["properties"]),this.components.dimensionAxis.updateNow(["properties"]),this.layout(),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(e.axisInnerOffset),this.components.scrollArea.setOffset(e.scrollOffset)):this.options.viewState&&(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset));var h=this.checkPage();if(h)g.push(h);else{for(a in this.components)g.push(this.components[a].invalidateDisplay("ComboChart.paint"));b.viewState.min+b.viewState.range>b.fullState.max&&b.setOffset(b.fullState.max-b.viewState.range)}return d.all(g)},prePaint:function(a){this._super(a),m.applyDisclaimerAttributes({paging:!0},this.$scope.dataAttributes,this.$element,this.$scope,a),this.supressChartRendering=this.$scope.dataAttributes.noDataExist},_updateData:function(b){this._checkPage=!1;var c,d,e,g,h,i,j,k,l,m,n=this.getSnapshotStoredChartData();if(c=b.qHyperCube.qMeasureInfo.filter(function(a){return a.series&&"line"===a.series.type}),d=b.qHyperCube.qMeasureInfo.filter(function(a){return!a.series||"bar"===a.series.type}),e=b.qHyperCube.qMeasureInfo.filter(function(a){return a.series&&"marker"===a.series.type}),g=t(b),h=g.primaryMeasures,i=g.secondaryMeasures,this.isStacked=!1,this.components.measureAxis.isStacked="stacked"===b.barGrouping.grouping&&d.length>1,this.components.axis.isStacked=!1,this._pagingMode=x.NONE,this.scrollMultiplicator="grouped"===b.barGrouping.grouping&&d.length>1?d.length+1:1,b.qHyperCube.qSize.qcy>b.qHyperCube.qDataPages[0].qArea.qHeight){this._pagingMode=x.ONE_DIM;var o=b.qHyperCube.qSize.qcy;"grouped"===b.barGrouping.grouping&&d.length>1&&(this.scrollMultiplicator=d.length+1,o*=this.scrollMultiplicator),this.components.dimensionAxis.setNumDiscreteUnits(o)}else this.components.dimensionAxis.setNumDiscreteUnits(null);this.components.dimensionAxis.isDiscrete()||(this._pagingMode=x.NONE);var p=a.extend(!0,{},b.measureAxes[0],{show:h.length?b.measureAxes[0].show:"none"}),q=a.extend(!0,{},b.measureAxes[1],{show:i.length?b.measureAxes[1].show:"none",dock_:["near","far"].contains(b.measureAxes[0].dock)?"near"===b.measureAxes[0].dock?"far":"near":f.prototype.getOppositeDock.call({options:{dock:b.measureAxes[0].dock}})});j={primary:h,secondary:i,lineSeries:c,markerSeries:e,barSeries:d,axes:{measureAxis:{component:this.components.measureAxis,data:p,dataIndices:h.map(function(a){return b.qHyperCube.qMeasureInfo.indexOf(a)})},secondaryMeasureAxis:{component:this.components.axis,data:q,dataIndices:i.map(function(a){return b.qHyperCube.qMeasureInfo.indexOf(a)})},dimensionAxis:{component:this.components.dimensionAxis,data:b.dimensionAxis,dataIndices:b.qHyperCube.qDimensionInfo.map(function(a,b){return b})}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:b.dimensionAxis},measureAxisTitle:{component:this.components.measureAxisTitle,data:p},secondaryMeasureAxisTitle:{component:this.components.secondaryMeasureAxisTitle,data:q}}},k=this.components.dimensionAxisTitle,l=this.components.measureAxisTitle,m=this.components.secondaryMeasureAxisTitle,this._dataOptions=j;var r=[],s=[];h.forEach(function(a){r.push({label:a.qFallbackTitle,index:b.qHyperCube.qMeasureInfo.indexOf(a)})}),i.forEach(function(a){s.push({label:a.qFallbackTitle,index:b.qHyperCube.qMeasureInfo.indexOf(a)})}),this._data=b,k.setData(b),l.setData(r),m.setData(s),this.components.dataArea.setData(b),this.providers.colorMap.setData(b),this.components.colorLegend.setData(b);var u=this.providers.colorMap.getLegendDataProvider();u.setMeasureLegendTypes(b.qHyperCube.qMeasureInfo.map(function(a){return a.series&&a.series.type?"line"===a.series.type?b.dataPoint.show?["line","circle"]:["line"]:"marker"===a.series.type?[(a.series.markerFill===!1?"!":"")+(a.series.marker||"circle")]:["rect"]:["rect"]})),this._super(b,j),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(n.axisInnerOffset),this.components.scrollArea.setOffset(n.scrollOffset)):this.options.viewState?(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset)):isNaN(b.scrollStartPos)?(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)):this.components.scrollArea.setRelativeOffset(b.scrollStartPos),this._checkPage=!0},initSelections:function(){this._super(),this.options._disableSelections||(this.selections.types.range.addComponent("y",this.components.axis),this.selections.Select.bind(function(a,b){var c,d=this.selections.getActiveType().activeComponent;c=d.subComponents?this.components.dimensionAxis.getType().current:d.getSelectionIndices(),this.onSelection.Select.apply(this,[a,b,c])}.bind(this)))},updateDataArea:function(a){this._super.apply(this,[].slice.call(arguments)),"byExpression"===a.color.mode?this.components.dataArea.lineArea.interpolateVaryingColors=!a.color.expressionIsColor&&["sg","dg"].indexOf(a.color.measureScheme)!==-1:this.components.dataArea.lineArea.interpolateVaryingColors=!1,this.components.dataArea.lineArea.setShowDataPoints(a.dataPoint.show),this.components.dataArea.lineArea.setLineType("area"===a.lineType&&a.stackedArea?"stackedArea":a.lineType),this.components.dataArea.lineArea.setNullMode(a.nullMode),this.components.dataArea.barArea.setGroupingMode(a.barGrouping.grouping),this.components.dataArea.updateNow(["properties"])},getMinDiscreteUnitSize:function(){return this._minDiscreteUnitSize},updateAxis:function(b,c){var d,e,g,h=c.primary.indexOf(c.barSeries[0])>=0,i=this.getSnapshotStoredChartData(),j=t(b),k=a.extend(!0,{},b.measureAxes[0],{show:j.primaryMeasures.length?b.measureAxes[0].show:"none"}),l=a.extend(!0,{},b.measureAxes[1],{show:j.secondaryMeasures.length?b.measureAxes[1].show:"none",dock_:["near","far"].contains(b.measureAxes[0].dock)?"near"===b.measureAxes[0].dock?"far":"near":f.prototype.getOppositeDock.call({options:{dock:b.measureAxes[0].dock}})});this._super(b,c),this._cutMode={positive:!1,negative:!1};var m=this.components.dataArea.barArea.getMinorAxisData();m&&c.primary.forEach(function(a){c.barSeries.indexOf(a)<0&&!isNaN(a.qMin)&&(m.min=Math.min(a.qMin,m.min),m.max=Math.max(a.qMax,m.max))}),this._readStoredData&&i.dataRanges&&(m.min=i.dataRanges[0].min,m.max=i.dataRanges[0].max),u.apply(this,[this.components.measureAxis,c.primary,c.axes.measureAxis,h,m,h?this.getPrimaryMeasureSettings(b,c):null]),u.apply(this,[this.components.axis,c.secondary,c.axes.secondaryMeasureAxis,"zero"===b.nullMode,null]),e=this.chartFormatter.getFormattersForMeasures(b.qHyperCube.qMeasureInfo,c.primary.map(function(a){return b.qHyperCube.qMeasureInfo.indexOf(a)})),g=this.chartFormatter.getFormattersForMeasures(b.qHyperCube.qMeasureInfo,c.secondary.map(function(a){return b.qHyperCube.qMeasureInfo.indexOf(a)})),this.components.measureAxis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(e),this.components.axis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(g),c.barSeries.length?d=this.components.dataArea.barArea.getMajorAxisData():c.markerSeries.length?(d=this.components.dataArea.markerArea.getMajorAxisData(),c.lineSeries.length||d.data.forEach(function(a){for(var b=[],d=0;d<c.markerSeries.length;d++)b.push(a.cacheIndex[0]*c.markerSeries.length+d);a.cacheIndex=b})):d=c.lineSeries.length?this.components.dataArea.lineArea.getMajorAxisData():{data:[],info:[],groupSize:null},this.components.dimensionAxis.setDataRange(d.data,d.info),this._updateMinDiscreteUnitSize(this.components.dimensionAxis),!c.primary.length&&c.secondary.length||["all","labels"].indexOf(c.axes.measureAxis.data.show)<0&&c.secondary.length&&["all","labels"].indexOf(c.axes.secondaryMeasureAxis.data.show)>=0?this.components.grid.setAxes(this.components.dimensionAxis,this.components.axis):this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis);var o=this.components.dimensionAxisTitle,p=this.components.measureAxisTitle,q=this.components.secondaryMeasureAxisTitle;if(o.setDock("far"===b.dimensionAxis.dock?"top":"bottom"),p.setDock("far"===k.dock?"right":"left"),q.setDock("far"===l.dock?"right":"left"),o.setSelectionsEnabled(!!this.selections),p.setSelectionsEnabled(!!this.selections),q.setSelectionsEnabled(!!this.selections),c.primary.length&&c.secondary.length||b.measureAxes.every(function(a){return"none"===a.show}))this.components.dimensionAxis.setUnitAlignment("center");else{var r=c.primary.length?b.measureAxes[0]:b.measureAxes[1];this.components.dimensionAxis.setUnitAlignment(n.getAxisUnitAlignment(r.dock,this.components.dimensionAxis.isHorizontal()))}},_updateMinDiscreteUnitSize:function(a){this._super(a)},getPrimaryMeasureSettings:function(a,c){var d,e,f,g,h=c.primary.filter(function(a){return!isNaN(a.qMin)}).map(function(b){return{min:b.qMin,max:b.qMax,index:a.qHyperCube.qMeasureInfo.indexOf(b),isBarSeries:c.barSeries.indexOf(b)>=0}}),i=c.primary.filter(function(a){return!isNaN(a.qMin)&&c.barSeries.indexOf(a)<0});return h.length&&(d=h.reduce(function(a,b){return a.min<b.min?a:b},h[0]),e=h.reduce(function(a,b){return a.max>b.max?a:b},h[0]),e&&(g=d.max),d&&(f=d.min),b.isNumeric(f)||(f=0),b.isNumeric(g)||(g=1)),{minMeasure:d,maxMeasure:e,nonBarSeriesMax:Math.max.apply(null,i.map(function(a){return a.qMax})),nonBarSeriesMin:Math.min.apply(null,i.map(function(a){return a.qMin})),min:f,max:g,data:a,options:c}},getSpikeSettings:function(a,b){var c,d,e=a.data,f=a.minMeasure,g=a.maxMeasure,h=a.min,i=a.max,j=0,k=0,l=0,m=0,n=!1,o=!1,p=g.index+e.qHyperCube.qDimensionInfo.length,q=f.index+e.qHyperCube.qDimensionInfo.length,r=e.qHyperCube.qDataPages[0]?e.qHyperCube.qDataPages[0].qMatrix:[];if(!isNaN(a.nonBarSeriesMax)&&a.nonBarSeriesMax>0&&(j=a.nonBarSeriesMax),!isNaN(a.nonBarSeriesMin)&&a.nonBarSeriesMin<0&&(k=a.nonBarSeriesMin),!this.components.measureAxis.isStacked){for(var s=0;s<r.length;s++)c=r[s],d=c[p].qNum,d>0&&!isNaN(d)&&(c[0].qIsOtherCell||c[1].qIsOtherCell?l=Math.max(d,l):j=Math.max(d,j)),d=c[q].qNum,d<0&&!isNaN(d)&&(c[0].qIsOtherCell||c[1].qIsOtherCell?m=Math.min(d,m):k=Math.min(d,k));null!==b.max&&b.max<g.max?n=b.max>0:j>0&&l/j>5&&(i=j,n=i>=0),null!==b.min&&b.min>f.min?o=b.min<0:k<0&&m/k>5&&(h=k,o=h<0)}return{max:i,min:h,positive:n,negative:o}},getPreferredSize:function(){return this._super()}}),{type:"ComboChart",BackendApi:o,template:r,View:w,definition:j,softDefinition:k,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:17,qHeight:500}],qSuppressMissing:!0},measureAxes:[{autoMinMax:!0,dock:"near",max:10,min:0,minMax:"min",show:"all",spacing:1},{autoMinMax:!0,dock:"far",max:10,min:0,minMax:"min",show:"all",spacing:1}]},data:l,support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0},options:{selections:{dataArea:{},range:{},colorLegend:{}},tooltips:{}},getDropMeasureOptions:function(a,b,c,d,e){"measure"===a.item.type?(v.call(a,c,b,e),b.getMeasures().length>=b.minMeasures()&&a.ReplaceMeasures(c,b,e),d()):p.getDropMeasureOptions(a,b,c,d,e)},importProperties:function(a,c,d){var e,f=q.axisChart.importProperties.apply(q,[a,c,d]),g="linechart"===a.properties.visualization,h=[];return f.qProperty.qHyperCubeDef.qMeasures.forEach(function(a){a.qDef.series||(a.qDef.series={type:g?"line":"bar",axis:0,marker:"circle",markerFill:!0}),h.indexOf(a.qDef.series.axis)<0&&h.push(a.qDef.series.axis)}),e=h.sort().shift(),f.qProperty.measureAxes[e]&&a.properties.measureAxis&&"undefined"!=typeof a.properties.measureAxis.autoMinMax&&b.extend(!0,f.qProperty.measureAxes[e],a.properties.measureAxis,{logarithmic:!1}),f},exportProperties:q.axisChart.exportProperties.bind(q)}}),define("apis/qutil",["qvangular","core.utils/deferred","util","translator","core.utils/environment","general.utils/touch-configuration-util","client.utils/property-mapper","objects.utils/type-loader","general.utils/visualizations","general.models/library/extension-list","objects.utils/interaction-states","client.utils/rtl/direction-service","client.utils/rtl/direction-directive","general.services/content-api/content-api"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(){J||(J=!0,e.inClient()||(f.configureTouchSupport(),K||""!==d.localeDetected||d.setup({context:"devhub"})))}function n(a){K=!0,d.setup({context:"devhub",language:a})}function o(a){a?pubsub.publish("/ui/object/resize."+a):pubsub.publish("/resize/end")}function p(a){return j.getList().then(function(b){a&&a(b)})}function q(b,c,d){return a.getService("$contentApi").request({method:c||"GET",url:b,data:d})}function r(a){return a=a||{},{host:a.host||c.hostname,port:a.port?a.port.toString():c.port,isSecure:a.isSecure||c.isSecure,reloadURI:"no_reload"===a.reloadURI?"":c.reloadURI,prefix:a.prefix||c.basePath.replace("/extensions/","/"),openWithoutData:a.openWithoutData,identity:a.identity}}function s(a,b,c){var d="extensions/"+a+"/"+a;return define(d,b),h.registerExtension({id:a,data:c||{type:"visualization"}}),d}function t(a){var b="",c="";return a&&a.currentSelections?((a.noInteraction||a.noSelections)&&(c=" style='pointer-events:none;'"),b+='<qv-stage-current-selections class="qvt-selections" app="app"'+c+'></qv-stage-current-selections><div class="qv-global-search-container"'+c+"></div>"):b+='<qv-object model="model" options="options"></qv-object>',b}function u(b,c,d,e){if("string"==typeof b&&(b=document.getElementById(b)),b){var f=b[0]?b[0]:b;f.innerHTML=t(d);var g=a.$rootScope.$new();g.model=c,g.app=e,g.options=d||{},d&&d.noSelections&&(g.options.selections=!1),d&&d.noInteraction&&(g.options.interactionState=k.STATIC);var h=a.getService("$compile");return h(f)(g),l.isInit?g.options.direction=l.direction:l.init().then(function(){g.options.direction=l.direction,a.$apply(g)}),a.$apply(g),g}}function v(a){"string"==typeof a?a=document.getElementById(a):a[0]&&(a=a[0]),a.innerHTML=""}function w(c,d,e){var f=new b;return a.$apply(a.$rootScope,function(){c.rpc(d,null,e).then(function(){f.resolve()})}),f.promise}function x(a,b){a.qInfo=a.qInfo||{},a.qInfo.qType=a.qInfo.qType||b||"mashup",a.qInfo.qId=a.qInfo.qId||"MU"+c.generateId()}function y(a,b){var c={};return x(c,a),"BookmarkList"===a?c.qBookmarkListDef={qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description"}}:"SnapshotList"===a?c.qBookmarkListDef={qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}:"CurrentSelections"===a?c.qSelectionObjectDef=b||{}:"DimensionList"===a?c.qDimensionListDef={qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}:"MeasureList"===a?c.qMeasureListDef={qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}:"sheet"===a?c.qAppObjectListDef={qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}:"masterobject"===a?c.qAppObjectListDef={qType:"masterobject",qData:{name:"/metadata/name",visualization:"/visualization",tags:"/metadata/tags"}}:"VariableList"===a?c.qVariableListDef={qType:"variable",qData:{tags:"/tags"}}:"story"===a?c.qAppObjectListDef={qType:"story",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",rank:"/rank"}}:c["q"+a+"Def"]={},c}function z(a,b,c){if(Array.isArray(a)&&!Array.isArray(b)){var d=b||{},e=[],f=[],g=[];a.forEach(function(a){B(a)?(g.push(-1),f.push(a)):(g.push(e.length),e.push(a))});var h=e.length;return g.forEach(function(a,b){a<0&&(g[b]=h,h++)}),d.columnOrder=g,d.qInterColumnSortOrder=g,z(e,f,d)}var i=c||{};if(a){var j=[];a.forEach(function(a){"string"==typeof a?j.push({qDef:{qFieldDefs:[a]}}):j.push(a)}),i.qDimensions=j}var k=[];return b.forEach(function(a){"string"==typeof a?k.push({qDef:{qDef:a}}):k.push(a)}),i.qMeasures=k,i.qInitialDataFetch=[{qTop:0,qLeft:0,qHeight:20,qWidth:(i.qDimensions?i.qDimensions.length:0)+i.qMeasures.length}],c&&c.rows&&(i.qInitialDataFetch[0].qHeight=c.rows),i}function A(a,b,c){for(var d in b)b.hasOwnProperty(d)&&(b[d]instanceof Object&&!Array.isArray(b[d])?A(a+d+"/",b[d],c):c.push({qPath:a+d,qOp:"add",qValue:"string"==typeof b[d]?'"'+b[d]+'"':JSON.stringify(b[d])}))}function B(a){return"string"==typeof a?0===a.indexOf("="):a.qType?"measure"===a.qType:!!(a.qDef&&a.qDef.qDef||a.qSortBy||a.qAttributeExpressions)}function C(a){a.qDef=a.qDef||{},a.qDef.cId=c.generateId()}function D(a,b){var d=c.extend(!0,{},b);return"string"==typeof a?(d.qDef=d.qDef||{},d.qDef.qDef=a):d=c.extend(!0,d,a),d.qSortBy=d.qSortBy||{qSortByLoadOrder:1,qSortByNumeric:-1},C(d),d}function E(a,b){var d=c.extend(!0,{},b);return"string"==typeof a?(d.qDef=d.qDef||{},d.qDef.qFieldDefs=[a]):d=c.extend(!0,d,a),d.qSortCriterias=d.qSortCriterias||[{qSortByAscii:1,qSortByLoadOrder:1}],C(d),d}function F(a,b,c){return a=a?a+", ":"",a+d.get(b,JSON.stringify(c))}function G(a){if(!Array.isArray(a))return d.get("Devhub.Cols.Array");var b;return a.forEach(function(a){"object"==typeof a?a.qType?"measure"!==a.qType&&"dimension"!==a.qType?b=F(b,"Devhub.Cols.InvalidQtype",a):a.qLibraryId||(b=F(b,"Devhub.Cols.QlibraryIdMissing",a)):a.qDef?a.qDef.qDef?"string"!=typeof a.qDef.qDef&&(b=F(b,"Devhub.Cols.QdefString",a)):a.qDef.qFieldDefs?Array.isArray(a.qDef.qFieldDefs)||(b=F(b,"Devhub.Cols.QfielddefArray",a)):b=F(b,"Devhub.Cols.QdefOrQfielddefs",a):b=F(b,"Devhub.Cols.QdefOrQlibraryid",a):"string"!=typeof a&&(b=F(b,"Devhub.Cols.InvalidType",a))}),b}function H(a,b,c,d){if(a.qHyperCubeDef){var e=[];b.forEach(function(b){B(b)?(e.push(-1),a.qHyperCubeDef.qMeasures.push(D(b,d))):(e.push(a.qHyperCubeDef.qDimensions.length),a.qHyperCubeDef.qDimensions.push(E(b,c)))});var f=a.qHyperCubeDef.qDimensions.length;e.forEach(function(a,b){a<0&&(e[b]=f,f++)}),a.qHyperCubeDef.columnOrder=e,a.qHyperCubeDef.qInterColumnSortOrder=e}else a.qListObjectDef&&b.forEach(function(b,c){0===c?(a.qListObjectDef.qDef||(a.qListObjectDef.qDef={}),a.qListObjectDef.qDef.qFieldDefs=[b]):(a.qListObjectDef.qExpressions||(a.qListObjectDef.qExpressions=[]),a.qListObjectDef.qExpressions.push(D(b,d)))})}function I(a,e,f){var h=i.getType(a);return h?h.getInitialProperties({}).then(function(a){if(f&&c.extend(!0,a,f),e){var d=G(e);return d?b.reject(d):h.getExtensionType().then(function(b){var c,d;return b.mapProperties(),a.qHyperCubeDef?(c=g.mapProperties(g.findDefinition(b.mappedDefinition,"qHyperCubeDef.qMeasures",!0)),d=g.mapProperties(g.findDefinition(b.mappedDefinition,"qHyperCubeDef.qDimensions",!0))):a.qListObjectDef&&(d=g.mapProperties(g.findDefinition(b.mappedDefinition,"qListObjectDef",!0))),H(a,e,d,c),a})}return a}):b.reject(d.get("Devhub.Visualization.InvalidType",a))}var J=!1,K=!1,L={createVisualizationHtml:t,showVisualization:u,clearElement:v,appDoIt:w,setDefaultId:x,getDefaultListParam:y,createHypercubeDef:z,makeConfig:r,inClient:e.inClient,initClient:m,registerExtension:s,addPatches:A,isMeasure:B,makeMeasure:D,makeDimension:E,addColumns:H,validateColumns:G,createDefinition:I,setLanguage:n,resize:o,getExtensionList:p,callRepository:q};return Object.defineProperty(L,"Promise",{get:function(){return b.Promise}}),L}),define("client.controllers/warning-handler-controller",["jquery","qvangular","autogenerated/qix/engine-enums","core.utils/external-urls","text!general.controllers/expire-dialog.ng.html","general.services/delayed-modal/delayed-modal"],function(a,b,c,d,e){"use strict";function f(){b.getService("$delayedModal").scope.$on("delayed-modal-closed",function(){n.length&&b.getService("$timeout")(function(){i(n.shift())})})}function g(a,b){for(var c=-1,d=0;d<a.length;d++)if(a[d].code===b){c=d;break}return c}function h(a,b){if(b.shown){var c=g(a,b.code);c!==-1&&a.splice(c,1)}else g(a,b.code)!==-1&&(b.shown=!0,b.interval?localStorage.setItem(b.label,Date.now()+b.interval):sessionStorage.setItem(b.label,!0))}function i(c){var g={};k.ready.then(function(){if(g=a.extend(!0,{},c,{title:"WarningDialog.Title",content:"undefined"!=typeof c.code?"WarningCode."+c.code:c.message,buttons:m,showDefaultButton:!1}),"undefined"!=typeof c.code&&c.code===l.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON){var h=k.get("Info.QlikSenseDesktop.Upgrade.Expiring",["<a href='"+d.personalUpgradeUrl+"' target='_blank'>"+d.personalUpgradeBase+"</a>"]);g.html=e.replace("<upgrade-msg/>",h),g.title="Info.QlikSenseDesktop.Upgrade.Expiring.Title"}b.getService("$delayedModal").open(g),f()}),document.activeElement&&a(document.activeElement).blur()}function j(c,d){var e=a.extend(!0,[],c);k||(k=d),h(e,o),h(e,p),e.length>0&&(n.push.apply(n,e),b.getService("$delayedModal").isOpened?f():i(n.shift()))}var k,l=c.NxLocalizedWarningCode,m=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0}],n=[],o={code:l.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON,label:"ExpireWarningShown",shown:Date.now()<parseInt(localStorage.ExpireWarningShown,10),interval:864e5},p={code:l.LOCWARN_PERSONAL_RELOAD_REQUIRED,label:"HiddenScriptWarningShown",shown:sessionStorage.HiddenScriptWarningShown};return{showDialog:j}}),define("client.models/rpc-session",["core.models/rpc-session","core.utils/websocket","core.utils/authentication","core.utils/debug-flags","translator","general.controllers/error-handler-controller","client.controllers/warning-handler-controller","qvangular"],function(a,b,c,d,e,f,g,h){function i(a){var b=["OnLicenseAccessDenied","OnLicenseAccessDeniedPendingUserSync","OnSessionClosed","OnNoAppFound","OnEngineWebsocketFailed","OnNoEngineAvailable","OnSessionTimedOut","OnSessionClosed","OnNoDataPrepServiceAvailable","OnDataPrepServiceWebsocketFailed"];"OnSessionLoggedOut"===a.method?f.showDialog(a.method):"OnEngineWebsocketFailed"===a.method?f.showDialog({method:a.method,message:"ProxyError."+a.method}):b.indexOf(a.method)>-1?f.showDialog({message:"ProxyError."+a.method,refreshButton:!0}):"OnAuthenticationInformation"===a.method&&c.parse(a.params)}function j(a){var b="method"in a?"SENT":"RECV";window.console.info("[DBGFLG:SOCKET]",b,":",a)}function k(a){var b=[];if(!this.reqCache[a.id]||"ExportData"!==this.reqCache[a.id].method){for(var c=0;c<a.warnings.length;c++)b.push({code:a.warnings[c]});g.showDialog(b,e)}}var l,m=[];return a.createSocket=function(a){var c;try{c=new b(a)}catch(d){f.showDialog({message:"ErrorDialog.NoConnectionCreated"})}return c},a.debounceApply=function(a){clearTimeout(l),m.push(a),l=setTimeout(function(){h.$apply(h.$rootScope,function(){for(var a=0;a<m.length;a++)try{m[a]()}catch(b){}m.length=0})})},a.NewSessionCreated.bind(function(a){a.Notification.bind(i),a.Warning.bind(k),d.SOCKET&&(a.Data.bind(j),a.Error.bind(j),a.Send.bind(j))}),a}),define("apis/qglobal",["qvangular","core.models/app","client.models/rpc-session","apis/qutil"],function(a,b,c,d){"use strict";function e(a,b,c,d){return a.session.rpc({method:b,handle:-1,params:c||[]}).then(function(a){return d&&d(a.result),a.result})}function f(c,d,e){a.$apply(a.$rootScope,function(){b.getList(c).then(function(a){e&&c.close(),d(a)})})}function g(a){"function"==typeof a.rpc?this.session=a:(this.session=c.get("?transient=",a),this.session.open())}return g.get=function(a){return new g(d.makeConfig(a))},g.getAppList=function(a,b){var e=c.get("?transient=",d.makeConfig(b));e.open(),f(e,a,!0)},g.prototype.getAppList=function(a){f(this.session,a,!1)},g.prototype.getAuthenticatedUser=function(a){return e(this,"GetAuthenticatedUser",[],a)},g.prototype.isPersonalMode=function(a){return e(this,"IsPersonalMode",[],a)},g.prototype.getQTProduct=function(a){return e(this,"QTProduct",[],a)},g.prototype.getProductVersion=function(a){return e(this,"ProductVersion",[],a)},g.prototype.getQvVersion=function(a){return this.getProductVersion(a)},g.prototype.cancelReload=function(){return e(this,"CancelReload")},g.prototype.getProgress=function(a,b){return e(this,"GetProgress",[a],b)},g.prototype.GetProgress=function(a,b){
return this.getProgress(a,b)},g}),define("client.models/current-selections",["core.models/session-object","core.models/app","general.models/field"],function(a,b,c){"use strict";function d(a,b,d){c.get(b,void 0,a).then(function(a){a[d]()})}var e;return e=a.extend("CurrentSelections",{clearField:function(a){d(this.app,a,"clear")},lockField:function(a){d(this.app,a,"lock")},unlockField:function(a){d(this.app,a,"unlock")},clearAll:function(){return this.app.rpc("ClearAll",null)},back:function(){return this.app.rpc("Back",null)},forward:function(){return this.app.rpc("Forward",null)}}),e.get=function(c){return c=c||b.current,a.get.call(this,{qInfo:{qType:"CurrentSelection"},qSelectionObjectDef:{}},c).then(function(a){return a.app=c,a})},e}),define("client.models/snapshot",["client.models/bookmark","core.utils/deferred"],function(a,b){"use strict";var c,d=500;return c=a.extend("Snapshot",{applyEmbeddedSnapshot:function(){return this.rpc("Apply")}},{listProperties:{qBookmarkListDef:{qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}}}),c.getLibraryContent=function(a,c){var d,e=new b;return this.getList().then(function(b){b.getLayout().then(function(b){d=b.filter(function(b){var c=!0;return a&&(c=a===b.qData.sourceObjectId),!b.qData.isClone&&c}),e.resolve(d)}),b.Invalidated&&b.Invalidated.unbind(),b.Invalidated.bind(c)}),e.promise},c.unbindList=function(){this.getList().then(function(a){a.Invalidated.unbind()})},c.getSnapshotCount=function(a){var c,d=new b,e=0;return this.getListLayout().then(function(b){for(c=0;c<b.length;c++)b[c].qData.isClone||b[c].qData.sourceObjectId!==a||e++;d.resolve(e)}),d.promise},c.create=function(e,f){var g,h,i=new b,j=0;return this.getListLayout().then(function(b){for(g=0;g<b.length;g++)b[g].qData.isClone||j++;h=j<d,h?a.create.call(c,e,f).then(function(a){i.resolve({limit:h,id:a.id})}):i.resolve(h)}),i.promise},c.getEmbedded=function(a){var c=this;return a.enigmaModel.getSnapshotObject().then(function(d){return c.getModel(d.id,a.session,function(){return b.resolve(d)})})},{Snapshot:c}}),define("apis/qfieldvalue",[],function(){"use strict";function a(a,b){Object.defineProperties(this,{qText:{value:a.qText},qElemNumber:{value:a.qElemNumber},qState:{value:a.qState},field:{value:b}}),isNaN(a.qNum)||Object.defineProperties(this,{qNum:{value:a.qNum}}),a.qFrequency&&Object.defineProperties(this,{qFrequency:{value:a.qFrequency}})}return a.prototype.select=function(a,b){return this.field.select([this.qElemNumber],a||!1,b||!1)},a}),define("apis/qfield",["core.utils/deferred","general.models/field","core.utils/notification","apis/qfieldvalue"],function(a,b,c,d){"use strict";function e(b,c,d,e,f,g,h){return b.waitFor?b.waitFor.then(function(){return b.field[c](d,e,f,g,h)}):a.resolve()}function f(d,e,f){var g=this;if(g.qapp=d,g.fldname=e,g.rows=[],g.qapp.model.session){c.create(g,"OnData");var h=new a;g.waitFor=h.promise,g.qapp.model.waitForOpen.promise.then(function(){b.get(e,f||"$",d.model).then(function(a){g.field=a,h.resolve()})})}}return f.prototype.clear=function(){return e(this,"clear")},f.prototype.lock=function(){return e(this,"lock")},f.prototype.unlock=function(){return e(this,"unlock")},f.prototype.clearOther=function(a){return e(this,"clearOther",a||!1)},f.prototype.selectAll=function(a){return e(this,"selectAll",a||!1)},f.prototype.selectExcluded=function(a){return e(this,"selectExcluded",a||!1)},f.prototype.selectAlternative=function(a){return e(this,"selectAlternative",a||!1)},f.prototype.selectPossible=function(a){return e(this,"selectPossible",a||!1)},f.prototype.toggleSelect=function(a,b){return e(this,"toggleSelect",a,b||!1)},f.prototype.selectMatch=function(a,b){return e(this,"selectMatch",a,b||!1)},f.prototype.select=function(a,b,c){return e(this,"select",a,b||!1,c||!1)},f.prototype.selectValues=function(a,b,c){var d=[];return a.forEach(function(a){"number"==typeof a?d.push({qIsNumeric:!0,qNumber:a}):"string"==typeof a?d.push({qText:a}):d.push(a)}),e(this,"selectValues",d,b||!1,c||!1)},f.prototype.getData=function(a){if(this.requestActive)return this;this.requestActive=!0,this.genericObject&&(this.genericObject.close(),delete this.genericObject);var b=this;return this.qapp.createGenericObject({qListObjectDef:{qDef:{qFieldDefs:[this.fldname]},qFrequencyMode:a&&a.freq||"V",qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:a&&a.rows||200,qWidth:1}]}},function(a){b.rows.length=0,a.qListObject.qDataPages.forEach(function(a){a.qMatrix.forEach(function(a){b.rows.push(new d(a[0],b))})}),b.rowCount=a.qListObject.qDimensionInfo.qCardinal,b.stateCounts=a.qListObject.qDimensionInfo.qStateCounts,b.requestActive=!1,b.OnData.emit()}).then(function(a){b.genericObject=a}),this},f.prototype.getMoreData=function(){if(this.requestActive)return this;if(this.rowCount<=this.rows.length)return this;this.requestActive=!0;var a=this,b={qTop:this.rows.length,qLeft:0,qWidth:1,qHeight:50};return a.genericObject.rpc("GetListObjectData",null,["/qListObjectDef",[b]]).then(function(b){b.qDataPages[0].qMatrix.forEach(function(b){a.rows.push(new d(b[0],a))}),a.requestActive=!1,a.OnData.emit()}),this},f}),define("apis/qbookmark",["client.models/bookmark","client.models/current-selections"],function(a,b){"use strict";function c(a){this.app=a}return c.prototype.create=function(c,d,e){var f=this;return f.app.waitForOpen.promise.then(function(){return b.get(f.app).then(function(b){return b.getLayout().then(function(){var g,h=b.layout.qSelectionObject?b.layout.qSelectionObject.qSelections:null,i={currentSelectFields:[],currentSelectCount:0};if(h&&h.length>0)for(i.currentSelectCount=h.length,g=0;g<h.length;g++)i.currentSelectFields.push(h[g].qField);var j="";for(g=0;g<i.currentSelectCount;g++)g>0&&(j+=", "),j+=i.currentSelectFields[g];var k={qMetaDef:{title:c,description:d},selectionFields:j};return e&&(k.sheetId=e),a.create(k,f.app)})})})},c.prototype.apply=function(b){return a.apply(b,this.app)},c.prototype.remove=function(b){return a.remove(b,this.app)},c}),define("apis/qvariable",[],function(){"use strict";function a(a){return a.waitForOpen.promise.then(function(){return a.enigmaModel})}function b(a,b){this.app=a,this.qapp=b}function c(a){var b="string"==typeof a?{qName:a}:a;return b.qInfo=b.qInfo||{},b.qInfo.qType=b.qInfo.qType||"Variable",b}return b.prototype.create=function(b){var d=c(b);return a(this.app).then(function(a){return a.createVariableEx(d)})},b.prototype.createSessionVariable=function(b){var d=c(b);return a(this.app).then(function(a){return a.createSessionVariable(d)})},b.prototype.get=function(b){return a(this.app).then(function(a){return a.getVariableById(b)})},b.prototype.getByName=function(b){return a(this.app).then(function(a){return a.getVariableByName(b)})},b.prototype.setStringValue=function(b,c){return a(this.app).then(function(a){return a.getVariableByName(b)}).then(function(a){return a.setStringValue(c)})},b.prototype.setNumValue=function(b,c){return a(this.app).then(function(a){return a.getVariableByName(b)}).then(function(a){return a.setNumValue(c)})},b.prototype.setContent=function(a,b){return this.setStringValue(a,b+"")},b.prototype.getContent=function(a,b){var c=this.qapp,d=b?function(a){b(a,c)}:function(){};return this.getByName(a).then(function(a){return a?a.getLayout().then(function(a){var b={qContent:{qString:a.qText,qIsNum:!isNaN(a.qNum)}};return d(b,c),b}):a})},b}),define("apis/qtable",["core.utils/notification","objects.error-handling/error-translation"],function(a,b){"use strict";function c(a,c,d){Object.defineProperties(this,{qFallbackTitle:{value:a.qFallbackTitle},qSortIndicator:{value:a.qSortIndicator},qReverseSort:{value:a.qReverseSort||!1},col:{value:c},isOrderedBy:{value:c===d.qHyperCube.qEffectiveInterColumnSortOrder[0]},isDimension:{value:c<d.qHyperCube.qDimensionInfo.length},selections:{value:[]},parent:{value:d}}),this.isDimension?Object.defineProperties(this,{qCardinal:{value:a.qCardinal},qStateCounts:{value:a.qStateCounts},qDimensionInfo:{value:a}}):Object.defineProperties(this,{qMax:{value:a.qMax},qMin:{value:a.qMin},qMeasureInfo:{value:a}}),a.qGroupFieldDefs&&a.qGroupFieldDefs.length>0&&Object.defineProperties(this,{field:{value:d.app.field(a.qGroupFieldDefs[a.qGroupPos])}}),a.qError&&Object.defineProperties(this,{errorCode:{value:a.qError.qErrorCode},errorMessage:{value:this.isDimension?b.getDimensionError(a.qError.qErrorCode):b.getMeasureError(a.qError.qErrorCode)}})}function d(a,b,c,d){Object.defineProperties(this,{qDimensionInfo:{value:b},qText:{value:a.qIsOtherCell?b.othersLabel:a.qText},qElemNumber:{value:a.qElemNumber},qState:{value:a.qState},col:{value:c},selected:{get:function(){return this.header.isSelected(this.qElemNumber)}},header:{get:function(){return this.parent.headers[this.col]}},parent:{value:d}}),isNaN(a.qNum)||Object.defineProperties(this,{qNum:{value:a.qNum}})}function e(a,b,c){Object.defineProperties(this,{qMeasureInfo:{value:b},qGrandTotal:{value:c},qText:{value:a.qText}}),isNaN(a.qNum)||Object.defineProperties(this,{qNum:{value:a.qNum}})}function f(a,b,c){var f=[],g=[],h=[],i=b.qDimensionInfo.length,j=b.columnOrder;a.forEach(function(a,h){h<i?f.push(new d(a,b.qDimensionInfo[h],h,c)):g.push(new e(a,b.qMeasureInfo[h-i],b.qGrandTotalRow[h-i]))}),j?j.forEach(function(a){h.push(a<i?f[a]:g[a-i])}):h=f.concat(g),Object.defineProperties(this,{dimensions:{value:f},measures:{value:g},cells:{value:h}})}function g(b,c,d){if(a.create(this,"OnData"),Object.defineProperties(this,{app:{value:b},path:{value:d||"qHyperCube"},defPath:{get:function(){return this.path+"Def"}},rows:{value:[]},headers:{value:[]},totals:{value:[]},rowCount:{get:function(){if(this.qHyperCube&&this.qHyperCube.qSize)return this.qHyperCube.qSize.qcy}},colCount:{get:function(){if(this.qHyperCube&&this.qHyperCube.qSize)return this.qHyperCube.qSize.qcx}}}),"function"==typeof c.then){var e=this;c.then(function(a){h(e,a)})}else{var f=c.backendApi?c.backendApi.model:c;h(this,f,c.backendApi?c:void 0)}}function h(a,b,c){Object.defineProperties(a,{model:{value:b},view:{value:c}}),i(a),a.model&&a.model.Validated&&(a._OnModelValid=function(){i(a)},a.model.Validated.bind(a._OnModelValid))}function i(a){if(!a.qHyperCube&&a.model.layout&&(a.qHyperCube=a.model.layout[a.path]),!(a.model&&a.model.layout&&a.model.layout.qSelectionInfo&&a.model.layout.qSelectionInfo.qInSelections)){if(a.headers.length=0,a.totals.length=0,a.rows.length=0,a.qHyperCube){var b=a.qHyperCube.qDimensionInfo?a.qHyperCube.qDimensionInfo.length:0,d=a.qHyperCube.columnOrder;a.qHyperCube.qDimensionInfo&&a.qHyperCube.qDimensionInfo.forEach(function(b,e){if(d){var f=d.indexOf(e);a.headers[f]=new c(b,e,a)}else a.headers.push(new c(b,e,a))}),a.qHyperCube.qMeasureInfo&&a.qHyperCube.qMeasureInfo.forEach(function(e,f){if(d){var g=d.indexOf(f+b);a.headers[g]=new c(e,f+b,a)}else a.headers.push(new c(e,f+b,a))}),a.qHyperCube.qGrandTotalRow&&a.qHyperCube.qGrandTotalRow.forEach(function(b,c){a.totals.push(new e(b,a.qHyperCube.qMeasureInfo[c]))}),j(a,a.qHyperCube.qDataPages)}a.OnData.emit()}}function j(a,b){b&&b.forEach(function(b){b.qMatrix.forEach(function(b){a.rows.push(new f(b,a.qHyperCube,a))})})}return c.prototype.orderBy=function(){var a=[this.col];this.parent.qHyperCube.qEffectiveInterColumnSortOrder.forEach(function(b){b!==a[0]&&a.push(b)});var b=[{qPath:"/"+this.parent.defPath+"/qInterColumnSortOrder",qOp:"replace",qValue:"["+a.join(",")+"]"}];return this.parent.model.applyPatches(b,!0)},c.prototype.reverseOrder=function(){var a=this.col<this.parent.qHyperCube.qDimensionInfo.length,b=[{qPath:"/"+this.parent.defPath+(a?"/qDimensions/"+this.col:"/qMeasures/"+(this.col-this.parent.qHyperCube.qDimensionInfo.length))+"/qDef/qReverseSort",qOp:"replace",qValue:(!this.qReverseSort).toString()}];return this.parent.model.applyPatches(b,!0)},c.prototype.isSelected=function(a){return this.selections.indexOf(a)>-1},c.prototype.toggleSelect=function(a){var b=this.selections.indexOf(a);b<0?this.selections.push(a):this.selections.splice(b,1)},c.prototype.selectRange=function(a,b,c,d){var e={qMeasureIx:this.col-this.parent.qHyperCube.qDimensionInfo.length,qRange:{qMin:a,qMax:b,qMinInclEq:c,qMaxInclEq:d}};return this.parent.model.rpc("RangeSelectHyperCubeValues",null,["/"+this.parent.defPath,[e],[],!1])},d.prototype.select=function(){return this.header.toggleSelect(this.qElemNumber),this.parent.view&&this.parent.view.selectValues?this.parent.view.selectValues(this.col,[this.qElemNumber],!0):this.parent.model.rpc("SelectHyperCubeValues",null,["/"+this.parent.defPath,this.col,[this.qElemNumber],!0])},e.prototype.getPercentOfMax=function(){return Math.round(100*this.qNum/this.qMeasureInfo.qMax*100)/100},e.prototype.getPercent=function(){return Math.round(100*this.qNum/this.qGrandTotal.qNum*100)/100},g.prototype.getMoreData=function(){if(!(this.requestActive||this.rowCount<=this.rows.length)){this.requestActive=!0;var a=this,b={qTop:this.rows.length,qLeft:0,qWidth:this.colCount,qHeight:50};return a.view?a.view.backendApi.getData([b]).then(function(b){j(a,b),a.requestActive=!1,a.OnData.emit()}):a.model.getData([b]).then(function(b){j(a,b),a.requestActive=!1,a.OnData.emit()})}},g.prototype.getColByName=function(a){if(a){var b,c=a.toUpperCase();return this.headers.forEach(function(a,d){a.qFallbackTitle.toUpperCase()===c&&(b=d)}),b}},g.prototype.exportData=function(a,b){return a=a||{},this.model.exportData(a.format||"OOXML","/"+this.defPath,a.filename,a.state||"P").then(function(c){var d="../.."+c.result.qUrl;a.download&&window.open(d),b&&b(d)})},g.prototype.destroy=function(){this.model&&this.model.Validated&&this._OnModelValid&&(this.model.Validated.unbind(this._OnModelValid),delete this._OnModelValid)},g}),define("apis/qvisualization",["objects.utils/type-loader","apis/qtable","apis/qutil"],function(a,b,c){"use strict";function d(a){this.qapp=a}function e(a,c){Object.defineProperties(this,{id:{value:c.id},qapp:{value:a},model:{value:c}}),c.layout.qHyperCube&&Object.defineProperties(this,{table:{value:new b(this.qapp,c),configurable:!0}})}return d.prototype.get=function(a){var b=this;return b.qapp.getObject(a).then(function(a){return new e(b.qapp,a)})},d.prototype.create=function(b,d,f){var g=this;return a.load().then(function(){return c.createDefinition(b,d,f).then(function(a){return g.qapp.createGenericObject(a).then(function(a){return new e(g.qapp,a)})})})},e.prototype.setOptions=function(a){var b=[];return c.addPatches("/",a,b),this.model.applyPatches(b,!0)},e.prototype.show=function(a,b){var d=c.showVisualization(a,this.model,b);return this._scopes=this._scopes||[],this._scopes.push(d),this._elements=this._elements||[],this._elements.push(a),d},e.prototype.close=function(){return this._scopes&&(this._scopes.forEach(function(a){a.$destroy()}),delete this._scopes),this._elements&&(this._elements.forEach(function(a){c.clearElement(a)}),delete this._elements),this.table&&(this.table.destroy(),delete this.table),this.model.close()},e.prototype.resize=function(){c.resize(this.id)},d}),define("apis/qselection-state",["core.utils/notification"],function(a){"use strict";function b(a,b){Object.defineProperties(this,{fieldName:{value:a.qField},field:{get:function(){return d(this.parent,this.fieldName)}},qSortIndex:{value:a.qSortIndex},locked:{value:a.qLocked||!1},isNumeric:{value:a.qIsNum||!1},totalCount:{value:a.qTotal},selectedCount:{value:a.qSelectedCount},qStateCounts:{value:a.qStateCounts},qSelected:{value:a.qSelected},selectedValues:{value:a.qSelectedFieldSelectionInfo},notSelectedValues:{value:a.qNotSelectedFieldSelectionInfo},qSelectionThreshold:{value:a.qSelectionThreshold},qTextSearch:{value:a.qTextSearch},qRangeInfo:{value:a.qRangeInfo},parent:{value:b}})}function c(b,c,d){a.create(this,"OnData"),Object.defineProperties(this,{qapp:{value:b},selections:{value:[]},stateName:{value:d||"$"}});var f=this;c.then(function(a){e(f,a),a.Validated.bind(function(){e(f,a)})})}function d(a,b){return a.qapp.field(b,a.stateName)}function e(a,c){a.selections.length=0,c.layout.qSelectionObject&&(void 0===a.backCount&&Object.defineProperties(a,{backCount:{get:function(){return c.layout.qSelectionObject.qBackCount||0}},forwardCount:{get:function(){return c.layout.qSelectionObject.qForwardCount||0}}}),c.layout.qSelectionObject.qSelections.forEach(function(c){a.selections.push(new b(c,a))}),a.OnData.emit())}return c.prototype.clearAll=function(a){return this.qapp.clearAll(a,this.stateName)},c.prototype.lockAll=function(){return this.qapp.lockAll(this.stateName)},c.prototype.unlockAll=function(){return this.qapp.unlockAll(this.stateName)},c}),define("apis/qapp",["core.utils/deferred","core.models/app","autogenerated/qix/engine-enums","core.models/session-object","core.models/generic-object","client.models/current-selections","objects.models/visualization-object","client.models/snapshot","objects.backend-api/snapshot-api","apis/qfield","apis/qbookmark","apis/qvariable","apis/qglobal","apis/qtable","apis/qutil","apis/qvisualization","apis/qselection-state"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){this.fieldCache={},this.stateCache={},Object.defineProperties(this,{id:{value:a.id},model:{value:a}}),a.session&&Object.defineProperties(this,{global:{value:new m(a.session)},bookmark:{value:new k(a)},variable:{value:new l(a,this)},visualization:{value:new p(this)}}),this.getAppLayout()}function s(b,c){var d=c||new a;return b.getLayout().then(function(){d.resolve(b)},function(a){d.reject(a)}),d.promise}var t,u,v=c.NxLocalizedErrorCode,w={};return r.prototype.clearAll=function(a,b){return o.appDoIt(this.model,"ClearAll",[a||!1,b||"$"])},r.prototype.back=function(){return o.appDoIt(this.model,"Back")},r.prototype.forward=function(){return o.appDoIt(this.model,"Forward")},r.prototype.lockAll=function(a){return o.appDoIt(this.model,"LockAll",[a||"$"])},r.prototype.unlockAll=function(a){return o.appDoIt(this.model,"UnlockAll",[a||"$"])},r.prototype.getObject=function(b,c,d){var e,h,i=this.model;return c||(c=b,b=void 0),e=new a,i.waitForOpen.promise.then(function(){if("CurrentSelections"===c){if(b){var a=d||{};a.currentSelections=!0,h=o.showVisualization(b,null,a,i)}f.get(i).then(function(a){a.close=h?h.$destroy.bind(h):function(){},e.resolve(a)})}else g.get(c,i).then(function(a){b&&(h=o.showVisualization(b,a,d),a.Closed.bind(function(){h.$destroy(),o.clearElement(b)})),s(a,e)},function(a){t&&(t(a.error),a.error.isHandled=!0),e.reject(a.error)})},function(){e.reject()}),e.promise},r.prototype.getSnapshot=function(a,b){b||(b=a,a=void 0);var c=this.model;return c.waitForOpen.promise.then(function(){return h.Snapshot.get(b,c).then(function(b){return a&&o.showVisualization(a,b,{APIType:i,noInteraction:!0}),b.getLayout().then(function(){return b})})})},r.prototype.getObjectProperties=function(a){var b=this.model;return b.waitForOpen.promise.then(function(){return e.getProperties(a,b)})},r.prototype.getFullPropertyTree=function(a){var b=this.model;return b.waitForOpen.promise.then(function(){return e.get(a,b).then(function(a){return a.getFullPropertyTree().then(function(){return a})})})},r.prototype.createGenericObject=function(b,c){var e=this;return e.model.waitForOpen.promise.then(function(){var a=c?function(a){c(a,e)}:function(){};return o.setDefaultId(b),d.get(b,e.model).then(function(b){return b.Invalidated.bind(function(){b.getLayout().then(a)}),b.Aborted.bind(function(){b.getLayout().then(a)}),b.getLayout().then(function(c){return a(c),b})},function(a){t&&(t(a.error,e),a.error.isHandled=!0)})},function(){return a.reject()})},r.prototype.destroySessionObject=function(a){return this.model.rpc("DestroySessionObject",null,[a])},r.prototype.createCube=function(a,b){return this.createGenericObject({qHyperCubeDef:a},b)},r.prototype.createList=function(a,b){return this.createGenericObject({qListObjectDef:a},b)},r.prototype.getList=function(a,b){return this.createGenericObject(o.getDefaultListParam(a),b)},r.prototype.getAppObjectList=function(a,b){return b||(b=a,a="sheet"),this.getList(a,b)},r.prototype.searchSuggest=function(a,b,c){var d=this.model.rpc("SearchSuggest",null,[b,a]);return c&&d.then(function(a){c(a)}),d},r.prototype.searchAssociations=function(a,b,c,d){var e=this.model.rpc("SearchAssociations",null,[c||{},a,b]);return d&&e.then(function(a){d(a)}),e},r.prototype.searchResults=function(a,b,c,d){var e=this.model.rpc("SearchResults",null,[c||{},a,b]);return d&&e.then(function(a){d(a)}),e},r.prototype.selectAssociations=function(a,b,c){return this.model.rpc("SelectAssociations",null,[c||{},b,a])},r.prototype.getAppLayout=function(b){var c=this,d=new a,e=b?function(a){b(a.layout,c)}:function(){};return c.model.waitForOpen?c.model.waitForOpen.promise.then(function(){c.model.Invalidated&&c.model.Invalidated.bind(function(){s(c.model).then(e)}),c.model.Aborted&&c.model.Aborted.bind(function(){s(c.model).then(e)}),s(c.model).then(function(a){e(a),d.resolve(a)})}):s(c.model).then(function(a){e(a),d.resolve(a)}),d.promise},r.prototype.addAlternateState=function(a){return this.model.rpc("AddAlternateState",null,[a])},r.prototype.removeAlternateState=function(a){return this.model.rpc("RemoveAlternateState",null,[a])},r.prototype.doReload=function(a,b,c){return this.fieldCache={},this.model.rpc("DoReload",null,[a||0,b||!1,c||!1])},r.prototype.doSave=function(a){return this.model.rpc("DoSave",null,[a])},r.prototype.field=function(a,b){var c=b?a+"/"+b:a;return this.fieldCache[c]||(this.fieldCache[c]=new j(this,a,b)),this.fieldCache[c]},r.prototype.table=function(a,b){return new n(this,a,b)},r.setErrorCallback=function(a){t=a},r.prototype.createTable=function(a,b,c){var d=o.createHypercubeDef(a,b,c);return new n(this,this.createGenericObject({qHyperCubeDef:d}))},r.prototype.selectionState=function(a){var b=a||"$";if(!this.stateCache[b]){var c=o.getDefaultListParam("CurrentSelections",{qStateName:b});this.stateCache[b]=new q(this,this.createGenericObject(c),b)}return this.stateCache[b]},r.currApp=function(a){var c=a&&a.backendApi?a.backendApi.model.session.currentApp:b.current;return c?(u||(u=new r(c)),u.model===c?u:new r(c)):null},r.openApp=function(a,c){o.initClient();var d,e=o.makeConfig(c),f=b.makeCacheId(a,e);if(w[f])return w[f];t&&(d=function(){t({code:v.LOCERR_GENERIC_CONNECTION_LOST,message:"Connection lost"})});var g=b.getSync(a,e,!0,d);if(g){var h=new r(g);h.close=function(){return delete w[f],g.close()},w[f]=h}return w[f]},r.table=function(a,b){var c=r.currApp(a);return c.table(a,b)},r}),define("apis/qnavigation",["qvangular","client.utils/state","client.utils/routing"],function(a,b,c){"use strict";function d(){return m||(m=a.getService("$navigationService")),m}function e(){return d().Sheets.all.mashed}function f(){return d().Stories.all.mashed}function g(a){var c=b.model.id,d=-1;return a.forEach(function(a,b){a.qInfo.qId===c&&(d=b)}),d}function h(a,b){var c;return b.forEach(function(b){b.qInfo.qId===a&&(c=b)}),c}function i(a,b){var c;return b.forEach(function(b){b.qInfo.qId===a&&(c=b)}),c}function j(a){return c.goToSheet(a,Object.keys(b.States)[b.state]),{success:!0,sheetId:a}}function k(a){return c.goToStory(a,Object.keys(b.States)[b.States.play]),{success:!0,storyId:a}}function l(a,b,c){this.inClient=a,Object.defineProperties(this,{ANALYSIS:{get:function(){return"analysis"}},EDIT:{get:function(){return"edit"}},SNAPSHOT:{get:function(){return"snapshot"}},sheets:{get:function(){return a?e(this):b||[]}},stories:{get:function(){return a?f(this):c||[]}}})}var m;return l.prototype.gotoSheet=function(a){var b=h(a,this.sheets);return b?j(a):{success:!1,error:"NOSUCHSHEET",errorMsg:"No such sheet"}},l.prototype.nextSheet=function(){if(b.view===b.Views.sheet&&b.model){var a=g(this.sheets)+1,c=this.sheets[a===this.sheets.length?0:a].qInfo.qId;return j(c)}return{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},l.prototype.prevSheet=function(){if(b.view===b.Views.sheet&&b.model){var a=g(this.sheets)-1,c=this.sheets[a<0?this.sheets.length-1:a].qInfo.qId;return j(c)}return{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},l.prototype.getCurrentSheetId=function(){return b.view===b.Views.sheet&&b.model?{success:!0,sheetId:b.model.id}:{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},l.prototype.getMode=function(){return Object.keys(b.States)[b.state]},l.prototype.setMode=function(a){return this.isModeAllowed(a)?(b.setState(b.States[a]),{success:!0,mode:a}):{success:!1,error:"MODENOTALLOWED",errorMsg:"Mode not allowed"}},l.prototype.isModeAllowed=function(a){switch(a){case this.ANALYSIS:return!0;case this.EDIT:return this.inClient&&b.model.layout&&b.model.layout.permissions&&b.model.layout.permissions.update;case this.SNAPSHOT:return this.inClient}return!1},l.prototype.gotoStory=function(a){var b=i(a,this.stories);return b?k(a):{success:!1,error:"NOSUCHSTORY",errorMsg:"No such story"}},l}),define("apis/qsession",["qvangular","core.utils/deferred","client.models/rpc-session","autogenerated/qix/engine-enums","core.utils/authentication"],function(a,b,c,d,e){"use strict";function f(a,b){a&&(a.isHandled||a.error.isHandled||!a.error||a.error.code===h.LOCERR_GENERIC_ABORTED||a.error.code===h.LOCERR_APP_NOT_FOUND||b(a.error))}function g(d,g){c.useTimeoutOnClose=!0,c.createSocket=function(a){var b;try{b=new WebSocket(a)}catch(c){d(c)}return b},c.hookIntoDeferred=function(c){c.promise.then(null,function(c){return a.getService("$timeout")(function(){f(c,d)},1e3),b.reject(c)})},c.NewSessionCreated.observers.forEach(function(a){c.NewSessionCreated.unbind(a)}),c.NewSessionCreated.bind(function(a){a.Notification.bind(function(a){"OnAuthenticationInformation"===a.method&&e.parse(a.params),a.error?d(a.error):a.params&&"fatal"===a.params.severity?d({message:a.params.message,method:a.method}):g&&g(a)}),g&&a.Warning.bind(g)})}var h=d.NxLocalizedErrorCode;return{setupSocketErrorHandling:g,handleError:f}}),define("apis/qlik-visual",["apis/qapp"],function(a){"use strict";function b(b){var c=b.getAttribute("appid");if(c){var d=JSON.parse(b.getAttribute("config"));b.app=a.openApp(c,d)}else b.app=a.currApp()}function c(a){var c=a.getAttribute("visid"),d=JSON.parse(a.getAttribute("options"));if(a.app||b(a),a.app&&c)a.app.visualization.get(c).then(function(b){a.vis=b,d&&b.setOptions(d),b.show(a)});else if(a.app){var e=JSON.parse(a.getAttribute("cols")),f=a.getAttribute("type")||"barchart";a.app.visualization.create(f,e,d).then(function(b){a.vis=b,b.show(a)})}}function d(a){a.vis&&(a.vis.close(),delete a.vis)}var e=Object.create(HTMLElement.prototype);return e.createdCallback=function(){b(this)},e.attachedCallback=function(){c(this)},e.attributeChangedCallback=function(a,e,f){if("options"===a&&this.vis){var g=JSON.parse(f);this.vis.setOptions(g)}else d(this),"appid"!==a&&"config"!==a||b(this),c(this)},e.detachedCallback=function(){d(this)},e.init=function(){if(document.registerElement)try{document.registerElement("qlik-visual",{prototype:e})}catch(a){}},e}),define("general.utils/qv-swipe",["jquery","touche"],function(a){function b(b,c,d){return a.Event(b,{pageX:d.pagePoints[0].x,pageY:d.pagePoints[0].y,ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,originalEvent:c,gestureData:d})}function c(){function a(){document.removeEventListener("mousedown",b,!0),document.removeEventListener("mousemove",c,!0),document.removeEventListener("mouseup",d,!0)}function b(a){a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(b){b.preventDefault(),b.stopPropagation(),a(),clearTimeout(e)}var e;document.addEventListener("mousedown",b,!0),document.addEventListener("mousemove",c,!0),document.addEventListener("mouseup",d,!0),e=setTimeout(a,350)}var d;Touche(document.body).tap({options:{preventDefault:!1},start:function(b){d=a(b.target)}}),Touche(document.body).swipe({options:{preventDefault:!1,radiusThreshold:8},start:function(a,c){var e=b("qv-swipestart",a,c);d.trigger(e)},update:function(a,c){var e=b("qv-swipeupdate",a,c);d.trigger(e)},cancel:function(){var b=a.Event("qv-swipecancel");d.trigger(b)},end:function(a,e){Touche.utils.isMouse(a)||c();var f=b("qv-swipe",a,e);d.trigger(f)}})}),define("general.utils/qv-longtapswipe",["jquery","touche"],function(a,b){"use strict";var c=b.Gesture.augment(function(c){function d(){c.apply(this,arguments)}function e(){function a(){document.removeEventListener("mousedown",b,!0),document.removeEventListener("mousemove",c,!0),document.removeEventListener("mouseup",d,!0)}function b(a){a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(b){b.preventDefault(),b.stopPropagation(),a(),clearTimeout(e)}var e;document.addEventListener("mousedown",b,!0),document.addEventListener("mousemove",c,!0),document.addEventListener("mouseup",d,!0),e=setTimeout(a,350)}var f=!1;return this.defaults={radiusThreshold:10,timeThreshold:510,touches:1,precedence:4,preventDefault:!1,which:1,interval:10},this.on=function(a){this.count=0,b(a).longtap({id:this.id,options:{precedence:this.options.precedence,preventDefault:this.options.preventDefault,touches:this.options.touches,which:this.options.which,areaThreshold:this.options.areaThreshold,timeThreshold:this.options.timeThreshold,interval:this.options.interval},start:this.longtapStart.bind(this),update:this.longtapUpdate.bind(this),cancel:this.longtapCancel.bind(this),end:this.longtapEnd.bind(this)}).swipe({id:this.id,options:{precedence:this.options.precedence+1,preventDefault:this.options.preventDefault,radiusThreshold:this.options.radiusThreshold,touches:this.options.touches},start:this.swipeStart.bind(this),update:this.swipeUpdate.bind(this),end:this.swipeEnd.bind(this),cancel:this.swipeCancel.bind(this)})},this.off=function(a){b(a).off("longtap",this.id),b(a).off("swipe",this.id)},this.longtapStart=function(){f=!1},this.longtapUpdate=function(a,b){100===b.percentage&&(f=!0)},this.longtapEnd=function(){this.binder.cancel()},this.longtapCancel=function(){f||this.binder.cancel()},this.swipeStart=function(b,c){var d=a(b.target).is("input, textarea");f&&!d?this.binder.start(b,c):f&&d&&(f=!1)},this.swipeUpdate=function(a,b){f&&this.binder.update(a,b)},this.swipeEnd=function(a,b){f&&(e(),this.binder.end(a,b),f=!1)},this.swipeCancel=function(){f=!1,this.binder.cancel()},d});b.gestures.add("longtapswipe",c)}),define("text!client.views/current-selections/current-selections.ng.html",[],function(){return'<div class="qv-panel-subtoolbar qv-panel-current-selections" ng-class="{smallDevice: isSmallDevice}">\n\t<div ng-if="!isSmallDevice">\n\t\t<div class="qv-selections-pager">\n\n\t\t\t<div class="buttons borderbox">\n\n\t\t\t\t<button class="qv-subtoolbar-button borderbox" qva-activate="back()" ng-disabled="disable.back" q-title-translation="Tooltip.NavigateBack">\n\t\t\t\t\t<i class="lui-icon lui-icon--selections-back"></i>\n\t\t\t\t</button>\n\n\t\t\t\t<button class="qv-subtoolbar-button borderbox" qva-activate="forward()" ng-disabled="disable.forward" q-title-translation="Tooltip.NavigateForward">\n\t\t\t\t\t<i class="lui-icon lui-icon--selections-forward"></i>\n\t\t\t\t</button>\n\n\t\t\t\t<button id="clearselections" class="qv-subtoolbar-button borderbox" ng-disabled="disable.clear" qva-activate="clearAllFields()" q-title-translation="Tooltip.ClearSelections">\n\t\t\t\t\t<i class="lui-icon lui-icon--clear-selections"></i>\n\t\t\t\t</button>\n\n\t\t\t</div>\n\t\t\t<div class="selections-shadow" ng-if="showShadow"></div>\n\t\t\t<div class="wrap borderbox" style="height: 100%;" qv-pager qv-selection-pager>\n\t\t\t\t<ul class="list" ng-show="items.length > 0 && !isGlobalSelectionsActive" qva-delegated-activate=".item#showPopover($event)" qva-outside-ignore-for="currentSelectionsItems">\n\t\t\t\t\t<li ng-repeat="item in items track by item.qField" data-csid="{{item.qField}}">\n\t\t\t\t\t\t<div class="item" ng-mousemove="openTooltip($event, item)" ng-mouseleave="closeTooltip()" ng-class="{\n\t\t\t\t\'active\' : item.qField === activeFieldName,\n\t\t\t\t\'dim\' : $parent.itemSelected && !item.active,\n\t\t\t\t\'item-locked\' : item.qLocked,\n\t\t\t\t\'locked-feedback item-animate-in\' : item.feedbackActive && item.qLocked,\n\t\t\t\t\'item-animate-out\' : !item.feedbackActive && item.qLocked }">\n\t\t\t\t\t\t\t<div ng-class="{locked:item.qLocked}" class="text">\n\t\t\t\t\t\t\t\t<div class="text-wrap">\n\t\t\t\t\t\t\t\t\t<span ng-class="{ \'icon-toolbar-locked\': item.qLocked }"></span><span class="name">{{item.qField}}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span class="values">{{item.translation}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<span ng-class="{\n\t\t\t\t\t\t\'icon-toolbar-locked\': item.qLocked,\n\t\t\t\t\t\t\'item-animate-in\' : item.feedbackActive,\n\t\t\t\t\t\t\'item-animate-out\' : !item.feedbackActive,\n\t\t\t\t\t\t\'icon-locked-feedback\' : item.feedbackActive && item.qLocked }">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<div class="options">\n\t\t\t\t\t\t\t\t<a ng-if="!item.qLocked && !item.isPlaceHolder" qva-activate="clear(item.qField)" class="remove" q-title-translation="CurrentSelections.Remove">\n\t\t\t\t\t\t\t\t\t<span class="lui-clear-all lui-icon lui-icon--remove"></span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<qv-state-count-bar ng-if="!item.isPlaceHolder" state-counts="item.qStateCounts"></qv-state-count-bar>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\n\t\t\t\t<div ng-if="!items.length" class="empty-text no-selection" q-translation="CurrentSelections.NoSelections"></div>\n\t\t\t\t<a class="qv-pager-nav qv-pager-previous" qva-activate="prevPage()" q-title-translation="Tooltip.Previous"><i class="lui-icon lui-icon--arrow-left"></i></a>\n\t\t\t\t<a class="qv-pager-nav qv-pager-next" qva-activate="nextPage()" q-title-translation="Tooltip.Next"><i class="lui-icon lui-icon--arrow-right"></i></a>\n\t\t\t</div>\n\t\t\t<div class="buttons-end borderbox">\n\t\t\t\t<button tid="toggleGlobalSearchButton" class="qv-subtoolbar-button global-search-button borderbox" ng-class="{active: isGlobalSearchActive}" qva-activate="toggleGlobalSearch()" q-title-translation="{{isGlobalSearchActive ? \'Tooltip.CloseGlobalSearch\' : \'Tooltip.GlobalSearch\'}}">\n\t\t\t\t\t<i class="lui-icon lui-icon--search"></i>\n\t\t\t\t</button>\n\n\t\t\t\t<button class="qv-subtoolbar-button borderbox" ng-class="{active: isGlobalSelectionsActive}" qva-activate="toggleGlobalSelection($event)"\n\t\t\t\t\tq-title-translation="{{isGlobalSelectionsActive ? \'Tooltip.CloseGlobalSelector\' : \'Tooltip.GlobalSelector\'}}" tid="currentSelections.toggleGlobalSelections">\n\t\t\t\t\t<i class="lui-icon\nlui-icon--selections-tool"></i>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\t<div ng-if="isSmallDevice && mobileIndicatorShow && !inSelection " qva-activate="toggleGlobalSelection($event)" class="qv-current-selections-mobile-wrapper" tid="currentSelections.toggleMobileSelections" q-title-translation="GlobalSelections.CurrentSelections">\n\t\t<div class="qv-current-selections-mobile-background">\n\t\t\t<p class="qv-current-selections-mobile-nbr" ng-class="{selections: nbrSelections > 0}">{{nbrSelections}}</p>\n\t\t</div>\n\t</div>\n</div>\n';
}),define("objects.models/listbox",["objects.models/visualization-object","general.utils/visualizations","objects.utils/data-properties/listobject-util","util","objects.utils/type-loader"],function(a,b,c,d,e){"use strict";var f,g=[];return f=a.extend("Listbox",{}),f.createTransient=function(c,d,f){var h,i,j,k=-1,l=g.length;for(h={that:c,app:d,props:f},i=0;i<l;i++)if(angular.equals(g[i].askFor,h)){k=i;break}return k>=0?g[k].result:(j=e.load().then(function(){return b.getType("listbox").getInitialProperties(f).then(function(b){return a.createTransient.call(c,b,d)})}),g.push({askFor:h,result:j}),j)},f.createTransientField=function(a,b,e){var f={};return f.qListObjectDef=c.createFieldDimension(b),d.extend(!0,f,e||{}),this.createTransient(this,a,f)},f.createTransientDimension=function(a,b,e){var f={};return f.qListObjectDef=c.createLibraryDimension(b),d.extend(!0,f,e||{}),this.createTransient(this,a,f)},f}),define("objects/listbox-popover/listbox-popover",["core.utils/deferred","core.utils/resize"],function(a,b){var c={template:null,controller:["$scope","$element","$timeout",function(c,d,e){function f(){e(function(){c.destroyComponent(),d.remove()}),b.off("start.listbox-popover-error",f)}function g(){return e(function(){return d.find(".toolbar-wrapper").outerWidth()})}var h=this;h.selectionsActivated=function(){},h.selectionsDeactivated=function(){},h.close=function(){f()},c.closeView=function(a){c.onPopoverClose(a),f()},a.all({object:c.getVisualization(),width:g()}).then(function(a){var d=a.object,e=a.width;d.getSelectionToolbar().then(function(a){c.toolbar=a,c.toolbar.showLock=c.options.showLock,c.toolbar.position={width:e},d.activateSelections()}),d.loaded.then(function(){d.ext.hasError({layout:d.model.layout})&&b.on("start.listbox-popover-error",f)}),d.selectionsApi.watchActivated(function(){h.selectionsActivated()}),d.selectionsApi.watchDeactivated(function(){h.selectionsDeactivated(),f()}),c.closeView=function(a){d.selectionsApi.confirm(),c.onPopoverClose(a),f()}})}]};return c}),define("text!objects/listbox-popover/listbox-popover.ng.html",[],function(){return'<immidiate-contextual\n\t\tclass="qv-listbox-popover"\n\t\talign-to="$alignToElement"\n\t\tposition="popupPosition"\n\t\tcollision="collision"\n\t\twidth="234"\n\t\theight="332"\n\t\ton-close-view="closeView(event)"\n\t\tqva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<div class="toolbar-wrapper"\n\t\tqva-include-selection-toolbar\n\t\tcomponent="selectionToolbarComponent"\n\t\ttoolbar="toolbar"\n\t\toptions="options"></div>\n\t<div class="listbox-wrapper" >\n\t\t<qv-object object="object" model="model" options="options"></qv-object>\n\t</div>\n</immidiate-contextual>\n'}),define("text!objects/listbox-popover/listbox-popover-small-device.ng.html",[],function(){return'<div\n\tclass="qv-listbox-popover-small-device">\n\t<div class="toolbar-wrapper"\n\t\tqva-include-selection-toolbar\n\t\tcomponent="selectionToolbarComponent"\n\t\ttoolbar="toolbar"\n\t\toptions="options">\n\t</div>\n\t<h1 qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{model.layout.title || model.layout.qListObject.qDimensionInfo.qFallbackTitle}}" class="qvt-visualization-title">{{model.layout.title || model.layout.qListObject.qDimensionInfo.qFallbackTitle}}</h1>\n\t<div class="listbox-wrapper">\n\t\t<qv-object object="object" model="model" options="options"></qv-object>\n\t</div>\n</div>\n'}),define("objects/listbox-popover/listbox-popover-service",["qvangular","util","core.utils/deferred","objects.models/listbox","client.views/selection-toolbar/selection-toolbar","objects/listbox-popover/listbox-popover","general.utils/responsive-state","text!./listbox-popover.ng.html","text!./listbox-popover-small-device.ng.html","objects/object","general.components/immidiate-contextual/immidiate-contextual"],function(a,b,c,d,e,f,g,h,i){a.service("qvListboxPopoverService",["$document",function(a){var j,k,l,m=a.find("body");return k={show:function(a,d,k,n){var o=c(),p={$alignToElement:d.$alignToElement,popupPosition:d.position||"bottom",collision:d.collision||"none",qvaOutsideIgnoreFor:d.qvaOutsideIgnoreFor,getVisualization:function(){return o.promise},model:a,onPopoverClose:this.onPopoverClose,options:{setController:o.resolve,isPopover:!0,showLock:d.showLock,search:d.search||{},smallDevice:g.isSmallDevice,direction:d.direction},selectionToolbarComponent:e};return l&&(l.selectionsActivated=function(){},l.selectionsDeactivated=function(){},l.close()),j=angular.element("<div>"),m.append(j),f.template=g.isSmallDevice?i:h,l=j.showComponent(f,p),l.selectionsActivated=function(){b.isFunction(n)&&n()},l.selectionsDeactivated=function(){b.isFunction(k)&&k(),k=null,n=null},l},showField:function(a,b,e,f,g,h){return d.createTransientField(b,a,f).then(function(a){return c.resolve(this.show(a,e,g,h))}.bind(this))},showDimension:function(a,b,c,e,f,g){d.createTransientDimension(b,a,e).then(function(a){this.show(a,c,f,g)}.bind(this))},close:function(){l&&l.close()},onPopoverClose:function(){}}}])}),define("widget.pager",["jquery","jqueryui"],function(a){return a.widget("qv.pager",{options:{itemSelector:">li",orientation:"horizontal",pageSize:"auto",startPage:1,animationDuration:300},_create:function(){var b=this.options;a.extend(this,{positionProperty:"horizontal"===b.orientation?"left":"top",sizeProperty:"horizontal"===b.orientation?"outerWidth":"outerHeight"}),this.refresh(),this.goToPage(b.startPage)},isItemInsidePage:function(b){var c=a(b),d=c.position()[this.positionProperty]+c[this.sizeProperty](),e=Math.abs(parseFloat(c.parent().css("margin-"+this.positionProperty))),f=e+this.containerSize;return d>e&&d<f},calculatePageSize:function(){return Math.floor(this.containerSize/this.calculateItemSize())},calculateItemSize:function(){return this.element.find(this.options.itemSelector).eq(0)[this.sizeProperty]()},refresh:function(){var a=this.currentPage||1;this.containerSize=this.element.parent()[this.sizeProperty](),this.pageSize="auto"===this.options.pageSize?this.calculatePageSize():this.options.pageSize,this.itemSize=this.calculateItemSize(),this.maxPages=Math.ceil(this.element.find(this.options.itemSelector).length/this.pageSize||1),this.currentPage=Math.min(a,this.maxPages),this.goToPage(this.currentPage)},goToPage:function(a){this.currentPage=Math.min(Math.max(1,a),this.maxPages);var b=(this.currentPage-1)*this.itemSize*this.pageSize,c={};c[this.positionProperty]=-b+"px",this.element.stop(!0).animate(c,this.options.animationDuration)},goToPreviousPage:function(){this.goToPage(this.currentPage-1)},goToNextPage:function(){this.goToPage(this.currentPage+1)},goToPageContaining:function(a){var b=Math.ceil(this.element.find(a).index()+1/this.pageSize);this.goToPage(b)},_destroy:function(){this.element.off(this.eventNamespace)}}),a}),define("general.components/pager/pager",["qvangular","core.utils/resize","general.utils/support","widget.pager"],function(a,b,c){a.directive("qvPager",["$timeout",function(a){return{restrict:"A",priority:0,link:function(d,e){function f(){d.refreshPager()}c.treatAsDesktop()||e.css("overflow-x","auto"),d.pagerData=e.find("ul").pager().data("qv-pager"),e.addClass("qv-pager"),d.nextPage=function(){a(function(){d.pagerData.goToNextPage(),d.refreshPager(!0)})},d.prevPage=function(){a(function(){d.pagerData.goToPreviousPage(),d.refreshPager(!0)})},d.goToPage=function(a){d.pagerData.goToPage(a),d.refreshPager(!0)},d.refreshPager=function(a){var b="";a||d.pagerData.refresh(),e.removeClass("qv-pager-back qv-pager-forward"),1!==d.pagerData.currentPage?(d.showShadow=!0,b+="qv-pager-back "):d.showShadow=!1,d.pagerData.currentPage!==d.pagerData.maxPages&&(b+="qv-pager-forward "),e.addClass(b)},d.$on("refreshPager",f),d.$on("$destroy",function(){b.off("end",f)})}}}])}),define("text!client.views/global-selections/global-selections.ng.html",[],function(){return'<div class="qv-global-selections" ng-class="{\'toolbar\': toolbar, \'selection-toolbar-open\': selectionToolbarOpen}">\n\n\t<section class="qv-gs-section qv-gs-top" tid="globalSelections.topSection">\n\t\t<header class="qv-gs-header">\n\t\t\t<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\n\t\t</header>\n\t\t<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'fields\' }" all-items="selectedFields" app="app"></div>\n\t</section>\n\n\t<section class="qv-gs-section" tid="globalSelections.bottomSection">\n\t\t<header class="qv-gs-header">\n\t\t\t<h2 q-translation="GlobalSelections.AppDimensions"></h2>\n\t\t\t<lui-checkbox x-variant="inverse" x-model="showFields" title="{{\'GlobalSelections.ShowFields\'|translate}}" tid="globalSelections.showFields">{{\'GlobalSelections.ShowFields\'|translate}}</lui-checkbox>\n\t\t\t<lui-search x-variant="inverse" class="qv-gs-searchfield" placeholder="{{showFields ? \'GlobalSelections.FilterDimensionsAndFields\' : \'GlobalSelections.FilterDimensions\'}}" query="filter" maxlength="255"\n\t\t\t\t\t\t\t tid="globalSelections.searchField" on-escape="filter = \'\';" auto-focus="autoFocus" on-enter="onEnter($event)"></lui-search>\n\t\t</header>\n\n\t\t<div class="qv-gs-info" ng-if="!dimAvailable && !showFields">\n\t\t\t<h2 q-translation="GlobalSelections.DimensionsWarning"></h2>\n\t\t</div>\n\t\t<div class="qv-gs-info" ng-if="!dimensionsFields || dimensionsFields.length === 0">\n\t\t\t<h2 q-translation="GlobalSelections.NoMatchesForSearch"></h2>\n\t\t</div>\n\t\t<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'dimensions\'}" all-items="dimensionsFields" filter="filter" app="app"></div>\n\n\t</section>\n</div>\n'}),define("text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="confirm-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\n\t<header ng-if="header" class="dm-header" q-translation="{{header}}"></header>\n\t<main class="dm-main">\n\t\t<div class="qv-mvc-dialog-content">\n\t\t\t<div class="qv-mvc-dialog-icon icon-{{icon}}" ng-show="icon"></div>\n\t\t\t<p><span q-translation="{{text}}"></span></p>\n\t\t</div>\n\t</main>\n\t<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="{{confirmLabel}}"></qv-confirm-cancel-footer>\n</qv-modal-dialog>\n'}),define("general.utils/tabbable-elements",["jquery","jqueryui"],function(a){"use strict";var b=[];return{preventTabbing:function(c){var d={id:b.length,elements:c.find(":tabbable")};b.push(d),d.elements.each(function(){var b=a(this);b.data("tabbable-elements-tabindex",b.attr("tabindex"))}),d.elements.attr("tabindex","-1")},restoreTabbing:function(){var c=b.pop();c.elements.each(function(){var b=a(this),c=b.data("tabbable-elements-tabindex");c?b.attr("tabindex",c):b.removeAttr("tabindex")})}}}),define("assets/client/dialogs/directives/tabbable-container",["qvangular","general.utils/tabbable-elements","jquery"],function(a,b,c){a.directive("qvTabbableContainer",function(){return{restrict:"A",controller:["$scope","$element",function(a,d){var e=d[0].nextSibling,f=d[0].parentNode;f.removeChild(d[0]),b.preventTabbing(c(document.body)),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),f.insertBefore(d[0],e),a.$on("$destroy",function(){b.restoreTabbing()})}]}})}),define("general.utils/keyboard-event-dispatcher",["jquery"],function(a){function b(a){Object.keys(f).forEach(function(b){f[b]=f[b].filter(function(b){return b.jackId!==a})})}function c(a){var b=Array.prototype.slice.call(arguments,1);f[a].forEach(function(a){a.jackId===g[g.length-1]&&a.handler.apply(null,b)})}function d(a,b,d){f[b]||(e.on(b,c.bind(null,b)),f[b]=[]),f[b].push({jackId:a.id,handler:d})}var e,f={},g=[],h={on:function(a,b){d(this,a,b)},release:function(){var a=this.id;b(a),g.splice(g.indexOf(a),1)}};return{hijack:function(){e||(e=a(document));var b=Object.create(h,{id:{value:g.length}});return g.push(b.id),b}}}),define("assets/client/dialogs/directives/escape",["qvangular","general.utils/keyboard-event-dispatcher"],function(a,b){a.directive("qvDialogEscape",["$parse",function(a){return{restrict:"A",controller:["$scope",function(a){var c=this.hijack=b.hijack();a.$on("$destroy",function(){c.release()})}],link:function(b,c,d,e){var f=a(d.qvDialogEscape);e.hijack.on("keydown",function(a){27===a.keyCode&&(a.preventDefault(),setTimeout(function(){b.$apply(function(){f(b,{$event:a})})}))})}}}])}),define("text!general.components/modal-dialog/modal-dialog.ng.html",[],function(){return'<div class="modal-container qui-modalbackground-centered" qv-tabbable-container>\n\t<div id="{{id}}"\n\t\t class="modal-frame qui-delayedModal"\n\t\t ng-transclude></div>\n</div>\n'}),define("general.components/modal-dialog/modal-dialog",["qvangular","text!general.components/modal-dialog/modal-dialog.ng.html","general.utils/keyboard-event-dispatcher"],function(a,b,c){a.directive("qvModalDialog",function(){return{scope:{id:"@qvId",confirm:"&qvConfirm",cancel:"&qvCancel"},restrict:"E",transclude:!0,replace:!0,template:b,link:function(a){var b=c.hijack();a.$on("$destroy",function(){b.release()}),b.on("keydown",function(b){if(27===b.keyCode&&(b.preventDefault(),setTimeout(function(){a.$apply(function(){a.cancel()})})),13===b.keyCode){if("TEXTAREA"===b.target.tagName)return;if("BUTTON"===b.target.tagName)return;setTimeout(function(){a.$apply(function(){a.confirm()})})}})}}})}),define("text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html",[],function(){return'<footer class="dm-footer">\n    <lui-button x-variant="inverse" qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f" ng-disabled="cancelDisabled"></lui-button>\n    <lui-button x-variant="inverse" qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></lui-button>\n</footer>\n'}),define("text!assets/client/dialogs/directives/confirm-cancel-footer-light.ng.html",[],function(){return'<footer class="dm-footer">\n    <lui-button qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f" ng-disabled="cancelDisabled"></lui-button>\n    <lui-button qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></lui-button>\n</footer>\n'}),define("assets/client/dialogs/directives/confirm-cancel-footer",["qvangular","text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html","text!assets/client/dialogs/directives/confirm-cancel-footer-light.ng.html"],function(a,b,c){a.directive("qvConfirmCancelFooter",function(){return{scope:{confirmLabel:"@qvConfirmLabel",confirm:"&qvConfirm",confirmDisabled:"=qvConfirmDisabled",cancel:"&qvCancel",cancelDisabled:"=qvCancelDisabled"},restrict:"E",replace:!0,template:function(a,d){var e=d.hasOwnProperty("light");return e?c:b}}})}),define("assets/client/dialogs/directives/dialog-directives",["assets/client/dialogs/directives/tabbable-container","assets/client/dialogs/directives/escape","general.components/modal-dialog/modal-dialog","assets/client/dialogs/directives/confirm-cancel-footer"],function(){}),define("assets/client/dialogs/confirm-dialog/confirm-dialog",["general.services/show-service/show-service","text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html","assets/client/dialogs/directives/dialog-directives"],function(a,b){function c(b){var c=b.text,e=void 0!==b.icon?b.icon:"cogwheel",f=b.confirm||"Common.OK",g={text:c,header:b.header,icon:e,confirmLabel:f};return a.show(d,g).resultPromise}var d={template:b,scope:{text:"=",header:"=",icon:"=",confirmLabel:"="},controller:["$scope",function(a){a.confirm=function(){a.destroyComponent(),a.deferredResult.resolve()},a.cancel=function(){a.destroyComponent(),a.deferredResult.reject()}}]};return{show:c}}),define("client.controllers/grid-controller",["jquery","core.utils/deferred","core.models/app","client.utils/state","general.utils/responsive-state","objects.models/visualization-object","general.utils/support","objects.utils/interaction-states","client.utils/rtl/direction-service"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){for(var c=[],d=0;d<b;d++){c[d]=[];for(var e=0;e<a;e++)c[d][e]=1}return c}function k(a,b){var c,d,e=b.row+b.rowspan,f=b.col+b.colspan;for(c=b.row;c<e;c++)for(d=b.col;d<f;d++)a[c][d]=0}function l(a,b){var c=a.rectFor(b);return{width:"calc( "+c.width+"% - "+2*c.margin+"px )",height:"calc( "+c.height+"% - "+2*c.margin+"px )",left:"calc( "+c.left+"% + "+c.margin+"px )",top:"calc( "+c.top+"% + "+c.margin+"px )"}}function m(a){a.getVisualization().then(function(b){b.getPreferredSize().then(function(b){b&&e.isSmallDevice&&(a.style={width:b.w+"px",height:b.h+"px"})})})}function n(a,b,c){var d=2,e=100,f=100,g=e/b,h=f/c;a.rectFor=function(a){var b=a.colspan*g,c=a.rowspan*h,e=a.col*g,f=a.row*h;return{left:e,top:f,width:b,height:c,margin:d}};var i,j=[],k=[];for(i=0;i<b-1;++i){var l=(i+1)*g;k.push({left:l+"%"})}for(i=0;i<c-1;++i){var m=(i+1)*h;j.push({top:m+"%"})}a.cols=b,a.rows=c,a.horizontalLines=j,a.verticalLines=k}function o(a,b){var c=b.qInfo.qId!==a.lastSheetId,e=!c&&d.isInEditMode()&&!a.zoomCell&&b.permissions.update;a.lastSheetId=b.qInfo.qId,a.hasUpdatePermission=b.permissions.update,a.isSheet=!0,a.isMaster=!1,a.sheetTitle=b.qMeta&&b.qMeta.title||"",a.isDraft=b.qMeta&&b.qMeta.sourceObject&&b.qMeta.sourceObject.length,a.isDraftOwner=b.qMeta&&b.qMeta.draftObject&&b.qMeta.draftObject.length,!c&&a.hasUpdatePermission||a.clearActiveCell(),c&&(a.cells=[]),r(a,b.cells.slice(),e)}function p(b,c,e){return{active:!1,visible:!1,items:[{translation:"Visualization.Unlink",tid:"nav-menu-link",cssClasses:"lui-icon lui-icon--link",dynamicCssClasses:function(){var a=[];return c.zoomCell?a.push("big"):a.push("border","white"),a.join(" ")},isVisible:function(){return(g.treatAsDesktop()||c.zoomCell)&&e.object.isLink&&d.isInEditMode()},action:function(){e.getVisualization().then(function(a){var b=require("client.services/link-object-service");b.showBreakLinkDialog(a.model)})}},{translation:"contextMenu.takeSnapshot",tid:"nav-menu-snapshot",cssClasses:"lui-icon lui-icon--camera",dynamicCssClasses:function(){var a=[];return c.zoomCell?a.push("big"):a.push("border","white"),e.snapshot.dialogOpen&&a.push("blue"),a.join(" ")},isVisible:function(){return(g.treatAsDesktop()||c.zoomCell)&&!e.object.isInvalid&&!c.zooming&&!d.isInEditMode()&&e.object.supportSnapshot()&&b.permissions.createBookmark||e.snapshot.isAnnotating},action:function(){var a=!0;e.snapshot.isAnnotating||(c.zoomCell&&e.object.showExploreMenu?(e.object.toggleExploreMenu(),e.object.resize(),e.snapshot.take(a)):c.zoomCell?e.snapshot.take(a,!0):e.snapshot.take(a))}},{translation:"Tooltip.ExplorationMenu",tid:"nav-menu-explore",cssClasses:"lui-icon lui-icon--control",dynamicCssClasses:function(){var a=[];return e.object.showExploreMenu&&a.push("active"),c.zoomCell?a.push("big"):a.push("border","white"),a.join(" ")},isVisible:function(){return(g.treatAsDesktop()||c.zoomCell)&&e.object.canShowExploreMenu()&&!d.isInEditMode()&&!c.zooming},action:function(){c.zoomCell?(e.object.toggleExploreMenu(),e.object.resize()):(c.zoom(e),e.object.toggleExploreMenu(!0))}},{translation:"Tooltip.ZoomOut",tid:"nav-menu-zoom-out",cssClasses:"lui-icon lui-icon--remove big",isVisible:function(){return c.isSheet&&c.zoomCell===e&&!c.zooming},action:function(){e.navMenu.visible=!1,e.object.showExploreMenu&&e.object.toggleExploreMenu(!1),a(".embedded-sheet-toolbar").length>0&&a(".embedded-sheet-toolbar").css("display","block"),c.zoom(null)}},{translation:"Tooltip.ZoomIn",tid:"nav-menu-zoom-in",cssClasses:"lui-icon lui-icon--expand white border",isVisible:function(){return g.treatAsDesktop()&&!c.zoomCell&&!e.object.isInvalid&&!c.zooming},action:function(){c.zoom(e)}}]}}function q(a,b){var c;if(!b)return null;for(c=0;c<b.length;++c)if(b[c].id===a)return b[c];return null}function r(a,g,l){function m(b){k(w,b);var c={},d={col:b.col,row:b.row,colspan:b.colspan,rowspan:b.rowspan};a.setCellSize(c,d),c.isEmpty=!0,c.navMenu={},v.push(c)}function n(g){k(w,g);var j=q(g.name,a.cells);if(!j){j={},j.id=g.name;var m,n=b();m=d.state===d.States.edit?h.EDIT:h.ANALYSIS,j.options={setController:n.resolve,id:g.name,isVisible:!0,isZoomed:!1,isActive:!1,canSaveSoftProperties:a.hasUpdatePermission&&!e.isSmallDevice,interactionState:m,direction:i.direction,removeIt:function(){a.gridService.removeCell(j)}},c.current.getLayout().then(function(b){j.navMenu=p(b,a,j)}),f.get(g.name).then(function(b){j.model=b,l&&a.toggleActive(j)}),j.getVisualization=function(){return n.promise}}var o={col:g.col,row:g.row,colspan:g.colspan,rowspan:g.rowspan};a.setCellSize(j,o),j.isEmpty=!1,v.push(j)}function o(){function a(a,b,c){for(var g=a;d.length>0;){var h=d[d.length-1];if(h.rowSpan===c)return;if(h.rowSpan<c)break;d.pop(),g=h.col;var i=a-h.col,j=h.rowSpan*i;j>e&&(e=j,f={col:h.col,row:b,colspan:i,rowspan:h.rowSpan})}c>0&&d.push({col:g,rowSpan:c})}for(var b,c,d,e,f,g=t,h=[];g--;)for(c=0,b=u,h[g]=[];b--;)w[b][g]?h[g][b]=++c:(c=0,h[g][b]=null);for(f=null,e=0,d=[],b=0;b<u;++b){for(g=0;g<t;++g)null!==h[g][b]?a(g,b,h[g][b]):a(g,b,0);a(g,b,0)}return f}function r(){for(var a,b=1;;){if(a=o(),!a)break;a.priority=b++,g.push(a),m(a)}}function s(a){a.sort(function(a,b){return a=a.pos,b=b.pos,a.row-b.row}).sort(function(a,b){return a=a.pos,b=b.pos,a.row===b.row?a.col-b.col:a.row-b.row})}var t=a.cols,u=a.rows,v=[],w=j(t,u);g.forEach(n),s(v),r(),a.cells=v}function s(a){this.gridService=a,this.blocked=!1}return s.prototype.updateCellsSize=function(a){var b=this;for(var c in a.cells)b.setCellSize(a.cells[c],a.cells[c].pos)},s.prototype.setCellSize=function(a,b){e.isSmallDevice&&a.getVisualization?a.style=m(a):a.style=l(this,b),a.pos=b},s.prototype.block=function(){this.blocked=!0,this.removeResizeHandles()},s.prototype.unblock=function(){this.blocked=!1,this.updateActiveCell()},s.prototype.isBlocked=function(){return this.blocked},s.prototype.updateActiveCell=function(){function a(a,b){b>=0&&j[a]>b&&(j[a]=b)}function b(a){var b={top:!0,bottom:!0}[a]||!1,c={left:!0,right:!0}[a]||!1,d={X:0,Y:0},f=!1;if(c)d.X=j[a],f=e.colspan<=1;else if(b)d.Y=j[a],f=e.rowspan<=1;else{var g=a.split("-");d.Y=j[g[0]],d.X=j[g[1]],f=e.rowspan<=1&&e.colspan<=1}0===d.Y&&0===d.X&&f||p.push({dir:a,expand:d,contract:{X:e.colspan-1,Y:e.rowspan-1}})}var c=this;if(c.activeCell&&d.isInEditMode()&&!this.blocked){for(var e=c.activeCell.pos,f=e.col,g=f+e.colspan,h=e.row,i=h+e.rowspan,j={left:f,right:c.cols-g,top:h,bottom:c.rows-i},k=0;k<c.cells.length;++k)if(c.cells[k]!==c.activeCell&&!c.cells[k].isEmpty){var l=c.cells[k].pos.col,m=l+c.cells[k].pos.colspan,n=c.cells[k].pos.row,o=n+c.cells[k].pos.rowspan;n<i&&o>h&&(a("left",f-m),a("right",l-g)),l<g&&m>f&&(a("top",h-o),a("bottom",n-i))}var p=[];b("left"),b("right"),b("top"),b("bottom"),b("top-left"),b("bottom-right"),b("top-right"),b("bottom-left"),c.activeCell.resize=p,c.activeCell.updating=!1}},s.prototype.removeResizeHandles=function(){var a=this;a.activeCell&&delete a.activeCell.resize},s.prototype.clearActiveCell=function(){var a=this;a.removeResizeHandles(),a.activeCell=null},s.prototype.toggleActive=function(a){var b=this;d.isInEditMode()&&(!a||b.zoomCell||a.isEmpty?b.clearActiveCell():(b.clearActiveCell(),b.hasUpdatePermission&&(b.activeCell=a),b.updateActiveCell()))},s.prototype.setEditMaster=function(a,b){var c=this,d=[{name:a,type:b,col:0,row:0,colspan:1,rowspan:1}];c.lastSheetId=null,c.isSheet=!1,c.isMaster=!0,n(c,1,1),c.clearActiveCell(),r(c,d,!1),c.zoom(c.cells[0])},s.prototype.update=function(a){if(a){var b=this;b.layout=a,n(b,a.columns||12,a.rows||7),o(b,a),b.activeCell&&b.cells.indexOf(b.activeCell)===-1&&b.clearActiveCell(),b.zoomCell&&b.cells.indexOf(b.zoomCell)===-1&&(b.zoomCell=null),b.updateActiveCell()}},s.prototype.zoom=function(a){var b=this;b.cells&&(b.cells.forEach(function(b){b.options&&(b.options.isVisible=b===a||!a,b.options.isZoomed=b===a&&!!a)}),a?(b.clearActiveCell(),b.zoomCell=a,b.gridService.saveScrollState(),a.object&&(a.object.expanded=!!a)):b.zoomCell&&(b.zoomCell.object&&(b.zoomCell.object.expanded=!1),b.clearActiveCell(),b.hasUpdatePermission&&(b.activeCell=b.zoomCell),b.zoomCell=null,b.updateActiveCell(),b.gridService.restoreScrollState()))},s.prototype.highlight=function(a){var b=this;b.cells&&b.cells.forEach(function(b){b.isHighlighted=b===a||!a})},s.prototype.exploreMenu=function(a,b){a&&a.object&&a.object.hasSoftProperties&&a.object.toggleExploreMenu(b)},s.prototype.getOptimalCell=function(){var a=this,b=a.cells.slice();b.sort(function(a,b){if(a.isEmpty&&!b.isEmpty)return-1;if(b.isEmpty&&!a.isEmpty)return 1;var c=a.pos.colspan*a.pos.rowspan,d=b.pos.colspan*b.pos.rowspan;return c>d?-1:c<d?1:0});var c=b[0]||null;if(c&&!c.isEmpty)if(c.pos.colspan>1||c.pos.rowspan>1){var d=c.pos.colspan>c.pos.rowspan?"right":"bottom";c={isEmpty:!0,pos:{pos:c.pos,split:d}}}else c=null;return c},s}),define("client.services/grid-service",["qvangular","core.utils/deferred","core.models/rpc-base","general.utils/responsive-state","client.controllers/grid-controller","client.utils/state","jquery","general.services/delayed-modal/delayed-modal"],function(a,b,c,d,e,f,g){"use strict";function h(){var b=a.getService("$delayedModal"),c=g.extend(!0,{},{},{title:"Ui.Warning.GridFull.Title",content:"Ui.Warning.GridFull"});b.open(c)}function i(a,b){f.setView(a);var c=g(document.body);c.toggleClass("qv-view-sheet",!b),c.toggleClass("qv-view-object",b),c.toggleClass("qv-gridzoom",b)}function j(){x.grid.updateCellsSize(x.grid)}function k(b){var g;x||(x=a.$rootScope.$new(!0),x.grid=new e(this),x.model=b,c.bindLayout(x,"model",function(a){x.grid.update(a)}),d.ViewChanged.bind(j),x.$watch(f.isInEditMode,function(a){g=a,x.grid.update(x.grid.layout),g?x.grid.updateActiveCell():(x.grid.removeResizeHandles(),v())}),x.$watch("grid.zoomCell",function(a){if(!(u()||f.view===f.Views.story&&f.state!==f.States.analysis)){var b=a?f.Views.object:f.Views.sheet;i(b,!!a)}}),x.$watch("grid.changedZoom",function(a){a!==!1||x.grid.zoomCell||j(x.grid)}),f.SheetChanged.bind(l))}function l(a){x&&(x.model=a,x.grid.unblock())}function m(){y||(y=a.getService("$interval")),x&&(x.$destroy(),x=null,d.ViewChanged.unbind(j),f.SheetChanged.unbind(l),y.cancel(z.intervalPromise),z.gridElement=null)}function n(){var a=x&&x.grid.getOptimalCell();return a||h(),a}function o(a){x&&t(a.pos)}function p(){return x&&x.grid.isBlocked()}function q(a){return p()?b.reject():(x.grid.block(),x.model.addObject(a).finally(function(){x.grid.unblock()}))}function r(a,c){return p()?b.reject():x.model.swapObjects(a,c)}function s(a,c){return p()?b.reject():x.model.moveObject(a,c)}function t(a){return p()?b.reject():(x.grid.block(),x.model.removeObject(a).finally(function(){x.grid.unblock()}))}function u(){return x&&x.grid&&!x.model}function v(){u()&&(l(f.model),i(f.Views.sheet,!1))}function w(a,b){x&&(x.model=null,x.grid.setEditMaster(a,b),i(f.Views.masterObject,!0))}var x=null,y=null,z={gridElement:null,scrollTop:0,scrollLeft:0,lastZoomedCell:null,intervalPromise:null,hightlightedCellId:null};return{start:k,stop:m,goToEditMode:function(){f.setState(f.States.edit)},getOptimalCell:n,removeCell:o,isActive:function(){return!!x},getGrid:function(){return x&&x.grid},getModel:function(){return x&&x.model},getActiveCell:function(){return x&&(x.grid.activeCell||x.grid.zoomCell)},activateCell:function(a){x&&x.grid.toggleActive(a)},deactivateCell:function(){x&&x.grid.toggleActive(null)},getZoomCell:function(){return x&&x.grid.zoomCell},getZoomedCellId:function(){return x.grid.zoomCell.id},zoomInOnCell:function(a){var b;x&&(b=x.grid.cells.filter(function(b){return b.id===a}),b.length&&x.grid.zoom(b[0]))},zoomOut:function(){x&&x.grid.zoom(null)},saveZoom:function(){!z.lastZoomedCell&&x.grid.zoomCell&&x.grid.zoomCell.id&&(z.lastZoomedCell=x.grid.zoomCell.id)},restoreZoom:function(){if(z.lastZoomedCell){var b=a.getService("$timeout");b(function(){x.grid.blockZoomAnimation=!0,this.zoomInOnCell(z.lastZoomedCell),z.lastZoomedCell=null}.bind(this))}},setGridElement:function(a){z.gridElement=a},saveScrollState:function(){!z.lastZoomedCell&&z.gridElement&&(z.scrollTop=z.gridElement.scrollTop,z.scrollLeft=z.gridElement.scrollLeft)},restoreScrollState:function(){y||(y=a.getService("$interval")),z.lastZoomedCell||(z.scrollTop>0&&(z.intervalPromise=y(function(){z.gridElement.children.length>0&&(z.gridElement.scrollTop=z.scrollTop,z.scrollTop=0,y.cancel(z.intervalPromise))},50)),z.scrollLeft>0&&(z.intervalPromise=y(function(){z.gridElement.children.length>0&&(z.gridElement.scrollLeft=z.scrollLeft,z.scrollLeft=0,y.cancel(z.intervalPromise))},50)))},highlightedCell:function(a){a&&(z.hightlightedCellId=a);var b;x&&z.hightlightedCellId&&(b=x.grid.cells.filter(function(a){return a.id===z.hightlightedCellId}),b.length&&(x.grid.highlight(b[0]),z.hightlightedCellId=null))},isBlocked:p,addObject:q,swapObjects:r,moveObject:s,isEditMaster:u,closeEditMaster:v,editMaster:w}}),define("client.assets/assets-utils",["jquery","util","assets/client/dialogs/confirm-dialog/confirm-dialog","pubsub","client.utils/state","client.services/grid-service"],function(a,b,c,d,e,f){function g(a,b){c.show({text:a}).then(b)}function h(a){if(!i)throw new TypeError("Permissions are not available yet. Make sure you have initialized this module with init().");switch(a){case"measure":return i.createMeasure;case"dimension":return i.createDimension;case"visualization":return i.createMasterobject;default:throw new TypeError("'"+a+"' is an unknown type.")}}var i,j={init:function(b){b&&(i=a.extend({},b))},getContextMenuAddToText:function(){var a=f.getActiveCell();return a?"contextMenu.addToVisualization":"contextMenu.addToSheet"},getAddToOptions:function(){var a=f.getActiveCell(),b=null;return e.isInEditMode()&&(b={},a?b.object=!0:b.sheet=!0),b},getAddToText:function(){var a=f.getActiveCell();return e.isInEditMode()?a?"library.addtoVisualization":"library.addtosheet":null},addItemToSheetOrVisualization:function(a){if(this.isAddToMode()){var b=f.getActiveCell(),c={item:a};b&&(c.cell=b),d.publish("/ui/library/addToSheet",c)}},librarySearchFn:function(a,c,d){return!c||""===c||(d=d?d:function(a,c){return b.match([a.name],c)})(a,c.toLowerCase())},libraryMultiSearch:function(a,c,d){if(a.match={},!c||""===c)return!0;c=c.toLowerCase();for(var e=!1,f=0;f<d.length;++f){var g=d[f];b.match(a[g],c)&&(e=!0,a.match[g]=!0)}return e},itemDblClickHandler:function(a){this.isAddToSheetMode()&&d.publish("/ui/library/addToSheet",{item:a})},removeDialog:g,editDialog:g,hasLinks:function(a,b){return b.get(a).then(function(a){return a.getLinkedObjects().then(function(a){return 0!==a.length})})},toggleSelection:function(b,c){var d=a(c.currentTarget);return b.selected=!b.selected,b.selected?(d.on("qv-outside",function(c){var e=a(c.target);1!==e.closest("#library-preview").length&&1!==e.closest(".qv-contextmenu").length&&(b.selected=!1,d.off("qv-outside"))}),!0):(d.off("qv-outside"),!1)},removeSelection:function(b){a.each(b,function(a,b){b.selected=!1})},localeOrderBy:function(a,b){if(a){var c=function(a,b){return a.localeCompare(b)};b&&b instanceof Function&&(c=function(a,c){return b(a).localeCompare(b(c))}),a.sort(c)}return a},isAddToSheetMode:function(){return e.isInEditMode()&&e.view===e.Views.sheet&&e.model.layout.permissions.update},isAddToVisualizationMode:function(){return e.isInEditMode()&&(e.view===e.Views.object&&e.model.layout.permissions.update||e.view===e.Views.masterObject)},isAddToMode:function(){return this.isAddToSheetMode()||this.isAddToVisualizationMode()},permissionToCreate:h};return j}),define("text!client.views/global-selections/directives/scroll/scroll.ng.html",[],function(){return'<div class="qv-gs-scroll-container">\n\t<qv-scroll-area class="qv-gs-scroll-area">\n\t\t<div ng-if="scrollApi.loadPrevious" class="qv-gs-scroll-btn qv-gs-scroll-btn-previous" tid="globalSelections.loadPrevious">\n\t\t\t<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true"></qv-scroll-load-button>\n\t\t</div>\n\t\t<div ng-repeat="item in items" class="qv-gs-listbox">\n\t\t\t<p ng-if="item.qField" q-title-translation="Common.Field" tid="globalSelections.fieldIndicator" class="qv-gs-field-indicator" qva-direction>\n\t\t\t\t<span class="lui-icon  lui-icon--field"></span>\n\t\t\t</p>\n\t\t\t<qv-gs-badge></qv-gs-badge>\n\t\t\t<qv-object ng-if="item.visible" model="item.model" options="item.options" object="item.object" class="qv-object-listbox" id="{{item.id}}"></qv-object>\n\t\t\t<div ng-if="!item.visible" class="qv-object qv-object-listbox qv-gs-placeholder" id="{{item.id}}">\n\t\t\t\t<h1 class="qv-object-title" qva-direction x-dir-text="{{item.title}}">\n\t\t\t\t\t<span class="qv-object-title-text" qva-direction x-dir-text="{{item.title}}">{{item.title}}</span>\n\t\t\t\t</h1>\n\t\t\t\t<div class="progress">\n\t\t\t\t\t<qv-rain></qv-rain>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div ng-if="scrollApi.loadNext" class="qv-gs-scroll-btn" tid="globalSelections.loadNext">\n\t\t\t<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\n\t\t</div>\n\t</qv-scroll-area>\n\t<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\n</div>\n';
}),define("general.scroll/api/dom-api",["core.utils/class","touche"],function(a,b){"use strict";function c(){return".grid-object-dom-api-"+ ++e}var d,e=0;return d=a.extend({init:function(a,b,d,e,f,g){g=g||".scroll-content",this.$element=a,this.$scrollArea=b,this.$scrollContent=b.find(g),this.rowSelector=d,this.firstRowSelector=e,this.lastRowSelector=f,this.namespace=c()},destroy:function(){this.unbindNativeScroll()},bindNativeScroll:function(a){this.$scrollArea.on("scroll"+this.namespace,a)},unbindNativeScroll:function(){this.$scrollArea.off(this.namespace)},resetNativeScroll:function(){this.$scrollArea.scrollTop(0)},preventNativeScroll:function(){var a="mousewheel"+this.namespace+" DOMMouseScroll"+this.namespace+" mousemove"+this.namespace;return this.$scrollArea.on(a,function(a){a.preventDefault()}),b(this.$scrollArea[0]).tap({id:this.namespace}),function(){this.$scrollArea.off(a),b(this.$scrollArea[0]).off("tap",this.namespace)}.bind(this)},getBoundingBox:function(){return this.$element[0].getBoundingClientRect()},getClientWidth:function(){return this.$element[0].clientWidth},getClientHeight:function(){return this.$element[0].clientHeight},getScrollAreaBoundingBox:function(){return this.$scrollArea[0].getBoundingClientRect()},getScrollAreaClientWidth:function(){return this.$scrollArea[0].clientWidth},getScrollAreaClientHeight:function(){return this.$scrollArea[0].clientHeight},getScrollAreaOffsetTop:function(){return this.$scrollArea[0].offsetTop},getScrollContentBoundingBox:function(){return this.$scrollContent[0].getBoundingClientRect()},getFirstRow:function(){return this.$scrollArea.find(this.firstRowSelector)},getLastRow:function(){return this.$scrollArea.find(this.lastRowSelector)},getVisibleRowCount:function(a){function b(a,b){var c=a.getBoundingClientRect();return Math.round(c.bottom-b.bottom)<1}function c(a,b){var c=b-a;return 1===c?b:Math.floor(a+c/2)}function d(a,e,f,g){var h=f-e,i=c(e,f),j=b(a[i],g);return 0===h?j?i:-1:1===h?j?i:d(a,e,e,g):j?d(a,i,f,g):d(a,e,i,g)}var e=this.$element[0].querySelectorAll(this.rowSelector);if(0===e.length)return 0;if(e=Array.prototype.slice.call(e),e=e.filter(function(a){return a.nodeType===Node.ELEMENT_NODE}),0===e.length)return 0;var f=this.getScrollAreaBoundingBox(),g=d(e,0,e.length-1,f)+1;if(g===e.length){var h=e[e.length-1],i=h.getBoundingClientRect(),j=Math.round(f.bottom-i.bottom);g+=Math.floor(j/a)}return g},alignToFirstRow:function(){var a=this.getFirstRow(),b=48;return function(){var c=a.position().top-b;this.$scrollArea.scrollTop(c)}.bind(this)},alignToLastRow:function(){var a=this.getLastRow(),b=48;return function(){this.$scrollArea.scrollTop(0);var c=a.position().top-this.getScrollAreaBoundingBox().height+a[0].getBoundingClientRect().height+b;this.$scrollArea.scrollTop(c)}.bind(this)}})}),define("general.scroll/api/data-api",["core.utils/deferred","core.utils/class"],function(a,b){"use strict";var c;return c=b.extend({getRowCount:function(){return 0},getFirstElementIndex:function(){return-1},getLastElementIndex:function(){return-1},getIndexOf:function(a){return a.getIndex()},onVirtualScroll:function(){return a.resolve()},onGotoNextBlock:function(){return a.resolve()},onGotoPreviousBlock:function(){return a.resolve()},onInitialNativeScroll:function(){return a.resolve()}})}),define("general.scroll/scroll-area-service",["qvangular"],function(a){"use strict";a.service("qvScrollAreaService",function(){function a(a){if("rtl"===a.textDirection&&"horizontal"===a.direction){var b=a.showMinAffordance;a.showMinAffordance=a.showMaxAffordance,a.showMaxAffordance=b}}return{createScrollbar:function(){return{vLength:0,vViewportLength:0,vPos:0,vPage:0,thumb:{},style:{},classList:[],enabled:!1,getScrollDelta:function(a){var b=0,c=0;if(!this.enabled)return[0,0];switch(this.direction){case"vertical":c=a.swipe.curDeltaY*(1/this.scaleFactor);break;case"horizontal":b=("rtl"===this.textDirection?-1:1)*a.swipe.curDeltaX*(1/this.scaleFactor);break;default:throw"not implemented"}return[b,c]},active:!1}},setScrollbarData:function(b,c,d,e,f,g,h){var i,j=3;switch(c){case"vertical":i=g.height;break;case"horizontal":i=g.width;break;default:throw"not implemented"}if(b.enabled=f<e&&i>0,b.enabled){switch(i-=2*j,b.uiOffset=j,b.direction=c,b.vLength=e,b.vViewportLength=f,b.vPos=0,b.vPage=i,b.length=i,b.trackSize=d,b.scaleFactor=i/e,b.thumb.pos=0,b.thumb.size=0,b.thumb.vPos=0,b.showMinAffordance=!1,b.showMaxAffordance=!0,b.textDirection=h,b.direction){case"vertical":b.style.top=g.top+b.uiOffset+"px",b.style.width=d+"px",b.style.left="rtl"===h?b.uiOffset+"px":g.left+g.width-d-b.uiOffset+"px",b.style.height=g.height-2*b.uiOffset+"px";break;case"horizontal":b.style.height=d+"px",b.style.top=g.top+g.height-d-b.uiOffset+"px",b.style.left=g.left+b.uiOffset+"px",b.style.width=g.width-2*b.uiOffset+"px";break;default:throw"not implemented"}a(b)}},setVirtualScrollPos:function(b,c,d){var e=0,f=c.vLength-c.vViewportLength,g=0,h=c.thumb.vPos;return c.enabled?(c.vPos+=b,c.showMinAffordance=!1,c.showMaxAffordance=!1,c.vPos<e?(h=e,c.vPos=d?c.vPos:e,c.showMaxAffordance=!0):c.vPos>f?(h=f,c.vPos=d?c.vPos:f,c.showMinAffordance=!0):(c.vPos!==e&&(c.showMinAffordance=!0),c.vPos!==f&&(c.showMaxAffordance=!0),h=c.vPos),g=h-c.thumb.vPos,c.thumb.vPos=h,a(c),g):0},setThumbStyle:function(a,b){var c=b.thumb,d=12,e=b.scaleFactor,f=Math.floor(c.vPos*e),g=Math.floor(b.vViewportLength*e);switch(g<d&&(f-=Math.floor((d-g)/2),g=d),f=Math.max(f,0),f+g>b.length&&(f=b.length-g),c.size=g,c.pos=f,b.direction){case"vertical":a.top=f+"px",a.height=g+"px";break;case"horizontal":"rtl"===b.textDirection?(delete a.left,a.right=f+"px"):(delete a.right,a.left=f+"px"),a.width=g+"px";break;default:throw"not implemented"}},setTrackHitAreaStyle:function(a,b,c){"vertical"===b.direction?(a.right=-b.uiOffset+"px",a.width=c+b.uiOffset+"px"):(a.bottom=-b.uiOffset+"px",a.height=c+b.uiOffset+"px")}}})}),define("general.scroll/scroll-area-controller",["general.utils/support","general.scroll/scroll-area-service"],function(a){"use strict";var b=["$scope","$element","$timeout","qvScrollAreaService",function(b,c,d,e){var f,g,h,i,j=[],k=[],l=[];b.interactive=!1,b.virtualSize={width:0,height:0},b.virtualViewport={width:0,height:0},b.scrollbarX=e.createScrollbar(),b.scrollbarY=e.createScrollbar(),b.viewportRect={top:0,left:0,width:0,height:0},b.hover=!1,b.isMouse=!0,b.$on("$destroy",function(){clearTimeout(h),clearTimeout(i)}),this.setMouse=function(a){b.isMouse=a},this.getScrollAreaRect=function(){var a=c[0].getBoundingClientRect();return{top:0,left:0,width:Math.ceil(a.width),height:Math.ceil(a.height)}},this.addScrollbarXCtrl=function(a){f=a},this.addScrollbarYCtrl=function(a){g=a},this.allowFade=function(){return(void 0===f||f.allowFade())&&(void 0===g||g.allowFade())},this.fadeScrollbarsWithoutDelay=function(){f&&f.fadeOut(),g&&g.fadeOut()},this.toggleFadeScrollbars=function(a){clearTimeout(i),clearTimeout(h),(a||this.allowFade())&&(h=setTimeout(function(){var b=a?"fadeIn":"fadeOut";f&&f[b](),g&&g[b]()},a?0:800))},this.fadeInScrollbars=function(){this.toggleFadeScrollbars(!0)},this.fadeOutScrollbars=function(){a.treatAsDesktop()&&b.hover||this.toggleFadeScrollbars(!1)},this.fadeOutScrollbarsDelayed=function(){clearTimeout(i),i=setTimeout(function(){this.toggleFadeScrollbars(!1)}.bind(this),1e3)},this.setNonMouseTrackSize=function(){"object"==typeof b.nonMouseViewportScrolling&&(c.addClass(b.nonMouseViewportScrolling.className),this.setTrackSize(b.nonMouseViewportScrolling.scrollbarSize))},this.setMouseTrackSize=function(){"object"==typeof b.nonMouseViewportScrolling&&c.removeClass(b.nonMouseViewportScrolling.className),this.setTrackSize(b.scrollbarSize)},this.setTrackSize=function(a){var c=this.getVirtualPosition();this.setVirtualSize(b.virtualSize,b.virtualViewport,b.viewportRect,a),this.setVirtualScrollPos(c.vPosX,c.vPosY)},this.setupScrollbars=function(a){a=a||8,e.setScrollbarData(b.scrollbarY,"vertical",a,b.virtualSize.height,b.virtualViewport.height,b.viewportRect,b.direction),e.setScrollbarData(b.scrollbarX,"horizontal",a,b.virtualSize.width,b.virtualViewport.width,b.viewportRect,b.direction),b.scrollbarX.enabled&&b.scrollbarY.enabled&&(b.scrollbarX.length-=a,b.scrollbarX.scaleFactor=b.scrollbarX.length/b.virtualSize.width,b.scrollbarX.style.width=b.viewportRect.width-a-2*b.scrollbarX.uiOffset+"px","rtl"===b.direction&&(b.scrollbarX.style.left=b.viewportRect.left+b.scrollbarX.uiOffset+a+"px"),b.scrollbarY.length-=a,b.scrollbarY.scaleFactor=b.scrollbarY.length/b.virtualSize.height,b.scrollbarY.style.height=b.viewportRect.height-a-2*b.scrollbarY.uiOffset+"px")},this.setVirtualSize=function(a,c,d,e){b.viewportRect=d,b.virtualSize.width=a.width,b.virtualSize.height=a.height,b.virtualViewport.width=c.width,b.virtualViewport.height=c.height,this.setupScrollbars(e)},this.setViewport=function(a){b.viewportRect=a},this.setVirtualViewport=function(a){var c=this.getVirtualPosition();b.virtualViewport.width=a.width,b.virtualViewport.height=a.height,b.scrollbarX.vViewportLength=a.width,b.scrollbarY.vViewportLength=a.height,this.setupScrollbars(b.isMouse?b.scrollbarSize:b.nonMouseViewportScrolling.scrollbarSize),this.setVirtualScrollPos(c.vPosX,c.vPosY)},this.getVirtualSize=function(){return{width:b.virtualSize.width,height:b.virtualSize.height}},this.getVirtualPosition=function(){var a=0,c=this.getMaxPosition();return{vPosX:Math.max(a,Math.min(c.vPosX,b.scrollbarX.vPos)),vPosY:Math.max(a,Math.min(c.vPosY,b.scrollbarY.vPos))}},this.getMaxPosition=function(){var a=0,c=Math.max(a,b.scrollbarX.vLength-b.scrollbarX.vViewportLength),d=Math.max(a,b.scrollbarY.vLength-b.scrollbarY.vViewportLength);return{vPosX:c,vPosY:d}},this.isMouseOver=function(){return b.hover},this.resetScroll=function(){void 0!==b.scrollbarX.vPos&&void 0!==b.scrollbarY.vPos&&(0===b.scrollbarX.vPos&&0===b.scrollbarY.vPos||this.scroll(-b.scrollbarX.vPos,-b.scrollbarY.vPos,!0,!1))},this.setVirtualScrollPos=function(a,c,d){e.setVirtualScrollPos(a,b.scrollbarX,d),e.setVirtualScrollPos(c,b.scrollbarY,d)},this.scroll=function(a,c,d,f){var g,h;g=e.setVirtualScrollPos(a,b.scrollbarX,f),h=e.setVirtualScrollPos(c,b.scrollbarY,f),(0!==g||0!==h||d)&&j.forEach(function(a){a(g,h)})},this.getScrollAmount=function(a,b,c){switch(c){default:return{deltaX:a,deltaY:b}}},this.scrollStart=function(){k.forEach(function(a){a()})},this.scrollEnd=function(){l.forEach(function(a){a()})},this.onScroll=function(a){j.push(a)},this.onScrollStart=function(a){k.push(a)},this.onScrollEnd=function(a){l.push(a)},this.on=function(){b.interactive||(b.off=b.on(),b.interactive=!0)},this.off=function(){b.off&&(b.off(),b.interactive=!1)},this.isVerticalScrollEnabled=function(){return b.scrollbarY.enabled},this.digest=function(){b.$parent.$digest()}}];return b}),define("general.scroll/loader/loader",["qvangular","core.utils/deferred"],function(a,b){"use strict";a.directive("qvScrollLoader",["$animateCss","$timeout",function(a,c){return{restrict:"E",replace:!0,template:function(a,b){var c=b.tag||"div";return"<"+c+' ng-style="loaderStyle" class="qv-scroll-loader qv-animate"><qv-rain ng-if="showRain" show="showRain"></qv-rain></'+c+">"},scope:{},controller:function(){},link:function(d,e,f,g){function h(a,b){d.loaderStyle.top=a,d.loaderStyle.width=b.width,d.loaderStyle.height=b.height}var i,j,k,l=!!f.noRain;d.loaderStyle={width:0,height:0},d.showRain=!1,g.fadeIn=function(f,g){var k=b();return h(f,g),l||(i=c(function(){d.showRain=!0})),j=a(e,{addClass:"fade"}),j.start().done(function(){k.resolve()}),k.promise},g.fadeOut=function(){var c=b();return d.showRain=!1,k=a(e,{removeClass:"fade"}),k.start().done(function(){d.loaderStyle.width=0,d.loaderStyle.height=0,d.$apply(),c.resolve()}),c.promise},d.$on("$destroy",function(){c.cancel(i)})}}}])}),define("text!general.scroll/loader/load-button.ng.html",[],function(){return'<div class="qv-scroll-data-load-buttons" ng-class="{ previous: previous }">\n\t<div ng-transclude></div>\n\t<button class="lui-button" qva-activate="load()" ng-disabled="disabled">\n\t\t<p q-translation="{{text}}"></p>\n\t</button>\n</div>\n'}),define("general.scroll/loader/load-button",["qvangular","text!./load-button.ng.html"],function(a,b){"use strict";a.directive("qvScrollLoadButton",[function(){return{restrict:"E",transclude:!0,replace:!0,template:function(a,c){var d=c.tag||"div";return b.replace(/^\s*<div/,"<"+d).replace(/<\/div>\s*$/,"</"+d+">")},scope:{onLoad:"&",text:"@",previous:"=",disabled:"="},link:function(a){a.load=function(){a.onLoad()}}}}])}),define("text!general.scroll/scroll-area.ng.html",[],function(){return'<div>\n\t<div class="scroll-content" ng-transclude></div>\n\t<qv-scroll-area-affordance x-show="scrollbarY.showMinAffordance" x-direction="\'vertical\'" x-dock="\'min\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\n\t<qv-scroll-area-affordance x-show="scrollbarX.showMinAffordance" x-direction="\'horizontal\'" x-dock="\'min\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\n\t<qv-scrollbar x-data="scrollbarY" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarY.enabled"></qv-scrollbar>\n\t<qv-scrollbar x-data="scrollbarX" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarX.enabled"></qv-scrollbar>\n\t<qv-scroll-area-affordance x-show="scrollbarY.showMaxAffordance" x-direction="\'vertical\'" x-dock="\'max\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\n\t<qv-scroll-area-affordance x-show="scrollbarX.showMaxAffordance" x-direction="\'horizontal\'" x-dock="\'max\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\n</div>\n'}),define("text!general.scroll/scrollbar.ng.html",[],function(){return'<div class="scrollbar-animation scrollbar-track"\n\tng-class="data.classList"\n\tng-style="data.style">\n\t<qv-scrollbar-track-hit-area ng-style="trackHitAreaStyle" class="scrollbar-hitarea"></qv-scrollbar-track-hit-area>\n\t<qv-scrollbar-thumb ng-class="{ active: data.active }" class="scrollbar-thumb" ng-style="thumbStyle"></qv-scrollbar-thumb>\n</div>\n'}),define("general.scroll/mouse-wheel-service",["qvangular"],function(a){"use strict";var b="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";a.service("qvMouseWheelService",function(){return{getEventName:function(){return b},getMouseWheelData:function(a){var c=1,d=0,e=0,f=0,g=40;return"wheel"===b?a:("MozMousePixelScroll"===a.type&&(c=0),a.wheelDelta&&(d=-a.wheelDelta/g),a.detail&&(d=-a.detail/3),f=d,void 0!==a.axis&&a.axis===a.HORIZONTAL_AXIS&&(f=0,e=-1*d),void 0!==a.wheelDeltaY&&(f=-1*a.wheelDeltaY/g),void 0!==a.wheelDeltaX&&(e=-1*a.wheelDeltaX/g),{deltaMode:c,delta:d,deltaX:e,deltaY:f,x:a.pageX,y:a.pageY})}}})}),define("general.scroll/scroll-area-affordance",["qvangular"],function(a){"use strict";a.directive("qvScrollAreaAffordance",function(){return{restrict:"E",template:'<div ng-show="show" class="scroll-affordance" ng-class="[dock,direction]" ng-style="style"></div>',replace:!0,require:"^qvScrollArea",scope:{viewportRect:"=",direction:"=",dock:"=",size:"=?",show:"="},link:function(a){a.size=a.size||18,a.style={},a.updateAffordance=function(){switch(a.direction){case"vertical":switch(a.style.width=a.viewportRect.width+"px",a.style.height=a.size+"px",a.dock){case"min":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+"px";break;case"max":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+a.viewportRect.height-a.size+"px";break;default:throw"Dock "+a.dock+" not supported"}break;case"horizontal":switch(a.style.width=a.size+"px",a.style.height=a.viewportRect.height+"px",a.dock){case"min":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+"px";break;case"max":a.style.left=a.viewportRect.left+a.viewportRect.width-a.size+"px",a.style.top=a.viewportRect.top+"px";break;default:throw"Dock "+a.dock+" not supported"}break;default:throw"Direction "+a.direction+" not supported"}},a.$watch("viewportRect",a.updateAffordance,!0)}}})}),define("general.scroll/scroll-area",["jquery","qvangular","general.scroll/scroll-area-controller","text!./scroll-area.ng.html","text!./scrollbar.ng.html","touche","general.utils/support","general.scroll/scroll-area-service","general.scroll/mouse-wheel-service","general.scroll/scroll-area-affordance"],function(a,b,c,d,e,f,g){"use strict";b.directive("qvScrollArea",["$document","$timeout","qvScrollAreaService","qvMouseWheelService",function(b,e,h,i){return{restrict:"E",transclude:!0,template:d,replace:!0,scope:{scrollbarSize:"=?",nonMouseViewportScrolling:"=?",direction:"=?"},require:"qvScrollArea",controller:c,link:function(c,d,e,h){function j(a,b){var d=c.viewportRect.left,e=c.viewportRect.top,f=c.viewportRect.left+c.viewportRect.width,g=c.viewportRect.top+c.viewportRect.height;return a>=d&&a<=f&&b>=e&&b<=g}function k(){d.off(c.namespace),b.off(c.namespace),f(d[0]).off("*",c.namespace)}"number"!=typeof c.scrollbarSize&&(c.scrollbarSize=8),c.direction||(c.direction="ltr"),c.$watch("scrollbarX.enabled",function(a){a===!0&&d.css("overflow-x","hidden")}),c.$watch("scrollbarY.enabled",function(a){a===!0&&d.css("overflow-y","hidden")}),c.namespace=".scroll-area-"+c.$id,c.on=function(){return d.on(i.getEventName()+c.namespace,function(a){var b,c=i.getMouseWheelData(a.originalEvent);b=h.getScrollAmount(c.deltaX,c.deltaY,c.deltaMode),h.scroll(b.deltaX,b.deltaY,!1,!1),g.treatAsDesktop()||(h.setMouseTrackSize(),h.fadeInScrollbars(),h.fadeOutScrollbarsDelayed()),h.digest()}),b.on("keydown"+c.namespace,function(b){var d,e,f=0,g=0,i=a(b.target),j=i.is("input")||i.is("textarea");if(c.hover&&!j){switch(b.keyCode){case 33:g=1,d=2;break;case 34:g=-1,d=2;break;case 36:g=1,d=10;break;case 35:g=-1,d=10;break;case 38:g=1,d=1;break;case 40:g=-1,d=1;break;case 39:f=-1,d=1;break;case 37:f=1,d=1;break;default:return}e=h.getScrollAmount(f,g,d),h.scroll(-e.deltaX,-e.deltaY,!1,!1),h.digest()}}),d.on("mouseenter"+c.namespace+"pointerenter"+c.namespace,function(a){c.isMouse=g.isMouse(a.originalEvent),c.isMouse?(c.hover=!0,g.treatAsDesktop()&&(h.setMouseTrackSize(),h.fadeInScrollbars()),h.digest()):a.preventDefault()}),d.on("mouseleave"+c.namespace+"pointerleave"+c.namespace,function(a){c.isMouse=g.isMouse(a.originalEvent),c.isMouse&&(c.hover=!1,g.treatAsDesktop()&&h.fadeOutScrollbars())}),"object"==typeof c.nonMouseViewportScrolling&&("number"!=typeof c.nonMouseViewportScrolling.scrollbarSize&&(c.nonMouseViewportScrolling.scrollbarSize=36),"string"!=typeof c.nonMouseViewportScrolling.className&&(c.nonMouseViewportScrolling.className="show-non-mouse-scrollbars"),f(d[0]).swipe({id:c.namespace,options:{radiusThreshold:0,useMomentum:!0,inertia:.7},start:function(a,b){return g.isMouse(a)?void this.cancel():j(b.pagePoints[0].x-this.rect.x,b.pagePoints[0].y-this.rect.y)?(h.setMouse(!1),h.setNonMouseTrackSize(),h.scrollStart(),h.fadeInScrollbars(),void h.digest()):void this.cancel()},update:function(a,b){var d=c.scrollbarX.getScrollDelta(b)[0],e=c.scrollbarY.getScrollDelta(b)[1];h.scroll(-1*d,-1*e,!1,!0),h.digest()},end:function(){h.scrollEnd(),h.fadeOutScrollbars(),h.digest()}})),k},c.$on("$destroy",function(){k()})}}}]),b.directive("qvScrollbar",["qvScrollAreaService",function(a){return{restrict:"E",require:["^qvScrollArea","qvScrollbar"],scope:{data:"=",interactive:"=",viewportRect:"="},template:e,replace:!0,controller:function(){},link:function(b,c,d,e){function f(a){c[a?"addClass":"removeClass"]("fade")}var h=e[0],i=e[1];"vertical"===b.data.direction?(b.data.classList.push("vertical"),h.addScrollbarYCtrl(i)):(b.data.classList.push("horizontal"),h.addScrollbarXCtrl(i)),i.allowFade=function(){return!b.data.active},i.fadeIn=function(){return f(!0)},i.fadeOut=function(){return f(!1)},b.thumbStyle={},b.$watch("data.thumb",function(){a.setThumbStyle(b.thumbStyle,b.data)},!0),b.$watch("data.vPage",function(){a.setThumbStyle(b.thumbStyle,b.data)}),b.$watch("data.vLength",function(){a.setThumbStyle(b.thumbStyle,b.data)}),b.$watch("data.enabled",function(a){h.isMouseOver()&&a&&i.fadeIn()}),b.setThumbStyle=a.setThumbStyle.bind(null,b.thumbStyle,b.data),b.trackHitAreaStyle={},b.$watch("data.trackSize",function(c){void 0!==c&&a.setTrackHitAreaStyle(b.trackHitAreaStyle,b.data,c)}),b.start=function(a){h.setMouse(a),b.data.active||g.treatAsDesktop()||(a?h.setMouseTrackSize():h.setNonMouseTrackSize(),h.fadeInScrollbars()),b.data.active=!0,h.scrollStart()},b.update=function(a,b){h.scroll(a,b,!1,!0)},b.end=function(a){var c=b.data,d=0,e=c.vLength-c.vViewportLength;c.vPos<d?c.vPos=d:c.vPos>e&&(c.vPos=e),b.data.active=!1,h.scrollEnd(),a?h.fadeOutScrollbarsDelayed():h.fadeOutScrollbars()},b.on=function(){return b.hitAreaOff=b.hitAreaOn(),b.thumbOff=b.thumbOn(),function(){b.hitAreaOff(),b.thumbOff()}},b.$watch("interactive",function(a){a?b.off=b.on():b.off&&b.off()})}}}]),b.directive("qvScrollbarThumb",[function(){return{restrict:"E",template:"<div></div>",replace:!0,require:"^qvScrollArea",link:function(a,b,c,d){a.thumbOn=function(){return f(b[0]).tap({start:function(b){f.preventGestures(this.gestureHandler),a.start(g.isMouse(b)),d.digest()}}).swipe({options:{radiusThreshold:0},update:function(b,c){a.update.apply(a,a.data.getScrollDelta(c)),d.digest()},end:function(){a.end(),d.digest()}}),function(){f(b[0]).off()}},a.$on("$destroy",function(){f(b[0]).off()})}}}]),b.directive("qvScrollbarTrackHitArea",[function(){return{restrict:"E",replace:!0,template:"<div></div>",require:"^qvScrollArea",link:function(a,b,c,d){function e(b,c){var e,f,g,h,i,j=a.data.thumb.size,k=a.data.thumb.pos,l=0,m=0;switch(a.data.direction){case"vertical":f=b.pagePoints[0].y-c.y<k,g=b.pagePoints[0].y-c.y>k+j,g?(e=d.getScrollAmount(-1,-1,2),l=0,m=-e.deltaY):f&&(e=d.getScrollAmount(1,1,2),l=0,m=-e.deltaY);break;case"horizontal":h=b.pagePoints[0].x-c.x<k,i=b.pagePoints[0].x-c.x>k+j,h?(e=d.getScrollAmount(1,1,2),l=-e.deltaX,m=0):i&&(e=d.getScrollAmount(-1,-1,2),l=-e.deltaX,m=0)}d.scroll(l,m)}function h(b,c){switch(a.data.direction){case"vertical":a.update(0,(b.pagePoints[0].y-c.y-(a.data.thumb.pos+a.data.thumb.size/2))*(1/a.data.scaleFactor));break;case"horizontal":a.update((b.pagePoints[0].x-c.x-(a.data.thumb.pos+a.data.thumb.size/2))*(1/a.data.scaleFactor),0);break;default:throw"not implemented"}}a.hitAreaOn=function(){return f(b[0]).tap({start:function(b,c){f.preventGestures(this.gestureHandler),a.start(g.isMouse(b)),a.setThumbStyle(),g.isMouse(b)?e(c,this.rect):h(c,this.rect),d.digest()},end:function(){a.end(!0),d.digest()}}).swipe({options:{radiusThreshold:0},start:function(b,c){return g.isMouse(b)?void this.cancel():(a.update.apply(a,a.data.getScrollDelta(c)),void d.digest())},update:function(b,c){a.update.apply(a,a.data.getScrollDelta(c)),d.digest()},end:function(){a.end(!0),d.digest()}}),function(){f(b[0]).off()}},a.$on("$destroy",function(){f(b[0]).off()})}}}])}),define("general.scroll/api/vertical-scroll-api",["core.utils/class","core.utils/notification","util","general.utils/support","general.scroll/api/dom-api","general.scroll/api/data-api","general.scroll/scroll-area-controller","general.scroll/loader/loader","general.scroll/loader/load-button","general.scroll/scroll-area"],function(a,b,c,d,e,f,g){"use strict";var h;return h=a.extend({destroy:function(){this.$timeout.cancel(this.initPromise),this.$timeout.cancel(this.setVirtualSizePromise),this.unpreventNativeScroll&&this.unpreventNativeScroll(),this.domApi.destroy()},init:function(a,e){b.create(this,"Scroll"),this.$timeout=a,this.initPromise=null,this.setVirtualSizePromise=null,void 0!==e.virtualScrollEnabled?this.virtualScrollEnabled=e.virtualScrollEnabled:this.virtualScrollEnabled=d.treatAsDesktop(),this.loaderStyle={width:0,height:0},this.totalRows=0,this.totalColumns=0,this.alignBottomAbsolute=!1,this.axisDelta={xAxis:0,yAxis:0},this.alignToBottomReduce={active:!1,activeFromStart:!1},this.ignoreScroll=!1,this.loadNext=!1,this.loadPrevious=!1,this.settings=c.extend(!0,{alignToBottom:"absolute",minRowHeight:21,maxRowHeight:21,minColumnWidth:30,viewportRowCount:0,viewportColumnCount:0,width:0,height:0,blockSize:100,keepItemsCount:10},e)},initialize:function(a,b,c,d){if(!(a instanceof e))throw"Must provide an instance of domApi";if(!(b instanceof f))throw"Must provide an instance of dataApi";if(!(c instanceof g[4]))throw"Must provide an instance of ScrollAreaController";if(!d||"function"!=typeof d.fadeIn||"function"!=typeof d.fadeOut)throw"Must provide valid loader api";return this.initPromise?this.initPromise:(this.domApi=a,this.dataApi=b,this.virtualScrollApi=c,this.loaderApi=d,this.initPromise=this.$timeout(function(){this.onInit(),this.onInitVirtualScroll(),this.bindNativeScroll()}.bind(this)),this.initPromise)},onInit:function(){this.updateViewport()},onInitVirtualScroll:function(){this.virtualScrollApi.onScroll(this.onVirtualScroll.bind(this)),this.virtualScrollApi.getScrollAmount=this.getVirtualScrollAmount.bind(this)},bindNativeScroll:function(){this.domApi.bindNativeScroll(this.onNativeScroll.bind(this))},activate:function(){this.virtualScrollEnabled&&this.virtualScrollApi.on(),this.unpreventNativeScroll&&(this.unpreventNativeScroll(),this.unpreventNativeScroll=null)},deactivate:function(){this.unpreventNativeScroll=this.domApi.preventNativeScroll(),this.virtualScrollApi.off()},updateViewport:function(){var a=this.domApi.getBoundingBox();this.settings.width=a.width,this.settings.height=a.height,this.settings.viewportRowCount=Math.ceil(this.settings.height/this.settings.minRowHeight),this.settings.viewportColumnCount=Math.ceil(this.settings.width/this.settings.minColumnWidth)},setTotalRows:function(a){this.totalRows=a},setTotalColumns:function(a){this.totalColumns=a},getSpliceArgs:function(){var a=this.dataApi.getRowCount(),b=this.settings.viewportRowCount,c=this.settings.keepItemsCount,d=a-b-c;return[0,d]},onSetVirtualSize:function(a){var b,c,d,e,f=this.domApi.getScrollAreaBoundingBox(),g=this.domApi.getScrollContentBoundingBox(),h=this.virtualScrollApi.getVirtualPosition(),i=this.settings.minRowHeight*this.totalRows;"reduce"===this.settings.alignToBottom?(this.alignToBottomReduce.active=!1,this.alignToBottomReduce.activeFromStart=!1,g.height>=f.height&&this.settings.viewportRowCount>=this.totalRows&&(b=this.domApi.getVisibleRowCount(this.settings.maxRowHeight),b<this.settings.viewportRowCount&&(this.alignToBottomReduce.active=!0,this.alignToBottomReduce.activeFromStart=!0,this.settings.viewportRowCount=b)),d={width:f.width,height:this.settings.viewportRowCount*this.settings.minRowHeight}):d={width:f.width,height:f.height},c={width:this.settings.minColumnWidth*this.totalColumns,height:i},e={top:0,left:0,width:f.width,height:f.height},this.virtualScrollApi.setVirtualSize(c,d,e),a&&this.virtualScrollApi.scroll(h.vPosX,h.vPosY,!0)},setVirtualSize:function(a){if(this.virtualScrollEnabled){var b=this.setVirtualSizePromise=this.$timeout(function(){this.onSetVirtualSize(a),this.updateAlignToBottom()}.bind(this));return b}},getVirtualScrollAmount:function(a,b,c){var d=this.virtualScrollApi.getVirtualPosition(),e=this.virtualScrollApi.getMaxPosition();if(this.alignBottomAbsolute&&b<0)return{deltaX:a,deltaY:b};switch(c){case 1:return{deltaX:0,deltaY:this.settings.minRowHeight*b};case 2:return{deltaX:0,deltaY:this.settings.viewportRowCount*this.settings.minRowHeight*b};case 10:return{deltaX:0,deltaY:b>0?d.vPosY*b:d.vPosY-e.vPosY};default:return{deltaX:a,deltaY:b}}},getPage:function(a){return{left:Math.floor(a.vPosX/this.settings.minColumnWidth),top:Math.floor(a.vPosY/this.settings.minRowHeight),width:this.settings.viewportColumnCount,height:this.settings.viewportRowCount}},adjustPageToBounds:function(a){a.top>0&&a.top+a.height>this.totalRows&&(a.top=Math.max(0,this.totalRows-a.height),a.height=Math.min(this.totalRows,a.height)),a.left>0&&a.left+a.width>this.totalColumns&&(a.left=Math.max(0,this.totalColumns-a.width),a.width=Math.min(this.totalColumns,a.width))},onVirtualScroll:function(a,b){this.Scroll.emit();var c=this.virtualScrollApi.getVirtualPosition(),d=this.virtualScrollApi.getMaxPosition(),e=this.getPage(c);return this.alignToBottomReduce.active&&b<0&&(this.graduallyLeaveAlignToBottomReduce(e),d=this.virtualScrollApi.getMaxPosition()),"reduce"===this.settings.alignToBottom&&d.vPosY>0&&c.vPosY===d.vPosY&&(this.alignToBottomReduce.active=!0),this.adjustPageToBounds(e),this.axisDelta.xAxis=a,this.axisDelta.yAxis=b,this.dataApi.onVirtualScroll(e.top,e.height,e.left,e.width,a,b).then(function(){this.updateAlignToBottom()}.bind(this))},updateAlignToBottom:function(){"reduce"===this.settings.alignToBottom?this.updateAlignToBottomReduce():this.updateAlignToBottomAbsolute()},updateAlignToBottomAbsolute:function(){var a=this.virtualScrollApi.getVirtualPosition(),b=this.virtualScrollApi.getMaxPosition();this.virtualScrollApi.isVerticalScrollEnabled()&&a.vPosY===b.vPosY?this.alignBottomAbsolute=!0:this.alignBottomAbsolute=!1},updateAlignToBottomReduce:function(){var a=!1;if(this.alignToBottomReduce.active){if(this.axisDelta.yAxis>0){var b=this.domApi.getVisibleRowCount(this.settings.maxRowHeight);this.settings.viewportRowCount=b}else{var c=Math.ceil(this.domApi.getScrollAreaClientHeight()/this.settings.minRowHeight);this.settings.viewportRowCount>=c&&(this.alignToBottomReduce.active=!1),a=!0}var d=this.domApi.getScrollAreaBoundingBox();this.virtualScrollApi.setViewport({top:0,left:0,width:d.width,height:d.height}),this.virtualScrollApi.setVirtualViewport({width:d.width,height:this.settings.viewportRowCount*this.settings.minRowHeight}),a&&this.virtualScrollApi.setVirtualScrollPos(0,-1)}},graduallyLeaveAlignToBottomReduce:function(a){var b=Math.ceil(this.domApi.getScrollAreaClientHeight()/this.settings.minRowHeight);this.alignToBottomReduce.activeFromStart||(a.height=Math.min(this.totalRows-a.top,b),this.settings.viewportRowCount=a.height)},updateLoadingButtons:function(){var a=this.dataApi.getFirstElementIndex(),b=this.dataApi.getRowCount();a+b>=this.totalRows||0===this.totalRows||a<0?this.loadNext=!1:this.loadNext=!0,a>0?this.loadPrevious=!0:this.loadPrevious=!1},resetNativeScroll:function(){return this.ignoreScroll=!0,this.loadNext=!1,this.loadPrevious=!1,this.domApi.resetNativeScroll(),function(){this.ignoreScroll=!1}.bind(this)},onNativeScroll:function(){if(this.Scroll.emit(),!this.ignoreScroll){var a=this.dataApi.getLastElementIndex()+1,b=this.settings.blockSize-a;this.ignoreScroll=!0,this.dataApi.onInitialNativeScroll(a,b).then(function(){this.updateLoadingButtons()}.bind(this))}},gotoNextBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var a=this.domApi.alignToLastRow(),b=this.dataApi.getLastElementIndex()+1,c=this.settings.blockSize-this.settings.keepItemsCount;this.dataApi.onGotoNextBlock(b,c).then(function(){this.updateLoadingButtons(),this.$timeout(function(){a(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))},gotoPreviousBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var a=this.domApi.alignToFirstRow(),b=this.settings.blockSize-this.settings.keepItemsCount,c=this.dataApi.getFirstElementIndex()-b;c<0&&(b+=c,c=0),this.dataApi.onGotoPreviousBlock(c,b).then(function(){this.updateLoadingButtons(),this.$timeout(function(){a(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))}})}),define("general.scroll/api/simple-list-data-api",["core.utils/deferred","general.scroll/api/data-api"],function(a,b){"use strict";var c;return c=b.extend({init:function(a){this.list=[],this.scrollApi=a},getRowCount:function(){return this.scrollApi.items?this.scrollApi.items.length:0},getFirstElementIndex:function(){return this.list.indexOf(this.scrollApi.items[0])},getLastElementIndex:function(){return this.list.indexOf(this.scrollApi.items[this.scrollApi.items.length-1])},getItems:function(a,b){
return this.list.slice(Math.max(0,a),a+b)},setItems:function(a,b){this.scrollApi.items=this.getItems(a,b)},setList:function(a,b){this.list=a,this.scrollApi.setTotalRows(this.list.length);var c=this.getRowCount(),d=b&&c>0?this.getFirstElementIndex():0;this.scrollApi.virtualScrollEnabled?(this.setItems(d,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(b)):b?(c=Math.min(a.length-d,Math.max(this.getRowCount(),this.scrollApi.settings.blockSize)),this.setItems(d,c),this.scrollApi.updateLoadingButtons()):(this.setItems(d,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()())},resize:function(){this.scrollApi.updateViewport();var b=this.getRowCount(),c=b>0?this.getFirstElementIndex():0;return 0!==c&&c+this.scrollApi.settings.viewportRowCount>b&&(c=Math.max(0,b-this.scrollApi.settings.viewportRowCount)),this.scrollApi.virtualScrollEnabled?(this.setItems(c,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(!0)):0===c&&b<this.scrollApi.settings.blockSize?(this.setItems(c,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()(),a.resolve()):a.resolve()},onVirtualScroll:function(b,c){return this.setItems(b,c),a.resolve()},onInitialNativeScroll:function(b,c){return this.setItems(0,b+c),a.resolve()},onGotoNextBlock:function(b,c){var d=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(b-d,c+d),a.resolve()},onGotoPreviousBlock:function(b,c){var d=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(b,c+d),a.resolve()}})}),function(a,b){"use strict";var c=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],d={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},e=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=function(a){return h(a,!0)},g=function(a){return h(a,!1)},h=function(a,c){c===b&&(c=!0);var d=k(a)?m(a):l(a);if(c)var f=1779033703,g=3144134277,h=1013904242,n=2773480762,o=1359893119,p=2600822924,q=528734635,r=1541459225;else var f=3238371032,g=914150663,h=812702999,n=4144912697,o=4290775857,p=1750603025,q=1694076839,r=3204075428;for(var s=0,t=d.length;s<t;s+=16){for(var u,v,w=[],x=0;x<16;++x)w[x]=d[s+x];for(var x=16;x<64;++x)u=i(w[x-15],7)^i(w[x-15],18)^w[x-15]>>>3,v=i(w[x-2],17)^i(w[x-2],19)^w[x-2]>>>10,w[x]=w[x-16]+u+w[x-7]+v;for(var y,z,A,B,C=f,D=g,E=h,F=n,G=o,H=p,I=q,J=r,x=0;x<64;++x)u=i(C,2)^i(C,13)^i(C,22),y=C&D^C&E^D&E,A=u+y,v=i(G,6)^i(G,11)^i(G,25),B=G&H^~G&I,z=J+v+B+e[x]+w[x]&4294967295,J=I,I=H,H=G,G=F+z,F=E,E=D,D=C,C=z+A;f+=C,g+=D,h+=E,n+=F,o+=G,p+=H,q+=I,r+=J}var K=j(f)+j(g)+j(h)+j(n)+j(o)+j(p)+j(q);return c&&(K+=j(r)),K},i=function(a,b){return a>>>b|a<<32-b},j=function(a){for(var b="",d=0;d<4;d++){var e=3-d<<3;b+=c[a>>e+4&15]+c[a>>e&15]}return b},k=function(a){for(var b=a.length;b--;)if(a.charCodeAt(b)>255)return!0;return!1},l=function(a){var b,c=a.length,d=(c+8>>6)+1,e=d<<4,f=[];for(b=0;b<e;++b)f[b]=0;for(b=0;b<c;++b)f[b>>2]|=a.charCodeAt(b)<<(3-b%4<<3);return f[b>>2]|=128<<(3-b%4<<3),f[e-1]=c<<3,f},m=function(a){for(var b=encodeURIComponent(a),c=[],e=0,f=0,g=b.length;e<g;++e){var h=b.charCodeAt(e);37==h?c[f>>2]|=(d[b.charAt(++e)]<<4|d[b.charAt(++e)])<<(3-f%4<<3):c[f>>2]|=h<<(3-f%4<<3),++f}var i=(f+8>>6)+1,j=i<<4,k=f>>2;c[k]|=128<<(3-f%4<<3);for(var e=k+1;e<j;++e)c[e]=0;return c[j-1]=f<<3,c};window.sha256=f,window.sha224=g}(this),define("sha256",function(){}),define("assets/datamodelviewer/utils/dmv-crypto-util",["sha256"],function(){function a(a){if(void 0===a)throw new Error("String is undefined.");if(0===a.length)throw new Error("String is empty.");var b=sha256(a);return b}var b={sha256:a};return b}),define("client.views/global-selections/directives/scroll/scroll",["qvangular","text!./scroll.ng.html","core.utils/class","objects.models/listbox","objects.utils/data-properties/listobject-util","core.utils/resize","core.utils/deferred","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/simple-list-data-api","jquery","util","general.utils/shapes/rect","assets/datamodelviewer/utils/dmv-crypto-util","client.utils/rtl/direction-service","client.views/selection-toolbar/selection-toolbar-service","general.scroll/scroll-area"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,b){for(;a.length>b;)a.pop()}var q=j.extend({init:function(){this.resetColumnIndex(),this._super.apply(this,arguments)},resetColumnIndex:function(){this.columnIndex=0},setList:function(a){this.list=a,this.scrollApi.setTotalRows(this.list.length),this.setItems(this.columnIndex,this.scrollApi.settings.blockSize),this.scrollApi.updateLoadingButtons()},onInitialNativeScroll:function(){return g.resolve()},onGotoNextBlock:function(){var a=this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this));return a},onGotoPreviousBlock:function(){var a=this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this));return a}}),r=i.extend({resetNativeScroll:function(){this.$scrollArea.scrollLeft(0)},alignToFirstRow:function(){var a=this.getFirstRow(),b=a.children(".qv-object-wrapper").attr("id"),c=260;return function(){var a,d=k(this.$scrollArea.find("#"+b));d.length>0&&(a=d.offset().left-c,this.$scrollArea.scrollLeft(a))}.bind(this)},alignToLastRow:function(){var a=this.getLastRow(),b=a.children(".qv-object-wrapper").attr("id"),c=250;return function(){var a,d=k(this.$scrollArea.find("#"+b));d.length>0&&(this.$scrollArea.scrollLeft(0),a=d.parent().position().left-this.getScrollAreaBoundingBox().width+d[0].getBoundingClientRect().width+c,this.$scrollArea.scrollLeft(a))}.bind(this)},getBoundingBox:function(){var a=this._super.apply(this,arguments);return new m(a.top,a.left,a.height,a.width)}}),s=c.extend({size:{width:0,height:0},itemSize:0,itemSpacing:0,$element:void 0,init:function(a,b,c){this.$scope=a,this.$timeout=b,this.selectionToolbarService=c,this.$scope.items=[],this.$scope.options={direction:o.direction}},initialize:function(a,b,c){this.setSize(b),this.setItemSize(c.itemSize),this.setItemSpacing(c.itemSpacing),this.setElement(a.find(".qv-gs-scroll-area")),this.setItems(),this.initialized=!0},updateVisible:function(){var a=this.offsetX-(this.$scope.scrollApi.loadPrevious?1:0),b=this.visibleItemsCount;this.$scope.items.forEach(function(c,d){var e=d>=a&&d<a+b;!c.visible&&e&&(c.options={isPopOver:!1,highlightTitle:!0,direction:o.direction}),e&&!c.model&&this.getModel(c).then(function(a,b){a.model=b}.bind(null,c)),c.visible=e},this)},getModel:function(a){var b,c=this.getInitProps(a.title);return a.qField?b=d.createTransientField(this.$scope.app,a.qField,c):a.qId&&(b=d.createTransientDimension(this.$scope.app,a.qId,c)),b},onScroll:function(){this.qvGlobalSelectionsCtrl.setIgnoreUpdates(!1),this.selectionToolbarService.confirm(),this.updateHighlights(),this.$timeout.cancel(this.scrollTimeout),this.scrollTimeout=this.$timeout(function(){this.updateVisible(),this.updateHighlights()}.bind(this),100)},onResize:function(a){this.setSize(a),this.updateVisible()},updateHighlights:function(){this.$scope.items.forEach(function(a){a.options.highlightQuery=this.$scope.filter},this)},setItems:function(){var a,b,c,d=this.$scope,e=this.totalItemsCount;for(d.items.length!==e&&p(d.items,e),a=0;a<e;a++)b=d.items[a]||{},c=d.scrollApi.items[a],c.enableBadge&&(b.enableBadge=c.enableBadge),b.model||(b.options={isPopOver:!1,highlightTitle:!0,direction:o.direction}),c.qField?(delete b.qId,b.model&&b.qField===c.qField||(b.visible&&(d.items[a]=l.extend(!0,{},b),b=d.items[a],delete b.$$hashKey,delete b.options.search),b.title=c.title,b.qField=c.qField,b.id=n.sha256(b.qField),delete b.model)):c.qId&&(delete b.qField,b.model&&b.qId===c.qId||(b.visible&&(d.items[a]=l.extend(!0,{},b),b=d.items[a],delete b.$$hashKey,delete b.options.search),b.title=c.title,b.qId=c.qId,b.id=n.sha256(b.qId),delete b.model)),d.items[a]||(d.items[a]=b);this.updateVisible()},getInitProps:function(a){var b={title:a,qListObjectDef:{qDef:{}}};return e.autoSortDimension(b.qListObjectDef),b},getWidthOf:function(a){return this.totalItemSize*a-this.itemSpacing},setItemSize:function(a){this.itemSize=a||220},setItemSpacing:function(a){this.itemSpacing=a||20},setSize:function(a){this.size=a},setElement:function(a){this.$element=a,this.$element.on("scroll",this.onScroll.bind(this))}});Object.defineProperties(s.prototype,{vPosX:{get:function(){return this.$element.scrollLeft()}},totalItemSize:{get:function(){return this.itemSize+this.itemSpacing}},visibleItemsCount:{get:function(){var a=Math.ceil(((this.vPosX+(this.previousBtnVisible?240:0))%this.totalItemSize+this.size.width)/this.totalItemSize);return Math.min(a,this.totalItemsCount+(this.previousBtnVisible?1:0))}},totalItemsCount:{get:function(){return(this.$scope.scrollApi.items||[]).length}},offsetX:{get:function(){return Math.floor(this.vPosX/this.totalItemSize)}},previousBtnVisible:{get:function(){return!!this.$scope.scrollApi.loadPrevious}}}),s.$inject=["$scope","$timeout","qvSelectionToolbarService"],a.directive("qvGlobalSelectSection",["$parse","$timeout",function(a,c){return{controller:s,require:["qvGlobalSelectSection","^qvGlobalSelections"],template:b,replace:!0,scope:{allItems:"=",filter:"=",app:"="},link:function(b,d,e,g){var i=g[0],j=g[1],k=a(e.qvGlobalSelectSection)(),l={},m=d.find(".qv-gs-scroll-area"),n=m.controller("qvScrollArea"),o=d.find(".qv-scroll-loader").controller("qvScrollLoader"),p={blockSize:24,minRowHeight:240,maxRowHeight:240,keepItemsCount:4,virtualScrollEnabled:!1},s=b.scrollApi=new h(c,p),t=new q(s),u=new r(d,m,".qv-gs-listbox",".qv-gs-listbox:first",".qv-gs-listbox:last"),v=null,w=function(){l.width=d.innerWidth(),l.height=d.innerHeight(),i.onResize(l)};i.qvGlobalSelectionsCtrl=j,s.initialize(u,t,n,o).then(function(){s.activate(),s.updateViewport(),b.$watch("filter",function(){t.resetColumnIndex(),s.resetNativeScroll()}),b.$watch("allItems",function(a){a&&(t.setList(a),v&&v(),v=b.$watch("scrollApi.items",function(){j.ignoreUpdates||(0===s.items.length&&b.allItems.length>0&&(s.resetNativeScroll(),t.resetColumnIndex(),t.setList(a)),i.initialized&&i.setItems())}))})}),c(function(){l.width=d.innerWidth(),l.height=d.innerHeight(),i.initialize(d,l,k)}),f.on("end",w),b.$on("$destroy",function(){f.off("end",w),s.destroy()}),j.addCallback(k.type,function(){i.$timeout(function(){i.setItems(),i.$timeout(function(){i.updateHighlights()})})})}}}])}),define("text!client.views/global-selections/directives/badge/badge.ng.html",[],function(){return'<div class="qv-gs-badge" ng-if="item.showBadge" q-title-translation="Tooltip.clearSelection" tid="globalSelections.badge" qva-activate="badgeClick(item)">\n\t<span class="lui-icon lui-icon--remove"></span>\n</div>\n'}),define("objects.backend-api/listbox-api",["./backend-api"],function(a){"use strict";var b;return b=a.extend("Listbox",{init:function(a){this._super(a,"/qListObjectDef"),this.cacheCube.setMethodName("GetListObjectData")},select:function(a,b,c){return this.model.rpc("SelectListObjectValues",null,[this.path,b,c])},selectAll:function(){return this.model.rpc("SelectListObjectAll",null,[this.path])},selectPossible:function(){return this.model.rpc("SelectListObjectPossible",null,[this.path])},selectAlternative:function(){return this.model.rpc("SelectListObjectAlternative",null,[this.path])},selectExcluded:function(){return this.model.rpc("SelectListObjectExcluded",null,[this.path])},search:function(a){return this.model.rpc("SearchListObjectFor","qSuccess",[this.path,a])},abortSearch:function(){return this.model.rpc("AbortListObjectSearch",null,[this.path])},confirmSearch:function(a){return this.model.rpc("AcceptListObjectSearch",null,[this.path,a])},updateCache:function(a){this.cacheCube.set(a.qListObject.qDataPages),this.cacheCube.setCubeSize(a.qListObject.qSize)},setInitialData:function(a){this.cacheCube.set(a.qListObject.qDataPages)},getData:function(a){return this.cacheCube.getData(a)},getDataPage:function(a){return this.getData([a]).then(function(a){return a[0]})},getSize:function(){return this.model.layout.qListObject.qSize},lock:function(){return this.model.rpc("Lock",null,[this.path])},unlock:function(){return this.model.rpc("Unlock",null,[this.path])},isLocked:function(){return!(!this.model.layout||!this.model.layout.qListObject)&&!!this.model.layout.qListObject.qDimensionInfo.qLocked},getDimensionInfos:function(){return this.model.layout&&this.model.layout.qListObject?[this.model.layout.qListObject.qDimensionInfo]:[]}})}),define("client.views/global-selections/directives/badge/badge",["qvangular","text!./badge.ng.html","objects.backend-api/listbox-api"],function(a,b,c){a.directive("qvGsBadge",function(){return{restrict:"E",template:b,replace:!0,link:function(b){b.item.enableBadge&&(b.item.object||(b.item.object={}),b.$watchCollection("[item.model.layout.qListObject.qDimensionInfo.qLocked, item.object.selectionsApi.active]",function(c){a.$apply(function(){b.item.showBadge=(void 0===c[0]||c[0]===!1)&&c[1]===!1})}),b.badgeClick=function(a){var b=new c(a.model);b.beginSelections(),b.clearSelections(),b.endSelections(!0)})}}})}),define("client.views/global-selections/global-selections",["jquery","qvangular","text!./global-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.utils/support","client.assets/assets-utils","core.utils/class","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","core.utils/deferred","core.models/app","core.utils/resize","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.utils/type-loader","client.views/selection-toolbar/selection-toolbar-service","client.views/global-selections/directives/scroll/scroll","client.views/global-selections/directives/badge/badge","client.views/global-selections/global-selections-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=".globalSelections",q=h.extend({init:function(b,c){var d=this;this.$scope=b,this.callbacks=[],this.ignoreUpdates=!1,this.hasLoaded=!1,b.dimensions=[],b.dimensionsFields=[],b.selectedFields=[],b.fields=[],b.dimAvailable=!1,b.showFields=c.getShowFields(l.current),b.showFieldsCheckbox=!0,b.filter="",b.autoFocus=f.treatAsDesktop(),b.selectionToolbarOpen=!1,k.all({fields:this.getFields(),select:this.bindCurrentSelections(),dim:this.getLibraryDimensions(),reg:this.registerExtensions()}).then(function(){d.hasLoaded=!0,b.showFieldsCheckbox=b.fields.length>0,b.dimAvailable=b.dimensions.length>0,!b.dimAvailable&&b.showFieldsCheckbox&&(b.showFields=!0,c.setShowFields(b.showFields,l.current)),b.$watch("filter",function(){d.filterShown(d,d.$scope)}),b.$watch("showFields",function(){c.setShowFields(b.showFields,l.current),d.filterShown(d,d.$scope)}),a(".qv-gs-section .qv-gs-header")[1].style.display="none",a(".qv-gs-section .qv-gs-header")[1].offsetHeight,a(".qv-gs-section .qv-gs-header")[1].style.display="block"})},registerExtensions:function(){var a=new k;return o.load().then(function(){a.resolve()}),a.promise},getFields:function(){var a=this.$scope,b=new k;return i.getListLayout(a.app,!0).then(function(c){a.fields=j.expand(c).map(function(a){return{title:a.qName,qField:a.qName,qTags:a.qTags}}),b.resolve()}),b.promise},_updateCurrentSelectionFields:function(a){var b=this,c=this.$scope;c.selectedFields=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}).map(function(a){return{title:a.qField,qField:a.qField,enableBadge:!0}}),b.hasLoaded&&b.filterShown(b,c)},handleCurrentSelectionFields:function(){var a=this;this.$scope.currentSelectionsModel.getLayout().then(function(b){a._updateCurrentSelectionFields(b)})},bindCurrentSelections:function(){var a=this.$scope,b=this;return d.get(b.$scope.app).then(function(c){return a.currentSelectionsModel=c,d.bindLayout(a,"currentSelectionsModel",function(a){l.current.isModal()||b._updateCurrentSelectionFields(a)})})},getLibraryDimensions:function(){var a=this.isCalculatedField,b=this.$scope,c=new k;return e.getList(b.app,!0).then(function(d){d.getLayout().then(function(d){b.dimensions=d.filter(function(b){return b.qData.info.length>0&&!b.qData.info.some(a)&&"H"!==b.qData.grouping}).map(function(a){return{title:a.qData.title,fieldName:a.qData.info[0].qName,qId:a.qInfo.qId}}),c.resolve()})}),c.promise},isCalculatedField:function(a){return"="===a.qName[0]},filterShown:function(a,c){var d="",e=[];c.dimensionsFields=c.dimensions.filter(function(a){return!c.selectedFields.some(function(b){return a.fieldName===b.qField})}),c.showFields&&(e=c.fields.filter(function(a){return!c.selectedFields.some(function(b){return b.qField===a.qField})}),e=n.removeMeasureAndDetailsFields(e),c.dimensionsFields=c.dimensionsFields.concat(e.filter(function(a){return!c.dimensions.some(function(b){return a.qField===b.fieldName})}))),c.filter.length>0&&(d=c.filter.toLowerCase(),e=c.dimensionsFields.filter(function(a){return a.title.toLowerCase().indexOf(d)!==-1}),c.dimensionsFields=e),g.localeOrderBy(c.dimensionsFields,function(a){return a.title}),b.$apply(c,function(){a.notifyCallbacks(a)})},addCallback:function(a,b){this.callbacks.push({type:a,fn:b})},notifyCallbacks:function(a){a.hasLoaded&&(a.ignoreUpdates||a.callbacks.forEach(function(a){"fields"!==a.type&&"dimensions"!==a.type||a.fn()}))},setIgnoreUpdates:function(a){this.ignoreUpdates=a}});return q.$inject=["$scope","qvGlobalSelectionsService"],b.directive("qvGlobalSelections",["$document","qvSelectionToolbarService","$timeout",function(b,d,e){return{restrict:"E",template:c,controller:q,require:["qvGlobalSelections"],scope:!0,replace:!0,link:function(c,f,g,h){c.toolbar=!!b.find(".qui-toolbar")[0];var i=h[0],j=function(){i.ignoreUpdates=!1},k=function(){c.selectionToolbarOpen=!1,e(function(){i.handleCurrentSelectionFields()})},l=function(){c.selectionToolbarOpen=!0};d.Closed.bind(k),d.Opened.bind(l),b.on("keyup"+p,function(a){27===a.which?i.ignoreUpdates=!1:13===a.which&&(i.ignoreUpdates=!1)}),Touche(b[0].body).tap({id:p,options:{preventDefault:!1},start:function(b){var c=a(b.target).closest(".qv-gs-badge").length>0,d=a(b.target).closest(".qv-gs-listbox").length>0,e=a(b.target).closest(".qv-selection-toolbar").length>0;i.ignoreUpdates=d&&!c&&!e}}),m.on("start",j),c.$on("$destroy",function(){i.callbacks=[],d.Closed.unbind(k),d.Opened.unbind(l),Touche(b[0].body).off("*",p),b.off(p),m.off("start",j)}),c.onEnter=function(a){a.stopPropagation(),a.target.blur()}}}}]),"<qv-global-selections></qv-global-selections>"}),define("text!client.views/mobile-selections/mobile-selections.ng.html",[],function(){return'<div class="qv-mobile-selections" tid="{{\'mobileSelections.showFields.\' + filter.showFields}}">\n\t<div class="qv-ms-toolbar">\n\t\t<p qva-activate="selectionsBack()" ng-class="{\'qv-ms-button-disabled\' : disable.back, \'qv-ms-button-enabled\': !disable.back}" class="qv-ms-toolbar-buttons" tid="mobileSelections.back" q-title-translation="Tooltip.NavigateBack"><</p>\n\t\t<p qva-activate="selectionsForward()" ng-class="{\'qv-ms-button-disabled\' : disable.forward, \'qv-ms-button-enabled\': !disable.forward}" class="qv-ms-toolbar-buttons" tid="mobileSelections.forward" q-title-translation="Tooltip.NavigateForward">=</p>\n\t\t<p qva-activate="selectionsClear()" ng-class="{\'qv-ms-button-disabled\' : disable.clear, \'qv-ms-button-enabled\': !disable.clear}" class="qv-ms-toolbar-buttons" tid="mobileSelections.clear" q-title-translation="Tooltip.ClearSelections">:</p>\n\t\t<p qva-activate="toggleMenu()" ng-class="{\'qv-ms-button-disabled\' : !enableMenu, \'qv-ms-button-enabled\': enableMenu, \'qv-ms-button-menu-active\': menuActive }" class="qv-ms-toolbar-buttons" id="mobileSelectionsMenu" tid="mobileSelections.showMenu" qva-outside-ignore-for="allOutside" q-title-translation="Toolbar.Menu"></p>\n\n\t\t<qui-toolbarbutton qva-activate="close($event)" name="close" class="qv-ms-toolbar-close" tid="mobileSelections.close">\n\t\t\t<span q-translation="Common.Close" class="qv-ms-toolbar-close-text"></span>\n\t\t</qui-toolbarbutton>\n\t</div>\n\t<header class="qv-ms-header">\n\t\t<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\n\t</header>\n\t<lui-search x-variant="inverse" class="qv-ms-searchbox" placeholder="{{filter.showFields ? \'GlobalSelections.FilterDimensionsAndFields\' : \'GlobalSelections.FilterDimensions\'}}" query="filter.filter" maxlength="255"\n\t\ton-enter="filter.onEnter($event)" tid="mobileSelections.searchfield">\n\t</lui-search>\n\t<div class="qv-ms-scroll-area">\n\t\t<qv-ms-selected ng-repeat="item in selectedFields"></qv-ms-selected>\n\t\t<div class="qv-ms-selectable" ng-if="filter.filter.length && (!selectables || selectables.length === 0)">\n\t\t\t<span q-translation="GlobalSelections.NoMatchesForSearch"></span>\n\t\t</div>\n\t\t<qv-ms-selectable ng-repeat="item in selectables"></qv-ms-selectable>\n\t</div>\n</div>\n'}),define("text!client.views/mobile-selections/menu/mobile-selections-menu.ng.html",[],function(){return'<immidiate-contextual align-to=" \'#mobileSelectionsMenu\' " position="\'bottom\'" on-close-view="closeView()" qva-outside-ignore-for="mobileSelectionsMenu" smallview="true">\n\t<ul class="qui-icontextlist toolbar-menu">\n\t\t<li qva-activate="toggleFields($event)" data-icon="{{fieldsIcon}}">\n\t\t\t<span class="qui-textlist-text" q-translation="{{fieldsLabel}}"></span>\n\t\t</li>\n\t</ul>\n</immidiate-contextual>\n'}),define("client.views/mobile-selections/menu/mobile-selections-menu",["text!./mobile-selections-menu.ng.html","core.models/app","client.views/global-selections/global-selections-service"],function(a,b){"use strict";var c={scope:{menuItem:"=",closeMenu:"="},template:a,controller:["$scope","qvGlobalSelectionsService",function(a,c){a.fieldsLabel=a.menuItem.model.showFields?"GlobalSelections.HideFields":"GlobalSelections.ShowFields",a.fieldsIcon=a.menuItem.model.showFields?"remove":"add",a.toggleFields=function(d){d.preventDefault(),a.menuItem.model.showFields=!a.menuItem.model.showFields,c.setShowFields(a.menuItem.model.showFields,b.current),a.closeMenu()},a.closeView=function(){a.closeMenu()}}]};return c}),define("general.utils/qv-keyboard-shortcuts",["jquery","general.utils/dom-util"],function(a,b){"use strict";function c(){this.groups=[],this.shortcuts=[],this.timer={id:null},this.isReleased=!0,this.currentEvent=void 0}var d,e={a:65,alt:18,b:66,backspace:8,c:67,ctrl:17,d:68,del:46,down:40,e:69,f:70,enter:13,esc:27,g:71,h:72,home:36,i:73,j:74,k:75,l:76,left:37,m:77,n:78,o:79,p:80,q:81,r:82,right:39,s:83,shift:16,space:32,t:84,tab:9,u:85,up:38,v:86,w:87,win:224,x:88,y:89,z:90,cmd:91,"*":106},f="qvKeyboardShortcuts",g=!1;return c.prototype.createGroup=function(a,b){var c,d,e=this;for(d=0;d<this.groups.length;d++)if(this.groups[d].name===a){c=this.groups[d];break}if(c)throw"Keyboard shortcut group already exist: "+a;return c={name:a,priority:b,active:!1,shortcuts:[]},this.groups.push(c),this.groups.sort(function(a,b){return a.priority-b.priority}),{registerKeys:function(a,b,d){e.registerKeys(c,a,b,d)},unregisterKeys:function(a,b){for(var d=c.shortcuts,e=0;e<d.length;e++)if(d[e].keyCombo===a&&d[e].callback===b){d.splice(e,1);break}},on:function(){e.activateGroup(c)},off:function(){e.deactivateGroup(c)},delete:function(){e.deactivateGroup(c),e.deleteGroup(c)}}},c.prototype.activateGroup=function(b){var c=this;b.active=!0,g||(g=!0,a(document).on("keydown."+f,function(a){c.handleEvent(a)}))},c.prototype.deactivateGroup=function(b){var c;b.active=!1,c=this.groups.reduce(function(a,b){return b.active&&a++,a},0),0===c&&g&&(g=!1,a(document).off("keydown."+f))},c.prototype.deleteGroup=function(a){this.groups=this.groups.filter(function(b){return b!==a})},c.prototype.registerKeys=function(a,b,c,d){var f=b.toLowerCase().split("+"),g={keyCombo:b,ctrlKey:!1,shiftKey:!1,keyCode:null,name:"",callback:null,allowInAllContexts:!!(d&&"allowInInput"in d)&&d.allowInInput,preventDefault:!(d&&"preventDefault"in d)||d.preventDefault,delay:d&&"delay"in d?d.delay:250};for(var h in e)for(var i=0;i<f.length;i++)g.name=b.toLowerCase(),g.callback=c,"ctrl"!==f[i]&&"cmd"!==f[i]||(g.ctrlKey=!0),"shift"===f[i]&&(g.shiftKey=!0),f[i]===h&&17!==e[h]&&16!==e[h]&&91!==e[h]&&(g.keyCode=e[h]);a.shortcuts.push(g)},c.prototype.preventDefault=function(){this.currentEvent&&this.currentEvent.preventDefault()},c.prototype.handleEvent=function(a){function c(b,c,f){for(var g,i,j=0;j<h.groups.length;j++)if(g=h.groups[j],g.active)for(var k=g.shortcuts.length-1;k>=0&&(i=g.shortcuts[k],i.keyCode!==e["*"]&&(i.keyCode!==f||i.ctrlKey!==b||i.shiftKey!==c)||d(a,i));k--);}function d(a,c){var d=b.isInput(document.activeElement);return!(d&&!c.allowInAllContexts)&&f(a,c)}function f(a,b){if(b.preventDefault&&a.preventDefault(),"number"!=typeof h.timer.id&&(b.delay>0&&(h.timer.id=setTimeout(function(){g()},b.delay)),b.callback(b,a)===!0))return g(),!0}function g(){clearTimeout(h.timer.id),delete h.timer.id}var h=this;this.currentEvent=a,a.shiftKey?!a.ctrlKey&&!a.metaKey||a.altKey||c(!0,!0,a.which):!a.ctrlKey&&!a.metaKey||a.altKey?c(!1,!1,a.which):c(!0,!1,a.which)},d=new c}),define("text!client.views/mobile-selections/directives/selectable/selectable.ng.html",[],function(){return'<div qva-activate="showSelectable()" ng-class="{\'qv-ms-touch-flash\' : item.flash}" class="qv-ms-selectable" tid="mobileSelections.selectable">\n\t<span ng-if="item.isField" class="lui-icon  lui-icon--field"></span>\n\t<div class="qv-ms-highlight">\n\t\t<span qve-highlight text="{{item.title}}" query="filter.filter"></span>\n\t</div>\n</div>\n'});define("client.views/mobile-selections/directives/selectable/selectable",["qvangular","text!./selectable.ng.html"],function(a,b){a.directive("qvMsSelectable",["$timeout",function(a){return{restrict:"E",replace:!0,template:b,link:function(b){b.showSelectable=function(){b.item.flash=!0,a(function(){b.$emit("showListbox",b.item),b.item.flash=!1},20)}}}}])});define("text!client.views/mobile-selections/directives/selected/selected.ng.html",[],function(){return'<div class="qv-ms-selected" tid="mobileSelections.selected">\n\t<div class="qv-ms-selected-icon">\n\t\t<a ng-show="!item.qLocked" qva-activate="clear(item.qField)">\n\t\t\t<i class="lui-icon  lui-icon--remove"></i>\n\t\t</a>\n\t\t<a ng-show="item.qLocked" qva-activate="showSelected(item.qField)">\n\t\t\t<i class="lui-icon lui-icon--lock"></i>\n\t\t</a>\n\t</div>\n\t<div qva-activate="showSelected(item.qField)" class="qv-ms-selected-info">\n\t\t<h1 class="qv-object-title">{{item.qField}}</h1>\n\t\t<span>{{item.translation}}</span>\n\t\t<qv-state-count-bar state-counts="item.qStateCounts"></qv-state-count-bar>\n\t</div>\n</div>\n'}),define("client.views/mobile-selections/directives/selected/selected",["qvangular","text!./selected.ng.html"],function(a,b){a.directive("qvMsSelected",function(){return{restrict:"E",replace:!0,template:b,link:function(a){a.showSelected=function(){a.$emit("showListbox",a.item)},a.clear=function(b){a.currentSelectionsModel.clearField(b)}}}})}),define("client.views/current-selections/current-selections-service",["qvangular","translator"],function(a,b){a.service("qvCurrentSelectionsService",[function(){return{translate:function(a){var c,d=a.qStateCounts.qSelected+a.qStateCounts.qSelectedExcluded+a.qStateCounts.qLocked+a.qStateCounts.qLockedExcluded,e=a.qTotal;return c=e===d&&e>1?b.get("CurrentSelections.All"):d>1&&e>1?b.get("CurrentSelections.Of",[d,e]):a.qSelectedFieldSelectionInfo.map(function(a){return a.qName}).join(", ").toString()}}}])}),define("client.views/mobile-selections/mobile-selections",["qvangular","text!./mobile-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.models/field","client.assets/assets-utils","core.utils/deferred","core.models/app","objects.models/listbox","general.services/show-service/show-service","client.views/mobile-selections/menu/mobile-selections-menu","client.assets/tab-contents/fields/assets-directdiscovery-service","general.utils/qv-keyboard-shortcuts","client.views/global-selections/global-selections-service","client.views/mobile-selections/directives/selectable/selectable","client.views/mobile-selections/directives/selected/selected","objects/listbox-popover/listbox-popover-service","client.views/current-selections/current-selections-service","objects.views/charts/tooltip/chart-tooltip-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b,c){var d="",e=[];b.selectables=c.dimensions.filter(function(a){return!b.selectedFields.some(function(b){return a.qField===b.qField})}),b.filter.showFields===!0&&(e=c.fields.filter(function(a){return!b.selectedFields.some(function(b){return b.qField===a.qField})}),e=l.removeMeasureAndDetailsFields(e),b.selectables=b.selectables.concat(e.filter(function(a){return!c.dimensions.some(function(b){return a.qField===b.qField})}))),b.filter.filter.length>0&&(d=b.filter.filter.toLowerCase(),e=b.selectables.filter(function(a){return a.title.toLowerCase().indexOf(d)!==-1}),b.selectables=e),f.localeOrderBy(b.selectables,function(a){return a.title}),a.$apply(b)}function o(b,d){var e=new g,f=a.getService("qvCurrentSelectionsService");return c.get().then(function(a){b.currentSelectionsModel=a,c.bindLayout(b,"currentSelectionsModel",function(a){b.disable={clear:0===a.qSelectionObject.qSelections.length||a.qSelectionObject.qSelections.every(function(a){return a.qLocked}),back:0===a.qSelectionObject.qBackCount,forward:0===a.qSelectionObject.qForwardCount},b.selectedFields=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}),b.selectedFields.forEach(function(a){a.translation=f.translate(a)}),d.hasLoaded&&n(b,d)}),e.resolve()}),e.promise}function p(a){var b=function(a){return"="===a.qName[0]},c=new g;return d.getList().then(function(d){d.getLayout().then(function(d){a.dimensions=d.filter(function(a){return a.qData.info.length>0&&!a.qData.info.some(b)&&"H"!==a.qData.grouping}).map(function(a){return{title:a.qData.title,qField:a.qData.info[0].qName,qId:a.qInfo.qId}}),c.resolve()})}),c.promise}function q(a){var b=new g;return e.getListLayout().then(function(c){a.fields=c.map(function(a){return{title:a.qName,qField:a.qName,qTags:a.qTags,isField:!0}}),b.resolve()}),b.promise}var r=["$scope","qvGlobalSelectionsService",function(b,c){var d={hasLoaded:!1,dimensions:[],fields:[]};b.selectedFields=[],b.filter={filter:"",showFields:c.getShowFields(h.current),onEnter:function(a){a.stopPropagation(),a.target.blur()}},b.selectables=[],b.enableMenu=!0,b.disable={clear:!1,back:!1,forward:!1},a.getService("qvChartTooltipService").close(),g.all({selectionsDfd:o(b,d),dimensionsDfd:p(d),fieldsDfd:q(d)}).then(function(){d.hasLoaded=!0,b.enableMenu=d.fields.length>0,d.dimensions.length<=0&&b.enableMenu&&(b.filter.showFields=!0,c.setShowFields(b.filter.showFields,h.current)),b.$watch("filter",function(){n(b,d)},!0)})}];return a.directive("qvMobileSelections",["qvGlobalSelectionsService","qvListboxPopoverService",function(a,d){return{restrict:"E",template:b,controller:r,replace:!0,require:["qvMobileSelections"],scope:{},link:function(b,e){var f,l=null,n=function(){l.destroy(),l=null,b.menuActive=!1},o=function(){e.find(".qv-ms-scroll-area").animate({scrollTop:0})},p=m.createGroup("mobile-selections",0);p.registerKeys("enter",function(){}),p.on(),document.activeElement&&document.activeElement.blur(),
b.close=function(b){b.preventDefault(),a.off("select")},b.selectionsBack=function(){b.disable.back||b.currentSelectionsModel.back()},b.selectionsForward=function(){b.disable.forward||b.currentSelectionsModel.forward()},b.selectionsClear=function(){b.disable.clear||b.currentSelectionsModel.clearAll()},b.toggleMenu=function(){l?n():b.enableMenu&&(b.menuActive=!0,l=j.show(k,{menuItem:{model:b.filter},closeMenu:n}))},b.$on("showListbox",function(a,j){var k={title:j.title,qListObjectDef:{qDef:{}}},l=b.selectedFields.indexOf(j)!==-1,m=function(){c.getLayout().then(function(a){var b;return!l&&(b=a.qSelectionObject.qSelections.some(function(a){return j.qField===a.qField}))?void f.resolve():void f.reject()})},n=function(a){f&&f.reject(),f=new g,f.promise.then(o),e.children(".qv-ms-searchbox").find("input").blur(),d.show(a,{showLock:!0},m)};j.qField?i.createTransientField(h.current,j.qField,k).then(n):i.createTransientDimension(h.current,j.qId,k).then(n)}),b.$on("$destroy",function(){l&&(l.destroy(),l=null),f&&f.reject(),p.delete()})}}}]),"<qv-mobile-selections></qv-mobile-selections>"}),define("client.views/global-selections/global-selections-service",["jquery","qvangular","client.views/global-selections/global-selections","client.views/mobile-selections/mobile-selections","client.utils/state","general.utils/responsive-state","core.models/app"],function(a,b,c,d,e,f,g){b.service("qvGlobalSelectionsService",["$document",function(b){function h(a){return{$container:void 0,$app:a,getComponent:function(){return f.isSmallDevice?d:c},setup:function(){f.ViewChanged.bind(i)},destroy:function(){f.ViewChanged.unbind(i)}}}function i(){k(o.select[g.current.id]),j(o.select[g.current.id])}function j(a){a.$container=angular.element("<div>"),b.find("body").append(a.$container),a.$container.showComponent(a.getComponent(),["$scope",function(b){b.app=a.$app}]),a.setup()}function k(a){a.$container&&(a.$container.remove(),a.$container=void 0),a.destroy()}function l(a){return!(!a||!a.$container)}function m(b){b&&l(b)?(k(b),a("body").removeClass("qv-global-selections-enabled")):(e.setState(e.States.analysis),a("body").addClass("qv-global-selections-enabled"),j(b))}var n,o={select:{}},p=null,q={},r={},s={};return n={toggleGlobalSelection:function(a){a=a||g.current,o.select[a.id]||(o.select[a.id]=new h(a)),m(o.select[a.id])},off:function(a){var b=o[a];for(var c in b)k(b[c])},isSelectActive:function(a){return a=a||g.current,!(void 0===a||!o.select[a.id]||void 0===o.select[a.id].$container)},setCsShowCallback:function(a){p=a},setCsShow:function(a){p&&p(a)},setSelectionCount:function(a,b){b=b||g.current,q[b.id]=a},getSelectionCount:function(a){return a=a||g.current,q[a.id]},setSelectionLockedCount:function(a,b){b=b||g.current,r[b.id]=a},getSelectionLockedCount:function(a){return a=a||g.current,r[a.id]},setShowFields:function(a,b){b=b||g.current,s[b.id]=a},getShowFields:function(a){return a=a||g.current,!!s[a.id]}}}])}),define("text!client.views/global-search/global-search.ng.html",[],function(){return'<div>\n    <div class="qv-global-search" ng-class="{ overlay:displaySuggestions || displayResult.data || displayResult.visuals }" ng-style="{paddingTop: toolbarHeight}" tid="globalSearch">\n        <qv-global-search-input class="qv-global-search-input"></qv-global-search-input>\n         <qv-global-search-history ng-if="isSearchHistoryFeature && searchInputFocused && query.length === 0"></qv-global-search-history>\n    \t<div class="qv-global-search-dimmer" ng-if="query.length > 0" ng-style="dimmerStyles">\n    \t\t<qv-global-search-result tid="globalSearch.ResultList"></qv-global-search-result>\n    \t\t<div ng-show="scrollShow" class="scroll-affordance scroll-vertical"></div>\n    \t</div>\n    </div>\n    <div class="qv-global-search-glass" ng-if="query.length === 0" qva-activate="close();"></div>\n\n</div>\n'}),define("client.views/global-search/global-search-keyboard-shortcuts",["qvangular","general.utils/qv-keyboard-shortcuts"],function(a,b){function c(c,d,e){function f(){var a=d.stateFocus;"input"===a?a=d.displaySuggestions?"suggestions":d.searchInputFocused&&0===d.query.length?"history":d.isPartials()?"partials":d.displayResult.data?"results":"start-new-search":"suggestions"===a?a=d.isPartials()?"partials":d.displayResult.data?"results":"start-new-search":"partials"===a&&d.forcePartials&&(a="results"),d.stateFocus=a}function g(){var a=d.stateFocus;"results"===a&&0===d.activeSelectIx?a=d.isPartials()?"partials":d.displaySuggestions?"suggestions":"input":"partials"===a||"start-new-search"===a?a=d.displaySuggestions?"suggestions":"input":("suggestions"===a||"history"===a&&0===d.activeHistoryIx)&&(a="input"),d.stateFocus=a}function h(){return"INPUT"===v[0].activeElement.tagName}function i(){b.preventDefault(),a.$rootScope.$apply()}function j(a){var b,c,d;return document.selection&&document.selection.createRange?(b=document.selection.createRange(),c=b.getBookmark(),d=c.charCodeAt(2)-2):a.setSelectionRange&&(d=a.selectionStart),d===a.value.length}function k(){h()?"suggestions"===d.stateFocus?e.hideSuggestions():d.query?d.query="":d.close():d.close(),i()}function l(){"suggestions"===d.stateFocus&&(d.activeSuggestionIx=d.activeSuggestionIx>0?d.activeSuggestionIx-1:d.suggestions.length-1,i())}function m(){"suggestions"===d.stateFocus&&(d.activeSuggestionIx=(d.activeSuggestionIx+1)%d.suggestions.length,i())}function n(){switch(g(),d.stateFocus){case"history":d.activeHistoryIx=Math.max(-1,d.activeHistoryIx-1);break;case"results":e.moveActiveResult(-1)}i()}function o(){switch(f(),d.stateFocus){case"history":d.activeHistoryIx=Math.min(d.activeHistoryIx+1,d.searchHistory.length-1);break;case"results":e.moveActiveResult(1)}i()}function p(a){switch(d.stateFocus){case"history":e.setQueryFromHistory(d.activeHistoryIx);break;case"input":d.isPartials()?e.setShowPartialMatches():d.displaySuggestions?q(a,!0):d.displayResult.data?e.select(d.searchTerms,0):e.startNewSearchFor();break;case"suggestions":q(a,!0);break;case"partials":e.setShowPartialMatches();break;case"results":d.showMeMoreFocus?e.loadNextPage():e.select(d.searchTerms,d.activeSelectIx);break;case"start-new-search":e.startNewSearchFor()}i()}function q(a,b){(b||j(u))&&(d.activeSuggestionIx=d.activeSuggestionIx===-1?0:d.activeSuggestionIx,d.onSuggestSelect()),i()}function r(){e.closeSearch(),i()}var s,t,u=c.find("input")[0],v=a.getService("$document");d.stateFocus="input",d.$watch("stateFocus",function(a){d.activeSelectIx="results"===a?0:-1,d.activeHistoryIx="history"===a?0:-1,d.activeSuggestionIx="suggestions"===a?0:-1}),s={preventDefault:!1,allowInInput:!0,delay:0},t={preventDefault:!1,allowInInput:!0,delay:75},this.keyboardShortcutsGroup=b.createGroup("global-search-"+d.app.id,1),this.keyboardShortcutsGroup.registerKeys("esc",k,s),this.keyboardShortcutsGroup.registerKeys("left",l,t),this.keyboardShortcutsGroup.registerKeys("right",m,t),this.keyboardShortcutsGroup.registerKeys("up",n,t),this.keyboardShortcutsGroup.registerKeys("down",o,t),this.keyboardShortcutsGroup.registerKeys("enter",p,s),this.keyboardShortcutsGroup.registerKeys("tab",q,s),this.keyboardShortcutsGroup.registerKeys("ctrl+f",r,s),this.keyboardShortcutsGroup.on()}return c.prototype.on=function(){this.keyboardShortcutsGroup.on()},c.prototype.off=function(){this.keyboardShortcutsGroup.off()},c.prototype.delete=function(){this.keyboardShortcutsGroup.delete()},c}),define("text!client.views/global-search/directives/input/input.ng.html",[],function(){return'<div class="qv-search-input" ng-class="{\'focus\': isInputFocused}">\n\t<div class="search-field-area">\n\t\t<lui-search class="search-field" query="query" auto-focus="autoFocus" autocomplete="\'off\'" is-focused="isInputFocused" tid="globalSearch.searchField" placeholder="{{placeholder}}" />\n\t</div>\n\t<div class="search-underlines">\n\t\t<span ng-repeat="underline in underlines" class="underline" ng-class="underline.isWhitespace ? \'term-space\' : \'term\' + underline.colorIx">{{underline.string}}</span><qv-global-search-input-hint></qv-global-search-input-hint>\n\t</div>\n</div>\n'}),define("text!client.views/global-search/directives/input/input-hint.ng.html",[],function(){return'<span ng-show="displaySuggestions" class="search-suggest" tid="globalSearch.suggestionString">{{hintString}}</span>\n'}),define("client.views/global-search/global-search-data-service",["qvangular"],function(a){function b(a,b,d,h){var i;0!==b.length&&(a[d]||(a[d]={}),i=a[d],i.string=b,i.isWhitespace=h||b.length<g&&!c(b)||'"'===b,i.colorIx=i.isWhitespace?-1:e,e=i.isWhitespace?e:(e+1)%f)}function c(a){return a.match(/[\u3040-\u9FBF]/)||a.match(/[\uFF65-\uFF9F]/)}function d(a,b,d,e){b.length<g&&!c(b)||a.push({string:b,startQuote:d,endQuote:e})}var e=0,f=6,g=1,h=!1;a.service("qvGlobalSearchDataService",function(){this.transformResult=function(a,b){var c=b.qResult;a.matches=a.matches||[],this.setGlobalSearchActive(!0),a.searchTermGroups=a.searchTermGroups||[],a.searchVisualsGroups=a.searchVisualsGroups||[];for(var d=0;d<c.qSearchGroupArray.length;++d)if("DatasetType"===c.qSearchGroupArray[d].qGroupType){a.searchTermGroups.push(c.qSearchGroupArray[d]);var e=c.qSearchGroupArray[d];a.matches.indexOf(e.qSearchTermsMatched.length)===-1&&a.matches.push(e.qSearchTermsMatched.length)}else a.searchVisualsGroups.push(c.qSearchGroupArray[d]);a.displayResult.data=a.searchTermGroups.length>0,a.displayResult.visuals=a.searchVisualsGroups.length>0},this.showMore=function(a,b){if(b&&a.qResult&&1===a.qResult.qSearchGroupArray.length){for(var c,d=a.qResult.qSearchGroupArray[0],e=0;e<d.qItems.length;e++)if(d.qItems[e].qIdentifier===b.qIdentifier){c=d.qItems[e].qItemMatches;break}c&&(b.qItemMatches=c)}},this.setHeaders=function(a){var b,c=0;for(b=0;b<a.searchTermGroups.length;b++)a.searchTermGroups[b].qTotalNumberOfItems>c&&(c=a.searchTermGroups[b].qTotalNumberOfItems);for(a.columnCount=c,a.columnWidth=Math.floor(100/c)+"%",a.shadowHeaders=a.shadowHeaders||[],a.shadowHeaders.splice(0,a.shadowHeaders.length-c),b=a.shadowHeaders.length;b<c;b++)a.shadowHeaders[b]={}},this.transformSuggest=function(a,b,c){var d,e,f=0,g=[];for(this.getUnderlinersAndSearchTerms(a.query,g,[]),c=void 0!==c?c:25,c=Math.min(c,b.qResult.qSuggestions.length),d=0;d<c;++d)e={value:b.qResult.qSuggestions[d].qValue,term:b.qResult.qSuggestions[d].qTerm},a.query!==this.getResultingQueryFromSuggestion(g,e)&&(a.suggestions[f]=e,f++);a.suggestions.splice(f,a.suggestions.length-f)},this._whitespaces=[" ","\t","\n","\r","\r\n",""],this.isWhiteSpaceAt=function(a,b){var c,d=this._whitespaces,e=a.charAt(b);for(c=0;c<d.length;++c)if(e===d[c])return!0;return!1},this.getUnderlinersAndSearchTerms=function(a,c,f){function g(a,b){var c,d,e;for(d=0;d<o.length;++d)c=a.indexOf(o[d],b),c>=0&&(!e||c<e)&&(e=c);return e||-1}function h(a,b){var c;do c=a.indexOf('"',b),b=c+1;while(c>=0&&b<m&&!p.isWhiteSpaceAt(a,b));return c}function i(){for(;l<m&&p.isWhiteSpaceAt(a,l);)l++;l>k&&b(c,a.substring(k,l),n++,!0),k=l}var j,k=0,l=0,m=a.length,n=0,o=this._whitespaces,p=this;for(f.length=0,e=0,i();k<m;)if('"'!==a.charAt(k)){if(l=g(a,k),j=l>=0?a.substring(k,l):a.substring(k),b(c,j,n++),d(f,j,!1,!1),l<0)break;k=l,i()}else{if(b(c,a.substring(k,k+1),n++),l=h(a,++k),j=l>=0?a.substring(k,l):a.substring(k),b(c,j,n++),d(f,j,!0,l>0),l<0)break;b(c,a.substring(l,l+1),n++),k=l+=1,i()}c.splice(n,c.length-n)},this.getSuggestTerms=function(a,b){function c(a){var b,c,d;if(a=a.trim(),0===a.length)return null;for(b=a.length,c=b-1,d=-1;c>-1;){if(f.isWhiteSpaceAt(a,c)){d=c+1;break}c--}return d=Math.max(d,0),a.substring(d,b)}var d,e,f=this;return e=c(a),d=b.map(function(a){return a.string}),e&&2===e.length&&'"'===e.charAt(0)&&d.push(e.charAt(1)),d},this.getUnderlineLengthFromTermIx=function(a,b){for(var c,d=0,e=0;d<a.length&&(c=a[d],e<b||c.isWhitespace)&&(d!==a.length-1||1!==c.string.length||this.isWhiteSpaceAt(c.string,0)||'"'===c.string);)c.isWhitespace||e++,d++;return d>0?d:0},this.getResultingQueryFromSuggestion=function(a,b){var c,d,e,f,g=this.getUnderlineLengthFromTermIx(a,b.term);return c=a.slice(0,g).reduce(function(a,b){return a+b.string},""),d='"'===c.charAt(c.length-1),e=!d&&b.value.indexOf(" ")>=0,f=e||d,c+(e?'"':"")+b.value+(f?'"':"")},this.getMinQueryLength=function(){return g},this.setGlobalSearchActive=function(a){h=a},this.isGlobalSearchActive=function(){return h},this.getMaxColorsNum=function(){return f}})}),define("client.views/global-search/directives/input/input",["jquery","qvangular","translator","util","text!./input.ng.html","text!./input-hint.ng.html","general.utils/string-normalization","touche","general.utils/support","client.views/global-search/global-search-data-service"],function(a,b,c,d,e,f,g,h,i){function j(a,b){var c;if(a.length!==b.length)return!1;for(c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}var k=null;b.directive("qvGlobalSearchInput",["$timeout","qvGlobalSearchDataService",function(f,g){return{restrict:"E",replace:!0,template:e,require:"^qvGlobalSearch",link:function(e,l,m,n){function o(b){if(e.isInputFocused){if(1===a(b.target).closest(".qv-global-search-suggest").length||1===a(b.target).closest(".qv-search-last-history").length)return;b.preventDefault(),b.stopPropagation(),h.preventGestures(this.gestureHandler),e.$apply(function(){n.hideSuggestions(),n.hideSoftKeyboard()})}}var p=l.find("input"),q=[],r=b.getService("$document");p.on("keydown",function(){e.ignoreQueryChange=!1}),e.$watch("isSelectActiveInSmallDevice",function(a){e.autoFocus=!d.isIos()&&!d.isAndroid()&&!a}),e.placeholder=c.get("GlobalSearch.SearchData"),e.isObjectsFeature&&!i.treatAsDesktop()&&l.on("qv-outside",o),e.$watch("query",function(a){var b,c,d=[];return f.cancel(k),n.showHistory(e.isSearchHistoryFeature&&e.isInputFocused&&0===e.query.length),e.ignoreQueryChange||n.resetSuggestions(),a&&0!==a.length?(g.getUnderlinersAndSearchTerms(a,e.underlines,d),e.ignoreQueryChange?void(e.ignoreQueryChange=!1):void(k=f(function(){g.isWhiteSpaceAt(a,a.length-1)||'"'===a.charAt(a.length-1)?n.hideSuggestions():(c=g.getSuggestTerms(a,d),n.suggest(c)),b=d.map(function(a){return a.string}),d.length>0&&!j(b,q)?(n.searchVisuals(b),n.search(b)):a.length<g.getMinQueryLength()&&n.emptyResult(),q=b,k=null},200))):(n.emptyResult(),e.underlines.length=0,void(q=[]))}),e.$watch("isInputFocused",function(a){e.isSmallDevice&&(a?r.find("body").animate({scrollTop:l.offset().top},100):e.isObjectsFeature&&n.hideSuggestions()),e.isSearchHistoryFeature&&a&&0===e.query.length&&n.showHistory(!0)}),e.$on("focusInput",function(){p.focus()}),e.$on("blurInput",function(){p.blur()}),e.$on("$destroy",function(){p.off()})}}}]),b.directive("qvGlobalSearchInputHint",["qvGlobalSearchDataService",function(a){return{restrict:"E",replace:!0,template:f,require:"^qvGlobalSearch",link:function(b){function c(){var c,d,e,f,h,i=b.suggestions[b.activeSuggestionIx===-1?0:b.activeSuggestionIx],j=[],k=[];a.getUnderlinersAndSearchTerms(b.query,j,k),c=a.getSuggestTerms(b.query,k),!b.displaySuggestions||b.suggestions.length<=0||0===c.length||(d=a.getUnderlineLengthFromTermIx(j,i.term),f=j.slice(d).reduce(function(a,b){return a+(b.isWhitespace?" ":b.string)},""),e=g.string(f).length,f=g.string(i.value).slice(0,e),h=g.string(i.value).slice(e),b.ignoreQueryChange=!0,b.hintString=h)}b.$watch("activeSuggestionIx",function(){c()}),b.$watchCollection("suggestions",function(){c()}),b.$watch("displaySuggestions",function(){c()})}}}])}),define("text!client.views/global-search/directives/result/result.ng.html",[],function(){return'<div class="qv-global-search-result" ng-class="classes" qv-smartsearch-swipe-results >\n\t<qv-global-search-suggest ng-if="displaySuggestions" class="qv-global-search-suggest" qv-scroll-to-active="{{activeSelectIx === -1 && stateFocus === \'suggestions\'}}" ></qv-global-search-suggest>\t\n\n\t<h3 class="title-section title-navigation" ng-if="displayResult.visuals && !isSmallDeviceLandscape">\n\t\t<span q-translation="GlobalSearch.Navigations"></span>\n\t\t<i qva-activate="resetDockState();" class="lui-icon lui-icon--arrow-down"></i>\n\t</h3>\n\t<h3 class="title-section title-landscape" ng-if="displayResult.visuals && isSmallDeviceLandscape">\n\t\t<span class="lui-icon lui-icon--object"></span>\n\t\t<span q-translation="GlobalSearch.RotateForVisuals"></span>\n\t</h3>\n\t\t\n\t<qv-smartsearch-visuals-group items="searchVisualsGroups" search-terms="searchTerms" options="{\'preload\': false}" ng-if="displayResult.visuals" ng-hide="isSmallDeviceLandscape" ng-class="visualClasses"></qv-smartsearch-visuals-group>\n\n\t<h3 ng-if="isObjectsFeature && ( displayResult.data || showNoResultsMessage() )" class="title-section title-selections" >\n\t\t<span q-translation="GlobalSearch.Selections"></span>\n\t\t<i qva-activate="resetDockState();" class="lui-icon lui-icon--arrow-up"></i>\n\t</h3>\n\n\t<div ng-show="displayResult.data" class="qv-global-search-result-groups data-container">\n\t\t\n\t\t<div ng-if="isPartials()" qv-scroll-to-active="{{ stateFocus === \'partials\' }}" class="qv-global-search-result-message search-partials-message">\n\t\t\t<qv-global-search-result-msg></qv-global-search-result-msg>\n\t\t\t<div><button class="lui-button" qva-activate="setShowPartialMatches($event)" tid="globalSearch.showPartialMatches" q-translation="{{ !forcePartials?\'GlobalSearch.ShowPartialMatches\' : \'GlobalSearch.HidePartialMatches\' }}" ng-class="{ \'lui-active\': stateFocus === \'partials\' }"></button></div>\n\t\t</div>\n\n\t\t<div ng-if="(outsideSelection || currentSelections) && (!isPartials() || forcePartials)" class="qv-global-search-result-title strong" >\n\t\t\t<span ng-if="outsideSelection && !currentSelections" tid="globalSearch.matchesWholeDataset" q-translation="GlobalSearch.MatchesWholeDataset"></span>\n\t\t\t<span ng-if="currentSelections" tid="globalSearch.addToYourSelections" q-translation="GlobalSearch.AddToYourSelections"></span>\n\t\t</div>\n\n\t\t<div ng-repeat="m in matches" class="data-matches-group" ng-if="(!isPartials() || forcePartials)">\n\t\t\t\n\t\t\t<div ng-if="m !== searchTerms.length" class="caption-flex" q-translation="GlobalSearch.MatchedSearchTerms,{{m}}"></div>\n\n\t\t\t<div class="content-flex" ng-init="parentIndex = $index" ng-class="{ \'touch-off\':!isSmallDevice }" ng-repeat="row in getSearchTermGroup(m)" qv-scroll-to-active="{{( row.qId === activeSelectIx) && stateFocus === \'results\' }}" tid="globalSearch.resultGroup" >\n\t\t\t\t\n\t\t\t\t<div class="cell" ng-repeat="item in row.qItems" tid="globalSearch.resultField" ng-class="{ \'maxcell\': !$last && !$first, \'maxcellfirst\': ($first && row.qTotalNumberOfItems > 1) }" >\n\t\t\t\t\t\n\t\t\t\t\t<div class="group-hits" qva-activate="select( row, $parentIndex )" ng-class="{ \'shown\': (item.qTotalNumberOfMatches-item.qItemMatches.length) > 0  }">\n\t\t\t\t\t\t<span class="field-name" tid="globalSearch.resultField.Name">{{item.qIdentifier}}</span>\n\t\t\t\t\t\t<span ng-repeat="hit in item.qItemMatches" tid="globalSearch.resultField.Hit">\n\t\t\t\t\t\t\t<qv-global-search-highlights q-text="hit.qText" q-ranges="hit.qRanges"></qv-global-search-highlights >\n\t\t\t\t\t\t\t<span>{{$last ? \'\' : \', \'}}</span>\t\t\n\t\t\t\t\t\t</span>\t\n\t\t\t\t\t\t<div tid="globalSearch.resultField.MoreHits" ng-if="item.qTotalNumberOfMatches-item.qItemMatches.length > 0" qva-activate="onShowMoreHits($event, item, row.qId)" class="more-hits"><span class="more-text" q-translation="GlobalSearch.MoreResults,{{(item.qTotalNumberOfMatches-item.qItemMatches.length)}}"></span></div>\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="more-hits-area-mobile" ng-if="item.qTotalNumberOfMatches-item.qItemMatches.length > 0" tid="globalSearch.resultField.MoreHitsMobile" qva-activate="onShowMoreHits($event, item, row.qId)">\n\t\t\t\t\t\t<button class="lui-button lui-button--rounded">\n\t\t\t\t\t\t\t<span class="lui-button__icon lui-icon lui-icon--more"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\t\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div qv-scroll-to-active="{{showMeMoreFocus}}" class="show-me-more"><button ng-if="paging.totalRows > paging.lastRowIx && (!isPartials() || forcePartials)" tid="globalSearch.showmemore" qva-activate="loadNextPage($event)" class="lui-button" q-translation="GlobalSearch.ShowMeMore" ng-class="{\'lui-active\': showMeMoreFocus }"></button></div>\n\n\t</div>\n\n\t<div class="fixed-bar" ng-show="fixedbar">\n\t\t<span qva-activate="resetDockState();" class="lui-fade-button">\n\t\t\t<span class="lui-fade-button__icon lui-icon lui-icon--arrow-down"></span>\n\t\t</span>\n\t</div>\n\n\t<qv-global-search-no-results class="search-no-results-message" ng-show="showNoResultsMessage()" ></qv-global-search-no-results>\n\n\t<qv-global-search-throbber></qv-global-search-throbber>\n</div>\n'}),define("text!client.views/global-search/directives/result/result-message.ng.html",[],function(){return'<div class="qv-global-search-result-message-inline">\n    <span ng-if="currentSelections" q-translation="GlobalSearch.NoMatchesWithinCurrentSelection"></span>\n    <span ng-if="!currentSelections" q-translation="GlobalSearch.NoMatchesForTheTerms"></span>\n    <span ng-repeat="t in searchTerms track by $index">\n        <span class="underlined{{$index % capUnderlineMaxNumber}}">{{t}}</span>\n        <i ng-if="!$last && $index === searchTerms.length-2" q-translation="GlobalSearch.And"></i><i ng-if="!$last && $index !== searchTerms.length-2">,</i>\n    </span> \n</div>  '}),define("text!client.views/global-search/directives/result/no-results.ng.html",[],function(){return'<div>\n    <div class="qv-global-search-result-groups" ng-if="!error.show">\n\n        <div class="qv-global-search-result-message" >            \n            <qv-global-search-result-msg></qv-global-search-result-msg>\n\n            <div ng-if="currentSelections && !allSelectionsLocked">\n            \t<button class="lui-button" qva-activate="searchOutsideSelections($event)" tid="globalSearch.newSearchJustFor" q-translation="GlobalSearch.NewSearchJustFor,{{query.trim()}}" ng-class="{ \'lui-active\': stateFocus === \'start-new-search\' }"></button>\n            </div>\n        </div>\n    </div>      \n\n    <div class="qv-global-search-result-error" ng-if="error.show">\n        <span q-translation="{{error.translation}}"></span>\n    </div>\n</div>'}),define("text!client.views/global-search/directives/result/highlights.ng.html",[],function(){return"<span ng-repeat=\"slice in slices track by $index\" ng-class=\"slice.highlight ? 'highlighted' + slice.qTerm : ''\">{{slice.qSliceText}}</span>"}),define("client.views/global-search/directives/result/highlights",["qvangular","text!./highlights.ng.html","client.views/global-search/global-search-data-service"],function(a,b){a.directive("qvGlobalSearchHighlights",function(){return{restrict:"E",template:b,scope:{qText:"=",qRanges:"="},link:function(b){function c(a,b){for(var c=null,d=0;d<a.length;d++)if(a[d].iStart===b.iStart){c=a.splice(d,1,b);break}c||a.push(b)}var d=a.getService("qvGlobalSearchDataService").getMaxColorsNum();b.slices=null,b.$watch("qRanges",function(a){if(a){for(var e=0,f=[],g=a.sort(function(a,b){return a.qCharPos-b.qCharPos}),h=0;h<g.length;h++){var i=g[h];i.qCharPos>e&&f.push({qTerm:-1,qSliceText:b.qText.slice(e,i.qCharPos),highlight:!1,iStart:e,iEnd:i.qCharPos}),e=i.qCharPos+i.qCharCount;var j={qTerm:i.qTerm%d,highlight:!0,qSliceText:b.qText.slice(i.qCharPos,e),iStart:i.qCharPos,iEnd:e};c(f,j),h===a.length-1&&e<b.qText.length&&f.push({qTerm:-1,qSliceText:b.qText.slice(e,b.qText.length),highlight:!1,iStart:e,iEnd:b.qText.length})}b.slices=f}})}}})}),define("text!client.views/global-search/directives/result/objects/visuals-group.ng.html",[],function(){return'<div class="qv-smartsearch-visuals-group" qv-smartsearch-swipe-horizontal >\n\t<div class="nav-visual-arrow left" qva-activate="goToPage( pageIndex - 1 );" ng-show="pageIndex > 0">\n\t\t<span class="lui-fade-button">\n\t\t\t<span class="lui-fade-button__icon  lui-icon lui-icon--arrow-left"></span>\n\t\t</span>\n\t</div>\n\t<div class="visuals-wrapper" >\n\t\t<div class="page" ng-repeat="p in pages" ng-class="{ \'first\': $first, \'last\': $last }">\n\t\t\t<div class="content" >\n\t\t\t\t<qv-smartsearch-visual-preview ng-repeat="visualItem in p" visual-object="visualItem" search-terms="searchTerms" ng-class="{ \'first\': $first && !$last, \'last\': $last }"></qv-smartsearch-visual-preview>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="nav-visual-arrow right" qva-activate="goToPage( pageIndex + 1 );" ng-show="pageIndex < (pages.length - 1)">\n\t\t<span class="lui-fade-button">\n\t\t\t<span class="lui-fade-button__icon  lui-icon lui-icon--arrow-right"></span>\n\t\t</span>\n\t</div>\n\t<div class="more-indicator" ng-if="!touchOn">\n\t\t<span class="hitarea dot" qva-activate="goToPageClick($index,$event);" ng-class="{ \'active\': $index === pageIndex }" ng-repeat="p in pages"></span>\n\t</div>\n\t<div class="more-indicator" ng-if="touchOn">\n\t\t<div class="hitarea" qva-activate="goToPageClick($index,$event);" ng-repeat="p in pages"><span class="dot" ng-class="{ \'active\': $index === pageIndex }"></span></div>\n\t</div>\n</div>'}),define("text!client.views/global-search/directives/result/objects/visual-item.ng.html",[],function(){return'<div class="visual-item" >\n\t<div class="object" qva-activate="navigateToSheet($event)" >\n\t\t<qv-object ng-if="viz && visualObject.load" model="viz.model" options="viz.options"></qv-object>\n\t\t<div class="transparent-overlay"></div>\n\t\t<div ng-hide="visualObject.load" class="qv-animate progress">\n\t\t\t<div class="progress-loader"></div>\n\t\t</div>\n\t</div>\n\t<div class="visual-data" qva-activate="showExtraInfo($event);">\n\t\t<div ng-if="visualObject.load" class="keywords">\n\t\t\t<div class="terms">\n\t\t\t\t<span ng-repeat="t in termsMatched"><span ng-if="!$first">&nbsp;</span><span class="highlighted{{t.pos}}">{{t.string}}</span></span>\n\t\t\t</div>\n\t\t\t<div class="lui-fade-button" ng-if="matches.length">\n\t\t\t\t<span class="lui-fade-button__icon lui-icon lui-icon--info"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="extra-info" ng-if="visualObject.load" ng-class="{ \'show\': extra }">\n\t\t\t<div ng-if="matches.length" ng-repeat="hits in matches" class="hits">\n\t\t\t\t<div ng-repeat="hit in hits" class="match-hit">\n\t\t\t\t\t<span ng-if="$first"><b q-translation="{{hit.trans}}"></b>: </span><qv-global-search-highlights q-text="hit.qText" q-ranges="hit.qRanges" class="highlights"></qv-global-search-highlights><span ng-if="!$last">,&nbsp;</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="more-hits" qva-activate="showMoreHits($event)" ng-if="$last && (visualObject.qTotalNumberOfMatches-hitsDisplayed) > 0" q-translation="GlobalSearch.MoreResults,{{(visualObject.qTotalNumberOfMatches-hitsDisplayed)}}"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'}),define("client.views/global-search/directives/result/objects/visual-item",["qvangular","underscore","text!./visual-item.ng.html","core.utils/deferred","objects.models/visualization-object","client.utils/rtl/direction-service","client.views/global-search/directives/result/highlights","client.views/global-search/global-search-data-service"],function(a,b,c,d,e,f){a.directive("qvSmartsearchVisualPreview",[function(){function g(a){var b=new d;return e.get(a.qIdentifier).then(function(a){b.resolve({model:a,options:{isReadonly:!0,isPopover:!1,selectionsDisabled:!0,components:{miniChart:{show:!1},scrollArea:{showFlag:0}},direction:f.direction}})}),b.promise}function h(a){var b=a.split("/");return b=b.map(function(a){return parseInt(a)}).filter(function(a){return!isNaN(a)}),b.length?b[0]:-1}function i(a,b){a.id=-1,b.indexOf("qDimensions")!==-1||b.indexOf("qListObjectDef/qDef")!==-1?(a.id=h(b),a.type=b.indexOf("qLayoutExclude")===-1?k.DIMENSION:k.ALTERNATIVE_DIMENSION,a.isLabel=b.indexOf("qFieldLabels")!==-1):b.indexOf("qMeasures")!==-1?(a.id=h(b),a.type=b.indexOf("qLayoutExclude")===-1?k.MEASURE:k.ALTERNATIVE_MEASURE,a.isLabel=b.indexOf("qLabel")!==-1):(b.indexOf("subtitle")!==-1?a.type=k.SUBTITLE:b.indexOf("title")!==-1?a.type=k.TITLE:b.indexOf("footnote")!==-1?a.type=k.FOOTNOTE:b.indexOf("type")!==-1?a.type=k.TYPE:a.type=k.VALUE,a.isLabel=b.indexOf("qExpr")===-1),a.trans=j(a.type)}function j(a){var b="---";switch(a){case k.TITLE:b="Common.Title";break;case k.DIMENSION:b="Common.Dimensions";break;case k.MEASURE:b="Common.Measures";break;case k.ALTERNATIVE_DIMENSION:b="properties.alternative.dimensions";break;case k.ALTERNATIVE_MEASURE:b="properties.alternative.measures";break;case k.SUBTITLE:b="properties.subtitle";break;case k.FOOTNOTE:b="properties.footnote";break;case k.TYPE:b="properties.type";break;case k.VALUE:b="properties.dataPoints.labelmode.value"}return b}var k={TITLE:0,SUBTITLE:1,FOOTNOTE:2,DIMENSION:3,MEASURE:4,ALTERNATIVE_DIMENSION:5,ALTERNATIVE_MEASURE:6,TYPE:7,VALUE:8};return{restrict:"E",template:c,replace:!0,require:["^qvGlobalSearch"],scope:{visualObject:"=",searchTerms:"="},link:function(c,f,h,j){function k(){c.termsMatched=c.visualObject.qSearchTermsMatched.map(function(a){return{string:c.searchTerms[a],pos:a%q}})}function l(a){c.hitsDisplayed=a.length;var d,e,f,g={};a.forEach(function(a){a.qAttributes&&a.qAttributes.length&&(i(a,a.qAttributes[0][1]),g[a.type]||(g[a.type]=[]),a.isLabel&&g[a.type].push(a.id))}),d=c.visualObject.qItemMatches.filter(function(a){return a.isLabel||g[a.type].indexOf(a.id)===-1}),e=b.groupBy(d,function(a){return a.type}),f=Object.keys(e).map(function(a){return e[a]}),c.matches?f.forEach(function(a,b){if(a.length>c.matches[b].length)for(var d=c.matches[b].length,e=d;e<a.length;e++)c.matches[b].push(a[e])}):c.matches=f}function m(a,b){var f=new d,g={sheet:a,cell:b};return b.name===c.visualObject.qIdentifier?f.resolve(g):"filterpane"===b.type?e.get(b.name).then(function(a){a.getLayout().then(function(a){if(a.qChildList&&a.qChildList.qItems.length){var b=a.qChildList.qItems.filter(function(a){return a.qInfo.qId===c.visualObject.qIdentifier});f.resolve(b.length?g:null)}else f.resolve(null)})}):f.resolve(null),f.promise}function n(){for(var a,b=[],c=0;c<p.all.mashed.length;c++){a=p.all.mashed[c];for(var e=0;e<a.qData.cells.length;e++)b.push(m(a,a.qData.cells[e]))}return d.all(b)}var o,p=a.getService("$navigationService").Sheets,q=a.getService("qvGlobalSearchDataService").getMaxColorsNum(),r=j[0];c.viz=null,c.termsMatched=null,c.extra=!1,c.matches=null,c.$watch("visualObject.load",function(a){a===!0?(k(),o?c.viz=o:(g(c.visualObject).then(function(a){o=a,c.viz=a}),l(c.visualObject.qItemMatches))):c.viz=null}),c.$watch("searchTerms",function(a){a&&c.visualObject&&k()}),c.$on("$destroy",function(){o=null}),c.showMoreHits=function(a){a.stopPropagation(),r.showMoreHitsForVisual(c.visualObject).then(function(a){l(a.qItemMatches)})},c.showExtraInfo=function(a){c.extra=!c.extra&&c.matches.length,a.stopPropagation()},c.navigateToSheet=function(a){a.stopPropagation(),n().then(function(a){a=a.filter(function(a){return a}),a.length&&(p.navigateToSheet(a[0].sheet),r.onNavigateToSheet(a[0].cell.name))})}}}}])}),define("client.views/global-search/directives/result/objects/visuals-group",["jquery","qvangular","text!./visuals-group.ng.html","touche","general.utils/responsive-state","core.utils/resize","general.utils/support","client.views/global-search/directives/result/objects/visual-item"],function(a,b,c,d,e,f,g){var h={MAX_MOBILE_VISUALS:10,PAGE_VISUALS:3,PAGE_VISUALS_PORTRAIT:2,PADDING_PAGES:15};b.directive("qvSmartsearchVisualsGroup",["$timeout",function(b){return{restrict:"E",template:c,replace:!0,scope:{items:"=",searchTerms:"=",options:"="},controller:function(){this.loadPage=function(){},this.preparePages=function(){}},link:function(c,d,g,i){function j(){c.pages=[],l.scrollLeft(0),c.pageIndex=0}c.pageIndex=0,c.pages=[],c.objects=null,c.touchOn=1===a(".touch-on").length;var k,l=d.find(".visuals-wrapper"),m=!1,n=e.isSmallDevice?400:600,o=function(){n=e.isSmallDevice?400:600,l[0].scrollLeft=c.pageIndex*(l[0].offsetWidth+h.PADDING_PAGES)},p=function(){i.preparePages(c.items[0].qItems);
};e.OrientationChanged.bind(p),c.setPageIndex=function(a){c.pageIndex=a,void 0!==k&&k.find(".dot").removeClass("pressed");for(var b=0;b<c.pages.length;b++)c.pages[b].forEach(function(d){c.options.preload?d.load=b===a||b===a+1||b===a-1:d.load=b===a})},f.on("update",o),c.goToPageClick=function(b,d){var e=a(d.target).hasClass("dot")?a(d.target):a(d.target).find(".dot");e.addClass("pressed"),k=a(d.target).closest(".more-indicator"),c.goToPage(b)},c.goToPage=function(a){i.loadPage(a)},c.$watch("items",function(a){a&&a.length&&i.preparePages(a[0].qItems)}),c.$on("$destroy",function(){f.off("update",o),e.OrientationChanged.unbind(p)}),i.loadPage=function(a){!m&&a>=0&&a<c.pages.length&&(m=!0,l.animate({scrollLeft:a*(l[0].offsetWidth+h.PADDING_PAGES)},n,"swing",function(){m=!1,b(function(){c.setPageIndex(a)})}))},i.preparePages=function(a){if(a){j();var b,d=0,f=[];e.orientation===e.Orientation.landscape?b=e.isSmallDevice?1:h.PAGE_VISUALS:e.orientation===e.Orientation.portrait&&(b=e.isSmallDevice?1:h.PAGE_VISUALS_PORTRAIT);for(var g=0;g<a.length&&!(e.isSmallDevice&&f.length>=h.MAX_MOBILE_VISUALS&&f[d].length>=b);g++)f[d]?f[d].length>=b&&(d++,f.push([])):f.push([]),a[g].itemIndex=g,a[g].load=c.options.preload?0===d||1===d:0===d,f[d].push(a[g]);c.pages=f}}}}}]),b.directive("qvSmartsearchSwipeHorizontal",[function(){var a={up:!1,down:!1,right:!0,left:!0};return{restrict:"A",require:"^qvSmartsearchVisualsGroup",link:function(b,c,e,f){function h(c,e){if(a[e.swipe.direction]){var g=e.swipe.curDeltaX>0?-1:0===e.swipe.curDeltaX?0:1;f.loadPage(b.pageIndex+g),d.preventGestures(this.gestureHandler)}}g.treatAsDesktop()||d(c[0]).swipe({options:{radiusThreshold:50,preventDefault:!0,useMomentum:!0},start:h}),b.$on("$destroy",function(){d(c[0]).off()})}}}])}),define("client.views/global-search/directives/result/result",["qvangular","text!./result.ng.html","text!./result-message.ng.html","text!./no-results.ng.html","touche","general.utils/support","client.views/global-search/directives/result/highlights","client.views/global-search/directives/result/objects/visuals-group"],function(a,b,c,d,e,f){var g={INITIAL:0,VISUALS_DOCKED:1,DATA_DOCKED:2};a.directive("qvGlobalSearchResult",["$timeout",function(a){return{restrict:"E",template:b,replace:!0,require:["^qvGlobalSearch","qvGlobalSearchResult"],controller:function(){this.getElement=function(){},this.setDockState=function(){}},link:function(b,c,d,h){var i,j,k=h[0],l=h[1],m=function(){var d=this,e=0;f.treatAsDesktop()&&!j&&(j=c.find(".qv-smartsearch-visuals-group")),a(function(){j&&j.length&&(e=j[0].offsetTop+j[0].offsetHeight-33,b.fixedbar=d.scrollTop>e),b.scrollShow=d.scrollHeight-d.scrollTop>d.clientHeight})},n=!f.treatAsDesktop()&&b.isObjectsFeature?c.find(".data-container"):c;b.dockState=g.INITIAL,b.resultLoaderOpen=!1,b.emptyMessageEnabled=!1,b.fixedbar=!1,b.classes={"qv-global-search-result-loader-open":b.resultLoaderOpen,"with-objects":b.isObjectsFeature},b.$watch("resultLoaderOpen",function(a){b.classes["qv-global-search-result-loader-open"]=a}),b.$watch(function(){return b.showNoResultsMessage()},function(a){b.classes.noresults=a}),b.select=function(c,d){e.utils.touch?(b.activeResultIx=d,a(function(){k.select(b.searchTerms,c.qId)},100)):k.select(b.searchTerms,c.qId)},b.loadNextPage=function(){k.loadNextPage()},l.getElement=function(){return c},l.setDockState=function(c){a(function(){b.dockState=c,b.classes["visuals-docked"]=c===g.VISUALS_DOCKED,b.classes["data-docked"]=c===g.DATA_DOCKED})},b.setShowPartialMatches=function(){k.setShowPartialMatches()},b.showNoResultsMessage=function(){var a=b.emptyMessageEnabled&&b.searchTerms.length>0&&!b.displayResult.data&&!b.error.show&&!b.resultLoaderOpen||b.error.show;return a},b.resetDockState=function(){b.dockState=g.INITIAL,f.treatAsDesktop()&&n.animate({scrollTop:0},300,"swing")},i=b.$watch(function(){return n[0].scrollHeight},function(a){b.scrollShow=a>n[0].clientHeight}),n.on("scroll",m),b.$on("$destroy",function(){i(),n.off("scroll",m)})}}}]),a.directive("qvScrollToActive",function(){return{restrict:"A",require:"^qvGlobalSearchResult",link:function(a,b,c,d){c.$observe("qvScrollToActive",function(a){if(a=a+""=="true",b.toggleClass("active",a),a){var c=d.getElement(),e=b.position();e.top<0?c[0].scrollTop=b[0].offsetTop:e.top+b.height()>c.height()&&b[0].scrollIntoView(!1)}})}}}),a.directive("qvGlobalSearchResultMsg",function(){return{restrict:"E",template:c,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(a){a.capUnderlineMaxNumber=6}}}),a.directive("qvGlobalSearchNoResults",function(){return{restrict:"E",template:d,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(){}}}),a.directive("qvSmartsearchSwipeResults",["$timeout",function(a){return{restrict:"A",require:["^qvGlobalSearchResult"],link:function(b,c,d,h){function i(){e(c[0]).off(),o&&o.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",A),n[0].removeEventListener("touchstart",y,!1),document.removeEventListener("touchmove",z,!1)}function j(a,c){if(!o||0===o.length)return void e.preventGestures(this.gestureHandler);if(p===g.INITIAL&&!b.isSmallDevice&&"up"===c.swipe.direction)return void e.preventGestures(this.gestureHandler);if(x[c.swipe.direction]&&!r){if(p===g.VISUALS_DOCKED&&n[0].scrollTop>1)return;var d=t+c.swipe.curDeltaY;if(d<0)return void n.removeAttr("style");a.preventDefault(),s=!0,t=d<v?d:v,n.css("overflow","hidden"),o.css("height",t+"px")}}function k(a,b){return r||!x[b.swipe.direction]?void e.preventGestures(this.gestureHandler):(t=o?o[0].clientHeight:0,v=c.height()-75,void j(a,b))}function l(c){p=c,q.setDockState(p),r||p!==g.INITIAL&&p!==g.DATA_DOCKED?r&&o.addClass("transitionAnim"):b.$broadcast("resizeCell"),n.scrollTop(0),a(function(){o.removeAttr("style"),n.removeAttr("style")},50)}function m(){!r&&s&&(t>0&&t<v?(r=!0,l(t<u-w?g.VISUALS_DOCKED:t>u-w&&t<u+w?g.INITIAL:g.DATA_DOCKED)):0===t?l(g.VISUALS_DOCKED):t===v&&l(g.DATA_DOCKED),s=!1)}if(b.isObjectsFeature){var n=c.find(".data-container"),o=null,p=g.INITIAL,q=h[0],r=!1,s=!1,t=null,u=0,v=0,w=b.isSmallDevice?80:200,x={up:!0,down:!0,left:!1,right:!1},y=function(){0===this.scrollTop?this.scrollTop+=1:this.scrollTop+this.offsetHeight>=this.scrollHeight&&(this.scrollTop-=1)},z=function(a){n[0].scrollHeight>n[0].offsetHeight?p!==g.INITIAL&&p!==g.DATA_DOCKED||a.preventDefault():a.preventDefault()},A=function(){this.classList.remove("transitionAnim"),(r&&p===g.INITIAL||p===g.DATA_DOCKED)&&b.$broadcast("resizeCell"),r=!1};b.$watchGroup(["displayResult.visuals","isSmallDeviceLandscape"],function(a){a[0]&&!a[1]?(o=c.find(".qv-smartsearch-visuals-group"),o.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",A),u=u||o.height(),f.treatAsDesktop()||(e(c[0]).swipe({options:{radiusThreshold:20,preventDefault:!1,useMomentum:!1},start:k,update:j,end:m}),document.addEventListener("touchmove",z,!1),n[0].addEventListener("touchstart",y,!1))):i()}),b.$watch("dockState",function(a){a===g.INITIAL&&p!==g.INITIAL&&(r=!0,l(g.INITIAL))}),b.$on("$destroy",function(){i()})}}}}])}),define("text!client.views/global-search/directives/suggest/suggest.ng.html",[],function(){return'<div class="qv-search-suggest-wrapper" tid="globalSearch.suggestions">\n\t<span class="hidden">{{query}}</span>\n    <div ng-show="isSmallDevice" ng-if="!isObjectsFeature" class="dym" q-translation="GlobalSearch.DidYouMean"></div>\n\t<ul class="suggest-popup">\n\t\t<li ng-repeat="suggest in suggestions track by $index" qv-scroll-to-active-suggestion="{{$index === activeSuggestionIx && stateFocus === \'suggestions\'}}" ng-class="{active: $index === activeSuggestionIx && stateFocus === \'suggestions\'}" qva-activate="onSuggestSelect($index)" tid="globalSearch.suggestion" bold-suggest=\'{{suggest.value}}\'>\n\t\t\t{{suggest.value}}\n\t\t</li>\n\t</ul>\n</div>\n'}),define("client.views/global-search/directives/suggest/suggest",["qvangular","text!./suggest.ng.html"],function(a,b){a.directive("qvGlobalSearchSuggest",[function(){return{restrict:"E",template:b,replace:!0,require:["^qvGlobalSearch"],link:function(){}}}]),a.directive("qvScrollToActiveSuggestion",function(){return{restrict:"A",link:function(a,b,c){c.$observe("qvScrollToActiveSuggestion",function(a){if(a=a+""=="true"){var c=b.position(),d=b.parent(),e=b[0].clientWidth>d[0].clientWidth,f=c.left+b[0].clientWidth-d[0].clientWidth;b[0].scrollIntoView(e),c.left<=d[0].offsetLeft?d.scrollLeft(b[0].offsetLeft-d[0].offsetLeft):f>0&&!e&&(d[0].scrollLeft=d[0].scrollLeft+f)}})}}})}),define("text!client.views/global-search/directives/history/history.ng.html",[],function(){return'<div class="qv-search-last-history" tid="globalSearch.searchHistory">\n\t<div class="title" ng-show="searchHistory.length" q-translation="GlobalSearch.SearchHistory"></div>\n\t<ul class="history-popup" ng-show="searchHistory.length">\n\t\t<li ng-repeat="items in searchHistory" qva-activate="onSearchHistorySelect($index)" tid="globalSearch.searchHistoryItem" ng-class="{active: $index === activeHistoryIx && stateFocus === \'history\'}" qv-scroll-to-active-history="{{$index === activeHistoryIx && stateFocus === \'history\'}}">\n\t\t\t<span ng-repeat="term in items.qData.searchTerms track by $index">\n\t\t\t\t<span class="underline term{{$index%colorsLimit}}">{{term}}</span><span class="term-space" ng-if="!$last">&nbsp;</span>\n\t\t\t</span>\n\t\t</li>\n\t</ul>\n</div>'}),define("client.views/global-search/directives/history/history",["qvangular","text!./history.ng.html","client.views/global-search/global-search-data-service"],function(a,b){a.directive("qvGlobalSearchHistory",["$timeout",function(c){return{restrict:"E",template:b,replace:!0,require:["^qvGlobalSearch"],link:function(b,d,e,f){var g=f[0],h=d.find(".history-popup")[0];b.colorsLimit=a.getService("qvGlobalSearchDataService").getMaxColorsNum(),b.$watch("searchInputFocused",function(a){a&&c(function(){h.scrollTop=0})}),b.onSearchHistorySelect=function(a){g.setQueryFromHistory(a)}}}}]),a.directive("qvScrollToActiveHistory",function(){return{restrict:"A",link:function(a,b,c){c.$observe("qvScrollToActiveHistory",function(a){a=a+""=="true",b.toggleClass("active",a),a&&b[0].scrollIntoView(!1)})}}})}),define("text!client.views/global-search/directives/throbber/throbber.ng.html",[],function(){return'<div ng-show="resultLoaderOpen" class="qv-animate progress ng-hide">\n\t<div class="progress-loader"></div>\n</div>'}),define("client.views/global-search/directives/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(a,b){"use strict";a.directive("qvGlobalSearchThrobber",["$timeout",function(a){return{replace:!0,template:b,restrict:"E",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(b,c,d,e){function f(a){a&&(h.getElement()[0].scrollTop=0)}var g,h=e[1];b.$on("resultLoader",function(c,d,e){d?(a.cancel(g),g=a(function(){f(e),b.resultLoaderOpen=!0,b.emptyMessageEnabled=!1},1e3)):(a.cancel(g),f(e),b.resultLoaderOpen=!1,b.emptyMessageEnabled=b.searchTerms.length>0)})}}}])}),define("client.views/global-search/global-search-controller",["jquery","qvangular","core.models/app","core.utils/feature-flags","core.utils/environment","core.utils/resize","./global-search-keyboard-shortcuts","autogenerated/qix/engine-enums","general.controllers/error-handler-controller","general.utils/responsive-state","client.models/current-selections","client.services/grid-service","general.utils/support","client.views/global-search/directives/input/input","client.views/global-search/directives/result/result","client.views/global-search/directives/suggest/suggest","client.views/global-search/directives/history/history","client.views/global-search/directives/throbber/throbber","client.views/global-search/global-search-data-service","client.views/global-selections/global-selections-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b,c,d){var e={qOffset:b,qCount:c,qGroupOptions:[],qGroupItemOptions:[]};return a===s.Data?(e.qGroupOptions.push({qGroupType:"DatasetType",qOffset:0,qCount:-1}),e.qGroupItemOptions.push({qGroupItemType:"Field",qOffset:0,qCount:d})):a===s.Visuals&&(e.qGroupOptions.push({qGroupType:"GenericObjectsType",qOffset:0,qCount:30}),e.qGroupItemOptions.push({qGroupItemType:"GenericObject",qOffset:0,qCount:d})),e}function o(a){var b={qContext:"Cleared"};return a.currentSelections&&(b.qContext="CurrentSelections",a.lockedSelections&&a.lockedSelections.length>0&&(b.qContext="LockedFieldsOnly")),b}function p(a,b){a.dimmerStyles["max-height"]=b,a.isObjectsFeature&&(a.dimmerStyles.height=b)}function q(q,t,u){function v(b){var c=a(b.target);1!==c.closest(".qv-selections-pager").length&&H.closeSearch()}var w=b.getService("qvGlobalSearchDataService"),x=b.getService("$timeout"),y=b.getService("qvGlobalSelectionsService"),z=b.getService("qvGlobalSearchService"),A=new g(u,q,this),B={search:{idCounter:0,state:r.idle,searchTerms:""},searchVisuals:{idCounter:0,state:r.idle,searchTerms:""},result:{state:r.idle},suggest:{idCounter:0,state:r.idle,suggestTerms:""}},C=function(){x(function(){q.isSmallDevice=j.isSmallDevice})},D=function(){q.isSmallDeviceLandscape=j.orientation===j.Orientation.landscape&&j.isSmallDevice},E=function(){p(q,t.find("body").height()-F)},F=u.offset().top+u[0].offsetTop+u.find(".qv-global-search").height(),G=u.parent().parent(),H=this;q.app=q.app||c.current,q.isObjectsFeature=d.SMARTSEARCH_OBJECTS&&e.inClient(),q.isSearchHistoryFeature=d.SEARCH_HISTORY,q.isSmallDevice=j.isSmallDevice,q.isSmallDeviceLandscape=j.orientation===j.Orientation.landscape&&j.isSmallDevice,j.ViewChanged.bind(C),j.OrientationChanged.bind(D),f.on("end",E),q.input="input goes here",q.result="result goes here",q.isSelectActiveInSmallDevice=!1,q.$on("$destroy",function(){u.off("qv-outside"),A.delete(),j.ViewChanged.unbind(C),j.OrientationChanged.unbind(D),f.off("end",E)}),k.get(q.app).then(function(a){q.modelSelections=a}),q.$watch(function(){return y.getSelectionCount(q.app)},function(a){q.currentSelections=!!(a&&a>0),q.allSelectionsLocked=q.currentSelections&&y.getSelectionLockedCount(q.app)===a,q.isObjectsFeature&&H.searchVisuals(q.searchTerms),H.search(q.searchTerms)}),q.$watch(function(){return y.getSelectionLockedCount(q.app)},function(a){q.allSelectionsLocked=q.currentSelections&&y.getSelectionCount(q.app)===a}),q.$watch(y.isSelectActive,function(a){q.isSelectActiveInSmallDevice=a&&q.isSmallDevice}),q.underlines=[],q.query="",q.searchTerms=[],q.searchTermGroups=[],q.matches=[],q.displayResult={data:!1,visuals:!1},q.activeSelectIx=-1,q.showMeMoreFocus=!1,q.forcePartials=!1,q.allSelectionsLocked=!1,q.dimmerStyles={},q.error={show:!1,message:"",description:""},q.paging={lastRowIx:0,totalRows:0},q.searchOutsideSelections=function(){H.startNewSearchFor()},q.onShowMoreHits=function(a,b,c){if(a.stopPropagation(),!b.disableShowMore){p(q,u.find(".qv-global-search-dimmer").height()),b.disableShowMore=!0,b.mobileExpand=!0;var d=n(s.Data,c,1,b.qItemMatches.length+15);H.callSearch(q.searchTerms,d).then(function(a){w.showMore(a,b)}).finally(function(){b.disableShowMore=!1})}},q.getSearchTermGroup=function(a){return q.searchTermGroups.filter(function(b){return b.qSearchTermsMatched.length===a})},q.close=function(){H.closeSearch()},u.on("qv-outside",v),q.isSearchHistoryFeature&&(q.searchInputFocused=!1,q.activeHistoryIx=-1,z.initHistory(q,q.app)),q.suggestions=[],q.displaySuggestions=!1,q.activeSuggestionIx=-1,q.ignoreQueryChange=!1,q.onSuggestSelect=function(a){var b,c,d,e=[];a=void 0!==a?a:q.activeSuggestionIx,d=q.suggestions[a],w.getUnderlinersAndSearchTerms(q.query,e,[]),b=w.getResultingQueryFromSuggestion(e,d),b.length>255?(A.off(),i.showDialog({message:"ErrorDialog.SearchStringTooLong"}),c=q.$on("errorHandlerClosed",function(){A.on(),c()})):(q.query=b+" ",q.ignoreQueryChange=!1),H.hideSuggestions(),q.$broadcast("focusInput")},this.hideSuggestions=function(){q.displaySuggestions&&(q.displaySuggestions=!1,this.resetSuggestions())},this.hideSoftKeyboard=function(){q.$broadcast("blurInput")},this.startNewSearchFor=function(){q.outsideSelection=!0,q.modelSelections.clearAll(),q.$broadcast("focusInput"),this.search(q.searchTerms)},this.setShowPartialMatches=function(){q.forcePartials=!q.forcePartials,m.treatAsDesktop()&&q.$broadcast("focusInput")},q.isPartials=function(){return q.searchTermGroups.length&&q.searchTerms.length>q.searchTermGroups[0].qSearchTermsMatched.length},this.resetSuggestions=function(){q.activeSuggestionIx=-1,q.activeSelectIx=-1},this.showSuggestions=function(){q.displaySuggestions=!0,q.activeSuggestionIx=-1,q.activeSelectIx=-1},this.showError=function(a){q.displayResult={data:!1,visuals:!1},q.error.show=!0,q.error.translation="ErrorCode."+a.error.code,a.error.isHandled=!0},this.toogleSuggestions=function(a){a?this.showSuggestions():this.hideSuggestions()},this.emptyResult=function(){q.displayResult={data:!1,visuals:!1},q.activeSelectIx=-1,q.error.show=!1,B.search.state=r.idle,B.searchVisuals.state=r.idle,B.suggest.state=r.idle,q.searchTerms=[],q.searchTermGroups=[],q.searchVisualsGroups=[],q.matches=[],q.outsideSelection=!1,q.$broadcast("resultLoader",!1),q.forcePartials=!1,q.stateFocus="input",this.hideSuggestions(),w.setGlobalSearchActive(!1),G.removeClass("queryon")},this.moveActiveResult=function(a){q.showMeMoreFocus=!1,0!==a&&(a>0?(q.activeSelectIx=Math.min(q.activeSelectIx+1,q.searchTermGroups.length),q.activeSelectIx=Math.min(q.activeSelectIx,q.paging.totalRows-1),q.activeSelectIx===q.searchTermGroups.length&&(q.showMeMoreFocus=!0)):a<0&&(q.activeSelectIx=Math.max(q.activeSelectIx-1,0)))},this.searchVisuals=function(a){function b(a){q.searchVisualsGroups=[],d===B.searchVisuals.idCounter&&B.searchVisuals.state===r.pending&&(B.searchVisuals.state=r.idle,B.searchVisuals.searchTerms="",w.transformResult(q,a))}function c(a){a.error.code===h.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(e.emptyResult(),e.showError(a)),a.error.code!==h.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(B.searchVisuals.state=r.idle,B.searchVisuals.searchTerms="",q.displayResult.visuals=!1)}if(q.isObjectsFeature&&(p(q,t.find("body").height()-F),0!==a.length)){B.searchVisuals.idCounter=B.searchVisuals.idCounter+1;var d=B.searchVisuals.idCounter,e=this,f=n(s.Visuals,0,-1,20);B.searchVisuals.state=r.pending,B.searchVisuals.searchTerms=a,q.app.rpc(s.Visuals,null,[{qAttributes:["qProperty"]},a,f]).then(b,c)}},this.search=function(a){function b(b){q.searchTermGroups=[],q.matches=[],d===B.search.idCounter&&B.search.state===r.pending&&(B.search.state=r.idle,B.search.searchTerms="",q.searchTerms=a,q.$broadcast("resultLoader",!1,!0),w.transformResult(q,b),q.activeSelectIx=-1,q.paging.lastRowIx=q.searchTermGroups.length,q.paging.totalRows=b.qResult.qTotalNumberOfGroups)}function c(a){a.error.code===h.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(e.emptyResult(),e.showError(a)),a.error.code!==h.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(B.search.state=r.idle,B.search.searchTerms="",q.displayResult.data=!1)}if(p(q,t.find("body").height()-F),q.stateFocus="input",0!==a.length){G.addClass("queryon"),B.search.idCounter=B.search.idCounter+1;var d=B.search.idCounter,e=this,f=n(s.Data,0,5,5);B.search.state=r.pending,B.search.searchTerms=a,q.$broadcast("resultLoader",!0,!0),q.error.show=!1,this.callSearch(a,f).then(b,c)}},this.loadNextPage=function(){p(q,u.find(".qv-global-search-dimmer").height());var a=n(s.Data,q.paging.lastRowIx,5,5);B.result.state===r.idle&&(B.result.state=r.pending,q.showMeMoreFocus=!1,q.$broadcast("resultLoader",!0,!0),this.callSearch(q.searchTerms,a).then(function(a){w.transformResult(q,a),q.paging.lastRowIx=q.searchTermGroups.length}).finally(function(){B.result.state=r.idle,q.$broadcast("resultLoader",!1)}))},this.callSearch=function(a,b){return q.app.rpc(s.Data,null,[o(q),a,b])},this.closeSearch=function(){q.isSmallDevice?(H.emptyResult(),q.query="",q.$broadcast("blurInput")):z.toggleGlobalSearch(q.app)},this.suggest=function(a){function b(a){B.suggest.suggestTerms="",w.isWhiteSpaceAt(q.query,q.query.length-1)||'"'===q.query.charAt(q.query.length-1)||(e===B.suggest.idCounter&&B.suggest.state===r.pending&&(w.transformSuggest(q,a,10),d.toogleSuggestions(q.suggestions.length>0),q.$broadcast("suggestShow",!0,!0)),B.suggest.state=r.idle)}function c(a){a.error.code===h.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(a.error.isHandled=!0),a.error.code!==h.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(B.suggest.state=r.idle,B.suggest.suggestTerms="")}if(0!==a.length){var d=this;B.suggest.idCounter=B.suggest.idCounter+1;var e=B.suggest.idCounter;B.suggest.state=r.pending,B.suggest.suggestTerms=a,q.app.rpc("SearchSuggest",null,[{},a]).then(b,c)}},this.select=function(a,b){if(q.$broadcast("blurInput"),0!==a.length&&0!==q.searchTermGroups.length){b<0&&(b=q.activeSelectIx=0);var c=q.query;q.app.rpc("SelectAssociations",null,[o(q),a,b]).then(function(){q.isSearchHistoryFeature&&z.createEntryInHistory(q.app,c,a)}),this.emptyResult(),q.query="",m.treatAsDesktop()&&!q.isSearchHistoryFeature&&q.$broadcast("focusInput")}},this.setTestSearchTermGroups=function(a){q.searchTermGroups=a},this.onNavigateToSheet=function(a){q.isSearchHistoryFeature&&z.createEntryInHistory(q.app,q.query,q.searchTerms),m.treatAsDesktop()?(H.emptyResult(),q.query="",q.isSearchHistoryFeature||q.$broadcast("focusInput")):x(function(){H.emptyResult(),q.query=""},200),l.highlightedCell(a)},this.showMoreHitsForVisual=function(a){var b={qOffset:0,qCount:1,qGroupOptions:[{qGroupType:"GenericObjectsType",qOffset:a.itemIndex,qCount:1}],qGroupItemOptions:[{qGroupItemType:"GenericObject",qOffset:0,qCount:a.qItemMatches.length+15}]};return q.app.rpc(s.Visuals,null,[{qAttributes:["qProperty"]},q.searchTerms,b]).then(function(b){return w.showMore(b,a),a})},this.showHistory=function(a){q.searchInputFocused=a},this.setQueryFromHistory=function(a){q.ignoreQueryChange=!1,q.query=q.searchHistory[a].qData.query.trim()+" ",this.showHistory(!1),q.$broadcast("focusInput")}}var r={idle:0,pending:1},s={Data:"SearchResults",Visuals:"SearchObjects"};return q}),define("client.views/global-search/global-search",["qvangular","text!./global-search.ng.html","client.views/global-search/global-search-controller"],function(a,b,c){return a.directive("qvGlobalSearch",function(){return{restrict:"E",template:b,controller:["$scope","$document","$element",c],require:["qvGlobalSearch"],scope:!0,replace:!0,link:function(){}}}),"<qv-global-search></qv-global-search>"}),define("client.views/global-search/global-search-service",["qvangular","client.views/global-search/global-search","client.utils/state","core.models/app","client.views/global-search/global-search-data-service","client.views/selection-toolbar/selection-toolbar-service"],function(a,b,c,d){a.service("qvGlobalSearchService",["$document","$timeout","qvGlobalSearchDataService","qvSelectionToolbarService",function(a,e,f,g){function h(a){return{$container:void 0,$containerId:".qv-global-search-container",$app:a,getComponent:function(){return b},setup:function(){c.StateChanged.bind(i),a.isModal()&&g.confirm()},destroy:function(){c.StateChanged.unbind(i)}}}function i(){(c.isInEditMode()||!c.isInAnalysisMode||c.inObjectView())&&l(o[d.current.id])}function j(b,c){b.$container=angular.element("<div>"),c=c||a,c.find(b.$containerId).append(b.$container),b.$container.showComponent(b.getComponent(),["$scope",function(a){a.app=b.$app}]),b.setup()}function k(a){return!(!a||void 0===a.$container)}function l(a){a.$container&&(a.$container.remove(),a.$container=void 0),a.destroy()}function m(a){return a=a||d.current,o[a.id]=o[a.id]||new h(a),o[a.id]}var n,o={};return n={toggleGlobalSearch:function(a,b){var d=m(a);k(d)?l(d):(c.setState(c.States.analysis),j(d,b))},openGlobalSearch:function(a,b){var c=m(a);k(c)||(l(c),j(c,b))},closeGlobalSearchIfNotActive:function(){f.isGlobalSearchActive()||this.off()},off:function(){for(var a in o)l(o[a])},isSearchActive:function(a){return a=a||d.current,k(o[a.id])},initHistory:function(a,b){b.enigmaModel.getSearchHistoryListObject().then(function(b){var c=b.layoutSubscribe(function(b){a.searchHistory=[].concat(b).sort(function(a,b){return Date.parse(b.qData.lastUsedDate)-Date.parse(a.qData.lastUsedDate)})});a.$on("$destroy",function(){c.dispose()})})},createEntryInHistory:function(a,b,c){return a.enigmaModel.getSearchHistoryList().then(function(d){var e=d.filter(function(a){return a.qData.query.trim().toLowerCase()===b.trim().toLowerCase()});return e.length?a.enigmaModel.updateSearchHistoryObject(e[0].qInfo.qId,function(a){a.query=b.trim(),a.searchTerms=c,a.lastUsedDate=(new Date).toISOString()}):a.enigmaModel.createSearchHistoryObject(b,c)})}}}])}),define("text!client.views/state-count-bar/state-count-bar.ng.html",[],function(){return'<div class="qv-state-count-bar" tid="stateCount" qva-direction x-dir-setting="{{options.direction}}">\n\t<div class="state selected" ng-style="{\'width\': percents.qSelected + \'%\'}"></div>\n\t<div class="state locked" ng-style="{\'width\': percents.qLocked + \'%\'}"></div>\n\t<div class="state optional" ng-style="{\'width\':  percents.qOption + \'%\'}"></div>\n\t<div class="state alternative" ng-style="{\'width\':  percents.qAlternative + \'%\'}"></div>\n</div>'}),define("client.views/state-count-bar/state-count-bar",["qvangular","text!./state-count-bar.ng.html"],function(a,b){"use strict";a.directive("qvStateCountBar",function(){return{restrict:"E",template:b,replace:!0,scope:{stateCounts:"=",options:"="},link:function(a){function b(){var b,c=a.stateCounts;c&&(b=d(c),a.percents=e(b))}function c(a){return Object.keys(a).reduce(function(b,c){return b+a[c]},0)}function d(a){var b=c(a),d={};return["qSelected","qLocked","qOption","qAlternative"].forEach(function(c){var e=a[c]||0,f=Math.round(e/b*100);e>0&&0===f&&(f=1),d[c]=f}),d}function e(a){var b,c,d={},e=0;for(b in a)d[b]=a[b],(!c||a[b]>a[c])&&(c=b),e+=a[b];return e>100&&(d[c]=a[c]-(e-100)),d}a.percents=[],a.$watchCollection("stateCounts",function(){b()})}}})}),define("client.views/current-selections/current-selections",["qvangular","text!./current-selections.ng.html","client.models/current-selections","core.utils/resize","general.utils/responsive-state","client.utils/state","util","client.utils/rtl/direction-service","objects/listbox-popover/listbox-popover-service","general.components/pager/pager","client.views/global-selections/global-selections-service","client.views/global-search/global-search-service","client.views/state-count-bar/state-count-bar","objects.views/charts/tooltip/chart-tooltip-service","client.views/current-selections/current-selections-service"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,b){return a.isPlaceHolder=!0,a.active=!1,a.qLocked=!1,a.feedbackActive=!1,a.translation="",a.qTotal=0,a.qStateCounts=0,b&&(a.qField=b),a}a.directive("qvSelectionPager",["qvGlobalSelectionsService","$timeout",function(a,b){return{restrict:"A",priority:1,link:function(c){var e=c.$watch(function(){return a.isSelectActive(c.app)},function(a){c.$emit("globalSelectionActive",a),b(function(){c.refreshPager(!1)})});d.on("end",function(){c.refreshPager(!1)}),c.$on("$destroy",function(){e()})}}}]);var j={template:b,replace:!0,restrict:"E",scope:{app:"="},link:function(b,c){function d(a){b.$watch(a.isModal.bind(a),function(a){b.inSelection=a,b.inSelection&&b.activeFieldName&&b.activeFieldName.length>0?b.cachedPlaceHolders=b.items.map(function(a){return i({},a.qField)}):(b.cachedPlaceHolders=[],b.items=b.items.filter(function(a){return!a.isPlaceHolder}))})}var g=a.getService("$timeout"),h=a.getService("qvGlobalSelectionsService"),j=a.getService("qvGlobalSearchService"),k=c.parent(),l=function(){g(function(){b.isSmallDevice=e.isSmallDevice})},m=function(){f.inSheetView()&&e.isSmallDevice&&j.openGlobalSearch(b.app,k)};b.isSmallDevice=e.isSmallDevice,b.cachedPlaceHolders=[],e.ViewChanged.bind(l),b.$watch("isSmallDevice",function(a){a===!0?j.openGlobalSearch(b.app,k):j.closeGlobalSearchIfNotActive()}),f.StateChanged.bind(m),b.mobileIndicatorTop=!1,b.mobileIndicatorShow=!1,h.setCsShowCallback(function(a){b.mobileIndicatorShow=a}),b.$on("globalSelectionActive",function(a,c){b.isGlobalSelectionsActive=c});var n=b.$watch("app",function(a){d(a),n()});b.$watch(function(){return j.isSearchActive(b.app)},function(a){b.isGlobalSearchActive=a}),b.toggleGlobalSelection=function(a){a.preventDefault(),h.toggleGlobalSelection(b.app)},b.toggleGlobalSearch=function(){j.toggleGlobalSearch(b.app,k)},b.$on("$destroy",function(){e.ViewChanged.unbind(l),j.off(),f.StateChanged.unbind(m),h.setCsShowCallback(null)})},controller:["$scope","$timeout","qvChartTooltipService","qvGlobalSelectionsService","qvCurrentSelectionsService",function(b,d,j,k,l){function m(){k.setCsShow(e.isSmallDevice&&b.items.length>0&&f.view!==f.Views.object)}var n,o,p=!1,q=a.getService("qvListboxPopoverService");b.items=[],b.disable={clear:!0,back:!0,forward:!0},c.get(b.app).then(function(a){b.model=a}),c.bindLayout(b,"model",function(a){b.disable.clear=0===a.qSelectionObject.qSelections.length||a.qSelectionObject.qSelections.every(function(a){return a.qLocked}),b.disable.back=0===a.qSelectionObject.qBackCount,b.disable.forward=0===a.qSelectionObject.qForwardCount,b.items=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex});var c=0;b.items.forEach(function(a){a.qLocked===!0&&c++,a.translation=l.translate(a)}),b.nbrSelections=b.items.length,k.setSelectionLockedCount(c,b.app),k.setSelectionCount(b.items.length,b.app),m(),b.cachedPlaceHolders.length>0&&b.activeFieldName&&b.activeFieldName.length>0&&(b.cachedPlaceHolders.forEach(function(a){a=i(a)}),b.items.forEach(function(a){b.cachedPlaceHolders.forEach(function(c,d){a.qField===c.qField&&(b.cachedPlaceHolders[d]=g.extend(!0,{},a))})}),b.items=b.cachedPlaceHolders),d(function(){b.$broadcast("refreshPager")})}),b.$watch(f.inObjectView,m),b.$watch("isSmallDevice",m),b.clear=function(a){b.$parent.itemSelected&&(b.$parent.itemSelected=!1),b.model.clearField(a)},b.clearAllFields=function(){b.model.clearAll()},b.back=function(){b.model.back()},b.forward=function(){b.model.forward()},b.showPopover=function(a){var c=angular.element(a.target).closest(".item"),e=c.scope().item.qField,f=c.scope().item.isPlaceHolder,g={qvaOutsideIgnoreFor:"currentSelectionsItems",$alignToElement:c,showLock:!0,direction:h.direction};return b.isClearSelectionIcon(a.target)?void(b.activeFieldName&&(q.close(),b.activeFieldName="")):e===b.activeFieldName||f?(q.close(),void(b.activeFieldName="")):(d(function(){b.closeTooltip()},100),b.activeFieldName=e,void q.showField(e,b.model.session.currentApp,g,{},function(){b.activeFieldName="",d(function(){b.closeTooltip()},100)}))},b.openTooltip=function(a,c){return b.isClearSelectionIcon(a.target)?void b.closeTooltip():void(p||Touche.utils.touch||(b.cancelTooltip(),n=d(function(){var b=c.qStateCounts.qSelected+c.qStateCounts.qSelectedExcluded+c.qStateCounts.qLocked+c.qStateCounts.qLockedExcluded;p=!0,j.open({content:[{header:c.qField+" ("+b+"/"+c.qTotal+")",rows:[{content:c.translation}]}],position:{x:a.clientX,y:a.clientY},alwaysOnTop:!0,direction:"bottom",template:"generic"})},500)))},b.closeTooltip=function(){p=!1,b.cancelTooltip(),j.close()},b.cancelTooltip=function(){d.cancel(n)},b.isClearSelectionIcon=function(a){return angular.element(a).closest(".remove").is(".remove")},o=a.$rootScope.$on("locked-feedback",function(c,d){b.items.forEach(function(c){d[0].indexOf(c.qField)!==-1&&(d[1]?c.feedbackActive=!1:c.feedbackActive=!0,a.$apply(b))})}),b.$on("$destroy",function(){o()})}]};return a.directive("qvStageCurrentSelections",function(){return j}),j}),define("qlik",["client.utils/state","apis/qutil","apis/qglobal","apis/qapp","apis/qnavigation","apis/qsession","apis/qlik-visual","assets/qlikui/custom-components","assets/leonardo-ui/leonardo-ui","general.utils/qv-activate","general.utils/qv-swipe","general.utils/qv-longtapswipe","objects/object","client.views/current-selections/current-selections","core.utils/augment","angular-route","angular-animate","angular-sanitize"],function(a,b,c,d,e,f,g){"use strict";
function h(a,b){d.setErrorCallback(a),j||f.setupSocketErrorHandling(a,b)}var i,j=b.inClient();j||(a.setState(a.States.analysis),a.setView(a.Views.sheet)),i=new e(j),g.init();var k={openApp:d.openApp,currApp:d.currApp,getGlobal:c.get,setOnError:h,setLanguage:b.setLanguage,table:d.table,getAppList:c.getAppList,resize:b.resize,getExtensionList:b.getExtensionList,callRepository:b.callRepository,registerExtension:b.registerExtension,navigation:i};return Object.defineProperty(k,"Promise",{get:function(){return b.Promise}}),define("qlik",k),require.s.contexts.sense&&(require.s.contexts._.defined.angular=require.s.contexts.sense.defined.angular),k}),define("extensions.qliktech/straight-table/straight-table-properties",["client.property-panel/default-properties","util","client.utils/property-resolver","translator","general.utils/attribute-expression-util"],function(a,b,c,d,e){var f={textAlignAuto:{ref:"qDef.textAlign.auto",type:"boolean",component:"switch",translation:"Common.Text.TextAlignment",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},textAlign:{ref:"qDef.textAlign.align",type:"string",component:"dropdown",options:[{value:"left",translation:"Common.Text.AlignLeft"},{value:"right",translation:"Common.Text.AlignRight"}],defaultValue:"left",show:function(a){return void 0!==a.qDef.textAlign&&!a.qDef.textAlign.auto}}},g={representationType:{ref:"qDef.representation.type",type:"string",component:"dropdown",translation:"Object.Table.Representation",options:[{value:"text",translation:"Object.Table.Representation.Text"},{value:"url",translation:"Object.Table.Representation.Url"}],defaultValue:"text",show:function(a){if("object"!=typeof a.qDef.representation){var b=a.qDef.representation||"text";a.qDef.representation={type:b}}return!0}},representationUrl:{ref:"qDef.representation.urlLabel",type:"string",translation:"Object.Table.Representation.Url.Label",defaultValue:"",show:function(a){var b=a.qDef.representation;return b&&"url"===b.type}}},h={tableCellColoring:{component:"attribute-expression-reference",defaultValue:[],ref:"qAttributeExpressions",items:[{component:"expression",ref:"qExpression",expressionType:"measure",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:"",id:e.IDMAP.CELL_BACKGROUND_COLOR,tid:"tableColorBgByExpression"},{component:"expression",ref:"qExpression",expressionType:"measure",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",id:e.IDMAP.CELL_FOREGROUND_COLOR,tid:"tableColorByExpression"}]},totalsAggr:{type:"items",items:{totalsAggrFunc:{type:"string",component:"dropdown",ref:"qDef.qAggrFunc",translation:"Object.Table.AggrFunc",options:[{value:"Expr",translation:"Common.Auto"},{value:"Avg",translation:"Object.Table.AggrFunc.Avg"},{value:"Count",translation:"Object.Table.AggrFunc.Count"},{value:"Max",translation:"Object.Table.AggrFunc.Max"},{value:"Min",translation:"Object.Table.AggrFunc.Min"},{value:"Sum",translation:"Object.Table.AggrFunc.Sum"},{value:"None",translation:"Object.Table.AggrFunc.None"}],defaultValue:"Expr"},totalsAggrFuncMessage:{component:"text",translation:"Object.Table.AggrFuncMessage",show:function(a,b){return b&&!c.getValue(b,"properties.totals.show")&&"noTotals"===c.getValue(b,"properties.totals.position")}}}}},i={tableCellColoring:{component:"attribute-expression-reference",defaultValue:[],ref:"qAttributeExpressions",items:[{component:"expression",ref:"qExpression",expressionType:"measure",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:"",id:e.IDMAP.CELL_BACKGROUND_COLOR,tid:"tableColorBgByExpression"},{component:"expression",ref:"qExpression",expressionType:"measure",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",id:e.IDMAP.CELL_FOREGROUND_COLOR,tid:"tableColorByExpression"}]}},j={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{totals:{ref:"totals.show",type:"boolean",translation:"properties.totals",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},totalsMode:{ref:"totals.position",translation:"Common.Position",type:"string",component:"dropdown",options:[{value:"noTotals",translation:"Common.None"},{value:"top",translation:"Common.Top"},{value:"bottom",translation:"Common.Bottom"}],defaultValue:"noTotals",show:function(a){return!a.totals.show}},totalsLabel:{ref:"totals.label",translation:"properties.totals.label",type:"string",expression:"optional",defaultValue:function(){return d.get("Object.Table.Totals")}}}}}},k={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},l={type:"items",component:"columns",translation:"Common.Data",sortIndexRef:"qHyperCubeDef.columnOrder",allowMove:!0,allowAdd:!0,addTranslation:"Common.Columns",items:{dimensions:{type:"array",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",grouped:!0,items:b.extend(!0,{},a.dimensions.items,i,f,g)},measures:{type:"array",component:"expandable-items",ref:"qHyperCubeDef.qMeasures",grouped:!0,items:b.extend(!0,{},a.measures.items,h,f)}}},m={uses:"sorting"};return{type:"items",component:"accordion",items:{data:l,sorting:m,addons:k,settings:j}}}),define("text!extensions.qliktech/straight-table/straight-table.ng.html",[],function(){return'<div class="qv-st" ng-class="{ \'qv-st-interactive\': interactive,\n\t\t\'align-column-picker\': scrollApi.settings.columnPicker.show,\n\t\t\'qv-st-selections-active\': selections.active,\n\t\t\'qv-st-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled,\n\t\t\'qv-st-navigatable\': navigatable,\n\t\t\'qv-rtl-layout\': rtl\n\t}">\n\t<div class="qv-st-header-wrapper">\n\t\t<qv-straight-table-column-width-adjuster\n\t\t\t\tmin-col-width="scrollApi.settings.column.minColWidth"\n\t\t\t\tng-if="navigatable && !selections.active"\n\t\t\t\tcolumns="columns"\n\t\t\t\texplicit-column-widths="explicitColumnWidths"\n\t\t\t\tx-rtl="rtl"\n\t\t\t\tdir="{{direction}}">\n\t\t</qv-straight-table-column-width-adjuster>\n\t\t<qv-straight-table-top-header></qv-straight-table-top-header>\n\t</div>\n\t<qv-scroll-area class="qv-grid-object-scroll-area qv-animate" dir="{{direction}}"\n\t\t\t\t\tx-direction="direction">\n\t\t<qv-straight-table-data qv-selections-select-while-locked="selectWhileLocked()"\n\t\t\t\t\t\t\t\tqv-selections-toggle-dimension-value="{ selector: \'.qv-st-data-cell\'}"\n\t\t\t\t\t\t\t\tqv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, $event)"\n\t\t\t\t\t\t\t\tqv-selections-multiselect="{ selector: \'.qv-st-data-cell:not(.qv-st-data-cell-null-value)\' }"\n\t\t\t\t\t\t\t\tqv-selections-start-multiselect="interactive && activateSelections(cell)"\n\t\t\t\t\t\t\t\tqv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\n\t\t\t\t\t\t\t\tqv-selections-end-multiselect="interactive && multiselect()"></qv-straight-table-data>\n\t</qv-scroll-area>\n\t<qv-straight-table-bottom-header></qv-straight-table-bottom-header>\n\t<qv-scroll-loader></qv-scroll-loader>\n\t<qv-straight-table-column-picker-activator ng-if="scrollApi.settings.columnPicker.show"></qv-straight-table-column-picker-activator>\n</div>\n'}),define("extensions.qliktech/straight-table/snapshot/snapshot-helper",["jquery"],function(a){function b(b,c,d,e){for(var f,g,h=d.top+d.height,i=0;i<b.length;){if(a(b[i]).offset().top+a(b[i]).height()>d.top){f=b[i];break}i++}for(i=b.length-1;i>=0;){if(a(b[i]).offset().top<h){g=b[i];break}i--}if(!f||!g||c<=0)return{index:1,height:e?2:1,width:c||1};var j=a(f).scope().row.getIndex(),k=a(g).scope().row.getIndex();return{index:j,height:k-j+1,width:c}}return{getIndexHeightAndWidth:b}}),define("objects.grid/data-grid",["core.utils/class","client.utils/rtl/rtl-util","general.utils/string-limits"],function(a,b,c){var d,e,f,g,h,i,j;return e=a.extend("ClassList",{init:function(){this.classList=[]},addClass:function(a){if(a){var b=this.classList.indexOf(a);return b===-1&&this.classList.push(a),this}},removeClass:function(a){if(a){var b=this.classList.indexOf(a);return b!==-1&&this.classList.splice(b,1),this}},hasClass:function(a){return this.classList.indexOf(a)!==-1}}),f=e.extend("Cell",{init:function(){this._super.apply(this,arguments),this.setDefaults()},setDefaults:function(){this.classList.length=0,this.style={},this.color={},this.colspan=1,this.rowspan=1,this.text="",this.displayText="",this.dataValue=-1,this.dataColIx=-10,this.dataRowIx=-1,this.isDimensionValue=!1,this.type=void 0,this.locked=!1,this.isNullValue=!1,this.value="",this.tid="",this.dir="auto",this.isRtl=!1,this.fieldName=""},setText:function(a,d){var e=b.detectTextDirection(a);this.text=a,this.displayText=a,!d&&a&&a.length>c.name&&(this.displayText=a.substring(0,c.name)+""),this.dir=b.supportDirAuto()?"auto":e,this.isRtl="rtl"===e},setData:function(a,b,c,d,e){this.setText(a),this.rowspan=b||1,this.colspan=c||1,this.dataRowIx=d||-1,this.dataColIx=e||-1},setHeader:function(a,b,c,d,e,f,g){this.setText(a),this.dataValue=b,this.rowspan=c||1,this.colspan=d||1,this.dataRowIx=e,this.dataColIx=f,this.templateSrc="pt-header-cell-item.ng.html",this.addClass("header"),this.setNullClass(g)},setTopHeader:function(){this.setHeader.apply(this,arguments),this.addClass("top")},setLeftHeader:function(){this.setHeader.apply(this,arguments),this.addClass("left")},setFromMetaHeader:function(a){Object.keys(a).forEach(function(b){this[b]=a[b]},this),this.setText(a.text),this.setTextAlign(a.autoAlignText,a.explicitTextAlign)},setNullClass:function(a){a&&(this.isNullValue=a,this.addClass("null-value"))}}),Object.defineProperties(f.prototype,{REPRESENTATION_URL:{value:"url"},REPRESENTATION_TEXT:{value:"text"}}),h=f.extend("StraightCell",{setDefaults:function(){this._super.apply(this,arguments),this.isNumeric=!1,this.textAlign="left",this.color.bgByExpression=!1,this.color.bgIsDark=!1,this.selected=!1,this.selectedHighlighted=!1,this.qvaOutsideIgnoreFor="",this.isSearchIcon=!1,this.open=!1,this.sortable=!1,this.isMeasure=!1,this.isSorted=!1,this.reversed=!1,this.isTotal=!1,this.isSelectLocked=!1,this.columnHighlighted=this.columnHighlighted||!1},getAutoTextAlign:function(){return this.isNumeric?"right":this.isRtl?"right":"left"},setTextAlign:function(a,b){this.textAlign=a?this.getAutoTextAlign():b||"left"}}),i=f.extend("PivotCell",{setDefaults:function(){this._super.apply(this,arguments),this.templateSrc="pt-cell-item.ng.html",this.collapseExpandClass="",this.isMeta=!1},setCollapseExpandClass:function(a){this.addClass("parent"),a.qCanExpand?this.collapseExpandClass="lui-icon--plus":a.qCanCollapse&&(this.collapseExpandClass="lui-icon--minus")},setEmpty:function(a,b,c){this.setHeader("",-4,a,b),this.addClass("empty"),this.addClass(c)}}),g=e.extend("Row",{init:function(a){this._super.apply(this,arguments),this.cells=[],this.style={},this.isBold=!1,this.classList=[],this.gridType=a,this.reset()},getIndex:function(){var a,b;for(b=0;b<this.cells.length;++b)if(a=this.cells[b],a.dataRowIx>=0)return a.dataRowIx;return-1},setNextCellIx:function(a){this.nextCellIx=a},reset:function(a){var b;for(this.nextCellIx=0,this.isBold=!1,a||(this.classList=[]),b=0;b<this.cells.length;++b)this.cells[b].setDefaults()},removeUnused:function(){this.cells.splice(this.nextCellIx,this.cells.length-this.nextCellIx)},_createCell:function(){switch(this.gridType){case"pivot":return new i;default:return new h}},getCell:function(a){return this.cells[a]||(this.cells[a]=this._createCell()),this.cells[a]},getNextCell:function(){var a;return this.cells[this.nextCellIx]?(a=this.cells[this.nextCellIx],a.setDefaults()):a=this.cells[this.nextCellIx]=this._createCell(),this.nextCellIx++,a},getCellSize:function(){return this.nextCellIx},addEmptyHeaderCell:function(a,b,c,d,e,f){var g=this.getNextCell();return g.setEmpty(c,d,e),g.setData("",c,d,a,b),g.setNullClass(f),g},addEmptyMetaCell:function(a,b,c){var d=this.addEmptyHeaderCell(-1,-1,a,b,c);return d.isMeta=!0,d},addEmptyDataCell:function(a,b){var c=this.getNextCell();return c.setData("",-4,a,b),c.addClass("empty"),c},addTotalCell:function(a,b,c){var d=this.getNextCell();return d.setHeader(a,-1,b,c),d.addClass("bold"),this.addClass("bold"),d},addLeftCollapseExpandCell:function(a,b,c,d){var e=this.getNextCell();return e.setLeftHeader("",-1,1,1,a,b),e.setCollapseExpandClass(c),e.setNullClass(d),e}}),j=a.extend("RowList",{init:function(a){this.rows=[],this.gridType=a},reset:function(a){this.rows.forEach(function(b){b.reset(a)}),this.nextRowIx=0},get:function(a){return this.rows[a]||(this.rows[a]=new g(this.gridType)),this.rows[a]},getNext:function(){var a=this.get(this.nextRowIx);return this.nextRowIx++,a},removeUnused:function(){this.rows.splice(this.nextRowIx,this.rows.length-this.nextRowIx),this.rows.forEach(function(a){a.removeUnused()})},setNextRowIx:function(a){this.nextRowIx=a}}),d=a.extend("DataGrid",{init:function(a){this.headerList=new j(a),this.rowList=new j(a),this.footerList=new j(a),this.gridType=a,this.reset()},setTopTreeDepth:function(a){this.topTreeDepth=a},setLeftTreeDepth:function(a){this.leftTreeDepth=a},reset:function(a,b){this.rowList.reset(),a||(this.headerList.reset(b),this.footerList.reset(b)),this.topTreeDepth=-1,this.leftTreeDepth=-1},getRowsByCellType:function(a){var b=[];return b=a===this.CELL_TYPE_DATA||a===this.CELL_TYPE_LEFT?this.rows:this.headerRows},getRow:function(a){return this.rowList.get(a)},getHeaderRow:function(a){return this.headerList.get(a)},getFooterRow:function(a){return this.footerList.get(a)},getNextRow:function(){return this.rowList.getNext()},getNextHeaderRow:function(){return this.headerList.getNext()},getNextFooterRow:function(){return this.footerList.getNext()},getCell:function(a,b){return this.getRow(a).getCell(b)},getHeaderCell:function(a,b){return this.getHeaderRow(a).getCell(b)},getFooterCell:function(a,b){return this.getFooterRow(a).getCell(b)},removeUnused:function(){this.rowList.removeUnused(),this.headerList.removeUnused(),this.footerList.removeUnused()},getNextRowIx:function(){return this.rowList.nextRowIx},setNextRowIx:function(a){this.rowList.setNextRowIx(a)},setNextHeaderIx:function(a){this.headerList.setNextRowIx(a)}}),Object.defineProperties(d.prototype,{headerRows:{get:function(){return this.headerList.rows}},footerRows:{get:function(){return this.footerList.rows}},rows:{get:function(){return this.rowList.rows}},GRID_TYPE_STRAIGHT:{value:"straight"},GRID_TYPE_PIVOT:{value:"pivot"},CELL_TYPE_TOP:{value:"top"},CELL_TYPE_LEFT:{value:"left"},CELL_TYPE_DATA:{value:"data"}}),d}),define("objects.grid/services/data-service",["qvangular","translator","general.utils/color","encoder","general.utils/attribute-expression-util"],function(a,b,c,d,e){"use strict";function f(a,b){var c,d=[],e=a.length,f=b.length;for(c=0;c<e;++c)d.push(c);for(c=0;c<f;++c)d.push(e+c);return d}function g(a,b){var c,d,e,f,g=[];for(d=a.rows.length,c=0;c<d;++c)f=a.rows[c],e=f.cells.length,b<e&&b>=0&&g.push(f.cells[b]);return g}function h(a,b,c,d){var e,f,g=i(a,b,c),h=g.length,j=[];for(f=0;f<h;++f)e=g[f],e.dataValue===d&&j.push(e);return j}function i(a,b,c){var d,e,f,g,h=a.getRowsByCellType(b),i=h.length,j=null,k=[];for(d=0;d<i;++d)for(f=h[d],g=f.cells.length,e=0;e<g;++e)j=f.cells[e],j.type===b&&j.dataColIx===c&&k.push(j);return k}function j(a,b,c){var d,e,f,g,h,i=a.getRowsByCellType(b),j=i.length,k=[];for(d=0;d<j;++d)for(f=i[d],h=f.cells.length,e=0;e<h;++e)g=f.cells[e],g.type===b&&g.dataRowIx===c&&k.push(g);return k}function k(a,b,c,d){var e,f,g,h,i=a.getRowsByCellType(b),j=i.length,k=null;for(e=0;e<j;++e)for(g=i[e],h=g.cells.length,f=0;f<h;++f)if(k=g.cells[f],k.dataColIx===c&&k.dataRowIx===d)return k;return null}function l(a,b){return b.type===a.CELL_TYPE_LEFT||b.type===a.CELL_TYPE_DATA?i(a,b.type,b.dataColIx):j(a,b.type,b.dataRowIx)}function m(a,b,c){var d,e,f=l(a,b),g=f.length,h=[];for(e=0;e<g;++e)d=f[e],d.dataValue===c&&h.push(d);return h}function n(a,b){var c=b.qHyperCube.qDimensionInfo.length;return b.qHyperCube.columnOrder?a<c?b.qHyperCube.qDimensionInfo[a]:b.qHyperCube.qMeasureInfo[a-c]:{othersLabel:!1,qLocked:!1}}function o(a,b){var c=b.qGrandTotalRow[a-b.qDimensionInfo.length];return c&&c.qText||(c={qText:""}),c}function p(a){if(a)return"qDimensionType"in a}function q(a){return void 0===a.textAlign||a.textAlign.auto}function r(a){return a.textAlign&&a.textAlign.align}function s(a){var b=a.representation;return b?"object"!=typeof b?{type:b}:b:{}}function t(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r;for(j=0;j<f.length;++j)k=f[j],r=x(k)||!!i,q=h.getDimInfo(h.leftDimCnt+d),l=e.getHeaderRow(a),m=l.getNextCell(),m.type=e.CELL_TYPE_TOP,m.locked=!A(k)&&q.qLocked,m.isDimensionValue=!(A(k)||v(k)||r||y(k)),n=k.qText,v(k)&&(o=h.leftCellCnt+b,o>=h.pseudoDimIndex&&o--,n=h.layout.qHyperCube.qDimensionInfo[o].othersLabel),m.setTopHeader(n,k.qElemNo,1,1,b,g+c,w(k)),(r||k.qCanCollapse||k.qCanExpand)&&(m.addClass("bold"),m.setCollapseExpandClass(k),l.addClass("bold")),k.qSubNodes.length?(p=t(a+1,b+1,c,d+1,e,k.qSubNodes,g,h,r),m.colspan=p-c,c=p):c++;return c}function u(a,b,c,d){d.dataColumnsInfo.cnt<=0||(t(1,0,0,0,a,b,c,d),a.setNextHeaderIx(a.topTreeDepth+1),a.headerRows[a.topTreeDepth].addClass("last-top-row"))}function v(a){return a.qElemNo===-3}function w(a){return a.qElemNo===-2}function x(a){return a.qElemNo===-1}function y(a){return a.qElemNo===-4}function z(a){return x(a)||y(a)}function A(a){return"P"===a.qType}function B(a){return a.qCanCollapse||a.qCanExpand||a.qSubNodes.length&&!A(a.qSubNodes[0])}function C(a,b){return 0===a&&(x(b)||A(b))||!z(b)&&!A(b)}function D(a,b,c,d,e,f,g,h){var i,j=0,k=e.getRow(a),l=g.getDimInfo(c),m=!(A(d)||v(d)||x(d)||w(d)),n=!!l&&l.qLocked;return c>0&&(i=k.addEmptyHeaderCell(f+a,b,1,c,"left",w(d)),i.type=e.CELL_TYPE_LEFT,i.isDimensionValue=m,i.locked=n,i.dataValue=d.qElemNo),(d.qCanCollapse||d.qCanExpand)&&(i=k.addLeftCollapseExpandCell(f+a,b,d,w(d)),i.type=e.CELL_TYPE_LEFT,i.isDimensionValue=m,i.locked=n,i.dataValue=d.qElemNo,j=-1),i=k.getNextCell(),i.type=e.CELL_TYPE_LEFT,i.isDimensionValue=m,i.locked=n,h=h||d.qText,v(d)&&(h=l.othersLabel),i.setLeftHeader(h,d.qElemNo,1,g.leftCellCnt-c+j,f+a,b,w(d)),(x(d)||B(d))&&(i.addClass("bold"),k.addClass("bold")),i}function E(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o;for(l=0;l<e.length;++l)m=e[l],C(b,m)&&(f=m,g=b,h=c),b>0&&A(m)&&(i=m),m.qSubNodes.length?(o=c+(b>0&&A(m)?0:1),a=E(a,b+1,o,d,m.qSubNodes,f,g,h,i,j,k)):(n=f.qText,i&&(n+=w(f)?" ":" - "+i.qText,i=null),D(a,g,h,f,d,j,k,n),++a);return a}function F(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s=0;for(h=0;h<d.length;++h)if(i=d[h],r=x(i)||!!g,o=f.getDimInfo(b),p=!A(i)&&!v(i)&&!r,q=!!o&&o.qLocked,j=c.getRow(a),y(i)?(k=j.getNextCell(),k.type=c.CELL_TYPE_LEFT,k.dataValue=i.qElemNo,k.isDimensionValue=p,k.locked=q,k.setLeftHeader("",-4,1,2)):(k=j.getNextCell(),k.type=c.CELL_TYPE_LEFT,k.isDimensionValue=p,k.locked=q,(i.qCanCollapse||i.qCanExpand)&&(l=k,l.setLeftHeader("",i.qElemNo,1,1,e+a,b,w(i)),l.setCollapseExpandClass(i),k=j.getNextCell(),k.type=c.CELL_TYPE_LEFT,k.isDimensionValue=p,k.locked=q,s=1),n=i.qText,v(i)&&(n=o.othersLabel),k.setLeftHeader(n,i.qElemNo,1,2-s,e+a,b,w(i)),r&&(k.addClass("bold"),j.addClass("bold"))),i.qSubNodes.length)m=F(a,b+1,c,i.qSubNodes,e,f,r),k.rowspan=m-a,l&&(l.rowspan=k.rowspan),a=m;else{var t=f.leftCellCnt-2*(b+1);t>0&&(k=j.getNextCell(),k.type=c.CELL_TYPE_LEFT,k.dataValue=i.qElemNo,k.isDimensionValue=p,k.locked=q,k.setLeftHeader("",-4,1,t)),++a}return a}function G(a,b,c,d){d.isIndentMode?E(0,0,0,a,b,null,-1,-1,null,c,d):F(0,0,a,b,c,d)}function H(a,b){var d,e;a.style.backgroundColor="",a.color.bgByExpression=!1,a.color.bgIsDark=!1,"U"!==b.qType&&b.qAttrExps&&b.qAttrExps.qValues&&b.qAttrExps.qValues.length&&(a.color.bgByExpression=!0,e="NaN"!==b.qAttrExps.qValues[0].qNum?b.qAttrExps.qValues[0].qNum:b.qAttrExps.qValues[0].qText,d=new c(e,"argb"),d.isInvalid()||(a.style.backgroundColor=d.toRGBA(),a.color.bgIsDark=d.isDark()&&d.getAlpha()>.5,a.addClass(a.color.bgIsDark?"color-light":"color-dark"))),a.style.color="",b.qAttrExps&&b.qAttrExps.qValues&&b.qAttrExps.qValues.length>1&&(e="NaN"!==b.qAttrExps.qValues[1].qNum?b.qAttrExps.qValues[1].qNum:b.qAttrExps.qValues[1].qText,d=new c(e,"argb"),d.isInvalid()||(a.style.color=d.toRGBA()))}function I(a,b,c,d,e){var f,g,h,i,j,k,l;for(f=0,h=b.length;f<h;++f)for(k=a.getNextRow(),0===a.leftTreeDepth&&k.addEmptyHeaderCell(c+f,d,1,1),i=Math.min(e.dataColumnsInfo.cnt,b[f].length),0===i&&0===f&&k.cells[0].addClass("first-data-cell"),g=0;g<i;++g)l=k.getNextCell(),l.type=a.CELL_TYPE_DATA,j=b[f][g],l.setData(j.qText,1,1,c+f,d+g),l.addClass("data"),0===f&&0===g&&l.addClass("first-data-cell"),"U"===j.qType&&l.setNullClass(!0),isNaN(j.qNum)||l.addClass("numeric"),k.hasClass("bold")&&l.addClass("bold"),H(l,j)}function J(a,b,c,d,e,f,g,h){var i,j,k,l,m,n;for(i=0;i<g;++i){for(k=b.getRow(c+i),m=f&&f[i]?f[i].length:1,j=0;j<m;++j)l=k.getCell(d+j),l.rowspan=1,l.colspan=1,l.style.backgroundColor="",l.style.color="",l.color.bgByExpression=!1,l.color.bgIsDark=!1,n=f&&f[i]&&f[i][j],n?L(b,l,n,a,e,i,j,h):l.setDefaults();k.setNextCellIx(d+j)}b.setNextRowIx(c+i)}function K(a,b,d){var f=e.getIndexById(b.qAttrExprInfo,d);if(f!==-1){var g="NaN"!==a.qAttrExps.qValues[f].qNum?a.qAttrExps.qValues[f].qNum:a.qAttrExps.qValues[f].qText;return new c(g,"argb")}return!1}function L(a,b,f,g,h,i,j,k){var l,m,o,t=h?h.qLeft+j:null,u=n(t,g),v=new c(255,255,255,1),w=s(u);if(b.colspan=p(u)?2:1,b.type=a.CELL_TYPE_DATA,b.isOtherCell=f.qIsOtherCell,b.isTotalCell=f.qIsTotalCell,b.representation=b.REPRESENTATION_TEXT,b.isNumeric=!isNaN(f.qNum),b.setText(f.qText),b.setTextAlign(q(u),r(u)),b.isOtherCell)b.setText(u.othersLabel),b.setTextAlign(q(u),r(u));else switch(w.type){case"url":try{w.urlLabel&&(b.setText(w.urlLabel),b.setTextAlign(q(u),r(u))),b.url=d.encodeForHref(f.qText),b.representation=b.REPRESENTATION_URL}catch(x){b.url=""}}b.locked=u.qLocked,b.dataValue=f.qElemNumber,b.dataColIx=t,b.dataRowIx=k?h.qTop+h.qHeight-i-1:h.qTop+i,b.isNumeric=!isNaN(f.qNum),b.isNullValue=b.isDimensionValue?b.dataValue===-2:f.qIsNull,b.isDimensionValue=!b.isNullValue&&p(u),b.selected=!1,b.selectedHighlighted=!1,b.isNullValue||(l=K(f,u,e.IDMAP.CELL_BACKGROUND_COLOR),l&&!l.isInvalid()&&(b.color.bgByExpression=!0,b.style.backgroundColor=l.toRGBA(),b.color.bgIsDark=l.isDark()&&l.getAlpha()>.5,m=c.getBlend(v,new c(l._r,l._g,l._b,1),l._a),b.color.fadeFromColor=new c(m._r,m._g,m._b,0).toRGBA(),b.color.fadeToColor=m.toRGBA(),1===a.headerRows.length&&(o=a.getHeaderRow(0).cells.filter(function(a){return a.dataColIx===b.dataColIx})[0],o.color.bgIsDark=l.isDark()))),l=K(f,u,e.IDMAP.CELL_FOREGROUND_COLOR),l&&!l.isInvalid()&&(b.style.color=l.toRGBA())}function M(a,b){var c,d,e;c=a.getHeaderRow(0),b.dataColumnsInfo.cnt>0&&b.leftCellCnt>0&&(d=c.addEmptyMetaCell(a.topTreeDepth+1,b.leftCellCnt,"left-meta"),d.templateSrc="pt-meta-left.ng.html",d.addClass("meta")),b.dataColumnsInfo.cnt>0&&(e=c.addEmptyMetaCell(1,b.dataColumnsInfo.cnt),e.addClass("top-meta").addClass("meta"),e.templateSrc="pt-meta-top.ng.html")}function N(a,b){return b.length?N(a+1,b[0].qSubNodes):a}function O(a,c){function d(){return c.qHyperCube.qMeasureInfo.length>0&&c.qHyperCube.qGrandTotalRow.length>0}function e(){return d()&&c.totals&&(c.totals.show||"noTotals"!==c.totals.position)}function f(){return!(e()&&c.totals&&!c.totals.show&&"bottom"===c.totals.position)}var g,h,i,j,k,l,m=a.headerRows[0].getCellSize();if(e()&&f())h=a.getNextHeaderRow();else{if(!e())return;h=a.getNextFooterRow()}for(g=0;g<m;++g)k=a.getHeaderCell(0,g),k.isSearchIcon||(j=h.getNextCell(),j.type=a.CELL_TYPE_TOP,j.tid=k.isSearchIcon?"st.total.search":"st.total",j.colIx=g,j.style={},j.colspan=k.isDimension?2:1,j.isDimension=!f()&&k.isDimension,j.isMeasure=k.isMeasure,k.isMeasure?(i=o(k.dataColIx,c.qHyperCube),l=i.qText,j.isNumeric=!0):(l=0===g?void 0!==c.totals.label?c.totals.label:b.get("Object.Table.Totals"):"",j.isNumeric=!1),j.setText(l),k.info&&j.setTextAlign(q(k.info),r(k.info)),j.isTotal=!0)}function P(a,b){var c,d,e,f=b.length;for(d=a.getNextHeaderRow(),c=0;c<f;++c)e=d.getNextCell(),e.type=a.CELL_TYPE_TOP,e.setFromMetaHeader(b[c])}function Q(a,b,c){a.tid="st.header",a.qvaOutsideIgnoreFor="",a.isSearchIcon=!1,a.open=!1,a.canCollapse=!1,a.canExpand=!1,a.rowspan=1,a.colspan=1,a.color={},b?(a.isFillColumn=!0,a.text="",a.sortable=!1,a.isDimension=!1,a.isSorted=!1,a.reversed=!1,a.style={width:"auto"}):(a.isNumeric="N"===a.info.qDimensionType||void 0===a.info.qDimensionType,a.locked=a.info.qLocked,a.text=a.info.qFallbackTitle,a.sortable=!0,a.dataColIx=a.qLeft,a.isDimension=!!a.info.qDimensionType,a.fieldName=a.isDimension?a.info.qGroupFieldDefs[a.info.qGroupPos]:"",a.isMeasure=!a.isDimension,a.isSorted=a.dataColIx===c[0],a.reversed=!!a.info.qReverseSort,a.sortIndicator=a.info.qSortIndicator,a.autoAlignText=q(a.info),a.explicitTextAlign=r(a.info),a.color={})}function R(){var a={glyphCntRange:{min:0,ok:0,max:1e5}};return Q(a,!0,[]),a}function S(a,b,c,d,e,f,g){var h,i,j,k=g.column.glyphWidth,l=Math.ceil(g.column.minColWidth/k),m=Math.ceil(g.column.maxColWidth/k),n=[],p=[],q=[],r=Math.ceil(g.column.paddingWidth/k),t=Math.floor(a/k),u=5,v=b>0?Math.round(10*(b/k))/10:NaN,w=3,x=Math.max(w,d.qApprMaxGlyphCount),y=Math.max(w,d.qFallbackTitle.length),z=0;if(n.push(w),c){var A=o(e,f);p.push(A.qText.length)}else{var B=s(d);"url"===B.type&&B.urlLabel&&(x=B.urlLabel.length),p.push(x),z=Math.ceil(g.column.minSearchWidth/k)}return n.push(m),n.push(t-r-z),p.push(y+z),q.push(y+z),h=Math.min.apply(null,n),p.push(h),i=Math.max.apply(null,p),q.push(i),j=Math.max.apply(null,q),{min:Math.max(l+z,h)+r,ok:Math.min(m,i)+r,optimal:j+r+u,explicit:v,search:z}}function T(a,b,c,d,e){function f(a){return a<n.length?n[a]:p[a-n.length]}var g,h,i,j,k,l,m=a.columnOrder,n=a.qDimensionInfo,p=a.qMeasureInfo,q=d.column.glyphWidth,r=Math.floor(c/q);for(e||(e=[]),l=0;l<m.length&&(d.useHorizontalScroll||r>0)&&(k=f(m[l]),h=m[l]>=n.length,i=S(c,b[l],h,k,m[l],a,d),j=i.min,!(!d.useHorizontalScroll&&r-j<0&&e.length>0));++l)r-=j,g=e[l],g||(g={},g.style={},e.push(g)),g.info=k,g.isDimension=m[l]<n.length,g.isMeasure=h,g.grandTotal=o(m[l],a),g.qLeft=m[l],g.glyphCntRange=i,Q(g,!1,a.qEffectiveInterColumnSortOrder);return e}function U(a,b){var c,d,e,f=0,g=a.length;for(c=0;c<g;c++)d=c-f,e=a[d],e.isDimension||e.isMeasure||(a.splice(d,1),f++);for(;a.length>b;)a.pop()}function V(a,b,c,d,e,f){var g,h,i,j,k=c.useHorizontalScroll?c.width:c.width-c.columnPicker.width,l=a.qHyperCube.columnOrder,m=c.column.glyphWidth,n=m/k,o=1;for(e&&U(e,l.length),c.columnPicker.show=!1,T(a.qHyperCube,b,k,c,e),c.columnCount=e.length,c.columnPicker.show=e.length<l.length,h=e.length,g=0;g<h;g++)i=e[g],i.widthFactor=i.glyphCntRange.min*m/k,o-=i.widthFactor;if(o>0){var p;if(j=o,c.useAllSpace){var q=(j-.015)/h;e.forEach(function(a){a.widthFactor+=q,o=0})}else p=e.reduce(function(a,b){return a+b.glyphCntRange.ok-b.glyphCntRange.min},0),e.forEach(function(a){var b=a.glyphCntRange.ok-a.glyphCntRange.min,c=b/p,d=Math.min(b*m/k,c*j);b>0&&(d>o?(a.widthFactor+=o,o=0):(a.widthFactor+=d,o-=d))})}if(o>0){var r;r=e.concat().sort(function(a,b){return a.glyphCntRange.optimal-a.glyphCntRange.ok-(b.glyphCntRange.optimal-b.glyphCntRange.ok)}),r.forEach(function(a){var b=a.glyphCntRange.optimal-a.glyphCntRange.ok,c=Math.min(o,b*n);b>0&&(c>o?(a.widthFactor+=o,o=0):(a.widthFactor+=c,o-=c))})}return o=Z(e,c),X(e,k,c.column.minSearchWidth/k,d),W(e,k,f,c),e}function W(a,b,c,d){var e,f,g,h=0;for(f=0;f<a.length;++f)e=a[f],e.isFillColumn?g=e:(e.calculatedWidth=Math.round(b*e.widthFactor),d.useHorizontalScroll&&e.calculatedWidth<d.column.minColWidth&&(e.calculatedWidth=d.column.minColWidth),c&&e.isSearchIcon?(e.style.width="1px",h+=1):(e.style.width=e.calculatedWidth+"px",h+=e.calculatedWidth));d.useHorizontalScroll&&g&&(g.style={width:b-h+"px"})}function X(a,b,c,d){var e,f,g,h=0,i=Math.round(b*c);for(e=0,f=a.length;e<h+f;++e)g=a[e],g.isDimension&&(a.splice(e+1,0,Y(g,i,c,d)),g.widthFactor=Math.max(0,g.widthFactor-c),++h)}function Y(a,b,c,d){return{isSearchIcon:!0,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+d,tid:"st.header.search",widthFactor:a.shouldBeRemoved?0:c,calculatedWidth:a.shouldBeRemoved?0:b,style:{width:b+"px"},fieldName:a.fieldName,dataColIx:a.dataColIx,colspan:1}}function Z(a,b){var c,d,e=1,f=b.width,g=b.column.glyphWidth,h=b.column.minSearchWidth/f,i=.01,j=0,k=!1;a.forEach(function(a){return a.shouldBeRemoved=!1,k?(a.widthFactor=0,void(a.shouldBeRemoved=!0)):void(a.glyphCntRange.explicit?(c=a.glyphCntRange.explicit*g/f,a.isDimension&&(c+=h),j=e-c,j>=0||b.useHorizontalScroll?(a.widthFactor=c,e-=a.widthFactor):(d=a.glyphCntRange.min*g/f,e-d>-i?(a.widthFactor=e,e-=a.widthFactor):(a.widthFactor=e,a.shouldBeRemoved=!0,k=!0))):(d=a.glyphCntRange.min*g/f,e>=a.widthFactor||b.useHorizontalScroll?e-=a.widthFactor:e-d>-i?(a.widthFactor=e,e-=a.widthFactor):(a.widthFactor=e,a.shouldBeRemoved=!0,k=!0)))});var l=b.columnCount;if(a.forEach(function(b,c){b.shouldBeRemoved&&(l--,c>0&&(a[c-1].widthFactor+=b.widthFactor),b.widthFactor=0)}),b.columnPicker.show||l===b.columnCount||(b.columnPicker.show=!0),!b.columnPicker.show){var m=a.reduceRight(function(a,b){return a?a:b.widthFactor>0&&b},!1);m&&(m.widthFactor+=b.columnPicker.width/f)}b.columnCount=l;var n=R();return a.push(n),e}a.service("qvGridObjectDataService",function(){return{getTopTreeDepth:function(a){return N(0,a.qTop)},getLeftTreeDepth:function(a){return N(0,a.qLeft)},updatePivotItems:function(a,b,c,d){var e=a.layout,f=a.grid,g=b[0].qTop,h=b[0].qLeft,i=b[0].qData,j=N(0,g),k=N(0,h),l=c[0],m=a.metaGhostHeaders,n=e.qHyperCube.qIndentMode,o=this.getPseudoDimIndex(e);f.reset(!1,d,o,n),f.setTopTreeDepth(j),f.setLeftTreeDepth(k),M(f,m),u(f,g,l.qLeft,m),G(f,h,l.qTop,m),I(f,i,l.qTop,l.qLeft,m),f.removeUnused()},updateStraightItems:function(a,b,c,d,e,f){var g,h,i,j,k,l=a.layout,m=a.grid,n=b.length+1;for(d||m.reset(f),f||(P(m,c),O(m,l)),g=m.getNextRowIx(),k=0;k<n;++k)b[k]?(i=b[k].qMatrix,j=b[k].qArea,h=i.length):(i=null,j=null),J(l,m,g,k,j,i,h,e);d&&m.setNextRowIx(m.rows.length),m.removeUnused()},getPseudoDimIndex:function(a){var b=a.qHyperCube.qEffectiveInterColumnSortOrder.indexOf(-1);return~b?b:a.qHyperCube.qEffectiveInterColumnSortOrder.length},getColumnInfo:n,getColumnCells:g,getCellsInColumnWithValue:h,getCellsInColumn:i,getCellsInRow:j,getSiblingCells:l,getSiblingCellsWithValue:m,getCellInColumnWithRowIndex:k,columnOrder:{get:f},getStraightMetaHeaders:V}})}),define("objects.grid/services/selections",["qvangular","util","objects.grid/services/data-service","objects.grid/directives/selections"],function(a,b){"use strict";a.service("qvGridObjectSelectionService",["$timeout","$document","qvGridObjectDataService",function(a,c,d){var e;return e={$new:function(){var a={active:!1,currentDataColIx:-1,currentDataRowIx:-1,currentCell:void 0,activationCell:void 0,dataValues:{},unbindKeyboard:null};return Object.defineProperties(a,{dataValuesArray:{get:function(){var a,b=[],c=Object.keys(this.dataValues),d=c.length;for(a=0;a<d;++a)b.push(parseInt(c[a]));return b}},selectedIndices:{get:function(){var a,b=[],c=this.dataValuesArray,d=c.length;for(a=0;a<d;++a)b.push(this.dataValues[c[a]]);return b}}}),a},init:function(a,b,c,d,f,g){a.confirm=function(){b.endSelections(!0),a.deactivated(),e.reset(c),e.hide(c),d()},a.cancel=function(){b.endSelections(!1),a.deactivated(),e.reset(c),e.hide(c),f()},a.clear=function(){c.dataValues={},g(),e.reset(c),b.clearSelections(),a.selectionsMade=!1}},reset:function(a){a.dataValues={},a.currentDataColIx=-1,a.currentDataRowIx=-1,a.currentCell=void 0},show:function(a,c){a.active||(a.currentDataColIx=c.dataColIx,a.currentDataRowIx=c.dataRowIx,a.activationCell=b.extend(!0,{},c),a.active=!0)},hide:function(a){a.active=!1},bindKeyboard:function(a,b){var d=".selections-keyboard-"+b;return c.on("keyup"+d,function(b){27===b.which?a.cancel():13===b.which&&a.confirm()}),function(){c.off(d)}},isColumnar:function(a,b){return b.type===a.CELL_TYPE_LEFT||b.type===a.CELL_TYPE_DATA},selectValue:function(a,b,c){c.dataValues[b.dataValue]=e.isColumnar(a,b)?b.dataRowIx:b.dataColIx,
c.currentDataColIx=b.dataColIx,c.currentDataRowIx=b.dataRowIx},selectCell:function(a,b,c){a.gridType===a.GRID_TYPE_PIVOT?(b[c?"addClass":"removeClass"]("selected-highlighted"),b[c?"removeClass":"addClass"]("selected")):(b.selectedHighlighted=!!c,b.selected=!c)},lockCell:function(a,b){a.gridType===a.GRID_TYPE_PIVOT?b.addClass("locked"):b.isSelectLocked=!0},deselectValue:function(a,b,c){delete c.dataValues[b.dataValue]},deselectCell:function(a,b){a.gridType===a.GRID_TYPE_PIVOT?(b.removeClass("selected-highlighted"),b.removeClass("selected")):(b.selectedHighlighted=!1,b.selected=!1)},unlockCell:function(a,b){a.gridType===a.GRID_TYPE_PIVOT?b.removeClass("locked"):b.isSelectLocked=!1},removeCellStyle:function(a){(a.color.bgByExpression||a.style.color)&&(a.styleCache={style:a.style,bgByExpression:a.color.bgByExpression},a.style="",a.color.bgByExpression=!1)},restoreCellStyle:function(a){a.styleCache&&(a.style=a.styleCache.style,a.color.bgByExpression=a.styleCache.bgByExpression,delete a.styleCache)},getSelectionType:function(a,b){var c={};return c[a.CELL_TYPE_TOP]="T",c[a.CELL_TYPE_LEFT]="L",c[a.CELL_TYPE_DATA]="D",c[b]},sendSelection:function(a,b,c,d,f){var g,h,i,j=c.selectedIndices;0!==j.length&&(e.isColumnar(d,c.currentCell)?(g=[c.currentDataColIx],h=c.selectedIndices):(g=c.selectedIndices,h=[c.currentDataRowIx]),i=e.getSelectionType(d,f.type),b.selectionsMade=!0,a.select(h,g,i).then(function(a){a.qSuccess||b.clear()}))},getCellCountWithDataValue:function(a,b,c){var d,f,g,h=[],i=0,j=b.length;if(0===j)return 0;for(g=0;g<j;++g)f=b[g],d=e.isColumnar(a,f)?f.dataColIx:f.dataRowIx,f.dataValue===c&&h.indexOf(d)===-1&&(h.push(d),i++);return i},getSiblingCell:function(a,b){return a.gridType===a.GRID_TYPE_PIVOT?b.currentCell:b.activationCell},selectDimensionCells:function(a,c,f,g,h,i){var j,k,l=h.dataValue,m=l in f.dataValues,n=d.getSiblingCells(g,e.getSiblingCell(g,f)||h);if(n.indexOf(h)!==-1&&(k=h.type===g.CELL_TYPE_TOP?a.getSize().qcx:a.getSize().qcy,j=e.getCellCountWithDataValue(g,n,l),k!==j||!i||!m))return n.forEach(function(a){a.dataValue in f.dataValues&&e.selectCell(g,a)}),i&&m?(e.deselectValue(g,h,f),n.forEach(function(a){a.dataValue===l&&e.deselectCell(g,a)})):m?i||(n.forEach(function(a){a.dataValue===l&&e.selectCell(g,a)}),e.selectCell(g,h,!0)):(e.selectValue(g,h,f),n.forEach(function(a){a.dataValue===l&&e.selectCell(g,a)}),e.selectCell(g,h,!0)),f.currentCell=b.extend(!0,{},h),function(){0===f.dataValuesArray.length?c.clear():e.sendSelection(a,c,f,g,h)}},selectDimensionValue:function(a,b,c,d,f,g,h){var i,j=e.activateSelections(a,b,c,d,f);return f.locked||f.isNullValue||(i=e.selectDimensionCells(b,c,d,g,f,h),i&&i()),j},activateSelections:function(b,c,d,f,g){return f.active||g.locked||(c.beginSelections(),e.show(f,g),f.unbindKeyboard=e.bindKeyboard(d,b),a(function(){d.activated(!0)})),function(){f.unbindKeyboard()}},updateStraight:function(a,b,c){var f,g,h,i;if(b.dataValuesArray.length)for(i=d.getSiblingCells(a,c),h=i.length,f=0;f<h;++f)g=i[f],g.dataValue in b.dataValues&&(e.selectCell(a,g),b.currentDataRowIx===g.dataRowIx&&e.selectCell(a,g,!0))},updatePivot:function(a,b,c){var f,g,h,i;if(b.dataValuesArray.length)for(i=d.getSiblingCells(a,c),h=i.length,f=0;f<h;++f)g=i[f],g.dataValue in b.dataValues&&e.selectCell(a,g)}}}])}),define("objects.grid/services/column-highlight-service",["qvangular","objects.grid/services/data-service"],function(a){"use strict";a.service("qvGridColumnHighlightService",["qvGridObjectDataService",function(a){function b(a,b){var c=b.filter(function(b){return b.text===a});return 1===c.length?c[0].dataColIx:-1}var c;return c={grid:null,headers:[],init:function(a,b){this.grid=a,this.headers=b},highlightColumnByName:function(c,d){1===arguments.length&&(d=!0);var e=b(c,this.headers),f=a.getCellsInColumn(this.grid,"data",e);f.forEach(function(a){a.columnHighlighted=d})},resetHighlightedColumns:function(){var b,c=this.headers.length;for(b=0;b<c;++b)a.getColumnCells(this.grid,b).forEach(function(a){a.columnHighlighted=!1})}}}])}),define("text!extensions.qliktech/straight-table/layout/top/straight-table-top-header.ng.html",[],function(){return'<div class="qv-st-header" tid="qv-st-header-top" ng-style="scrollApi.topBottomStyle">\n\t<table\tdir="{{direction}}"\n\t\t\tqva-delegated-activate=".qv-st-header-sortable:not(.qv-st-custom-header)#interactive && !selections.active && sortHeader($event);\n\t\t   .qv-st-header-cell-search:not(.qv-st-total-cell)#interactive && !selections.active && searchHeader($event)">\n\t\t<colgroup class="qv-st-columns">\n\t\t\t<col ng-repeat="header in grid.headerRows[0].cells"\n\t\t\t\t ng-style="header.style"\n\t\t\t\t ng-class="header.classList"/>\n\t\t</colgroup>\n\t\t<tbody>\n\t\t<tr ng-repeat="row in grid.headerRows">\n\t\t\t<th ng-repeat="header in row.cells"\n\t\t\t\ttid="{{header.tid}}"\n\t\t\t\tclass="qv-st-header-cell"\n\t\t\t\tqva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\n\t\t\t\tng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\n\t\t\t\t\t\'qv-st-custom-header\': !!options.customHeader,\n\t\t\t\t\t\'qv-st-header-sortable\': header.sortable,\n\t\t\t\t\t\'qv-st-total-cell\': header.isTotal,\n\t\t\t\t\t\'qv-st-header-cell-dimension\': header.isDimension,\n\t\t\t\t\t\'qv-st-header-cell-search\': header.isSearchIcon,\n\t\t\t\t\t\'qv-st-header-cell-search-open\': header.isSearchIcon && header.open }"\n\t\t\t\tcolspan="{{header.colspan}}">\n\t\t\t\t<qv-straight-table-header-cell ng-if="!header.isSearchIcon"></qv-straight-table-header-cell>\n\t\t\t\t<qv-straight-table-header-cell-search ng-if="!header.isTotal && header.isSearchIcon"></qv-straight-table-header-cell-search>\n\t\t\t</th>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/top/straight-table-top-header",["qvangular","jquery","text!./straight-table-top-header.ng.html"],function(a,b,c){"use strict";a.directive("qvStraightTableTopHeader",function(){return{restrict:"E",replace:!0,template:c,link:function(a){a.sortHeader=function(c){var d=b(c.target).scope().header;a.sort(d)},a.searchHeader=function(c){var d=b(c.target).closest(".qv-st-header-cell"),e=d.scope().header;c.preventDefault(),a.search(d,e)}}}})}),define("text!extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell.ng.html",[],function(){return'<div class="qv-st-header-cell-wrapper" ng-style="{height: customHeaderHeight}">\n\t<div class="qv-st-fade-out"\nng-if="!options.hasCustomHeader"\n\t\t ng-class="{ \'qv-st-header-selections-active\': header.selectionsActive, \'qv-rtl-text\': header.isRtl }"\n\t\t ng-style="{ \'textAlign\': header.textAlign }">\n\t\t<i ng-class="{\'lui-icon\': header.locked, \'lui-icon--lock\': header.locked }"></i><span dir="{{header.dir}}" ng-attr-title="{{header.text}}" ng-bind="header.text"></span>\n\t</div>\n\n\t<i ng-if="header.isSorted && header.sortIndicator !== \'N\' && !options.hasCustomHeader"\n\t   class="qv-st-sorting-indicator"\n\t   ng-class="{ \'lui-icon lui-icon--triangle-top\': header.sortIndicator === \'A\', \'lui-icon lui-icon--triangle-bottom\': header.sortIndicator === \'D\', \'icon-triangle-light\': header.color.bgIsDark && !header.reversed }"\n\t   ng-style="header.sortStyle"></i>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell",["qvangular","text!./straight-table-header-cell.ng.html","general.utils/responsive-state"],function(a,b,c){"use strict";a.directive("qvStraightTableHeaderCell",[function(){return{restrict:"E",replace:!0,template:b,link:function(b,d){var e=d.closest(".qv-st-header-cell");if(b.options.customHeader){b.customHeaderHeight=b.options.customHeader.height;var f=a.getService("$compile");b.dmmodel=b.options.customHeader.model,d.append(f(b.options.customHeader.template)(b))}b.$watch("!header.isTotal && selections.currentDataColIx === header.dataColIx",function(a){return a?(b.header.addClass("qv-st-active-col"),void(b.selectionsApi.getDockToElement=function(){var a=b.rtl?e.next():e;return c.isSmallDevice?d.closest(".qv-object").parent():a})):void(b.selections.currentDataColIx!==-1&&b.header.removeClass("qv-st-active-col"))})}}}]),a.directive("qvStraightTableHeaderCellSearch",[function(){return{restrict:"E",replace:!0,template:'<i class="lui-icon  lui-icon--search" q-title-translation="Common.Search"></i>',link:function(a,b){var d=b.closest(".qv-st-header-cell");a.$watch("!header.isTotal && selections.currentDataColIx === header.dataColIx",function(b){return b?(a.header.addClass("qv-st-active-col"),void(a.selectionsApi.getSelectionToolbarWidthOffset=function(){var b=a.rtl?d.prev():d;return c.isSmallDevice?0:b[0].getBoundingClientRect().width+1})):void(a.selections.currentDataColIx!==-1&&a.header.removeClass("qv-st-active-col"))})}}}])}),define("text!extensions.qliktech/straight-table/layout/data/straight-table-data.ng.html",[],function(){return'<div class="qv-st-data" tid="qv-st-data">\n\t<qv-scroll-load-button\n\t\t\tclass="qv-st-load-prev"\n\t\t\tdisabled="!navigatable"\n\t\t\tng-show="scrollApi.loadPrevious && scrollApi.settings.columnCount > 0 && ( navigatable || !isLoadPrevVisible )"\n\t\t\ton-load="scrollApi.gotoPreviousBlock()"\n\t\t\ttext="Object.Listbox.LoadPrevious"\n\t\t\tprevious="true">\n\t</qv-scroll-load-button>\n\t<table ng-style="dataTableHeight"\n\t\t   dir="{{direction}}">\n\t\t<colgroup class="qv-st-columns">\n\t\t\t<col ng-repeat="header in grid.headerRows[0].cells"\n\t\t\t\t ng-style="header.style"\n\t\t\t\t ng-class="header.classList"/>\n\t\t</colgroup>\n\t\t<tbody>\n\t\t\t<tr ng-repeat="row in grid.rows" class="qv-st-data-row" ng-class="{ \'qv-grid-object-data-first-row\': $first, \'qv-grid-object-data-last-row\': $last }">\n\t\t\t\t<td ng-repeat="cell in row.cells" class="qv-st-data-cell"\n\t\t\t\t\trowspan="{{ cell.rowspan }}"\n\t\t\t\t\tcolspan="{{ cell.colspan }}"\n\t\t\t\t\tng-style="!cell.selected && !cell.selectedHighlighted && cell.style"\n\t\t\t\t\tng-class="{ \'qv-st-data-cell-dimension-value\' : cell.isDimensionValue,\n\t\t\t\t\t\t\'qv-st-data-cell-numeric\': cell.isNumeric,\n\t\t\t\t\t\t\'qv-st-data-cell-selected\': cell.selected,\n\t\t\t\t\t\t\'qv-st-data-cell-selected-highlighted\': cell.selectedHighlighted,\n\t\t\t\t\t\t\'qv-st-data-cell-null-value\': cell.isNullValue,\n\t\t\t\t\t\t\'qv-st-data-cell-locked\': cell.isSelectLocked,\n\t\t\t\t\t\t\'qv-st-data-cell-color-dark\': cell.color.bgByExpression && !cell.color.bgIsDark,\n\t\t\t\t\t\t\'qv-st-data-cell-color-light\': cell.color.bgByExpression && cell.color.bgIsDark,\n\t\t\t\t\t\t \'qv-st-data-cell-column-highlighted\': cell.columnHighlighted}">\n\t\t\t\t<qv-straight-table-data-cell></qv-straight-table-data-cell>\n\t\t\t</td>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t<qv-scroll-loader class="qv-scroll-row-loader"></qv-scroll-loader>\n\t<qv-scroll-load-button\n\t\t\tclass="qv-st-load-next"\n\t\t\tng-show="scrollApi.loadNext && scrollApi.settings.columnCount > 0 && navigatable"\n\t\t\ton-load="scrollApi.gotoNextBlock()"\n\t\t\ttext="Object.Listbox.LoadMore">\n\t</qv-scroll-load-button>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/data/straight-table-data",["qvangular","text!./straight-table-data.ng.html"],function(a,b){"use strict";a.directive("qvStraightTableData",[function(){return{restrict:"E",replace:!0,template:b}}])}),define("text!extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell.ng.html",[],function(){return'<div ng-class="{ \'qv-st-fade-out\': !cell.color.bgByExpression, \'qv-st-fade-out-bgr-expr\': cell.color.bgByExpression, \'qv-rtl-text\': cell.isRtl }"\n\t ng-attr-title="{{cell.text}}"\n\t ng-style="{ \'textAlign\': cell.textAlign }"\n\t dir="{{cell.dir}}">\n\t<a ng-if="cell.representation === \'url\' && !selections.active" qva-activate="openUrl(cell.url)" ng-attr-title="{{cell.url}}" ng-bind="cell.displayText"></a>\n\t<span ng-if="cell.representation === \'text\' || cell.representation === \'url\' && selections.active" ng-bind="cell.displayText"></span>\n\t<div ng-if="cell.color.bgByExpression && !cell.isNumeric" class="qv-st-fade-out-bgr-expr-overlay" ng-attr-style="background-image: linear-gradient(to right, {{cell.color.fadeFromColor}}, {{cell.color.fadeToColor}});"></div>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell",["qvangular","text!./straight-table-data-cell.ng.html"],function(a,b){"use strict";a.directive("qvStraightTableDataCell",[function(){return{restrict:"E",replace:!0,template:b,link:function(){}}}])}),define("text!extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header.ng.html",[],function(){return'<div class="qv-st-bottom-header" tid="qv-st-bottom-header" ng-style="topBottomStyle">\n\t<table dir="{{direction}}">\n\t\t<colgroup class="qv-st-columns">\n\t\t\t<col ng-repeat="header in grid.headerRows[0].cells"\n\t\t\t\t ng-style="header.style"\n\t\t\t\t ng-class="header.classList" />\n\t\t</colgroup>\n\t\t<tbody>\n\t\t\t<tr ng-repeat="row in grid.footerRows">\n\t\t\t\t<th ng-repeat="header in row.cells"\n\t\t\t\t\ttid="{{header.tid}}"\n\t\t\t\t\tclass="qv-st-header-cell"\n\t\t\t\t\tng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\n\t\t\t\t\t\'qv-st-total-cell\': header.isTotal,\n\t\t\t\t\t\'qv-st-header-cell-dimension\': header.isDimension,\n\t\t\t\t\t\'qv-st-header-cell-measure\': header.isMeasure,\n\t\t\t\t\t\'qv-st-header-cell-search\': header.isSearchIcon }"\n\t\t\t\t\tcolspan="{{header.colspan}}">\n\t\t\t\t\t<qv-straight-table-header-cell></qv-straight-table-header-cell>\n\t\t\t\t</th>\n\t\t\t</tr>\n\t\t</tbody>\n\t</table>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header",["qvangular","text!./straight-table-bottom-header.ng.html"],function(a,b){"use strict";a.directive("qvStraightTableBottomHeader",function(){return{restrict:"E",replace:!0,template:b,link:function(){}}})}),define("client.property-panel/components/components",[],function(){function a(a){var b=a.component;if("string"==typeof b)return e[b]?e[b]:(window.console.log('Error! No component found with name "'+b+'"'),e.missing);if("object"==typeof b)return b;switch(a.type){case"items":return e.items;case"string":return e.string;case"integer":return e.integer;case"number":return e.number;case"boolean":return e.checkbox;case"array":return a.items?e.list:e.slider;default:return a.type?(window.console.log('Error! No component found for type "'+a.type+'"'),e.missing):(window.console.log('Warning! Missing component/type in definition. Using "items" component.'),e.items)}}function b(a){return e[a]}function c(a){return!!b(a)}function d(a,b){if(e[a])throw"Property panel component already loaded: "+a;e[a]=b}var e={missing:{template:"<div></div>",controller:[function(){}]}};return{getComponent:b,hasComponent:c,findComponent:a,addComponent:d}}),define("text!client.property-panel/popovers/type-popover.ng.html",[],function(){return'<immidiate-contextual width="150" align-to="alignTo" position="\'bottom\'" on-close-view="closeTypeFoldout(event)" qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}" class="pp-type-popover" tid="pp-type-popover">\n\t<ul class="qui-icontextlist">\n\t\t<li ng-repeat="item in items" tid="{{item.tid}}" ng-class="{ \'lui-disabled\': item.disabled() }" qva-activate="itemClicked($event,item);">\n\t\t\t<span class="qui-textlist-text" q-translation="{{item.translation}}"></span>\n\t\t</li>\n\t</ul>\n</immidiate-contextual>\n'}),define("client.property-panel/popovers/type-popover",["text!./type-popover.ng.html"],function(a){return{template:a,controller:["$scope",function(a){a.itemClicked=function(a,b){a.preventDefault(),b.disabled()||b.select()}}],scope:{items:"=",alignTo:"=",closeTypeFoldout:"=",qvaOutsideIgnoreFor:"="}}}),define("general.sortable/sortable-list-constants",[],function(){var a={};return Object.defineProperties(a,{ENTER_BEFORE:{value:0},ENTER_AFTER:{value:1},ENTER_SWAP:{value:2},TYPEFLAG_PLACEHOLDER:{value:16},TYPEFLAG_LOCKED:{value:32}}),a}),define("general.sortable/sortable-list-service",["jquery","qvangular","general.sortable/sortable-list-constants"],function(a,b,c){"use strict";b.service("qvSortableListDragService",[function(){var b;return b={$new:function(a){return{fromItem:void 0,enterItem:void 0,enterList:void 0,toItem:void 0,toList:void 0,offsetX:0,offsetY:0,left:0,top:0,direction:void 0,clientRect:void 0,scroll:{},pageX:0,pageY:0,zIndex:a.zIndex,enterItemAction:void 0}},startOffset:function(a,b,c,d){var e=c.offsetParent(),f=c.position();b.left=f.left+e[0].scrollLeft,b.top=f.top+e[0].scrollTop,b.offsetX=b.left-d.x-e[0].scrollLeft,b.offsetY=b.top-d.y-e[0].scrollTop},startData:function(a,b,c,d){b.scroll.clientRect=a[0].getBoundingClientRect(),b.scroll.width=a[0].scrollWidth,b.scroll.height=a[0].scrollHeight,b.clientRect=c[0].getBoundingClientRect(),b.minLeft=-b.clientRect.width,b.maxLeft=b.scroll.width,b.minTop=-b.clientRect.height,b.maxTop=b.scroll.height-b.clientRect.height,b.fromItem=c.scope()[d],b.toItem=void 0,b.toList=void 0,b.enterItem=void 0,b.enterList=void 0,b.enterItemAction=void 0},updateDragCoordinates:function(a,b,c,d){d=d||a.scroll.clientRect,a.pageX=b,a.pageY=c,a.pageX<=d.left?a.pageX=d.left+1:a.pageX>=d.left+d.width&&(a.pageX=d.left+d.width-1),a.pageY<=d.top?a.pageY=d.top+1:a.pageY>=d.top+d.height&&(a.pageY=d.top+d.height-1)},updateEnterItemAction:function(a,b){var d,e,f,g=b[0].getBoundingClientRect();switch(a.direction){case"horizontal":d=a.pageX,e=g.left,f=g.width;break;case"vertical":d=a.pageY,e=g.top,f=g.height;break;default:return}d<=e+.5*f?a.enterItemAction=c.ENTER_BEFORE:d>e+.5*f&&(a.enterItemAction=c.ENTER_AFTER)},updateData:function(c,d,e,f,g,h,i,j,k){function l(a){return a.length&&b.isChild(c[0],a[0])}function m(a){return"function"==typeof g?g(a):a.scope()[g]}var n,o,p,q,r=d.enterItemAction,s=function(){},t=e[0].style.display;e[0].style.display="none",o=document.elementFromPoint(d.pageX,d.pageY),n=a(o).closest(h),l(n)?s=function(a){p=a.scope()[i],b.updateEnterItemAction(d,a),(d.enterItem!==p||d.enterItem===p&&r!==d.enterItemAction)&&(d.enterList=void 0,d.enterItem=p,j())}:(n=a(o).closest(f),l(n)?s=function(a){q=m(a),d.enterList!==q&&(d.enterList=q,d.enterItem=void 0,k())}:(d.enterItem=void 0,d.enterList=void 0)),e[0].style.display=t,s(n)},start:function(a,b,c){c[0].style||(c[0].style=""),c[0].style.position="absolute",c[0].style.width=b.clientRect.width+"px",c[0].style.height=b.clientRect.height+"px",c[0].style.pointerEvents="none",c[0].style.left=b.left+"px",c[0].style.top=b.top+"px",c[0].style.zIndex=b.zIndex},update:function(a,b,c,d){var e,f;switch(b.direction){case"horizontal":b.left=d.currentPoint.x+b.offsetX+a[0].scrollLeft;break;case"vertical":b.top=d.currentPoint.y+b.offsetY+a[0].scrollTop;break;default:b.left=d.currentPoint.x+b.offsetX+a[0].scrollLeft,b.top=d.currentPoint.y+b.offsetY+a[0].scrollTop}e=b.left,f=b.top,b.left<b.minLeft?e=b.minLeft:b.left>b.maxLeft&&(e=b.maxLeft),b.top<b.minTop?f=b.minTop:b.top>b.maxTop&&(f=b.maxTop),c[0].style.left=e+"px",c[0].style.top=f+"px"},end:function(a,b){a.stopAutoScrolling&&(a.stopAutoScrolling(),a.stopAutoScrolling=null),b&&b.length&&b[0].removeAttribute("style")},isParent:function(a,b){return a===b},isChild:function(a,c){var d=c;if(b.isParent(a,c))return!1;for(;d;){if(d===a)return!0;d=d.parentNode}return!1},autoScroll:function(a,b,c,d,e,f,g,h){function i(e,g){if(k=a.scrollLeft,l=a.scrollTop,j){if(e<0&&0===k)return void(j=!1);if(e>0&&k+parseInt(b.height+.5,10)>=c)return void(j=!1);if(g<0&&0===l)return void(j=!1);if(g>0&&l+parseInt(b.height+.5,10)>=d)return void(j=!1);0!==e&&(a.scrollLeft+=e),0!==g&&(a.scrollTop+=g),f(),setTimeout(function(){i(e,g)})}}var j=!0,k=0,l=0,m=0,n=0;switch(e.direction){case"horizontal":e.pageX<=b.left+h?m=-g:e.pageX>=b.left+b.width-h&&(m=g);break;case"vertical":e.pageY<=b.top+h?n=-g:e.pageY>=b.top+b.height-h&&(n=g);break;default:e.pageY<=b.top+h?n=-g:e.pageY>=b.top+b.height-h&&(n=g)}return 0===m&&0===n||i(m,n),e.stopAutoScrolling&&(e.stopAutoScrolling(),delete e.stopAutoScrolling),e.stopAutoScrolling=function(){j=!1},e.stopAutoScrolling}}}])}),define("general.sortable/sortable-list",["core.utils/class","util","jquery","qvangular","touche","general.utils/dom-util","general.sortable/sortable-list-service"],function(a,b,c,d,e,f){"use strict";var g=a.extend("DefaultSortableList",{init:function(a,c){this.options=b.extend(!0,{gesture:{name:"swipe",options:{radiusThreshold:2,preventDefault:!1}},direction:"",scrollSelector:"",listSelector:"",listKey:"",itemSelector:"[ng-repeat]",itemDragSelector:"[ng-repeat]",itemKey:"$index",zIndex:1},a||{}),this.ctrl=c},onBegin:function(){},onEnter:function(){},onEnterList:function(){},onMove:function(){},onMoveToList:function(){},onCancel:function(){},onEnd:function(){},allowDrag:function(a){return e.utils.isMouse(a)?!!c(a.target).closest(this.options.itemSelector).length:!!c(a.target).closest(this.options.itemDragSelector).length},allowScroll:function(a){return!this.allowDrag(a)},allowEnter:function(){return!0},allowEnterList:function(){return!0},allowAutoScroll:function(){return!0},onAutoScroll:function(a){a()},getGesture:function(){return this.options.gesture},getDirection:function(){return this.options.direction},getScrollSensitivity:function(a){return e.utils.isMouse(a)?15:25},getScrollSpeed:function(a){return e.utils.isMouse(a)?15:25}});return d.directive("qvSortableList",["$parse","qvSortableListDragService",function(a,b){return{restrict:"A",controller:function(){},link:function(a,d,h,i){var j=a.$watch(h.qvSortableList,function(h){function k(){return n=void 0,e(d[0])[q.name](v).tap(u),e(m[0]).tap({id:"sortable-list-tap-"+a.$id,options:{preventDefault:!1},start:function(a){h.allowScroll(a)||f.isInput(a.target)||a.preventDefault()}}),function(){e(m[0]).off("*","sortable-list-tap-"+a.$id),e(d[0]).off("*",t)}}if(j(),h instanceof g)h.ctrl=i;else{var l=g.extend(h||{});h=new l(h&&h.options,i)}var m=d.closest(h.options.scrollSelector);m.length||(m=d);var n,o,p,q,r,s=b.$new(h.options),t="sortable-list-"+a.$id,u={id:t,options:{preventDefault:!1},start:function(a,d){if(n=void 0,!f.isInput(a.target)&&b.isChild(m[0],a.target)&&h.allowDrag(a)){if(n=c(a.target).closest(h.options.itemSelector),0===n.length)return void(n=void 0);s.direction=h.getDirection(),o=h.getScrollSpeed(a),p=h.getScrollSensitivity(a),b.startOffset(m,s,n,d.pagePoints[0]),b.startData(m,s,n,h.options.itemKey)}},end:function(){n=void 0}},v={id:t,start:function(c){return n?(c.preventDefault(),h.onBegin(s.fromItem,s.clientRect),a.$digest(),void b.start(m,s,n)):void this.cancel()},update:function(c,d){function e(){h.allowEnter(s.enterItem,s.fromItem)&&(s.toItem=s.enterItem,s.toList=void 0,h.onEnter(s.enterItem,s.enterItemAction),a.$digest())}function f(){h.allowEnterList(s.enterList,s.fromItem)&&(s.toItem=void 0,s.toList=s.enterList,h.onEnterList(s.enterList),a.$digest())}function g(){b.update(m,s,n,d.swipe),b.updateDragCoordinates(s,d.pagePoints[0].x,d.pagePoints[0].y,h.options.boundingRect),b.updateData(m,s,n,h.options.listSelector,h.options.listKey,h.options.itemSelector,h.options.itemKey,e,f)}if(!n)return void this.cancel();if(g(),h.allowAutoScroll()){var i=b.autoScroll.bind(this,m[0],s.scroll.clientRect,s.scroll.width,s.scroll.height,s,g,o,p);h.onAutoScroll(i,s.enterList,s.enterItem,function(a,c,d,e){b.autoScroll(a,c,d,e,s,g,o,p)})}},end:function(){b.end(s,n),void 0!==s.toItem?(h.onMove(s.fromItem,s.toItem),a.$digest()):void 0!==s.toList?(h.onMoveToList(s.fromItem,s.toList),a.$digest()):(h.onCancel(),a.$digest()),h.onEnd(),n=void 0},cancel:function(){n&&(b.end(s,n),h.onCancel(),n=void 0,a.$digest())}};q=h.options.gesture,v.options=q.options,a.$on("$destroy",function(){e(m[0]).off("*","sortable-list-tap-"+a.$id),e(d[0]).off("*",t)}),i.on=function(){r||(r=k())},i.off=function(){r&&(r(),r=void 0)},i.cancel=function(){v.cancel()},i.on()})}}}]),g}),define("general.sortable/sortable-item-lists",["core.utils/class","util","general.sortable/sortable-list","general.sortable/sortable-list-constants"],function(a,b,c,d){"use strict";var e=a.extend("SortableItemList",{init:function(a,b){this.items=[],this.disabled=!1,this.typeFlag=a||1,this.locked=!1,Object.keys(b||{}).forEach(function(a){this[a]=b[a]},this)},addSortableItem:function(a,b){Object.defineProperty(a,"__sortableItem__",{configurable:!1,enumerable:!0,writable:!0,value:{typeFlag:b||1}}),this.items.push(a)},moveItem:function(a,b){this.items.splice(b,0,this.items.splice(a,1)[0])},getIndexByItem:function(a){return this.items.indexOf(a)},get:function(a){return this.items.filter(a||function(){return!0})},getLockedIndices:function(){return this.get(function(a){return!!(a.__sortableItem__.typeFlag&d.TYPEFLAG_LOCKED)}).map(function(a){return this.getIndexByItem(a)},this)},reset:function(){this.items.length=0,this.disabled=!1},isEmpty:function(){return 0===this.items.length},setLocked:function(a){this.locked=a}});Object.defineProperties(e.prototype,{length:{get:function(){return this.items.length}}});var f=c.extend("SortableItemLists",{init:function(){this._super.apply(this,arguments),this.lists=[],this.dragPlaceholder=null},addPlaceholder:function(a){var c=this.getList(a),e=c.items.indexOf(a);return this.dragPlaceholder=b.extend(!0,{},a),this.dragPlaceholder.id="placeholder",this.dragPlaceholder.__sortableItem__.typeFlag=d.TYPEFLAG_PLACEHOLDER,this.dragPlaceholder.style={opacity:"0.3"},c.items.splice(e,0,this.dragPlaceholder),this.dragPlaceholder},removePlaceholder:function(){if(this.dragPlaceholder){var a=this.getList(this.dragPlaceholder),b=a?a.items.indexOf(this.dragPlaceholder):-1;b!==-1&&(a.items.splice(b,1),this.dragPlaceholder=null)}},getPlaceholder:function(){return this.dragPlaceholder},createList:function(a,b){var c=new e(a,b);return this.lists.push(c),c},reset:function(){this.lists.forEach(function(a){a.reset()})},getList:function(a){return this.lists.filter(function(b){return b.items.indexOf(a)!==-1})[0]},disable:function(a){this.lists.forEach(function(b){b.disabled=!(a.__sortableItem__.typeFlag&b.typeFlag)})},enable:function(){this.lists.forEach(function(a){a.disabled=!1})},getIndexOfItem:function(a){return this.getList(a).items.indexOf(a)},moveItem:function(a,b){var c,d,e=this.getList(a),f=this.getList(b);e&&f&&(d=f.items.indexOf(b),c=e.items.indexOf(a),e.items.splice(c,1),f.items.splice(d,0,a))},onBegin:function(a,b){this.addPlaceholder(a,b),this.disable(a)},onEnter:function(a,b){var c=this.getList(a),e=c.getLockedIndices();if(a!==this.dragPlaceholder){if(b===d.ENTER_BEFORE||b===d.ENTER_AFTER){var f,g,h=this.getList(this.dragPlaceholder);if(!h||!c)return;f=h.getIndexByItem(this.dragPlaceholder),h.items.splice(f,1),g=c.getIndexByItem(a),g+=b===d.ENTER_AFTER?1:0,c.items.splice(g,0,this.dragPlaceholder)}else this.moveItem(this.dragPlaceholder,a);var i=c.getLockedIndices();e.forEach(function(a,b){c.moveItem(i[b],a)})}},onEnterList:function(a){if(!a.disabled&&!a.locked){var b=this.getList(this.dragPlaceholder),c=b.getIndexByItem(this.dragPlaceholder);b.items.splice(c,1),a.items.push(this.dragPlaceholder)}},onMove:function(a){var b=this.dragPlaceholder;this.moveItem(a,b),this.removePlaceholder(),this.enable()},onMoveToList:function(a,b){if(!b.disabled&&!b.locked){var c=this.getList(a),d=c.items.indexOf(a);if(c===b)return void this.onMove(a,this.dragPlaceholder);c.items.splice(d,1),b.items.push(a)}this.removePlaceholder(),this.enable()},onCancel:function(){this.removePlaceholder(),this.enable()},allowEnter:function(a,b){var c=this.getList(a);return void 0!==c&&!c.disabled&&!c.locked&&!!(b.__sortableItem__.typeFlag&c.typeFlag)},allowEnterList:function(a,b){return!a.disabled&&!a.locked&&!!(b.__sortableItem__.typeFlag&a.typeFlag)}});return f.create=function(a){var b=f.extend(a||{});return a=new b(a&&a.options)},f}),define("extensions.qliktech/straight-table/properties/columns/columns-sorting-util",["general.utils/array-util"],function(a){function b(a){function b(){for(var a=[],b=0;b<d.length+e.length;b++)a.push(b);return a}var d=a.qDimensions,e=a.qMeasures;c(d,e,a.columnOrder)&&(a.columnOrder=b()),c(d,e,a.qInterColumnSortOrder)&&(a.qInterColumnSortOrder=b())}function c(a,b,c){var d={},e=[],f=!1;c.forEach(function(a){d[a]?f=!0:d[a]=!0}),f=f||a.length+b.length!==Object.keys(d).length,Object.keys(d).forEach(function(a){e.push(parseInt(a,10))}),e=e.sort(function(a,b){return a-b});for(var g=0;g<e.length;++g)f=f||e[g]!==g;return f}function d(c){function d(){for(var b=0;b<k.length;b++)if(k[b]!==b){var c=k[b],d=k.indexOf(b),e=k[d];a.swap(k,b,d),a.swap(g,c,e),a.swap(i,i.indexOf(c),i.indexOf(e)),a.swap(j,j.indexOf(c),j.indexOf(e))}}function e(){for(var b=0;b<l.length;b++)if(l[b]!==b+g.length){var c=l[b],d=l.indexOf(b+g.length),e=l[d];a.swap(l,b,d),a.swap(h,c-g.length,e-g.length),a.swap(i,i.indexOf(c),i.indexOf(e)),a.swap(j,j.indexOf(c),j.indexOf(e))}}b(c);for(var f,g=c.qDimensions,h=c.qMeasures,i=c.columnOrder,j=c.qInterColumnSortOrder,k=[],l=[],m=0;m<i.length;m++)f=i[m],f<g.length?k.push(f):l.push(f);d(),e()}function e(b,c,d){a.swap(b.columnWidths,c,d)}return{validateTableHyperCube:b,fixTableHypercubeOrders:d,isInvalidOrderArray:c,updateColumnInfoOrders:e}}),define("text!client.property-panel/components/common/data.ng.html",[],function(){return'<div class="pp-component pp-list-component pp-toplist" tcl="data">\n\t<button class="lui-button  lui-button--full-width  pp-toplist-add-button" qva-activate="addClicked($event)" qv-enter="addClicked($event)" qva-outside-ignore-for="{{\'addButton-\' + $id}}"\n\t\t\tng-disabled="addDisabled()" tid="add-data">\n\t\t<span class="lui-button__text">{{getAddLabel()}}</span>\n\t\t<i class="toggle-expand  lui-button__caret  lui-caret" ng-if="hasMultipleAddOptions()"></i>\n\t</button>\n\n\t<div class="pp-toplist-content pp-data-container" qv-sortable-list="sortableItemLists">\n\t\t<div class="pp-data" ng-repeat="list in sortableItemLists.lists" tid="{{list.tid}}" ng-class="{ \'disabled\': list.disabled }" ng-if="list.show() != false">\n\t\t\t<div class="pp-data-header ">\n\t\t\t\t<span class="pp-data-header-text">{{list.title}}</span>\n\t\t\t</div>\n\n\t\t\t<ul class="pp-expandable-list pp-data-list">\n\t\t\t\t<li ng-repeat="item in list.items track by item.id" ng-include src="item.templateSrc" ng-class="item.classList"></li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</div>\n'}),define("extensions.qliktech/straight-table/properties/columns/columns",["qvangular","jquery","touche","client.property-panel/components/components","general.utils/support","objects.error-handling/error-translation","translator","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover","client.property-panel/popovers/type-popover","client.utils/property-resolver","general.services/show-service/show-service","general.sortable/sortable-item-lists","extensions.qliktech/straight-table/properties/columns/columns-sorting-util","text!client.property-panel/components/common/data.ng.html","general.components/context-menu/context-menu-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return{name:"columns",template:o,controller:["$scope","$element","$timeout","qvGridObjectDataService",function(o,p,q,r){function s(a){if(o.adding)return void t();var c=b(a.currentTarget);H=l.show(j,{items:[{tid:"dimension",select:function(){A("dimension",c)},disabled:function(){return o.args.handler.getDimensions().length>=o.args.handler.maxDimensions()},translation:"Common.Dimension"},{tid:"measure",select:function(){A("measure",c)},disabled:function(){return o.args.handler.getMeasures().length>=o.args.handler.maxMeasures()},translation:"Common.Measure"}],closeTypeFoldout:t,alignTo:c,qvaOutsideIgnoreFor:"addButton-"+c.scope().$id}),o.adding=!0}function t(a){H&&(H.destroy(),H=null,o.adding=!1),a&&b(a.target).hasClass("pp-toplist-add-button")&&c.preventGestures(),o.addType=null}function u(){var a=k.getValue(o.data,o.definition.sortIndexRef);void 0===a?(a=r.columnOrder.get(o.args.handler.getDimensionLayouts(),o.args.handler.getMeasureLayouts()),k.setValue(o.data,o.definition.sortIndexRef,a),o.$emit("saveProperties")):a.length&&"number"!=typeof a[0]&&(k.setValue(o.data,o.definition.sortIndexRef,a.map(function(a){
return a.dataColIx})),o.$emit("saveProperties"))}function v(){u();var a=k.getValue(o.data,o.definition.sortIndexRef),b=o.data.qHyperCubeDef.qDimensions.length;if(o.sortableItemLists.reset(),a.forEach(function(a,c){var d,e,g,h,i;a<b?(e=a,g=o.data.qHyperCubeDef.qDimensions[e],h="dimension",i=g.qDef.cId,d=o.definition.items.dimensions):(e=a-b,g=o.data.qHyperCubeDef.qMeasures[e],i=g.qDef.cId,h="measure",d=o.definition.items.measures);var j={title:function(){var a;if("dimension"===h){var b=o.args.handler.getDimensionLayout(i);a=b&&b.qError?f.getDimensionError(b.qError.qErrorCode):g.qLibraryId?b&&b.title||"":b&&b.qFallbackTitle||""}else{var c=o.args.handler.getMeasureLayout(g.qDef.cId);a=c&&c.qError?f.getMeasureError(c.qError.qErrorCode):c&&c.qFallbackTitle||""}return a},isInvalid:function(){if("dimension"===h){var a=o.args.handler.getDimensionLayout(i);return a&&!!a.qError}var b=o.args.handler.getMeasureLayout(i);return b&&!!b.qError},component:G,definition:{type:"items",items:d.items},data:g,args:o.args,id:i,expanded:E.get(F+i)||!1,index:c,type:h,sourceIndex:e,dataColIx:a,templateSrc:"pp-data-item.ng.html",markerClass:"dimension"===h?"pp-dimension":"pp-measure",sortable:o.definition.allowMove!==!1};K.addSortableItem(j)}),K.isEmpty()){var c={id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1};K.addSortableItem(c)}}function w(a){o.args.handler.addFieldDimension(a.value,"").then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function x(a){o.args.handler.addLibraryDimension(a.libraryId).then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function y(a){o.args.handler.addLibraryMeasure(a.libraryId).then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function z(a){o.args.handler.addExpressionMeasure(a.value,"").then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function A(a,b){o.addType=a,t(),D(),"dimension"===a?(I=l.show(h,{alignTo:b,app:o.args.app,position:"bottom",closeAddPopover:B,addFieldDimension:w,addLibraryDimension:x}),o.adding=!0):I=l.show(i,{alignTo:b,app:o.args.app,position:"bottom",closeAddPopover:B,addLibraryMeasure:y,addExpressionMeasure:z})}function B(a){I&&(I.destroy(),I=null),a&&b(a.target).hasClass("pp-toplist-add-button")&&c.preventGestures(),o.adding=!1}function C(){q(function(){var a=p.find(".pp-toplist-content"),b=a.find(".pp-data-list").children().last();a[0].scrollTop=b[0].offsetTop-1},100)}function D(){K.items.forEach(function(a){a.expanded=!1,E.put(F+a.id,!1)})}var E=o.args.cache,F="columns_",G=d.getComponent("items");o.expandClicked=function(a,c){c.disabled||b(a.target).hasClass("pp-move-item")||(c.expanded=!c.expanded,E.put(F+c.id,c.expanded))};var H=null,I=null,J=null;o.addClicked=function(a){s(a)},o.hasMultipleAddOptions=function(){return!0},o.getAddLabel=function(){return g.get("properties.columns.add")},o.removeItem=function(a){"dimension"===a.type?o.args.handler.removeDimension(a.sourceIndex).then(function(){o.$emit("saveProperties")}):o.args.handler.removeMeasure(a.sourceIndex).then(function(){o.$emit("saveProperties")})},o.openContextMenu=function(b,c){var d=a.getService("qvContextMenu").menu();d.addItem({translation:"Common.Delete",tid:"delete",select:function(){o.removeItem(c)}}),J=a.getService("qvContextMenu").show(d,{position:{x:b.pageX,y:b.pageY},docking:"Top"})},o.$on("pp-open-path",function(a,b){var c=b.split("."),d=c[0],e=c[1];"columns"===d&&e&&(E.put(F+e,!0),C())}),o.add=function(a){a&&a.trim().length&&("measure"===o.addType?z({value:a,label:a}):"dimension"===o.addType&&w({value:a,label:a}))},o.sortableItemLists=m.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:e.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.classList=["qv-pp-sortable"]},onBegin:function(){this._super.apply(this,arguments),D()},onMove:function(){var a,b=this.getIndexOfItem(arguments[0]);this._super.apply(this,arguments),a=this.getIndexOfItem(arguments[0]),a<b&&b--,o.data.qHyperCubeDef.columnOrder=K.get().filter(function(a){return"empty-item"!==a.id}).map(function(a){return a.dataColIx}),n.fixTableHypercubeOrders(o.data.qHyperCubeDef),n.updateColumnInfoOrders(o.data.qHyperCubeDef,b,a),o.$emit("saveProperties")}});var K=o.sortableItemLists.createList(1,{title:g.get("Common.Columns"),tid:"columns"});o.$watchCollection("data.qHyperCubeDef.columnOrder",v),o.$watchCollection("data.qHyperCubeDef.qDimensions",v),o.$watchCollection("data.qHyperCubeDef.qMeasures",v),o.$on("$destroy",function(){t(),B(),J&&J.destroy()})}]}}),define("text!extensions.qliktech/straight-table/column-picker/column-picker.ng.html",[],function(){return'<div class="qv-st-column-picker"\n\t tid="qv-st-column-picker"\n\t qva-activate="interactive && !selections.active && toggleColumnPickerPopover();"\n\t qva-outside-ignore-for="{{columnPicker.qvaOutsideIgnoreFor}}"\n\t ng-class="{ \'qv-st-column-picker-open\': columnPicker.showPopover }">\n\t<table>\n\t\t<tr>\n\t\t\t<td q-title-translation="{{columnPicker.showPopover ? \'Tooltip.CloseColumnPicker\' : \'Tooltip.ColumnPicker\'}}">\n\t\t\t\t<div class="qv-st-column-picker-more"></div>\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n</div>\n'}),define("text!extensions.qliktech/straight-table/column-picker/column-picker-popover.ng.html",[],function(){return'<immidiate-contextual class="qv-st-column-picker-popover"\n\t\t\t\t\t  align-to="$alignColumnPickerTo"\n\t\t\t\t\t  position="\'left\'"\n\t\t\t\t\t  collision="\'flip fit\'"\n\t\t\t\t\t  width="180"\n\t\t\t\t\t  height="\'auto\'"\n\t\t\t\t\t  qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}"\n\t\t\t\t\t  on-close-view=" toggleColumnPickerPopover();"\n\t\t\t\t\t  qva-direction x-dir-setting="{{options.direction}}">\n\t<div class="qv-st-cp-header-wrapper"><p class="qv-st-cp-header" q-translation="Common.Columns"></p></div>\n\t<ul class="qv-st-cp-popover-list"\n\t\tqv-sortable-list="sortableItemLists">\n\t\t<li class="qv-st-cp-popover-list-item"\n\t\t\tdraggable="false"\n\t\t\tng-repeat="col in columnPicker.columns.items track by col.id"\n\t\t\tng-class="col.classList"\n\t\t\tng-style="col.style">\n\t\t\t<table class="qv-st-cp-popover-table" ng-if="col.id !== -2">\n\t\t\t\t<tr>\n\t\t\t\t\t<td ng-class="{ \'disabled\': col.disabled }">\n\t\t\t\t\t\t<div class="qv-st-cp-fade-out" ng-bind="col.title" qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{col.title}}"></div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td ng-if="col.id !== -2" class="qv-st-cp-handle">\n\t\t\t\t\t\t<div class="icon-handle"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</li>\n\t</ul>\n</immidiate-contextual>\n'}),define("extensions.qliktech/straight-table/column-picker/column-picker",["jquery","qvangular","text!./column-picker.ng.html","text!./column-picker-popover.ng.html","core.utils/resize","general.sortable/sortable-item-lists","general.sortable/sortable-list"],function(a,b,c,d,e,f){"use strict";return b.service("qvStraighTableColumnPickerService",["$document",function(b){var c,e,f=b.find("body");return e={show:function(e){return c=b.find(".qv-st-column-picker-popover"),c.length||(c=a("<div>")),c.showComponent({controller:function(){},template:d},e),c.appendTo(f),function(){c.remove()}}}}]),b.directive("qvStraightTableColumnPicker",function(){return{restrict:"A",require:"qvSortableList",link:function(a,b,c,d){a.columnPicker.cancel=function(){d.cancel()}}}}),b.directive("qvStraightTableColumnPickerActivator",["qvStraighTableColumnPickerService",function(a){return{restrict:"E",replace:!0,template:c,require:"^qvObjectContent",link:function(b,c,d,g){function h(){b.columnPicker.columns.get().forEach(function(a,c){b.scrollApi.settings.columnCount<c?a.disabled=!0:a.disabled=!1})}function i(){var a,c,d=b.layout.qHyperCube.qDimensionInfo,e=b.layout.qHyperCube.qMeasureInfo,f=d.length,g={};b.columnPicker.cancel(),b.columnPicker.columns.reset(),b.layout.qHyperCube.columnOrder.forEach(function(a){var c={id:a,classList:["qv-st-cp-sortable"]};a<f?c.title=d[a].qFallbackTitle:c.title=e[a-f].qFallbackTitle,b.columnPicker.columns.addSortableItem(c)}),g.title="",g.id=-2,g.classList=["qv-st-cp-divider"],g.isDivider=!0,b.columnPicker.columns.addSortableItem(g,32),a=b.columnPicker.columns.getIndexByItem(g),c=b.scrollApi.settings.columnCount,b.columnPicker.columns.moveItem(a,c),h()}function j(){e.off("start."+b.$id,j),b.columnPicker.showPopover&&(k(),b.columnPicker.showPopover=!1,b.$digest())}var k;b.sortableItemLists=f.create({options:{direction:"vertical",itemKey:"col",itemSelector:".qv-st-cp-sortable",itemDragSelector:".qv-st-cp-handle"},addPlaceholder:function(a,b){var c=this._super.apply(this,arguments);c.style.height=b.height,c.id=-1},onMove:function(){this._super.apply(this,arguments),h(),b.applyColumnOrderSoftPatch(!1,b.columnPicker.columns.get(function(a){return a.id>=0}).map(function(a){return a.id}))}}),b.columnPicker={showPopover:!1,columns:b.sortableItemLists.createList(),qvaOutsideIgnoreFor:"qv-st-column-picker-"+b.$id,cancel:function(){}},g.watchPaint(i),b.toggleColumnPickerPopover=function(){b.$alignColumnPickerTo=c,b.columnPicker.showPopover=!b.columnPicker.showPopover,b.columnPicker.showPopover?(i(),k=a.show({$alignColumnPickerTo:b.$alignColumnPickerTo,columnPicker:b.columnPicker,onMoveBegin:b.onMoveBegin,onMoveEnter:b.onMoveEnter,onMoveCancel:b.onMoveCancel,onMove:b.onMove,toggleColumnPickerPopover:b.toggleColumnPickerPopover,qvaOutsideIgnoreFor:b.columnPicker.qvaOutsideIgnoreFor,sortableItemLists:b.sortableItemLists,hc:b.layout.qHyperCube,options:b.options}),e.on("start."+b.$id,j)):k&&k()}}}}])}),define("text!extensions.qliktech/straight-table/column-width-adjuster/column-adjuster.ng.html",[],function(){return'<div class="column-width-adjuster">\n\t<qv-column-width-adjust-column ng-repeat="column in columns" column="column" explicit-column-width="explicitColumnWidths[$index]" x-rtl="rtl" min-col-width="minColWidth"></qv-column-width-adjust-column>\n</div>\n'}),define("text!extensions.qliktech/straight-table/column-width-adjuster/column-adjuster-column.ng.html",[],function(){return'<div class="column-width-adjust-column" ng-style="columnStyle" >\n\t<div class="column-width-adjust-line" ng-class="{active : isActive}"></div>\n</div>\n'}),define("extensions.qliktech/straight-table/column-width-adjuster/column-adjuster",["qvangular","text!./column-adjuster.ng.html","text!./column-adjuster-column.ng.html","touche"],function(a,b,c,d){"use strict";a.directive("qvStraightTableColumnWidthAdjuster",function(){return{restrict:"E",replace:!0,template:b,scope:{columns:"=",explicitColumnWidths:"=",rtl:"=",minColWidth:"="}}}),a.directive("qvColumnWidthAdjustColumn",function(){return{restrict:"E",scope:{column:"=",explicitColumnWidth:"=",rtl:"=",minColWidth:"="},template:c,replace:!0,link:function(a,b){var c,e="columnAdjuster",f=a.minColWidth||40;a.columnStyle={},a.$watch("column.left",function(){a.columnStyle.left=a.column.left+"px"}),a.$watch("column.hidden",function(){a.columnStyle.display=a.column.hidden?"none":"block"}),a.$on("$destroy",function(){d(b[0]).off("*",e)}),d(b[0]).swipe({id:e,options:{radiusThreshold:5,preventDefault:!1},start:function(){(a.explicitColumnWidth===-1||isNaN(a.explicitColumnWidth))&&(a.explicitColumnWidth=a.column.width),c=a.explicitColumnWidth},update:function(b,d){var e=(a.rtl?-1:1)*d.swipe.deltaX,g=Math.max(c+e,f);a.isActive||(a.isActive=!0),a.explicitColumnWidth=g,a.$apply(),a.$emit("onExplicitColumnChanging")},end:function(){a.isActive=!1,a.$emit("onExplicitColumnChanged")}}).doubletap({id:e,end:function(){a.isActive=!1,a.explicitColumnWidth=-1,a.$apply(),a.$emit("onExplicitColumnChanged")}})}}})}),define("extensions.qliktech/straight-table/straight-table",["jquery","qvangular","core.utils/deferred","objects.backend-api/hypercube-api","extensions.qliktech/straight-table/straight-table-properties","text!./straight-table.ng.html","objects.extension/base-controller","objects.extension/object-conversion","general.utils/array-util","extensions.qliktech/straight-table/snapshot/snapshot-helper","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.utils/event-utils","objects.grid/data-grid","general.utils/shapes/rect","objects.grid/services/data-service","objects.grid/services/selections","objects.grid/services/column-highlight-service","extensions.qliktech/straight-table/layout/top/straight-table-top-header","extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell","extensions.qliktech/straight-table/layout/data/straight-table-data","extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell","extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header","extensions.qliktech/straight-table/properties/columns/columns","extensions.qliktech/straight-table/column-picker/column-picker","extensions.qliktech/straight-table/column-width-adjuster/column-adjuster","objects/listbox-popover/listbox-popover-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q,r,s,t;return r=m.extend({init:function(a){this.visualizationCtrl=a},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(a,b){return this.visualizationCtrl.onVirtualScroll(a,b)},onInitialNativeScroll:function(a,b){return this.visualizationCtrl.onInitialNativeScroll(a,b)},onGotoNextBlock:function(a,b){return this.visualizationCtrl.onGotoNextBlock(a,b)},onGotoPreviousBlock:function(a,b){return this.visualizationCtrl.onGotoPreviousBlock(a,b)}}),s=l.extend({init:function(a,b,c,d,e,f,g){this.snapshotObject=g,this._super.apply(this,arguments)},getBoundingBox:function(){var a;return a=this.snapshotObject.freeResize?this.$element[0].getBoundingClientRect():{height:this.snapshotObject.size.h,width:this.snapshotObject.size.w}}}),q=g.extend({init:function(a,b,c,d,e){this.appliedSoftPatch=!1,this._paintWatches=[],this._resizeWatches=[],this.$element=b,this.horizontalScrollElement=this.$element.closest(".qv-object-content-container")[0],this.dataService=d,this.selectionService=e,this.$timeout=c,this.metaHeaders=[],this._super.apply(this,arguments),a.backendApi.setCacheOptions({width:1}),a.interactive=!1,a.isLoadPrevVisible=!1,a.direction=a.options.direction,a.rtl="rtl"===a.options.direction,a.$on("onExplicitColumnChanged",function(){a.applyColumnWidthSoftPatch(!1,a.explicitColumnWidths)}),a.$on("onExplicitColumnChanging",function(){var a=this.$scope;this.dataService.getStraightMetaHeaders(a.layout,a.explicitColumnWidths,a.scrollApi.settings,a.$id,this.metaHeaders,this.$scope.options.customHeader),this.updateColumnInfo(this.metaHeaders),this.metaHeaders.forEach(function(b,c){a.grid.headerRows[0].cells[c].style.width=b.style.width})}.bind(this))},setDirection:function(a){this._super(a),this.$scope.direction=this.$scope.options.direction,this.$scope.rtl="rtl"===this.$scope.options.direction,this.processResize()},watchPaint:function(a){var b=this;return b._paintWatches.push(a),function(){var c=b._paintWatches.indexOf(a);b._paintWatches.splice(c,1)}},watchResize:function(a){var b=this;return b._resizeWatches.push(a),function(){var c=b._resizeWatches.indexOf(a);b._resizeWatches.splice(c,1)}},update:function(a,b,d,e,f){f||(this.$scope.explicitColumnWidths=this.$scope.layout.qHyperCube.columnWidths.concat(),this.dataService.getStraightMetaHeaders(this.$scope.layout,this.$scope.explicitColumnWidths,this.$scope.scrollApi.settings,this.$scope.$id,this.metaHeaders,this.$scope.options.customHeader));var g=this.getDataInfo(a,b,this.metaHeaders),h=c();return this.$scope.backendApi.getData(g.rects).then(function(a){this.onUpdateData({dataPages:a,dataInfo:g},d,e,f).then(function(){h.resolve(a)})}.bind(this)),h.promise},updateLocked:function(a){var b,c,d,e,f,g,h,i=this.dataService,j=this.selectionService,k=this.$scope.selections,l=k.activationCell,m=[];if(l){for(b=a.getRowsByCellType(a.CELL_TYPE_DATA),f=i.getSiblingCells(a,l),c=b.length,h=0;h<c;++h)m=m.concat(b[h].cells);for(e=m.length,h=0;h<e;++h)d=m[h],g=f.indexOf(d)!==-1,g&&!d.isDimensionValue||!g&&!d.isMeta?j[l&&k.active?"lockCell":"unlockCell"](a,d):j[l&&k.active?"removeCellStyle":"restoreCellStyle"](d)}},getDataInfo:function(a,b,c){var d,e,f=c.length,g=[];for(d=0;d<f;++d)e=c[d],e.isSearchIcon||e.isFillColumn||(a>0&&a+b>this.$scope.scrollApi.totalRows&&(a=Math.max(0,this.$scope.scrollApi.totalRows-b)),g.push({qLeft:e.qLeft,qTop:a||0,qWidth:1,qHeight:b}));return g.length||g.push({qTop:0,qLeft:0,qWidth:0,qHeight:0}),{rects:g,metaHeaders:c}},updateColumnInfo:function(a){var b=this.$scope,c=b.scrollApi.settings,d=0,e=c.width-(c.columnPicker.show?c.columnPicker.width:0);b.columns||(b.columns=[]);var f,g,h,i=0,j=0;for(h=0,g=a.length;h<g;h++)f=a[h],f.isFillColumn||(f.isDimension?(i+=this.$scope.options.customHeader?h>0?f.calculatedWidth+1:f.calculatedWidth:f.calculatedWidth+a[h+1].calculatedWidth,h++):i+=f.calculatedWidth,b.columns[j]||(b.columns[j]={}),b.columns[j].width=f.calculatedWidth,b.columns[j].left=b.rtl?e-i:i,b.columns[j].hidden=f.shouldBeRemoved,d+=f.calculatedWidth,j++);this.horizontalScrollElement&&(c.useHorizontalScroll&&d>e+5?this.horizontalScrollElement.style.overflow="auto":this.horizontalScrollElement.style.overflow="")},onUpdateData:function(a,b,c,d){return c&&a.dataPages.forEach(function(a){a.qMatrix.reverse()}),this.dataService.updateStraightItems(this.$scope,a.dataPages,a.dataInfo.metaHeaders,b,c,d),this.updateColumnInfo(a.dataInfo.metaHeaders),c&&this.$scope.grid.rows.reverse(),this.$scope.selections.active&&(this.selectionService.updateStraight(this.$scope.grid,this.$scope.selections,this.$scope.selections.activationCell),this.updateLocked(this.$scope.grid)),this.$timeout(function(){},0,!1)},setSnapshotData:function(a){var b,c,d=!!a.sourceObjectId,e=this.$scope,f=e.scrollApi.domApi,g=f.getScrollAreaBoundingBox(),h=f.$scrollArea.find(".qv-st-data-row"),i=e.scrollApi.settings.columnCount;return b=j.getIndexHeightAndWidth(h,i,g,a.totals&&a.totals.show),this.dataService.getStraightMetaHeaders(this.$scope.layout,this.$scope.explicitColumnWidths,this.$scope.scrollApi.settings,this.$scope.$id,this.metaHeaders,this.$scope.options.customHeader),c=this.getDataInfo(b.index,b.height,this.metaHeaders),c.rects.splice(b.width),e.backendApi.getData(c.rects).then(function(b){a.qHyperCube.qDataPages=b;var f=e.layout.qHyperCube.columnOrder.slice(0,c.rects.length);return d||(a.qHyperCube.columnOrder=f),a})},getViewState:function(){return{virtualScrollPosition:this.$scope.scrollApi.virtualScrollApi.getVirtualPosition()}},process:function(a,b,c){return this.update(a,b,!1,!1,!1).then(function(){this.$scope.scrollApi.setTotalRows(this.$scope.layout.qHyperCube.qSize.qcy),this.$scope.scrollApi.setVirtualSize(c)}.bind(this))},processPaint:function(){this.$scope.scrollApi.updateViewport();var a,b=0,c=this.$scope.scrollApi.settings.viewportRowCount;return a=this.$scope.scrollApi.resetNativeScroll(),this.process(b,c,!1).then(function(){a()})},processResize:function(){var a=this.$scope.grid.rows.length,b=a?this.$scope.grid.rows[0].getIndex():0,c=this.$scope.scrollApi.settings.viewportRowCount;return c<a&&(c=a),this.process(b,c,!0)},onVirtualScroll:function(a,b){return this.update(a,b,!1,!1,!0)},gotoBlock:function(a,b,c){var d=this.$scope.scrollApi.getSpliceArgs(),e=this.$scope.grid.rows,f=this.$scope.grid.getNextRowIx();return c&&e.reverse(),e.splice.apply(e,d),f-=d[1],this.$scope.grid.setNextRowIx(f),this.update(a,b,!0,c,!0)},onGotoNextBlock:function(a,b){return this.gotoBlock(a,b,!1)},onGotoPreviousBlock:function(a,b){return this.gotoBlock(a,b,!0)},getRows:function(){return this.$scope.grid.rows},getRowCount:function(){return this.$scope.grid.rows.length},getFirstElementIndex:function(){return this.$scope.grid.rows[0].getIndex()},getLastElementIndex:function(){return this.$scope.grid.rows[this.$scope.grid.rows.length-1].getIndex()},getPreferredSize:function(){var a=c(),b=function(){return this.$element.find(".qv-st-data")[0].offsetHeight}.bind(this),d=this.$scope.$watch(b,function(b){if(b&&b>0){var c=this.$element.find(".qv-st-header")[0].offsetHeight,e=this.$element.find(".qv-st-bottom-header")[0].offsetHeight;a.resolve({w:this.$element.width(),h:b+c+e}),d()}}.bind(this));return a.promise}}),q.$inject=["$scope","$element","$timeout","qvGridObjectDataService","qvGridObjectSelectionService"],b.directive("qvStraightTable",["$timeout","qvGridObjectDataService","qvGridObjectSelectionService","qvGridColumnHighlightService","qvListboxPopoverService","$window",function(b,d,e,g,h,j){return{restrict:"E",replace:!0,template:f,require:"qvObjectContent",link:function(f,m,q,u){function v(a,b){return u[a]().then(function(){b.forEach(function(a){a()})})}function w(a,b){var c,d,e,f=m.find(a);return!!f.length&&(c=f[0].getBoundingClientRect(),d=new p(b.left,b.top,b.width,b.height),e=new p(c.left,c.top,c.width,c.height),e.intersectsWith(d))}function x(){u.updateLocked(f.grid),C&&C()}function y(){d.getSiblingCells(f.grid,f.selections.activationCell).forEach(function(a){e.deselectCell(f.grid,a)}),u.updateLocked(f.grid),C&&C()}function z(){f.selections.active&&f.selections.activationCell&&(d.getSiblingCells(f.grid,f.selections.activationCell).forEach(function(a){e.deselectCell(f.grid,a)}),u.updateLocked(f.grid))}function A(){f.object.selectionsClass="",u.updateLocked(f.grid)}function B(a,b){var c,d,e=a.length;for(c=0;c<e;++c)if(d=a[c],d.dataRowIx===b)return d}var C,D=m.find(".qv-grid-object-scroll-area"),E=m.closest(".qv-object-content-container"),F=D.controller("qvScrollArea"),G=m.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),H=D.find(".qv-scroll-row-loader").controller("qvScrollLoader"),I="."+f.id+"-straight-table",J={alignToBottom:"reduce",minRowHeight:29,maxRowHeight:87,columnCount:0,useHorizontalScroll:f.options.useHorizontalScroll,useAllSpace:f.options.useAllSpace,column:{glyphWidth:8,paddingWidth:14,minSearchWidth:f.options.customHeader?1:35,minColWidth:f.options.minColumnWidth||24,maxColWidth:250},columnPicker:{show:!1,width:21},blockSize:50},K=f.scrollApi=new k(b,J),L=new r(u);f.options.hasCustomHeader=!!f.options.customHeader,t=l.extend({init:function(a,b,c,d,e,f,g){this.columnPicker=g,this._super.apply(this,arguments)},getScrollAreaClientHeight:function(){var a=this.$element[0].getBoundingClientRect(),b=this.$scrollArea[0].getBoundingClientRect();return a.top+a.height-b.top},getBoundingBox:function(){var a=this.$element[0].getBoundingClientRect(),b={};return b.bottom=a.bottom,b.height=a.height,b.left=a.left,b.right=a.right,b.top=a.top,b.width=a.width,this.$element.find(".qv-st-column-picker").length>0&&(b.width+=this.columnPicker.width),b}});var M=m;J.useHorizontalScroll&&(M=M.parent().parent(),t=t.extend({getScrollAreaBoundingBox:function(){var a=this.$scrollArea[0].getBoundingClientRect(),b=E[0].clientWidth+E[0].scrollLeft;return{bottom:a.bottom,height:a.height,left:a.left,right:a.right,top:a.top,width:b}}}));var N=f.backendApi.isSnapshot?new s(m,D,".qv-st-data-row","","",null,f.layout.snapshotData.object):new t(M,D,".qv-st-data-row",".qv-grid-object-data-first-row",".qv-grid-object-data-last-row",null,K.settings.columnPicker);f.grid=new o("straight"),f.selections=e.$new(),f.$on("$destroy",function(){K.destroy(),m.off(I)}),m.on("contextmenu"+I,function(a){f.selections.active&&a.preventDefault()});var O;f.options.useHorizontalScroll&&E.scroll(function(){F.fadeScrollbarsWithoutDelay(),b.cancel(O),O=b(function(){v("processResize",[]),F.fadeInScrollbars()},300)});var P=K.initialize(N,L,F,G).then(function(){u.setInteractionState=function(){var a=f.object.inAnalysisState(),b=a&&f.options.navigation!==!1,c=a&&f.options.selections!==!1;f.interactive=c,b&&!f.navigatable?(f.navigatable=!0,f.scrollApi.activate()):!b&&f.navigatable&&(f.navigatable=!1,f.scrollApi.deactivate()),a||(f.isLoadPrevVisible=w(".qv-st-load-prev",K.domApi.getScrollAreaBoundingBox()))},u.onPaint=function(){return this.$scope.selections.active?c.resolve():v("processPaint",u._paintWatches)},u.onResize=function(){return f.scrollApi.updateViewport(),v("processResize",u._resizeWatches)},u.onInitialNativeScroll=function(a,b){return H.fadeIn(null,{width:"100%",height:"30px"},"relative").then(function(){return u.update(a,b,!0,!1,!0).then(function(){return H.fadeOut()})})},u.setInteractionState(f.options.interactionState)});u.onInit=function(){return P},f.applyColumnOrderSoftPatch=function(a,b){var c=[[],!0],d=a?"add":"replace";c[0][0]={qPath:"/qHyperCubeDef/columnOrder",qOp:d.toString(),qValue:JSON.stringify(b)},f.backendApi.applyPatches(c)},g.init(f.grid,u.metaHeaders),f.options.externalInterface&&(f.options.externalInterface.columnHighlightService=g,f.options.externalInterface.forceRedraw=function(){u.onPaint()}),f.applyColumnWidthSoftPatch=function(a,b){var c=[[],!0],d=a?"add":"replace";c[0][0]={qPath:"/qHyperCubeDef/columnWidths",qOp:d.toString(),qValue:JSON.stringify(b)},f.backendApi.applyPatches(c),f._columnWidthsExistsInLayout=!0},e.init(f.selectionsApi,f.backendApi,f.selections,x,y,z);var Q=f.selectionsApi.ignoreOnOutside;f.selectionsApi.ignoreOnOutside=function(a){return!!a.closest(".qv-st-dim-columns").length||(!(!Q(a)&&!a.closest(".qv-st-selections-active").length)||void 0)},f.selectionsApi.getMenuMaxHeight=function(){return m.outerHeight()},f.selectWhileLocked=function(){n.showLockedFeedback(f.layout.qHyperCube.qDimensionInfo)},f.selectDimensionValue=function(b,c){if(f.scrollApi.updateViewport(),b.representation!==b.REPRESENTATION_URL||!a(c.target).is("a")){f.selectionsApi.getKeyAsToggleSelected(c)||(z(),e.reset(f.selections)),C=e.selectDimensionValue(f.$id,f.backendApi,f.selectionsApi,f.selections,b,f.grid,!0);var d=f.selectionsApi.watchActivated(function(){A(),d()})}},f.activateSelections=function(a){f.scrollApi.updateViewport(),C=e.activateSelections(f.$id,f.backendApi,f.selectionsApi,f.selections,a);var b=f.selectionsApi.watchActivated(function(){A(),b()})},f.multiselectDimensionValues=function(a,b){function c(a){var b=B(h,a);b&&b.isDimensionValue&&e.selectDimensionCells(f.backendApi,f.selectionsApi,f.selections,f.grid,b,!1)}var g,h=d.getSiblingCells(f.grid,a),i=a.dataRowIx,j=b.dataRowIx;if(i<=j)for(g=i;g<=j;++g)c(g);else if(i>j)for(g=i;g>=j;--g)c(g)},f.multiselect=function(){f.selections.active&&e.sendSelection(f.backendApi,f.selectionsApi,f.selections,f.grid,f.selections.currentCell)},f.sort=function(a){if(a){f.scrollApi.updateViewport();var b,c,e,g=a.dataColIx,h=[].concat(f.layout.qHyperCube.qEffectiveInterColumnSortOrder),j=h[0],k="",l=[[],!0];g!==j&&(e=h.indexOf(g),i.move(h,e,0)),l[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:"["+h.join(",")+"]"},g===j&&(k=a.isDimension?"/qHyperCubeDef/qDimensions/":"/qHyperCubeDef/qMeasures/",b=d.getColumnInfo(g,f.layout),a.reversed=!b.qReverseSort,c=a.isDimension?g:g-f.layout.qHyperCube.qDimensionInfo.length,k+=c+"/qDef/qReverseSort",l[0][1]={qPath:k,qOp:"replace",qValue:a.reversed.toString()}),f.backendApi.applyPatches(l)}},f.currentHeaderSearch=null,f.search=function(a,b){return f.currentHeaderSearch===b?(b.open=!1,f.currentHeaderSearch=null,void h.close()):(f.currentHeaderSearch&&(f.currentHeaderSearch.open=!1,f.currentHeaderSearch=null),h.showField(b.fieldName,f.backendApi.model.session.currentApp,{$alignToElement:a,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+f.$id,collision:"flipfit",direction:f.options.direction},null,function(){f.currentHeaderSearch&&(f.currentHeaderSearch.open=!1),f.currentHeaderSearch=null}),b.open=!0,void(f.currentHeaderSearch=b))},f.openUrl=function(a){f.interactive&&j.open(a,"_blank")}}}}]),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"S",columnOrder:[],columnWidths:[]}},data:{dimensions:{min:1,max:1e3,add:function(a,b,c){var d=c.hcProperties.columnOrder,e=c.hcProperties.columnWidths,f=c.getDimensions().length-1;return i.indexAdded(d,f),e.splice(f,0,-1),a},remove:function(a,b,c,d){var e=c.hcProperties.columnOrder,f=c.hcProperties.columnWidths;i.indexRemoved(e,d),f.splice(e[d],1)}},measures:{add:function(a,b,c){var d=c.hcProperties.columnOrder,e=c.hcProperties.columnWidths,f=c.getDimensions().length+c.getMeasures().length-1;i.indexAdded(d,f),e.splice(d[f],0,-1)},remove:function(a,b,c,d){var e=c.hcProperties.columnOrder,f=c.hcProperties.columnWidths,g=e.indexOf(d);i.indexRemoved(e,g),f.splice(g,1)},min:0,max:1e3}},support:{cssScaling:!0,snapshot:!0,export:!0,exportData:!0,sharing:!1},type:"table",template:"<qv-straight-table></qv-straight-table>",BackendApi:d,definition:e,importProperties:function(a,c,d){var e=h.hypercube.importProperties(a,c,d),f=e.qProperty.qHyperCubeDef.columnOrder,g=e.qProperty.qHyperCubeDef.qDimensions,i=e.qProperty.qHyperCubeDef.qMeasures;return f.length&&g.length+i.length===f.length||(e.qProperty.qHyperCubeDef.columnOrder=b.getService("qvGridObjectDataService").columnOrder.get(g,i)),e.qProperty.qHyperCubeDef.qDimensions.forEach(function(a){a.qOtherTotalSpec&&a.qOtherTotalSpec.qTotalMode&&(a.qOtherTotalSpec.qTotalMode="TOTAL_OFF")}),e},exportProperties:h.hypercube.exportProperties,controller:q}}),define("extensions.qliktech/listbox/listbox-properties",["client.utils/property-resolver"],function(a){var b,c,d,e=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return b={uses:"settings",items:{}},c={type:"items",translation:"Common.Dimension",ref:"qListObjectDef",items:{label:{type:"string",ref:"qListObjectDef.qDef.qFieldLabels.0",translation:"Common.Label",show:!1},libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(a){return a.qListObjectDef&&a.qListObjectDef.qLibraryId}},field:{type:"string",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",change:function(a){var b=a.qListObjectDef.qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]},show:function(a){return a.qListObjectDef&&!a.qListObjectDef.qLibraryId}},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},d={type:"items",translation:"properties.sorting",grouped:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){if(a.qListObjectDef.qDef.autoSort)return b.autoSortDimension(a.qListObjectDef)}},expression:{type:"items",show:function(a){return!!a.qListObjectDef&&!a.qListObjectDef.qDef.autoSort},items:{expressionToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",ref:"qListObjectDef.qDef.qSortCriterias.0.qExpression",translation:"Common.Expression",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",0)}}}},frequency:{type:"items",show:function(a){return!!a.qListObjectDef&&!a.qListObjectDef.qDef.autoSort},items:{frequencyToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",
translation:"properties.sorting.sortByFrequency",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",options:e,resolveFunctions:"invertedEnumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",0)}}}},numeric:{type:"items",show:function(a){return!!a.qListObjectDef&&!a.qListObjectDef.qDef.autoSort},items:{numericToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(a){return!!a.qListObjectDef&&!a.qListObjectDef.qDef.autoSort},items:{asciiToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",0)}}}}}},{type:"items",component:"accordion",items:{dimension:c,sorting:d,settings:b}}}),define("text!extensions.qliktech/listbox/listbox.ng.html",[],function(){return'<div class="qv-listbox-container" ng-class="{ \'qv-listbox-interactive\': navigatable }" tid="qv-listbox-container">\n\t<div qva-direction x-dir-setting="{{options.direction}}" qv-listbox-search ng-show="options.search.show" class="qv-listbox-search">\n\t\t<lui-search query="query" is-focused="focused" on-escape="onEscape($event);" auto-focus="autoFocus" />\n\t</div>\n\t<div class="qv-listbox-wrapper" ng-class="{ \'searchActive\': options.search.show }">\n\t\t<qv-scroll-area class="qv-listbox-scroll-area qv-animate"\n\t\t\t\t\t\tng-class="{ \'qv-listbox-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled }"\n\t\t\t\t\t\tx-direction="options.direction">\n\t\t\t<ul class="qv-listbox"\n\t\t\t\tng-class="{ \'align-bottom\': scrollApi.alignBottomAbsolute }"\n\t\t\t\tqva-direction x-dir-setting="{{options.direction}}"\n\t\t\t\tqv-selections-select-while-locked="selectWhileLocked()"\n\t\t\t\tqv-selections-toggle-dimension-value="{ selector: \'li\', itemKey: \'item\' }"\n\t\t\t\tqv-selections-on-toggle-dimension-value="interactive && select($event, item)"\n\t\t\t\tqv-selections-multiselect="{ selector: \'li\', itemKey: \'item\' }"\n\t\t\t\tqv-selections-start-multiselect="interactive && multiselectStart($event)"\n\t\t\t\tqv-selections-update-multiselect="interactive && multiselectUpdate(start, current)"\n\t\t\t\tqv-selections-end-multiselect="interactive && multiselectEnd($event)">\n\t\t\t\t<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="navigatable && scrollApi.loadPrevious" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true">\n\t\t\t\t</qv-scroll-load-button>\n\t\t\t\t<li ng-repeat="item in items" ng-class="item.classNames" tid="listbox.item">\n\t\t\t\t\t<div class="qv-listbox-tick"><i class="lui-icon tick-icon" ng-class="{\'lui-icon--tick\': !item.locked, \'lui-icon--lock\': item.locked, }"></i></div>\n\t\t\t\t\t<div class="qv-listbox-text" ng-style="item.style" dir="{{item.dir}}">\n\t\t\t\t\t\t<span ng-attr-title="{{item.text}}">\n\t\t\t\t\t\t\t<span ng-repeat="textItem in item.textItems" ng-class="{ highlighted: textItem.isHighlighted }" ng-bind="textItem.text"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t\t<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\n\t\t\t\t<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="navigatable && scrollApi.loadNext" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\n\t\t\t</ul>\n\t\t</qv-scroll-area>\n\t\t<qv-scroll-loader></qv-scroll-loader>\n\t</div>\n</div>\n'}),define("text!client.services/export-dialog/export-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="export-dialog">\n\t<div ng-if="state === states.PENDING">\n\t\t<header class="dm-header" q-translation="Export.Exporting"></header>\n\t\t<main class="dm-main">\n\t\t\t<div class="qv-loader dm-p"></div>\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="cancel()" q-translation="Common.Cancel"></lui-button>\n\t\t</footer>\n\t</div>\n\t<div ng-if="state === states.COMPLETED">\n\t\t<header class="dm-header" q-translation="Export.Completed"></header>\n\t\t<main class="dm-main">\n\t\t\t<p class="dm-p">\n\t\t\t\t<span q-translation="Export.CompletedDescription"></span>\n\t\t\t\t<span q-translation="Export.WarningDataTruncated" ng-if="dataIsTruncated"></span>\n\t\t\t</p>\n\t\t\t<p class="dm-p">\n\t\t\t\t<a ng-href="{{exportUrl}}" target="_blank" q-translation="Export.CompletedLink"></a>\n\t\t\t</p>\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="close()" q-translation="Common.Close"></lui-button>\n\t\t</footer>\n\t</div>\n\t<div ng-if="state === states.FAILED">\n\t\t<header class="dm-header" q-translation="Export.Failed"></header>\n\t\t<main class="dm-main">\n\t\t\t<p class="dm-p" q-translation="{{errorTranslation}}"></p>\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="close()" q-translation="Common.Close"></lui-button>\n\t\t</footer>\n\t</div>\n</qv-modal-dialog>\n'}),define("client.services/export-dialog/export-dialog",["qvangular","text!./export-dialog.ng.html","general.services/show-service/show-service","assets/client/dialogs/directives/dialog-directives"],function(a,b,c){var d={template:b,scope:{model:"=",hypercubePath:"="},controller:["$scope",function(a){a.states={FAILED:-1,IDLE:0,PENDING:1,COMPLETED:2},a.state=a.states.PENDING,a.model.getLayout().then(function(b){var c=a.model.exportData(null,a.hypercubePath,b.title||null);a.rpcId=c.rpcId,c.then(function(b){a.exportUrl=require.toUrl(".."+b.result.qUrl),a.state=a.states.COMPLETED,b.warnings&&1e3===b.warnings[0]&&(a.dataIsTruncated=!0)},function(b){a.state=a.states.FAILED,a.errorTranslation="ErrorCode."+b.error.code,b.error.isHandled=!0})}),a.openExportWindow=function(){window.open(a.exportUrl)},a.cancel=function(){a.rpcId?a.model.cancelRequest(a.rpcId).finally(a.close):a.close()},a.close=function(){a.destroyComponent()}}]};a.service("$exportDialog",[function(){return{show:function(a,b){var e={model:a,hypercubePath:b};return c.show(d,e)}}}])}),define("extensions.qliktech/listbox/listbox-search",["qvangular","util","general.utils/support"],function(a,b,c){"use strict";var d=document.createElement("input");d.type="text",a.directive("qvListboxSearch",["$document","$timeout",function(e,f){return{link:function(g,h){function i(){return e.on("keypress.watchKeyChars"+g.$id,function(a){27!==a.keyCode&&13!==a.keyCode&&(d.value=String.fromCharCode(a.which),d.value.length&&g.$apply(function(){g.options.search.toggle(!0,d.value)}))}),function(){e.off(".watchKeyChars"+g.$id)}}function j(){function a(){return g.$watch("query",function(a,b){void 0!==a&&a!==b&&g.backendApi.search(a)})}function b(){d&&d(),g.query="",d=a()}function c(a){var b=a.split(" ");return b.some(function(a){var b=a.trim()[0];return"<"===b||">"===b})}var d,h;return b(),h=g.$watch("focused",function(a){void 0!==a&&g.selectionsApi.toggleKeyboardAccelerators(!a)}),e.on("keydown.listboxSearch"+g.$id,function(a){g.focused===!0&&f(function(){switch(g.clearItemStates(!1),a.which){case 13:var d,e=g.backendApi.getSize();g.backendApi.isLocked()||g.options.selections===!1?(g.backendApi.abortSearch(),g.options.search.toggle&&g.options.search.toggle()):e.qcy>0&&(d=g.selectionsApi.getKeyAsToggleSelected(a),d=c(g.query)?!d:d,g.backendApi.confirmSearch(d),g.selectionsApi.selectionsMade=!0,b());break;case 27:g.backendApi.abortSearch(),b()}})}),function(){d(),h(),e.off(".listboxSearch"+g.$id)}}var k,l;g.autoFocus=!1,g.selectionsApi.deactivateSearch=function(){k&&k(),l&&l(),a.$apply(g,function(){g.options.search&&g.options.search.toggle(!1)})},g.onEscape=function(a){g.query&&g.query.length?g.query="":(g.backendApi.abortSearch(),g.selectionsApi.cancel()),a.preventDefault()},g.options.search=b.extend(!0,{show:g.options.isPopover,toggle:function(a,b){g.options.search.show=void 0!==a?a:!g.options.search.show,g.options.search.show?(g.query=b,k=j()):(k&&k(),g.backendApi.abortSearch(),g.query="")}},g.options.search),g.options.showSearch=!0,g.$watch("options.search.show",function(a){g.autoFocus=a&&c.treatAsDesktop(),a||h.find("input").blur()}),g.$watch("selectionsApi.active && !focused",function(a){a?l=i():void 0!==a&&l&&l()}),g.$on("$destroy",function(){e.off(".listboxSearch"+g.$id),e.off(".watchKeyChars"+g.$id),delete g.options.search}),g.options.isPopover&&g.options.search.toggle(!0,g.options.search.defaultStr)}}}])}),define("extensions.qliktech/listbox/listbox",["qvangular","objects.backend-api/listbox-api","extensions.qliktech/listbox/listbox-properties","client.utils/property-mapper","text!./listbox.ng.html","objects.utils/data-properties/listobject-handler","objects.extension/object-conversion","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.extension/base-controller","general.utils/support","objects.extension/default-selection-toolbar","objects.utils/event-utils","client.utils/rtl/rtl-util","client.services/export-dialog/export-dialog","general.scroll/scroll-area","objects.grid/directives/selections","./listbox-search"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,b,c){var d=".selections-keyboard-"+c;return a.on("keyup"+d,function(a){b.focused||(27===a.which?b.selectionsApi.cancel():13===a.which&&b.selectionsApi.confirm())}),function(){a.off(d)}}var q,r,s;return s=i.extend({getBoundingBox:function(){return this.$scrollArea[0].getBoundingClientRect()}}),r=j.extend({init:function(a){this.visualizationCtrl=a},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(a,b){return this.visualizationCtrl.onVirtualScroll(a,b)},onInitialNativeScroll:function(a,b){return this.visualizationCtrl.onInitialNativeScroll(a,b)},onGotoNextBlock:function(a,b){return this.visualizationCtrl.onGotoNextBlock(a,b)},onGotoPreviousBlock:function(a,b){return this.visualizationCtrl.onGotoPreviousBlock(a,b)}}),q=k.extend({init:function(a,b,c){function d(b,c){var d=f.isSelected(b);d&&!c?(a.itemStates[b.dataValue]=!1,b.classNames="serverOptional"):d||(a.selectedValues.push(b.dataValue),a.itemStates[b.dataValue]=!0,b.classNames="selected")}this._super.apply(this,arguments),this.$timeout=c;var e,f=this;a.itemStates={},a.selectedValues=[],a.ignoreSelectionState=!1,a.selectionsApi.watchDeactivated(function(){a.$emit("childSelectionActive",!1),a.clearItemStates(!1),a.options.search&&(a.options.search.show=!1),e&&e()}),a.selectionsApi.watchActivated(function(){a.$emit("childSelectionActive",!0),e&&e(),e=p(b,a,a.$id)}),a.selectionsApi.clear=function(){this.selectionsMade=!0,a.backendApi.clearSelections(),a.removeAllSelections()},a.activateSelections=function(){a.selectionsApi.active||a.clearItemStates(!1),a.selectionsApi.activate()},a.clearItemStates=function(b){a.itemStates={},a.ignoreSelectionState=b},a.removeAllSelections=function(b){a.clearItemStates(!0),a.items.forEach(function(a){a!==b&&(a.classNames="serverOptional")})},a.selectValues=function(b,c){a.selectionsApi.selectionsMade=!0,a.backendApi.select(0,b,c).then(function(b){b.qSuccess||a.selectionsApi.clear()})},a.select=function(b,c){var e=a.selectionsApi.getKeyAsToggleSelected(b);a.activateSelections(),e||a.removeAllSelections(c),d(c,!1),a.selectValues([c.dataValue],e)},a.multiselectStart=function(b){var c=a.selectionsApi.getKeyAsToggleSelected(b);a.activateSelections(),a.selectedValues=[],c||a.removeAllSelections()},a.multiselectUpdate=function(b,c){var e,f,g,h;if(a.items.indexOf(c)!==-1)if(g=a.items.indexOf(b),h=a.items.indexOf(c),g<=h)for(e=g;e<=h;++e)f=a.items[e],d(f,!0);else if(g>h)for(e=g;e>=h;--e)f=a.items[e],d(f,!0)},a.multiselectEnd=function(b){a.selectedValues.length&&a.selectValues(a.selectedValues,a.selectionsApi.getKeyAsToggleSelected(b))},a.selectWhileLocked=function(){n.showLockedFeedback([a.layout.qListObject.qDimensionInfo])},a.$on("$destroy",function(){e&&e()}),Object.defineProperties(a,{isDesktop:{get:function(){return l.treatAsDesktop()}}})},update:function(a,b,c,d){var e=this.getDataInfo(a,b);return this.$scope.backendApi.getData(e.rects).then(function(a){return this.onUpdateData(a,c,d)}.bind(this))},getDataInfo:function(a,b){return a=a||0,{rects:[{qTop:a,qLeft:0,qWidth:1,qHeight:b}]}},stateMap:{S:"Selected",A:"Alternative",O:"Optional",XS:"SelectedExcluded",L:"Locked",X:"Excluded",XL:"ExcludedLock"},getState:function(a){return this.stateMap[a]},getItemClassNames:function(a,b){var c,d=this.getState(b);return c=this.useClientItemState(a)?this.$scope.itemStates[a]?"XS"===b?"server"+d:"selected server"+d:"Selected"===d?"serverOptional":"server"+d:"server"+d},useClientItemState:function(a){return this.$scope.ignoreSelectionState||a in this.$scope.itemStates},isSelected:function(a){return this.useClientItemState(a.dataValue)?!!this.$scope.itemStates[a.dataValue]:"S"===a.state||"XS"===a.state},updateTextItem:function(a,b){var c,d,e,f,g=b.qHighlightRanges&&b.qHighlightRanges.qRanges.length||0,h=b.qText&&b.qText.split("")||[],i=0;if(a.textItems=[],h.length||a.textItems.push({isHighlighted:!1,text:""}),!g)return void a.textItems.push({isHighlighted:!1,text:b.qText});for(e=b.qHighlightRanges.qRanges.sort(function(a,b){return a.qCharPos-b.qCharPos}),c=0;c<g;++c)d=e[c],f=d.qCharPos,f!==i&&a.textItems.push({isHighlighted:!1,text:h.splice(0,f-i).join("")}),a.textItems.push({isHighlighted:!0,text:h.splice(0,d.qCharCount).join("")}),i=d.qCharPos+d.qCharCount;h.length&&a.textItems.push({isHighlighted:!1,text:h.splice(0,h.length).join("")})},updateItems:function(a,b,c){var d,e,f,g,h,i,j,k=0,l=a[0].qArea.qTop,m=a[0].qArea.qHeight,n=this.$scope.items,p=a[0].qMatrix,q=o.supportDirAuto(),r={rtl:"right",ltr:"left"};for(c&&p.reverse(),b&&(k=n.length),h=this.$scope.backendApi.isLocked(),d=0,e=p.length;d<e;++d)n[k+d]||(n[k+d]={style:{}}),g=n[k+d],f=p[d][0],i="NaN"!==f.qNum,j=o.detectTextDirection(f.qText),g.locked=h,g.dataValue=f.qElemNumber,g.dataColIx=0,g.dataRowIx=c?l+m-d-1:l+d,g.state=f.qState,g.classNames=this.getItemClassNames(f.qElemNumber,f.qState),g.isDimensionValue=!0,g.text=f.qText,g.dir=q?"auto":j,g.style.textAlign=i?"right":r[j],this.updateTextItem(g,f);b||n.splice(d),c&&n.reverse()},onUpdateData:function(a,b,c){return this.updateItems(a,b,c),this.$timeout(function(){},0,!1)},process:function(a,b,c){return this.update(a,b,!1,!1).then(function(){return this.$scope.scrollApi.setTotalRows(this.$scope.layout.qListObject.qSize.qcy),this.$scope.scrollApi.setVirtualSize(c)}.bind(this))},processPaint:function(){var a,b,c=0;return a=this.$scope.scrollApi.settings.viewportRowCount,b=this.$scope.scrollApi.resetNativeScroll(),this.process(c,a,!1).then(function(){b()})},processResize:function(){var a=this.$scope.items.length,b=a?this.$scope.items[0].dataRowIx:0,c=this.$scope.scrollApi.settings.viewportRowCount;return c<a&&(c=a),this.process(b,c,!0)},onVirtualScroll:function(a,b){var c=this.update(a,b,!1,!1);return this.$scope.$digest(),c},gotoBlock:function(a,b,c){var d=this.$scope.scrollApi.getSpliceArgs(),e=this.$scope.items;return c&&e.reverse(),e.splice.apply(e,d),this.update(a,b,!0,c)},onGotoNextBlock:function(a,b){return this.gotoBlock(a,b,!1)},onGotoPreviousBlock:function(a,b){return this.gotoBlock(a,b,!0)},getRows:function(){return this.$scope.items},getRowCount:function(){return this.$scope.items.length},getFirstElementIndex:function(){return this.$scope.items[0].dataRowIx},getLastElementIndex:function(){return this.$scope.items[this.$scope.items.length-1].dataRowIx},getSelectionToolbar:function(){var a=this.$scope,b=new m(a.backendApi,a.selectionsApi,!1,!1,[],[{name:"Selections.All",tid:"selection-toolbar-menu.selectAll",iconClass:"icon-selection-toolbar-selectAll",buttonClass:"",action:function(){a.clearItemStates(!1),this.selectionsApi.selectionsMade=!0,this.backendApi.selectAll()},isDisabled:function(){return!this.hasState(["qOption","qAlternative","qExcluded","qDeselected"])}},{name:"Selections.Possible",tid:"selection-toolbar-menu.selectPossible",iconClass:"icon-selection-toolbar-selectPossible",buttonClass:"",action:function(){a.clearItemStates(!1),this.selectionsApi.selectionsMade=!0,this.backendApi.selectPossible()},isDisabled:function(){return!this.hasState(["qOption"])}},{name:"Selections.Alternative",tid:"selection-toolbar-menu.selectAlternative",iconClass:"icon-selection-toolbar-selectAlternative",buttonClass:"",action:function(){a.clearItemStates(!1),this.selectionsApi.selectionsMade=!0,this.backendApi.selectAlternative()},isDisabled:function(){return!this.hasState(["qAlternative"])}},{name:"Selections.Excluded",tid:"selection-toolbar-menu.selectExcluded",iconClass:"icon-selection-toolbar-selectExcluded",buttonClass:"",action:function(){a.clearItemStates(!1),this.selectionsApi.selectionsMade=!0,this.backendApi.selectExcluded()},isDisabled:function(){return!this.hasState(["qExcluded","qAlternative"])}}]);return b.buttons[0].isDisabled=function(){return!a.backendApi.hasSelections()},b}}),q.$inject=["$scope","$document","$timeout"],a.directive("qvListbox",["$timeout",function(a){return{restrict:"E",replace:!0,template:e,require:"^qvObjectContent",link:function(b,c,d,e){var f=c.find(".qv-listbox-scroll-area"),g=f.controller("qvScrollArea"),i=c.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),j=f.find(".qv-scroll-row-loader").controller("qvScrollLoader"),k="."+b.id+"-listbox",l={blockSize:200,minRowHeight:30,maxRowHeight:30},m=b.scrollApi=new h(a,l),n=new r(e),o=new s(c,f,"li:not(.qv-listbox-load-buttons)","li:not(.qv-listbox-load-buttons):first","li:not(.qv-listbox-load-buttons):not(.qv-scroll-row-loader):last");b.items=[],b.$on("$destroy",function(){m.destroy(),c.off(k)}),c.on("contextmenu"+k,function(a){b.object.selectionsApi.active&&a.preventDefault()});var p=m.initialize(o,n,g,i).then(function(){b.options.isPopover&&b.activateSelections(),b.$watch("options.search.show",function(a,c){var d=a===c;b.options.isPopover||d||b.scrollApi.setVirtualSize(!0)}),e.setInteractionState=function(){var a=this.$scope.object&&this.$scope.object.inAnalysisState(),c=a&&b.options.navigation!==!1,d=a&&b.options.selections!==!1;b.interactive=d,c&&!b.navigatable?(b.navigatable=!0,b.scrollApi.activate()):!c&&b.navigatable&&(b.navigatable=!1,b.scrollApi.deactivate())},e.setDirection=function(a){b.options.direction=a},e.onPaint=function(){var a=b.scrollApi.totalRows===this.$scope.layout.qListObject.qSize.qcy;return b.selectionsApi.active&&a?e.processResize():b.selectionsApi.active||a?e.processPaint():(b.scrollApi.updateViewport(),e.processResize())},e.onResize=function(){return b.scrollApi.updateViewport(),e.processResize()},e.onInitialNativeScroll=function(a,b){return j.fadeIn(null,{width:"100%",height:"30px"},"relative").then(function(){return e.update(a,b,!0,!1).then(function(){return j.fadeOut()})})}});e.onInit=function(){return p}}}}]),{type:"listbox",template:"<qv-listbox></qv-listbox>",controller:q,initialProperties:{qListObjectDef:{qShowAlternatives:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:0,qHeight:0}],qDef:{qSortCriterias:[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}]}}},data:{dimensions:{min:1,max:1}},mapProperties:function(){this.mappedDefinition=d.mapDefinition(this.definition,this.type),this.dimensionDefinition=d.findDefinition(this.mappedDefinition,"qListObjectDef",!0)},getCreatePropertyHandler:function(a){return new f({app:a,dimensionDefinition:this.dimensionDefinition})},showRequirements:function(){return!1},hasError:function(a){var b=a.layout;return!b.qListObject||!b.qListObject.qDimensionInfo||!!b.qListObject.qDimensionInfo.qError},BackendApi:b,definition:c,options:{search:{},selections:{}},getDropFieldOptions:function(a,b,c,d){a.Add(c,b),a.ReplaceDimensions(c,b),d()},getDropMeasureOptions:function(a,b,c,d){d()},importProperties:g.listbox.importProperties,exportProperties:g.listbox.exportProperties}}),define("objects.backend-api/field-api",["./backend-api"],function(a){"use strict";var b;return b=a.extend("FieldApi",{init:function(a){this._super(a,"/dimensions"),this.cacheCube.setMethodName("GetListObjectData")},updateCache:function(){},getProperties:function(){return this.model.getProperties()},getData:function(a){return this.cacheCube.getData(a)},getSize:function(){return this.model.layout.qListObject.qSize},isLocked:function(){return this.model.layout.qListObject.qDimensionInfo.qLocked}})}),define("extensions.qliktech/filterpane/filterpane-properties",["client.property-panel/default-sorting-properties","util"],function(a,b){var c,d,e,f;return f={qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1},c={uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}}}},d={type:"array",component:"filterpane-data",translation:"Common.Data",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!1,ref:"qChildListDef",items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(a){return a.qListObjectDef.qLibraryId}},field:{type:"string",component:"expression",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",show:function(a){return!a.qListObjectDef.qLibraryId},change:function(a){var b=a.qListObjectDef.qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]}},title:{ref:"title",type:"string",expression:"optional",translation:"Common.Title"},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},e={type:"items",component:"filterpane-sorting",translation:"properties.sorting",allowMove:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a){if(a.qListObjectDef.qDef.autoSort)for(var b=a.qListObjectDef,c=0;c<b.qDef.qSortCriterias.length;c++)b.qDef.qSortCriterias[c]=f}},dimension:{component:"sorting-dimension",type:"items",ref:"qListObjectDef",show:function(a){return!a.qListObjectDef.qDef.autoSort},items:b.extend(!0,{},a.items.dimensions.items.dimension.items,{dimensionDefinition:{items:{frequency:{show:!0}}}})}}},{type:"items",component:"accordion",items:{data:d,sorting:e,settings:c}}}),define("extensions.qliktech/filterpane/filterpane-handler",["objects.utils/data-properties/data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util","general.utils/visualizations"],function(a,b,c,d,e){"use strict";var f=1e3,g=a.extend({init:function(a){this._super(a),this.dimensionLayout=[],this.dimensions=[]},autoSortDimension:function(a){return a.qLibraryId?this.app.getDimensionList().then(function(d){var e=c.findLibraryDimension(a.qLibraryId,d),f=e?e.qData.info:void 0;return b.autoSortDimension(a,f),a}):this.app.getFieldList().then(function(d){var e=c.findField(a.qDef.qFieldDefs[0],d),f=e?[e]:void 0;return b.autoSortDimension(a,f),a})},getDimensions:function(){return this.dimensions||[]},minDimensions:function(){return 1},maxDimensions:function(){return 1e3},setModel:function(a){this.model=a},addDimension:function(a){var b,g,h=this;if(a.qDef.cId=d.generateId(),a.qShowAlternatives=!0,this.getDimensions().length<f)return b=e.getType("listbox"),g=b.getInitialProperties({}),g.then(function(b){return h.autoSortDimension(a).then(function(){return b.qListObjectDef=a,a.qLibraryId?h.app.getDimensionList().then(function(d){var e=c.findLibraryDimension(a.qLibraryId,d);return b.title=e.qData.title,h.model.createChild(b,h.properties).then(function(){return b.qListObjectDef})}):(b.title=a.qDef.title||a.qDef.qFieldLabels[0]||a.qDef.qFieldDefs[0],h.model.createChild(b,h.properties).then(function(){return b.qListObjectDef}))})})},removeDimension:function(a){var b=this.layout.qChildList.qItems[a];return this.model.removeChild(b.qInfo.qId,this.properties).then(function(){return b})},getDimensionLayouts:function(){return this.dimensionLayout||[]},getDimensionLayout:function(a){var b=this.getDimensionLayouts();return b[a]?b[a].qListObject.qDimensionInfo:""}});return g}),define("text!extensions.qliktech/filterpane/filterpane.ng.html",[],function(){return'<qv-filterpane\n\t\tclass="qv-filterpane"\n\t\tqv-collapsed-listbox-delegated-open\n\t\toutside-ignore-name="outsideIgnoreName"\n\t\tinteractive="interactive"\n\t\tqva-direction x-dir-setting="{{options.direction}}">\n\t<div ng-repeat="column in columns" class="qv-filterpane-column">\n\t\t<div ng-repeat="item in column.items"\n\t\t\t ng-class="{\'qv-filterpane-collapsed\': !item.expand, \'qv-filterpane-expanded\': item.expand}"\n\t\t\t ng-style="{height: item.height}"\n\t\t\t tid="qv-object-filterpane.dimension">\n\t\t\t<qv-object ng-if="item.expand" model="item.model" options="item.options" object="item.object"></qv-object>\n\t\t\t<qv-collapsed-listbox ng-if="!item.expand" model="item.model" read-direction="options.direction" outside-ignore-name="outsideIgnoreName" responsive-mode="item.responsiveMode"></qv-collapsed-listbox>\n\t\t</div>\n\n\t\t<div ng-if="column.showAll && object.expanded" class="qv-filterpane-collapsed qv-filterpane-showall">\n\t\t\t<div class="presentation" q-title-translation="Tooltip.Filterpane.NotAllItemsShow"></div>\n\t\t</div>\n\t\t<div ng-if="column.showAll && !object.expanded" class="qv-filterpane-collapsed qv-filterpane-fullscreen">\n\t\t\t<button class="add-button lui-button"\n\t\t\t\t\tng-class="{ \'lui-disabled\': !object.inAnalysisState() }"\n\t\t\t\t\tqva-activate="triggerFullScreen()"\n\t\t\t\t\tq-title-translation="Tooltip.Filterpane.ClickForFullScreen"></button>\n\t\t</div>\n\t</div>\n</qv-filterpane>\n'}),define("extensions.qliktech/filterpane/filterpane-layout",["qvangular","general.utils/responsive-state","client.utils/property-resolver"],function(a,b,c){"use strict";var d=10,e=89,f=20,g=47,h=30;a.service("qvFilterpaneLayout",function(){return{getMaxColumns:function(a){return b.isSmallDevice?1:Math.floor((a.width+f)/180)||1},getMaxItemsPerColumn:function(a){return Math.max(1,Math.floor((a.height+d)/44))},getDimensionCount:function(a){return a.qChildList.qItems.length},getColumnItemsCount:function(a){var b=0;return a.forEach(function(a){b+=a.itemCount}),b},getHeightOf:function(a){var b=44*a-d;return Math.max(b,0)},getDimensionCardinal:function(a){var b=c.getValue(a,"model.layout.qListObject.qDimensionInfo.qStateCounts",void 0);if(b)return Object.keys(b).reduce(function(a,c){return a+b[c]},0)},getHeightOfExpanded:function(a){var b=a*h+g+3;return b},doesAllFit:function(a,b,c){return c<=a*b},haveRoomToExpandOne:function(a,c){var f=c.itemCount>1?d:0;return!b.isSmallDevice&&a.height>this.getHeightOf(c.itemCount-1)+e+f},getSize:function(a,b){return{width:a.innerWidth()-1,height:a.innerHeight(),dimensionCount:this.getDimensionCount(b)}},sizeChanged:function(a,b){return!angular.equals(a,b)},calculateColumns:function(a,c,d){var f=!b.isSmallDevice&&a.height>e,g=this.getMaxColumns(a),h=this.getMaxItemsPerColumn(a),i=this.getColumnItemsCount(c);if(f&&this.doesAllFit(h,g-c.length-1,a.dimensionCount-i-1))c.push({expand:!0,itemCount:1}),i+1<a.dimensionCount&&this.calculateColumns(a,c,d);else{var j;j=Math.min(a.dimensionCount-i,h),b.isSmallDevice?j=a.dimensionCount-i:d||(j=Math.ceil((a.dimensionCount-i)/(g-c.length)),j=Math.max(h,j),j=Math.min(a.dimensionCount-i,j)),c.push({expand:!1,itemCount:j}),c.length>=g&&h>0&&this.getColumnItemsCount(c)<a.dimensionCount&&(c[c.length-1].showAll=!0,38>a.height-this.getHeightOf(h)&&(c[c.length-1].itemCount=Math.max(c[c.length-1].itemCount-1,0))),this.getColumnItemsCount(c)<a.dimensionCount&&c.length<g&&this.calculateColumns(a,c,d)}},balanceColumns:function(a,b){var c,d,e;return c=b.filter(function(a){return a.expand}),d=b.filter(function(a){return a.expand===!1}),d.length>0&&!d[d.length-1].showAll&&this.haveRoomToExpandOne(a,d[d.length-1])?d[d.length-1].expand=!0:(e=this.getColumnItemsCount(d),d.forEach(function(a,b){var c,f;c=b<e%d.length?1:0,f=Math.floor(e/d.length)+c,a.itemCount=f},this)),d.concat(c)},getDimensions:function(a){return a.qChildList.qItems.map(function(a){return{id:a.qInfo.qId,expand:!1,height:void 0,responsiveMode:"full"}})},sortDimensions:function(a,b){var c;return c=a.qChildList.qItems.map(function(a){return a.qInfo.qId}),c.map(function(a){return b.filter(function(b){return b.id===a})[0]})},isValid:function(a){return!!a&&!!a.qChildList&&!!a.qChildList.qItems&&this.getDimensionCount(a)>0},mergeColumnsAndDimensions:function(a,b){return a.forEach(function(a){a.items=b.slice(0,a.itemCount),b=b.slice(a.itemCount)},this),a},reSizeArray:function(a,b,c,d){for(;a.length>b;)a.pop();for(;a.length<b;)a.push(c.extend(!0,{},d))},dimensionsEqual:function(a,b){return a.id===b.id&&a.expand===b.expand&&a.height===b.height},shouldDimensionBeUpdated:function(a,b){return!this.dimensionsEqual(a,b)},patchScope:function(a,b,c){this.resizeScopeArrays(a,b,c),a.columns.forEach(function(c,d,e){var f=b[d];e[d].showAll=f.showAll,e[d].expand=f.expand,e[d].itemCount=f.itemCount,c.items.forEach(function(b,c){var d=f.items[c];this.shouldDimensionBeUpdated(b,d)&&(d.expand||delete b.options,d.expand&&!b.options&&(b.options={isPopover:!1,isReadonly:a.object.isReadonly,interactionState:a.options.interactionState,card:a.options.card,selections:a.options.selections,navigation:a.options.navigation,direction:a.options.direction}),this.copyDimensionValues(d,b))},this)},this)},expandOne:function(a,b){var c,e,f;for(c=0;c<a.length;c++)if(e=a[c],e.cardinal&&!e.expand&&(f=this.getHeightOfExpanded(e.cardinal),f<b))return e.expand=!0,e.height=f+"px",f+d;return!1},calculateExpandPriority:function(a,b){a.forEach(function(a){if(a.expand){var c,f,g=0,h=b.height-this.getHeightOf(a.itemCount-1)-d,i=0;if(a.items.forEach(function(a){a.cardinal=this.getDimensionCardinal(a)}.bind(this)),c=a.items.concat().sort(function(a,b){return a.cardinal-b.cardinal}),c.length>1)for(;h>e;){var j=this.expandOne(c,h);if(!j)break;g++,i+=j,h=b.height-this.getHeightOf(a.itemCount-g)-i}if(f=c.filter(function(a){return!a.expand}),h>e&&f.length){var k=f[0],l=f.length>1?d:0;k.expand||(c.length>1&&(k.height=b.height-this.getHeightOf(f.length-1)-i-l+"px"),k.expand=!0)}}1===a.items.length&&b.height<30&&(a.items[0].responsiveMode=b.height<17?"spark":"small",a.items[0].height=b.height+"px")},this)},resolveAllModels:function(a,b,c,d){var e=[];return b.forEach(function(b,d){var f=a.columns[d]||{items:[]};b.items.forEach(function(a,b){var d=f.items[b]||{};this.shouldDimensionBeUpdated(a,d)||!d.model?e.push(c(a)):a.model=d.model},this)},this),d.all(e)},resizeScopeArrays:function(a,b,c){a.columns.length!==b.length&&this.reSizeArray(a.columns,b.length,c,{items:[]}),a.columns.forEach(function(d,e){d.items.length!==b[e].items.length&&this.reSizeArray(a.columns[e].items,b[e].items.length,c,{})},this)},copyDimensionValues:function(a,b){Object.keys(a).forEach(function(c){b[c]=a[c]})},getResolveModelFunction:function(a,b,c){
return function(d){return this.resolveModel(a,d,b,c)}.bind(this)},resolveModel:function(a,b,c,d){var e=a.get(b.id,d),f=new c;return e.then(function(a){return b.model=a,a.getLayout().then(function(){f.resolve()})}),f.promise}}})}),define("text!extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed.ng.html",[],function(){return'<div class="qv-collapsed-listbox"\n\t ng-class="{locked: isLocked, error: hasError, spark: responsiveMode == \'spark\', small: responsiveMode == \'small\'}"\n\t qva-outside-ignore-for="{{outsideIgnoreName}}"\n\t qva-direction x-dir-setting="{{readDirection}}">\n\t<div class="error-layer"></div>\n\t<div class="title-wrapper">\n\t\t<span ng-if="isLocked" class="lui-icon lui-icon--lock" qva-direction x-dir-setting="{{readDirection}}"></span>\n\t\t<span class="title" ng-attr-title="{{title}}" qva-direction x-dir-setting="{{readDirection}}" x-dir-text="{{title}}">{{title}}</span>\n\t</div>\n\t<qv-state-count-bar ng-if="!hasError" state-counts="stateCounts" options="options"></qv-state-count-bar>\n</div>\n'}),define("extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed",["qvangular","objects.models/listbox","text!./collapsed.ng.html","client.views/state-count-bar/state-count-bar","objects/listbox-popover/listbox-popover-service"],function(a,b,c){"use strict";a.directive("qvCollapsedListbox",function(){return{restrict:"E",replace:!0,template:c,scope:{model:"=",outsideIgnoreName:"=",responsiveMode:"=",readDirection:"="},require:"^qv-collapsed-listbox-delegated-open",link:function(c){c.title="",c.hasError=!1,c.isLocked=!1,c.options={direction:c.readDirection},b.bindLayout(c,"model",function(b){a.$apply(c,function(){var a=b.qListObject.qDimensionInfo;c.hasError=!(!b.qListObject.qError&&!b.qListObject.qDimensionInfo.qError),c.stateCounts=a.qStateCounts,c.isLocked=a.qStateCounts.qLocked>0,c.title=b.title,c.id=b.qInfo.qId})})}}}),a.directive("qvCollapsedListboxDelegatedOpen",function(){return{restrict:"A",scope:{outsideIgnoreName:"=",interactive:"=?"},controller:["$scope","$element","qvListboxPopoverService",function(a,b,c){function d(a,b){return{left:a.position().left-b.position().left,top:a.position().top-b.position().top,right:b.width()-a.position().left-a.width(),bottom:b.height()-a.position().top-a.height()}}function e(a,b){var c,e=d(a,b);return c=Math.max(e.left,e.right)>Math.max(e.top,e.bottom)?e.left>e.right?"left":"right":e.top>e.bottom?"top":"bottom"}var f;b.on("qv-activate",".qv-collapsed-listbox:not(.error)",function(d){var g=angular.element(d.target).closest(".qv-collapsed-listbox"),h=g.isolateScope().model,i=g.isolateScope().id,j=g.isolateScope().options.direction,k={qvaOutsideIgnoreFor:a.outsideIgnoreName,$alignToElement:g,position:e(g,b),collision:"flipfit",direction:j};if(d.preventDefault(),a.interactive){if(i===f)return c.close(),void(f=void 0);f=i,c.show(h,k,function(){f=void 0})}})}]}})}),define("extensions.qliktech/filterpane/filterpane",["jquery","qvangular","util","core.utils/deferred","objects.backend-api/field-api","extensions.qliktech/filterpane/filterpane-properties","extensions.qliktech/filterpane/filterpane-handler","objects.utils/data-properties/listobject-util","client.utils/property-mapper","objects.models/listbox","text!./filterpane.ng.html","objects.extension/base-controller","objects.extension/export-format","objects.extension/object-conversion","extensions.qliktech/filterpane/filterpane-layout","extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){return"filterpane-"+ ++s}function p(a){return a.columns.some(function(a){return a.items.some(function(a){return a.expand&&(!a.object||1!==a.object.renderState)})})}var q=1e3,r=1,s=0,t=l.extend({size:{},columns:[],expandable:!1,init:function(b,c,d,e){this.$scope=b,this.$element=c,this.$timeout=d,this.filterpaneLayout=e,b.object.throbberApi.off(),this.showThrobberTimeout=d(function(){b.object.throbberApi.show()},1e3),b.outsideIgnoreName=o(),b.columns=[],b.ext.expandable=function(){return this.expandable}.bind(this),b.options||(b.options={}),b.triggerFullScreen=function(){b.object.inAnalysisState()&&(a(".embedded-sheet-toolbar").length>0&&a(".embedded-sheet-toolbar").css("display","none"),b.$emit("zoomOnCell"))},b.$on("objectRenderStateChange",function(a,c){a.stopPropagation(),c&&!p(b)&&this.renderStateDfd.resolve()}.bind(this))},onPaint:function(){return this.renderStateDfd=d(),this.update(this.$scope.layout).then(function(){p(this.$scope)||this.renderStateDfd.resolve()}.bind(this)),this.renderStateDfd.promise},onResize:function(){return this.renderStateDfd=d(),this.update(this.$scope.layout).then(function(){p(this.$scope)||this.renderStateDfd.resolve()}.bind(this)),this.renderStateDfd.promise},update:function(a){var b,e=this.size,f=this.$scope,g=this.columns,h=this.$element,i=f.object.model.session.currentApp,k=this.filterpaneLayout,l=k.getSize(h,a),m=k.getResolveModelFunction(j,d,i);return k.sizeChanged(e,l)&&(this.size=e=l,this.columns=g=this.getColumns(e)),k.isValid(a)?(b=k.getDimensions(a),b=k.sortDimensions(a,b),this.dimensions=b,this.preferredSizeDeferred&&this.preferredSizeDeferred.resolve(),g=k.mergeColumnsAndDimensions(g,b),k.resolveAllModels(f,g,m,d).then(function(){k.calculateExpandPriority(g,e),k.patchScope(f,g,c),this.$timeout.cancel(this.showThrobberTimeout),f.object.throbberApi.hide(),this.expandable=!f.columns.some(function(a){return a.items.some(function(a){var b=a.model;return b&&b.layout&&b.layout.qSelectionInfo&&b.layout.qSelectionInfo.qInSelections})})}.bind(this))):(f.columns=g=[],d.resolve())},getColumns:function(a){var b=[];return this.filterpaneLayout.calculateColumns(a,b,this.$scope.options.zoomEnabled),this.filterpaneLayout.balanceColumns(a,b)},setInteractionState:function(a){this.$scope.interactive=this.$scope.object&&this.$scope.object.inAnalysisState()&&this.$scope.options.navigation!==!1,this.$scope.columns.forEach(function(b){b.items.forEach(function(b){b.expand&&b.object.setInteractionState(a)})})},setDirection:function(a){this.$scope.options&&(this.$scope.options.direction=a),this.$scope.columns.forEach(function(b){b.items.forEach(function(b){b.expand&&b.object.setDirection(a)})})},getPreferredSize:function(){var a=d();this.preferredSizeDeferred&&this.preferredSizeDeferred.reject(),this.preferredSizeDeferred=d();var b=this;return this.preferredSizeDeferred.promise.then(function(){b.preferredSizeDeferred=null,a.resolve({w:b.$element.width(),h:b.filterpaneLayout.getHeightOf(b.dimensions.length)})}),this.dimensions&&this.preferredSizeDeferred.resolve(),a.promise}});t.$inject=["$scope","$element","$timeout","qvFilterpaneLayout"];var u={type:"filterpane",template:k,BackendApi:e,controller:t,definition:f,initialProperties:{qChildListDef:{qData:{info:"/qInfo"}}},data:{dimensions:{min:1,max:1e3}},expandable:function(){return!1},mapProperties:function(){this.mappedDefinition=i.mapDefinition(this.definition,this.type),this.dimensionDefinition={min:1}},getCreatePropertyHandler:function(a){return new g({app:a,dimensionDefinition:this.dimensionDefinition})},addFieldDimension:function(a,c){return c.model.getProperties().then(function(d){var e=c.getCreatePropertyHandler();return e.setProperties(d),e.setModel(c.model),e.addFieldDimension(a.value,a.displayName).then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},addLibraryDimension:function(a,c){return c.model.getProperties().then(function(d){var e=c.getCreatePropertyHandler();return e.setProperties(d),e.setModel(c.model),e.addLibraryDimension(a.libraryId).then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},getDropFieldOptions:function(a,c,d){c.getDimensions().length<c.maxDimensions()&&(c.setModel(d),c.addFieldDimension(a.item.name,a.item.displayName).then(function(a){d.save(),b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)}))},getDropDimensionOptions:function(a,c,d){c.getDimensions().length<c.maxDimensions()&&(c.setModel(d),c.addLibraryDimension(a.item.id).then(function(a){d.save(),b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)}))},getDropMeasureOptions:function(a,b,c,d){d()},getExportRawDataOptions:function(a,c,e){c.model.getLayout().then(function(f){if(1===f.qChildList.qItems.length)return a.addItem({translation:"contextMenu.export",tid:"export",icon:"lui-icon lui-icon--export",select:function(){j.get(f.qChildList.qItems[0].qInfo.qId).then(function(a){b.getService("$exportDialog").show(a)})}}),void e.resolve();var g=[],h=a.addItem({translation:"contextMenu.export",tid:"export-submenu",icon:"lui-icon lui-icon--export"});h.addItem({translation:"Export.AllDimensions",tid:"export-all-dimensions",select:function(){b.getService("$exportDialog").show(c.model)}}),f.qChildList.qItems.forEach(function(a){g.push(j.get(a.qInfo.qId).then(function(a){return a.getLayout().then(function(c){h.addItem({translation:c.title,tid:"export",select:function(){b.getService("$exportDialog").show(a)}})})}))}),d.all(g).then(e.resolve)})},exportProperties:function(a){var b,c,d,e,f,g=new m,h=a.qProperty,i=g.data[0];for(c=0;c<a.qChildren.length;++c)b=a.qChildren[c].qProperty,i.dimensions.push({qDef:b.qListObjectDef.qDef,qLibraryId:b.qListObjectDef.qLibraryId,qOtherTotalSpec:b.qListObjectDef.qOtherTotalSpec||{qOtherMode:"OTHER_OFF",qOtherCounted:{qv:"10"}},title:b.title});if(h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef){if(h.qLayoutExclude.qHyperCubeDef.qDimensions)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qDimensions.length;++c)i.excludedDimensions.push(h.qLayoutExclude.qHyperCubeDef.qDimensions[c]);if(h.qLayoutExclude.qHyperCubeDef.qMeasures)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qMeasures.length;++c)i.excludedMeasures.push(h.qLayoutExclude.qHyperCubeDef.qMeasures[c]);if(h.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.length;++c)i.interColumnSortOrder.push(h.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder[c])}for(e in h)"qChildListDef"!==e&&(g.properties[e]=h[e]);if(h.qLayoutExclude||(h.qLayoutExclude={}),h.qLayoutExclude.disabled){for(e in h.qLayoutExclude.disabled)f=e,g.properties.hasOwnProperty(f)||(g.properties[f]=h.qLayoutExclude.disabled[e]);h.qLayoutExclude.disabled.previousShowTitles&&(g.properties.showTitles=!0)}for(delete h.qLayoutExclude,c=0;c<i.dimensions.length;++c)for(d=0;d<i.dimensions[c].qDef.qSortCriterias.length;++d)i.dimensions[0].qDef.qSortCriterias[d].qSortByFrequency=0,i.dimensions[0].qDef.qSortCriterias[d].qSortByState=0;return g},importProperties:function(a,b){var d,e,f={qChildren:[]},g={},i=a.data[0];g.qLayoutExclude||(g.qLayoutExclude={}),g.qLayoutExclude.disabled={};for(d in a.properties)"qLayoutExclude"===d?a.properties[d].quarantine&&(g.qLayoutExclude.quarantine=c.extend(!0,{},a.properties[d].quarantine)):b.hasOwnProperty(d)||"qMetaDef"===d?g[d]=a.properties[d]:g.qLayoutExclude.disabled[d]=a.properties[d];for(g=c.extend(!0,{},b,g),e=0;e<i.dimensions.length;++e)f.qChildren.length<q?f.qChildren.push({qProperty:h.createDefaultListBox(i.dimensions[e],i.dimensions[e].title),qChildren:[]}):(g.qLayoutExclude||(g.qLayoutExclude={}),g.qLayoutExclude.qHyperCubeDef||(g.qLayoutExclude.qHyperCubeDef={}),g.qLayoutExclude.qHyperCubeDef.qDimensions||(g.qLayoutExclude.qHyperCubeDef.qDimensions=[]),g.qLayoutExclude.qHyperCubeDef.qDimensions.push(i.dimensions[e]));if(i.measures.length)for(g.qLayoutExclude.qHyperCubeDef||(g.qLayoutExclude.qHyperCubeDef={}),g.qLayoutExclude.qHyperCubeDef.qMeasures||(g.qLayoutExclude.qHyperCubeDef.qMeasures=[]),e=0;e<i.measures.length;++e)g.qLayoutExclude.qHyperCubeDef.qMeasures.push(i.measures[e]);for(e=0;e<i.excludedDimensions.length;++e)f.qChildren.length<r?f.qChildren.push({qProperty:h.createDefaultListBox(i.excludedDimensions[e],i.excludedDimensions[e].title),qChildren:[]}):(g.qLayoutExclude.qHyperCubeDef||(g.qLayoutExclude.qHyperCubeDef={}),g.qLayoutExclude.qHyperCubeDef.qDimensions||(g.qLayoutExclude.qHyperCubeDef.qDimensions=[]),g.qLayoutExclude.qHyperCubeDef.qDimensions.push(i.excludedDimensions[e]));for(e=0;e<i.excludedMeasures.length;++e)g.qLayoutExclude.qHyperCubeDef||(g.qLayoutExclude.qHyperCubeDef={}),g.qLayoutExclude.qHyperCubeDef.qMeasures||(g.qLayoutExclude.qHyperCubeDef.qMeasures=[]),g.qLayoutExclude.qHyperCubeDef.qMeasures.push(i.excludedMeasures[e]);for(e=0;e<i.interColumnSortOrder.length;++e)g.qLayoutExclude.qHyperCubeDef&&(g.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder||(g.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder=[]),g.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.push(i.interColumnSortOrder[e]));return n.importCommonProperties(g,a,b),g.showTitles&&(g.qLayoutExclude.disabled.previousShowTitles=!0,g.showTitles=!1),f.qProperty=g,f}};return u}),define("text!extensions.qliktech/text-image/text-image.ng.html",[],function(){return'<div class="qv-ti" style=\'width: 100%; height: 100%;\' qva-activate="edit()">\n\t<div class="media-tool-scrollbar" ng-if="!editing && !initializing && !saving && !empty" dir="{{ direction }}">\n\t\t<div class="qv-media-tool-html" ng-class="[sizeClass, visibilityClass, responsiveClass, {\'qv-interactive\': navigation}]" ng-click="clickHtml($event)" ng-bind-html="html" dir="{{ textDirection }}"></div>\n\t</div>\n\t<div class="text-image-hint" ng-if="empty && !editing" ng-class="{ \'selected\': isSelected() }">\n\t\t<div class="hint-content" ng-show="!isSelected() || !editmode || object.isLink">\n\t\t\t<i class="hint-icon lui-icon lui-icon--text"></i>\n\t\t\t<div class="text" q-translation="Object.TextImage.EmptyHint"></div>\n\t\t</div>\n\t\t<div class="hint-content" ng-show="isSelected() && editmode && !object.isLink">\n\t\t\t<i class="hint-icon lui-icon lui-icon--plus"></i>\n\t\t\t<div class="text" q-translation="Object.TextImage.EmptySelectedHint"></div>\n\t\t</div>\n\t</div>\n\t<div class="qv-media-tool-editor" ng-class="[sizeClass, visibilityClass, responsiveClass]" ng-if="initializing || editing || saving" qv-text-image-editor x-editor-options="editorOptions" x-save="save" dir="{{ direction }}"></div>\n</div>'}),define("extensions.qliktech/text-image/text-image-properties",["client.utils/property-resolver"],function(a){return{type:"items",component:"accordion",items:{data:{uses:"data",items:{measures:{disabledRef:""},dimensions:{disabledRef:""}}},settings:{uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}},presentation:{type:"items",translation:"properties.presentation",items:{responsive:{type:"string",component:"dropdown",ref:"responsive",translation:"properties.textImage.responsive",defaultValue:"all",undefinedValue:"none",snapshot:{tid:"property-responsive"},options:[{value:"all",translation:"properties.textImage.responsive.textImages"},{value:"text",translation:"properties.textImage.responsive.text"},{value:"images",translation:"properties.textImage.responsive.images"},{value:"none",translation:"properties.textImage.responsive.none"}]}}},markdown:{type:"string",ref:"markdown",show:!1,defaultValue:""},images:{type:"array",ref:"images",show:!1,defaultValue:[]},backgroundImage:{type:"items",translation:"properties.backgroundImage",grouped:!0,items:{useBackgroundImage:{ref:"background.isUsed",type:"boolean",translation:"properties.backgroundImage.use",component:"switch",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},backgroundUrl:{ref:"background.url.qStaticContentUrlDef.qUrl",layoutRef:"background.url.qStaticContentUrl.qUrl",schemaIgnore:!0,translation:"Common.Image",tooltip:{select:"properties.media.select",remove:"properties.media.removeBackground"},type:"string",component:"media",defaultValue:"",show:function(b){return a.getValue(b,"background.isUsed")}},backgroundSize:{ref:"background.size",translation:"properties.backgroundImage.size",type:"string",component:"dropdown",defaultValue:"auto",options:[{value:"auto",translation:"properties.backgroundImage.originalSize"},{value:"alwaysFit",translation:"properties.backgroundImage.sizeAlwaysFit"},{value:"fitWidth",translation:"properties.backgroundImage.sizeFitWidth"},{value:"fitHeight",translation:"properties.backgroundImage.sizeFitHeight"},{value:"fill",translation:"properties.backgroundImage.sizeStretch"}],show:function(b){return a.getValue(b,"background.isUsed")&&a.getValue(b,"background.url.qStaticContentUrlDef.qUrl")}},backgroundPosition:{ref:"background.position",translation:"Common.Position",type:"string",component:"align-matrix",defaultValue:"topLeft",show:function(b){return a.getValue(b,"background.isUsed")&&a.getValue(b,"background.url.qStaticContentUrlDef.qUrl")&&"fill"!==a.getValue(b,"background.size")},currentSize:function(b){return a.getValue(b,"background.size")}}}}}}}}}),define("extensions.qliktech/text-image/measure-utils",["general.utils/array-util","util"],function(a,b){function c(a,b){var c,d,e,f=[],g=[];for(c=a.map(function(a){return a.qDef.cId}),d=b.map(function(a){return a.qDef.cId}),e=d.length-1;e>=0;--e)c.contains(d[e])||f.push({index:e,id:d[e],measure:b[e]});for(e=0;e<c.length;++e)d.contains(c[e])?c.lastIndexOf(c[e])!==e&&g.push({index:e,id:c[e],measure:a[e]}):g.push({index:e,id:c[e],measure:a[e]});return{removed:f,added:g}}function d(a,b){return b.replace(/=\[(\w*?)]\((\w*?)\)/g,function(b,c,d){return a===d?"":b})}function e(a,b,c,d){var e=-1;return c.replace(/=\[(\w*?)]\((\w*?)\)/g,function(c,f,g){if(g===a){++e;var h="undefined"!=typeof d;if(!h||h&&e===d)return"=["+f+"]("+b+")"}return c})}function f(d,f){var g=f.qHyperCubeDef.qMeasures,h=c(d,g);h.removed.forEach(function(b){var c=b.index;g.splice(c,1),a.indexRemoved(f.qHyperCubeDef.qInterColumnSortOrder,f.qHyperCubeDef.qDimensions.length+c)}),h.added.forEach(function(c){var d=c.measure.qDef.cId,h=b.generateId();c.measure.qDef.cId=h,g.push(c.measure),a.indexAdded(f.qHyperCubeDef.qInterColumnSortOrder,f.qHyperCubeDef.qDimensions.length+g.length-1),f.markdown=e(d,h,f.markdown,1)})}return{removeMeasure:d,replaceMeasure:e,syncMeasures:f}}),define("extensions.qliktech/text-image/image-utils",["client.services/media-tool/markdown-html-parser","general.utils/paths","util"],function(a,b,c){function d(a,b){function c(a){for(var c=0;c<b.length;c++)if(b[c].id===a)return b[c].url.qStaticContentUrlDef.qUrl;return null}var d,e=[],f=[],g=a.map(function(a){return a.id||""}),h=b.map(function(a){return a.id});for(d=h.length-1;d>=0;--d)g.contains(h[d])||e.push({index:d,id:h[d],url:b[d].url});for(d=0;d<g.length;++d)h.contains(g[d])?g.lastIndexOf(g[d])!==d&&f.push({index:d,id:g[d],url:c(g[d])}):f.push({index:d,id:g[d],url:a[d].url});return{removed:e,added:f}}function e(a,b,c,d){var e=-1;return c.replace(/!\[(\w*?)]\((.*?)\)/g,function(c,f,g){if(f===a){++e;var h="undefined"!=typeof d;if(!h||h&&e===d)return"!["+b+"]("+g+")"}return c})}function f(f,g){g.images||(g.images=[]);var h=g.images,i=d(f,h);i.removed.forEach(function(a){var b=a.index;h.splice(b,1)}),i.added.forEach(function(d){var f=d.id,i=c.generateId(),j=a.unescapeMarkdown(d.url);j=b.stripBasePath(j),h.push({id:i,url:{qStaticContentUrlDef:{qUrl:j}}}),f?g.markdown=e(f,i,g.markdown,1):g.markdown=e(f,i,g.markdown,0)})}return{syncImages:f}}),define("extensions.qliktech/text-image/text-image",["jquery","qvangular","core.utils/deferred","lz-string","text!./text-image.ng.html","./text-image-properties","objects.backend-api/hypercube-api","client.services/media-tool/media-tool-service","general.utils/string-limits","./measure-utils","./image-utils","client.utils/rtl/rtl-util","general.utils/paths","core.utils/resize"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){return a.background&&a.background.isUsed&&a.background.url&&a.background.url.qStaticContentUrl&&a.background.url.qStaticContentUrl.qUrl||""}function p(d,e){var f=b.getService("$timeout"),g=e.find(".qv-media-tool-html")[0];return"none"===d.responsive||"undefined"==typeof d.responsive?f(function(){d.sizeClass="",d.sizeStyle={maxWidth:"",maxHeight:""},a(g).find("img").css(d.sizeStyle),d.visibilityClass="",d.responsiveClass=""},0):(d.sizeClass="",d.visibilityClass="hidden","images"===d.responsive?d.responsiveClass="responsive-images":"text"===d.responsive?d.responsiveClass="responsive-text":d.responsiveClass="responsive-images responsive-text",g?f(function(){d.sizeClass="",d.sizeStyle={maxWidth:"100%",maxHeight:"100%"},a(g).find("img").css(d.sizeStyle),a(g).addClass("default-font-size");var b=g.scrollHeight/g.clientHeight;a(g).removeClass("default-font-size"),b>1&&(d.sizeStyle={maxWidth:Math.floor(1/b*100)+"%",maxHeight:Math.floor(1/b*100)+"%"},a(g).find("img").css(d.sizeStyle)),b>3?d.sizeClass="bp-4":b>2?d.sizeClass="bp-3":b>1.5?d.sizeClass="bp-2":b>1?d.sizeClass="bp-1":d.sizeClass="",d.visibilityClass=""},10):(d.visibilityClass="",c.resolve()))}function q(a){return!h.hasContent(a)||""===a.trim()}function r(a){var b=0;if(document.createRange){var c=document.createRange();if(c.selectNodeContents(a),c.getBoundingClientRect){var d=c.getBoundingClientRect();d&&(b=d.bottom-d.top)}}return b}function s(a){return!q(a.markdown)||o(a)}var t,u,v=b.getService("$sce");return t={auto:"auto auto",alwaysFit:"contain",fitWidth:"100% auto",fitHeight:"auto 100%",fill:"100% 100%"},u={topLeft:"0% 0%",centerLeft:"50% 0%",bottomLeft:"100% 0%",topCenter:"0% 50%",centerCenter:"50% 50%",bottomCenter:"100% 50%",topRight:"0% 100%",centerRight:"50% 100%",bottomRight:"100% 100%"},b.directive("qvTextImageEditor",[function(){return{restrict:"A",scope:{editorOptions:"=",save:"="},link:function(b,c){h.show(c,b.editorOptions),c.on("qv-outside",function(c){var d=a(c.target);d.closest(".qv-texttool-toolbar, .modal-container, .qui-immidiateContextual, .text-image-hint").length||b.save()}),b.$on("$destroy",function(){b.save(),h.hide()})}}}]),{type:"text-image",BackendApi:g,definition:f,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],customErrorMessage:{calcCond:""}},images:[],markdown:"",background:{url:{},size:"auto"}},data:{measures:{min:0,max:1e3,add:function(a,b){b.markdown+="=[]("+a.qDef.cId+")"},remove:function(a,b){b.markdown=j.removeMeasure(a.qDef.cId,b.markdown)},replace:function(a,b,c,d){d.markdown=j.replaceMeasure(b.qDef.cId,a.qDef.cId,d.markdown)}}},support:{cssScaling:!0,snapshot:s,export:s,exportData:!0,sharing:!1},exportProperties:null,importProperties:null,template:e,showRequirements:function(){return!1},getDropMeasureOptions:function(a,b,c,d){b.getMeasures().length<b.maxMeasures()?"expression"===a.item.type?b.addExpressionMeasure(a.item.name,"").then(function(){c.save()}):b.addLibraryMeasure(a.item.id).then(function(){c.save()}):(a.ReplaceMeasures(c,b),d())},controller:["$scope","$element",function(e,f){function g(){var a=h.getEditorElement(),c=b.getService("$compile");a.attr("qva-rtl-supported-input",e.options.direction),a.attr("x-auto-direction-for-paragraphs",""),c(a)(e)}function s(a){var b=[];return a.find(".tokenized-measure").each(function(a,c){var e=c.getAttribute("data-measure");e=d.decompressFromBase64(e),b.push(JSON.parse(e))}),b}function w(a){function b(a){for(var b=h.getOptions().insertedImages,c=0;c<b.length;c++)if(b[c].url===a)return b[c].urlDef;return null}var c=[];return a.find("img:not(.tokenized-measure)").map(function(a,d){var e=d.getAttribute("data-image-id"),f=d.getAttribute("src"),g=b(f);g||(g=d.getAttribute("src")),c.push({id:e,url:g})}),c}function x(){b.$apply(e,function(){e.editing=!1})}var y=f.find(".qv-ti");e.isSelected=function(){return e.options.isActive||e.options.isZoomed},e.$watch("editing",function(a){e.object.preventDrag=a}),e.edit=function(){!e.object.inEditState()||e.editing||e.object.isLink||e.isSelected()&&(e.saving=!1,e.saved=!1,e.backendApi.getProperties().then(function(a){var b=e.object.getCreatePropertyHandler();b.setProperties(a),e.editorOptions={markdown:a.markdown,maxlength:i.textImage,toolbar:{style:"popover",buttons:"all",width:558},useMeasures:!0,layout:e.backendApi.model.layout,properties:a,propertyHandler:b,copiedMeasures:[],insertedImages:[],onOpen:function(a){a.saveRange(),e.$apply(function(){e.editing=!0,e.initializing=!1}),setTimeout(function(){g()},0)},isActive:function(){return e.editing||e.initializing}},e.initializing=!0}))},e.save=function(){if(!e.saving&&!e.saved){h.closing();var a=h.getMarkdown(),b=h.getEditorElement();if(null!==a&&a!==e.markdown){e.saving=!0;var c=h.getOptions().properties;c.markdown=a,j.syncMeasures(s(b),c),k.syncImages(w(b),c),e.backendApi.model.save(),e.saved=!0}else e.editing=!1}},e.clickHtml=function(b){var c=!e.navigation;c&&a(b.target).closest("a").length&&b.preventDefault()},this.onPaint=function(a){var d="",f="",g="",i="",j=[];if(e.finishRender=!1,e.saving&&(e.editing=!1,e.saving=!1),d=o(a)){m.stripBasePath(d),d=d.replace(/"/g,'\\"'),d=d.replace(/'/g,"\\'"),f=m.getUrl(d),g=t[a.background.size]||t.auto,i=u[a.background.position]||u.topLeft;var k=new Image,n=c();j.push(n.promise),k.onload=function(){n.resolve()},k.onerror=function(){n.resolve()},k.src=f,k.complete&&(k.onload=null,k.onerror=null,n.resolve())}y.css({backgroundImage:"url('"+f+"')",backgroundSize:g,backgroundPosition:i,backgroundRepeat:"no-repeat"}),e.empty=q(a.markdown)&&!d,e.html=v.trustAsHtml(h.toHTML(a.markdown,a,!0)),e.direction=this.view.options.direction,e.textDirection=l.getAutoOrAlternativeDirection(a.markdown),e.markdown=a.markdown,e.responsive=a.responsive;var r=p(e,y).then(function(){return b.getService("$timeout")(function(){return y.find("img").each(function(a,b){b.complete||!function(a){var b=c();j.push(b.promise),a.onload=function(){b.resolve()},a.onerror=function(){b.resolve()}}(b)}),j.length?c.all(j).then(function(a){return p(e,y).then(function(){return e.finishRender=!0,a})}):void(e.finishRender=!0)},0,!1)});return r.then(function(){e.backendApi.isSnapshot&&(a.snapshotData.scrollTopPercent&&y.closest(".qv-object-content").css("top",-a.snapshotData.scrollTopPercent+"%"),a.snapshotData.verticalScrollWidth&&y.find(".qv-media-tool-html").css("padding-right",a.snapshotData.verticalScrollWidth+"px")),c().resolve()})},this.onResize=function(){return this.onPaint.apply(this,arguments)},this.setInteractionState=function(a){this._super(a),e.navigation=(e.options.navigation||e.options.limitedInteraction)&&e.object.inAnalysisState(),e.editmode=e.object.inEditState(),e.editmode||(e.editing=!1)},this.getPreferredSize=function(){var a=c(),b=e.$watch("finishRender",function(c){if(c===!0){var d=0;y.find(".qv-media-tool-html").contents().each(function(){d+=3===this.nodeType?r(this):this.offsetHeight,"BR"===this.nodeName&&(d+=8)}),a.resolve({w:y.width(),h:d}),b()}});return a.promise},this.setSnapshotData=function(b){if(e.backendApi.isSnapshot)e.object.layout.snapshotData.scrollTopPercent&&(b.snapshotData.scrollTopPercent=e.object.layout.snapshotData.scrollTopPercent);else{var c=y.find(".qv-media-tool-html")[0];b.snapshotData.scrollTopPercent=c.scrollTop/c.clientHeight*100,b.snapshotData.verticalScrollWidth=a(c).innerWidth()-c.clientWidth}},n.on("start",x),e.$on("$destroy",function(){n.off("start",x)})}],getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()}}}),define("objects.backend-api/pivot-api",["./backend-api"],function(a){"use strict";function b(a,b,c){var d,e,f,g=[];for(e=0;e<b.length;e++)for(d=0;d<a.length;d++)f={qType:c,qCol:b[e],qRow:a[d]},g.push(f);return g}var c;return c=a.extend("PivotApi",{init:function(a){this._super(a,"/qHyperCubeDef",{mode:"P"}),this.cacheCube.setMethodName("GetHyperCubePivotData")},updateCache:function(a){a&&a.qHyperCube&&"P"===a.qHyperCube.qMode?(this.cacheCube.set(a.qHyperCube.qPivotDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(a){switch(this.model.layout.qHyperCube.qMode){case"P":return this.cacheCube.getData(a);default:throw"you are using a non-supported backend-api"}},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},select:function(a,c,d){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.rpc("SelectPivotCells",null,[this.path,b(a,c,d)]);default:throw"you are using a non-supported backend-api"}},expandTop:function(a,b,c){return this.model.rpc("ExpandTop",null,[this.path,a,b,c])},expandLeft:function(a,b,c){return this.model.rpc("ExpandLeft",null,[this.path,a,b,c])},collapseTop:function(a,b,c){return this.model.rpc("CollapseTop",null,[this.path,a,b,c])},collapseLeft:function(a,b,c){return this.model.rpc("CollapseLeft",null,[this.path,a,b,c])},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},getSize:function(){return this.model.layout.qHyperCube.qSize}})}),define("extensions.qliktech/pivot-table/pivot-table-properties",["client.property-panel/default-properties","client.utils/property-resolver","util","translator"],function(a,b,c,d){function e(a,b,c){if(!c.properties.qHyperCubeDef.qIndentMode)return!0;var d,e=c.properties.qHyperCubeDef.qInterColumnSortOrder.indexOf(-1),f=c.properties.qHyperCubeDef.qNoOfLeftDims;return e>-1&&e<f&&f--,d=c.properties.qHyperCubeDef.qDimensions.indexOf(a),0===d||d>=f}var f,g,h;f={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{alwaysFullyExpanded:{ref:"qHyperCubeDef.qAlwaysFullyExpanded",type:"boolean",translation:"properties.pivot.fullyExpanded",defaultValue:!1},indentMode:{ref:"qHyperCubeDef.qIndentMode",type:"boolean",translation:"properties.pivot.indentMode"}}}}},g={uses:"sorting",component:"pivot-sorting"};var i={type:"items",component:"pivot-data",translation:"properties.data",addTranslation:"Properties.AddData",items:{dimensions:c.extend(!0,{},a.dimensions,{items:{globalGrouping:{type:"boolean",translation:"properties.dimensionLimits.globalGrouping",ref:"qOtherTotalSpec.qGlobalOtherGrouping",defaultValue:!1,show:function(a){return"OTHER_OFF"!==b.getValue(a,"qOtherTotalSpec.qOtherMode")}},totalMode:{type:"string",component:"switch",translation:"properties.showTotals",ref:"qOtherTotalSpec.qTotalMode",defaultValue:"TOTAL_OFF",trueOption:{value:"TOTAL_EXPR",translation:"properties.on"},falseOption:{value:"TOTAL_OFF",translation:"properties.off"},show:e},totalsLabel:{type:"string",component:"expression",expressionType:"StringExpr",ref:"qTotalLabel",translation:"properties.dimensionLimits.totals",defaultValue:function(){return d.get("properties.dimensionLimits.totals")},show:function(a,c,d){return"TOTAL_OFF"!==b.getValue(a,"qOtherTotalSpec.qTotalMode")&&e(a,c,d)}}}}),measures:c.extend(!0,{},a.measures,{items:{tableColorBgByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.0.qExpression",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:""},tableColorByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.1.qExpression",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",change:function(a){void 0===a.qAttributeExpressions[0]&&(a.qAttributeExpressions[0]={})}}}})}};return h={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:i,sorting:g,addons:h,settings:f}}}),define("extensions.qliktech/pivot-table/pivot-sorting-util",["general.utils/array-util"],function(a){function b(a){function b(){for(var b=[],c=0;c<d.length;c++)b.push(c);var e=a.qMeasures.length>=2;return e&&b.push(-1),b}var d=a.qDimensions;c(d,a.qInterColumnSortOrder)&&(a.qInterColumnSortOrder=b())}function c(a,b){var c={},d=[],e=!1,f=b.indexOf(-1)!==-1;b.forEach(function(a){c[a]?e=!0:c[a]=!0}),e=f?e||a.length+1!==Object.keys(c).length:e||a.length!==Object.keys(c).length,Object.keys(c).forEach(function(a){"-1"!==a&&d.push(parseInt(a,10))}),d=d.sort(function(a,b){return a-b});for(var g=0;g<d.length;++g)e=e||d[g]!==g;return e}function d(c){function d(){for(var b=0;b<e.length;b++)if(e[b]!==-1&&e[b]!==b){var c=e[b],d=e.indexOf(b),h=e[d];
a.swap(e,b,d),a.swap(f,b,d),a.swap(g,g.indexOf(c),g.indexOf(h))}}b(c);var e,f=c.qDimensions,g=c.qInterColumnSortOrder;e=g.filter(function(a){return a!==-1}),d()}function e(a,b){var c=a.qDimensions,d=a.qInterColumnSortOrder,e=[],f=b.indexOf(-1);b.forEach(function(a){a!==-1&&e.push(c[a])}),e.forEach(function(a,b){c[b]=a}),d.splice(0,d.length);for(var g=0;g<e.length;g++)d.push(g);f>-1&&d.splice(f,0,-1)}function f(a,b){var c=a.qMeasures,d=[];b.forEach(function(a){d.push(c[a])}),c.splice(0,c.length),d.forEach(function(a){c.push(a)})}return{validatePivotHyperCube:b,fixPivotHypercubeOrders:d,reorderPivotDimensions:e,reorderMeasures:f,isInvalidOrderArray:c}}),define("extensions.qliktech/pivot-table/pivot-hypercube-handler",["objects.utils/data-properties/hypercube-handler","core.utils/deferred","general.utils/array-util","extensions.qliktech/pivot-table/pivot-sorting-util","util"],function(a,b,c,d,e){"use strict";var f,g=1e3;return f=a.extend({addDimension:function(a,c){var f=this.getDimensions(),g=this;if(a.qDef.cId||(a.qDef.cId=e.generateId()),f.length<this.maxDimensions())return this.autoSortDimension(a).then(function(){var e,h,i=g.hcProperties.qNoOfLeftDims,j=f.length;return d.fixPivotHypercubeOrders(g.hcProperties),e=g.hcProperties.qInterColumnSortOrder,h=e.indexOf(-1),c||i!==-1?!c&&i>=0?(h>=i?(e.splice(h,1),e.push(j),e.splice(h+1,0,-1)):(h!==-1&&--i,e.push(j)),f.splice(i,0,a),g.hcProperties.qNoOfLeftDims++):(0===j&&(g.hcProperties.qNoOfLeftDims=0),e.push(j),f.push(a)):(g.hcProperties.qNoOfLeftDims=1,e.unshift(j),f.splice(0,0,a)),b.resolve(a)})},removeDimension:function(a){var e,f,g,h=this.getDimensions(),i=this.properties.qHyperCubeDef.qNoOfLeftDims,j=this.hcProperties.qInterColumnSortOrder;for(g=0;g<j.length;g++)if(j[g]===a){f=g;break}return f+1<=i&&this.properties.qHyperCubeDef.qNoOfLeftDims--,e=h.splice(a,1)[0],c.indexRemoved(this.hcProperties.qInterColumnSortOrder,a),d.fixPivotHypercubeOrders(this.hcProperties),b.resolve(e)},addMeasure:function(a){var c=this.getMeasures(),d=this;if(a.qDef.cId||(a.qDef.cId=e.generateId()),delete a.qDef.qNumFormat,c.length<this.maxMeasures()){var f=1===c.length;return c.push(a),this.autoSortMeasure(a).then(function(){return f&&d.hcProperties.qInterColumnSortOrder.push(-1),a})}if(c.length<g)return this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(a),b.resolve(a)},removeMeasure:function(a){var c,d,e,f=this.getMeasures();if(a<f.length){if(c=2===f.length,d=this.hcProperties.qMeasures.splice(a,1)[0],c){var g=this.hcProperties.qInterColumnSortOrder;e=g.indexOf(-1),g.splice(e,1),e+1<=this.hcProperties.qNoOfLeftDims&&this.hcProperties.qNoOfLeftDims--}}else d=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(a-f.length,1)[0];return b.resolve(d)},getSorting:function(){throw"don't call this"},changeSorting:function(){throw"don't call this"},setSorting:function(){throw"don't call this"}})}),define("text!extensions.qliktech/pivot-table/pivot-table.ng.html",[],function(){return'<div class="qv-pt" ng-class="{ \'qv-pt-interactive\': interactive, \'sortable-active\': pivoting.dragPlaceholder, \'qv-rtl-layout\': options.direction === \'rtl\' }">\n\t<qv-scroll-area x-non-mouse-viewport-scrolling="nonMouseViewportScrolling"\n\t\t\t\t\tclass="qv-grid-object-scroll-area"\n\t\t\t\t\tqva-delegated-activate=".qv-pt-expandable#interactive && !selectionsApi.active && collapseExpand($event);"\n\t\t\t\t\tqv-sortable-list="pivoting"\n\t\t\t\t\tx-direction="viewport.direction">\n\t\t<table\tdir="{{viewport.direction}}"\n\t\t\t\tqv-selections-select-while-locked="selectWhileLocked()"\n\t\t\t\tqv-selections-toggle-dimension-value="{ selector: \'.cell\' }"\n\t\t\t\tqv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, $event)"\n\t\t\t\tqv-selections-exclude-toggle-dimension-value="excludeDimensionToggle($event)"\n\t\t\t\tqv-selections-multiselect="{ selector: \'.cell:not(.null-value)\' }"\n\t\t\t\tqv-selections-start-multiselect="interactive && activateSelections(cell)"\n\t\t\t\tqv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\n\t\t\t\tqv-selections-end-multiselect="interactive && multiselect()">\n\t\t\t<colgroup>\n\t\t\t\t<col ng-repeat="cell in metaGhostHeaders.headers" ng-style="cell.style" />\n\t\t\t</colgroup>\n\t\t\t<tbody>\n\t\t\t\t<tr ng-repeat="row in grid.headerRows" tid="header.row"\n\t\t\t\t\tng-class="row.classList" on-finish-render>\n\t\t\t\t\t<th ng-repeat="cell in row.cells"\n\t\t\t\t\t\tng-class="cell.classList"\n\t\t\t\t\t\tclass="cell"\n\t\t\t\t\t\tcolspan="{{cell.colspan}}"\n\t\t\t\t\t\trowspan="{{cell.rowspan}}"\n\t\t\t\t\t\tng-style="cell.style"\n\t\t\t\t\t\tqv-pivot-table-include="cell.templateSrc"\n\t\t\t\t\t\ttitle="{{cell.text}}"\n\t\t\t\t\t\ttid="header.row.cell"></th>\n\t\t\t\t</tr>\n\t\t\t\t<tr ng-repeat="row in grid.rows" tid="data.row" on-finish-render>\n\t\t\t\t\t<td ng-repeat="cell in row.cells"\n\t\t\t\t\t\tng-class="cell.classList"\n\t\t\t\t\t\tclass="cell"\n\t\t\t\t\t\tcolspan="{{cell.colspan}}"\n\t\t\t\t\t\trowspan="{{cell.rowspan}}"\n\t\t\t\t\t\tng-style="cell.style"\n\t\t\t\t\t\tqv-pivot-table-include="cell.templateSrc"\n\t\t\t\t\t\ttitle="{{cell.text}}"\n\t\t\t\t\t\ttid="data.row.cell"></td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</qv-scroll-area>\n</div>\n'}),define("text!extensions.qliktech/pivot-table/cell-item.ng.html",[],function(){return'<div class="value" ng-class="{ \'qv-rtl-text\': cell.isRtl }" ng-bind="cell.text" dir="{{cell.dir}}"></div>\n'}),define("text!extensions.qliktech/pivot-table/header-cell-item.ng.html",[],function(){return'<div class="value" ng-class="{ \'qv-rtl-text\': cell.isRtl }">\n\t<i class="qv-pt-expandable lui-icon" ng-if="cell.collapseExpandClass" ng-class="cell.collapseExpandClass"></i>\n\t<span ng-bind="cell.text" dir="{{cell.dir}}"></span>\n</div>\n'}),define("text!extensions.qliktech/pivot-table/meta/meta-left.ng.html",[],function(){return'<div class="left-meta-headers list"\n\t tid="meta.rows"\n\t ng-repeat="list in [pivoting.rows]"\n\t qv-pivot-table-include="list.templateSrc">\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-top.ng.html",[],function(){return'<div class="top-meta-headers list"\n\t tid="meta.columns"\n\t ng-repeat="list in [pivoting.columns]"\n\t qv-pivot-table-include="list.templateSrc">\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-list.ng.html",[],function(){return'<div class="button-wrapper"\n\t ng-repeat="header in list.items track by header.id"\n\t qv-pivot-table-include="header.templateSrc">\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-item.ng.html",[],function(){return'<div class="lui-button qv-pt-meta-button"\n\t\ttid="meta.button"\n\t\tng-style="header.style"\n\t\tng-class="{ \'lui-active\': header.open, \'pseudo\': header.isPseudoDim, \'dragging\': header.dragging, \'lui-disabled\': !interactive || selectionsApi.active }"\n\t\tqva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\n\t\tqva-activate="!header.isPseudoDim && !selectionsApi.active && interactive && showDimension($event, header)">\n\t<span ng-if="header.locked" class="lui-icon lui-icon--lock"></span>\n\t<div class="meta-text" dir="{{header.dir}}" title="{{header.title}}">{{header.title}}</div>\n\t<span ng-if="!header.isPseudoDim" class="lui-caret"></span>\n</div>\n'}),define("ng",[],function(){return{load:function(a,b,c,d){function e(){"undefined"!=typeof window&&window.qvangularGlobal?c(window.qvangularGlobal.getService(a)):setTimeout(e,5)}d.isBuild||"undefined"==typeof window?c():e()}}}),define("objects.grid/data-grid-provider",["qvangular","./data-grid"],function(a,b){"use strict";a.provider("qvDataGrid",function(){this.$get=[function(){return function(a){return new b(a)}}]})}),define("extensions.qliktech/pivot-table/meta/ghost-headers-provider",["qvangular","util","translator","general.utils/support"],function(a,b,c,d){"use strict";function e(a,b,c){this.calcApprMaxGlyphCnt=a,this.maxGlyphCnt=c,this.isWidthFlexible=b,this.style={}}function f(a,c,e){var f=10,g={glyphWidth:i,collapseExpandIconGlyphCnt:d.treatAsDesktop()?3:4,columnPaddingGlyphCnt:3,metaHeaderMaxGlyphCnt:(150+f)/i,cellPaddingGlyphCnt:Math.ceil(1.5),buttonPaddingGlyphCnt:Math.ceil(2.5),buttonArrowGlyphCnt:Math.ceil(1.625),buttonMarginOfSafetyGlyphCnt:2,leftTree:{minNonEmptyGlyphCnt:12,emptyGlyphCnt:3,widthFactor:.35},topTree:{wideWidthFactor:.3,growFactor:1.2,minGlyphCnt:8}};this.opts=b.extend(!0,g,a),this.layout=c,this.viewportRect=e,this.headers=[],this.maxGlyphs=0,this.availableGlyphs=0,this.leftCellCnt=0,this.dataColumnsInfo={cnt:0,width:0}}function g(a){var b=!!this.layout.qHyperCube.qAlwaysFullyExpanded;return this.sortOrder.filter(function(b,c){return a?c>=this.leftDimCnt:c<this.leftDimCnt},this).map(function(a,c){var d=0;if(a===-1)return 0;var e=this.layout.qHyperCube.qDimensionInfo[a];return c+1<this.leftDimCnt?(d=e.qApprMaxGlyphCount,b||(d+=this.opts.collapseExpandIconGlyphCnt),d=Math.max(e.othersLabel.length,d)):(d=e.qApprMaxGlyphCount,d+=this.opts.columnPaddingGlyphCnt),d},this).sort(function(a,b){return b-a})[0]||0}function h(a){return this.sortOrder.filter(function(b,c){return a?c>=this.leftDimCnt:c<this.leftDimCnt},this).map(function(a){var b=0;return a===-1?b=c.get("Common.Measures").length:(b=this.layout.qHyperCube.qDimensionInfo[a].qFallbackTitle.length+this.opts.buttonArrowGlyphCnt,this.layout.qHyperCube.qDimensionInfo[a].othersLabel&&(b=Math.max(this.layout.qHyperCube.qDimensionInfo[a].othersLabel.length,b))),b+this.opts.buttonPaddingGlyphCnt+this.opts.buttonMarginOfSafetyGlyphCnt},this).sort(function(a,b){return b-a})[0]||0}var i=8;f.prototype={_reset:function(){this.headers.length=0,this.maxGlyphs=0,this.availableGlyphs=0,this.leftCellCnt=0,this.dataColumnsInfo.cnt=0,this.dataColumnsInfo.width=0},_addCollapseExpandHeader:function(a){var b=new e(this.opts.collapseExpandIconGlyphCnt,!1);a.push(b),this.availableGlyphs-=this.opts.collapseExpandIconGlyphCnt},_addCollapseExpandHeaders:function(a){for(var b=0;b<this.leftDimCnt-1&&this.leftDimCnt>1&&this.leftDimCnt<=this.sortOrderCnt;++b)this._addCollapseExpandHeader(a)},_getLeftCollapseExpandCnt:function(a){return this.isIndentMode?this.leftDimCnt-1:a},_addLeftTreeMetaGhostHeader:function(a,b,c){var d=c>b,f=new e(b,d,c);a.push(f),this.availableGlyphs-=b},_addEmptyLeftTreeMetaGhostHeader:function(a,b){var c=new e(b||this.opts.leftTree.emptyGlyphCnt,!1);a.push(c),this.availableGlyphs-=c.calcApprMaxGlyphCnt},_getDataGhostHeaders:function(){var a,b,c=[];for(a=0;this.availableGlyphs>0&&this.totDataColCnt>0&&a<this.totDataColCnt;++a){if(b=this.longestMeasureGlyphCnt,b+=this.opts.columnPaddingGlyphCnt,b/this.longestTopDimGlyphCnt<this.opts.topTree.wideWidthFactor&&(b+=b*this.opts.topTree.growFactor),0===a&&b>this.availableGlyphs&&(b=this.availableGlyphs),this.availableGlyphs-b<0){this.availableGlyphs=0;break}this.availableGlyphs-=b;var d=new e(b,!0);c.push(d)}return c},_getLeftGhostHeaders:function(a,b,c){var d=[],e=this.opts.collapseExpandIconGlyphCnt*this._getLeftCollapseExpandCnt(b),f=this.longestLeftDimGlyphCnt,g=Math.min(this.longestLeftDimTitleGlyphCnt,this.opts.metaHeaderMaxGlyphCnt);return b>0?this.isIndentMode?this._getLeftGhostHeadersIndent(d,f,g,e,b,c):this._getLeftGhostHeadersNonIndent(d,b,g,e):this._addEmptyLeftTreeMetaGhostHeader(d,a),d},_isSpaceForDataColumn:function(a,b){return this.maxGlyphs-a>=b.calcApprMaxGlyphCnt},_getLeftGhostHeadersIndent:function(a,b,c,d,e,f){var g,h,i=b;if(this.pseudoInLeftTree&&(i+=this.longestMeasureTitleGlyphCnt),e>0&&i<this.opts.leftTree.minNonEmptyGlyphCnt&&(i=this.opts.leftTree.minNonEmptyGlyphCnt),i<c-d&&(0===f.length||f.length>0&&this._isSpaceForDataColumn(c-d,f[0]))&&(i=c-d),i+d>this.availableGlyphs&&f.length>0&&!this._isSpaceForDataColumn(i+d,f[0])){var j=[],k=[];f.length=1,j.push(Math.ceil(i/3)),j.push(Math.ceil(this.opts.leftTree.widthFactor*this.maxGlyphs)),j.push(this.opts.metaHeaderMaxGlyphCnt),k.push(Math.min.apply(null,j)),e>0&&k.push(this.opts.leftTree.minNonEmptyGlyphCnt),k.push(this.availableGlyphs),h=i,g=Math.max.apply(null,k)}else g=i;this._addCollapseExpandHeaders(a),this._addLeftTreeMetaGhostHeader(a,g,h)},_getLeftGhostHeadersNonIndent:function(a,b,c,d){this._getLeftDimsWidths(b,c,d).forEach(function(b){this._addCollapseExpandHeader(a),this._addLeftTreeMetaGhostHeader(a,b)},this)},_getLeftDimsWidths:function(a,b,c){for(var d,e,f,g=[],h=0,i=0,j=0;j<a;++j)d=this._getDimGlyphCnt(j)+this.opts.cellPaddingGlyphCnt,h+=d,g.push({target:d,adjusted:d});if(h<b-c){var k=b-c-h,l=g[g.length-1];l.adjusted=l.target+=Math.min(k,this.maxGlyphs-h),h=g.reduce(function(a,b){return a+b.target},0)}if(h+c>this.availableGlyphs&&h+c>this.maxGlyphs*this.opts.leftTree.widthFactor)for(h=0,j=0;j<a;++j)d=Math.min(this.opts.metaHeaderMaxGlyphCnt-c,g[j].target>8?g[j].target/2:g[j].target),g[j].adjusted=d,h+=d;if(h+c>this.availableGlyphs&&h+c>this.maxGlyphs)for(i=(h+c-this.maxGlyphs)/h,j=0;j<a;++j)d=g[j].adjusted,g[j].adjusted=Math.floor(d-d*i);else if(h+c<this.availableGlyphs)for(f=this.availableGlyphs-h-c,e=g.reduce(function(a,b){return a+(b.adjusted<b.target?b.target:0)},0),j=0;j<a;++j)d=g[j],d.adjusted<d.target&&(g[j].adjusted+=Math.floor(d.target/e*f));return g.map(function(a){return a.adjusted})},_calculateGhostMetaHeadersWidth:function(a){var b,c,d,e=1;this.headers.forEach(function(b){b.widthFactor=b.calcApprMaxGlyphCnt*this.opts.glyphWidth/a,e-=b.widthFactor},this),e>0&&(b=e,d=this.headers.filter(function(a){return a.isWidthFlexible&&a.maxGlyphCnt>a.calcApprMaxGlyphCnt}),c=d.reduce(function(a,b){return b.maxGlyphCnt-b.calcApprMaxGlyphCnt},0),d.forEach(function(d){var f=d.maxGlyphCnt-d.calcApprMaxGlyphCnt,g=f/c,h=Math.min(f*this.opts.glyphWidth/a,g*b);d.widthFactor+=h,e-=h},this)),e>0&&(d=this.headers.filter(function(a){return a.isWidthFlexible===!0}),d.forEach(function(a){a.widthFactor+=e/d.length})),this.headers.forEach(function(a){a.style.width=100*a.widthFactor+"%"}),this.headers.length>this.leftCellCnt&&(this.dataColumnsInfo.width=this.headers[this.leftCellCnt].widthFactor*a)},update:function(a,b){var c,d,e,f,g=[];for(this._reset(),this.maxGlyphs=Math.floor(this.viewportRect.width/this.opts.glyphWidth),this.availableGlyphs=this.maxGlyphs,this.availableGlyphs>0&&(g=this._getDataGhostHeaders()),c=this._getLeftGhostHeaders(a,b,g),f=g.reduce(function(a,b){return a+b.calcApprMaxGlyphCnt},0),e=c.reduce(function(a,b){return a+b.calcApprMaxGlyphCnt},0);g.length>0&&f+e>this.maxGlyphs;){if(d=g.pop(),0===g.length&&this.maxGlyphs-e>=this.opts.topTree.minGlyphCnt){d.calcApprMaxGlyphCnt=this.maxGlyphs-e,g.push(d),f=d.calcApprMaxGlyphCnt;break}f-=d.calcApprMaxGlyphCnt}this.headers=c.concat(g),this.dataColumnsInfo.cnt=g.length,this.leftCellCnt=c.length,this._calculateGhostMetaHeadersWidth(this.viewportRect.width)},_getDimGlyphCnt:function(a){var b=this.pseudoDimIndex;if(b===a)return this.longestMeasureTitleGlyphCnt;var c=a>b?a-1:a;return this.layout.qHyperCube.qDimensionInfo[c].qApprMaxGlyphCount},getDimInfo:function(a){if(a!==this.pseudoDimIndex)return this.layout.qHyperCube.qDimensionInfo[this.sortOrder[a]]}},Object.defineProperties(f.prototype,{isIndentMode:{get:function(){return this.layout.qHyperCube.qIndentMode}},pseudoDimIndex:{get:function(){var a=this.sortOrder.indexOf(-1);return~a?a:this.sortOrderCnt}},longestMeasureGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(a){return Math.max(a.qApprMaxGlyphCount,2)}).sort(function(a,b){return b-a})[0]||0}},longestMeasureTitleGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle.length}).sort(function(a,b){return b-a})[0]||0}},longestLeftDimTitleGlyphCnt:{get:function(){return h.call(this)}},longestLeftDimGlyphCnt:{get:function(){return g.call(this)}},longestTopDimGlyphCnt:{get:function(){return g.call(this,!0)}},sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}},totDataColCnt:{get:function(){return this.layout.qHyperCube.qSize.qcx}},pseudoInLeftTree:{get:function(){return this.pseudoDimIndex<this.leftDimCnt}}}),a.provider("qvPivotTableMetaGhostHeadersProvider",function(){this.$get=[function(){return function(a,b,c){return new f(a,b,c)}}]})}),define("extensions.qliktech/pivot-table/meta/pivoting",["general.sortable/sortable-item-lists","translator","client.utils/rtl/rtl-util"],function(a,b,c){"use strict";var d;return d=a.extend("SortableMetaLists",{init:function(a,b,c,d,e,f,g){this._super.apply(this,[a]),this.layout=e,this.backendApi=b,this.grid=c,this.metaGhostHeaders=d,this.$id=f,this.currentPopover=g,this.rows=this.createList(),this.rows.templateSrc="pt-meta-list.ng.html",this.columns=this.createList(),this.columns.templateSrc="pt-meta-list.ng.html"},reset:function(){this._super.apply(this,arguments)},update:function(a){var d,e,f,g,h,i;for(this.reset(),d=0;d<this.sortOrderCnt;++d){if(e=this.sortOrder[d],d<this.leftDimCnt)f=this.rows;else{if(a<=0)continue;f=this.columns}e!==-1?(i=this.layout.qHyperCube.qDimensionInfo[e].qGroupFieldDefs[this.layout.qHyperCube.qDimensionInfo[e].qGroupPos],h=this.layout.qHyperCube.qDimensionInfo[e].qFallbackTitle,g={title:h,id:this.layout.qHyperCube.qDimensionInfo[e].cId,fieldName:i,style:{},qvaOutsideIgnoreFor:"qv-pt-meta-header-"+this.$id,open:this.currentPopover.header&&i===this.currentPopover.header.fieldName,dimIx:e,locked:!!this.layout.qHyperCube.qDimensionInfo[e].qLocked,dir:c.getAutoOrAlternativeDirection(h)}):(h=b.get("Common.Measures"),g={title:b.get("Common.Measures"),dimIx:-1,isPseudoDim:!0,style:{},locked:!1,dir:c.getAutoOrAlternativeDirection(h)}),g.templateSrc="pt-meta-item.ng.html",f.addSortableItem(g)}}}),Object.defineProperties(d.prototype,{sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}}}),d}),define("extensions.qliktech/pivot-table/meta/pivoting-provider",["qvangular","./pivoting"],function(a,b){"use strict";function c(){this.$get=[function(){return function(a,c,d,e,f,g,h,i){return new(b.extend("PivotTableSortableMetaLists",{addPlaceholder:function(a,b){var c=this._super.apply(this,arguments);c.style.width=b.width,a.dragging=!0},allowAutoScroll:function(){return!1},onBegin:function(){this._super.apply(this,arguments),h.off(),i.off(),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!0)},enable:function(){this._super.apply(this,arguments),h.on(),i.on(),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!1)},allowDrag:function(){var a=this._super.apply(this,arguments);return a&&!(e&&e.qSelectionInfo&&e.qSelectionInfo.qMadeSelections)},onMove:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onMoveToList:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onEnterList:function(a){a===this.rows&&a.isEmpty()&&this.metaGhostHeaders.update(2*this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt),this._super.apply(this,arguments),a===this.columns&&this.rows.isEmpty()&&this.metaGhostHeaders.update(this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt)},patchPivotingProperties:function(){var a,b=[];this.rows.items.forEach(function(a){b.push(a.dimIx)}),a=b.length,this.columns.items.forEach(function(a){b.push(a.dimIx)});var c=[[],!0];c[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(b)},c[0][1]={qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(a)},this.backendApi.applyPatches(c)},toggleCellsWhenSorting:function(){var a,b;for(a=arguments.length-1;a>=0;--a)if(Array.isArray(arguments[a])){var c,d,e,f,g=arguments[a];for(c=0;c<g.length;++c)for(e=g[c].cells.length,d=0;d<e;++d)f=g[c].cells[d],f.isMeta?f[b?"addClass":"removeClass"]("drop"):f[b?"addClass":"removeClass"]("locked")}else b=arguments[a]}}))({listSelector:".meta",listKey:function(a){return a.find(".list").scope().list},itemSelector:".button-wrapper",itemDragSelector:".button-wrapper",itemKey:"header"},a,c,d,e,f,g)}}]}a.provider("qvPivotTablePivoting",c)}),define("extensions.qliktech/pivot-table/snapshot/snapshot-helper",[],function(){function a(a,b){var c=a[0].getBoundingClientRect();return b&&!b.freeResize?{height:b.size.h,width:b.size.w,top:c.top,left:c.left}:c}return{getSnapshotScrollAreaBBox:a}}),define("extensions.qliktech/pivot-table/viewport-provider",["qvangular","extensions.qliktech/pivot-table/snapshot/snapshot-helper"],function(a,b){"use strict";function c(a,c,d,e,f,g,h,i,j,k){var l,m,n,o=c.find(e),p=o.find(f),q=p.find(g);return l={minRowHeight:d,rect:{left:0,top:0,width:0,height:0},scrollRect:{left:0,top:0,width:0,height:0},rowCount:0,direction:k,getVirtualScrollController:function(){return o.controller("qvScrollArea")},getSortableListController:function(){return o.controller("qvSortableList")},getMultiSelectController:function(){return q.controller("qvSelectionsMultiselect")},getFirstDataCell:function(){var a,b=o.find(h);if(a={top:0,left:0,width:0},b.length){var c=b[0].getBoundingClientRect(),d=b.position();a.top=d.top,a.left=d.left,a.width=c.width}return a},getTopHeaders:function(){return o.find(i)},getScrollAreaBBox:function(){return j?b.getSnapshotScrollAreaBBox(o,j.object):o[0].getBoundingClientRect()},getScrollAreaPosition:function(){return o.position()},getScrollContentBBox:function(){return p[0].getBoundingClientRect()},updateRowCount:function(a){l.rowCount=Math.ceil(a)},getMaxRowCount:function(){return Math.ceil(l.scrollRect.height/l.minRowHeight)},getVisibleRowCount:function(){function a(a,b){var c=a.offsetTop+a.getBoundingClientRect().height,d=b.top+b.height;return c<=d}function b(a,b){var c=b-a;return 1===c?b:Math.floor(a+c/2)}function d(c,e,f){var g=f-e,h=b(e,f),i=a(c[h],l.scrollRect);return 0===g?i?h:-1:1===g?i?h:d(c,e,e):i?d(c,h,f):d(c,e,h)}var e,f,g=c[0].querySelector(h);if(!g)return 0;if(e=g.parentNode,f=Array.prototype.slice.call(e.parentNode.childNodes),f=f.filter(function(a){return a.nodeType===Node.ELEMENT_NODE}),f=f.splice(f.indexOf(e)),0===f.length)return 0;var i=d(f,0,f.length-1)+1;if(i===f.length){var j=f[f.length-1],k=l.scrollRect.top+l.scrollRect.height-(j.offsetTop+j.getBoundingClientRect().height);i+=Math.floor(k/(3*l.minRowHeight))}return i},updateRect:function(){return a.cancel(m),m=a(function(){var a=l.getScrollAreaBBox();l.rect.top=a.top,l.rect.left=a.left,l.rect.width=a.width,l.rect.height=a.height,l.updateRowCount(l.rect.height/d)},!1)},updateScrollRect:function(b){return a.cancel(n),n=a(function(){var a=l.getScrollAreaPosition(),c=l.getFirstDataCell();l.scrollRect.top=a.top+c.top,l.scrollRect.height=l.rect.height-c.top,"rtl"===l.direction?(l.scrollRect.left=0,l.scrollRect.width=c.left+c.width):(l.scrollRect.left=c.left,l.scrollRect.width=l.rect.width-c.left),b&&(l.updateRowCount(l.collapsedRowCount||l.scrollRect.height/d),delete l.collapsedRowCount)},!1)},getScrollRect:function(){return{top:l.scrollRect.top,left:l.scrollRect.left,width:l.scrollRect.width,height:l.scrollRect.height}}}}function d(a){return c.bind(null,a)}function e(){this.$get=["$timeout",d]}a.provider("qvPivotTableViewportProvider",e)}),define("extensions.qliktech/pivot-table/virtual-scroll-provider",["qvangular"],function(a){"use strict";function b(a,b,c){function d(b){var d=a.getMaxRowCount();j.activeFromStart||(b.qHeight=Math.min(c.qcy-b.qTop,d),a.updateRowCount(Math.min(b.qHeight,a.rowCount)))}function e(c){return{qLeft:b.cnt>0?Math.round(c.vPosX/b.width):0,qTop:Math.round(c.vPosY/a.minRowHeight),qWidth:Math.max(1,b.cnt),qHeight:Math.max(1,a.rowCount)}}function f(a){a.qTop>0&&a.qTop+a.qHeight>c.qcy&&(a.qTop=Math.max(0,c.qcy-a.qHeight),a.qHeight=Math.min(c.qcy,a.qHeight)),a.qLeft>0&&a.qLeft+a.qWidth>c.qcx&&(a.qLeft=Math.max(0,c.qcx-a.qWidth),a.qWidth=Math.min(c.qcx,a.qWidth))}var g,h,i=a.getVirtualScrollController(),j={active:!1,activeFromStart:!1},k={xAxis:0,yAxis:0};return h={page:{qLeft:0,qTop:0,qWidth:0,qHeight:0},equalsPage:function(a){return this.page.qLeft===a.qLeft&&this.page.qTop===a.qTop&&this.page.qWidth===a.qWidth&&this.page.qHeight===a.qHeight},setPage:function(a){this.page.qLeft=a.qLeft,this.page.qTop=a.qTop,this.page.qWidth=a.qWidth,this.page.qHeight=a.qHeight},onGetData:function(a){g=a},setScrollViewport:function(){a.updateScrollRect(!1).then(function(){i.setViewport(a.getScrollRect())})},setVirtualSize:function(){var d=this;a.updateScrollRect(!0).then(function(){var e,f,g,k,l;j.active=!1,j.activeFromStart=!1,a.scrollRect.top+a.scrollRect.height>=a.rect.height&&h.page.qHeight>=c.qcy&&(e=a.getVisibleRowCount(),e<h.page.qHeight&&(j.active=!0,j.activeFromStart=!0,a.updateRowCount(e))),f={vPosY:d.page.qTop*a.minRowHeight,vPosX:d.page.qLeft*b.width},k=h.page.qWidth===c.qcx?a.scrollRect.width:c.qcx*b.width,g={width:k,height:c.qcy*a.minRowHeight},l={width:a.scrollRect.width,height:a.rowCount*a.minRowHeight},i.setVirtualSize(g,l,a.getScrollRect()),(f.vPosY>0||f.vPosX>0)&&i.scroll(f.vPosX,f.vPosY)})},alignToBottom:function(){var b=!1;if(j.active){if(k.yAxis>0){var c=a.getVisibleRowCount();c<a.rowCount&&a.updateRowCount(c)}else{var d=a.getMaxRowCount();a.rowCount>=d&&(j.active=!1),b=!0}i.setVirtualViewport({width:a.scrollRect.width,height:a.rowCount*a.minRowHeight}),b&&i.setVirtualScrollPos(0,-1)}}},i.onScroll(function(a,b){var c=i.getVirtualPosition(),l=i.getMaxPosition(),m=e(c);j.active&&b<0&&(d(m),l=i.getMaxPosition()),l.vPosY>0&&c.vPosY===l.vPosY&&(j.active=!0),f(m),j.lastTop=m.qTop,k.xAxis=a,k.yAxis=b,h.equalsPage(m)&&!j.active||(h.setPage(m),g(h.page).then(function(){h.alignToBottom()}))}),i.getScrollAmount=function(c,d,e){var f=i.getVirtualPosition(),g=i.getMaxPosition();switch(e){case 1:return{deltaX:b.width*c,deltaY:a.minRowHeight*d};case 2:return{deltaX:b.cnt*b.width*c,deltaY:a.minRowHeight*a.rowCount*d};case 10:return{deltaX:0,deltaY:d>0?f.vPosY*d:f.vPosY-g.vPosY};default:return{deltaX:c,deltaY:d}}},h}function c(){return b}function d(){this.$get=[c]}a.provider("qvPivotTableVirtualScrollProvider",d)}),define("extensions.qliktech/pivot-table/selections-provider",["qvangular","jquery","objects.utils/event-utils"],function(a,b,c){"use strict";function d(a,d,e,f,g,h,i,j){function k(b,c){var e,f,g,h,i,j,k,l=[],m=q.dataValuesArray.length;for(e=b.getRowsByCellType(b.CELL_TYPE_TOP).concat(b.getRowsByCellType(b.CELL_TYPE_LEFT)),i=m>0?d.getSiblingCells(b,c):[],f=e.length,k=0;k<f;++k)l=l.concat(e[k].cells);for(h=l.length,k=0;k<h;++k)g=l[k],j=i.indexOf(g)!==-1,(j&&!g.isDimensionValue||!j&&!g.isMeta)&&a[m?"lockCell":"unlockCell"](b,g)}function l(){q.active&&(a.updatePivot(h,q,q.currentCell),k(h,q.currentCell))}function m(){j.on(),p&&p()}function n(){j.on(),p&&p()}function o(){q.active&&q.currentCell&&(d.getSiblingCells(h,q.currentCell).forEach(function(b){a.deselectCell(h,b)}),k(h,q.currentCell))}var p,q=a.$new();return e.excludeDimensionToggle=function(a){return!f.active&&b(a.target).is(".qv-pt-expandable")},e.selectDimensionValue=function(b,c){var d=f.getKeyAsToggleSelected(c);d||(o(),a.reset(q)),p=a.selectDimensionValue(e.$id,g,f,q,b,h,d),k(h,q.currentCell)},e.activateSelections=function(b){p=a.activateSelections(e.$id,g,f,q,b)},e.multiselectDimensionValues=function(b,c){var i,j,l,m,n=d.getSiblingCells(h,b),o=n.length,p=a.isColumnar(h,b),r=p?b.dataRowIx:b.dataColIx,s=p?c.dataRowIx:c.dataColIx;if(n.indexOf(c)!==-1&&c.isDimensionValue){for(i=0;i<o;++i)l=n[i],j=p?l.dataRowIx:l.dataColIx,m=r<=s?j>=r&&j<=s:j>=s&&j<=r,m&&l.isDimensionValue&&l!==c&&a.selectDimensionCells(g,f,q,e.grid,l,!1);a.selectDimensionCells(g,f,q,e.grid,c,!1),k(h,q.currentCell)}},e.multiselect=function(){q.active&&a.sendSelection(g,f,q,h,q.currentCell)},e.selectWhileLocked=function(){q.dataValuesArray.length>0||c.showLockedFeedback(i.qHyperCube.qDimensionInfo)},f.watchActivated(function(){j.off()}),a.init(f,g,q,m,n,o),{updateSelections:l}}function e(a,b){return d.bind(null,a,b)}function f(){this.$get=["qvGridObjectSelectionService","qvGridObjectDataService",e]}a.provider("qvPivotTableSelectionsProvider",f)}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel.ng.html",[],function(){return'<div class="qv-pivot-panel"\n\t qv-sortable-list="sortableItemLists">\n\t<div class="qv-pivot-panel-row" ng-repeat="row in grid.rows">\n\t\t<div class="qv-pivot-panel-column" ng-if="$first"></div>\n\t\t<div ng-repeat="list in row.lists" class="qv-pivot-panel-column" ng-class="{\'qv-pivot-panel-disabled\': list.disabled}">\n\t\t\t<h2>{{list.title}}</h2>\n\t\t\t<div class="qv-pivot-panel-list">\n\t\t\t\t<ul>\n\t\t\t\t\t<li ng-repeat="item in list.items track by item.id" class="qv-pivot-panel-item" ng-class="item.classList" ng-include src="itemTemplateSrc"></li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel-item.ng.html",[],function(){return'<div class="field-wrapper field-token" ng-style="item.style">\n\t<div ng-if="list.showMoveHandle" class="icon-handle"></div>\n\t<div class="field-text">{{item.title}}</div>\n</div>\n'}),define("extensions.qliktech/pivot-table/pivot-panel/pivot-panel",["jquery","qvangular","text!./pivot-panel.ng.html","text!./pivot-panel-item.ng.html","ng!$templateCache","general.sortable/sortable-item-lists","translator","general.sortable/sortable-list"],function(a,b,c,d,e,f,g){var h={Dimension:"dimension",Measure:"measure",Pseudo:"pseudo"};e.put("pivot-panel-item.ng.html",d),b.directive("qvPivotPanel2",function(){return{restrict:"E",template:c,replace:!0,scope:{layout:"=layout",backendApi:"=backendApi"},controller:["$scope","$element",function(b,c){function d(a){var b;return b=a.qLibraryId?a.title||"":a.qFallbackTitle||""}function e(){var a,c=b.layout.qHyperCube.qNoOfLeftDims;b.sortableItemLists.reset(),a=b.layout.qHyperCube.qEffectiveInterColumnSortOrder.map(function(a){var c;return b.$broadcast("pivotPanelUpdated"),a===-1?{title:"Measures",cId:"pseudo-dimension",type:h.Pseudo,dimIndex:a,cssClass:["sortable","is-pseudo"]}:(c=b.layout.qHyperCube.qDimensionInfo[a],{title:d(c),cId:c.cId,type:h.Dimension,dimIndex:a,cssClass:["sortable"]})}),c=c<0?a.length:c,a.splice(0,c).forEach(function(a){var c=b.rows.add(a.title,a.cId,a.cssClass,1);c.dimIndex=a.dimIndex}),a.forEach(function(a){var c=b.columns.add(a.title,a.cId,a.cssClass,1);c.dimIndex=a.dimIndex}),b.layout.qHyperCube.qMeasureInfo.forEach(function(a){b.measures.add(a.qFallbackTitle||"",a.cId,[],2)})}var i=this;b.itemTemplateSrc="pivot-panel-item.ng.html",b.sortableItemLists=f.create({options:{listKey:"list",listSelector:".qv-pivot-panel-column",itemSelector:".sortable",itemDragSelector:".icon-handle",itemKey:"item"},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("sortable")},bindAutoScroll:function(){var b=c.find(".qv-pivot-panel-list ul");b.each(function(){var b=a(this),c=b.scope().list;c.scrollInfo={elem:b[0],clientRect:b[0].getBoundingClientRect(),scrollWidth:b[0].scrollWidth,scrollHeight:b[0].scrollHeight}})},onBegin:function(){this._super.apply(this,arguments),this.bindAutoScroll()},onEnterList:function(){this.bindAutoScroll()},onMove:function(){this._super.apply(this,arguments),i.sortOrderUpdated()},onMoveToList:function(a,b){this._super.apply(this,arguments),b.disabled||i.sortOrderUpdated()},onAutoScroll:function(a,b,c,d){if(this._super.apply(this,arguments),!b&&c&&(b=this.getList(c)),b){var e=b.scrollInfo;d(e.elem,e.clientRect,e.scrollWidth,e.scrollHeight)}}}),b.columns=b.sortableItemLists.createList(1,{title:g.get("Common.Columns"),showMoveHandle:!0}),b.rows=b.sortableItemLists.createList(1,{title:g.get("Common.Rows"),showMoveHandle:!0}),b.measures=b.sortableItemLists.createList(2,{title:g.get("Common.Measures")}),b.grid={rows:[]},b.grid.rows.push({lists:[b.columns]}),b.grid.rows.push({lists:[b.rows,b.measures]
}),i.sortOrderUpdated=function(){var a,c=[];b.rows.items.forEach(function(a){c.push(a.dimIndex)}),a=c.length,b.columns.items.forEach(function(a){c.push(a.dimIndex)});var d=[[],!0];d[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(c)},d[0][1]={qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(a)},b.backendApi.applyPatches(d)},b.$watchCollection("layout.qHyperCube.qDimensionInfo",e),b.$watchCollection("layout.qHyperCube.qEffectiveInterColumnSortOrder",e),b.$watchCollection("layout.qHyperCube.qMeasureInfo",e),b.$watchCollection("layout.qHyperCube.qNoOfLeftDims",e)}]}})}),define("extensions.qliktech/pivot-table/pivot-table",["qvangular","jquery","objects.backend-api/pivot-api","extensions.qliktech/pivot-table/pivot-table-properties","extensions.qliktech/pivot-table/pivot-hypercube-handler","objects.extension/object-conversion","client.utils/property-mapper","text!./pivot-table.ng.html","text!./cell-item.ng.html","text!./header-cell-item.ng.html","text!./meta/meta-left.ng.html","text!./meta/meta-top.ng.html","text!./meta/meta-list.ng.html","text!./meta/meta-item.ng.html","ng!$templateCache","general.utils/support","core.utils/deferred","objects.extension/default-selection-toolbar","objects.grid/data-grid-provider","./meta/ghost-headers-provider","./meta/pivoting-provider","./viewport-provider","./virtual-scroll-provider","./selections-provider","general.scroll/scroll-area","objects.grid/services/data-service","objects.grid/services/selections","extensions.qliktech/pivot-table/pivot-panel/pivot-panel"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){"use strict";function s(a,c,d,e,f,g,i,j,k){function l(h,l,m,n){function o(a,b,c){h.interactive=a&&b,h.navigatable=a&&c,a?c&&(s.on(),t.on()):a||(s.off(),t.off())}var s,t,u,v;h.currentPopover={header:void 0},h.nonMouseViewportScrolling={scrollbarSize:36,className:"show-non-mouse-scrollbars"},h.grid=a("pivot"),h.viewport=g(l,p.treatAsDesktop()?21:31,".qv-grid-object-scroll-area",".scroll-content","table",".first-data-cell","th.top:nth-child(2)",h.layout.snapshotData,h.options.direction),s=h.viewport.getVirtualScrollController(),t=h.viewport.getSortableListController(),u=h.viewport.getMultiSelectController(),h.metaGhostHeaders=f({},h.layout,h.viewport.rect),h.pivoting=e(h.backendApi,h.grid,h.metaGhostHeaders,h.layout,h.$id,h.currentPopover,s,u),h.selections=j(h,h.selectionsApi,h.backendApi,h.grid,h.layout,t),h.virtualScroll=i(h.viewport,h.metaGhostHeaders.dataColumnsInfo,h.layout.qHyperCube.qSize),h.virtualScroll.onGetData(function(a){return h.getData(a,!0).then(function(){k.cancel(v),v=k(function(){h.virtualScroll.setScrollViewport()},100)})}),h.getData=function(a,b){var c=q();return h.backendApi.getData([a]).then(function(d){h.onUpdateData(d,a,b).then(function(){c.resolve()})}),c.promise},h.onUpdateData=function(a,b,d){return c.updatePivotItems(h,a,[b],d),h.selections.updateSelections(),k(function(){},0,!1)},h.process=function(a){return a&&h.virtualScroll.setPage(a),h.getData(h.virtualScroll.page).then(function(){h.virtualScroll.setVirtualSize()})},h.processPaint=function(){return h.updateMetaInfo().then(function(a){var b=h.layout.qHyperCube.qLastExpandedPos,c=b&&void 0!==h.expandedPosDiffX&&void 0!==h.expandedPosDiffY,d=h.viewport.getVisibleRowCount(),e={qLeft:Math.max(0,c?b.qx-h.expandedPosDiffX:0),qTop:Math.max(0,c?b.qy-h.expandedPosDiffY:0),qWidth:a.qWidth,qHeight:a.qHeight};return b&&e.qLeft+e.qWidth>h.layout.qHyperCube.qSize.qcx&&(e.qLeft=Math.max(0,h.layout.qHyperCube.qSize.qcx-a.qWidth)),b&&h.collapsed&&e.qTop+d>h.layout.qHyperCube.qSize.qcy&&(h.viewport.collapsedRowCount=d,e.qTop=Math.max(0,h.layout.qHyperCube.qSize.qcy-d),e.qHeight=d),delete h.expandedPosDiffX,delete h.expandedPosDiffY,delete h.collapsed,h.process(e)})},h.processResize=function(){return h.updateMetaInfo().then(function(a){var b=h.layout.qHyperCube.qSize,c={qLeft:h.virtualScroll.page.qLeft,qTop:h.virtualScroll.page.qTop,qWidth:a.qWidth,qHeight:a.qHeight};return c.qTop+c.qHeight>b.qcy&&(c.qTop=Math.max(0,b.qcy-c.qHeight)),c.qLeft+c.qWidth>b.qcx&&(c.qLeft=Math.max(0,b.qcx-c.qWidth)),h.$emit("ngRepeatFinished"),h.process(c)})},n.setDirection=function(){h.viewport.direction=h.options.direction,h.processPaint()},n.getSelectionToolbar=function(){return new r(n.$scope.backendApi,n.$scope.selectionsApi,!1,!1)},h.updateMetaInfo=function(){return h.viewport.updateRect().then(function(){return h.metaGhostHeaders.update(0,c.getLeftTreeDepth(h.layout.qHyperCube.qPivotDataPages[0])),h.pivoting.update(h.metaGhostHeaders.dataColumnsInfo.cnt),{qWidth:Math.max(1,h.metaGhostHeaders.dataColumnsInfo.cnt),qHeight:Math.max(1,h.viewport.rowCount)}})},h.collapseExpand=function(a){var c,d=b(a.target);c=d.scope().cell,c&&(h.expandedPosDiffX=c.dataColIx-h.virtualScroll.page.qLeft,h.expandedPosDiffY=c.dataRowIx-h.virtualScroll.page.qTop,"lui-icon--plus"===c.collapseExpandClass?c.hasClass("top")?h.backendApi.expandTop(c.dataRowIx,c.dataColIx,!1):c.hasClass("left")&&h.backendApi.expandLeft(c.dataRowIx,c.dataColIx,!1):"lui-icon--minus"===c.collapseExpandClass&&(h.collapsed=!0,c.hasClass("top")?h.backendApi.collapseTop(c.dataRowIx,c.dataColIx,!1):c.hasClass("left")&&h.backendApi.collapseLeft(c.dataRowIx,c.dataColIx,!1)))},h.showDimension=function(a,c){var e=b(a.target).closest(".qv-pt-meta-button");return t.off(),h.currentPopover.header===c?(c.open=!1,h.currentPopover.header=void 0,d.close(),void h.processPaint()):(h.currentPopover.header&&(h.currentPopover.header.open=!1,h.currentPopover.header=void 0),d.showField(c.fieldName,h.backendApi.model.session.currentApp,{$alignToElement:e,qvaOutsideIgnoreFor:"qv-pt-meta-header-"+h.$id,collision:"flipfit",direction:h.options.direction},null,function(){h.currentPopover.header=void 0,t.on(),h.processPaint()}),c.open=!0,void(h.currentPopover.header=c))},n.setInteractionState=function(){var a=h.object.inAnalysisState(),b=h.options.navigation!==!1,c=h.options.selections!==!1;o(a,c,b)},n.onPaint=function(){return this.setInteractionState(h.options.interactionState),this.$scope.selectionsApi.active||void 0!==this.$scope.currentPopover.header?(this.$scope.currentPopover.header&&h.pivoting.update(h.metaGhostHeaders.dataColumnsInfo.cnt),q.resolve()):(t.cancel(),h.processPaint())},n.onResize=function(){return h.processResize()},n.setSnapshotData=function(a){var b=h.virtualScroll.page;return h.backendApi.getData([b]).then(function(b){return h.backendApi.isSnapshot||(b[0].qArea.qTop=0,b[0].qArea.qLeft=0),a.qHyperCube.qPivotDataPages=b,a})},n.getPreferredSize=function(){var a=q(),b=this.$scope.$on("ngRepeatFinished",function(){a.resolve({w:l.width(),h:l.find("table").height()+5}),b()});return a.promise}}return{restrict:"E",replace:!0,template:h,require:"qvObjectContent",link:l}}return o.put("pt-cell-item.ng.html",i),o.put("pt-header-cell-item.ng.html",j),o.put("pt-meta-left.ng.html",k),o.put("pt-meta-top.ng.html",l),o.put("pt-meta-list.ng.html",m),o.put("pt-meta-item.ng.html",n),a.directive("qvPivotTableInclude",["$compile","$animate",function(a,b){return{link:function(c,d,e){b.enabled(d,!1),c.$watch(e.qvPivotTableInclude,function(){var b=c.$eval(e.qvPivotTableInclude),f=o.get(b);d.html(f),a(d.contents())(c)})}}}]),a.directive("onFinishRender",["$timeout",function(a){return{restrict:"A",link:function(b){b.$last===!0&&a(function(){b.$emit("ngRepeatFinished")})}}}]),a.directive("qvPivotTable",["qvDataGrid","qvGridObjectDataService","qvListboxPopoverService","qvPivotTablePivoting","qvPivotTableMetaGhostHeadersProvider","qvPivotTableViewportProvider","qvPivotTableVirtualScrollProvider","qvPivotTableSelectionsProvider","$timeout",s]),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"P",qShowTotalsAbove:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:50,qHeight:50}],qIndentMode:!0}},data:{dimensions:{min:1,max:1e3},measures:{min:1,max:1e3}},getCreatePropertyHandler:function(a){var b=g.mapProperties(this.mappedDefinition.items.data.items.dimensions),c=g.mapProperties(this.mappedDefinition.items.data.items.measures);return new e({app:a,dimensionDefinition:this.dimensionDefinition,measureDefinition:this.measureDefinition,dimensionProperties:b,measureProperties:c})},support:{cssScaling:!0,snapshot:!0,export:!0,exportData:!0,sharing:!1},type:"pivot-table",template:"<qv-pivot-table></qv-pivot-table>",BackendApi:c,definition:d,importProperties:f.pivotChart.importProperties.bind(f),exportProperties:f.pivotChart.exportProperties.bind(f)}}),define("dev-hub.custom-components/custom-component-loader",["require","qvangular","core.utils/deferred"],function(a,b,c){function d(a){return(!a||!a.data||"component"===a.data.type)&&(i.push(a.path),!0)}function e(){var a=new c,b=[];return i.forEach(function(a){b.push(g(a))}),c.all(b,function(){a.resolve(j)}).catch(function(){a.resolve()}).finally(function(){a.resolve(j)}),a.promise}function f(a){var d=new c;if(a){if(Array.isArray(a))a.forEach(function(a){var c=a;h.has(a.name+"Directive")||(b.directive(a.name,function(){return c}),j[a.path]=a)});else{var e=a;h.has(a.name+"Directive")||(b.directive(a.name,function(){return e}),j[a.path]=a)}d.resolve(a)}else console.warn("plugin is invalid or missing, '"+JSON.stringify(a)+"'"),d.resolve({success:!1,error:"plugin is invalid or missing"});return d.promise}function g(b){var d=new c;return j[b]?d.resolve(j[b]):a([b],function(a){a.path=b,d.resolve(f(a))},function(a){console.warn("plugin is invalid or missing",a),d.resolve({success:!1,error:"plugin is invalid or missing: "+JSON.stringify(a)})}),d.promise}var h=b.getService("$injector"),i=[],j={};return{register:d,load:e,__onlytest__:{_loadCustomComponent:g,_applyComponentAsDirective:f,customComponents:i,loadedCustomComponents:j}}}),define("dev-hub.custom-components/custom-components",["dev-hub.custom-components/custom-component-loader","general.models/library/extension-list"],function(a,b){function c(){return d.forEach(function(b){a.register({path:b})}),b.getList().then(function(b){return b.forEach(function(b){b.data&&b.data.type&&"component"===b.data.type&&(b.path="extensions/"+b.id+"/"+b.id,a.register(b))}),a.load()})}var d=["dev-hub.custom-components/qw-console/qw-console","dev-hub.custom-components/qw-sys-info/qw-sys-info"];return{init:c}}),define("dev-hub.lib/utils",["util","angular","jquery","qvangular"],function(a,b,c){"use strict";function d(a,b){return(new RegExp(b+"=(.+?)(&|$)").exec(a)||[null,null])[1]}function e(a,b){for(var c,d=new RegExp(b+"=(.+?)(&|$)","g"),e=[];c=d.exec(a);)e.push(decodeURIComponent(c[1]));return e}function f(a){document.title=a+" | Dev Hub"}function g(a){var c=[];return b.forEach(a,function(a,d){b.isObject(a)&&(a.key=d),c.push(a)}),c}function h(a){if(location.hash){var b=new RegExp(a+"{(.*)}",""),c=location.hash.match(b);return!!(c&&c.length>1)&&decodeURIComponent(c[1])}return!1}function i(){return window.location.pathname.substr(0,window.location.pathname.toLowerCase().lastIndexOf("/dev-hub")+1)}function j(a){if(a){var b=window.location.href,c=b.indexOf("#");c>0&&(window.location.hash="")}window.location.reload()}function k(a){return l(a)&&a.indexOf(".")<0}function l(a){return!!(a&&a.length&&a.length>0)&&(/^[\.0-9a-zA-Z_-]+$/.test(a)&&!/^\./.test(a))}function m(a){var b=/^[$A-Z_][0-9A-Z_$]*$/i;return b.test(a)&&C.indexOf(a)===-1}function n(a){var b=/^[$A-Z_][0-9A-Z_$]*$/i;return b.test(a)}function o(a){return C.indexOf(a)!==-1}function p(b,c,d){return d?a.isInteger(b)&&a.isInteger(c)&&b>=0&&c>=0&&c>=b:a.isInteger(b)&&a.isInteger(c)&&c>=b}function q(a){if(!a)return!1;var b=a.lastIndexOf(".");return!(b<0)&&B.indexOf(a.substr(a.lastIndexOf(".")+1).toLowerCase())>-1}function r(a){return a.substr(a.lastIndexOf(".")+1).toLowerCase()}function s(a){return a.substr(0,a.lastIndexOf("."))}function t(a){return a.replace(/[^a-z0-9]/gi,"-").toLowerCase()}function u(a){for(var b="",c=0;c<a.length-1;c++)b+="."+a[c]+", ";return b+="."+a[a.length-1]}function v(){A||(A=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,c.fn.mutation=function(a,b,c){if(A)return b=b||{subtree:!1,attributes:!0},z=new A(function(b){b.forEach(function(b){c?c(b,a):a(b.target,b.attributeName,b)})}),this.each(function(){z.observe(this,b)})})}function w(a,b){b?(a.find("span[q-title-translation='Devhub.EditItem']").css({"pointer-events":"all"}),a.find("*").not("span[q-title-translation='Devhub.EditItem']").css({"pointer-events":"none"})):a.find("*").css({"pointer-events":"auto"})}function x(){var a=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return("x"===b?c:3&c|8).toString(16)})}function y(a,b,c){function d(a){a.debounceTimer&&clearTimeout(a.debounceTimer),a.debounceTimer=null}return function(){var e,f=this,g=arguments;d(c),e=setTimeout(function(){a.apply(f,g)},b),c.debounceTimer=e}}var z,A,B=["js","css","html","json"],C=["break","do","instanceof","typeof","case","else","new","var","catch","finally","return","void","continue","for","switch","while","debugger","function","this","with","default","if","throw","delete","in","try","class","enum","extends","super","const","export","import","implements","let","private","public","yield","interface","package","protected","static","null","true","false"];return{getURLParameter:d,getURLParameters:e,setBrowserTitle:f,getHashParameter:h,getPrefix:i,reload:j,isInteger:function(b){return a.isInteger(b)},extend:function(){return b.extend.apply(null,arguments)},isValidExtensionName:k,isValidName:l,isValidFunctionName:m,isJsReservedWord:o,isValidSyntax:n,isValidInterval:p,sanitizeFileName:t,hasValidFileExtension:q,getFileExtension:r,getFileName:s,fileExtensionArrayToString:u,objectToArray:g,addMutationObserver:v,toggleElementSubtreeInteraction:w,generateId:x,debounce:y}}),define("dev-hub.lib/assets-files-utils",["qvangular","underscore","core.utils/deferred","translator","dev-hub.lib/utils","general.services/content-api/content-api"],function(a,b,c,d,e){"use strict";function f(a,b){var c=e.getFileExtension(a),d=t(c);return b instanceof ArrayBuffer&&(b=new Blob([b])),{fileName:a,extension:c,content:b||d.defaultContent,contentType:null,mode:d.editorMode,lastModified:null,isDirty:!0}}function g(a){return["gif","png","jpeg","jpg"].indexOf(a)>-1}function h(a){return["eot","woff","woff2","ttf","otf"].indexOf(a)>-1}function i(a,b){var e=new c,f=[];return a.isDirty()&&a.files.forEach(function(c){if(c.isDirty){if(!g(c.extension)){var d=b?b(c.fileName):void 0;c.content=c.newContent?c.newContent:d?d.getValue():c.content}f.push(B(a.extensionUniqueName,c))}}),c.all(f).then(function(){e.resolve(a)},function(a){e.reject({errName:"ExtensionUploadToQRSErr",errMessage:d.get(a.errMessage),errObject:a})}),e.promise}function j(a,b){var c=b.files.filter(function(b){return b.fileName.toLowerCase()===a.toLowerCase()});return c.length>0}function k(a,b){var d=new c;return d.resolve(b.files.splice(b.files.indexOf(a),1)),d.promise}function l(a,b){var c={method:"GET",url:"/extensions/"+a+"/"+b,cache:!1};return g(e.getFileExtension(b))||h(e.getFileExtension(b))?c.responseType="blob":c.transformResponse=function(a){return a},D.request(c)}function m(a,b){var d=new c;return D.request({method:"GET",url:"/extensions/"+a+"/"+b}).success(function(){d.resolve(!0)}).error(function(){d.resolve(!1)}),d.promise}function n(a){var b=new c;return D.request({method:"DELETE",url:"/qrs/extension/name/"+a}).success(function(){b.resolve()}).error(function(c){b.reject({errMsg:d.get("Devhub.ErrorExtensionDelete",a),errObject:c})}),b.promise}function o(a){var b=new c;return D.request({method:"POST",url:"/qrs/extension/name/"+a.name,data:JSON.stringify(a,null,"\t")}).success(function(){b.resolve(a)}).error(function(a){b.reject({errName:"errCreateExtension",errMessage:d.get("Devhub.ErrorCreateExtension"),errObject:a})}),b.promise}function p(a,b){var d=e.getFileExtension(b),f=t(d),g=new c;return l(a,b).success(function(a,c,e){g.resolve({success:!0,file:{fileName:b,extension:d,content:a,contentType:e()["content-type"],mode:f.editorMode,lastModified:e()["last-modified"],isDirty:!1}})}).error(function(a){g.resolve({success:!1,errObject:a,file:{fileName:b,extension:d,content:f.defaultContent,contentType:null,mode:f.editorMode,lastModified:null,isDirty:!0,loadingErr:a}})}),g.promise}function q(a){var b=new c,e=new FileReader;return e.onload=function(c){b.resolve(f(a.name,c.target.result))},e.onerror=function(a){b.reject({errName:"errFileReader",errMessage:d.get("Devhub.ErrorReadingLocalFile"),errObject:a})},(!a.type.match("image.*")&&!a.type.match("font")||a.type.match("svg")&&a.type.match("xml"))&&""!==a.type?e.readAsText(a):e.readAsArrayBuffer(a),b.promise}function r(a){var b=[],e=new c;return l(a,"wbfolder.wbl").success(function(f){if(f.length>0){var g=x(f);g.forEach(function(c){b.push(p(a,c))}),c.all(b).then(function(a){var b=a.map(function(a){return a.file});e.resolve(b)}).catch(function(b){e.reject({errName:"loadFilesFromRepo",errMessage:d.get("Devhub.ErrorLoadingFilesFromRepo",a),errObject:b})})}else e.reject({errName:"wbFolderEmpty",errMessage:d.get("Devhub.wbFolderEmpty",a)})}).error(function(){e.reject({errName:"ErrorIncompleteWbFolder",errMessage:d.get("Devhub.ErrorIncompleteWbFolder",a)})}),e.promise}function s(a){var b=new c;return l(a,"wbfolder.wbl").success(function(){b.resolve()}).error(function(){b.reject()}),b.promise}function t(a){switch(a.toLowerCase()){case"html":return{defaultContent:"<div></div>",editorMode:"htmlmixed"};case"js":return{defaultContent:"// JavaScript\r\n",editorMode:"javascript"};case"qext":case"json":return{defaultContent:"{\r\n\r\n}",editorMode:"javascript"};case"css":return{defaultContent:"/* CSS */\r\n",editorMode:"css"};case"gif":case"png":case"jpg":case"jpeg":return{defaultContent:void 0,editorMode:void 0};default:return{defaultContent:"",editorMode:"javascript"}}}function u(a,b){var e=new c;return r(a).then(function(c){var g=v(c,a,b);g.push(f("wbfolder.wbl",A(g)));var h=w(c);if(h){g.forEach(function(a){a.isDirty=!0});var j={extensionUniqueName:b,files:g,type:h,isDirty:function(){return!0}};o({name:b,type:h}).then(function(){i(j).then(function(a){e.resolve(a)}).catch(function(a){e.reject({errName:"errDuplicateExtensionTasks",errMessage:d.get("Devhub.ErrorCopyingExtension"),errObject:a})})}).catch(function(a){e.reject({errName:"errDuplicateExtensionTasks",errMessage:d.get("Devhub.ErrorCopyingExtension"),errObject:a})})}}).catch(function(a){e.reject(a)}),e.promise}function v(a,b,c){return a.forEach(function(a){if(a.fileName=a.fileName.replace(b,c),a.content&&a.content.length>0&&(a.content.indexOf("${name}")>-1&&(a.content=a.content.replace(/\${name}/g,c)),["js","css","html","htm","json"].indexOf(a.extension)>-1&&(a.content=a.content.replace(new RegExp(b,"g"),c)),"qext"===a.extension)){var d=JSON.parse(a.content);d.name=c,d.type=d.type.replace("-template",""),a.content=JSON.stringify(d,null,"\t")}}),a}function w(a){var c=b.findWhere(a,{extension:"qext"});if(c&&c.content)return JSON.parse(c.content).type}function x(a){var b=a.replace(/[\r\n]/g,"").split(";");return b.filter(function(a){return""!==a.trim()})}function y(a){var b=new c;return l(a,"wbfolder.wbl").success(function(a){if(a.length>0){var c=x(a),f=c.filter(function(a){return"qext"===e.getFileExtension(a)});1===f.length?b.resolve(c):b.reject({errName:"moreThanOneQEXT",errMessage:d.get("Devhub.ErrorMoreThanOneQEXT")})}}).error(function(){b.reject({errName:"ErrorIncompleteWbFolder",errMessage:d.get("Devhub.ErrorIncompleteWbFolder",a)})}),b.promise}function z(a,b){return B(a,f("wbfolder.wbl",A(b)))}function A(a){return a.map(function(a){return a.fileName}).join(";\r\n")}function B(a,b){var e=new c;return D.request({method:"POST",url:"/qrs/extension/"+a+"/uploadfile?externalpath="+b.fileName+"&overwrite=true",data:b.content}).success(function(){l(a,b.fileName).success(function(a,c,d){b.lastModified=d("last-modified"),b.isDirty=!1,e.resolve(b)}).error(function(a){e.reject({errName:"LoadFileFromQRSErr",errMessage:d.get("Devhub.ErrorReadingLocalFile",b.fileName),errObject:a})})}).error(function(a){e.reject({errName:"ExtensionUploadToQRSErr",errMessage:d.get("Devhub.ErrorCreatingFile",b.fileName),errObject:a})}),e.promise}function C(a){var b=new c;return D.getExtensions().then(function(c){a===!0?b.resolve(K(c)):b.resolve(c)}),b.promise}var D=a.getService("$contentApi"),E=function(){d.setup({context:"devhub",language:"en"}).then(function(){})},F=function(a,b){var e=new c;if(j(a,b))e.reject({errorMsg:d.get("Devhub.FileAlreadyExists",a)});else{var g=J(a,!0);g.success===!0?m(b.extensionUniqueName,a).then(function(c){c===!0?e.reject({errorMsg:d.get("Devhub.FileAlreadyExists",a)}):B(b.extensionUniqueName,f(a,null)).then(function(a){a.isDirty=!0,a.selected=!0,b.files.push(a),z(b.extensionUniqueName,b.files).then(function(){e.resolve(b)}).catch(function(a){e.reject(a)})}).catch(function(a){e.reject(a)})}):e.reject({errorMsg:g.errorMsg})}return e.promise},G=function(a,d){var e=new c,f=b.extend({},d);return f.files=d.files.slice(),k(a,f),c.all({deleteFileFromRepo:H(d.extensionUniqueName,a.fileName),saveFilesToWbFolder:z(d.extensionUniqueName,f.files),removeFileFromAssets:k(a,d)}).then(function(a){e.resolve(a.removeFileFromAssets)}).catch(function(a){e.reject(a)}),e.promise},H=function(a,b){var d=new c;return m(a,b).then(function(c){c?D.request({method:"DELETE",url:"/qrs/extension/"+a+"/deletecontent?externalpath="+b}).success(function(){d.resolve()}).error(function(a){d.reject(a)}):d.resolve()}),d.promise},I=function(a,e){var f=new c;return q(a).then(function(a){if(j(a.fileName,e))f.reject({errMessage:d.get("Devhub.ErrorImportDuplicateFile",a.fileName)});else{var g=b.extend({},e);g.files=e.files.slice(),g.files.push(a),c.all({saveFileInRepo:B(e.extensionUniqueName,a),saveFilesToWbFolder:z(e.extensionUniqueName,g.files)}).then(function(a){a.saveFileInRepo.selected=!0,f.resolve(g)}).catch(function(a){f.reject(a)})}}).catch(function(a){f.reject({errName:"errorReadLocalFile",errMessage:d.get("Devhub.ErrorReadingLocalFile"),errObject:a})}),f.promise},J=function(a,b){if(b)return/^[\.0-9a-zA-Z_-]+\..{2,4}$/.test(a)&&e.hasValidFileExtension(a)?{success:!0}:{success:!1,errorMsg:d.get("Devhub.InvalidFileName")};var c=a&&e.isValidExtensionName(a);return{success:c,errorMsg:c?void 0:d.get("Devhub.InvalidExtensionName")}},K=function(a){var b={extensionList:[],templateList:[]};for(var c in a){var d=/^(.*)\-template$/.exec(a[c].type);if(d){var f=d[1],g=b.templateList.filter(function(a){return a.type===f});if(g.length>0)g[0].items.push({id:c,name:a[c].name||c,title:a[c].name||c});else{var h={type:f,items:[{id:c,name:a[c].name||c,title:a[c].name||c}]};b.templateList.push(h)}}else b.extensionList.push({id:c,title:a[c].name||c,qext:a[c],src:a[c].preview&&a[c].preview.indexOf(".")!==-1?e.getPrefix()+"extensions/"+c+"/"+a[c].preview:""})}return b};return{init:E,isValidFileName:J,isFileInAssets:j,isImage:g,checkWbFolder:s,createFileObject:f,getExtensionFileObjectsFromRepo:r,getExtensionFileListFromRepo:y,saveFileInRepo:B,saveFilesToRepo:i,removeFileFromAssets:k,addNewFile:F,getExtensionsFromRepo:C,deleteExtensionFromRepo:n,deleteFileFromRepo:H,deleteFile:G,importFromLocal:I,duplicateExtension:u,saveFilesToWbFolder:z,readLocalFile:q,createExtensionInRepo:o,_loadFileFromRepo:l,__onlytest__:{_getFileDefaults:t,_getFilesFromWbFolderContent:x,_isFileInRepo:m}}}),define("dev-hub.models/widget-file",["core.utils/deferred","qvangular","general.models/library/extension-list","dev-hub.lib/assets-files-utils","general.services/content-api/content-api"],function(a,b,c,d){function e(a){return(a.libid?a.libid:a.id)+"/"+a.id}function f(a){var b=z.filter(function(b){return b.data.widgets&&b.data.widgets.indexOf(a)>-1});return b.length>1&&console.log("Duplicate libraries for widget:"+a,b),b[0]}function g(b){if(!x||b){x=new a;var d=[];c.getList(b).then(function(a){z.length=0,a.forEach(function(a){"widget-library"===a.data.type&&(z.push(a),a.data.widgets&&a.data.widgets.forEach(function(b){d.push({libid:a.id,id:b})}))}),x.resolve(d)})}return x.promise}function h(a,c){return b.getService("$contentApi").request({method:"GET",url:"/extensions/"+a+(c?"?"+(new Date).getTime():""),cache:!1,transformResponse:function(a){return a}})}function i(c,d,e){var f=new a;if(e)return h(c).success(function(a,b,g){g("last-modified")!==e?f.reject("File modified by another user"):i(c,d).then(function(){f.resolve()})}),f.promise;var g=c.split("/");return b.getService("$contentApi").request({method:"POST",url:"/qrs/extension/"+g[0]+"/uploadfile?externalpath="+g[1]+"&overwrite=true",data:d}).success(function(){f.resolve()}).error(function(a){f.reject(a)}),f.promise}function j(c){var d=new a,e=c.split("/");return b.getService("$contentApi").request({method:"DELETE",url:"/qrs/extension/"+e[0]+"/deletecontent?externalpath="+e[1]}).success(function(){d.resolve()}).error(function(a){d.reject(a)}),d.promise}function k(b){var c=new a;return i(e(b)+".qext",JSON.stringify(b.data,null,2)).then(function(){c.resolve()},function(a){c.reject(a)}),c.promise}function l(a){return j(e(a)+".qext")}function m(a,b){return d.createExtensionInRepo({name:a.toLowerCase(),description:b,type:"widget-library"})}function n(b){var c=new a;return h(b+"/"+b+".qext",!0).success(function(a){var b=JSON.parse(a);c.resolve(b)}).error(function(a){c.reject(a)}),c.promise}function o(b,c){var d=new a;return n(b).then(function(a){a.widgets||(a.widgets=[]),a.widgets.push(c),k({id:b,data:a}).then(function(){d.resolve()},function(a){d.reject(a)})}),d.promise}function p(b,c){var d=new a;return n(b).then(function(a){a.widgets?(a.widgets=a.widgets.filter(function(a){return a!==c}),k({id:b,data:a}).then(function(){d.resolve()},function(a){d.reject(a)})):d.reject()}),d.promise}function q(){var b=new a;return c.getList(!0).then(function(a){z.length=0,a.forEach(function(a){"widget-library"===a.data.type&&z.push(a)}),b.resolve()}).catch(function(a){b.reject(a)}),b.promise}function r(b){var c=new a,d=e(b);return i(d+".json",JSON.stringify({name:b.name,description:b.description,author:b.author,library:b.libid,meta:b.meta,properties:b.properties},null,2),b.lastModified).then(function(){var a="<style>"+b.css+"</style>\n<div>"+b.html+"</div>";i(d+".html",a).then(function(){b.lastModified?h(d+".json",!0).success(function(a,c,d){b.lastModified=d("last-modified")}).then(function(){c.resolve()}):o(b.libid,b.id).then(function(){h(d+".json",!0).success(function(a,c,d){b.lastModified=d("last-modified")}).then(function(){c.resolve()})})},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function s(b){var c=new a;return h(b+".json",!0).success(function(a,b,d){try{var e=JSON.parse(a);e.lastModified=d("last-modified"),c.resolve(e)}catch(f){c.reject(f)}}).error(function(){c.reject()}),c.promise}function t(a,b){var c=a+"/"+b;return y[c]||(y[c]=s(c)),y[c]}function u(b){var c=new a,d=e(b);return j(d+".json").then(function(){p(b.libid,b.id).then(function(){j(d+".html").then(function(){delete y[d],c.resolve()},function(a){c.reject(a)})},function(a){c.reject(a)})},function(){c.reject()}),c.promise}function v(b){var c=new a,d=e(b);return h(d+".html",!0).success(function(a){var d=document.createElement("div");d.innerHTML=a;for(var e=d.getElementsByTagName("script"),f=e.length;f--;)e[f].parentNode.removeChild(e[f]);var g=d.getElementsByTagName("style");if(1===g.length){b.css=g[0].innerHTML;var h=d.getElementsByTagName("div");b.html=h[0].innerHTML,c.resolve()}else c.reject("Widget.InvalidTemplate")}).error(function(){c.reject()}),c.promise}function w(b){var c=e(b);if(!y[c]){var d=new a;y[c]=d.promise,d.resolve(b)}}var x,y={},z=[];return{saveTemplate:r,getTemplate:t,deleteTemplate:u,addTemplate:w,getWidgetList:g,loadWidget:v,getLibForId:f,loadFile:h,getLibrary:n,saveLibrary:k,deleteLibrary:l,createLibrary:m,reloadCachedLibraries:q}}),define("dev-hub.models/widget-template",["core.utils/deferred","translator","./widget-file","core.utils/notification"],function(a,b,c,d){function e(a){var b=null;f.forEach(function(c,d){a.id===c.id&&(b=d)}),null===b?f.push(a):f[b]=a,g[a.id]=a}var f=[],g={},h="",i=[{id:"chart",name:"Widget.Type.chart",icon:"line-chart"},{id:"table",name:"Widget.Type.table",icon:"table"},{id:"kpi",name:"Widget.Type.kpi",icon:"kpi"},{id:"navigation",name:"Widget.Type.navigation",icon:"navigation"},{id:"other",name:"Widget.Type.other"}],j=function(a,b,c,d,e,f,g,h){this._version=0,f||(f={}),Object.defineProperties(this,{libid:{value:a},id:{value:b},name:{value:c,writable:!0},description:{value:d,writable:!0},author:{value:e,writable:!0},meta:{value:f,writable:!0},dummy:{value:h===!0?"true":null},html:{get:function(){return this._html},set:function(a){this._html=a,this._version++}},css:{get:function(){return this._css},set:function(a){this._css=a,this._version++}},properties:{value:g,writable:!0},version:{get:function(){return this._version}},isLoaded:{get:function(){return void 0!==this._html}}})};return j.getIcon=function(a){var b;return i.forEach(function(c){c.id===a&&c.icon&&(b=c.icon)}),b||"widget"},j.prototype.load=function(a){return this.loadDfd&&!a||(this.loadDfd=c.loadWidget(this)),this.loadDfd},j.prototype.save=function(){var a=this;return c.saveTemplate(this).then(function(){return j.Updated.emit(f),a})},j.prototype.copy=function(a){return j.add({libid:a.libid||this.libid,id:a.id||this.id,name:a.name||this.name,description:a.description||""===a.description?a.description:this.description,author:a.author||this.author,meta:a.meta||this.meta,html:a.html||this.html,css:a.css||this.css,properties:a.properties||this.properties})},j.prototype.delete=function(){var a=c.deleteTemplate(this),b=this;return f.forEach(function(a,c){a.id===b.id&&f.splice(c,1)}),g&&g[b.id]&&delete g[b.id],a.then(function(){j.Updated.emit(f)}),a},j.prototype.move=function(a){var b=this,d=this.copy({libid:a});return d.save().then(function(){return b.delete().then(function(){return c.reloadCachedLibraries().then(function(){return d})})})},j.getTemplateList=function(b){var d=[];return h&&!b||(h=new a,c.getWidgetList(b).then(function(b){b.forEach(function(a){d.push(j.get(a.id,!0,a.libid))}),a.all(d).then(function(){h.resolve(f)})})),h.promise},j.getLoaded=function(a){return g[a]},j.resetWidgetsProperties=function(a){g[a].propertiesObj&&g[a].propertiesObj.lastSavedProperties&&(g[a].properties=g[a].propertiesObj.lastSavedProperties)},j.get=function(d,f,h){if(d.indexOf("/")>-1){var i=d.split("/");h=i[0],d=i[1]}var k=new a;if(g[d]){var l=g[d];l.isLoaded||f?k.resolve(l):l.load().then(function(){k.resolve(l)},function(a){k.reject(a)})}else{if(!h){var m=c.getLibForId(d);h=m?m.id:void 0}h?c.getTemplate(h,d).then(function(a){a.properties||(a.properties={});var c=new j(h,d,a.name||b.get("Widget.NoName"),a.description||"",a.author||"",a.meta||{},a.properties);c.lastModified=a.lastModified,e(c),c.isLoaded||f?k.resolve(c):c.load().then(function(){k.resolve(c)},function(a){c.err=a,k.resolve(c)})},function(){var a=new j(h,d);k.resolve(a)}):k.reject("Can not find library for widget:"+d)}return k.promise},j.add=function(a){if(!a.id||!a.libid)return!1;var b=new j(a.libid,a.id,a.name||"",a.description||"",a.author||"",a.meta,a.properties,a.dummy);return b.html=a.html||"",b.css=a.css||"",e(b),c.addTemplate(b),j.Updated.emit(f),b},d.create(j,"Updated"),j.types=i,j}),/*!
 * Less - Leaner CSS v2.5.3
 * http://lesscss.org
 *
 * Copyright (c) 2009-2015, Alexis Sellier <self@cloudhead.net>
 * Licensed under the  License.
 *
 */
/** * @license 
 */
function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("assets/external/less/less",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.less=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./utils").addDataAttr,e=a("./browser");b.exports=function(a,b){d(b,e.currentScript(a)),void 0===b.isFileProtocol&&(b.isFileProtocol=/^(file|(chrome|safari)(-extension)?|resource|qrc|app):/.test(a.location.protocol)),b.async=b.async||!1,b.fileAsync=b.fileAsync||!1,b.poll=b.poll||(b.isFileProtocol?1e3:1500),b.env=b.env||("127.0.0.1"==a.location.hostname||"0.0.0.0"==a.location.hostname||"localhost"==a.location.hostname||a.location.port&&a.location.port.length>0||b.isFileProtocol?"development":"production");var c=/!dumpLineNumbers:(comments|mediaquery|all)/.exec(a.location.hash);c&&(b.dumpLineNumbers=c[1]),void 0===b.useFileCache&&(b.useFileCache=!0),void 0===b.onReady&&(b.onReady=!0)}},{"./browser":3,"./utils":9}],2:[function(a,b,c){a("promise/polyfill.js");var d=window.less||{};a("./add-default-options")(window,d);var e=b.exports=a("./index")(window,d);window.less=e,d.onReady&&(/!watch/.test(window.location.hash)&&e.watch(),e.registerStylesheetsImmediately(),e.pageLoadFinished=e.refresh("development"===e.env))},{"./add-default-options":1,"./index":7,"promise/polyfill.js":95}],3:[function(a,b,c){var d=a("./utils");b.exports={createCSS:function(a,b,c){var e=c.href||"",f="less:"+(c.title||d.extractId(e)),g=a.getElementById(f),h=!1,i=a.createElement("style");i.setAttribute("type","text/css"),c.media&&i.setAttribute("media",c.media),i.id=f,i.styleSheet||(i.appendChild(a.createTextNode(b)),h=null!==g&&g.childNodes.length>0&&i.childNodes.length>0&&g.firstChild.nodeValue===i.firstChild.nodeValue);var j=a.getElementsByTagName("head")[0];if(null===g||h===!1){var k=c&&c.nextSibling||null;k?k.parentNode.insertBefore(i,k):j.appendChild(i)}if(g&&h===!1&&g.parentNode.removeChild(g),i.styleSheet)try{i.styleSheet.cssText=b}catch(l){throw new Error("Couldn't reassign styleSheet.cssText.")}},currentScript:function(a){var b=a.document;return b.currentScript||function(){var a=b.getElementsByTagName("script");return a[a.length-1]}()}}},{"./utils":9}],4:[function(a,b,c){b.exports=function(a,b,c){var d=null;if("development"!==b.env)try{d="undefined"==typeof a.localStorage?null:a.localStorage}catch(e){}return{setCSS:function(a,b,e){if(d){c.info("saving "+a+" to cache.");try{d.setItem(a,e),d.setItem(a+":timestamp",b)}catch(f){c.error('failed to save "'+a+'" to local storage for caching.')}}},getCSS:function(a,b){var c=d&&d.getItem(a),e=d&&d.getItem(a+":timestamp");if(e&&b.lastModified&&new Date(b.lastModified).valueOf()===new Date(e).valueOf())return c}}}},{}],5:[function(a,b,c){var d=a("./utils"),e=a("./browser");b.exports=function(a,b,c){function f(b,f){var g,h,i="less-error-message:"+d.extractId(f||""),j='<li><label>{line}</label><pre class="{class}">{content}</pre></li>',k=a.document.createElement("div"),l=[],m=b.filename||f,n=m.match(/([^\/]+(\?.*)?)$/)[1];k.id=i,k.className="less-error-message",h="<h3>"+(b.type||"Syntax")+"Error: "+(b.message||"There is an error in your .less file")+'</h3><p>in <a href="'+m+'">'+n+"</a> ";var o=function(a,b,c){void 0!==a.extract[b]&&l.push(j.replace(/\{line\}/,(parseInt(a.line,10)||0)+(b-1)).replace(/\{class\}/,c).replace(/\{content\}/,a.extract[b]))};b.extract&&(o(b,0,""),o(b,1,"line"),o(b,2,""),h+="on line "+b.line+", column "+(b.column+1)+":</p><ul>"+l.join("")+"</ul>"),b.stack&&(b.extract||c.logLevel>=4)&&(h+="<br/>Stack Trace</br />"+b.stack.split("\n").slice(1).join("<br/>")),k.innerHTML=h,e.createCSS(a.document,[".less-error-message ul, .less-error-message li {","list-style-type: none;","margin-right: 15px;","padding: 4px 0;","margin: 0;","}",".less-error-message label {","font-size: 12px;","margin-right: 15px;","padding: 4px 0;","color: #cc7777;","}",".less-error-message pre {","color: #dd6666;","padding: 4px 0;","margin: 0;","display: inline-block;","}",".less-error-message pre.line {","color: #ff0000;","}",".less-error-message h3 {","font-size: 20px;","font-weight: bold;","padding: 15px 0 5px 0;","margin: 0;","}",".less-error-message a {","color: #10a","}",".less-error-message .error {","color: red;","font-weight: bold;","padding-bottom: 2px;","border-bottom: 1px dashed red;","}"].join("\n"),{title:"error-message"}),k.style.cssText=["font-family: Arial, sans-serif","border: 1px solid #e00","background-color: #eee","border-radius: 5px","-webkit-border-radius: 5px","-moz-border-radius: 5px","color: #e00","padding: 15px","margin-bottom: 15px"].join(";"),"development"===c.env&&(g=setInterval(function(){var b=a.document,c=b.body;c&&(b.getElementById(i)?c.replaceChild(k,b.getElementById(i)):c.insertBefore(k,c.firstChild),clearInterval(g))},10))}function g(a,b){c.errorReporting&&"html"!==c.errorReporting?"console"===c.errorReporting?k(a,b):"function"==typeof c.errorReporting&&c.errorReporting("add",a,b):f(a,b)}function h(b){var c=a.document.getElementById("less-error-message:"+d.extractId(b));c&&c.parentNode.removeChild(c)}function i(a){}function j(a){c.errorReporting&&"html"!==c.errorReporting?"console"===c.errorReporting?i(a):"function"==typeof c.errorReporting&&c.errorReporting("remove",a):h(a)}function k(a,d){var e="{line} {content}",f=a.filename||d,g=[],h=(a.type||"Syntax")+"Error: "+(a.message||"There is an error in your .less file")+" in "+f+" ",i=function(a,b,c){void 0!==a.extract[b]&&g.push(e.replace(/\{line\}/,(parseInt(a.line,10)||0)+(b-1)).replace(/\{class\}/,c).replace(/\{content\}/,a.extract[b]))};a.extract&&(i(a,0,""),i(a,1,"line"),i(a,2,""),h+="on line "+a.line+", column "+(a.column+1)+":\n"+g.join("\n")),a.stack&&(a.extract||c.logLevel>=4)&&(h+="\nStack Trace\n"+a.stack),b.logger.error(h)}return{add:g,remove:j}}},{"./browser":3,"./utils":9}],6:[function(a,b,c){b.exports=function(b,c){function d(){if(window.XMLHttpRequest&&!("file:"===window.location.protocol&&"ActiveXObject"in window))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return c.error("browser doesn't support AJAX."),null}}var e=a("../less/environment/abstract-file-manager.js"),f={},g=function(){};return g.prototype=new e,g.prototype.alwaysMakePathsAbsolute=function(){return!0},g.prototype.join=function(a,b){return a?this.extractUrlParts(b,a).path:b},g.prototype.doXHR=function(a,e,f,g){function h(b,c,d){b.status>=200&&b.status<300?c(b.responseText,b.getResponseHeader("Last-Modified")):"function"==typeof d&&d(b.status,a)}var i=d(),j=b.isFileProtocol?b.fileAsync:b.async;"function"==typeof i.overrideMimeType&&i.overrideMimeType("text/css"),c.debug("XHR: Getting '"+a+"'"),i.open("GET",a,j),i.setRequestHeader("Accept",e||"text/x-less, text/css; q=0.9, */*; q=0.5"),i.send(null),b.isFileProtocol&&!b.fileAsync?0===i.status||i.status>=200&&i.status<300?f(i.responseText):g(i.status,a):j?i.onreadystatechange=function(){4==i.readyState&&h(i,f,g)}:h(i,f,g)},g.prototype.supports=function(a,b,c,d){return!0},g.prototype.clearFileCache=function(){f={}},g.prototype.loadFile=function(a,b,c,d,e){b&&!this.isPathAbsolute(a)&&(a=b+a),c=c||{};var g=this.extractUrlParts(a,window.location.href),h=g.url;if(c.useFileCache&&f[h])try{var i=f[h];e(null,{contents:i,filename:h,webInfo:{lastModified:new Date}})}catch(j){e({filename:h,message:"Error loading file "+h+" error was "+j.message})}else this.doXHR(h,c.mime,function(a,b){f[h]=a,e(null,{contents:a,filename:h,webInfo:{lastModified:b}})},function(a,b){e({type:"File",message:"'"+b+"' wasn't found ("+a+")",href:h})})},g}},{"../less/environment/abstract-file-manager.js":14}],7:[function(a,b,c){var d=a("./utils").addDataAttr,e=a("./browser");b.exports=function(b,c){function f(a){return c.postProcessor&&"function"==typeof c.postProcessor&&(a=c.postProcessor.call(a,a)||a),a}function g(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function h(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){var d=c.concat(Array.prototype.slice.call(arguments,0));return a.apply(b,d)}}function i(a){for(var b,d=m.getElementsByTagName("style"),e=0;e<d.length;e++)if(b=d[e],b.type.match(t)){var f=g(c);f.modifyVars=a;var i=b.innerHTML||"";f.filename=m.location.href.replace(/#.*$/,""),n.render(i,f,h(function(a,b,c){b?r.add(b,"inline"):(a.type="text/css",a.styleSheet?a.styleSheet.cssText=c.css:a.innerHTML=c.css)},null,b))}}function j(a,b,e,h,i){function j(c){var d=c.contents,g=c.filename,i=c.webInfo,j={currentDirectory:q.getPath(g),filename:g,rootFilename:g,relativeUrls:k.relativeUrls};if(j.entryPath=j.currentDirectory,j.rootpath=k.rootpath||j.currentDirectory,i&&(i.remaining=h,!k.modifyVars)){var l=s.getCSS(g,i);if(!e&&l)return i.local=!0,void b(null,l,d,a,i,g)}r.remove(g),k.rootFileInfo=j,n.render(d,k,function(c,e){c?(c.href=g,b(c)):(e.css=f(e.css),k.modifyVars||s.setCSS(a.href,i.lastModified,e.css),b(null,e.css,d,a,i,g))})}var k=g(c);d(k,a),k.mime=a.type,i&&(k.modifyVars=i),q.loadFile(a.href,null,k,o,function(a,c){return a?void b(a):void j(c)})}function k(a,b,c){for(var d=0;d<n.sheets.length;d++)j(n.sheets[d],a,b,n.sheets.length-(d+1),c)}function l(){"development"===n.env&&(n.watchTimer=setInterval(function(){n.watchMode&&(q.clearFileCache(),k(function(a,c,d,f,g){a?r.add(a,a.href||f.href):c&&e.createCSS(b.document,c,f)}))},c.poll))}var m=b.document,n=a("../less")();n.options=c;var o=n.environment,p=a("./file-manager")(c,n.logger),q=new p;o.addFileManager(q),n.FileManager=p,a("./log-listener")(n,c);var r=a("./error-reporting")(b,n,c),s=n.cache=c.cache||a("./cache")(b,c,n.logger);c.functions&&n.functions.functionRegistry.addMultiple(c.functions);var t=/^text\/(x-)?less$/;return n.watch=function(){return n.watchMode||(n.env="development",l()),this.watchMode=!0,!0},n.unwatch=function(){return clearInterval(n.watchTimer),this.watchMode=!1,!1},n.registerStylesheetsImmediately=function(){var a=m.getElementsByTagName("link");n.sheets=[];for(var b=0;b<a.length;b++)("stylesheet/less"===a[b].rel||a[b].rel.match(/stylesheet/)&&a[b].type.match(t))&&n.sheets.push(a[b])},n.registerStylesheets=function(){return new Promise(function(a,b){n.registerStylesheetsImmediately(),a()})},n.modifyVars=function(a){return n.refresh(!0,a,!1)},n.refresh=function(a,c,d){return(a||d)&&d!==!1&&q.clearFileCache(),new Promise(function(d,f){var g,h,j;g=h=new Date,k(function(a,c,i,k,l){return a?(r.add(a,a.href||k.href),void f(a)):(l.local?n.logger.info("loading "+k.href+" from cache."):n.logger.info("rendered "+k.href+" successfully."),e.createCSS(b.document,c,k),n.logger.info("css for "+k.href+" generated in "+(new Date-h)+"ms"),0===l.remaining&&(j=new Date-g,n.logger.info("less has finished. css generated in "+j+"ms"),d({startTime:g,endTime:h,totalMilliseconds:j,sheets:n.sheets.length})),void(h=new Date))},a,c),i(c)})},n.refreshStyles=i,n}},{"../less":30,"./browser":3,"./cache":4,"./error-reporting":5,"./file-manager":6,"./log-listener":8,"./utils":9}],8:[function(a,b,c){b.exports=function(a,b){var c=4,d=3,e=2,f=1;b.logLevel="undefined"!=typeof b.logLevel?b.logLevel:"development"===b.env?d:f,b.loggers||(b.loggers=[{debug:function(a){b.logLevel>=c&&console.log(a)},info:function(a){b.logLevel>=d&&console.log(a)},warn:function(a){b.logLevel>=e&&console.warn(a)},error:function(a){b.logLevel>=f&&console.error(a)}}]);for(var g=0;g<b.loggers.length;g++)a.logger.addListener(b.loggers[g])}},{}],9:[function(a,b,c){b.exports={extractId:function(a){return a.replace(/^[a-z-]+:\/+?[^\/]+/,"").replace(/[\?\&]livereload=\w+/,"").replace(/^\//,"").replace(/\.[a-zA-Z]+$/,"").replace(/[^\.\w-]+/g,"-").replace(/\./g,":")},addDataAttr:function(a,b){for(var c in b.dataset)if(b.dataset.hasOwnProperty(c))if("env"===c||"dumpLineNumbers"===c||"rootpath"===c||"errorReporting"===c)a[c]=b.dataset[c];else try{a[c]=JSON.parse(b.dataset[c])}catch(d){}}}},{}],10:[function(a,b,c){var d={};b.exports=d;var e=function(a,b,c){if(a)for(var d=0;d<c.length;d++)a.hasOwnProperty(c[d])&&(b[c[d]]=a[c[d]])},f=["paths","relativeUrls","rootpath","strictImports","insecure","dumpLineNumbers","compress","syncImport","chunkInput","mime","useFileCache","processImports","reference","pluginManager"];d.Parse=function(a){e(a,this,f),"string"==typeof this.paths&&(this.paths=[this.paths])};var g=["paths","compress","ieCompat","strictMath","strictUnits","sourceMap","importMultiple","urlArgs","javascriptEnabled","pluginManager","importantScope"];d.Eval=function(a,b){e(a,this,g),"string"==typeof this.paths&&(this.paths=[this.paths]),this.frames=b||[],this.importantScope=this.importantScope||[]},d.Eval.prototype.inParenthesis=function(){this.parensStack||(this.parensStack=[]),this.parensStack.push(!0)},d.Eval.prototype.outOfParenthesis=function(){this.parensStack.pop()},d.Eval.prototype.isMathOn=function(){return!this.strictMath||this.parensStack&&this.parensStack.length},d.Eval.prototype.isPathRelative=function(a){return!/^(?:[a-z-]+:|\/|#)/i.test(a)},d.Eval.prototype.normalizePath=function(a){var b,c=a.split("/").reverse();for(a=[];0!==c.length;)switch(b=c.pop()){case".":break;case"..":0===a.length||".."===a[a.length-1]?a.push(b):a.pop();break;default:a.push(b)}return a.join("/")}},{}],11:[function(a,b,c){b.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},{}],12:[function(a,b,c){b.exports={colors:a("./colors"),unitConversions:a("./unit-conversions")}},{"./colors":11,"./unit-conversions":13}],13:[function(a,b,c){b.exports={length:{m:1,cm:.01,mm:.001,in:.0254,px:.0254/96,pt:.0254/72,pc:.0254/72*12},duration:{s:1,ms:.001},angle:{rad:1/(2*Math.PI),deg:1/360,grad:.0025,turn:1}}},{}],14:[function(a,b,c){var d=function(){};d.prototype.getPath=function(a){var b=a.lastIndexOf("?");return b>0&&(a=a.slice(0,b)),b=a.lastIndexOf("/"),b<0&&(b=a.lastIndexOf("\\")),b<0?"":a.slice(0,b+1)},d.prototype.tryAppendExtension=function(a,b){return/(\.[a-z]*$)|([\?;].*)$/.test(a)?a:a+b},d.prototype.tryAppendLessExtension=function(a){return this.tryAppendExtension(a,".less")},d.prototype.supportsSync=function(){return!1},d.prototype.alwaysMakePathsAbsolute=function(){return!1},d.prototype.isPathAbsolute=function(a){return/^(?:[a-z-]+:|\/|\\|#)/i.test(a)},d.prototype.join=function(a,b){return a?a+b:b},d.prototype.pathDiff=function(a,b){var c,d,e,f,g=this.extractUrlParts(a),h=this.extractUrlParts(b),i="";if(g.hostPart!==h.hostPart)return"";for(d=Math.max(h.directories.length,g.directories.length),c=0;c<d&&h.directories[c]===g.directories[c];c++);for(f=h.directories.slice(c),e=g.directories.slice(c),c=0;c<f.length-1;c++)i+="../";for(c=0;c<e.length-1;c++)i+=e[c]+"/";return i},d.prototype.extractUrlParts=function(a,b){var c,d,e=/^((?:[a-z-]+:)?\/+?(?:[^\/\?#]*\/)|([\/\\]))?((?:[^\/\\\?#]*[\/\\])*)([^\/\\\?#]*)([#\?].*)?$/i,f=a.match(e),g={},h=[];if(!f)throw new Error("Could not parse sheet href - '"+a+"'");if(b&&(!f[1]||f[2])){if(d=b.match(e),!d)throw new Error("Could not parse page url - '"+b+"'");f[1]=f[1]||d[1]||"",f[2]||(f[3]=d[3]+f[3])}if(f[3]){for(h=f[3].replace(/\\/g,"/").split("/"),c=0;c<h.length;c++)"."===h[c]&&(h.splice(c,1),c-=1);for(c=0;c<h.length;c++)".."===h[c]&&c>0&&(h.splice(c-1,2),c-=2)}return g.hostPart=f[1],g.directories=h,g.path=(f[1]||"")+h.join("/"),g.fileUrl=g.path+(f[4]||""),g.url=g.fileUrl+(f[5]||""),g},b.exports=d},{}],15:[function(a,b,c){var d=a("../logger"),e=function(a,b){this.fileManagers=b||[],a=a||{};for(var c=["encodeBase64","mimeLookup","charsetLookup","getSourceMapGenerator"],d=[],e=d.concat(c),f=0;f<e.length;f++){var g=e[f],h=a[g];h?this[g]=h.bind(a):f<d.length&&this.warn("missing required function in environment - "+g)}};e.prototype.getFileManager=function(a,b,c,e,f){a||d.warn("getFileManager called with no filename.. Please report this issue. continuing."),null==b&&d.warn("getFileManager called with null directory.. Please report this issue. continuing.");var g=this.fileManagers;c.pluginManager&&(g=[].concat(g).concat(c.pluginManager.getFileManagers()));for(var h=g.length-1;h>=0;h--){var i=g[h];if(i[f?"supportsSync":"supports"](a,b,c,e))return i}return null},e.prototype.addFileManager=function(a){this.fileManagers.push(a)},e.prototype.clearFileManagers=function(){this.fileManagers=[]},b.exports=e},{"../logger":32}],16:[function(a,b,c){function d(a,b,c){var d,f,g,h,i=b.alpha,j=c.alpha,k=[];g=j+i*(1-j);for(var l=0;l<3;l++)d=b.rgb[l]/255,f=c.rgb[l]/255,h=a(d,f),g&&(h=(j*f+i*(d-j*(d+f-h)))/g),k[l]=255*h;return new e(k,g)}var e=a("../tree/color"),f=a("./function-registry"),g={multiply:function(a,b){return a*b},screen:function(a,b){return a+b-a*b},overlay:function(a,b){return a*=2,a<=1?g.multiply(a,b):g.screen(a-1,b)},softlight:function(a,b){var c=1,d=a;return b>.5&&(d=1,c=a>.25?Math.sqrt(a):((16*a-12)*a+4)*a),a-(1-2*b)*d*(c-a)},hardlight:function(a,b){return g.overlay(b,a)},difference:function(a,b){return Math.abs(a-b)},exclusion:function(a,b){return a+b-2*a*b},average:function(a,b){return(a+b)/2},negation:function(a,b){return 1-Math.abs(a+b-1)}};for(var h in g)g.hasOwnProperty(h)&&(d[h]=d.bind(null,g[h]));f.addMultiple(d)},{"../tree/color":49,"./function-registry":21}],17:[function(a,b,c){function d(a){return Math.min(1,Math.max(0,a))}function e(a){return h.hsla(a.h,a.s,a.l,a.a)}function f(a){if(a instanceof i)return parseFloat(a.unit.is("%")?a.value/100:a.value);if("number"==typeof a)return a;throw{type:"Argument",message:"color functions take numbers as parameters"}}function g(a,b){return a instanceof i&&a.unit.is("%")?parseFloat(a.value*b/100):f(a)}var h,i=a("../tree/dimension"),j=a("../tree/color"),k=a("../tree/quoted"),l=a("../tree/anonymous"),m=a("./function-registry");h={rgb:function(a,b,c){return h.rgba(a,b,c,1)},rgba:function(a,b,c,d){var e=[a,b,c].map(function(a){return g(a,255)});return d=f(d),new j(e,d)},hsl:function(a,b,c){return h.hsla(a,b,c,1)},hsla:function(a,b,c,e){function g(a){return a=a<0?a+1:a>1?a-1:a,6*a<1?j+(i-j)*a*6:2*a<1?i:3*a<2?j+(i-j)*(2/3-a)*6:j}a=f(a)%360/360,b=d(f(b)),c=d(f(c)),e=d(f(e));var i=c<=.5?c*(b+1):c+b-c*b,j=2*c-i;return h.rgba(255*g(a+1/3),255*g(a),255*g(a-1/3),e)},hsv:function(a,b,c){return h.hsva(a,b,c,1)},hsva:function(a,b,c,d){a=f(a)%360/360*360,b=f(b),c=f(c),d=f(d);var e,g;e=Math.floor(a/60%6),g=a/60-e;var i=[c,c*(1-b),c*(1-g*b),c*(1-(1-g)*b)],j=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];return h.rgba(255*i[j[e][0]],255*i[j[e][1]],255*i[j[e][2]],d)},hue:function(a){return new i(a.toHSL().h)},saturation:function(a){return new i(100*a.toHSL().s,"%")},lightness:function(a){return new i(100*a.toHSL().l,"%")},hsvhue:function(a){return new i(a.toHSV().h)},hsvsaturation:function(a){return new i(100*a.toHSV().s,"%")},hsvvalue:function(a){return new i(100*a.toHSV().v,"%")},red:function(a){return new i(a.rgb[0])},green:function(a){return new i(a.rgb[1])},blue:function(a){return new i(a.rgb[2])},alpha:function(a){return new i(a.toHSL().a)},luma:function(a){return new i(a.luma()*a.alpha*100,"%")},luminance:function(a){var b=.2126*a.rgb[0]/255+.7152*a.rgb[1]/255+.0722*a.rgb[2]/255;return new i(b*a.alpha*100,"%")},saturate:function(a,b,c){if(!a.rgb)return null;var f=a.toHSL();return"undefined"!=typeof c&&"relative"===c.value?f.s+=f.s*b.value/100:f.s+=b.value/100,f.s=d(f.s),e(f)},desaturate:function(a,b,c){var f=a.toHSL();return"undefined"!=typeof c&&"relative"===c.value?f.s-=f.s*b.value/100:f.s-=b.value/100,f.s=d(f.s),e(f)},lighten:function(a,b,c){var f=a.toHSL();return"undefined"!=typeof c&&"relative"===c.value?f.l+=f.l*b.value/100:f.l+=b.value/100,f.l=d(f.l),e(f)},darken:function(a,b,c){var f=a.toHSL();return"undefined"!=typeof c&&"relative"===c.value?f.l-=f.l*b.value/100:f.l-=b.value/100,f.l=d(f.l),e(f)},fadein:function(a,b,c){var f=a.toHSL();return"undefined"!=typeof c&&"relative"===c.value?f.a+=f.a*b.value/100:f.a+=b.value/100,f.a=d(f.a),e(f)},fadeout:function(a,b,c){var f=a.toHSL();return"undefined"!=typeof c&&"relative"===c.value?f.a-=f.a*b.value/100:f.a-=b.value/100,f.a=d(f.a),e(f)},fade:function(a,b){var c=a.toHSL();return c.a=b.value/100,c.a=d(c.a),e(c)},spin:function(a,b){var c=a.toHSL(),d=(c.h+b.value)%360;return c.h=d<0?360+d:d,e(c)},mix:function(a,b,c){a.toHSL&&b.toHSL||(console.log(b.type),console.dir(b)),c||(c=new i(50));var d=c.value/100,e=2*d-1,f=a.toHSL().a-b.toHSL().a,g=((e*f==-1?e:(e+f)/(1+e*f))+1)/2,h=1-g,k=[a.rgb[0]*g+b.rgb[0]*h,a.rgb[1]*g+b.rgb[1]*h,a.rgb[2]*g+b.rgb[2]*h],l=a.alpha*d+b.alpha*(1-d);return new j(k,l)},greyscale:function(a){return h.desaturate(a,new i(100))},contrast:function(a,b,c,d){if(!a.rgb)return null;if("undefined"==typeof c&&(c=h.rgba(255,255,255,1)),"undefined"==typeof b&&(b=h.rgba(0,0,0,1)),b.luma()>c.luma()){var e=c;c=b,b=e}return d="undefined"==typeof d?.43:f(d),a.luma()<d?c:b},argb:function(a){return new l(a.toARGB())},color:function(a){if(a instanceof k&&/^#([a-f0-9]{6}|[a-f0-9]{3})$/i.test(a.value))return new j(a.value.slice(1));if(a instanceof j||(a=j.fromKeyword(a.value)))return a.value=void 0,a;throw{type:"Argument",message:"argument must be a color keyword or 3/6 digit hex e.g. #FFF"}},tint:function(a,b){return h.mix(h.rgb(255,255,255),a,b)},shade:function(a,b){return h.mix(h.rgb(0,0,0),a,b)}},m.addMultiple(h)},{"../tree/anonymous":45,"../tree/color":49,"../tree/dimension":55,"../tree/quoted":72,"./function-registry":21}],18:[function(a,b,c){b.exports=function(b){var c=a("../tree/quoted"),d=a("../tree/url"),e=a("./function-registry"),f=function(a,b){return new d(b,a.index,a.currentFileInfo).eval(a.context)},g=a("../logger");e.add("data-uri",function(a,e){e||(e=a,a=null);var h=a&&a.value,i=e.value,j=this.currentFileInfo,k=j.relativeUrls?j.currentDirectory:j.entryPath,l=i.indexOf("#"),m="";l!==-1&&(m=i.slice(l),i=i.slice(0,l));var n=b.getFileManager(i,k,this.context,b,!0);if(!n)return f(this,e);var o=!1;if(a)o=/;base64$/.test(h);else{if(h=b.mimeLookup(i),"image/svg+xml"===h)o=!1;else{var p=b.charsetLookup(h);o=["US-ASCII","UTF-8"].indexOf(p)<0}o&&(h+=";base64")}var q=n.loadFileSync(i,k,this.context,b);if(!q.contents)return g.warn("Skipped data-uri embedding of "+i+" because file not found"),f(this,e||a);var r=q.contents;if(o&&!b.encodeBase64)return f(this,e);r=o?b.encodeBase64(r):encodeURIComponent(r);var s="data:"+h+","+r+m,t=32768;return s.length>=t&&this.context.ieCompat!==!1?(g.warn("Skipped data-uri embedding of "+i+" because its size ("+s.length+" characters) exceeds IE8-safe "+t+" characters!"),f(this,e||a)):new d(new c('"'+s+'"',s,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../logger":32,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],19:[function(a,b,c){var d=a("../tree/keyword"),e=a("./function-registry"),f={eval:function(){var a=this.value_,b=this.error_;if(b)throw b;if(null!=a)return a?d.True:d.False},value:function(a){this.value_=a},error:function(a){this.error_=a},reset:function(){this.value_=this.error_=null}};e.add("default",f.eval.bind(f)),b.exports=f},{"../tree/keyword":64,"./function-registry":21}],20:[function(a,b,c){var d=a("../tree/expression"),e=function(a,b,c,d){this.name=a.toLowerCase(),this.index=c,this.context=b,this.currentFileInfo=d,this.func=b.frames[0].functionRegistry.get(this.name)};e.prototype.isValid=function(){return Boolean(this.func)},e.prototype.call=function(a){return Array.isArray(a)&&(a=a.filter(function(a){return"Comment"!==a.type}).map(function(a){if("Expression"===a.type){var b=a.value.filter(function(a){return"Comment"!==a.type});return 1===b.length?b[0]:new d(b)}return a})),this.func.apply(this,a)},b.exports=e},{"../tree/expression":58}],21:[function(a,b,c){function d(a){return{_data:{},add:function(a,b){a=a.toLowerCase(),this._data.hasOwnProperty(a),this._data[a]=b},addMultiple:function(a){Object.keys(a).forEach(function(b){this.add(b,a[b])}.bind(this))},get:function(b){return this._data[b]||a&&a.get(b)},inherit:function(){return d(this)}}}b.exports=d(null)},{}],22:[function(a,b,c){b.exports=function(b){var c={functionRegistry:a("./function-registry"),functionCaller:a("./function-caller")};return a("./default"),a("./color"),a("./color-blending"),a("./data-uri")(b),a("./math"),a("./number"),a("./string"),a("./svg")(b),a("./types"),c}},{"./color":17,"./color-blending":16,"./data-uri":18,"./default":19,"./function-caller":20,"./function-registry":21,"./math":24,"./number":25,"./string":26,"./svg":27,"./types":28}],23:[function(a,b,c){var d=a("../tree/dimension"),e=function(){};e._math=function(a,b,c){if(!(c instanceof d))throw{type:"Argument",message:"argument must be a number"};return null==b?b=c.unit:c=c.unify(),new d(a(parseFloat(c.value)),b)},b.exports=e},{"../tree/dimension":55}],24:[function(a,b,c){var d=a("./function-registry"),e=a("./math-helper.js"),f={ceil:null,floor:null,sqrt:null,abs:null,tan:"",sin:"",cos:"",atan:"rad",asin:"rad",acos:"rad"};for(var g in f)f.hasOwnProperty(g)&&(f[g]=e._math.bind(null,Math[g],f[g]));f.round=function(a,b){var c="undefined"==typeof b?0:b.value;return e._math(function(a){return a.toFixed(c)},null,a)},d.addMultiple(f)},{"./function-registry":21,"./math-helper.js":23}],25:[function(a,b,c){var d=a("../tree/dimension"),e=a("../tree/anonymous"),f=a("./function-registry"),g=a("./math-helper.js"),h=function(a,b){switch(b=Array.prototype.slice.call(b),b.length){case 0:throw{type:"Argument",message:"one or more arguments required"}}var c,f,g,h,i,j,k,l,m=[],n={};for(c=0;c<b.length;c++)if(g=b[c],g instanceof d)if(h=""===g.unit.toString()&&void 0!==l?new d(g.value,l).unify():g.unify(),j=""===h.unit.toString()&&void 0!==k?k:h.unit.toString(),k=""!==j&&void 0===k||""!==j&&""===m[0].unify().unit.toString()?j:k,l=""!==j&&void 0===l?g.unit.toString():l,f=void 0!==n[""]&&""!==j&&j===k?n[""]:n[j],void 0!==f)i=""===m[f].unit.toString()&&void 0!==l?new d(m[f].value,l).unify():m[f].unify(),(a&&h.value<i.value||!a&&h.value>i.value)&&(m[f]=g);else{if(void 0!==k&&j!==k)throw{type:"Argument",message:"incompatible types"};n[j]=m.length,m.push(g)}else Array.isArray(b[c].value)&&Array.prototype.push.apply(b,Array.prototype.slice.call(b[c].value));return 1==m.length?m[0]:(b=m.map(function(a){return a.toCSS(this.context)}).join(this.context.compress?",":", "),new e((a?"min":"max")+"("+b+")"))};f.addMultiple({min:function(){return h(!0,arguments)},max:function(){return h(!1,arguments)},convert:function(a,b){return a.convertTo(b.value)},pi:function(){return new d(Math.PI)},mod:function(a,b){return new d(a.value%b.value,a.unit)},pow:function(a,b){if("number"==typeof a&&"number"==typeof b)a=new d(a),b=new d(b);else if(!(a instanceof d&&b instanceof d))throw{type:"Argument",message:"arguments must be numbers"};return new d(Math.pow(a.value,b.value),a.unit)},percentage:function(a){var b=g._math(function(a){return 100*a},"%",a);return b}})},{"../tree/anonymous":45,"../tree/dimension":55,"./function-registry":21,"./math-helper.js":23}],26:[function(a,b,c){var d=a("../tree/quoted"),e=a("../tree/anonymous"),f=a("../tree/javascript"),g=a("./function-registry");g.addMultiple({e:function(a){return new e(a instanceof f?a.evaluated:a.value)},escape:function(a){return new e(encodeURI(a.value).replace(/=/g,"%3D").replace(/:/g,"%3A").replace(/#/g,"%23").replace(/;/g,"%3B").replace(/\(/g,"%28").replace(/\)/g,"%29"))},replace:function(a,b,c,e){var f=a.value;return c="Quoted"===c.type?c.value:c.toCSS(),f=f.replace(new RegExp(b.value,e?e.value:""),c),new d(a.quote||"",f,a.escaped)},"%":function(a){for(var b=Array.prototype.slice.call(arguments,1),c=a.value,e=0;e<b.length;e++)c=c.replace(/%[sda]/i,function(a){var c="Quoted"===b[e].type&&a.match(/s/i)?b[e].value:b[e].toCSS();return a.match(/[A-Z]$/)?encodeURIComponent(c):c});return c=c.replace(/%%/g,"%"),new d(a.quote||"",c,a.escaped)}})},{"../tree/anonymous":45,"../tree/javascript":62,"../tree/quoted":72,"./function-registry":21}],27:[function(a,b,c){b.exports=function(b){var c=a("../tree/dimension"),d=a("../tree/color"),e=a("../tree/expression"),f=a("../tree/quoted"),g=a("../tree/url"),h=a("./function-registry");h.add("svg-gradient",function(a){function b(){throw{type:"Argument",message:"svg-gradient expects direction, start_color [start_position], [color position,]..., end_color [end_position] or direction, color list"}}var h,i,j,k,l,m,n,o,p="linear",q='x="0" y="0" width="1" height="1"',r={compress:!1},s=a.toCSS(r);switch(2==arguments.length?(arguments[1].value.length<2&&b(),h=arguments[1].value):arguments.length<3?b():h=Array.prototype.slice.call(arguments,1),s){case"to bottom":i='x1="0%" y1="0%" x2="0%" y2="100%"';break;case"to right":i='x1="0%" y1="0%" x2="100%" y2="0%"';break;case"to bottom right":i='x1="0%" y1="0%" x2="100%" y2="100%"';break;case"to top right":i='x1="0%" y1="100%" x2="100%" y2="0%"';break;case"ellipse":case"ellipse at center":p="radial",i='cx="50%" cy="50%" r="75%"',
q='x="-50" y="-50" width="101" height="101"';break;default:throw{type:"Argument",message:"svg-gradient direction must be 'to bottom', 'to right', 'to bottom right', 'to top right' or 'ellipse at center'"}}for(j='<?xml version="1.0" ?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none"><'+p+'Gradient id="gradient" gradientUnits="userSpaceOnUse" '+i+">",k=0;k<h.length;k+=1)h[k]instanceof e?(l=h[k].value[0],m=h[k].value[1]):(l=h[k],m=void 0),l instanceof d&&((0===k||k+1===h.length)&&void 0===m||m instanceof c)||b(),n=m?m.toCSS(r):0===k?"0%":"100%",o=l.alpha,j+='<stop offset="'+n+'" stop-color="'+l.toRGB()+'"'+(o<1?' stop-opacity="'+o+'"':"")+"/>";return j+="</"+p+"Gradient><rect "+q+' fill="url(#gradient)" /></svg>',j=encodeURIComponent(j),j="data:image/svg+xml,"+j,new g(new f("'"+j+"'",j,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../tree/color":49,"../tree/dimension":55,"../tree/expression":58,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],28:[function(a,b,c){var d=a("../tree/keyword"),e=a("../tree/detached-ruleset"),f=a("../tree/dimension"),g=a("../tree/color"),h=a("../tree/quoted"),i=a("../tree/anonymous"),j=a("../tree/url"),k=a("../tree/operation"),l=a("./function-registry"),m=function(a,b){return a instanceof b?d.True:d.False},n=function(a,b){if(void 0===b)throw{type:"Argument",message:"missing the required second argument to isunit."};if(b="string"==typeof b.value?b.value:b,"string"!=typeof b)throw{type:"Argument",message:"Second argument to isunit should be a unit or a string."};return a instanceof f&&a.unit.is(b)?d.True:d.False},o=function(a){var b=Array.isArray(a.value)?a.value:Array(a);return b};l.addMultiple({isruleset:function(a){return m(a,e)},iscolor:function(a){return m(a,g)},isnumber:function(a){return m(a,f)},isstring:function(a){return m(a,h)},iskeyword:function(a){return m(a,d)},isurl:function(a){return m(a,j)},ispixel:function(a){return n(a,"px")},ispercentage:function(a){return n(a,"%")},isem:function(a){return n(a,"em")},isunit:n,unit:function(a,b){if(!(a instanceof f))throw{type:"Argument",message:"the first argument to unit must be a number"+(a instanceof k?". Have you forgotten parenthesis?":"")};return b=b?b instanceof d?b.value:b.toCSS():"",new f(a.value,b)},"get-unit":function(a){return new i(a.unit)},extract:function(a,b){return b=b.value-1,o(a)[b]},length:function(a){return new f(o(a).length)}})},{"../tree/anonymous":45,"../tree/color":49,"../tree/detached-ruleset":54,"../tree/dimension":55,"../tree/keyword":64,"../tree/operation":70,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],29:[function(a,b,c){var d=a("./contexts"),e=a("./parser/parser"),f=a("./plugins/function-importer");b.exports=function(a){var b=function(a,b){this.rootFilename=b.filename,this.paths=a.paths||[],this.contents={},this.contentsIgnoredChars={},this.mime=a.mime,this.error=null,this.context=a,this.queue=[],this.files={}};return b.prototype.push=function(b,c,g,h,i){var j=this;this.queue.push(b);var k=function(a,c,d){j.queue.splice(j.queue.indexOf(b),1);var e=d===j.rootFilename;h.optional&&a?i(null,{rules:[]},!1,null):(j.files[d]=c,a&&!j.error&&(j.error=a),i(a,c,e,d))},l={relativeUrls:this.context.relativeUrls,entryPath:g.entryPath,rootpath:g.rootpath,rootFilename:g.rootFilename},m=a.getFileManager(b,g.currentDirectory,this.context,a);if(!m)return void k({message:"Could not find a file-manager for "+b});c&&(b=m.tryAppendExtension(b,h.plugin?".js":".less"));var n=function(a){var b=a.filename,c=a.contents.replace(/^\uFEFF/,"");l.currentDirectory=m.getPath(b),l.relativeUrls&&(l.rootpath=m.join(j.context.rootpath||"",m.pathDiff(l.currentDirectory,l.entryPath)),!m.isPathAbsolute(l.rootpath)&&m.alwaysMakePathsAbsolute()&&(l.rootpath=m.join(l.entryPath,l.rootpath))),l.filename=b;var i=new d.Parse(j.context);i.processImports=!1,j.contents[b]=c,(g.reference||h.reference)&&(l.reference=!0),h.plugin?new f(i,l).eval(c,function(a,c){k(a,c,b)}):h.inline?k(null,c,b):new e(i,j,l).parse(c,function(a,c){k(a,c,b)})},o=m.loadFile(b,g.currentDirectory,this.context,a,function(a,b){a?k(a):n(b)});o&&o.then(n,k)},b}},{"./contexts":10,"./parser/parser":37,"./plugins/function-importer":39}],30:[function(a,b,c){b.exports=function(b,c){var d,e,f,g,h,i={version:[2,5,3],data:a("./data"),tree:a("./tree"),Environment:h=a("./environment/environment"),AbstractFileManager:a("./environment/abstract-file-manager"),environment:b=new h(b,c),visitors:a("./visitors"),Parser:a("./parser/parser"),functions:a("./functions")(b),contexts:a("./contexts"),SourceMapOutput:d=a("./source-map-output")(b),SourceMapBuilder:e=a("./source-map-builder")(d,b),ParseTree:f=a("./parse-tree")(e),ImportManager:g=a("./import-manager")(b),render:a("./render")(b,f,g),parse:a("./parse")(b,f,g),LessError:a("./less-error"),transformTree:a("./transform-tree"),utils:a("./utils"),PluginManager:a("./plugin-manager"),logger:a("./logger")};return i}},{"./contexts":10,"./data":12,"./environment/abstract-file-manager":14,"./environment/environment":15,"./functions":22,"./import-manager":29,"./less-error":31,"./logger":32,"./parse":34,"./parse-tree":33,"./parser/parser":37,"./plugin-manager":38,"./render":40,"./source-map-builder":41,"./source-map-output":42,"./transform-tree":43,"./tree":61,"./utils":82,"./visitors":86}],31:[function(a,b,c){var d=a("./utils"),e=b.exports=function(a,b,c){Error.call(this);var e=a.filename||c;if(b&&e){var f=b.contents[e],g=d.getLocation(a.index,f),h=g.line,i=g.column,j=a.call&&d.getLocation(a.call,f).line,k=f.split("\n");this.type=a.type||"Syntax",this.filename=e,this.index=a.index,this.line="number"==typeof h?h+1:null,this.callLine=j+1,this.callExtract=k[j],this.column=i,this.extract=[k[h-1],k[h],k[h+1]]}this.message=a.message,this.stack=a.stack};if("undefined"==typeof Object.create){var f=function(){};f.prototype=Error.prototype,e.prototype=new f}else e.prototype=Object.create(Error.prototype);e.prototype.constructor=e},{"./utils":82}],32:[function(a,b,c){b.exports={error:function(a){this._fireEvent("error",a)},warn:function(a){this._fireEvent("warn",a)},info:function(a){this._fireEvent("info",a)},debug:function(a){this._fireEvent("debug",a)},addListener:function(a){this._listeners.push(a)},removeListener:function(a){for(var b=0;b<this._listeners.length;b++)if(this._listeners[b]===a)return void this._listeners.splice(b,1)},_fireEvent:function(a,b){for(var c=0;c<this._listeners.length;c++){var d=this._listeners[c][a];d&&d(b)}},_listeners:[]}},{}],33:[function(a,b,c){var d=a("./less-error"),e=a("./transform-tree"),f=a("./logger");b.exports=function(a){var b=function(a,b){this.root=a,this.imports=b};return b.prototype.toCSS=function(b){var c,g,h={};try{c=e(this.root,b)}catch(i){throw new d(i,this.imports)}try{var j=Boolean(b.compress);j&&f.warn("The compress option has been deprecated. We recommend you use a dedicated css minifier, for instance see less-plugin-clean-css.");var k={compress:j,dumpLineNumbers:b.dumpLineNumbers,strictUnits:Boolean(b.strictUnits),numPrecision:8};b.sourceMap?(g=new a(b.sourceMap),h.css=g.toCSS(c,k,this.imports)):h.css=c.toCSS(k)}catch(i){throw new d(i,this.imports)}if(b.pluginManager)for(var l=b.pluginManager.getPostProcessors(),m=0;m<l.length;m++)h.css=l[m].process(h.css,{sourceMap:g,options:b,imports:this.imports});b.sourceMap&&(h.map=g.getExternalSourceMap()),h.imports=[];for(var n in this.imports.files)this.imports.files.hasOwnProperty(n)&&n!==this.imports.rootFilename&&h.imports.push(n);return h},b}},{"./less-error":31,"./logger":32,"./transform-tree":43}],34:[function(a,b,c){var d,e=a("./contexts"),f=a("./parser/parser"),g=a("./plugin-manager");b.exports=function(b,c,h){var i=function(b,c,j){if(c=c||{},"function"==typeof c&&(j=c,c={}),!j){d||(d="undefined"==typeof Promise?a("promise"):Promise);var k=this;return new d(function(a,d){i.call(k,b,c,function(b,c){b?d(b):a(c)})})}var l,m,n=new g(this);if(n.addPlugins(c.plugins),c.pluginManager=n,l=new e.Parse(c),c.rootFileInfo)m=c.rootFileInfo;else{var o=c.filename||"input",p=o.replace(/[^\/\\]*$/,"");m={filename:o,relativeUrls:l.relativeUrls,rootpath:l.rootpath||"",currentDirectory:p,entryPath:p,rootFilename:o},m.rootpath&&"/"!==m.rootpath.slice(-1)&&(m.rootpath+="/")}var q=new h(l,m);new f(l,q,m).parse(b,function(a,b){return a?j(a):void j(null,b,q,c)},c)};return i}},{"./contexts":10,"./parser/parser":37,"./plugin-manager":38,promise:void 0}],35:[function(a,b,c){b.exports=function(a,b){function c(b){var c=h-q;c<512&&!b||!c||(p.push(a.slice(q,h+1)),q=h+1)}var d,e,f,g,h,i,j,k,l,m=a.length,n=0,o=0,p=[],q=0;for(h=0;h<m;h++)if(j=a.charCodeAt(h),!(j>=97&&j<=122||j<34))switch(j){case 40:o++,e=h;continue;case 41:if(--o<0)return b("missing opening `(`",h);continue;case 59:o||c();continue;case 123:n++,d=h;continue;case 125:if(--n<0)return b("missing opening `{`",h);n||o||c();continue;case 92:if(h<m-1){h++;continue}return b("unescaped `\\`",h);case 34:case 39:case 96:for(l=0,i=h,h+=1;h<m;h++)if(k=a.charCodeAt(h),!(k>96)){if(k==j){l=1;break}if(92==k){if(h==m-1)return b("unescaped `\\`",h);h++}}if(l)continue;return b("unmatched `"+String.fromCharCode(j)+"`",i);case 47:if(o||h==m-1)continue;if(k=a.charCodeAt(h+1),47==k)for(h+=2;h<m&&(k=a.charCodeAt(h),!(k<=13)||10!=k&&13!=k);h++);else if(42==k){for(f=i=h,h+=2;h<m-1&&(k=a.charCodeAt(h),125==k&&(g=h),42!=k||47!=a.charCodeAt(h+1));h++);if(h==m-1)return b("missing closing `*/`",i);h++}continue;case 42:if(h<m-1&&47==a.charCodeAt(h+1))return b("unmatched `/*`",h);continue}return 0!==n?f>d&&g>f?b("missing closing `}` or `*/`",d):b("missing closing `}`",d):0!==o?b("missing closing `)`",e):(c(!0),p)}},{}],36:[function(a,b,c){var d=a("./chunker");b.exports=function(){var a,b,c,e,f,g,h,i=[],j={};j.save=function(){h=j.i,i.push({current:g,i:j.i,j:b})},j.restore=function(a){(j.i>c||j.i===c&&a&&!e)&&(c=j.i,e=a);var d=i.pop();g=d.current,h=j.i=d.i,b=d.j},j.forget=function(){i.pop()},j.isWhitespace=function(b){var c=j.i+(b||0),d=a.charCodeAt(c);return d===k||d===n||d===l||d===m},j.$re=function(a){j.i>h&&(g=g.slice(j.i-h),h=j.i);var b=a.exec(g);return b?(s(b[0].length),"string"==typeof b?b:1===b.length?b[0]:b):null},j.$char=function(b){return a.charAt(j.i)!==b?null:(s(1),b)},j.$str=function(b){for(var c=b.length,d=0;d<c;d++)if(a.charAt(j.i+d)!==b.charAt(d))return null;return s(c),b},j.$quoted=function(){var b=a.charAt(j.i);if("'"===b||'"'===b){for(var c=a.length,d=j.i,e=1;e+d<c;e++){var f=a.charAt(e+d);switch(f){case"\\":e++;continue;case"\r":case"\n":break;case b:var g=a.substr(d,e+1);return s(e+1),g}}return null}};var k=32,l=9,m=10,n=13,o=43,p=44,q=47,r=57;j.autoCommentAbsorb=!0,j.commentStore=[],j.finished=!1;var s=function(c){for(var d,e,i,o=j.i,p=b,r=j.i-h,t=j.i+g.length-r,u=j.i+=c,v=a;j.i<t;j.i++){if(d=v.charCodeAt(j.i),j.autoCommentAbsorb&&d===q){if(e=v.charAt(j.i+1),"/"===e){i={index:j.i,isLineComment:!0};var w=v.indexOf("\n",j.i+2);w<0&&(w=t),j.i=w,i.text=v.substr(i.i,j.i-i.i),j.commentStore.push(i);continue}if("*"===e){var x=v.indexOf("*/",j.i+2);if(x>=0){i={index:j.i,text:v.substr(j.i,x+2-j.i),isLineComment:!1},j.i+=i.text.length-1,j.commentStore.push(i);continue}}break}if(d!==k&&d!==m&&d!==l&&d!==n)break}if(g=g.slice(c+j.i-u+r),h=j.i,!g.length){if(b<f.length-1)return g=f[++b],s(0),!0;j.finished=!0}return o!==j.i||p!==b};return j.peek=function(b){if("string"==typeof b){for(var c=0;c<b.length;c++)if(a.charAt(j.i+c)!==b.charAt(c))return!1;return!0}return b.test(g)},j.peekChar=function(b){return a.charAt(j.i)===b},j.currentChar=function(){return a.charAt(j.i)},j.getInput=function(){return a},j.peekNotNumeric=function(){var b=a.charCodeAt(j.i);return b>r||b<o||b===q||b===p},j.start=function(e,i,k){a=e,j.i=b=h=c=0,f=i?d(e,k):[e],g=f[0],s(0)},j.end=function(){var b,d=j.i>=a.length;return j.i<c&&(b=e,j.i=c),{isFinished:d,furthest:j.i,furthestPossibleErrorMessage:b,furthestReachedEnd:j.i>=a.length-1,furthestChar:a[j.i]}},j}},{"./chunker":35}],37:[function(a,b,c){var d=a("../less-error"),e=a("../tree"),f=a("../visitors"),g=a("./parser-input"),h=a("../utils"),i=function a(b,c,i){function j(a,b,c){var d="[object Function]"===Object.prototype.toString.call(a)?a.call(n):o.$re(a);return d?d:void l(b||("string"==typeof a?"expected '"+a+"' got '"+o.currentChar()+"'":"unexpected token"))}function k(a,b){return o.$char(a)?a:void l(b||"expected '"+a+"' got '"+o.currentChar()+"'")}function l(a,b){throw new d({index:o.i,filename:i.filename,type:b||"Syntax",message:a},c)}function m(a){var b=i.filename;return{lineNumber:h.getLocation(a,o.getInput()).line+1,fileName:b}}var n,o=g();return{parse:function(g,h,j){var k,l,m,n,p=null,q="";if(l=j&&j.globalVars?a.serializeVars(j.globalVars)+"\n":"",m=j&&j.modifyVars?"\n"+a.serializeVars(j.modifyVars):"",b.pluginManager)for(var r=b.pluginManager.getPreProcessors(),s=0;s<r.length;s++)g=r[s].process(g,{context:b,imports:c,fileInfo:i});(l||j&&j.banner)&&(q=(j&&j.banner?j.banner:"")+l,n=c.contentsIgnoredChars,n[i.filename]=n[i.filename]||0,n[i.filename]+=q.length),g=g.replace(/\r\n?/g,"\n"),g=q+g.replace(/^\uFEFF/,"")+m,c.contents[i.filename]=g;try{o.start(g,b.chunkInput,function(a,b){throw new d({index:b,type:"Parse",message:a,filename:i.filename},c)}),k=new e.Ruleset(null,this.parsers.primary()),k.root=!0,k.firstRoot=!0}catch(t){return h(new d(t,c,i.filename))}var u=o.end();if(!u.isFinished){var v=u.furthestPossibleErrorMessage;v||(v="Unrecognised input","}"===u.furthestChar?v+=". Possibly missing opening '{'":")"===u.furthestChar?v+=". Possibly missing opening '('":u.furthestReachedEnd&&(v+=". Possibly missing something")),p=new d({type:"Parse",message:v,index:u.furthest,filename:i.filename},c)}var w=function(a){return a=p||a||c.error,a?(a instanceof d||(a=new d(a,c,i.filename)),h(a)):h(null,k)};return b.processImports===!1?w():void new f.ImportVisitor(c,w).run(k)},parsers:n={primary:function(){for(var a,b=this.mixin,c=[];;){for(;;){if(a=this.comment(),!a)break;c.push(a)}if(o.finished)break;if(o.peek("}"))break;if(a=this.extendRule())c=c.concat(a);else if(a=b.definition()||this.rule()||this.ruleset()||b.call()||this.rulesetCall()||this.directive())c.push(a);else{for(var d=!1;o.$char(";");)d=!0;if(!d)break}}return c},comment:function(){if(o.commentStore.length){var a=o.commentStore.shift();return new e.Comment(a.text,a.isLineComment,a.index,i)}},entities:{quoted:function(){var a,b=o.i,c=!1;return o.save(),o.$char("~")&&(c=!0),(a=o.$quoted())?(o.forget(),new e.Quoted(a.charAt(0),a.substr(1,a.length-2),c,b,i)):void o.restore()},keyword:function(){var a=o.$char("%")||o.$re(/^[_A-Za-z-][_A-Za-z0-9-]*/);if(a)return e.Color.fromKeyword(a)||new e.Keyword(a)},call:function(){var a,b,c,d,f=o.i;if(!o.peek(/^url\(/i))return o.save(),(a=o.$re(/^([\w-]+|%|progid:[\w\.]+)\(/))?(a=a[1],b=a.toLowerCase(),"alpha"===b&&(d=n.alpha())?(o.forget(),d):(c=this.arguments(),o.$char(")")?(o.forget(),new e.Call(a,c,f,i)):void o.restore("Could not parse call arguments or missing ')'"))):void o.forget()},arguments:function(){for(var a,b=[];;){if(a=this.assignment()||n.expression(),!a)break;if(b.push(a),!o.$char(","))break}return b},literal:function(){return this.dimension()||this.color()||this.quoted()||this.unicodeDescriptor()},assignment:function(){var a,b;return o.save(),(a=o.$re(/^\w+(?=\s?=)/i))&&o.$char("=")&&(b=n.entity())?(o.forget(),new e.Assignment(a,b)):void o.restore()},url:function(){var a,b=o.i;return o.autoCommentAbsorb=!1,o.$str("url(")?(a=this.quoted()||this.variable()||o.$re(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",o.autoCommentAbsorb=!0,k(")"),new e.URL(null!=a.value||a instanceof e.Variable?a:new e.Anonymous(a),b,i)):void(o.autoCommentAbsorb=!0)},variable:function(){var a,b=o.i;if("@"===o.currentChar()&&(a=o.$re(/^@@?[\w-]+/)))return new e.Variable(a,b,i)},variableCurly:function(){var a,b=o.i;if("@"===o.currentChar()&&(a=o.$re(/^@\{([\w-]+)\}/)))return new e.Variable("@"+a[1],b,i)},color:function(){var a;if("#"===o.currentChar()&&(a=o.$re(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/))){var b=a.input.match(/^#([\w]+).*/);return b=b[1],b.match(/^[A-Fa-f0-9]+$/)||l("Invalid HEX color code"),new e.Color(a[1],void 0,"#"+b)}},dimension:function(){if(!o.peekNotNumeric()){var a=o.$re(/^([+-]?\d*\.?\d+)(%|[a-z]+)?/i);return a?new e.Dimension(a[1],a[2]):void 0}},unicodeDescriptor:function(){var a;if(a=o.$re(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/))return new e.UnicodeDescriptor(a[0])},javascript:function(){var a,b=o.i;o.save();var c=o.$char("~"),d=o.$char("`");return d?(a=o.$re(/^[^`]*`/))?(o.forget(),new e.JavaScript(a.substr(0,a.length-1),Boolean(c),b,i)):void o.restore("invalid javascript definition"):void o.restore()}},variable:function(){var a;if("@"===o.currentChar()&&(a=o.$re(/^(@[\w-]+)\s*:/)))return a[1]},rulesetCall:function(){var a;if("@"===o.currentChar()&&(a=o.$re(/^(@[\w-]+)\s*\(\s*\)\s*;/)))return new e.RulesetCall(a[1])},extend:function(a){var b,c,d,f,g,h=o.i;if(o.$str(a?"&:extend(":":extend(")){do{for(d=null,b=null;!(d=o.$re(/^(all)(?=\s*(\)|,))/))&&(c=this.element());)b?b.push(c):b=[c];d=d&&d[1],b||l("Missing target selector for :extend()."),g=new e.Extend(new e.Selector(b),d,h),f?f.push(g):f=[g]}while(o.$char(","));return j(/^\)/),a&&j(/^;/),f}},extendRule:function(){return this.extend(!0)},mixin:{call:function(){var a,b,c,d,f,g,h=o.currentChar(),j=!1,l=o.i;if("."===h||"#"===h){for(o.save();;){if(a=o.i,d=o.$re(/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/),!d)break;c=new e.Element(f,d,a,i),b?b.push(c):b=[c],f=o.$char(">")}return b&&(o.$char("(")&&(g=this.args(!0).args,k(")")),n.important()&&(j=!0),n.end())?(o.forget(),new e.mixin.Call(b,g,l,i,j)):void o.restore()}},args:function(a){var b,c,d,f,g,h,i,j=n.entities,k={args:null,variadic:!1},m=[],p=[],q=[];for(o.save();;){if(a)h=n.detachedRuleset()||n.expression();else{if(o.commentStore.length=0,o.$str("...")){k.variadic=!0,o.$char(";")&&!b&&(b=!0),(b?p:q).push({variadic:!0});break}h=j.variable()||j.literal()||j.keyword()}if(!h)break;f=null,h.throwAwayComments&&h.throwAwayComments(),g=h;var r=null;if(a?h.value&&1==h.value.length&&(r=h.value[0]):r=h,r&&r instanceof e.Variable)if(o.$char(":")){if(m.length>0&&(b&&l("Cannot mix ; and , as delimiter types"),c=!0),g=n.detachedRuleset()||n.expression(),!g){if(!a)return o.restore(),k.args=[],k;l("could not understand value for named argument")}f=d=r.name}else if(o.$str("...")){if(!a){k.variadic=!0,o.$char(";")&&!b&&(b=!0),(b?p:q).push({name:h.name,variadic:!0});break}i=!0}else a||(d=f=r.name,g=null);g&&m.push(g),q.push({name:f,value:g,expand:i}),o.$char(",")||(o.$char(";")||b)&&(c&&l("Cannot mix ; and , as delimiter types"),b=!0,m.length>1&&(g=new e.Value(m)),p.push({name:d,value:g,expand:i}),d=null,m=[],c=!1)}return o.forget(),k.args=b?p:q,k},definition:function(){var a,b,c,d,f=[],g=!1;if(!("."!==o.currentChar()&&"#"!==o.currentChar()||o.peek(/^[^{]*\}/)))if(o.save(),b=o.$re(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/)){a=b[1];var h=this.args(!1);if(f=h.args,g=h.variadic,!o.$char(")"))return void o.restore("Missing closing ')'");if(o.commentStore.length=0,o.$str("when")&&(d=j(n.conditions,"expected condition")),c=n.block())return o.forget(),new e.mixin.Definition(a,f,c,d,g);o.restore()}else o.forget()}},entity:function(){var a=this.entities;return this.comment()||a.literal()||a.variable()||a.url()||a.call()||a.keyword()||a.javascript()},end:function(){return o.$char(";")||o.peek("}")},alpha:function(){var a;if(o.$re(/^opacity=/i))return a=o.$re(/^\d+/),a||(a=j(this.entities.variable,"Could not parse alpha")),k(")"),new e.Alpha(a)},element:function(){var a,b,c,d=o.i;if(b=this.combinator(),a=o.$re(/^(?:\d+\.\d+|\d+)%/)||o.$re(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||o.$char("*")||o.$char("&")||this.attribute()||o.$re(/^\([^&()@]+\)/)||o.$re(/^[\.#:](?=@)/)||this.entities.variableCurly(),a||(o.save(),o.$char("(")?(c=this.selector())&&o.$char(")")?(a=new e.Paren(c),o.forget()):o.restore("Missing closing ')'"):o.forget()),a)return new e.Element(b,a,d,i)},combinator:function(){var a=o.currentChar();if("/"===a){o.save();var b=o.$re(/^\/[a-z]+\//i);if(b)return o.forget(),new e.Combinator(b);o.restore()}if(">"===a||"+"===a||"~"===a||"|"===a||"^"===a){for(o.i++,"^"===a&&"^"===o.currentChar()&&(a="^^",o.i++);o.isWhitespace();)o.i++;return new e.Combinator(a)}return o.isWhitespace(-1)?new e.Combinator(" "):new e.Combinator(null)},lessSelector:function(){return this.selector(!0)},selector:function(a){for(var b,c,d,f,g,h,k,m=o.i;(a&&(c=this.extend())||a&&(h=o.$str("when"))||(f=this.element()))&&(h?k=j(this.conditions,"expected condition"):k?l("CSS guard can only be used at the end of selector"):c?g=g?g.concat(c):c:(g&&l("Extend can only be used at the end of selector"),d=o.currentChar(),b?b.push(f):b=[f],f=null),"{"!==d&&"}"!==d&&";"!==d&&","!==d&&")"!==d););return b?new e.Selector(b,g,k,m,i):void(g&&l("Extend must be used to extend a selector, it cannot be used on its own"))},attribute:function(){if(o.$char("[")){var a,b,c,d=this.entities;return(a=d.variableCurly())||(a=j(/^(?:[_A-Za-z0-9-\*]*\|)?(?:[_A-Za-z0-9-]|\\.)+/)),c=o.$re(/^[|~*$^]?=/),c&&(b=d.quoted()||o.$re(/^[0-9]+%/)||o.$re(/^[\w-]+/)||d.variableCurly()),k("]"),new e.Attribute(a,c,b)}},block:function(){var a;if(o.$char("{")&&(a=this.primary())&&o.$char("}"))return a},blockRuleset:function(){var a=this.block();return a&&(a=new e.Ruleset(null,a)),a},detachedRuleset:function(){var a=this.blockRuleset();if(a)return new e.DetachedRuleset(a)},ruleset:function(){var a,c,d,f;for(o.save(),b.dumpLineNumbers&&(f=m(o.i));;){if(c=this.lessSelector(),!c)break;if(a?a.push(c):a=[c],o.commentStore.length=0,c.condition&&a.length>1&&l("Guards are only currently allowed on a single selector."),!o.$char(","))break;c.condition&&l("Guards are only currently allowed on a single selector."),o.commentStore.length=0}if(a&&(d=this.block())){o.forget();var g=new e.Ruleset(a,d,b.strictImports);return b.dumpLineNumbers&&(g.debugInfo=f),g}o.restore()},rule:function(a){var c,d,f,g,h,j=o.i,k=o.currentChar();if("."!==k&&"#"!==k&&"&"!==k&&":"!==k)if(o.save(),c=this.variable()||this.ruleProperty()){if(h="string"==typeof c,h&&(d=this.detachedRuleset()),o.commentStore.length=0,!d){g=!h&&c.length>1&&c.pop().value;var l=!a&&(b.compress||h);if(l&&(d=this.value()),!d&&(d=this.anonymousValue()))return o.forget(),new e.Rule(c,d,!1,g,j,i);l||d||(d=this.value()),f=this.important()}if(d&&this.end())return o.forget(),new e.Rule(c,d,f,g,j,i);if(o.restore(),d&&!a)return this.rule(!0)}else o.forget()},anonymousValue:function(){var a=o.$re(/^([^@+\/'"*`(;{}-]*);/);if(a)return new e.Anonymous(a[1])},import:function(){var a,b,c=o.i,d=o.$re(/^@import?\s+/);if(d){var f=(d?this.importOptions():null)||{};if(a=this.entities.quoted()||this.entities.url())return b=this.mediaFeatures(),o.$char(";")||(o.i=c,l("missing semi-colon or unrecognised media features on import")),b=b&&new e.Value(b),new e.Import(a,b,f,c,i);o.i=c,l("malformed import statement")}},importOptions:function(){var a,b,c,d={};if(!o.$char("("))return null;do if(a=this.importOption()){switch(b=a,c=!0,b){case"css":b="less",c=!1;break;case"once":b="multiple",c=!1}if(d[b]=c,!o.$char(","))break}while(a);return k(")"),d},importOption:function(){var a=o.$re(/^(less|css|multiple|once|inline|reference|optional)/);if(a)return a[1]},mediaFeature:function(){var a,b,c=this.entities,d=[];o.save();do if(a=c.keyword()||c.variable())d.push(a);else if(o.$char("(")){if(b=this.property(),a=this.value(),!o.$char(")"))return o.restore("Missing closing ')'"),null;if(b&&a)d.push(new e.Paren(new e.Rule(b,a,null,null,o.i,i,!0)));else{if(!a)return o.restore("badly formed media feature definition"),null;d.push(new e.Paren(a))}}while(a);if(o.forget(),d.length>0)return new e.Expression(d)},mediaFeatures:function(){var a,b=this.entities,c=[];do if(a=this.mediaFeature()){if(c.push(a),!o.$char(","))break}else if(a=b.variable(),a&&(c.push(a),!o.$char(",")))break;while(a);return c.length>0?c:null},media:function(){var a,c,d,f;return b.dumpLineNumbers&&(f=m(o.i)),o.save(),o.$str("@media")?(a=this.mediaFeatures(),(c=this.block())?(o.forget(),d=new e.Media(c,a,o.i,i),b.dumpLineNumbers&&(d.debugInfo=f),d):void o.restore("media definitions require block statements after any features")):void o.restore()},plugin:function(){var a,b=o.i,c=o.$re(/^@plugin?\s+/);if(c){var d={plugin:!0};if(a=this.entities.quoted()||this.entities.url())return o.$char(";")||(o.i=b,l("missing semi-colon on plugin")),new e.Import(a,null,d,b,i);o.i=b,l("malformed plugin statement")}},directive:function(){var a,c,d,f,g,h,j,k=o.i,n=!0,p=!0;if("@"===o.currentChar()){if(c=this.import()||this.plugin()||this.media())return c;if(o.save(),a=o.$re(/^@[a-z-]+/)){switch(f=a,"-"==a.charAt(1)&&a.indexOf("-",2)>0&&(f="@"+a.slice(a.indexOf("-",2)+1)),f){case"@counter-style":g=!0,n=!0;break;case"@charset":g=!0,n=!1;break;case"@namespace":h=!0,n=!1;break;case"@keyframes":g=!0;break;case"@host":case"@page":j=!0;break;case"@document":case"@supports":j=!0,p=!1}return o.commentStore.length=0,g?(c=this.entity(),c||l("expected "+a+" identifier")):h?(c=this.expression(),c||l("expected "+a+" expression")):j&&(c=(o.$re(/^[^{;]+/)||"").trim(),c&&(c=new e.Anonymous(c))),n&&(d=this.blockRuleset()),d||!n&&c&&o.$char(";")?(o.forget(),new e.Directive(a,c,d,k,i,b.dumpLineNumbers?m(k):null,!1,p)):void o.restore("directive options not recognised")}}},value:function(){var a,b=[];do if(a=this.expression(),a&&(b.push(a),!o.$char(",")))break;while(a);if(b.length>0)return new e.Value(b)},important:function(){if("!"===o.currentChar())return o.$re(/^! *important/)},sub:function(){var a,b;return o.save(),o.$char("(")?(a=this.addition(),a&&o.$char(")")?(o.forget(),b=new e.Expression([a]),b.parens=!0,b):void o.restore("Expected ')'")):void o.restore()},multiplication:function(){var a,b,c,d,f;if(a=this.operand()){for(f=o.isWhitespace(-1);;){if(o.peek(/^\/[*\/]/))break;if(o.save(),c=o.$char("/")||o.$char("*"),!c){o.forget();break}if(b=this.operand(),!b){o.restore();break}o.forget(),a.parensInOp=!0,b.parensInOp=!0,d=new e.Operation(c,[d||a,b],f),f=o.isWhitespace(-1)}return d||a}},addition:function(){var a,b,c,d,f;if(a=this.multiplication()){for(f=o.isWhitespace(-1);;){if(c=o.$re(/^[-+]\s+/)||!f&&(o.$char("+")||o.$char("-")),!c)break;if(b=this.multiplication(),!b)break;a.parensInOp=!0,b.parensInOp=!0,d=new e.Operation(c,[d||a,b],f),f=o.isWhitespace(-1)}return d||a}},conditions:function(){var a,b,c,d=o.i;if(a=this.condition()){for(;;){if(!o.peek(/^,\s*(not\s*)?\(/)||!o.$char(","))break;if(b=this.condition(),!b)break;c=new e.Condition("or",c||a,b,d)}return c||a}},condition:function(){var a,b,c,d,f=this.entities,g=o.i,h=!1;if(o.$str("not")&&(h=!0),k("("),a=this.addition()||f.keyword()||f.quoted())return o.$char(">")?d=o.$char("=")?">=":">":o.$char("<")?d=o.$char("=")?"<=":"<":o.$char("=")&&(d=o.$char(">")?"=>":o.$char("<")?"=<":"="),d?(b=this.addition()||f.keyword()||f.quoted(),b?c=new e.Condition(d,a,b,g,h):l("expected expression")):c=new e.Condition("=",a,new e.Keyword("true"),g,h),k(")"),o.$str("and")?new e.Condition("and",c,this.condition()):c},operand:function(){var a,b=this.entities;o.peek(/^-[@\(]/)&&(a=o.$char("-"));var c=this.sub()||b.dimension()||b.color()||b.variable()||b.call();return a&&(c.parensInOp=!0,c=new e.Negative(c)),c},expression:function(){var a,b,c=[];do a=this.comment(),a?c.push(a):(a=this.addition()||this.entity(),a&&(c.push(a),o.peek(/^\/[\/*]/)||(b=o.$char("/"),b&&c.push(new e.Anonymous(b)))));while(a);if(c.length>0)return new e.Expression(c)},property:function(){var a=o.$re(/^(\*?-?[_a-zA-Z0-9-]+)\s*:/);if(a)return a[1]},ruleProperty:function(){function a(a){var b=o.i,c=o.$re(a);if(c)return f.push(b),d.push(c[1])}var b,c,d=[],f=[];o.save();var g=o.$re(/^([_a-zA-Z0-9-]+)\s*:/);if(g)return d=[new e.Keyword(g[1])],o.forget(),d;for(a(/^(\*?)/);;)if(!a(/^((?:[\w-]+)|(?:@\{[\w-]+\}))/))break;if(d.length>1&&a(/^((?:\+_|\+)?)\s*:/)){for(o.forget(),""===d[0]&&(d.shift(),f.shift()),c=0;c<d.length;c++)b=d[c],d[c]="@"!==b.charAt(0)?new e.Keyword(b):new e.Variable("@"+b.slice(2,-1),f[c],i);return d}o.restore()}}}};i.serializeVars=function(a){var b="";for(var c in a)if(Object.hasOwnProperty.call(a,c)){var d=a[c];b+=("@"===c[0]?"":"@")+c+": "+d+(";"===String(d).slice(-1)?"":";")}return b},b.exports=i},{"../less-error":31,"../tree":61,"../utils":82,"../visitors":86,"./parser-input":36}],38:[function(a,b,c){var d=function(a){this.less=a,this.visitors=[],this.preProcessors=[],this.postProcessors=[],this.installedPlugins=[],this.fileManagers=[]};d.prototype.addPlugins=function(a){if(a)for(var b=0;b<a.length;b++)this.addPlugin(a[b])},d.prototype.addPlugin=function(a){this.installedPlugins.push(a),a.install(this.less,this)},d.prototype.addVisitor=function(a){this.visitors.push(a)},d.prototype.addPreProcessor=function(a,b){var c;for(c=0;c<this.preProcessors.length&&!(this.preProcessors[c].priority>=b);c++);this.preProcessors.splice(c,0,{preProcessor:a,priority:b})},d.prototype.addPostProcessor=function(a,b){var c;for(c=0;c<this.postProcessors.length&&!(this.postProcessors[c].priority>=b);c++);this.postProcessors.splice(c,0,{postProcessor:a,priority:b})},d.prototype.addFileManager=function(a){this.fileManagers.push(a)},d.prototype.getPreProcessors=function(){for(var a=[],b=0;b<this.preProcessors.length;b++)a.push(this.preProcessors[b].preProcessor);return a},d.prototype.getPostProcessors=function(){for(var a=[],b=0;b<this.postProcessors.length;b++)a.push(this.postProcessors[b].postProcessor);return a},d.prototype.getVisitors=function(){return this.visitors},d.prototype.getFileManagers=function(){return this.fileManagers},b.exports=d},{}],39:[function(a,b,c){var d=a("../less-error"),e=a("../tree"),f=b.exports=function(a,b){this.fileInfo=b};f.prototype.eval=function(a,b){var c,f,g={};f={add:function(a,b){g[a]=b},addMultiple:function(a){Object.keys(a).forEach(function(b){g[b]=a[b]})}};try{c=new Function("functions","tree","fileInfo",a),c(f,e,this.fileInfo)}catch(h){b(new d({message:"Plugin evaluation error: '"+h.name+": "+h.message.replace(/["]/g,"'")+"'",filename:this.fileInfo.filename}),null)}b(null,{functions:g})}},{"../less-error":31,"../tree":61}],40:[function(a,b,c){var d;b.exports=function(b,c,e){var f=function(b,e,g){if("function"==typeof e&&(g=e,e={}),!g){d||(d="undefined"==typeof Promise?a("promise"):Promise);var h=this;return new d(function(a,c){f.call(h,b,e,function(b,d){b?c(b):a(d)})})}this.parse(b,e,function(a,b,d,e){if(a)return g(a);var f;try{var h=new c(b,d);f=h.toCSS(e)}catch(a){return g(a)}g(null,f)})};return f}},{promise:void 0}],41:[function(a,b,c){b.exports=function(a,b){var c=function(a){this.options=a};return c.prototype.toCSS=function(b,c,d){var e=new a({contentsIgnoredCharsMap:d.contentsIgnoredChars,rootNode:b,contentsMap:d.contents,sourceMapFilename:this.options.sourceMapFilename,sourceMapURL:this.options.sourceMapURL,outputFilename:this.options.sourceMapOutputFilename,sourceMapBasepath:this.options.sourceMapBasepath,sourceMapRootpath:this.options.sourceMapRootpath,outputSourceFiles:this.options.outputSourceFiles,sourceMapGenerator:this.options.sourceMapGenerator,sourceMapFileInline:this.options.sourceMapFileInline}),f=e.toCSS(c);return this.sourceMap=e.sourceMap,this.sourceMapURL=e.sourceMapURL,this.options.sourceMapInputFilename&&(this.sourceMapInputFilename=e.normalizeFilename(this.options.sourceMapInputFilename)),f+this.getCSSAppendage()},c.prototype.getCSSAppendage=function(){var a=this.sourceMapURL;if(this.options.sourceMapFileInline){if(void 0===this.sourceMap)return"";a="data:application/json;base64,"+b.encodeBase64(this.sourceMap)}return a?"/*# sourceMappingURL="+a+" */":""},c.prototype.getExternalSourceMap=function(){return this.sourceMap},c.prototype.setExternalSourceMap=function(a){this.sourceMap=a},c.prototype.isInline=function(){return this.options.sourceMapFileInline},c.prototype.getSourceMapURL=function(){return this.sourceMapURL},c.prototype.getOutputFilename=function(){return this.options.sourceMapOutputFilename},c.prototype.getInputFilename=function(){
return this.sourceMapInputFilename},c}},{}],42:[function(a,b,c){b.exports=function(a){var b=function(b){this._css=[],this._rootNode=b.rootNode,this._contentsMap=b.contentsMap,this._contentsIgnoredCharsMap=b.contentsIgnoredCharsMap,b.sourceMapFilename&&(this._sourceMapFilename=b.sourceMapFilename.replace(/\\/g,"/")),this._outputFilename=b.outputFilename,this.sourceMapURL=b.sourceMapURL,b.sourceMapBasepath&&(this._sourceMapBasepath=b.sourceMapBasepath.replace(/\\/g,"/")),b.sourceMapRootpath?(this._sourceMapRootpath=b.sourceMapRootpath.replace(/\\/g,"/"),"/"!==this._sourceMapRootpath.charAt(this._sourceMapRootpath.length-1)&&(this._sourceMapRootpath+="/")):this._sourceMapRootpath="",this._outputSourceFiles=b.outputSourceFiles,this._sourceMapGeneratorConstructor=a.getSourceMapGenerator(),this._lineNumber=0,this._column=0};return b.prototype.normalizeFilename=function(a){return a=a.replace(/\\/g,"/"),this._sourceMapBasepath&&0===a.indexOf(this._sourceMapBasepath)&&(a=a.substring(this._sourceMapBasepath.length),"\\"!==a.charAt(0)&&"/"!==a.charAt(0)||(a=a.substring(1))),(this._sourceMapRootpath||"")+a},b.prototype.add=function(a,b,c,d){if(a){var e,f,g,h,i;if(b){var j=this._contentsMap[b.filename];this._contentsIgnoredCharsMap[b.filename]&&(c-=this._contentsIgnoredCharsMap[b.filename],c<0&&(c=0),j=j.slice(this._contentsIgnoredCharsMap[b.filename])),j=j.substring(0,c),f=j.split("\n"),h=f[f.length-1]}if(e=a.split("\n"),g=e[e.length-1],b)if(d)for(i=0;i<e.length;i++)this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+i+1,column:0===i?this._column:0},original:{line:f.length+i,column:0===i?h.length:0},source:this.normalizeFilename(b.filename)});else this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+1,column:this._column},original:{line:f.length,column:h.length},source:this.normalizeFilename(b.filename)});1===e.length?this._column+=g.length:(this._lineNumber+=e.length-1,this._column=g.length),this._css.push(a)}},b.prototype.isEmpty=function(){return 0===this._css.length},b.prototype.toCSS=function(a){if(this._sourceMapGenerator=new this._sourceMapGeneratorConstructor({file:this._outputFilename,sourceRoot:null}),this._outputSourceFiles)for(var b in this._contentsMap)if(this._contentsMap.hasOwnProperty(b)){var c=this._contentsMap[b];this._contentsIgnoredCharsMap[b]&&(c=c.slice(this._contentsIgnoredCharsMap[b])),this._sourceMapGenerator.setSourceContent(this.normalizeFilename(b),c)}if(this._rootNode.genCSS(a,this),this._css.length>0){var d,e=JSON.stringify(this._sourceMapGenerator.toJSON());this.sourceMapURL?d=this.sourceMapURL:this._sourceMapFilename&&(d=this._sourceMapFilename),this.sourceMapURL=d,this.sourceMap=e}return this._css.join("")},b}},{}],43:[function(a,b,c){var d=a("./contexts"),e=a("./visitors"),f=a("./tree");b.exports=function(a,b){b=b||{};var c,g=b.variables,h=new d.Eval(b);"object"!=typeof g||Array.isArray(g)||(g=Object.keys(g).map(function(a){var b=g[a];return b instanceof f.Value||(b instanceof f.Expression||(b=new f.Expression([b])),b=new f.Value([b])),new f.Rule("@"+a,b,!1,null,0)}),h.frames=[new f.Ruleset(null,g)]);var i,j=[],k=[new e.JoinSelectorVisitor,new e.ExtendVisitor,new e.ToCSSVisitor({compress:Boolean(b.compress)})];if(b.pluginManager){var l=b.pluginManager.getVisitors();for(i=0;i<l.length;i++){var m=l[i];m.isPreEvalVisitor?j.push(m):m.isPreVisitor?k.splice(0,0,m):k.push(m)}}for(i=0;i<j.length;i++)j[i].run(a);for(c=a.eval(h),i=0;i<k.length;i++)k[i].run(c);return c}},{"./contexts":10,"./tree":61,"./visitors":86}],44:[function(a,b,c){var d=a("./node"),e=function(a){this.value=a};e.prototype=new d,e.prototype.type="Alpha",e.prototype.accept=function(a){this.value=a.visit(this.value)},e.prototype.eval=function(a){return this.value.eval?new e(this.value.eval(a)):this},e.prototype.genCSS=function(a,b){b.add("alpha(opacity="),this.value.genCSS?this.value.genCSS(a,b):b.add(this.value),b.add(")")},b.exports=e},{"./node":69}],45:[function(a,b,c){var d=a("./node"),e=function(a,b,c,d,e,f){this.value=a,this.index=b,this.mapLines=d,this.currentFileInfo=c,this.rulesetLike="undefined"!=typeof e&&e,this.isReferenced=f||!1};e.prototype=new d,e.prototype.type="Anonymous",e.prototype.eval=function(){return new e(this.value,this.index,this.currentFileInfo,this.mapLines,this.rulesetLike,this.isReferenced)},e.prototype.compare=function(a){return a.toCSS&&this.toCSS()===a.toCSS()?0:void 0},e.prototype.isRulesetLike=function(){return this.rulesetLike},e.prototype.genCSS=function(a,b){b.add(this.value,this.currentFileInfo,this.index,this.mapLines)},e.prototype.markReferenced=function(){this.isReferenced=!0},e.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},b.exports=e},{"./node":69}],46:[function(a,b,c){var d=a("./node"),e=function(a,b){this.key=a,this.value=b};e.prototype=new d,e.prototype.type="Assignment",e.prototype.accept=function(a){this.value=a.visit(this.value)},e.prototype.eval=function(a){return this.value.eval?new e(this.key,this.value.eval(a)):this},e.prototype.genCSS=function(a,b){b.add(this.key+"="),this.value.genCSS?this.value.genCSS(a,b):b.add(this.value)},b.exports=e},{"./node":69}],47:[function(a,b,c){var d=a("./node"),e=function(a,b,c){this.key=a,this.op=b,this.value=c};e.prototype=new d,e.prototype.type="Attribute",e.prototype.eval=function(a){return new e(this.key.eval?this.key.eval(a):this.key,this.op,this.value&&this.value.eval?this.value.eval(a):this.value)},e.prototype.genCSS=function(a,b){b.add(this.toCSS(a))},e.prototype.toCSS=function(a){var b=this.key.toCSS?this.key.toCSS(a):this.key;return this.op&&(b+=this.op,b+=this.value.toCSS?this.value.toCSS(a):this.value),"["+b+"]"},b.exports=e},{"./node":69}],48:[function(a,b,c){var d=a("./node"),e=a("../functions/function-caller"),f=function(a,b,c,d){this.name=a,this.args=b,this.index=c,this.currentFileInfo=d};f.prototype=new d,f.prototype.type="Call",f.prototype.accept=function(a){this.args&&(this.args=a.visitArray(this.args))},f.prototype.eval=function(a){var b,c=this.args.map(function(b){return b.eval(a)}),d=new e(this.name,a,this.index,this.currentFileInfo);if(d.isValid())try{if(b=d.call(c),null!=b)return b}catch(g){throw{type:g.type||"Runtime",message:"error evaluating function `"+this.name+"`"+(g.message?": "+g.message:""),index:this.index,filename:this.currentFileInfo.filename}}return new f(this.name,c,this.index,this.currentFileInfo)},f.prototype.genCSS=function(a,b){b.add(this.name+"(",this.currentFileInfo,this.index);for(var c=0;c<this.args.length;c++)this.args[c].genCSS(a,b),c+1<this.args.length&&b.add(", ");b.add(")")},b.exports=f},{"../functions/function-caller":20,"./node":69}],49:[function(a,b,c){function d(a,b){return Math.min(Math.max(a,0),b)}function e(a){return"#"+a.map(function(a){return a=d(Math.round(a),255),(a<16?"0":"")+a.toString(16)}).join("")}var f=a("./node"),g=a("../data/colors"),h=function(a,b,c){Array.isArray(a)?this.rgb=a:6==a.length?this.rgb=a.match(/.{2}/g).map(function(a){return parseInt(a,16)}):this.rgb=a.split("").map(function(a){return parseInt(a+a,16)}),this.alpha="number"==typeof b?b:1,"undefined"!=typeof c&&(this.value=c)};h.prototype=new f,h.prototype.type="Color",h.prototype.luma=function(){var a=this.rgb[0]/255,b=this.rgb[1]/255,c=this.rgb[2]/255;return a=a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4),b=b<=.03928?b/12.92:Math.pow((b+.055)/1.055,2.4),c=c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4),.2126*a+.7152*b+.0722*c},h.prototype.genCSS=function(a,b){b.add(this.toCSS(a))},h.prototype.toCSS=function(a,b){var c,e,f=a&&a.compress&&!b;if(this.value)return this.value;if(e=this.fround(a,this.alpha),e<1)return"rgba("+this.rgb.map(function(a){return d(Math.round(a),255)}).concat(d(e,1)).join(","+(f?"":" "))+")";if(c=this.toRGB(),f){var g=c.split("");g[1]===g[2]&&g[3]===g[4]&&g[5]===g[6]&&(c="#"+g[1]+g[3]+g[5])}return c},h.prototype.operate=function(a,b,c){for(var d=[],e=this.alpha*(1-c.alpha)+c.alpha,f=0;f<3;f++)d[f]=this._operate(a,b,this.rgb[f],c.rgb[f]);return new h(d,e)},h.prototype.toRGB=function(){return e(this.rgb)},h.prototype.toHSL=function(){var a,b,c=this.rgb[0]/255,d=this.rgb[1]/255,e=this.rgb[2]/255,f=this.alpha,g=Math.max(c,d,e),h=Math.min(c,d,e),i=(g+h)/2,j=g-h;if(g===h)a=b=0;else{switch(b=i>.5?j/(2-g-h):j/(g+h),g){case c:a=(d-e)/j+(d<e?6:0);break;case d:a=(e-c)/j+2;break;case e:a=(c-d)/j+4}a/=6}return{h:360*a,s:b,l:i,a:f}},h.prototype.toHSV=function(){var a,b,c=this.rgb[0]/255,d=this.rgb[1]/255,e=this.rgb[2]/255,f=this.alpha,g=Math.max(c,d,e),h=Math.min(c,d,e),i=g,j=g-h;if(b=0===g?0:j/g,g===h)a=0;else{switch(g){case c:a=(d-e)/j+(d<e?6:0);break;case d:a=(e-c)/j+2;break;case e:a=(c-d)/j+4}a/=6}return{h:360*a,s:b,v:i,a:f}},h.prototype.toARGB=function(){return e([255*this.alpha].concat(this.rgb))},h.prototype.compare=function(a){return a.rgb&&a.rgb[0]===this.rgb[0]&&a.rgb[1]===this.rgb[1]&&a.rgb[2]===this.rgb[2]&&a.alpha===this.alpha?0:void 0},h.fromKeyword=function(a){var b,c=a.toLowerCase();if(g.hasOwnProperty(c)?b=new h(g[c].slice(1)):"transparent"===c&&(b=new h([0,0,0],0)),b)return b.value=a,b},b.exports=h},{"../data/colors":11,"./node":69}],50:[function(a,b,c){var d=a("./node"),e=function(a){" "===a?(this.value=" ",this.emptyOrWhitespace=!0):(this.value=a?a.trim():"",this.emptyOrWhitespace=""===this.value)};e.prototype=new d,e.prototype.type="Combinator";var f={"":!0," ":!0,"|":!0};e.prototype.genCSS=function(a,b){var c=a.compress||f[this.value]?"":" ";b.add(c+this.value+c)},b.exports=e},{"./node":69}],51:[function(a,b,c){var d=a("./node"),e=a("./debug-info"),f=function(a,b,c,d){this.value=a,this.isLineComment=b,this.currentFileInfo=d};f.prototype=new d,f.prototype.type="Comment",f.prototype.genCSS=function(a,b){this.debugInfo&&b.add(e(a,this),this.currentFileInfo,this.index),b.add(this.value)},f.prototype.isSilent=function(a){var b=this.currentFileInfo&&this.currentFileInfo.reference&&!this.isReferenced,c=a.compress&&"!"!==this.value[2];return this.isLineComment||b||c},f.prototype.markReferenced=function(){this.isReferenced=!0},b.exports=f},{"./debug-info":53,"./node":69}],52:[function(a,b,c){var d=a("./node"),e=function(a,b,c,d,e){this.op=a.trim(),this.lvalue=b,this.rvalue=c,this.index=d,this.negate=e};e.prototype=new d,e.prototype.type="Condition",e.prototype.accept=function(a){this.lvalue=a.visit(this.lvalue),this.rvalue=a.visit(this.rvalue)},e.prototype.eval=function(a){var b=function(a,b,c){switch(a){case"and":return b&&c;case"or":return b||c;default:switch(d.compare(b,c)){case-1:return"<"===a||"=<"===a||"<="===a;case 0:return"="===a||">="===a||"=<"===a||"<="===a;case 1:return">"===a||">="===a;default:return!1}}}(this.op,this.lvalue.eval(a),this.rvalue.eval(a));return this.negate?!b:b},b.exports=e},{"./node":69}],53:[function(a,b,c){var d=function(a,b,c){var e="";if(a.dumpLineNumbers&&!a.compress)switch(a.dumpLineNumbers){case"comments":e=d.asComment(b);break;case"mediaquery":e=d.asMediaQuery(b);break;case"all":e=d.asComment(b)+(c||"")+d.asMediaQuery(b)}return e};d.asComment=function(a){return"/* line "+a.debugInfo.lineNumber+", "+a.debugInfo.fileName+" */\n"},d.asMediaQuery=function(a){var b=a.debugInfo.fileName;return/^[a-z]+:\/\//i.test(b)||(b="file://"+b),"@media -sass-debug-info{filename{font-family:"+b.replace(/([.:\/\\])/g,function(a){return"\\"==a&&(a="/"),"\\"+a})+"}line{font-family:\\00003"+a.debugInfo.lineNumber+"}}\n"},b.exports=d},{}],54:[function(a,b,c){var d=a("./node"),e=a("../contexts"),f=function(a,b){this.ruleset=a,this.frames=b};f.prototype=new d,f.prototype.type="DetachedRuleset",f.prototype.evalFirst=!0,f.prototype.accept=function(a){this.ruleset=a.visit(this.ruleset)},f.prototype.eval=function(a){var b=this.frames||a.frames.slice(0);return new f(this.ruleset,b)},f.prototype.callEval=function(a){return this.ruleset.eval(this.frames?new e.Eval(a,this.frames.concat(a.frames)):a)},b.exports=f},{"../contexts":10,"./node":69}],55:[function(a,b,c){var d=a("./node"),e=a("../data/unit-conversions"),f=a("./unit"),g=a("./color"),h=function(a,b){this.value=parseFloat(a),this.unit=b&&b instanceof f?b:new f(b?[b]:void 0)};h.prototype=new d,h.prototype.type="Dimension",h.prototype.accept=function(a){this.unit=a.visit(this.unit)},h.prototype.eval=function(a){return this},h.prototype.toColor=function(){return new g([this.value,this.value,this.value])},h.prototype.genCSS=function(a,b){if(a&&a.strictUnits&&!this.unit.isSingular())throw new Error("Multiple units in dimension. Correct the units or use the unit function. Bad unit: "+this.unit.toString());var c=this.fround(a,this.value),d=String(c);if(0!==c&&c<1e-6&&c>-1e-6&&(d=c.toFixed(20).replace(/0+$/,"")),a&&a.compress){if(0===c&&this.unit.isLength())return void b.add(d);c>0&&c<1&&(d=d.substr(1))}b.add(d),this.unit.genCSS(a,b)},h.prototype.operate=function(a,b,c){var d=this._operate(a,b,this.value,c.value),e=this.unit.clone();if("+"===b||"-"===b)if(0===e.numerator.length&&0===e.denominator.length)e=c.unit.clone(),this.unit.backupUnit&&(e.backupUnit=this.unit.backupUnit);else if(0===c.unit.numerator.length&&0===e.denominator.length);else{if(c=c.convertTo(this.unit.usedUnits()),a.strictUnits&&c.unit.toString()!==e.toString())throw new Error("Incompatible units. Change the units or use the unit function. Bad units: '"+e.toString()+"' and '"+c.unit.toString()+"'.");d=this._operate(a,b,this.value,c.value)}else"*"===b?(e.numerator=e.numerator.concat(c.unit.numerator).sort(),e.denominator=e.denominator.concat(c.unit.denominator).sort(),e.cancel()):"/"===b&&(e.numerator=e.numerator.concat(c.unit.denominator).sort(),e.denominator=e.denominator.concat(c.unit.numerator).sort(),e.cancel());return new h(d,e)},h.prototype.compare=function(a){var b,c;if(a instanceof h){if(this.unit.isEmpty()||a.unit.isEmpty())b=this,c=a;else if(b=this.unify(),c=a.unify(),0!==b.unit.compare(c.unit))return;return d.numericCompare(b.value,c.value)}},h.prototype.unify=function(){return this.convertTo({length:"px",duration:"s",angle:"rad"})},h.prototype.convertTo=function(a){var b,c,d,f,g,i=this.value,j=this.unit.clone(),k={};if("string"==typeof a){for(b in e)e[b].hasOwnProperty(a)&&(k={},k[b]=a);a=k}g=function(a,b){return d.hasOwnProperty(a)?(b?i/=d[a]/d[f]:i*=d[a]/d[f],f):a};for(c in a)a.hasOwnProperty(c)&&(f=a[c],d=e[c],j.map(g));return j.cancel(),new h(i,j)},b.exports=h},{"../data/unit-conversions":13,"./color":49,"./node":69,"./unit":78}],56:[function(a,b,c){var d=a("./node"),e=a("./selector"),f=a("./ruleset"),g=function(a,b,c,d,f,g,h,i){var j;if(this.name=a,this.value=b,c)for(Array.isArray(c)?this.rules=c:(this.rules=[c],this.rules[0].selectors=new e([],null,null,this.index,f).createEmptySelectors()),j=0;j<this.rules.length;j++)this.rules[j].allowImports=!0;this.index=d,this.currentFileInfo=f,this.debugInfo=g,this.isReferenced=h,this.isRooted=i||!1};g.prototype=new d,g.prototype.type="Directive",g.prototype.accept=function(a){var b=this.value,c=this.rules;c&&(this.rules=a.visitArray(c)),b&&(this.value=a.visit(b))},g.prototype.isRulesetLike=function(){return this.rules||!this.isCharset()},g.prototype.isCharset=function(){return"@charset"===this.name},g.prototype.genCSS=function(a,b){var c=this.value,d=this.rules;b.add(this.name,this.currentFileInfo,this.index),c&&(b.add(" "),c.genCSS(a,b)),d?this.outputRuleset(a,b,d):b.add(";")},g.prototype.eval=function(a){var b,c,d=this.value,e=this.rules;return b=a.mediaPath,c=a.mediaBlocks,a.mediaPath=[],a.mediaBlocks=[],d&&(d=d.eval(a)),e&&(e=[e[0].eval(a)],e[0].root=!0),a.mediaPath=b,a.mediaBlocks=c,new g(this.name,d,e,this.index,this.currentFileInfo,this.debugInfo,this.isReferenced,this.isRooted)},g.prototype.variable=function(a){if(this.rules)return f.prototype.variable.call(this.rules[0],a)},g.prototype.find=function(){if(this.rules)return f.prototype.find.apply(this.rules[0],arguments)},g.prototype.rulesets=function(){if(this.rules)return f.prototype.rulesets.apply(this.rules[0])},g.prototype.markReferenced=function(){var a,b;if(this.isReferenced=!0,this.rules)for(b=this.rules,a=0;a<b.length;a++)b[a].markReferenced&&b[a].markReferenced()},g.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},g.prototype.outputRuleset=function(a,b,c){var d,e=c.length;if(a.tabLevel=(0|a.tabLevel)+1,a.compress){for(b.add("{"),d=0;d<e;d++)c[d].genCSS(a,b);return b.add("}"),void a.tabLevel--}var f="\n"+Array(a.tabLevel).join("  "),g=f+"  ";if(e){for(b.add(" {"+g),c[0].genCSS(a,b),d=1;d<e;d++)b.add(g),c[d].genCSS(a,b);b.add(f+"}")}else b.add(" {"+f+"}");a.tabLevel--},b.exports=g},{"./node":69,"./ruleset":75,"./selector":76}],57:[function(a,b,c){var d=a("./node"),e=a("./paren"),f=a("./combinator"),g=function(a,b,c,d){this.combinator=a instanceof f?a:new f(a),"string"==typeof b?this.value=b.trim():b?this.value=b:this.value="",this.index=c,this.currentFileInfo=d};g.prototype=new d,g.prototype.type="Element",g.prototype.accept=function(a){var b=this.value;this.combinator=a.visit(this.combinator),"object"==typeof b&&(this.value=a.visit(b))},g.prototype.eval=function(a){return new g(this.combinator,this.value.eval?this.value.eval(a):this.value,this.index,this.currentFileInfo)},g.prototype.genCSS=function(a,b){b.add(this.toCSS(a),this.currentFileInfo,this.index)},g.prototype.toCSS=function(a){a=a||{};var b=this.value,c=a.firstSelector;return b instanceof e&&(a.firstSelector=!0),b=b.toCSS?b.toCSS(a):b,a.firstSelector=c,""===b&&"&"===this.combinator.value.charAt(0)?"":this.combinator.toCSS(a)+b},b.exports=g},{"./combinator":50,"./node":69,"./paren":71}],58:[function(a,b,c){var d=a("./node"),e=a("./paren"),f=a("./comment"),g=function(a){if(this.value=a,!a)throw new Error("Expression requires an array parameter")};g.prototype=new d,g.prototype.type="Expression",g.prototype.accept=function(a){this.value=a.visitArray(this.value)},g.prototype.eval=function(a){var b,c=this.parens&&!this.parensInOp,d=!1;return c&&a.inParenthesis(),this.value.length>1?b=new g(this.value.map(function(b){return b.eval(a)})):1===this.value.length?(this.value[0].parens&&!this.value[0].parensInOp&&(d=!0),b=this.value[0].eval(a)):b=this,c&&a.outOfParenthesis(),this.parens&&this.parensInOp&&!a.isMathOn()&&!d&&(b=new e(b)),b},g.prototype.genCSS=function(a,b){for(var c=0;c<this.value.length;c++)this.value[c].genCSS(a,b),c+1<this.value.length&&b.add(" ")},g.prototype.throwAwayComments=function(){this.value=this.value.filter(function(a){return!(a instanceof f)})},g.prototype.markReferenced=function(){this.value.forEach(function(a){a.markReferenced&&a.markReferenced()})},b.exports=g},{"./comment":51,"./node":69,"./paren":71}],59:[function(a,b,c){var d=a("./node"),e=function a(b,c,d){switch(this.selector=b,this.option=c,this.index=d,this.object_id=a.next_id++,this.parent_ids=[this.object_id],c){case"all":this.allowBefore=!0,this.allowAfter=!0;break;default:this.allowBefore=!1,this.allowAfter=!1}};e.next_id=0,e.prototype=new d,e.prototype.type="Extend",e.prototype.accept=function(a){this.selector=a.visit(this.selector)},e.prototype.eval=function(a){return new e(this.selector.eval(a),this.option,this.index)},e.prototype.clone=function(a){return new e(this.selector,this.option,this.index)},e.prototype.findSelfSelectors=function(a){var b,c,d=[];for(b=0;b<a.length;b++)c=a[b].elements,b>0&&c.length&&""===c[0].combinator.value&&(c[0].combinator.value=" "),d=d.concat(a[b].elements);this.selfSelectors=[{elements:d}]},b.exports=e},{"./node":69}],60:[function(a,b,c){var d=a("./node"),e=a("./media"),f=a("./url"),g=a("./quoted"),h=a("./ruleset"),i=a("./anonymous"),j=function(a,b,c,d,e){if(this.options=c,this.index=d,this.path=a,this.features=b,this.currentFileInfo=e,void 0!==this.options.less||this.options.inline)this.css=!this.options.less||this.options.inline;else{var f=this.getPath();f&&/[#\.\&\?\/]css([\?;].*)?$/.test(f)&&(this.css=!0)}};j.prototype=new d,j.prototype.type="Import",j.prototype.accept=function(a){this.features&&(this.features=a.visit(this.features)),this.path=a.visit(this.path),this.options.plugin||this.options.inline||!this.root||(this.root=a.visit(this.root))},j.prototype.genCSS=function(a,b){this.css&&void 0===this.path.currentFileInfo.reference&&(b.add("@import ",this.currentFileInfo,this.index),this.path.genCSS(a,b),this.features&&(b.add(" "),this.features.genCSS(a,b)),b.add(";"))},j.prototype.getPath=function(){return this.path instanceof f?this.path.value.value:this.path.value},j.prototype.isVariableImport=function(){var a=this.path;return a instanceof f&&(a=a.value),!(a instanceof g)||a.containsVariables()},j.prototype.evalForImport=function(a){var b=this.path;return b instanceof f&&(b=b.value),new j(b.eval(a),this.features,this.options,this.index,this.currentFileInfo)},j.prototype.evalPath=function(a){var b=this.path.eval(a),c=this.currentFileInfo&&this.currentFileInfo.rootpath;if(!(b instanceof f)){if(c){var d=b.value;d&&a.isPathRelative(d)&&(b.value=c+d)}b.value=a.normalizePath(b.value)}return b},j.prototype.eval=function(a){var b,c,d=this.features&&this.features.eval(a);if(this.options.plugin)return c=a.frames[0]&&a.frames[0].functionRegistry,c&&this.root&&this.root.functions&&c.addMultiple(this.root.functions),[];if(this.skip&&("function"==typeof this.skip&&(this.skip=this.skip()),this.skip))return[];if(this.options.inline){var f=new i(this.root,0,{filename:this.importedFilename,reference:this.path.currentFileInfo&&this.path.currentFileInfo.reference},!0,!0,!1);return this.features?new e([f],this.features.value):[f]}if(this.css){var g=new j(this.evalPath(a),d,this.options,this.index);if(!g.css&&this.error)throw this.error;return g}return b=new h(null,this.root.rules.slice(0)),b.evalImports(a),this.features?new e(b.rules,this.features.value):b.rules},b.exports=j},{"./anonymous":45,"./media":65,"./node":69,"./quoted":72,"./ruleset":75,"./url":79}],61:[function(a,b,c){var d={};d.Node=a("./node"),d.Alpha=a("./alpha"),d.Color=a("./color"),d.Directive=a("./directive"),d.DetachedRuleset=a("./detached-ruleset"),d.Operation=a("./operation"),d.Dimension=a("./dimension"),d.Unit=a("./unit"),d.Keyword=a("./keyword"),d.Variable=a("./variable"),d.Ruleset=a("./ruleset"),d.Element=a("./element"),d.Attribute=a("./attribute"),d.Combinator=a("./combinator"),d.Selector=a("./selector"),d.Quoted=a("./quoted"),d.Expression=a("./expression"),d.Rule=a("./rule"),d.Call=a("./call"),d.URL=a("./url"),d.Import=a("./import"),d.mixin={Call:a("./mixin-call"),Definition:a("./mixin-definition")},d.Comment=a("./comment"),d.Anonymous=a("./anonymous"),d.Value=a("./value"),d.JavaScript=a("./javascript"),d.Assignment=a("./assignment"),d.Condition=a("./condition"),d.Paren=a("./paren"),d.Media=a("./media"),d.UnicodeDescriptor=a("./unicode-descriptor"),d.Negative=a("./negative"),d.Extend=a("./extend"),d.RulesetCall=a("./ruleset-call"),b.exports=d},{"./alpha":44,"./anonymous":45,"./assignment":46,"./attribute":47,"./call":48,"./color":49,"./combinator":50,"./comment":51,"./condition":52,"./detached-ruleset":54,"./dimension":55,"./directive":56,"./element":57,"./expression":58,"./extend":59,"./import":60,"./javascript":62,"./keyword":64,"./media":65,"./mixin-call":66,"./mixin-definition":67,"./negative":68,"./node":69,"./operation":70,"./paren":71,"./quoted":72,"./rule":73,"./ruleset":75,"./ruleset-call":74,"./selector":76,"./unicode-descriptor":77,"./unit":78,"./url":79,"./value":80,"./variable":81}],62:[function(a,b,c){var d=a("./js-eval-node"),e=a("./dimension"),f=a("./quoted"),g=a("./anonymous"),h=function(a,b,c,d){this.escaped=b,this.expression=a,this.index=c,this.currentFileInfo=d};h.prototype=new d,h.prototype.type="JavaScript",h.prototype.eval=function(a){var b=this.evaluateJavaScript(this.expression,a);return"number"==typeof b?new e(b):"string"==typeof b?new f('"'+b+'"',b,this.escaped,this.index):new g(Array.isArray(b)?b.join(", "):b)},b.exports=h},{"./anonymous":45,"./dimension":55,"./js-eval-node":63,"./quoted":72}],63:[function(a,b,c){var d=a("./node"),e=a("./variable"),f=function(){};f.prototype=new d,f.prototype.evaluateJavaScript=function(a,b){var c,d=this,f={};if(void 0!==b.javascriptEnabled&&!b.javascriptEnabled)throw{message:"You are using JavaScript, which has been disabled.",filename:this.currentFileInfo.filename,index:this.index};a=a.replace(/@\{([\w-]+)\}/g,function(a,c){return d.jsify(new e("@"+c,d.index,d.currentFileInfo).eval(b))});try{a=new Function("return ("+a+")")}catch(g){throw{message:"JavaScript evaluation error: "+g.message+" from `"+a+"`",filename:this.currentFileInfo.filename,index:this.index}}var h=b.frames[0].variables();for(var i in h)h.hasOwnProperty(i)&&(f[i.slice(1)]={value:h[i].value,toJS:function(){return this.value.eval(b).toCSS()}});try{c=a.call(f)}catch(g){throw{message:"JavaScript evaluation error: '"+g.name+": "+g.message.replace(/["]/g,"'")+"'",filename:this.currentFileInfo.filename,index:this.index}}return c},f.prototype.jsify=function(a){return Array.isArray(a.value)&&a.value.length>1?"["+a.value.map(function(a){return a.toCSS()}).join(", ")+"]":a.toCSS()},b.exports=f},{"./node":69,"./variable":81}],64:[function(a,b,c){var d=a("./node"),e=function(a){this.value=a};e.prototype=new d,e.prototype.type="Keyword",e.prototype.genCSS=function(a,b){if("%"===this.value)throw{type:"Syntax",message:"Invalid % without number"};b.add(this.value)},e.True=new e("true"),e.False=new e("false"),b.exports=e},{"./node":69}],65:[function(a,b,c){var d=a("./ruleset"),e=a("./value"),f=a("./selector"),g=a("./anonymous"),h=a("./expression"),i=a("./directive"),j=function(a,b,c,g){this.index=c,this.currentFileInfo=g;var h=new f([],null,null,this.index,this.currentFileInfo).createEmptySelectors();this.features=new e(b),this.rules=[new d(h,a)],this.rules[0].allowImports=!0};j.prototype=new i,j.prototype.type="Media",j.prototype.isRulesetLike=!0,j.prototype.accept=function(a){this.features&&(this.features=a.visit(this.features)),this.rules&&(this.rules=a.visitArray(this.rules))},j.prototype.genCSS=function(a,b){b.add("@media ",this.currentFileInfo,this.index),this.features.genCSS(a,b),this.outputRuleset(a,b,this.rules)},j.prototype.eval=function(a){a.mediaBlocks||(a.mediaBlocks=[],a.mediaPath=[]);var b=new j(null,[],this.index,this.currentFileInfo);this.debugInfo&&(this.rules[0].debugInfo=this.debugInfo,b.debugInfo=this.debugInfo);var c=!1;a.strictMath||(c=!0,a.strictMath=!0);try{b.features=this.features.eval(a)}finally{c&&(a.strictMath=!1)}return a.mediaPath.push(b),a.mediaBlocks.push(b),this.rules[0].functionRegistry=a.frames[0].functionRegistry.inherit(),a.frames.unshift(this.rules[0]),b.rules=[this.rules[0].eval(a)],a.frames.shift(),a.mediaPath.pop(),0===a.mediaPath.length?b.evalTop(a):b.evalNested(a)},j.prototype.evalTop=function(a){var b=this;if(a.mediaBlocks.length>1){var c=new f([],null,null,this.index,this.currentFileInfo).createEmptySelectors();b=new d(c,a.mediaBlocks),b.multiMedia=!0}return delete a.mediaBlocks,delete a.mediaPath,b},j.prototype.evalNested=function(a){var b,c,f=a.mediaPath.concat([this]);for(b=0;b<f.length;b++)c=f[b].features instanceof e?f[b].features.value:f[b].features,f[b]=Array.isArray(c)?c:[c];return this.features=new e(this.permute(f).map(function(a){for(a=a.map(function(a){return a.toCSS?a:new g(a)}),b=a.length-1;b>0;b--)a.splice(b,0,new g("and"));return new h(a)})),new d([],[])},j.prototype.permute=function(a){if(0===a.length)return[];if(1===a.length)return a[0];for(var b=[],c=this.permute(a.slice(1)),d=0;d<c.length;d++)for(var e=0;e<a[0].length;e++)b.push([a[0][e]].concat(c[d]));return b},j.prototype.bubbleSelectors=function(a){a&&(this.rules=[new d(a.slice(0),[this.rules[0]])])},b.exports=j},{"./anonymous":45,"./directive":56,"./expression":58,"./ruleset":75,"./selector":76,"./value":80}],66:[function(a,b,c){var d=a("./node"),e=a("./selector"),f=a("./mixin-definition"),g=a("../functions/default"),h=function(a,b,c,d,f){this.selector=new e(a),this.arguments=b||[],this.index=c,this.currentFileInfo=d,this.important=f};h.prototype=new d,h.prototype.type="MixinCall",h.prototype.accept=function(a){this.selector&&(this.selector=a.visit(this.selector)),this.arguments.length&&(this.arguments=a.visitArray(this.arguments))},h.prototype.eval=function(a){function b(b,c){var d,e,f;for(d=0;d<2;d++){for(y[d]=!0,g.value(d),e=0;e<c.length&&y[d];e++)f=c[e],f.matchCondition&&(y[d]=y[d]&&f.matchCondition(null,a));b.matchCondition&&(y[d]=y[d]&&b.matchCondition(u,a))}return y[0]||y[1]?y[0]!=y[1]?y[1]?B:C:A:z}var c,d,e,h,i,j,k,l,m,n,o,p,q,r,s,t,u=[],v=[],w=!1,x=[],y=[],z=-1,A=0,B=1,C=2;for(k=0;k<this.arguments.length;k++)if(h=this.arguments[k],i=h.value.eval(a),h.expand&&Array.isArray(i.value))for(i=i.value,l=0;l<i.length;l++)u.push({value:i[l]});else u.push({name:h.name,value:i});for(t=function(b){return b.matchArgs(null,a)},k=0;k<a.frames.length;k++)if((c=a.frames[k].find(this.selector,null,t)).length>0){for(o=!0,l=0;l<c.length;l++){for(d=c[l].rule,e=c[l].path,n=!1,m=0;m<a.frames.length;m++)if(!(d instanceof f)&&d===(a.frames[m].originalRuleset||a.frames[m])){n=!0;break}n||d.matchArgs(u,a)&&(p={mixin:d,group:b(d,e)},p.group!==z&&x.push(p),w=!0)}for(g.reset(),r=[0,0,0],l=0;l<x.length;l++)r[x[l].group]++;if(r[A]>0)q=C;else if(q=B,r[B]+r[C]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(u)+"`",index:this.index,filename:this.currentFileInfo.filename};for(l=0;l<x.length;l++)if(p=x[l].group,p===A||p===q)try{d=x[l].mixin,d instanceof f||(s=d.originalRuleset||d,d=new f("",[],d.rules,null,!1),d.originalRuleset=s),Array.prototype.push.apply(v,d.evalCall(a,u,this.important).rules)}catch(D){throw{message:D.message,index:this.index,filename:this.currentFileInfo.filename,stack:D.stack}}if(w){if(!this.currentFileInfo||!this.currentFileInfo.reference)for(k=0;k<v.length;k++)j=v[k],j.markReferenced&&j.markReferenced();return v}}throw o?{type:"Runtime",message:"No matching definition was found for `"+this.format(u)+"`",index:this.index,filename:this.currentFileInfo.filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.index,filename:this.currentFileInfo.filename}},h.prototype.format=function(a){return this.selector.toCSS().trim()+"("+(a?a.map(function(a){var b="";return a.name&&(b+=a.name+":"),b+=a.value.toCSS?a.value.toCSS():"???"}).join(", "):"")+")"},b.exports=h},{"../functions/default":19,"./mixin-definition":67,"./node":69,"./selector":76}],67:[function(a,b,c){var d=a("./selector"),e=a("./element"),f=a("./ruleset"),g=a("./rule"),h=a("./expression"),i=a("../contexts"),j=function(a,b,c,f,g,h){this.name=a,this.selectors=[new d([new e(null,a,this.index,this.currentFileInfo)])],this.params=b,this.condition=f,this.variadic=g,this.arity=b.length,this.rules=c,this._lookups={};var i=[];this.required=b.reduce(function(a,b){return!b.name||b.name&&!b.value?a+1:(i.push(b.name),a)},0),this.optionalParameters=i,this.frames=h};j.prototype=new f,j.prototype.type="MixinDefinition",j.prototype.evalFirst=!0,j.prototype.accept=function(a){this.params&&this.params.length&&(this.params=a.visitArray(this.params)),this.rules=a.visitArray(this.rules),this.condition&&(this.condition=a.visit(this.condition))},j.prototype.evalParams=function(a,b,c,d){var e,j,k,l,m,n,o,p,q=new f(null,null),r=this.params.slice(0),s=0;if(b.frames&&b.frames[0]&&b.frames[0].functionRegistry&&(q.functionRegistry=b.frames[0].functionRegistry.inherit()),b=new i.Eval(b,[q].concat(b.frames)),c)for(c=c.slice(0),s=c.length,k=0;k<s;k++)if(j=c[k],n=j&&j.name){for(o=!1,l=0;l<r.length;l++)if(!d[l]&&n===r[l].name){d[l]=j.value.eval(a),q.prependRule(new g(n,j.value.eval(a))),o=!0;break}if(o){c.splice(k,1),k--;continue}throw{type:"Runtime",message:"Named argument for "+this.name+" "+c[k].name+" not found"}}for(p=0,k=0;k<r.length;k++)if(!d[k]){if(j=c&&c[p],n=r[k].name)if(r[k].variadic){for(e=[],l=p;l<s;l++)e.push(c[l].value.eval(a));q.prependRule(new g(n,new h(e).eval(a)))}else{if(m=j&&j.value)m=m.eval(a);else{if(!r[k].value)throw{type:"Runtime",message:"wrong number of arguments for "+this.name+" ("+s+" for "+this.arity+")"};m=r[k].value.eval(b),q.resetCache()}q.prependRule(new g(n,m)),
d[k]=m}if(r[k].variadic&&c)for(l=p;l<s;l++)d[l]=c[l].value.eval(a);p++}return q},j.prototype.makeImportant=function(){var a=this.rules?this.rules.map(function(a){return a.makeImportant?a.makeImportant(!0):a}):this.rules,b=new j(this.name,this.params,a,this.condition,this.variadic,this.frames);return b},j.prototype.eval=function(a){return new j(this.name,this.params,this.rules,this.condition,this.variadic,this.frames||a.frames.slice(0))},j.prototype.evalCall=function(a,b,c){var d,e,j=[],k=this.frames?this.frames.concat(a.frames):a.frames,l=this.evalParams(a,new i.Eval(a,k),b,j);return l.prependRule(new g("@arguments",new h(j).eval(a))),d=this.rules.slice(0),e=new f(null,d),e.originalRuleset=this,e=e.eval(new i.Eval(a,[this,l].concat(k))),c&&(e=e.makeImportant()),e},j.prototype.matchCondition=function(a,b){return!(this.condition&&!this.condition.eval(new i.Eval(b,[this.evalParams(b,new i.Eval(b,this.frames?this.frames.concat(b.frames):b.frames),a,[])].concat(this.frames||[]).concat(b.frames))))},j.prototype.matchArgs=function(a,b){var c,d=a&&a.length||0,e=this.optionalParameters,f=a?a.reduce(function(a,b){return e.indexOf(b.name)<0?a+1:a},0):0;if(this.variadic){if(f<this.required-1)return!1}else{if(f<this.required)return!1;if(d>this.params.length)return!1}c=Math.min(f,this.arity);for(var g=0;g<c;g++)if(!this.params[g].name&&!this.params[g].variadic&&a[g].value.eval(b).toCSS()!=this.params[g].value.eval(b).toCSS())return!1;return!0},b.exports=j},{"../contexts":10,"./element":57,"./expression":58,"./rule":73,"./ruleset":75,"./selector":76}],68:[function(a,b,c){var d=a("./node"),e=a("./operation"),f=a("./dimension"),g=function(a){this.value=a};g.prototype=new d,g.prototype.type="Negative",g.prototype.genCSS=function(a,b){b.add("-"),this.value.genCSS(a,b)},g.prototype.eval=function(a){return a.isMathOn()?new e("*",[new f(-1),this.value]).eval(a):new g(this.value.eval(a))},b.exports=g},{"./dimension":55,"./node":69,"./operation":70}],69:[function(a,b,c){var d=function(){};d.prototype.toCSS=function(a){var b=[];return this.genCSS(a,{add:function(a,c,d){b.push(a)},isEmpty:function(){return 0===b.length}}),b.join("")},d.prototype.genCSS=function(a,b){b.add(this.value)},d.prototype.accept=function(a){this.value=a.visit(this.value)},d.prototype.eval=function(){return this},d.prototype._operate=function(a,b,c,d){switch(b){case"+":return c+d;case"-":return c-d;case"*":return c*d;case"/":return c/d}},d.prototype.fround=function(a,b){var c=a&&a.numPrecision;return null==c?b:Number((b+2e-16).toFixed(c))},d.compare=function(a,b){if(a.compare&&"Quoted"!==b.type&&"Anonymous"!==b.type)return a.compare(b);if(b.compare)return-b.compare(a);if(a.type===b.type){if(a=a.value,b=b.value,!Array.isArray(a))return a===b?0:void 0;if(a.length===b.length){for(var c=0;c<a.length;c++)if(0!==d.compare(a[c],b[c]))return;return 0}}},d.numericCompare=function(a,b){return a<b?-1:a===b?0:a>b?1:void 0},b.exports=d},{}],70:[function(a,b,c){var d=a("./node"),e=a("./color"),f=a("./dimension"),g=function(a,b,c){this.op=a.trim(),this.operands=b,this.isSpaced=c};g.prototype=new d,g.prototype.type="Operation",g.prototype.accept=function(a){this.operands=a.visit(this.operands)},g.prototype.eval=function(a){var b=this.operands[0].eval(a),c=this.operands[1].eval(a);if(a.isMathOn()){if(b instanceof f&&c instanceof e&&(b=b.toColor()),c instanceof f&&b instanceof e&&(c=c.toColor()),!b.operate)throw{type:"Operation",message:"Operation on an invalid type"};return b.operate(a,this.op,c)}return new g(this.op,[b,c],this.isSpaced)},g.prototype.genCSS=function(a,b){this.operands[0].genCSS(a,b),this.isSpaced&&b.add(" "),b.add(this.op),this.isSpaced&&b.add(" "),this.operands[1].genCSS(a,b)},b.exports=g},{"./color":49,"./dimension":55,"./node":69}],71:[function(a,b,c){var d=a("./node"),e=function(a){this.value=a};e.prototype=new d,e.prototype.type="Paren",e.prototype.genCSS=function(a,b){b.add("("),this.value.genCSS(a,b),b.add(")")},e.prototype.eval=function(a){return new e(this.value.eval(a))},b.exports=e},{"./node":69}],72:[function(a,b,c){var d=a("./node"),e=a("./js-eval-node"),f=a("./variable"),g=function(a,b,c,d,e){this.escaped=null==c||c,this.value=b||"",this.quote=a.charAt(0),this.index=d,this.currentFileInfo=e};g.prototype=new e,g.prototype.type="Quoted",g.prototype.genCSS=function(a,b){this.escaped||b.add(this.quote,this.currentFileInfo,this.index),b.add(this.value),this.escaped||b.add(this.quote)},g.prototype.containsVariables=function(){return this.value.match(/(`([^`]+)`)|@\{([\w-]+)\}/)},g.prototype.eval=function(a){function b(a,b,c){var d=a;do a=d,d=a.replace(b,c);while(a!==d);return d}var c=this,d=this.value,e=function(b,d){return String(c.evaluateJavaScript(d,a))},h=function(b,d){var e=new f("@"+d,c.index,c.currentFileInfo).eval(a,!0);return e instanceof g?e.value:e.toCSS()};return d=b(d,/`([^`]+)`/g,e),d=b(d,/@\{([\w-]+)\}/g,h),new g(this.quote+d+this.quote,d,this.escaped,this.index,this.currentFileInfo)},g.prototype.compare=function(a){return"Quoted"!==a.type||this.escaped||a.escaped?a.toCSS&&this.toCSS()===a.toCSS()?0:void 0:d.numericCompare(this.value,a.value)},b.exports=g},{"./js-eval-node":63,"./node":69,"./variable":81}],73:[function(a,b,c){function d(a,b){var c,d="",e=b.length,f={add:function(a){d+=a}};for(c=0;c<e;c++)b[c].eval(a).genCSS(a,f);return d}var e=a("./node"),f=a("./value"),g=a("./keyword"),h=function(a,b,c,d,g,h,i,j){this.name=a,this.value=b instanceof e?b:new f([b]),this.important=c?" "+c.trim():"",this.merge=d,this.index=g,this.currentFileInfo=h,this.inline=i||!1,this.variable=void 0!==j?j:a.charAt&&"@"===a.charAt(0)};h.prototype=new e,h.prototype.type="Rule",h.prototype.genCSS=function(a,b){b.add(this.name+(a.compress?":":": "),this.currentFileInfo,this.index);try{this.value.genCSS(a,b)}catch(c){throw c.index=this.index,c.filename=this.currentFileInfo.filename,c}b.add(this.important+(this.inline||a.lastRule&&a.compress?"":";"),this.currentFileInfo,this.index)},h.prototype.eval=function(a){var b,c=!1,e=this.name,f=this.variable;"string"!=typeof e&&(e=1===e.length&&e[0]instanceof g?e[0].value:d(a,e),f=!1),"font"!==e||a.strictMath||(c=!0,a.strictMath=!0);try{if(a.importantScope.push({}),b=this.value.eval(a),!this.variable&&"DetachedRuleset"===b.type)throw{message:"Rulesets cannot be evaluated on a property.",index:this.index,filename:this.currentFileInfo.filename};var i=this.important,j=a.importantScope.pop();return!i&&j.important&&(i=j.important),new h(e,b,i,this.merge,this.index,this.currentFileInfo,this.inline,f)}catch(k){throw"number"!=typeof k.index&&(k.index=this.index,k.filename=this.currentFileInfo.filename),k}finally{c&&(a.strictMath=!1)}},h.prototype.makeImportant=function(){return new h(this.name,this.value,"!important",this.merge,this.index,this.currentFileInfo,this.inline)};var i=function(a){Array.isArray(a)?a.forEach(function(a){i(a)}):a.markReferenced&&a.markReferenced()};h.prototype.markReferenced=function(){this.value&&i(this.value)},b.exports=h},{"./keyword":64,"./node":69,"./value":80}],74:[function(a,b,c){var d=a("./node"),e=a("./variable"),f=function(a){this.variable=a};f.prototype=new d,f.prototype.type="RulesetCall",f.prototype.eval=function(a){var b=new e(this.variable).eval(a);return b.callEval(a)},b.exports=f},{"./node":69,"./variable":81}],75:[function(a,b,c){var d=a("./node"),e=a("./rule"),f=a("./selector"),g=a("./element"),h=a("./paren"),i=a("../contexts"),j=a("../functions/function-registry"),k=a("../functions/default"),l=a("./debug-info"),m=function(a,b,c){this.selectors=a,this.rules=b,this._lookups={},this.strictImports=c};m.prototype=new d,m.prototype.type="Ruleset",m.prototype.isRuleset=!0,m.prototype.isRulesetLike=!0,m.prototype.accept=function(a){this.paths?a.visitArray(this.paths,!0):this.selectors&&(this.selectors=a.visitArray(this.selectors)),this.rules&&this.rules.length&&(this.rules=a.visitArray(this.rules))},m.prototype.eval=function(a){var b,c,d,f,g=this.selectors,h=!1;if(g&&(c=g.length)){for(b=[],k.error({type:"Syntax",message:"it is currently only allowed in parametric mixin guards,"}),f=0;f<c;f++)d=g[f].eval(a),b.push(d),d.evaldCondition&&(h=!0);k.reset()}else h=!0;var i,l,n=this.rules?this.rules.slice(0):null,o=new m(b,n,this.strictImports);o.originalRuleset=this,o.root=this.root,o.firstRoot=this.firstRoot,o.allowImports=this.allowImports,this.debugInfo&&(o.debugInfo=this.debugInfo),h||(n.length=0),o.functionRegistry=function(a){for(var b,c=0,d=a.length;c!==d;++c)if(b=a[c].functionRegistry)return b;return j}(a.frames).inherit();var p=a.frames;p.unshift(o);var q=a.selectors;q||(a.selectors=q=[]),q.unshift(this.selectors),(o.root||o.allowImports||!o.strictImports)&&o.evalImports(a);var r=o.rules,s=r?r.length:0;for(f=0;f<s;f++)r[f].evalFirst&&(r[f]=r[f].eval(a));var t=a.mediaBlocks&&a.mediaBlocks.length||0;for(f=0;f<s;f++)"MixinCall"===r[f].type?(n=r[f].eval(a).filter(function(a){return!(a instanceof e&&a.variable)||!o.variable(a.name)}),r.splice.apply(r,[f,1].concat(n)),s+=n.length-1,f+=n.length-1,o.resetCache()):"RulesetCall"===r[f].type&&(n=r[f].eval(a).rules.filter(function(a){return!(a instanceof e&&a.variable)}),r.splice.apply(r,[f,1].concat(n)),s+=n.length-1,f+=n.length-1,o.resetCache());for(f=0;f<r.length;f++)i=r[f],i.evalFirst||(r[f]=i=i.eval?i.eval(a):i);for(f=0;f<r.length;f++)if(i=r[f],i instanceof m&&i.selectors&&1===i.selectors.length&&i.selectors[0].isJustParentSelector()){r.splice(f--,1);for(var u=0;u<i.rules.length;u++)l=i.rules[u],l instanceof e&&l.variable||r.splice(++f,0,l)}if(p.shift(),q.shift(),a.mediaBlocks)for(f=t;f<a.mediaBlocks.length;f++)a.mediaBlocks[f].bubbleSelectors(b);return o},m.prototype.evalImports=function(a){var b,c,d=this.rules;if(d)for(b=0;b<d.length;b++)"Import"===d[b].type&&(c=d[b].eval(a),c&&c.length?(d.splice.apply(d,[b,1].concat(c)),b+=c.length-1):d.splice(b,1,c),this.resetCache())},m.prototype.makeImportant=function(){var a=new m(this.selectors,this.rules.map(function(a){return a.makeImportant?a.makeImportant():a}),this.strictImports);return a},m.prototype.matchArgs=function(a){return!a||0===a.length},m.prototype.matchCondition=function(a,b){var c=this.selectors[this.selectors.length-1];return!!c.evaldCondition&&!(c.condition&&!c.condition.eval(new i.Eval(b,b.frames)))},m.prototype.resetCache=function(){this._rulesets=null,this._variables=null,this._lookups={}},m.prototype.variables=function(){return this._variables||(this._variables=this.rules?this.rules.reduce(function(a,b){if(b instanceof e&&b.variable===!0&&(a[b.name]=b),"Import"===b.type&&b.root&&b.root.variables){var c=b.root.variables();for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},{}):{}),this._variables},m.prototype.variable=function(a){return this.variables()[a]},m.prototype.rulesets=function(){if(!this.rules)return[];var a,b,c=[],d=this.rules,e=d.length;for(a=0;a<e;a++)b=d[a],b.isRuleset&&c.push(b);return c},m.prototype.prependRule=function(a){var b=this.rules;b?b.unshift(a):this.rules=[a]},m.prototype.find=function(a,b,c){b=b||this;var d,e,g=[],h=a.toCSS();return h in this._lookups?this._lookups[h]:(this.rulesets().forEach(function(h){if(h!==b)for(var i=0;i<h.selectors.length;i++)if(d=a.match(h.selectors[i])){if(a.elements.length>d){if(!c||c(h)){e=h.find(new f(a.elements.slice(d)),b,c);for(var j=0;j<e.length;++j)e[j].path.push(h);Array.prototype.push.apply(g,e)}}else g.push({rule:h,path:[]});break}}),this._lookups[h]=g,g)},m.prototype.genCSS=function(a,b){function c(a){return"boolean"==typeof a.isRulesetLike?a.isRulesetLike:"function"==typeof a.isRulesetLike&&a.isRulesetLike()}var d,e,f,g,h,i=[],j=[];a.tabLevel=a.tabLevel||0,this.root||a.tabLevel++;var k,m=a.compress?"":Array(a.tabLevel+1).join("  "),n=a.compress?"":Array(a.tabLevel).join("  "),o=0,p=0;for(d=0;d<this.rules.length;d++)g=this.rules[d],"Comment"===g.type?(p===d&&p++,j.push(g)):g.isCharset&&g.isCharset()?(j.splice(o,0,g),o++,p++):"Import"===g.type?(j.splice(p,0,g),p++):j.push(g);if(j=i.concat(j),!this.root){f=l(a,this,n),f&&(b.add(f),b.add(n));var q,r=this.paths,s=r.length;for(k=a.compress?",":",\n"+n,d=0;d<s;d++)if(h=r[d],q=h.length)for(d>0&&b.add(k),a.firstSelector=!0,h[0].genCSS(a,b),a.firstSelector=!1,e=1;e<q;e++)h[e].genCSS(a,b);b.add((a.compress?"{":" {\n")+m)}for(d=0;d<j.length;d++){g=j[d],d+1===j.length&&(a.lastRule=!0);var t=a.lastRule;c(g)&&(a.lastRule=!1),g.genCSS?g.genCSS(a,b):g.value&&b.add(g.value.toString()),a.lastRule=t,a.lastRule?a.lastRule=!1:b.add(a.compress?"":"\n"+m)}this.root||(b.add(a.compress?"}":"\n"+n+"}"),a.tabLevel--),b.isEmpty()||a.compress||!this.firstRoot||b.add("\n")},m.prototype.markReferenced=function(){var a;if(this.selectors)for(a=0;a<this.selectors.length;a++)this.selectors[a].markReferenced();if(this.rules)for(a=0;a<this.rules.length;a++)this.rules[a].markReferenced&&this.rules[a].markReferenced()},m.prototype.getIsReferenced=function(){var a,b,c,d;if(this.paths)for(a=0;a<this.paths.length;a++)for(c=this.paths[a],b=0;b<c.length;b++)if(c[b].getIsReferenced&&c[b].getIsReferenced())return!0;if(this.selectors)for(a=0;a<this.selectors.length;a++)if(d=this.selectors[a],d.getIsReferenced&&d.getIsReferenced())return!0;return!1},m.prototype.joinSelectors=function(a,b,c){for(var d=0;d<c.length;d++)this.joinSelector(a,b,c[d])},m.prototype.joinSelector=function(a,b,c){function d(a,b){var c,d;if(0===a.length)c=new h(a[0]);else{var e=[];for(d=0;d<a.length;d++)e.push(new g(null,a[d],b.index,b.currentFileInfo));c=new h(new f(e))}return c}function e(a,b){var c,d;return c=new g(null,a,b.index,b.currentFileInfo),d=new f([c])}function i(a,b,c){function f(a){var b;return"Paren"!==a.value.type?null:(b=a.value.value,"Selector"!==b.type?null:b)}var h,m,n,o,p,q,r,s,t,u,v=!1;for(o=[],p=[[]],h=0;h<c.elements.length;h++)if(s=c.elements[h],"&"!==s.value){var w=f(s);if(null!=w){l(o,p);var x,y=[],z=[];for(x=i(y,b,w),v=v||x,n=0;n<y.length;n++){var A=e(d(y[n],s),s);k(p,[A],s,c,z)}p=z,o=[]}else o.push(s)}else{for(v=!0,q=[],l(o,p),m=0;m<p.length;m++)if(r=p[m],0===b.length)r.length>0&&r[0].elements.push(new g(s.combinator,"",s.index,s.currentFileInfo)),q.push(r);else for(n=0;n<b.length;n++){var B=j(r,b[n],s,c);q.push(B)}p=q,o=[]}for(l(o,p),h=0;h<p.length;h++)t=p[h].length,t>0&&(a.push(p[h]),u=p[h][t-1],p[h][t-1]=u.createDerived(u.elements,c.extendList));return v}function j(a,b,c,d){var e,f,h;if(e=[],a.length>0?(e=a.slice(0),f=e.pop(),h=d.createDerived(f.elements.slice(0))):h=d.createDerived([]),b.length>0){var i=c.combinator,j=b[0].elements[0];i.emptyOrWhitespace&&!j.combinator.emptyOrWhitespace&&(i=j.combinator),h.elements.push(new g(i,j.value,c.index,c.currentFileInfo)),h.elements=h.elements.concat(b[0].elements.slice(1))}return 0!==h.elements.length&&e.push(h),b.length>1&&(e=e.concat(b.slice(1))),e}function k(a,b,c,d,e){var f;for(f=0;f<a.length;f++){var g=j(a[f],b,c,d);e.push(g)}return e}function l(a,b){var c,d;if(0!==a.length){if(0===b.length)return void b.push([new f(a)]);for(c=0;c<b.length;c++)d=b[c],d.length>0?d[d.length-1]=d[d.length-1].createDerived(d[d.length-1].elements.concat(a)):d.push(new f(a))}}var m,n,o;if(n=[],o=i(n,b,c),!o)if(b.length>0)for(n=[],m=0;m<b.length;m++)n.push(b[m].concat(c));else n=[[c]];for(m=0;m<n.length;m++)a.push(n[m])},b.exports=m},{"../contexts":10,"../functions/default":19,"../functions/function-registry":21,"./debug-info":53,"./element":57,"./node":69,"./paren":71,"./rule":73,"./selector":76}],76:[function(a,b,c){var d=a("./node"),e=a("./element"),f=function(a,b,c,d,e,f){this.elements=a,this.extendList=b,this.condition=c,this.currentFileInfo=e||{},this.isReferenced=f,c||(this.evaldCondition=!0)};f.prototype=new d,f.prototype.type="Selector",f.prototype.accept=function(a){this.elements&&(this.elements=a.visitArray(this.elements)),this.extendList&&(this.extendList=a.visitArray(this.extendList)),this.condition&&(this.condition=a.visit(this.condition))},f.prototype.createDerived=function(a,b,c){c=null!=c?c:this.evaldCondition;var d=new f(a,b||this.extendList,null,this.index,this.currentFileInfo,this.isReferenced);return d.evaldCondition=c,d.mediaEmpty=this.mediaEmpty,d},f.prototype.createEmptySelectors=function(){var a=new e("","&",this.index,this.currentFileInfo),b=[new f([a],null,null,this.index,this.currentFileInfo)];return b[0].mediaEmpty=!0,b},f.prototype.match=function(a){var b,c,d=this.elements,e=d.length;if(a.CacheElements(),b=a._elements.length,0===b||e<b)return 0;for(c=0;c<b;c++)if(d[c].value!==a._elements[c])return 0;return b},f.prototype.CacheElements=function(){if(!this._elements){var a=this.elements.map(function(a){return a.combinator.value+(a.value.value||a.value)}).join("").match(/[,&#\*\.\w-]([\w-]|(\\.))*/g);a?"&"===a[0]&&a.shift():a=[],this._elements=a}},f.prototype.isJustParentSelector=function(){return!this.mediaEmpty&&1===this.elements.length&&"&"===this.elements[0].value&&(" "===this.elements[0].combinator.value||""===this.elements[0].combinator.value)},f.prototype.eval=function(a){var b=this.condition&&this.condition.eval(a),c=this.elements,d=this.extendList;return c=c&&c.map(function(b){return b.eval(a)}),d=d&&d.map(function(b){return b.eval(a)}),this.createDerived(c,d,b)},f.prototype.genCSS=function(a,b){var c,d;if(a&&a.firstSelector||""!==this.elements[0].combinator.value||b.add(" ",this.currentFileInfo,this.index),!this._css)for(c=0;c<this.elements.length;c++)d=this.elements[c],d.genCSS(a,b)},f.prototype.markReferenced=function(){this.isReferenced=!0},f.prototype.getIsReferenced=function(){return!this.currentFileInfo.reference||this.isReferenced},f.prototype.getIsOutput=function(){return this.evaldCondition},b.exports=f},{"./element":57,"./node":69}],77:[function(a,b,c){var d=a("./node"),e=function(a){this.value=a};e.prototype=new d,e.prototype.type="UnicodeDescriptor",b.exports=e},{"./node":69}],78:[function(a,b,c){var d=a("./node"),e=a("../data/unit-conversions"),f=function(a,b,c){this.numerator=a?a.slice(0).sort():[],this.denominator=b?b.slice(0).sort():[],c?this.backupUnit=c:a&&a.length&&(this.backupUnit=a[0])};f.prototype=new d,f.prototype.type="Unit",f.prototype.clone=function(){return new f(this.numerator.slice(0),this.denominator.slice(0),this.backupUnit)},f.prototype.genCSS=function(a,b){var c=a&&a.strictUnits;1===this.numerator.length?b.add(this.numerator[0]):!c&&this.backupUnit?b.add(this.backupUnit):!c&&this.denominator.length&&b.add(this.denominator[0])},f.prototype.toString=function(){var a,b=this.numerator.join("*");for(a=0;a<this.denominator.length;a++)b+="/"+this.denominator[a];return b},f.prototype.compare=function(a){return this.is(a.toString())?0:void 0},f.prototype.is=function(a){return this.toString().toUpperCase()===a.toUpperCase()},f.prototype.isLength=function(){return Boolean(this.toCSS().match(/px|em|%|in|cm|mm|pc|pt|ex/))},f.prototype.isEmpty=function(){return 0===this.numerator.length&&0===this.denominator.length},f.prototype.isSingular=function(){return this.numerator.length<=1&&0===this.denominator.length},f.prototype.map=function(a){var b;for(b=0;b<this.numerator.length;b++)this.numerator[b]=a(this.numerator[b],!1);for(b=0;b<this.denominator.length;b++)this.denominator[b]=a(this.denominator[b],!0)},f.prototype.usedUnits=function(){var a,b,c={};b=function(b){return a.hasOwnProperty(b)&&!c[d]&&(c[d]=b),b};for(var d in e)e.hasOwnProperty(d)&&(a=e[d],this.map(b));return c},f.prototype.cancel=function(){var a,b,c={};for(b=0;b<this.numerator.length;b++)a=this.numerator[b],c[a]=(c[a]||0)+1;for(b=0;b<this.denominator.length;b++)a=this.denominator[b],c[a]=(c[a]||0)-1;this.numerator=[],this.denominator=[];for(a in c)if(c.hasOwnProperty(a)){var d=c[a];if(d>0)for(b=0;b<d;b++)this.numerator.push(a);else if(d<0)for(b=0;b<-d;b++)this.denominator.push(a)}this.numerator.sort(),this.denominator.sort()},b.exports=f},{"../data/unit-conversions":13,"./node":69}],79:[function(a,b,c){var d=a("./node"),e=function(a,b,c,d){this.value=a,this.currentFileInfo=c,this.index=b,this.isEvald=d};e.prototype=new d,e.prototype.type="Url",e.prototype.accept=function(a){this.value=a.visit(this.value)},e.prototype.genCSS=function(a,b){b.add("url("),this.value.genCSS(a,b),b.add(")")},e.prototype.eval=function(a){var b,c=this.value.eval(a);if(!this.isEvald&&(b=this.currentFileInfo&&this.currentFileInfo.rootpath,b&&"string"==typeof c.value&&a.isPathRelative(c.value)&&(c.quote||(b=b.replace(/[\(\)'"\s]/g,function(a){return"\\"+a})),c.value=b+c.value),c.value=a.normalizePath(c.value),a.urlArgs&&!c.value.match(/^\s*data:/))){var d=c.value.indexOf("?")===-1?"?":"&",f=d+a.urlArgs;c.value.indexOf("#")!==-1?c.value=c.value.replace("#",f+"#"):c.value+=f}return new e(c,this.index,this.currentFileInfo,!0)},b.exports=e},{"./node":69}],80:[function(a,b,c){var d=a("./node"),e=function(a){if(this.value=a,!a)throw new Error("Value requires an array argument")};e.prototype=new d,e.prototype.type="Value",e.prototype.accept=function(a){this.value&&(this.value=a.visitArray(this.value))},e.prototype.eval=function(a){return 1===this.value.length?this.value[0].eval(a):new e(this.value.map(function(b){return b.eval(a)}))},e.prototype.genCSS=function(a,b){var c;for(c=0;c<this.value.length;c++)this.value[c].genCSS(a,b),c+1<this.value.length&&b.add(a&&a.compress?",":", ")},b.exports=e},{"./node":69}],81:[function(a,b,c){var d=a("./node"),e=function(a,b,c){this.name=a,this.index=b,this.currentFileInfo=c||{}};e.prototype=new d,e.prototype.type="Variable",e.prototype.eval=function(a){var b,c=this.name;if(0===c.indexOf("@@")&&(c="@"+new e(c.slice(1),this.index,this.currentFileInfo).eval(a).value),this.evaluating)throw{type:"Name",message:"Recursive variable definition for "+c,filename:this.currentFileInfo.filename,index:this.index};if(this.evaluating=!0,b=this.find(a.frames,function(b){var d=b.variable(c);if(d){if(d.important){var e=a.importantScope[a.importantScope.length-1];e.important=d.important}return d.value.eval(a)}}))return this.evaluating=!1,b;throw{type:"Name",message:"variable "+c+" is undefined",filename:this.currentFileInfo.filename,index:this.index}},e.prototype.find=function(a,b){for(var c,d=0;d<a.length;d++)if(c=b.call(a,a[d]))return c;return null},b.exports=e},{"./node":69}],82:[function(a,b,c){b.exports={getLocation:function(a,b){for(var c=a+1,d=null,e=-1;--c>=0&&"\n"!==b.charAt(c);)e++;return"number"==typeof a&&(d=(b.slice(0,a).match(/\n/g)||"").length),{line:d,column:e}}}},{}],83:[function(a,b,c){var d=a("../tree"),e=a("./visitor"),f=a("../logger"),g=function(){this._visitor=new e(this),this.contexts=[],this.allExtendsStack=[[]]};g.prototype={run:function(a){return a=this._visitor.visit(a),a.allExtends=this.allExtendsStack[0],a},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitRuleset:function(a,b){if(!a.root){var c,e,f,g,h=[],i=a.rules,j=i?i.length:0;for(c=0;c<j;c++)a.rules[c]instanceof d.Extend&&(h.push(i[c]),a.extendOnEveryPath=!0);var k=a.paths;for(c=0;c<k.length;c++){var l=k[c],m=l[l.length-1],n=m.extendList;for(g=n?n.slice(0).concat(h):h,g&&(g=g.map(function(a){return a.clone()})),e=0;e<g.length;e++)this.foundExtends=!0,f=g[e],f.findSelfSelectors(l),f.ruleset=a,0===e&&(f.firstExtendOnThisSelectorPath=!0),this.allExtendsStack[this.allExtendsStack.length-1].push(f)}this.contexts.push(a.selectors)}},visitRulesetOut:function(a){a.root||(this.contexts.length=this.contexts.length-1)},visitMedia:function(a,b){a.allExtends=[],this.allExtendsStack.push(a.allExtends)},visitMediaOut:function(a){this.allExtendsStack.length=this.allExtendsStack.length-1},visitDirective:function(a,b){a.allExtends=[],this.allExtendsStack.push(a.allExtends)},visitDirectiveOut:function(a){this.allExtendsStack.length=this.allExtendsStack.length-1}};var h=function(){this._visitor=new e(this)};h.prototype={run:function(a){var b=new g;if(this.extendIndicies={},b.run(a),!b.foundExtends)return a;a.allExtends=a.allExtends.concat(this.doExtendChaining(a.allExtends,a.allExtends)),this.allExtendsStack=[a.allExtends];var c=this._visitor.visit(a);return this.checkExtendsForNonMatched(a.allExtends),c},checkExtendsForNonMatched:function(a){var b=this.extendIndicies;a.filter(function(a){return!a.hasFoundMatches&&1==a.parent_ids.length}).forEach(function(a){var c="_unknown_";try{c=a.selector.toCSS({})}catch(d){}b[a.index+" "+c]||(b[a.index+" "+c]=!0,f.warn("extend '"+c+"' has no matches"))})},doExtendChaining:function(a,b,c){var e,f,g,h,i,j,k,l,m=[],n=this;for(c=c||0,e=0;e<a.length;e++)for(f=0;f<b.length;f++)j=a[e],k=b[f],j.parent_ids.indexOf(k.object_id)>=0||(i=[k.selfSelectors[0]],g=n.findMatch(j,i),g.length&&(j.hasFoundMatches=!0,j.selfSelectors.forEach(function(a){h=n.extendSelector(g,i,a),l=new d.Extend(k.selector,k.option,0),l.selfSelectors=h,h[h.length-1].extendList=[l],m.push(l),l.ruleset=k.ruleset,l.parent_ids=l.parent_ids.concat(k.parent_ids,j.parent_ids),k.firstExtendOnThisSelectorPath&&(l.firstExtendOnThisSelectorPath=!0,k.ruleset.paths.push(h))})));if(m.length){if(this.extendChainCount++,c>100){var o="{unable to calculate}",p="{unable to calculate}";try{o=m[0].selfSelectors[0].toCSS(),p=m[0].selector.toCSS()}catch(q){}throw{message:"extend circular reference detected. One of the circular extends is currently:"+o+":extend("+p+")"}}return m.concat(n.doExtendChaining(m,b,c+1))}return m},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitSelector:function(a,b){b.visitDeeper=!1},visitRuleset:function(a,b){if(!a.root){var c,d,e,f,g=this.allExtendsStack[this.allExtendsStack.length-1],h=[],i=this;for(e=0;e<g.length;e++)for(d=0;d<a.paths.length;d++)if(f=a.paths[d],!a.extendOnEveryPath){var j=f[f.length-1].extendList;j&&j.length||(c=this.findMatch(g[e],f),c.length&&(g[e].hasFoundMatches=!0,g[e].selfSelectors.forEach(function(a){h.push(i.extendSelector(c,f,a))})))}a.paths=a.paths.concat(h)}},findMatch:function(a,b){var c,d,e,f,g,h,i,j=this,k=a.selector.elements,l=[],m=[];for(c=0;c<b.length;c++)for(d=b[c],e=0;e<d.elements.length;e++)for(f=d.elements[e],(a.allowBefore||0===c&&0===e)&&l.push({pathIndex:c,index:e,matched:0,initialCombinator:f.combinator}),h=0;h<l.length;h++)i=l[h],g=f.combinator.value,""===g&&0===e&&(g=" "),!j.isElementValuesEqual(k[i.matched].value,f.value)||i.matched>0&&k[i.matched].combinator.value!==g?i=null:i.matched++,i&&(i.finished=i.matched===k.length,i.finished&&!a.allowAfter&&(e+1<d.elements.length||c+1<b.length)&&(i=null)),i?i.finished&&(i.length=k.length,i.endPathIndex=c,i.endPathElementIndex=e+1,l.length=0,m.push(i)):(l.splice(h,1),h--);return m},isElementValuesEqual:function(a,b){if("string"==typeof a||"string"==typeof b)return a===b;if(a instanceof d.Attribute)return a.op===b.op&&a.key===b.key&&(a.value&&b.value?(a=a.value.value||a.value,b=b.value.value||b.value,a===b):!a.value&&!b.value);if(a=a.value,b=b.value,a instanceof d.Selector){if(!(b instanceof d.Selector)||a.elements.length!==b.elements.length)return!1;for(var c=0;c<a.elements.length;c++){if(a.elements[c].combinator.value!==b.elements[c].combinator.value&&(0!==c||(a.elements[c].combinator.value||" ")!==(b.elements[c].combinator.value||" ")))return!1;if(!this.isElementValuesEqual(a.elements[c].value,b.elements[c].value))return!1}return!0}return!1},extendSelector:function(a,b,c){var e,f,g,h,i,j=0,k=0,l=[];for(e=0;e<a.length;e++)h=a[e],f=b[h.pathIndex],g=new d.Element(h.initialCombinator,c.elements[0].value,c.elements[0].index,c.elements[0].currentFileInfo),h.pathIndex>j&&k>0&&(l[l.length-1].elements=l[l.length-1].elements.concat(b[j].elements.slice(k)),k=0,j++),i=f.elements.slice(k,h.index).concat([g]).concat(c.elements.slice(1)),j===h.pathIndex&&e>0?l[l.length-1].elements=l[l.length-1].elements.concat(i):(l=l.concat(b.slice(j,h.pathIndex)),l.push(new d.Selector(i))),j=h.endPathIndex,k=h.endPathElementIndex,k>=b[j].elements.length&&(k=0,j++);return j<b.length&&k>0&&(l[l.length-1].elements=l[l.length-1].elements.concat(b[j].elements.slice(k)),j++),l=l.concat(b.slice(j,b.length))},visitRulesetOut:function(a){},visitMedia:function(a,b){var c=a.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);c=c.concat(this.doExtendChaining(c,a.allExtends)),this.allExtendsStack.push(c)},visitMediaOut:function(a){var b=this.allExtendsStack.length-1;this.allExtendsStack.length=b},visitDirective:function(a,b){var c=a.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);c=c.concat(this.doExtendChaining(c,a.allExtends)),this.allExtendsStack.push(c)},visitDirectiveOut:function(a){var b=this.allExtendsStack.length-1;this.allExtendsStack.length=b}},b.exports=h},{"../logger":32,"../tree":61,"./visitor":89}],84:[function(a,b,c){function d(a){this.imports=[],this.variableImports=[],this._onSequencerEmpty=a,this._currentDepth=0}d.prototype.addImport=function(a){var b=this,c={callback:a,args:null,isReady:!1};return this.imports.push(c),function(){c.args=Array.prototype.slice.call(arguments,0),c.isReady=!0,b.tryRun()}},d.prototype.addVariableImport=function(a){this.variableImports.push(a)},d.prototype.tryRun=function(){this._currentDepth++;try{for(;;){for(;this.imports.length>0;){var a=this.imports[0];if(!a.isReady)return;this.imports=this.imports.slice(1),a.callback.apply(null,a.args)}if(0===this.variableImports.length)break;var b=this.variableImports[0];this.variableImports=this.variableImports.slice(1),b()}}finally{this._currentDepth--}0===this._currentDepth&&this._onSequencerEmpty&&this._onSequencerEmpty()},b.exports=d},{}],85:[function(a,b,c){var d=a("../contexts"),e=a("./visitor"),f=a("./import-sequencer"),g=function(a,b){this._visitor=new e(this),this._importer=a,this._finish=b,this.context=new d.Eval,this.importCount=0,this.onceFileDetectionMap={},this.recursionDetector={},this._sequencer=new f(this._onSequencerEmpty.bind(this))};g.prototype={isReplacing:!1,run:function(a){try{this._visitor.visit(a)}catch(b){this.error=b}this.isFinished=!0,this._sequencer.tryRun()},_onSequencerEmpty:function(){this.isFinished&&this._finish(this.error)},visitImport:function(a,b){var c=a.options.inline;if(!a.css||c){var e=new d.Eval(this.context,this.context.frames.slice(0)),f=e.frames[0];this.importCount++,a.isVariableImport()?this._sequencer.addVariableImport(this.processImportNode.bind(this,a,e,f)):this.processImportNode(a,e,f)}b.visitDeeper=!1},processImportNode:function(a,b,c){var d,e=a.options.inline;try{d=a.evalForImport(b)}catch(f){f.filename||(f.index=a.index,f.filename=a.currentFileInfo.filename),a.css=!0,a.error=f}if(!d||d.css&&!e)this.importCount--,this.isFinished&&this._sequencer.tryRun();else{d.options.multiple&&(b.importMultiple=!0);for(var g=void 0===d.css,h=0;h<c.rules.length;h++)if(c.rules[h]===a){c.rules[h]=d;break}var i=this.onImported.bind(this,d,b),j=this._sequencer.addImport(i);this._importer.push(d.getPath(),g,d.currentFileInfo,d.options,j)}},onImported:function(a,b,c,d,e,f){c&&(c.filename||(c.index=a.index,c.filename=a.currentFileInfo.filename),this.error=c);var g=this,h=a.options.inline,i=a.options.plugin,j=a.options.optional,k=e||f in g.recursionDetector;if(b.importMultiple||(k?a.skip=!0:a.skip=function(){return f in g.onceFileDetectionMap||(g.onceFileDetectionMap[f]=!0,!1)}),!f&&j&&(a.skip=!0),d&&(a.root=d,a.importedFilename=f,!h&&!i&&(b.importMultiple||!k))){g.recursionDetector[f]=!0;var l=this.context;this.context=b;try{this._visitor.visit(d)}catch(c){this.error=c}this.context=l}g.importCount--,g.isFinished&&g._sequencer.tryRun()},visitRule:function(a,b){"DetachedRuleset"===a.value.type?this.context.frames.unshift(a):b.visitDeeper=!1},visitRuleOut:function(a){"DetachedRuleset"===a.value.type&&this.context.frames.shift()},visitDirective:function(a,b){this.context.frames.unshift(a)},visitDirectiveOut:function(a){this.context.frames.shift()},visitMixinDefinition:function(a,b){this.context.frames.unshift(a)},visitMixinDefinitionOut:function(a){this.context.frames.shift()},visitRuleset:function(a,b){this.context.frames.unshift(a)},visitRulesetOut:function(a){this.context.frames.shift()},visitMedia:function(a,b){this.context.frames.unshift(a.rules[0])},visitMediaOut:function(a){this.context.frames.shift()}},b.exports=g},{"../contexts":10,"./import-sequencer":84,"./visitor":89}],86:[function(a,b,c){
var d={Visitor:a("./visitor"),ImportVisitor:a("./import-visitor"),ExtendVisitor:a("./extend-visitor"),JoinSelectorVisitor:a("./join-selector-visitor"),ToCSSVisitor:a("./to-css-visitor")};b.exports=d},{"./extend-visitor":83,"./import-visitor":85,"./join-selector-visitor":87,"./to-css-visitor":88,"./visitor":89}],87:[function(a,b,c){var d=a("./visitor"),e=function(){this.contexts=[[]],this._visitor=new d(this)};e.prototype={run:function(a){return this._visitor.visit(a)},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitRuleset:function(a,b){var c,d=this.contexts[this.contexts.length-1],e=[];this.contexts.push(e),a.root||(c=a.selectors,c&&(c=c.filter(function(a){return a.getIsOutput()}),a.selectors=c.length?c:c=null,c&&a.joinSelectors(e,d,c)),c||(a.rules=null),a.paths=e)},visitRulesetOut:function(a){this.contexts.length=this.contexts.length-1},visitMedia:function(a,b){var c=this.contexts[this.contexts.length-1];a.rules[0].root=0===c.length||c[0].multiMedia},visitDirective:function(a,b){var c=this.contexts[this.contexts.length-1];a.rules&&a.rules.length&&(a.rules[0].root=a.isRooted||0===c.length||null)}},b.exports=e},{"./visitor":89}],88:[function(a,b,c){var d=a("../tree"),e=a("./visitor"),f=function(a){this._visitor=new e(this),this._context=a};f.prototype={isReplacing:!0,run:function(a){return this._visitor.visit(a)},visitRule:function(a,b){if(!a.variable)return a},visitMixinDefinition:function(a,b){a.frames=[]},visitExtend:function(a,b){},visitComment:function(a,b){if(!a.isSilent(this._context))return a},visitMedia:function(a,b){if(a.accept(this._visitor),b.visitDeeper=!1,a.rules.length)return a},visitImport:function(a,b){if(void 0===a.path.currentFileInfo.reference||!a.css)return a},visitDirective:function(a,b){function c(a){var b,c=a.rules;1!==c.length||c[0].paths&&0!==c[0].paths.length||(c=c[0].rules);for(var d=0;d<c.length;d++)if(b=c[d],b.getIsReferenced&&b.getIsReferenced())return!0;return!1}if("@charset"===a.name){if(!a.getIsReferenced())return;if(this.charset){if(a.debugInfo){var e=new d.Comment("/* "+a.toCSS(this._context).replace(/\n/g,"")+" */\n");return e.debugInfo=a.debugInfo,this._visitor.visit(e)}return}this.charset=!0}if(a.rules&&a.rules.length){if(this._mergeRules(a.rules[0].rules),a.accept(this._visitor),b.visitDeeper=!1,a.getIsReferenced())return a;if(!a.rules||!a.rules.length)return;if(c(a))return a.markReferenced(),a}else if(a.getIsReferenced())return a},checkPropertiesInRoot:function(a){for(var b,c=0;c<a.length;c++)if(b=a[c],b instanceof d.Rule&&!b.variable)throw{message:"properties must be inside selector blocks, they cannot be in the root.",index:b.index,filename:b.currentFileInfo?b.currentFileInfo.filename:null}},visitRuleset:function(a,b){var c,e=[];if(a.firstRoot&&this.checkPropertiesInRoot(a.rules),a.root)a.accept(this._visitor),b.visitDeeper=!1,(a.firstRoot||a.rules&&a.rules.length>0)&&e.splice(0,0,a);else{a.paths&&(a.paths=a.paths.filter(function(a){var b;for(" "===a[0].elements[0].combinator.value&&(a[0].elements[0].combinator=new d.Combinator("")),b=0;b<a.length;b++)if(a[b].getIsReferenced()&&a[b].getIsOutput())return!0;return!1}));for(var f=a.rules,g=f?f.length:0,h=0;h<g;)c=f[h],c&&c.rules?(e.push(this._visitor.visit(c)),f.splice(h,1),g--):h++;g>0?a.accept(this._visitor):a.rules=null,b.visitDeeper=!1,f=a.rules,f&&(this._mergeRules(f),f=a.rules),f&&(this._removeDuplicateRules(f),f=a.rules),f&&f.length>0&&a.paths.length>0&&e.splice(0,0,a)}return 1===e.length?e[0]:e},_removeDuplicateRules:function(a){if(a){var b,c,e,f={};for(e=a.length-1;e>=0;e--)if(c=a[e],c instanceof d.Rule)if(f[c.name]){b=f[c.name],b instanceof d.Rule&&(b=f[c.name]=[f[c.name].toCSS(this._context)]);var g=c.toCSS(this._context);b.indexOf(g)!==-1?a.splice(e,1):b.push(g)}else f[c.name]=c}},_mergeRules:function(a){if(a){for(var b,c,e,f={},g=0;g<a.length;g++)c=a[g],c instanceof d.Rule&&c.merge&&(e=[c.name,c.important?"!":""].join(","),f[e]?a.splice(g--,1):f[e]=[],f[e].push(c));Object.keys(f).map(function(a){function e(a){return new d.Expression(a.map(function(a){return a.value}))}function g(a){return new d.Value(a.map(function(a){return a}))}if(b=f[a],b.length>1){c=b[0];var h=[],i=[];b.map(function(a){"+"===a.merge&&(i.length>0&&h.push(e(i)),i=[]),i.push(a)}),h.push(e(i)),c.value=g(h)}})}},visitAnonymous:function(a,b){if(a.getIsReferenced())return a.accept(this._visitor),a}},b.exports=f},{"../tree":61,"./visitor":89}],89:[function(a,b,c){function d(a){return a}function e(a,b){var c,d;for(c in a)if(a.hasOwnProperty(c))switch(d=a[c],typeof d){case"function":d.prototype&&d.prototype.type&&(d.prototype.typeIndex=b++);break;case"object":b=e(d,b)}return b}var f=a("../tree"),g={visitDeeper:!0},h=!1,i=function(a){this._implementation=a,this._visitFnCache=[],h||(e(f,1),h=!0)};i.prototype={visit:function(a){if(!a)return a;var b=a.typeIndex;if(!b)return a;var c,e=this._visitFnCache,f=this._implementation,h=b<<1,i=1|h,j=e[h],k=e[i],l=g;if(l.visitDeeper=!0,j||(c="visit"+a.type,j=f[c]||d,k=f[c+"Out"]||d,e[h]=j,e[i]=k),j!==d){var m=j.call(f,a,l);f.isReplacing&&(a=m)}return l.visitDeeper&&a&&a.accept&&a.accept(this),k!=d&&k.call(f,a),a},visitArray:function(a,b){if(!a)return a;var c,d=a.length;if(b||!this._implementation.isReplacing){for(c=0;c<d;c++)this.visit(a[c]);return a}var e=[];for(c=0;c<d;c++){var f=this.visit(a[c]);void 0!==f&&(f.splice?f.length&&this.flatten(f,e):e.push(f))}return e},flatten:function(a,b){b||(b=[]);var c,d,e,f,g,h;for(d=0,c=a.length;d<c;d++)if(e=a[d],void 0!==e)if(e.splice)for(g=0,f=e.length;g<f;g++)h=e[g],void 0!==h&&(h.splice?h.length&&this.flatten(h,b):b.push(h));else b.push(e);return b}},b.exports=i},{"../tree":61}],90:[function(a,b,c){function d(){if(!h){h=!0;for(var a,b=g.length;b;){a=g,g=[];for(var c=-1;++c<b;)a[c]();b=g.length}h=!1}}function e(){}var f=b.exports={},g=[],h=!1;f.nextTick=function(a){g.push(a),h||setTimeout(d,0)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=e,f.addListener=e,f.once=e,f.off=e,f.removeListener=e,f.removeAllListeners=e,f.emit=e,f.binding=function(a){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(a){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],91:[function(a,b,c){"use strict";function d(a){function b(a){return null===i?void k.push(a):void g(function(){var b=i?a.onFulfilled:a.onRejected;if(null===b)return void(i?a.resolve:a.reject)(j);var c;try{c=b(j)}catch(d){return void a.reject(d)}a.resolve(c)})}function c(a){try{if(a===l)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var b=a.then;if("function"==typeof b)return void f(b.bind(a),c,d)}i=!0,j=a,h()}catch(e){d(e)}}function d(a){i=!1,j=a,h()}function h(){for(var a=0,c=k.length;a<c;a++)b(k[a]);k=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");var i=null,j=null,k=[],l=this;this.then=function(a,c){return new l.constructor(function(d,f){b(new e(a,c,d,f))})},f(a,c,d)}function e(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function f(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var g=a("asap");b.exports=d},{asap:93}],92:[function(a,b,c){"use strict";function d(a){this.then=function(b){return"function"!=typeof b?this:new e(function(c,d){f(function(){try{c(b(a))}catch(e){d(e)}})})}}var e=a("./core.js"),f=a("asap");b.exports=e,d.prototype=e.prototype;var g=new d(!0),h=new d(!1),i=new d(null),j=new d(void 0),k=new d(0),l=new d("");e.resolve=function(a){if(a instanceof e)return a;if(null===a)return i;if(void 0===a)return j;if(a===!0)return g;if(a===!1)return h;if(0===a)return k;if(""===a)return l;if("object"==typeof a||"function"==typeof a)try{var b=a.then;if("function"==typeof b)return new e(b.bind(a))}catch(c){return new e(function(a,b){b(c)})}return new d(a)},e.all=function(a){var b=Array.prototype.slice.call(a);return new e(function(a,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}b[f]=g,0===--e&&a(b)}catch(i){c(i)}}if(0===b.length)return a([]);for(var e=b.length,f=0;f<b.length;f++)d(f,b[f])})},e.reject=function(a){return new e(function(b,c){c(a)})},e.race=function(a){return new e(function(b,c){a.forEach(function(a){e.resolve(a).then(b,c)})})},e.prototype.catch=function(a){return this.then(null,a)}},{"./core.js":91,asap:93}],93:[function(a,b,c){(function(a){function c(){for(;e.next;){e=e.next;var a=e.task;e.task=void 0;var b=e.domain;b&&(e.domain=void 0,b.enter());try{a()}catch(d){if(i)throw b&&b.exit(),setTimeout(c,0),b&&b.enter(),d;setTimeout(function(){throw d},0)}b&&b.exit()}g=!1}function d(b){f=f.next={task:b,domain:i&&a.domain,next:null},g||(g=!0,h())}var e={task:void 0,next:null},f=e,g=!1,h=void 0,i=!1;if("undefined"!=typeof a&&a.nextTick)i=!0,h=function(){a.nextTick(c)};else if("function"==typeof setImmediate)h="undefined"!=typeof window?setImmediate.bind(window,c):function(){setImmediate(c)};else if("undefined"!=typeof MessageChannel){var j=new MessageChannel;j.port1.onmessage=c,h=function(){j.port2.postMessage(0)}}else h=function(){setTimeout(c,0)};b.exports=d}).call(this,a("_process"))},{_process:90}],94:[function(a,b,c){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(a,b){var c=arguments.length?this.then.apply(this,arguments):this;c.then(null,function(a){setTimeout(function(){throw a},0)})})},{}],95:[function(a,b,c){a("asap");"undefined"==typeof Promise&&(Promise=a("./lib/core.js"),a("./lib/es6-extensions.js")),a("./polyfill-done.js")},{"./lib/core.js":91,"./lib/es6-extensions.js":92,"./polyfill-done.js":94,asap:93}]},{},[2])(2)}),function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)},b=function(c,d){function e(){this.q=[],this.add=function(a){this.q.push(a)};var a,b;this.call=function(){for(a=0,b=this.q.length;a<b;a++)this.q[a].call()}}function f(a,b){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue(b):a.style[b]}function g(b,c){if(b.resizedAttached){if(b.resizedAttached)return void b.resizedAttached.add(c)}else b.resizedAttached=new e,b.resizedAttached.add(c);b.resizeSensor=document.createElement("div"),b.resizeSensor.className="resize-sensor";var d="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",g="position: absolute; left: 0; top: 0; transition: 0s;";b.resizeSensor.style.cssText=d,b.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+d+'"><div style="'+g+'"></div></div><div class="resize-sensor-shrink" style="'+d+'"><div style="'+g+' width: 200%; height: 200%"></div></div>',b.appendChild(b.resizeSensor),"static"==f(b,"position")&&(b.style.position="relative");var h=b.resizeSensor.childNodes[0],i=h.childNodes[0],j=b.resizeSensor.childNodes[1],k=function(){i.style.width=1e5+"px",i.style.height=1e5+"px",h.scrollLeft=1e5,h.scrollTop=1e5,j.scrollLeft=1e5,j.scrollTop=1e5};k();var l=!1,m=function(){b.resizedAttached&&(l&&(b.resizedAttached.call(),l=!1),a(m))};a(m);var n,o,p,q,r=function(){(p=b.offsetWidth)==n&&(q=b.offsetHeight)==o||(l=!0,n=p,o=q),k()},s=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c)};s(h,"scroll",r),s(j,"scroll",r)}var h=Object.prototype.toString.call(c),i="[object Array]"===h||"[object NodeList]"===h||"[object HTMLCollection]"===h||"undefined"!=typeof jQuery&&c instanceof jQuery||"undefined"!=typeof Elements&&c instanceof Elements;if(i)for(var j=0,k=c.length;j<k;j++)g(c[j],d);else g(c,d);this.detach=function(){if(i)for(var a=0,d=c.length;a<d;a++)b.detach(c[a]);else b.detach(c)}};b.detach=function(a){a.resizeSensor&&(a.removeChild(a.resizeSensor),delete a.resizeSensor,delete a.resizedAttached)},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=b:window.ResizeSensor=b}(),define("resize-sensor",function(){}),function(){var a=window.ResizeSensor;"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(a=require("./ResizeSensor"));var b=this.ElementQueries=function(){function c(a){a||(a=document.documentElement);var b=getComputedStyle(a,"fontSize");return parseFloat(b)||16}function d(a,b){var d=b.replace(/[0-9]*/,"");switch(b=parseFloat(b),d){case"px":return b;case"em":return b*c(a);case"rem":return b*c();case"vw":return b*document.documentElement.clientWidth/100;case"vh":return b*document.documentElement.clientHeight/100;case"vmin":case"vmax":var e=document.documentElement.clientWidth/100,f=document.documentElement.clientHeight/100,g=Math["vmin"===d?"min":"max"];return b*g(e,f);default:return b}}function e(a){this.element=a,this.options={};var b,c,e,f,g,h,i,j=0,k=0;this.addOption=function(a){var b=[a.mode,a.property,a.value].join(",");this.options[b]=a};var l=["min-width","min-height","max-width","max-height"];this.call=function(){j=this.element.offsetWidth,k=this.element.offsetHeight,g={};for(b in this.options)this.options.hasOwnProperty(b)&&(c=this.options[b],e=d(this.element,c.value),f="width"==c.property?j:k,i=c.mode+"-"+c.property,h="","min"==c.mode&&f>=e&&(h+=c.value),"max"==c.mode&&f<=e&&(h+=c.value),g[i]||(g[i]=""),h&&-1===(" "+g[i]+" ").indexOf(" "+h+" ")&&(g[i]+=" "+h));for(var a in l)l.hasOwnProperty(a)&&(g[l[a]]?this.element.setAttribute(l[a],g[l[a]].substr(1)):this.element.removeAttribute(l[a]))}}function f(b,c){b.elementQueriesSetupInformation?b.elementQueriesSetupInformation.addOption(c):(b.elementQueriesSetupInformation=new e(b),b.elementQueriesSetupInformation.addOption(c),b.elementQueriesSensor=new a(b,function(){b.elementQueriesSetupInformation.call()})),b.elementQueriesSetupInformation.call(),n&&o.indexOf(b)<0&&o.push(b)}function g(a,b,c,d){"undefined"==typeof p[b]&&(p[b]={}),"undefined"==typeof p[b][c]&&(p[b][c]={}),"undefined"==typeof p[b][c][d]?p[b][c][d]=a:p[b][c][d]+=","+a}function h(){var a;if(document.querySelectorAll&&(a=document.querySelectorAll.bind(document)),a||"undefined"==typeof $$||(a=$$),a||"undefined"==typeof jQuery||(a=jQuery),!a)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";return a}function i(){var a=h();for(var b in p)if(p.hasOwnProperty(b))for(var c in p[b])if(p[b].hasOwnProperty(c))for(var d in p[b][c])if(p[b][c].hasOwnProperty(d))for(var e=a(p[b][c][d]),g=0,i=e.length;g<i;g++)f(e[g],{mode:b,property:c,value:d})}function j(b){function c(){var a,c=!1;for(a in d)d.hasOwnProperty(a)&&e[a].minWidth&&b.offsetWidth>e[a].minWidth&&(c=a);if(c||(c=g),h!=c)if(i[c])d[h].style.display="none",d[c].style.display="block",h=c;else{var j=new Image;j.onload=function(){d[c].src=f[c],d[h].style.display="none",d[c].style.display="block",i[c]=!0,h=c},j.src=f[c]}else d[c].src=f[c]}var d=[],e=[],f=[],g=0,h=-1,i=[];for(var j in b.children)if(b.children.hasOwnProperty(j)&&b.children[j].tagName&&"img"===b.children[j].tagName.toLowerCase()){d.push(b.children[j]);var k=b.children[j].getAttribute("min-width")||b.children[j].getAttribute("data-min-width"),l=b.children[j].getAttribute("data-src")||b.children[j].getAttribute("url");f.push(l);var m={minWidth:k};e.push(m),k?b.children[j].style.display="none":(g=d.length-1,b.children[j].style.display="block")}h=g,b.resizeSensor=new a(b,c),c(),n&&o.push(b)}function k(){for(var a=h(),b=a("[data-responsive-image],[responsive-image]"),c=0,d=b.length;c<d;c++)j(b[c])}function l(a){var b,c;for(a=a.replace(/'/g,'"');null!==(b=q.exec(a));)for(c=b[1]+b[3],attrs=b[2];null!==(attrMatch=r.exec(attrs));)g(c,attrMatch[1],attrMatch[2],attrMatch[3])}function m(a){var b="";if(a)if("string"==typeof a)a=a.toLowerCase(),-1===a.indexOf("min-width")&&-1===a.indexOf("max-width")||l(a);else for(var c=0,d=a.length;c<d;c++)1===a[c].type?(b=a[c].selectorText||a[c].cssText,-1!==b.indexOf("min-height")||-1!==b.indexOf("max-height")?l(b):-1===b.indexOf("min-width")&&-1===b.indexOf("max-width")||l(b)):4===a[c].type&&m(a[c].cssRules||a[c].rules)}var n=!1,o=[],p={},q=/,?[\s\t]*([^,\n]*?)((?:\[[\s\t]*?(?:min|max)-(?:width|height)[\s\t]*?[~$\^]?=[\s\t]*?"[^"]*?"[\s\t]*?])+)([^,\n\s\{]*)/gim,r=/\[[\s\t]*?(min|max)-(width|height)[\s\t]*?[~$\^]?=[\s\t]*?"([^"]*?)"[\s\t]*?]/gim,s=!1;this.init=function(a){n="undefined"!=typeof a&&a;for(var b=0,c=document.styleSheets.length;b<c;b++)try{m(document.styleSheets[b].cssRules||document.styleSheets[b].rules||document.styleSheets[b].cssText)}catch(d){if("SecurityError"!==d.name)throw d}if(!s){var e=document.createElement("style");e.type="text/css",e.innerHTML="[responsive-image] > img, [data-responsive-image] {overflow: hidden; padding: 0; } [responsive-image] > img, [data-responsive-image] > img { width: 100%;}",document.getElementsByTagName("head")[0].appendChild(e),s=!0}i(),k()},this.update=function(a){this.init(a)},this.detach=function(){if(!this.withTracking)throw"withTracking is not enabled. We can not detach elements since we don not store it.Use ElementQueries.withTracking = true; before domready or call ElementQueryes.update(true).";for(var a;a=o.pop();)b.detach(a);o=[]}};b.update=function(a){b.instance.update(a)},b.detach=function(a){a.elementQueriesSetupInformation?(a.elementQueriesSensor.detach(),delete a.elementQueriesSetupInformation,delete a.elementQueriesSensor):a.resizeSensor&&(a.resizeSensor.detach(),delete a.resizeSensor)},b.withTracking=!1,b.init=function(){b.instance||(b.instance=new b),b.instance.init(b.withTracking)};var c=function(a){/*@cc_on
         @if (@_win32 || @_win64)
         document.write('<script id="ieScriptLoad" defer src="//:"><\/script>');
         document.getElementById('ieScriptLoad').onreadystatechange = function() {
         if (this.readyState == 'complete') {
         callback();
         }
         };
         @end @*/
if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1);else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent))var b=setInterval(function(){/loaded|complete/i.test(document.readyState)&&(a(),clearInterval(b))},10);else window.onload=a};b.listen=function(){c(b.init)},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=b:(window.ElementQueries=b,b.listen())}(),define("element-queries",["resize-sensor"],function(a){return function(){var b;return b||a.ElementQueries}}(this)),define("extensions.qliktech/widget/widget-styling",["assets/external/less/less","element-queries","core.utils/deferred"],function(a,b,c){function d(a){return j.test(a)}function e(a){return a&&k.test(a)}function f(a){b.detach(a);for(var c=0;c<a.children.length;++c)f(a.children[c])}function g(a,c){b.init(),a.$scope.$on("$destroy",function(){f(c)})}function h(b,c){var d="#widget"+c+" {"+b+"}";return a.render(d)}function i(a,b,e){return b?h(b,e).then(function(b){a.styleElement.innerHTML=b.css,d(b.css)&&g(a,a.htmlElement)}):(a.styleElement.innerHTML="",c.resolve())}var j=new RegExp("(?:min|max)-(?:width|height)"),k=/\{{[^}]*}}/gim;return{hasAngularBindings:e,updateLess:i,processLess:h,hasElementQuery:d,enableElementQueries:g}}),define("extensions.qliktech/widget/widget-properties",["util"],function(a){function b(a){return a&&0===a.indexOf(C)?a.substring(9):a}function c(a){return a&&0!==a.indexOf(C)?C+a:a}function d(a,b){var c=0,d=b.length;return a&&a.forEach(function(a){if(a.ref&&0===a.ref.indexOf(b)){var e=parseInt(a.ref.substring(d));e>c&&(c=e)}}),b+(c+1)}function e(a,b){a&&a.forEach(function(c,d){c.ref===b&&a.splice(d,1)})}function f(a,b){var c=-1;return a&&a.some(function(a,d){if(a.ref===b)return c=d,!0}),c}function g(a){return a.settings?a.settings.sort(function(a,b){return a.order===b.order?0:!a.order||a.order<b.order?-1:1}):[]}function h(a,b){return a.settings?a.settings.filter(function(a){return(a.parent||B)===b}).sort(function(a,b){return a.order===b.order?0:!a.order||a.order<b.order?-1:1}):[]}function i(b){var d=a.extend(!0,{},b);return d.type=d.type||"string",d.label=d.label||d.ref,d.defaultValue=d.defaultValue||"boolean"!==d.type&&"","string"!==d.type||d.component||(d.expression=d.expression||"optional"),"text"===b.component?delete d.ref:d.ref=c(d.ref),d}function j(a,b){var c={},d=h(a,b);return d.forEach(function(a){c[a.ref]=i(a)}),c}function k(a){o(a,y,{ref:B})}function l(a,b){return b===y||(b===z?!m(a)&&!n(a):b===A&&((m(a)||n(a))&&a.sorting!==!0))}function m(a){return void 0!==a.measures&&(a.measures.max>0||void 0===a.measures.max)}function n(a){return void 0!==a.dimensions&&(a.dimensions.max>0||void 0===a.dimensions.max)}function o(a,b,c){switch(b){case z:a.measures={min:1,max:1};break;case y:a.sections=a.sections||[];var e=c||{};e.type=b,e.ref=e.ref||d(a.sections,b),e.label=e.label||"Settings",a.sections.push(e);break;case A:a.sorting=!0}}function p(a,b,c){return b===z?(delete a.measures,delete a.dimensions,void delete a.sorting):b===A?void delete a.sorting:("section-header"===b&&h(a,c).forEach(function(b){t(a,b)}),void e(a.sections,c))}function q(a,b){if(!b||"q"===b.substr(0,1).toLowerCase())return!1;if(x.indexOf(b.toLowerCase())>-1)return!1;var c=!0;return a.settings&&a.settings.forEach(function(a){a.ref===b&&(c=!1)}),c}function r(a,b,c){b=b.item||b,a.settings||(a.settings=[]),a.sections||k(a),b.parent&&"general"!==b.parent||(b.parent=B),b.ref=b.ref||d(a.settings,"property"),b.label=b.label||b.ref.substr(0,1).toUpperCase()+b.ref.substring(1),c||u(a,b),a.settings.push(b)}function s(a,c,d,e,g){c=c.item||c,c.ref=b(c.ref);var h=c.parent===d;"undefined"==typeof c.order&&(c.order=f(a.settings,c.ref));var i=c.order;c.parent=d,t(a,c,h,g),c.order=e-(c.order<e&&h?1:0),h&&u(a,c,!1,i),r(a,c,h)}function t(a,c,d,f){c=c.item||c,e(a.settings,b(c.ref)),d||u(a,c,!0,null,f)}function u(a,b,c,d,e){var f=h(a,e||b.parent);isNaN(b.order)||b.order>f.length||b.order<0?b.order=f.length:c||"undefined"==typeof d?c?f.forEach(function(a){a.order>b.order&&a.order--}):f.forEach(function(a){a.order>=b.order&&a.order++}):d<b.order?f.forEach(function(a){a.order>d&&a.order<=b.order&&a.order--}):f.forEach(function(a){a.order>=b.order&&a.order<d&&a.order++})}function v(a){var b={};return a&&a.properties&&(n(a.properties)&&(b.dimensions=a.properties.dimensions),m(a.properties)&&(b.measures=a.properties.measures)),b}function w(a){var b={type:"items",component:"accordion",items:{}};if(a&&a.properties){var c=a.properties;(m(c)||n(c))&&(b.items.data={uses:z,items:{measures:{disabledRef:""},dimensions:{disabledRef:""}}},c.sorting&&(b.items.sorting={uses:A})),b.items.settings={uses:"settings",items:{}},(!c.sections||c.sections.length<1)&&c.settings&&c.settings.length>0&&k(c),c.sections&&c.sections.length>0&&c.sections.forEach(function(a){b.items.settings.items[a.ref]={ref:a.ref,type:"items",label:a.label,items:j(c,a.ref)}})}return b}var x=["showtitles","title","subtitle","footnote"],y="header",z="data",A="sorting",B="settings",C="settings.";return{addScope:c,stripScope:b,canAddSection:l,addSection:o,removeSection:p,addItem:r,removeItem:t,moveItem:s,getData:v,getDefinition:w,isValidRef:q,getSectionItemsArr:h,getSectionsItemsArr:g}}),define("extensions.qliktech/widget/widget",["qvangular","core.utils/deferred","translator","qlik","dev-hub.custom-components/custom-components","objects.extension/default-extension","objects.extension/object-conversion","dev-hub.models/widget-template","./widget-styling","./widget-properties"],function(a,b,c,d,e,f,g,h,i,j){function k(a,b,c,d){d=d&&"hard"===d?" hard-error":" soft-error",a.$scope.error={title:b,message:c},a.htmlElement.innerHTML='<div qv-errorhandler class="object-error'+d+'" ng-class="hard-error" tid="widget.Error"><div class="object-error-content"><div class="object-error-title"><span>{{error.title}}</span>\t</div>\t<div ng-if="error.message" class="object-error-message">{{error.message}}</div></div></div>',m(a.htmlElement)(a.$scope)}function l(a,d,e){var f=e.templateId,g=new b;return a.htmlElement||(a.styleElement=document.createElement("style"),d.appendChild(a.styleElement),a.htmlElement=document.createElement("div"),a.htmlElement.id="widget"+e.qInfo.qId,a.htmlElement.style.height="100%",a.htmlElement.style.overflow="auto",d.appendChild(a.htmlElement)),f?(h.get(f).then(function(b){function d(){m("<style>"+b.css+"</style>")(a.$scope,function(b){n(function(){i.updateLess(a,b[0].innerHTML,e.qInfo.qId).then(function(){g.resolve()},function(b){k(a,c.get("Widget.InvalidCss"," "),b.message),g.resolve()})})})}a.template=b,f!==a.templateId||a.version!==b.version?(a.templateId=f,a.version=b.version,a.htmlElement.innerHTML=b.html,m(a.htmlElement)(a.$scope),d()):(d(),n(function(){g.resolve()}))},function(b){k(a,c.get(b||"Widget.TemplateNotFound",[f]),c.get(b||"Widget.TemplateNotFound",[f])),g.resolve()}),g.promise):(k(a,c.get("Widget.NoTemplate"),f),g.resolve(),g.promise())}var m=a.getService("$compile"),n=a.getService("$timeout");return{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:50}]},templateId:""},init:function(a,d){return h.getTemplateList().then(function(){return h.get(d.templateId).then(function(){return e.init()},function(){return b.reject(c.get("Widget.TemplateNotFound",[d.widgetMeta&&d.widgetMeta.name||d.templateId,d.widgetMeta&&d.widgetMeta.libid]))})})},mapProperties:function(a){var c=this,d=new b,e=h.getLoaded(a.layout.templateId),g={};return e&&e.properties&&(e.properties.measures&&(g.measures=JSON.parse(JSON.stringify(e.properties.measures))),e.properties.dimensions&&(g.dimensions=JSON.parse(JSON.stringify(e.properties.dimensions)))),c.data=j.getData(e),c.definition=j.getDefinition(e),f.mapProperties.apply(c),d.resolve(g),d.promise},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:function(a){return!!a.qHyperCube&&(a.qHyperCube.qDimensionInfo.length>0||a.qHyperCube.qMeasureInfo.length>0)},sharing:!1},importProperties:function(a,b,c){var d=h.getLoaded(b.templateId);c.data=j.getData(d),c.definition=j.getDefinition(d);var e=g.hypercube.importProperties(a,b,c);return b.templateId&&(e.qProperty.templateId=b.templateId,e.qProperty.widgetMeta={libid:d.libid,name:d.name}),e},paint:function(a,b){return this.$scope.app||(this.$scope.app=d.currApp(this)),this.$scope.data||(this.$scope.data=d.table(this)),this.$scope.navigation||(this.$scope.navigation=d.navigation),this.$scope.layout=b,this.$scope.settings=b.settings||{},this.$scope.settings.title=b.title,this.$scope.settings.subtitle=b.subtitle,this.$scope.settings.footnote=b.footnote,l(this,a[0],b)},controller:["$scope",function(){}]}});