/*!
* Copyright(C) 2015
* Qlik International AB
* All Rights Reserved
*/
define("js/configloader",{load:function(a,b,c){b(["assets/general/require-config"],function(d){(d=d||b)([a],function(a){c(a)})})}}),define("assets/general/require-config",[],function(){var a=requirejs.s.contexts.sense?"sense":"_";return requirejs.config({context:a,paths:{text:"assets/external/requirejs/text",css:"assets/external/requirejs/css",jquery:"assets/external/jquery/jquery",jqueryoutside:"assets/external/jquery/jquery.ba-outside-events",jqueryui:"assets/external/jquery/jquery.ui.touch-punch",jqueryuitouch:"assets/external/jquery/jquery-ui",eventable:"assets/external/eventable/eventable",sirtrevor:"assets/external/sir-trevor/sir-trevor",angular:"assets/external/angular/angular","angular-animate":"assets/external/angular/angular-animate","angular-resource":"assets/external/angular/angular-resource","angular-route":"assets/external/angular/angular-route","angular-sanitize":"assets/external/angular/angular-sanitize",crossroads:"assets/external/crossroads/crossroads",signals:"assets/external/crossroads/signals",underscore:"assets/external/underscorejs/underscore",touche:"assets/external/touche/touche",codemirror:"assets/external/codemirror/lib/codemirror","codemirror.runmode":"assets/external/codemirror/addon/runmode/runmode","codemirror.dialog":"assets/external/codemirror/addon/dialog/dialog","codemirror.placeholder":"assets/external/codemirror/addon/display/placeholder","codemirror.foldcode":"assets/external/codemirror/addon/fold/foldcode","codemirror.javascript":"assets/external/codemirror/mode/javascript/javascript","codemirror.css":"assets/external/codemirror/mode/css/css","codemirror.htmlmixed":"assets/external/codemirror/mode/htmlmixed/htmlmixed","codemirror.xml":"assets/external/codemirror/mode/xml/xml","codemirror.matchbrackets":"assets/external/codemirror/addon/edit/matchbrackets","codemirror.search":"assets/external/codemirror/addon/search/search","codemirror.comment":"assets/external/codemirror/addon/comment/comment","codemirror.matchtags":"assets/external/codemirror/addon/edit/matchtags","codemirror.closetag":"assets/external/codemirror/addon/edit/closetag","codemirror.closebrackets":"assets/external/codemirror/addon/edit/closebrackets","codemirror.show-hint":"assets/external/codemirror/addon/hint/show-hint","codemirror.searchcursor":"assets/external/codemirror/addon/search/searchcursor","codemirror.javascript-hint":"assets/external/codemirror/addon/hint/javascript-hint","codemirror.qjavascript-hint":"workbench/codemirror/addon/hint/qjavascript-hint","codemirror.qhtml-hint":"workbench/codemirror/addon/hint/qhtml-hint","codemirror.css-hint":"assets/external/codemirror/addon/hint/css-hint","codemirror.html-hint":"assets/external/codemirror/addon/hint/html-hint","codemirror.xml-hint":"assets/external/codemirror/addon/hint/xml-hint",mqa:"assets/external/mqa/mqa","lz-string":"assets/external/lz-string/lz-string",moment:"assets/external/moment/moment-with-langs-2.4.0",sha256:"assets/external/js-sha256/sha256",openlayers:"assets/external/openlayers/OpenLayers",qvangular:"assets/qvangular/qvangular",ng:"assets/qvangular/qvangular-injector-require-plugin",ngModule:"assets/qvangular/qvangular-external-module-require-plugin","angular-vs-repeat":"assets/external/angular/angular-vs-repeat",util:"js/lib/util",encoder:"js/lib/encoder",pubsub:"js/lib/pubsub",translator:"js/lib/translator","widget.loader":"js/widgets/loader","widget.scriptarea":"js/widgets/scriptarea","widget.itemcontainer":"js/widgets/itemcontainer","widget.pager":"js/widgets/pager","widget.dialog":"js/widgets/dialog/dialog","widget.dialogblock":"js/widgets/dialog/block","widget.dialogtooltip":"js/widgets/dialog/tooltip","general.models":"assets/general/models","general.views":"assets/general/views","general.controllers":"assets/general/controllers","general.utils":"assets/general/utils","general.services":"assets/general/services","general.components":"assets/general/components","general.directives":"assets/general/directives","general.toolbar":"assets/general/views/toolbar","general.scroll":"assets/general/components/scroll","general.sortable":"assets/general/components/sortable","general.support":"assets/general/support","core.models":"assets/core/models","core.utils":"assets/core/utils",storytelling:"assets/storytelling","storytelling.models":"assets/storytelling/models","storytelling.controllers":"assets/storytelling/controllers","storytelling.views":"assets/storytelling/views","storytelling.directives":"assets/storytelling/directives","storytelling.utils":"assets/storytelling/utils","hub.files":"assets/hub","client.models":"assets/client/models","client.views":"assets/client/views","client.controllers":"assets/client/controllers","client.components":"assets/client/components","client.utils":"assets/client/utils","client.services":"assets/client/services","client.assets":"assets/client/assets","client.property-panel":"assets/client/property-panel","client.dialogs":"assets/client/dialogs",objects:"assets/objects","objects.extension":"assets/objects/extension","objects.models":"assets/objects/models","objects.backend-api":"assets/objects/backend-api","objects.requirements":"assets/objects/requirements","objects.error-handling":"assets/objects/error-handling","objects.add-popovers":"assets/objects/add-popovers","objects.touch-context-menu":"assets/objects/touch-context-menu","objects.views":"assets/objects/views","objects.controllers":"assets/objects/controllers","objects.utils":"assets/objects/utils","objects.grid":"assets/objects/grid","objects.snapshot":"assets/objects/snapshot","object-renderer":"assets/object-renderer/object-renderer","scripteditor.models":"assets/scripteditor/models","scripteditor.services":"assets/scripteditor/services","scripteditor.utils":"assets/scripteditor/utils","scripteditor.views":"assets/scripteditor/views","scripteditor.codemirror":"assets/scripteditor/codemirror",qmc:"assets/qmc/qmc","qmc.modules":"assets/qmc/modules",xsrfplugin:"js/qmc/utils/xsrfplugin","qmc.comm":"js/qmc/comm","qmc.configuration":"js/qmc/configuration","qmc.ctor":"js/qmc/ctors","qmc.utils":"js/qmc/utils","qmc.widgets":"js/widgets/qmc","qmc.event":"js/qmc/events",qlik:"js/qlik-impl","extensions.qliktech":"extensions/qliktech","workbench.startpage":"workbench/startpage","workbench.extension":"workbench/extension","workbench.components":"workbench/mashup/components","workbench.utils":"workbench/utils",handlebars:"assets/external/handlebars/handlebars","qwidget.views":"assets/widget/views","qwidget.model":"assets/widget/model","qwidget.components":"assets/widget/components","qwidget.dialogs":"assets/widget/dialogs","qwidget.services":"assets/widget/services","qwidget.controllers":"assets/widget/controllers",qlikui:"assets/qlikui"},shim:{angular:{deps:["jquery"],exports:"angular"},underscore:{exports:"_"},eventable:["underscore"],sirtrevor:{deps:["eventable","underscore"],exports:"SirTrevor"},touche:{exports:"Touche"},"angular-resource":{deps:["angular"],init:function(a){return a.module("ngResource")}},"angular-route":{deps:["angular"],init:function(a){return a.module("ngRoute")}},"angular-animate":{deps:["angular"],init:function(a){return a.module("ngAnimate")}},"angular-sanitize":{deps:["angular"],init:function(a){return a.module("ngSanitize")}},"angular-vs-repeat":{deps:["angular"]},jqueryui:["jqueryuitouch"],jqueryoutside:["jquery"],jqueryuitouch:["jquery"],openlayers:{exports:"OpenLayers"},codemirror:{exports:"CodeMirror"},handlebars:{exports:"Handlebars"},"codemirror.qlikviewscript":["codemirror"],"codemirror.dialog":["codemirror"],"codemirror.placeholder":["codemirror"],"codemirror.foldcode":["codemirror"],"codemirror.comment":["codemirror"],"codemirror.javascript":["codemirror"],"codemirror.qjavascript-hint":["codemirror"],"codemirror.qhtml-hint":["codemirror"],"codemirror.htmlmixed":["codemirror"],"codemirror.xml":["codemirror"],"codemirror.css":["codemirror"],"codemirror.show-hint":["codemirror"],"codemirror.xml-hint":["codemirror"],"codemirror.html-hint":["codemirror"],"codemirror.css-hint":["codemirror"],"codemirror.javascript-hint":["codemirror"],"codemirror.matchbrackets":["codemirror"],"codemirror.search":["codemirror"],"codemirror.searchcursor":["codemirror"],"codemirror.closetag":["codemirror"],"codemirror.closematchtags":["codemirror"],"codemirror.closebrackets":["codemirror"]},waitSeconds:20}),requirejs.config({context:a,paths:{extensions:"../extensions","custom.connector.root":"../customdata"}})}),define("assets/qvangular/qvangular-config",[],function(){var a="false"!==(document.documentElement.getAttribute("qva-bootstrap")||document.body.getAttribute("qva-bootstrap"));return{internalOptimizations:a,autoBootstrap:a}}),define("assets/qvangular/qvangular-core",["jquery","assets/qvangular/qvangular-config","angular-animate","angular-sanitize","angular","angular-vs-repeat"],function(a,b){function c(a,b){o.isBootstrapped?o[a]=b:(p.push({name:a,fn:b}),o[a]=function(){var a=Array.prototype.slice.call(arguments);q.push({fn:b,args:a})})}function d(a){return function(){var b=Array.prototype.slice.apply(arguments);o.$rootScope.$$phase?a.apply(this,b):o.$rootScope.$apply(function(){a.apply(this,b)})}}var e,f,g,h,i,j,k,l,m,n=window.angular,o={},p=[],q=[];if(o.bootstrap=function(a,b,c,d,i,j){f=b,g=c,h=d,l=i,m=j,e=a,o.$injector=e,o.$rootScope=f,o.isBootstrapped=!0,p.forEach(function(a){o[a.name]=a.fn}),q.forEach(function(a){a.fn.apply(a.fn,a.args)}),q.length=p.length=0},o.module=n.module("qlik-angular",["ngAnimate","ngSanitize","vs-repeat"],["$provide","$injector","$compileProvider","$filterProvider","$animateProvider",function(a,c,d,e,f){i=a,j=d,k=e,b.internalOptimizations&&(f.classNameFilter(/\bqv-animate\b/i),a.value("$anchorScroll",function(){}))}]).run(["$injector","$rootScope","$compile","$controller","$timeout","$q",o.bootstrap]),c("directive",function(a,b){j.directive(a,b)}),c("filter",function(a,b){k.register(a,b)}),c("service",function(a,b){return i.service(a,b),e.get(a)}),c("provider",function(a,b){return i.provider(a,b)}),c("injectComponent",function(b,c,d){var i;if(!c)throw"Trying to show undefined component.";if("function"==typeof c)return c.apply({},[b,d]);if(Array.isArray(c)){var j={$element:b,input:d};for(var k in d)d.hasOwnProperty(k)&&(j[k]=d[k]);return e.invoke(c,{},j)}if(c.controller){var l=a(b).scope();return l||(l=f),o.$apply(l,function(){var a=l.$new();a.extractComponent=function(){a.$$destroyed||(a.$destroy(),b.off(".qvangularcoreshowcomponent"),b.html(""))},a.destroyComponent=a.extractComponent;var e={$scope:a,$element:b,$transclude:void 0,input:d};for(var f in d)d.hasOwnProperty(f)&&(e[f]=d[f],a[f]=d[f]);b.html(c.template);var j=g(b.contents());c.controller&&(i=h(c.controller,e),b.contents().data("$ngControllerController",i)),j(a),b.on("remove.qvangularcoreshowcomponent",function(){a.$$destroyed||a.$destroy()})}),i}}),c("componentDirective",function(a,b,c){var d={};for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);d[a]="=",d.input="=",d.component="=",o.directive(a,["$http","$templateCache","$compile","$controller",function(a,b,e,f){return{restrict:"EA",replace:!0,terminal:!0,scope:d,link:function(a,b,d){var g,h=0;a.$watch("component",function(i){var j=++h;if(i||(i=c),i&&i.template){if(j!==h)return;g&&g.$destroy(),g=a.$new(),b.html(i.template);var k=e(b.contents()),l={$scope:g,$element:b,$attrs:d};if(a.input&&i.scope&&n.forEach(i.scope,function(b,c){var d;d="string"==typeof b&&"="===b.charAt(0)&&b.length>1?b.substring(1):c,g[d]=a.input[c];var e=g[d];g.$watch(function(){var b=a.input[c];return b!==g[d]&&(b!==e?e=g[d]=b:a.input[c]=e=g[d]),b})}),a.input){for(var m in a.input)a.input.hasOwnProperty(m)&&(l[m]=a.input[m]);l.input=a.input}if(i.controller){var o=f(i.controller,l);b.contents().data("$ngControllerController",o)}k(g)}else g&&(g.$destroy(),g=null),b.html("")})}}}])}),q.push({name:"componentDirective",fn:function(){o.componentType=o.componentDirective,o.componentDirective("qvaInclude",{ngModel:"="})}}),b.autoBootstrap){var r=Object.keys(window.qvangularNgModules||[]),s=(window.angular.mock?["ngMock","qlik-angular"]:["qlik-angular"]).concat(r);n.bootstrap(document,s)}return o.$apply=function(a,b){return o.isBootstrapped?void(b?a.$root.$$phase?b&&b():a.$apply(b):(b=a,"function"==typeof b?o.$rootScope.$$phase?b():o.$rootScope.$apply(b):b&&b.$apply&&(o.$rootScope.$$phase||a.$apply()))):b&&b()||null},o.defer=function(){return m.defer()},o.when=function(a,b,c){return m.when(a,b,c)},o.promise=function(a){return l(function(){return a})},o.getService=function(a){return e.get(a)},a.fn.showComponent=function(a,b){return"string"==typeof a?o.injectComponent(this,{template:a,controller:b||function(){}},{}):o.injectComponent(this,a,b)},o.$applyify=d,window.qvangularGlobal=o,o}),define("assets/qvangular/qvangular-locale",["assets/qvangular/qvangular-core","translator"],function(a,b){a.directive("qPlaceholder",function(){return{restrict:"A",link:function(a,c,d){d.ngDisabled?a.$watch(d.ngDisabled,function(a){a?c.attr("placeholder",""):c.attr("placeholder",b.get(d.qPlaceholder))}):c.attr("placeholder",b.get(d.qPlaceholder))}}}),a.directive("qSimpleTranslation",function(){return{restrict:"A",link:function(a,c,d){function e(a){c.text(b.get(a))}b.ready.then(function(){d.$observe("qTranslation",e)})}}}),a.directive("qTranslation",function(){return{restrict:"A",link:function(a,c,d){function e(a){var e,f,g,h=a.split(","),i=JSON.parse(d.qHtmlTranslationIndexes||"null"),j=i?"html":"text",k=h[0].indexOf("|");for(f=k>=0&&h.length>=2?"1"===h[1]?h[0].substring(0,k).trim():h[0].substring(k+1).trim():h[0],e=b.get(f),i&&h.push.apply(h,i),g=1;g<h.length;g++)e=e.replace("{"+(g-1)+"}",h[g]);c[j](e)}b.ready.then(function(){d.$observe("qTranslation",e),e(d.qTranslation)})}}}),a.directive("translate",function(){return function(a,c,d){function e(a){a?"string"==typeof a?(c.attr("data-translation",a),c.removeAttr("data-text")):(c.attr("data-translation",a.id),c.data("text",{value:a.value})):(c.removeAttr("data-translation"),c.removeAttr("data-text")),b.apply(c[0])}a.$watch(d.translate,e)}}),a.directive("qTitleTranslation",function(){return{restrict:"A",link:function(a,c,d){function e(a){a?c.attr("title",b.get(a)):c.removeAttr("title")}b.ready.then(function(){d.$observe("qTitleTranslation",e),e(d.qTitleTranslation)})}}}),a.filter("translate",function(){return function(a){return b.get(a)}}),a.filter("translatetoupper",function(){return function(a){return b.get(a).toUpperCase()}})}),define("assets/qvangular/qvangular-filters",["assets/qvangular/qvangular-core"],function(a){a.filter("qvCropString",function(){function a(a,b){return"undefined"!=typeof b&&a.length>b&&(a=a.substr(0,b)+"..."),a}return a}),a.filter("qvOptStringExpression",function(){function a(a){return"object"==typeof a&&(a=a.qStringExpression.qExpr,a.length&&"="===a[0]||(a="="+a)),a}return a}),a.filter("qvToArray",function(){return function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}}),a.filter("qvFirstToUpper",function(){return function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}})}),define("assets/qvangular/qvangular-highlight/highlight",["general.utils/string-normalization","util","encoder"],function(a,b,c){function d(){return{scope:{text:"@",query:"="},restrict:"EA",replace:!0,link:function(b,c){b.$watchCollection("[text, query]",function(){var e=a.string(b.query);if(!e)return void c.text(b.text);var f=d.highlightMatches(a.string(b.text),e,"qui-texthighlight",b.text);c.html(f)})}}}return d.highlightMatches=function(a,b,e,f){return d.markMatches(a,b,f).map(function(a){return a.match?"<span "+c.encodeForAttr("class",e)+">"+c.encodeForHTML(a.text)+"</span>":c.encodeForHTML(a.text)}).join("")},d.markMatches=function(a,c,d){d=a;for(var e=[],f=0,g=new RegExp(b.escapeRegExp(c),"gi");;){var h=g.exec(a);if(!h){f<a.length&&e.push({text:d.substring(f),match:!1});break}h.index>f&&e.push({text:d.substring(f,h.index),match:!1}),e.push({text:d.substring(h.index,g.lastIndex),match:!0}),f=g.lastIndex}return e},d}),define("general.utils/dom-util",["jquery"],function(a){"use strict";var b={};return b.getParentElementWithAttribute=function(a,b,c){for(var d=!1,e=0;a&&a.parentNode&&100>e&&!d;){if(e++,a.nodeName===b.toUpperCase()&&a.hasAttribute(c))return d=!0,a;a=a.parentNode}return d?void 0:null},b.getAncestorsUntil=function(a,b){var c=[];for(b||(b=function(){return!1});a&&a.parentNode&&!b(a);)c.push(a),a=a.parentNode;return c},b.isInput=function(a){return a&&("INPUT"===a.tagName||"SELECT"===a.tagName||"TEXTAREA"===a.tagName||a.isContentEditable)},b.elementFromEventPosition=function(a){var b=document,c=b.body,d=a.pageX+(b&&b.clientLeft||c&&c.clientLeft||0)-(b&&b.scrollLeft||c&&c.scrollLeft||0),e=a.pageY+(b&&b.clientTop||c&&c.clientTop||0)-(b&&b.scrollTop||c&&c.scrollTop||0);return document.elementFromPoint(d,e)},b.scrollElmentIntoView=function(b,c,d){var e;if(e=c instanceof a?c:b.closest(c),e.length){var f,g=e.offset().top,h=g+e.height(),i=b.offset().top,j=i+b.outerHeight(),k=j-i,l=h-g;f=b[0].getBoundingClientRect().top,d?(f-=e.height()/2,e.scrollTop(e.scrollTop()+f)):k>l?(f=i-g,e.scrollTop(e.scrollTop()+f)):j>h?(f=j-h,e.scrollTop(e.scrollTop()+f)):g>i&&(f=i-g,e.scrollTop(e.scrollTop()+f))}},b.getAction=function(b,c,d){var e,f,g,h=(d?a(b.target).closest("[data-action]"):a(b.target).parent())[0];return b.target.getAttribute("data-action")?(e=b.target.getAttribute("data-action"),f=a(b.target)):h&&h.getAttribute("data-action")&&(e=h.getAttribute("data-action"),f=a(h)),e&&c&&(g=a(f.closest(c)).scope()),{action:e,element:f,scope:g}},b}),define("assets/qvangular/qvangular-directives",["jquery","assets/qvangular/qvangular-core","angular","assets/qvangular/qvangular-highlight/highlight","general.utils/dom-util","touche"],function(a,b,c,d,e,f){function g(a,c){b.directive(a,["$parse",function(b){return function(d,e,f){for(var g=f[a].split(";"),h=0;h<g.length;h++){var i=g[h].trim().split("#"),j=i[0],k=b(i[1]);!function(a,b){e.on(c,j,function(a){d.$apply(function(){b(d,{$event:a})})})}(j,k)}}}])}function h(b,c,d){return["$parse",function(e){return{restrict:"A",link:function(f,g,h){var i=e(h[b]),j=function(a){c&&c!==a.which||setTimeout(function(){a.preventDefault(),f.$apply(function(){i(f,{$event:a})})})};a(d?d:g).bind("keydown",j),f.$on("$destroy",function(){a(d?d:g).unbind("keydown",j)})}}}]}b.directive("qvaBlur",["$parse",function(a){return function(c,d,e){var f=a(e.qvaBlur);d.bind("blur",function(a){b.$apply(c,function(){f(c,{$event:a})})})}}]),b.directive("qvaDblclick",["$parse",function(a){return function(b,c,d){var e=a(d.qvaDblclick),g="qva-dblclick"+b.$id;f(c[0]).doubletap({id:g,options:{timeThreshold:250,preventDefault:!1},end:function(){b.$apply(e)}}),b.$on("$destroy",function(){f(c[0]).off("doubletap",g)})}}]),b.directive("qvaDblclick",["$parse",function(a){return function(b,c,d){var e=a(d.qvaDblclick),g="qva-dblclick"+b.$id;f(c[0]).doubletap({id:g,options:{timeThreshold:250,preventDefault:!1},end:function(){b.$apply(e)}}),b.$on("$destroy",function(){f(c[0]).off("doubletap",g)})}}]),b.directive("qvaActivate",["$parse",function(b){return function(c,d,e){var f=b(e.qvaActivate);d.on("qv-activate keypress",function(b){var d="keypress"===b.type&&32===b.which;("keypress"!==b.type||d&&a(b.target).is(":input"))&&c.$apply(function(){f(c,{$event:b})})})}}]),b.directive("qvaScrollIntoView",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.qvaScrollIntoView,function(b){b.scrollSelector&&b.scroll&&a(function(){e.scrollElmentIntoView(c,b.scrollSelector)})},!0)}}}]),b.directive("qvaPreventDrag",function(){return{restrict:"A",link:function(a,b){b.on("qv-press",function(a){a.preventDefault()})}}}),b.directive("qvaPress",["$parse",function(a){return function(b,c,d){var e=a(d.qvaPress);c.on("qv-press",function(a){b.$apply(function(){e(b,{$event:a})})})}}]),b.directive("qvaContextMenu",["$parse",function(a){return function(b,c,d){var e=a(d.qvaContextMenu);c.bind("qv-contextmenu",function(a){b.$apply(function(){e(b,{$event:a})})})}}]),b.directive("qvaRadialContextMenu",["$parse",function(a){return function(b,c,d){var e=a(d.qvaRadialContextMenu);c.bind("qv-radial-contextmenu",function(a){b.$apply(function(){e(b,{$event:a})})})}}]),b.directive("qvaSwipeUpdate",["$parse",function(a){return function(b,c,d){var e=a(d.qvaSwipeUpdate);c.bind("qv-swipeupdate",function(a){b.$apply(function(){e(b,{$event:a,$element:c})})})}}]),b.directive("qvaSwipe",["$parse",function(a){return function(b,c,d){var e=a(d.qvaSwipe);c.bind("qv-swipe",function(a){b.$apply(function(){e(b,{$event:a,$element:c})})})}}]),b.directive("qvaLoad",["$parse",function(a){return function(b,c,d){var e=a(d.qvaLoad);c.on("load",function(a){b.$apply(function(){e(b,{$event:a})})})}}]),g("qvaDelegatedClick","click"),g("qvaDelegatedActivate","qv-activate"),b.directive("qvaIndeterminate",["$parse",function(){return function(a,b,c){var d=c.qvaIndeterminate;b.prop("indeterminate",d===!0||"true"===d),a.$watch(c.qvaIndeterminate,function(a){b.prop("indeterminate",a===!0||"true"===a)})}}]),b.directive("qvaOutside",["$parse",function(b){return function(c,d,e){var f=b(e.qvaOutside),g=!1,h=!1;d.bind("qv-outside",function(b){g="allOutside"===a(b.target).attr("qva-outside-ignore-for")||a(b.target).closest('[qva-outside-ignore-for="allOutside"]').length,h=a(b.target).data("overrideignore"),(!g||h)&&(e.qvaOutsideIgnoreFor&&e.qvaOutsideIgnoreFor===a(b.target).closest("[qva-outside-ignore-for]").attr("qva-outside-ignore-for")||c.$apply(function(){f(c,{$event:b})}))})}}]),b.directive("qvaOnDragstart",["$parse",function(b){return function(c,d,e){if("ondragstart"in window){var f=b(e.qvaOnDragstart);c.$watch(e.qvaDragDisabled,function(b){b||d.attr("draggable","true").addClass("draggable").on("dragstart",function(b){a(this).addClass("dragging"),f(c,{$event:b})}).on("dragend",function(){a(this).removeClass("dragging")}).on("selectstart",function(a){var b=a.originalEvent.target;b.dragDrop&&b.dragDrop()}).on("mousedown","button",function(a){a.preventDefault()})})}}}]),b.directive("qvaModelOnblur",function(){return{restrict:"A",require:"ngModel",priority:1,link:function(a,b,c,d){"radio"!==c.type&&"checkbox"!==c.type&&(b.unbind("input keydown change compositionend"),b.bind("blur",function(){a.$apply(function(){"undefined"!=typeof c.qvaCancelEditingOnEmpty&&""===b.val().trim()?b.val(d.$modelValue):d.$setViewValue(b.val())})}),b.bind("keydown",function(a){27===a.which?(a.stopPropagation(),b.val(d.$modelValue),b.closest("*[tabindex]").focus()):13===a.which&&(a.stopPropagation(),b.closest("*[tabindex]").focus())}))}}}),b.directive("qvaSelect",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){(0===d.qvaSelect.length||"true"===d.qvaSelect)&&a(function(){"ontouchstart"in window||c[0].select()})}}}]),b.directive("qvaSelectWatch",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.qvaSelectWatch,function(b){(""===d.qvaSelectWatch||""!==d.qvaSelectWatch&&b===!0)&&a(function(){"ontouchstart"in window||c[0].select()})},!0)}}}]),b.directive("qvaFallbackSrc",function(){return{restrict:"A",link:function(a,b,d){b.bind("error",function(){c.element(this).attr("src",d.qvaFallbackSrc)})}}}),b.directive("qvaFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.qvaFocus,function(b){b===!0&&a(function(){c[0].focus()})},!0)}}}]),b.directive("qveHighlight",d),b.directive("qvaReportedWindowSize",function(){return{restrict:"A",link:function(c,d,e){function f(){b.$apply(function(){c[e.qvaReportedWindowSize]={width:a(window).width(),height:a(window).height()}})}f(),a(window).bind("resize",f),c.$on("$destroy",function(){a(window).unbind("resize",f)})}}}),b.directive("qvGlobalKeydown",h("qvGlobalKeydown",void 0,a("body"))),b.directive("qvGlobalEscape",h("qvGlobalEscape",27,a("body"))),b.directive("qvGlobalEnter",h("qvGlobalEnter",13,a("body"))),b.directive("qvKeydown",h("qvKeydown",void 0)),b.directive("qvEscape",h("qvEscape",27)),b.directive("qvEnter",h("qvEnter",13))}),define("qvangular",["assets/qvangular/qvangular-core","assets/qvangular/qvangular-locale","assets/qvangular/qvangular-filters","assets/qvangular/qvangular-directives"],function(a){return a}),define("core.utils/deferred",["qvangular"],function(a){var b;return b=function(){var b=a.getService("$q").defer();return b},b.resolve=function(b){var c=a.getService("$q").defer();return c.resolve(b),c.promise},b.reject=function(){return a.getService("$q").reject.apply(null,arguments)},b.all=function(){return a.getService("$q").all.apply(null,arguments)},b.when=function(){return a.getService("$q").when.apply(null,arguments)},b}),define("core.utils/class",[],function(){"use strict";var a=/xyz/.test(function(){})?/\b_super\b/:/.*/,b=function(){};return b.extend=function c(b,d){var e=this.prototype;"string"!=typeof b&&(d=b,b="Class");var f=Object.create(this.prototype);for(var g in d)f[g]="function"==typeof d[g]&&"function"==typeof e[g]&&a.test(d[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,d[g]):d[g];if(!/^[_a-z][_a-z\d]*$/i.test(b))throw new Error("Invalid subclass name. Alphanumericals only.");var h=new Function("return (function "+b+"(){ typeof this.init === 'function' && this.init.apply(this, [].slice.call(arguments)) });")();return h.prototype=f,h.prototype.constructor=h,h.extend=c,h},b}),define("core.utils/notification",[],function(){"use strict";var a,b,c=!1;return a=function(a,b){if(c!==!0)throw new Error("This class can't be instantiated directly.");this.observers=[],this.receiver=a,Object.defineProperty(this,"name",{get:function(){return b}})},a.prototype.bind=function(b){if("function"!=typeof b)throw new Error("Observer must be a function.");if(b===a.prototype.emit)throw new Error("Observer cannot be proxied this way. Use a wrapper function.");this.observers.push(b)},a.prototype.once=function(a){function b(){c.unbind(b),a.apply(c.receiver,arguments)}var c=this;b.onceObserver=a,c.bind(b)},a.prototype.unbind=function(a){var b;b=this.observers.reduce(function(b,c,d){return-1!==b?b:c===a||c.onceObserver===a?d:-1},-1),-1!==b&&this.observers.splice(b,1)},a.prototype.emit=function(){var a=this.receiver,b=Array.prototype.slice.call(arguments);this.observers.forEach(function(c){c.apply(a,b)})},a.prototype.release=function(){var a=this.receiver;delete a[this.name],Object.keys(b.prototype).forEach(function(b){delete a[b]}),this.receiver=null,this.observers=null},a.create=function(b,d){if(!b)throw new Error("Not a valid receiver.");if("string"!=typeof d)throw new Error("Nofification name not optional.");if(!/^([A-Z][a-z]+)+$/.test(d))throw new Error("The notification name must be PascalCased.");if(d in b)throw new Error("A property named '"+d+"' is already present on the receiver.");return c=!0,b[d]=new a(b,d),c=!1,b[d]},a.mixin=function(a){if(!a)throw new Error("Not a valid receiver.");Object.keys(b.prototype).forEach(function(c){if(c in a)throw new Error("A property named '"+c+"' is already present on the receiver.");a[c]=b.prototype[c]})},a.release=function(b){Object.keys(b).forEach(function(c){var d=b[c];d instanceof a&&d.release()})},b={prototype:{notification:function(b){return a.create(this,b)}}},a}),define("objects.backend-api/engine-throttle",["jquery","core.utils/class","core.utils/notification","util"],function(a,b,c,d){function e(a,b){var c=this;this.queuedRequests.push(a),clearTimeout(this._debounceTimer),b>=10?this._debounceTimer=setTimeout(function(){f.call(c)},b):f.call(c)}function f(){if(this.ongoingRequests.length)return void(this.waitingForResponse=!0);var a=this.queuedRequests.pop();for(a&&g.call(this,a);this.queuedRequests.length;)a=this.queuedRequests.shift(),a.dfd.reject()}function g(a){this.waitingForResponse=!1,this.ongoingRequests.push(a);var b=this,c=a.wrapper;a.sentAt=Date.now(),c.then(function(){b.ongoingRequests.splice(b.ongoingRequests.indexOf(a),1),a.respondedAt=Date.now(),b.resolvedRequests.push({sentAt:a.sentAt,respondedAt:a.respondedAt,requestedAt:a.requestedAt}),b.resolvedRequests.length>10&&(b.resolvedRequests=b.resolvedRequests.slice(-10)),a.requestedAt>b._latestResolvedRequestedAt?a.dfd.resolve.apply(a.dfd,[].slice.call(arguments)):a.dfd.reject(),b._latestResolvedRequestedAt=a.requestedAt},function(){b.ongoingRequests.splice(b.ongoingRequests.indexOf(a),1),a.respondedAt=Date.now(),a.dfd.reject.apply(a.dfd,[].slice.call(arguments))}).always(function(){b.waitingForResponse&&f.call(b)}),this.Send.emit(a.data,c)}var h,i={enabled:!0,delay:50};return h=b.extend("Throttle",{init:function(){this.options={},this.ongoingRequests=[],this.queuedRequests=[],this.recentRequests=[],this.resolvedRequests=[],this._debounceTimer=null,this._latestResolvedRequestedAt=-1,c.mixin(this),this.notification("Send"),this.notification("Cancel"),this.setOptions({})},destroy:function(){this.clear(),this.recentRequests=[],this.resolvedRequests=[],c.release(this)},setOptions:function(a){this.options=d.extend(!0,{},i,this.options,a),this.enabled=this.options.enabled||!1,this.delay=this.options.delay||-1},clear:function(){clearTimeout(this._debounceTimer);for(var a;this.queuedRequests.length;)a=this.queuedRequests.pop(),a.dfd.reject();for(;this.ongoingRequests.length;)a=this.ongoingRequests.pop(),a.dfd.reject()},queue:function(b){var c=this.enabled?this.delay:-1,d={data:b,dfd:new a.Deferred,wrapper:new a.Deferred,requestedAt:Date.now()},f=Math.max(this._getAvgResolutionTime(),c);return 1>c||this.recentRequests.length<1||Date.now()-this.recentRequests.slice(-1)[0].requestedAt>f?e.apply(this,[d,0]):e.apply(this,[d,Math.min(c,1e3)]),this.recentRequests.push(d),this.recentRequests.length>10&&(this.recentRequests=this.recentRequests.slice(-10)),d.dfd.promise()},updateResolutionTime:function(){this._latestResolvedRequestedAt=Date.now()},_getAvgResolutionTime:function(){var a;return this.resolvedRequests.length&&(a=0,this.resolvedRequests.forEach(function(b){a+=b.respondedAt-b.sentAt}),a/=this.resolvedRequests.length),a}})}),define("objects.utils/shapes/geometry-math",[],function(){"use strict";var a,b=1e-12;return a={checkPointsCoincident:function(a,b){return a.x===b.x&&a.y===b.y?!0:!1},checkPointOnLineSegment2:function(c,d,e){var f,g,h,i;return f=e.x-d.x,g=e.y-d.y,0===f?0===g?a.checkPointsCoincident(c,d):c.x!==d.x?!1:(h=(c.y-d.y)/g,h>=0&&1>=h?!0:!1):0===g?c.y!==d.y?!1:(h=(c.x-d.x)/f,h>=0&&1>=h?!0:!1):(h=(c.x-d.x)/f,i=(c.y-d.y)/g,h>=0&&1>=h&&Math.abs(h-i)<b?!0:!1)},checkPointOnLineSegment:function(b,c){return a.checkPointOnLineSegment2(b,c[0],c[1])},checkLineSegmentIntersectingLineSegment2:function(b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r;if(f=c.x-b.x,g=c.y-b.y,h=e.x-d.x,i=e.y-d.y,j=b.x-d.x,k=b.y-d.y,n=i*f-h*g,l=h*k-i*j,m=f*k-g*j,0===n){if(0===l&&0===m){if(0===f){if(0===g)return a.checkPointOnLineSegment2(b,d,e);q=(d.y-b.y)/g,r=(e.y-b.y)/g}else q=(d.x-b.x)/f,r=(e.x-b.x)/f;return 0>q&&0>r||q>1&&r>1?!1:!0}return!1}return o=l/n,p=m/n,o>=0&&1>=o&&p>=0&&1>=p?!0:!1},checkLineSegmentIntersectingLineSegment:function(b,c){return a.checkLineSegmentIntersectingLineSegment2(b[0],b[1],c[0],c[1])},checkPointInsideRectDefinedByMaxMin:function(a,b){return a.x>b.minX&&a.x<b.maxX&&a.y>b.minY&&a.y<b.maxY},checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin:function(a,b){return a.x>=b.minX&&a.x<=b.maxX&&a.y>=b.minY&&a.y<=b.maxY},checkLineSegmentIntersectingRectDefinedByMaxMin:function(b,c){return a.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(b[0],c)||a.checkPointInsideOrOnBoundaryOfRectDefinedByMaxMin(b[0],c)?!0:a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.minY},{x:c.minX,y:c.maxY}])?!0:a.checkLineSegmentIntersectingLineSegment(b,[{x:c.maxX,y:c.minY},{x:c.maxX,y:c.maxY}])?!0:a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.minY},{x:c.maxX,y:c.minY}])?!0:a.checkLineSegmentIntersectingLineSegment(b,[{x:c.minX,y:c.maxY},{x:c.maxX,y:c.maxY}])?!0:!1},checkPolylineIntersectingRectDefinedByMaxMin:function(b,c){var d,e,f,g,h,i,j,k=b?b.length:0;if(0===k)return!1;if(e=b[0],e.x>c.maxX)return!1;if(e.x>=c.minX&&e.y>=c.minY&&e.y<=c.maxY)return!0;for(d=e,
f=1;k>f;f++){if(e=b[f],e.x>=c.minX&&e.x<=c.maxX&&e.y>=c.minY&&e.y<=c.maxY)return!0;if(g=Math.min(d.x,e.x),g>c.maxX)return!1;if(h=Math.max(d.x,e.x),h<c.minX)d=e;else if(i=Math.min(d.y,e.y),i>c.maxY)d=e;else if(j=Math.max(d.y,e.y),j<c.minY)d=e;else{if(a.checkLineSegmentIntersectingRectDefinedByMaxMin([d,e],c))return!0;d=e}}return!1},checkPolylinesIntersectingRectDefinedByMaxMin:function(b,c){var d,e=b?b.length:0;for(d=0;e>d;d++)if(a.checkPolylineIntersectingRectDefinedByMaxMin(b[d],c))return!0;return!1},calculateBounds:function(a){var b,c,d,e,f,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=Number.MAX_VALUE,j=-Number.MAX_VALUE,k=a?a.length:0;if(0===k)return null;for(d=0;k>d;d++)b=a[d],c=b?b.calculateBounds():void 0,c&&c.x!==1/0&&(e=c.getRight(),f=c.getBottom(),e>h&&(h=e),c.x<g&&(g=c.x),f>j&&(j=f),c.y<i&&(i=c.y));return{x:g,y:i,width:h-g,height:j-i}}}}),define("objects.utils/shapes/line",["./geometry-math"],function(a){"use strict";function b(a,b,c,d){0===arguments.length?this.set(0,0,0,0):2===arguments.length?this.set(a.x,a.y,b.x,b.y):this.set(a,b,c,d)}return b.prototype={toString:function(){return this.x1+" "+this.y1+" "+this.x2+" "+this.y2},clone:function(){return new b(this.x1,this.y1,this.x2,this.y2)},set:function(a,b,c,d){this.x1=a,this.y1=b,this.x2=c,this.y2=d},intersectsLine:function(b){return a.checkLineSegmentIntersectingLineSegment(this.getPoints(),b.getPoints())},intersectsRect:function(a){return this.intersectsLine(new b(a.x,a.y,a.x+a.width,a.y))||this.intersectsLine(new b(a.x+a.width,a.y,a.x+a.width,a.y+a.height))||this.intersectsLine(new b(a.x,a.y+a.height,a.x+a.width,a.y+a.height))||this.intersectsLine(new b(a.x,a.y,a.x,a.y+a.height))},getPoints:function(){var a=[];return a.push({x:this.x1,y:this.y1}),a.push({x:this.x2,y:this.y2}),a}},b}),define("objects.utils/shapes/rect",["./line"],function(a){"use strict";function b(a,b,c,d){0===arguments.length?this.set(0,0,0,0):this.set(a,b,c,d)}return b.prototype={toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height},clone:function(){return new b(this.x,this.y,this.width,this.height)},set:function(a,b,c,d){c>=0?(this.x=a,this.width=c):(this.x=a+c,this.width=-c),d>=0?(this.y=b,this.height=d):(this.y=b+d,this.height=-d)},setLTRB:function(a,b,c,d){c>=a?(this.x=a,this.width=c-a):(this.x=c,this.width=a-c),d>=b?(this.y=b,this.height=d-b):(this.y=d,this.height=b-d)},equal:function(a){return a&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},combineWith:function(a){var c,d,e,f,g=Math.max(a.getRight(),this.getRight()),h=Math.max(a.getBottom(),this.getBottom());return c=Math.min(a.x,this.x),d=Math.min(a.y,this.y),e=Math.max(0,g-c),f=Math.max(0,h-d),new b(c,d,e,f)},intersectsWith:function(a){return a&&this.x<=a.getRight()&&a.x<=this.getRight()&&this.y<=a.getBottom()&&a.y<=this.getBottom()?!0:!1},intersectsRect:function(a){return this.intersectsWith(a)},intersection:function(a,c){var d,e,f,g;return this.intersectsWith(a)?(d=Math.max(this.x,a.x),e=Math.max(this.y,a.y),f=Math.min(this.getRight(),a.getRight()),g=Math.min(this.getBottom(),a.getBottom()),new b(d,e,f-d,g-e)):c?null:new b(this.x,this.y,this.width,this.height)},union:function(a){var c,d,e,f;return c=Math.min(this.x,a.x),d=Math.min(this.y,a.y),e=Math.max(this.getRight(),a.getRight()),f=Math.max(this.getBottom(),a.getBottom()),new b(c,d,e-c,f-d)},pointInside:function(a,b){return a>=this.x&&a<=this.getRight()&&b>=this.y&&b<=this.getBottom()},rectInside:function(a){var b,c=a.getPoints();for(b=0;4>b;b++)if(!this.pointInside(c[b].x,c[b].y))return!1;return!0},intersectsLine:function(b){var c=this.getRight(),d=this.getBottom();return this.pointInside(b.x1,b.y1)||this.pointInside(b.x2,b.y2)?!0:b.intersectsLine(new a(this.x,this.y,c,this.y))||b.intersectsLine(new a(c,this.y,c,d))||b.intersectsLine(new a(c,d,this.x,d))||b.intersectsLine(new a(this.x,d,this.x,this.y))?!0:!1},getPoints:function(){var a=[];return a.push({x:this.x,y:this.y}),a.push({x:this.getRight(),y:this.y}),a.push({x:this.getRight(),y:this.getBottom()}),a.push({x:this.x,y:this.getBottom()}),a},getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},getCenterPoint:function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},getBoundingRect:function(){return this},scale:function(a){var b=a-1,c=b*this.width/2,d=b*this.height/2;this.x-=c,this.y-=d,this.width*=a,this.height*=a},hasNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.width)||isNaN(this.height)}},b}),define("objects.backend-api/cube-slicer",["core.utils/class","objects.utils/shapes/rect"],function(a,b){"use strict";var c,d=new b(0,0,0,0),e=new b(0,0,0,0);return c=a.extend("CubeSlicer",{init:function(){this.pages=[]},get:function(a){return a.map(function(a){return this.getPage(a)}.bind(this))},getPage:function(a){var c,f,g,h=[];for(f=0;f<this.pages.length;f++)if(c=this.pages[f].qArea,d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(c.qLeft,c.qTop,c.qWidth,c.qHeight),g=e.intersection(d,!0),h.push({coverage:g?g.clone():new b(0,0,0,0),idx:f}),c.qLeft<=a.qLeft&&c.qLeft+c.qWidth>=a.qLeft+a.qWidth&&c.qTop<=a.qTop&&c.qTop+c.qHeight>=a.qTop+a.qHeight)return this._extract(a,this.pages[f]);return h.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),h[0].coverage.height>0&&h[0].coverage.width>0?this._extract(a,this.pages[h[0].idx]):{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qMatrix:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(a){this.pages=a},containsArea:function(a){for(var b,c=0;c<this.pages.length;c++)if(b=this.pages[c].qArea,b.qLeft<=a.qLeft&&b.qLeft+b.qWidth>=a.qLeft+a.qWidth&&b.qTop<=a.qTop&&b.qTop+b.qHeight>=a.qTop+a.qHeight)return!0;return!1},contains:function(a){return this.pages&&this.pages.length?0===a.filter(function(a){return!this.containsArea(a)}.bind(this)).length:!1},_extract:function(a,b){d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(b.qArea.qLeft,b.qArea.qTop,b.qArea.qWidth,b.qArea.qHeight);var c,f,g,h=d.intersection(e,!0);return h?(g=Math.max(0,a.qTop-b.qArea.qTop),f=Math.max(0,a.qLeft-b.qArea.qLeft),c=b.qMatrix.slice(g,g+h.height).map(function(a){return a.slice(f,f+h.width)}),{qArea:{qTop:h.y,qLeft:h.x,qWidth:h.width,qHeight:h.height},qMatrix:c}):{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qMatrix:[]}}})}),define("objects.backend-api/pivot-cube-slicer",["./cube-slicer","objects.utils/shapes/rect"],function(a,b){"use strict";function c(a,b){var c,d={};for(c in a)"qSubNodes"!==c&&a.hasOwnProperty(c)&&(d[c]=a[c]);return b.push(d),d}function d(a,b,e){var g,h,i,j=[],k=[],l=0,m=0;for(e.length&&(l=e[0].qUp||0,m=e[e.length-1].qDown||0),g=0;g<e.length;++g)if(h=e[g],h.qSubNodes.length>0&&(k=d(a,b,h.qSubNodes)),i=null,(0===h.qSubNodes.length&&f>=a&&a+b>=f||k.length>0)&&(i=c(h,j),void 0!==i.qUp&&1===j.length&&(i.qUp=l+g),i.qSubNodes=k),0===h.qSubNodes.length&&f++,f===a+b){i&&void 0!==i.qDown&&(i.qDown=m+(e.length-1-g));break}return j}function e(a,b,c){return f=0,d(a,b,c)}var f,g,h=new b(0,0,0,0),i=new b(0,0,0,0);return g=a.extend("PivotCubeSlicer",{init:function(){this._super(),this.requestedAreas=[]},getPage:function(a){var c,d,e,f=[];for(d=0;d<this.pages.length;d++)if(c=this.pages[d].qArea,h.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),i.set(c.qLeft,c.qTop,c.qWidth,c.qHeight),e=i.intersection(h,!0),f.push({coverage:e?e.clone():new b(0,0,0,0),idx:d}),c.qLeft<=a.qLeft&&c.qLeft+c.qWidth>=a.qLeft+a.qWidth&&c.qTop<=a.qTop&&c.qTop+c.qHeight>=a.qTop+a.qHeight)return this._extract(a,this.pages[d]);return f.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),f[0].coverage.height>0&&f[0].coverage.width>0?this._extract(a,this.pages[f[0].idx]):{qLeft:[],qTop:[],qData:[],qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0}}},_extract:function(a,b){var c,d;h.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),i.set(b.qArea.qLeft,b.qArea.qTop,b.qArea.qWidth,b.qArea.qHeight);var f,g,j,k=h.intersection(i,!0);return k?(j=Math.max(0,a.qTop-b.qArea.qTop),g=Math.max(0,a.qLeft-b.qArea.qLeft),f=b.qData.slice(j,j+k.height).map(function(a){return a.slice(g,g+k.width)}),c=e(j,k.height,b.qLeft),d=e(g,k.width,b.qTop),{qLeft:c,qTop:d,qData:f,qArea:{qTop:k.y,qLeft:k.x,qWidth:k.width,qHeight:k.height}}):{qLeft:[],qTop:[],qData:[],qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0}}}})}),define("objects.backend-api/cache-cube",["jquery","core.utils/class","util","objects.backend-api/engine-throttle","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function(a,b,c,d,e,f){var g,h={mode:"S",enabled:!0,debouncing:{enabled:!0,delay:50},height:250,width:250};return g=b.extend("CacheCube",{init:function(a,b,c,g){this.model=a,this.responseProperty=b,this.options={},this.cubeHeight=0,this.cubeWidth=0,this.setOptions(g||{}),this.setPath(c),"P"===this.options.mode?this.cube=new f:this.cube=new e,this.throttle=new d;var h=this;this.throttle.Send.bind(function(a,b){var c=h._getDirections(h.throttle.recentRequests.map(function(a){return{top:a.data[0].qTop,left:a.data[0].qLeft}})),d=h._getAreasToCache(a,c.vertical,c.horizontal);h.cacheData(d,a).then(function(a){h.cube?b.resolve(a):b.reject()},function(){b.reject()})}),this._modelBinding=function(){h.clear()},this.model.Invalidated.bind(this._modelBinding)},destroy:function(){this.cube.destroy(),this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle,delete this.cube},setMethodName:function(a){this.method=a},setPath:function(a){this.path=a},setCubeSize:function(a){this.cubeHeight=a.qcy,this.cubeWidth=a.qcx},setOptions:function(a){a&&(this.options=c.extend(!0,{},h,this.options,a),this.cacheHeight=this.options.height,this.cacheWidth=this.options.width,this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1})},clear:function(){this.cube.clear(),this.throttle.clear()},set:function(a){this.clear(),a&&a.length&&this.cube.store(a)},cacheData:function(a,b){return this.model.rpc(this.method,this.responseProperty,[this.path,a]).then(function(a){return this.cube?(this.cube.store(a),this.cube.get(b)):a}.bind(this))},getData:function(b){if(!this.enabled||!this.cubeHeight||!this.cubeWidth)return this.model.rpc(this.method,this.responseProperty,[this.path,b]);var c,d,e=[];for(c=0;c<b.length;++c)d=b[c],e.push({qTop:Math.max(Math.floor(d.qTop),0),qLeft:Math.max(d.qLeft,0),qHeight:Math.min(d.qHeight,this.cubeHeight-Math.floor(d.qTop)),qWidth:Math.min(d.qWidth,this.cubeWidth-d.qLeft)});return this.cube.contains(e)?(this.throttle.updateResolutionTime(),a.Deferred().resolve(this.cube.get(e)).promise()):0===e[0].qTop&&this.cube.isEmpty()?(this.throttle.updateResolutionTime(),this.cacheData(e,e)):this.throttle.queue(e)},_getDirections:function(a){if(!a||a.length<2)return{vertical:0,horizontal:0};var b=a.slice(-2),c=b[1].top-b[0].top,d=b[1].left-b[0].left;return{vertical:0>c?-1:c>0?1:0,horizontal:0>d?-1:d>0?1:0}},_getAreasToCache:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];for("undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),d=0;d<a.length;++d)e=0!==b?Math.floor(.5*Math.max(0,this.cacheHeight-a[d].qHeight)):0,f=0!==c?Math.floor(.5*Math.max(0,this.cacheWidth-a[d].qWidth)):0,g=e*b-e,h=f*c-f,i=0!==b?Math.max(0,Math.min(Math.max(a[d].qHeight,this.cacheHeight),this.cubeHeight)):a[d].qHeight,j=0!==c?Math.max(0,Math.min(Math.max(a[d].qWidth,this.cacheWidth),this.cubeWidth)):a[d].qWidth,k=Math.max(0,Math.min(a[d].qTop+g,this.cubeHeight-i)),l=Math.max(0,Math.min(a[d].qLeft+h,this.cubeWidth-j)),m.push({qTop:k,qHeight:i,qLeft:l,qWidth:j});return m}})}),define("objects.backend-api/backend-throttle",["core.utils/class","util","objects.backend-api/engine-throttle"],function(a,b,c){var d,e={enabled:!0,debouncing:{enabled:!0,delay:50}};return d=a.extend({init:function(a,b,d){this.model=a,this.responseProperty=b,this.options={},this.setOptions({}),this.setPath(d),this.throttle=new c,this.throttle.Send.bind(function(a,b){e.model.rpc(e.method,e.responseProperty,[e.path,a]).then(function(a){b.resolve(a)},function(){b.reject()})});var e=this;this._modelBinding=function(){e.clear()},this.model.Invalidated.bind(this._modelBinding)},setMethodName:function(a){this.method=a},setPath:function(a){this.path=a},setOptions:function(a){this.options=b.extend(!0,{},e,this.options,a),this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1}},clear:function(){this.throttle.clear()},destroy:function(){this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle},set:function(){this.clear()},getData:function(a){return this.enabled?this.throttle.queue(a):this.model.rpc(this.method,this.responseProperty,[this.path,a])}})}),define("core.utils/json-patch",["jquery"],function(a){function b(a){return a&&(a=i({},{val:a}).val),a}function c(a,b){return m(a[b])||"$$"===b.substring(0,2)||"_"===b.substring(0,1)}function d(a,b){var c,d="/",e=b.substring(1).split(d).slice(0,-1);return e.forEach(function(b,d){d!==e.length&&(c=+b,a=a[c||b]=l(a[c||b])?isNaN(c)?{}:[]:a[b])}),a}function e(a){Object.keys(a).forEach(function(b){var d=Object.getOwnPropertyDescriptor(a,b);d.configurable&&!c(a,b)&&delete a[b]})}function f(a,b){var c,d,e=!0;if(j(a)&&j(b))return Object.keys(a).length!==Object.keys(b).length?!1:(Object.keys(a).forEach(function(c){return f(a[c],b[c])?void 0:(e=!1,!1)}),e);if(k(a)&&k(b)){if(a.length!==b.length)return!1;for(c=0,d=a.length;d>c;c++)if(!f(a[c],b[c]))return!1;return!0}return a===b}function g(a,b,c){function d(a,b,c){if(a[c]&&l(a[c].qInfo))return null;if(a[c]&&a[c].qInfo.qId===b)return c;for(var d=0,e=a.length;e>d;d++)if(a[d]&&a[d].qInfo.qId===b)return d;return-1}var e,g,i=[],j=a.slice(),k=-1;if(f(b,j))return i;if(!l(b[0])&&l(b[0].qInfo))return i.push({op:"replace",path:c,value:b}),i;for(e=j.length-1;e>=0;--e)k=d(b,j[e].qInfo&&j[e].qInfo.qId,e),-1===k?(i.push({op:"remove",path:c+"/"+e}),j.splice(e,1)):i=i.concat(h.generate(j[e],b[k],c+"/"+e));for(e=0,g=b.length;g>e;++e)k=d(j,b[e].qInfo&&b[e].qInfo.qId),-1===k?(i.push({op:"add",path:c+"/"+e,value:b[e]}),j.splice(e,0,b[e])):k!==e&&(i.push({op:"move",path:c+"/"+e,from:c+"/"+k}),j.splice(e,0,j.splice(k,1)[0]));return i}var h={},i=function(){return a.extend.apply(a,[!0].concat(Array.prototype.slice.call(arguments)))},j=a.isPlainObject,k=Array.isArray,l=function(a){return"undefined"==typeof a},m=function(a){return"function"==typeof a};return h.generate=function(a,d,e){e=e||"";var i=[];return Object.keys(d).forEach(function(m){var n=b(d[m]),o=a[m],p=e+"/"+m;f(n,o)||c(d,m)||(l(o)?i.push({op:"add",path:p,value:n}):j(n)&&j(o)?i=i.concat(h.generate(o,n,p)):k(n)&&k(o)?i=i.concat(g(o,n,p)):i.push({op:"replace",path:e+"/"+m,value:n}))}),Object.keys(a).forEach(function(b){l(d[b])&&!c(a,b)&&i.push({op:"remove",path:e+"/"+b})}),i},h.apply=function(a,b){b.forEach(function(b){var c=d(a,b.path),f=b.path.split("/").splice(-1)[0],g=f&&isNaN(+f)?c[f]:c[+f]||c,h=b.from?b.from.split("/").splice(-1)[0]:null;if("add"===b.op||"replace"===b.op)if(k(c))"-"===f&&(f=c.length),c.splice(+f,"add"===b.op?0:1,b.value);else if(k(g)&&k(b.value)){var l=b.value.slice();g.length=0,g.push.apply(g,l)}else j(g)&&j(b.value)?(e(g),i(g,b.value)):c[f]=b.value;else if("move"===b.op){var m=d(a,b.from);k(c)?c.splice(+f,0,m.splice(+h,1)[0]):(c[f]=m[h],delete m[h])}else"remove"===b.op&&(k(c)?c.splice(+f,1):delete c[f])})},h.clone=function(a){return i({},a)},h.createPatch=function(a,b,c){var d={op:a.toLowerCase(),path:c};return"move"===d.op?d.from=b:"undefined"!=typeof b&&(d.value=b),d},h.updateObject=function(a,b){return Object.keys(a).length?void h.apply(a,h.generate(a,b)):void i(a,b)},h}),define("core.utils/debug-flags",["util"],function(a){var b="undefined"!=typeof window&&"undefined"!=typeof document,c=(b&&a.getParameterByName("debug")||"").split("+"),d={};return c.forEach(function(a){d[a.toUpperCase()]=!0}),d}),define("core.utils/permissions",[],function(){function a(a,b){return a.length||(a=["update","publish","export","exportdata","changeowner","delete"]),e&&(a=[]),b=b||{},b.update=-1!==a.indexOf("update"),b.publish=-1!==a.indexOf("publish"),b["export"]=-1!==a.indexOf("export"),b.exportData=-1!==a.indexOf("exportdata"),b.changeOwner=-1!==a.indexOf("changeowner"),b.remove=-1!==a.indexOf("delete"),b}function b(a,b){b=b||{};for(var c in b)delete b[c];return e?b:(a.forEach(function(a){a.canCreate&&(b["create"+a.resource[0].toUpperCase()+a.resource.substring(1)]=!0)}),b)}function c(c,f){var g={};return c.permissions||Object.defineProperty(c,"permissions",{configurable:!1,enumerable:!1,get:function(){return c&&(f&&(e=c.qReadOnly,b(c.create||d,g)),a(c.privileges||c.qMeta&&c.qMeta.privileges||[],g)),g}}),c}var d=[{resource:"sheet",canCreate:!0},{resource:"bookmark",canCreate:!0},{resource:"story",canCreate:!0},{resource:"dimension",canCreate:!0},{resource:"measure",canCreate:!0},{resource:"masterobject",canCreate:!0}],e=!0;return{mapToLayout:c,parse:a,parseCreate:b}}),define("core.utils/model-garbage-collector",["core.utils/notification","core.utils/debug-flags"],function(a,b){function c(a){return a.Invalidated&&a.Invalidated.observers&&0===a.Invalidated.observers.length}function d(){for(var a,d=g.length;d--;)a=g[d],b.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Checking model (id, handle, model):",a.id,a.handle,a),c(a)&&(e(a),g.splice(d,1))}function e(c){b.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Releasing model (id):",c.id),a.release(c);for(var d in c)delete c[d]}function f(a){g.push(a)}var g=[];return setInterval(d,1e4),{addToQueue:f}}),define("autogenerated/qix/engine-enums",[],function(){"use strict";return{NxLocalizedErrorCode:{LOCERR_INTERNAL_ERROR:-128,LOCERR_GENERIC_UNKNOWN:-1,LOCERR_GENERIC_OK:0,LOCERR_GENERIC_NOT_SET:1,LOCERR_GENERIC_NOT_FOUND:2,LOCERR_GENERIC_ALREADY_EXISTS:3,LOCERR_GENERIC_INVALID_PATH:4,LOCERR_GENERIC_ACCESS_DENIED:5,LOCERR_GENERIC_OUT_OF_MEMORY:6,LOCERR_GENERIC_NOT_INITIALIZED:7,LOCERR_GENERIC_INVALID_PARAMETERS:8,LOCERR_GENERIC_EMPTY_PARAMETERS:9,LOCERR_GENERIC_INTERNAL_ERROR:10,LOCERR_GENERIC_CORRUPT_DATA:11,LOCERR_GENERIC_MEMORY_INCONSISTENCY:12,LOCERR_GENERIC_INVISIBLE_OWNER_ABORT:13,LOCERR_GENERIC_PROHIBIT_VALIDATE:14,LOCERR_GENERIC_ABORTED:15,LOCERR_GENERIC_CONNECTION_LOST:16,LOCERR_GENERIC_UNSUPPORTED_IN_PRODUCT_VERSION:17,LOCERR_GENERIC_REST_CONNECTION_FAILURE:18,LOCERR_HTTP_400:400,LOCERR_HTTP_401:401,LOCERR_HTTP_402:402,LOCERR_HTTP_403:403,LOCERR_HTTP_404:404,LOCERR_HTTP_405:405,LOCERR_HTTP_406:406,LOCERR_HTTP_407:407,LOCERR_HTTP_408:408,LOCERR_HTTP_409:409,LOCERR_HTTP_410:410,LOCERR_HTTP_411:411,LOCERR_HTTP_412:412,LOCERR_HTTP_413:413,LOCERR_HTTP_414:414,LOCERR_HTTP_415:415,LOCERR_HTTP_416:416,LOCERR_HTTP_417:417,LOCERR_HTTP_500:500,LOCERR_HTTP_501:501,LOCERR_HTTP_502:502,LOCERR_HTTP_503:503,LOCERR_HTTP_504:504,LOCERR_HTTP_505:505,LOCERR_HTTP_509:509,LOCERR_APP_ALREADY_EXISTS:1e3,LOCERR_APP_INVALID_NAME:1001,LOCERR_APP_ALREADY_OPEN:1002,LOCERR_APP_NOT_FOUND:1003,LOCERR_APP_IMPORT_FAILED:1004,LOCERR_APP_SAVE_FAILED:1005,LOCERR_APP_CREATE_FAILED:1006,LOCERR_APP_INVALID:1007,LOCERR_APP_CONNECT_FAILED:1008,LOCERR_APP_ALREADY_OPEN_IN_DIFFERENT_MODE:1009,LOCERR_APP_MIGRATION_COULD_NOT_CONTACT_MIGRATION_SERVICE:1010,LOCERR_APP_MIGRATION_COULD_NOT_START_MIGRATION:1011,LOCERR_APP_MIGRATION_FAILURE:1012,LOCERR_CONNECTION_ALREADY_EXISTS:2e3,LOCERR_CONNECTION_NOT_FOUND:2001,LOCERR_CONNECTION_FAILED_TO_LOAD:2002,LOCERR_CONNECTION_FAILED_TO_IMPORT:2003,LOCERR_CONNECTION_NAME_IS_INVALID:2004,LOCERR_FILE_ACCESS_DENIED:3e3,LOCERR_FILE_NAME_INVALID:3001,LOCERR_FILE_CORRUPT:3002,LOCERR_FILE_NOT_FOUND:3003,LOCERR_FILE_FORMAT_UNSUPPORTED:3004,LOCERR_FILE_OPENED_IN_UNSUPPORTED_MODE:3005,LOCERR_USER_ACCESS_DENIED:4e3,LOCERR_USER_IMPERSONATION_FAILED:4001,LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS:5e3,LOCERR_SERVER_OUT_OF_SESSION_CALS:5001,LOCERR_SERVER_OUT_OF_USAGE_CALS:5002,LOCERR_SERVER_OUT_OF_CALS:5003,LOCERR_SERVER_OUT_OF_NAMED_CALS:5004,LOCERR_SERVER_OFF_DUTY:5005,LOCERR_SERVER_BUSY:5006,LOCERR_SERVER_LICENSE_EXPIRED:5007,LOCERR_SERVER_AJAX_DISABLED:5008,LOCERR_HC_INVALID_OBJECT:6e3,LOCERR_HC_RESULT_TOO_LARGE:6001,LOCERR_HC_INVALID_OBJECT_STATE:6002,LOCERR_HC_MODAL_OBJECT_ERROR:6003,LOCERR_CALC_INVALID_DEF:7e3,LOCERR_CALC_NOT_IN_LIB:7001,LOCERR_CALC_HEAP_ERROR:7002,LOCERR_CALC_TOO_LARGE:7003,LOCERR_CALC_TIMEOUT:7004,LOCERR_CALC_EVAL_CONDITION_FAILED:7005,LOCERR_CALC_MIXED_LINKED_AGGREGATION:7006,LOCERR_CALC_MISSING_LINKED:7007,LOCERR_CALC_INVALID_COL_SORT:7008,LOCERR_CALC_PAGES_TOO_LARGE:7009,LOCERR_CALC_SEMANTIC_FIELD_NOT_ALLOWED:7010,LOCERR_CALC_VALIDATION_STATE_INVALID:7011,LOCERR_CALC_PIVOT_DIMENSIONS_ALREADY_EXISTS:7012,LOCERR_CALC_MISSING_LINKED_FIELD:7013,LOCERR_LAYOUT_EXTENDS_INVALID_ID:8e3,LOCERR_LAYOUT_LINKED_OBJECT_NOT_FOUND:8001,LOCERR_LAYOUT_LINKED_OBJECT_INVALID:8002,LOCERR_PERSISTENCE_WRITE_FAILED:9e3,LOCERR_PERSISTENCE_READ_FAILED:9001,LOCERR_PERSISTENCE_DELETE_FAILED:9002,LOCERR_PERSISTENCE_NOT_FOUND:9003,LOCERR_PERSISTENCE_UNSUPPORTED_VERSION:9004,LOCERR_PERSISTENCE_MIGRATION_FAILED_READ_ONLY:9005,LOCERR_PERSISTENCE_MIGRATION_CANCELLED:9006,LOCERR_PERSISTENCE_MIGRATION_BACKUP_FAILED:9007,LOCERR_PERSISTENCE_DISK_FULL:9008,LOCERR_PERSISTENCE_NOT_SUPPORTED_FOR_SESSION_APP:9009,LOCERR_PERSISTENCE_SYNC_SET_CHUNK_INVALID_PARAMETERS:9510,LOCERR_PERSISTENCE_SYNC_GET_CHUNK_INVALID_PARAMETERS:9511,LOCERR_SCRIPT_DATASOURCE_ACCESS_DENIED:1e4,LOCERR_RELOAD_IN_PROGRESS:11e3,LOCERR_PERSONAL_NEW_VERSION_AVAILABLE:12e3,LOCERR_PERSONAL_VERSION_EXPIRED:12001,LOCERR_PERSONAL_SECTION_ACCESS_DETECTED:12002,LOCERR_PERSONAL_APP_DELETION_FAILED:12003,LOCERR_EXPORT_OUT_OF_MEMORY:13e3,LOCERR_EXPORT_NO_DATA:13001,LOCERR_SYNC_INVALID_OFFSET:14e3,LOCERR_SEARCH_TIMEOUT:15e3,LOCERR_DIRECT_DISCOVERY_LINKED_EXPRESSION_FAIL:16e3,LOCERR_DIRECT_DISCOVERY_ROWCOUNT_OVERFLOW:16001,LOCERR_DIRECT_DISCOVERY_EMPTY_RESULT:16002,LOCERR_DIRECT_DISCOVERY_DB_CONNECTION_FAILED:16003,LOCERR_DIRECT_DISCOVERY_MEASURE_NOT_ALLOWED:16004,LOCERR_DIRECT_DISCOVERY_DETAIL_NOT_ALLOWED:16005,LOCERR_DIRECT_DISCOVERY_NOT_SYNTH_CIRCULAR_ALLOWED:16006,LOCERR_DIRECT_DISCOVERY_ONLY_ONE_DD_TABLE_ALLOWED:16007,LOCERR_SMART_LOAD_TABLE_NOT_FOUND:17e3,LOCERR_SMART_LOAD_TABLE_DUPLICATED:17001,LOCERR_JSON_RPC_INVALID_REQUEST:-32600,LOCERR_JSON_RPC_METHOD_NOT_FOUND:-32601,LOCERR_JSON_RPC_INVALID_PARAMETERS:-32602,LOCERR_JSON_RPC_INTERNAL_ERROR:-32603,LOCERR_JSON_RPC_PARSE_ERROR:-32700},NxLocalizedWarningCode:{LOCWARN_PERSONAL_RELOAD_REQUIRED:0,LOCWARN_PERSONAL_VERSION_EXPIRES_SOON:1,LOCWARN_EXPORT_DATA_TRUNCATED:1e3,LOCWARN_COULD_NOT_OPEN_ALL_OBJECTS:2e3},NxLocalizedMessageCode:{LOCMSG_SCRIPTEDITOR_EMPTY_MESSAGE:0,LOCMSG_SCRIPTEDITOR_PROGRESS_SAVING_STARTED:1,LOCMSG_SCRIPTEDITOR_PROGRESS_BYTES_LEFT:2,LOCMSG_SCRIPTEDITOR_PROGRESS_STORING_TABLES:3,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWS_SO_FAR:4,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTED:5,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTING_TO:6,LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECT_FAILED:7,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWISH:8,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_COLUMNAR:9,LOCMSG_SCRIPTEDITOR_ERROR:10,LOCMSG_SCRIPTEDITOR_DONE:11,LOCMSG_SCRIPTEDITOR_LOAD_EXTERNAL_DATA:12,LOCMSG_SCRIPTEDITOR_PROGRESS_OLD_QVD_ISLOADING:13,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_LOADING:14,LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_BUFFERED:15,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_PREPARING:16,LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_APPENDING:17,LOCMSG_SCRIPTEDITOR_REMOVE_SYNTHETIC:18,LOCMSG_SCRIPTEDITOR_PENDING_LINKEDTABLE_FETCHING:19,LOCMSG_SCRIPTEDITOR_RELOAD:20,LOCMSG_SCRIPTEDITOR_LINES_FETCHED:21}}}),define("core.utils/authentication",["jquery"],function(a){"use strict";var b,c,d,e,f={},g=!1,h=a.Deferred();return f.parse=function(a){b=a.userId,c=a.userDirectory,g=a.mustAuthenticate,e=a.loginUri,d=a.logoutUri,g===!0&&a.loginUri&&(window.location.href=a.loginUri),h.resolve(this)},f.onDataReceived=h.promise(),Object.defineProperties(f,{userId:{get:function(){return b}},userDirectory:{get:function(){return c}},mustAuthenticate:{get:function(){return g}},loginUri:{get:function(){return e}},logoutUri:{get:function(){return d}}}),f}),define("core.models/rpc-base",["core.utils/deferred","core.utils/notification","core.utils/class","core.utils/json-patch","core.utils/debug-flags","core.utils/permissions","core.utils/model-garbage-collector","autogenerated/qix/engine-enums","core.utils/authentication"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a,b){Array.isArray(b)?d.apply(a,b):d.updateObject(a,b)}var k,l,m=h.NxLocalizedErrorCode,n=["GetLayout","GetAppLayout","AbortModal","DoSave"];i.onDataReceived.then(function(a){"NONE"!==a.userDirectory&&(k=a.userId,l=a.userDirectory)});var o=c.extend("RPCBase",{init:function(a){var c=this;b.mixin(c),c.notification("Validated"),c.notification("Invalidated"),c.notification("Aborted"),c.notification("Validating"),c.notification("Closed"),c.notification("Closing"),c.notification("Cancelled"),c.id=a.id,c.session=a.session,c.handle=a.handle,c.layout={},c._properties={},c.properties={},c.propertyTree={},c.ongoingRequests={},c.needCacheProperties=!0,c.setState(o.States.INVALID),f.mapToLayout(c.layout,a.checkCreate),"App"!==c.constructor.name&&c.bindToRPC()},bindToRPC:function(){var a=this;a.session.onChange(a.handle,a.changeHandler.bind(a)),a.Aborted.bind(a.clearPending.bind(a)),a.Cancelled.bind(a.clearPending.bind(a))},changeHandler:function(){var a=this;a.clearPending(),a.needCacheProperties=!0,a.isCancelled||a.setState(o.States.INVALID)},clearPending:function(){for(var a in this.ongoingRequests)delete this.ongoingRequests[a]},publish:function(){return this.layout.permissions.publish?this.rpc("Publish"):a.reject("permission denied")},unpublish:function(){var b=this,c=a();return b.getLayout().then(function(a){return!a.qMeta.published||a.qMeta.approved||a.qMeta.owner.userId!==k||a.qMeta.owner.userDirectory!==l?c.reject("permission denied"):void b.rpc("UnPublish").then(function(a){c.resolve(a)})}),c.promise},setState:function(a){var b=this,c=b.state;delete this.__layoutRPCId,b.state=a,c!==b.state&&(a===o.States.INVALID?b.Invalidated.emit():a===o.States.VALID?b.Validated.emit():a===o.States.ABORTED?b.Aborted.emit():a===o.States.VALIDATING?b.Validating.emit():a===o.States.CLOSED?b.Closed.emit():a===o.States.CLOSING?b.Closing.emit():a===o.States.CANCELLED&&b.Cancelled.emit())},getLayout:function(b,c){function d(a){return e.DELTA&&h&&window.console.info("[DBGFLG:DELTA] APPLY ["+g.constructor.name+"]:",a),j(g.layout,a),g.setState(o.States.VALID),g.layout}function f(b){return b.error.code!==m.LOCERR_GENERIC_ABORTED||g.isCancelled||(g.setState(o.States.ABORTED),b.isHandled=!0),a.reject(b)}var g=this,h=!0;if(g.isValid||g.isCancelled)return a.resolve(g.layout);if(b=b||"GetLayout",c=c||"qLayout",g.isValidating||g.setState(o.States.VALIDATING),g.ongoingRequests[b+h])return g.ongoingRequests[b+h];var i=g.rpc(b,c,[],{delta:h}),k=i.then(d,f);return g.__layoutRPCId=i.rpcId,g.ongoingRequests[b+h]=k,k},getProperties:function(b){var c=this,e=!1;if(b=b||"GetProperties",c.isValid&&!c.needCacheProperties)return a.resolve(c.properties);if(c.ongoingRequests[b+e])return c.ongoingRequests[b+e];var f=c.rpc(b,"qProp",[],{delta:e}).then(function(a){var b=d.generate(c._properties,a);return c._properties=a,d.apply(c.properties,b),c.isValid&&(c.needCacheProperties=!1),c.properties});return c.ongoingRequests[b+e]=f,f},hasChanges:function(){var a=d.generate(this._properties,this.properties);return a.length>0},markAsInvalid:function(){this.state=-99,this.setState(o.States.INVALID)},getFullPropertyTree:function(a){var b=this,c=!1;return a=a||"GetFullPropertyTree",b.rpc(a,"qPropEntry",[],c).then(function(a){return b._propertyTree=a,j(b.propertyTree,a),b.propertyTree})},setProperties:function(a,b,c){var e=this;return b=b||"SetProperties",Array.isArray(a)||(a=[a]),this.rpc(b,null,a,c).then(function(){d.updateObject(e._properties,e.properties)})},setFullPropertyTree:function(a,b,c){return b=b||"SetFullPropertyTree",Array.isArray(a)||(a=[a]),this.rpc(b,null,a,c)},save:function(){return this.hasChanges()?this.setProperties(this.properties):a.resolve()},saveTree:function(){return this.setFullPropertyTree(this.propertyTree)},getChildInfos:function(){return this.rpc("GetChildInfos","qInfos",[])},close:function(b){var c=this;c.setState(o.States.CLOSING);var d=b||"App"===c.constructor.name?a.resolve():c.rpc("Close","qReturn",[]);delete c.session.changeHandlers[c.handle],delete c.session.modelCache[c.id];for(var e in c.ongoingRequests)c.ongoingRequests[e].then&&c.ongoingRequests[e].then(null,function(a){a.isHandled=!0});return d.then(function(){c.setState(o.States.CLOSED),g.addToQueue(c)})},rpc:function(b,c,d,e){e=e||{delta:!1,raw:!1};var f=this,g=[].slice.call(arguments);if(!f.handle&&"App"===f.constructor.name)return f.waitForOpen.promise.then(function(){return f.rpc.apply(f,g)});var h={method:b,handle:this.handle,params:d||[]};if(e.delta&&(h.delta=!0),!f.session||f.isClosing||f.isClosed)return a.reject();var i=f.session.rpc(h).then(function(a){return c?a.result[c]:e.raw?a:a.result},function(b){return b.error.code===m.LOCERR_HC_MODAL_OBJECT_ERROR?(b.isHandled=!0,f.session.currentApp.abortModal().then(function(){return f.rpc.apply(f,g)})):a.reject(b)});return n.indexOf(b)>-1&&(f.ongoingRequests[b+e.delta]=i,i["finally"](function(){delete f.ongoingRequests[b+e.delta]})),i.rpcId=h.id,i}});return o.getModel=function(b,c,d){function e(d){return delete c.modelCache[b],a.reject({error:{code:d&&d.error&&d.error.code,message:"No object with Id "+b+" found",parameter:b}})}var f=c.modelCache[b],g=this;return b?f?f:(f=d().then(function(a){var d=null!==a.qHandle?new g({id:b,session:c,handle:a.qHandle}):null;return d?d:e({error:{code:m.LOCERR_GENERIC_NOT_FOUND}})},e),c.modelCache[b]=f,f):a.reject("No ID given to RPCBase#getModel")},o.getLayout=function(a,b){return this.get(a,b).then(function(a){return a.getLayout().then(function(a){return a})})},o.getProperties=function(a,b){return this.get(a,b).then(function(a){return a.getProperties().then(function(){return a})})},o.extend=function(a,b){var d=c.extend.call(this,a,b);return d.bindLayout=o.bindLayout,d.getLayout=o.getLayout,d.getProperties=o.getProperties,d.getModel=o.getModel,d},Object.defineProperties(o.prototype,{isValid:{get:function(){return this.state===o.States.VALID}},isValidating:{get:function(){return this.state===o.States.VALIDATING}},isInvalid:{get:function(){return this.state===o.States.INVALID}},isAborted:{get:function(){return this.state===o.States.ABORTED}},isClosed:{get:function(){return this.state===o.States.CLOSED}},isClosing:{get:function(){return this.state===o.States.CLOSING}},isCancelled:{get:function(){return this.state===o.States.CANCELLED}}}),o.States={VALID:1,INVALID:2,VALIDATING:3,ABORTED:4,CLOSED:5,CLOSING:6,CANCELLED:7},o.bindLayout=function(a,b,c,d){function e(){var c=a.$eval(b);c&&c.Invalidated&&c.Invalidated.unbind(f)}b=b||"model";var f,g,h,i=function(){var d=this,e=this.getLayout();a.__layoutRPCId=e.rpcId,e.then(function(e){var f=a.$eval(b);f===d&&c&&c(e)})};return h=a.$on("$destroy",function(){e()}),g=a.$watch(b,function(a,b){b&&b!==a&&b.Invalidated&&b.Invalidated.unbind(f),!a||a.isClosing&&a.isClosed||(d&&d(a),a.getLayout().then(c),f=i.bind(a),a.Invalidated.bind(f))}),function(){e(),g(),h(),c&&(c=null),d&&(d=null)}},o}),define("core.utils/websocket",[],function(){if("undefined"!=typeof window&&"undefined"!=typeof document)return window.WebSocket;var a=require("ws");return a}),define("assets/core/models/rpc-session",["core.utils/websocket","core.utils/notification","core.utils/deferred"],function(a,b,c){"use strict";function d(a){var c=this;b.mixin(c),c.notification("Open"),c.notification("Close"),c.notification("Send"),c.notification("Data"),
c.notification("Error"),c.notification("ClosedHandles"),c.notification("ChangedHandles"),c.notification("Notification"),c.notification("Warning"),c.changeHandlers=[],c.cacheName=a.cacheName,c.queue=[],c.dfdCache={},c.reqCache={},c.modelCache={},c.options=a}var e=1;return d.prototype={open:function(){var a=this;a.socket=a.socket||d.createSocket(d.buildUrl(a.options)),a.socket.onopen=a.onOpen.bind(a),a.socket.onclose=a.onClose.bind(a),a.socket.onerror=a.onError.bind(a),a.socket.onmessage=a.onData.bind(a)},onOpen:function(){var a=this;setTimeout(function(){a.queue.forEach(function(b){a.send(b)}),a.queue.length=0,a.Open.emit()},100)},onError:function(a){var b=this;Object.keys(b.dfdCache).forEach(function(c){a.error={err:a,isHandled:!0},b.dfdCache[c].reject(a)}),b.Error.emit(a)},onClose:function(){var a=this;a.queue.length=0,delete d.__cache[a.cacheName],setTimeout(function(){if(a.Close){a.Close.emit();for(var c in a.modelCache)a.modelCache[c].then(function(a){"App"!==a.constructor.name&&a.close(!0)});b.release(a)}},1e3)},onData:function(a){var b=this,c=JSON.parse(a.data),e=b.dfdCache[c.id];c.change&&b.handleChanged(c),c.close&&b.handleClosed(c),d.debounceApply(function(){c.handle&&!b.changeHandlers[c.handle]&&e?e.reject("No model mapped to handle"):c.result?(b.Data.emit(c),c.warnings&&b.Warning.emit(c),e&&e.resolve(c)):c.params?(b.Notification.emit(c),e&&e.resolve(c)):c.suspend?(b.rpc({method:"Resume",params:[],handle:c.suspend[0]}),e&&e.resolve(c)):c.error&&(e&&e.reject(c),b.Error.emit(c)),delete b.dfdCache[c.id],delete b.reqCache[c.id]})},handleChanged:function(a){var b=this;a.change.forEach(function(a){var c=b.changeHandlers[a];c&&c.forEach(function(a){a()})}),b.ChangedHandles.emit(a.change)},handleClosed:function(a){var b=this;Object.keys(b.modelCache).forEach(function(c){b.modelCache[c].then(function(b){a.close.indexOf(b.handle)>-1&&b.close(!0)})}),b.ClosedHandles.emit(a.close)},send:function(a){var b=this,c=a;return"string"!=typeof a&&(c=JSON.stringify(a)),b.socket&&1===b.socket.readyState?(b.Send.emit(a),void b.socket.send(c)):void b.queue.push(a)},close:function(){var a=this;a.socket&&(a.socket.close(),delete a.socket)},rpc:function(a,b){return b||(b=new c),d.hookIntoDeferred(b),"undefined"==typeof a.id&&(a.id=e++),a.jsonrpc="2.0",this.send(a),this.dfdCache[a.id]=b,this.reqCache[a.id]=a,b.id=a.id,b.promise},onChange:function(a,b){this.changeHandlers[a]||(this.changeHandlers[a]=[]),this.changeHandlers[a].push(b)},getRequest:function(a){return this.reqCache[a]||null}},d.__cache={},b.create(d,"NewSessionCreated"),d.createSocket=function(b){return new a(b)},d.createInput=function(a,b){return b=b||{},b.appName=a,b.cacheName=d.buildUrl(b),b},d.debounceApply=function(a){a()},d.get=function(a,b){var c=d.createInput(a,b),e=d.getIfCached(a,b);return e||(e=d.__cache[c.cacheName]=new d(c),d.NewSessionCreated.emit(e)),e},d.getIfCached=function(a,b){var c=d.createInput(a,b);return d.__cache[c.cacheName]},d.buildUrl=function(a){var b="",c=a.host,d="string"==typeof a.port?a.port:a.isSecure?443:4848;return b+=a.isSecure?"wss":"ws",b+="://",b+=c||"localhost",a.port&&(b+=":",b+=d),b+=a.prefix||"/",a.subpath&&(b+=a.subpath+"/"),b+=a.route?a.route:"app/"+encodeURIComponent(a.appName),a.identity&&(b+="/identity/"+encodeURIComponent(a.identity)),b+="?reloadUri="+(a.reloadURI||"")},d.hookIntoDeferred=function(){},d}),/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */
function(a){function b(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0}function c(a,b){if("function"!=typeof a)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))}function d(){this._bindings=[],this._prevParams=null;var a=this;this.dispatch=function(){d.prototype.dispatch.apply(a,arguments)}}b.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},d.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,c,d,e){var f,g=this._indexOfListener(a,d);if(-1!==g){if(f=this._bindings[g],f.isOnce()!==c)throw new Error("You cannot add"+(c?"":"Once")+"() then add"+(c?"Once":"")+"() the same listener without removing the relationship first.")}else f=new b(this,a,c,d,e),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){for(var c,d=this._bindings.length;d--;)if(c=this._bindings[d],c._listener===a&&c.context===b)return d;return-1},has:function(a,b){return-1!==this._indexOfListener(a,b)},add:function(a,b,d){return c(a,"add"),this._registerListener(a,!1,b,d)},addOnce:function(a,b,d){return c(a,"addOnce"),this._registerListener(a,!0,b,d)},remove:function(a,b){c(a,"remove");var d=this._indexOfListener(a,b);return-1!==d&&(this._bindings[d]._destroy(),this._bindings.splice(d,1)),a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b,c=Array.prototype.slice.call(arguments),d=this._bindings.length;if(this.memorize&&(this._prevParams=c),d){b=this._bindings.slice(),this._shouldPropagate=!0;do d--;while(b[d]&&this._shouldPropagate&&b[d].execute(c)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var e=d;e.Signal=d,"function"==typeof define&&define.amd?define("signals",[],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.signals=e}(this),/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2013/01/21 13:47)
 */
function(){var a=function(a){function b(a,b){if(a.indexOf)return a.indexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1}function c(a,c){var d=b(a,c);-1!==d&&a.splice(d,1)}function d(a,b){return"[object "+b+"]"===Object.prototype.toString.call(a)}function e(a){return d(a,"RegExp")}function f(a){return d(a,"Array")}function g(a){return"function"==typeof a}function h(a){var b;return b=null===a||"null"===a?null:"true"===a?!0:"false"===a?!1:a===o||"undefined"===a?o:""===a||isNaN(a)?a:parseFloat(a)}function i(a){for(var b=a.length,c=[];b--;)c[b]=h(a[b]);return c}function j(a,b){for(var c,d,e=(a||"").replace("?","").split("&"),f=e.length,g={};f--;)c=e[f].split("="),d=b?h(c[1]):c[1],g[c[0]]="string"==typeof d?decodeURIComponent(d):d;return g}function k(){this.bypassed=new a.Signal,this.routed=new a.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function l(b,c,d,f){var g=e(b),h=f.patternLexer;this._router=f,this._pattern=b,this._paramsIds=g?null:h.getParamIds(b),this._optionalParamsIds=g?null:h.getOptionalParamsIds(b),this._matchRegexp=g?b:h.compilePattern(b,f.ignoreCase),this.matched=new a.Signal,this.switched=new a.Signal,c&&this.matched.add(c),this._priority=d||0}var m,n,o;return n=""===/t(.+)?/.exec("t")[1],k.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new k},addRoute:function(a,b,c){var d=new l(a,b,c,this);return this._sortedInsert(d),d},removeRoute:function(a){c(this._routes,a),a._destroy()},removeAllRoutes:function(){for(var a=this.getNumRoutes();a--;)this._routes[a]._destroy();this._routes.length=0},parse:function(a,b){if(a=a||"",b=b||[],this.ignoreState||a!==this._prevMatchedRequest&&a!==this._prevBypassedRequest){var c,d=this._getMatchedRoutes(a),e=0,f=d.length;if(f)for(this._prevMatchedRequest=a,this._notifyPrevRoutes(d,a),this._prevRoutes=d;f>e;)c=d[e],c.route.matched.dispatch.apply(c.route.matched,b.concat(c.params)),c.isFirst=!e,this.routed.dispatch.apply(this.routed,b.concat([a,c])),e+=1;else this._prevBypassedRequest=a,this.bypassed.dispatch.apply(this.bypassed,b.concat([a]));this._pipeParse(a,b)}},_notifyPrevRoutes:function(a,b){for(var c,d=0;c=this._prevRoutes[d++];)c.route.switched&&this._didSwitch(c.route,a)&&c.route.switched.dispatch(b)},_didSwitch:function(a,b){for(var c,d=0;c=b[d++];)if(c.route===a)return!1;return!0},_pipeParse:function(a,b){for(var c,d=0;c=this._piped[d++];)c.parse(a,b)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(a){var b=this._routes,c=b.length;do--c;while(b[c]&&a._priority<=b[c]._priority);b.splice(c+1,0,a)},_getMatchedRoutes:function(a){for(var b,c=[],d=this._routes,e=d.length;(b=d[--e])&&((!c.length||this.greedy||b.greedy)&&b.match(a)&&c.push({route:b,params:b._getParamsArray(a)}),this.greedyEnabled||!c.length););return c},pipe:function(a){this._piped.push(a)},unpipe:function(a){c(this._piped,a)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},m=new k,m.VERSION="0.12.0",m.NORM_AS_ARRAY=function(a,b){return[b.vals_]},m.NORM_AS_OBJECT=function(a,b){return[b]},l.prototype={greedy:!1,rules:void 0,match:function(a){return a=a||"",this._matchRegexp.test(a)&&this._validateParams(a)},_validateParams:function(a){var b,c=this.rules,d=this._getParamsObject(a);for(b in c)if("normalize_"!==b&&c.hasOwnProperty(b)&&!this._isValidParam(a,b,d))return!1;return!0},_isValidParam:function(a,c,d){var h=this.rules[c],i=d[c],j=!1,k=0===c.indexOf("?");return null==i&&this._optionalParamsIds&&-1!==b(this._optionalParamsIds,c)?j=!0:e(h)?(k&&(i=d[c+"_"]),j=h.test(i)):f(h)?(k&&(i=d[c+"_"]),j=this._isValidArrayRule(h,i)):g(h)&&(j=h(i,a,d)),j},_isValidArrayRule:function(a,c){if(!this._router.ignoreCase)return-1!==b(a,c);"string"==typeof c&&(c=c.toLowerCase());for(var d,e,f=a.length;f--;)if(d=a[f],e="string"==typeof d?d.toLowerCase():d,e===c)return!0;return!1},_getParamsObject:function(a){for(var c,d,e=this._router.shouldTypecast,f=this._router.patternLexer.getParamValues(a,this._matchRegexp,e),g={},i=f.length;i--;)d=f[i],this._paramsIds&&(c=this._paramsIds[i],0===c.indexOf("?")&&d&&(g[c+"_"]=d,d=j(d,e),f[i]=d),n&&""===d&&-1!==b(this._optionalParamsIds,c)&&(d=void 0,f[i]=d),g[c]=d),g[i]=d;return g.request_=e?h(a):a,g.vals_=f,g},_getParamsArray:function(a){var b,c=this.rules?this.rules.normalize_:null;return c=c||this._router.normalizeFn,b=c&&g(c)?c(a,this._getParamsObject(a)):this._getParamsObject(a).vals_},interpolate:function(a){var b=this._router.patternLexer.interpolate(this._pattern,a);if(!this._validateParams(b))throw new Error("Generated string doesn't validate against `Route.rules`.");return b},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},k.prototype.patternLexer=function(){function a(){var a,b;for(a in n)n.hasOwnProperty(a)&&(b=n[a],b.id="__CR_"+a+"__",b.save="save"in b?b.save.replace("{{id}}",b.id):b.id,b.rRestore=new RegExp(b.id,"g"))}function b(a,b){var c,d=[];for(a.lastIndex=0;c=a.exec(b);)d.push(c[1]);return d}function c(a){return b(m,a)}function d(a){return b(n.OP.rgx,a)}function e(a,b){return a=a||"",a&&(r===o?a=a.replace(k,""):r===q&&(a=a.replace(l,"")),a=f(a,"rgx","save"),a=a.replace(j,"\\$&"),a=f(a,"rRestore","res"),r===o&&(a="\\/?"+a)),r!==p&&(a+="\\/?"),new RegExp("^"+a+"$",b?"i":"")}function f(a,b,c){var d,e;for(e in n)n.hasOwnProperty(e)&&(d=n[e],a=a.replace(d[b],d[c]));return a}function g(a,b,c){var d=b.exec(a);return d&&(d.shift(),c&&(d=i(d))),d}function h(a,b){if("string"!=typeof a)throw new Error("Route pattern should be a string.");var c=function(a,c){var d;if(c="?"===c.substr(0,1)?c.substr(1):c,null!=b[c]){if("object"==typeof b[c]){var e=[];for(var f in b[c])e.push(encodeURI(f+"="+b[c][f]));d="?"+e.join("&")}else d=String(b[c]);if(-1===a.indexOf("*")&&-1!==d.indexOf("/"))throw new Error('Invalid value "'+d+'" for segment "'+a+'".')}else{if(-1!==a.indexOf("{"))throw new Error("The segment "+a+" is required.");d=""}return d};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),a.replace(n.OS.rgx,n.OS.save).replace(m,c).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var j=/[\\.+*?\^$\[\](){}\/'#]/g,k=/^\/|\/$/g,l=/\/$/g,m=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},o=1,p=2,q=3,r=o;return a(),{strict:function(){r=p},loose:function(){r=o},legacy:function(){r=q},getParamIds:c,getOptionalParamsIds:d,getParamValues:g,compilePattern:e,interpolate:h}}(),m};"function"==typeof define&&define.amd?define("crossroads",["signals"],a):"undefined"!=typeof module&&module.exports?module.exports=a(require("signals")):window.crossroads=a(window.signals)}(),define("general.controllers/route-controller",["crossroads","util"],function(a,b){"use strict";function c(){n.forEach(function(a){a.dispose()}),m.forEach(function(a){e.addRoute(a)})}function d(){window.addEventListener("popstate",function(){var a=b.getParameterByName("app");return f&&f!==a?void(location.href=location.href):void e.parse()},!1)}if(location.pathname.match(/hub$/i))return void(location.href=location.href+"/");location.hash&&history.replaceState(null,null,location.href.replace("#!/",""));var e={},f=b.getParameterByName("app"),g=b.getParameterByName("language"),h=b.getParameterByName("theme"),i=b.getParameterByName("debug"),j=b.getParameterByName("noData"),k=[],l=[],m=[],n=[];return f&&k.push("app",f),g&&l.push("language",g),h&&l.push("theme",h),i&&l.push("debug",i),j&&l.push("noData",!0),e.isSuffixInUse=function(a){for(var b=0;b<l.length;b++)if(l[b]===a)return!0;return!1},e.removePartialSuffix=function(a){for(var b=!1,d=0;d<l.length;d++)if(l[d]===a){l.splice(d,2),b=!0;break}if(b){var f=location.href,g=new RegExp("/"+a+"/[^/]+","i");c(),g.test(f)&&(f=f.replace(g,""),e.setUrl(f))}return b},e.parse=function(b){a.parse(b||location.pathname)},e.addRoute=function(b){var c=this,d=b.pattern;m.push(b),b.isPartial&&("/"===d&&(d=""),d=c.buildUrl("replaceme").replace(location.protocol+"//"+location.host+"/","").replace("/replaceme",d));var e=a.addRoute(d,function(){c.lastRoute&&c.lastRoute!==b&&c.lastRoute.DeRoute.emit(),c.lastRoute=b,b.Route.emit.apply(b.Route,arguments)});n.push(e)},e.setUrl=function(a,c,d){c=!0;var f=location.href.toLowerCase().indexOf("?x-")>-1;f&&(a=a.replace(/\?x-.+?=[^&]+/i,"").replace("&","?")),0!==a.indexOf(b.baseURI)?location.href=a:a!==location.href&&(history[c?"replaceState":"pushState"](null,null,a),d||e.parse())},e.start=function(){this.setUrl(location.href),d(this),e.parse()},e.buildUrl=function(){var a,c=Array.apply(null,arguments),d="",e="";if(c[0]===!0?(d=c[1],c=c.slice(2)):c.unshift.apply(c,k),l.length&&c.push.apply(c,l),c=c.map(function(a){return encodeURIComponent(a).replace(/'/g,"%27")}),d){var f=new RegExp("([^/])/"+b.project+"/","i");e=b.baseURI.replace(f,"$1/"+d+"/")}else e=b.baseURI;return a=e+c.join("/").replace(/[\/]+/g,"/")},e}),define("core.utils/external-urls",["translator"],function(a){var b={serverHelpBaseUrl:"http://help.qlik.com/sense/2.0/",personalHelpBaseUrl:"http://help.qlik.com/sense/2.0/",cloudBaseUrl:"https://qlikcloud.com/",cloudUploadUrl:"https://qlikcloud.com/upload?",personalUpgradeBase:"qlik.com/QlikSenseDesktopUpgrade",personalUpgradeUrl:"http://qlik.com/QlikSenseDesktopUpgrade"};return Object.defineProperty(b,"gettingStarted",{get:function(){return"http://www.qlik.com/"+a.language+"-sense-gettingstarted"}}),b}),define("text!client.controllers/expire-dialog.ng.html",[],function(){return"<div>\r\n	<p class='dm-pb' ng-class=\"{'dm-pt': noTitle}\" q-translation=\"{{content}}\"></p>\r\n	<p><upgrade-msg/></p>\r\n</div>"}),define("text!general.services/delayed-modal/delayed-modal.ng.html",[],function(){return'<div class="qui-delayedModal" on-close-view="closeView( $event )" qv-escape="handleEscButton( $event )" ng-style="modalStyle" tid="errorDialog">\r\n	<header class="dm-header" ng-if="title" q-translation="{{title}}"></header>\r\n	<main ng-if="!html" class="dm-main"> <p class="dm-p">{{content | translate}}</p></main>\r\n	<main ng-if="html" class="dm-main qv-appname"></main>\r\n	<footer class="dm-footer">\r\n		<qui-button qv-delayed-dialog-button ng-if="!buttons.length && showDefaultButton" qva-activate="closeModal( $event, true );" qva-focus="true"\r\n					q-translation="Common.OK" tid="confirm"></qui-button>\r\n		<qui-button qv-delayed-dialog-button ng-repeat="button in buttons" qva-focus="button.defaultButton" qva-activate="closeModal( $event );" ng-disabled="button.expression === false"\r\n					q-translation="{{button.name}}" tid="{{button.tid}}"></qui-button>\r\n	</footer>\r\n</div>\r\n'}),define("general.services/delayed-modal/delayed-modal",["jquery","core.utils/deferred","qvangular","text!general.services/delayed-modal/delayed-modal.ng.html","angular"],function(a,b,c,d){var e,f=window.angular,g={"max-height":"90%","max-width":"90%","min-height":"180px",width:"400px"},h=!1,i=!1;c.directive("qvDelayedDialogButton",function(){return{replace:!0,restrict:"A",link:function(a){a.button&&a.button.defaultEscButton&&(e=a),a.closeModal=function(b,c){b&&(b.preventDefault(),b.stopPropagation()),a.button&&a.button.callback&&("undefined"==typeof a.button.expression||a.button.expression)&&a.button.callback(),(c||a.autoClose||a.button&&!a.button.callback)&&a.destroyModal()}}}}),c.service("$delayedModal",["$compile","$rootScope","$document",function(c,j,k){var l,m,n,o,p={},q=d,r={open:function(a){var d,r=new b;l&&(m=l,o=n),l=j.$new(),n=f.element('<div class="qv-modal-container qui-modalbackground-centered" qva-outside-ignore-for="allOutside" ng-style="containerStyle" ng-class="classes"></div>'),l.containerStyle={content:" "},l.classes={},l.modalStyle={};for(var s in g)l.modalStyle[s]=g[s];l.wasDisabled=[],l.showDefaultButton=!0,h=!0,i=!1,p=a,l.failed=!1,l.autoClose=!0;for(s in p)l[s]=p[s];return n.html(q).appendTo(k.find("body")),l.html&&n.find("main").append(l.html),d=l.$watch("element",function(){r.resolve(),d()}),l.element=c(n)(l),l.destroyModal=this.close.bind(this),l.handleEscButton=function(a){a&&(a.preventDefault(),a.stopPropagation()),l.buttons&&e?e&&e.closeModal():l.destroyModal()},l.$broadcast("delayed-modal-opened"),l.$watchCollection("[width, height]",function(){l.width&&(l.modalStyle.width=l.width),l.height&&(l.modalStyle.height=l.height)}),r.promise},update:function(a){if(h){for(var b in a)l[b]=a[b],p[b]=a[b];(a.html||a.buttons)&&(n.html(q),n.find("main").html(a.html),k.find("body").find(".qui-delayedModal").replaceWith(n.html()),l.element=c(n)(l))}},close:function(){l&&n&&(n.remove(),l.$destroy(),l.$broadcast("delayed-modal-closed"),l=m||null,n=o||null,m=o=null),h=!1,i=!1},lock:function(){i=!0,l.wasDisabled.length=0,l.element.find("button, input, textarea, select").each(function(){var b=a(this);b.prop("disabled")?l.wasDisabled.push(this):b.prop("disabled",!0)})},unlock:function(){i=!1,l.element.find("button, input, textarea, select").each(function(){-1===l.wasDisabled.indexOf(this)&&a(this).prop("disabled",!1)}),l.wasDisabled.length=0}};return Object.defineProperty(r,"isOpened",{get:function(){return h}}),Object.defineProperty(r,"isLocked",{get:function(){return i}}),Object.defineProperty(r,"scope",{get:function(){return l}}),r}])}),define("client.controllers/error-handler-controller",["jquery","qvangular","translator","autogenerated/qix/engine-enums","general.controllers/route-controller","core.utils/external-urls","text!client.controllers/expire-dialog.ng.html","general.services/delayed-modal/delayed-modal"],function(a,b,c,d,e,f,g){"use strict";function h(d){if(!i){var h=b.getService("$delayedModal");if(i=!0,"OnSessionLoggedOut"===d)return k={title:"Hub.OnSessionLoggedOut.title",content:"Hub.OnSessionLoggedOut.message",buttons:[{name:"Hub.OnSessionLoggedOut.button",defaultButton:!0,callback:function(){location.href=e.buildUrl(!0,"hub")}}],showDefaultButton:!1,classes:{"qs-e-dim":!0}},void c.ready.then(function(){b.getService("$delayedModal").open(k),b.getService("$delayedModal").scope.$on("delayed-modal-closed",function(){i=!1})});if(d.code===j.LOCERR_JSON_RPC_INVALID_PARAMETERS)return void(i=!1);var l=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0,callback:function(){var a=null;2===k.buttons.length&&(a=k.buttons[1]),h.scope.$root.$broadcast("errorHandlerClosed",k.content,a)}}];d.buttons?l=d.buttons:d.code===j.LOCERR_APP_NOT_FOUND||d.code===j.LOCERR_APP_CONNECT_FAILED?l=[{name:"Common.Refresh",callback:function(){b.getService("$timeout")(function(){location.reload(!0)})}},{name:"ErrorDialog.GoToHub",defaultButton:!0,callback:function(){location.href=e.buildUrl(!0,"hub")}}]:(d.code===j.LOCERR_SERVER_LICENSE_EXPIRED||d.code===j.LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS||d.code===j.LOCERR_SERVER_OUT_OF_SESSION_CALS||d.code===j.LOCERR_SERVER_OUT_OF_USAGE_CALS||d.code===j.LOCERR_SERVER_OUT_OF_CALS||d.code===j.LOCERR_SERVER_OUT_OF_NAMED_CALS||d.code===j.LOCERR_GENERIC_CONNECTION_LOST)&&(l[0].defaultButton=!1,l.push({name:"Common.Refresh",defaultButton:!0,callback:function(){b.getService("$timeout")(function(){location.reload(!0)});var a=null;2===k.buttons.length&&(a=k.buttons[1]),b.$rootScope.$broadcast("errorHandlerRefresh",k.content,a)}})),c.ready.then(function(){if(k=a.extend(!0,{},d,{title:"ErrorDialog.Title",content:d.code?"ErrorCode."+d.code:d.message,buttons:l,showDefaultButton:!1,classes:{"qs-e-dim":!0}}),d.code===j.LOCERR_PERSONAL_VERSION_EXPIRED){var b=c.get("Info.QlikView.Personal.Upgrade",["<a href='"+f.personalUpgradeUrl+"' target='_blank'>"+f.personalUpgradeBase+"</a>"]),e=g.replace("<upgrade-msg/>",b);k.html=e,k.title="",k.noTitle=!0}h.open(k),h.scope.$on("delayed-modal-closed",function(){i=!1}),h.scope.$root.$broadcast("errorHandlerOpen")}),document.activeElement&&a(document.activeElement).blur()}}var i=!1,j=d.NxLocalizedErrorCode,k={};return{showDialog:h,isOpen:function(){return i}}}),define("client.controllers/warning-handler-controller",["jquery","qvangular","autogenerated/qix/engine-enums","core.utils/external-urls","text!client.controllers/expire-dialog.ng.html","general.services/delayed-modal/delayed-modal"],function(a,b,c,d,e){"use strict";function f(){b.getService("$delayedModal").scope.$on("delayed-modal-closed",function(){m.length&&b.getService("$timeout")(function(){h(m.shift())})})}function g(a){for(var b=-1,c=0;c<a.length;c++)if("undefined"!=typeof a[c].code&&a[c].code===k.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON){b=c;break}return b}function h(c){var g={};j.ready.then(function(){if(g=a.extend(!0,{},c,{title:"WarningDialog.Title",content:"undefined"!=typeof c.code?"WarningCode."+c.code:c.message,buttons:l,showDefaultButton:!1}),"undefined"!=typeof c.code&&c.code===k.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON){var h=j.get("Info.QlikView.Personal.Upgrade",["<a href='"+d.personalUpgradeUrl+"' target='_blank'>"+d.personalUpgradeBase+"</a>"]),i=e.replace("<upgrade-msg/>",h);g.html=i}b.getService("$delayedModal").open(g),f()}),document.activeElement&&a(document.activeElement).blur()}function i(c,d){var e=a.extend(!0,[],c);if(j||(j=d),n){var i=g(e);-1!==i&&e.splice(i,1)}else-1!==g(e)&&(n=!0);e.length>0&&(m.push.apply(m,e),b.getService("$delayedModal").isOpened?f():h(m.shift()))}var j,k=c.NxLocalizedWarningCode,l=[{name:"Common.Close",defaultEscButton:!0,defaultButton:!0}],m=[],n=!1;return{showDialog:i}}),define("client.models/rpc-session",["assets/core/models/rpc-session","core.utils/websocket","core.utils/deferred","core.utils/authentication","core.utils/debug-flags","translator","client.controllers/error-handler-controller","client.controllers/warning-handler-controller","autogenerated/qix/engine-enums","qvangular"],function(a,b,c,d,e,f,g,h,i,j){function k(a){var b=["OnLicenseAccessDenied","OnSessionClosed","OnEngineWebsocketFailed","OnNoEngineAvailable","OnSessionTimedOut","OnSessionClosed","OnNoDataPrepServiceAvailable","OnDataPrepServiceWebsocketFailed"];"OnSessionLoggedOut"===a.method?g.showDialog(a.method):b.indexOf(a.method)>-1?g.showDialog({message:f.get("ProxyError."+a.method)}):"OnAuthenticationInformation"===a.method&&d.parse(a.params)}function l(a){var b="string"==typeof a?"SENT":"RECV";window.console.info("[DBGFLG:SOCKET]",b,":",a)}function m(a){var b=[];if("ExportData"!==this.reqCache[a.id].method){for(var c=0;c<a.warnings.length;c++)b.push({code:a.warnings[c]});h.showDialog(b,f)}}var n,o=i.NxLocalizedErrorCode,p=[];return a.createSocket=function(a){var c;try{c=new b(a)}catch(d){g.showDialog({message:"ErrorDialog.NoConnectionCreated"})}return c},a.hookIntoDeferred=function(a){a.promise.then(null,function(a){return j.getService("$timeout")(function(){a||(a={isHandled:!1}),a.isHandled||a.error.isHandled||a.error.code===o.LOCERR_GENERIC_ABORTED||g.showDialog(a.error)},1e3),c.reject(a)})},a.debounceApply=function(a){clearTimeout(n),p.push(a),n=setTimeout(function(){j.$apply(j.$rootScope,function(){for(var a=0;a<p.length;a++)try{p[a]()}catch(b){}p.length=0})})},a.NewSessionCreated.bind(function(a){a.Notification.bind(k),a.Warning.bind(m),e.SOCKET&&(a.Data.bind(l),a.Error.bind(l),a.Send.bind(l))}),a}),define("autogenerated/qix/engine-api-def",[],function(){"use strict";var a={Field:{GetCardinal:{In:[],Out:[]},GetAndMode:{In:[],Out:[]},SelectValues:{In:[{Name:"qFieldValues",DefaultValue:[{qText:"",qIsNumeric:!1,qNumber:0}]},{Name:"qToggleMode",DefaultValue:!1,Optional:!0},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Select:{In:[{Name:"qMatch",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qExcludedValuesMode",DefaultValue:0,Optional:!0}],Out:[]},ToggleSelect:{In:[{Name:"qMatch",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qExcludedValuesMode",DefaultValue:0,Optional:!0}],Out:[]},ClearAllButThis:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectPossible:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectExcluded:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},SelectAll:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Lock:{In:[],Out:[]},Unlock:{In:[],Out:[]},GetNxProperties:{In:[],Out:[{Name:"qProperties"}]},SetNxProperties:{In:[{Name:"qProperties",DefaultValue:{qOneAndOnlyOne:!1}}],Out:[]},SetAndMode:{In:[{Name:"qAndMode",DefaultValue:!1}],Out:[]},SelectAlternative:{In:[{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},LowLevelSelect:{In:[{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},Clear:{In:[],Out:[]}},Variable:{GetContent:{In:[],Out:[{Name:"qContent"}]},GetRawContent:{In:[],Out:[]},SetContent:{In:[{Name:"qContent",DefaultValue:""},{Name:"qUpdateMRU",DefaultValue:!1}],Out:[]},ForceContent:{In:[{Name:"qs",DefaultValue:""},{Name:"qd",DefaultValue:0}],Out:[]},GetNxProperties:{In:[],Out:[{Name:"qProperties"}]},SetNxProperties:{In:[{Name:"qProperties",DefaultValue:{qName:"",qNumberPresentation:{qType:0,qnDec:0,qUseThou:0,qFmt:"",qDec:"",qThou:""},qIncludeInBookmark:!1,qUsePredefListedValues:!1,qPreDefinedList:[""]}}],Out:[]}},GenericObject:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},GetListObjectData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeReducedData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qZoomFactor",DefaultValue:0},{Name:"qReductionMode",DefaultValue:0}],Out:[{Name:"qDataPages"}]},GetHyperCubePivotData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]}],Out:[{Name:"qDataPages"}]},GetHyperCubeStackData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qMaxNbrCells",DefaultValue:0,Optional:!0}],Out:[{Name:"qDataPages"}]},GetHyperCubeBinnedData:{In:[{Name:"qPath",DefaultValue:""},{Name:"qPages",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qViewport",DefaultValue:{qWidth:0,qHeight:0,qZoomLevel:0}},{Name:"qDataRanges",DefaultValue:[{qLeft:0,qTop:0,qWidth:0,qHeight:0}]},{Name:"qMaxNbrCells",DefaultValue:0},{Name:"qQueryLevel",DefaultValue:0},{Name:"qBinningMethod",DefaultValue:0}],Out:[{Name:"qDataPages"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]},{Name:"qSoftPatch",DefaultValue:!1,Optional:!0}],Out:[]},ClearSoftPatches:{In:[],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetEffectiveProperties:{In:[],Out:[{Name:"qProp"}]},SetFullPropertyTree:{In:[{Name:"qPropEntry",DefaultValue:{qProperty:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}},qChildren:[],qEmbeddedSnapshotRef:null}}],Out:[]},GetFullPropertyTree:{In:[],Out:[{Name:"qPropEntry"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},ClearSelections:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},ExportData:{In:[{Name:"qFileType",DefaultValue:0},{Name:"qPath",DefaultValue:"",Optional:!0},{Name:"qFileName",DefaultValue:"",Optional:!0},{Name:"qExportState",DefaultValue:0,Optional:!0}],Out:[{Name:"qUrl"}]},SelectListObjectValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectPossible:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectExcluded:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectAlternative:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectListObjectAll:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SearchListObjectFor:{In:[{Name:"qPath",DefaultValue:""},{Name:"qMatch",DefaultValue:""}],Out:[{Name:"qSuccess"}]},AbortListObjectSearch:{In:[{Name:"qPath",DefaultValue:""}],Out:[]},AcceptListObjectSearch:{In:[{Name:"qPath",DefaultValue:""},{Name:"qToggleMode",DefaultValue:!1},{Name:"qSoftLock",DefaultValue:!1,Optional:!0}],Out:[]},ExpandLeft:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},ExpandTop:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},CollapseLeft:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},CollapseTop:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRow",DefaultValue:0},{Name:"qCol",DefaultValue:0},{Name:"qAll",DefaultValue:!1}],Out:[]},DrillUp:{In:[{Name:"qPath",DefaultValue:""},{Name:"qDimNo",DefaultValue:0},{Name:"qNbrSteps",DefaultValue:0}],Out:[]},Lock:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},Unlock:{In:[{Name:"qPath",DefaultValue:""},{Name:"qColIndices",DefaultValue:[0],Optional:!0}],Out:[]},SelectHyperCubeValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qDimNo",DefaultValue:0},{Name:"qValues",DefaultValue:[0]},{Name:"qToggleMode",DefaultValue:!1}],Out:[{Name:"qSuccess"}]},SelectHyperCubeCells:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRowIndices",DefaultValue:[0]},{Name:"qColIndices",DefaultValue:[0]},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},SelectPivotCells:{In:[{Name:"qPath",DefaultValue:""},{Name:"qSelections",DefaultValue:[{qType:0,qCol:0,qRow:0}]},{Name:"qSoftLock",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},RangeSelectHyperCubeValues:{In:[{Name:"qPath",DefaultValue:""},{Name:"qRanges",DefaultValue:[{qRange:{qMin:0,qMax:0,qMinInclEq:!1,qMaxInclEq:!1},qMeasureIx:0}]},{Name:"qColumnsToSelect",DefaultValue:[0],Optional:!0},{Name:"qOrMode",DefaultValue:!1,Optional:!0},{Name:"qDeselectOnlyOneSelected",DefaultValue:!1,Optional:!0}],Out:[{Name:"qSuccess"}]},GetChild:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetChildInfos:{In:[],Out:[{Name:"qInfos"}]},CreateChild:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}},{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[{Name:"qInfo"}]},DestroyChild:{In:[{Name:"qId",DefaultValue:""},{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[{Name:"qSuccess"}]},DestroyAllChildren:{In:[{Name:"qPropForThis",DefaultValue:null,Optional:!0}],Out:[]},SetChildArrayOrder:{In:[{Name:"qIds",DefaultValue:[""]}],Out:[]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},CopyFrom:{In:[{Name:"qFromId",DefaultValue:""}],Out:[]},BeginSelections:{In:[{Name:"qPaths",DefaultValue:[""]}],Out:[]},EndSelections:{In:[{Name:"qAccept",DefaultValue:!1}],Out:[]},ResetMadeSelections:{In:[],Out:[]},EmbedSnapshotObject:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetSnapshotObject:{In:[],Out:[]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericDimension:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDim:{qGrouping:0,qFieldDefs:[""],qFieldLabels:[""]},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDimension:{In:[],Out:[{Name:"qDim"}]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericBookmark:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},Apply:{In:[],Out:[{Name:"qSuccess"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericMeasure:{GetLayout:{In:[],Out:[{Name:"qLayout"}]},ApplyPatches:{In:[{Name:"qPatches",DefaultValue:[{qOp:0,qPath:"",qValue:""}]}],Out:[]},SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMeasure:{qLabel:"",qDef:"",qGrouping:0,qExpressions:[""],qActiveExpression:0},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetMeasure:{In:[],Out:[{Name:"qMeasure"}]},GetLinkedObjects:{In:[],Out:[{Name:"qItems"}]},Publish:{In:[],Out:[]},UnPublish:{In:[],Out:[]}},GenericDerivedDefinition:{SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinition:{qName:"",qTags:[""],qParameters:[{qName:"",qValue:""}],qFieldDefs:[{qName:"",qExpression:"",qTags:[""]}],qGroupDefs:[{qName:"",qGrouping:0,qFieldDerivedDefinitionNames:[""]}]},qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},MatchTags:{In:[{Name:"qTags",DefaultValue:[""]}],Out:[]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDerivedDefinitionData:{In:[],Out:[{Name:"qData"}]},GetExpression:{In:[{Name:"qExpressionName",DefaultValue:""},{Name:"qParameters",DefaultValue:[""]}],Out:[]}},GenericDerivedFields:{SetProperties:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinitionId:"",qFieldName:[""],qMetaDef:{}}}],Out:[]},GetProperties:{In:[],Out:[{Name:"qProp"}]},GetInfo:{In:[],Out:[{Name:"qInfo"}]},GetDerivedFieldData:{In:[],Out:[{Name:"qData"}]},GetDerivedField:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qFields"}]},GetListData:{In:[],Out:[{Name:"qListData"}]},GetDerivedFields:{In:[],Out:[{Name:"qFields"}]},GetDerivedGroups:{In:[],Out:[{Name:"qGroups"}]}},InternalTest:{Initialised:{In:[],Out:[]},TestMemoryManagement:{In:[],Out:[]},TestNextFileFormat:{In:[],Out:[]},BombQRS:{In:[],Out:[]},BombQRSParallel:{In:[{Name:"qNThreads",DefaultValue:0}],Out:[]},TestLogging:{In:[{Name:"qLogger",DefaultValue:""},{Name:"qVerbosity",DefaultValue:0},{Name:"qSteps",DefaultValue:0,Optional:!0}],Out:[]},TestRepositoryLogging:{In:[{Name:"qLogger",DefaultValue:""},{Name:"qVerbosity",DefaultValue:0},{Name:"qMessage",DefaultValue:""}],Out:[]},GetQixCounters:{In:[],Out:[{Name:"qCounters"}]},ResetQixCounters:{In:[],Out:[]}},Doc:{GetProperties:{In:[],Out:[]},GetField:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},GetFieldDescription:{In:[{Name:"qFieldName",DefaultValue:""}],Out:[]},GetVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},GetLooselyCoupledVector:{In:[],Out:[{Name:"qv"}]},SetLooselyCoupledVector:{In:[{Name:"qv",DefaultValue:[0]}],Out:[]},Evaluate:{In:[{Name:"qExpression",DefaultValue:""}],Out:[]},EvaluateEx:{In:[{Name:"qExpression",DefaultValue:""}],Out:[{Name:"qValue"}]},ClearAll:{In:[{Name:"qLockedAlso",DefaultValue:!1,Optional:!0},{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},LockAll:{In:[{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},UnlockAll:{In:[{Name:"qStateName",DefaultValue:"",Optional:!0}],Out:[]},Back:{In:[],Out:[]},Forward:{In:[],Out:[]},ReduceData:{In:[{Name:"qConfirm",DefaultValue:!1,Optional:!0},{Name:"qDropFieldNames",DefaultValue:[""],Optional:!0}],Out:[]},RemoveAllData:{In:[{Name:"qConfirm",DefaultValue:!1,Optional:!0
}],Out:[]},CreateVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},RemoveVariable:{In:[{Name:"qName",DefaultValue:""}],Out:[]},GetLocaleInfo:{In:[],Out:[]},GetTablesAndKeys:{In:[{Name:"qWindowSize",DefaultValue:{qcx:0,qcy:0}},{Name:"qNullSize",DefaultValue:{qcx:0,qcy:0}},{Name:"qCellHeight",DefaultValue:0},{Name:"qSyntheticMode",DefaultValue:!1},{Name:"qIncludeSysVars",DefaultValue:!1}],Out:[{Name:"qtr"},{Name:"qk"}]},GetViewDlgSaveInfo:{In:[],Out:[]},SetViewDlgSaveInfo:{In:[{Name:"qInfo",DefaultValue:{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCtlInfo:{qInternalView:{qTables:[{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCaption:""}],qBroomPoints:[{qPos:{qx:0,qy:0},qTable:"",qFields:[""]}],qConnectionPoints:[{qPos:{qx:0,qy:0},qFields:[""]}],qZoomFactor:0},qSourceView:{qTables:[{qPos:{qLeft:0,qTop:0,qWidth:0,qHeight:0},qCaption:""}],qBroomPoints:[{qPos:{qx:0,qy:0},qTable:"",qFields:[""]}],qConnectionPoints:[{qPos:{qx:0,qy:0},qFields:[""]}],qZoomFactor:0}},qMode:0}}],Out:[]},GetEmptyScript:{In:[{Name:"qLocalizedMainSection",DefaultValue:"",Optional:!0}],Out:[]},DoReload:{In:[{Name:"qMode",DefaultValue:0,Optional:!0},{Name:"qPartial",DefaultValue:!1,Optional:!0},{Name:"qDebug",DefaultValue:!1,Optional:!0}],Out:[]},GetScriptBreakpoints:{In:[],Out:[{Name:"qBreakpoints"}]},SetScriptBreakpoints:{In:[{Name:"qBreakpoints",DefaultValue:[{qbufferName:"",qlineIx:0,qEnabled:!1}]}],Out:[]},GetScript:{In:[],Out:[{Name:"qScript"}]},GetTextMacros:{In:[],Out:[{Name:"qMacros"}]},SetFetchLimit:{In:[{Name:"qLimit",DefaultValue:0}],Out:[]},DoSave:{In:[{Name:"qFileName",DefaultValue:"",Optional:!0}],Out:[]},GetTableData:{In:[{Name:"qOffset",DefaultValue:0},{Name:"qRows",DefaultValue:0},{Name:"qSyntheticMode",DefaultValue:!1},{Name:"qTableName",DefaultValue:""}],Out:[{Name:"qData"}]},GetAppLayout:{In:[],Out:[{Name:"qLayout"}]},SetAppProperties:{In:[{Name:"qProp",DefaultValue:{qTitle:"",qLastReloadTime:"",qMigrationHash:"",qSavedInProductVersion:"",qThumbnail:{qUrl:""}}}],Out:[]},GetAppProperties:{In:[],Out:[{Name:"qProp"}]},CreateSessionObject:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[]},DestroySessionObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},CreateObject:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qExtendsId:"",qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetObject:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneObject:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateDraft:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qDraftId"}]},CommitDraft:{In:[{Name:"qId",DefaultValue:""}],Out:[]},DestroyDraft:{In:[{Name:"qId",DefaultValue:""},{Name:"qSourceId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},Undo:{In:[],Out:[{Name:"qSuccess"}]},Redo:{In:[],Out:[{Name:"qSuccess"}]},ClearUndoBuffer:{In:[],Out:[]},CreateDimension:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDim:{qGrouping:0,qFieldDefs:[""],qFieldLabels:[""]},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneDimension:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateMeasure:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMeasure:{qLabel:"",qDef:"",qGrouping:0,qExpressions:[""],qActiveExpression:0},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[]},CloneMeasure:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},CreateDerivedDefinition:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinition:{qName:"",qTags:[""],qParameters:[{qName:"",qValue:""}],qFieldDefs:[{qName:"",qExpression:"",qTags:[""]}],qGroupDefs:[{qName:"",qGrouping:0,qFieldDerivedDefinitionNames:[""]}]},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetDerivedDefinitionByName:{In:[{Name:"qName",DefaultValue:""}],Out:[]},CloneDerivedDefinition:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},GetDerivedDefinitionsForTags:{In:[{Name:"qTags",DefaultValue:[""]}],Out:[{Name:"qInstanceName"}]},AssignDerivedFieldFor:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qDerivedDefinitionNames",DefaultValue:[""]}],Out:[]},CreateDerivedFields:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qDerivedDefinitionId:"",qFieldName:[""],qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyDerivedFields:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetDerivedFields:{In:[{Name:"qId",DefaultValue:""}],Out:[]},GetAllDerivedFields_INTERNAL:{In:[],Out:[{Name:"qDerivedFields"}]},GetDerivedFieldDimensionDef:{In:[{Name:"qLibraryId",DefaultValue:""}],Out:[{Name:"qDimensionDef"}]},GetDerivedFieldFor:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qGetDerivedDefinitionsForTags",DefaultValue:""}],Out:[]},GetAllDerivedFieldsFor:{In:[{Name:"qFieldName",DefaultValue:""}],Out:[{Name:"qDerivedFields"}]},MigrateDerivedFields:{In:[],Out:[]},CheckExpression:{In:[{Name:"qExpr",DefaultValue:""},{Name:"qLabels",DefaultValue:[""],Optional:!0}],Out:[{Name:"qErrorMsg"},{Name:"qBadFieldNames"},{Name:"qDangerousFieldNames"}]},CheckNumberOrExpression:{In:[{Name:"qExpr",DefaultValue:""}],Out:[{Name:"qErrorMsg"},{Name:"qBadFieldNames"}]},AddAlternateState:{In:[{Name:"qStateName",DefaultValue:""}],Out:[]},RemoveAlternateState:{In:[{Name:"qStateName",DefaultValue:""}],Out:[]},CreateBookmark:{In:[{Name:"qProp",DefaultValue:{qInfo:{qId:"",qType:""},qMetaDef:{}}}],Out:[{Name:"qInfo"}]},DestroyBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[]},ApplyBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},CloneBookmark:{In:[{Name:"qId",DefaultValue:""}],Out:[{Name:"qCloneId"}]},AddFieldFromExpression:{In:[{Name:"qName",DefaultValue:""},{Name:"qExpr",DefaultValue:""}],Out:[{Name:"qSuccess"}]},GetAllInfos:{In:[],Out:[{Name:"qInfos"}]},Resume:{In:[],Out:[]},AbortModal:{In:[{Name:"qAccept",DefaultValue:!1}],Out:[]},Publish:{In:[{Name:"qStreamId",DefaultValue:""},{Name:"qName",DefaultValue:"",Optional:!0}],Out:[]},UnPublish:{In:[],Out:[]},GetMatchingFields:{In:[{Name:"qTags",DefaultValue:[""]},{Name:"qMatchingFieldMode",DefaultValue:0,Optional:!0}],Out:[{Name:"qFieldNames"}]},FindMatchingFields:{In:[{Name:"qFieldName",DefaultValue:""},{Name:"qTags",DefaultValue:[""]}],Out:[{Name:"qFieldNames"}]},SearchSuggest:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]}],Out:[{Name:"qResult"}]},SearchAssociations:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]},{Name:"qPage",DefaultValue:{qOffset:0,qCount:0,qMaxNbrFieldMatches:0}}],Out:[{Name:"qResults"}]},SelectAssociations:{In:[{Name:"qOptions",DefaultValue:{qSearchFields:[""],qContext:0}},{Name:"qTerms",DefaultValue:[""]},{Name:"qMatchIx",DefaultValue:0},{Name:"qSoftLock",DefaultValue:null,Optional:!0}],Out:[]},SaveObjects:{In:[],Out:[]},GetAssociationScores:{In:[{Name:"qTable1",DefaultValue:""},{Name:"qTable2",DefaultValue:""}],Out:[{Name:"qScore"}]},GetMediaList:{In:[],Out:[{Name:"qList"}]},DoReloadEx:{In:[{Name:"qParams",DefaultValue:{qMode:0,qPartial:!1,qDebug:!1},Optional:!0}],Out:[{Name:"qResult"}]},BackCount:{In:[],Out:[]},ForwardCount:{In:[],Out:[]},SetScript:{In:[{Name:"qScript",DefaultValue:""}],Out:[]},CheckScriptSyntax:{In:[],Out:[{Name:"qErrors"}]},GetFavoriteVariables:{In:[],Out:[{Name:"qNames"}]},SetFavoriteVariables:{In:[{Name:"qNames",DefaultValue:[""]}],Out:[]},GetIncludeFileContent:{In:[{Name:"qPath",DefaultValue:""}],Out:[{Name:"qContent"}]},CreateConnection:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[{Name:"qConnectionId"}]},ModifyConnection:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}},{Name:"qOverrideCredentials",DefaultValue:!1,Optional:!0}],Out:[]},DeleteConnection:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[]},GetConnection:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qConnection"}]},GetConnections:{In:[],Out:[{Name:"qConnections"}]},GetDatabaseInfo:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qInfo"}]},GetDatabases:{In:[{Name:"qConnectionId",DefaultValue:""}],Out:[{Name:"qDatabases"}]},GetDatabaseOwners:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0}],Out:[{Name:"qOwners"}]},GetDatabaseTables:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0}],Out:[{Name:"qTables"}]},GetDatabaseTableFields:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qFields"}]},GetDatabaseTablePreview:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qDatabase",DefaultValue:"",Optional:!0},{Name:"qOwner",DefaultValue:"",Optional:!0},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qPreview"}]},GetFolderItemsForConnection:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0}],Out:[{Name:"qFolderItems"}]},GuessFileType:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0}],Out:[{Name:"qDataFormat"}]},GetFileTables:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}}],Out:[{Name:"qTables"}]},GetFileTableFields:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qFields"},{Name:"qFormatSpec"}]},GetFileTablePreview:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}},{Name:"qTable",DefaultValue:""}],Out:[{Name:"qPreview"},{Name:"qFormatSpec"}]},GetFileTablesEx:{In:[{Name:"qConnectionId",DefaultValue:""},{Name:"qRelativePath",DefaultValue:"",Optional:!0},{Name:"qDataFormat",DefaultValue:{qType:0,qLabel:"",qQuote:"",qComment:"",qDelimiter:{qName:"",qScriptCode:"",qNumber:0,qIsMultiple:!1},qCodePage:0,qHeaderSize:0,qRecordSize:0,qTabSize:0,qIgnoreEOF:!1,qFixedWidthDelimiters:""}}],Out:[{Name:"qTables"}]},SendGenericCommandToCustomConnector:{In:[{Name:"qProvider",DefaultValue:""},{Name:"qCommand",DefaultValue:""},{Name:"qMethod",DefaultValue:""},{Name:"qParameters",DefaultValue:[""]},{Name:"qAppendConnection",DefaultValue:""}],Out:[{Name:"qResult"}]}},Global:{AbortRequest:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[]},AbortAll:{In:[],Out:[]},GetProgress:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[{Name:"qProgressData"}]},QvVersion:{In:[],Out:[]},OSVersion:{In:[],Out:[]},OSName:{In:[],Out:[]},QTProduct:{In:[],Out:[]},GetDocList:{In:[],Out:[{Name:"qDocList"}]},GetInteract:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[{Name:"qDef"}]},InteractDone:{In:[{Name:"qRequestId",DefaultValue:0},{Name:"qDef",DefaultValue:{qType:0,qTitle:"",qMsg:"",qButtons:0,qLine:"",qOldLineNr:0,qNewLineNr:0,qPath:"",qHidden:!1,qResult:0,qInput:""}}],Out:[]},GetAuthenticatedUser:{In:[],Out:[]},GetStreamList:{In:[],Out:[{Name:"qStreamList"}]},CreateDocEx:{In:[{Name:"qDocName",DefaultValue:""},{Name:"qUserName",DefaultValue:"",Optional:!0},{Name:"qPassword",DefaultValue:"",Optional:!0},{Name:"qSerial",DefaultValue:"",Optional:!0},{Name:"qLocalizedScriptMainSection",DefaultValue:"",Optional:!0}],Out:[{Name:"qDocId"}]},GetActiveDoc:{In:[],Out:[]},AllowCreateApp:{In:[],Out:[]},CreateApp:{In:[{Name:"qAppName",DefaultValue:""},{Name:"qLocalizedScriptMainSection",DefaultValue:"",Optional:!0}],Out:[{Name:"qSuccess"},{Name:"qAppId"}]},DeleteApp:{In:[{Name:"qAppId",DefaultValue:""}],Out:[{Name:"qSuccess"}]},IsDesktopMode:{In:[],Out:[]},GetConfiguration:{In:[],Out:[{Name:"qConfig"}]},CancelRequest:{In:[{Name:"qRequestId",DefaultValue:0}],Out:[]},GetInternalTest:{In:[{Name:"qKey",DefaultValue:""}],Out:[]},ShutdownProcess:{In:[],Out:[]},ReloadExtensionList:{In:[],Out:[]},ReplaceAppFromID:{In:[{Name:"qTargetAppId",DefaultValue:""},{Name:"qSrcAppID",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},ReplaceAppFromPath:{In:[{Name:"qTargetAppId",DefaultValue:""},{Name:"qSrcPath",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},CopyApp:{In:[{Name:"qTargetAppId",DefaultValue:""},{Name:"qSrcAppId",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},ImportApp:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qSrcPath",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},ImportAppEx:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qSrcPath",DefaultValue:""},{Name:"qIds",DefaultValue:[""]},{Name:"qExcludeConnections",DefaultValue:!1}],Out:[]},ExportApp:{In:[{Name:"qTargetPath",DefaultValue:""},{Name:"qSrcAppId",DefaultValue:""},{Name:"qIds",DefaultValue:[""]}],Out:[{Name:"qSuccess"}]},PublishApp:{In:[{Name:"qAppId",DefaultValue:""},{Name:"qStreamId",DefaultValue:""},{Name:"qCopy",DefaultValue:!1},{Name:"qReplaceId",DefaultValue:"",Optional:!0}],Out:[{Name:"qSuccess"}]},IsPersonalMode:{In:[],Out:[]},GetUniqueID:{In:[],Out:[{Name:"qUniqueID"}]},OpenDoc:{In:[{Name:"qDocName",DefaultValue:""},{Name:"qUserName",DefaultValue:"",Optional:!0},{Name:"qPassword",DefaultValue:"",Optional:!0},{Name:"qSerial",DefaultValue:"",Optional:!0},{Name:"qNoData",DefaultValue:!1,Optional:!0}],Out:[]},CreateSessionApp:{In:[],Out:[{Name:"qSessionAppId"}]},CreateSessionAppFromApp:{In:[{Name:"qSrcAppId",DefaultValue:""}],Out:[{Name:"qSessionAppId"}]},ProductVersion:{In:[],Out:[]},GetAppEntry:{In:[{Name:"qAppID",DefaultValue:""}],Out:[{Name:"qEntry"}]},ConfigureReload:{In:[{Name:"qCancelOnScriptError",DefaultValue:!1},{Name:"qUseErrorData",DefaultValue:!1},{Name:"qInteractOnError",DefaultValue:!1}],Out:[]},CancelReload:{In:[],Out:[]},GetBNF:{In:[{Name:"qBnfType",DefaultValue:0}],Out:[{Name:"qBnfDefs"}]},GetFunctions:{In:[{Name:"qGroup",DefaultValue:0,Optional:!0}],Out:[{Name:"qFunctions"}]},GetOdbcDsns:{In:[],Out:[{Name:"qOdbcDsns"}]},GetOleDbProviders:{In:[],Out:[{Name:"qOleDbProviders"}]},GetDatabasesFromConnectionString:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[{Name:"qDatabases"}]},IsValidConnectionString:{In:[{Name:"qConnection",DefaultValue:{qId:"",qName:"",qConnectionString:"",qType:"",qUserName:"",qPassword:"",qModifiedDate:"",qMeta:{qName:""}}}],Out:[]},GetDefaultAppFolder:{In:[],Out:[{Name:"qPath"}]},GetMyDocumentsFolder:{In:[],Out:[{Name:"qFolder"}]},GetLogicalDriveStrings:{In:[],Out:[{Name:"qDrives"}]},GetFolderItemsForPath:{In:[{Name:"qPath",DefaultValue:""}],Out:[{Name:"qFolderItems"}]},GetSupportedCodePages:{In:[],Out:[{Name:"qCodePages"}]},GetCustomConnectors:{In:[{Name:"qReloadList",DefaultValue:!1,Optional:!0}],Out:[{Name:"qConnectors"}]}}};return a}),define("core.models/engine",["client.models/rpc-session","autogenerated/qix/engine-api-def","core.utils/deferred"],function(a,b,c){"use strict";function d(a,b){n.openApps[a]=b}function e(a){this._session=a}function f(b,c,d){var f=a.get(c,d);return f.Close.bind(function(){delete b._session,delete n.openApps[c]}),f.open(),new e(f)}function g(a){return a.substring(0,1).toLowerCase()+a.substring(1)}function h(a,b){var c=function(b,c){this._cache={},this._handle=!!b&&!!b.qReturn&&b.qReturn.qHandle,this._session=c,this.__engineTypeName=a};for(var d in b){var e=b[d];c.prototype[g(d)]=k(d,e)}return function(a,b){return new c(a,b)}}function i(a,b,c){var d;return a._session?d="OpenDoc"!==b&&"OpenApp"!==b||!a._session.isAssignToApp()&&c===a._session.getAppName()?a._session:f(a,c,a._rpcOptions):(a._session=f(a,c,a._rpcOptions),d=a._session),d}function j(a,b){var c=Object.keys(a),d=b.In.map(function(a){return a.Name});return 0!==c.filter(function(a,b){return a===d[b]}).length}function k(a,b){var e=function(){var e=this,f=Array.prototype.slice.apply(arguments);1===f.length&&"object"==typeof f[0]&&j(f[0],b)&&(f=f[0]);var g;"OpenDoc"===a||"OpenApp"===a?(g=i(e,a,f[0]),delete e._rpcOptions):!e._session&&"Global"===e.__engineTypeName&&Object.keys(n.openApps).length?(e._session=Object.keys(n.openApps).map(function(a){return n.openApps[a]._session})[0],g=e._session):g=i(e,a);var h={method:a,params:f,handle:this._handle||-1},k=g.rpc(h).then(function(b){var c;if(b){if(b.qReturn&&b.qReturn.qHandle&&b.qReturn.qType){var i=m[b.qReturn.qType];c=i(b,g)}else if(b.hasOwnProperty("qResult"))c=b.qResult,e["current"+a]=b.qResult;else if(b.hasOwnProperty("qReturn")&&1===Object.keys(b).length)c=b.qReturn,e["current"+a]=b.qReturn;else{for(var j in b)b.hasOwnProperty(j)&&(e[j]=b[j]);c=b}return("OpenDoc"===a||"OpenApp"===a)&&(g._session.connectedAppHandle=b.qReturn.qHandle,c.name=f[0],c.selectAsCurrentApp=function(){n.currentApp=c},d(f[0],c)),c&&"object"==typeof c&&(c.__protocolRequestId=h.id),c}return void 0},function(a){return c.reject(a.error)});return k.__protocolRequestId=h.id,k};return e}function l(){var a={};for(var c in b){var d=b[c];a[c]=h(c,d)}return a}var m={},n={global:void 0,openApps:{},currentApp:void 0};return e.prototype.rpc=function(a){return this._session.rpc(a).then(function(a){return a.result})},e.prototype.getAppName=function(){return this._session.options.appName},e.prototype.isAssignToApp=function(){return!!this.appName},m=l(),n.global=m.Global(),n.types=m,n.getCurrentApp=function(){return n.currentApp},n.openApp=function(b,c){var d=n.global,f=c&&c.openWithoutData?c.openWithoutData:!1;return d._rpcOptions=c,d._session&&(d._session=new e(a.get(b,c))),d.openDoc(b,"","","",f)},"undefined"!=typeof window&&(window.engineModuleGlobal=n),n}),define("core.models/app",["core.models/rpc-base","client.models/rpc-session","core.models/engine","core.utils/deferred","util","qvangular","client.controllers/error-handler-controller","autogenerated/qix/engine-enums"],function(a,b,c,d,e,f,g,h){"use strict";function i(){f.getService("$timeout")(function(){g.showDialog({code:h.NxLocalizedErrorCode.LOCERR_GENERIC_CONNECTION_LOST})},1e3)}var j,k,l={};return j=a.extend("App",{init:function(a,c,e){var f=this;e&&k||(k=f);var g=b.get(a,c);if(g.Close.bind(i),g.modelCache[a]=d.resolve(f),f.waitForOpen=new d,f.rpcOptions=c,f._super({id:a,session:g,checkCreate:!0}),f.session.connectedAppHandle)f.handle=f.session.connectedAppHandle,f.bindToRPC(),f.waitForOpen.resolve(f);else try{f.session.open(),f.open().then(function(){f.waitForOpen.resolve(f)},function(a){f.waitForOpen.reject({error:a})})}catch(h){f.waitForOpen.reject({isHandled:!1,error:h})}f.session.currentApp=f},open:function(){function a(a){a.selectAsCurrentApp(),b.session.connectedAppHandle=b.handle=a._handle,b.engineApp=a,b.bindToRPC()}var b=this;return b.rpcOptions||(b.rpcOptions={}),b.session.Error.bind(function(a){window.console.log("Error from Engine:",a)}),b.rpcOptions||(b.rpcOptions={}),"true"===e.getParameterByName("noData")&&(b.rpcOptions.openWithoutData=!0),c.openApp(b.id,b.rpcOptions).then(a)},close:function(a){return a?g.showDialog({message:"ErrorDialog.AppClosed"}):this.session.Close.unbind(i),this.session.close(),this._super()},createSessionObject:function(a){return this.rpc("CreateSessionObject","qReturn",[a])},doSave:function(){return this.rpc("DoSave",null)},getLayout:function(){return this._super("GetAppLayout")},getProperties:function(){return this._super("GetAppProperties")},setProperties:function(a){return this._super(a,"SetAppProperties")},checkExpression:function(a,b){var c=[a];return b&&c.push(b),this.rpc("CheckExpression",null,c)},checkNumberOrExpression:function(a){return this.rpc("CheckNumberOrExpression",null,[a])},evaluateExpression:function(a){return this.rpc("Evaluate","qReturn",[a])},getConfiguration:function(){return this.session.rpc({method:"GetConfiguration",handle:-1,params:[]}).then(function(a){return a.result.qConfig})},getVersion:function(){return this.session.rpc({method:"QvVersion",handle:-1,params:[]}).then(function(a){return a.result.qReturn})},getListOfFunctions:function(){return this.session.rpc({method:"GetFunctions",handle:-1,params:[]}).then(function(a){return a.result.qFunctions})},getLocaleInfo:function(){return this.rpc("GetLocaleInfo","qReturn")},getExpressions:function(){return this.rpc("GetExpressions","qExpressions")},getStreams:function(){var a=this;return a.streamsList?d.resolve(a.streamsList):this.session.rpc({method:"GetStreamList",handle:-1,params:[]}).then(function(b){return a.streamsList=b.result.qStreamList,a.streamsList})},getPublishableStreams:function(){var a=this.getLayout(),b=this.getStreams(),c=new d;return d.all({layout:a,streams:b}).then(function(a){var b=a.streams.filter(function(b){return a.layout.stream?b.qId===a.layout.stream.id&&-1!==b.privileges.indexOf("publish"):-1!==b.privileges.indexOf("publish")});c.resolve(b)}),c.promise},getMatchingFields:function(a){return this.rpc("GetMatchingFields",null,[a])},getMediaList:function(){return this.rpc("GetMediaList").then(function(a){return a.qList.qItems})},findMatchingFields:function(a,b){return this.rpc("FindMatchingFields",null,[a,b])},abortModal:function(a){return a=void 0!==a?a:!0,this.setModal(null),this.rpc("AbortModal",null,[a])},switchModal:function(a,b,c){var e,f=this;return a=a||null,b=b||"",e=Array.isArray(b)?b:[b],c=void 0!==c?c:!0,f.modalObject&&!f.modalObject.isClosed&&f.modalObject.rpc("EndSelections",null,[c]),a&&!a.isClosed?(f.modalObject=a,a.rpc("BeginSelections",null,[e])):(f.setModal(null),d.resolve())},setModal:function(a){this.modalObject=a},isModal:function(){return null!=this.modalObject},publish:function(a){return this.rpc("Publish",null,[a])}}),Object.defineProperty(j,"current",{get:function(){return k}}),j.get=function(a,b,c){var d=j.getSync(a,b,c);return d.waitForOpen.promise},j.getSync=function(a,b,c){a=a||e.getParameterByName("app")||"?transient=","undefined"==typeof b&&(b={}),"string"!=typeof b.host&&(b.host=e.hostname),"string"!=typeof b.port&&(b.port=e.port),"string"!=typeof b.prefix&&(b.prefix=e.basePath),"boolean"!=typeof b.isSecure&&(b.isSecure=e.isSecure),"string"!=typeof b.reloadURI&&(b.reloadURI=e.reloadURI);var d=l[a.toLowerCase()]=l[a.toLowerCase()]||new j(a,b,c);return d},j.create=function(a,b){return b.rpc({method:"CreateApp",handle:-1,params:[a]}).then(function(a){return a.result})},j.remove=function(a,b){return b.rpc({method:"DeleteApp",handle:-1,params:[a]}).then(function(a){return a.result})},j.getList=function(a){return a.rpc({method:"GetDocList",handle:-1,params:[]}).then(function(a){return a.result.qDocList})},j}),define("objects.backend-api/backend-api",["jquery","core.utils/class","core.utils/deferred","./cache-cube","./backend-throttle","core.models/app"],function(a,b,c,d,e,f){"use strict";var g;return g=b.extend("BackendApi",{init:function(a,b,c){this.model=a,this.localeInfo=a.session.currentApp.layout.qLocaleInfo,this.path=b,b&&(this.dataPath=b.slice(1,-3)),this.cacheCube=new d(a,"qDataPages",this.path,c),this.backendStackThrottle=new e(a,"qDataPages",this.path)},setCacheOptions:function(a){this.cacheCube.setOptions(a)},updateCache:function(){},applyPatches:function(a){return this.model.rpc("ApplyPatches",null,a)},clearSoftProperties:function(){var a=this;return this.model.getLayout().then(function(b){return b.qHasSoftPatches?a.model.rpc("ClearSoftPatches"):c.resolve()})},beginSelections:function(){return f.current.switchModal(this.model,this.path)},endSelections:function(a){return f.current.switchModal(null,null,a)},clearSelections:function(a){return a=a||0,this.model.rpc("ClearSelections",null,[this.path,[a]])},getDimensionInfos:function(){return this.model.layout[this.dataPath].qDimensionInfo?Array.isArray(this.model.layout[this.dataPath].qDimensionInfo)?this.model.layout[this.dataPath].qDimensionInfo:[this.model.layout[this.dataPath].qDimensionInfo]:[]},getMeasureInfos:function(){return this.model.layout[this.dataPath].qMeasureInfo},getRowCount:function(){return this.model.layout[this.dataPath].qSize.qcy},eachDataRow:function(b){var c=this.model.layout[this.dataPath],d=!0;c&&a.each(c.qDataPages,function(c,e){return a.each(e.qMatrix,function(a,c){return d=b(e.qArea.qTop+a,c)}),d})},drillUp:function(a,b){return this.model.rpc("DrillUp",null,[this.path,a,b])},hasSelections:function(){for(var a=this.getDimensionInfos(),b=0;b<a.length;++b)if(a[b].qStateCounts.qSelected>0)return!0;return!1},inSelections:function(){return this.model.layout.qSelectionInfo&&this.model.layout.qSelectionInfo.qInSelections},destroy:function(){this.cacheCube.destroy(),this.backendStackThrottle.destroy()},getSize:function(){return this.model.layout[this.dataPath].qSize}})}),define("objects.backend-api/snapshot-api",["./backend-api","core.utils/deferred","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer"],function(a,b,c,d){"use strict";function e(a,b,c,d){if(a){b.snapshotData.object.origDataPages||(b.snapshotData.object.origDataPages=b.qHyperCube[d]);for(var e=0;e<c.length;e++)c[e].qHeight=Math.min(b.qHyperCube.qSize.qcy,c[e].qHeight),c[e].qTop=b.snapshotData.object.origDataPages[e].qArea.qTop;b.qHyperCube[d]=a.get(c)}}function f(a){if("pivot-table"===a.visualization)this.responseProperty="qPivotDataPages",this.slicer=new d;else{if("table"!==a.visualization)return;this.slicer=new c}a.snapshotData.object.origDataPages?this.slicer.store(a.snapshotData.object.origDataPages):this.slicer.store(a.qHyperCube[this.responseProperty])}var g;return g=a.extend("SnapshotAPI",{init:function(a){this.responseProperty="qDataPages",f.call(this,a.layout),this._super(a,a.layout.qListObject?"/qListObjectDef":"/qHyperCubeDef")},getData:function(a){var c=b();if("map"===this.model.layout.visualization){var d=this.dataPath.split("/")[1],f=this.dataPath.split("/"),g=f[f.length-1];"polygon"===this.model.layout.layers[d].type&&"3"===this.model.layout.layers[d].version?c.resolve({qDataPages:this.model.layout.layers[d].geodata.qHyperCube[this.responseProperty]}):c.resolve({qDataPages:this.model.layout.layers[d][g][this.responseProperty]})}else e(this.slicer,this.model.layout,a,this.responseProperty),c.resolve(this.model.layout[this.dataPath][this.responseProperty]);return c.promise},getHyperCubeAdaptiveGrid:function(){return b.resolve(this.model.layout.dataPages)},getSize:function(){return this.model.layout[this.dataPath].qSize},beginSelections:function(){},endSelections:function(){},clearSelections:function(){},isSnapshot:!0})}),define("client.utils/state",["core.utils/notification","general.controllers/route-controller"],function(a,b){"use strict";var c,d,e,f,g,h,i={};return i.States={analysis:0,edit:1,snapshot:2,play:3,editstory:4,editwidget:5},i.Views={overview:0,sheet:1,story:2,object:3,masterObject:4,widgetEditor:5,dataSpace:6},a.mixin(i),i.notification("StateChanged"),i.notification("SheetChanged"),i.notification("StoryChanged"),i.setState=function(a){a!==d&&(g=d,d=a,i.StateChanged.emit(c,d,h,g),c===i.Views.sheet||c===i.Views.object||c===i.Views.masterObject?b.setUrl(b.buildUrl("sheet",e.layout.qInfo.qId,"state",Object.keys(i.States)[a])):c===i.Views.story&&b.setUrl(b.buildUrl("story",e.layout.qInfo.qId,"state",Object.keys(i.States)[a],"slide",f)))},i.setView=function(a){a!==c&&(h=c,c=a,a===i.Views.overview&&(e=null),i.StateChanged.emit(c,d,h,g))},i.setSheet=function(a,b){var f=!1;a!==e&&(e=a,h=c,c=i.Views.sheet,i.SheetChanged.emit(a),f=!0),i.States[b]!==d&&(g=d,d=i.States[b]||i.States.analysis,f=!0),f&&i.StateChanged.emit(c,d,h,g)},i.setStory=function(a,b,j){var k=!1;a!==e&&(e=a,h=c,c=i.Views.story,i.StoryChanged.emit(a),k=!0),f=j,i.States[b]!==d&&(g=d,d=i.States[b]||i.States.editstory,k=!0),k&&i.StateChanged.emit(c,d,h,g)},i.isInAnalysisMode=function(){return d===i.States.analysis},i.isInEditMode=function(){return d===i.States.edit},i.isInSnapshotMode=function(){return d===i.States.snapshot},i.inStoryPlayState=function(){return i.inStorytelling()&&d===i.States.play},i.inStorytelling=function(){return c===i.Views.story},i.inAppOverView=function(){return c===i.Views.overview},i.inDataSpace=function(){return c===i.Views.dataSpace},i.inSheetView=function(){return c===i.Views.sheet},i.inObjectView=function(){return c===i.Views.object},i.inMasterObjectView=function(){return c===i.Views.masterObject},i.isInWidgetEditMode=function(){return d===i.States.editwidget},i.getModel=function(){return i.model},Object.defineProperties(i,{state:{get:function(){return d}},view:{get:function(){return c}},model:{get:function(){return e},set:function(a){e=a}}}),i}),define("general.utils/visualizations",[],function(){function a(a){return c[a]}function b(a,b){c[a]=b}var c={};return{getType:a,getRegisteredNames:function(){return Object.keys(c)},getLibraryInfo:function(a){return c[a]?c[a].getLibraryInfo():null},getTemplateIconClassName:function(a){return c[a]?c[a].getTemplateIconClassName():null},getIconChar:function(a){return c[a]?c[a].getIconChar():null},registerType:b}}),define("general.utils/property-resolver",[],function(){function a(a){return"object"==typeof a.items&&"array"!==a.type&&("items"===a.type||"items"===a.component||"expandable-items"===a.component||"accordion"===a.component||!a.type&&!a.component)}function b(a,b,c){var d,e=b.split("."),f=a,g=e[e.length-1];for(d=0;d<e.length-1;++d)"undefined"==typeof f[e[d]]&&(f[e[d]]=isNaN(e[d+1])?{}:[]),f=f[e[d]];"undefined"!=typeof c?f[g]=c:delete f[g]}function c(a,b,c){var d,e=b.split("."),f=a;for(d=0;d<e.length;++d){if("undefined"==typeof f[e[d]])return c;f=f[e[d]]}return f}function d(a,b,c){if("string"!=typeof b)return b;switch(a){case"integer":b=parseInt(b,10),isNaN(b)&&(b=c);break;case"number":b=parseFloat(b),isNaN(b)&&(b=c);break;case"boolean":b="true"===b}return b}function e(a,b){if("function"==typeof b.defaultValue)return b.defaultValue();if("undefined"!=typeof b.defaultValue)return b.defaultValue;if(Array.isArray(b.options))return b.options[0].value;switch(a){case"array":return[];case"string":return"";case"integer":return 0;case"number":return 0;case"boolean":return!1;default:return null}}function f(c){function d(c){var g,h,i;if(!c.schemaIgnore)if(a(c))for(g=Object.keys(c.items),i=0;i<g.length;i++)h=c.items[g[i]],h&&d(h);else c.ref&&!c.schemaIgnore&&b(f,c.ref,e(c.type,c))}var f={};return"array"===c.type&&c.items?(f={},d({type:"items",items:c.items})):d(c),f}var g={};return g.invertedBoolean={get:function(a){return!a("boolean")},set:function(a,b){b("boolean",!a)}},g.booleanToSortInteger={get:function(a){return!!a("integer")},set:function(a,b,c){var d;a?(d=c.defaultSort?c.defaultSort:1,b("integer",d)):b("integer",0)}},g.enumToSortInteger={get:function(a){switch(a("integer")){case-1:return"descending";case 1:return"ascending";default:return"disabled"}},set:function(a,b){switch(a){case"descending":b("integer",-1);break;case"ascending":b("integer",1);break;default:b("integer",void 0)}}},{getValue:c,setValue:b,getTypeValue:d,getDefaultValue:e,getDefaults:f,resolveFunctions:g,isHierarchical:a}}),define("client.property-panel/default-sorting-properties",["general.utils/property-resolver"],function(a){
var b=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return{type:"array",component:"sorting",translation:"properties.sorting",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",allowMove:!0,schemaIgnore:!0,items:{dimensions:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){return a.qDef.autoSort?b.autoSortDimension(a).then(function(){}):void 0}},dimension:{component:"sorting-dimension",type:"items",ref:"",items:{dimensionDefinition:{type:"items",grouped:!0,items:{expression:{type:"items",items:{expressionToggled:{type:"boolean",ref:"qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",expressionType:"ValueExpr",ref:"qExpression",translation:"Common.Expression",defaultValue:"",show:function(b){return 0!==a.getValue(b,"qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qSortByExpression",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByExpression",0)}}}},frequency:{type:"items",show:!1,items:{frequencyToggled:{type:"boolean",ref:"qSortByFrequency",translation:"properties.sorting.sortByFrequency",resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qSortByFrequency",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByFrequency",0)}}}},numeric:{type:"items",items:{numericToggled:{type:"boolean",ref:"qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortByNumeric",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByNumeric",0)}}}},ascii:{type:"items",items:{asciiToggled:{type:"boolean",ref:"qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortByAscii",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(a){return!(a.qSortByAscii||a.qSortByNumeric||a.qSortByExpression||a.qSortByFrequency)}}}}}}}},measures:{type:"items",component:"expandable-items",grouped:!0,ref:"qHyperCubeDef.qMeasures",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){return a.qDef.autoSort?b.autoSortMeasure(a).then(function(){}):void 0}},numeric:{type:"items",show:function(a){return!a.qDef.autoSort},items:{numericToggled:{type:"boolean",ref:"qSortBy.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByNumeric",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortBy.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(a){return!a.qDef.autoSort},items:{asciiToggled:{type:"boolean",ref:"qSortBy.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qSortBy.qSortByAscii",options:b,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qSortBy.qSortByAscii",0)}}}},defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(b){var c;return b.qDef.autoSort?!1:(c=a.getValue(b,"qSortBy",{}),c.qSortByAscii||c.qSortByNumeric||c.qSortByFrequency?!1:!0)}}}}}}}),define("general.utils/number-formatting",["util"],function(a){function b(a,b,c,d,e){void 0===c&&(c=e.qDecimalSep),void 0===d&&(d=e.qThousandSep);var f,g,h,i,j="";if("F"===a)if(0===b)j="#"+d+"##0";else for(j="#"+d+"##0"+c,h=0;b>h;++h)j+="0";else{for(h=0;b>h;++h)j+="#";b>3&&(i=j.length,f=j.substring(0,i-3),g=j.substr(i-3),j=f+d+g)}return j}var c;return{setNumFmtPattern:function(a,b,d){var e,f={type:b.qType||"U",nDec:"qType"===a?("F"===b.qType,2):"R"===b.qType?b.qnDec||10:"number"==typeof b.qnDec?Math.max(0,b.qnDec):2,thousandSep:b.qThou,decimalSep:b.qDec};e=this._getSeparators(a,"M"===b.qType,f.decimalSep,f.thousandSep,d),e.decimal!==c&&(f.decimalSep=e.decimal),e.thousand!==c&&(f.thousandSep=e.thousand),b.qType=f.type,b.qnDec=f.nDec,b.qDec=f.decimalSep,b.qThou=f.thousandSep,b.qFmt=this._getPattern(f.type,f.nDec,f.decimalSep,f.thousandSep,d),["D","T","TS","IV"].indexOf(f.type)>=0&&(b.qDec="",b.qThou="")},_getSeparators:function(a,b,c,d,e){var f=c,g=d,h="q"+(b?"Money":"");return"qType"===a?(g=e[h+"ThousandSep"]||"",f=e[h+"DecimalSep"]||"."):"qThou"===a&&void 0===d?(g=e[h+"ThousandSep"]||"",f=c||"."):"qDec"!==a||void 0!==c&&""!==c||(f=e[h+"DecimalSep"]||".",g=d||""),{decimal:f||".",thousand:g||""}},_getPattern:function(b,c,d,e,f){var g;switch(b){case"U":return"";case"I":return"#"+e+"##0";case"R":case"F":return this.getNDecPattern("F",c,d,e,f);case"M":return g=f.qMoneyFmt,f.qMoneyDecimalSep&&(g=g.replace(new RegExp(a.escapeRegExp(f.qMoneyDecimalSep),"g"),d)),f.qMoneyThousandSep&&(g=g.replace(new RegExp(a.escapeRegExp(f.qMoneyThousandSep),"g"),e)),g;case"D":return f.qDateFmt;case"T":return f.qTimeFmt;case"TS":return f.qTimestampFmt;case"IV":return"h:mm:ss";default:return""}},getDefaultNumericFormat:function(a,c){return b("F",2,a.qDec,a.qThou||"",c)},getNDecPattern:b,getNormalizedFormat:function(a,b){var c=a.qDec+a.qThou;return/\u00a0/.test(c)&&!/\u0020/.test(c)?b.replace(/\u0020/g," "):b}}}),define("core.utils/theme",["util","core.utils/notification","general.utils/property-resolver","text!themes/sense/theme.json","require"],function(a,b,c,d,e){"use strict";function f(a){var b=document.createElement("link");return b.setAttribute("rel","stylesheet"),b.setAttribute("href",e.toUrl("themes/"+a+"/theme.css")),document.head.appendChild(b),b}function g(b,d){b=JSON.parse(b),a.extend(!0,p,j,b),d&&o.forEach(function(a){var d=c.getValue(b,a);void 0!==d&&c.setValue(p,a,d)}),n=b}function h(a){var b=f(a);return e(["text!themes/"+a+"/theme.json"],function(a){g(a,!0),p.ThemeChanged.emit()}),b}function i(){m.parentNode.removeChild(m),Object.keys(n).forEach(function(a){delete p[a]})}var j=JSON.parse(d),k="sense",l=null,m=null,n={},o=["palette","colorSchemes.qualitativeScales","colorSchemes.ordinalScales"],p={};return b.create(p,"ThemeChanged"),Object.defineProperty(p,"name",{iterable:!1,get:function(){return l||k}}),p.set=function(a){a.indexOf("/")>-1||a!==l&&(l&&i(),a&&(m=h(a),l=a))},f("sense"),g(d),p}),define("general.utils/string-limits",[],function(){"use strict";var a={};return Object.defineProperties(a,{name:{value:255,writable:!1},description:{value:512,writable:!1},expression:{value:8192,writable:!1},script:{value:5e4,writable:!1},textImage:{value:12e3,writable:!1}}),a}),define("client.property-panel/default-properties",["general.utils/property-resolver","client.property-panel/default-sorting-properties","general.utils/number-formatting","translator","core.utils/theme","general.utils/string-limits","util"],function(a,b,c,d,e,f,g){function h(b){var c=a.getValue(b,"color.auto"),d=a.getValue(b,"color.mode"),e=a.getValue(b,"color.expressionIsColor"),f=a.getValue(b,"qHyperCubeDef.qDimensions.length"),g=a.getValue(b,"qHyperCubeDef.qMeasures.length");return c&&1===f&&1===g||!c&&"primary"===d||!c&&"byExpression"===d&&(e||void 0===e)}function i(b){return a.getValue(b,"color.reverseScheme")!==!0}function j(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!1}function k(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!0}function l(b,d){return a.getValue(b,"qDef.qNumFormat.qFmt")===c.getDefaultNumericFormat(b.qDef.qNumFormat,d?d.localeInfo:"")}function m(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return["R","M","IV"].contains(c)||"U"!==c&&a.getValue(b,"qDef.numFormatFromTemplate",!0)===!1}var n={sorting:b,"dimensions-sorting":b.items.dimensions,"measures-sorting":b.items.measures};return n.general={type:"items",translation:"properties.general",grouped:!0,items:{showTitles:{translation:"properties.showTitles",type:"boolean",ref:"showTitles",component:"switch",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-showTitles"}},titles:{type:"items",show:function(a){return a.showTitles!==!1},items:{title:{translation:"Common.Title",type:"string",expression:"optional",ref:"title",defaultValue:""},subtitle:{translation:"properties.subtitle",type:"string",expression:"optional",ref:"subtitle",defaultValue:""},footnote:{translation:"properties.footnote",type:"string",expression:"optional",ref:"footnote",defaultValue:""}}}}},n.metadata={type:"items",translation:"properties.metadata",schemaIgnore:!0,show:function(a){return"masterobject"===a.qInfo.qType},grouped:!0,items:{name:{translation:"Common.Name",type:"string",ref:"qMetaDef.title",minlength:1,rollbackInvalid:!0,show:function(a){return a.qMetaDef}},description:{translation:"Common.Description",type:"string",component:"textarea",ref:"qMetaDef.description",maxlength:f.description,show:function(a){return a.qMetaDef}},tags:{translation:"Common.Tags",component:"tags",type:"array",ref:"qMetaDef.tags",show:function(a){return a.qMetaDef}}}},n.settings={type:"items",component:"expandable-items",translation:"Common.Appearance",items:{metadata:n.metadata,general:n.general}},n.addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{}},n.dimensions={type:"array",component:"dimensions",translation:"Common.Dimensions",ref:"qHyperCubeDef.qDimensions",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qLibraryId",translation:"Common.Dimension",show:function(a){return a.qLibraryId}},inlineDimension:{component:"inline-dimension",show:function(a){return!a.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},nullSuppression:{type:"boolean",ref:"qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0},dimensionLimits:{type:"items",items:{otherMode:{type:"string",component:"dropdown",ref:"qOtherTotalSpec.qOtherMode",translation:"properties.dimensionLimits.limitation",options:[{value:"OTHER_OFF",translation:"properties.dimensionLimits.none"},{value:"OTHER_COUNTED",translation:"properties.dimensionLimits.fixedNumber"},{value:"OTHER_ABS_LIMITED",translation:"properties.dimensionLimits.exactValue"},{value:"OTHER_REL_LIMITED",translation:"properties.dimensionLimits.relativeValue"}],defaultValue:"OTHER_OFF",readOnly:function(a,b){return 0===b.getMeasures().length},change:function(b){var c,d=a.getValue(b,"qOtherTotalSpec.qOtherMode");"OTHER_REL_LIMITED"===d?(c=a.getValue(b,"qOtherTotalSpec.qOtherLimit.qv","0"),c.length&&"%"!==c[c.length-1]&&g.isNumeric(c)&&(b.qOtherTotalSpec.qOtherLimit||a.setValue(b,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),b.qOtherTotalSpec.qOtherLimit.qv=c+"%")):"OTHER_ABS_LIMITED"===d&&(c=a.getValue(b,"qOtherTotalSpec.qOtherLimit.qv","0"),c.length&&"%"===c[c.length-1]&&(b.qOtherTotalSpec.qOtherLimit||a.setValue(b,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),b.qOtherTotalSpec.qOtherLimit.qv=c.substr(0,c.length-1)))}},otherSortMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherSortMode",options:[{value:"OTHER_SORT_DESCENDING",translation:"Common.Top"},{value:"OTHER_SORT_ASCENDING",translation:"Common.Bottom"}],defaultValue:"OTHER_SORT_DESCENDING",show:function(b,c){return"OTHER_COUNTED"===a.getValue(b,"qOtherTotalSpec.qOtherMode")&&c.getMeasures().length>0}},otherCounted:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherCounted",defaultValue:{qv:"10"},show:function(b,c){return"OTHER_COUNTED"===a.getValue(b,"qOtherTotalSpec.qOtherMode")&&c.getMeasures().length>0}},otherLimitMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherLimitMode",options:[{value:"OTHER_GE_LIMIT",label:">=",tooltipTranslation:"properties.greaterOrEqualTo"},{value:"OTHER_GT_LIMIT",label:">",tooltipTranslation:"properties.greaterThan"},{value:"OTHER_LT_LIMIT",label:"<",tooltipTranslation:"properties.lessThan"},{value:"OTHER_LE_LIMIT",label:"<=",tooltipTranslation:"properties.lessOrEqualTo"}],defaultValue:"OTHER_GE_LIMIT",icon:!0,smallIconFont:!0,show:function(b,c){var d=a.getValue(b,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===d||"OTHER_REL_LIMITED"===d)&&c.getMeasures().length>0}},otherLimit:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherLimit",defaultValue:{qv:"0"},show:function(b,c){var d=a.getValue(b,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===d||"OTHER_REL_LIMITED"===d)&&c.getMeasures().length>0}},calculatedAgainstMessage:{component:"text",label:function(a,b){var c=b.getMeasureLayouts()[0];return c?d.get("Properties.DimensionLimits.CalculatedAgainst",c.qFallbackTitle):d.get("Properties.DimensionLimits.NoMeasure")},show:function(b){var c=a.getValue(b,"qOtherTotalSpec.qOtherMode");return"OTHER_OFF"!==c}}}},others:{type:"items",items:{suppressOther:{type:"boolean",ref:"qOtherTotalSpec.qSuppressOther",translation:"properties.dimensionLimits.showOthers",inverted:!0,defaultValue:!1,show:function(b,c){return"OTHER_OFF"!==a.getValue(b,"qOtherTotalSpec.qOtherMode")&&c.getMeasures().length>0}},othersLabel:{type:"string",expression:"optional",ref:"qDef.othersLabel",translation:"properties.dimensionLimits.othersLabel",defaultValue:function(){return d.get("properties.dimensionLimits.others")},show:function(b,c){return!a.getValue(b,"qOtherTotalSpec.qSuppressOther")&&"OTHER_OFF"!==a.getValue(b,"qOtherTotalSpec.qOtherMode")&&c.getMeasures().length>0}}}}}},n.measures={type:"array",component:"measures",translation:"Common.Measures",ref:"qHyperCubeDef.qMeasures",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.measures.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qLibraryId",translation:"Common.Measure",show:function(a){return a.qLibraryId}},inlineMeasure:{component:"inline-measure",show:function(a){return!a.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},numberFormatting:{type:"items",items:{numberFormattingType:{type:"string",component:"dropdown",ref:"qDef.qNumFormat.qType",translation:"properties.numberFormatting",defaultValue:"U",options:[{value:"U",translation:"Common.Auto"},{value:"F",translation:"properties.numberFormatting.types.number"},{value:"M",translation:"properties.numberFormatting.types.money"},{value:"D",translation:"properties.numberFormatting.types.date"},{value:"IV",translation:"properties.numberFormatting.types.duration"},{value:"R",translation:"Common.Custom"}],change:function(a,b,d,e){c.setNumFmtPattern("qType",a.qDef.qNumFormat,e.localeInfo)}},numberFormattingMode:{type:"boolean",component:"switch",ref:"qDef.numFormatFromTemplate",translation:"properties.numberFormatting.formatting",defaultValue:!0,options:[{value:!0,translation:"properties.numberFormatting.simple"},{value:!1,translation:"Common.Custom"}],show:function(b){return["F","D","TS","T"].contains(a.getValue(b,"qDef.qNumFormat.qType"))}},numberFormattingTemplates:{type:"string",component:"number-formatter-dropdown",ref:"qDef.qNumFormat.qFmt",defaultValue:"#,##0",show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return["F","D","TS","T"].contains(c)&&a.getValue(b,"qDef.numFormatFromTemplate",!0)===!0}},numDecimals:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.nDec",defaultValue:2,min:0,max:14,show:!1},numPrecisionDigits:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.significantFigures",defaultValue:10,min:1,max:14,show:!1},decimalSep:{type:"string",ref:"qDef.qNumFormat.qDec",translation:"properties.numberFormatting.dec",defaultValue:".",show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"R"===c},change:function(a,b,d,e){c.setNumFmtPattern("qDec",a.qDef.qNumFormat,e.localeInfo)},invalid:function(b){return a.getValue(b,"qDef.qNumFormat.qDec")===a.getValue(b,"qDef.qNumFormat.qThou")},readOnly:function(a,b,c,d){return!l(a,d)}},thousandSep:{type:"string",ref:"qDef.qNumFormat.qThou",translation:"properties.numberFormatting.thousandSeparator",defaultValue:"",show:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"R"===c},change:function(a,b,d,e){c.setNumFmtPattern("qThou",a.qDef.qNumFormat,e.localeInfo)},invalid:function(b){var c=a.getValue(b,"qDef.qNumFormat.qType");return"I"===c?!1:a.getValue(b,"qDef.qNumFormat.qDec")===a.getValue(b,"qDef.qNumFormat.qThou")},readOnly:function(a,b,c,d){return!l(a,d)}},format:{type:"string",component:"number-formatter",ref:"qDef.qNumFormat.qFmt",resetTranslation:"properties.numberFormatting.resetPattern",translation:"properties.numberFormatting.formatPattern",defaultValue:"",show:function(a){return m(a)},change:function(a){a.qDef.qNumFormat.qFmt=c.getNormalizedFormat(a.qDef.qNumFormat,a.qDef.qNumFormat.qFmt)},invalid:function(a,b,c){if(["D","T","TS","IV"].contains(a.qDef.qNumFormat.qType))return!1;var d="R"===a.qDef.qNumFormat.qType?a.qDef.qNumFormat.qDec:c.localeInfo["q"+("M"===a.qDef.qNumFormat.qType?"Money":"")+"DecimalSep"],e=new RegExp("(0|#)"+g.escapeRegExp(d)+"0*#*"),f=(a.qDef.qNumFormat.qFmt||"").split(";"),h=f[0].match(e),i=h&&h[0]?h[0].length-2:0,j=f[1]?f[1].match(e):null,k=j&&j[0]?j[0].length-2:0;return i>15||k>15}}}}}},n.measureAxis={type:"items",label:d.get("properties.yAxis"),grouped:!0,items:{axis:{type:"items",items:{show:{type:"string",component:"dropdown",ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},dock:{type:"string",component:"dropdown",ref:"measureAxis.dock",translation:"Common.Position",defaultValue:"near",options:function(a){var b,c;return"horizontal"===a.orientation?(b="Common.Bottom",c="Common.Top"):(b="properties.dock.left",c="properties.dock.right"),[{value:"near",translation:b},{value:"far",translation:c}]},show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show}},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}],show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxis.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},minMax:{type:"string",component:"dropdown",ref:"measureAxis.minMax",options:[{translation:"properties.axis.min",value:"min"},{translation:"Common.Max",value:"max"},{translation:"properties.axis.minMax",value:"minMax"}],defaultValue:"min",show:function(a){return a.measureAxis&&!a.measureAxis.autoMinMax}},min:{ref:"measureAxis.min",translation:"properties.axis.min",expression:"optional",type:"number",show:function(a){return a.measureAxis&&["min","minMax"].contains(a.measureAxis.minMax)&&!a.measureAxis.autoMinMax},invalid:function(a){return a.measureAxis&&"minMax"===a.measureAxis.minMax?a.measureAxis.min>=a.measureAxis.max:!1}},max:{ref:"measureAxis.max",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(a){return a.measureAxis&&["max","minMax"].contains(a.measureAxis.minMax)&&!a.measureAxis.autoMinMax},invalid:function(a){return a.measureAxis&&"minMax"===a.measureAxis.minMax?a.measureAxis.min>=a.measureAxis.max:!1}}}}}},n.reflines={type:"array",ref:"refLine.refLines",translation:"properties.referenceLines",itemTitleRef:"label",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.referenceLines.add",items:{show:{ref:"show",translation:"Common.Show",type:"boolean",defaultValue:!0},label:{ref:"label",translation:"Common.Label",type:"string"},color:{ref:"color",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:2},expressionValue:{ref:"refLineExpr.value",translation:"properties.referenceLines.expression",type:"number",expression:"optional",expressionType:"ValueExpression",defaultValue:0,change:function(a){var b=a.refLineExpr;"object"==typeof b.value?b.label={qStringExpression:{qExpr:b.value.qValueExpression.qExpr}}:b.label=""+b.value}},expressionLabel:{ref:"refLineExpr.label",translation:"properties.referenceLines.expression",type:"string",expression:"optional",expressionType:"StringExpression",defaultValue:"0",show:!1}}},n.dataHandling={type:"items",translation:"properties.dataHandling",grouped:!0,items:{suppressZero:{ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",type:"boolean",inverted:!0},calcCond:{type:"items",items:{expr:{ref:"qHyperCubeDef.qCalcCond",type:"string",component:"expression",expressionType:"ValueExpr",translation:"properties.hyperCube.calcCond"},customErrorMessage:{ref:"qHyperCubeDef.customErrorMessage.calcCond",component:"textarea",defaultValue:"",type:"string",placeholderTranslation:"Object.ErrorMessage.CalculationCondition",translation:"properties.hyperCube.calcCondMessage",show:function(b){var c=a.getValue(b,"qHyperCubeDef.qCalcCond");return c.qv&&""!==c.qv}}}}}},n.colorsAndLegend={type:"items",translation:"properties.colorsAndLegend",grouped:!0,items:{colors:{type:"items",items:{autoColor:{ref:"color.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},colorMode:{ref:"color.mode",type:"string",component:"dropdown",options:function(a,b){var c=[{value:"primary",translation:"properties.colorMode.primary"}];return b.getMeasures().length>1?c.push({value:"byDimension",translation:"properties.colorMode.multicolored"}):c.push({value:"byDimension",translation:"properties.colorMode.byDimension"}),1===b.getMeasures().length&&c.push({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),b.getMeasures().length>=1&&c.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),c},defaultValue:"primary",show:function(b){return!a.getValue(b,"color.auto")}},singleColor:{ref:"color.singleColor",translation:"properties.color",type:"integer",component:"color-picker",defaultValue:3,show:function(b){return!a.getValue(b,"color.auto")&&"primary"===a.getValue(b,"color.mode")}},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",defaultValue:!1,show:function(b,c){return!a.getValue(b,"color.auto")&&"byDimension"===a.getValue(b,"color.mode")&&c.getMeasures().length<=1},readOnly:function(b){return a.getValue(b,"qHyperCubeDef.qDimensions.length")>1}},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:!0,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:function(b){var c=a.getValue(b,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.type="colorByExpression",d&&(d.colorExpression=c.qExpression))},globalChange:function(b){var c,d,e,f=a.getValue(b,"qHyperCubeDef.qMeasures",[]),g=a.getValue(b,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),h=null,i=function(a,b){"colorByExpression"===a.type&&(d=b)};if(f.length+g.length>1){for(c=g.length-1;c>=0;--c)e=g[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);for(c=f.length-1;c>=0;--c)e=f[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);!f[0].qAttributeExpressions&&h&&(f[0].qAttributeExpressions=[]),h&&f[0].qAttributeExpressions.splice(0,0,h)}var j=a.getValue(b,"color.colorExpression");1!==f.length||f[0].qAttributeExpressions&&0!==f[0].qAttributeExpressions.length||!j||(f[0].qAttributeExpressions=[{qExpression:j,type:"colorByExpression"}])},translation:"Common.Expression",show:function(b,c){return!a.getValue(b,"color.auto")&&"byExpression"===a.getValue(b,"color.mode")&&c.getMeasures().length>0}},expressionIsColor:{ref:"color.expressionIsColor",translation:"properties.expressionIsColor",type:"boolean",defaultValue:!0,show:function(b,c){return!a.getValue(b,"color.auto")&&"byExpression"===a.getValue(b,"color.mode")&&c.getMeasures().length>0}},expressionLabel:{type:"string",ref:"color.expressionLabel",translation:"Common.Label",change:function(b){var c=a.getValue(b,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.label=a.getValue(b,"color.expressionLabel"),d&&(d.colorExpression=c.qExpression))},show:function(b,c){return!a.getValue(b,"color.auto")&&j(b)&&c.getMeasures().length>0}},colorSchemeMeasure:{ref:"color.measureScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:"sg",items:[{colors:e.colorSchemes.ordinalScales[0].scale,type:"gradient",reverse:i,component:"color-scale",translation:e.colorSchemes.ordinalScales[0].translation||e.colorSchemes.ordinalScales[0].name,value:"sg"},{colors:e.colorSchemes.ordinalScales[1].scale[e.colorSchemes.ordinalScales[1].scale.length-1],type:"classes",reverse:i,component:"color-scale",translation:e.colorSchemes.ordinalScales[1].translation||e.colorSchemes.ordinalScales[1].name,value:"sc"},{colors:e.colorSchemes.ordinalScales[2].scale,type:"gradient",reverse:i,component:"color-scale",translation:e.colorSchemes.ordinalScales[2].translation||e.colorSchemes.ordinalScales[2].name,value:"dg"},{colors:e.colorSchemes.ordinalScales[3].scale[e.colorSchemes.ordinalScales[3].scale.length-1],type:"classes",reverse:i,component:"color-scale",translation:e.colorSchemes.ordinalScales[3].translation||e.colorSchemes.ordinalScales[3].name,value:"dc"}],show:function(b){return!a.getValue(b,"color.auto")&&("byMeasure"===a.getValue(b,"color.mode")||j(b))}},reverseScheme:{ref:"color.reverseScheme",translation:"properties.reverseColorScheme",type:"boolean",defaultValue:!1,show:function(b){return!a.getValue(b,"color.auto")&&("byMeasure"===a.getValue(b,"color.mode")||j(b))}},colorSchemeDimension:{ref:"color.dimensionScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:"12",items:[{colors:e.colorSchemes.qualitativeScales[0].scale[e.colorSchemes.qualitativeScales[0].scale.length-1],type:"classes",component:"color-scale",translation:e.colorSchemes.qualitativeScales[0].translation||e.colorSchemes.qualitativeScales[0].name,value:"12"},{colors:e.colorSchemes.qualitativeScales[1].scale,type:"classes",component:"color-scale",translation:e.colorSchemes.qualitativeScales[1].translation||e.colorSchemes.qualitativeScales[1].name,value:"100"}],show:function(b){return!a.getValue(b,"color.auto")&&"byDimension"===a.getValue(b,"color.mode")}},customRange:{type:"items",items:{autoMinMax:{ref:"color.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(b){return"byMeasure"===a.getValue(b,"color.mode")||j(b)}},min:{ref:"color.measureMin",translation:"properties.axis.min",expression:"optional",type:"number",show:function(b){return("byMeasure"===a.getValue(b,"color.mode")||j(b))&&a.getValue(b,"color.autoMinMax")===!1},invalid:function(b){return"minMax"===a.getValue(b,"color.minMax")?a.getValue(b,"color.measureMin")>=a.getValue(b,"color.measureMax"):!1}},max:{ref:"color.measureMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(b){return("byMeasure"===a.getValue(b,"color.mode")||j(b))&&a.getValue(b,"color.autoMinMax")===!1},invalid:function(b){return"minMax"===a.getValue(b,"color.minMax")?a.getValue(b,"color.measureMin")>=a.getValue(b,"color.measureMax"):!1}}},show:function(b){return!a.getValue(b,"color.auto")}}}},legend:{type:"items",items:{show:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(a){return!h(a)}},dock:{type:"string",component:"dropdown",ref:"legend.dock",translation:"properties.legend.position",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"bottom",translation:"Common.Bottom"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"Common.Top"}],defaultValue:"auto",show:function(b){return a.getValue(b,"legend.show")&&!h(b)}},showTitle:{ref:"legend.showTitle",translation:"properties.legend.showTitle",type:"boolean",defaultValue:!0,show:function(b){return a.getValue(b,"legend.show")&&!h(b)&&!k(b)}}}}}},n.data={type:"items",component:"hypercube-data",translation:"Common.Data",addTranslation:"Properties.AddData",allowAdd:!0,items:{dimensions:n.dimensions,measures:n.measures}},n}),define("general.utils/property-mapper",["client.property-panel/default-properties","general.utils/property-resolver","util"],function(a,b,c){function d(a,c,e){var f,g,h,i=null;if(a.ref===c)return a;if(b.isHierarchical(a))for(f=Object.keys(a.items),h=0;h<f.length;++h){if(g=a.items[f[h]],g.ref===c){i=g;break}if(e&&(i=d(g,c,e),null!==i))break}return i}function e(d,f){var g,h,i;if(d||(d=j),f&&k[f])return k[f];if(d.uses){if(i=a[d.uses],!i)throw"No defaults found for: "+d.uses;d=c.extend(!0,{},i,d)}return b.isHierarchical(d)?(h={},Object.keys(d.items).forEach(function(a){d.items[a]&&(h[a]=e(d.items[a]))}),g=c.extend({},d,{items:h})):"array"===d.type&&d.items?(h={},Object.keys(d.items).forEach(function(a){d.items[a]&&(h[a]=e(d.items[a]))}),g=c.extend({},d,{items:h})):g=c.extend({},d),f&&!k[f]&&(k[f]=g),g}function f(a,d,f){var g=e(a,f);return d?c.extend(!0,b.getDefaults(g),d):b.getDefaults(g)}function g(a){function c(a){function d(a){return-1!==a.search(/\.\d/g)}function e(a){var c={type:a.type,defaultValue:b.getDefaultValue(a.type,a)};return a.maxlength&&(c.maxlength=a.maxlength),a.min&&(c.min=a.min),a.max&&(c.max=a.max),a.expression&&(c.expression=a.expression),a.options&&"boolean"!==a.type&&(c["enum"]=a.options.map(function(a){return a.value})),c}function f(a){var h,i,j,k,l,m;if(b.isHierarchical(a))for(h=Object.keys(a.items),l=0;l<h.length;l++)i=h[l],j=a.items[i],f(j);else a.ref&&"array"===a.type&&a.items?(k=c({type:"items",items:a.items}),m={type:"array",items:k},d(a.ref)||b.setValue(g,a.ref,m)):a.ref&&(m=e(a),d(a.ref)||b.setValue(g,a.ref,m))}var g={};return f(a),g}return c(a)}function h(a){function c(a){var e,f,g;if(b.isHierarchical(a))for(e=Object.keys(a.items),g=0;g<e.length;++g)f=a.items[e[g]],f.snapshot&&d.push(f),c(f)}var d=[];return c(a),d}function i(a,b){function c(a){a.globalChange&&d.push(a.globalChange),"items"!==a.type&&"array"!==a.type||!a.items||Object.keys(a.items).forEach(function(b){a.items[b]&&c(a.items[b])})}if(b&&l[b])return l[b];
var d=[];return c(a),b&&!l[b]&&(l[b]=d),d}var j,k={},l={};return j={type:"items",component:"accordion",items:{settings:{uses:"settings"}}},{findDefinition:d,findSnapshotProperties:h,findGlobalListeners:i,mapDefinition:e,mapProperties:f,getPropertyHierarchy:g}}),define("objects.backend-api/generic-api",["./backend-api"],function(a){"use strict";function b(a,b){if(b){if(a[b]){if(a[b].qHyperCube)return b+".qHyperCube";if(a[b].qListObject)return b+".qListObject"}return-1!==b.indexOf("Def",b.length-3)?b.slice(0,b.length-3):b}return a.qHyperCube?"qHyperCube":"qListObject"}var c;return c=a.extend("GenericApi",{init:function(a,c){var d=b(a.layout,c);this._super(a,"/"+d+"Def"),this.isHyperCube=-1!==this.dataPath.indexOf("qHyperCube"),this.cacheCube.setMethodName(this.isHyperCube?"GetHyperCubeData":"GetListObjectData")},getBackendApi:function(a){return new c(this.model,a)},getProperties:function(){return this.model.getProperties()},setProperties:function(a){return this.model.setProperties(a)},applyPatches:function(a,b){return this.model.applyPatches(a,b)},clearSoftPatches:function(){return this.model.clearSoftPatches()},save:function(){return this.model.save()},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},updateCache:function(a){a&&a[this.dataPath]?(this.cacheCube.set(a[this.dataPath].qDataPages),this.cacheCube.setCubeSize(a[this.dataPath].qSize)):this.cacheCube.clear()},getData:function(a){var b=this.cacheCube.getData(a),c=this;return b.then(function(a){c.model.layout[c.dataPath].qDataPages.push(a[0])}),b},getDataRow:function(a){var b=this.model.layout[this.dataPath];if(b)for(var c=b.qDataPages.length,d=0;c>d;d++){var e=b.qDataPages[d];if(a>=e.qArea.qTop&&a<e.qArea.qTop+e.qArea.qHeight)return e.qMatrix[a-e.qArea.qTop]}return null},selectValues:function(a,b,c){return this.isHyperCube?this.model.rpc("SelectHyperCubeValues",null,[this.path,a,b,c]):this.model.rpc("SelectListObjectValues",null,[this.path,b,c])},select:function(a,b,c){return this.selectValues(b,a,c)},getReducedData:function(a,b,c){return this.isHyperCube?this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c||"D1"]):null},selectRange:function(a,b,c){return b=!!b,c=c||[],this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,a,c,b])},search:function(a){return this.isHyperCube?null:this.model.rpc("SearchListObjectFor",null,[this.path,a])},abortSearch:function(){return this.isHyperCube?null:this.model.rpc("AbortListObjectSearch",null,[this.path])},acceptSearch:function(a){return this.isHyperCube?null:this.model.rpc("AcceptListObjectSearch",null,[this.path,a])},getPivotData:function(a){return this.isHyperCube?this.model.rpc("GetHyperCubePivotData","qDataPages",[this.path,a]):null},getStackData:function(a,b){return this.isHyperCube?this.model.rpc("GetHyperCubeStackData","qDataPages",[this.path,a,b||1e3]):null},expandTop:function(a,b,c){return this.model.rpc("ExpandTop",null,[this.path,a,b,c||!1])},expandLeft:function(a,b,c){return this.model.rpc("ExpandLeft",null,[this.path,a,b,c||!1])},collapseTop:function(a,b,c){return this.model.rpc("CollapseTop",null,[this.path,a,b,c])},collapseLeft:function(a,b,c){return this.model.rpc("CollapseLeft",null,[this.path,a,b,c])}})}),define("objects.utils/data-properties/data-property-handler",["core.utils/class","util"],function(a,b){"use strict";var c,d;return d="Not supported in this object, need to implement in subclass.",c=a.extend({init:function(a,b,c,d){this.dimensionDefinition=a||{max:0},this.measureDefinition=b||{max:0},a&&(this.dimensionProperties=c||{}),b&&(this.measureProperties=d||{})},setProperties:function(a){this.properties=a},setLayout:function(a){this.layout=a},type:function(){throw"Must override this method"},getDimensions:function(){return[]},getDimension:function(a){var b=this.getDimensions(),c=0;for(c;c<b.length;++c)if(b[c].qDef.cId===a)return b[c];return null},minDimensions:function(){return"function"==typeof this.dimensionDefinition.min?this.dimensionDefinition.min.call(null,this.properties,this):this.dimensionDefinition.min||0},maxDimensions:function(){return"function"==typeof this.dimensionDefinition.max?this.dimensionDefinition.max.call(null,this.getMeasures().length):isNaN(this.dimensionDefinition.max)?1e4:this.dimensionDefinition.max},canAddDimension:function(){return this.getDimensions().length<this.maxDimensions()},minMeasures:function(){return"function"==typeof this.measureDefinition.min?this.measureDefinition.min.call(null,this.properties,this):this.measureDefinition.min||0},maxMeasures:function(){return"function"==typeof this.measureDefinition.max?this.measureDefinition.max.call(null,this.getDimensions().length):isNaN(this.measureDefinition.max)?1e4:this.measureDefinition.max},canAddMeasure:function(){return this.getMeasures().length<this.maxMeasures()},getMeasures:function(){return[]},getMeasure:function(a){var b=this.getMeasures(),c=0;for(c;c<b.length;++c)if(b[c].qDef.cId===a)return b[c];return null},addDimension:function(){throw d},getSorting:function(){throw d},addFieldDimension:function(a,b,c){var d=this.createFieldDimension(a,b,c);return this.addDimension(d)},addLibraryDimension:function(a,b){var c=this.createLibraryDimension(a,b);return this.addDimension(c)},addMeasure:function(){throw d},addExpressionMeasure:function(a,b,c){var d=this.createExpressionMeasure(a,b,c);return this.addMeasure(d)},addLibraryMeasure:function(a,b){var c=this.createLibraryMeasure(a,b);return this.addMeasure(c)},replaceDimension:function(){throw d},replaceMeasure:function(){throw d},autoSortDimension:function(){throw d},autoSortMeasure:function(){throw d},createFieldDimension:function(a,c,d){var e=b.extend(!0,{},this.dimensionProperties||{},d||{});return e.qDef||(e.qDef={}),e.qOtherTotalSpec||(e.qOtherTotalSpec={}),a?(e.qDef.qFieldDefs=[a],c?e.qDef.qFieldLabels=[c]:e.qDef.qFieldLabels=[""],e.qDef.qSortCriterias=[{qSortByLoadOrder:1}]):(e.qDef.qFieldDefs=[],e.qDef.qFieldLabels=[],e.qDef.qSortCriterias=[]),e.qDef.autoSort=!0,e},createLibraryDimension:function(a,c){var d=b.extend(!0,{},this.dimensionProperties||{},c||{});return d.qDef||(d.qDef={}),d.qOtherTotalSpec||(d.qOtherTotalSpec={}),d.qLibraryId=a,d.qDef.qSortCriterias=[{qSortByLoadOrder:1}],d.qDef.autoSort=!0,delete d.qDef.qFieldDefs,delete d.qDef.qFieldLabels,d},createExpressionMeasure:function(a,c,d){var e=b.extend(!0,{},this.measureProperties||{},d||{});return e.qDef||(e.qDef={}),e.qDef.qNumFormat||(e.qDef.qNumFormat={}),e.qDef.qDef=a,e.qDef.qLabel=c,e.qDef.autoSort=!0,e},createLibraryMeasure:function(a,c){var d=b.extend(!0,{},this.measureProperties||{},c||{});return d.qDef||(d.qDef={}),d.qDef.qNumFormat||(d.qDef.qNumFormat={}),d.qLibraryId=a,d.qDef.autoSort=!0,delete d.qDef.qDef,delete d.qDef.qLabel,d},getDimensionLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qDimensionInfo:[]},getDimensionLayout:function(a){return this.getDimensionLayouts().filter(function(b){return a===b.cId})[0]},getMeasureLayouts:function(){return this.layout&&this.layout.qHyperCube?this.layout.qHyperCube.qMeasureInfo:[]},getMeasureLayout:function(a){return this.getMeasureLayouts().filter(function(b){return a===b.cId})[0]},removeDimension:function(){throw d},removeMeasure:function(){throw d},moveDimension:function(){throw d},moveMeasure:function(){throw d},changeSorting:function(){throw d}})}),define("general.utils/array-util",[],function(){function a(a){return a&&"[object Array]"===Object.prototype.toString.call(a)}function b(a){return a&&"function"==typeof a}function c(c,d){var e,f;if(!a(c))throw"No valid items were specified.";if(!b(d))throw"No valid action function was specified.";if(Array.prototype.forEach)c.forEach(d);else for(e in c)f=c[e],d(f)}function d(b,c){if(!a(b))throw"No valid items were specified.";if(Array.prototype.indexOf)return-1!==b.indexOf(c);for(var d=b.length;d--;)if(b[d]===c)return!0;return!1}function e(a,b){if(!(a&&b&&a.length&&b.length))return!1;var c,d=b.length;for(c=0;d>c;c++)if(a.indexOf(b[c])>-1)return!0;return!1}function f(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);a.splice(c,0,a.splice(b,1)[0])}function g(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function h(a,b){var c;for(c=0;c<a.length;++c)a[c]>=0&&a[c]>=b&&++a[c];a.push(b)}function i(a,b){var c,d=0;for(c=0;c<a.length;++c)a[c]>b?--a[c]:a[c]===b&&(d=c);a.splice(d,1)}function j(a,b){return a.length>b?a.slice(0,b):a}function k(a){if(!(a instanceof Array))throw new Error("Argument is not an Array.");return a.slice(0)}return{forEach:c,contains:d,move:f,swap:g,limit:j,indexAdded:h,indexRemoved:i,intersects:e,copy:k}}),define("core.models/base-object",["core.models/rpc-base","core.models/app","core.utils/deferred","core.utils/permissions","util"],function(a,b,c,d,e){"use strict";function f(c,e){var f,g,h=c.name+"List",i=Object.keys(e).filter(function(a){return a.indexOf("ListDef")>-1?a:void 0})[0].replace(/Def$/g,"");if(!i)throw new Error("BaseObject: Tried to create a model without a ListDef in properties");g=a.extend(h,{strippedLayout:{},getLayout:function(){var a=this;return this._super().then(function(b){return a.strippedLayout=b[i].qItems,a.strippedLayout.forEach(function(a){"object"==typeof a&&d.mapToLayout(a)}),a.strippedLayout})}}),e.qInfo={qId:h,qType:h},c.getList=function(a){return a=a||b.current,f?f:f=a.createSessionObject(e).then(function(b){return new g({id:h,handle:b.qHandle,session:a.session})})},c.getListLayout=function(a){return this.getList(a).then(function(a){return a.getLayout()})}}var g;return g=a.extend("BaseObject",{getInfo:function(){return this.rpc("GetInfo","qInfo")},clone:function(a,c){var d=this;return c=c||b.current,c.rpc(a||"CloneObject","qCloneId",[d.id]).then(function(a){return d.constructor.get(a)})}}),g.get=function(a,c){function d(){return c.rpc("GetObject","qReturn",[a])}return c=c||b.current,this.getModel(a,c.session,d)},g.create=function(a,d,f){var g=this;return a.qInfo=a.qInfo||{},a.qInfo.qId=a.qInfo.qId||e.generateId(),a.qInfo.qType=a.qInfo.qType||this.name.toLowerCase(),d=d||"CreateObject",f=f||b.current,f.rpc(d,null,[a]).then(function(b){return g.getModel(b.qInfo&&b.qInfo.qId||a.qInfo.qId,f.session,function(){return c.resolve(b.qReturn)})})},g.remove=function(a,c,d,e){var f=[a];return e&&f.push(e),d=d||b.current,c=c||"DestroyObject",d.rpc(c,"qReturn",f)},g.States=a.States,g.extend=function(b,c,d){var e=a.extend.call(this,b,c);return e.extend=g.extend,e.get=g.get,e.create=g.create,e.remove=g.remove,e.States=g.States,d&&d.listProperties&&f(e,d.listProperties),e},g}),define("general.models/field",["core.models/base-object","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("Field",{clear:function(){return this.rpc("Clear","qReturn")},lock:function(){return this.rpc("Lock","qReturn")},unlock:function(){return this.rpc("Unlock","qReturn")},clearOther:function(a){return this.rpc("ClearAllButThis","qReturn",[a||!1])},selectPossible:function(a){return this.rpc("SelectPossible","qReturn",[a||!1])},selectExcluded:function(a){return this.rpc("SelectExcluded","qReturn",[a||!1])},selectAll:function(a){return this.rpc("SelectAll","qReturn",[a||!1])},selectAlternative:function(a){return this.rpc("SelectAlternative",null,[a||!1])},selectMatch:function(a,b){return this.rpc("Select","qReturn",[a||"",b||!1])},toggleSelect:function(a,b){return this.rpc("ToggleSelect","qReturn",[a||"",b||!1])},select:function(a,b,c){return this.rpc("LowLevelSelect","qReturn",[a,b||!1,c||!1])},selectValues:function(a,b,c){return this.rpc("SelectValues","qReturn",[a,b||!1,c||!1])}},{listProperties:{qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0}}}),c.get=function(a,c,d){function e(){return d.rpc("GetField","qReturn",[a,c])}c=c||"$";var f="FIELD_"+a+"_"+c;return d=d||b.current,this.getModel(f,d.session,e)},c}),define("general.models/library/dimension",["core.models/base-object","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("Dimension",{clone:function(){return this._super("CloneDimension")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qDimensionListDef:{qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}}}),c.get=function(a,c){function d(){return c.rpc("GetDimension","qReturn",[a])}return c=c||b.current,this.getModel(a,c.session,d)},c.create=function(b,d){return a.create.call(c,b,"CreateDimension",d)},c.remove=function(b,c){return a.remove(b,"DestroyDimension",c)},c}),define("general.models/library/measure",["core.models/base-object","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("Measure",{clone:function(){return this._super("CloneMeasure")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])}},{listProperties:{qMeasureListDef:{qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}}}),c.get=function(a,c){function d(){return c.rpc("GetMeasure","qReturn",[a])}return c=c||b.current,this.getModel(a,c.session,d)},c.create=function(b,d){return a.create.call(c,b,"CreateMeasure",d)},c.remove=function(b,c){return a.remove(b,"DestroyMeasure",c)},c}),define("objects.utils/data-properties/listobject-util",["util"],function(a){"use strict";return{autoSortDimension:function(a,b){return a.qDef.qSortCriterias=[],a.qDef.autoSort=!0,b?b.forEach(function(b,c){a.qDef.qSortCriterias[c]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1}}):a.qDef.qSortCriterias[0]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1},a},createFieldDimension:function(a){return{qDef:{qFieldDefs:[a],qFieldLabels:[a],qSortCriterias:[]}}},createLibraryDimension:function(a){return{qLibraryId:a,qDef:{qSortCriterias:[]}}},createDefaultListBox:function(b,c){var d,e=a.extend(!0,{},b);for(e.qShowAlternatives=!0,d=0;d<e.qDef.qSortCriterias.length;++d)e.qDef.qSortCriterias[d].qSortByState=1;return c=c||(b.qDef.qFieldLabels&&b.qDef.qFieldLabels.length?b.qDef.qFieldLabels[0]:""),{qInfo:{qType:"listbox"},qListObjectDef:e,title:c,visualization:"listbox"}}}}),define("client.assets/tab-contents/fields/assets-directdiscovery-service",[],function(){"use strict";function a(a){return!!a.qTags&&-1!==a.qTags.indexOf("$dd_measure")}function b(a){return!!a.qTags&&-1!==a.qTags.indexOf("$dd_details")}function c(a){return!!a.qTags&&-1!==a.qTags.indexOf("$dd_dimension")}function d(a){return!!a.qTags&&-1!==a.qTags.indexOf("$directdiscovery")}function e(c){var d=c;return c&&(d=c.filter(function(c){return!a(c)&&!b(c)})),d}function f(d){var e="",f={qTags:d};return a(f)?e="DirectDiscovery.Measure":b(f)?e="DirectDiscovery.Details":c(f)&&(e="DirectDiscovery.Dimension"),e}return{isMeasure:a,isDetails:b,isDimension:c,removeMeasureAndDetailsFields:e,getTypeTranslationKey:f,isDirectDiscoveryField:d}}),define("client.assets/tab-contents/fields/assets-field-list-model",["objects.utils/data-properties/listobject-util","client.assets/tab-contents/fields/assets-directdiscovery-service"],function(a,b){"use strict";function c(b){var c;return c=a.createFieldDimension(b.qName),a.autoSortDimension(c,[b]),{id:"newObject",args:{template:"filterpane",children:[a.createDefaultListBox(c,b.qName)],init:{}}}}function d(a){for(var b=[],c=0;c<a.length;++c){var d=a[c];if(b.push(d),d.qDerivedFieldData)for(var e=0;e<d.qDerivedFieldData.qDerivedFieldLists.length;++e)for(var f=d.qDerivedFieldData.qDerivedFieldLists[e],g=0;g<f.qFieldDefs.length;++g){var h=f.qFieldDefs[g];b.push({qName:h.qName,qSrcTables:d.qSrcTables,qTags:h.qTags,isDerived:!0,sourceField:d.qName,derivedDefinitionName:f.qDerivedDefinitionName})}}return b}var e={create:function(a){return a.map(function(a){return{id:a.qName,name:a.qName,type:"field",srcTables:a.qSrcTables,sourceField:a.sourceField,calendarTemplateName:a.derivedDefinitionName,getDropOption:c.bind(null,a),tags:a.qTags,icon:b.isDirectDiscoveryField(a)?"directdiscovery":"",iconTooltip:b.getTypeTranslationKey(a.qTags),derivedCalendars:a.qDerivedFieldData?a.qDerivedFieldData.qDerivedFieldLists.map(function(a){return a.qDerivedDefinitionName}):[]}})},expand:d,createFromArray:function(a,b){var d,e=[];for(d=0;d<a.length;d++)b&&(a[d].qName=a[d][b]),e.push({name:a[d].qName,type:"field",getDropOption:c.bind(null,a[d])});return e},getTables:function(a){var b,c,d,e=a;for(d=[],b=0;b<e.length;++b)for(c=0;c<e[b].qSrcTables.length;++c)-1===d.indexOf(e[b].qSrcTables[c])&&d.push(e[b].qSrcTables[c]);return d}};return e}),define("objects.utils/data-properties/library-utils",["general.utils/array-util","general.models/field","general.models/library/dimension","general.models/library/measure","client.assets/tab-contents/fields/assets-field-list-model"],function(a,b,c,d,e){"use strict";function f(a){return b.getListLayout().then(function(b){b=e.expand(b);var c,d;if(b)for(c=0;c<b.length;c++)if(d=b[c],d.qName===a)return d;return null})}function g(a){return d.getListLayout().then(function(b){var c,d;if(b)for(c=0;c<b.length;c++)if(d=b[c],d.qInfo.qId===a)return d;return null})}function h(a){return c.getListLayout().then(function(b){var c,d;if(b)for(c=0;c<b.length;c++)if(d=b[c],d.qInfo.qId===a)return d;return null})}function i(){return b.getListLayout().then(function(a){return e.expand(a).sort(function(a,b){return a.qName.toLowerCase().localeCompare(b.qName.toLowerCase())})})}function j(){return c.getListLayout().then(function(b){return a.copy(b).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}function k(){return d.getListLayout().then(function(b){return a.copy(b).sort(function(a,b){return a.qData.title.toLowerCase().localeCompare(b.qData.title.toLowerCase())})})}return{findField:f,findLibraryDimension:h,findLibraryMeasure:g,getSortedFields:i,getSortedDimensions:j,getSortedMeasures:k}}),define("objects.utils/data-properties/hypercube-handler",["./data-property-handler","core.utils/deferred","objects.utils/data-properties/library-utils","general.utils/array-util","util"],function(a,b,c,d,e){"use strict";var f,g=1e3,h=1e3;return f=a.extend({init:function(a,b,c,d){this._super(a,b,c,d)},setProperties:function(a){a.qHyperCubeDef&&(this._super(a),this.hcProperties=a.qHyperCubeDef,this.hcProperties.qDimensions||(this.hcProperties.qDimensions=[]),this.hcProperties.qMeasures||(this.hcProperties.qMeasures=[]),this.hcProperties.qInterColumnSortOrder||(this.hcProperties.qInterColumnSortOrder=[]),this.hcProperties.qLayoutExclude||(this.hcProperties.qLayoutExclude={}),this.hcProperties.qLayoutExclude.qHyperCubeDef||(this.hcProperties.qLayoutExclude.qHyperCubeDef={}),this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions=[]),this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures=[]),this.hcProperties.qDimensions.forEach(function(a){void 0!==a.autoSort&&(a.qDef.autoSort=a.autoSort,delete a.autoSort)}),this.hcProperties.qMeasures.forEach(function(a){void 0!==a.autoSort&&(a.qDef.autoSort=a.autoSort,delete a.autoSort)}))},getDimensions:function(){return this.hcProperties?this.hcProperties.qDimensions:[]},getMeasures:function(){return this.hcProperties?this.hcProperties.qMeasures:[]},getSorting:function(){return this.hcProperties.qInterColumnSortOrder},addDimension:function(a){var c=this.getDimensions(),f=this;return a.qDef.cId||(a.qDef.cId=e.generateId()),c.length<this.maxDimensions()?(c.push(a),this.autoSortDimension(a).then(function(){return d.indexAdded(f.hcProperties.qInterColumnSortOrder,c.length-1),"function"==typeof f.dimensionDefinition.add?b.when(f.dimensionDefinition.add.call(f,a,f.properties,f)).then(function(){return a}):a})):c.length<g?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.push(a),b.resolve(a)):void 0},addMeasure:function(a){var c=this.getMeasures(),f=this;return a.qDef.cId||(a.qDef.cId=e.generateId()),delete a.qDef.qNumFormat,c.length<this.maxMeasures()?(c.push(a),this.autoSortMeasure(a).then(function(){return d.indexAdded(f.hcProperties.qInterColumnSortOrder,f.getDimensions().length+c.length-1),"function"==typeof f.measureDefinition.add?b.when(f.measureDefinition.add.call(null,a,f.properties,f)).then(function(){return a}):a})):c.length<h?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(a),b.resolve(a)):void 0},replaceDimension:function(a,b){var c=this.getDimensions(),d=c[a],f=this;return this.autoSortDimension(b).then(function(){return b.qDef.cId=e.generateId(),c[a]=b,"function"==typeof f.dimensionDefinition.replace&&f.dimensionDefinition.replace.call(null,b,d,a,f.properties,f),b})},replaceMeasure:function(a,b){var c=this.getMeasures(),d=c[a],f=this;return this.autoSortMeasure(b).then(function(){return b.qDef.cId=e.generateId(),c[a]=b,"function"==typeof f.measureDefinition.replace&&f.measureDefinition.replace.call(null,b,d,a,f.properties,f),b})},autoSortDimension:function(a){function b(b){b.forEach(function(b,c){var e=b.qTags,f={qSortByLoadOrder:1};"function"==typeof d.dimensionDefinition.autoSort?d.dimensionDefinition.autoSort(a,d.properties,e,f,d):e&&(e.contains("$numeric")?f.qSortByNumeric=1:(e.contains("$text")||e.contains("$ascii"))&&(f.qSortByAscii=1)),a.qDef.qSortCriterias[c]=f})}var d=this;return a.qLibraryId?c.findLibraryDimension(a.qLibraryId).then(function(c){return c&&b(c.qData.info),a}):c.findField(a.qDef.qFieldDefs[0]).then(function(c){return c&&b([c]),a})},autoSortMeasure:function(a){return a.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.resolve(a)},removeDimension:function(a){var c,e=this.getDimensions();if(a<e.length){if(c=this.hcProperties.qDimensions.splice(a,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length?e.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(0,1)[0]):d.indexRemoved(this.hcProperties.qInterColumnSortOrder,a),"function"==typeof this.dimensionDefinition.remove)return b.when(this.dimensionDefinition.remove.call(null,c,this.properties,this,a))}else c=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(a-e.length,1);return b.resolve(c)},removeMeasure:function(a){var c,e=this.getMeasures();if(a<e.length){if(c=this.hcProperties.qMeasures.splice(a,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length?e.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(0,1)[0]):d.indexRemoved(this.hcProperties.qInterColumnSortOrder,this.getDimensions().length+a),"function"==typeof this.measureDefinition.remove)return b.when(this.measureDefinition.remove.call(null,c,this.properties,this,a))}else c=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(a-e.length,1)[0];return b.resolve(c)},moveDimension:function(a,c){var e,f,g,h=this.getDimensions(),i=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;return a<h.length&&c<h.length?d.move(h,a,c):a<h.length&&c>=h.length?(f=c-h.length,g=i.splice(0,1)[0],h.push(g),g=h.splice(a,1)[0],i.splice(f,0,g)):a>=h.length&&c<h.length?(e=a-h.length,g=h.splice(h.length-1,1)[0],i.splice(0,0,g),g=i.splice(e+1,1)[0],h.splice(c,0,g)):(e=a-h.length,f=c-h.length,d.move(i,e,f)),b.resolve(g)},moveMeasure:function(a,c){var e,f,g,h=this.getMeasures(),i=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;return a<h.length&&c<h.length?d.move(h,a,c):a<h.length&&c>=h.length?(f=c-h.length,g=i.splice(0,1)[0],h.push(g),g=h.splice(a,1)[0],i.splice(f,0,g)):a>=h.length&&c<h.length?(e=a-h.length,g=h.splice(h.length-1,1)[0],i.splice(0,0,g),g=i.splice(e+1,1)[0],h.splice(c,0,g)):(e=a-h.length,f=c-h.length,d.move(i,e,f)),b.resolve(g)},changeSorting:function(a,b){d.move(this.hcProperties.qInterColumnSortOrder,a,b)},setSorting:function(a){a&&a.length===this.hcProperties.qInterColumnSortOrder.length&&(this.hcProperties.qInterColumnSortOrder=a)}})}),define("objects.utils/data-properties/listobject-handler",["core.utils/deferred","./data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util"],function(a,b,c,d,e){"use strict";var f=b.extend({init:function(a,b){this._super(a,null,b,null)},minDimensions:function(){return 1},maxDimensions:function(){return 1},minMeasures:function(){return 0},maxMeasures:function(){return 0},autoSortDimension:function(a){return c.autoSortDimension(a)},getDimensions:function(){var a=this.properties.qListObjectDef.qDef;return a&&a.qFieldDefs&&a.qFieldDefs.length||this.properties.qListObjectDef.qLibraryId?[this.properties.qListObjectDef]:[]},addDimension:function(a){function b(){f.properties.qListObjectDef=e.extend(!0,f.properties.qListObjectDef,a),"function"==typeof f.dimensionDefinition.add&&f.dimensionDefinition.add.call(null,a,f.properties,f)}var f=this;return a.qLibraryId?d.findLibraryDimension(a.qLibraryId).then(function(d){return d&&c.autoSortDimension(a,d.qData.info),b(),a}):d.findField(a.qDef.qFieldDefs[0]).then(function(d){return d&&c.autoSortDimension(a,[d]),b(),a})},replaceDimension:function(b,d){var f=this,g=e.extend(!0,this.properties.qListObjectDef,d);return c.autoSortDimension(d),d.qLibraryId?(delete g.qDef.qFieldDefs,delete g.qDef.qFieldLabels):delete g.qLibraryId,f.properties.qListObjectDef=g,a.resolve(d)},removeDimension:function(){},getDimensionLayouts:function(){return[this.getDimensionLayout()]},getDimensionLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qDimensionInfo?this.layout.qListObject.qDimensionInfo:""},getMeasures:function(){return this.properties.qListObjectDef.qExpressions},getMeasureLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qExpressions&&this.layout.qListObject.qExpressions[0]?this.layout.qListObject.qExpressions[0].qExpr:""}});return f}),define("text!objects.extension/default-template.ng.html",[],function(){return'<div qv-extension style="height: 100%; position: relative;"></div>\r\n'}),define("client.models/bookmark",["jquery","core.models/base-object","core.models/app"],function(a,b,c){"use strict";var d;return d=b.extend("Bookmark",{clone:function(){return this._super("CloneBookmark")},apply:function(){return d.apply(this.id,this.app)}},{listProperties:{qBookmarkListDef:{qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",sheetId:"/sheetId",selectionFields:"/selectionFields",creationDate:"/creationDate"}}}}),d.get=function(a,b){function d(){return b.rpc("GetBookmark","qReturn",[a])}return b=b||c.current,this.getModel(a,b.session,d)},d.apply=function(a,b){b=b||c.current;var d=b.rpc("ApplyBookmark","qSuccess",[a]);return d},d.create=function(c,d){var e={version:.96,qMetaDef:{title:"",description:""},sheetId:c.sheetId||null,selectionFields:c.selectionFields,creationDate:(new Date).toISOString()};return b.create.call(this,a.extend(!0,{},e,c),"CreateBookmark",d)},d.remove=function(a,c){return b.remove(a,"DestroyBookmark",c)},d.extend=function(a,c,e){var f=b.extend.call(this,a,c,e);return f.extend=d.extend,f.create=d.create,f.remove=d.remove,f.get=d.get,f},d}),define("client.models/snapshot",["client.models/bookmark","core.utils/deferred"],function(a,b){"use strict";var c,d=500;return c=a.extend("Snapshot",{applyEmbeddedSnapshot:function(){return this.rpc("Apply")}},{listProperties:{qBookmarkListDef:{qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}}}),c.getLibraryContent=function(a,c){var d,e=new b;return this.getList().then(function(b){b.getLayout().then(function(b){d=b.filter(function(b){var c=!0;return a&&(c=a===b.qData.sourceObjectId),!b.qData.isClone&&c}),e.resolve(d)}),b.Invalidated&&b.Invalidated.unbind(),b.Invalidated.bind(c)}),e.promise},c.unbindList=function(){this.getList().then(function(a){a.Invalidated.unbind()})},c.getSnapshotCount=function(a){var c,d=new b,e=0;return this.getListLayout().then(function(b){for(c=0;c<b.length;c++)b[c].qData.isClone||b[c].qData.sourceObjectId!==a||e++;d.resolve(e)}),d.promise},c.create=function(e,f){var g,h,i=new b,j=0;return this.getListLayout().then(function(b){for(g=0;g<b.length;g++)b[g].qData.isClone||j++;h=d>j,h?a.create.call(c,e,f).then(function(){i.resolve(h)}):i.resolve(h)}),i.promise},c.getEmbedded=function(a,b){function c(){return b.rpc("GetSnapshotObject","qReturn",[])}return this.getModel(a,b.session,c)},{Snapshot:c}}),define("core.models/generic-object",["core.models/base-object","core.utils/deferred","util"],function(a,b,c){"use strict";var d;return d=a.extend("GenericObject",{createChild:function(a,e,f){var g=this.session,h=[a];return f=f||d,e&&h.push(e),a.qInfo.qId=a.qInfo.qId||c.generateId(),this.rpc("CreateChild",null,h).then(function(a){return f.getModel(a.qInfo.qId,g,function(){return b.resolve(a.qReturn)})})},removeChild:function(a,b){return d.remove(a,"DestroyChild",this,b)},setChildArrayOrder:function(a){var b=[a];return this.rpc("SetChildArrayOrder",null,b)},removeAllChildren:function(a){var b=[];return a&&b.push(a),this.rpc("DestroyAllChildren",null,b)},copyFrom:function(a){return this.rpc("CopyFrom",null,[a])},applyPatches:function(a,b){return this.rpc("ApplyPatches",null,[a,b])},clearSoftPatches:function(){return this.rpc("ClearSoftPatches")},getLinkedObjects:function(){return this.rpc("GetLinkedObjects","qItems",[])},exportData:function(a,b,c){a=a||"OOXML",b=b||"",c=c||"";var d=[a,b,c];return this.rpc("ExportData",null,d,{raw:!0})},cancelRequest:function(a){var b=this,c=b.session.getRequest(a);return b.session.rpc({method:"CancelRequest",handle:-1,params:[a]}).then(function(){c&&"GetLayout"===c.method&&b.setState(d.States.CANCELLED)})}})}),define("core.models/session-object",["core.models/generic-object","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("SessionObject",{remove:function(){return c.remove(this.id,b.current)}}),c.get=function(a,c){function d(){return c.createSessionObject(a)}var e=a.qInfo.qId||a.qInfo.qType;if(!e)throw new Error("no id");return a.qInfo.qId=e,c=c||b.current,this.getModel(e,c.session,d)},c.remove=function(b,c){return a.remove(b,"DestroySessionObject",c)},c.extend=function(){var b=a.extend.apply(this,arguments);return b.get=c.get,b.remove=c.remove,b},c}),define("client.models/undo-info",["core.models/session-object","core.utils/deferred","core.models/app"],function(a,b,c){"use strict";var d;return d=a.extend("UndoInfo",{getLayout:function(){return this._super().then(function(a){return a.qUndoInfo})},undo:function(){return this.layout.qUndoInfo.qUndoCount>0?c.current.rpc("Undo"):b.resolve()},redo:function(){return this.layout.qUndoInfo.qRedoCount>0?c.current.rpc("Redo"):b.resolve()},reset:function(){return this.getLayout().then(function(a){return a.qUndoCount||a.qRedoCount?c.current.rpc("ClearUndoBuffer"):b.resolve()})}}),d.get=function(b){return b=b||c.current,a.get.call(this,{qInfo:{qType:"UndoInfo"},qUndoInfoDef:{}},b).then(function(a){return a.app=b,a})},d}),define("objects.snapshot/snapshot-helper",["jquery","util","qvangular","client.models/snapshot","core.utils/deferred","client.utils/state","client.models/undo-info"],function(a,b,c,d,e,f,g){function h(){var a=c.getService("$delayedModal"),d=b.extend(!0,{},{},{title:"Storytelling.Snapshot.MaxLimitReached.Title",html:'<p class="dm-p" q-translation="Storytelling.Snapshot.MaxLimitReached.Text"></p>'});a.open(d)}function i(a){var b=!o||o!==a;return b&&(o=a,setTimeout(function(){o=null},n)),b}function j(b,c,d,e){var f=c.layout,g=f.qInfo.qId;if(i(g)){var h=a(d.target).parents(".qv-object");k(f,c,!0,e).then(function(a){l(b,c,h,a)})}}function k(c,d,g,h){var i=new e,j=new Date,k=g?b.extend(!0,{},c):c;return m(d,k).then(function(){k.snapshotData={object:{size:d.objectSize}},d.setSnapshotData(k,h||{}).then(function(){if(g){delete k.qInfo,k.visualizationType=c.qInfo.qType,k.sourceObjectId=c.qInfo.qId,k.sheetId=f.model.id,k.timestamp=j.getTime(),k.isClone=!1,k.qMetaDef={title:c.title
};var e=a(".qv-panel-sheet");k.snapshotData.parent={h:e.height(),w:e.width()}}else k.snapshotData.object.origDataPages=d.model.layout.snapshotData.object.origDataPages,k.snapshotData.content&&(k.snapshotData.content.chartData=b.extend(!0,{},d.model.layout.snapshotData.content.chartData));i.resolve(k)})}),i.promise}function l(a,b,c,e){var f=b.ext.snapshot;d.Snapshot.create(e).then(function(b){b?(f.animate(c),a&&f.updateCount(a)):h(),g.get().then(function(a){a.reset()})})}function m(a,c){function d(){g.forEach(function(a,c){b.extend(!0,a,h[c])})}function f(a,b,c,d){for(var e in c)c.hasOwnProperty(e)&&"qHyperCube"!==e&&"qHyperCubeDef"!==e&&(e===b?(d&&(delete c[e],c.qStaticContentUrlDef={}),a.push(c.qStaticContentUrlDef)):"object"==typeof c[e]&&f(a,b,c[e],d))}var g=[],h=[],i=new e;return a.model.getProperties().then(function(a){f(g,"qStaticContentUrl",c,!0),f(h,"qStaticContentUrlDef",a),d(),i.resolve(c)}),i.promise}var n=1e3,o=null;return{createSnapshot:j,prepSnapshotData:k,prepareStaticContent:m}}),define("objects.extension/export-format",[],function(){"use strict";function a(a){a=void 0!==a?a:1,this.data=[];for(var b=0;a>b;++b)this.data.push({dimensions:[],measures:[]});this.properties={}}return a}),define("objects.extension/object-conversion",["util","objects.extension/export-format","general.utils/array-util","general.utils/property-resolver","translator"],function(a,b,c,d,e){function f(a,b,c){b.hasOwnProperty(a)&&(c[a]=b[a])}function g(a,b,c,d){b.hasOwnProperty(a)?c[a]=b[a]:c[a]=d}function h(a,b,c){"masterobject"===b.properties.qInfo.qType?a.qInfo.qType="masterobject":a.qInfo.qType=c.qInfo.qType,a.visualization=c.visualization,a.version=c.version}function i(a,b,c){var e=c.qProperty,f=c.qProperty.qLayoutExclude;return/boolean|number|string/.test(typeof b)?(f&&(f.changed||(f.changed={}),f.changed[a]={from:d.getValue(e,a),to:b}),void d.setValue(e,a,b)):void d.setValue(e,a,b)}function j(a){for(var b in a.qLayoutExclude.changed)a.qLayoutExclude.changed[b].to===d.getValue(a,b)&&d.setValue(a,b,a.qLayoutExclude.changed[b].from)}function k(a,b,c){var e,f,g=b.properties,h=b.properties.qLayoutExclude,i=d.getValue(g,a);if(!/boolean|number|string/.test(typeof i))try{if(e=JSON.stringify(i),f=e.match(/:\{/g),f=f?f.length:0,f>2)return;i=JSON.parse(e)}catch(j){return}h||(b.properties.qLayoutExclude={quarantine:{}},h=b.properties.qLayoutExclude),h.quarantine||(h.quarantine={}),h.quarantine[c]||(h.quarantine[c]={}),h.quarantine[c][a]=i}function l(a,b){var c,e=a.qLayoutExclude?a.qLayoutExclude.quarantine:{};if(!e[b])return!1;e=e[b];for(c in e)d.setValue(a,c,e[c]);return delete a.qLayoutExclude.quarantine[b],!0}var m,n,o,p,q,r,s=Math.pow(2,53)-1;return m={exportProperties:function(c){var d,e,f,g=new b,h=c.qProperty,i=h.qHyperCubeDef,k=g.data[0];for(d=0;d<i.qDimensions.length;++d)k.dimensions.push(i.qDimensions[d]);if(i.qLayoutExclude&&i.qLayoutExclude.qHyperCubeDef&&i.qLayoutExclude.qHyperCubeDef.qDimensions)for(d=0;d<i.qLayoutExclude.qHyperCubeDef.qDimensions.length;++d)k.dimensions.push(i.qLayoutExclude.qHyperCubeDef.qDimensions[d]);for(d=0;d<i.qMeasures.length;++d)k.measures.push(i.qMeasures[d]);if(i.qLayoutExclude&&i.qLayoutExclude.qHyperCubeDef&&i.qLayoutExclude.qHyperCubeDef.qMeasures)for(d=0;d<i.qLayoutExclude.qHyperCubeDef.qMeasures.length;++d)k.measures.push(i.qLayoutExclude.qHyperCubeDef.qMeasures[d]);delete i.qLayoutExclude;for(e in h)g.properties[e]=h[e];if(h.qLayoutExclude||(h.qLayoutExclude={}),h.qLayoutExclude.disabled){for(e in h.qLayoutExclude.disabled)f=e,g.properties.hasOwnProperty(f)||(g.properties[f]=h.qLayoutExclude.disabled[e]);delete h.qLayoutExclude.disabled}return h.qLayoutExclude.changed&&(j(h),delete h.qLayoutExclude.changed),(!h.qLayoutExclude.quarantine||a.isEmpty(h.qLayoutExclude.quarantine))&&delete h.qLayoutExclude,g},importProperties:function(b,d,i){var j,k,l,m={qChildren:[]},n={},o=b.data[0],p=i.data&&i.data.measures;p||(p=i.definition&&i.definition.items&&i.definition.items.measures||{max:0});var q="function"==typeof p.max?p.max(o.dimensions.length):isNaN(p.max)?s:p.max,r=i.data&&i.data.dimensions;r||(r=i.definition&&i.definition.items&&i.definition.items.dimensions||{max:0});var t="function"==typeof r.max?r.max(q):isNaN(r.max)?s:r.max;n.qLayoutExclude||(n.qLayoutExclude={}),n.qLayoutExclude.disabled={},n.qLayoutExclude.quarantine={};for(j in b.properties)"qLayoutExclude"===j?b.properties[j].quarantine&&(n.qLayoutExclude.quarantine=a.extend(!0,{},b.properties[j].quarantine)):d.hasOwnProperty(j)||"qMetaDef"===j?n[j]=b.properties[j]:n.qLayoutExclude.disabled[j]=b.properties[j];for(n=a.extend(!0,{},d,n),n.qHyperCubeDef.qDimensions.length=0,n.qHyperCubeDef.qMeasures.length=0,(o.dimensions.length>t||o.measures.length>q)&&(n.qHyperCubeDef.qLayoutExclude||(n.qHyperCubeDef.qLayoutExclude={}),n.qHyperCubeDef.qLayoutExclude.qHyperCubeDef||(n.qHyperCubeDef.qLayoutExclude.qHyperCubeDef={}),o.dimensions.length>t&&(n.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions||(n.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions=[])),o.measures.length>q&&(n.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures||(n.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]))),k=0;k<o.dimensions.length;++k)o.dimensions[k].qDef.hasOwnProperty("othersLabel")||(o.dimensions[k].qDef.othersLabel=e.get("properties.dimensionLimits.others"));for(k=0;k<o.dimensions.length;++k)n.qHyperCubeDef.qDimensions.length<t?n.qHyperCubeDef.qDimensions.push(o.dimensions[k]):n.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(o.dimensions[k]);for(k=0;k<o.measures.length;++k)n.qHyperCubeDef.qMeasures.length<q?n.qHyperCubeDef.qMeasures.push(o.measures[k]):n.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(o.measures[k]);for(l=n.qHyperCubeDef.qDimensions.length+n.qHyperCubeDef.qMeasures.length,n.qHyperCubeDef.qInterColumnSortOrder||(n.qHyperCubeDef.qInterColumnSortOrder=[]),k=n.qHyperCubeDef.qInterColumnSortOrder.length;k!==l;)l>k?(c.indexAdded(n.qHyperCubeDef.qInterColumnSortOrder,k),++k):(--k,c.indexRemoved(n.qHyperCubeDef.qInterColumnSortOrder,k));return f("qAlwaysFullyExpanded",d.qHyperCubeDef,n.qHyperCubeDef),f("qMaxStackedCells",d.qHyperCubeDef,n.qHyperCubeDef),f("qSuppressZero",d.qHyperCubeDef,n.qHyperCubeDef),f("qSuppressMissing",d.qHyperCubeDef,n.qHyperCubeDef),f("qNoOfLeftDims",d.qHyperCubeDef,n.qHyperCubeDef),g("qInitialDataFetch",d.qHyperCubeDef,n.qHyperCubeDef,[{qTop:0,qLeft:0,qWidth:0,qHeight:0}]),g("qMode",d.qHyperCubeDef,n.qHyperCubeDef,"S"),g("qReductionMode",d.qHyperCubeDef,n.qHyperCubeDef,"N"),h(n,b,d),m.qProperty=n,m}},n={exportProperties:function(a){var c,d,e,f=new b,g=a.qProperty,h=g.qListObjectDef,i=f.data[0];if(i.dimensions.push({qLibraryId:h.qLibraryId,qDef:h.qDef,title:h.title}),h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef&&h.qLayoutExclude.qHyperCubeDef.qDimensions)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qDimensions.length;++c)i.dimensions.push(h.qLayoutExclude.qHyperCubeDef.qDimensions[c]);if(h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef&&h.qLayoutExclude.qHyperCubeDef.qMeasures)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qMeasures.length;++c)i.measures.push(h.qLayoutExclude.qHyperCubeDef.qMeasures[c]);delete h.qLayoutExclude;for(d in g)f.properties[d]=g[d];if(g.qLayoutExclude&&g.qLayoutExclude._disabled){for(d in g.qLayoutExclude._disabled)e="_"===d.substr(0,1)?d.substring(1):d,f.properties.hasOwnProperty(e)||(f.properties[e]=g.qLayoutExclude.disabled[d]);delete g.qLayoutExclude.disabled}for(c=0;c<i.dimensions[0].qDef.qSortCriterias.length;++c)i.dimensions[0].qDef.qSortCriterias[c].qSortByFrequency=0;return f},importProperties:function(b,c){var d,e,f={qChildren:[]},g={},i=b.data[0],j=1;g.qLayoutExclude||(g.qLayoutExclude={}),g.qLayoutExclude.disabled={};for(d in b.properties)"qLayoutExclude"===d?b.properties[d].quarantine&&(g.qLayoutExclude.quarantine=a.extend(!0,{},b.properties[d].quarantine)):c.hasOwnProperty(d)||"qMetaDef"===d?g[d]=b.properties[d]:g.qLayoutExclude.disabled[d]=b.properties[d];for(g=a.extend(!0,{},c,g),g.qListObjectDef.qLayoutExclude||(g.qListObjectDef.qLayoutExclude={}),g.qListObjectDef.qLayoutExclude.qHyperCubeDef||(g.qListObjectDef.qLayoutExclude.qHyperCubeDef={}),g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions||(g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions=[]),g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures||(g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]),e=0;e<i.dimensions.length;++e)j>e?(g.qListObjectDef.qDef=i.dimensions[e].qDef,g.qListObjectDef.qLibraryId=i.dimensions[e].qLibraryId):g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(i.dimensions[e]);for(e=0;e<i.measures.length;++e)g.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(i.measures[e]);return g.qListObjectDef.qInitialDataFetch=c.qListObjectDef.qInitialDataFetch,h(g,b,c),f.qProperty=g,f}},o={importProperties:function(a,b,c){var e=this.hypercube.importProperties(a,b,c),f=d.getValue(e,"qProperty.visualization"),g=d.getValue(e,"qProperty.qHyperCubeDef.qDimensions",[]),h=d.getValue(e,"qProperty.qHyperCubeDef.qMeasures",[]).length,j=d.getValue(e,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]),k=d.getValue(e,"qProperty.color.colorExpression",""),l=d.getValue(e,"qProperty.color.mode",""),m=d.getValue(e,"qProperty.color.persistent",!1);return h&&(j.splice(0,0,{qExpression:k,type:"colorByExpression"}),d.setValue(e,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",j)),("scatterplot"===f||h>1)&&"byMeasure"===l&&d.setValue(e,"qProperty.color.mode","primary"),g.length>1&&!m&&i("color.persistent",!0,e),g.forEach(function(a){"qTotalMode"in a.qOtherTotalSpec&&delete a.qOtherTotalSpec.qTotalMode,"qGlobalOtherGrouping"in a.qOtherTotalSpec&&delete a.qOtherTotalSpec.qGlobalOtherGrouping}),e},exportProperties:function(a){var b=this.hypercube.exportProperties(a),c=-1,e=d.getValue(b,"properties.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]);return e.every(function(a,b){"colorByExpression"===a.type&&(c=b)}),c>=0&&e.splice(c,1),b}},p={importProperties:function(b,c,d){var e,f,g=this.colorChart.importProperties.apply(this,[b,c,d]),h=g.qProperty;if(c.measureAxis&&"undefined"==typeof c.measureAxis.autoMinMax?l(h,"unsupportedAutoMinMax")||a.extend(h.measureAxis,c.measureAxis):l(h,"supportedAutoMinMax")||a.extend(h.measureAxis,c.measureAxis),b.properties.measureAxes&&!c.measureAxes&&c.measureAxis&&"undefined"!=typeof c.measureAxis.autoMinMax){var i=[];if(h.qHyperCubeDef.qMeasures.length>0&&h.qHyperCubeDef.qMeasures.forEach(function(a){a.qDef.series&&(i[a.qDef.series.axis]||(i[a.qDef.series.axis]={axis:a.qDef.series.axis,type:{line:0,marker:0,bar:0,total:0}}),["bar","marker","line"].contains(a.qDef.series.type)&&i[a.qDef.series.axis].type[a.qDef.series.type]++,i[a.qDef.series.axis].type.total++)}),i.length){var j="barchart"===c.visualization?"bar":"linechart"===c.visualization?"line":"";j&&(e=i.filter(function(a){return a.type[j]>0}).sort(function(a,b){return b.type[j]-a.type[j]})),e&&e.length||(e=i.sort(function(a,b){return b.type.total-a.type.total})),e&&e[0]&&a.extend(h.measureAxis,b.properties.measureAxes[e[0].axis])}else a.extend(h.measureAxis,b.properties.measureAxes[0])}return h.qHyperCubeDef.qDimensions.length>1&&(f=h.qHyperCubeDef.qInterColumnSortOrder.indexOf(0),0!==f&&(e=h.qHyperCubeDef.qInterColumnSortOrder[0],h.qHyperCubeDef.qInterColumnSortOrder[0]=0,h.qHyperCubeDef.qInterColumnSortOrder[f]=e)),g},exportProperties:function(a){var b=this.colorChart.exportProperties.apply(this,[a]);return"gauge"===b.properties.visualization?(k("measureAxis.min",b,"unsupportedAutoMinMax"),k("measureAxis.max",b,"unsupportedAutoMinMax")):(k("measureAxis.min",b,"supportedAutoMinMax"),k("measureAxis.max",b,"supportedAutoMinMax")),b}},q={importProperties:function(a,b,c){var e,f,g=this.hypercube.importProperties(a,b,c),h=d.getValue(g,"qProperty.qHyperCubeDef.qDimensions",[]),i=h.length,j=d.getValue(g,"qProperty.qHyperCubeDef.qMeasures",[]).length,k=d.getValue(g,"qProperty.qHyperCubeDef.qInterColumnSortOrder",[]),m=!0;i+j===k.length&&d.setValue(g,"qProperty.qLayoutExclude.quarantine.interColSortOrder",k);var n=d.getValue(g,"qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder");if(n&&(k=n,f=n.slice(),d.setValue(g,"qProperty.qHyperCubeDef.qInterColumnSortOrder",k),delete g.qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder),i>k.length)for(e=k.length;i>e;e++)k.indexOf(e)<0&&k.push(e);for(e=k.length-1;e>=0;e--)k[e]>=i&&k.splice(e,1);if(j>1&&k.indexOf(-1)<0?k.push(-1):2>j&&k.indexOf(-1)>-1&&k.splice(k.indexOf(-1),1),i>0&&-1===d.getValue(g,"qProperty.qHyperCubeDef.qNoOfLeftDims",-1)&&d.setValue(g,"qProperty.qHyperCubeDef.qNoOfLeftDims",i),f&&k&&f.length===k.length){for(e=0;e<f.length;e++)if(f[e]!==k[e]){m=!1;break}m&&l(g.qProperty,"noOfLeftDims")}return h.forEach(function(a){"qTotalMode"in a.qOtherTotalSpec||(a.qOtherTotalSpec.qTotalMode="TOTAL_EXPR")}),g},exportProperties:function(a){var b=this.hypercube.exportProperties(a),c=b.properties.qHyperCubeDef,e=c.qDimensions.length,f=c.qMeasures.length,g=c.qInterColumnSortOrder;d.setValue(b,"properties.qLayoutExclude.quarantine.pivotInterColSortOrder",g.slice(0)),k("qHyperCubeDef.qNoOfLeftDims",b,"noOfLeftDims");var h=d.getValue(b,"properties.qLayoutExclude.quarantine.interColSortOrder");h&&(g=h,d.setValue(b,"properties.qHyperCubeDef.qInterColumnSortOrder",g),delete b.properties.qLayoutExclude.quarantine.interColSortOrder);var i=g.indexOf(-1);i>-1&&g.splice(i,1);for(var j=g.length;e+f>j;j++)g.length<=j&&g.push(j);return b}},r={importProperties:function(b,c){var d,e={qChildren:[]},f={};f.qLayoutExclude||(f.qLayoutExclude={}),f.qLayoutExclude.disabled={};for(d in b.properties)"qLayoutExclude"!==d&&(c.hasOwnProperty(d)||"qMetaDef"===d?f[d]=b.properties[d]:f.qLayoutExclude.disabled[d]=b.properties[d]);return f=a.extend(!0,{},c,f),h(f,b,c),e.qProperty=f,e},exportProperties:function(a){var c,d,e=new b,f=a.qProperty;for(c in f)e.properties[c]=f[c];if(f.qLayoutExclude||(f.qLayoutExclude={}),f.qLayoutExclude.disabled)for(c in f.qLayoutExclude.disabled)d=c,e.properties.hasOwnProperty(d)||(e.properties[d]=f.qLayoutExclude.disabled[c]);return delete f.qLayoutExclude,e}},{importCommonProperties:h,hypercube:m,listbox:n,axisChart:p,colorChart:o,pivotChart:q,other:r,changeProperty:i}}),define("objects.extension/default-extension",["jquery","qvangular","core.utils/deferred","objects.backend-api/generic-api","general.utils/property-mapper","objects.utils/data-properties/hypercube-handler","objects.utils/data-properties/listobject-handler","text!./default-template.ng.html","client.models/snapshot","objects.snapshot/snapshot-helper","general.utils/visualizations","objects.utils/data-properties/library-utils","objects.extension/object-conversion"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){if(a.qHyperCube)return a.qHyperCube.qDimensionInfo||[];if(a.qChildList){var b=a.qChildList.qItems||[];return b.map(function(){return{}})}var c=!a.qListObject||!a.qListObject.qDimensionInfo||a.qListObject.qDimensionInfo.qError;return c?[]:[a.qListObject.qDimensionInfo]}function o(a){return a.qHyperCube?a.qHyperCube.qMeasureInfo||[]:[]}function p(a){var b,d,e,f,g=c(),h=[],i=[];for(b=0;b<a.data.length;++b){for(d=0;d<a.data[b].dimensions.length;++d)e=a.data[b].dimensions[d],e.qLibraryId&&(h.push(l.findLibraryDimension(e.qLibraryId)),i.push(e));for(d=0;d<a.data[b].measures.length;++d)f=a.data[b].measures[d],f.qLibraryId&&(h.push(l.findLibraryDimension(f.qLibraryId)),i.push(f))}return c.all(h).then(function(a){for(b=0;b<a.length;++b)a[b]&&(i[b].title=a[b].qData.title);g.resolve()}),g.promise}return{BackendApi:d,template:h,mapProperties:function(){this.mappedDefinition=e.mapDefinition(this.definition,this.type,this.globalChangeListeners),this.globalChangeListeners=e.findGlobalListeners(this.mappedDefinition);var a=this.data&&this.data.dimensions;a?(a.min="undefined"!=typeof a.min?a.min:1,a.max="undefined"!=typeof a.max?a.max:1e3):this.data||(a=e.findDefinition(this.mappedDefinition,"qHyperCubeDef.qDimensions",!0),a||(a=e.findDefinition(this.mappedDefinition,"qListObjectDef",!0)),a&&(a.obsolete=!0)),this.dimensionDefinition=a;var b=this.data&&this.data.measures;b?(b.min="undefined"!=typeof b.min?b.min:1,b.max="undefined"!=typeof b.max?b.max:1):this.data||(b=e.findDefinition(this.mappedDefinition,"qHyperCubeDef.qMeasures",!0),b&&(b.obsolete=!0)),this.measureDefinition=b},getCreatePropertyHandler:function(){var a,b,c=this.mappedDefinition;return this.model.layout.qListObject?(a=e.mapProperties(this.dimensionDefinition),new g(this.dimensionDefinition,a)):(this.dimensionDefinition&&this.dimensionDefinition.obsolete?a=e.mapProperties(this.dimensionDefinition):this.dimensionDefinition&&(a=e.mapProperties(c.items.data.items.dimensions)),this.measureDefinition&&this.measureDefinition.obsolete?b=e.mapProperties(this.measureDefinition):this.measureDefinition&&(b=e.mapProperties(c.items.data.items.measures)),new f(this.dimensionDefinition,this.measureDefinition,a,b))},hasError:function(a){var b=a.layout;return b.qHyperCube?!!b.qHyperCube.qError:b.qListObject?!!b.qListObject.qError:!1},showRequirements:function(a){var b,c=a.ext.dimensionDefinition?a.ext.dimensionDefinition.min:0,d=a.ext.measureDefinition?a.ext.measureDefinition.min:0,e=n(a.layout),f=o(a.layout);if(c>0&&e.length<c)return!0;for(b=0;b<e.length;++b)if(e[b].qError)return!0;if(d>0&&f.length<d)return!0;for(b=0;b<f.length;++b)if(f[b].qError)return!0;return!1},addFieldDimension:function(a,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.addFieldDimension(a.value,"").then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},addLibraryDimension:function(a,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.addLibraryDimension(a.libraryId).then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},addLibraryMeasure:function(a,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.addLibraryMeasure(a.libraryId).then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},addExpressionMeasure:function(a,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.addExpressionMeasure(a.value,"").then(function(a){b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)})})},getDropFieldOptions:function(a,b,c,d,e){a.Add(c,b,e),a.ReplaceDimensions(c,b,e),a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,c,d,e,f){c.getDimensions().length<c.minDimensions()?c.addLibraryDimension(a.item.id).then(function(a){d.save(),b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)}):(a.Add(d,c,f),a.ReplaceDimensions(d,c,f),e())},getDropMeasureOptions:function(a,c,d,e,f){c.getMeasures().length<c.minMeasures()?"expression"===a.item.type?c.addExpressionMeasure(a.item.name,"").then(function(a){d.save(),b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)}):c.addLibraryMeasure(a.item.id).then(function(a){d.save(),b.$rootScope.$broadcast("pp-open-path","data."+a.qDef.cId)}):(a.Add(d,c,f),a.ReplaceMeasures(d,c,f),e())},getDropTemplateOptions:function(a,b,c,d,e){var f=this,g=k.getType(a.item.template),h=["contextMenu.convertTo",a.item.name];f.type!==g.type?g.getExtensionType().then(function(b){!e.isReadonly&&f.exportProperties&&b.importProperties&&a.menu.addItem({translation:h,tid:"convert",select:function(){f._convert(g,b,a.item)}}),d()},function(){d()}):d()},getDropOptions:function(a,b,c){var d,e,f,g=a.model,h=this;return e={field:"getDropFieldOptions",dimension:"getDropDimensionOptions",measure:"getDropMeasureOptions",template:"getDropTemplateOptions",expression:"getDropMeasureOptions"},d=b.item.type,(f=e[d])?g.getProperties().then(function(d){var e=h.getCreatePropertyHandler();return e.setProperties(d),h[f](b,e,g,c,a)}):void c()},_convert:function(a,b,d){var e,f,g=this;c.all({initialProperties:a.getInitialProperties(d.init),propertyTree:g.model.getFullPropertyTree()}).then(function(a){try{e=g.exportProperties(a.propertyTree),p(e).then(function(){f=b.importProperties(e,a.initialProperties,b),g.model.propertyTree=f,g.model.saveTree()})}catch(c){}})},exportProperties:function(a){return a.qProperty.qHyperCubeDef?m.hypercube.exportProperties(a):a.qProperty.qListObjectDef?m.listbox.exportProperties(a):m.other.exportProperties(a)},importProperties:function(a,b,c){return b.qHyperCubeDef?m.hypercube.importProperties(a,b,c):b.qListObjectDef?m.listbox.importProperties(a,b,c):m.other.importProperties(a,b,c)},snapshot:{canTakeSnapshot:!1,animate:function(b){b.append(a('<div class="qv-snapshot-tool-flash" />').bind("oanimationend animationend webkitAnimationEnd",function(){a(this).remove()}))},take:function(a,b,c,d){j.createSnapshot(a,b,c,d)},updateCount:function(a){return i.Snapshot.getSnapshotCount(a.options.id).then(function(b){return a.snapshotCount=b,b})}},options:{},controller:function(){}}}),define("objects.models/visualization-object",["core.models/app","core.models/generic-object"],function(a,b){"use strict";var c;return c=b.extend("VisualizationObject",{init:function(){this._super.apply(this,Array.prototype.slice.apply(arguments))}}),c.create=function(c,d,e){return d=d||a.current,d.createChild?d.createChild(c,e,this):b.create.call(this,c)},c.createTransient=function(b,c){c=c||a.current;var d=this;return c.createSessionObject(b).then(function(a){return new d({id:null,handle:a.qHandle,session:c.session})})},c.remove=function(a,c,d){var e=null;c&&c.removeChild&&(e="DestroyChild"),b.remove.call(this,a,e,c,d)},c.extend=function(){var a=b.extend.apply(this,arguments);return a.extend=c.extend,a.create=c.create,a.createTransient=c.createTransient,a.remove=c.remove,a},c}),define("objects.views/selections/cache-item",[],function(){"use strict";function a(a,b,c,d,e,f,g){if(a instanceof Array&&!a[0].pointInside&&!a.pointInside)throw"The shape must implement a `pointInside` function";this.setShape(a),this.selected=!!b,this.value=c,this.parent=d,this.index=e,this.objectShapes={},f&&(this.parent=f.parent,this.node=f,this.rowIndex=f.data.rowIndex,this.label=f.data.qText,this.id=f.data.qElemNo),g&&a&&(this.objectShapes[g]=a instanceof Array?a:[a])}return a.prototype={getShapes:function(a){return(a||0===a)&&this.objectShapes&&this.objectShapes[a]?this.objectShapes[a]:this.shapes?this.shapes:[this.shape]},addShape:function(a,b){this.objectShapes[a]instanceof Array||(this.objectShapes[a]=[]),this.objectShapes[a].push(b),this.shapes.push(b)},setShape:function(a){this.shape=a instanceof Array?a[0]:a,a?this.shapes=a instanceof Array?a:[a]:this.shapes=[]},addValue:function(a){void 0===this.value&&(this.value=[]),this.value instanceof Array||(this.value=[this.value]),this.value.push(a)}},a}),define("objects.extension/default-selection-toolbar",["core.utils/class"],function(a){"use strict";var b;return b=a.extend("SelectionToolbar",{menuButtons:[],init:function(a,b,c,d,e,f){this.backendApi=a,this.selectionsApi=b,this.showMenu=c,this.showLock=d,e=e||[],this.menuButtons=f||[],this.buttons=e.concat([{name:"Tooltip.clearSelection",tid:"selection-toolbar.clear",isIcon:!0,buttonClass:"clear",iconClass:"icon-toolbar-clearselections",action:function(){this.selectionsApi.clear()},isDisabled:function(){return!this.backendApi.hasSelections()}},{clazz:"sel-toolbar-separator",buttonClass:"sel-toolbar-icon-separator",isDisabled:function(){return!0}},{name:"Tooltip.CancelSelections",tid:"selection-toolbar.undo",isIcon:!1,iconClass:"icon-cancel",buttonClass:"sel-toolbar-cancel",action:function(){this.selectionsApi.cancel()}},{name:"Tooltip.ConfirmSelections",tid:"selection-toolbar.refresh",iconClass:"icon-tick",buttonClass:"sel-toolbar-confirm",action:function(){this.selectionsApi.confirm()},isDisabled:function(){return!this.selectionsApi.selectionsMade}}])},hasState:function(a){if(!a)return!0;for(var b=this.backendApi.getDimensionInfos(),c=0;c<b.length;++c)for(var d=0;d<a.length;++d)if(b[c].qStateCounts[a[d]]>0)return!0;return!1}})}),define("objects.extension/default-view",["core.utils/class","qvangular","objects.utils/shapes/rect","objects.views/selections/cache-item","objects.extension/default-selection-toolbar"],function(a,b,c,d,e){"use strict";var f;return f=a.extend("DefaultView",{$scope:null,$element:null,containerRect:null,options:null,selections:null,backendApi:null,activeDimensions:[0],selectedShapes:[],init:function(a,b,c,d){this.$scope=a,this.$element=b,this.options=c,this.backendApi=d,this._toggleLasso=!1},on:function(){this.selections&&this.selections.on(),this.selectionsEnabled=!0},off:function(){this.selections&&this.selections.off(),this.selectionsEnabled=!1},prePaint:function(){},suppressOnPaint:function(a){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):a.qSelectionInfo&&a.qSelectionInfo.qInSelections},paint:function(){},updateData:function(){},resize:function(a,b){this.paint(a,b)},destroy:function(){},initialize:function(){this.initSelections()},setSelections:function(a){this.selections=a},initSelections:function(){this.selections&&(this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",{rect:new c(0,0,this.$element.width(),this.$element.height())}),this.options._disableSelections||(this.selections.Select.bind(function(a,b){this.onSelect(a,b)}.bind(this)),this.selections.ToggleShape.bind(function(a){var b=this.selectedShapes.indexOf(a);-1!==b?this.selectedShapes.splice(b,1):this.selectedShapes.push(a),this.onToggleShape(a)}.bind(this)),this.selections.Deactivated.bind(function(){this.selectedShapes=[]}.bind(this)),this.selections.Clear.bind(function(){this.selectedShapes=[]}.bind(this))))},refreshSelections:function(){this.selections&&(this.containerRect=this.$element[0].getBoundingClientRect(),this.selections.cache.clear())},onToggleShape:function(a){a.$element[this.isSelected(a.value)?"addClass":"removeClass"]("selected")},onSelect:function(a,b){if(a.length){var c=this.selectedShapes.map(function(a){return a.value});c.length>0&&this.activeDimensions.length>0?this.backendApi.select(c,this.activeDimensions,b):1!==a.length||a[0].selected||this.backendApi.clearSelections()}},onRangeSelect:function(){},addToSelectionCache:function(a,b){if(this.selections){var e=this.containerRect,f=a[0].getBoundingClientRect(),g=new d(new c(f.left-e.left,f.top-e.top,f.right-f.left,f.bottom-f.top),!1,b);g.$element=a,this.selections.cache.add(g)}},isSelected:function(a){return this.selectedShapes.filter(function(b){return b.value===a}).length},getContextMenu:function(){},setSnapshotData:function(){},toggleLasso:function(a){b.$apply(function(){this.selections&&(this._toggleLasso=a,this.options.lassoEnabled=a,this.selections.setLassoEnabled(a))}.bind(this))},isLassoing:function(){return this._toggleLasso},getSelectionToolbar:function(){var a=this;return new e(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[{name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"icon-toolbar-lasso",action:function(){a.toggleLasso(!a._toggleLasso)},isActive:function(){return this.name=a._toggleLasso?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection",a.isLassoing()},isDisabled:function(){return a.isLassoDisabled&&a.isLassoDisabled()?!0:!1}}],[])},setBackendApi:function(a){this.backendApi=a},selectValues:function(a,b,c){if(this.selectionsEnabled){if(!this.backendApi.inSelections()){var d=this.$scope,f=this;d.selectionsApi.confirm=function(){d.backendApi.endSelections(!0).then(function(){d.selectionsApi.deactivated()})},d.selectionsApi.cancel=function(){d.backendApi.endSelections(!1),d.selectionsApi.deactivated()},d.selectionsApi.deactivate=function(){this.deactivated()},d.selectionsApi.clear=function(){f.clearSelectedValues(f.$element),d.backendApi.clearSelections(),f.selectedArrays={}},this.getSelectionToolbar=function(){return new e(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[],[])},this.backendApi.beginSelections(),d.selectionsApi.activated(),d.selectionsApi.selectionsMade=!0,this.selectedArrays={}}if(this.selectedArrays[a]||(this.selectedArrays[a]=[]),c)for(var g=0;g<b.length;g++){var h=this.selectedArrays[a].indexOf(b[g]);-1===h?this.selectedArrays[a].push(b[g]):this.selectedArrays[a].splice(h,1)}else this.selectedArrays[a]=this.selectedArrays[a].concat(b);this.backendApi.selectValues(a,this.selectedArrays[a],!1)}},clearSelectedValues:function(a){a.find(".selected").removeClass("selected")},onStateChanged:function(){},allowInteraction:function(a){var b=!1;return a.state!==a.States.analysis&&(a.state!==a.States.play||this.backendApi&&this.backendApi.isSnapshot)||(b=!0),b},setInteraction:function(){}})}),define("text!objects/inline-title-edit.ng.html",[],function(){return'<div ng-show="!editing && displayValue == \'\'" class="qv-inline-edit-button">\r\n    <div class="icon-add"></div>\r\n    <div class="add-text" q-translation="{{emptyTranslation}}" q-title-translation="{{emptyTranslation}}"></div>\r\n</div>\r\n<div ng-show="!editing && displayValue != \'\'" class="qv-inline-edit-value">{{displayValue}}</div>\r\n<input ng-show="editing" class="qv-inline-edit-input" type="text" ng-model="titleValue" qv-inline-title-input maxlength="255"/>'}),define("objects/inline-title-edit",["qvangular","angular","core.models/rpc-base","general.utils/property-resolver","text!./inline-title-edit.ng.html"],function(a,b,c,d,e){"use strict";function f(a){return"object"==typeof a&&(a=a.qStringExpression.qExpr,"="!==a[0]&&(a="="+a)),a}function g(a){return a&&0===a.indexOf("=")?{qStringExpression:{qExpr:a}}:a}a.directive("qvInlineTitleInput",[function(){return{priority:1,require:"ngModel",link:function(a,b,c,d){b.unbind("input keydown change compositionend"),b.bind("blur",function(){a.$apply(function(){d.$setViewValue(b.val()),a.doEdit()})}),b.bind("keydown",function(a){a.stopPropagation(),27===a.which?(b.val(d.$viewValue),b.trigger("blur")):13===a.which&&"textarea"!==b[0].nodeName.toLowerCase()&&b.trigger("blur")})}}}]),a.directive("qvInlineTitleEdit",["$timeout",function(a){return{template:e,restrict:"A",scope:{model:"=",propertyPath:"@",layoutPath:"@",emptyTranslation:"@"},priority:1,link:function(e,h){var i=h.children().first(),j=h.children().eq(1),k=h.children().eq(2);e.editing=!1,e.titleProperty="",e.titleValue="",c.bindLayout(e,"model",function(a){e.displayValue=d.getValue(a,e.layoutPath),e.editing=!1}),e.doEdit=function(){var a=g(e.titleValue);e.editing&&(b.equals(l,a)?e.editing=!1:e.model.getProperties().then(function(b){d.setValue(b,e.propertyPath,a),e.model.save(),l=a}))};var l;i.add(j).on("qv-activate",function(){e.editing||e.model.getProperties().then(function(b){var c,g=k.get(0);e.editing=!0,e.titleProperty=d.getValue(b,e.propertyPath),e.titleValue=f(e.titleProperty),l=e.titleProperty,g.scrollLeft=g.scrollWidth,c=f(e.titleProperty).length,g.selectionStart=c,g.selectionEnd=c,a(function(){g.focus(),g.setSelectionRange(c,c)})})})}}}])}),define("objects.extension/base-controller",["core.utils/class","objects.extension/default-selection-toolbar"],function(a,b){"use strict";var c;return c=a.extend({$scope:null,init:function(a){this.$scope=a},onPaint:function(){},onResize:function(){},onStateChanged:function(){},setInteraction:function(){},setBackendApi:function(){},getContextMenu:function(){},getObjectMenu:function(){},getSelectionToolbar:function(){return new b(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1)},allowInteraction:function(a){var b=!1;return a.state!==a.States.analysis&&(a.state!==a.States.play||this.$scope.backendApi&&this.$scope.backendApi.isSnapshot)||(b=!0),b}}),c.$inject=["$scope"],c}),define("objects.utils/shapes/point",[],function(){"use strict";function a(a,b){0===arguments.length?this.set(0,0):this.set(a,b)}return a.prototype={toString:function(){return this.x+" "+this.y},clone:function(){
return new a(this.x,this.y)},set:function(a,b){this.x=a,this.y=b},equal:function(a){return this.x===a.x&&this.y===a.y},closeTo:function(a,b){return a?Math.abs(this.x-a.x)<b&&Math.abs(this.y-a.y)<b:!1},distanceTo:function(a){return a?Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2)):NaN}},a}),define("objects.utils/shapes/polygon",["objects.utils/shapes/rect","objects.utils/shapes/line"],function(a,b){"use strict";function c(b){var c,d,e=Number.MAX_VALUE,f=-Number.MAX_VALUE,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=b?b.length:0;if(!i)return null;for(d=0;i>d;d++)c=b[d],f=c.x>f?c.x:f,e=c.x<e?c.x:e,h=c.y>h?c.y:h,g=c.y<g?c.y:g;return new a(e,g,f-e,h-g)}function d(){this._numPoints=this.points?this.points.length:0,this._closedPolygon=this._numPoints>1&&this.points[0].x===this.points[this._numPoints-1].x&&this.points[0].y===this.points[this._numPoints-1].y,this._closedPolygon?this._numLines=this._numPoints-1:this._numLines=this._numPoints,this._pointsChanged=!0}function e(a){0===arguments.length?this.set([]):this.set(a),this._pointsChanged=!0}return e.prototype={clone:function(){var a=this.points.map(function(a){return a.clone()});return new e(a)},set:function(a){this.points=a,d.call(this)},getPoints:function(){return this.points},getNumPoints:function(){return this.points?this.points.length:0},addPoint:function(a){this.points.push(a),d.call(this)},pointInside:function(a,b){if(this.calculateBounds(),!this._bounds)return!1;if(a<this._bounds.x||a>this._bounds.x+this._bounds.width||b<this._bounds.y||b>this._bounds.y+this._bounds.height)return!1;var c,d,e,f,g;for(c=!1,f=-1,d=this.points.length,e=d-1;++f<d;e=f){if(this.points[f].x===a&&this.points[f].y===b)return!0;if(this.points[f].y===this.points[e].y&&this.points[f].y===b&&(a-this.points[f].x)*(a-this.points[e].x)<=0)return!0;if(this.points[f].y<b&&b<=this.points[e].y||this.points[e].y<b&&b<=this.points[f].y){if(g=(this.points[e].x-this.points[f].x)*(b-this.points[f].y)/(this.points[e].y-this.points[f].y)+this.points[f].x,a===g)return!0;g>a&&(c=!c)}}return c},intersectsLine:function(a){if(!a)return!1;if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var c,d;if(0===this._numPoints)return!1;if(1===this._numPoints)return a.intersectsLine(new b(this.points[0].x,this.points[0].y,this.points[0].x,this.points[0].y))?!0:!1;for(d=this._numPoints-1,c=0;d>c;c++)if(a.intersectsLine(new b(this.points[c].x,this.points[c].y,this.points[c+1].x,this.points[c+1].y)))return!0;return!this._closedPolygon&&a.intersectsLine(new b(this.points[d].x,this.points[d].y,this.points[0].x,this.points[0].y))?!0:!1},intersectsLines:function(a){var b,c=a?a.length:0;for(b=0;c>b;b++)if(this.intersectsLine(a[b]))return!0;return!1},intersectsRect:function(a){if(!a)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(a.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(a))return!1;var c,d,e,f,g;return c=a.x,d=a.getRight(),e=a.y,f=a.getBottom(),this.pointInside(c,e)||this.pointInside(d,e)||this.pointInside(d,f)||this.pointInside(c,f)?!0:(g=[new b(c,e,d,e),new b(c,f,d,f),new b(c,e,c,f),new b(d,e,d,f)],this.intersectsLines(g))},calculateBounds:function(){return this._pointsChanged&&(this._bounds=c(this.points),this._pointsChanged=!1),this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="",c=this._numPoints-1;for(a=0;c>a;a++)b+=this.points[a].toString()+",";return b+=this.points[c].toString()}},e}),define("objects.views/charts/utils/tree-iterator",[],function(){var a={getLevel:function(){if(this&&this.parent!==this){for(var a=this.parent,b=0;a;)b+=1,a=a.parent;return b}},each:function(b){var c,d=this.children;if(d)for(c=0;c<d.length;c+=1){if(b&&b(d[c],c,d.length-1)===!1)return!1;if(a.each.call(d[c],b)===!1)return!1}},getLeaves:function(){if(!this.children||!this.children)return[];var b,c=[];for(b=0;b<this.children.length;b+=1)this.children[b]&&this.children[b].children&&this.children[b].children.length?c=c.concat(a.getLeaves.call(this.children[b])):c.push(this.children[b]);return c}};return a}),define("objects.views/charts/utils/cache-utils",[],function(){function a(b,c){return b.forEach(function(b){if(b.isCacheItem)c.push(b);else if(b.data.cacheItem)c.push(b.data.cacheItem);else if(b.cacheItem&&(c.push(b.cacheItem),b.cacheItem.isCacheItem))throw"Using new cache item before its time";b.children&&b.children.length>0&&a.apply(this,[b.children,c])}),c}var b={getCacheItems:function(){return this.children&&this.children?a.apply(this,[this.children,[]]):[]}};return b}),define("objects.views/selections/types/base",["core.utils/class","objects.utils/shapes/point","objects.views/charts/utils/tree-iterator","objects.views/charts/utils/cache-utils"],function(a,b,c,d){"use strict";function e(a){return a?a.selectionIdentifier:null}function f(a,b){if(b){var c=!1;return b.contains(0)&&(c=a.parent?-2===a.parent.id:-2===a.id),a.parent&&b.contains(1)&&(c=c||-2===a.id),c}return-2===a.id||a.parent&&-2===a.parent.id}function g(a){var b=this.indexOf(a);b>=0&&this.splice(b,1)}var h;return h=a.extend({init:function(a,b){this._selectedShapes=[],this.handler=a,this.options=b,this.components=b.components||{},this.activeComponent=null},release:function(){this.components={},this._selectedShapes=[],this.handler=null},initComponent:function(){throw new Error("base.js: initComponent has to be implemented in subclass")},resetSelectedShapes:function(){this._selectedShapes.length=0},getSelectedShapes:function(){return this._selectedShapes},toggleSelectedShape:function(a){var b=this._selectedShapes.indexOf(a);-1!==b?this._selectedShapes.splice(b,1):this._selectedShapes.push(a)},setComponent:function(a,b){switch(a){case"x":case"y":case"dataArea":case"colorLegend":this.components[a]=Array.isArray(b)?b:[b];break;default:throw"Key "+a+" not implemented"}},addComponent:function(a,b){switch(a){case"x":case"y":case"dataArea":case"colorLegend":this.components[a]||(this.components[a]=[]),g.call(this.components[a],b),this.components[a].push(b);break;default:throw"Key "+a+" not implemented"}},removeComponent:function(a,b){switch(a){case"x":case"y":case"dataArea":case"colorLegend":this.components[a]&&b&&g.call(this.components[a],b),b&&this.components[a]&&this.components[a].length||delete this.components[a];break;default:throw"Key "+a+" not implemented"}},getComponent:function(a,c){var d=new b(a-this.handler.containerRect.x,c-this.handler.containerRect.y);return Object.keys(this.components).map(function(a){return this.components[a]},this).reduce(function(a,b){return a.concat(b)}).filter(function(a){return this.getRect(a).pointInside(d.x,d.y)},this)[0]},getRect:function(a){return a.rect},getComponentKey:function(a){return Object.keys(this.components).filter(function(b){return this.components[b].indexOf(a)>=0},this)[0]},setActiveMode:function(a){this._activeMode=a},getActiveMode:function(){return this._activeMode},getActiveDimensions:function(){return this.activeComponent.getSelectionIndices()},toggle:function(){},toggleRect:function(){},start:function(){},update:function(){},end:function(){},cancel:function(){},move:function(){},leave:function(){},getTransformedPoint:function(a,c){var d=this.getRect(this.activeComponent||this.components.dataArea[0]);return new b(a-d.x-this.handler.containerRect.x,c-d.y-this.handler.containerRect.y)},getPagePoint:function(a,c,d){var e=this.getRect(d||this.activeComponent||this.components.dataArea[0]);return new b(a+e.x+this.handler.containerRect.x,c+e.y+this.handler.containerRect.y)},getInterpolatedPoints:function(a,c,d){d=d||this.options.interpolation.pixelPrecision||2;var e,f,g=a.distanceTo(c),h=1/(g/(d>0?d:g)),i=[];for(i.push(a),e=h;1-h>e;e+=h)f=new b(a.x+(c.x-a.x)*e,a.y+(c.y-a.y)*e),i.push(f);return i.push(c),i},shapeFromPoint:function(a){return this.shapesFromPoints([a])[0]},shapesFromPoints:function(a){var b,c,d,g,h,i,j,k,l=this.handler.cache.data,m=this.handler.cache.data.length,n=a.length,o=e(this.activeComponent),p=[];for(i=0;m>i;++i)if(h=l[i],!f(h)||this._allowNullSelect)for(j=0;n>j;++j)for(b=a[j],d=h.getShapes(e(this.activeComponent)),"dataArea"===o&&h.toggleShapes&&(d=d.concat(h.toggleShapes)),c=d.length,k=0;c>k;++k)if(g=d[k],g.pointInside(b.x,b.y)){p.push(h);break}return p},shapesFromLines:function(a){var b,c,d,g,h,i,j,k,l=this.handler.cache.data,m=this.handler.cache.data.length,n=a.length,o=[];for(i=0;m>i;++i)if(h=l[i],!f(h)||this._allowNullSelect)for(j=0;n>j;++j)for(b=a[j],d=h.getShapes(e(this.activeComponent)),c=d.length,k=0;c>k;++k)if(g=d[k],g.intersectsLine(b)){o.push(h);break}return o},shapesFromPolygon:function(a){var b,c,d,g,h,i,j,k,l,m,n=this.handler.cache.data,o=this.handler.cache.data.length,p=[];for(j=0;o>j;++j)if(i=n[j],!f(i)||this._allowNullSelect)for(m=!1,h=i.getShapes(e(this.activeComponent)),g=h.length,l=0;g>l&&!m;++l)for(b=h[l].getPoints(),d=b.length,k=0;d>k;++k)if(c=b[k],a.pointInside(c.x,c.y)){p.push(i),m=!0;break}return p},shapesFromRect:function(a,b){if(!a)return[];var c,d,g,h,i,j,k=this.handler.cache.data,l=this.handler.cache.data.length,m=[];for(i=0;l>i;++i)if(h=k[i],!f(h)||this._allowNullSelect)for(d=h.getShapes(b?b:e(this.activeComponent)),c=d.length,j=0;c>j;j++)if(g=d[j],g.intersectsRect){if(g.intersectsRect(a)){m.push(h);break}}else if(a.intersectsWith(g)){m.push(h);break}return m},shapesFromRectForDirection:function(a,b,c){var d,g,h,i,j,k,l,m=this.handler.cache.data,n=this.handler.cache.data.length,o=[],p=0,q=0,r="";switch(b){case"x":p=a.x,q=a.getRight(),r="getRight";break;case"y":p=a.y,q=a.getBottom(),r="getBottom"}for(k=0;n>k;++k)if(d=m[k],!f(d)||this._allowNullSelect)for(h=d.getShapes(c?c:e(this.activeComponent)),g=h.length,l=0;g>l;++l)if(i=h[l],"cx"in i){if(i["c"+b]>=p&&i["c"+b]<=q){o.push(d);break}}else{if(j=i.getBoundingRect(),j[b]>=p&&j[b]<=q){o.push(d);break}if(j[r]()>=p&&j[r]()<=q){o.push(d);break}if(p>=j[b]&&q<=j[r]()){o.push(d);break}}return o},shapesFromRange:function(a,b,c,d){var e,g,h,i,j,k,l=Math.min(a,b),m=Math.max(a,b),n=this.handler.cache.data,o=this.handler.cache.data.length,p="function"==typeof this.activeComponent.getType?this.activeComponent.getType().indices:null,q=[];for(c=c!==!1,d=d!==!1,k=c&&d?function(a){return a>=l&&m>=a}:c?function(a){return a>=l&&m>a}:d?function(a){return a>l&&m>=a}:function(a){return a>l&&m>a},i=0;o>i;++i)if(e=n[i],!f(e)||this._allowNullSelect)for(g=e.values instanceof Array?e.values:e.value instanceof Array?e.value:[e.value],p&&p.length&&(g=g.filter(function(a,b){return p.indexOf(b)>=0})),j=0;j<g.length;j++)if(h=g[j],k(h)){q.push(e);break}return q},shapesFromDimensionValue:function(a){var b,c,d,e=this.handler.cache.data,g=this.handler.cache.data.length,h=[];for(c=0;g>c;++c)if(b=e[c],!f(b)||this._allowNullSelect)for(d=0;d<a.length;d++)if(b.id===a[d]){h.push(b);break}return h},groupedItemsFromShapes:function(a){var b,e,f,g,h=[];return b=void 0!==this.activeComponent.getSelectionIndices?this.activeComponent.getSelectionIndices():[0],e=b[b.length-1],a.forEach(function(b){g=b.parent,void 0!==g&&(f=c.getLevel.call(g)-(b.isCacheItem?0:1),f===e&&-1===h.indexOf(g)&&a&&h.push(g))}),h.length>0&&(a=[],h.forEach(function(b){a=a.concat(d.getCacheItems.call(b))})),a},shapesFromIndex:function(a,b){var c,d,e=Math.min(a,b),f=Math.max(a,b),g=this.handler.cache.data,h=this.handler.cache.data.length,i=[];for(d=0;h>d;++d)c=g[d],void 0!==c.index&&c.index>=e&&c.index<=f&&i.push(c);return i},ToggleFlag:{select:1,deselect:2,auto:4,replace:8,tooltip:16},toggleSelection:function(a,b){function c(c){var d=a.filter(c);d.forEach(function(a){e||(a.selected=!a.selected,j(a),g.emit(a,b))}),d.length>0&&h.emit(a,b)}var d,e=this.handler._disableSelections,f=this.ToggleFlag,g=this.handler.ToggleShape,h=this.handler.ToggleShapes,i=this.handler.ToggleTooltip,j=this.toggleSelectedShape.bind(this);b=b||f.auto,b&f.select?c(function(a){return!a.selected}):b&f.deselect?c(function(a){return a.selected}):b&f.auto?c(function(){return!0}):b&f.replace&&(d=a,a=this.handler.cache.data,c(function(a){return a.selected}),a=d,c(function(){return!0})),b&f.tooltip&&i.emit(a,e)},clearSelection:function(){var a=this.handler.Clear,b=this.handler.cache.data,c=this.ToggleFlag.deselect;this.toggleSelection(b,c),a.emit()},_isNull:f}),h.defaultOptions={},h}),define("general.services/show-service/show-service",["jquery","qvangular","core.utils/deferred"],function(a,b,c){"use strict";function d(){if(!i){var b=a("<div id='show-service-popup-dialog'></div>");a("body").append(b),b.showComponent(k,{views:j}),i=!0}}function e(a,b){function e(){var a=j.indexOf(g);a>=0&&j.splice(a,1)}d();var f=new c,g={component:a,input:b,deferredResult:f,exposedApi:{destroy:e,resultPromise:f.promise}};return j.push(g),g.exposedApi}function f(c,d){var e={$element:a("body"),input:d};for(var f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);return b.$injector.invoke(c,{},e)}function g(a,b){return"function"==typeof a||Array.isArray(a)?f(a,b):e(a,b)}function h(){return j.length>0}var i,j=[];b.componentDirective("qvShowServiceView",{destroyComponent:"&",input:"=",deferredResult:"=",exposedApi:"="});var k={template:"<div><div ng-repeat='view in views' qv-show-service-view component='view.component' data-input='view.input' data-deferred-result='view.deferredResult' destroy-component='unshow(view)' data-exposed-api='view.exposedApi'></div></div>",controller:["$scope",function(a){a.unshow=function(b){var c=a.views.indexOf(b);c>=0&&a.views.splice(c,1)}}]},l={show:g,isViewShowing:h};return l}),define("general.components/framer/framer",["qvangular","general.services/show-service/show-service"],function(a,b){var c={template:'<div class ="qv-framer" ng-style="style"></div>',controller:["$scope",function(a){a.style={},a.style.top=a.top,a.style.left=a.left,a.style.height=a.height,a.style.width=a.width,a.closeComponent()}],scope:{top:"=",left:"=",height:"=",width:"=",closeComponent:"="}},d={flash:function(d,e){var f=a.getService("$timeout"),g=b.show(c,{top:Math.min(d.y,e.y)+"px",left:Math.min(d.x,e.x)+"px",height:Math.max(d.y,e.y)-Math.min(d.y,e.y)+"px",width:Math.max(d.x,e.x)-Math.min(d.x,e.x)+"px",closeComponent:function(){f(function(){g.destroy(),g=null},300)}})}};return d}),define("objects.views/selections/types/data-area",["jquery","objects.utils/shapes/point","objects.utils/shapes/polygon","objects.utils/shapes/rect","objects.utils/shapes/line","./base","general.components/framer/framer"],function(a,b,c,d,e,f,g){"use strict";function h(){x.beginPath(),x.moveTo(n.x,n.y),x.fillStyle="rgba(77, 192, 78, 1)",x.arc(n.x,n.y,10,0,2*Math.PI,!0),x.fill()}function i(a,b,c){var d,e;!c||"x"!==c&&"y"!==c||(b[c]=n[c]),d=(a.x+b.x)/2,e=(a.y+b.y)/2,x.beginPath(),x.moveTo(a.x,a.y),x.quadraticCurveTo(d,e,b.x,b.y),x.stroke()}function j(a,b,c,d){d=d||[2,4];var e,f=d.length,g=c.x-b.x,h=c.y-b.y,i=Math.sqrt(g*g+h*h),j=i,k=0,l=!0,m=b.x,n=b.y;for(g/=i,h/=i,a.moveTo(m,n),k=0;j>=.1&&5e3>k;++k)e=d[k%f],0===e&&(e=.001),e>j&&(e=j),m+=e*g,n+=e*h,a[l?"lineTo":"moveTo"](m,n),j-=e,l=!l}function k(a,b){y.clearRect(0,0,u.width,u.height),y.beginPath(),j(y,a,b),y.stroke()}function l(){p.hide(),r.hide(),t.hide()}var m,n,o=document.body,p=a("<div />"),q=p[0],r=a("<canvas />"),s=r[0],t=a("<canvas />"),u=t[0],v=a("<canvas />"),w=v[0],x=s.getContext("2d"),y=u.getContext("2d"),z=w.getContext("2d"),A=[],B=!1,C=!1;return q.appendChild(s),q.appendChild(u),q.appendChild(w),q.className="selections-data-area-ui",p.hide(),o.appendChild(q),m=f.extend("DataAreaSelection",{init:function(a,b){this._super(a,b),this.setActiveMode("item"),this._startIndex=-1,this._endIndex=-1},initComponent:function(){this.activeComponent=this.components.dataArea[0]},refreshCanvas:function(){this.rect=this.components.dataArea[0].rect;var a={position:"absolute",left:this.handler.containerRect.x+this.rect.x+"px",top:this.handler.containerRect.y+this.rect.y+"px",width:this.rect.width+"px",height:this.rect.height+"px","z-index":20};x.canvas.width=this.rect.width,x.canvas.height=this.rect.height,x.lineWidth=2,x.lineCap="round",x.lineJoin="round",x.strokeStyle="rgba(102,102,102,1)",x.fillStyle="rgba(102,102,102,1)",r.css(a),y.canvas.width=this.rect.width,y.canvas.height=this.rect.height,y.lineWidth=2,y.lineCap="round",y.lineJoin="round",y.strokeStyle="rgba(102,102,102,1)",t.css(a),z.canvas.width=this.rect.width,z.canvas.height=this.rect.height,v.css(a)},toggle:function(a,b,c){c=void 0!==c?c:this.handler.getKeyAsToggleSelected(a),c||this.clearSelection(),this.resetSelectedShapes(),this.activeComponent=this.components.dataArea[0];var e,f=this.getTransformedPoint(b.x,b.y),g=this.options.toggle.callback||this.toggleSelection,h=this.options.indexSelection,i=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return e=h?this.shapesFromRectForDirection(new d(f.x,f.y,0,0),"y"):this.shapesFromPoints([f]),e=this.groupedItemsFromShapes(e),e.forEach(function(a){a.selectionMode="dataArea"}),e.forEach(function(a){a.interactPosition=b}),g.call(this,e,i),e&&e.length>0},toggleRect:function(b,c,e){if(c&&e){var f,h,i,j,k,l,m,n,o,p,q,r=a(this.components.dataArea[0].container),s=r.offset(),t=function(a){return{x:Math.min(Math.max(a.x,s.left),s.left+r.width()),y:Math.min(Math.max(a.y,s.top),s.top+r.height())}};c=t(c),e=t(e),p=c,q=e,this.resetSelectedShapes(),c=this.getTransformedPoint(c.x,c.y),e=this.getTransformedPoint(e.x,e.y),f=Math.min(c.x,e.x),h=Math.min(c.y,e.y),i=Math.max(1,Math.abs(e.x-c.x)),j=Math.max(1,Math.abs(e.y-c.y)),k=new d(f,h,i,j),m=this.ToggleFlag.select,n=this.options.indexSelection,o=this.toggleSelection,this.activeComponent=this.components.dataArea[0],l=n?this.shapesFromRectForDirection(k,"y"):this.shapesFromRect(k),l=this.groupedItemsFromShapes(l),l.forEach(function(a){a.selectionMode="dataArea"}),o.call(this,l,m),this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),!0),g.flash(p,q)}},start:function(a,c){this.handler.getKeyAsToggleSelected(a)||this.clearSelection(),this.resetSelectedShapes(),this.activeComponent=this.components.dataArea[0];var e=this.getTransformedPoint(c.x,c.y),f=this.options.captureInput,g=this.options.indexSelection;if(f&&(r.show(),t.show(),p.show(),this.refreshCanvas()),A.length=0,A.push(e),n=new b(A[0].x,A[0].y),B=!1,C=!1,g){var i=this.shapesFromRectForDirection(new d(n.x,n.y,1,1),"y"),j=i.length&&i[0].index;void 0!==j&&j>=0&&(this._startIndex=j)}f&&h()},update:function(a,b){var c,f,g,h,j=this.getTransformedPoint(b.x,b.y),l=this.options,m=l.captureInput,o=l.lassoAutoCloseDistance,p=l.indexSelection,q=a.shiftKey&&l.shiftLockCapture?l.shiftLockAxis:"",r=this.ToggleFlag.select,s=-1,t=this.toggleSelection;c=A[A.length-1],A.push(j),m&&i(c,j,q),m&&(B||(B=A.length>2&&n.distanceTo(j)>=o),y.clearRect(0,0,u.width,u.height),B&&(n.distanceTo(j)<=o?(k(j,n),C=!0):C=!1)),p?(h=this.shapesFromRectForDirection(new d(j.x,j.y,1,1),"y"),s=h.length?h[0].index:-1,void 0!==s&&s>=0&&(this._endIndex=s),f=this.shapesFromIndex(this._startIndex,this._endIndex),g=this.getSelectedShapes().filter(function(a){return-1===f.indexOf(a)}),t.call(this,g,this.ToggleFlag.deselect),t.call(this,f,r)):(f=this.shapesFromLines([new e(c.x,c.y,j.x,j.y)]),f=this.groupedItemsFromShapes(f),f.forEach(function(a){a.selectionMode="dataArea"}),t.call(this,f,r))},end:function(a){var b,d,e=this.options.captureInput,f=this.options.indexSelection,g=this.ToggleFlag.select,h=this.toggleSelection;f&&(this._startIndex=-1,this._endIndex=-1),e&&l(),e&&C&&(d=new c(A),b=this.shapesFromPolygon(d),b=this.groupedItemsFromShapes(b),b.forEach(function(a){a.selectionMode="dataArea"}),h.call(this,b,g)),A.length=0,this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),this.handler.getKeyAsToggleSelected(a))},cancel:function(a){A.length&&l(),a&&this.clearSelection(),this.activeComponent=null}}),m.defaultOptions={captureInput:!0,indexSelection:!1,shiftLockCapture:!1,shiftLockAxis:"x",lassoAutoCloseDistance:50,autoConfirm:!1,toggle:{callback:null},interpolation:{pixelPrecision:2}},m}),define("text!objects.views/selections/types/range-template.ng.html",[],function(){return'<div class="qvt-range-selection">\r\n\r\n	<div ng-show="vertical" class="range-vertical"\r\n		 ng-class="{\'near\': vOptions.dock == \'left\', \'far\' : vOptions.dock == \'right\'}"\r\n		 ng-style="vRangeStyle">\r\n		<div class="range">\r\n			<div class="axis-cover" ng-style="vRelevantSize" tid="range-vertical-cover" ng-class="{\'active\' : activeOptions.y.cover}"></div>\r\n		</div>\r\n		<div class="far-edge" tid="range-vertical-far" ng-class="{\'active\' : activeOptions.y.far}">\r\n		</div>\r\n		<div class="near-edge" tid="range-vertical-near" ng-class="{\'active\' : activeOptions.y.near}">\r\n		</div>\r\n		<div class="outer-bubble-wrapper" ng-style="vWrappperSize">\r\n			<div class="far bubble-wrapper">\r\n				<div class="bubble" ng-class="{\'active\' : activeOptions.y.far}">{{vValues.start.text}}</div>\r\n			</div>\r\n			<div class="near bubble-wrapper">\r\n				<div class="bubble" ng-class="{\'active\' : activeOptions.y.near}">{{vValues.end.text}}</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n	<div ng-show="horizontal" class="range-horizontal"\r\n		 ng-class="{\'near\': hOptions.dock == \'bottom\', \'far\' : hOptions.dock == \'top\'}"\r\n		 ng-style="hRangeStyle">\r\n	    <div class="range">\r\n			<div class="axis-cover" ng-style="hRelevantSize" tid="range-horizontal-cover" ng-class="{\'active\' : activeOptions.x.cover}"></div>\r\n	    </div>\r\n	   \r\n	    <div class="far-edge" tid="range-horizontal-far" ng-class="{\'active\' : activeOptions.x.far}">\r\n	    </div>\r\n		<div class="near-edge" tid="range-horizontal-near" ng-class="{\'active\' : activeOptions.x.near}">\r\n		</div>\r\n		<div class="outer-bubble-wrapper" ng-style="hWrappperSize">\r\n			<div class="far bubble-wrapper">\r\n				<div class="bubble" ng-class="{\'active\' : activeOptions.x.far}">{{hValues.end.text}}</div>\r\n			</div>\r\n			<div class="near bubble-wrapper">\r\n				<div class="bubble" ng-class="{\'active\' : activeOptions.x.near}">{{hValues.start.text}}</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("objects.views/selections/types/range-directive",["touche","qvangular","objects.utils/shapes/point","text!./range-template.ng.html"],function(a,b,c,d){function e(a,b,d,e){var f=[];return"y"===d?(f[b]=new c(a[b].x,a[b].y+e),f[1^b]=a[1^b]):(f[b]=new c(a[b].x+e,a[b].y),f[1^b]=a[1^b]),f}function f(a){a.$emit("rangeStart")}function g(a,b,c){a.$emit("rangeUpdate",b,c)}function h(a,b){a.$emit("rangeEnd",b)}function i(a,b,c){return b?a[0][c]>a[1][c]?0:1:a[0][c]<a[1][c]?0:1}function j(b,c,d,j){var k,l,m,n=d?"hHandlePoints":"vHandlePoints",o=d?"x":"y";a(c).tap({id:w,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:w,options:{radiusThreshold:0},start:function(){l=i(b[n],j,o),k=b[n],a.preventGestures(this.gestureHandler),f(b)},update:function(a,c){b[n]=e(k,l,o,d?c.swipe.deltaX:c.swipe.deltaY),b.$digest(),b.activeOptions[o].near=b.activeOptions[o].far=!1,m=i(b[n],j,o)^!d?"far":"near",b.activeOptions[o][m]=!0,g(b,b[n],o)},end:function(){h(b,b[n]),b.activeOptions[o].near=b.activeOptions[o].far=!1}})}function k(b){if(!x){x=!0;var c="hey";a(m).tap({id:w,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:w,options:{preventDefault:!0},start:function(){c=b.vHandlePoints,a.preventGestures(this.gestureHandler),f(b),b.activeOptions.y.cover=!0},update:function(a,d){b.vHandlePoints=[{x:c[0].x,y:c[0].y+d.swipe.deltaY},{x:c[1].x,y:c[1].y+d.swipe.deltaY}],b.$digest(),g(b,b.vHandlePoints,"y")},end:function(){h(b,b.vHandlePoints),b.activeOptions.y.cover=!1}}),a(n).tap({id:w,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:w,options:{preventDefault:!0},start:function(){c=b.hHandlePoints,a.preventGestures(this.gestureHandler),f(b),b.activeOptions.x.cover=!0},update:function(a,d){b.hHandlePoints=[{x:c[0].x+d.swipe.deltaX,y:c[0].y},{x:c[1].x+d.swipe.deltaX,y:c[1].y}],b.$digest(),g(b,b.hHandlePoints,"x")},end:function(){h(b,b.hHandlePoints),b.activeOptions.x.cover=!1}}),j(b,o,!1,!1,"far"),j(b,p,!1,!0,"near"),j(b,q,!0,!0,"far"),j(b,r,!0,!1,"near"),a.utils.touch||(j(b,s,!1,!1,"far"),j(b,t,!1,!0,"near"),j(b,u,!0,!0,"far"),j(b,v,!0,!1,"near"))}}function l(){a(m).off("*",w),a(n).off("*",w),a(o).off("*",w),a(p).off("*",w),a(q).off("*",w),a(r).off("*",w),a(s).off("*",w),a(t).off("*",w),a(u).off("*",w),a(v).off("*",w),x=!1}var m,n,o,p,q,r,s,t,u,v,w=".rangeselection",x=!1;b.directive("qvaRangeSelection",function(){return{template:d,replace:!0,scope:{vertical:"=",horizontal:"=",vOptions:"=",hOptions:"=",vHandlePoints:"=",hHandlePoints:"=",vValues:"=",hValues:"="},link:function(a,b){a.vRangeStyle={},a.hRangeStyle={},a.vRelevantSize=0,a.hRelevantSize=0,a.activeOptions={y:{far:!1,near:!1,cover:!1},x:{far:!1,near:!1,cover:!1}},a.setRangeStyle=function(b,c,d){if(!c||2!==c.length||!d)return{};var e=c[0],f=c[1];"y"===b?a.vRangeStyle={height:Math.abs(e[b]-f[b]),top:Math.min(e[b],f[b])+d.rect.y-d.containerRect.y-d.padding.top}:a.hRangeStyle={width:Math.abs(e[b]-f[b]),left:Math.min(e[b],f[b])+d.rect.x-d.containerRect.x-d.padding.left}},a.$watchCollection("[vHandlePoints, vOptions]",function(b){a.setRangeStyle("y",b[0],b[1])}),a.$watchCollection("[hHandlePoints, hOptions]",function(b){a.setRangeStyle("x",b[0],b[1])}),a.$watch("hOptions",function(b){b&&a.setRelevantSize("x",b.rect.height)}),a.$watch("vOptions",function(b){b&&a.setRelevantSize("y",b.rect.width)}),a.setRelevantSize=function(b,c){"x"===b?(a.hRelevantSize={height:c+"px"},a.hWrappperSize={height:"calc(100% - "+c+"px)"}):(a.vRelevantSize={width:c+"px"},a.vWrappperSize={width:"calc(100% - "+c+"px)"})},m=b.find(".range-vertical .axis-cover")[0],n=b.find(".range-horizontal .axis-cover")[0],o=b.find(".range-vertical .far.bubble-wrapper .bubble")[0],p=b.find(".range-vertical .near.bubble-wrapper .bubble")[0],q=b.find(".range-horizontal .far.bubble-wrapper .bubble")[0],r=b.find(".range-horizontal .near.bubble-wrapper .bubble")[0],s=b.find(".range-vertical .far-edge")[0],t=b.find(".range-vertical .near-edge")[0],u=b.find(".range-horizontal .far-edge")[0],v=b.find(".range-horizontal .near-edge")[0],k.call(this,a),a.$on("on",function(){k.call(this,a)}),a.$on("off",function(){l.call(this)}),a.$on("$destroy",function(){l.call(this)})}}})}),define("objects.views/selections/types/range-angular",["jquery","qvangular","./base","objects.utils/shapes/point","objects.utils/shapes/rect","./range-directive"],function(a,b,c,d,e){"use strict";function f(a){if(a.isCacheItem){var b=a.getDimensions();return b[b.length-1]}return a.parent&&a.parent.data&&a.parent.data.qText?a.parent.data.qText:a.label}function g(a,b,c){var d,e,g,h=this.activeComponent.rect,i=this.getRect(this.activeComponent),j=this.components.dataArea[0].rect,k=a.x-b.x,l=a.y-b.y,m=i.y-h.y,n=i.x-h.x,o=0,p=0,s=0,t=0,u=0;switch(this.activeComponent.dock){case"top":case"bottom":o=0>=k?i.width-a.x:a.x,0>k&&(o+=n),b.x<n&&(k-=n-b.x),p=q(i.width+n,r(n,q(a.x,b.x))),t=r(p,q(n+i.width,r(a.x,b.x))),s=0,u=j.height,c.rect.set(p,s,t-p,u-s),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(d=this.shapesFromRectForDirection(c.rect,"x","dataArea"),d.length?(e=d[0],g=d[d.length-1],c.startVal=f(e),c.updateVal=f(g)):(c.startVal="-",c.updateVal="-")):(c.startVal=this.activeComponent.getValueOfPosition(p),c.updateVal=this.activeComponent.getValueOfPosition(t));break;case"left":case"right":o=0>=l?i.height-a.y:a.y,0>l&&(o+=m),b.y<m&&(l-=m-b.y),p=0,t=j.width,s=q(i.height+m,r(m,q(a.y,b.y))),u=r(s,q(m+i.height,r(a.y,b.y))),c.rect.set(p,s,t-p,u-s),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(d=this.shapesFromRectForDirection(c.rect,"y","dataArea"),d.length?(e=d[0],g=d[d.length-1],c.startVal=f(e),c.updateVal=f(g)):(c.startVal="-",c.updateVal="-")):(c.startVal=this.activeComponent.getValueOfPosition(s),c.updateVal=this.activeComponent.getValueOfPosition(u))}}function h(){return this.components.x&&this.components.y&&!this.components.x[0].isDiscrete()&&!this.components.y[0].isDiscrete()}function i(){n.y=!1,n.x=!1,this._rangeEventWatchers&&(this._rangeEventWatchers.forEach(function(a){a()}),this._rangeEventWatchers=null),s.hide(),w={x:[],y:[]}}function j(a,b){a||(a="x"),b||(b=0);var c=w[a][b];return c||(c={rect:new e(0,0,0,0),startVal:0,endVal:0},w[a][b]=c),c}function k(a,b,c){var d,e=[],f=this._previousShapes?this._previousShapes.slice():[],g=j(a),i=w["y"===a?"x":"y"];this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?(e=this.shapesFromRectForDirection(g.rect,a,"dataArea"),e=this.groupedItemsFromShapes(e),e.forEach(function(a){var b=f.indexOf(a);b>=0&&f.splice(b,1),a.selectionMode="range.dimension"}),this.checkActiveMode(["range.dimension","item"],!0),b.call(this,e,c),this._clearPrev&&b.call(this,f,this.ToggleFlag.deselect),this._shapes=e):(h.call(this)?(d=i.length?g.rect.intersection(i[0].rect):g.rect,e=this.shapesFromRect(d,"dataArea"),this.components.dataArea&&this.components.dataArea[0].updateRangeSelection&&this.components.dataArea[0].updateRangeSelection(d)):e=this.shapesFromRange(g.startVal,g.updateVal),e.forEach(function(a){a.selectionMode="range.measure"}),this.checkActiveMode(["range.measure"],!0),b.call(this,e,c),this._shapes=e)}function l(a){var b,c,e=this.getComponentKey(this.activeComponent),f=j(e),h=a,i=this.ToggleFlag.select,l=this.toggleSelection;g.call(this,o,h,f),b=new d(f.rect.x,f.rect.y),c=new d(f.rect.x+f.rect.width,f.rect.y+f.rect.height),"y"===e?(n.vHandlePoints=[b,c],n.vValues={start:{text:this.activeComponent.getFormatter().format(f.startVal),value:f.startVal},end:{text:this.activeComponent.getFormatter().format(f.updateVal),value:f.updateVal}}):(n.hHandlePoints=[b,c],n.hValues={start:{text:this.activeComponent.getFormatter().format(f.startVal),value:f.startVal},end:{text:this.activeComponent.getFormatter().format(f.updateVal),value:f.updateVal}}),n.$digest(),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?this._shapes&&l.call(this,this._shapes,this.ToggleFlag.deselect):this.clearSelection(!0),k.call(this,e,l,i)}var m,n,o,p=!1,q=Math.min,r=Math.max,s=a("<div />"),t=s[0],u=new e(0,0,0,0),v=a('<div qva-range-selection v-handle-points="vHandlePoints" h-handle-points="hHandlePoints" horizontal="x" vertical="y" h-options="hOptions" v-options="vOptions" h-values="hValues" v-values="vValues"/>'),w={x:[],y:[]};return m=c.extend("RangeSelection",{init:function(a,b){this._super(a,b),this._shapes=null,this.setActiveMode("item")},initComponent:function(a){this.previousComponent=this.activeComponent,this.activeComponent=this.getComponent(a.x,a.y)},refreshContainer:function(){var a=this.components.dataArea[0].rect,b=[];["x","y"].forEach(function(a){this.components[a]&&!this.components[a].contains(this.activeComponent)&&(b=b.concat(this.components[a]))}.bind(this)),this.activeComponent&&b.push(this.activeComponent),b.forEach(function(b){a=a.combineWith(b.rect)},this),u=a,s.css({left:a.x,top:a.y,width:a.width,height:a.height})},resetSelectedShapes:function(){this._previousSelectedShapes=this._selectedShapes.concat(),this._super()},getRect:function(a,b){return a?(b=b||!1,a.hasOwnProperty("innerRect")&&!b?a.innerRect:a.rect):new e(0,0,0,0)},getExtendedRect:function(a){return a?a.hasOwnProperty("extendedRect")?a.extendedRect:this.getRect(a):new e(0,0,0,0)},getTransformedPoint:function(a,b){var c=this.getRect(this.activeComponent||this.components.dataArea[0],!0);return new d(a-c.x-this.handler.containerRect.x,b-c.y-this.handler.containerRect.y)},getComponent:function(a,b){var c=new d(a-this.handler.containerRect.x,b-this.handler.containerRect.y);return Object.keys(this.components).map(function(a){return this.components[a]},this).reduce(function(a,b){return a.concat(b)}).filter(function(a){return this.getExtendedRect(a).pointInside(c.x,c.y)},this)[0]},checkActiveMode:function(a,b){a.contains(this.handler.getActiveMode())||this.clearSelection(b),this.setActiveMode(a[0])},toggleRect:function(a,b,c){this.start(a,b),this.update(a,c),this.end(a)},toggle:function(a,b,c){if(c=void 0!==c?c:this.handler.getKeyAsToggleSelected(a),
c||this.clearSelection(),this.resetSelectedShapes(),this.cancel(),!this.activeComponent||!this.activeComponent.isDiscrete())return!1;var d=this.getTransformedPoint(b.x,b.y),e=this.shapesFromPoints([d]),f=this.options.toggle.callback||this.toggleSelection,g=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return e=this.groupedItemsFromShapes(e),e.forEach(function(a){a.selectionMode="dataArea"}),this.checkActiveMode(["item"]),f.call(this,e,g),e&&e.length>0},start:function(a,b){if(this.handler._disableSelections)return!0;var c,d,e,f;if(this.resetSelectedShapes(),this.refreshContainer(),this.activeComponent.isDiscrete?this.checkActiveMode(["range.dimension","item"],!0):this.checkActiveMode(["range.measure"]),c=this.getComponentKey(this.previousComponent),d=this.getComponentKey(this.activeComponent),c&&c!==d&&this.previousComponent&&this.previousComponent!==this.activeComponent&&!h.call(this)&&c in this.components&&(n[c]=!1,f=j(c),f.rect.set(0,0,0,0)),this.handler.container[0].appendChild(t),!this._rangeEventWatchers){var g=this;this._rangeEventWatchers=[],this._rangeEventWatchers.push(n.$on("rangeStart",function(){g.resetSelectedShapes(),g._shapes=g._previousShapes,g._clearPrev=!0})),this._rangeEventWatchers.push(n.$on("rangeUpdate",function(a,b,c){o=b[0],g.components[c].indexOf(g.activeComponent)<0&&(g.activeComponent=g.components[c][0]),l.call(g,b[1]),g._clearPrev=!1})),this._rangeEventWatchers.push(n.$on("rangeEnd",function(){g.end(),g._clearPrev=!1}))}o=this.getTransformedPoint(b.x,b.y),n[d]=!0,e=this.getRect(this.activeComponent),"y"===d?(n.vOptions={rect:e.clone(),containerRect:u,padding:this.activeComponent.getPadding(),dock:this.activeComponent.dock},n.vHandlePoints=[o,o]):(n.hOptions={rect:e.clone(),containerRect:u,padding:this.activeComponent.getPadding(),dock:this.activeComponent.dock},n.hHandlePoints=[o,o]),s.show()},update:function(a,b){return this.handler._disableSelections?!0:void l.call(this,this.getTransformedPoint(b.x,b.y))},updateShapesState:function(){var a=this.getComponentKey(this.activeComponent),b=j(a),c=this.ToggleFlag.select,d=[],e=this.toggleSelection;this.clearSelection(!0),this.setActiveMode("range.measure"),this.activeComponent.isDiscrete&&!this.activeComponent.isDiscrete()&&(d=this.shapesFromRange(b.startVal,b.updateVal),d.forEach(function(a){a.selectionMode="range.measure"}),e.call(this,d,c)),this._shapes=d},end:function(a){return this.handler._disableSelections?!0:(this.selectRange(a),this._previousShapes=this._shapes,void(this._shapes=null))},cancel:function(){return this.handler._disableSelections?!0:("range.dimension"===this.getActiveMode()&&this.setActiveMode("item"),this._shapes=null,void i.call(this))},clearSelection:function(a){a=a||!1,this._shapes=null,a?this._super():(this._super(),i.call(this)),this.setActiveMode("item")},selectRange:function(){var a,b=this.handler.SelectRange,c=this.getComponentKey(this.activeComponent),d=[],e=!1;if(this.activeComponent){if("dimension"===this.activeComponent.getType().type){var f=this._previousSelectedShapes,g=this.getSelectedShapes().concat();return f.forEach(function(a){var b=g.indexOf(a);-1===b&&g.push(a)}),void(g.length>0&&this.handler.Select.emit(g))}if(h.call(this))Object.keys(w).filter(function(a){return w[a][0]&&void 0!==w[a][0].startVal&&void 0!==w[a][0].updateVal}).forEach(function(b){var c=this.components[b][0].getType().current[0];a=w[b][0],d.push({measure:c,range:{min:Math.min(a.startVal,a.updateVal),max:Math.max(a.startVal,a.updateVal)}})},this);else{if(a=w[c][0],!a)return;this.activeComponent.getType().current.forEach(function(b){d.push({measure:b,range:{min:Math.min(a.startVal,a.updateVal),max:Math.max(a.startVal,a.updateVal)}})}),e=!0}d.length&&b.emit(d,e)}},on:function(){if(!p){var a=b.getService("$compile"),c=b.getService("$rootScope");n=c.$new(),t.className="selections-range-ui",s.append(v),s.hide(),a(t)(n),p=!0}n.$broadcast("on")},off:function(){this.activeComponent&&(n.$broadcast("off"),this.activeComponent=null)}}),m.defaultOptions={toggle:{callback:null}},m}),define("objects.views/selections/types/dom-base",["./base","objects.utils/shapes/rect"],function(a,b){"use strict";function c(a,b){var c,d,e=b[0],f=!1;for(c=0;c<a.length;c++)d=a[c],d.startVal===e.startVal&&d.updateVal===e.updateVal&&(a.splice(c,2),c--,f=!0);return f||(a=a.concat(b)),a}var d;return d=a.extend({init:function(a,b){this._super(a,b),this.internal=!0},release:function(){},initComponent:function(a){this.activeComponent=this.getComponent(a.x,a.y)},getRect:function(a){return a?a.hasOwnProperty("innerRect")?a.innerRect:a.rect:new b(0,0,0,0)},setComponent:function(a,b){this._super(a,b),b.selections=this},addComponent:function(a,b){this._super(a,b),b.selections=this},removeComponent:function(a,b){this._super(a,b),b.selections=null,b.off()},updateFromItems:function(a,b){var c=this.handler,d=this;if(c._isLocked)return void c.SelectWhileLocked.emit();if(this.setActiveMode("item"),c.activate(this),b=b.filter(function(a){return d._allowNullSelect||!d._isNull(a)}),b.length){var e=this.options.toggle.callback||this.toggleSelection;e.call(this,b),c.Select.emit(this.getSelectedShapes(),c.getKeyAsToggleSelected(a))}},rangeStart:function(){var a=this.handler;return a._isLocked?void a.SelectWhileLocked.emit():(this.setActiveMode("range.measure"),a.activate(this),void this.resetSelectedShapes())},rangeUpdate:function(a,b){var d=this.handler;if(d._isLocked)return void d.SelectWhileLocked.emit();var e,f=this.options.toggle.callback||this.toggleSelection,g=[],h=this.ToggleFlag.select;for(this.clearSelection(!0),this._rangeObjects&&b&&(a=c(this._rangeObjects,a)),e=0;e<a.length;e++){var i=a[e];g=g.concat(this.shapesFromRange(i.startVal,i.updateVal,!0,i.isMax))}g.forEach(function(a){a.selectionMode="range.measure"}),f.call(this,g,h),this._rangeObjects=a,this._shapes=g},rangeEnd:function(){this.selectRange(),this._shapes=null},toggle:function(){},cancel:function(){this._rangeObjects=null,this.activeComponent.cancelSelection()},clearSelection:function(a){this._super(),a||this.activeComponent.clearSelection()},selectRange:function(){var a,b,c=this.handler.SelectRange,d=[];if(this._rangeObjects){for(a=0;a<this._rangeObjects.length;a++)b=this._rangeObjects[a],d.push({measure:0,range:{min:Math.min(b.startVal,b.updateVal),max:Math.max(b.startVal,b.updateVal)}});c.emit(d,!0)}}}),d.defaultOptions={},d}),define("objects.views/selections/types/color-legend",["./dom-base"],function(a){"use strict";var b;return b=a.extend({}),b.defaultOptions={captureInput:!0,toggle:{callback:null}},b}),define("general.utils/support",["touche"],function(a){"use strict";function b(){return!a.utils.msPointer||0!==window.navigator.msMaxTouchPoints&&0!==window.navigator.maxTouchPoints?a.utils.msPointer&&(window.navigator.msMaxTouchPoints>0||window.navigator.maxTouchPoints>0)?!1:!a.utils.touch:!0}function c(b){return a.utils.isMouse(b)}return{treatAsDesktop:b,isMouse:c}}),define("general.utils/arrow-positioner",[],function(){"use strict";function a(a){var b={left:"right",right:"left",top:"bottom",bottom:"top"};return b[a]}function b(b,c,d,e){var f,g,h=a(d),i={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},j=i[h],k=b.outerWidth(),l=b.outerHeight(),m=e.outerWidth(),n=e.outerHeight();"left"===h||"right"===h?(f=j.width*(k-n),g=c.offset().top+c.outerHeight()*(1-j.height)-b.offset().top-m*(1-j.height)):(f=c.offset().left+c.outerWidth()*(1-j.width)-b.offset().left-m*(1-j.width),g=j.height*(l-n)),e.css({left:parseInt(f,10),top:parseInt(g,10)})}function c(b,c,d,f,g){var h,i,j=a(f),k={left:{width:0,height:.5,size:-1.5},right:{width:1,height:.5,size:.5},top:{width:.5,height:0,size:-1},bottom:{width:.5,height:1,size:1}},l=k[j],m=b.outerWidth(),n=b.outerHeight(),o=g.outerWidth(),p=g.outerHeight();"left"===j||"right"===j?(h=l.width*(m-p)+p*l.size,i=d-b.offset().top-p*(1-l.height)):(h=c-b.offset().left-o*(1-l.width),i=l.height*(n-p)+p*l.size),g.css({left:e(h),top:e(i)})}function d(b,c,d){var e,f,g=a(c),h={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}},i=h[g],j=b.outerWidth(),k=b.outerHeight(),l=d.outerWidth(),m=d.outerHeight();"left"===g||"right"===g?(e=i.width*(j-m),f=d.offset().top-l*(1-i.height)):(e=j*(1-i.width)-l*(1-i.width),f=i.height*(k-m)+m),d.css({left:e,top:f})}var e=Math.floor;return{align:b,alignToParent:d,alignToCoordinate:c}}),define("general.utils/window-positioner",["jquery","objects.utils/shapes/rect"],function(a,b){"use strict";function c(c,d){var e,f,g=a("body").outerHeight();return e=d.y+d.height/2-c.height/2,e=0>e?0:e,g-e-c.height<0&&(e=g-c.height),f=d.x+d.width,new b(f,e,c.width,c.height)}function d(c,d){var e,f,g=a("body").outerWidth();return f=d.x+d.width/2-c.width/2,f=0>f?0:f,g-f-c.width<0&&(f=g-c.width),e=d.y+d.height,new b(f,e,c.width,c.height)}function e(c,d){var e,f,g=a("body").outerHeight();return e=d.y+d.height/2-c.height/2,e=0>e?0:e,g-e-c.height<0&&(e=g-c.height),f=d.x-c.width,new b(f,e,c.width,c.height)}function f(c,d){var e,f,g=a("body").outerWidth();return f=d.x+d.width/2-c.width/2,f=0>f?0:f,g-f-c.width<0&&(f=g-c.width),e=d.y-c.height,new b(f,e,c.width,c.height)}function g(a){var c=a[0]===window?{left:0,top:0}:a.offset();return new b(c.left,c.top,a.outerWidth(),a.outerHeight())}function h(a,b,g){var h,i={top:f,right:c,bottom:d,left:e};return h=i[g]||c,h.call({},a,b)}function i(a){var b="bottom,bottomLeft,bottomRight,centerLeft,center,centerRight,topLeft,top,topRight,topLeft,left,right".split(",");if(-1===b.indexOf(a))throw new Error("Not a valid docking position. Try "+b.join(" ,")+".")}function j(a,b,c){return"right"===a?b.getRight()-c.getRight():"left"===a?c.x-b.x:"top"===a?c.y-b.y:"bottom"===a?b.getBottom()-c.getBottom():0}function k(a){var b={top:"bottom",right:"left",bottom:"top",left:"right"};return b[a]}function l(a){return"flip"===a||"flipfit"===a}function m(a){return"fit"===a||"flipfit"===a}function n(a){var b={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"};return b[a]}function o(a){var b={vertical:["top","bottom"],horizontal:["left","right"]};return b[a]}function p(a){var b={horizontal:"vertical",vertical:"horizontal"};return b[a]}function q(a){var b=a.collision.split(" "),c={horizontal:b[0],vertical:b[1]||b[0]},d=n(a.position),e=p(d);return{flipPrimary:l(c[d]),fitPrimary:m(c[d]),fitSecondary:m(c[e])}}function r(a,b,c){var d,e;for(d=0;d<b.length;d++){if(e=b[d],"left"===e&&a.x<c.x){a.x=c.x;break}if("right"===e&&a.getRight()>c.getRight()){a.x=c.getRight()-a.width;break}if("top"===e&&a.y<window.y){a.y=window.y;break}if("bottom"===e&&a.getBottom()>c.getBottom()){a.y=c.getBottom()-a.height;break}}return a}function s(a,b,c,d,e,f){if(!c)return a.map(function(a,c){return{align:a,x:b[c].x,y:b[c].y}});var g=b[0].x,h=b[0].y,i=function(a){var b,c,f,i,j=a?a.length/2:0,k=new Array(j);for(b=0;j>b;b++)c=a[2*b+1],f=c*g+(1-c)*d,i=c*h+(1-c)*e,k[b]={align:a[2*b],x:f,y:i};return k},j=a[0]+(a[1]?"-"+a[1]:""),k=1,l=.7,m=.5,n=f>.5?0:.5-f,o=f>.5?.5:.7-.4*f;switch(j){case"top":return i(g>=d?["top",k,"top",l,"top",m,"right",l,"right",m,"left",m,"left",l,"bottom",n,"bottom",o]:["top",k,"top",l,"top",m,"left",l,"left",m,"right",m,"right",l,"bottom",n,"bottom",o]);case"top-right":return i(["top",k,"top",l,"top",m,"right",l,"right",m,"left",m,"left",l,"bottom",n,"bottom",o]);case"top-left":return i(["top",k,"top",l,"top",m,"left",l,"left",m,"right",m,"right",l,"bottom",n,"bottom",o]);case"bottom":return i(g>=d?["bottom",k,"bottom",l,"bottom",m,"right",l,"right",m,"left",m,"left",l,"top",n,"top",o]:["bottom",k,"bottom",l,"bottom",m,"left",l,"left",m,"right",m,"right",l,"top",n,"top",o]);case"bottom-right":return i(["bottom",k,"bottom",l,"bottom",m,"right",l,"right",m,"left",m,"left",l,"top",n,"top",o]);case"bottom-left":return i(["bottom",k,"bottom",l,"bottom",m,"left",l,"left",m,"right",m,"right",l,"top",n,"top",o]);case"left":return i(e>=h?["left",k,"left",l,"left",m,"top",l,"top",m,"bottom",m,"bottom",l,"right",m,"right",l]:["left",k,"left",l,"left",m,"bottom",l,"bottom",m,"top",m,"top",l,"right",m,"right",l]);case"left-top":return i(["left",k,"left",l,"left",m,"top",l,"top",m,"bottom",m,"bottom",l,"right",m,"right",l]);case"left-bottom":return i(["left",k,"left",l,"left",m,"bottom",l,"bottom",m,"top",m,"top",l,"right",m,"right",l]);case"right":return i(e>=h?["right",k,"right",l,"right",m,"top",l,"top",m,"bottom",m,"bottom",l,"left",m,"left",l]:["right",k,"right",l,"right",m,"bottom",l,"bottom",m,"top",m,"top",l,"left",m,"left",l]);case"right-top":return i(["right",k,"right",l,"right",m,"top",l,"top",m,"bottom",m,"bottom",l,"left",m,"left",l]);case"right-bottom":return i(["right",k,"right",l,"right",m,"bottom",l,"bottom",m,"top",m,"top",l,"left",m,"left",l])}}var t={align:function(b,c,d){if(d=d||{position:"right",collision:"none"},d.position=d.position||"right",d.collision=d.collision||"none",b&&c){var e,f=g(a(window)),i=g(b),l=g(c),m=q(d),s=h(i,l,d.position);e=function(a){var b=h(i,l,k(d.position)),c=j(d.position,a,f),e=j(k(d.position),b,f);return c>e},m.flipPrimary&&j(d.position,s,f)>0&&e(s)&&(s=h(i,l,k(d.position)),d.position=k(d.position)),m.fitPrimary&&(s=r(s,[d.position],f)),m.fitSecondary&&(s=r(s,o(p(n(d.position))),f)),d.limits&&s.y<d.limits.top&&(s.y=d.limits.top),b.offset({top:s.y,left:s.x})}return d.position},alignToCoordinate:function(b,c,d,e,f){i(e);var g,h;e=e||"top",g=function(a,c,d){var e=c,f=d;switch(a){case"topRight":f=d-b.outerHeight();break;case"top":e=c-b.outerWidth()/2,f=d-b.outerHeight();break;case"topLeft":e=c-b.outerWidth(),f=d-b.outerHeight();break;case"right":case"centerRight":f=d-b.outerHeight()/2;break;case"center":e=c-b.outerWidth()/2,f=d-b.outerHeight()/2;break;case"left":case"centerLeft":e=c-b.outerWidth(),f=d-b.outerHeight()/2;break;case"bottom":e=c-b.outerWidth()/2;break;case"bottomLeft":e=c-b.outerWidth();break;case"bottomRight":e=c,f=d}return{x:e,y:f}},h=g(e,c,d);var j,k,l,m,n={},o={};j=a(window),k=10,o.x=j.outerWidth()-b.outerWidth()-k,n.x=k,o.y=j.outerHeight()-b.outerHeight()-k,n.y=k;var p=function(a,b){return b[a]>o[a]?b[a]-o[a]:b[a]<n[a]?n[a]-b[a]:0};if(f){l=p("x",h),m=p("y",h);var q=g(f,c,d);(l>p("x",q)||m>p("y",q))&&(h=q,e=f)}return h.x=Math.max(n.x,Math.min(o.x,h.x)),h.y=Math.max(n.y,Math.min(o.y,h.y)),b.offset({left:h.x,top:h.y}),e},alignToBestCoordinate:function(b,c,d,e,f,g,h){i(d[0]),c=c instanceof Array?c:[c];var j=c[0].x,k=c[0].y;b.offset({left:0,top:0}),b.width("auto"),b.height("auto");var l=a(window),m=l.outerWidth(),n=l.outerHeight(),o=b.outerWidth(),p=b.outerHeight(),q={},r={};h=void 0===h?5:h;var t=(void 0===g?5:g)+h;r.x=m-o-t,q.x=h,r.y=n-p-t,q.y=h,o+2*t>m&&(o=m-2*t,b.width(o),r.x=q.x),p+2*t>n&&(p=n-2*t,b.height(p),r.y=q.y),d=d||["top"];var u,v,w,x,y,z,A,B,C,D,E,F=function(a,b,c){var d=b,e=c;switch(a){case"topRight":e=c-p;break;case"top":d=b-o/2,e=c-p;break;case"topLeft":d=b-o,e=c-p;break;case"right":case"centerRight":e=c-p/2;break;case"center":d=b-o/2,e=c-p/2;break;case"left":case"centerLeft":d=b-o,e=c-p/2;break;case"bottom":d=b-o/2;break;case"bottomLeft":d=b-o;break;case"bottomRight":d=b,e=c}return{x:d,y:e}},G=function(a,b){return b[a]>r[a]?b[a]-r[a]:b[a]<q[a]?b[a]-q[a]:0},H=j,I=k;f&&(x=e.shape.cx+e.targetToPageTranslation.x,y=e.shape.cy+e.targetToPageTranslation.y,z=e.shape.innerRadius,A=e.shape.radius,B=0,z>0&&(B=z/A,x+=B*(j-x),y+=B*(k-y))),E=s(d,c,f,x,y,B);var J=function(){for(u=0;u<E.length;u++)if(v=E[u].align,H=E[u].x,I=E[u].y,w=F(v,H,I),C=G("x",w),D=G("y",w),(0!==C||0!==D)&&(0!==D||"top"!==v&&"bottom"!==v?0!==C||"left"!==v&&"right"!==v||(w.y-=D,D=0):(w.x-=C,C=0)),0===C&&0===D)return};return J(),w&&b.offset({left:w.x,top:w.y}),{position:v,x:H,y:I}}};return t}),define("text!objects.views/charts/tooltip/chart-tooltip.ng.html",[],function(){return'<div ng-switch on="template">\r\n	<div ng-switch-when="generic" class="qv-tooltip qvt-generic-tooltip">\r\n		<div ng-repeat="item in content">\r\n			<div class="header">\r\n				<strong>{{item.header}}</strong>\r\n			</div>\r\n			<table>\r\n				<tr ng-repeat="row in item.rows" class="row">\r\n					<td class=\'item\'>\r\n						<div class="rowContent fade-out">{{row.content}}</div>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</div>\r\n\r\n    <div ng-switch-default class="qv-tooltip qvt-chart-tooltip" qva-press="onTap($event)" tid="qv-chart-tooltip">\r\n        <div class="immidiate-contextual-arrow"></div>\r\n		<div class="qv-chart-tooltip-inner">\r\n			<div ng-repeat="item in content">\r\n				<div class="qv-chart-tooltip-content">\r\n					<div class=\'header\'>\r\n						<strong>{{item.header}}</strong>\r\n					</div>\r\n					<table>\r\n						<tr ng-repeat="row in item.rows" class="row">\r\n							<td class=\'item\'>\r\n								<div class="rowPart">{{row.label + \':&nbsp;\'}}</div>\r\n							</td>\r\n							<td class=\'value\'>\r\n								<div class="rowPart">{{row.value}}</div>\r\n							</td>\r\n						</tr>\r\n					</table>\r\n				</div>\r\n			</div>\r\n		</div>\r\n        <div class="qv-chart-tooltip-excess" ng-if="numberInExcess > 0" q-translation="Object.ChartTooltip.NMore,{{numberInExcess}}"></div>\r\n	</div>\r\n</div>'}),define("objects.views/charts/tooltip/chart-tooltip-directive",["touche","qvangular","general.utils/arrow-positioner","general.utils/window-positioner","text!./chart-tooltip.ng.html"],function(a,b,c,d,e){var f=5,g=5;b.directive("qvaChartTooltip",function(){return{template:e,replace:!0,scope:{content:"=",position:"=",visible:"=",direction:"=",template:"=",numberInExcess:"=",target:"="},link:function(e,h){var i,j,k=!1;i=function(a){var b=a?"block":"none";h.css("display",b)},e.synchronAlign=function(){var a,b=h.find(".qv-tooltip"),j=h.find(".immidiate-contextual-arrow");i(e.visible);var l=e.direction instanceof Array?e.direction:[e.direction];a=d.alignToBestCoordinate(b,e.position,l,e.target,!1,f,g);var m=b.offset();switch(a.position){case"right":m.left+=9;break;case"left":m.left-=9;break;case"bottom":m.top+=9;break;default:m.top-=9}b.offset(m),j.removeClass().addClass("immidiate-contextual-arrow").addClass(a.position),c.alignToCoordinate(b,a.x,a.y,a.position,j),k=!1},e.align=function(){j=b.getService("$timeout")(e.synchronAlign)},e.$watch("position",function(a){a&&(a instanceof Array||a.x&&a.y)&&(k=!0,e.align())}),e.$watch("visible",function(a){k||i(a)}),e.$watch("content",function(a){a||(e.visible=!1)}),e.onTap=function(b){e.visible=!1,b.stopPropagation(),b.preventDefault(),a.preventGestures()},e.$on("$destroy",function(){b.getService("$timeout").cancel(j)})}}})}),define("objects.views/charts/tooltip/chart-tooltip-component",["./chart-tooltip-directive"],function(){var a;return a={transclude:!0,template:'<div qva-chart-tooltip position="position" content="content" direction="direction" visible="visible" template="template" number-in-excess="numberInExcess" target="target"></div>',controller:["$scope",function(a){a.visible=!1,this.hide=function(){a.visible=!1},this.show=function(b){a.content=b.content,a.position=b.position,a.direction=b.direction,a.template=b.template,a.numberInExcess=b.numberInExcess,a.visible=!0,a.target=b.target}}]}}),define("objects.views/charts/tooltip/chart-tooltip-service",["qvangular","core.utils/notification","./chart-tooltip-component","angular"],function(a,b,c){"use strict";a.service("qvChartTooltipService",["$document",function(a){var d,e,f=a.find("body"),g=angular.element("<div>").appendTo(f);return d={open:function(a){if(!e){var b=a.position;a.position=void 0,e=g.showComponent(c,a),a.position=b}e.show(a)},close:function(){this.Closed.emit(),e&&e.hide()}},b.create(d,"Closed"),d}])}),define("objects.views/selections/types/tooltip",["jquery","./base","qvangular","general.utils/support","objects.utils/shapes/rect","objects.views/charts/tooltip/chart-tooltip-service"],function(a,b,c,d,e){"use strict";function f(a){var b=a.getBoundingRect();return isNaN(b.x+b.y+b.width+b.height)}function g(a){return a.getDimensions().join(", ")}function h(a,b,c){return{positions:[b(a.x+a.width/2,a.y,c),b(a.x+a.width,a.y+a.height/2,c),b(a.x,a.y+a.height/2,c),b(a.x+a.width/2,a.y+a.height,c)],directions:["top","right","left","bottom"]}}function i(a,b){var d,e,i,k,l,m,n,o,p=[],q=null,r=a[0];if(this._positionAtMouse)d=b||r.interactPosition,e=this.getTransformedPoint(d.x,d.y),k=r.getShapes(),p=k.filter(function(a){return a.pointInside(e.x,e.y)}),m=p.length?p[0]:k[0],n=["top","right","left","bottom"],o=[d,d,d,d];else if(r.calculateTooltipPosition&&r.tooltipShape)i=r.getShapeBounds(r.tooltipShapeComponent),i&&(q=this.components[r.tooltipShapeComponent]?this.components[r.tooltipShapeComponent][0]:void 0,s=h(i,this.getPagePoint.bind(this),q),o=s.positions,n=s.directions);else{k=r.getShapes(),r.tooltipShape&&!f(r.tooltipShape)?(p=[r.tooltipShape],q=this.components[r.tooltipShapeComponent]?this.components[r.tooltipShapeComponent][0]:void 0):b&&(e=this.getTransformedPoint(b.x,b.y),p=k.filter(function(a){return a.pointInside(e.x,e.y)})),m=p.length?p[0]:k[0];var s;m.getRelevantPosition?(i=m.getRelevantPosition(),i.pos&&(d=this.getPagePoint(i.pos.x,i.pos.y,q),o=[d,d,d,d]),n=i.direction):(i=m.getBoundingRect(),s=h(i,this.getPagePoint.bind(this),q),o=s.positions,n=s.directions)}l=[];for(var t=0,u=0,v=0,w=this.getPagePoint(0,0,q);B>t&&u<a.length;)l.push({header:g(a[u]),rows:j.apply(this,[a[u],m])}),t+=l[u].rows.length+1,u++;a.length>u&&(v=a.length-u),(d||o)&&(c.getService("qvChartTooltipService").open({target:{shape:m,targetToPageTranslation:w},position:o||[d],content:l,direction:n,numberInExcess:v}),x=r,y=a.map(function(a){return a.id}).join(""))}function j(a,b){var c,d,e,f,g,h,i=[],j=0,k=this.measureFormatters||[];if(a.isCacheItem)for(g=a.getMeasures(),h=a.getMeasuresIndecies(b),d=h.length,j;d>j;++j){var l=h[j];e=a.getValue(l),f=a.getPreformattedLabel(l),k[h[j]]&&(e="U"!==k[l].type&&f?f:k[l].format(e)),g[l]&&void 0!==e&&i.push({label:g[l],value:e})}else for(d=a.node.children.length,j;d>j;++j)e=a.node.children[j].children[0].data.qNum||a.node.children[j].children[0].data.qValue,f=a.node.children[j].children[0].data.qText,k[j]&&(e="U"!==k[j].type&&f?f:k[j].format(e)),i.push({label:a.node.children[j].data.qText,value:e});return this.colorMap&&(c=this.colorMap.getTooltipContent(a.getCombinedElementID?a.getCombinedElementID():a.id),c&&i.push(c)),i}function k(a){var b=this.getTransformedPoint(a.x,a.y);return this.shapesFromPoints([b])}function l(a){var b=k.call(this,a);return b.map(function(a){return a.id}).join("")}function m(a){var b=this;this.activeComponent=this.getComponent(a.x,a.y),this.tooltipComponentId=z=this.activeComponent.id;var d=k.call(b,a);p(),d&&d.length&&(b._positionAtMouse="MapArea"===b.activeComponent.className,v=c.getService("$timeout")(function(){o(),i.call(b,d,a),v=null},500))}function n(a,b){var d=this;this.tooltipComponentId=z=this.activeComponent.id,v=c.getService("$timeout")(function(){a&&a.length&&(d._positionAtMouse="MapArea"===d.activeComponent.className,i.call(d,a)),v=null},b)}function o(){w=c.getService("$timeout")(function(){r()},7e3)}function p(){c.getService("$timeout").cancel(w),w=null}function q(){this.tooltipComponentId===z&&(c.getService("$timeout").cancel(v),v=null,this.prevPoint=null)}function r(){x&&(x=null,y=null,c.getService("$timeout")(function(){c.getService("qvChartTooltipService").close()})),v=null,p()}function s(a,b){var c,d,e=b?b.length:0;for(c=0;e>c;c++)if(d=b[c],d&&d.pointInside&&d.pointInside(a.x,a.y))return!0;return!1}function t(a){var b,c,d,e=a?a.length:0,f=[];for(b=0;e>b;b++)c=a[b]._shapes,d||(d=a[b]._interactPosition,d&&(d=this.getTransformedPoint(d.x,d.y))),d&&s(d,c)&&(f[f.length]=a[b]);return f.length||f.push(a),f}var u,v,w,x,y,z,A=!0,B=7;return u=b.extend("ChartTooltip",{init:function(a,b){this._super(a,b),x=null,this._positionAtMouse=!1,v=null,this.name="tooltip",A=!d.treatAsDesktop(),A&&a.ToggleTooltip.bind(this.updateHighlightedShape.bind(this)),this.enabled=!0,this._allowNullSelect=!0,this.touchTimeout=b.touchTimeout},initComponent:function(a){this.activeComponent=this.getComponent(a.x,a.y)},updateHighlightedShape:function(a,b){if(a.length>=1){var c;if(c=t.call(this,a),!c||!c.length)return;A&&(c=c.filter(function(a){return b?!0:a.selected}),c&&c.length?x||v?(c.length>1||c[0]!==x)&&(q.call(this),p(),r.call(this),n.call(this,c,this.touchTimeout)):n.call(this,c,this.touchTimeout):(q.call(this),p(),r.call(this)))}},getRect:function(a){return a?a.hasOwnProperty("innerRect")?a.innerRect:a.rect:new e(0,0,0,0)},move:function(a,b){!A&&this.enabled&&(null!==v?(!this.prevPoint||b.distanceTo(this.prevPoint)>5)&&(q.call(this),m.call(this,b)):(this.prevPoint=b,x?l.call(this,b)!==y?(r.call(this),m.call(this,b)):(p(),o()):m.call(this,b)))},leave:function(b){var c=b.toElement||b.relatedTarget;a(c).hasClass("qvt-chart-tooltip")||a(c).parents(".qvt-chart-tooltip").length||(q.call(this),r.call(this))},cancel:function(){q.call(this),r.call(this)},clearSelection:function(){q.call(this),r.call(this)}}),u.defaultOptions={},u}),define("objects.views/selections/handler",["jquery","core.utils/notification","client.utils/state","core.utils/class","./types/data-area","./types/range-angular","./types/color-legend","./types/tooltip","objects.utils/shapes/rect","objects.utils/shapes/point","general.utils/support"],function(a,b,c,d,e,f,g,h,i,j,k){function l(b){Object.keys(b).forEach(function(c){c in s&&(this.types[c]=new s[c](this,a.extend(!0,{},s[c].defaultOptions,b[c])))},this)}function m(a,b){var c;for(c=0;c<b.length;c++)if(a.contains(b[c]))return!0;for(c=0;c<a.length;c++)if(b.contains(a[c]))return!0;return!1}var n,o,p=a(document),q=0,r=function(){return".selections-"+ ++q},s={dataArea:e,range:f,colorLegend:g,tooltip:h};return n=d.extend({init:function(c,d,e){b.mixin(this),this.notification("Activated"),this.notification("Deactivated"),this.notification("ToggleShape"),this.notification("ToggleShapes"),this.notification("ToggleTooltip"),this.notification("SelectWhileLocked"),this.notification("Pan"),this.notification("Lasso"),this.notification("Confirm"),this.notification("Cancel"),this.notification("Select"),this.notification("SelectRange"),this.notification("Clear"),this.notification("ResetSelections"),this._active=!1,this._autoActivated=!1,this._isListening=!1,this._isScrolling=!1,this._isLocked=!1,this._shiftPressed=!1,this._lassoEnabled=!1,this.container=c,this.options=a.extend(!0,{},{getSelectionType:function(a,b){var c=this.containerRect,d=b||!1,e=new j(a.x-c.x,a.y-c.y);return Object.keys(this.types).map(function(a){return this.types[a]},this).filter(function(a){return Object.keys(a.components).map(function(b){return a.components[b]}).filter(function(b){return b.filter(function(b){var f=a.getExtendedRect?a.getExtendedRect(b):a.getRect(b);return f===c&&(e.x+=c.x,e.y+=c.y),d?"tooltip"===a.name&&("function"==typeof b.isVisible?b.isVisible():!0)&&f.pointInside(e.x,e.y):"tooltip"!==a.name?("function"==typeof b.isVisible?b.isVisible():!0)&&f.pointInside(e.x,e.y):void 0}).length>0})[0]},this)[0]},toggle:!0,toggleRect:!0,swipe:!0,autoSwipe:!1,ctrlKeyAsToggleSelected:!1},d),this.cache=e,this.containerRect=new i(0,0,0,0),this.eventNS=r(),this.types={},this._keyboard=!0,l.call(this,this.options)},setContainer:function(a){this.off(),this.container=a,this.on()},refreshContainerRect:function(){var a=this.offset=this.container.offset(),b=this.container.width(),c=this.container.height();this.containerRect.set(a.left,a.top,b,c)},on:function(){function a(a){o=a,n.refreshContainerRect(),i=q.getSelectionType.call(n,a),i&&i.initComponent(a),l=q.getSelectionType.call(n,a,!0),l&&l.initComponent(a)}function b(){if(n._activeType&&n._activeType!==i){var a=n._activeType.getActiveDimensions();n._activeType.cancel(),n._activeType.getActiveMode()===i.getActiveMode()&&m(a,i.getActiveDimensions())||(n._activeType.clearSelection(),n.ResetSelections.emit())}n._activeType=i,n._tooltipType=l=n.types.tooltip}function d(){b(),q._disableSelectionActivation||n.activate()}function e(){return(c.state===c.States.analysis||c.state===c.States.play)&&!n._isScrolling}function f(){return n._active&&!c.isInEditMode()}function g(){return i&&q.swipe&&e()}function h(a){return k.isMouse(a)}if(!this._isListening){this._isListening=!0;var i,l,n=this,q=this.options;this._reset=function(){i=null,l=null},this.getActiveType=function(){return n._activeType},this.getActiveTooltip=function(){return n._tooltipType},this.getActiveMode=function(){return n._activeType?n._activeType.getActiveMode():null},this._setTypeOnAutoActivate=function(){i=n.types.dataArea},this._activateType=function(a){i=a,b()},p.off(n.eventNS),p.on("mouseup"+n.eventNS,function(a){1===a.which&&!n._shiftPressed&&n._drawingLassoWithShift&&n.Lasso.emit(!1)}),p.on("keydown"+n.eventNS,function(a){n._keyboard&&16===a.which&&(!n._shiftPressed&&n._active&&n.Lasso.emit(!n._lassoEnabled),n._shiftPressed=!0)}),p.on("keyup"+n.eventNS,function(a){n._keyboard&&(16===a.which&&(n._shiftPressed&&n._active&&!n._drawingLassoWithShift&&n.Lasso.emit(n._lassoEnabled),n._shiftPressed=!1),f()&&(27===a.which?n.cancel():13===a.which&&n.confirm()))}),this._onMouseMove=function(a){var b=new j(a.pageX,a.pageY),c=l;n.refreshContainerRect(),l=q.getSelectionType.call(n,b,!0),c&&c!==l&&c.cancel(),l&&(l.move.call(l,a,b),n._tooltipType=l)},this._onMouseLeave=function(a){l&&l.leave(a)},this.types.tooltip&&k.treatAsDesktop()&&(this.container.on("mousemove",this._onMouseMove),this.container.on("mouseleave",this._onMouseLeave),p.on("mouseleave"+n.eventNS,this._onMouseLeave)),this.types.range&&this.types.range.on&&this.types.range.on();var r=!1;Touche(this.container[0]).tap({id:this.eventNS,options:{preventDefault:q.swipe},start:function(b,c){e()&&(q.autoSwipe&&h(b)&&(q.swipe=!0),a(c.pagePoints[0]))},end:function(a,b){if(e()&&i&&!i.internal&&q.toggle){if(n._isLocked)return void n.SelectWhileLocked.emit();d(),Touche.preventGestures(this.gestureHandler),i.toggle.call(i,a,b.pagePoints[0]),"range"===i.getActiveMode()?i.selectRange():i.getSelectedShapes().length>0&&n.Select.emit(i.getSelectedShapes(),n.getKeyAsToggleSelected(a))}}}).tap({id:this.eventNS,options:{touches:2,preventDefault:q.swipe},end:function(b,c){return e()&&q.toggleRect&&(a(c.pagePoints[0]),i&&q.toggle)?(d(),n._isLocked?void n.SelectWhileLocked.emit():void i.toggleRect.call(i,b,c.pagePoints[0],c.pagePoints[1])):void 0}}).swipe({id:this.eventNS,options:{preventDefault:q.swipe,useMomentum:!0,inertia:.5,radiusThreshold:6},start:function(a,b){if((g()||q._enablePanning)&&(this.options.useMomentum=!0,l&&l.cancel(),n._shiftPressed&&!n._active&&n.Lasso.emit(!n._lassoEnabled),i)){if(!n._lassoEnabled&&i.activeComponent&&"dataArea"===i.activeComponent.selectionIdentifier)return n.Pan.emit("start",a,b),void(this._isPanning=!0);if(n._lassoEnabled||!i.activeComponent||"colorLegend"!==i.activeComponent.selectionIdentifier)return r=!0,n._isLocked?void n.SelectWhileLocked.emit():(d(),n._drawingLassoWithShift=n._shiftPressed,this.options.useMomentum=!1,i.start.call(i,a,o),void 0)}},update:function(a,b){if(g()||q._enablePanning)if(this._isPanning)n.Pan.emit("update",a,b);else if(r&&i){if(n._isLocked)return void n.SelectWhileLocked.emit();i.update.call(i,a,b.pagePoints[0])}},end:function(a,b){if(g()||q._enablePanning)if(this._isPanning)n.Pan.emit("end",a,b),this._isPanning=!1;else if(r&&i){if(r=!1,n._isLocked)return void n.SelectWhileLocked.emit();n._drawingLassoWithShift=!1,i.end.call(i,a,b)}},cancel:function(){i&&r&&(i.cancel.call(i,!0),l&&l.cancel.call(l,!0))}})}},off:function(){this.container.off(this.eventNS),this.container.off("mousemove",this._onMouseMove),this.container.off("mouseleave",this._onMouseLeave),Touche(this.container[0]).off("*",this.eventNS),p.off(this.eventNS),this.types.range&&this.types.range.off&&this.types.range.off(),this._isListening=!1},autoActivate:function(){!this._autoActivated&&this._isListening&&(this._autoActivated=!0,this._setTypeOnAutoActivate(),this._activeType=this.types.dataArea,this._activeType.initComponent(),this.activate())},activate:function(a){this._active||(this.Activated.emit(),this._active=!0),a&&this._activateType(a)},deactivate:function(a){
this._active&&(this._active=!1,this._autoActivated=!1,a||this.clearSelection(),this._activeType&&(this._activeType.cancel(),this._activeType=void 0),this._tooltipType&&(this._tooltipType.cancel(),this._tooltipType=void 0),this.Deactivated.emit(),this._reset())},confirm:function(){this._activeType&&this.deactivate(!0),this.Confirm.emit()},cancel:function(){this.deactivate(),this.Cancel.emit()},clearSelection:function(){this._activeType&&this._activeType.clearSelection(),this.types.tooltip&&this.types.tooltip.cancel()},toggleKeyboardAccelerators:function(a){this._keyboard=a},getKeyAsToggleSelected:function(a){return!(a.metaKey||a.ctrlKey)},release:function(){this.off(),b.release(this),Object.keys(this.types).forEach(function(a){this.types[a].release()},this)},toggleScrolling:function(a){a=a||!1,this._isScrolling=a},setLocked:function(a){this._isLocked=a},setLassoEnabled:function(a){this._lassoEnabled=a}})}),define("objects.views/selections/cache-item-base",["core.utils/class"],function(a){"use strict";function b(a){var b=a.getBoundingRect();return isNaN(b.x+b.y+b.width+b.height)}var c=a.extend({init:function(a,b,c,d,e,f,g){if(a&&!(a instanceof Array)||b&&!(b instanceof Array)||c&&!(b instanceof Array)||d&&!(c instanceof Array))throw"The dimensions, measures and values input must be undefined or arrays";this.selected=!1,this.highlighted=!1,this.values=c||[],this.labels=d||[],this.row=e,this.col=f,this.id=g,this.parent=void 0,this.children=[],this._dimensions=a||[],this._measures=b||[],this._objectShapes={},this._shapes=[],this._tooltipShape=void 0,this._tooltipShapeComponent=void 0},get siblings(){return this._parent?this._parent.children:[]},clearShapes:function(a){a&&this._objectShapes[a]&&(this._objectShapes[a]=[]),this._shapes=[];for(var b in this._objectShapes)this._shapes=this._shapes.concat(this._objectShapes[b])},getShapes:function(a){return a?this._objectShapes[a]||(this._objectShapes[a]=[]):this._shapes},getShapeBounds:function(a){if(this._calculateTooltipPosition&&a){var c=this.getShapes(a),d=c.map(function(a){return a.getBoundingRect()});if(d=d.filter(function(a){return!b(a)}),d.length){var e=d.reduce(function(a,b){return a.combineWith(b)},d[0]);return e}return null}return null},addShape:function(a,b,c){if(b instanceof Array&&(!b[0].pointInside||!b[0].getBoundingRect)||!b.pointInside||!b.getBoundingRect)throw"The shape must implement a `pointInside` function";this._objectShapes[a]instanceof Array||(this._objectShapes[a]=[]),this._objectShapes[a].push(b),this._shapes.push(b),c&&(this._tooltipShape=b,this._tooltipShapeComponent=a)},addMeasure:function(a,b,c){this.values.push(b),this.labels.push(c),this._measures.push(a)},getMeasures:function(){return this._measures},getMeasuresIndecies:function(){return this._measures.map(function(a,b){return b})},addDimension:function(a){this._dimensions.push(a)},getDimensions:function(){return this._dimensions},getValue:function(a){return a=a||0,this.values[a]},getPreformattedLabel:function(a){return a=a||0,this.labels[a]},getCombinedElementID:function(){for(var a=this,b=[a.id];a.parent;)a=a.parent,b.push(a.id);return b.reverse(),b.join(",")}});return c.prototype.isCacheItem=!0,Object.defineProperties(c.prototype,{tooltipShape:{get:function(){return this._tooltipShape}},calculateTooltipPosition:{set:function(a){this._calculateTooltipPosition=a},get:function(){return this._calculateTooltipPosition}},interactPosition:{set:function(a){this._interactPosition=a},get:function(){return this._interactPosition}},tooltipShapeComponent:{get:function(){return this._tooltipShapeComponent}},label:{get:function(){throw new Error("CacheItem: label: Removed functionality")}},shape:{get:function(){throw new Error("CacheItem: shape: Removed functionality")}},value:{get:function(){throw new Error("CacheItem: value: Removed functionality")}}}),c}),define("objects.views/selections/cache",["./cache-item","./cache-item-base"],function(a,b){"use strict";function c(){this.data=[]}return Object.defineProperties(c.prototype,{has:{value:function(a){return-1!==this.data.indexOf(a)}},add:{value:function(c){if(!(c instanceof a||c instanceof b))throw"Invalid cache item!";this.has(c)||this.data.push(c)}},remove:{value:function(a){var b=this.data.indexOf(a);-1!==b&&this.data.splice(b,1)}},clear:{value:function(){this.data.length=0}}}),c}),define("objects.extension/default-view-selection-service",["qvangular","objects.views/selections/handler","objects.views/selections/cache"],function(a,b,c){"use strict";a.service("qvDefaultViewSelectionService",[function(){return{createSelections:function(a,d,e){var f,g;if(e&&e.dataArea)return e.isPopover=a.options.isPopover,e.selectionsDisabled=a.options.selectionsDisabled||!1,f=new b(d,e,new c),f.Activated.bind(function(){a.selectionsApi.activated()}),f.Deactivated.bind(function(){a.selectionsApi.deactivateSearch&&a.selectionsApi.deactivateSearch()}),f.Cancel.bind(function(){a.selectionsApi.cancel()}),f.Select.bind(function(){a.selectionsApi.selectionsMade=!0}),f.SelectRange.bind(function(){a.selectionsApi.selectionsMade=!0}),f.Confirm.bind(function(){a.backendApi.endSelections(!0),a.selectionsApi.deactivated()}),f.ResetSelections.bind(function(){a.backendApi.clearSelections()}),a.selectionsApi.confirm=function(){f&&f.confirm()},g=a.selectionsApi.deactivated.bind(a.selectionsApi),a.selectionsApi.deactivated=function(){f&&f.deactivate(),g()},a.selectionsApi.deactivate=function(){f&&(f.deactivate(),this.deactivated())},a.selectionsApi.clear=function(){f.clearSelection(),a.backendApi.clearSelections(),a.selectionsApi.selectionsMade=!0},a.selectionsApi.toggleKeyboardAccelerators=function(a){f.toggleKeyboardAccelerators(a)},a.selectionsApi.getKeyAsToggleSelected=function(a){return f.getKeyAsToggleSelected(a)},a.selectionsApi.toggleSearch=function(){a.options.search.toggle()},a.selectionsApi.activate=function(){f.autoActivate()},a.selectionsApi.on=function(){f.on()},a.selectionsApi.off=function(){f.off()},a.$on("$destroy",function(){f&&(f.release(),f=null)}),f}}}])}),define("objects.extension/controller",["objects.extension/base-controller","util","core.utils/deferred","objects.extension/default-view-selection-service"],function(a,b,c){"use strict";var d;return d=a.extend({$scope:null,$element:null,api:null,view:null,create:function(a,c,d,e,f,g){var h=this.createView(a,c,d,e,g),i=b.extend(!0,{},f,e.selections||{});return this.createSelections(h,a,c,i),h},createView:function(a,b,c,d,e){return new c(a,b,d,e)},createSelections:function(a,b,c,d){var e=this.selectionService.createSelections(b,c,d);return a.setSelections(e),e},init:function(a,b,c){this.$scope=a,this.$element=b,this.selectionService=c;var d=this,e=this.view=this.create(a,b,a.ext.View,a.options,a.ext.options.selections,a.backendApi);e.initialize(),this.handleSpecialCaseForSyntaxSugarInExtension(e),a.$on("$destroy",function(){e&&(e.destroy(e),d.$scope.options=null,d.view=null,e=null)})},handleSpecialCaseForSyntaxSugarInExtension:function(a){var b,c=this.$scope.object.ext;for(b in c)"View"!==b&&"constructor"!==b&&"options"!==b&&a[b]&&(a[b]=c[b])},onPaint:function(a){return this.view?this.view.suppressOnPaint(this.$scope.layout)?c.resolve():(this.view.refreshSelections(),a?(this.view.prePaint(this.$scope.layout),this.view.updateData(this.$scope.layout),this.view.paint(this.view.$element,this.$scope.layout)):(this.view.updateData(this.$scope.layout),c.resolve())):c.resolve()},onResize:function(){return this.view.refreshSelections(),this.view.resize(this.view.$element,this.$scope.layout)},onStateChanged:function(a){this.view.allowInteraction(a)?this.view.on():this.view.off(),this.view.onStateChanged(a)},setBackendApi:function(a){this.view.setBackendApi(a)},setSnapshotData:function(a,b){return this.view.setSnapshotData(a,b)},getContextMenu:function(a,b){return this.view.getContextMenu(a,b)},getSelectionToolbar:function(){return this.view.getSelectionToolbar()},allowInteraction:function(a){return this.view.allowInteraction(a)},setInteraction:function(a){this.view.setInteraction(a)}}),d.$inject=["$scope","$element","qvDefaultViewSelectionService"],d}),define("objects.extension/qv-extension",["qvangular","objects.extension/controller"],function(a,b){"use strict";a.directive("qvExtension",function(){return{require:["qvExtension","^qvObject"],controller:b,link:function(a,b,c,d){var e=d[0],f=d[1];f.addChildController(e)}}})}),define("objects.utils/layout",[],function(){"use strict";function a(a,b){var c;for(c=0;i>c;++c)if(a>=f[c][0]&&b>=f[c][1])return f[c][2];return e.SPARK}function b(a){var b;for(b=0;i>b;++b)if(a>=g[b][0])return g[b][1];return e.SPARK}function c(a){var b;for(b=0;i>b;++b)if(a>=h[b][0])return h[b][1];return e.SPARK}function d(a){var b=Object.keys(e).filter(function(b){return e[b]===a})[0];return b&&b.toLowerCase()||""}var e={SPARK:1,XSMALL:3,SMALL:7,MEDIUM:15,FULL:31},f=[[550,450,e.FULL],[400,220,e.MEDIUM],[300,150,e.SMALL],[150,75,e.XSMALL],[0,0,e.SPARK]],g=[[450,e.FULL],[220,e.MEDIUM],[150,e.SMALL],[75,e.XSMALL],[0,e.SPARK]],h=[[550,e.FULL],[400,e.MEDIUM],[300,e.SMALL],[150,e.XSMALL],[0,e.SPARK]],i=f.length;return{LayoutMode:e,getLayoutMode:a,getLayoutModeKey:d,getHorizontalLayoutMode:c,getVerticalLayoutMode:b}}),define("text!objects/object.ng.html",[],function(){return'<article class="qv-object qvt-visualization" ng-class="classList" qva-activate="takeSnapshot($event)" tid="{{objectClass}}">\r\n\r\n	<qv-rain ng-if="object.throbberApi.isVisible" show="object.throbberApi.isVisible" resize="object.throbberApi.watchResize"></qv-rain>\r\n\r\n	<div class="retry-overlay" ng-if="object.throbberApi.isQueryCanceled">\r\n		<ul class="cancelled-list">\r\n			<li>\r\n				<div class="retry-text" q-translation="Object.Cancelled"></div>\r\n			</li>\r\n			<li>\r\n				<button class="retry-button qui-outlinebutton"  qva-activate="retry()" q-translation="Dialog.Button.Retry" tid="retry-calculations"></button>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n	<div class="cancel-overlay" ng-if="object.throbberApi.isLongRunningQuery">\r\n		<button class="cancel-button qui-outlinebutton" ng-if="!object.throbberApi.isQueryCanceled" qva-activate="cancel()"\r\n				q-translation="Common.Cancel" tid="cancel-calculations"></button>\r\n	</div>\r\n\r\n	<button ng-if="showSnapshotCount" class="snapshotcounter qui-iconbt" qva-activate="openSnapshotLibrary($event, \'snapshot\')">\r\n		<i class="icon-snapshot"></i><span>{{snapshotCount}}</span>\r\n	</button>\r\n\r\n	<header class="qv-object-header" ng-show="object.hasFrame && object.showTitles">\r\n		<h1 ng-attr-title="{{layout.title}}" class="qv-object-title qvt-visualization-title" qva-activate="titleClicked();">\r\n			<a ng-if="!editmode && options.showSearch && !object.isReadonly" q-title-translation="Common.Search" class="qv-object-search icon-magnifying-glass"\r\n				qva-activate="options.showSearch && options.search.toggle()"></a>\r\n			<span ng-if="!editmode || editmode && object.isReadonly" qve-highlight text="{{layout.title}}" query="options.highlightQuery"></span>\r\n			<span ng-if="options.showDisclaimerStar && !!layout.title && !editmode" class="disclaimer">*</span>\r\n			<div ng-if="editmode && !object.isReadonly" qv-inline-title-edit x-model="model" x-property-path="title" x-layout-path="title"\r\n				 x-empty-translation="Object.AddTitle"></div>\r\n		</h1>\r\n\r\n		<h2 ng-attr-title="{{layout.subtitle}}" ng-show="!!layout.subtitle" class="qv-object-subtitle qvt-visualization-subtitle">{{layout.subtitle}}</h2>\r\n	</header>\r\n	<div class="qv-object-content-container">\r\n		<div class="qv-object-content" qv-object-content component="object.content" options="options" object="object" backend-api="object.backendApi" layout="layout"\r\n			 ext="object.ext" selections-api="object.selectionsApi" throbber-api="object.throbberApi">\r\n		</div>\r\n	</div>\r\n	<footer ng-attr-title="{{layout.footnote}}" ng-show="object.hasFrame && object.showTitles && !!layout.footnote" class="qv-object-footnote qvt-visualization-footnote">{{layout.footnote}}</footer>\r\n</article>\r\n'}),define("pubsub",[],function(){function a(){this.topics={},this.wildcards=[]}return a.prototype.getTopics=function(a,b){var c=this.topics[a];return"undefined"==typeof c&&b&&(c=this.topics[a]=[]),c},a.prototype.createMatcher=function(a){return a=a.replace(/\$/g,"\\$"),new RegExp("^"+a.replace(/\*/g,".+?")+"$","i")},a.prototype.subscribe=function(a,b,c){if(a=a.toLowerCase().split("."),"function"!=typeof b)throw"pubsub: Invalid handler";var d={handler:b,topic:a[0],namespace:a[1],context:c||window};a[0].indexOf("*")>-1?(d.matcher=this.createMatcher(a[0]),this.wildcards.push(d)):this.getTopics(a[0],!0).push(d)},a.prototype.subscribeOnce=function(a,b,c){function d(){b.apply(this,arguments),e.unsubscribe(a,b)}var e=this;d.original=b,this.subscribe(a,d,c)},a.prototype.unsubscribe=function(a,b){a=a.toLowerCase(),this["."===a[0]?"unsubscribeNamespace":"unsubscribeTopic"](a,b)},a.prototype.unsubscribeNamespace=function(a){function b(b){return b.namespace!==a}a=a.substr(1);var c;this.wildcards=this.wildcards.filter(b);for(c in this.topics)this.topics[c]=this.topics[c].filter(b),this.topics[c].length||delete this.topics[c]},a.prototype.unsubscribeTopic=function(a,b){function c(c){var d=c.topic!==a[0];return!d&&b&&(d=c.handler.original?c.handler.original!==b:c.handler!==b),d}a=a.split(".");var d=this.getTopics(a[0]);this.wildcards=this.wildcards.filter(c),d&&(d=this.topics[a[0]]=d.filter(c),d.length||delete this.topics[a[0]])},a.prototype.publish=function(a,b){function c(c){(!c.matcher||c.matcher&&c.matcher.test(a[0]))&&c.handler.call(c.context,b,a[0])}a=a.toLowerCase().split(".");var d=this.getTopics(a[0]);this.wildcards.forEach(c),d&&d.forEach(c)},window.pubsub=new a,window.pubsub}),define("text!objects.requirements/requirements.ng.html",[],function(){return'<div qv-requirements class="requirements-wrapper" ng-show="show" ng-class="{\'incomplete\': !showAdd}">\r\n	<div class="requirements">\r\n		<h2 class="header">\r\n			<i class="object-icon" ng-class="iconClass"></i>\r\n		</h2>\r\n	<p class="incomplete-text" ng-if="!showAdd" q-translation="Visualization.Requirements.IncompleteVisualization"></p>\r\n		<!-- finished dimensions -->\r\n	<ul ng-if="showAdd && finishedDimensions.length">\r\n		<li ng-repeat="dimension in finishedDimensions" class="item" ng-class="{ finished: !dimension.invalid, invalid: dimension.invalid }"\r\n			tid="{{ dimension.invalid ? \'invalid-dimension\' : \'added-dimension\'}}">\r\n			<span class="text" title="{{dimension.title}}">{{dimension.title}}</span>\r\n			<i class="icon-cancel" qva-activate="removeDimension($index)" q-title-translation="Common.Delete"></i>\r\n			</li>\r\n		</ul>\r\n		<!-- unfinished dimensions -->\r\n	<ul ng-if="showAdd && unfinishedDimensions.length">\r\n		<li ng-repeat="d in unfinishedDimensions" class="item missing" tid="missing-dimension">\r\n			<button class="add-button qui-outlinebutton" ng-class="{ \'qui-active\': d.active }" qva-activate="showAddDimension($event,d)"\r\n					q-translation="Visualization.Requirements.AddDimension" tid="add-dimension"></button>\r\n			</li>\r\n		</ul>\r\n		<!-- finished measures -->\r\n	<ul ng-if="showAdd && finishedMeasures.length">\r\n		<li ng-repeat="measure in finishedMeasures" class="item" ng-class="{ finished: !measure.invalid, invalid: measure.invalid }"\r\n			tid="{{ measure.invalid ? \'invalid-measure\' : \'added-measure\'}}">\r\n			<span class="text" title="{{measure.title}}">{{measure.title}}</span>\r\n			<i class="icon-cancel" qva-activate="removeMeasure($index)" q-title-translation="Common.Delete"></i>\r\n			</li>\r\n		</ul>\r\n		<!-- unfinished measures -->\r\n	<ul ng-if="showAdd && unfinishedMeasures.length">\r\n		<li ng-repeat="m in unfinishedMeasures" class="item missing" tid="missing-measure">\r\n			<button class="add-button qui-outlinebutton" ng-class="{ \'qui-active\': m.active }" qva-activate="showAddMeasure($event,m)"\r\n					q-translation="Visualization.Requirements.AddMeasure" tid="add-measure"></button>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/error-translation",["autogenerated/qix/engine-enums","translator"],function(a,b){"use strict";function c(a,b){switch(a){case d.LOCERR_CALC_INVALID_DEF:return b===e?"Object.ErrorMessage.InvalidDimension":b===f?"Object.ErrorMessage.InvalidMeasure":"ErrorCode."+a;case d.LOCERR_CALC_NOT_IN_LIB:return b===e?"Object.ErrorMessage.MissingDimension":b===f?"Object.ErrorMessage.MissingMeasure":"ErrorCode."+a;case d.LOCERR_CALC_HEAP_ERROR:return"Object.ErrorMessage.HeapError";case d.LOCERR_CALC_TOO_LARGE:return"Object.ErrorMessage.CalcTooLarge";case d.LOCERR_CALC_TIMEOUT:return"Object.ErrorMessage.CalcTimeout";case d.LOCERR_DIRECT_DISCOVERY_LINKED_EXPRESSION_FAIL:return"Object.ErrorMessage.DirectDiscoveryLinkedExpressionFail";case d.LOCERR_DIRECT_DISCOVERY_ROWCOUNT_OVERFLOW:return"Object.ErrorMessage.DirectDiscoveryRowcountOverflow";case d.LOCERR_DIRECT_DISCOVERY_EMPTY_RESULT:return"Object.ErrorMessage.DirectDiscoveryEmptyResult";case d.LOCERR_DIRECT_DISCOVERY_DB_CONNECTION_FAILED:return"Object.ErrorMessage.DirectDiscoveryBDConnectionFailed";case d.LOCERR_DIRECT_DISCOVERY_MEASURE_NOT_ALLOWED:return"Object.ErrorMessage.DirectDiscoveryMeasureNotAllowed";case d.LOCERR_DIRECT_DISCOVERY_DETAIL_NOT_ALLOWED:return"Object.ErrorMessage.DirectDiscoveryDetailNotAllowed";case d.LOCERR_DIRECT_DISCOVERY_ONLY_ONE_DD_TABLE_ALLOWED:return"Object.ErrorMessage.DirectDiscoveryOnlyOneDDTableAllowed";case d.LOCERR_CALC_PIVOT_DIMENSIONS_ALREADY_EXISTS:return"Object.ErrorMessage.DimensionExists";case d.LOCERR_CALC_EVAL_CONDITION_FAILED:return"Object.ErrorMessage.CalculationCondition";case d.LOCERR_GENERIC_UNKNOWN:return"Object.ErrorMessage.Unknown";default:return"ErrorCode."+a}}var d=a.NxLocalizedErrorCode,e=1,f=2;return{getDimensionError:function(a){var d=c(a,e);return b.get(d)},getMeasureError:function(a){var d=c(a,f);return b.get(d)},getHyperCubeError:function(a){var d=c(a);return b.get(d)},getListObjectError:function(a){var d=c(a);return b.get(d)}}}),define("general.utils/android-keyboard-fix",[],function(){"use strict";function a(a,b,c){this.lastHeight=null,this.document=c||document,this.window=b||window,this.viewport=a||this.document.querySelector("meta[name=viewport]"),this.viewportContent=this.viewport.getAttribute("content"),this.updateHeight()}return a.prototype.clearHeight=function(){this.viewport.setAttribute("content",this.viewportContent)},a.prototype.setHeight=function(a){this.viewport.setAttribute("content",this.viewportContent+", height="+a)},a.prototype.updateHeight=function(){var a=this.window.innerHeight;return this.lastHeight!==a?(this.lastHeight=a,this.setHeight(a),!0):!1},a.prototype.rotate=function(a){var b=function(){this.updateHeight()&&a()}.bind(this);this.document.activeElement&&this.document.activeElement.blur(),this.clearHeight(),this.window.setTimeout(b,500),this.window.setTimeout(b,1e3),this.window.setTimeout(b,1500)},a.isNeeded=function(){var a=navigator.userAgent.toLowerCase().indexOf("android")>-1;return a},a}),define("core.utils/resize",["touche","pubsub","general.utils/android-keyboard-fix"],function(a,b,c){function d(a){k=!0,f("/resize/start",a)}function e(a){f("/resize/end",a),k=!1}function f(a,c){b.publish(a,{width:window.innerWidth,height:window.innerHeight,element:c.target})}function g(a){(a.target===window||a.target===document)&&(k||d(a),clearTimeout(i),f("/resize/update",a),i=setTimeout(function(){e(a)},j))}function h(a){l?l.rotate(function(){d(a),e(a)}):(d(a),e(a))}var i,j=250,k=!1,l=c.isNeeded()?new c:null;return a.utils.touch&&"ondeviceorientation"in window?window.addEventListener("orientationchange",h,!1):window.addEventListener("resize",g,!1),{on:function(a,c){b.subscribe("/resize/"+a,c)},off:function(a,c){b.unsubscribe("/resize/"+a,c)},force:function(a){a=a||"end",b.publish("/resize/"+a)}}}),define("text!objects.add-popovers/add-dimension-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<object-add-typeahead>\r\n		<div class="object-add-popover-header">\r\n			<div class="qui-inputwithicon">\r\n				<input type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\r\n					   object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)" maxlength="255"/>\r\n				<i class="icon-expression edit-expression" q-title-translation="Tooltip.OpenExpressionEditor" qva-activate="closeAddPopover()"\r\n				   pp-expression-editor="search.term" pp-expression-editor-on-apply="addFieldDimension({value:value})" expression-type="dimension"></i>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content" object-add-typeahead-menu>\r\n			<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="dimension in dimensions" tid="dimension-item"\r\n					object-add-typeahead-item="dimension" on-select="addLibraryDimension(dimension)">\r\n					<span qve-highlight text="{{dimension.label}}" query="search.term" class="qui-list-text"></span>\r\n				</li>\r\n			</ul>\r\n			<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n					object-add-typeahead-item="field" on-select="addFieldDimension(field)">\r\n					<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery qui-list-icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n					<span qve-highlight text="{{field.label}}" query="search.term" class="qui-list-text"></span>\r\n				</li>\r\n			</ul>\r\n			<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n		</div>\r\n	</object-add-typeahead>\r\n</immidiate-contextual>'}),define("text!objects.add-popovers/object-add-typeahead.ng.html",[],function(){return"<div ng-transclude></div>"}),define("general.services/aligner/aligner",[],function(){function a(a){this.container=a.container,this.body=a.body,this.alignAgainst=a.alignAgainst}return a.prototype.showTranscluded=function(a){a(function(a){this.container.appendTo(this.body).append(a)}.bind(this))},a.prototype.showContent=function(a){this.container.appendTo(this.body).append(a)},a.prototype.update=function(){var a=this.alignAgainst.offset();this.container.css({top:a.top,left:a.left,width:this.alignAgainst.width(),height:this.alignAgainst.height(),zIndex:1021})},a.prototype.hide=function(){this.container.remove()},a}),define("objects.add-popovers/object-add-typeahead",["qvangular","text!./object-add-typeahead.ng.html","general.services/aligner/aligner"],function(a,b){a.directive("objectAddTypeahead",[function(){return{template:b,scope:{},transclude:!0,replace:!0,restrict:"E",controller:["$scope",function(a){function b(){var b=a.menu;if(a.activeItem){var c=a.activeItem,d=c.getPosition();d.top<0?b.setScrollTop(c.getOffsetTop()):d.top+c.getHeight()>b.getHeight()&&c.scrollIntoView(!1)}else b.setScrollTop(0)}var c=this;a.items=[],this.activate=function(b){a.activeItem=b},this.nextItem=function(d){var e=a.items.indexOf(a.activeItem);"undefined"!=typeof d&&(e=(e+d)%a.items.length),e===a.items.length-1?c.activate(null):-1===e?c.activate(a.items[0]):c.activate(a.items[e+1]),b()},this.prevItem=function(d){var e=a.items.indexOf(a.activeItem);"undefined"!=typeof d&&(e=(e-d+a.items.length)%a.items.length),0===e?c.activate(null):-1===e?c.activate(a.items[a.items.length-1]):c.activate(a.items[e-1]),b()},this.getActiveItem=function(){return a.activeItem},this.selectActiveItem=function(){a.activeItem&&a.activeItem.select()},this.select=function(b){a.select({item:b}),a.activeItem=null},this.setMenu=function(b){a.menu=b},this.addItem=function(b){a.items.push(b)},this.removeItem=function(b){var c=a.items.indexOf(b);c>=0&&a.items.splice(c,1)}}]}}]),a.directive("objectAddTypeaheadInput",[function(){return{require:["^objectAddTypeahead","ngModel"],link:function(a,b,c,d){var e=d[0],f=d[1];b.on("keydown",function(b){b.stopPropagation(),13===b.which||9===b.which?(b.preventDefault(),e.getActiveItem()?a.$apply(function(){e.selectActiveItem()}):a.$apply(function(){a.$eval(c.onEnter,{$event:b})})):33===b.which?(b.preventDefault(),a.$apply(function(){e.prevItem(10)})):34===b.which?(b.preventDefault(),a.$apply(function(){e.nextItem(10)})):40===b.which?(b.preventDefault(),a.$apply(function(){e.nextItem()})):38===b.which?(b.preventDefault(),a.$apply(function(){e.prevItem()})):27===b.which&&(b.preventDefault(),a.$apply(function(){a.$eval(c.onEscape,{$event:b})}))}),a.$watch(e.getActiveItem,function(a){a?a.item.label&&b.val(a.item.label):b.val(f.$modelValue)}),a.$watch(f.$modelValue,function(a){a||e.activate(null)})}}}]),a.directive("objectAddTypeaheadMenu",[function(){return{require:"^objectAddTypeahead",link:function(a,b,c,d){a.controller=d,d.setMenu({getHeight:function(){return b.height()},setScrollTop:function(a){b[0].scrollTop=a}})}}}]),a.directive("objectAddTypeaheadItem",[function(){return{require:"^objectAddTypeahead",link:function(a,b,c,d){function e(){a.$eval(c.onSelect,{item:f})}var f=a.$eval(c.objectAddTypeaheadItem),g={item:f,getOffsetTop:function(){return b[0].offsetTop},scrollIntoView:function(a){b[0].scrollIntoView(a)},getPosition:function(){return b.position()},getHeight:function(){return b.height()},select:function(){e()}};d.addItem(g),a.$on("$destroy",function(){d.removeItem(g)}),a.$watch(function(){var a=d.getActiveItem();return a?a.item===f:!1},function(a){a?b.addClass("object-add-typeahead-active"):b.removeClass("object-add-typeahead-active")}),b.on("mouseenter",function(){b.addClass("object-add-typeahead-hover")}),b.on("mouseleave",function(){b.removeClass("object-add-typeahead-hover")}),b.on("qv-activate",function(b){b.preventDefault(),a.$apply(function(){e()})})}}}])}),define("objects.add-popovers/add-dimension-popover",["core.utils/deferred","general.utils/string-normalization","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-dimension-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g){"use strict";function h(a,c){return""===c?a:a.filter(function(a){return"undefined"==typeof a.value?!1:b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var i=100,j={template:f,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=g.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=g.getTypeTranslationKey,b.autoFocus=d.treatAsDesktop(),b.position||(b.position="right"),b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.onEnter=function(a){""!==b.search.term?(a.stopPropagation(),b.addFieldDimension({value:b.search.term})):b.closeAddPopover()};var f=null;b.$watch("search.term",function(d){function g(){var a=h(f.fields,d),e=h(f.dimensions,d);e.length>i?(e=c.limit(e,i),a=[]):a.length+e.length>i&&(a=c.limit(a,i-e.length)),b.fields=a,b.dimensions=e}f?g():a.all({fields:e.getSortedFields(),dimensions:e.getSortedDimensions()}).then(function(a){var b=a.fields.map(function(a){return{label:a.qName,value:a.qName,qTags:a.qTags}}),c=a.dimensions.map(function(a){return{label:a.qData.title,value:a.qData.title,libraryId:a.qInfo.qId}});f={fields:b,dimensions:c},g()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",closeAddPopover:"=",position:"="}};return j}),define("text!objects.add-popovers/add-measure-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<div class="object-add-popover" ng-show="!step2">\r\n		<object-add-typeahead>\r\n			<div class="object-add-popover-header">\r\n				<div class="qui-inputwithicon">\r\n					<input type="text" name="new-measure" autocomplete="off" ng-model="search.term" tid="add-measure-input" qva-focus="autoFocus"\r\n						   maxlength="255" object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)"/>\r\n					<i class="icon-expression edit-expression" q-title-translation="Tooltip.OpenExpressionEditor" qva-activate="closeAddPopover()"\r\n					   pp-expression-editor="search.term" pp-expression-editor-on-apply="addExpressionMeasure({value:value})" expression-type="measure"></i>\r\n				</div>\r\n			</div>\r\n			<div class="object-add-popover-content" object-add-typeahead-menu>\r\n				<div class="object-add-popover-list-header" ng-if="measures.length" q-translation="Common.Measures"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="measure in measures" tid="measure-item"\r\n						object-add-typeahead-item="measure" on-select="addLibraryMeasure(measure)">\r\n						<span qve-highlight text="{{measure.value}}" query="search.term" class="qui-list-text"></span>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Visualization.Requirements.FromField"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n						object-add-typeahead-item="field" on-select="showFromField(field)">\r\n						<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery qui-list-icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n						<span qve-highlight text="{{field.value}}" query="search.term" class="qui-list-text"></span>\r\n						<i class="object-add-popover-toogle-step2-icon qui-list-icon icon-triangle-right"></i>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-nohits" ng-if="!measures.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n			</div>\r\n		</object-add-typeahead>\r\n	</div>\r\n	<div class="object-add-popover back" ng-show="step2">\r\n		<div class="object-add-popover-header">\r\n			<div qva-activate="goBack($event);">\r\n				<i class="icon-triangle-left"></i>\r\n				<span q-translation="Visualization.Requirements.Back"></span>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content">\r\n			<div class="object-add-popover-list-header" q-translation="Visualization.Requirements.Aggregation"></div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="suggestion in fieldSuggestions" qva-activate="addFromField(suggestion)" tid="from-field-item">\r\n					<span class="qui-list-text">{{suggestion.aggregation}}({{suggestion.field}})</span>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("objects.add-popovers/add-measure-popover",["core.utils/deferred","general.utils/string-normalization","util","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-measure-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,c){return""===c?a:a.filter(function(a){return"undefined"==typeof a.value?!1:b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var j=100,k={template:g,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=h.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=h.getTypeTranslationKey,b.autoFocus=e.treatAsDesktop(),b.position||(b.position="right"),b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.onEnter=function(a){""!==b.search.term?(a.stopPropagation(),b.addExpressionMeasure({value:b.search.term})):b.closeAddPopover()},b.showFromField=function(a){
b.currentField=a,b.step2=!0},b.goBack=function(a){a.preventDefault(),b.currentField=null,b.step2=!1},b.$watch("currentField",function(a){a?b.fieldSuggestions=["Sum","Count","Avg","Min","Max"].map(function(a){var d=c.escapeField(b.currentField.value);return{aggregation:a,field:d}}):b.fieldSuggestions=[]}),b.addFromField=function(a){var c=a.aggregation+"("+a.field+")";b.addExpressionMeasure({value:c})};var g=null;b.$watch("search.term",function(c){function e(){var a=i(g.measures,c),e=i(g.fields,c);a.length>j?(a=d.limit(a,j),e=[]):a.length+e.length>j&&(e=d.limit(e,j-a.length)),b.fields=e,b.measures=a}g?e():a.all({fields:f.getSortedFields(),measures:f.getSortedMeasures()}).then(function(a){var b=a.fields.map(function(a){return{value:a.qName,label:a.qName,field:a.qName,qTags:a.qTags}}),c=a.measures.map(function(a){return{value:a.qData.title,label:a.qData.title,libraryId:a.qInfo.qId}});g={fields:b,measures:c},e()})})}],scope:{alignTo:"=",addExpressionMeasure:"=",addLibraryMeasure:"=",closeAddPopover:"=",position:"="}};return k}),define("objects.requirements/requirements",["jquery","qvangular","text!./requirements.ng.html","client.utils/state","general.services/show-service/show-service","objects.extension/base-controller","objects.error-handling/error-translation","core.utils/resize","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){var b,c=new Array(a);for(b=0;a>b;++b)c[b]={index:b};return c}function l(a){if(a.qHyperCube)return a.qHyperCube.qDimensionInfo||[];if(a.qChildList){var b=a.qChildList.qItems||[];return b.map(function(){return{}})}var c=!a.qListObject||!a.qListObject.qDimensionInfo||a.qListObject.qDimensionInfo.qError;return c?[]:[a.qListObject.qDimensionInfo]}function m(a){return a.qHyperCube?a.qHyperCube.qMeasureInfo||[]:[]}function n(a){a.showAdd=d.isInEditMode()&&!a.object.isReadonly}var o,p=null;return o=f.extend({$scope:null,init:function(b){function c(){n(b)}function f(a){return b.object.ext.addFieldDimension(a,b.object).then(function(){b.object.model.save(),m()})}function g(a){return b.object.ext.addLibraryDimension(a,b.object).then(function(){b.object.model.save(),m()})}function k(a){return b.object.ext.addLibraryMeasure(a,b.object).then(function(){b.object.model.save(),m()})}function l(a){return b.object.ext.addExpressionMeasure(a,b.object).then(function(){b.object.model.save(),m()})}function m(b){o&&(o.destroy(),o=null),p&&(p.active=!1),b&&!a(b.target).hasClass("add-button")&&(p=null)}this.$scope=b,d.StateChanged.bind(c),b.$on("$destroy",function(){d.StateChanged.unbind(c)}),c(),b.removeDimension=function(a){b.object.model.getProperties().then(function(c){var d=b.ext.getCreatePropertyHandler();d.setProperties(c),d.removeDimension(a).then(function(){b.object.model.save()})})},b.removeMeasure=function(a){b.object.model.getProperties().then(function(c){var d=b.ext.getCreatePropertyHandler();d.setProperties(c),d.removeMeasure(a).then(function(){b.object.model.save()})})};var o;b.showAddDimension=function(c,d){if(p&&p===d)return void(p=null);var h=b.ext.addDimensionPopoverComponent||i;o=e.show(h,{alignTo:a(c.target),closeAddPopover:m,addFieldDimension:f,addLibraryDimension:g}),d.active=!0,p=d},b.showAddMeasure=function(c,d){if(p&&p===d)return void(p=null);var f=b.ext.addMeasurePopoverComponent||j;o=e.show(f,{alignTo:a(c.target),closeAddPopover:m,addLibraryMeasure:k,addExpressionMeasure:l}),d.active=!0,p=d},h.on("start",m),b.$on("$destroy",function(){h.off("start",m),m()})},onPaint:function(){var a,b,c=this.$scope,d=c.layout,e=c.ext.dimensionDefinition?c.ext.dimensionDefinition.min:0,f=c.ext.dimensionDefinition?c.ext.dimensionDefinition.max:0,h=c.ext.measureDefinition?c.ext.measureDefinition.min:0,i=c.ext.measureDefinition?c.ext.measureDefinition.max:0;n(c),c.iconClass=c.object.ext.libraryInfo.templateIconClassName,c.minDimensions=e,c.minMeasures=h,c.maxDimensions=f,c.maxMeasures=i,e!==f||h!==i?c.headerStr="Visualization.Requirements.AddAtLeast":c.headerStr="Visualization.Requirements.Add",a=l(d).map(function(a){var b,c=a.qError&&a.qError.qErrorCode;return b=c?g.getDimensionError(c):a.title||a.qFallbackTitle,{invalid:!!c,title:b}}),b=m(d).map(function(a){var b,c=a.qError&&a.qError.qErrorCode;return b=c?g.getMeasureError(c):a.qFallbackTitle,{invalid:!!c,title:b}}),c.finishedDimensions=a,c.finishedMeasures=b,c.unfinishedDimensions=k(Math.max(0,c.minDimensions-c.finishedDimensions.length)),c.unfinishedMeasures=k(Math.max(0,c.minMeasures-c.finishedMeasures.length)),c.show=!0}}),o.$inject=["$scope"],b.directive("qvRequirements",function(){return{controller:o,require:["qvRequirements","^qvObject"],link:function(a,b,c,d){var e=d[0],f=d[1];f.addChildController(e)}}}),{template:c,controller:o}}),define("text!objects.error-handling/error-info-popup.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" width="200" position="\'top\'" collision="\'flipfit\'" class="qui-immidiateContextual" on-close-view="onClose(event)">\r\n	<div class="object-error-popup">\r\n		<!--<div class="object-error-title" q-translation="{{error.title}}"></div>-->\r\n		<div class="object-error-message">{{error.message}}</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("objects.error-handling/error-info-popup",["text!objects.error-handling/error-info-popup.ng.html","core.utils/resize"],function(a,b){"use strict";return{template:a,controller:["$scope",function(a){function c(){a.onClose()}a.$on("$destroy",function(){b.off("start",c)}),b.on("start",c)}]}}),define("text!objects.error-handling/error.ng.html",[],function(){return'<div qv-errorhandler class="object-error" ng-class="error.class" tid="object.Error">\r\n	<div class="object-error-content">\r\n		<div class="object-error-title">\r\n			<span>{{error.title}}</span>\r\n			<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\r\n		</div>\r\n		<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/error-handler",["qvangular","angular","touche","translator","./error-info-popup","text!./error.ng.html","objects.extension/base-controller","objects.error-handling/error-translation","autogenerated/qix/engine-enums"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return a.qErrorCode===i.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED}function k(a){return a.qHyperCube?a.qHyperCube:a.layers&&a.layers.length&&a.layers[0].qHyperCube?a.layers[0].qHyperCube:!1}function l(a){var b=a.qError.qErrorCode;switch(b){case i.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED:return a.customErrorMessage?a.customErrorMessage.calcCond:""}}var m=g.extend({$scope:null,init:function(a){this.$scope=a,a.hasSoftError=!1,a.hasHardError=!1,a.showMore=function(d){var f=b.element("<div>").appendTo("body");f.showComponent(e,{alignTo:b.element(d.target),error:a.error,onClose:function(){f.remove(),c.preventGestures()}})}},onPaint:function(){var a,b=this.$scope,c=b.object.error;if(!c){var e=b.layout,f=k(e);f?f.qError&&(a=l(f)||h.getHyperCubeError(f.qError.qErrorCode),c=j(f.qError)?{"class":"soft-error",message:a}:{"class":"hard-error",title:d.get("Object.Error"),message:a}):e.qListObject&&(e.qListObject.qError?(a=l(e.qListObject)||h.getListObjectError(e.qListObject.qError.qErrorCode),c=j(e.qListObject.qError)?{"class":"soft-error",message:a}:{"class":"hard-error",title:d.get("Object.Error"),message:a}):e.qListObject.qDimensionInfo&&e.qListObject.qDimensionInfo.qError.qErrorCode&&(a=l(e.qListObject.qDimensionInfo)||h.getDimensionError(e.qListObject.qDimensionInfo.qError.qErrorCode),c=j(e.qListObject.qDimensionInfo.qError.qErrorCode)?{"class":"soft-error",message:a}:{"class":"hard-error",title:d.get("Object.Error"),message:a}))}b.error=c}});return m.$inject=["$scope"],a.directive("qvErrorhandler",function(){return{controller:m,require:["qvErrorhandler","^qvObject"],link:function(a,b,c,d){var e=d[0],f=d[1];f.addChildController(e)}}}),{template:f,controller:m}}),define("objects.utils/data-properties/empty-handler",["./data-property-handler","util"],function(a){"use strict";var b=a.extend({getDimensions:function(){return[]},getMeasures:function(){return[]}});return b}),define("text!objects.error-handling/invalid-type.ng.html",[],function(){return'<div qv-extension class="object-error hard-error" tid="object.Error">\r\n	<div class="object-error-content">\r\n		<div class="object-error-title">\r\n			<span>{{error.title}}</span>\r\n			<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\r\n		</div>\r\n		<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\r\n		<button ng-if="showButton" class="qui-button object-error-remove" qva-activate="remove($event)" q-translation="Common.Delete"></button>\r\n	</div>\r\n</div>\r\n'}),define("objects.error-handling/invalid-type",["angular","touche","translator","objects.utils/data-properties/empty-handler","client.utils/state","./error-info-popup","text!objects.error-handling/invalid-type.ng.html"],function(a,b,c,d,e,f,g){"use strict";return{type:"invalid",template:g,definition:{type:"items",items:{}},snapshot:{canTakeSnapshot:!1},getContextMenu:function(){},hasError:function(){return!1},showRequirements:function(){return!1},getCreatePropertyHandler:function(){return new d},getDropFieldOptions:function(){},getDropDimensionOptions:function(){},getDropMeasureOptions:function(){},controller:["$scope",function(d){var g,h=d.object.error,i=c.get(h.title);g=Array.isArray(h.message)?c.get(h.message[0],h.message.slice(1)):c.get(h.message),d.error={title:i,message:g},d.showButton=!(d.options&&d.options._hideErrorButton),d.remove=function(a){var b=d.layout.qInfo.qId,c=e.model,f=c.getObjectById(b);c.removeObject({row:f.row,col:f.col}),a.stopPropagation()},d.showMore=function(c){var e=a.element("<div>").appendTo("body");e.showComponent(f,{alignTo:a.element(c.target),error:d.error,onClose:function(){e.remove(),b.preventGestures()}})}}]}}),define("objects.utils/resize",["pubsub"],function(a){function b(b){b=b||{},a.publish("/ui/object/resize",b)}["/resize/end","/ui/panel/toggle","/ui/grid/cellswap","/ui/grid/cellresize","/ui/grid/cellsplitting","/ui/grid/zoom/activated","/ui/grid/zoom/deactivated"].forEach(function(c){a.subscribe(c,b)})}),define("text!client.views/selection-toolbar/selection-toolbar.ng.html",[],function(){return'<div class="qv-selection-toolbar qvt-selection-toolbar"\r\n	 ng-style="toolbar.style"\r\n	 ng-class="{ \'sel-toolbar-card\': !options.isPopover, \'sel-toolbar-popover\': options.isPopover, \'sel-toolbar-click-to-unlock-bg\': locked, \'sel-toolbar-menu-item\': locked }"\r\n	 qva-activate="locked && toggleLock($event);">\r\n	<div class="sel-toolbar-list-wrapper">\r\n		<table class="sel-toolbar-list">\r\n			<tr>\r\n				<td class="sel-toolbar-list-item" ng-class="{ \'sel-toolbar-list-item-hide-more\': filteredMenuButtons.length === 0 }">\r\n					<button tid="selection-toolbar.toggleShowMenu"\r\n							class="sel-toolbar-btn sel-toolbar-icon sel-toolbar-icon-toggle"\r\n							ng-class="{ \'menu-active\': toolbar.showMenu }"\r\n							q-title-translation="{{toolbar.showMenu ? \'Tooltip.CloseSelectionMenu\' : \'Tooltip.SelectionMenu\'}}"\r\n							qva-activate="toggleShowMenu($event)">\r\n						<span class="sel-toolbar-span-icon selections-more"></span>\r\n					</button>\r\n				</td>\r\n				<td ng-if="toolbar.showLock || locked" class="sel-toolbar-list-item sel-toolbar-list-item-lockunlock">\r\n					<button tid="selection-toolbar.lock"\r\n							class="sel-toolbar-btn sel-toolbar-icon"\r\n							q-title-translation="{{\'DataModelViewer.RightMenu.Tooltip.ClickTo\' + (locked ? \'Unlock\' : \'Lock\')}}"\r\n							ng-disabled="locked ? false : !toolbar.backendApi.hasSelections()"\r\n							qva-activate="!locked && toggleLock($event);">\r\n						<span class="sel-toolbar-span-icon" ng-class="!locked ? \'icon-toolbar-unlocked\':\'icon-toolbar-locked sel-toolbar-menu-span-icon\'"></span>\r\n					</button>\r\n				</td>\r\n				<td ng-show="locked" class="sel-toolbar-list-item-locked">\r\n					<p class="sel-toolbar-menu-text" q-translation="SelectionToolbar.ClickToUnlock"></p>\r\n				</td>\r\n				<td ng-show="!locked" ng-repeat="button in filteredButtons" class="sel-toolbar-list-item" ng-class="button.clazz">\r\n					<button tid="{{button.tid}}"\r\n							qva-activate="buttonAction($event, button)"\r\n							q-title-translation="{{button.name}}"\r\n							ng-disabled="buttonIsDisabled(button)"\r\n							class="sel-toolbar-btn"\r\n							ng-class="[button.buttonClass, button.isIcon ? \'sel-toolbar-icon\' : \'\', button.isActive(this) ? \'menu-active\' : \'\']">\r\n						<span class="sel-toolbar-span-icon" ng-class="button.iconClass"></span>\r\n					</button>\r\n				</td>\r\n			</tr>\r\n		</table>\r\n\r\n	</div>\r\n	<div ng-if="toolbar.showMenu" class="sel-toolbar-menu" ng-style="toolbar.menuStyle"\r\n		 qva-delegated-activate="div:not(.disabled)#menuAction($event);">\r\n		<div ng-repeat="button in filteredMenuButtons" class="sel-toolbar-menu-item"\r\n			 tid="{{button.tid}}"\r\n			 q-title-translation="{{button.name}}"\r\n			 ng-class="{\'disabled\': buttonIsDisabled(button) }">\r\n			<table class="sel-toolbar-menu-table" ng-class="{ \'selection-toolbar-menu-table-align-center\': filteredButtons.length === 0 }">\r\n				<tr>\r\n					<td><span class="sel-toolbar-menu-span-icon" ng-class="button.iconClass"></span></td>\r\n					<td ng-if="filteredButtons.length !== 0"><p class="sel-toolbar-menu-text" q-translation="{{button.name}}"></p></td>\r\n				</tr>\r\n			</table>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("client.views/selection-toolbar/selection-toolbar",["jquery","qvangular","text!./selection-toolbar.ng.html","core.utils/deferred"],function(a,b,c,d){"use strict";var e,f,g=44,h=1,i=8,j=2;return b.componentDirective("qvaIncludeSelectionToolbar",{toolbar:"=",options:"="}),f={width:0,buttons:[],haveButtons:function(){return this.buttons.length>0},reset:function(a){this.width=a,this.buttons.length=0},freeWidth:function(){var a,b=0;for(a=0;a<this.buttons.length;a++)b+=this.buttons[a];return this.width-b}},e={template:c,controller:["$scope",function(b){function c(a,c,d){var e,k,l=0;for(f.reset(a-(i+2*j)),k=c.length-1;k>=0&&(e="sel-toolbar-icon-separator"!==c[k].buttonClass?g+i:h+i,e<=f.freeWidth());k--)f.buttons.push(e);for((b.toolbar.showLock||b.locked)&&(l+=g+i),(d.length>0||c.length>f.buttons.length)&&(l+=g+i);f.haveButtons()&&f.freeWidth()<l;)f.buttons.pop();return f.buttons.length}function e(){var a,d,e=[].concat(b.toolbar.buttons),f=[].concat(b.toolbar.menuButtons),g=c(b.toolbar.style.width,e,f);for(b.filteredButtons=[],b.filteredMenuButtons=[],a=0;g>a&&e.length;++a)b.filteredButtons.push(e.pop());for(b.filteredButtons.reverse();e.length;)d=e.pop(),"sel-toolbar-icon-separator"!==d.buttonClass&&b.filteredMenuButtons.push(d);for(;f.length;)b.filteredMenuButtons.push(f.shift())}function k(a){b.locked=a,b.toolbar.showMenu=!1,m.then(function(){e()})}var l=d(),m=l.promise;b.filteredButtons=[],b.filteredMenuButtons=[],b.selectionInfo={show:!1,selected:0,total:0},b.lassoEnabled=!1,this.confirm=function(){b.selectionsApi.confirm()},this.close=function(){b.destroyComponent()},b.buttonAction=function(a,c){a.originalEvent.preventDefault(),c.action.call(b.toolbar)},b.buttonIsDisabled=function(a){return"function"==typeof a.isDisabled?a.isDisabled.call(b.toolbar):!1},b.menuAction=function(c){var d=a(c.target).scope();c.originalEvent.preventDefault(),d.button.action.call(b.toolbar),b.toolbar.showMenu=!b.toolbar.showMenu},b.toggleShowMenu=function(a){a.originalEvent.preventDefault(),b.toolbar.showMenu=!b.toolbar.showMenu},b.toggleLasso=function(){b.lassoEnabled=!b.lassoEnabled,b.toolbar.toggleLasso(b.lassoEnabled)},b.toggleLock=function(a){a.originalEvent.preventDefault(),b.toolbar.backendApi.isLocked()?(b.toolbar.selectionsApi.selectionsMade=!0,b.toolbar.backendApi.unlock()):b.toolbar.backendApi.lock()},b.$watch("toolbar.backendApi.isLocked()",function(a){void 0!==a&&k(a?!0:!1)}),b.$watch("toolbar.position",function(a){a&&(b.toolbar.style=a,l.resolve(),k(b.toolbar.backendApi.isLocked?b.toolbar.backendApi.isLocked():!1))}),b.$watch("toolbar.menuMaxHeight",function(a){a&&(b.toolbar.menuStyle={maxHeight:a})}),b.$watch("options.lassoEnabled",function(a){b.lassoEnabled=a})}]}}),define("client.views/selection-toolbar/selection-toolbar-service",["qvangular","client.views/selection-toolbar/selection-toolbar","util","core.utils/notification","angular"],function(a,b,c,d){"use strict";a.service("qvSelectionToolbarService",["$document",function(a){function e(a){var b,c,d,e,f=a[0].getBoundingClientRect();return a.is("th, td")&&(c=a.closest("table")[0].getBoundingClientRect(),b=a.prevAll(),d=b.length?b.last():a,e=d[0].getBoundingClientRect(),e.left-c.left===1)?{top:f.top,left:f.left-1,width:f.width}:f}var f,g,h,i=a.find("body");return f={open:function(d,f){var j=e(d);f.toolbar=c.extend(!0,f.toolbar,{position:{top:j.top-40,left:j.left,width:j.width+(f.offsetWidth||0)},menuMaxHeight:f.menuMaxHeight}),g=a.find(".qv-selection-toolbar"),0===g.length&&(g=angular.element("<div>")),h=g.showComponent(b,f),g.appendTo(i)},close:function(){h&&(h.close(),this.Closed.emit(),h=void 0),g&&g.remove()},confirm:function(){h&&(h.confirm(),h=void 0),this.close()}},d.create(f,"Closed"),f}])}),define("text!objects/throbber/throbber.ng.html",[],function(){return'<div ng-show="progress" class="qv-animate progress ng-hide">\r\n	<div class="progress-loader" style="width:20%;height:20%;position:absolute;top:40%;left:40%"></div>\r\n</div>\r\n'}),define("objects/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(a,b){"use strict";a.directive("qvThrobber",["$timeout",function(a){return{replace:!0,template:b,restrict:"E",scope:{model:"=",progress:"=",delay:"=",disabled:"="},link:function(b){var c;b.$watch("model.isValidating",function(d){return b.disabled===!0?void(b.progress=!1):void(b.model&&void 0===b.model.state?b.progress=!0:d?(c&&a.cancel(c),c=a(function(){b.model&&b.model.isValidating&&(b.progress=!0)},b.delay||1e3)):b.progress=!1)})}}}])}),define("text!general.services/loader/rain/rain.ng.html",[],function(){return'<div class="rain progress" ng-class="{\'qv-fade-out\': fadeOut}">\r\n	<div class="rain-progress" ng-style="rainStyle">\r\n		<div class="progress-div rotating" ng-class="ngClasses">\r\n		</div>\r\n	</div>\r\n	<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\r\n		<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\r\n		<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\r\n	</div>\r\n</div>\r\n'}),define("general.services/loader/rain/rain",["qvangular","text!../rain/rain.ng.html"],function(a,b){"use strict";a.directive("qvRain",[function(){return{replace:!0,template:b,restrict:"E",scope:{show:"=",resize:"=?",messageObj:"=?"},link:function(a,b){function c(){var c=b[0].getBoundingClientRect(),d=Math.min(c.width,c.height);d=.3*d,a.rainStyle.height=d+"px",a.rainStyle.width=d+"px",a.rainStyle.top=(c.height-d)/2,a.rainStyle.left=(c.width-d)/2}a.rainStyle={},a.$watch("show",function(a){void 0!==a&&a&&c()}),a.resize&&a.resize(c),c()}}}])}),define("objects/object",["jquery","qvangular","core.utils/deferred","general.utils/visualizations","objects.models/visualization-object","objects.utils/layout","objects.utils/type-loader","text!./object.ng.html","pubsub","client.utils/state","objects.extension/extension-type","util","translator","objects.requirements/requirements","objects.error-handling/error-handler","core.utils/resize","objects.extension/base-controller","objects.error-handling/invalid-type","objects.utils/resize","client.views/selection-toolbar/selection-toolbar-service","objects/throbber/throbber","general.services/loader/rain/rain"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a){a.selectionsApi&&a.selectionsApi.active&&a.selectionsApi.confirm()}function s(a,c){function d(){return!a.options||a.options.isVisible!==!1}function e(){r(c)}function f(){d()&&(b.$apply(a,function(){c.resize()}),c.throbberApi.resize())}function g(){h||(h=setTimeout(function(){f(),clearTimeout(h),h=null},100))}var h;a.$on("resizeCell",function(){g()}),i.subscribe("/ui/object/resize."+a.$id,function(){g()}),p.on("start."+a.$id,e),a.$on("$destroy",function(){clearTimeout(h),i.unsubscribe("."+a.$id),p.off("start."+a.$id,e)})}function t(a,b){function c(c){a.layout=c,b.setLayout(c,a.options)}function d(a){b.setModel(a)}var f;a.object._forcePaint=!0,f=e.bindLayout(a,"model",c,d),a.$on("$destroy",function(){f&&f()})}function u(a,c,d,e){function g(){return!a.options||a.options.isVisible!==!1}function h(a,b,c){a&&(b&&b.then?b.then(function(){setTimeout(function(){a({status:1,error:c||!1})},0)}):setTimeout(function(){a({status:0,error:c||!1})},0))}var i,k,l,n,p;c.setObjectClass=function(b){(b||void 0===n)&&(n=d[0].clientWidth),(b||void 0===p)&&(p=d[0].clientHeight);var e=f.getLayoutMode(n,p),g=c.type&&c.type.type,h=[];if(a.ext&&j.state===j.States.snapshot){var i=c.canTakeSnapshot()?"qv-snapshot-enabled":"qv-snapshot-disabled";h.push(i)}c.selectionsApi&&c.selectionsApi.active&&h.push("qv-selections-active"),c.objectSize={w:n,h:p},a.options.layoutMode=e;var k="qv-layout-"+f.getLayoutModeKey(e);h.push(k),a.objectClass="qv-object-"+g,h.push(a.objectClass),c.selectionClass&&h.push(c.selectionClass),a.classList=h},c.update=function(){this.valid&&(this.loadContent(),i=b.getService("$timeout")(function(){c.setObjectClass(),c.backendApi&&c.backendApi.updateCache(a.layout);var d=e.childLoaded();a.rpcId=d.rpcId,d.then(function(d){try{h(a.options.onRendered,d.onPaint(g()))}catch(f){throw c.error={"class":"hard-error",title:m.get("Object.Error"),message:m.get("Object.ErrorMessage.RenderingFailed",c.ext.type)},c.content=o,e.resetChildController(),k=b.getService("$timeout")(function(){e.childLoaded().then(function(b){h(a.options.onRendered,b.onPaint(!0),!0)})}),f}})}))},c.resize=function(){g()&&(l=b.getService("$timeout")(function(){c.setObjectClass(!0),e.childLoaded().then(function(a){a.onResize()})}))},c.onResize=function(){e.childLoaded().then(function(a){a.onResize()})},a.$on("$destroy",function(){var a=b.getService("$timeout");a.cancel(i),a.cancel(k),a.cancel(l)})}function v(a,e,f,g){function h(){var b={options:a.options,object:f,layout:a.layout,ext:f.ext};return f.ext.hasError(b)?o:f.ext.showRequirements(b)?n:f.ext}var i=c();f.loaded=i.promise,f.valid=!1,f.loadContent=function(){var a=h();this.content!==a&&(void 0!==this.content&&(g.resetChildController(),g.childLoaded().then(function(a){a.onStateChanged(j)})),this.content=a)},f.reset=function(){this.valid&&(a.options=l.extend({},a.resetOptions),i=c(),this.loaded=i.promise,this.valid=!1)},f.validate=function(){this.valid||this.layout&&this.type&&this.ext&&(this.valid=!0,i.resolve())},f.setExtension=function(b){this.ext=b,a.ext=b,"invalid"!==b.type&&(b.mapProperties(this.model),this.setBackendApi(),this.updateSnapshot()),this.validate(),this.update(),this.ext.model=this.model},f.setBackendApi=function(){var b=a.options.APIType||this.ext.BackendApi,c=this.backendApi=new b(this.model);g.childLoaded().then(function(a){a.setBackendApi(c)})},f.setType=function(c,d){this.backendApi&&this.backendApi.destroy(),this.ext=null,this.backendApi=null,this.hasContent=!1,this.type=c,c.load().then(function(h){f.type===c&&(c!==y&&(f.error=null),f.setExtension(h),w(a,e,f,g),d&&b.$rootScope.$broadcast("refreshPropertyPanel"))},function(){f.setType(y),f.error={"class":"hard-error",title:m.get("Object.Invalid.Title"),message:m.get("Object.ErrorMessage.NotFound",c.type)},f.isInvalid=!0})},f.setModel=function(a){this.model=a,this.ext&&(this.ext.model=a,this.setBackendApi())},f.setLayout=function(a){this.layout=a;var b=a.visualization||a.qInfo.qType,c=d.getType(b);a.qError&&(c=y,this.error={title:"Object.Error",message:"Object.Invalid.Info"}),c||(c=y,this.error={title:"Object.Invalid.Title",message:["Object.ErrorMessage.NotFound",b]}),this.type!==c&&(this.reset(),this.setType(c,!!this.type)),this.isInvalid=c===y,this.isLink=!this.isInvalid&&!!a.qExtendsId,this.showTitles=a.showTitles!==!1,this.validate(),this.update()}}function w(c,d,e,f){function g(b){var c=a(b.target);e.selectionsApi.ignoreOnOutside(c)||(e.selectionsApi.getDockToElement().off(".object"),e.selectionsApi.confirm())}function h(){return e.backendApi&&e.backendApi.endSelections(!0),null}e.activateSelections=function(){"undefined"!=typeof e.ext.options.selections&&f.childLoaded().then(function(a){a.allowInteraction(j)&&e.selectionsApi.activate()})},e.selectionsApi&&"function"==typeof e.selectionsApi.destroy&&e.selectionsApi.destroy(),e.selectionsApi={destroy:function(){this._activatedCallbacks=[],this._deactivatedCallbacks=[],a(window).off("onbeforeunload",h)},active:!1,selectionsMade:!1,_activatedCallbacks:[],_deactivatedCallbacks:[],on:function(){},off:function(){},ignoreOnOutside:function(a){return!(!a.closest(".qv-selection-toolbar").length&&!a.closest(".selections-data-area-ui").length)},getDockToElement:function(){return d},getMenuMaxHeight:function(){return e.selectionsApi.getDockToElement().outerHeight()},getSelectionToolbarWidthOffset:function(){return 0},watchActivated:function(a){return this._activatedCallbacks.push(a),function(){var b=this._activatedCallbacks.indexOf(a);this._activatedCallbacks.splice(b,1)}.bind(this)},activated:function(d){this.active=!0,d||e.backendApi.beginSelections(),a(window).on("onbeforeunload",h),c.options.isPopover||(this.getDockToElement().on("qv-outside.object",g),b.$apply(c,function(){e.setObjectClass(),e.getSelectionToolbar().then(function(a){b.getService("qvSelectionToolbarService").open(e.selectionsApi.getDockToElement(),{toolbar:a,selectionsApi:e.selectionsApi,options:c.options,menuMaxHeight:e.selectionsApi.getMenuMaxHeight(),offsetWidth:e.selectionsApi.getSelectionToolbarWidthOffset()})})})),this._activatedCallbacks.forEach(function(a){a.call(this)},this)},watchDeactivated:function(a){return this._deactivatedCallbacks.push(a),function(){var b=this._deactivatedCallbacks.indexOf(a);this._deactivatedCallbacks.splice(b,1)}.bind(this)},deactivated:function(){a(window).off("onbeforeunload",h),this.active=!1,this.selectionsMade=!1,c.options.isPopover||(e.selectionsApi.getDockToElement().off(".object"),b.$apply(c,function(){e.setObjectClass(),b.getService("qvSelectionToolbarService").close()})),this._deactivatedCallbacks.forEach(function(a){a.call(this)},this)},confirm:function(){e.selectionsApi.deactivateSearch&&e.selectionsApi.deactivateSearch(),e.backendApi.endSelections(!0),this.deactivated()},cancel:function(){e.selectionsApi.deactivateSearch&&e.selectionsApi.deactivateSearch(),e.backendApi.endSelections(!1),this.deactivated()},clear:function(){e.backendApi.clearSelections()},toggleKeyboardAccelerators:function(){},getKeyAsToggleSelected:function(a){return!(a.metaKey||a.ctrlKey)},search:function(){},confirmSearch:function(){},cancelSearch:function(){},activate:function(){this.active||this.activated()}}}function x(a,c){function d(d,e){c.selectionsApi&&c.selectionsApi.active?c.throbberApi.hide():a.model&&void 0===a.model.state?c.throbberApi.show():d?(b.getService("$timeout").cancel(f),f=b.getService("$timeout")(function(){a.model&&a.model.isValidating&&c.throbberApi.show()},e)):(c.throbberApi.hide(),c.throbberApi.isLongRunningQuery=!1),b.getService("$timeout").cancel(g),g=b.getService("$timeout")(function(){c.throbberApi.isVisible===!0&&(c.throbberApi.isLongRunningQuery=!0,c.throbberApi.isQueryCanceled=!1)},8e3)}var e,f,g;c.throbberApi&&"function"==typeof c.throbberApi.destroy&&c.throbberApi.destroy(),c.throbberApi={resizeCallbacks:[],isVisible:!1,isLongRunningQuery:!1,isQueryCanceled:!1,initialize:function(){e=a.$watch("model.isValidating",function(a){d(a,1e3)})},reset:function(a){d(a,0)},show:function(){c.throbberApi.isVisible=!0},hide:function(){c.throbberApi.isVisible=!1,c.throbberApi.isLongRunningQuery=!1},off:function(){e(),b.getService("$timeout").cancel(f),b.getService("$timeout").cancel(g)},destroy:function(){c.throbberApi.off(),c.throbberApi.resizeCallbacks.length=0},resize:function(){c.throbberApi.resizeCallbacks.forEach(function(a){a()})},watchResize:function(a){c.throbberApi.resizeCallbacks.push(a)}},c.throbberApi.initialize()}var y=new k({type:"invalid",path:"objects.error-handling/invalid-type"});b.componentDirective("qvObjectContent",{object:"=",backendApi:"=",ext:"=",options:"=",layout:"=",selectionsApi:"=",throbberApi:"="}),b.directive("qvObject",["$parse",function(d){return{restrict:"E",replace:!0,template:h,scope:{options:"=",model:"=",object:"=?"},controller:function(){var a=c();this.addChildController=function(b,c){b instanceof q||(b=new(q.extend(b)),b.$scope=c),a.resolve(b)},this.resetChildController=function(){a=c()},this.childLoaded=function(){return a.promise}},link:function(c,e,f,h){var i,k=c.object={};c.resetOptions=l.extend({},c.options),c.options||(c.options={}),c.options.zoomEnabled=!!f.zoomObject,c.$on("objectTrigger",function(a,b){switch(b){case"zoomOnCell":d(f.zoomObject)(c.$parent)}a.stopPropagation()}),Object.defineProperties(k,{hasFrame:{get:function(){return!c.options.isPopover&&!k.isInvalid}},isReadonly:{get:function(){return k.isLink||k.isInvalid||c.options.isReadonly}},haveTitleArea:{get:function(){var a=this.layout;return this.showTitles&&(""!==a.title||""!==a.subtitle||j.state===j.States.edit&&!this.isReadonly)}}}),k.getPropertyPanelContent=function(){return k.loaded.then(function(){var a=k.ext.getCreatePropertyHandler(),b=k.ext.mappedDefinition||k.ext.definition,c=k.ext.globalChangeListeners;return{definition:b,globalChangeListeners:c,type:k.type,backendApi:k.backendApi,handler:a,iconClass:k.ext.libraryInfo.templateIconClassName,titleRef:"title",ext:k.ext}})},k.setSnapshotData=function(a,b){return h.childLoaded().then(function(c){return c.setSnapshotData(a,b)})},k.getDropOptions=function(a,b){return k.ext.getDropOptions(k,a,b)},k.getContextMenu=function(a){return h.childLoaded().then(function(b){return b.getContextMenu(k,a)})},k.getObjectMenu=function(a){return h.childLoaded().then(function(b){return b.getObjectMenu(k,a)})},k.getSelectionToolbar=function(){return k.loaded.then(function(){return h.childLoaded().then(function(a){return a.getSelectionToolbar()})})},k.reloadContent=function(){c.ext=k.ext=a.extend({},k.ext),k.loadContent()},k.canTakeSnapshot=function(){return this.content!==n&&this.content!==o&&c.model.isValid?"function"==typeof c.ext.snapshot.canTakeSnapshot?c.ext.snapshot.canTakeSnapshot.call(null,k):"boolean"==typeof c.ext.snapshot.canTakeSnapshot?c.ext.snapshot.canTakeSnapshot:!1:void 0},k.updateSnapshot=function(){var a=j.state===j.States.snapshot;k&&k.ext&&a?k.ext.snapshot.updateCount(c).then(function(a){c.showSnapshotCount=k&&k.canTakeSnapshot()&&a>0}):c.showSnapshotCount=!1},k.setInteraction=function(a){h.childLoaded().then(function(b){b.setInteraction(a)})},c.$watch(function(){return j.state},function(a){var d=h.childLoaded();c.rpcId=d.rpcId,d.then(function(d){c.editmode=a===j.States.edit,c.editmode&&r(k),k.updateSnapshot(),d.onStateChanged(j),b.getService("$timeout").cancel(i),i=b.getService("$timeout")(function(){k.setObjectClass()})})}),v(c,e,k,h),s(c,k),u(c,k,e,h),g.load(c.options._skipRegisterExtensions).then(function(){t(c,k)}),k.loaded.then(function(){c.cancelled=c.model.isCancelled}),c.$watch("options",function(a){a&&a.setController&&h.childLoaded().then(function(){a.setController(k)})}),c.$on("childSelectionActive",function(a,b){k.childInSelection=b,a.preventDefault()}),c.takeSnapshot=function(a,b){j.state===j.States.snapshot&&k.canTakeSnapshot()&&(c.ext.snapshot.take(this,k,a,b),c.showSnapshotCount=!0)},c.openSnapshotLibrary=function(a){a.stopImmediatePropagation(),b.getService("storyItemsLibrary").openLibrary({event:a,library:"snapshot",objectId:this.layout.qInfo.qId})},c.titleClicked=function(){this.options._disableSelections||c.editmode||k.activateSelections()},c.cancel=function(){
c.model.__layoutRPCId&&(c.model.cancelRequest(c.model.__layoutRPCId),delete c.model.__layoutRPCId,k.throbberApi.hide(),k.throbberApi.isQueryCanceled=!0)},c.retry=function(){k.throbberApi.hide(),k.throbberApi.isQueryCanceled=!1,k.throbberApi.reset(!0),c.model.markAsInvalid(),c.model.getLayout().then(function(a){c.layout=a,k.setLayout(a)})},x(c,k,h),c.$on("$destroy",function(){b.getService("$timeout").cancel(i),k&&(r(k),k.selectionsApi&&"function"==typeof k.selectionsApi.destroy&&k.selectionsApi.destroy(),k.backendApi&&(k.backendApi.destroy(),k.backendApi=null),k.throbberApi&&k.throbberApi.destroy(),k=null,c.object=null)})}}}])}),define("objects.extension/extension-type",["jquery","core.utils/class","general.utils/property-mapper","objects.extension/default-extension","util","qvangular","core.utils/deferred","objects.models/visualization-object","objects.extension/default-view","require","objects/inline-title-edit","objects.extension/qv-extension"],function(a,b,c,d,e,f,g,h,i,j){function k(a,b){var c=e.extend(!0,{},d,b);return c.libraryInfo=a.getLibraryInfo(),c}function l(a){var b,c=a.path;return t[c]||(b=g(),j([c],function(c){f.$rootScope.$apply(function(){b.resolve(k(a,c))})},function(a){b.reject(a)}),t[c]=b.promise),t[c]}function m(a){return"[object Object]"===Object.prototype.toString.call(a)}function n(a){var b="";switch(a.toLowerCase()){case"listbox":b="Object.Listbox";break;case"barchart":b="Object.BarChart";break;case"combochart":b="Object.ComboChart";break;case"filterpane":b="Object.FilterPane";break;case"gauge":b="Object.Gauge";break;case"kpi":b="Object.Kpi";break;case"linechart":b="Object.LineChart";break;case"piechart":b="Object.PieChart";break;case"pivot-table":b="Object.PivotTable";break;case"scatterplot":b="Object.ScatterPlot";break;case"table":b="Object.Table";break;case"treemap":b="Object.Treemap";break;case"text-image":b="Object.TextImage";break;case"sheet":b="Common.Sheet";break;case"objectlibrary":b="Object.ObjectLibrary";break;case"libraryobject":b="Object.LibraryObject";break;case"map":b="Object.Map";break;default:b=""}return b}function o(a){switch(a.toLowerCase()){case"barchart":return"bar-chart-vertical";case"linechart":return"line-chart";case"table":return"table";case"pivot-table":return"pivot-table";case"components":return"components";case"piechart":return"pie-chart";case"filterpane":return"filterpane";case"listbox":return"list";case"gauge":return"gauge-chart";case"kpi":return"kpi";case"scatterplot":return"scatter-chart";case"text-image":return"text-image";case"treemap":return"treemap";case"map":return"map";case"combochart":return"combo-chart";default:return"extension"}}function p(a){return"icon-"+o(a)}function q(a){if(!a)return"icon-extension";switch(a.toLowerCase()){case"bar-chart-vertical":return"icon-bar-chart-vertical";case"line-chart":return"icon-line-chart";case"table":return"icon-table";case"pivot-table":return"icon-pivot-table";case"components":return"icon-components";case"pie-chart":return"icon-pie-chart";case"filterpane":return"icon-filterpane";case"list":return"icon-list";case"gauge-chart":return"icon-gauge-chart";case"kpi":return"icon-kpi";case"scatter-chart":return"icon-scatter-chart";case"text-image":return"icon-text-image";case"text":return"icon-titletext";case"map":return"icon-map";case"combo-chart":return"icon-combo-chart";default:return"icon-extension"}}function r(a){var b=0!==a.indexOf("listbox");return{name:a,descriptionKey:"Template.preview.description."+a,translationKey:n(a),template:a,templateIconClassName:p(a),icon:o(a),author:"Qlik",isThirdParty:!1,isLibraryItem:b}}var s,t={};f.componentDirective("qvaIncludeObject",{model:"=",ext:"=",options:"="});var u={"bar-chart-vertical":"!","line-chart":"%","pie-chart":"&",list:"-",table:"'","pivot-table":"(",filterpane:".","scatter-chart":"+","text-image":"/","gauge-chart":")",kpi:"1",treemap:"»",map:",","combo-chart":"‚","":"E"};return s=b.extend("ExtensionType",{init:function(a){this.type=a.type,this.path=a.path,this.libraryInfo=a.libraryInfo||r(a.type),this.components=a.components||[],this.libraryInfo.templateIconClassName||(this.libraryInfo.templateIconClassName=q(this.libraryInfo.icon))},getLibraryInfo:function(){return this.libraryInfo},getTemplateIconClassName:function(){return this.libraryInfo.templateIconClassName},getIconChar:function(){return u[this.libraryInfo.icon]?u[this.libraryInfo.icon]:"g"},getModelCtor:function(){return l(this).then(function(a){return a.Model})},getInitialProperties:function(a){var b=this;return l(b).then(function(d){var f=e.extend(!0,{qInfo:{qType:b.type},visualization:b.type},d.initialProperties,a);return c.mapProperties(d.definition,f,b.type)})["catch"](function(){return{qInfo:{qType:b.type},visualization:b.type}})},load:function(){return l(this).then(function(a){var b;if(a.View)for(b in i)i.hasOwnProperty(b);return m(a.view)&&(a.View=i.extend(a.view)),void 0===a.View&&(a.View=i),e.extend(!0,{},a)})},getExtensionType:function(){return l(this)}}),s.addObject=function(b,c,d){var e=new g;return j(["objects/object"],function(){var g=a(b);g.html('<qv-object model="model" options="options"></qv-object>');var i=f.$rootScope.$new(),j=h.get(c,d);j.then(function(a){i.model=a,i.options={};var b=f.getService("$compile");b(g.contents())(i),f.$apply(i),e.resolve(j)},function(a){e.reject(a)})}),e.promise},s}),function(){"use strict";define("xsrfplugin",["jquery"],function(a){function b(a){var b,c,d="";for(b=0;a>b;b++)c=Math.floor(62*Math.random()),d+=10>c?c:c>9&&36>c?String.fromCharCode(c+55):String.fromCharCode(c+61);return d}function c(){var c,d;e||(e=!0,c=b(16),d=a.ajax,a.extend({ajax:function(a){if(a.headers||(a.headers={}),a.headers["X-Qlik-XrfKey"]=c,"GET"===a.type)void 0===a.data&&(a.data={}),a.data.xrfkey=c;else if(a.url){var b=-1===a.url.indexOf("?")?"?":"&";a.url+=b+"xrfkey="+c}return d.call(this,a)}}))}function d(){e=!1}var e=!1;return{getRandomString:b,setupXsrfPlugin:c,resetHasBeenSetup:d}})}(),define("general.services/content-api/content-api",["qvangular","core.utils/deferred","translator","xsrfplugin","require"],function(a,b,c,d,e){a.service("$contentApi",["$http",function(f){function g(a){a.headers||(a.headers={})}function h(a){a.params||(a.params={})}function i(a){var b=d.getRandomString(16);return a.headers["X-Qlik-XrfKey"]=b,a.params.xrfkey=b,a}function j(a){var b=e.toUrl(""),c=b.indexOf("/resources");return c>-1&&(b=b.substring(0,c)),a.url=b+a.url,a}function k(a){var b=c.language;return b&&(a.headers["Accept-Language"]="pseudo"!==b?b:"qps-ploc"),a}function l(b){return g(b),h(b),a.$rootScope.isPersonalMode||i(b),j(b),k(b),f(b)}function m(){var a=new b,c={method:"GET",url:"/qrs/extension/schema"};return l(c).then(function(b){var c=b.data;a.resolve(c)})["catch"](function(b){var c=b.data;a.reject(c)}),a.promise}return{getExtensions:m,request:l}}])}),define("general.models/library/extension-list",["core.utils/deferred","qvangular","general.services/content-api/content-api"],function(a,b){"use strict";var c={},d=null;return c.getList=function(){return null===d&&(d=new a,b.getService("$contentApi").getExtensions().then(function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({id:c,data:a[c]});d.resolve(b)},function(){var a=[];d.resolve(a)})),d.promise},c}),define("objects.utils/type-loader",["core.utils/deferred","general.utils/visualizations","objects.extension/extension-type","general.models/library/extension-list"],function(a,b,c,d){function e(a,b){return b=b||{},b.previewIconURL||b.preview&&b.preview.indexOf(".png")>0&&(b.previewIconURL="../extensions/"+a+"/"+b.preview),b.icon=b.icon||"extension",b.description=b.description||b.name,b.template=b.template||a,b.isLibraryItem=b.isLibraryItem===!1?!1:!0,b.isThirdParty=!0,b.name=b.name||b.template||a,b}function f(a){a.data&&"visualization"===a.data.type&&b.registerType(a.id,new c({type:a.id,path:"extensions/"+a.id+"/"+a.id,libraryInfo:e(a.id,a.data)}))}function g(g){return null===h&&(h=new a,b.registerType("listbox",new c({type:"listbox",path:"extensions.qliktech/listbox/listbox"})),b.registerType("filterpane",new c({type:"filterpane",path:"extensions.qliktech/filterpane/filterpane",components:["extensions.qliktech/filterpane/properties/filterpane-data/filterpane-data","extensions.qliktech/filterpane/properties/filterpane-sorting/filterpane-sorting"]})),b.registerType("gauge",new c({type:"gauge",path:"extensions.qliktech/gauge/gauge"})),b.registerType("kpi",new c({type:"kpi",path:"extensions.qliktech/kpi/kpi"})),b.registerType("table",new c({type:"table",path:"extensions.qliktech/straight-table/straight-table",components:["extensions.qliktech/straight-table/properties/columns/columns"]})),b.registerType("pivot-table",new c({type:"pivot-table",path:"extensions.qliktech/pivot-table/pivot-table",components:["extensions.qliktech/pivot-table/properties/pivot-data/pivot-data","extensions.qliktech/pivot-table/properties/pivot-sorting/pivot-sorting"]})),b.registerType("barchart",new c({type:"barchart",path:"extensions.qliktech/barchart/barchart"})),b.registerType("piechart",new c({type:"piechart",path:"extensions.qliktech/piechart/piechart"})),b.registerType("scatterplot",new c({type:"scatterplot",path:"extensions.qliktech/scatterplot/scatterplot"})),b.registerType("linechart",new c({type:"linechart",path:"extensions.qliktech/linechart/linechart"})),b.registerType("combochart",new c({type:"combochart",path:"extensions.qliktech/combochart/combochart"})),b.registerType("treemap",new c({type:"treemap",path:"extensions.qliktech/treemap/treemap"})),b.registerType("map",new c({type:"map",path:"extensions.qliktech/map/map",components:["extensions.qliktech/map/properties/layers"]})),b.registerType("text-image",new c({type:"text-image",path:"extensions.qliktech/text-image/text-image"})),b.registerType("widget",new c({type:"widget",path:"extensions.qliktech/widget/widget",libraryInfo:e("widget",{name:"Widget",description:"Qlik Sense Widget",isLibraryItem:!1})})),g?h.resolve():d.getList().then(function(a){a.forEach(function(a){f(a)}),h.resolve()})),h.promise}var h=null;return{load:g,registerExtension:f}}),define("assets/object-renderer/settings-validator",[],function(){function a(a,b){switch(a){case"object":return null!=b&&!Array.isArray(b)&&"object"==typeof b;case"HTMLElement":return b&&b.toString().indexOf("Element]")>-1||!1;case"boolean":return"boolean"==typeof b;case"string":return"string"==typeof b;case"number":return"number"==typeof b;default:throw"Unknown type: "+a}}function b(b,c){for(var d,e,f,g=[],h=0;h<c.length;h++)e=c[h],d=e.param,f=b[d],e.optional||"undefined"!=typeof f?(!e.optional||e.optional&&"undefined"!=typeof f)&&(a(e.type,f)||g.push("Invalid type for parameter: "+d)):g.push("Missing setting: "+d);return g}return{validateSettings:b,validateType:a}}),define("general.utils/qv-activate",["jquery","jqueryoutside","touche"],function(a){function b(b,c,d){return a.Event(b,{pageX:d.pagePoints[0].x,pageY:d.pagePoints[0].y,ctrlKey:c.ctrlKey,metaKey:c.metaKey,shiftKey:c.shiftKey,originalEvent:c,gestureData:d})}var c;Touche(document.body).tap({options:{preventDefault:!1},start:function(b){c=a(b.target)},end:function(a,d){var e=b("qv-activate",a,d);0===c.closest(":disabled").length&&c.trigger(e),c=null}});var d=Touche.Gesture.augment(function(a){function b(){a.apply(this,arguments)}return this.defaults={precedence:6},this.start=function(a,b){this.binder.start.call(this,a,b)},b});Touche.gestures.add("press",d),Touche(document.body).press({start:function(c,d){var e=b("qv-press",c,d);a(c.target).trigger(e)}}),a.addOutsideEvent("qv-press","qv-outside","touchstart","touchend")}),"undefined"==typeof Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{enumerable:!1,get:function(){var a=this.toString().match(/^function( (.*?))?\(/);return a&&a.length>=3?a[2]:"anonymous function"}}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,value:function(a){return-1!==this.indexOf(a)}}),"scrollX"in window.constructor.prototype||Object.defineProperties(window.constructor.prototype,{scrollX:{get:function(){return this.pageXOffset}},scrollY:{get:function(){return this.pageYOffset}}}),define("core.utils/augment",function(){}),define("assets/object-renderer/object-renderer-impl",["jquery","core.utils/deferred","objects.backend-api/snapshot-api","core.models/rpc-base","client.utils/state","objects.utils/type-loader","assets/object-renderer/settings-validator","translator","objects/object","general.utils/qv-activate","core.utils/augment"],function(a,b,c,d,e,f,g,h){function i(a,c){return{session:{currentApp:{layout:{qLocaleInfo:c}}},state:d.States.VALID,layout:a,getLayout:function(){return b.resolve(a)},Invalidated:function(){}}}function j(a){var c=g.validateSettings(a,n);return c.length?b.reject(c):h.setup(a.language)}function k(a){a.snapshotData.content&&delete a.snapshotData.content.size,a.snapshotData.object.freeResize=!0}function l(d){var h=g.validateSettings(d,o);if(h.length)return b.reject(h);d.extensionInfo&&f.registerExtension(d.extensionInfo),k(d.layout);var j=i(d.layout,d.localeInfo),l={APIType:c,_disableSelections:!0,_skipRegisterExtensions:!0,_readStoredData:!0,_hideErrorButton:!0,selections:{_disableSelectionActivation:!0,_enablePanning:!0,toggleRect:!1,swipe:!1,tooltip:{touchTimeout:0}}};d.interactive&&e.setState(e.States.analysis);var n=a(d.element);return n.showComponent(m,{options:l,model:j}),b.resolve()}var m={template:'<qv-object options="options" model="model"></qv-object>',controller:["$scope",function(){}]},n=[{param:"language",type:"string"}],o=[{param:"element",type:"HTMLElement"},{param:"layout",type:"object"},{param:"localeInfo",type:"object"},{param:"element",type:"HTMLElement"},{param:"interactive",type:"boolean",optional:!0},{param:"extensionInfo",type:"object",optional:!0}];return{init:j,renderSnapshot:l}}),define("assets/object-renderer/object-renderer",["js/configloader!assets/object-renderer/object-renderer-impl"],function(a){return a}),define("objects.views/charts/events/event-launcher",["core.utils/class"],function(a){"use strict";return a.extend({init:function(){this._listeners={}},listen:function(a,b,c){return"function"!=typeof b?this:(this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push({callback:b,scope:c}),this)},stopListen:function(a,b,c){var d,e=this._listeners[a];if(e)for(d=e.length-1;d>=0;d-=1)b?(c&&c===e[d].scope&&e[d].callback===b||!c&&e[d].callback===b)&&e.splice(d,1):e.splice(d,1);return this},fire:function(a,b){var c,d,e=a;if("string"!=typeof e&&(e=a.getType()),c=this._listeners[e])for(d=c.length-1;d>=0;--d)"string"==typeof a?c[d].callback.apply(c[d].scope?c[d].scope:this,b||[]):c[d].callback.apply(c[d].scope?c[d].scope:this,[a]);return this},hasListener:function(a){var b=a;return"string"!=typeof b&&(b=a.getType()),this._listeners&&this._listeners[b]&&this._listeners[b].length}})}),define("objects.utils/animation-frame",[],function(){var a=function(a){return window.setTimeout(a,1e3/60)},b=function(a){return window.clearTimeout(a)},c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||a,d=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame||b;return{request:c===a?a:c.bind(window),cancel:d===b?b:d.bind(window)}}),define("objects.views/charts/invalidatable",["core.utils/deferred","./events/event-launcher","objects.utils/animation-frame"],function(a,b,c){"use strict";function d(b,c){var d;this._validating=!0,this._invalidatedProperties&&(!b||b&&b.contains("properties"))&&(d=f.call(this),d&&"function"==typeof d.then&&this._pendingDfds.push(d)),this._invalidatedDisplay&&(!b||b&&b.contains("display"))&&(d=e.call(this),d&&"function"==typeof d.then&&this._pendingDfds.push(d)),this._validating=!1,this._invalidated=this._invalidatedDisplay||this._invalidatedProperties,this._invalidated||(this._pendingDfds.length?(a.all(this._pendingDfds).then(function(){c.__qvState=1,c.resolve()}),this._pendingDfds=[]):(c.__qvState=1,c.resolve()))}function e(){var a=this._updateDisplay();return this._invalidatedDisplay=!1,this.__invalidators.display=[],a}function f(){var a=this._updateProperties();return this._invalidatedProperties=!1,this.__invalidators.properties=[],a}function g(){if(!this._invalidated&&!this._validating&&!this._released){var b,d=this;this._invalidated=!0,b=a(),b.__qvState=0,b.__id=++this._dfdCount,this.dfd=b,this._timer=c.request(function(){d._validate(null,b)})}return this.dfd.promise}return b.extend("Invalidatable",{init:function(){this._super(),this.__invalidators={size:[],display:[],properties:[]},this._pendingDfds=[],this._dfdCount=0},invalidate:function(){return g.call(this)},invalidateProperties:function(a){return this._invalidatedProperties||(this._invalidatedProperties=!0,g.call(this)),this.__invalidators.properties.push(a),this.dfd.promise},invalidateDisplay:function(a){return this._invalidatedDisplay||(this._invalidatedDisplay=!0,g.call(this)),this.__invalidators.display.push(a),this.dfd.promise},validateNow:function(){return this._invalidated=!0,this.updateNow(),this},updateNow:function(a){if(this._invalidated&&!this._validating){var b=a&&a.contains("display")===this._invalidatedDisplay,d=a&&a.contains("properties")===this._invalidatedProperties;(!a||b&&d)&&(c.cancel(this._timer),this._timer=null),this._validate(a,this.dfd)}return this},_update:function(){return this},_updateDisplay:function(){},_updateProperties:function(){},cancel:function(){c.cancel(this._timer),this._invalidatedProperties=!1,this.__invalidators.properties=[],this._invalidatedDisplay=!1,this.__invalidators.display=[],this._invalidated=!1,this.dfd&&(this.dfd.__qvState=2,this.dfd.reject())},release:function(){this._released=!0,this.cancel(),this.dfd=null},_validate:function(a,b){d.call(this,a,b)}})}),define("objects.views/charts/utils/transition-helper",["jquery","core.utils/class","core.utils/deferred"],function(a,b,c){"use strict";function d(b,c,d,g){f.apply(this,[b,c]);var i,j,k,l,m,n=!0,o=!1,p=this;n=h.checkEqual(b,d);for(i in d)void 0===b[i]&&(o=!0);return n?(p._endCallback&&p._endCallback.call(p._scope),void g.resolve()):o?(a.extend(c,d),a.extend(b,d),p._endCallback&&p._endCallback.call(p._scope),void g.resolve()):(j=this._transitionTime,k=Date.now(),this._inAnimation=!0,this._initiateAnimation=!1,this._transitionProgress=0,a.extend(c,e(b,c,d,0)),void(this._animationCallback=setInterval(function(){if(l=(Date.now()-k)/j,l>1)clearInterval(p._animationCallback),a.extend(c,e(b,c,d,1)),p._updateCallback&&p._updateCallback.call(p._scope),p._inAnimation=!1,p._lastFrame=!0,p._transitionProgress=1;else{switch(p._transitionCurve){case"linear":m=l;break;case"easeout":m=Math.sin(Math.PI*l/2);break;case"easein":m=1-Math.cos(Math.PI*l/2);break;default:m=(1+Math.cos(Math.PI*(1+l)))/2}p._transitionProgress=m,a.extend(c,e(b,c,d,m)),p._updateCallback&&p._updateCallback.call(p._scope)}l>1&&(c=a.extend({},d),p._endCallback.call(p._scope),g.resolve())},15)))}function e(b,c,d,f){var g=function(b,c){a.extend(b,e(b,d[i][c],f))},h=function(a,b,c){b[i]=e(a[i],b[i],c[i],f)};if(0>=f)return b;if(f>=1)return d;for(var i in b)b||!d?!b||d?(b[i]instanceof Array?b[i].forEach(g):isNaN(b[i])&&b[i]instanceof Object&&h(b,c,d),b[i]&&!d[i]&&(c[i]=d[i]),null===b[i]||null===d[i]||isNaN(b[i])||isNaN(d[i])||(c[i]=b[i]*(1-f)+d[i]*f)):void 0!==b.opacity&&(c.opacity=1-f):(void 0!==d.opacity&&(c.opacity=f),c=a.extend(c,d));return c}function f(b,c){a.extend(b,c),clearInterval(this._animationCallback),this._inAnimation=!1,this._lastFrame=!1}function g(a,b,c,e){this._inAnimation||this._initiateAnimation&&this._transitionEnabled?d.call(this,a,b,c,e):e.resolve()}var h;return h=b.extend("TransitionHelper",{namespace:".transitionhelper",init:function(a,b,c,d){this._updateCallback=a,this._endCallback=b,this._transitionTime=c?c:500,this._scope=d,this._inAnimation=!1,this._transitionProgress=0,this._lastFrame=!1,this._animationCallback=function(){return null},this._initiateAnimation=!0,this._transitionEnabled=!0,this._transitionDelay=0,this._transitionCurve=""},transition:function(a,b,d,e,h,i){var j=this,k=c();return this._oldValues=a,this._currentValues=b,this._newValues=d,this._updateCallback=h,this._endCallback=e,this._scope=i,f.apply(this,[a,b]),this._initiateAnimation=!0,this._inAnimation||this._lastFrame?k.resolve():this._transitionDelay>0?this._trantisionTimeout=setTimeout(function(){g.apply(j,[a,b,d,k])},this._transitionDelay):g.apply(this,[a,b,d,k]),k.promise},clear:function(){clearInterval(this._animationCallback),clearTimeout(this._trantisionTimeout),this._inAnimation=!1,this._lastFrame=!0,this._transitionProgress=1},setTransitionTime:function(a){this._transitionTime=a},setDelay:function(a){this._transitionDelay=a},setTransitionCurve:function(a){this._transitionCurve=a}}),h.checkEqual=function(a,b){var c;for(c in b){if(!(c in a))return!1;if(typeof b[c]!=typeof a[c])return!1;if(Array.isArray(b[c])){if(!h.checkEqual(a[c],b[c]))return!1}else if(!(b[c]===a[c]||void 0===a[c]||"number"==typeof b[c]&&"number"==typeof a[c]&&isNaN(b[c])&&isNaN(a[c])))return!1}return!0},h}),define("objects.views/charts/utils/node",["core.utils/class"],function(a){var b;return b=a.extend("Node",{init:function(){this._parent=null,this._children=[],this._ancestors=null,this.data={}},detach:function(){return this._parent&&this._parent.removeChild(this),this},each:function(a,b){if("function"!=typeof a||!this._children||!this._children.length)return this;var c,d=this._children.length;for(c=0;d>c;c++)a.call(b,this._children[c],c),this._children[c].isBranch&&this._children[c].each(a,b);return this}}),Object.defineProperties(b.prototype,{parent:{get:function(){return this._parent}},isBranch:{get:function(){return this._children&&this._children.length}},children:{get:function(){return this._children}},siblings:{get:function(){if(!this._parent)return[];var a=this._parent._children.slice();return a.splice(a.indexOf(this),1),a}},ancestors:{get:function(){if(!this._ancestors){var a=this._parent;this._ancestors=a?[a].concat(a.ancestors):[]}return this._ancestors}},descendants:{get:function(){var a,b,c,d=[];for(a=0,b=this._children.length;b>a;a++)c=this._children[a],d.push(c),c._children.length&&(d=d.concat(c.descendants));return d}},leaves:{get:function(){var a,b,c=[],d=this._children.length;for(b=0;d>b;b++)a=this._children[b],a._children&&a._children.length?c=c.concat(a.leaves):c.push(a);return c}}}),b}),define("objects.views/charts/utils/matrix",["core.utils/class"],function(a){var b;return b=a.extend({init:function(){this._elements=[[1,0,0],[0,1,0],[0,0,1]],this._stack=[]},clone:function(){var a=new b;return a.multiply(this._elements)},set:function(a){return this._elements=a,this},save:function(){return this._stack.push(this.elements),this},restore:function(){return this._stack.length&&(this._elements=this._stack.pop()),this},add:function(a){var b,c;for(b=0;b<this._elements.length;b++)for(c=0;c<this._elements[b].length;c++)this._elements[b][c]+=a;return this},translate:function(a,b){return this.multiply([[1,0,a],[0,1,b],[0,0,1]]),this},rotate:function(a){var b=Math.cos(-a),c=Math.sin(-a);return this.multiply([[b,c,0],[-c,b,0],[0,0,1]]),this},skew:function(a,b){var c=Math.tan(a),d=Math.tan(b);return this.multiply([[1,c,0],[d,1,0],[0,0,1]]),this},multiply:function(a){var c,d,e,f;if(a instanceof b&&(a=a._elements),Array.isArray(a)){for(e=[[0,0,0],[0,0,0],[0,0,0]],c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)for(f=0;3>f;f++)e[c][d]+=this._elements[c][f]*a[f][d];this._elements=e}else for(c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)this._elements[c][d]*=a;return this},scale:function(a,b){return(arguments.length<2||"undefined"==typeof b)&&(b=a),this.multiply([[a,0,0],[0,b,0],[0,0,1]]),this},determinant:function(){var a=this._elements[0][0],b=this._elements[0][1],c=this._elements[0][2],d=this._elements[1][0],e=this._elements[1][1],f=this._elements[1][2],g=this._elements[2][0],h=this._elements[2][1],i=this._elements[2][2],j=0;return j=a*e*i+b*f*g+c*d*h-c*e*g-b*d*i-a*f*h},invert:function(){var a=this.determinant(),b=this._elements[0][0],c=this._elements[0][1],d=this._elements[0][2],e=this._elements[1][0],f=this._elements[1][1],g=this._elements[1][2],h=this._elements[2][0],i=this._elements[2][1],j=this._elements[2][2];return this._elements=[[f*j-g*i,d*i-c*j,c*g-d*f],[g*h-e*j,b*j-d*h,d*e-b*g],[e*i-f*h,h*c-b*i,b*f-c*e]],this.multiply(1/a),this},transpose:function(){var a=Object.create(this._elements);return this._elements=[[a[0][0],a[1][0],a[2][0]],[a[0][1],a[1][1],a[2][1]],[a[0][2],a[1][2],a[2][2]]],this},identity:function(){return this._elements=[[1,0,0],[0,1,0],[0,0,1]],this},transformPoint:function(a){var b,c,d=[a.x,a.y,1],e=this._elements,f=[0,0,0];for(b=0;b<this._elements.length;b++)for(c=0;c<this._elements[b].length;c++)f[b]+=d[c]*e[b][c];return{x:f[0],y:f[1]}},transformPoints:function(a){var b,c,d,e,f,g=this._elements,h=[];for(e=0;e<a.length;e++){for(b=[a[e].x,a[e].y,1],f=[0,0,0],c=0;c<this._elements.length;c++)for(d=0;d<this._elements[c].length;d++)f[c]+=b[d]*g[c][d];h.push({x:f[0],y:f[1]})}return h},toString:function(){var a="";return this._elements.forEach(function(b,c,d){a+=b.join("	")+(c<d.length?"\n":"")}),a}}),Object.defineProperties(b.prototype,{elements:{get:function(){var a=this._elements;return[[a[0][0],a[0][1],a[0][2]],[a[1][0],a[1][1],a[1][2]],[a[2][0],a[2][1],a[2][2]]]}}}),b}),define("objects.views/charts/utils/node-selector",["general.utils/property-resolver"],function(a){"use strict";var b={className:/^\w[\w-]+/,attr:/^\[\w(?:[\w\._-]+)?(?:[!]?=['\"][\w\s*#_-]*['\"])?\]/},c={className:function(a,b){return b.filter(function(b){var c=b.constructor.name;if(c){var d=a.replace(/(\-[a-z])/g,function(a){return a[1].toUpperCase()});return d=d[0].toUpperCase()+d.slice(1),c===a||c===d}})},attr:function(b,c,d,e){return e.filter(function(e){var f=a.getValue(e,b);if(!c)return"undefined"!=typeof f;if("undefined"==typeof f)return!1;switch(c){case"=":return d===String(f);case"!=":return d!==String(f)}return!1})}},d={find:function(a,b){var c,d,e=[],f=[];return b.isBranch&&(c=this._tokenize(a),d=b.descendants,c.forEach(function(a){var b=d.slice(),c=[],e=!1;a.reverse().forEach(function(a){return" "===a.type?(c.push(b),b=d.slice(),void(e=!1)):(b=this._filter(a,b),void(e=!0))},this),e&&c.push(b);var g=c[0].filter(function(a){var b,d,e=a.parent;for(b=1;b<c.length;b++){for(;e&&(d=c[b].indexOf(e))<0;)e=e.parent;if(0>d)return!1}return!0});f.push(g)},this),f.forEach(function(a){a.forEach(function(a){e.indexOf(a)<0&&e.push(a)})})),e||[]},_filter:function(a,b){if(!b||!b.length||!a||"function"!=typeof c[a.type])return[];switch(a.type){case"className":return c[a.type](a.value,b);case"attr":return c[a.type](a.attribute,a.operator,a.attributeValue,b)}return[]},_tokenize:function(a){var c,d,e,f,g=[];return a.split(/\s*,\s*/).forEach(function(a){for(a=a.trim(),c=[];a;){f=!1,e=a.match(/^\s*([>+~]|\s)\s*/),e&&(f=!0,c.push({type:" ",value:e[0]}),a=a.slice(e[0].length));for(var h in b)e=a.match(b[h]),e&&(f=!0,a=a.slice(e[0].length),d={type:h,value:e[0]},"attr"===h&&(e=e[0].match(/\[(\w[\w\._-]+)?(?:([!]?=)['\"]([\w\s#_-]*)['\"])?\]/),d.attribute=e[1],d.operator=e[2],d.attributeValue=e[3]),c.push(d));if(c&&c.length&&g.indexOf(c)<0&&g.push(c),!f)break}}),g}};return d}),define("objects.views/charts/shapes/display-object",["objects.views/charts/utils/node","objects.views/charts/utils/matrix","objects.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(a,b,c,d){"use strict";function e(){this.matrix=new b,this.scale=g.scale,this.rotate=g.rotate,this.translate=g.translate,this._dirtyBounds=!0}var f,g={translate:function(a,b){return this.matrix.translate(a,b),this._dirtyBounds=!0,this.invalidate(),this},rotate:function(a){return this.matrix.rotate(a),this._dirtyBounds=!0,this.invalidate(),this},scale:function(a,b){return this.matrix.scale(a,b),this._dirtyBounds=!0,this.invalidate(),this}};return f=a.extend("DisplayObject",{init:function(){this._super(),this._dirtyBounds=!0,this._bounds=new c(NaN,NaN,NaN,NaN),this._vmBounds=new c(NaN,NaN,NaN,NaN),this._visualBounds=new c(NaN,NaN,NaN,NaN),this._stage=null,this.rData={inherited:{}},this._modelView=null,this._inverseModelView=null,this._inheritedProps={}},find:function(a){return d.find(a,this)},translate:function(a,b){return 0===a&&0===b?this:(e.call(this),g.translate.call(this,a,b))},rotate:function(a){return isNaN(a)||0===a?this:(e.call(this),g.rotate.call(this,a))},scale:function(a,b){return 1===a?this:(e.call(this),g.scale.call(this,a,b))},clearTransform:function(){return this.matrix&&(this.matrix.identity(),this._dirtyBounds=!0,this.invalidate()),this},invalidate:function(){var a=this._stage||this.stage;return a&&a.invalidateObject(this),this._inheritedProps={},this},attr:function(a){return"undefined"!=typeof this[a]?this[a]:"undefined"!=typeof this.rData.inherited[a]?this.rData.inherited[a]:void 0},attrs:function(a){for(var b in a)"undefined"==typeof a[b]?delete this[b]:this[b]=a[b];return this},getBoundingRect:function(){return this._dirtyBounds&&this._calculateBounds(),this._vmBounds},getVisualBounds:function(){return this._dirtyBounds&&this._calculateBounds(),this._visualBounds},getVisualExpansion:function(){var a,b=this.attr("stroke");return b?(a=this.attr("strokeWidth"),a?a/2:0):0},pointInside:function(a,b){if(this.visible===!1)return!1;var c,d=this.getInverseModelView();return d&&this._transformedIncomingPoint!==!0?(c=d.transformPoint({x:a,y:b}),this.containsPoint(c.x,c.y)):this.containsPoint(a,b)},intersectsLine:function(a){if(this.visible===!1)return!1;var b,c,d,e=this.getInverseModelView();return e&&this._transformedIncomingPoint!==!0?(c=e.transformPoint({x:a.x1,y:a.y1}),d=e.transformPoint({x:a.x2,y:a.y2}),a=a.clone(),a.set(c.x,c.y,d.x,d.y),this._transformedIncomingPoint=!0,b=this.intersectsLocalLine(a),delete this._transformedIncomingPoint,b):this.intersectsLocalLine(a)},intersectsRect:function(a){if(this.visible===!1)return!1;var b,c,d=this.getInverseModelView();return d&&this._transformedIncomingPoint!==!0?(this._transformedIncomingPoint=!0,b=this._getTransformedBoundsOfRect(d,a),c=this.intersectsLocalRect(b),delete this._transformedIncomingPoint,c):this.intersectsLocalRect(a)},getPoints:function(){if(this.visible===!1)return[];var a,b,c,d=this.getModelView();if(d){for(a=this.getLocalPoints(),b=0,c=a?a.length:0;c>b;b++)a[b]=d.transformPoint(a[b]);return a}return this.getLocalPoints()},getLocalPoints:function(){return[]},intersectsLocalLine:function(){return!1},intersectsLocalRect:function(a){var b,c="function"==typeof a.getPoints?a.getPoints():[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}],d=c.length;for(b=0;d>b;b++)if(this.containsPoint(c[b].x,c[b].y))return!0;for(c=this.getLocalPoints(),d=c.length,b=0;d>b;b++)if(c[b].x>=a.x&&c[b].x<=a.x+a.width&&c[b].y>=a.y&&c[b].y<=a.y+a.height)return!0;return!1},containsPoint:function(){return!1},getLocalBoundingRect:function(){return this._bounds},invalidateBounds:function(){return this._dirtyBounds=!0,this},clearModelView:function(){this._modelView=null,this._inverseModelView=null,this._isModelViewCalculated=!1,this._dirtyBounds=!0},getModelView:function(){return this._modelView||this._isModelViewCalculated||this._calculateModelView(),this._modelView},getInverseModelView:function(){
return this._inverseModelView||this._isModelViewCalculated||this._calculateModelView(),this._inverseModelView},destroy:function(){this._stage=null},_calculateBounds:function(){var a,b=this._bounds,c=this.getLocalBoundingRect(),d=this.getModelView(),e=this.getVisualExpansion();c?(b.set(c.x,c.y,c.width,c.height),d?(a=this._getTransformedBoundsOfRect(d,b),this._vmBounds.set(a.x,a.y,a.width,a.height),a=this._getTransformedBoundsOfRect(d,{x:b.x-e,y:b.y-e,width:b.width+2*e,height:b.height+2*e}),this._visualBounds.set(a.x,a.y,a.width,a.height)):(this._vmBounds.set(c.x,c.y,c.width,c.height),this._visualBounds.set(c.x-e,c.y-e,c.width+2*e,c.height+2*e))):(b.set(NaN,NaN,NaN,NaN),this._vmBounds.set(NaN,NaN,NaN,NaN),this._visualBounds.set(NaN,NaN,NaN,NaN)),this._dirtyBounds=!1},_getTransformedBoundsOfRect:function(a,b){var d,e,f,g,h,i,j;return d=a.transformPoints([{x:b.x,y:b.y},{x:b.x+b.width,y:b.y},{x:b.x+b.width,y:b.y+b.height},{x:b.x,y:b.y+b.height}]),e=d.map(function(a){return a.x}),f=d.map(function(a){return a.y}),g=Math.min.apply(null,e),i=Math.max.apply(null,e),h=Math.min.apply(null,f),j=Math.max.apply(null,f),new c(g,h,i-g,j-h)},_calculateModelView:function(){for(var a=this;a&&!a.rData.vmTransform;)a=a._parent;return this._isModelViewCalculated=!0,a?(a._modelView||(a._modelView=new b,a._inverseModelView=new b),a.rData.dirtyVMTransform&&(a._modelView.set(a.rData.vmTransform),a._inverseModelView.set(a.rData.vmTransform).invert(),delete a.rData.dirtyVMTransform),this._modelView=a._modelView,this._inverseModelView=a._inverseModelView,!0):!1}}),Object.defineProperties(f.prototype,{stage:{get:function(){return this._parent&&!this._stage?this._stage=this._parent.stage:this._parent||this._stage===this||(this._stage=null),this._stage}}}),f}),define("objects.utils/shapes/circle",["./rect"],function(a){"use strict";function b(a,b,c){0===arguments.length?this.set(0,0,0):this.set(a,b,c)}return b.prototype={toString:function(){return this.cx+" "+this.cy+" "+this.r},clone:function(){return new b(this.cx,this.cy,this.r)},set:function(a,b,c){this.cx=a,this.cy=b,this.r=c,this.radius=c},setPosition:function(a,b){this.cx=a,this.cy=b},setRadius:function(a){this.radius=a},combineWith:function(){},intersectsWith:function(a){return a.pointInside(this.cx,this.cy)},intersectsRect:function(a){return a.pointInside(this.cx,this.cy)},intersectsLine:function(a){if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var b,c,d,e,f,g,h,i;if(b=Math.sqrt(Math.pow(a.x2-a.x1,2)+Math.pow(a.y2-a.y1,2)),c=(a.x2-a.x1)/b,d=(a.y2-a.y1)/b,e=c*(this.cx-a.x1)+d*(this.cy-a.y1),f=c*(this.cx-a.x2)+d*(this.cy-a.y2),e>=0&&1>=f){if(g=e*c+a.x1,h=e*d+a.y1,i=Math.sqrt(Math.pow(g-this.cx,2)+Math.pow(h-this.cy,2)),i<=this.r)return!0}else if(f>=0&&1>=f&&(g=f*c+a.x2,h=f*d+a.y2,i=Math.sqrt(Math.pow(g-this.cx,2)+Math.pow(h-this.cy,2)),i<=this.r))return!0;return!1},pointInside:function(a,b){var c=Math.sqrt(Math.pow(this.cx-a,2)+Math.pow(this.cy-b,2));return c<=this.r},getPoints:function(){return[{x:this.cx,y:this.cy}]},getBoundingRect:function(){return new a(this.cx-this.r,this.cy-this.r,2*this.r,2*this.r)}},b}),define("objects.views/charts/utils/vector",["core.utils/class"],function(a){var b;return b=a.extend({init:function(a,b){this.x=a||0,this.y=b||0},clone:function(){return new b(this.x,this.y)},add:function(a){this.x+=a.x,this.y+=a.y},dot:function(a){return this.x*a.x+this.y*a.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),b.add=function(a,b){return a.clone().add(b)},b}),define("objects.utils/shapes/arc",["./line","./circle","./rect","objects.views/charts/utils/vector"],function(a,b,c,d){"use strict";function e(a,b,c,d,e,f,g){this.cx=a,this.cy=b,this.innerRadius=c,this.radius=d,this.radianOffset=(0>g?g+2*Math.PI:g)%(2*Math.PI),this.start=e,this.start-=this.start>Math.PI?2*Math.PI:0,this.end=f,this.end-=this.end>Math.PI?2*Math.PI:0,this.arcCenter=(e+f)/2%(2*Math.PI),this.x1=a+d*Math.cos(this.start+this.radianOffset),this.y1=b+d*Math.sin(this.start+this.radianOffset),this.x2=a+d*Math.cos(this.end+this.radianOffset),this.y2=b+d*Math.sin(this.end+this.radianOffset),this.x3=a+c*Math.cos(this.start+this.radianOffset),this.y3=b+c*Math.sin(this.start+this.radianOffset),this.x4=a+c*Math.cos(this.end+this.radianOffset),this.y4=b+c*Math.sin(this.end+this.radianOffset)}var f=["top","left","bottom","right"],g={top:"left",left:"bottom",bottom:"right",right:"top"},h={top:"right",left:"top",bottom:"left",right:"bottom"};return e.prototype={getDistance:function(a,b,c,d){var e=Math.abs(a-c),f=Math.abs(b-d),g=Math.sqrt(Math.pow(e,2)+Math.pow(f,2));return g},getAngle:function(a,b,c,d){var e=a-c,f=b-d,g=Math.atan2(f,e)-this.radianOffset;return g=0>g?g+2*Math.PI:g,g=g>Math.PI?g-2*Math.PI:g},pointInside:function(a,b){var c=this.getAngle(a,b,this.cx,this.cy),d=this.getDistance(a,b,this.cx,this.cy),e=this.start,f=this.end;return d>this.radius||d<this.innerRadius?!1:c>=e&&f>=c?!0:e>f&&(f>=c||c>=e)?!0:!1},getDirection:function(a){a+=Math.PI/4,0>a&&(a+=2*Math.PI),a%=2*Math.PI;var b=3;return a>=1.5*Math.PI?b=0:a>=Math.PI?b=1:a>=Math.PI/2&&(b=2),f[b]},getSecondaryDirection:function(a){var b=this.getDirection(a);return a+=Math.PI/4,a%(Math.PI/2)>Math.PI/4?h[b]:g[b]},getPoints:function(){var a=[];return a.push({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},{x:this.x3,y:this.y3},{x:this.x4,y:this.y4}),a},getBoundingRect:function(){var a=Math.min(Math.min(this.x1,this.x2),Math.min(this.x3,this.x4)),b=Math.min(Math.min(this.y1,this.y2),Math.min(this.y3,this.y4)),d=Math.max(Math.max(this.x1,this.x2),Math.max(this.x3,this.x4))-a,e=Math.max(Math.max(this.y1,this.y2),Math.max(this.y3,this.y4))-b;return new c(a,b,d,e)},getRelevantPosition:function(){var a=this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),b=this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset);return{pos:{x:a,y:b},direction:[this.getDirection(this.arcCenter+this.radianOffset),this.getSecondaryDirection(this.arcCenter+this.radianOffset)]}},intersectsWith:function(b){return this.intersectsLine(new a(b.x,b.y,b.x+b.width,b.y))||this.intersectsLine(new a(b.x+b.width,b.y,b.x+b.width,b.y+b.height))||this.intersectsLine(new a(b.x,b.y+b.height,b.x+b.width,b.y+b.height))||this.intersectsLine(new a(b.x,b.y,b.x,b.y+b.height))},intersectsLine:function(c){if(this.pointInside(c.x1,c.y1)||this.pointInside(c.x2,c.y2))return!0;if(c.intersectsLine(new a(this.x1,this.y1,this.x4,this.y4))||c.intersectsLine(new a(this.x3,this.y3,this.x2,this.y2)))return!0;var e=new b(this.cx,this.cy,this.innerRadius);if(this.innerRadius>0&&e.pointInside(c.x1,c.y1)&&e.pointInside(c.x2,c.y2))return!1;var f,g,h,i,j=new d(c.x2-c.x1,c.y2-c.y1),k=new d(c.x1-this.cx,c.y2-this.cy),l=j.dot(j),m=2*k.dot(j),n=k.dot(k)-this.radius*this.radius,o=m*m-4*l*n,p=[];if(0>o)return!1;if(o=Math.sqrt(o),g=(-m-o)/(2*l),h=(-m+o)/(2*l),g>=0&&1>=g&&p.push({x:c.x1+g*j.x,y:c.y1+g*j.y}),h>=0&&1>=h&&p.push({x:c.x1+h*j.x,y:c.y1+h*j.y}),!p.length)return!1;for(f=0;f<p.length;f++){if(i=this.getAngle(p[f].x,p[f].y,this.cx,this.cy),i>=this.start&&i<=this.end)return!0;if(this.start>this.end&&(i<=this.end||i>=this.start))return!0}return!1}},e}),define("objects.views/charts/shapes/arc",["objects.views/charts/shapes/display-object","objects.utils/shapes/arc"],function(a,b){"use strict";var c,d=Math.PI/2,e=3*Math.PI/2,f=2*Math.PI;return c=a.extend("Arc",{init:function(a,c,d,e,f,g,h){this._super(),b.apply(this,[a,c,d,e,f,g,h])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,getLocalPoints:b.prototype.getPoints,intersectsLocalRect:function(a){return b.prototype.intersectsWith.call(this,a)},getLocalBoundingRect:function(){var a,b,c=[this.x1,this.x2,this.x3,this.x4],g=[this.y1,this.y2,this.y3,this.y4],h=(this.start+this.radianOffset)%f,i=h+this.end-this.start;return(f>h&&i>f||0>h&&i>0)&&c.push(this.cx+this.radius),d>h&&i>d&&g.push(this.cy+this.radius),h<Math.PI&&i>Math.PI&&c.push(this.cx-this.radius),(e>h&&i>e||-d>h&&i>-d)&&g.push(this.cy-this.radius),a=Math.min.apply(null,c),b=Math.min.apply(null,g),{x:a,y:b,width:Math.max.apply(null,c)-a,height:Math.max.apply(null,g)-b}},getRelevantPosition:function(){var a=this.getModelView(),b=this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),c=this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset),d={x:b,y:c};return a&&(d=a.transformPoint(d)),{pos:{x:d.x,y:d.y},direction:[this.getDirection(this.arcCenter+this.radianOffset),this.getSecondaryDirection(this.arcCenter+this.radianOffset)]}},set:function(){b.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints","getRelevantPosition","intersectsRect"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/components/chart-component",["../invalidatable","objects.views/charts/utils/transition-helper","objects.utils/shapes/rect","objects.views/charts/shapes/arc","objects.utils/layout","core.utils/deferred","jquery"],function(a,b,c,d,e,f,g){"use strict";function h(a){if(this._$renderAreaWrap){this.containerRect=new c(this.rect.x*this.layoutToContainerRatios.x||1,this.rect.y*this.layoutToContainerRatios.y||1,this.rect.width*this.layoutToContainerRatios.x||1,this.rect.height*this.layoutToContainerRatios.y||1),this.container.style.left=this.containerRect.x+"px",this.container.style.top=this.containerRect.y+"px",this.container.style.width=this.containerRect.width+"px",this.container.style.height=this.containerRect.height+"px";var b=this.isVisible(a)&&0!==this.rect.width&&0!==this.rect.height?"block":"none";this.container.style.display!==b&&(this.container.style.display=b)}}function i(a,c){return b.checkEqual(a,c)}function j(a){return a?(a=a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()}),a.replace(/^\-/,"")):""}var k;return k=a.extend("ChartComponent",{init:function(a,d,e){this._super(),this.testId=e,this.options=g.extend(!0,{},{dock:"center",show:!0,relevantSize:0,showFlag:this.ShowFlags.SPARK,components:{}},d),this.rect=new c,this._transitionHelper=new b,this._transitionHelper.setTransitionCurve("easein"),this._oldProperties={},this._currentProperties={},this._transitionProperties={},this._useTransition=!1,this.outerRect=new c,this.containerRect=new c,this.layoutToContainerRatios={x:1,y:1},this.renderers={},this.dock=this.options.dock,this.show=this.options.show,this.isMini=this.options.isMini,this.relevantSize=this.options.relevantSize,this.showFlag=this.options.showFlag,this.layoutOrder=this.options.order||1,this.reductionOrder=this.options.reductionOrder,this.parentContainer=a,this.components=this.options.components,this.selectionIdentifier=this.options.label,this._selectionIndices=[0],this.chartFormatter=null,this.measureFormatters=[],this._globalAlpha=1,this._hasValidData=!1,this._createRenderArea();try{var f=d&&d.tcl?d.tcl:j(this.constructor.name);f&&this._$renderAreaWrap[0].setAttribute("tcl",f)}catch(h){}this.chartScale=1,this._edgeBleed={top:0,bottom:0,left:0,right:0}},ShowFlags:{SPARK:1,XSMALL:2,SMALL:4,MEDIUM:8,FULL:16},setData:function(a){return this._data=a,this.invalidateProperties("ChartComponent.setData")},getTransformedShape:function(a){var b,e=this.layoutToContainerRatios.x||1,f=this.layoutToContainerRatios.y||1;if(a instanceof c)b=new c(a.x*e,a.y*f,a.width*e,a.height*f);else if(a instanceof d){var g=a.getModelView(),h={x:a.cx*e,y:a.cy*f};g&&(h=g.transformPoint(h)),b=new d(h.x,h.y,Math.min(e,f)*a.innerRadius,Math.min(e,f)*a.radius,a.start,a.end,a.radianOffset)}return b},getTransformedPoint:function(a,b){return{x:a*this.layoutToContainerRatios.x||1,y:b*this.layoutToContainerRatios.y||1}},getOriginalPoint:function(a,b){return{x:a/this.layoutToContainerRatios.x||1,y:b/this.layoutToContainerRatios.y||1}},setLayoutMode:function(a){if(this._layoutMode!==a){this._layoutMode=a;var b=/\s*qv-layout-\S+\s*/g,c=this._layoutMode?" qv-layout-"+e.getLayoutModeKey(a):"";this.container.className.match(b)?this.container.className=this.container.className.replace(/\s*qv-layout-\S+\s*/g,c):this.container.className+=c,this.invalidateDisplay("ChartComponent.setLayoutMode")}},getLayoutMode:function(){return this._layoutMode},setVerticalLayoutMode:function(a){this._verticalLayoutMode=a},setHorizontalLayoutMode:function(a){this._horizontalLayoutMode=a},setSelectableShapes:function(a){this._selectableShapes=a},getSelectableShapes:function(){return this._selectableShapes||[]},getSelectedCacheItems:function(){var a,b=this._selectableShapes?this._selectableShapes.length:0,c=[];for(a=0;b>a;a++)this._selectableShapes[a].selected&&c.push(this._selectableShapes[a]);return c},getRect:function(){return this.rect},setRect:function(a,b,c,d){this.rect.set(a,b,c,d)},setUseTransition:function(a){this._useTransition=a},getTransitionHelper:function(){return this._transitionHelper},setOuterRect:function(a,b,c,d){this.outerRect.set(a,b,c,d)},setLayoutToContainerRatios:function(a,b){this.layoutToContainerRatios={x:a,y:b}},setContainerRect:function(a,b,c,d){this.containerRect.set(a,b,c,d)},setSelectionIndices:function(a){if(!(a&&a instanceof Array))throw"invalid input, selectionsIndices has to be an Array";this._selectionIndices=a},getSelectionIndices:function(){return this._selectionIndices},setDock:function(a){switch(a){case"left":case"top":case"right":case"bottom":case"center":break;default:throw a+" invalid parameter"}this.options.dock=a,this.dock=a},getOppositeDock:function(){var a=this.options.dock;switch(a){case"left":return"right";case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"center":return"center";default:throw a+" invalid parameter"}},isHorizontal:function(){var a=this.options.dock;switch(a){case"top":case"bottom":return!0;default:return!1}},isVertical:function(){var a=this.options.dock;switch(a){case"left":case"right":return!0;default:return!1}},showComponent:function(){if(this.show=this.options.show,this.renderers)for(var a in this.renderers)this.renderers[a].show()},hideComponent:function(){if(this.show=!1,this.renderers)for(var a in this.renderers)this.renderers[a].hide()},getFormatter:function(){return this._formatter||this.measureFormatters[0]||{format:function(a){return a.toString()}}},isVisible:function(a){void 0===a&&(a=this._layoutMode);var b=this.showFlag,c=a;return"object"==typeof b&&("whenVertical"in b&&(b=this.isVertical()?b.whenVertical:b.whenHorizontal),"vertical"in b)?this.show&&!!(b.vertical&this._verticalLayoutMode)&&!!(b.horizontal&this._horizontalLayoutMode):this.show&&!!(b&c)},setHasValidData:function(a){this._hasValidData=a},hasValidData:function(){return this._hasValidData},calculateRelevantSize:function(){this.relevantSize=this.options.relevantSize},reduceLayoutRect:function(a){switch(this.dock){case"top":a.y+=this.relevantSize,a.height-=this.relevantSize;break;case"bottom":a.height-=this.relevantSize;break;case"left":a.x+=this.relevantSize,a.width-=this.relevantSize;break;case"right":a.width-=this.relevantSize}},insertAdjacentTo:function(a,b){switch(this.dock){case"top":this.rect.x=a.x,this.rect.y=a.y-this.relevantSize,this.rect.width=a.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,b&&(a.y-=this.relevantSize,a.height+=this.relevantSize);break;case"bottom":this.rect.x=a.x,this.rect.y=a.getBottom(),this.rect.width=a.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,b&&(a.height+=this.relevantSize);break;case"left":this.rect.x=a.x-this.relevantSize,this.rect.y=a.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=a.height,b&&(a.x-=this.relevantSize,a.width+=this.relevantSize);break;case"right":this.rect.x=a.getRight(),this.rect.y=a.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=a.height,b&&(a.width+=this.relevantSize);break;case"center":this.rect.x=a.x,this.rect.y=a.y,this.rect.width=a.width,this.rect.height=a.height}},_updateProperties:function(){return this._transition()},_updateDisplay:function(){return this.hasValidData()&&this.isVisible(this._layoutMode)&&this.rect.width>0&&this.rect.height>0?this.paint(this._layoutMode,this._data):f.resolve()},updateSize:function(){h.call(this,this._layoutMode);for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},_transition:function(){this._useTransition?i(this._currentProperties,this._transitionProperties)?this._onAnimatitonEnd():(this._inTransition=!0,this._transitionHelper.transition(this._oldProperties,this._currentProperties,this._transitionProperties,this._onAnimatitonEnd,this._updateDisplay,this)):(g.extend(this._currentProperties,this._transitionProperties),g.extend(this._oldProperties,this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd"))},paint:function(){},setGlobalOpacity:function(a,b){this._globalAlpha=a,b||this.invalidateDisplay("ChartComponent.setGlobalOpacity")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=g(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container))},_onAnimatitonEnd:function(){this._inTransition=!1,this._oldProperties=g.extend(!0,{},this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd")},release:function(){if(this._super(),this.renderers)for(var a in this.renderers)this.renderers[a].release()},clear:function(){var a=[];if(this.renderers)for(var b in this.renderers)a.push(this.renderers[b].clear());return f.all(a)},on:function(){},off:function(){}})}),define("objects.views/charts/shapes/polygon",["objects.views/charts/shapes/display-object","objects.utils/shapes/polygon","objects.utils/shapes/line"],function(a,b){"use strict";var c;return c=a.extend("Polygon",{init:function(a){this._super(),a?this.set(a):this._polygons=[]},getLocalBoundingRect:function(){var a;return this._polygons&&this._polygons.length?(a=this._polygons.reduce(function(a,b){return a.combineWith(b.getBoundingRect())},this._polygons[0].getBoundingRect()),{x:a.x,y:a.y,width:a.width,height:a.height}):void 0},getLocalPoints:function(){return this._polygons&&this._polygons[0]?this._polygons[0].points:[]},set:function(a){var c=a&&a[0]&&Array.isArray(a[0])?a:[a];this._polygons=c.map(function(a){return new b(a)}),this.invalidateBounds()},intersectsLocalLine:function(a){return this._polygons.some(function(b){return b.intersectsLine(a)})},intersectsLocalRect:function(a){return this._polygons.some(function(c){return b.prototype.intersectsRect.call(c,a)})},containsPoint:function(a,b){return this._polygons.some(function(c){return c.pointInside(a,b)})}})}),define("objects.views/charts/utils/tree-node",["objects.views/charts/utils/node"],function(a){"use strict";var b,c;return b=a.extend("TreeNode",{addChild:function(b){if(!(b&&b instanceof a))throw new TypeError("Expecting a Node as argument, but got "+b);if(b===this)throw"Can not add itself as child!";if(b._children&&b._children.length&&this.ancestors.indexOf(b)>=0)throw"Can not add an ancestor as child!";return b._parent&&b._parent!==this&&b._parent.removeChild(b),c=this._children.indexOf(b),c>=0&&this._children.splice(c,1),this._children.push(b),b._parent=this,b._ancestors=null,this},addChildren:function(a){var b,c=a?a.length:0;for(b=0;c>b;b++)this.addChild(a[b]);return this},removeChild:function(a){return c=this._children.indexOf(a),c>=0&&(this._children.splice(c,1),a._parent=null,a._ancestors=null),this},removeChildren:function(a){var b,c;if(!this._children)return this;if(a)for(c=a.length,b=0;c>b;b++)this.removeChild(a[b]);else for(;this._children.length;)this.removeChild(this._children[0]);return this}})}),define("objects.views/charts/shapes/container",["objects.views/charts/shapes/display-object","objects.views/charts/utils/tree-node"],function(a,b){"use strict";var c,d;return c=a.extend("Container",{init:function(){this._super()},addChild:function(a){b.prototype.addChild.call(this,a),this.doInvalidate&&a.invalidate()},addChildren:b.prototype.addChildren,removeChild:function(a){this.doInvalidate&&a.invalidate(),a._stage=null;var c,d=a.descendants,e=d?d.length:0;for(c=0;e>c;c++)d[c]._stage=null;return b.prototype.removeChild.call(this,a),this},removeChildren:function(a){var b,c,d,e,f;if(!this._children)return this;if(a)for(d=a.length,b=0;d>b;b++)this.removeChild(a[b]);else{for(d=this._children.length,b=0;d>b;b++)for(this._children[b]._parent=null,this._children[b]._ancestors=null,this._children[b]._stage=null,e=this._children[b].descendants,f=e?e.length:0,c=0;f>c;c++)e[c]._stage=null;this._children.length=0}return this},containsPoint:function(a,b){if(this._children&&this._children.length)for(var c=0,d=this._children.length;d>c;c++)if(this._children[c].containsPoint(a,b))return!0;return!1},intersectsLocalRect:function(a){if(this._children&&this._children.length)for(var b=0,c=this._children.length;c>b;b++)if(this._children[b].intersectsLocalRect(a))return!0;return!1},intersectsLocalLine:function(a){if(this._children&&this._children.length)for(var b=0,c=this._children.length;c>b;b++)if(this._children[b].intersectsLocalLine(a))return!0;return!1},getLocalPoints:function(){var a=[];if(this._children&&this._children.length)for(var b=0,c=this._children.length;c>b;b++)a=a.concat(this._children[b].getLocalPoints());return a},getLocalBoundingRect:function(){var a,b,c,e,f,g,h,i=!1;if(this._children&&this._children.length){for(g=0,h=this._children.length;h>g;g++)f=this._children[g].getVisualBounds(),f&&!isNaN(f.width+f.height+f.x+f.y)&&(i?(a=Math.min(a,f.x),c=Math.max(c,f.x+f.width),b=Math.min(b,f.y),e=Math.max(e,f.y+f.height)):(a=f.x,c=f.x+f.width,b=f.y,e=f.y+f.height,i=!0));return i?{x:a,y:b,width:c-a,height:e-b}:d}return d},_calculateBounds:function(){var a=this._bounds,b=this.getLocalBoundingRect(),c=0;b?(a.set(b.x,b.y,b.width,b.height),this._vmBounds.set(b.x,b.y,b.width,b.height),this._visualBounds.set(b.x-c,b.y-c,b.width+2*c,b.height+2*c)):(a.set(NaN,NaN,NaN,NaN),this._vmBounds.set(NaN,NaN,NaN,NaN),this._visualBounds.set(NaN,NaN,NaN,NaN)),this._dirtyBounds=!1}})}),define("objects.views/charts/renderers/stage",["objects.views/charts/shapes/container","objects.utils/shapes/rect","core.utils/notification"],function(a,b,c){var d;return d=a.extend("Stage",{init:function(){this._super(),this._stage=this,this._dimensions=new b(0,0,0,0),c.create(this,"Invalid")},invalidateObject:function(a){return this.Invalid.emit(a),this},destroy:function(){this._super(),c.release(this)}})}),define("objects.views/charts/renderers/renderer",["core.utils/class","objects.views/charts/renderers/stage","objects.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(a,b,c,d){"use strict";var e;return e=a.extend("Renderer",{init:function(){this._stage=new b,this._stageBinding=function(a){this.invalidateObject(a)}.bind(this),this._stage.Invalid.bind(this._stageBinding),this.scaling={x:1,y:1},this._size=new c,this._extendedSize=new c},find:function(a){return d.find(a,this._stage)},setDimensions:function(a,b,c,d){this._size.set(a,b,c,d)},setDimensionsToContainerRatio:function(a,b){this.scaling={x:a,y:b}},release:function(){this._stage&&this._stage.Invalid&&this._stage.Invalid.unbind(this._stageBinding),this._stage.destroy(),this._stageBinding=null},render:function(){},clear:function(){},invalidateObject:function(){}}),Object.defineProperties(e.prototype,{stage:{get:function(){return this._stage}}}),e}),define("objects.views/charts/shapes/rect",["objects.views/charts/shapes/display-object","objects.utils/shapes/rect"],function(a,b){"use strict";var c;return c=a.extend("Rect",{init:function(a,c,d,e,f){this._super(),this._radius=f||0,b.apply(this,[a,c,d,e])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,intersectsLocalRect:b.prototype.intersectsRect,getLocalBoundingRect:b.prototype.getBoundingRect,getLocalPoints:b.prototype.getPoints,set:function(a,c,d,e,f){b.prototype.set.apply(this,[a,c,d,e]),f>=0&&(this._radius=f),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/rect",["objects.views/charts/shapes/rect"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){if(this._radius){var d=this.x,e=this.y,f=this.width,g=this.height,h=Math.min(this._radius,f/2,g/2),i=d+f,j=e+g;a.beginPath(),a.moveTo(d+h,e),a.quadraticCurveTo(d,e,d,e+h),a.lineTo(d,j-h),a.quadraticCurveTo(d,j,d+h,j),a.lineTo(i-h,j),a.quadraticCurveTo(i,j,i,j-h),a.lineTo(i,e+h),a.quadraticCurveTo(i,e,i-h,e),a.lineTo(d+h,e),a.closePath(),b&&a.fill(),c&&a.stroke()}else b&&a.fillRect(this.x,this.y,this.width,this.height),c&&a.strokeRect(this.x,this.y,this.width,this.height)}}}),define("objects.views/charts/shapes/circle",["objects.views/charts/shapes/display-object","objects.utils/shapes/circle"],function(a,b){"use strict";var c;return c=a.extend("Circle",{init:function(a,c,d){this._super(),b.apply(this,[a,c,d])},containsPoint:b.prototype.pointInside,intersectsLocalLine:b.prototype.intersectsLine,intersectsLocalRect:b.prototype.intersectsRect,getLocalPoints:b.prototype.getPoints,getLocalBoundingRect:function(){return{x:this.cx-this.r,y:this.cy-this.r,width:2*this.r,height:2*this.r}},set:function(){b.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!c.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/circle",["objects.views/charts/shapes/circle"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){a.beginPath(),a.moveTo(this.cx+this.r,this.cy),a.arc(this.cx,this.cy,this.r,0,2*Math.PI,!1),b&&a.fill(),c&&a.stroke()}}}),define("objects.views/charts/shapes/line",["objects.views/charts/shapes/display-object","objects.utils/shapes/line"],function(a,b){"use strict";var c;return c=a.extend("Line",{init:function(a,c,d,e){this._super(),b.apply(this,[a,c,d,e])},containsPoint:function(){return!1},intersectsLocalLine:b.prototype.intersectsLine,intersectsLocalRect:b.prototype.intersectsRect,getLocalPoints:b.prototype.getPoints,getLocalBoundingRect:function(){var a=Math.min(this.x1,this.x2),b=Math.max(this.x1,this.x2),c=Math.min(this.y1,this.y2),d=Math.max(this.y1,this.y2);return{x:a,y:c,width:b-a,height:d-c}},set:function(){b.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(b.prototype).forEach(function(a){!b.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(a)<0&&(c.prototype[a]=b.prototype[a])}),c}),define("objects.views/charts/renderers/canvas/line",["objects.views/charts/shapes/line"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){c&&(a.beginPath(),a.moveTo(this.x1,this.y1),a.lineTo(this.x2,this.y2),a.stroke())}}}),define("objects.views/charts/renderers/canvas/polygon",["objects.views/charts/shapes/polygon"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){var d,e,f,g,h,i;for(a.beginPath(),h=0;h<this._polygons.length;h++){if(d=this._polygons[h].points,e=d?d.length:0,f=d[0],!f)return;for(i=f,a.moveTo(f.x,f.y),g=1;e>g;g+=1)f=d[g],a.lineTo(f.x,f.y);this.close===!1||!c||i.x===f.x&&i.y===f.y||a.lineTo(i.x,i.y)}this.close!==!1&&a.closePath(),b&&a.fill(),c&&a.stroke()}}}),define("objects.views/charts/renderers/canvas/arc",["objects.views/charts/shapes/arc"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){a.beginPath(),0===this.innerRadius?(a.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),a.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy)):this.end-this.start===2*Math.PI?(a.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),a.moveTo(this.cx+this.innerRadius*Math.cos(this.radianOffset+this.start),this.cy+this.innerRadius*Math.sin(this.radianOffset+this.start)),a.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0)):(a.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),a.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy),a.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0),a.lineTo(this.radius*Math.cos(this.start+this.radianOffset)+this.cx,this.radius*Math.sin(this.start+this.radianOffset)+this.cy)),b&&a.fill(),c&&(a.closePath(),a.stroke())}}}),define("objects.views/charts/shapes/text-helper",[],function(){function a(a,b,c,d){var e,f,g,i,j,k,l=a?a.split(/\n+|\r+|\r\n/):[],m=[],n=a?a.split(/\s+/):[],o=l[0];if("number"!=typeof b||0>=b)return[a];if("number"==typeof d&&l.length>=d)return l.slice(0,d);for(c&&(h.font=c),f=0;f<l.length;f++){for(k=l[f]||"",n=k.split(/\s+/),o=n[0],j="",e=1;e<n.length;e++)if(g=o+" "+n[e],i=h.measureText(g).width,i>b&&("number"!=typeof d||d>m.length)?(m.push(o),o=n[e]):o=g,"number"==typeof d&&m.length>=d){j=n.slice(e+1).join(" ");break}"number"!=typeof d||m.length<d?m.push(o):m[Math.max(0,m.length-1)]=(m[Math.max(0,m.length-1)]||"")+" "+o+" "+j}return m}function b(a,b,d,e){if(!a||!a.length)return[];d&&(h.font=d);var g,i,j,k,l=[],m=a.slice();if(m.filter(function(a){return!!a}),"number"!=typeof b||0>b)return a.slice();for(k=0;k<m.length;k++)j=m[k],i=null,j&&(j.length<=1||h.measureText(j).width<=b?l.push(j):(g=f(j,b,void 0,e-l.length),g.length<=1?l.push(g[0]):(i=g.pop(),l=l.concat(g),m[k+1]?m[k+1]=i+m[k+1]:m.push(i))));return l.forEach(function(a,b,c){c[b]=a?a.trim():a}),l.length>e?(l=l.splice(0,e),l[l.length-1]=c(l[l.length-1],b).text):(j=l[l.length-1],j&&j.length>1&&h.measureText(j).width>b&&(l[l.length-1]=c(j,b).text)),l}function c(a,b,c){var d,e,f,g,j=a,k=h.measureText("i").width,l=Math.ceil(b/k);if(c&&(h.font=c),a&&b){if(h.measureText(j).width>b){for(d=Math.min(l,j.length);d>0;d--)if(e=j.substring(0,d-1),f=e.trim()+i,h.measureText(f).width<=b){g=j.substring(d-1),j=f;break}d||(g=j,j=i)}}else g=void 0;return{text:j,rest:g}}function d(a){return"number"==typeof a&&isFinite(a)}function e(a,b,c,f){var g,i=a,j="",k=[];if(d(c)&&1>=c)return[a];var l=Math.ceil(b/f),m=Math.min(a.length,l);for(g=m;g>0&&(i=a.substring(0,g),j=a.substring(g),!(h.measureText(i).width<=b));g--);return g||i||(i=a.substring(0,1),j=a.substring(1)),k.push(i),j?(h.measureText(j).width>b?(j=e(j,b,c-1,f),k=k.concat(j)):k.push(j),k):k}function f(a,b,c,d){return a&&b?(c&&(h.font=c),e(a,b,d,Math.max(1,h.measureText("i").width))):[]}function g(c,d,e,f){var g;return isNaN(d)?[c]:(g=f>1?a(c,d,e,f):[c],g=b(g,d,e,f))}var h=document.createElement("canvas").getContext("2d"),i="…";return{lineWrap:a,wordWrap:b,splitWord:f,wrap:g,truncate:c}}),define("objects.views/charts/shapes/text",["objects.views/charts/shapes/display-object","objects.views/charts/shapes/text-helper","objects.utils/shapes/line"],function(a,b,c){"use strict";function d(a){return 1.5*a.measureText("m").width}function e(a){g.font=this.font;var c,e=d(g),f=(this.lineHeightMultiplicator||1)*e,h="maxWidth"in this?this.maxWidth:this.width,i="maxHeight"in this?this.maxHeight:this.height,j=this.maxNumLines,k=[],l=0,m=[];return this.lineHeight=f,e>i?[]:(c=i?Math.max(1,Math.floor(i/f)):1,Array.isArray(j)?(j.forEach(function(a){l+=isNaN(a)||0>=a?0:a}),j.forEach(function(a){k.push(isNaN(a)||0>=a?c-l:a);
})):k=[isNaN(j)||0>=j?c:Math.min(c,j)],Array.isArray(a)?a.forEach(function(a,d){m.length<c&&(m=m.concat(b.wrap(a,h,this.font,k[d])))},this):(isNaN(j)&&(j=i?Math.max(1,Math.floor(i/f)):1),m=b.wrap(a,h,this.font,k[0])),m)}var f,g=document.createElement("canvas").getContext("2d");return f=a.extend("Text",{init:function(){this._super(),this.options={},this.x=0,this.y=0,this.lineHeightMultiplicator=1,this._dirtyMeasures=!0,this._measures={numLines:0,width:0,height:0}},setText:function(a){return this.text=a,this.invalidateBounds(),this},tokenize:function(){return this.lines=e.apply(this,[this.text]),this},measure:function(){if(this.preRender(),this._dirtyMeasures){var a,b=0,c=this.lines;for(g.font!==this.font&&(g.font=this.font),a=0;a<c.length;a++)b=Math.max(b,g.measureText(c[a]).width);this._measures.numLines=c.length,this._measures.width=b,this._measures.height=c.length*this.lineHeight,this._dirtyMeasures=!1}return{numLines:this._measures.numLines,width:this._measures.width,height:this._measures.height}},getHorizontalAnchor:function(){var a,b=this.x||0;if(this.width>0){if(a=this.attr("align"),"center"===a)return b+this.width/2;if("right"===a)return b+this.width}return b},getVerticalAnchor:function(){var a,b=this.y||0,c=this.attr("baseline");return"middle"===c?(a=this.attr("lineHeight"),b-=(this.lines.length-1)*a/2,this.height>0&&(b+=this.height/2)):"bottom"===c&&(a=this.attr("lineHeight"),b-=(this.lines.length-1)*a,this.height>0&&(b+=this.height)),b},preRender:function(){var a,b="";Array.isArray(this.text)?this.text.forEach(function(a){b+=a+"__"}):b=this.text,a=this.attr("font"),this.font=a;var c=b+a+this.maxWidth;return c!==this._renderedID&&(this.tokenize(),this.invalidateBounds(),this._dirtyMeasures=!0,this._renderedID=c),this},getLocalBoundingRect:function(){var a=this.measure(),b=this.getHorizontalAnchor(),c=this.getVerticalAnchor(),d=this.attr("align")||"left",e=this.attr("baseline")||"top";return"middle"===e?c-=a.height/2:"bottom"===e&&(c-=a.height),"center"===d?b-=a.width/2:"right"===d&&(b-=a.width),{x:b,y:c,width:a.width,height:a.height}},containsPoint:function(a,b){var c=this.getLocalBoundingRect();return a>c.x&&a<c.x+c.width&&b>c.y&&b<c.y+c.height},getLocalPoints:function(){var a=this.getLocalBoundingRect();return[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}]},intersectsLocalRect:function(a){if(!a)return!1;var b=this.getLocalBoundingRect();return b.x<=a.x+a.width&&a.x<=b.x+b.width&&b.y<=a.y+a.height&&a.y<=b.y+b.height},intersectsLocalLine:function(a){if(this.containsPoint(a.x1,a.y1)||this.containsPoint(a.x2,a.y2))return!0;var b=this.getLocalBoundingRect();return a.intersectsLine(new c(b.x,b.y,b.x+b.width,b.y))||a.intersectsLine(new c(b.x+b.width,b.y,b.x+b.width,b.y+b.height))||a.intersectsLine(new c(b.x+b.width,b.y+b.height,b.x,b.y+b.height))||a.intersectsLine(new c(b.x,b.y+b.height,b.x,b.y))}})}),define("objects.views/charts/renderers/canvas/text",["objects.views/charts/shapes/text"],function(a){"use strict";return{displayObject:a,render:function(a,b,c){var d,e=this.x||0,f=this.y||0,g=this.lines||[],h=g.length,i=[],j=this.lineHeight;if(e=this.getHorizontalAnchor(),f=this.getVerticalAnchor(),b&&i.push("fillText"),c&&(this.strokeFirst?i.unshift("strokeText"):i.push("strokeText")),i.length)for(d=0;h>d;d++)a[i[0]](g[d],e,f),i[1]&&a[i[1]](g[d],e,f),f+=j}}}),define("objects.views/charts/renderers/canvas-renderer",["jquery","core.utils/deferred","objects.views/charts/renderers/renderer","objects.views/charts/utils/matrix","objects.utils/animation-frame","objects.utils/shapes/rect","objects.views/charts/renderers/canvas/rect","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/line","objects.views/charts/renderers/canvas/polygon","objects.views/charts/renderers/canvas/arc","objects.views/charts/renderers/canvas/text"],function(a,b,c,d,e,f){"use strict";function g(a,b){v.length>100&&delete u[v.shift()],v.push(a),u[a]=b}function h(){var a={dfd:b(),state:t.PENDING},c=a.dfd.promise;return c.then(function(){a.state=t.RESOLVED},function(){a.state=t.REJECTED}),a}var i,j=1,k=[].slice.call(arguments,6),l={},m=k.length,n=document.createElement("canvas"),o=n.getContext("2d"),p=["fill","stroke","strokeWidth","opacity","font","align","baseline","lineJoin","lineCap"],q=new RegExp(p.join("|")),r=p.length,s={fill:"fillStyle",stroke:"strokeStyle",strokeWidth:"lineWidth",opacity:"globalAlpha",align:"textAlign",baseline:"textBaseline"},t={PENDING:0,RESOLVED:1,REJECTED:2},u={},v=[],w=0;return i=c.extend("CanvasRenderer",{init:function(b,c){this._super(),this._id=++w,this._canvas=document.createElement("canvas"),this._canvas.width=this._size.width,this._canvas.height=this._size.height,this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._bufferCanvas=document.createElement("canvas"),this._bufferCanvas.width=this._canvas.width,this._bufferCanvas.height=this._canvas.height,this._mvMatrix=new d,this._wrapper=document.createElement("div"),this._wrapper.style.position="relative",this._wrapper.style.left="0",this._wrapper.style.top="0",this._wrapper.appendChild(this._canvas),c&&c.name&&a(this._wrapper).attr({tid:c.name}),a(this._wrapper).attr({tcl:"renderer"}).data("_renderer",this),this.container=b,this.container.appendChild(this._wrapper),this._isCompositingEnabled=!0,this._invalidObjects=[],this._t={x:0,y:0,dx:0,dy:0,scale:1}},setDimensions:function(a,b,c,d){this._super(a,b,c,d),this._wrapper.style.left=a+"px",this._wrapper.style.top=b+"px"},setCompositingEnabled:function(a){this._isCompositingEnabled=a},getCompositingEnabled:function(){return this._isCompositingEnabled},render:function(a){return this._rendering?void 0:(this._resetImage(),this._renderDfdObj&&this._renderDfdObj.state===t.PENDING||(this._renderDfdObj=h()),a?this._invalidate(!0,!1):(this._doClear=!1,this._doRender=!0,this._validate()),this._renderDfdObj.dfd.promise)},clear:function(a){this._rendering||(a?this._invalidate(!1,!0):(this._doRender=!1,this._doClear=!0,this._validate()))},release:function(){this._super(),this._clearSchedule(),a(this._wrapper).removeData(),this._bufferCanvas=null,this._canvas=null,this.container&&(this.container.removeChild(this._wrapper),this.container=null)},invalidateObject:function(a){this._isCompositingEnabled&&this._invalidObjects.indexOf(a)<0&&this._invalidObjects.push(a),this.render(!0)},translateScene:function(a,b){return this._t.dx+=a,this._t.dy+=b,this._t.x+=a,this._t.y+=b,this._t.scale=null,this._invalidate(!0,!1),this},scaleScene:function(a,b,c){return this._t.scale={x:a,y:b,scale:c},this._invalidate(!0,!1),this},setAttribute:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(this._wrapper[a][c]=b[c])},getTextWidth:function(a,b){return i.getTextWidth(a,b,this._canvas.getContext("2d"))},getFontHeight:function(a){return i.getFontHeight(a,this._canvas.getContext("2d"))},_render:function(){if(this._canvas){this._rendering=!0;var a=this._canvas,b=a.getContext("2d"),c=this._mvMatrix,d=[],e=this._isCompositingEnabled&&(0!==this._t.dx||0!==this._t.dy||this._t.scale&&void 0!==this._t.scale.scale&&1!==this._t.scale.scale),g=i.getDevicePixelToBackingStoreRatio();if(e&&this._storeImage(),this._updateSize()||(this._isCompositingEnabled&&(d=this._getInvalidViews().filter(function(a){return!a.hasNaN()}),d.length&&e?d=[]:e&&(b.clearRect(0,0,a.width,a.height),d=d.concat(this._getInvalidImageParts()).filter(function(a){return!a.hasNaN()}))),d.length||b.clearRect(0,0,a.width,a.height)),b.save(),c.save(),this.stage.matrix&&this.stage.matrix.identity(),this.stage.scale(this.scaling.x,this.scaling.y),this.stage.translate(-this._extendedSize.x,-this._extendedSize.y),this.stage.translate(this._t.x,this._t.y),b.setTransform(g,0,0,g,0,0),d.length&&(e&&(b.save(),b.setTransform(1,0,0,1,0,0),this._patchImage(),this._t.dx=0,this._t.dy=0,b.restore()),b.beginPath(),d.forEach(function(a){b.rect(a.x,a.y,a.width,a.height)}),b.clip(),b.clearRect(0,0,this._extendedSize.width,this._extendedSize.height)),!d.length){var h=new f(0,0,this.scaling.x*this._extendedSize.width,this.scaling.y*this._extendedSize.height);d.push(h)}i._updateTransforms([this.stage],c,{}),i._renderDisplayObjects(b,[this.stage],this._isCompositingEnabled?d:!1,g),c.restore(),b.restore(),this._invalidObjects=[],this._rendering=!1}},_updateSize:function(){var a,b,c,d=this._canvas,e=i.getDevicePixelToBackingStoreRatio(),g=this._extendedSize;return this.edgeBleed?g.set(-this.edgeBleed.left,-this.edgeBleed.top,this._size.width+this.edgeBleed.left+this.edgeBleed.right,this._size.height+this.edgeBleed.top+this.edgeBleed.bottom):g.set(this._size.x,this._size.y,this._size.width,this._size.height),c=new f(Math.round(g.x*this.scaling.x),Math.round(g.y*this.scaling.y),Math.round(g.width*this.scaling.x),Math.round(g.height*this.scaling.y)),a=Math.round(e*c.width),b=Math.round(e*c.height),this._canvas.style.left=c.x+"px",this._canvas.style.top=c.y+"px",d.width!==a||d.height!==b?(d.width=a,d.height=b,d.style.width=c.width+"px",d.style.height=c.height+"px",this._bufferCanvas.width=a,this._bufferCanvas.height=b,!0):!1},_invalidate:function(a,b){if(this._doRender=a||this._doRender,this._doClear=b||this._doClear,!this._invalidated){var c=this;this._invalidated=!0,this._timer=e.request(function(){c._validate()},this._canvas)}},_validate:function(){this._doClear&&!this._doRender?this._clear():this._doRender&&this._render(),this._renderDfdObj&&this._renderDfdObj.state===t.PENDING&&this._renderDfdObj.dfd.resolve(),this._clearSchedule()},_clear:function(){this._canvas&&(this._canvas.width=this._canvas.width)},_clearSchedule:function(){this._timer&&(e.cancel(this._timer),this._timer=null),this._renderDfdObj&&this._renderDfdObj.state===t.PENDING&&this._renderDfdObj.dfd.reject(),this._doRender=!1,this._doClear=!1,this._invalidated=!1},_getInvalidViews:function(){var a,b,c,d,e,g,h,i,j,k,l,m=this._invalidObjects?this._invalidObjects.length:0,n=new f,o=!1,p=!1,q=new f;for(a=0;m>a;a++)b=this._invalidObjects[a].getVisualBounds(),c=this._invalidObjects[a].rData.oldVisualBounds,!o&&b?(d=b.x,g=b.x+b.width,e=b.y,h=b.y+b.height,o=!0):b&&(d=Math.min(d,b.x),g=Math.max(g,b.x+b.width),e=Math.min(e,b.y),h=Math.max(h,b.y+b.height)),!p&&c?(i=c.x,k=c.x+c.width,j=c.y,l=c.y+c.height,p=!0):c&&(i=Math.min(i,c.x),k=Math.max(k,c.x+c.width),j=Math.min(j,c.y),l=Math.max(l,c.y+c.height));return n.set(Math.floor(d)-1,Math.floor(e)-1,Math.ceil(g-d)+2,Math.ceil(h-e)+2),q.set(Math.floor(i)-1,Math.floor(j)-1,Math.ceil(k-i)+2,Math.ceil(l-j)+2),n.x!==q.x||n.y!==q.y||n.width!==q.width||n.height!==q.height?[n,q]:[n]},_getInvalidImageParts:function(){var a=[];return this._t.scale&&this._t.scale.scale>1?a.push(new f(0,0,0,0)):this._t.scale&&this._t.scale.scale<1&&a.push(new f(0,0,0,0)),0!==this._t.dx&&this._size.width>Math.abs(this._t.dx)&&a.push(new f(this._t.dx>0?0:this._size.width+this._t.dx,0,Math.abs(this._t.dx),this._size.height)),0!==this._t.dy&&this._size.height>Math.abs(this._t.dy)&&a.push(new f(0,this._t.dy>0?0:this._size.height+this._t.dy,this._size.width,Math.abs(this._t.dy))),a},_storeImage:function(){var a=this._bufferCanvas.getContext("2d");a.clearRect(0,0,this._bufferCanvas.width,this._bufferCanvas.height),a.drawImage(this._canvas,0,0)},_patchImage:function(){var a=this._t.dx,b=this._t.dy,c=i.getDevicePixelToBackingStoreRatio();if(this._t.scale&&this._t.scale.scale){var d,e,f,g,h,j,k=this._canvas.width,l=this._canvas.height,m={left:this._t.scale.x/this._size.width,top:this._t.scale.y/this._size.height};this._t.scale.scale>1?(d=this._size.width,e=this._size.height,h=Math.min(this._size.width/this._t.scale.scale,k),j=Math.min(this._size.height/this._t.scale.scale,l),f=Math.max(this._t.scale.x-m.left*h,0),g=Math.max(this._t.scale.y-m.top*j,0)):(f=0,g=0,h=Math.min(this._size.width,k),j=Math.min(this._size.height,l),d=this._size.width*this._t.scale.scale,e=this._size.height*this._t.scale.scale,a=Math.max(this._t.scale.x-m.left*d,0),b=Math.max(this._t.scale.y-m.top*e,0)),this._canvas.getContext("2d").drawImage(this._bufferCanvas,f*c,g*c,h*c,j*c,a*c,b*c,d*c,e*c)}else this._canvas.getContext("2d").drawImage(this._bufferCanvas,a*c,b*c)},_resetImage:function(){this._t.dx=0,this._t.dy=0,this._t.x=0,this._t.y=0,this._t.scale=1}}),i.getFontHeightOfContext=function(a){return 1.5*a.measureText("m").width},i.getFontHeight=function(a,b){if("string"!=typeof a)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(a in u)return u[a];var c;return b=b||o,b.font!==a?(b.save(),b.font=a,c=1.5*b.measureText("m").width,b.restore()):c=1.5*b.measureText("m").width,g(a,c),c},i.getTextWidth=function(a,b,c){var d;return c=c||o,c.save(),c.font=b,d=void 0!==a?Math.ceil(c.measureText(a).width):0,c.restore(),d},i.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1)},i.measureText=function(a,b,c){var d,e,f;return c=c||o,b&&c.font!==b&&(c.save(),c.font=b),e=c.measureText(a).width,b in u?d=u[b]:(d=1.5*c.measureText("m").width,g(b,d)),b&&c.restore(),f=void 0!==a?{width:e,height:d}:{width:0,height:0}},i._renderDisplayObjects=function(a,b,c,d){var e,f,g,h,j,k,l=c?c.length:0,m=[],n=!0,o=[];for(f=b?b.length:0,e=0;f>e;e++)if(g=b[e],g.visible!==!1&&g.data.isVisible!==!1){if(l){for(n=!1,j=0;l>j;j++)if(c[j].intersectsWith(g.getVisualBounds())){n=!0;break}if(!n)continue}h=i._getRenderFn(b[e]),k=g.children.length>0,("function"==typeof h||k)&&(g.zIndex>0?(m[g.zIndex]||(m[g.zIndex]={index:g.zIndex,objects:[]}),m[g.zIndex].objects.push({object:g,renderFn:h,hasChildren:k})):i._renderObject(a,g,h,k,c,d))}for(m=m.filter(function(a){return a&&a.objects.length}).sort(function(a,b){return a.index-b.index}),e=0;e<m.length;e++)for(o=m[e].objects,f=o.length,j=0;f>j;j++)i._renderObject(a,o[j].object,o[j].renderFn,o[j].hasChildren,c,d)},i._renderObject=function(a,b,c,d,e,f){var g,h,j,k,l;"function"==typeof c&&(h=b.attr("strokeWidth"),"undefined"==typeof h&&(h=1),j=!!b.attr("fill"),k=!!b.attr("stroke")&&h>0),a.save(),b.rData.stroke=k,b.rData.strokeWidth=h,e&&(l=b.getVisualBounds(),b.rData.oldVisualBounds={x:l.x,y:l.y,width:l.width,height:l.height}),i._applyAttributes(a,b),b.rData.vmTransform&&(g=b.rData.vmTransform,a.setTransform(f*g[0][0],f*g[1][0],f*g[0][1],f*g[1][1],f*g[0][2],f*g[1][2])),b.clip&&(a.beginPath(),a.rect(b.clip.x,b.clip.y,b.clip.width,b.clip.height),a.clip()),(j||k)&&(b.preRender&&b.preRender(),c.apply(b,[a,j,k])),d&&i._renderDisplayObjects(a,b.children,e,f),a.restore()},i._registerRenderFn=function(a,b){var c;if("function"!=typeof a)throw new TypeError("First parameter must be a function");c="function"!=typeof b&&"function"==typeof b.constructor?b.constructor:b,c.__renderFnId="_"+j++,l[c.__renderFnId]=a},i._getRenderFn=function(a){var b=a.__renderFnId||(a.constructor?a.constructor.__renderFnId:void 0);if(b)return l[b];for(var c=0;m>c;c++)if(k[c].displayObject===a.constructor)return i._registerRenderFn(k[c].render,a),k[c].render;for(c=0;m>c;c++)if(a instanceof k[c].displayObject)return i._registerRenderFn(k[c].render,a),k[c].render;a.constructor.__renderFnId="does not exist"},i._updateTransforms=function(a,b,c){var d,e,f,g,h,j={},k=a?a.length:0;for(h in c)q.test(h)&&(j[h]=c[h]);for(d=0;k>d;d++){e=a[d],e.clearModelView(),e.matrix&&(b.save(),b.multiply(e.matrix),e.rData.vmTransform=b.elements,e.rData.dirtyVMTransform=!0),e.rData.inherited={};for(h in j)e.rData.inherited[h]=j[h];if(g=e.children,g&&g.length){for(f=0;r>f;f++)e.hasOwnProperty(p[f])&&(j[h]=e[h]);i._updateTransforms(g,b,j)}e.matrix&&b.restore()}},i.Gradient={LINEAR:0,RADIAL:1},i._applyAttributes=function(a,b){var c,d;for(d=0;r>d;d++)c=p[d],c in b&&"undefined"!=typeof b[c]&&(("fill"===c||"stroke"===c)&&b[c]&&b[c].gradient?b[c].gradient.r?a[s[c]]=i._createGradient(a,b[c].gradient,i.Gradient.RADIAL)||"#000000":a[s[c]]=i._createLinearGradient(a,b[c].gradient)||"#000000":a[s[c]||c]=b[c])},i._createLinearGradient=function(a,b){return i._createGradient(a,b,i.Gradient.LINEAR)},i._createGradient=function(a,b,c){var d,e,f;if(!(isNaN(b.x0)||isNaN(b.y0)||isNaN(b.x1)||isNaN(b.y1))){for(d=c===i.Gradient.RADIAL?a.createRadialGradient(b.x0,b.y0,0,b.x1,b.y1,b.r):a.createLinearGradient(b.x0,b.y0,b.x1,b.y1),f=b.limits.length,e=0;f>e;e++)d.addColorStop(b.limits[e],b.colors[e]);return d}},i.registerRenderObject=function(a){k.push(a),m=k.length},i}),define("extensions.qliktech/barchart/layers/bar-helpers",["objects.views/charts/shapes/rect"],function(a){"use strict";function b(a,b,c,d,e,f,g){var h,i;return f?(h=b,i=c,c=e,b=d,e=h,d=i,b>c&&(h=c,c=b,b=h),b=Math.max(g.x,Math.min(g.x+g.width,b)),c=Math.max(g.x,Math.min(g.x+g.width,c))):(e>d&&(h=e,e=d,d=h),d=Math.max(g.y,Math.min(g.y+g.height,d)),e=Math.max(g.y,Math.min(g.y+g.height,e))),a.set(b,e,c-b,d-e),a}function c(a,b,c,d){var e=[{x:a.x,y:a.y},{x:a.x,y:a.y+a.height},{x:a.x+a.width,y:a.y+a.height},{x:a.x+a.width,y:a.y}];switch(b){case"left":d?e[0].x-=c:e[1].x+=c;break;case"right":d?e[2].x+=c:e[3].x-=c;break;case"top":d?e[3].y-=c:e[0].y+=c;break;case"bottom":d?e[1].y+=c:e[2].y-=c}return e}function d(b,d,e){var f,g=e.pad,h=e.gap,i=e.sharpness,j=b.clone(),k=c,l=[];return"right"===d?(f=new a(j.x+j.width+h,j.y,g-h,j.height),l.push(k(j,"right",i,!0)),l.push(k(f,"left",i,!1,!0)),b.width+=f.width+h):"left"===d?(f=new a(0,j.y,g-h,j.height),l.push(k(j,"left",i,!0)),l.push(k(f,"right",i,!1,!0)),b.x=f.x,b.width+=f.width+h):"down"===d?(f=new a(j.x,j.y+j.height+h,j.width,g-h),l.push(k(j,"bottom",i,!0)),l.push(k(f,"top",i,!1,!0)),b.height+=f.height+h):"up"===d&&(f=new a(j.x,0,j.width,g-h),l.push(k(j,"top",i,!0)),l.push(k(f,"bottom",i,!1,!0)),b.y=f.y,b.height+=f.height+h),l}function e(a,b,c){a.set(d(a.data.hitRect,b,c))}function f(a,b,c){a.set(h(a.data.hitRect,b,c))}function g(a,b,c,d,e){var f=[];return"left"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a-d,y:b})):"right"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a+d,y:b})):"up"===e?(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b-d})):"down"===e&&(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b+d})),f}function h(a,b,c){var d,e,f;return f=Math.min(a[["left","right"].contains(b)?"height":"width"]/2,8),e=Math.min(f,8),"left"===b?(d=g(c.x+e,a.y+a.height/2,f,e,b),a.width+=e):"right"===b?(d=g(c.x+c.width-e-1,a.y+a.height/2,f,e,b),a.width+=e,a.x-=e):"up"===b?(d=g(a.x+a.width/2,c.y+e,f,e,b),a.height+=e):"down"===b&&(d=g(a.x+a.width/2,c.y+c.height-e-1,f,e,b),a.height+=e,a.y-=e),d}return{updateRectangle:b,getSpike:d,getSlicedPolygon:c,getHint:h,updateSpike:e,updateHint:f}}),define("extensions.qliktech/barchart/layers/bar-layer",["core.utils/class","objects.utils/shapes/rect","objects.views/charts/shapes/polygon","objects.views/charts/renderers/canvas-renderer","general.utils/property-resolver","extensions.qliktech/barchart/layers/bar-helpers"],function(a,b,c,d,e,f){"use strict";function g(){var a,d,e,g,h,i,j,k,l,m,n,o,p=this.style.shape,q=new b(0,0,0,0),r=this.widthRatio,s=this.isSpikingEnabled,t=this.isHintingEnabled,u=[],v=this.majorAxis.isDiscrete(),w=this.majorAxis.getDiscreteSpacing()*r,x=this.minorAxis.getPlotMax(),y=this.minorAxis.getPlotMin(),z=!this.majorAxis.isVertical(),A=this.minorAxis.getPadding(),B=this.minorAxis.getPositionOfValue(0)-1,C={pad:z?A.top:A.right},D={pad:z?A.bottom:A.left},E=new b;C.gap=.3*C.pad,C.sharpness=.3*C.pad,D.gap=.3*D.pad,D.sharpness=.3*D.pad,E.set(A.left,A.top,this.rect.width-A.left-A.right,this.rect.height-A.top-A.bottom),this._bounds=E;var F=0,G=z?this.rect.width:this.rect.height,H=-1,I=z?this.rect.height:this.rect.width;for(k=this.shapes?this.shapes.length:0,l=0;k>l;l++)if(i=this.shapes[l],o=i instanceof c||"Polygon"===i.type,j=this.majorAxis.getPositionOfId(i.data.axisId),h=v?w:this.majorAxis.getWidthOfId(i.data.axisId)*r,i.data.isNaN||isNaN(i.data.value)?(i.data.isNaN=!0,e=g=B):(e=this.minorAxis.getPositionOfValue(i.data.start)-1,g=this.minorAxis.getPositionOfValue(i.data.end)-1),a=j-h/2,d=j+h/2,f.updateRectangle(i.data.hitRect,a,d,e,g,!z,E),delete i.data.labelRect,delete i.data.isCutOff,delete i.data.hintDirection,F>d||a>G)i.data.isVisible=!1;else{i.data.isVisible=!0,o?i.set(i.data.hitRect.getPoints()):i.set(i.data.hitRect.x,i.data.hitRect.y,i.data.hitRect.width,i.data.hitRect.height),q.set(i.data.hitRect.x,i.data.hitRect.y,i.data.hitRect.width,i.data.hitRect.height),u.push(i),m=i.data.cacheItem;var J=m.selected;if(i.data.isFakeOtherCell&&i.data.highlightOnGroupSelect&&m.children[0].selected){J=!0;for(var K=0;K<m.children.length;K++)if(!m.children[K].selected){J=!1;break}}n=J?p.selected:{border:{color:0,width:0}},i.stroke=n.border.color,i.fill=i.data.isFakeOtherCell?this.othersFillPattern:i.data.fill,i.strokeWidth=n.border.width,i.opacity=J?1:this._globalAlpha;var L=t?this._getHint(e,g,E,z):!1,M=o&&!L&&s?this._getSpike(i.data.end,e,g,E,z,y,x):!1;M?(i.data.labelRect=q.clone(),f.updateSpike(i,z?i.data.end>=0?"up":"down":i.data.end>=0?"right":"left",i.data.end>=0?C:D),i.data.isCutOff=!0):L?(i.fill="#999999",f.updateHint(i,L,E),i.data.hintDirection=L):(H>e&&H>g||e>I&&g>I)&&(i.data.isVisible=!1)}this.nodesInView=u}var h;return h=a.extend("BarLayer",{init:function(a){this.renderer=new d(a,{name:"bar-layer"}),this.widthRatio=.7,this.isSpikingEnabled=!1,this.isHintingEnabled=!1,this.shapes=[],this._globalAlpha=1},release:function(){this.renderer.release(),this.shapes=null,this.minorAxis=null,this.majorAxis=null},update:function(){g.call(this)},render:function(){return this.renderer.render()},_getStyle:function(a){return{selected:{border:{color:e.getValue(a,"shape.selected.border.color","rgba(0,0,0,0.25)"),width:e.getValue(a,"shape.selected.border.width",1)}}}},_getHint:function(a,b,c,d){if(d){if(b+1<c.y&&a+1<=c.y)return"up";if(b+1>c.y+c.height&&a+1>=c.y+c.height)return"down"}else{if(b+1<c.x&&a+1<=c.x)return"left";if(b+1>c.x+c.width&&a+1>=c.x+c.width)return"right"}return!1},_getSpike:function(a,b,c,d,e,f,g){var h=a>g,i=f>a;return e?(h=h&&c<d.y&&b>d.y,i=i&&c>d.y+d.height&&b<d.y+d.height):(h=h&&c>d.x+d.width&&b<d.x+d.width,i=i&&c<d.x&&b>d.x),h||i}})}),define("objects.views/charts/utils/canvas-renderer",["core.utils/class","objects.utils/shapes/rect","objects.utils/animation-frame","jquery","./matrix","core.utils/deferred"],function(a,b,c,d,e,f){"use strict";function g(a,b){z.length>100&&delete y[z.shift()],z.push(a),y[a]=b}function h(a){if(a.font in y)return y[a.font];var b=1.5*a.measureText("m").width;return g(a.font,b),b}function i(a,b,c,d,e){var f,g,h=b.shape.points,i=h?h.length:0;if(a.beginPath(),f=h[0]){for(a.moveTo(f.x,f.y),g=1;i>g;g+=1)f=h[g],a.lineTo(f.x,f.y);e&&a.closePath(),c&&a.fill(),d&&a.stroke()}}function j(a,b,c){var d,e,f,g=a?a.replace(/^\s*|\s*$/,"").split(" "):[],h=[],i=g[0];if(!i)return[];for(d=1;d<g.length;d++)e=i+" "+g[d],f=u.measureText(e).width,f>b&&c>h.length?(h.push(i),i=g[d]):i=e;return h.length<c?h.push(i):h[Math.max(0,h.length-1)]?h[Math.max(0,h.length-1)]+=" "+i:h[Math.max(0,h.length-1)]=" "+i,h}function k(a,b,c){if(void 0!==a){var d,e,f,g,h,i,j,k,l="…",m=u.measureText("i").width;for(d=0;d<a.length;d++){if(e=a[d],j=Math.ceil(Math.max(0,b/m))+1,j<e.length?(g=e.slice(j),e=e.slice(0,j)):g="",f=e,e&&e.length>1&&u.measureText(e).width>b){for(h=!1,i=e.length;i>0;i--)if(f=f.substring(0,f.length-1),k=f+(c>d+1?"-":l),u.measureText(k).width<b){g=e.substring(i-1),e=k,h=!0;break}h||(g=e.substring(1),e=e.substring(0,1)),h||i||(g="",e=l)}a[d]=String(e).trim(),g&&d<a.length-1?a[d+1]=g+" "+a[d+1]:g&&a.length<c&&a.push(g)}}}function l(a,b,c){var d,e=c.maxWidth;return isNaN(e)?[a]:(d=b>1?j(a,e,b):[a],k(d,e,b),d)}function m(a,b,c){var d,e,f=b.text,g=(b.lineHeight||1)*h(a),i="maxWidth"in b?b.maxWidth:b.width,j="maxHeight"in b?b.maxHeight:b.height,k=b.width,m=b.height,n=b.maxNumLines,o=b.x||0,p=b.y||0;if(u.font=a.font,isNaN(n)&&(n=j?Math.max(1,Math.floor(j/g)):1),d=l(f,n,{maxWidth:i,maxHeight:j}),c){for(k=0,e=0;e<d.length;e++)k=Math.max(k,a.measureText(d[e]).width);return{lines:d,numLines:d.length,width:k,height:d.length*g,truncated:Array.isArray(/…$/.exec(d[d.length-1]))}}for("middle"===a.textBaseline?"undefined"!=typeof m?p+=m/2:d.length&&(p-=(d.length-1)*g/2):"bottom"===a.textBaseline&&("undefined"!=typeof m?p+=m:p-=(d.length-1)*g),"center"===a.textAlign&&k?o+=k/2:"right"===a.textAlign&&k&&(o+=k),e=0;e<d.length;e++)a.fillText(d[e],o,p),p+=g}function n(a,b,c,d,e,f){var g,h,i,j,k,l,m;for(g=0;g<c.length;g+=1)if(j=c[g]){if(a.save(),i=j.transform,i&&(b.save(),b.multiply(i)),"opacity"in j&&(a.globalAlpha=j.opacity),j.fill)if(j.fill.gradient){if(m=j.fill.gradient,isNaN(m.x0)||isNaN(m.y0)||isNaN(m.x1)||isNaN(m.y1))return;for(l=a.createLinearGradient(m.x0,m.y0,m.x1,m.y1),h=0;h<m.limits.length;h++)l.addColorStop(m.limits[h],m.colors[h]);a.fillStyle=l}else a.fillStyle=j.fill;if(j.stroke&&0!==j.strokeWidth){if(j.stroke.gradient){for(m=j.stroke.gradient,l=a.createLinearGradient(m.x0,m.y0,m.x1,m.y1),h=0;h<m.limits.length;h++)l.addColorStop(m.limits[h],m.colors[h]);a.strokeStyle=l}else a.strokeStyle=j.stroke;a.lineWidth=j.strokeWidth||1,d>1&&"polygon"!==j.type&&(a.lineWidth/=d)}j.lineJoin&&(a.lineJoin=j.lineJoin),j.lineCap&&(a.lineCap=j.lineCap),k=b.elements,"group"===j.type?(b.save(),j.clip&&(a.beginPath(),a.setTransform(k[0][0],k[1][0],k[0][1],k[1][1],k[0][2],k[1][2]),a.rect(j.clip.rect.x,j.clip.rect.y,j.clip.rect.width,j.clip.rect.height),a.clip()),n(a,b,j.children,void 0,!!j.fill||!!e,!!j.stroke&&0!==j.strokeWidth||!!f),b.restore()):j.type in r&&(a.setTransform(k[0][0],k[1][0],k[0][1],k[1][1],k[0][2],k[1][2]),r[j.type](a,j,!!j.fill||!!e,!!j.stroke&&0!==j.strokeWidth||!!f)),a.globalAlpha=1,i&&b.restore(),a.restore()}}function o(a,b,c){if(c){var d=b.elements;switch(c.type){case"clip":a.save(),a.setTransform(d[0][0],d[1][0],d[0][1],d[1][1],d[0][2],d[1][2]),a.beginPath(),a.rect(c.rect.x,c.rect.y,c.rect.width,c.rect.height),a.clip();break;case"slice":}}}function p(a,b){b&&a.restore()}var q,r,s=window.devicePixelRatio||1,t=document.createElement("canvas"),u=t.getContext("2d"),v=document.createElement("span"),w=u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1,x=s/w,y={},z=[];v.innerText="Wj",r={rect:function(a,b,c,d){c&&a.fillRect(b.shape.x||0,b.shape.y||0,b.shape.width||0,b.shape.height||0),d&&a.strokeRect(b.shape.x||0,b.shape.y||0,b.shape.width||0,b.shape.height||0)},roundRect:function(a,b,c,d){a.beginPath(),a.moveTo(b.shape.x+b.shape.radius,b.shape.y),a.lineTo(b.shape.x+b.shape.width-b.shape.radius,b.shape.y),a.quadraticCurveTo(b.shape.x+b.shape.width,b.shape.y,b.shape.x+b.shape.width,b.shape.y+b.shape.radius),a.lineTo(b.shape.x+b.shape.width,b.shape.y+b.shape.height-b.shape.radius),a.quadraticCurveTo(b.shape.x+b.shape.width,b.shape.y+b.shape.height,b.shape.x+b.shape.width-b.shape.radius,b.shape.y+b.shape.height),a.lineTo(b.shape.x+b.shape.radius,b.shape.y+b.shape.height),a.quadraticCurveTo(b.shape.x,b.shape.y+b.shape.height,b.shape.x,b.shape.y+b.shape.height-b.shape.radius),a.lineTo(b.shape.x,b.shape.y+b.shape.radius),a.quadraticCurveTo(b.shape.x,b.shape.y,b.shape.x+b.shape.radius,b.shape.y),a.closePath(),c&&a.fill(),d&&a.stroke()},circle:function(a,b,c,d){if(b.shape&&b.shape.r&&!b.shape.radius&&(b.shape.radius=b.shape.r),!(isNaN(b.shape.cx)||isNaN(b.shape.cy)||isNaN(b.shape.radius)||b.shape.radius<=0)){var e=.551784;a.save(),a.translate(b.shape.cx,b.shape.cy),a.scale(b.shape.radius,b.shape.radius),a.beginPath(),a.moveTo(1,0),a.bezierCurveTo(1,-e,e,-1,0,-1),a.bezierCurveTo(-e,-1,-1,-e,-1,0),a.bezierCurveTo(-1,e,-e,1,0,1),a.bezierCurveTo(e,1,1,e,1,0),a.closePath(),a.restore(),c&&a.fill(),d&&a.stroke()}},line:function(a,b,c,d){d&&(a.beginPath(),a.moveTo(b.shape.x1,b.shape.y1),a.lineTo(b.shape.x2,b.shape.y2),a.stroke())},polygon:function(a,b,c,d){i(a,b,c,d,!0)},polyline:function(a,b,c,d){i(a,b,c,d)},polygons:function(a,b,c,d){var e,f,g,h,i,j,k=b.shape.polygons,l=k?k.length:0;for(a.beginPath(),i=0;l>i;i++)if(e=k[i],f=e.points,g=f?f.length:0,0!==g&&(h=f[0]))for(a.moveTo(h.x,h.y),j=1;g>j;j+=1)h=f[j],a.lineTo(h.x,h.y);c&&a.fill(),d&&a.stroke()},multipolygon:function(a,b,c,d){var e,f,g,h,i,j,k,l,m=b.shape.geopolygons,n=m?m.length:0;for(a.beginPath(),j=0;n>j;j++)for(e=m[j].getPolygons(),f=e?e.length:0,k=0;f>k;k++)if(g=e[k].points,h=g?g.length:0,0!==h&&(i=g[0]))for(a.moveTo(i.x,i.y),l=1;h>l;l+=1)i=g[l],a.lineTo(i.x,i.y);c&&a.fill(),d&&a.stroke()},arc:function(a,b,c,d){var e=b.shape;a.beginPath(),e.end-e.start===2*Math.PI?(a.arc(e.cx,e.cy,e.radius,e.start+e.radianOffset,e.end+e.radianOffset,!1),a.moveTo(e.cx+e.innerRadius*Math.cos(e.radianOffset+e.start),e.cy+e.innerRadius*Math.sin(e.radianOffset+e.start)),a.arc(e.cx,e.cy,e.innerRadius,e.end+e.radianOffset,e.start+e.radianOffset,!0)):(a.arc(e.cx,e.cy,e.radius,e.start+e.radianOffset,e.end+e.radianOffset,!1),isNaN(e.innerRadius)||e.innerRadius===e.radius||(a.lineTo(e.innerRadius*Math.cos(e.end+e.radianOffset)+e.cx,e.innerRadius*Math.sin(e.end+e.radianOffset)+e.cy),e.innerRadius>0&&a.arc(e.cx,e.cy,e.innerRadius,e.end+e.radianOffset,e.start+e.radianOffset,!0),a.lineTo(e.radius*Math.cos(e.start+e.radianOffset)+e.cx,e.radius*Math.sin(e.start+e.radianOffset)+e.cy))),a.closePath(),c&&a.fill(),d&&a.stroke()},text:function(a,b){b.shape&&b.shape.text&&b.fill&&(b.shape.font&&(a.font=b.shape.font),b.shape.align&&(a.textAlign=b.shape.align),b.shape.baseline&&(a.textBaseline=b.shape.baseline),m(a,b.shape))}},q=a.extend({init:function(a,c){var f=d.extend(!0,{storeObjects:!1},c);this._container=a,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.width=0,this._canvas.height=0,f.name&&this._canvas.setAttribute("name",f.name),this.storeRenderedObjects=f.storeObjects===!0,this.scaling={x:1,y:1},this._container&&this._container.appendChild(this._canvas),this.rect=new b(0,0,0,0),this.shapes=[],this._matrix=new e},setDimensions:function(a,b,c,d){this.rect.set(a,b,c,d)},setDimensionsToContainerRatio:function(a,b){this.scaling={x:a,y:b},this.ratios={x:a,y:b}},show:function(){this._canvas.style.display=""},hide:function(){this._canvas.style.display="none"},clear:function(a){if(a){if(!this._clearTimer){var b=this;this._clearTimer=c.request(function(){b._clearTimer&&(b._canvas.width=0,b._clearTimer=0)})}}else c.cancel(this._clearTimer),this._clearTimer=0,this._canvas.width=0,this._canvas.height=0,d(this._canvas).data("shapes",null),this.shapes=[]},render:function(){c.cancel(this._clearTimer),this._clearTimer=0,s=window.devicePixelRatio||1,w=u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1,x=s/w;var a,b,e=this._canvas,g=e.getContext("2d"),h=x,i=this._matrix,j=0,k=0;return b=this.rect.height*this.scaling.y,a=this.rect.width*this.scaling.x,this.edgeBleed&&(j=this.edgeBleed.left*this.scaling.x,k=this.edgeBleed.top*this.scaling.y,b+=this.edgeBleed.top*this.scaling.y+this.edgeBleed.bottom*this.scaling.y,a+=this.edgeBleed.left*this.scaling.x+this.edgeBleed.right*this.scaling.x),b=Math.round(b),a=Math.round(a),this._canvas.style.left=-j+"px",this._canvas.style.top=-k+"px",e.width!==a||e.height!==b?(e.width=h*a,e.height=h*b,this._canvas.style.width=a+"px",this._canvas.style.height=b+"px"):g.clearRect(0,0,e.width,e.height),g.save(),i.save(),i.scale(h*this.scaling.x,h*this.scaling.y),i.translate(j/this.scaling.x,k/this.scaling.y),o(g,i,this.viewBox),n(g,i,this.shapes,this.scaling.x),p(g,this.viewBox),g.restore(),i.restore(),this.storeRenderedObjects&&d(this._canvas).data("shapes",this.shapes),f.resolve()},setFont:function(a){this._canvas.getContext("2d").font=a},getFontHeight:function(a){if("string"!=typeof a)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(a in y)return y[a];var b,c=this._canvas.getContext("2d");return c.font!==a?(c.save(),c.font=a,b=1.5*c.measureText("m").width,c.restore()):b=1.5*c.measureText("m").width,g(a,b),b},getTextWidth:function(a,b){var c,d=this._canvas.getContext("2d");
return d.save(),d.font=b,c=void 0!==a?Math.ceil(d.measureText(a).width):0,d.restore(),c},getEMFontWidth:function(a){var b,c="m",d=this._canvas.getContext("2d");return d.save(),d.font=a,b=d.measureText(c).width,d.restore(),b},getAverageLetterWidth:function(a){var b,c="eeeaaaiinnoorsstldumcph";return u.font=a||this._canvas.getContext("2d").font,b=u.measureText(c).width,b/c.length},release:function(){d(this._canvas).data("shapes",null),this.shapes=[],this._container&&(this._container.removeChild(this._canvas),this._container=null)},applyTransform:function(){var a;for(a=0;a<this.shapes.length;a+=1)this.shapes[a].type in A&&A[this.shapes[a].type](this.shapes[a].shape,this.ratios)}});var A={rect:function(a,b){a.x*=b.x,a.y*=b.y,a.width*=b.x,a.height*=b.y},line:function(a,b){a.x1*=b.x,a.y1*=b.y,a.x2*=b.x,a.y2*=b.y},circle:function(a,b){a.cx*=b.x,a.cy*=b.y,a.r*=Math.min(b.x,b.y)},polygon:function(a,b){var c,d;for(c=0;c<a.points.length;c++)d=a.points[c],d.x*=b.x,d.y*=b.y},text:function(a,b){a.x*=b.x,a.y*=b.y,a.width*=b.x,a.height*=b.y}};return q.getTextWidth=function(a){return Math.ceil(u.measureText(a).width)},q.setFont=function(a){u.font=a},q.getAverageLetterWidth=function(a){var b,c="eeeaaaiinnoorsstldumcph";return u.font=a,b=u.measureText(c).width,b/c.length},q.measureText=function(a,b){var c,d,e,f=u;return b&&f.font!==b&&(f.save(),f.font=b),d=f.measureText(a).width,b in y?c=y[b]:(c=1.5*f.measureText("m").width,g(b,c)),b&&f.restore(),e=void 0!==a?{width:d,height:c}:{width:0,height:0}},q.measureTextObject=function(a){return a.shape.font&&(u.font=a.shape.font),a.shape.align&&(u.textAlign=a.shape.align),a.shape.baseline&&(u.textBaseline=a.shape.baseline),m(u,a.shape,!0)},q.getFontHeight=function(a){var b,c=u;return a in y?y[a]:(a&&(c.save(),c.font=a),b=1.5*c.measureText("m").width,g(a,b),a&&c.restore(),b)},q.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1)},q}),define("general.utils/css-colors",[],function(){var a={aliceblue:{r:240,g:248,b:255},antiquewhite:{r:250,g:235,b:215},aqua:{r:0,g:255,b:255},aquamarine:{r:127,g:255,b:212},azure:{r:240,g:255,b:255},beige:{r:245,g:245,b:220},bisque:{r:255,g:228,b:196},black:{r:0,g:0,b:0},blanchedalmond:{r:255,g:235,b:205},blue:{r:0,g:0,b:255},blueviolet:{r:138,g:43,b:226},brown:{r:165,g:42,b:42},burlywood:{r:222,g:184,b:135},cadetblue:{r:95,g:158,b:160},chartreuse:{r:127,g:255,b:0},chocolate:{r:210,g:105,b:30},coral:{r:255,g:127,b:80},cornflowerblue:{r:100,g:149,b:237},cornsilk:{r:255,g:248,b:220},crimson:{r:220,g:20,b:60},cyan:{r:0,g:255,b:255},darkblue:{r:0,g:0,b:139},darkcyan:{r:0,g:139,b:139},darkgoldenrod:{r:184,g:134,b:11},darkgray:{r:169,g:169,b:169},darkgreen:{r:0,g:100,b:0},darkgrey:{r:169,g:169,b:169},darkkhaki:{r:189,g:183,b:107},darkmagenta:{r:139,g:0,b:139},darkolivegreen:{r:85,g:107,b:47},darkorange:{r:255,g:140,b:0},darkorchid:{r:153,g:50,b:204},darkred:{r:139,g:0,b:0},darksalmon:{r:233,g:150,b:122},darkseagreen:{r:143,g:188,b:143},darkslateblue:{r:72,g:61,b:139},darkslategray:{r:47,g:79,b:79},darkslategrey:{r:47,g:79,b:79},darkturquoise:{r:0,g:206,b:209},darkviolet:{r:148,g:0,b:211},deeppink:{r:255,g:20,b:147},deepskyblue:{r:0,g:191,b:255},dimgray:{r:105,g:105,b:105},dimgrey:{r:105,g:105,b:105},dodgerblue:{r:30,g:144,b:255},firebrick:{r:178,g:34,b:34},floralwhite:{r:255,g:250,b:240},forestgreen:{r:34,g:139,b:34},fuchsia:{r:255,g:0,b:255},gainsboro:{r:220,g:220,b:220},ghostwhite:{r:248,g:248,b:255},gold:{r:255,g:215,b:0},goldenrod:{r:218,g:165,b:32},gray:{r:128,g:128,b:128},green:{r:0,g:128,b:0},greenyellow:{r:173,g:255,b:47},grey:{r:128,g:128,b:128},honeydew:{r:240,g:255,b:240},hotpink:{r:255,g:105,b:180},indianred:{r:205,g:92,b:92},indigo:{r:75,g:0,b:130},ivory:{r:255,g:255,b:240},khaki:{r:240,g:230,b:140},lavender:{r:230,g:230,b:250},lavenderblush:{r:255,g:240,b:245},lawngreen:{r:124,g:252,b:0},lemonchiffon:{r:255,g:250,b:205},lightblue:{r:173,g:216,b:230},lightcoral:{r:240,g:128,b:128},lightcyan:{r:224,g:255,b:255},lightgoldenrodyellow:{r:250,g:250,b:210},lightgray:{r:211,g:211,b:211},lightgreen:{r:144,g:238,b:144},lightgrey:{r:211,g:211,b:211},lightpink:{r:255,g:182,b:193},lightsalmon:{r:255,g:160,b:122},lightseagreen:{r:32,g:178,b:170},lightskyblue:{r:135,g:206,b:250},lightslategray:{r:119,g:136,b:153},lightslategrey:{r:119,g:136,b:153},lightsteelblue:{r:176,g:196,b:222},lightyellow:{r:255,g:255,b:224},lime:{r:0,g:255,b:0},limegreen:{r:50,g:205,b:50},linen:{r:250,g:240,b:230},magenta:{r:255,g:0,b:255},maroon:{r:128,g:0,b:0},mediumaquamarine:{r:102,g:205,b:170},mediumblue:{r:0,g:0,b:205},mediumorchid:{r:186,g:85,b:211},mediumpurple:{r:147,g:112,b:219},mediumseagreen:{r:60,g:179,b:113},mediumslateblue:{r:123,g:104,b:238},mediumspringgreen:{r:0,g:250,b:154},mediumturquoise:{r:72,g:209,b:204},mediumvioletred:{r:199,g:21,b:133},midnightblue:{r:25,g:25,b:112},mintcream:{r:245,g:255,b:250},mistyrose:{r:255,g:228,b:225},moccasin:{r:255,g:228,b:181},navajowhite:{r:255,g:222,b:173},navy:{r:0,g:0,b:128},oldlace:{r:253,g:245,b:230},olive:{r:128,g:128,b:0},olivedrab:{r:107,g:142,b:35},orange:{r:255,g:165,b:0},orangered:{r:255,g:69,b:0},orchid:{r:218,g:112,b:214},palegoldenrod:{r:238,g:232,b:170},palegreen:{r:152,g:251,b:152},paleturquoise:{r:175,g:238,b:238},palevioletred:{r:219,g:112,b:147},papayawhip:{r:255,g:239,b:213},peachpuff:{r:255,g:218,b:185},peru:{r:205,g:133,b:63},pink:{r:255,g:192,b:203},plum:{r:221,g:160,b:221},powderblue:{r:176,g:224,b:230},purple:{r:128,g:0,b:128},red:{r:255,g:0,b:0},rosybrown:{r:188,g:143,b:143},royalblue:{r:65,g:105,b:225},saddlebrown:{r:139,g:69,b:19},salmon:{r:250,g:128,b:114},sandybrown:{r:244,g:164,b:96},seagreen:{r:46,g:139,b:87},seashell:{r:255,g:245,b:238},sienna:{r:160,g:82,b:45},silver:{r:192,g:192,b:192},skyblue:{r:135,g:206,b:235},slateblue:{r:106,g:90,b:205},slategray:{r:112,g:128,b:144},slategrey:{r:112,g:128,b:144},snow:{r:255,g:250,b:250},springgreen:{r:0,g:255,b:127},steelblue:{r:70,g:130,b:180},tan:{r:210,g:180,b:140},teal:{r:0,g:128,b:128},thistle:{r:216,g:191,b:216},tomato:{r:255,g:99,b:71},turquoise:{r:64,g:224,b:208},violet:{r:238,g:130,b:238},wheat:{r:245,g:222,b:179},white:{r:255,g:255,b:255},whitesmoke:{r:245,g:245,b:245},yellow:{r:255,g:255,b:0},yellowgreen:{r:154,g:205,b:50}};return a}),define("general.utils/color",["core.utils/class","./css-colors"],function(a,b){var c,d=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i,e=/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d+)?)\)$/i,f=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i,g=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i,h=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i,i=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i,j=Math.floor,k=Math.round;return c=a.extend({init:function(){var a,d,e,f,g,h,i,l,m,n,o,p=0,q=0,r=0,s=1;if(arguments[0]instanceof c)p=arguments[0]._r,q=arguments[0]._g,r=arguments[0]._b,s=arguments[0]._a;else if(arguments.length<3)if("string"==typeof arguments[0])if(o=arguments[0],n=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(o))p=parseInt(n[1],10),q=parseInt(n[2],10),r=parseInt(n[3],10);else if(n=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d+)?)\s*\)$/i.exec(o))p=parseInt(n[1],10),q=parseInt(n[2],10),r=parseInt(n[3],10),s=parseFloat(n[4]);else if(n=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(o))p=parseInt(n[1],16),q=parseInt(n[2],16),r=parseInt(n[3],16),s=1;else if(n=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(o))p=parseInt(n[1]+n[1],16),q=parseInt(n[2]+n[2],16),r=parseInt(n[3]+n[3],16),s=1;else if(n=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i.exec(o)){switch(a=parseFloat(n[1]),d=parseFloat(n[3]),f=parseFloat(n[5]),a%=360,d/=100,f/=100,a=0>a?0:a>360?360:a,d=0>d?0:d>1?1:d,f=0>f?0:f>1?1:f,g=.5>=f?2*f*d:(2-2*f)*d,h=a/60,i=g*(1-Math.abs(h%2-1)),l=[],h=Math.floor(h)){case 0:l=[g,i,0];break;case 1:l=[i,g,0];break;case 2:l=[0,g,i];break;case 3:l=[0,i,g];break;case 4:l=[i,0,g];break;case 5:l=[g,0,i];break;default:l=[0,0,0]}m=f-.5*g,p=l[0]+m,q=l[1]+m,r=l[2]+m,p=k(255*p),q=k(255*q),r=k(255*r),s=1}else if(n=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(o)){switch(a=parseFloat(n[1]),d=parseFloat(n[3]),f=parseFloat(n[5]),s=parseFloat(n[7]),a%=360,d/=100,f/=100,a=0>a?0:a>360?360:a,d=0>d?0:d>1?1:d,f=0>f?0:f>1?1:f,g=.5>=f?2*f*d:(2-2*f)*d,h=a/60,i=g*(1-Math.abs(h%2-1)),l=[],h=Math.floor(h)){case 0:l=[g,i,0];break;case 1:l=[i,g,0];break;case 2:l=[0,g,i];break;case 3:l=[0,i,g];break;case 4:l=[i,0,g];break;case 5:l=[g,0,i];break;default:l=[0,0,0]}m=f-.5*g,p=l[0]+m,q=l[1]+m,r=l[2]+m,p=k(255*p),q=k(255*q),r=k(255*r)}else b[o.toLowerCase()]?(e=o.toLowerCase(),p=b[e].r,q=b[e].g,r=b[e].b,s=1):this._invalid=!0;else"number"==typeof arguments[0]&&arguments[0]>=0&&"argb"===arguments[1]?(s=(4278190080&arguments[0])>>>24,s/=255,p=(16711680&arguments[0])>>16,q=(65280&arguments[0])>>8,r=255&arguments[0]):"number"==typeof arguments[0]&&arguments[0]>=0?(p=(16711680&arguments[0])>>16,q=(65280&arguments[0])>>8,r=255&arguments[0]):this._invalid=!0;else arguments.length>=3?(p=arguments[0],q=arguments[1],r=arguments[2],s=arguments.length>=4?arguments[3]:1):this._invalid=!0;this._r=j(p),this._g=j(q),this._b=j(r),this._a=s,this._spaces={}},isInvalid:function(){return this._invalid},setAlpha:function(a){this._a=a,this._spaces={}},getAlpha:function(){return this._a},toRGB:function(){return this._spaces.rgb||(this._spaces.rgb=c.toRGB(this)),this._spaces.rgb},toRGBA:function(){return this._spaces.rgba||(this._spaces.rgba=c.toRGBA(this)),this._spaces.rgba},toString:function(){return this._spaces.rgb||(this._spaces.rgb=c.toRGB(this)),this._spaces.rgb},toHex:function(){return this._spaces.hex||(this._spaces.hex=c.toHex(this)),this._spaces.hex},toHSL:function(a){return this._spaces.hsl||(this._spaces.hsl=c.toHSL(this,a)),this._spaces.hsl},toHSLA:function(a){return this._spaces.hsla||(this._spaces.hsla=c.toHSLA(this,a)),this._spaces.hsla},toNumber:function(){return this._spaces.num||(this._spaces.num=c.toNumber(this)),this._spaces.num},isDark:function(){return this.getLuminance()<125},getLuminance:function(){return"undefined"==typeof this._lumi&&(this._lumi=.299*this._r+.587*this._g+.114*this._b),this._lumi},shiftLuminance:function(a){var b,c,d,e,f,g=this.toHSLA();return f=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(g),b=parseFloat(f[1]),c=parseFloat(f[3]),d=parseFloat(f[5]),e=parseFloat(f[7]),d+=a,d=Math.max(0,Math.min(d,100)),"hsla("+b+","+c+","+d+","+e+")"},isEqual:function(a){return a instanceof c?this._r===a._r&&this._g===a._g&&this._b===a._b:(a=new c(a),this._r===a._r&&this._g===a._g&&this._b===a._b)},blend:function(a,b){var c=j(this._r+(a._r-this._r)*b),d=j(this._g+(a._g-this._g)*b),e=j(this._b+(a._b-this._b)*b),f=j(this._a+(a._a-this._a)*b);return"rgba("+[c,d,e,f].join(",")+")"},createShiftedColor:function(a){(void 0===a||isNaN(a))&&(a=1);var b=this.getLuminance(),d=this._g<126?1:1+this._g/512,e=this.shiftLuminance(20*(220>b*d?.8+4*(1/(b+1)):-(.8+1*(b/255)))*a);return new c(e)}}),c.toRGB=function(a){if(a instanceof c)return"rgb("+[a._r,a._g,a._b].join(",")+")";"string"==typeof a&&(a=c.toNumber(a));var b=(16711680&a)>>16,d=(65280&a)>>8,e=255&a;return"rgb("+b+","+d+","+e+")"},c.toRGBA=function(a,b){if(a instanceof c)return"rgba("+[a._r,a._g,a._b,"undefined"!=typeof b?b:a._a].join(",")+")";"string"==typeof a&&(a=c.toNumber(a));var d=(16711680&a)>>16,e=(65280&a)>>8,f=255&a;return"rgba("+d+","+e+","+f+","+("undefined"!=typeof b?b:a._a)+")"},c.toHex=function(a){var b,d,e;return a instanceof c?(b=a._r.toString(16),d=a._g.toString(16),e=a._b.toString(16),1===b.length&&(b="0"+b),1===d.length&&(d="0"+d),1===e.length&&(e="0"+e),"#"+[b,d,e].join("")):("string"==typeof a&&(a=c.toNumber(a)),b=((16711680&a)>>16).toString(16),d=((65280&a)>>8).toString(16),e=(255&a).toString(16),1===b.length&&(b="0"+b),1===d.length&&(d="0"+d),1===e.length&&(e="0"+e),"#"+b+d+e)},c.toHSL=function(a,b){var d,e,f,g,h,i,j,k,l=0;if("string"==typeof a&&(a=new c(a)),d=a._r/255,e=a._g/255,f=a._b/255,i=Math.max(d,e,f),j=Math.min(d,e,f),h=b?.21*d+.72*e+.07*f:(i+j)/2,i===j)l=g=0;else{switch(k=i-j,g=h>.5?k/(2-i-j):k/(i+j),i){case d:l=(e-f)/k+(f>e?6:0);break;case e:l=(f-d)/k+2;break;case f:l=(d-e)/k+4}l/=6}return"hsl("+360*l+","+100*g+","+100*h+")"},c.toHSLA=function(a,b){var d,e,f,g,h,i,j,k,l,m=0;if("string"==typeof a&&(a=new c(a)),d=a._r/255,e=a._g/255,f=a._b/255,g=a._a,j=Math.max(d,e,f),k=Math.min(d,e,f),i=b?.21*d+.72*e+.07*f:(j+k)/2,j===k)m=h=0;else{switch(l=j-k,h=i>.5?l/(2-j-k):l/(j+k),j){case d:m=(e-f)/l+(f>e?6:0);break;case e:m=(f-d)/l+2;break;case f:m=(d-e)/l+4}m/=6}return"hsla("+360*m+","+100*h+","+100*i+","+g+")"},c.toNumber=function(){if(1===arguments.length&&arguments[0]instanceof c)return(arguments[0]._r<<16)+(arguments[0]._g<<8)+arguments[0]._b;var a,b,d=0,e=0,f=0;return 1===arguments.length&&"string"==typeof arguments[0]&&(b=arguments[0],(a=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i.exec(b))?(d=parseInt(a[1],10),e=parseInt(a[2],10),f=parseInt(a[3],10)):(a=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(b))?(d=parseInt(a[1],16),e=parseInt(a[2],16),f=parseInt(a[3],16)):(a=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(b))&&(d=parseInt(a[1]+a[1],16),e=parseInt(a[2]+a[2],16),f=parseInt(a[3]+a[3],16))),(d<<16)+(e<<8)+f},c.blend=function(a,b,d){a=c.toNumber(a),b=c.toNumber(b);var e=(16711680&a)>>16,f=(65280&a)>>8,g=255&a,h=(16711680&b)>>16,i=(65280&b)>>8,j=255&b,k=e+(h-e)*d,l=f+(i-f)*d,m=g+(j-g)*d;return(k<<16)+(l<<8)+m},c.getBlend=function(a,b,d){var e=a._r+(b._r-a._r)*d,f=a._g+(b._g-a._g)*d,g=a._b+(b._b-a._b)*d,h=a._a+(b._a-a._a)*d;return new c(e,f,g,h)},c.isCSSColor=function(a){return arguments.length>1||"string"!=typeof a?!1:d.test(a)||e.test(a)||f.test(a)||g.test(a)||h.test(a)||i.test(a)||b[a.toLowerCase()]},c.getBestContrast=function(a,b,c){var d=a.getLuminance();return Math.abs(d-b.getLuminance())>Math.abs(d-c.getLuminance())?b:c},c.getContrast=function(a,b){if(a&&b){var c=a.getLuminance()/100,d=b.getLuminance()/100;return c>d?(c+.05)/(d+.05):(d+.05)/(c+.05)}},c.isDark=function(){var a={getLuminance:c.prototype.getLuminance};return c.prototype.init.apply(a,[].slice.call(arguments)),c.prototype.isDark.call(a)},c.useDarkLabel=function(a,b){return a._a>.5?!a.isDark():!b},c}),define("extensions.qliktech/barchart/layers/label-layer",["core.utils/class","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","general.utils/color","objects.views/charts/utils/tree-iterator"],function(a,b,c,d){"use strict";function e(a,b){return a?d.useDarkLabel(b,t)?q.label.dark.color:q.label.light.color:t?q.label.light.color:q.label.dark.color}function f(a,b,c,d,e,f,g){return{type:"text",fill:q.label.dark.color,opacity:d||1,data:{value:b,rect:c,labelRect:f,hintDirection:g,color:e},shape:{text:a,maxNumLines:1,align:"center",baseline:"middle"}}}function g(a){var b,c,d,e;return b=a.descendants.filter(function(a){return!a.isBranch&&a.data.isVisible!==!1}),c=b.map(function(a){return a.data.hitRect}),c.length?(d=c[0],c.length>1&&(d=d.combineWith(c.slice(-1)[0])),e=f(a.data.valueLabel,a.data.sum,d,b[b.length-1].opacity,b[b.length-1].data.color,null,null),e.data.isFillPattern=window.CanvasPattern&&b[b.length-1].fill instanceof window.CanvasPattern,e.data.lastRect=c[c.length-1],e):void 0}function h(a,b){var c,d;a.forEach(function(a){c=a.children,a.data.isStack?(d=g(a),d&&(d.data.isStack=!0,b.push(d))):c&&c.length?h(c,b):a.data.isVisible!==!1&&b.push(f(a.data.valueLabel,a.data.value,a.data.hitRect,a.opacity,a.data.color,a.data.labelRect,a.data.hintDirection))})}function i(a,b){Object.keys(b).forEach(function(c){a[c]=b[c]})}function j(){var a,c,d,e,f=[],g=this.minorAxis.getPlotMin(),i=this.minorAxis.getPlotMax(),j=q.label.font,m=this.bounds;h(this._shapes,f),b.setFont(j),this.renderer.setFont(j),f=f.filter(function(a){return"NaN"===a.data.value?!0:a.data.labelRect||a.data.showHintLabel?!0:a.data.value>=0&&i>=a.data.value&&g<=a.data.value?!0:a.data.value<0&&g<=a.data.value&&i>=a.data.value?!0:a.data.rect.width&&a.data.rect.height&&m.intersectsWith(a.data.rect)?!0:!1});var o,p,s;for(this._shapes&&this._shapes.length?(p=this._shapes[0].descendants.filter(function(a){return!a.isBranch})[0],s=p?p.data.hitRect.width:this.majorAxis._discreteSpacing):s=0,o=0,a=f?f.length:0,d=0;a>d;d++)c=f[d],c.shape&&(c.shape.font=j,c.data.labelWidth=b.getTextWidth(c.shape.text),o=Math.max(o,c.data.labelWidth));this._longestLabel=o,e=this._longestLabel<s;var u;for(u=this.minorAxis.isVertical()?e?k:l:n,d=0;a>d;d++)u.call(this,f[d],s);f.slice().forEach(function(a){a.fill&&a.backdrop&&(f.unshift({opacity:a.opacity||1,type:"roundRect",fill:r,shape:a.backdrop}),a.fill=t?q.label.light.color:q.label.dark.color)}),this.renderer.shapes=f,this.renderer.render()}function k(a,b){for(var c,d=this.renderer.getFontHeight(q.label.font),f=m.apply(this,[a,!1,b]),g=0;g<f.length;g++)if(i(a.shape,f[g].rect),d<f[g].rect.height){c=f[g];break}if(c){var h=c.rect.width-a.data.labelWidth;i(a.shape,c.rect),a.shape.baseline=c.baseline,a.shape.align=c.align,a.data.isStack&&c.inline&&(a.data.lastRect.height<20||a.data.isFillPattern)?a.backdrop={x:c.rect.x+Math.min(h/2,4),y:"top"===c.baseline?c.rect.y:c.rect.y+c.rect.height-16,width:Math.max(c.rect.width-Math.min(h,8)),height:16,radius:4}:(a.fill=e(c.inline,a.data.color),a.backdrop=!1)}else a.fill=!1}function l(a,d){var f,g,h,j=m.apply(this,[a,!0,d]);f="labelWidth"in a.data?a.data.labelWidth:b.getTextWidth(a.shape.text);for(g=0;g<j.length;g++)if(j[g].rect.height>=f){h=j[g];break}if(h||(j.sort(function(a,b){return.8*b.rect.height-a.rect.height}),j[0].rect.height>=8&&(h=j[0])),h){var k=new c;k.translate(h.rect.x,h.rect.y+h.rect.height),k.rotate(-Math.PI/2),i(a.shape,{width:h.rect.height,height:h.rect.width,baseline:h.baseline,align:h.align,x:0,y:0}),a.transform=k.elements,a.data.isStack&&h.inline&&(a.data.lastRect.height<f+4||a.data.isFillPattern)?a.backdrop={radius:4,x:h.rect.x+h.rect.width/2-8,y:"right"===h.align?h.rect.y-4:h.rect.y+h.rect.height-f-4,width:16,height:f+8}:(a.fill=e(h.inline,a.data.color),a.backdrop=!1)}else a.fill=!1}function m(a,b,c){var d,e,f,g,h=b&&a.data.isStack?8:4,i=[];return d=a.data.rect.width,e=a.data.rect.height,f=a.data.rect.x,g=a.data.rect.y,"up"!==a.data.hintDirection&&a.data.value>=0||"down"===a.data.hintDirection?(g-this.bounds.y-2*h>4&&i.push({align:b?"left":"center",baseline:b?"middle":"bottom",rect:{x:f-.5*(c-d),y:this.bounds.y+h,width:c,height:g-this.bounds.y-2*h}}),a.data.labelRect&&(d=a.data.labelRect.width,e=a.data.labelRect.height,f=a.data.labelRect.x,g=a.data.labelRect.y),a.data.hintDirection||i.push({align:b?"right":"center",baseline:b?"middle":"top",inline:!0,rect:{x:f,y:g+h,width:d,height:e-2*h}})):(this.bounds.height-g-e-2*h>0&&i.push({align:b?"right":"center",baseline:b?"middle":"top",rect:{x:f-.5*(c-d),y:g+e+h,width:c,height:this.bounds.height-g-e-2*h}}),a.data.labelRect&&(d=a.data.labelRect.width,e=a.data.labelRect.height,f=a.data.labelRect.x,g=a.data.labelRect.y),a.data.hintDirection||i.push({align:b?"left":"center",baseline:b?"middle":"bottom",inline:!0,rect:{x:f,y:g+h,width:d,height:e-2*h}})),i}function n(a,c){var d,f,g,h;g=o.apply(this,[a,c]),d="labelWidth"in a.data?a.data.labelWidth:b.getTextWidth(a.shape.text);for(f=0;f<g.length;f++)if(g[f].rect.width>=d){h=g[f];break}!h&&g.length&&(g.sort(function(a,b){return.8*b.rect.width-a.rect.width}),g[0].rect.width>=8&&(h=g[0])),h?(a.shape.baseline="middle",a.shape.align=h.align,i(a.shape,h.rect),a.data.isStack&&h.inline&&(a.data.lastRect.width<d+8||a.data.isFillPattern)?a.backdrop={y:h.rect.y+h.rect.height/2-8,height:16,x:("right"===h.align?h.rect.x+h.rect.width-d:h.rect.x)-4,width:d+8,radius:4}:(a.fill=e(h.inline,a.data.color),a.backdrop=!1)):a.fill=!1}function o(a){var b,c,d,e,f=a.data.isStack?8:4,g=[];return b=a.data.rect.width,c=a.data.rect.height,d=a.data.rect.x,e=a.data.rect.y,"right"!==a.data.hintDirection&&a.data.value>=0||"left"===a.data.hintDirection?(this.bounds.width-d-b-2*f>0&&g.push({align:"left",rect:{x:d+b+f,y:e,width:this.bounds.width-d-b-2*f,height:c}}),a.data.labelRect&&(b=a.data.labelRect.width,c=a.data.labelRect.height,d=a.data.labelRect.x,e=a.data.labelRect.y),a.data.hintDirection||g.push({align:"right",inline:!0,rect:{x:d+f,y:e,width:b-2*f,height:c}})):(d-this.bounds.x-2*f&&g.push({align:"right",rect:{x:this.bounds.x+f,y:e,width:d-this.bounds.x-2*f,height:c}}),a.data.labelRect&&(b=a.data.labelRect.width,c=a.data.labelRect.height,d=a.data.labelRect.x,e=a.data.labelRect.y),a.data.hintDirection||g.push({align:"left",inline:!0,rect:{x:d+f,y:e,width:b-2*f,height:c}})),g}var p,q,r,s,t;return p=a.extend("LabelLayer",{init:function(a){this.renderer=new b(a)},setData:function(a){this._data=a},setMeasureIndices:function(){},setBarData:function(a){this._barData=a},setShapes:function(a){this._shapes=a},show:function(){this.renderer.show()},hide:function(){this.renderer.hide()},release:function(){this.renderer.release()},render:function(){q=this.style.dataPoints,s=new d(this.style.backgroundColor),t=s.isDark(),r=d.toRGBA(s,.75),j.call(this)}})}),define("objects.views/charts/style",[],function(){return{shape:{selected:{border:{color:"rgba(255, 0, 0, 0.8)",width:2}},unselected:{opacity:.5}}}}),define("objects.views/charts/chart-style-service",["core.utils/class","core.utils/theme","./style"],function(a,b){"use strict";function c(a,b){if("string"==typeof a&&"@"===a[0]){var d=a.substring(1);return b[d]?c(b[d],b):a}return a}function d(a,b,c,d,f){var g,h=b.split("."),i=a,j=f;for(void 0!==i[c]&&(j=i[c]),g=0;g<h.length;++g){if(void 0===i[h[g]])return j;i=i[h[g]],void 0!==i[c]&&(j=i[c])}return void 0!==i[c]&&(j=i[c]),["string","number","boolean","array"].contains(typeof j)?j:j?void 0!==j["default"]||void 0!==d?e(j,d,f):f:null}function e(a,b){var c,d,e=a,f=a["default"];if(!b)return f;for(c=b.split("."),d=0;d<c.length;++d){if(void 0===e[c[d]])return f;e=e[c[d]],f=e}return f}function f(a){a=a||{};var b=a;return b}function g(a,b){return a=a.substring(0,a.length-2),a*=b,a+"px"}var h,i;return h=a.extend("ChartStyleService",{init:function(){this._baseStyle=b,this._chartStyles=b,this._fontCache={},this._variables=f(b._variables);var a=this;b.ThemeChanged.bind(function(){a._variables=f(b._variables)})},getValue:function(a,b,e,f,g){return a=a||"",""===a||this._chartStyles[a]?(""!==a&&(a+="."),b&&(a+=b),c(d(this._chartStyles,a,e,f,g),this._variables)):g},getFont:function(a,b,c,e,f,h){if(a=a||"",h=h||1,""===a||this._chartStyles[a]){""!==a&&(a+="."),b&&(a+=b);var i=c?a+"."+c:a;if(this._fontCache[i])return this._fontCache[i];var j=d(this._chartStyles,a,"lineHeight",c),k=d(this._chartStyles,a,"fontFamily",c),l=[d(this._chartStyles,a,"fontStyle",c)||"",d(this._chartStyles,a,"fontVariant",c)||"",d(this._chartStyles,a,"fontWeight",c)||"",d(this._chartStyles,a,"fontStretch",c)||"",f||0===f?f+"px":g(d(this._chartStyles,a,"fontSize",c)||"12px",h),j?"/"+j:"",k?"'"+k+"'":"'Qlikview Sans'"];return l=l.filter(function(a){return""!==a}),this._fontCache[a+"."+c]=l.join(" "),this._fontCache[a+"."+c]}return e}}),i=new h,i.layoutMap={1:"spark",3:"xsmall",7:"small",15:"medium",31:"full"},{getInstance:function(){return i}}}),define("extensions.qliktech/barchart/style",[],function(){return{dataPoint:{label:{dark:{color:"#666"},light:{color:"#eee"},font:"11px 'QlikView Sans'"}},shape:{selected:{border:{color:"#333",width:2}},unselected:{opacity:.5},highlighted:{border:{dark:{color:"rgba( 26, 26, 26, 0.75 )"},light:{color:"rgba( 230, 230, 230, 0.75)"},width:1}}}}}),define("extensions.qliktech/barchart/bararea",["objects.views/charts/components/chart-component","./layers/bar-layer","./layers/label-layer","general.utils/color","objects.utils/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","objects.views/charts/chart-style-service","core.utils/deferred","./style"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){var b=1;return q.width=5*b,q.height=5*b,r.save(),r.fillStyle=d.toRGBA(a,.8),r.scale(b,b),r.fillRect(0,0,1,1),r.fillRect(0,1,1,1),r.fillRect(1,0,1,1),r.fillRect(4,1,1,1),r.fillRect(4,2,1,1),r.fillRect(3,2,1,1),r.fillRect(3,3,1,1),r.fillRect(2,3,1,1),r.fillRect(2,4,1,1),r.fillRect(1,4,1,1),r.restore(),r.createPattern(q,"repeat")}function l(a,b){var c=a.layoutMap[b]||"medium",d={shape:{selected:{border:{color:a.getValue(n,"shape.border","color","selected"),width:a.getValue(n,"shape.border","width","selected")}}},dataPoints:{label:{font:a.getFont(n,"value",c),dark:{color:a.getValue(n,"value","color","dark")},light:{color:a.getValue(n,"value","color","light")}}},backgroundColor:a.getValue(n,null,"backgroundColor")};return d}var m,n="barChart",o="stacked",p="grouped",q=document.createElement("canvas"),r=q.getContext("2d");return m=a.extend("BarArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._barData=[],this._showDataPoints=!0,this._colorMap=null,this._groupingMode=p,this._globalAlpha=1,this._styleService=i.getInstance(),this._barLayer=new b(this.container),this._barLayer.isMini=this.isMini,this.layers=[this._barLayer],this.isMini||(this._labelLayer=new c(this.container),this.layers.push(this._labelLayer))},beforeBarsAddedToRenderer:function(){},barsAddedToRenderer:function(){},labelAddedToRenderer:function(){},afterPaint:function(){return j.resolve()},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setShowDataPoints:function(a){this._showDataPoints=a,this.invalidateDisplay("BarArea.setShowDataPoints")},getShowDataPoints:function(){return this._showDataPoints},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(a){this._measureIndices=a},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay("BarArea.setMajorAxis")},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this._localFormatting&&(this._areLabelsFormatted=!1),this.invalidateDisplay("BarArea.setMinorAxis")},this)},setDimensionTree:function(a){this._tree=a},setGroupingMode:function(a){this._groupingMode=a},_updateSize:function(){this.invalidateDisplay("BarArea._updateSize")},insertAdjacentTo:function(a,b){if(this._super(a,b),this._minorAxis&&this._minorAxis.isHorizontal())switch(this._minorAxis.dock){case"bottom":this.rect.height-=1}},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},setCacheItems:function(a){this._cacheItems=a},getCacheItems:function(){return this._cacheItems},createAxisData:function(a,b,c,d){d||(this._cacheIndex=0);var e,f=b.stackLevel===d+1,g=a.children;return"measure"===b.types[d]&&this._measureIndices&&(g=g.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),g.map(function(a){var g;if("dimension"===b.types[d]){if(g={label:a.data.qText,group:"dimension"===b.types[d+1]||"measure"===b.types[d+1]&&b.numMeasures>1,id:a.data.id,cacheIndex:[]},"measure"===b.types[d+1])for(e=0;e<b.numMeasures;e++)g.cacheIndex.push(this._cacheIndex++);!f&&("dimension"===b.types[d+1]||"measure"===b.types[d+1]&&b.numMeasures>1)&&(g.children=this.createAxisData(a,b,c,d+1))}else"measure"===b.types[d]&&(g={label:a.data.qText,id:a.data.id});return g}.bind(this))},_createMeasureDisplayNode:function(a,b){if(a.isBranch){var c=this.isMini===!0||this._isStacked?new h:new g,d=a.children,f=d[0].data,i=a.parent.cacheItem,j=new e(0,0,0,0),k=this.measureFormatters[b],l="undefined"!=typeof f.qValue?f.qValue:f.qNum,m=a.ancestors.filter(function(a){return"qElemNo"in a.data}).map(function(a){return a.data.qElemNo}).reverse();return c.data={qText:a.data.qText,measureIndex:b,value:l,start:0,end:l,valueLabel:a.children[0].data.qText,formatted:!k||"U"!==k.type,hitRect:j,cacheItem:i,color:this._colorMap.getColor(m,l,b,a.data.rowIndex)},i.addShape("dataArea",j,!0),i.calculateTooltipPosition=!0,c.data.fill=c.data.color.toRGBA(),c.fill=c.data.fill,c.data.isFillColorDark=c.data.color.isDark(),c}},_createDimensionDisplayNode:function(a){var b=new f;return b.data={qText:a.data.qText,qElemNo:a.data.qElemNo,qMaxPos:a.data.qMaxPos,qMinNeg:a.data.qMinNeg,qType:a.data.qType},b},_createStackNode:function(){var a=new f;return a.data={stack:!0},a},_createOtherNode:function(a,b){var c=new h,d=new e(0,0,0,0),f=this.measureFormatters[0];return c.data={measureIndex:0,value:b-a,start:a,end:b,isFakeOtherCell:!0,highlightOnGroupSelect:0===this._selectionIndices[0],valueLabel:"valueLabel",formatted:!f||"U"!==f.type,hitRect:d,cacheItem:{},color:this._colorMap.getColor([-3],b-a,0,0)},c.data.fill=c.data.color.toRGBA(),c.fill=c.data.fill,c.data.isFillColorDark=c.data.color.isDark(),c},_addOtherNode:function(a,b,c){var d=this._createDimensionDisplayNode({data:{qMaxPos:0,qMinNeg:0,qElemNo:-3,qType:"O"}}),e=this._createOtherNode(a.data.sum,b);return e.data.axisId=c.data.id,e.data.cacheItem=c.cacheItem,d.addChild(e),a.data.sum=b,a.addChild(d),e},_stackNodes:function(a,b,c,d){var e,f,g,h,i,j=this._createStackNode(),k=this._createStackNode(),l=!1,m=!1,n=0,o=0;j.data.isStack=!0,k.data.isStack=!0,a.forEach(function(a){e=b,g=a.children&&a.children[0]?a.children[0].data:a.data,g.value>=0?(e=j,g.start=n,n+=g.value,g.end=n,f=n,h=!0,e.addChild(a),"O"===a.data.qType&&(l=!0)):isNaN(g.value)||(e=k,g.start=o,o+=g.value,g.end=o,f=o,i=!0,e.addChild(a),"O"===a.data.qType&&(m=!0)),e.data.sum=f}),"undefined"==typeof b.data.qMaxPos||l||n===b.data.qMaxPos||(d.push(this._addOtherNode(j,b.data.qMaxPos,c)),n=j.data.sum,h=n>0),"undefined"==typeof b.data.qMinNeg||m||o===b.data.qMinNeg||(d.push(this._addOtherNode(k,b.data.qMinNeg,c)),o=k.data.sum,i=0>o),h&&(j.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(j.data.sum):j.data.sum+"",b.addChild(j)),i&&(k.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(k.data.sum):k.data.sum+"",b.addChild(k)),b.data.sum={positive:n,negative:o}},getRenderTree:function(a,b,c,d){var e,f,g,h,i,j,k,l=b.stackLevel===d+1,m=[];for(g=a.children,"measure"===b.types[d]&&this._measureIndices&&(g=g.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),i=g.length,h=0;i>h;h++)if(k=g[h],"dimension"===b.types[d])j=this._createDimensionDisplayNode(k),f=this.getRenderTree(k,b,c,d+1),l?(this._stackNodes(f,j,k,c.otherShapes),c.globalPositiveSum=Math.max(c.globalPositiveSum,j.data.sum.positive),c.globalNegativeSum=Math.min(c.globalNegativeSum,j.data.sum.negative)):j.addChildren(f),j.isBranch&&m.push(j);else if("measure"===b.types[d]){if(j=this._createMeasureDisplayNode(k,this._measureIndices?this._measureIndices[h]:h),!j)continue;e=k,b.numMeasures<=1&&(e=e.parent),b.stackLevel===d&&(e=e.parent),j.data.axisId=e.data.id,c.shapes.push(j),m.push(j)}return m},_applyIds:function(a,b,c,d){var e;a.children.forEach(function(f,g){e=a.data.id?a.data.id+";"||"":"","dimension"===c[d]?(f.data.id=e+b[d]+":"+f.data.qElemNo,this._applyIds(f,b,c,d+1)):"measure"===c[d]&&(f.data.id=e+b[d+g])}.bind(this))},_updateProperties:function(){if(this._data&&this._tree){this._barLayer.renderer.stage.removeChildren();var a=this._data.qHyperCube.qDimensionInfo.length,b=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,c=this._groupingMode===o&&(a>1||b>1),d=a+1,e=-2,f=new Array(a).join(",").split(",").map(function(){return"dimension"}),g=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(a){return a.cId}),h=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.qApprMaxGlyphCount});f.push("measure"),h.push(this._data.qHyperCube.qMeasureInfo.reduce(function(a,b){return Math.max(a,b.qApprMaxGlyphCount)},0)),c&&(e=b>1?a:a-1),this._isStacked=c;var i={columns:[],shapes:[],shapesToLabel:[],otherShapes:[],
globalPositiveSum:0,globalNegativeSum:0},j={colIds:g,types:f,numLevels:d,numMeasures:b,stackLevel:e};a>1&&this._allowInnerSelection&&!this._data.qHyperCube.qDimensionInfo[1].qLocked?(this.setSelectionIndices([1]),this._majorAxis.setSelectionIndices([1]),this._majorAxis.setCurrentDataIndices([1])):(this.setSelectionIndices([0]),this._majorAxis.setSelectionIndices([0]),this._majorAxis.setCurrentDataIndices([0])),this._applyIds(this._tree,g,f,0);var k=this.getRenderTree(this._tree,j,i,0);this._objects=k,this._formatted=this._isStacked||this.measureFormatters.every(function(a,b){var c=this._measureIndices?this._measureIndices.indexOf(b)>=0:!0;return c?"U"!==a.type:!0},this),this._shapes=i.shapes;var l=i.shapes.map(function(a){return a.data.cacheItem});this._shapes=this._shapes.concat(i.otherShapes),k.forEach(function(a){this._barLayer.renderer.stage.addChild(a)}.bind(this));var m=this.createAxisData(this._tree,j,i,0),n=f.map(function(a,b){return{qApprMaxGlyphCount:h[b],show:b<f.length-1}});this._majorAxisData={data:m,info:n,groupSize:c?null:b},this._numDimensions=a,this._numMeasures=b,this._minorAxisData=c?{min:i.globalNegativeSum,max:i.globalPositiveSum}:null,this.setSelectableShapes(l)}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree&&(this._data.qHyperCube.qStackedDataPages.length>0||this._data.qHyperCube.qDataPages.length>0)},updateSize:function(){this._super(),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y),a.renderer.setDimensions(0,0,this.rect.width,this.rect.height)},this)},paint:function(){this._super(this._layoutMode,this._data),this._majorAxis.updateNow(),this._minorAxis.updateNow();var a=this._minorAxis.getPadding(),b=new e,c=this;return this._style=l(this._styleService,this._layoutMode),b.set(a.left,a.top,this.rect.width-a.left-a.right,this.rect.height-a.top-a.bottom),this.layers.forEach(function(a){a.minorAxis=this._minorAxis,a.majorAxis=this._majorAxis,a.shapes=this._shapes,a.othersFillPattern=k(this._colorMap.getColor([-3])),a.groupingMode=this._groupingMode,a.widthRatio=this._numDimensions<=1&&this._numMeasures<=1||this._groupingMode===o?.7:.95,a.isSpikingEnabled=!(this.isMini||this._groupingMode===o&&(this._numDimensions>1||this._numMeasures>1)),a.isHintingEnabled=!this.isMini&&(this._groupingMode===p||this._groupingMode===o&&this._numDimensions+this._numMeasures<=2),a.style=this._style,a._globalAlpha=this._globalAlpha},this),this._barLayer.colorMap=this._colorMap,this._barLayer.update(),this.nodesInView=this._barLayer.nodesInView,this.barsAddedToRenderer(),this._labelLayer&&(this._labelLayer.setShapes(this._objects),this._labelLayer.bounds=b,this._labelLayer._longestLabel=20,this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPoints?(this._formatLabels(),this._labelLayer.show(),this._labelLayer.render()):this._labelLayer.hide()),this._barLayer.render().then(function(){return c.afterPaint()})},_formatLabels:function(){if(!this._isStacked&&!this._formatted){var a,b,c=this.nodesInView?this.nodesInView.length:0;for(a=0;c>a;a++)b=this.nodesInView[a].data,b.formatted||(b.formatted=!0,b.valueLabel=this.measureFormatters[b.measureIndex]?this.measureFormatters[b.measureIndex].formatValue(b.value):b.valueLabel)}},release:function(){this.layers.forEach(function(a){a.release()}),this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this)}})}),define("extensions.qliktech/barchart/barchart-properties",["translator","general.utils/property-resolver"],function(a,b){function c(a,c){var d=b.getValue(a,"color.auto"),e=b.getValue(a,"color.mode"),f=c.getDimensions();return f.length>1&&!d&&"byDimension"===e}function d(a,b){return b?b.getMeasureLayouts():a.qHyperCubeDef.qMeasures.map(function(a){return a.qDef})}function e(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}var f,g,h;f={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"∫",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"ª",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(a){var b=a.qHyperCubeDef.qMeasures.length,c=a.qHyperCubeDef.qDimensions.length;return b+c>2},change:function(a,b){b.getDimensions().length>1&&"stacked"===a.barGrouping.grouping?(a.qHyperCubeDef.qMode="K",a.qHyperCubeDef.qAlwaysFullyExpanded=!0):a.qHyperCubeDef.qMode="S"}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,items:[{component:"icon-item",icon:"º",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"Ω",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a){return a.gridLine&&!a.gridLine.auto}}}},showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-dataPoints"}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-dropdown",translation:"properties.colorDimensionId",show:function(a,b){return c(a,b)}}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var d,f="y",g=e(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return"vertical"===b.orientation&&(f="x"),d=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",group:!1,tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a){return"vertical"===a.orientation&&a.dimensionAxis&&["all","labels"].contains(a.dimensionAxis.show)}},dock:{ref:"dimensionAxis.dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:function(a){var b,c;return"vertical"===a.orientation?(b="Common.Bottom",c="Common.Top"):(b="properties.dock.left",c="properties.dock.right"),[{value:"near",translation:b},{value:"far",translation:c}]},show:function(a){return a.dimensionAxis&&"none"!==a.dimensionAxis.show}}}},measureAxis:{uses:"measureAxis",label:function(b,c){var e,f="x",g=d(b,c).map(function(a){return a.qFallbackTitle}).join(", ");return"vertical"===b.orientation&&(f="y"),e=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{axis:{type:"items",items:{show:{snapshot:{title:"properties.yAxis",group:!1,tid:"property-yAxis"}}}}}}}},g={uses:"sorting",items:{dimensions:{locked:function(a,b,c){return 1===c.getMeasures().length&&2===c.getDimensions().length?0===a:!1}}}},h={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"},refLines:{uses:"reflines"}}};var i={uses:"data",items:{dimensions:{}}};return{type:"items",component:"accordion",items:{data:i,sorting:g,addons:h,settings:f}}}),define("extensions.qliktech/barchart/barchart-data",["core.utils/deferred","general.utils/array-util","general.utils/property-resolver","objects.utils/data-properties/library-utils","general.models/library/dimension"],function(a,b,c,d,e){function f(b){function c(a){a>10?1!==b.getSorting()[0]&&b.changeSorting(1,0):0!==b.getSorting()[0]&&b.changeSorting(1,0)}var f,g=b.getDimensions(),h=b.getMeasures();if(1===g.length&&1===h.length){var i=g[0];return i.qLibraryId?e.getLayout(i.qLibraryId).then(function(a){if(a&&a.qDimInfos&&a.qDimInfos[0]){var b=a.qDimInfos[0].qCardinal;c(b)}return i}):d.findField(i.qDef.qFieldDefs[0]).then(function(a){if(a){var b=a.qCardinal;c(b)}return i})}return g.length>1&&1===h.length&&(f=b.getSorting().indexOf(0),0!==f&&b.changeSorting(f,0)),a.resolve()}function g(a,b){var d=b.getDimensions(),e=b.getMeasures(),f=c.getValue(a,"color.mode");d.length>1&&a.color&&(a.color.persistent=!0),"byMeasure"===f&&e.length>1?c.setValue(a,"color.mode","byDimension"):"byExpression"===f&&0===e.length&&c.setValue(a,"color.mode","primary")}function h(a){return a>=2?1:15}var i={measures:{min:1,max:h,add:function(a,b,c){return f(c).then(function(){return a.qSortBy.qSortByNumeric=-1,g(b,c),a})},remove:function(a,c,d){var e=d.getDimensions(),f=d.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;1===e.length&&f&&f.length&&(e.push(f.splice(0,1)[0]),b.indexAdded(d.hcProperties.qInterColumnSortOrder,e.length-1)),g(c,d),e.length>1&&"stacked"===c.barGrouping.grouping?(c.qHyperCubeDef.qMode="K",c.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===e.length&&(c.qHyperCubeDef.qMode="S")}},dimensions:{min:1,max:function(a){return a>=2?1:2},add:function(a,b,c){return c.getDimensions().length>1&&"stacked"===b.barGrouping.grouping&&(b.qHyperCubeDef.qMode="K",b.qHyperCubeDef.qAlwaysFullyExpanded=!0),f(c).then(function(){return g(b,c),a})},remove:function(a,b,c){var d=c.getDimensions(),e=c.getMeasures(),f=h(d.length),i=c.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;1===e.length&&i&&i.length&&i.splice(0,f-1).forEach(function(a){e.push(a),c.hcProperties.qInterColumnSortOrder.push(d.length+e.length-1)}),g(b,c),1===d.length&&(b.qHyperCubeDef.qMode="S")}}};return i}),define("objects.views/charts/layout-engine",["objects.utils/shapes/rect"],function(a){function b(){this._layoutComponents=[],this._componentSizes=[]}function c(a){var b=this._componentSizes.filter(function(b){return b.component===a})[0];b||(b={component:a},this._componentSizes.push(b)),b.rect=a.rect.clone()}function d(a){return this._componentSizes.filter(function(b){return b.component===a})[0]}function e(a,b,c,d,e){var f,g=this._layoutComponents.slice(),h=[{fn:"_reduceComponentRectBySpacingV",dock:["left","right"]},{fn:"_reduceComponentRectBySpacingH",dock:["top","bottom"]}];for("vertical"===d&&h.reverse(),g.sort(function(a,b){return(a.reductionOrder||1e3)-(b.reductionOrder||1e3)}),f=0;f<g.length;f++)g[f].perpendicularlyRelevantSpacing={top:0,left:0,right:0,bottom:0},g[f].preRelevantSizeCalculation&&g[f].preRelevantSizeCalculation();var i=a.clone();h.forEach(function(a){this._reducePreliminaryLayoutRectForComponents(g,i,b,c,function(b){return b&&a.dock.indexOf(b.dock)>=0}),this[a.fn](i,b,g,c)},this),e&&e()&&(i=a.clone(),h.forEach(function(a){this._reducePreliminaryLayoutRectForComponents(g,i,b,c,function(b){return b&&a.dock.indexOf(b.dock)>=0}),this[a.fn](i,b,g,c)},this)),h.forEach(function(d){this._reduceLayoutRectForComponents(g,a,b,i,c,function(a){return a&&d.dock.indexOf(a.dock)>=0}),this[d.fn](a,b,g,c)},this)}return b.prototype={addComponent:function(a){var b;b=this._layoutComponents,this.removeComponent(a),b.push(a)},removeComponent:function(a){var b,c;for(c=this._layoutComponents,b=0;b<c.length;++b)if(c[b]===a)return void c.splice(b,1)},_reduceLayoutRectForComponents:function(a,b,c,d,e,f){var g;for(g=0;g<a.length;++g)a[g]&&["left","right","bottom","top"].contains(a[g].dock)&&f(a[g])&&(a[g].calculateRelevantSize(b,c,d),a[g].isVisible(e)&&a[g].reduceLayoutRect(b))},_reducePreliminaryLayoutRectForComponents:function(a,b,c,d,e){var f;for(f=0;f<a.length;++f)a[f]&&["left","right","bottom","top"].contains(a[f].dock)&&e(a[f])&&(a[f].calculatePreliminaryRelevantSize?a[f].calculatePreliminaryRelevantSize(b,c):a[f].calculateRelevantSize(b,c),a[f].isVisible(d)&&a[f].reduceLayoutRect(b))},_reduceComponentRectBySpacingH:function(a,b,c,d){var e,f;for(e=0;e<c.length;++e)f=c[e].perpendicularlyRelevantSpacing,f&&c[e].isVisible(d)&&(f.left>a.x&&a.x>=0&&(a.width-=f.left-a.x,a.x=f.left),f.right>b.width-a.x-a.width&&(a.width-=f.right-(b.width-a.x-a.width-b.x)))},_reduceComponentRectBySpacingV:function(a,b,c,d){var e,f;for(e=0;e<c.length;++e)f=c[e].perpendicularlyRelevantSpacing,f&&c[e].isVisible(d)&&(f.top>a.y&&a.y>=0&&(a.height-=f.top-a.y,a.y=f.top),f.bottom>b.height-a.y-a.height&&(a.height-=f.bottom-(b.height-a.y-a.height-b.y)))},_layoutComponent:function(a,b,c,d){a&&a.insertAdjacentTo(a.dock&&"center"!==a.dock?a.isVertical()?c.x:c.y:d,a.isVisible(b))},layout:function(b,f,g,h,i){var j=2;b=new a(b.x,b.y,b.width,b.height),g=new a(g.x,g.y,g.width,g.height);var k,l,m,n,o,p=g.width/b.width,q=g.height/b.height;for(l=this._layoutComponents,l.sort(function(a,b){return"center"===a.dock?"center"===b.dock?0:-1:"center"===b.dock?1:a.layoutOrder-b.layoutOrder}),b=new a(b.x,b.y,b.width-2*j,b.height-2*j),m=new a(b.x,b.y,b.width,b.height),n={x:new a,y:new a},e.apply(this,[m,b,f,h,i]),m.x+=j,m.y+=j,n.x.set(m.x,m.y,m.width,m.height),n.y.set(m.x,m.y,m.width,m.height),k=0;k<l.length;++k)l[k].setLayoutToContainerRatios(p,q),this._layoutComponent(l[k],f,n,m),o=d.call(this,l[k]),l[k].updateSize(!o||o.rect.width!==l[k].rect.width||o.rect.height!==l[k].rect.height),c.call(this,l[k])}},b}),define("objects.views/charts/components/data-area",["./chart-component"],function(a){var b;return b=a.extend({paint:function(a){this._super(a)}})}),define("objects.views/charts/components/axis/radial-axis-helper",["objects.views/charts/utils/matrix","objects.utils/shapes/rect"],function(a){function b(b,e,j){var k,l,m,n,o,p,q,r,s=b.length>0?b[0].positions:[],t=e._style,u=e._radialOptions,v=new a,w=t.tick.length*j,x=t.label.offset*j*20,y=1,z="far"===e.getAlignment()?"left":"right",A=[],B=Math.min(e.rect.height,e.rect.width),C=0,D=[],E=e._radius;if(m="left"===z?1:-1,w=m*w,k=m>0?0:e.rect.width,l=0,k+=m*y/2,l+=e._padding.top,e.getShowLine()&&A.push({stroke:t.line.color,shape:{cx:e._centerPoint.x,cy:e._centerPoint.y,radius:E,radianOffset:0,start:u.start,end:u.end},type:"arc"}),e.getShowLabels())for(r=0;r<s.length;r++)n=(s[r]-C)/(B-C),p=g(n,e),q=h(p),q.r=q.r+x,q=i(q,e._centerPoint),o=f(n,e),q.angle=o,D.push(q),v.save(),v.translate(p.x+e._centerPoint.x,p.y+e._centerPoint.y),v.rotate(o),A.push({stroke:t.tick.color,opacity:e.ticks[r].opacity,transform:v.elements,shape:{x1:0,x2:-w,y1:0,y2:0},type:"line"}),v.restore();if(k+=t.tick.length*m,e._showLabels&&e._layoutMode>1)for(r=0;r<b.length;r++)A=A.concat(c(b[r],D,k,e)),k+=b[r].labelSpace*m;e._showTitle&&e._layoutMode>1&&(A=A.concat(d(e,t))),e._renderer.shapes=A,e._renderer.render()}function c(a,b,c,d){var e,f,g,h,i,j,k=a.labels,l=b,m=a.opacities,n=[],o=d._style;if(k){for(i=0;i<k.length;i++)e=d._renderer.getTextWidth(k[i],o.label.font),h=l[i],g=h.angle,f=g-.1<3*Math.PI/2&&g+.1>3*Math.PI/2?"center":g<Math.PI/2||g>3*Math.PI/2?"left":"right",n.push({type:"text",fill:o.label.color,opacity:m?m[i]:1,shape:{text:k[i],x:h.x,y:h.y,maxWidth:h.x-e<0?h.x:h.x+e>d.rect.width?d.rect.width-h.x:e,height:j,maxNumLines:1,font:o.label.font,align:f,baseline:"middle"}});return n}}function d(a,b){var c=[],d=Math.min(a.rect.width,a.rect.height),f=e(a);return c.push({type:"text",fill:b.label.color,opacity:1,shape:{text:a._title,x:f.x,y:f.y+d*(.06+.04*(Math.min(d-300,0)/-300)),maxWidth:1.4*a._radius,maxNumLines:1,font:b.label.font,align:"center",baseline:"middle"}}),c}function e(a){var b={x:a.rect.width/2,y:a.rect.height/2};return b}function f(a,b){var c=b._radialOptions,d=Math.max(Math.min(a,1),0)*(c.end-c.start)+c.start;return d}function g(a,b,c){var d=b._radialOptions,e=a*(d.end-d.start)+d.start,f=b._radius;return i({a:e,r:f},c)}function h(a){return{r:Math.sqrt(a.x*a.x+a.y*a.y),a:Math.atan2(a.y,a.x)}}function i(a,b){return b||(b={x:0,y:0}),{x:b.x+a.r*Math.cos(a.a),y:b.y+a.r*Math.sin(a.a)}}return{renderRadial:b,getPointOfValue:g,getPolPos:h,getCartPos:i,getAngleOfNormalizedValue:f}}),define("objects.views/charts/components/axis/axis",["jquery","../chart-component","objects.views/charts/components/axis/radial-axis-helper","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","objects.utils/shapes/rect","objects.utils/shapes/polygon","objects.views/charts/chart-style-service"],function(a,b,c,d,e,f,g,h){"use strict";function i(){var a,b=this;return a=this.getLabels()||[],a.length||this._showTitle_internal?(this._cacheItems&&this._cacheItems.length&&(this._cacheItems[0].objectShapes?this._cacheItems.forEach(function(a){a.objectShapes[b.selectionIdentifier]=null}):this._cacheItems.forEach(function(a){a.clearShapes(b.selectionIdentifier)})),void(this.isRadial()?c.renderRadial(a,this,this._windowSizeMultiplier):this.isVertical()?m.apply(this,[a]):n.apply(this,[a]))):void this._renderer.clear()}function j(a,b,c,d,f){var h,i,j,k,l,m,n,p,q,r,s=a.labels,t=a.positions,u=Math.abs(this._fontHeight*Math.sin(c)),v=a.labelSpace,w=Math.abs(v/Math.sin(c)),x=Math.cos(c),y=(new e).skew(1.57079632679-c,0).scale(this._discreteSpacing*(this._groupSize||1)/this._fontHeight,1).translate(0,-d*this._fontHeight/2).rotate(-1.57079632679),z=[],A=0>c?"right":"left";for(r="middle","near"===this.getAlignment()&&"center"!==A&&(A="left"===A?"right":"left"),q=0;q<s.length;q++)h=t[q],0>h||h>this.rect.width||(n=new e,n.translate(t[q],b+d*u/2),p=n.clone(),n.rotate(c),m="right"===A?Math.min((h+this._edgeBleed.left)/x,w):Math.min((this.rect.width-h+this._edgeBleed.right)/x,w),m-=2*u,z.push({type:"text",fill:this._style.label.color,opacity:a.opacities[q],transform:n.elements,shape:{text:s[q]||"",font:this._style.label.font,maxWidth:m,align:A,baseline:r}}),o(this._cacheItems,this.isDiscrete(),a.indecies,q)&&f&&(i="left"===A?0:-Math.abs(v),j=this._fontHeight/2,k=[{x:i,y:-j},{x:i+v,y:-j},{x:i+v,y:j},{x:i,y:j}],p.multiply(y),l=new g(p.transformPoints(k)),this._cacheItems[a.indecies[q]].addShape(this.selectionIdentifier,l)));return z}function k(a,b,c,e){var g,h,i,j,k,l="near"===this.getAlignment()?"bottom":"top",m="center",n=a.labels,p=a.positions,q=a.opacities,s=a.labelMode,t=this._style,u=a.widths,v=[];for(g=0;g<n.length;g++)h=p[g],-.5>h||h>this.rect.width+.5||(this.isDiscrete()||0!==g&&g!==n.length-1?!this.isDiscrete()||s!==r||0!==g&&g!==n.length-1?m="center":(i=d.measureTextObject({type:"text",shape:{text:n[g]||"",x:h,y:b,maxWidth:u[g]-4,font:this._style.label.font,align:m,baseline:l}}).width,0===g&&i/2>h?h+=i/2-h:g===n.length-1&&i/2>this._plotSize-h&&(h-=i/2-(this._plotSize-h))):(i=d.measureTextObject({type:"text",shape:{text:n[g]||"",x:h,y:b+(s===r?0:1.5*this._fontHeight*(g%2)*c),maxWidth:u[g]-4,font:this._style.label.font,align:m,baseline:l}}).width,0===g&&i/2>h?h+=i/2-h:g===n.length-1&&i/2>this._plotSize-h+this._padding.left&&(h-=i/2-(this._plotSize-h+this._padding.left))),k=b+(s===r?0:1.5*this._fontHeight*(g%2)*c),o(this._cacheItems,this.isDiscrete(),a.indecies,g)&&e&&(j=new f(h-(u[g]-4)/2,k-("bottom"===l?this._fontHeight*t.label.lineHeight:0),u[g]-4,this._fontHeight*t.label.lineHeight),this._cacheItems[a.indecies[g]].addShape(this.selectionIdentifier,j)),v.push({type:"text",fill:this._style.label.color,opacity:q?q[g]:1,shape:{text:n[g]||"",x:h,y:k,maxWidth:u[g]-4,font:this._style.label.font,align:m,baseline:l}}));return v}function l(a,b,c,d){var e,g,h,i,j,k=a.labels,l=a.positions,m=a.opacities,n=a.labelSpace,p=[],q=this._style;for(e=this._renderer.getFontHeight(q.label.font),i=l.length>1?Math.abs(l[0]-l[1]):this.rect.height,this.isDiscrete()||(i=0),h=0;h<k.length;h++)g=l[h],g=Math.max(e/2,Math.min(this._padding.top+this._plotSize-e/2,g)),0>g-.5||g+.5>this.rect.height||(o(this._cacheItems,this.isDiscrete(),a.indecies,h)&&d&&(j=new f(b-("right"===c?n:0),g-i/2,n,i),this._cacheItems[a.indecies[h]].addShape(this.selectionIdentifier,j)),p.push({type:"text",fill:q.label.color,opacity:m?m[h]:1,shape:{text:k[h],x:b,y:g-i/2,maxWidth:n,height:i,maxNumLines:1,font:q.label.font,align:c,baseline:"middle"}}));return p}function m(a){var b,c,d,f,g=a[0]?a[0].positions:[],h=a[0]?a[0].opacities:[],i=this._style,j=this.isDiscrete()?0:i.tick.length,k=1,m=new e,n="far"===this.getAlignment()?"left":"right",o=[];if(d="left"===n?1:-1,j=d*j,b=d>0?0:this.rect.width,c=0,b+=d*k/2,c+=this._padding.top,!this.isDiscrete()&&this._showLabels_internal){if(this._showLabels_internal)for(f=0;f<g.length;f++)o.push({stroke:i.tick.color,opacity:h[f],shape:{x1:b,x2:b+j,y1:g[f],y2:g[f]},type:"line"});this._showLine_internal&&o.push({stroke:i.line.color,shape:{x1:b,x2:b,y1:c-1,y2:c+this._plotSize},type:"line"}),b+=i.tick.length*d}if(this._showLabels_internal){for(b+=i.label.margin*d,a.reverse(),f=0;f<a.length;f++)a[f].labelMode!==q&&(o=o.concat(l.apply(this,[a[f],b,n,0===f])),b+=a[f].labelSpace*d);a.reverse()}this._showTitle_internal&&(m=new e,m.translate((d>0?b:0)+(d>0?this.rect.width-b:b)/2,this._padding.top+this._plotSize/2),m.rotate(.5*Math.PI*("right"===n?-1:1)),o.push({type:"text",fill:i.title.color,transform:m.elements,shape:{text:this._title||"",maxWidth:this._plotSize,font:i.title.font,align:"center",baseline:"middle"}})),this._renderer.shapes=o,this._renderer.render()}function n(a){var b,c,d,e=a[0]?a[0].positions:[],f=a[0]?a[0].opacities:[],g=this._style.tick.length,h=1,i="far"===this.getAlignment()?1:-1,l=[];if(g*=i,b=this._padding.left||0,c="near"===this.getAlignment()?this.rect.height-1:0,c+=h/2*i,!this.isDiscrete()&&this._showLabels_internal){for(this._showLine_internal&&l.push({stroke:this._style.line.color,shape:{x1:b-1,x2:b+this._plotSize,y1:c,y2:c},type:"line"}),c+=h*i/2,d=0;d<e.length;d++)l.push({stroke:this._style.tick.color,opacity:f[d],shape:{x1:e[d],x2:e[d],y1:c,y2:c+g},type:"line"});c+=g}if(this._showLabels_internal)for(c+=this._style.label.margin*i,d=0;d<a.length;d++)a[d].labelMode!==q&&(l=a[d].labelMode===s?l.concat(j.apply(this,[a[d],c,a[d].radians,i,d===a.length-1])):l.concat(k.apply(this,[a[d],c,i,d===a.length-1])),a[d].labelSpace&&(c+=a[d].labelSpace*i));this._showTitle_internal&&l.push({type:"text",fill:this._style.title.color,shape:{x:b,y:i>0?c:0,width:this._plotSize,height:i>0?this.rect.height-c:c,text:this._title||"",font:this._style.title.font,align:"center",baseline:"middle"}}),this._renderer.shapes=l,this._renderer.render()}function o(a,b,c,d){return b&&a&&c&&a[c[d]]}var p,q=0,r=1,s=3;return p=b.extend("Axis",{init:function(b,c,e){this._super.apply(this,[b,a.extend(!0,{},{components:{title:{show:!0,showFlag:c.showFlag},labels:{show:!1,showFlag:c.showFlag}}},c),e]),this._fontHeight=20,this._titleShowFlag=c.titleShowFlag||null,this._showLabels=!0,this._showLabels_internal=!0,this._showLine=!0,this._showLine_internal=!0,this._showTitle=!1,this._dataIndex=0,this._radial=!1,this._relevantAngle=0,this._cacheItems=null,this._styleService=h.getInstance(),this._style=this._getStyleObject(this._styleService),this._padding={top:0,bottom:0,left:0,right:0},this._renderer=new d(this.container),this._$renderAreaWrap&&this._$renderAreaWrap.addClass("qv-chart-component-axis"),this.innerRect=new f(0,0,0,0),this.renderers={axis:this._renderer}},getLabels:function(){return[]},setSelectableShapes:function(a){this._cacheItems=a},calculateValuePositionMappingInfo:function(){},_calculatePlotSize:function(a){var b,c,d=0;this.isRadial()?(b=Math.min(a.height,a.width),c=.4*b,this._relevantAngle=this._radialOptions.end-this._radialOptions.start,d=Math.tan(-this._relevantAngle/4+Math.PI/2)*b*.02,this._radius=c+d,this._centerPoint={x:a.width/2,y:a.height/2+4*d}):b=this.isVertical()?a.height-this._padding.top-this._padding.bottom:a.width-this._padding.left-this._padding.right,0===this._plotSize&&0!==b?this._plotSize=b:this._plotSize=b},_calculateEdgeBleedAndPlotSize:function(a){this._edgeBleed={top:this.isVertical()?1:0,bottom:this.isVertical()?1:0,left:this.isVertical()?1:Math.max(a.x,1),right:this.isVertical()?0:Math.max(0,this.outerRect.width-a.width-a.x)},this._calculatePlotSize(a)},preRelevantSizeCalculation:function(){this._isSizing=!0,this.updateNow(["properties"]),this._isVertical=this.isVertical(),this._style=this._getStyleObject(this._styleService,this._layoutMode,this.isDiscrete()),this._fontHeight=Math.ceil(this._renderer.getFontHeight(this._style.label.font));var a=this._isVertical;this._showTitle_internal=b.prototype.isVisible.call({show:this._showTitle&&!!this._title,_verticalLayoutMode:this._verticalLayoutMode,_horizontalLayoutMode:this._horizontalLayoutMode,isVertical:function(){return a},showFlag:null!==this._titleShowFlag?this._titleShowFlag:this.showFlag<<1},this._layoutMode),this._showTitle_internal&&(this._titleFontHeight=this._renderer.getFontHeight(this._style.title.font),this.relevantSize+=this._titleFontHeight*this._style.title.lineHeight)},calculatePreliminaryRelevantSize:function(a,b){var c,d=0,e=0,f=a[this.isVertical()?"height":"width"];this._isSizing=!0,this.relevantSize=0,this.preliminaryRelevantSize=0,this._preliminaryStatics=0,0>=f||(c=this.calculatePreliminaryLabelSpace(a,b),d=c.relevantLabelSize||0,e=c.relevantSpacing||0,this.isDiscrete()||(this._preliminaryStatics+=this._style.tick.length),d&&(this.preliminaryRelevantSize+=d,this.preliminaryRelevantSize+=this._style.label.margin),this._showTitle_internal&&(this._preliminaryStatics+=this._titleFontHeight*this._style.title.lineHeight),this.preliminaryRelevantSize+=this._preliminaryStatics,this.preliminaryRelevantSize=Math.ceil(this.preliminaryRelevantSize),this.perpendicularlyRelevantSpacing={top:0,left:"far"===this.getAlignment()?e:0,right:"near"===this.getAlignment()?e:0,bottom:0},this.relevantSize=this.preliminaryRelevantSize)},calculateRelevantSize:function(a,b,c){this._isSizing=!0,this._isVertical=this.isVertical(),this.relevantSize=0;var d=c?c:a,e=0,f=0;if(this.rect.set(d.x,d.y,d.width,d.height),this._calculationSize=d[this.isVertical()?"height":"width"],this.isVertical()?this._calculationSize-=this._padding.top+this._padding.bottom:this._calculationSize-=this._padding.left+this._padding.right,this._plotSize=this._calculationSize,0!==d.width){var g=this.calculateLabelSpace(a,b,c);return e=g.relevantLabelSize||0,f=g.relevantSpacing||0,e&&(this.relevantSize+=e,this.relevantSize+=this._style.label.margin),this.relevantSize+=this._preliminaryStatics,this.relevantSize=Math.ceil(this.relevantSize),this.perpendicularlyRelevantSpacing={top:0,left:"far"===this.getAlignment()?f:0,right:"near"===this.getAlignment()?f:0,bottom:0},this._isSizing=!1,this}},insertAdjacentTo:function(a,b){if(this._super(a,b),!this.isDiscrete())switch(this.dock){case"top":this.rect.y+=1;break;case"bottom":this.rect.y-=1}},_getStyleObject:function(a,b,c){var d="",e=a.layoutMap[b]||"medium",f=c?".discrete":"";return{backgroundColor:a.getValue(d,null,"backgroundColor"),label:{lineHeight:1.4,color:a.getValue(d,"axis.label","color"),margin:a.getValue(d,"axis.label","margin"),offset:1,font:a.getFont(d,"axis.label"+f,e)},tick:{color:a.getValue(d,"axis.tick","color"),length:a.getValue(d,"axis.tick","length")},line:{color:a.getValue(d,"axis.line","color")},title:{lineHeight:1.4,font:a.getFont(d,"axis.title",e),color:a.getValue(d,"axis.title","color")}}},isVisible:function(){return this._super.apply(this,[].slice.call(arguments))&&this._showSubcomponents},setShowLabels:function(a){this._showLabels_internal=a,this._showLabels=a},getShowLabels:function(){return this._showLabels},getSpacingMode:function(){return void 0},setShowLine:function(a){this._showLine_internal=a,this._showLine=a},getShowLine:function(){return this._showLine},setShowStrategy:function(a){this._showSubcomponents="none"!==a,this._showTitle=["all","title"].contains(a),this._showTitle_internal=this._showTitle,this.components.title.show=this._showSubcomponents&&["all","title"].contains(a),this._showLabels=["all","labels"].contains(a),this._showLabels_internal=this._showLabels,this.components.labels.show=this._showSubcomponents&&["all","labels"].contains(a)},getShowStrategy:function(){return this._showSubcomponents},setTitle:function(a){this._title=a},setLabelMode:function(a){this._explicitLabelMode=a},setCurrentDataIndices:function(a){this._currentDataIndices=Array.isArray(a)?a:[a]},setDataIndices:function(a){this._dataIndices=Array.isArray(a)?a:[a]},setDataRange:function(){},setOffset:function(){},setInnerOffset:function(){},getInnerOffset:function(){},getNumDiscreteUnits:function(){},setNumDiscreteUnits:function(){},getNumDiscreteUnitsInView:function(){},setMaxDiscreteUnitSize:function(){},setMinDiscreteUnitSize:function(){},setUnitAlignment:function(){},_updateProperties:function(){var a=this.getType().indices;return this._formatter=1===a.length&&this.measureFormatters.length?this.measureFormatters[a[0]]:this.combinedMeasuresFormatter||this._defaultFormatter,this.container.setAttribute("data-type",this.isDiscrete()?"discrete":"continuous"),this},updateSize:function(){this._super(),this._calculateEdgeBleedAndPlotSize(this.rect),this._renderer.edgeBleed=this._edgeBleed,this.innerRect=new f(this.rect.x+this._padding.left,this.rect.y+this._padding.top,this.rect.width-this._padding.left-this._padding.right,this.rect.height-this._padding.top-this._padding.bottom),this._isVertical=this.isVertical()},paint:function(){return i.apply(this,[]),this.fire("rendered"),this},isDiscrete:function(){return!1},getPositionOfValue:function(){},getAngleOfValue:function(){},getValueOfPosition:function(){},getType:function(){return{type:this.isDiscrete()?"dimension":"measure",indices:this._dataIndices||[0],current:this._currentDataIndices||[0]}},setPadding:function(a,b,c,d){this._padding={top:a>0?a:0,right:b>0?b:0,bottom:c>0?c:0,left:d>0?d:0}},getPadding:function(){return this._padding},isVertical:function(){var a=this.options.dock;switch(a){case"left":case"right":return!0;case"center":return"vertical"===this._orientation;default:return!1}},setOrientation:function(a){this._orientation=a},setAlignment:function(a){this._align=a},getAlignment:function(){var a=this.options.dock;switch(a){case"left":case"top":return"near";case"center":return this._align;default:return"far"}},setRadial:function(a,b){this._radial=a,this._radialOptions=b},isRadial:function(){return this._radial}})}),define("objects.views/charts/components/axis/discrete-axis",["./axis","objects.utils/shapes/rect"],function(a,b){"use strict";function c(a){var b=this._cacheItems;return b&&a&&a.some(function(a){return b[a]&&b[a].selected})?1:this._globalAlpha}function d(a,b,d,e){var f,g,h=this.isHorizontal(),i=[],j=[],k=[],l=[],m=[];for(f=0;f<a.length;f+=1)g={center:this.getPositionOfValue(f,b),width:this.getWidthOfValue(f,b)},g.width>=2*this._discreteSpacing&&(g.center-this._discreteSpacing+g.width/2<0||g.center+this._discreteSpacing-g.width/2>e)||g.width<2*this._discreteSpacing&&(g.center<0||g.center>e)||(h&&g.center+g.width/2>e?i.push(Math.min(e,e-(g.center-g.width/2))):h&&g.center-g.width/2<0?i.push(Math.min(e,g.width/2+g.center)):i.push(Math.min(e,g.width)),g.width>this._discreteSpacing?j.push(Math.max(1,Math.min(g.center,e-1))):j.push(g.center),k.push(a[f].label),l.push(a[f].cacheIndex?a[f].cacheIndex[0]:0),m.push(d?c.apply(this,[a[f].cacheIndex]):1));return{labels:k,
widths:i,positions:j,indecies:l,opacities:m}}function e(a){var b=a.match(/[\u4E00-\u9FFF]/g);return b=b?b.length:0,{latin:a.length-b,cjk:b}}function f(a,b,c,d,g,h){if(!a||!a.length)return[];var i,j,k,l,m,n,o=[];for(i=0;i<a.length;i++)j=a[i],k={},l="",m=null,"object"==typeof j?(l=j.label,m=j.children?f(j.children,b,c+1,k,g,h):null,k.cacheIndex="cacheIndex"in a[i]?a[i].cacheIndex:[],k.group=j.group===!0,j.id&&(h[j.id]=k)):l=j,k.label=l||"",k.parent=d,n=e(k.label),m&&m.length&&(k.children=m),o.push(k),b[c]||(b[c]={data:[]},b[c].show=!(g&&g[c]&&g[c].show===!1||b[c].silo),b[c].qApprMaxGlyphCount=g&&g[c]&&g[c].qApprMaxGlyphCount||10,b[c].characterRatios={latin:0,cjk:0}),b[c].data.push(k),b[c].characterRatios.latin+=n.latin,b[c].characterRatios.cjk+=n.cjk;return o}function g(a){for(var b=a.parent,c=[];b;)b.collapseChildren||c.push(b),b=b.parent;return c}function h(a,b){var c,d,e,f,h,i,j,k,l=a[a.length-1].data;for(l[0].distanceFrom=b/2,l[0].distanceTo=l[0].distanceFrom+1,c=g(l[0]),j=c.filter(function(a){return a.group})[0],f=1;f<l.length;f++){if(i=l[f-1].distanceTo,d=g(l[f]),k=d.filter(function(a){return a.group})[0],k!==j){for(h=0;h<d.length&&(d[h]!==c[h]||!(d[h]<0||d[h].group));h++);i+=b*h,j=k,c=d}l[f].distanceFrom=i,l[f].distanceTo=l[f].distanceFrom+1}if(a.length>1)for(f=a.length-2;f>=0;f--)for(e=a[f].data,h=0;h<e.length;h++)e[h].distanceFrom=e[h].children[0].distanceFrom,e[h].distanceTo=e[h].children[e[h].children.length-1].distanceTo}function i(a,b,c,d){var e=b.getTextWidth("客",c),f=24>=a?b.getTextWidth("m",c):b.getAverageLetterWidth(c);return d?a*(e*d.cjk+f*d.latin):a*f}var j,k=0,l=1,m=3;return j=a.extend("DiscreteAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._unitsOffset=0,this._innerOffset=0,this._shrinkToFitThreshold=arguments[1]&&null!==arguments[1].shrinkToFitThreshold?arguments[1].shrinkToFitThreshold:.85,this._maxDiscreteUnitSize=null,this._minDiscreteUnitSize=null,this._alignmentOffset=0,this._unitAlignment="center"},updateSize:function(){this._super(),1===this._numDiscrete?this._discreteSpacing=Math.min(this._discreteSpacing,this._plotSize/this._numDiscrete):this._discreteSpacing-=(this._preliminarySize-this._plotSize)/(this._numUnitsInView||1),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,this._plotSize),this.extendedRect=new b(this.rect.x-this._edgeBleed.left,this.rect.y-this._edgeBleed.top,this.rect.width+this._edgeBleed.left+this._edgeBleed.right,this.rect.height+this._edgeBleed.top+this._edgeBleed.bottom)},updateLevels:function(){var a=this._oldLevels;this._levels.forEach(function(b,c){b.labelSpace=a[c].labelSpace,b.labelMode=a[c].labelMode,b.radians=a[c].radians})},_getPerpendicularExtensionForTiltedLabels:function(a,b,c,d){var e,f=-40*Math.PI/180,g=Math.abs(Math.sin(f))*a.longestLabelWidth,h=0;return g=Math.min(d,g),e=Math.abs(Math.cos(f))*g,e=Math.max(e-this._discreteSpacing/2,0),"bottom"===this.dock?(e=Math.max(e-this._alignmentOffset,0),e>b.x&&(h=e-b.x)):"top"===this.dock&&(e=Math.max(e-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0),e>c.width-b.x-b.width&&(h=e-(c.width-c.x-b.x-b.width))),h},_getLabelMode:function(a,b,c){var d,e=a.qApprMaxGlyphCount;return this._showLabels&&"none"!==this._explicitLabelMode?this._explicitLabelMode&&"auto"!==this._explicitLabelMode?"none"===this._explicitLabelMode?k:"tilted"===this._explicitLabelMode?m:l:b&&this.isHorizontal()&&a.data&&a.data.length&&(d=i(e,this._renderer,this._style.label.font,a.characterRatios),this._groupSize&&(c*=this._groupSize),d>c)?m:l:k},preRelevantSizeCalculation:function(){this._super();var a,b=this._levels?this._levels.filter(function(a){return a.show!==!1}):[],c=b.length,d=this.outerRect[this.isVertical()?"width":"height"]/4,e=0,f=0;if(this.isVisible()){for(a=0;c>a;a++)b[a].longestLabelWidth=i(b[a].qApprMaxGlyphCount,this._renderer,this._style.label.font,b[a].characterRatios),e+=b[a].longestLabelWidth;for(a=0;c>a;a++)b[a].labelSizeRatio=Math.min(1/c,b[a].longestLabelWidth/Math.min(e,d)),f+=b[a].labelSizeRatio;1>f&&c>1?b[0].labelSizeRatio===1/c?b[0].labelSizeRatio+=1-f:b[1].labelSizeRatio===1/c&&(b[1].labelSizeRatio+=1-f):1===c&&(b[0].labelSizeRatio=1)}},calculatePreliminaryLabelSpace:function(a,b){var c,d=this._hideMyLabels,e=this._levels?this._levels.filter(function(a){return a.show!==!1&&!d}):[],f=e.length,g=this.outerRect[this._isVertical?"width":"height"]/4,h=this._fontHeight*this._style.label.lineHeight,i=0,j=0;if(this._preliminarySize=a[this._isVertical?"height":"width"],this._calculateDiscreteUnits(this._preliminarySize),this.isVisible())for(c=0;f>c;c++){e[c].labelMode=this._getLabelMode(e[c],c===e.length-1,this._discreteSpacing);var n=0;switch(e[c].labelMode){case l:e[c].labelSpace=this.isHorizontal()?h:e[c].longestLabelWidth,e[c].labelSpace=Math.min(e[c].labelSizeRatio*g,e[c].labelSpace);break;case m:e[c].radians=-40*Math.PI/180,n=this._getPerpendicularExtensionForTiltedLabels(e[c],a,b,g*e[c].labelSizeRatio),n>a.width/5&&(e[c].radians=-90*Math.PI/180),e[c].labelSpace=Math.abs(Math.sin(e[c].radians))*e[c].longestLabelWidth+Math.abs(this._fontHeight*Math.sin(e[c].radians)*2),e[c].labelSpace=Math.min(e[c].labelSizeRatio*g+Math.abs(this._fontHeight*Math.sin(e[c].radians)/2),e[c].labelSpace);break;default:e[c].labelSpace=0}e[c].labelMode===m&&(i=Math.max(i,Math.min(a.width/3,Math.ceil(Math.cos(e[c].radians)*e[c].labelSpace))),i=Math.max(i-this._discreteSpacing/2,0),"bottom"===this.dock?i=Math.max(i-this._alignmentOffset,0):"top"===this.dock&&(i=Math.max(i-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0)),i=Math.ceil(i)),j+=e[c].labelSpace}return i>0&&("bottom"===this.dock&&i>a.x?this._preliminarySize=this._preliminarySize-(i-a.x):"top"===this.dock&&i>b.width-a.x-a.width&&(this._preliminarySize=this._preliminarySize-(i-(b.width-b.x-a.x-a.width))),this._calculateDiscreteUnits(this._preliminarySize)),this.fire("numDiscreteUnitsChanged"),this.fire("numDiscreteUnitsInViewChanged"),this._showLabels_internal=this._showLabels&&e&&e.some(function(a){return a.labelMode!==k}),this._preliminaryRelevantSize={relevantLabelSize:j,relevantSpacing:i},this._preliminaryRelevantSize},calculateLabelSpace:function(){return this.updateNow(["properties"]),this._preliminaryRelevantSize},setDataRange:function(a,b){var c,d,e,g;if(this._levels&&this._levels.length&&(this._oldLevels=this._levels.map(function(a){return{labelMode:a.labelMode,labelSpace:a.labelSpace,radians:a.radians}})),this._levels=[],this._labelIds={},f(a,this._levels,0,-1,b,this._labelIds),e=this._levels.length>1?1:0,this._levels&&this._levels.length){h(this._levels,e);for(var i=0;i<this._levels.length;i++)this._levels[i].characterRatios&&(g=this._levels[i].characterRatios.latin+this._levels[i].characterRatios.cjk||1,this._levels[i].characterRatios.latin=this._levels[i].characterRatios.latin/g,this._levels[i].characterRatios.cjk=this._levels[i].characterRatios.cjk/g);c=this._levels[this._levels.length-1].data,d=c[c.length-1].distanceTo+e/2,this._numDiscrete=c.length,this._numDiscrete=d||0,this._explicitNumDiscrete&&(this._numDiscrete=this._explicitNumDiscrete,this._numDiscrete=this._explicitNumDiscrete)}return this.invalidateProperties(),this.invalidateDisplay("setDataRange"),this},setOffset:function(a){return this._unitsOffset!==a?(this._unitsOffset=a,this.invalidateProperties(),this.invalidateDisplay("setOffset"),this.fire("changed"),this):void 0},getOffset:function(){return this._unitsOffset},setGroupSize:function(a){this._groupSize=a},setInnerOffset:function(a){this._innerOffset=a},getInnerOffset:function(){return this._innerOffset||0},getNumDiscreteUnits:function(){return this._numDiscrete},setNumDiscreteUnits:function(a){this._explicitNumDiscrete=a},getNumDiscreteUnitsInView:function(){return this._numUnitsInView},setMaxDiscreteUnitSize:function(a){this._maxDiscreteUnitSize=a},setMinDiscreteUnitSize:function(a){this._minDiscreteUnitSize=a},setUnitAlignment:function(a){this._unitAlignment=a},isDiscrete:function(){return!0},setLockedInfo:function(a){this._lockedInfo=a},getLabels:function(){var a,b,c=[];if(this._levels&&this._levels.length)for(b=0;b<this._levels.length;b++)this._levels[b].show&&(a=d.call(this,this._levels[b].data,b,b===this._levels.length-1,this._plotSize),a.labelMode=this._levels[b].labelMode,a.labelSpace=this._levels[b].labelSpace,a.radians=this._levels[b].radians,c.push(a));return c},calculateValuePositionMappingInfo:function(){this._calculateDiscreteUnits(this._plotSize)},getDiscreteSpacing:function(){return this._discreteSpacing},getPositionOfValue:function(a,b){var c,d,e=this._levels.length-1;"undefined"!=typeof b&&(e=Math.min(this._levels.length-1,Math.max(0,b))),c=this._levels[e].data,d=c[a];var f=d.distanceFrom+.5*(d.distanceTo-d.distanceFrom)+this._innerOffset-this._unitsOffset;return f*this._discreteSpacing+this._alignmentOffset},getWidthOfValue:function(a,b){var c,d=this._levels.length-1;return"undefined"!=typeof b&&(d=Math.min(this._levels.length-1,Math.max(0,b))),c=this._levels[d].data,(c[a].distanceTo-c[a].distanceFrom)*this._discreteSpacing},getPositionOfId:function(a){var b=this._labelIds[a]||this._labelIds[a.split(";").reverse().slice(-1).reverse().join(";")];if(!b)return 0;var c=b.distanceFrom+.5*(b.distanceTo-b.distanceFrom)+this._innerOffset-this._unitsOffset;return c*this._discreteSpacing+this._alignmentOffset},getWidthOfId:function(a){var b=this._labelIds[a]||this._labelIds[a.split(";").reverse().slice(-1).reverse().join(";")];return b?(b.distanceTo-b.distanceFrom)*this._discreteSpacing:0},getValueOfPosition:function(a){var b,c,d,e,f=this._levels[0].data,g=f.length;for(d=0;g>d;d+=1)if(e=f[d],b=(e.distanceFrom+this._innerOffset-this._unitsOffset)*this._discreteSpacing,c=b+(e.distanceTo-e.distanceFrom)*this._discreteSpacing,a>=b&&c>=a)return e.label;return""},_calculateDiscreteUnits:function(a){this._discreteSpacing=Math.max(null!==this._minDiscreteUnitSize?this._minDiscreteUnitSize:0,a/this._numDiscrete),null!==this._maxDiscreteUnitSize&&(this._discreteSpacing=Math.min(this._maxDiscreteUnitSize,this._discreteSpacing)),(1===this._numDiscrete||this._numDiscrete*this._discreteSpacing>a&&this._numDiscrete*this._discreteSpacing*this._shrinkToFitThreshold<a)&&(this._discreteSpacing=Math.min(this._discreteSpacing,a/this._numDiscrete)),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,a),this._numUnitsInView=Math.min(this._numDiscrete,Number((a/this._discreteSpacing).toFixed(5)))},_getAlignmentOffset:function(a,b){var c=null!==this._maxDiscreteUnitSize&&this._discreteSpacing<b/this._numDiscrete?.5*(b-this._numDiscrete*this._discreteSpacing):0;return"near"===a?0:"far"===a?2*c:c}})}),define("objects.views/charts/components/chart-component-angular",["jquery","qvangular","./chart-component"],function(a,b,c){"use strict";var d;return d=c.extend({init:function(c,d,e,f){this._super(c,d,e);var g=b.getService("$compile");this._innerContainer=a(f).appendTo(a(this.container)),g(this._innerContainer)(a(this.container).scope().$new()),this._innerScope=this._innerContainer.scope()},getInnerContainer:function(){return this._innerContainer},getInnerContainerScope:function(){return this._innerScope},release:function(){this._super(),this._innerContainer.remove(),this._innerContaine=null,this._innerScope.$destroy(),this._innerScope=null}})}),define("text!objects.views/charts/components/legend/color-legend.ng.html",[],function(){return'<div class="color-legend">\r\n    <div qv-discrete-legend\r\n         ng-if="discrete && visible"\r\n         view-items="viewItems"\r\n         options="options">\r\n    </div>\r\n\r\n	<div qv-continous-legend\r\n		 ng-if="!discrete && visible"\r\n		 view-items="viewItems"\r\n		 options="options"></div>\r\n</div>\r\n'}),define("objects.views/charts/components/legend/legend-data",["objects.views/charts/utils/canvas-renderer"],function(a){function b(a){return a.label?a.label:a.min&&a.max?a.min+" - "+(a.isMax?"":"<")+a.max:a.max?"<"+a.max:">"+a.min}function c(a,b){var c,d,e,f,g=a.length,h={};for(c=0;g>c;c++){for(e=a[c],d=0;b>d&&e.parent;)e=e.parent,d++;f=e.id,h[f]?h[f].push(a[c]):h[f]=[a[c]]}return h}function d(d,e,f,l,m,p){var q,r,s,t,u,v,w=[],x=0,y=h,z=Math.min(o,d.length);p=p||0,v=c(e,p),f=f||{font:"13px 'QlikView Sans'"},u=a.getAverageLetterWidth(f.font)*k,l>(u+g)*d.length&&(u=l/d.length-g-n);var A={type:"text",fill:0,opacity:1,shape:{text:null,font:f.font,maxWidth:u,align:"left",baseline:"middle",maxNumLines:2}};for(q=0;z>q;q++){var B=d[q];r=B.color.toHex(),A.shape.text=b(B);var C=a.measureTextObject(A);C.height=Math.ceil(C.height),x=Math.max(x,C.width),y=Math.max(y,C.height),"range"===B.type?w.push({text:C.lines.join(" "),height:Math.max(C.height,h)*m,tipText:B.label,marker:"rect",color:r,isDimensionValue:!0,locked:!1,id:B.id,index:B.index,isMax:B.isMax,type:B.type}):w.push({text:C.lines.join(" "),tipText:B.label,height:Math.max(C.height,h)*m,marker:B.marker||"rect",color:r,isDimensionValue:!0,locked:!1,id:B.id,index:B.index,cacheItems:v[B.id],type:B.type})}return s=y,t=Math.max(x+g,i),{viewItems:w,cellHeight:s,cellWidth:t+n+2*j}}function e(b,c,d){var e,f=[],g=0;for(a.setFont(c.font),e=b.length-1;e>=0;e--){var h=b[e],i={colorFrom:h.grad[0].toHex(),colorTo:h.grad[1].toHex(),maxText:d.formatValue(h.max),minText:d.formatValue(h.min),max:h.id[0],min:h.id[1]};f.push(i),g=Math.max(g,a.getTextWidth(i.maxText.substr(0,m)),a.getTextWidth(i.minText.substr(0,m)))}return{viewItems:f,labelHeight:a.getFontHeight(c.font),maxLabelWidth:g}}function f(b,c){var d=a.getAverageLetterWidth(c.font)*l,e={type:"text",fill:0,opacity:1,shape:{text:b,font:c.font,maxWidth:d,align:"left",baseline:"middle",maxNumLines:2}},f=a.measureTextObject(e);return{text:f.lines.join(" "),fullText:b,height:f.height,width:f.width+n}}var g=26,h=26,i=54,j=4,k=20,l=15,m=10,n=1,o=100;return{prepareDiscreteData:d,prepareContinousData:e,prepareLegendTitle:f,Modes:{DISCRETE:"discrete",CONTINOUS:"continous"},constants:{PADDING:j}}}),define("text!objects.views/charts/components/legend/continous-legend.ng.html",[],function(){return'<div class="qv-continous-color-legend"\r\n	 ng-class="cclOrientationClass"\r\n	 ng-style="options.labelStyle">\r\n	<div class="ccl-title"\r\n		 ng-style="options.titleStyle"\r\n		 ng-class="cclOrientationClass">\r\n		<div class="ccl-title-inner"\r\n			 ng-if="options.legendTitle && options.legendTitle.length"\r\n			 title="{{options.legendTitleTooltip}}">{{options.legendTitle}}</div>\r\n	</div>\r\n    <div class="ccl-gradient"\r\n		 ng-class="cclOrientationClass"\r\n         ng-style="options.vertical ? {height: \'calc(100% - \' + options.titleHeight + \'px)\'} : {}"\r\n		 tid="ccl.gradient">\r\n        <div class="ccl-axis" ng-class="cclOrientationClass">\r\n			<div ng-repeat="axisVal in axisValues track by $index" class="ccl-axis-value" ng-class="{\'first\': $first, \'last\':$last}">{{axisVal}}</div>\r\n            <!--\r\n                <div class="ccl-axis-top-value">{{axisValues[1]}}</div>\r\n                <div class="ccl-axis-bottom-value">{{axisValues[0]}}</div>\r\n                -->\r\n        </div>\r\n		<div class="ccl-gradient-color"\r\n			 ng-class="cclOrientationClass"\r\n			 qva-apply-style="cclGradientStyle">\r\n		</div>\r\n		<div class="ccl-range"\r\n			 ng-show="selectionEnabled && !isLocked"\r\n			 ng-style="cclRangeStyle"\r\n			 ng-class="cclOrientationClass">\r\n			<div ng-show="active" class="ccl-range-inner"\r\n				 ng-class="cclOrientationClass"\r\n				 ng-style="rangeStyle">\r\n				<div class="ccl-axis-cover"\r\n					 ng-style="active && cclCoverStyle"\r\n					 tid="ccl.cover"\r\n					 ng-class="{\'active\' : activeOptions.cover}"></div>\r\n				<div class="ccl-far-edge"\r\n					 tid="ccl.edge.far"\r\n					 ng-class="{\'active\' : activeOptions.far}">\r\n				</div>\r\n				<div class="ccl-near-edge"\r\n					 tid="ccl.edge.near"\r\n					 ng-class="{\'active\' : activeOptions.near}">\r\n				</div>\r\n				<div class="ccl-outer-bubble-wrapper"\r\n					 ng-class="active && cclOrientationClass">\r\n					<div class="far ccl-bubble-wrapper"\r\n						 ng-style="active && cclBubbleFarStyle">\r\n						<div class="ccl-bubble"\r\n							 ng-class="{\'active\' : activeOptions.far}"\r\n							 tid="ccl.bubble.far">\r\n							{{cclFarValueLabel}}\r\n						</div>\r\n					</div>\r\n					<div class="near ccl-bubble-wrapper"\r\n						 ng-style="active && cclBubbleNearStyle">\r\n						<div class="ccl-bubble"\r\n							 ng-class="{\'active\' : activeOptions.near}"\r\n							 tid="ccl.bubble.near">\r\n							{{cclNearValueLabel}}\r\n						</div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("general.directives/apply-style",["qvangular"],function(a){a.directive("qvaApplyStyle",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.qvaApplyStyle,function(a){a&&b.attr("style",b.attr("style")?b.attr("style")+a:a)},!1)}}})}),define("objects.views/charts/components/legend/qv-continous-legend",["touche","qvangular","text!./continous-legend.ng.html","objects.utils/shapes/point","general.directives/apply-style"],function(a,b,c,d){function e(a,b,c){var d,e,f,g=c?o:p;if(e="",f=")",b)for(d=a.length-1;d>0;d--)e+=", "+a[d]+" "+100/(a.length-1)*(a.length-1-d)+"%";else for(d=0;d<a.length;d++)e+=", "+a[d]+" "+100/(a.length-1)*d+"%";return"background:"+a[a.length/2]+"; background:"+g.moz+e+f+"; background:"+g.webkit+e+f+"; background:"+g.opera+e+f+"; background:"+g.ie+e+f+"; background:"+g.w3c+e+f}function f(a,b,c){return b?a[0][c]>a[1][c]?0:1:a[0][c]<a[1][c]?0:1}function g(a){return["left","bottom"].contains(a)}function h(a,b,c){var d=c?b.height():b.width(),e=c?"y":"x";a[0][e]=m(n(a[0][e],0),d),a[1][e]=m(n(a[1][e],0),d)}function i(a,b,c,e){var f=[];return c?(f[b]=new d(a[b].x,a[b].y+e),f[1^b]=a[1^b]):(f[b]=new d(a[b].x+e,a[b].y),f[1^b]=a[1^b]),f}function j(a,b){var c=a.find(".ccl-axis");return b?c.width():c.height()}function k(a,b){return{vertical:a.options.vertical,direction:a.options.vertical?"y":"x",grt:a.options.vertical?b:!b}}var l=".legendRangeSelection",m=Math.min,n=Math.max,o={moz:"-moz-linear-gradient(bottom",webkit:"-webkit-linear-gradient(bottom",opera:" -o-linear-gradient(bottom",ie:"-ms-linear-gradient(bottom",w3c:"linear-gradient(to top"},p={moz:"-moz-linear-gradient(left",webkit:"-webkit-linear-gradient(left",opera:" -o-linear-gradient(left",ie:"-ms-linear-gradient(left",w3c:"linear-gradient(to right"};b.directive("qvContinousLegend",function(){return{template:c,replace:!0,scope:!0,link:function(b,c){function m(a){if(b.positionToValue&&a){var c,d;return b.options.vertical?(c=x.rangeElement.height(),d=1-a.y/c):(c=x.rangeElement.width(),d=a.x/c),b.positionToValue(d)}return a+""}function n(){if(!w){w=!0;var c,e="hey";a(x.gradient[0]).swipe({id:l,options:{preventDefault:!0},start:function(b,d){var e=d.pagePoints[0];c=t(e.x,e.y),a.preventGestures(this.gestureHandler),q()},update:function(a,d){b.active=!0,b.swiping=!0;var e=d.pagePoints[0];b.handlePoints=[c,t(e.x,e.y)],b.$digest()},end:function(){b.swiping=!1,s()}}),a(x.axisCover[0]).tap({id:l,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:l,options:{preventDefault:!0},start:function(){e=b.handlePoints,a.preventGestures(this.gestureHandler),q(),b.activeOptions.cover=!0},update:function(a,c){var f=b.options.vertical?c.swipe.deltaY:0,g=b.options.vertical?0:c.swipe.deltaX;b.handlePoints=[new d(e[0].x+g,e[0].y+f),new d(e[1].x+g,e[1].y+f)],b.$digest()},end:function(){s(),b.activeOptions.cover=!1}}),o(x.farBubble[0],!1),o(x.nearBubble[0],!0),a.utils.touch||(o(x.farEdge[0],!1),o(x.nearEdge[0],!0))}}function o(c,d){var e,g,h,j=k(b,d);a(c).tap({id:l,options:{preventDefault:!0},start:function(){a.preventGestures(this.gestureHandler)}}).swipe({id:l,options:{radiusThreshold:0},start:function(){j=k(b,d),g=f(b.handlePoints,j.grt,j.direction),e=b.handlePoints,a.preventGestures(this.gestureHandler),q(b)},update:function(a,c){b.handlePoints=i(e,g,j.vertical,j.vertical?c.swipe.deltaY:c.swipe.deltaX),b.$digest(),b.activeOptions.near=b.activeOptions.far=!1,h=f(b.handlePoints,j.grt,j.direction)?"far":"near",b.activeOptions[h]=!0},end:function(){s(b.handlePoints),b.activeOptions.near=b.activeOptions.far=!1,b.$digest()}})}function p(){b.active=!1,Object.keys(x).forEach(function(b){a(x[b][0]).off("*",l)}),w=!1}function q(){b.$emit("rangeStart")}function r(a){b.$emit("rangeUpdate",a,b.options.vertical?x.rangeElement.height():x.rangeElement.width())}function s(){var a;b.options.vertical&&b.handlePoints[0].y<b.handlePoints[1].y?(a=[],a[1]=b.handlePoints[0],a[0]=b.handlePoints[1],b.handlePoints=a):!b.options.vertical&&b.handlePoints[0].x>b.handlePoints[1].x&&(a=[],a[1]=b.handlePoints[0],a[0]=b.handlePoints[1],b.handlePoints=a),b.$emit("rangeEnd")}function t(a,b){var c=x.rangeElement.offset();return new d(a-c.left,b-c.top)}function u(a,b,c){var d=v(a,c);d=d>0?d:0,c?x.nearBubble.css({"margin-left":Math.round(d)+"px"}):x.farBubble.css({"margin-right":Math.round(d)+"px"})}function v(a,b){return a?0:b?c.offset().left-(x.nearBubbleWrapper.offset().left-.5*x.nearBubbleWrapper.width()-5):x.farBubbleWrapper.offset().left-c.offset().left+1.5*x.farBubbleWrapper.width()+5-c.width()}var w=!1,x={gradient:c.find(".ccl-gradient"),rangeElement:c.find(".ccl-range"),rangeInner:c.find(".ccl-range-inner"),axisCover:c.find(".ccl-axis-cover"),nearBubbleWrapper:c.find(".near.ccl-bubble-wrapper"),nearBubble:c.find(".near.ccl-bubble-wrapper .ccl-bubble"),farBubbleWrapper:c.find(".far.ccl-bubble-wrapper"),farBubble:c.find(".far.ccl-bubble-wrapper .ccl-bubble"),nearEdge:c.find(".ccl-near-edge"),farEdge:c.find(".ccl-far-edge")};b.activeOptions={far:!1,near:!1,cover:!1},b.setRangeStyle=function(a){if(a&&2===a.length){b.relevantSize=j(c,b.options.vertical);var d=a[0],e=a[1],f=b.options.vertical?"y":"x";b.options.vertical?b.rangeStyle={height:Math.abs(d[f]-e[f]),top:Math.min(d[f],e[f])}:b.rangeStyle={width:Math.abs(d[f]-e[f]),left:Math.min(d[f],e[f])}}},b.$watch("handlePoints",function(a){if(a){if(h(a,x.rangeElement,b.options.vertical),b.setRangeStyle(a),r(b.handlePoints),b.active){var c=b.options.vertical?"y":"x";b.cclFarValueLabel=m(a[f(b.handlePoints,!b.options.vertical,c)]),b.cclNearValueLabel=m(a[f(b.handlePoints,b.options.vertical,c)])}if(b.active&&b.options){var d=g(b.options.dock);u(b.options.vertical,d,!1),u(b.options.vertical,d,!0)}}}),b.$watchCollection("[viewItems, options.reverse, options.vertical]",function(a){var c=a[0],d=a[1],f=a[2];if(c&&c.length){for(var g=[c[0].colorTo],h=0;h<c.length;h++)g.push(c[h].colorFrom);if(b.cclGradientStyle=e(g,d,f),b.positionToValue){var i=[c[0].minText,c[c.length-1].maxText];(d?!f:f)&&i.reverse(),b.axisValues=i}}}),b.$watchCollection("[options.vertical, options.dock, relevantSize]",function(a){var c=a[0],d=g(a[1]),e=a[2];b.cclOrientationClass={vertical:c,horizontal:!c,near:d,far:!d},d?(b.cclCoverStyle=c?{left:"0px",width:e+"px"}:{bottom:"0px",height:e+"px"},b.cclBubbleNearStyle=c?{}:{bottom:"0px"},b.cclBubbleFarStyle=c?{}:{bottom:"0px"}):(b.cclCoverStyle=c?{right:"0px",width:e+"px"}:{top:"0px",height:e+"px"},b.cclBubbleNearStyle=c?{right:"0px"}:{},b.cclBubbleFarStyle=c?{right:"0px"}:{})}),n.call(this),b.$watch("selectionEnabled",function(a){a?n.call():p.call()}),b.$on("$destroy",function(){p.call()}),b.$on("cancelSelection",function(){b.active=!1})}}})}),define("text!objects.views/charts/components/legend/discrete-legend.ng.html",[],function(){return'<div class="qv-discrete-color-legend"\r\n	 ng-class="{ \'vertical\': options.vertical }"\r\n	 ng-style="options.labelStyle">\r\n	<div class="dcl-title"\r\n		 ng-if="options.legendTitle && options.legendTitle.length"\r\n		 ng-style="options.titleStyle"\r\n		 ng-class="{\'vertical\': options.vertical }">\r\n		<div class="dcl-title-inner" title="{{options.legendTitleTooltip}}">{{options.legendTitle}}</div>\r\n	</div>\r\n	<div class="dcl-flex" ng-class="{\'align\': align, \'vertical\': options.vertical, \'in-selections\': selectionsApi.active }"\r\n		 qv-selections-toggle-dimension-value="{ selector: \'.color-item\', itemKey: \'item\' }"\r\n		 qv-selections-on-toggle-dimension-value="selectionEnabled && !isScrolling && select($event, item)">\r\n		<div ng-repeat="item in viewItems track by $index"\r\n			 ng-style="{\'height\':item.height,  \'width\': options.cellWidth}"\r\n			 class="color-item" ng-class="{\'selected\': item.selected}"\r\n			 tid="dcl.item">\r\n			<div class="marker">\r\n				<div ng-style="item.markerClass[\'glyph-triangle\']  ? {\'border-bottom-color\': item.color} : ( item.markerClass[\'glyph-inverse-triangle\'] ? {\'border-top-color\': item.color} : {background: item.color} )" ng-class="item.markerClass"></div>\r\n			</div>\r\n			<div class="text"\r\n				 title="{{item.tipText}}">{{item.text}}</div>\r\n		</div>\r\n	</div>\r\n	<div class="dcl-buttons-v" ng-show="options.vertical && overflow">\r\n		<!--DOWN-->\r\n		<button class="dcl-down qui-plainbuttonicon" data-icon="S" ng-disabled="!interactionEnabled || scrollAtEnd" tid="dcl.down"></button>\r\n		<!--UP-->\r\n		<button class="dcl-up qui-plainbuttonicon" data-icon="R" ng-disabled="!interactionEnabled || scrollAtStart" tid="dcl.up"></button>\r\n	</div>\r\n	<div class="dcl-buttons-h" ng-show="!options.vertical && overflow">\r\n		<!--RIGHT-->\r\n		<button class="dcl-right qui-plainbuttonicon" data-icon="U" ng-disabled="!interactionEnabled || scrollAtEnd" tid="dcl.right"></button>\r\n		<!--LEFT-->\r\n		<button class="dcl-left qui-plainbuttonicon" data-icon="T" ng-disabled="!interactionEnabled || scrollAtStart" tid="dcl.left"></button>\r\n	</div>\r\n</div>\r\n'}),define("objects.utils/event-utils",["qvangular","touche"],function(a){"use strict";function b(a,b){a.gestures.forEach(function(c){c!==b&&a.cancelGesture(c)})}function c(a){var b=0,c=0,d=0,e=60;return a.wheelDelta&&(b=a.wheelDelta/e),a.detail&&(b=-a.detail/3),d=b,void 0!==a.axis&&a.axis===a.HORIZONTAL_AXIS&&(d=0,c=-1*b),void 0!==a.wheelDeltaY&&(d=a.wheelDeltaY/e),void 0!==a.wheelDeltaX&&(c=-1*a.wheelDeltaX/e),{delta:b,deltaX:c,deltaY:d,x:a.pageX,y:a.pageY}}function d(a,b,c){var d,e;return function(){var f=c||this,g=+new Date,h=arguments;d&&d+b>g?(clearTimeout(e),e=setTimeout(function(){d=g,a.apply(f,h)},b)):(d=g,a.apply(f,h))}}function e(a,b){return function(){var c=this,d=arguments;clearTimeout(h),h=setTimeout(function(){a.apply(c,d)},b)}}function f(b){b&&(b=b.map(function(a){return a.qGroupFieldDefs?a.qGroupFieldDefs[a.qGroupPos||0]:a.qFallbackTitle}),a.$rootScope.$broadcast("locked-feedback",[b]),e(function(){a.$rootScope.$broadcast("locked-feedback",[b,!0])},100)())}var g=Touche.Gesture.augment(function(a){function b(){a.apply(this,arguments)}return this.defaults={which:2,radiusThreshold:3},this.start=function(a,b){Touche.utils.touch||Touche.utils.msPointer&&a.pointerType!==a.MSPOINTER_TYPE_MOUSE||this.isValidMouseButton(a,this.options.which)&&(this.initiated=!0,b.startPoint=b.points[0],this.binder.start.call(this,a,b))},this.update=function(a,b){!this.started&&b.startPoint&&b.startPoint.distanceTo(b.points[0])>=this.options.radiusThreshold?(this.started=!0,this.binder.update.call(this,a,b)):this.started&&this.binder.update.call(this,a,b)},this.end=function(a,b){this.initiated&&(this.binder.end.call(this,a,b),this.initiated=!1)},b});Touche.gestures.add("wheelswipe",g);var h=null;return{getMouseWheelData:c,cancelGestures:b,throttle:d,debounce:e,showLockedFeedback:f}}),define("objects.grid/directives/selections",["qvangular","jquery","touche"],function(a,b,c){"use strict";a.directive("qvSelectionsToggleValue",["$parse",function(a){return{restrict:"A",link:function(c,d,e){var f=a(e.qvSelectionsToggleValue)(),g=f.selector,h="."+c.$id+"-toggle-value",i=f.itemKey||"cell";d.on("qv-activate"+h,g,function(a){var d=b(a.target).closest(g),f=d.scope()[i];d.length&&f&&c.$apply(function(){var b={$event:a};b[i]=f,c.$eval(e.qvSelectionsOnToggleValue,b)})}),c.$on("$destroy",function(){d.off(h)})}}}]),a.directive("qvSelectionsToggleDimensionValue",["$parse",function(a){return{restrict:"A",link:function(c,d,e){var f=a(e.qvSelectionsToggleDimensionValue)(),g=f.selector,h="."+c.$id+"-toggle-dimension-value",i=f.itemKey||"cell";d.on("qv-activate"+h,g,function(a){var d=b(a.target).closest(g),f=d.scope()[i];if(!c.$eval(e.qvSelectionsExcludeToggleDimensionValue,{$event:a})&&f&&f.isDimensionValue)return f.locked?void c.$eval(e.qvSelectionsSelectWhileLocked):void c.$apply(function(){var b={$event:a};b[i]=f,c.$eval(e.qvSelectionsOnToggleDimensionValue,b)})}),c.$on("$destroy",function(){d.off(h)})}}}]),a.directive("qvSelectionsMultiselect",["$parse",function(a){return{restrict:"A",controller:function(){},link:function(d,e,f,g){function h(){return c(e[0]).tap({id:q,options:{preventDefault:!1},start:function(a){l=b(a.target).closest(o)}}),c(e[0]).swipe({id:q,options:{radiusThreshold:4,preventDefault:!1},start:function(a){var b,e;return c.utils.isMouse(a)&&l.length?(b=l.scope()[p],b.isDimensionValue?b.locked?(d.$eval(f.qvSelectionsSelectWhileLocked),void this.cancel()):(m=b,e={$event:a},e[p]=b,void d.$apply(d.$eval(f.qvSelectionsStartMultiselect,e))):void this.cancel()):void this.cancel()},update:function(a){var c,e=b(a.target).closest(o);e.length&&(c=e.scope()[p],d.$apply(d.$eval(f.qvSelectionsUpdateMultiselect,{start:m,current:c,dataColIx:c.dataColIx})))},end:function(a){d.$apply(d.$eval(f.qvSelectionsEndMultiselect,{$event:a}))}}),function(){c(e[0]).off("*",q)}}function i(){return c(e[0]).tap({id:r,options:{touches:2,preventDefault:!1},end:function(a,c){var e,g=c.pagePoints[0],h=c.pagePoints[1],i=b(document.elementFromPoint(g.x,g.y)),j=b(document.elementFromPoint(h.x,h.y)),k=i.closest(o).scope()[p],l=j.closest(o).scope()[p];if(k.isDimensionValue&&l.isDimensionValue)return k.locked||l.locked?void d.$eval(f.qvSelectionsSelectWhileLocked):void d.$apply(function(){e={offsetLeft:i[0].offsetLeft,width:i[0].clientWidth,$event:a},e[p]=k,d.$eval(f.qvSelectionsStartMultiselect,e),d.$eval(f.qvSelectionsUpdateMultiselect,{start:k,current:l,dataColIx:k.dataColIx}),d.$eval(f.qvSelectionsEndMultiselect,{$event:a})})}}),function(){c(e[0]).off("*",r)}}var j,k,l,m,n=a(f.qvSelectionsMultiselect)(),o=n.selector,p=n.itemKey||"cell",q=d.$id+"-multiselect",r=d.$id+"-2finger-multiselect";g.on=function(){j||(j=h()),k||(k=i())},g.off=function(){j&&(j(),j=void 0),k&&(k(),k=void 0)},d.$watch("interactive",function(a){void 0!==a&&(a?g.on():g.off())}),d.$on("$destroy",function(){g.off()})}}}])}),define("objects.views/charts/components/legend/qv-discrete-legend",["assets/qvangular/qvangular-core","text!./discrete-legend.ng.html","touche","objects.utils/event-utils","objects.grid/directives/selections"],function(a,b,c,d){var e=5,f=10,g=".discretelegend";a.directive("qvDiscreteLegend",function(){return{template:b,replace:!0,scope:!0,link:function(a,b){function h(b,c){var d,e=a.viewItems,f=0,g=1;if(c)for(;g!==b&&g<e.length;)d=e[g],f+=d.height,g++;else f=b*a.options.cellWidth;return f}function i(){return a.options.vertical?s.scrollTop():s.scrollLeft()}function j(a){k(i()+a)}function k(b){a.options.vertical?s.scrollTop(b):s.scrollLeft(b)}function l(){var b=i();a.scrollAtStart=0>=b,a.options.vertical?a.scrollAtEnd=b+s.height()>=s[0].scrollHeight:a.scrollAtEnd=b+s.width()>=s[0].scrollWidth,a.$digest()}function m(b,c){var d=a.viewItems,e=d[0],f=0,g=0;if(c){for(;b>f&&g<d.length;)e=d[g],f+=e.height,g++;b+s.height()>=s[0].scrollHeight?f=b:Math.abs(b-f)>Math.abs(b-(f-e.height))&&(f-=e.height)}else f=Math.round(b/a.options.cellWidth)*a.options.cellWidth,g=Math.round(b/a.options.cellWidth),b+s.width()>=s[0].scrollWidth&&(f=b,g++);return{position:f,index:g}}function n(b,c,d){d=d||0;var e=i(),f=m(e+d,b);f.position!==e&&(b?s.animate({scrollTop:f.position+"px"},c?200:0):s.animate({scrollLeft:f.position+"px"},c?200:0)),a.$emit("scrollPositionChanged",f.index)}function o(d,h,i){var j=!1;c(b.find(d)[0]).longtap({id:g,options:{timeThreshold:1e4},update:function(b,d){d.percentage>2&&a.interactionEnabled&&(p(h*(i?e:f)),
j=!0,c.preventGestures(this.gestureHandler))},end:function(){j=!1,c.preventGestures(this.gestureHandler),l()},cancel:function(){c.preventGestures(this.gestureHandler)}}).tap({end:function(){a.interactionEnabled&&(j?(n(i,!0),l()):(p(h*(i?a.options.cellHeight:a.options.cellWidth)),n(i,!1),l()),j=!1)}})}function p(a){j(a)}function q(a,b){var e=null,f=d.throttle(function(a){if(b.interactionEnabled){var c,e=d.getMouseWheelData(a.originalEvent);c=(e.delta>0?-1:1)*(b.options.vertical?b.options.cellHeight:b.options.cellWidth),n(b.options.vertical,!1,c),l()}},20);s.on("mousewheel"+g+" DOMMouseScroll"+g,function(a){f(a),a.preventDefault()}),o(".dcl-up",-1,!0),o(".dcl-down",1,!0),o(".dcl-left",-1,!1),o(".dcl-right",1,!1),c(s[0]).swipe({options:{useMomentum:!0,inertia:.7,preventDefault:!0},start:function(a){b.interactionEnabled&&(e=i(),b.isScrolling=!0,c.preventGestures(this.gestureHandler),a.preventDefault())},update:function(a,c){if(null!==e&&c.swipe){var d=c.swipe.distance;b.options.vertical?"up"===c.swipe.direction?k(e-d):"down"===c.swipe.direction&&k(e+d):"left"===c.swipe.direction?k(e-d):"right"===c.swipe.direction&&k(e+d)}},end:function(){null!==e&&(n(b.options.vertical,!0),l(),b.isScrolling=!1,e=null)}})}function r(a){c(a.find(".dcl-up").off("*",g)),c(a.find(".dcl-down").off("*",g)),c(a.find(".dcl-left").off("*",g)),c(a.find(".dcl-right").off("*",g))}var s=b.find(".dcl-flex");a.$watch("viewItems",function(a){a.forEach(function(a){for(var b={},c=Array.isArray(a.marker)?a.marker:[a.marker],d=0;d<c.length;d++)switch(c[d]){case"line":b["glyph-line"]=!0;break;case"triangle":b["glyph-triangle"]=!0;break;case"inverse-triangle":b["glyph-inverse-triangle"]=!0;break;case"diamond":b["glyph-diamond"]=!0;break;case"circle":b["glyph-circle"]=!0;break;case"rect":default:b["glyph-rect"]=!0}a.markerClass=b})}),a.$on("clearSelection",function(){if(a.viewItems){a.selectedValues=[];for(var b=0;b<a.viewItems.length;b++){var c=a.viewItems[b];c.selected=!1}}}),a.$on("invalidateSelections",function(){if(a.viewItems){a.selectedValues=[];for(var b=0;b<a.viewItems.length;b++){var c=a.viewItems[b];"dimension"===c.type&&c.cacheItems&&c.cacheItems[0]&&(c.selected=c.cacheItems[0].selected)}}a.$digest()}),a.select=function(b,c){"range"===c.type&&(c.selected=!c.selected),a.$emit("toggleSelect",b,[c])},a.$on("$destroy",function(){r(b)}),a.$watch("explicitScrollPosition",function(b){a.explicitScrollPosition=b}),a.$on("updateSize",function(){if(l(),void 0!==a.explicitScrollPosition){var b=h(a.explicitScrollPosition,a.options.vertical);a.options.vertical?s.scrollTop(b):s.scrollLeft(b)}}),q(b,a)}}})}),define("objects.views/charts/components/legend/color-legend",["jquery","objects.views/charts/chart-style-service","../chart-component-angular","text!./color-legend.ng.html","./legend-data","client.utils/state","./qv-continous-legend","./qv-discrete-legend"],function(a,b,c,d,e,f){function g(a){return f.state===f.States.analysis||f.state===f.States.play&&(!a.backendApi||!a.backendApi.isSnapshot)}function h(a,b){var c={backgroundColor:a.getValue(s,null,"backgroundColor"),label:{font:a.getFont(s,"label"),lineHeight:"1em"},scaledLabel:{font:a.getFont(s,"label",null,null,null,b),color:a.getValue(s,"label","color"),lineHeight:"1em"},ticks:{color:"#a6a6a6",length:8},line:{color:"#666666"},title:{font:a.getFont(s,"title"),lineHeight:"1em"},scaledTitle:{font:a.getFont(s,"title",null,null,null,b),color:a.getValue(s,"title","color"),lineHeight:"1em"}};return c}function i(a,b,c){var d={};return d.maxItemsPerRow=Math.floor((a.width-(c.show?c.width:0))/b.cellWidth),d.numRows=Math.ceil(b.viewItems.length/d.maxItemsPerRow),d.itemsPerRow=Math.ceil(b.viewItems.length/d.numRows),d.w=d.itemsPerRow*b.cellWidth,d.h=Math.ceil(Math.max(c.height,Math.min(b.cellHeight*t,d.numRows*b.cellHeight))),d}function j(a){a.visible=!1,a.discreteItems=null,a.continousItems=null,this._titleMetrics=null,this._legendMetrics=null}function k(a){return a&&"primary"!==a.colorMode}function l(a,b,c){return c?Math.max(a.width,b.maxLabelWidth+v):Math.max(b.labelHeight+v,a.height)}function m(a,b,c,d){var e,f,g=d[0].min,h=d[d.length-1].max,i=h-g;return c?(e=1-Math.max(a[0].y,a[1].y)/b,f=1-Math.min(a[0].y,a[1].y)/b):(e=Math.min(a[0].x,a[1].x)/b,f=Math.max(a[0].x,a[1].x)/b),e=0===e?g:e*i+g,f=1===f?h:f*i+g,{startVal:e,updateVal:f,isMax:!0}}function n(a,b){var c,d=b[0].min,e=b[b.length-1].max,f=e-d;return c=0===a?d:1===a?e:a*f+d}function o(a,b){for(var c,d=[],e=0;e<b.length;e++)c=b[e],d.push({startVal:c.id[0],updateVal:c.id[1],isMax:c.isMax});return d}function p(a){return!("measure"===a.colorMode&&"item"===a.boxType)}function q(){return{prepare:function(){},formatValue:function(a){return a}}}var r,s="legend",t=2,u=12,v=48;return r=c.extend("ColorLegend",{init:function(){var a=Array.prototype.slice.call(arguments);a.push(d),this._super.apply(this,a),this._styleService=b.getInstance(),this._legendContainer=this.getInnerContainer(),this._dataInvalid=!0,this.$scope=this.getInnerContainerScope(),this._scrollPosition=0,this._mode={};var c=this;this.$scope.$on("toggleSelect",function(a,b,d){if(p(c._mode)){if("range"===c._mode.boxType){c.selections.rangeStart();var e=o(c.$scope.viewItems,d);c.selections.rangeUpdate(e,!0),c.selections.rangeEnd()}else{var f,g=[],h=d.length;for(f=0;h>f;f++)g=g.concat(d[f].cacheItems);c.selections.updateFromItems(b,g)}a.preventDefault()}}),this.$scope.$on("rangeStart",function(a){c._formatter=c._colorMap._measureFormatters[0]||q(),c._formatter.prepare(),c.selections&&c.selections.rangeStart(),a.preventDefault()}),this.$scope.$on("rangeUpdate",function(a,b,d){var e=m(b,d,c.isVertical(),c.$scope.viewItems);c.selections&&c.selections.rangeUpdate([e]),a.preventDefault()}),this.$scope.$on("rangeEnd",function(a){c.selections&&c.selections.rangeEnd(),a.preventDefault()}),this.$scope.$on("scrollPositionChanged",function(a,b){c._scrollPosition=b}),this.formatValue=function(a){return c._formatter.formatValue(a)},this.$scope.positionToValue=function(a){return c.formatValue(n(a,c.$scope.viewItems))}},release:function(){this._super(),this.$scope=null,this._legendContainer=null},setColorMap:function(a){this._colorMap=a,this.invalidateProperties("Legend.setColorMap"),this.invalidateDisplay("Legend.setColorMap")},getColorMap:function(){return this._colorMap},getSelectionIndices:function(){return this._colorMap.getSelectionIndices()},setData:function(a){this._super(a),this._dataInvalid=!0},setSelectableShapes:function(a){this._super(a),this._dataInvalid=!0,this.invalidateProperties("Legend.setSelectableShapes")},isVisible:function(a){return this._super(a)&&k(this._mode)&&this._data&&this._data.qHyperCube&&!this._data.qHyperCube.isReduced},updateSize:function(){this._super(),this.invalidateProperties("Legend.calculateRelevantSize"),this.updateNow(["properties"]),this._dataInvalid=!0},_updateProperties:function(){if(!this._colorMap||!this._data||!this._data.qHyperCube||this._data.qHyperCube.isReduced||!this._data.legend)return void j(this.$scope);var b,c=this._colorMap.getColorMapping().concat(),d=h(this._styleService,this.chartScale),f=this._colorMap.getLegendMode();return this._mode={legend:"scale"!==f[0]?e.Modes.DISCRETE:e.Modes.CONTINOUS,boxType:f[1],colorMode:f[2],selectionEnabled:!f[3],showTitle:this._data.legend.showTitle},this.isVisible()?(this.$scope.visible=!0,this.$scope.selectionEnabled=!this.options._disableSelections&&this._mode.selectionEnabled&&g(this.options)&&!!this.selections,this.$scope.interactionEnabled=g(this.options),this._mode.showTitle?(this._titleMetrics=e.prepareLegendTitle(this._colorMap.getLegendTitle(),d.title),this._titleMetrics.show=this._mode.showTitle):this._titleMetrics={show:!1,width:0,height:0},this._mode.legend===e.Modes.DISCRETE?(b=this._data.qHyperCube?this._data.qHyperCube.qDimensionInfo.length:1,this._legendMetrics=e.prepareDiscreteData(c,this._selectableShapes,d.label,this.rect.width-(this._mode.showTitle&&this.isHorizontal()?this._titleMetrics.width:0),this.chartScale,b-this._colorMap.getDimensionIndex()[0]-1),this.$scope.viewItems=this._legendMetrics.viewItems):(this._formatter=this._colorMap._measureFormatters[0]||q(),this._formatter.prepare(),this._legendMetrics=e.prepareContinousData(c,d.label,this._formatter),this.$scope.viewItems=this._legendMetrics.viewItems),this.isHorizontal()?(this._horizontalMetrics=i(this.rect,this._legendMetrics,this._titleMetrics),this.$scope.align=this._horizontalMetrics.numRows>=t,this.$scope.overflow=this._horizontalMetrics.numRows>t):this.$scope.overflow=this._legendMetrics.cellHeight*this._legendMetrics.viewItems.length>this.rect.height,this.$scope.discrete=this._mode.legend===e.Modes.DISCRETE,this.$scope.options={vertical:this.isVertical(),labelStyle:d.scaledLabel,titleStyle:a.extend(!0,{width:Math.ceil(this._titleMetrics.width*this.chartScale)+"px"},d.scaledTitle),titleHeight:(Math.max(this._titleMetrics.height,u)+u)*this.chartScale,legendTitle:this._titleMetrics.show?this._titleMetrics.text:null,legendTitleTooltip:this._titleMetrics.fullText,cellWidth:Math.ceil(this._legendMetrics.cellWidth*this.chartScale),cellHeight:Math.ceil(this._legendMetrics.cellHeight*this.chartScale),reverse:this._data.legend.reverse,dock:this.dock},void(this._dataInvalid=!1)):void j(this.$scope)},paint:function(){this.$scope.$broadcast("invalidateSelections"),this.$scope.$broadcast("updateSize")},calculateRelevantSize:function(a){if(this._super(),this.relevantSize=0,this.invalidateProperties("Legend.calculateRelevantSize"),this.updateNow(["properties"]),this.isVisible()&&this._titleMetrics&&this._legendMetrics)if(this.isDiscrete())if(this.isHorizontal()){var b=i(a,this._legendMetrics,this._titleMetrics);this.relevantSize=b.h+(b.numRows>t?t:b.numRows)+2*e.constants.PADDING}else this.relevantSize=Math.max(this._legendMetrics.cellWidth,this._titleMetrics.width);else this.relevantSize=l(this._titleMetrics,this._legendMetrics,this.isVertical(),this._values)},isDiscrete:function(){return this._mode.legend===e.Modes.DISCRETE},clear:function(){this._super()},on:function(){this.$scope.selectionEnabled=!!this._mode.selectionEnabled&&!!this.selections,this.$scope.interactionEnabled=!0},off:function(){this.$scope.selectionEnabled=!1,this.$scope.interactionEnabled=!1},getSelectionMode:function(){return this._mode.legend},clearSelection:function(){this.$scope.$broadcast("clearSelection"),this.$scope.$broadcast("cancelSelection")},cancelSelection:function(){this.$scope.$broadcast("cancelSelection")},getScrollPosition:function(){return this._scrollPosition},setScrollPosition:function(a){this.$scope.explicitScrollPosition=a},setLocked:function(a){this.$scope.isLocked=a}}),Object.defineProperties(r.prototype,{pagingMode:{get:function(){return this._pagingMode},set:function(a){this._pagingMode=a}}}),Object.defineProperty(r.prototype,"className",{value:"ColorLegend"}),r}),/**
 * @preserve IntegraXor Web SCADA - JavaScript Number Formatter
 * http://www.integraxor.com/
 * author: KPL, KHL
 * (c)2011 ecava
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
define("assets/external/numberformatter/format",[],function(){return function(a,b){if(!a||isNaN(+b))return b;var b="-"==a.charAt(0)?-b:+b,c=0>b?b=-b:0,d=a.match(/[^\d\-\+#]/g),e=d&&d[d.length-1]||".",f=d&&d[1]&&d[0]||",",a=a.split(e);b=b.toFixed(a[1]&&a[1].length),b=+b+"";var g=a[1]&&a[1].lastIndexOf("0"),h=b.split(".");(!h[1]||h[1]&&h[1].length<=g)&&(b=(+b).toFixed(g+1));var i=a[0].split(f);a[0]=i.join("");var j=a[0]&&a[0].indexOf("0");if(j>-1)for(;h[0].length<a[0].length-j;)h[0]="0"+h[0];else 0==+h[0]&&(h[0]="");b=b.split("."),b[0]=h[0];var k=i[1]&&i[i.length-1].length;if(k){for(var l=b[0],m="",n=l.length%k,o=0,p=l.length;p>o;o++)m+=l.charAt(o),!((o-n+1)%k)&&p-k>o&&(m+=f);b[0]=m}return b[1]=a[1]&&b[1]?e+b[1]:"",(c?"-":"")+b[0]+b[1]}}),define("objects.utils/number-formatter",["core.utils/class","util","assets/external/numberformatter/format"],function(a,b,c){"use strict";function d(a,b,c,d){return a=a.toString(b),c[1]===c[1].toUpperCase()&&(a=a.toUpperCase()),a.length-a.indexOf(".")>10&&(a=a.slice(0,a.indexOf(".")+11)),a.replace(".",d||".")}function e(a,b,c){var e;return m.test(b)?a=d(a,Number(/\d{2}/.exec(b)[0]),b,c):n.test(b)?a=d(a,8,b,c):o.test(b)?a=d(a,10,b,c):p.test(b)?a=d(a,16,b,c):q.test(b)?a=d(a,2,b,c):r.test(b)&&(e="",0>a&&(e="-",a=-a),a=Math.floor(a),0===a?a="0":5e5>=a?(a=f(a,b),a=e+a):a=b+e+a.toExponential(0)),a}function f(a,b){for(var c,d="",e=Number(String(a).slice(-3)),f=(a-e)/1e3,g=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),h=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();e>0;)for(c=0;c<g.length;c++)if(g[c]<=e){d+=h[c],e-=g[c];break}for(c=0;f>c;c++)d="M"+d;return b[1]!==b[1].toUpperCase()&&(d=d.toLowerCase()),d}function g(a,b,c){var d,e,f,g,j,k,m,n,o,p=a.pattern;p.indexOf("A")>=0&&(p=p.replace("A",""),a.abbreviate=!0),o=i(b,c),f=p.match(o),f=f?f[0]:"",g=f?p.substr(0,p.indexOf(f)):p,j=f?p.substring(p.indexOf(f)+f.length):"",f||(f=p?"#":"##########"),b&&b===c&&(d=f.split(c),e=d.pop(),f=d.join("")+c+e,b=""),k=b,b=/,/.test(c)?"¤":",",k&&(f=f.replace(h(k,"g"),b)),m=c,c=".",m&&(f=f.replace(h(m,"g"),c)),n=f.match(/#/g),n=n?n.length:0,a.prefix=g||"",a.postfix=j||"",a.pattern=p,a.percentage=l.test(p),a.numericPattern=f||"",a.numericRegex=new RegExp(h(b,null,!0)+"|"+h(c,null,!0),"g"),a.groupTemp=k,a.decTemp=m,a.t=b,a.d=c,a.temp=n}function h(a,c,d){var e=b.escapeRegExp(a);return d?e:new RegExp(e||"",c)}function i(a,c){return c&&(c=b.escapeRegExp(c)),a&&(a=b.escapeRegExp(a)),new RegExp("(?:[#0]+"+a+")?[#0]+(?:"+c+"[#0]+)?")}var j,k={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"μ","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},l=/%$/,m=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,n=/^\(oct\)/i,o=/^\(dec\)/i,p=/^\(hex\)/i,q=/^\(bin\)/i,r=/^\(rom\)/i,s=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i;return j=a.extend("NumberFormatter",{init:function(a,b,c,d,e){this.localeInfo=a,this.pattern=b,this.thousandDelimiter=c||",",this.decimalDelimiter=d||".",this.type=e||"numeric",this.prepare()},clone:function(){var a=new j(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);return a.subtype=this.subtype,a},format:function(a,b,c,d){return this.prepare(b,c,d),this.formatValue(a)},prepare:function(a,b,c){var d,e;return"undefined"==typeof a&&(a=this.pattern),"undefined"==typeof b&&(b=this.thousandDelimiter),"undefined"==typeof c&&(c=this.decimalDelimiter),a?(this._prepared={positive:{d:c,t:b,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},negative:{d:c,t:b,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""}},d=this._prepared,a=a.split(";"),d.positive.pattern=a[0],d.negative.pattern=a[1],s.test(a[0])&&(d.positive.isFunctional=!0),a[1]?s.test(a[1])&&(d.negative.isFunctional=!0):d.negative=!1,e=d.positive.isFunctional&&(!d.negative||d.negative&&d.negative.isFunctional),void(e||(g(d.positive,b,c),d.negative&&g(d.negative,b,c)))):void(this._prepared={pattern:!1})},formatValue:function(a){var b,d,f,g,h,i,j,l,m,n=this._prepared,o="",p="";if(isNaN(a))return a;if(n.pattern===!1)return a.toString();if(0>a&&n.negative?(n=n.negative,a=-a):n=n.positive,h=n.d,i=n.t,n.isFunctional)a=e(a,n.pattern,h);else{if(n.percentage&&(a*=100),n.abbreviate&&(d=Number(Number(a).toExponential().split("e")[1]),d-=d%3,d in k&&(o=k[d],a/=Math.pow(10,d))),f=Math.abs(a),b=n.temp,l=n.numericPattern,m=l.split(h)[1],"I"===this.type&&(a=Math.round(a)),g=a,m||"#"!==l.slice(-1)[0])if(f>=1e15||f>0&&1e-14>=f)a=f?f.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var q=Number(a.toFixed(Math.min(20,m?m.length:0)).split(".")[0]),r=l.split(h)[0];if(r+=h,a=c(r,q)||"0",m){var s=Math.max(0,Math.min(14,m.length)),t=m.replace(/#+$/,"").length,u=(f%1).toFixed(s).slice(2).replace(/0+$/,"");for(j=u.length;t>j;j++)u+="0";u&&(a+=h+u)}else 0===q&&(g=0)}else if(f>=Math.pow(10,b)||1>f||1e-4>f)0===a?a="0":1e-4>f||f>=1e20?(a=g.toExponential(Math.max(1,Math.min(14,b))-1),a=a.replace(/\.?0+(?=e)/,""),p=""):(a=a.toPrecision(Math.max(1,Math.min(14,b))),a.indexOf(".")>=0&&(a=a.replace(a.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,""),a=a.replace(".",h)));else{for(l+=h,b=Math.max(0,Math.min(20,b-Math.ceil(Math.log(f)/Math.log(10)))),j=0;b>j;j++)l+="#";a=c(l,a)}a=a.replace(n.numericRegex,function(a){return a===i?n.groupTemp:a===h?n.decTemp:""}),0>g&&!/^\-/.test(a)&&(a="-"+a)}return n.prefix+a+p+o+n.postfix}}),window.NumberFormatter=j,j}),define("objects.views/charts/components/legend/color-legend-light",["jquery","objects.views/charts/chart-style-service","../chart-component-angular","text!./color-legend.ng.html","./legend-data","translator","objects.utils/number-formatter","./qv-continous-legend","./qv-discrete-legend"],function(a,b,c,d,e,f,g){function h(a){a.visible=!1,a.discreteItems=null,a.continousItems=null,this._titleMetrics=null,this._legendMetrics=null}function i(a,b){var c={backgroundColor:a.getValue(l,null,"backgroundColor"),label:{font:a.getFont(l,"label"),lineHeight:"1em"},scaledLabel:{font:a.getFont(l,"label",null,null,null,b),color:a.getValue(l,"label","color"),lineHeight:"1em"},ticks:{color:"#a6a6a6",length:8},line:{color:"#666666"},title:{font:a.getFont(l,"title"),lineHeight:"1em"},scaledTitle:{font:a.getFont(l,"title",null,null,null,b),color:a.getValue(l,"title","color"),lineHeight:"1em"}};return c}function j(a,b){var c,d=b[0].min,e=b[b.length-1].max,f=e-d;return c=0===a?d:1===a?e:a*f+d}var k,l="legend",m=12;return k=c.extend("ColorLegendLight",{init:function(){var a=Array.prototype.slice.call(arguments);a.push(d),this._super.apply(this,a),this._styleService=b.getInstance(),this._numberFormatter=new g,this._defaultPattern="#.#A",this._legendContainer=this.getInnerContainer(),this._dataInvalid=!0,this.$scope=this.getInnerContainerScope(),this._scrollPosition=0,this._mode={};var c=this;this.formatValue=function(a){return c._formatter.formatValue(a)},this.$scope.positionToValue=function(a){return c.formatValue(j(a,c.$scope.viewItems))}},release:function(){this._super(),this.$scope=null,this._legendContainer=null},setColorMapLight:function(a){this._colorMapLight=a},getColorMapLight:function(){return this._colorMapLight},setData:function(a){this._super(a),this._dataInvalid=!0},setClusterDataPage:function(a){this._dataPage=a},isVisible:function(a){return this._super(a)&&this._data&&this._data.legend&&this._data.legend.show&&this._data.qHyperCube&&this._data.qHyperCube.isReduced},updateSize:function(){this._super(),this.invalidateProperties("LegendLight.calculateRelevantSize"),this.updateNow(["properties"]),this._dataInvalid=!0},_updateProperties:function(){if(!this.isVisible())return void h(this.$scope);var b=i(this._styleService,this.chartScale),c=f.get("properties.compression.density"),d=f.get("properties.compression.density");this._data.legend.showTitle?(this._titleMetrics=e.prepareLegendTitle(c,b.title),this._titleMetrics.show=!0):this._titleMetrics={show:!1,width:0,height:0},this.$scope.visible=!0,this._maxNrInBin=this._dataPage[0][0].qNum,this.$scope.viewItems=[{colorFrom:"rgba(29,51,72,1.0)",colorTo:"rgba(111,153,197,1.0)",max:1,maxText:this._numberFormatter.format(this._maxNrInBin,this._defaultPattern),min:0,minText:"1"}],this.$scope.options={vertical:this.isVertical(),labelStyle:b.scaledLabel,titleStyle:a.extend(!0,{width:Math.ceil(this._titleMetrics.width*this.chartScale)+"px"},b.scaledTitle),titleHeight:(Math.max(this._titleMetrics.height,m)+m)*this.chartScale,legendTitle:this._titleMetrics.show?c:null,legendTitleTooltip:d,reverse:this._data.legend.reverse,dock:this.dock},this.$scope.discrete=!1,this.$scope.overflow=!1,this.$scope.visible=!0},paint:function(){this.$scope.$broadcast("invalidateSelections"),this.$scope.$broadcast("updateSize")},calculateRelevantSize:function(){var a=90;this._super(),this.invalidateProperties("Legend.calculateRelevantSize"),this.updateNow(["properties"]),this.relevantSize=this._titleMetrics&&this.isVertical()?Math.max(a,this._titleMetrics.width):a},isDiscrete:function(){return this._mode.legend===e.Modes.DISCRETE},clear:function(){this._super()},setLocked:function(a){this.$scope.isLocked=a}}),Object.defineProperties(k.prototype,{pagingMode:{get:function(){return this._pagingMode},set:function(a){this._pagingMode=a}}}),Object.defineProperty(k.prototype,"className",{value:"ColorLegendLight"}),k}),define("objects.views/charts/utils/axis-utils",[],function(){"use strict";function a(){var a,b,c,d;a=0===this.explicitPlotMax?1:y.getMagnitude(this.explicitPlotMax),b=this.explicitPlotMax,c=this.maxNumIntervals<2?b-a:b-2*a,c=Math.ceil(c/a)*a,d=b-c,this.tickDataSpacing=d/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a/10,y.getNiceNumber(this.tickDataSpacing)),this.plotMax=b,this.plotMin=c,this.plotRange=d,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMin)}function b(){var a,b,c,d;a=0===this.explicitPlotMin?1:y.getMagnitude(this.explicitPlotMin),c=this.explicitPlotMin,b=this.maxNumIntervals<2?c+a:c+2*a,b=Math.floor(b/a)*a,d=b-c,this.tickDataSpacing=d/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a/10,y.getNiceNumber(this.tickDataSpacing)),this.plotMax=b,this.plotMin=c,this.plotRange=d,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMax-this.tickDataSpacingNN)}function c(){null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin?a.call(this):null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax&&b.call(this)}function d(){this.plotMax=this.plotMin=this.tickBaseValue=this.usedDataMin,this.plotRange=0,this.tickDataSpacing=this.tickDataSpacingNN=0===this.usedDataMin?1:Math.abs(this.usedDataMin),this.tickMaxIndex=this.tickMinIndex=0}function e(){if(0===this.usedDataMax)this.maxNumIntervals<2?(this.plotMin=0,this.plotMax=1):(this.plotMin=-1,this.plotMax=1),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=this.plotRange/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.ceil(this.plotMin/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor(this.plotMax/this.tickDataSpacingNN);else{var a=h(Math.abs(this.usedDataMax),this.maxNumIntervals);this.usedDataMax>0?(this.plotMax=a.max,this.plotMin=a.min,this.tickBaseValue=a.tickBaseValue):(this.plotMax=-a.min,this.plotMin=-a.max,this.tickBaseValue=-a.tickBaseValue),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=this.plotRange/this.maxNumIntervals,this.tickDataSpacingNN=Math.max(a.magnitude/10,y.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.floor((this.plotMin-this.tickBaseValue)/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor((this.plotMax-this.tickBaseValue)/this.tickDataSpacingNN)}}function f(){0===this.explicitPlotMax?(this.plotMax=0,this.plotMin=-1,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.plotRange/this.maxNumIntervals))):a.call(this)}function g(){0===this.explicitPlotMin?(this.plotMax=1,this.plotMin=0,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,y.getNiceNumber(this.plotRange/this.maxNumIntervals))):b.call(this)}function h(a,b){var c,d,e=y.getMagnitude(a),f=a/e,g=Math.floor(f),h=Math.round(f),i=0;return 2>b?(c=g*e,d=(g+1)*e,1>b&&(i=c)):(c=(h-1)*e,d=(h+1)*e),{min:c,max:d,tickBaseValue:i,magnitude:e}}function i(){null!==this.explicitPlotMin&&null!==this.explicitPlotMax?d.call(this):null===this.explicitPlotMin&&null===this.explicitPlotMax?e.call(this):null===this.explicitPlotMin&&null!==this.explicitPlotMax?f.call(this):g.call(this)}function j(a,b,c){void 0===a&&(a=null!==this.explicitPlotMin),void 0===b&&(b=null!==this.explicitPlotMax),this.tickDataSpacingNN=c?y.getGoodNumber(this.tickDataSpacing):y.getNiceNumber(this.tickDataSpacing),u.apply(this,[a,b])}function k(){var a,b,c,d;if(j.call(this),a=this.tickMaxIndex-this.tickMinIndex,b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,d&&this.maxNumIntervals>=5){for(c=0;this.tickDataSpacing<=this.absMax&&d;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.call(this),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c++;if(!d)return}for(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,(d||2>=a&&this.maxNumIntervals>=2*a)&&j.apply(this,[void 0,void 0,!0]),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c=0;this.tickDataSpacing<=this.absMax&&d;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.apply(this,[void 0,void 0,!0]),b=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=b/this.plotRange,d=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,c++}function l(a){a?(this.tickDataSpacingNN=y.getGoodNumber(this.absMax),this.tickBaseValue=-this.tickDataSpacingNN,this.plotMin=null===this.explicitPlotMin?-this.tickDataSpacingNN:this.explicitPlotMin,this.plotMax=null===this.explicitPlotMax?this.tickDataSpacingNN:this.explicitPlotMax,this.tickMinIndex=null===this.explicitPlotMin?0:1,this.tickMaxIndex=(null===this.explicitPlotMax,1),this.tickDataSpacingNN=2*this.tickDataSpacingNN):(this.plotMax=this.usedDataMax,this.plotMin=this.usedDataMin,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,this.tickDataSpacingNN=y.getNiceNumber(this.absMax),this.tickDataSpacingNN===this.absMax&&(this.tickDataSpacingNN=y.getNiceNumber(1.1*this.absMax)))}function m(){var a;this.tickDataSpacingNN=y.getNiceNumber(this.tickDataSpacing),this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,(this.usedDataMax<0||this.usedDataMin>0)&&(a=y.getSmallNiceNumber(this.plotRange),this.tickBaseValue=Math.ceil(this.plotMin/a)*a)}function n(){var a,b,c,d,e,f;for(c=this.usedDataMax>=-this.usedDataMin,a=c||null!==this.explicitPlotMin,b=!c||null!==this.explicitPlotMax,j.apply(this,[a,b,!0]),e=0,f=(this.absMax+(1-this.spaceUseLimit)*this.absMin)/this.spaceUseLimit*1.0001;this.tickDataSpacing<=f&&this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel;)this.tickDataSpacing=1.1*this.tickDataSpacingNN,j.apply(this,[a,b,!0]),e++;d=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=d/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&l.call(this)}function o(){k.call(this);var a=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin);this.spaceUseFactor=a/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,n.call(this))}function p(){var a,b,c,d,e,f,g,h,i,j=y.getNiceNumber(this.tickDataSpacingNN);this.tickDataSpacingNN!==j&&0===this.tickBaseValue&&(a=this.tickDataSpacingNN,d=this.tickMinIndex,e=this.tickMaxIndex,f=e-d,b=this.plotMin,c=this.plotMax,this.tickDataSpacingNN=j,u.apply(this,[null!==this.explicitPlotMin,null!==this.explicitPlotMax]),g=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=g/this.plotRange,h=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,i=this.tickMaxIndex-this.tickMinIndex,(h||!(i===f||i>=10||i>=3&&1.5*i>=f))&&(this.tickDataSpacingNN=a,this.tickMinIndex=d,this.tickMaxIndex=e,this.plotMin=b,this.plotMax=c,this.plotRange=this.plotMax-this.plotMin))}function q(){this.niceNumberEnabled&&this.plotMax!==this.plotMin&&0!==this.plotSize?(this.minTickValue=this.tickBaseValue+this.tickMinIndex*this.tickDataSpacingNN,this.maxTickValue=this.tickBaseValue+this.tickMaxIndex*this.tickDataSpacingNN):(this.minTickValue=this.plotMin,this.maxTickValue=this.plotMax)}function r(){var a,b,c;if(this.mainTickValues=[],this.secondaryTickValues=[],q.call(this),0!==this.plotSize)if(this.niceNumberEnabled){if(a=this.tickBaseValue,c=this.tickMaxIndex-this.tickMinIndex,!(c>100||1>c)){for(b=0;c>=b;b++)this.mainTickValues.push(a+(b+this.tickMinIndex)*this.tickDataSpacingNN);for(a=this.tickBaseValue+this.tickDataSpacingNN/2,b=0;c>b;b++)this.secondaryTickValues.push(a+(b+this.tickMinIndex)*this.tickDataSpacingNN)}}else{for(this.numIntervals=Math.floor(this.maxNumIntervals),this.tickDataSpacing=this.usedDataRange/this.numIntervals,a=this.usedDataMin,b=0;b<=this.numIntervals;b++)this.mainTickValues.push(a+b*this.tickDataSpacing);for(a=this.usedDataMin+this.tickDataSpacing/2,b=0;b<this.numIntervals;b++)this.secondaryTickValues.push(a+b*this.tickDataSpacing)}}function s(){var a,b,c,d,e,f=[.5];for(a=this.mainTickValues[0],e=0;e<f.length;e++)if(b=a-this.tickDataSpacingNN*f[e],c=this.plotMax-b,d=this.plotSize*this.tickDataSpacingNN/c,d>3*this.fontHeight)return this.plotMin=b,this.plotRange=c,void this.mainTickValues.splice(0,0,b)}function t(){var a,b,c,d,e,f=[.5];for(a=this.mainTickValues[this.mainTickValues.length-1],e=0;e<f.length;e++)if(b=a+this.tickDataSpacingNN*f[e],c=b-this.plotMin,d=this.plotSize*this.tickDataSpacingNN/c,d>3*this.fontHeight)return this.plotMax=b,this.plotRange=c,void this.mainTickValues.push(b)}function u(a,b){this.tickMinIndex=a?Math.ceil(this.usedDataMin/this.tickDataSpacingNN):Math.floor(this.usedDataMin/this.tickDataSpacingNN),this.tickMaxIndex=b?Math.floor(this.usedDataMax/this.tickDataSpacingNN):Math.ceil(this.usedDataMax/this.tickDataSpacingNN),this.plotMin=a?this.usedDataMin:this.tickMinIndex*this.tickDataSpacingNN,this.plotMax=b?this.usedDataMax:this.tickMaxIndex*this.tickDataSpacingNN,this.plotRange=this.plotMax-this.plotMin}function v(){var a,b,c,d,e,f=this.plotMin,g=this.plotMax,h=this.tickMinIndex,i=this.tickMaxIndex,j=this.tickDataSpacingNN,k=this.tickMaxIndex-this.tickMinIndex,l=null!==this.explicitPlotMin,m=null!==this.explicitPlotMax,n=!0,o=2*this.fontHeight,p=k;if(d=this.mainTickValues?this.mainTickValues.length:0,b=this.mainTickValues[0],c=this.mainTickValues[d-1],null===this.explicitPlotMin&&b>this.dataMin&&p++,null===this.explicitPlotMax&&c<this.dataMax&&p++,p!==k){for(e=0;n&&10>e;)this.tickDataSpacingNN=y.getSmallNiceNumber(.99*this.tickDataSpacingNN),u.apply(this,[l,m]),a=this.tickMaxIndex-this.tickMinIndex,a>p&&(n=!1),e++;for(n=!0,e=0;this.tickDataSpacingNN<j&&n&&10>e;)this.tickDataSpacingNN=y.getGoodNumber(1.1*this.tickDataSpacingNN),u.apply(this,[l,m]),a=this.tickMaxIndex-this.tickMinIndex,a===p&&this.plotSize*this.tickDataSpacingNN/this.plotRange>o&&(n=!1),e++;n?(this.plotMin=f,this.plotMax=g,this.tickMinIndex=h,this.tickMaxIndex=i,this.tickDataSpacingNN=j):r.call(this)}}function w(){var a,b,c;c=this.mainTickValues?this.mainTickValues.length:0,a=this.mainTickValues[0],b=this.mainTickValues[c-1],null===this.explicitPlotMin&&a>this.dataMin&&null===this.explicitPlotMax&&b<this.dataMax?Math.abs(this.dataMin)<=Math.abs(this.dataMax)?(s.call(this),t.call(this)):(t.call(this),s.call(this)):null===this.explicitPlotMin&&a>this.dataMin?s.call(this):null===this.explicitPlotMax&&b<this.dataMax&&t.call(this)}function x(){return{plotMin:this.plotMin,plotMax:this.plotMax,tickSpacing:this.tickDataSpacingNN,tickBaseValue:this.tickBaseValue,tickMinIndex:this.tickMinIndex,tickMaxIndex:this.tickMaxIndex,minTickValue:this.minTickValue,maxTickValue:this.maxTickValue,mainTickValues:this.mainTickValues,secondaryTickValues:this.secondaryTickValues}}var y,z=Math.log(10),A=1e-12;return y={log:function(a,b){return 0>=a||0>=b?NaN:Math.log(a)/Math.log(b)},log10:function(a){return 0>=a?NaN:Math.log(a)/z},eliminateFloatingError:function(a){var b=Math.round(a);return Math.abs(a-b)<A&&(a=b),a},getNiceNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),d=1>=c?1:2>=c?2:5>=c?5:10,d*Math.pow(10,b)*(0>a?-1:1))},getSmallNiceNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),1>c?(d=5,b--):d=2>c?1:5>c?2:5,d*Math.pow(10,b)*(0>a?-1:1))},getMagnitude:function(a){var b;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),Math.pow(10,b))},getFraction:function(a){var b;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),a/Math.pow(10,b))},getGoodNumber:function(a){var b,c,d;return 0===a?0:(b=Math.floor(Math.log(Math.abs(a))/z),c=a/Math.pow(10,b),d=Math.ceil(c),(7===d||9===d)&&d++,c>1&&1.5>=c?d=1.5:c>2&&2.5>=c&&(d=2.5),d*Math.pow(10,b)*(0>a?-1:1))},calculateTicks:function(a,b,d,e,f,g,h,j,q,s,t){var u,y=!1;return void 0===t&&(t=!1),isNaN(e)&&(e=null),isNaN(f)&&(f=null),b>d&&(u=b,b=d,d=u),null!==e&&null!==f&&e>f&&(u=e,e=f,f=u),this.plotSize=a,this.dataMin=b,this.dataMax=d,this.explicitPlotMin=e,this.explicitPlotMax=f,this.minTickSpacingInPixel=g,this.usedDataMin=null===this.explicitPlotMin?this.dataMin:this.explicitPlotMin,this.usedDataMax=null===this.explicitPlotMax?this.dataMax:this.explicitPlotMax,this.absMax=Math.max(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.absMin=Math.min(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=this.plotSize/this.minTickSpacingInPixel,this.maxNumTicks=this.maxNumIntervals+1,this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,this.fontHeight=h,this.niceNumberEnabled=j,this.tickBaseValue=0,this.spaceUseLimit=void 0===s?.6:s,this.spaceOptimizingEnabled=q,this.plotMaxCanBeTuned=null===this.explicitPlotMax&&this.usedDataMax>0,this.plotMinCanBeTuned=null===this.explicitPlotMin&&this.usedDataMin<0,j&&0!==a?(null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin||null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax?(y=!0,c.call(this)):0===this.usedDataRange?i.call(this):this.maxNumIntervals<1?m.call(this):(this.usedDataMax>0&&this.usedDataMin<0?1===this.maxNumIntervals?l.call(this,!0):this.maxNumIntervals>=5?k.call(this):this.maxNumIntervals<2?n.call(this):o.call(this):k.call(this),this.tickMaxIndex<this.tickMinIndex?(this.tickDataSpacing=this.usedDataRange/this.maxNumIntervals,m.call(this)):p.call(this)),r.call(this),t&&this.maxNumIntervals>=1&&!y&&(v.call(this),w.call(this)),x.call(this)):(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.tickDataSpacingNN=this.tickDataSpacing,r.call(this),x.call(this))}}}),define("objects.views/charts/components/axis/linear-scale",["core.utils/class","../../utils/axis-utils"],function(a,b){"use strict";var c=a.extend("LinearScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(a){this._plotSize=a},getPositionOfValue:function(a){return(a-this.plotMin)/this.plotRange*this._plotSize},getValueOfPosition:function(a){return this.plotMin+this.plotRange*a/this._plotSize},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin},calculateTicks:function(){var a,c,d,e,f;d=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,c=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,a=b.calculateTicks(this._calculationSize,d,c,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled,.6,this._showExplicitMinMax),this._tickSpacing=a.tickSpacing,this.plotMin=a.plotMin,this.plotMax=a.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=a.tickMinValue,this.tickMax=a.tickMaxValue,this.mainValues=a.mainTickValues,this.secondaryValues=a.secondaryTickValues,0===this.mainValues.length&&this.mainValues.push(a.minTickValue),0===this._tickSpacing&&(this._tickSpacing=1),this._showExplicitMinMax&&(f=this.mainValues[0],this.mainValues[0]=a.plotMin,f-a.plotMin>=a.tickSpacing/2&&this.mainValues.splice(1,0,f),e=a.mainTickValues[a.mainTickValues.length-1],a.plotMax-e<=a.tickSpacing/2?this.mainValues[a.mainTickValues.length-1]=a.plotMax:this.mainValues.push(a.plotMax))},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}});return c}),define("objects.views/charts/utils/axis-log-utils",["objects.views/charts/utils/axis-utils"],function(a){"use strict";function b(a,b,c){var d,e=a?a.length:0,f=void 0===b?Number.MAX_VALUE:a[0]/b;for(d=1;e>d;d++)f=Math.min(f,a[d]/a[d-1]);void 0!==c&&(f=Math.min(f,c/a[e-1])),a.splice(0,0,f)}function c(a,c,d){var e,f=a?a.length:0;for(e=0;f>e;e++)b(a[e],c,d)}function d(){var a,b;for(c(E,1,10),a=0;a<F.length;a++)if(F[a])for(b=0;b<F[a].length;b++)F[a][b]instanceof Array&&c(F[a][b])}function e(){var a,b,c,d,e,f,g,h=!0,i=0;for(a=this.tickDataSpacingLog,g=0;h&&5>i;)a=0===i?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*a),b=this.minIsStrict?Math.ceil(this.usedDataMinLog/a):Math.floor(this.usedDataMinLog/a),c=this.maxIsStrict?Math.floor(this.usedDataMaxLog/a):Math.ceil(this.usedDataMaxLog/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a,f=e-d,h=a/f*this.plotSize<this.minTickSpacingInPixel,i++;return h&&(a=Math.ceil(this.tickDataSpacingLog),b=this.minIsStrict?Math.ceil(this.usedDataMinLog/a):Math.floor(this.usedDataMinLog/a),c=this.maxIsStrict?Math.floor(this.usedDataMaxLog/a):Math.ceil(this.usedDataMaxLog/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a),{plotMinLog:d,plotMaxLog:e,tickMinIndex:b,tickMaxIndex:c,tickDataSpacingNNLog:a,tickBaseValueLog:g,success:!h}}function f(){var a,b,c,d,e,f,g,h=!0,i=0;for(a=this.tickDataSpacingLog,b=0,g=this.usedDataMinLogFloor;h&&5>i;)a=0===i?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*a),b=this.minIsStrict?Math.ceil((this.usedDataMinLog-g)/a):Math.floor((this.usedDataMinLog-g)/a),c=this.maxIsStrict?Math.floor((this.usedDataMaxLog-g)/a):Math.ceil((this.usedDataMaxLog-g)/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a+g,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a+g,f=e-d,h=a/f*this.plotSize<this.minTickSpacingInPixel,i++;return h&&(a=0===i?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*a),b=this.minIsStrict?Math.ceil((this.usedDataMinLog-g)/a):Math.floor((this.usedDataMinLog-g)/a),c=this.maxIsStrict?Math.floor((this.usedDataMaxLog-g)/a):Math.ceil((this.usedDataMaxLog-g)/a),d=this.minIsStrict?this.explicitPlotMinLog:b*a+g,e=this.maxIsStrict?this.explicitPlotMaxLog:c*a+g),{plotMinLog:d,plotMaxLog:e,tickMinIndex:b,tickMaxIndex:c,tickDataSpacingNNLog:a,tickBaseValueLog:g,success:!h}}function g(){var a,b,c,d,g,h,i;return b=f.call(this),b.success?(c=this.usedDataMaxLog-this.usedDataMinLog,g=c/(b.plotMaxLog-b.plotMinLog),1===g?b:(a=e.call(this),a.success?(d=c/(a.plotMaxLog-a.plotMinLog),h=a.tickMaxIndex-a.tickMinIndex,i=b.tickMaxIndex-b.tickMinIndex,i>h||i===h&&g>d||i===h&&g===d&&b.plotMinLog<a.plotMinLog?b:a):b)):a=e.call(this)}function h(b,c,d,e,f){var g=a.getNiceNumber(1.1*f),h=b?Math.ceil(d/g):Math.floor(d/g),i=c?Math.floor(e/g):Math.ceil(e/g),j=b||0===h?d:h*g,k=c?e:i*g;return{plotMin:j,plotMax:k,tickSpacing:g,tickBaseValue:0}}function i(a,b){var c;for(c=0;c<a.length;c++)if(a[c]>=b)return c-1}function j(a,b){var c;for(c=a.length-1;c>=0;c--)if(a[c]<=b)return c+1}function k(a,b,c,d,e){var f,g;f=i(a,b),g=j(a,c),!d&&void 0!==a[f+1]&&a[f+1]>b&&(f-=1),!e&&g>0&&void 0!==a[g-1]&&a[g-1]<c&&(g+=1),g<a.length&&a.splice(g,a.length-g),f>=0&&a.splice(0,f+1)}function l(b,c,d,e){var f,g,h,i,j=Number.MAX_VALUE,k=-Number.MAX_VALUE,l=a.log10(d),m=a.log10(c),n=l-m;for(g=b?b.length:0,h=new Array(g),(null===e||isNaN(e))&&(e=1.71),f=0;g>f;f++)h[f]=a.log10(b[f]);for(f=1;g>f;f++)i=h[f]-h[f-1],j=Math.min(j,i),k=Math.max(k,i);return k=Math.max(k,Math.abs(h[0]-m)),k=Math.max(k,Math.abs(l-h[g-1])),j/n*this.plotSize>=this.minTickSpacingInPixel-C&&e>=k/j&&b.length-1<=this.maxNumIntervals}function m(b){var c,d,e,f,g=Number.MAX_VALUE,h=-Number.MAX_VALUE,i=b.mainTickValues;for(d=i?i.length:0,e=new Array(d),c=0;d>c;c++)e[c]=a.log10(i[c]);for(c=1;d>c;c++)f=e[c]-e[c-1],g=Math.min(g,f),h=Math.max(h,f);b.maxTickSpacing=h,b.minTickSpacing=g,b.tickSpacingRatio=h/g,b.spaceUseFactor=this.usedDataRange/(b.plotMax-b.plotMin),b.factor=b.spaceUseFactor/(b.tickSpacingRatio*b.tickSpacingRatio)}function n(b,c,d,e,f){var g,h,i,j,k;return g=(e+d)/2,void 0===f?(h=Math.round(g),h>=d&&e>=h?Math.pow(10,h):(i=Math.floor(g),i>=d&&e>=i?Math.pow(10,i):(j=Math.ceil(g),j>=d&&e>=j?Math.pow(10,j):(k=a.getSmallNiceNumber(Math.max(1,c-b)),Math.ceil(b/k)*k)))):(i=Math.pow(10,Math.floor(g)),j=Math.pow(10,Math.ceil(g)),Math.abs(i-f)<Math.abs(j-f)?i:j)}function o(a,b,c,d,e,f){var g,h,i=e?Math.ceil((a-c)/d):Math.floor((a-c)/d),j=f?Math.floor((b-c)/d):Math.ceil((b-c)/d),k=[];for(g=i;j>=g;g++)h=g*d+c,h>0&&k.push(g*d+c);return k}function p(a,b,c,d){a.mainTickValues=b,a.plotMin=c,a.plotMax=d}function q(){return this.usedDataMax>=10*this.usedDataMin?1:this.usedDataMaxLogFloor===this.usedDataMinLogFloor?this.maxIsStrict&&this.minIsStrict?2:3:1}function r(a){a.sort(function(a,b){return a-b})}function s(a,b,c,d,e,f,g){var h,i,j,m,n,o,p,q=0,s=[];for(q=0;q<a.length;q++)if(b<=a[q][0]+C){for(n=c.concat(),h=d;e>h;h++)for(i=1;i<a[q].length;i++)n.push(a[q][i]*Math.pow(10,h*f+g));r(n),k(n,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),o=this.minIsStrict?this.explicitPlotMin:n[0],p=this.maxIsStrict?this.explicitPlotMax:n[n.length-1],l.apply(this,[n,o,p])&&s.push({mainTickValues:n,plotMin:o,plotMax:p})}if(0===s.length)return n=c,k(n,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),o=this.minIsStrict?this.explicitPlotMin:n[0],p=this.maxIsStrict?this.explicitPlotMax:n[n.length-1],{mainTickValues:n,plotMin:o,plotMax:p};if(1===s.length)return s[0];for(m=c.length-1,q=0;q<s.length;q++)if(j=s[q].mainTickValues.length-1,s[q].mainTickValues[0]===c[0]&&s[q].mainTickValues[j]===c[m])return s[q];return s[0]}function t(a,b){var c,d,e,f,g,h,i=!0,j=Math.ceil(this.fractionMinLog),k=Math.floor(this.fractionMaxLog),m=0;if(a[j]&&a[j][k])for(g=a[j][k],g instanceof Array||(g=a[j][g]),h=g.length;h>m&&i;){
if(b<=g[m][0]+C&&g[m].length-2<=this.maxNumIntervals){for(d=[],c=1;c<g[m].length;c++)d.push(g[m][c]*this.dataMinMagnitude);i=!l.apply(this,[d,this.usedDataMin,this.usedDataMax])}i&&m++}return i&&(d=[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),e=this.minIsStrict?this.explicitPlotMin:d[0],f=this.maxIsStrict?this.explicitPlotMax:d[d.length-1],{mainTickValues:d,plotMin:e,plotMax:f}}function u(a,b){var c,d,e,f,g,h,i,j,m,o,q,r,s,t,u,v=this.minIsStrict?Math.ceil(this.fractionMinLog):Math.floor(this.fractionMinLog),w=this.maxIsStrict?Math.floor(this.fractionMaxLog):Math.ceil(this.fractionMaxLog),x={};if(G[v]&&G[v][w])for(i=G[v][w],j=i instanceof Array?i.length/2:0,x.mainTickValues=[],c=0;j>c;c++)if(m=i[2*c],o=i[2*c+1],a[m]&&a[m][o])for(q=a[m][o],r=q.length,d=0;r>d;d++)if(s=b<=q[d][0]+C&&q[d].length-2<=this.maxNumIntervals,t=q[d][1]*this.dataMinMagnitude,u=q[d][q[d].length-1]*this.dataMinMagnitude,s=this.minIsStrict?s&&t>=this.usedDataMin:s&&t<=this.usedDataMin,s=this.maxIsStrict?s&&u<=this.usedDataMax:s&&u>=this.usedDataMax){for(f=[],e=1;e<q[d].length;e++)f.push(q[d][e]*this.dataMinMagnitude);if(k(f,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),g=this.minIsStrict?this.explicitPlotMin:f[0],h=this.maxIsStrict?this.explicitPlotMax:f[f.length-1],l.apply(this,[f,g,h])){x.mainTickValues.length<f.length&&p(x,f,g,h);break}}return x.mainTickValues&&0!==x.mainTickValues.length||(x.mainTickValues=[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),f=x.mainTickValues,x.plotMin=this.minIsStrict?this.explicitPlotMin:f[0],x.plotMax=this.maxIsStrict?this.explicitPlotMax:f[f.length-1],x}function v(a,b,c){var d,e=a.length;if(c){for(d=e-1;d>=0;d--)if(Math.abs(a[d]-b[d]*this.dataMinMagnitude)>C)return!1;return!0}for(d=0;e>d;d++)if(Math.abs(a[d]-b[d]*this.dataMinMagnitude)>C)return!1;return!0}function w(a){var b,c,d=a.mainTickValues,e=d.length;if(!(2>e||e>4))return c=5*this.dataMinMagnitude,(this.minIsStrict&&this.usedDataMin<=c||!this.minIsStrict&&this.usedDataMin>=c)&&(v.apply(this,[d,[6,10,20,40]])||v.apply(this,[d,[4,10,20,40]]))?(b=d[0],d[0]=c,a.plotMin=this.minIsStrict?this.explicitPlotMin:d[0],void(l.apply(this,[d,a.plotMin,a.plotMax])||(d[0]=b,a.plotMin=this.minIsStrict?this.explicitPlotMin:d[0]))):(c=80*this.dataMinMagnitude,(this.maxIsStrict&&this.usedDataMax>=c||!this.maxIsStrict&&this.usedDataMax<=c)&&v.apply(this,[d,[10,20,40,60],!0])?(b=d[e-1],d[e-1]=c,a.plotMax=this.maxIsStrict?this.explicitPlotMax:d[e-1],void(l.apply(this,[d,a.plotMin,a.plotMax])||(d[e-1]=b,a.plotMax=this.maxIsStrict?this.explicitPlotMax:d[e-1]))):void 0)}function x(b,c,d,e,f,g,i,j,k,m){var n,p,q,r,s=a.calculateTicks(b,c,d,e,f,g,i,j,k,m),t=null!==e,u=null!==f,v=t?e:c,w=u?f:d,x=1;for(0===s.plotMin&&(s.plotMin=t?e:c),n=s.mainTickValues,p=t?e:Math.min(c,n[0]),q=u?f:Math.max(n[n.length-1],d);!l.apply(this,[n,p,q])&&20>=x;)s=h(t||s.tickSpacing>v,u,v,w,s.tickSpacing),n=o(v,w,s.tickBaseValue,s.tickSpacing,t,u),p=t?e:Math.min(c,n[0]),q=u?f:Math.max(n[n.length-1],d),x++;return l.apply(this,[n,p,q])?(r=a.getFraction(n[0])/2,2===n.length&&n[1]/n[0]===2&&n[0]/2>=p&&r===Math.floor(r)&&(n.splice(0,0,n[0]/2),r=a.getFraction(n[0])/2,n[0]/2>=p&&r===Math.floor(r)&&n.splice(0,0,n[0]/2))):n=[],s.mainTickValues=n,s.numLoops=x,s}function y(){var a,b,c,d,e,f,h,i,j,m,o,r,v,x,y,z={};if(this.maxIsStrict&&this.explicitPlotMax<=this.usedDataMin?(this.dataMinLog=Math.ceil(this.explicitPlotMaxLog-(this.maxNumIntervals<2?1:2)),this.dataMin=Math.pow(10,this.dataMinLog)):this.minIsStrict&&this.explicitPlotMin>=this.usedDataMax?(this.dataMaxLog=Math.floor(this.explicitPlotMinLog+(this.maxNumIntervals<2?1:2)),this.dataMax=Math.pow(10,this.dataMaxLog)):this.usedDataMin===this.usedDataMax&&(c=this.usedDataMin,this.dataMinLog=Math.floor(this.dataMinLog),this.dataMaxLog=this.dataMinLog+1,this.dataMin=Math.pow(10,this.dataMinLog),this.dataMax=Math.pow(10,this.dataMaxLog)),this.usedDataMin=this.minIsStrict?this.explicitPlotMin:this.dataMin,this.usedDataMax=this.maxIsStrict?this.explicitPlotMax:this.dataMax,this.usedDataMinLog=this.minIsStrict?this.explicitPlotMinLog:this.dataMinLog,this.usedDataMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:this.dataMaxLog,this.maxNumIntervals<1)return p(z,[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog,c)],this.usedDataMin,this.usedDataMax),z;if(this.tickDataSpacingLog=(this.usedDataMaxLog-this.usedDataMinLog)/this.maxNumIntervals,this.usedDataMinLogFloor=Math.floor(this.usedDataMinLog),this.usedDataMaxLogFloor=Math.floor(this.usedDataMaxLog),this.dataMinMagnitude=Math.pow(10,this.usedDataMinLogFloor),this.fractionMinLog=this.usedDataMin/this.dataMinMagnitude,this.fractionMaxLog=this.usedDataMax/this.dataMinMagnitude,a=Math.ceil(this.usedDataMaxLog),this.usedDataMinLog===this.usedDataMinLogFloor&&this.usedDataMaxLog===a&&this.maxNumIntervals>=2&&this.maxNumIntervals<3&&this.tickDataSpacingLog>1&&this.tickDataSpacingLog-Math.floor(this.tickDataSpacingLog)<D&&(b=Math.floor((this.usedDataMinLogFloor+a)/2),v=[Math.pow(10,this.usedDataMinLogFloor),3*Math.pow(10,b),Math.pow(10,a)],k(v,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),x=this.minIsStrict?this.explicitPlotMin:v[0],y=this.maxIsStrict?this.explicitPlotMax:v[v.length-1],v.length>=2&&l.apply(this,[v,x,y])))return p(z,v,x,y),z;if(h=g.call(this),!h.success)return p(z,[n(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)],this.usedDataMin,this.usedDataMax),z;for(i=h.tickMinIndex,j=h.tickMaxIndex,e=h.tickDataSpacingNNLog,f=h.tickBaseValueLog,this.minIsStrict&&i--,this.maxIsStrict&&j++,o=[],m=i;j>=m;m++)o.push(Math.pow(10,m*e+f));return d=Math.pow(10,this.tickDataSpacingLog),r=q.call(this),2===r?t.apply(this,[F,d]):3===r?u.apply(this,[F,d]):(z=s.apply(this,[E,d,o,i,j,e,f]),w.call(this,z),z)}function z(){var a,b,c,d,e={};for(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,b=Math.floor(this.maxNumIntervals),c=(this.dataMaxLog-this.dataMinLog)/b,d=[this.usedDataMin],a=0;b>a;a++)d.push(Math.pow(10,this.dataMinLog+(a+1)*c));return p(e,d,this.plotMin,this.plotMax),e}var A,B=Math.log(10),C=1e-12,D=Math.log(3)/B,E=[[2,4,6],[2,4],[3]],F=[,[,,[[1,2]],[[1,2,3],[1,3]],[[1,2,4],[1,4]],[[1,2,4],[1,5]],[[1,2,4,6],[2,4,6],[1,3,6],[1,6]],[[1,2,4,6],[2,4,6],[1,3,6],[1,7]],[[1,2,4,8],[2,4,8],[1,8]],[[1,2,4,8],[2,4,8],[1,3,9],[1,9]],[[1,2,4,6,10],[1,2,4,10],[1,3,10],[3,10],[1,10]]],[,,,[[2,3]],[[2,3,4],[2,4]],[[2,3,4],[2,4],[2,5]],[[2,4,6],[2,6]],[[2,4,6],[2,6],[2,7]],[[2,4,8],[2,8]],[[2,4,8],[2,8],[2,9]],[[2,4,6,10],[2,4,10],[5,10],[3,10]]],[,,,,[[3,4]],[[3,4,5],[3,5]],[[3,4,5,6],[3,6]],[[3,4,5,6],[3,5,7],[3,7]],[[3,4,5,6,8],[3,5,7],[4,8],[3,8]],[[3,4,5,6,8],[3,4,6,9],[3,4,6,8],[3,6,9],[4,8],[3,9]],[[4,6,10],[5,10],[3,10]]],[,,,,,[[4,5]],[[4,5,6],[4,6]],[[4,5,6,7],[4,5,6],[4,6]],[[4,5,6,7,8],[4,5,6,7],[4,6,8],[4,8]],[[4,5,6,7,8],[4,6,9],[4,6,8],[4,8]],[[4,6,10],[5,7,9],[5,10],[4,10]]],[,,,,,,[[5,6]],[[5,6,7],[5,7]],[[5,6,7,8],[5,6,7],[6,8]],[[5,6,7,8,9],[5,6,7,8],[5,7,9],[5,9]],[[6,8,10],[5,10]]],[,,,,,,,[[6,7]],[[6,7,8],[6,8]],[[6,7,8,9],[6,7,8],[6,9]],[[6,7,8,9,10],[6,8,10],[6,10]]],[,,,,,,,,[[7,8]],[[7,8,9],[7,9]],[[7,8,9,10],[8,10],[7,10],[7,9]]],[,,,,,,,,,[[8,9]],[[8,9,10],[8,10]]],[,,,,,,,,,,[[9,10]]]],G=[,[,,[1,2],[1,3],[1,4],[1,5,1,6],[1,6],[1,10,1,8,1,7],[1,8,1,10],[1,10,1,9]],[,,,[2,3],[2,4],[2,6,2,5],[2,6,2,8],[2,8,2,7],[2,8,1,10],[1,10,2,10,2,9],[1,10,2,10]],[,,,,[3,4,2,4],[3,6,3,5],[3,6,2,6],[2,8,3,8,3,7],[2,8,3,8,3,9],[2,10,3,10,3,9]],[,,,,,[4,5,4,6,3,5],[4,6],[4,8,4,7],[4,8],[4,10,4,9,3,9],[4,10]],[,,,,,[5,6,4,6],[5,7,4,8],[4,8,5,8,5,10],[5,10,4,10,5,9],[5,10,4,10]],[,,,,,,[6,7,6,8],[6,8],[6,10,5,10,6,9],[6,10,5,10]],[,,,,,,,[7,8,6,8],[7,9,6,10],[6,10,7,10]],[,,,,,,,,[8,10,8,9],[8,10]],[,,,,,,,,,[9,10]]];return d(),A={calculateTicksLogPositive:function(b,c,d,e,f,g,h,i,j){var k,l,n,o={};return isNaN(e)&&(e=null),isNaN(f)&&(f=null),c>d&&(k=c,c=d,d=k),null!==e&&null!==f&&e>f&&(k=e,e=f,f=k),this.plotSize=b,this.dataMin=c,this.dataMax=d,this.explicitPlotMin=e,this.explicitPlotMax=f,this.minTickSpacingInPixel=g,this.minIsStrict=null!==e,this.maxIsStrict=null!==f,this.usedDataMin=this.minIsStrict?e:c,this.usedDataMax=this.maxIsStrict?f:d,this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=b/g,this.maxNumTicks=this.maxNumIntervals+1,this.explicitPlotMinLog=this.minIsStrict?a.eliminateFloatingError(a.log10(e)):null,this.explicitPlotMaxLog=this.maxIsStrict?a.eliminateFloatingError(a.log10(f)):null,this.dataMinLog=a.eliminateFloatingError(a.log10(c)),this.dataMaxLog=a.eliminateFloatingError(a.log10(d)),i&&0!==b?this.minIsStrict&&this.maxIsStrict&&this.explicitPlotMin===this.explicitPlotMax?(p(o,[this.explicitPlotMin],this.explicitPlotMin,this.explicitPlotMax),o):(n=y.call(this),this.usedDataMax>=10*this.usedDataMin?n:(l=x.apply(this,[b,c,d,e,f,g,h,i,j]),l.mainTickValues.length<2?n:n.mainTickValues.length<2?l:l.mainTickValues.length===n.mainTickValues.length?(m.call(this,l),m.call(this,n),l.factor>n.factor?l:n):l.mainTickValues.length-1>=1.5*(n.mainTickValues.length-1)&&l.mainTickValues.length>n.mainTickValues.length?l:n)):z.call(this)},calculateTicks:function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p;if(isNaN(d)&&(d=null),isNaN(e)&&(e=null),b>c&&(j=b,b=c,c=j),null!==d&&null!==e&&d>e&&(j=d,d=e,e=j),0>=b*c&&(b=null===d?b:d,c=null===e?c:e),b>0&&c>0&&(null===d||d>0)&&(null===e||e>0))return k=A.calculateTicksLogPositive(a,b,c,d,e,f,g,h,i),k.sign=1,k;if(0>b&&0>c&&(null===d||0>d)&&(null===e||0>e)){for(l=A.calculateTicksLogPositive(a,-c,-b,null===e?null:-e,null===d?null:-d,f,g,h,i),k={},k.plotMin=-l.plotMax,k.plotMax=-l.plotMin,n=l.mainTickValues,o=n?n.length:0,m=new Array(o),p=0;o>p;p++)m[p]=-n[o-1-p];return k.mainTickValues=m,k.sign=-1,k}return{plotMin:null===d?b:d,plotMax:null===e?c:e,mainTickValues:[]}}}}),define("objects.views/charts/components/axis/log-scale",["core.utils/class","../../utils/axis-utils","../../utils/axis-log-utils"],function(a,b,c){var d=a.extend("LogScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(a){this._plotSize=a},getPositionOfValue:function(a){var c;return 0===a?this._usedDataMin>0?0:this._plotSize:(c=a>0?b.log10(a):-b.log10(-a),(c-this._plotMinLog10)/this._plotRangeLog10*this._plotSize)},getValueOfPosition:function(a){var b;return 0===a?0:(b=this._plotMinLog10+this._plotRangeLog10*a/this._plotSize,this._usedDataMin>0?Math.pow(10,b):-Math.pow(10,-b))},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin,this._plotMinLog10=b.log10(Math.abs(this.plotMin))*(this.plotMin<0?-1:1),this._plotMaxLog10=b.log10(Math.abs(this.plotMax))*(this.plotMax<0?-1:1),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10},calculateTicks:function(){var a;a=c.calculateTicks(this._calculationSize,this._usedDataMin,this._usedDataMax,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled),this.plotMin=a.plotMin,this.plotMax=a.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=a.tickMin,this.tickMax=a.tickMax,this.mainValues=a.mainTickValues,this.secondaryValues=[],this._dataSign=a.sign,this._tickSpacing=this.mainValues.length>1?this.mainValues[1]-this.mainValues[0]:this.plotMax-this.plotMin,this._plotMinLog10=this._dataSign*b.log10(Math.abs(this.plotMin)),this._plotMaxLog10=this._dataSign*b.log10(Math.abs(this.plotMax)),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10,0===this.mainValues.length&&this.mainValues.push(a.minTickValue),0===this._tickSpacing&&(this._tickSpacing=1)},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}});return d}),define("objects.views/charts/utils/tween",["core.utils/class","objects.utils/animation-frame"],function(a,b){"use strict";function c(){i.tick()&&(j=b.request(c))}function d(a){k.push(a),a._isRunning=!0,null===j&&(j=b.request(c))}function e(a,b){for(var c in a)this._props[c]||(this._props[c]={}),this._props[c][b]=Array.isArray(a[c])?a[c].slice():a[c]}function f(){var a,b,c,d;for(a in this._props)if(d=this._props[a],b="from"in d?d.from:this._target[a],c=d.to,d.from=b,Array.isArray(b)){var e=b.map(function(a){return a.value}),f=c.map(function(a){return a.value});d.fresh=c.filter(function(a){return e.indexOf(a.value)<0}),d.rotten=b.filter(function(a){return f.indexOf(a.value)<0}),d.ripe=c.filter(function(a){return e.indexOf(a.value)>=0}),d.combined=d.rotten.concat(d.ripe).concat(d.fresh),d.isArray=!0}else isNaN(b)||isNaN(d.to)||(d.change=d.to-b)}function g(a){var b;for(b in a)if(a[b].isArray){if(a[b].fresh.length||a[b].rotten.length)return!0}else if(a[b].change)return!0;return!1}function h(a,b,c){var d,e,f,g,h,i,j;for(e in a){if(f=a[e],g=f.to,h=f.from,f.isArray){for(i=f.fresh,j=f.rotten,f.value=c?f.to:f.combined,d=0;d<i.length;d++)i[d].opacity=b;for(d=0;d<j.length;d++)j[d].opacity=1-b;c&&(delete f.combined,delete f.fresh,delete f.rotten,delete f.ripe)}else!c&&"change"in f?f.value=h+f.change*b:f.value=g;c&&delete a[e].from}}var i,j=null,k=[],l=!0,m=Math.PI,n=Math.cos;i=a.extend("Tween",{init:function(a,b,c,e){var h,j,k,l={},m=!0;this._target=a,this._enabled=!0;for(h in b)j=Array.isArray(a[h])?a[h].slice():a[h],k=Array.isArray(b[h])?b[h].slice():b[h],l[h]={from:j,to:k};this._props=l,f.call(this),"object"==typeof c?(this._duration=c.duration||200,this._easing="function"==typeof c.easing?c.easing:i.easing[c.easing||"linear"],m=c.autoStart!==!1):(this._duration=c||200,this._easing="function"==typeof e?e:i.easing[e||"linear"]),this._dfd=new o,this._pos=0,this._isRunning=!1,m&&(g(this._props)?(this._startTime=Date.now(),d(this)):this._step(!0))},from:function(a){return this._isRunning||e.call(this,a,"from"),this},to:function(a){return this._isRunning||e.call(this,a,"to"),this},start:function(){return!this._isRunning&&this._enabled&&l&&(f.call(this),g(this._props)?this._start():this._dfd.resolve()),this},willStart:function(){return!this._isRunning&&this._enabled&&l&&(f.call(this),g(this._props))?!0:!1},stop:function(){return this._isRunning&&(this._isRunning=!1,k.splice(k.indexOf(this),1)),this},end:function(){return this._isRunning&&this._step(!0),this},then:function(){return this._dfd.then.apply(this._dfd,[].slice.call(arguments)),this},progress:function(){return this._dfd.progress.apply(this._dfd,[].slice.call(arguments)),this},isRunning:function(){return this._isRunning},on:function(){this._enabled=!0},off:function(){this._enabled=!1},destroy:function(){this.stop(),this._dfd.destroy()},_update:function(){var a;for(a in this._props)this._target[a]=this._props[a].value},_step:function(a){var b,c=Date.now()-this._startTime;return c>=this._duration||a?(this._pos=1,this._isRunning=!1,b=k.indexOf(this),b>=0&&k.splice(b,1),h(this._props,this._pos,!0),this._update(),this._dfd.notify(c,c/this._duration,this._pos),void this._dfd.resolve()):(this._pos=this._easing(c/this._duration),h(this._props,this._pos,!1),this._update(),void this._dfd.notify(c,c/this._duration,this._pos))},_start:function(){this._startTime=Date.now(),d(this),this._step()}}),i.off=function(){l=!1},i.on=function(){l=!0},i.tick=function(){var a,c,d=k.slice(),e=d.length;for(a=0;e>a;a++)c=d[a],c._step();return k.length?!0:(b.cancel(j),j=null,!1)},i.clear=function(){},i.easing={linear:function(a){return a},easeInOut:function(a){return.5*(1-n(a*m))}},i.tweens=k;var o=function(){this._onSuccess=[],this._onProgress=[],this._isResolved=!1};return o.prototype={then:function(a){this._onSuccess.push(a),this._isResolved&&a.call(null,[].slice.apply(arguments))},progress:function(a){this._onProgress.push(a)},resolve:function(){this._isResolved=!0;var a,b=this._onSuccess.length;for(a=0;b>a;a++)this._onSuccess[a].apply(null,[].slice.call(arguments))},notify:function(){var a,b=this._onProgress.length;for(a=0;b>a;a++)this._onProgress[a].apply(null,[].slice.call(arguments))},destroy:function(){this._onSuccess=[],this._onProgress=[]}},i}),define("objects.views/charts/components/axis/continuous-axis",["./axis","./linear-scale","./log-scale","objects.views/charts/components/axis/radial-axis-helper","util","objects.views/charts/utils/tween","objects.utils/shapes/rect","objects.utils/shapes/polygon"],function(a,b,c,d,e,f){"use strict";function g(a){var b,c,d=[],e=a?a.length:0;for(b=0;e>b;b++)c=a[b],d.push({position:0,value:c,opacity:1});return d}function h(a){var b,c=a?a.length:0,d=[],e=[],f=[],g=[],h=[];if(a.forEach(function(a){f.push(a.position),e.push(a.value),g.push("opacity"in a?a.opacity:1),d.push(a.formatted||a.value+"")},this),1>=c)h=[this._plotSize];else{for(h[0]=Math.abs(a[1].position-a[0].position)/2+a[0].position,b=1;b<a.length-1;b++)h.push(Math.abs(a[b].position-a[b-1].position)/2+Math.abs(a[b+1].position-a[b].position)/2);h[b]=Math.abs(a[b].position-a[b-1].position)/2+(this._padding.left+this._plotSize-a[b].position)}return{values:e,widths:h,positions:f,opacities:g,labels:d,labelMode:k,labelSpace:this._wantedLabelSpace}}function i(a,b){var c,d,e=0,f=a[this._isVertical?"height":"width"],g=0,h=this._style;if(f-=this._isVertical?this._padding.top+this._padding.bottom:this._padding.left+this._padding.right,this.isRadial())e=2*Math.sin(this._relevantAngle/4)*this._fontHeight*h.label.lineHeight;else if(this._isVertical){if(this._calculateScale(f),c=this._formatter,d=this._renderer,c){var i=this._scale.getValues().mainValues.map(function(a){return d.getTextWidth(c.formatValue(a)+"ml",h.label.font)});g=Math.max.apply(null,i.length?i:[0])}e=Math.min(b[this._isVertical?"width":"height"]/3,g<this.outerRect.width/2?g:this.outerRect.width/3)}else e=this._fontHeight*h.label.lineHeight;return this._wantedLabelSpace=e,e}var j,k=1,l={onProgress:function(){this._updateTickPositions(),this.invalidateDisplay(),this.fire("changed")},on:function(){this._tickTween.on(),this._linearTween.on()},off:function(){this._tickTween.off(),this._linearTween.off()},to:function(){this._linearTween.stop().to({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().to({ticks:this.ticks})},from:function(){this._linearTween.stop().from({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().from({ticks:this.ticks})},start:function(){this._scale===this._linearScale&&this._linearTween.willStart()&&(this._tickTween.start(),this._linearTween.start())},end:function(){this._scale===this._linearScale&&(this._tickTween.end(),this._linearTween.end())},stop:function(){this._tickTween.stop(),this._linearTween.stop()}};return j=a.extend("ContinuousAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._scaleDetails={showExplicitMinMax:!0,niceNumberEnabled:!0,tickMultiplier:1},this.ticks=[],this.minorTicks=[],this._defaultFormatter={formatValue:function(a){return String(a)},format:function(a){return String(a)}},this._formatter=this._defaultFormatter,this._useLogScaleIfPossible=!1,this._linearScale=new b,this._logarithmicScale=new c,this._scale=this._linearScale,this._cacheItems=null,this._useTransition=!1;var a={autoStart:!1,duration:500,easing:"easeInOut"};this._linearTween=new f(this._linearScale,{},a).progress(l.onProgress.bind(this)),this._tickTween=new f(this,{},a)},setSelectableShapes:function(a){this._cacheItems=a},updateSize:function(){this._super(),this._calculationSize=this._plotSize,this._updateScaleAndTicks(),this._scale.setSize(this._plotSize),this._updateTickPositions(),l.to.call(this),this._changed?(this._changed=!1,l.start.call(this)):l.end.call(this)},calculateValuePositionMappingInfo:function(){this._scale.setSize(this._plotSize),this._scale._calculationSize=this._plotSize,this._scale.calculateLimits()},setUseTransition:function(a){this._super(),l[a?"on":"off"].call(this)},preRelevantSizeCalculation:function(){this._super(),this._areLabelsVisible=this.isVisible(this._layoutMode)&&this._showLabels},calculatePreliminaryLabelSpace:function(a){var b=0;return this._areLabelsVisible&&(b=i.call(this,a,a)),{relevantLabelSize:b||0,relevantSpacing:0}},calculateLabelSpace:function(a,b,c){var d=0;return this._calculateScale(this._calculationSize),this._areLabelsVisible&&(d=i.call(this,c||a,a)),{relevantLabelSize:d||0,relevantSpacing:0}},_updateTickPositions:function(){for(var a=0;a<this.ticks.length;a++)this.ticks[a].position=Math.floor(this.getPositionOfValue(this.ticks[a].value))-.5;for(a=0;a<this.minorTicks.length;a++)this.minorTicks[a].position=Math.floor(this.getPositionOfValue(this.minorTicks[a].value))-.5;this._areLabelsVisible&&(this._levels=[h.call(this,this.ticks)])},_generateLevels:function(){this._updateTickFormatting(this.ticks,this._formatter),this._levels=[h.call(this,this.ticks)]},_calculateScale:function(a){if(0!==a){var b=this._scaleDetails,c=isNaN(b.realDataMin)?b.dataMin:b.realDataMin,d=isNaN(b.realDataMax)?b.dataMax:b.realDataMax,e=isNaN(b.explicitPlotMin)||null===b.explicitPlotMin?c:b.explicitPlotMin,f=isNaN(b.explicitPlotMax)||null===b.explicitPlotMax?d:b.explicitPlotMax,g=this.isRadial()?96:Math.max(96,this._getApproximateLabelWidth(e,f)),h=this.isVertical()?4*this._fontHeight:g,i=Math.max(2,a/h/b.tickMultiplier+1);h=a/(i-1),this._scale=this._linearScale,this._useLogScaleIfPossible&&e*f>0&&(this._scale=this._logarithmicScale),b.usedDataMin=c,b.usedDataMax=d,b.defaultLabelWidth=g,b.minTickSpacingInPixel=h,b.numTicks=i,b.plotSize=this._plotSize,b.calculationSize="undefined"!=typeof a?a:this._calculationSize,b.fontHeight=this._fontHeight,Object.keys(b).forEach(function(a){this._scale["_"+a]=b[a]},this),this._scale.calculateTicks()}},_getLabelWidthFromValues:function(a){var b=this._formatter,c=this._renderer,d=this._style.label.font;return b?Math.max.apply(null,a.map(function(a){return c.getTextWidth(b.formatValue(a)+"ml",d)})):0},_getApproximateLabelWidth:function(a,b){var c=this._formatter,d=this._renderer,e=this._style.label.font;return c?Math.max.apply(null,[a,b,(b-a)/2].map(function(a){return d.getTextWidth(c.formatValue(a),e)})):0},_generateTickObjects:function(a,b){var c=a.getValues();this.ticks=g.call(this,c.mainValues,this._padding,b),this.minorTicks=g.call(this,c.secondaryValues,this._padding,b)},_updateTickFormatting:function(a,b){var c,d=a?a.length:0;for(c=0;d>c;c++)a[c].formatted=b.formatValue(a[c].value)},setPlotMin:function(a){this._scaleDetails.explicitPlotMin="number"==typeof a?a:null,this.invalidateProperties("setPlotMin")},getPlotMin:function(){return this._scale.plotMin},setPlotMax:function(a){this._scaleDetails.explicitPlotMax="number"==typeof a?a:null,this.invalidateProperties("setPlotMax")},getPlotMax:function(){return this._scale.plotMax},setTickMultiplier:function(a){this._scaleDetails.tickMultiplier=a||1,this.invalidateProperties("setTickMultiplier")},setSpacingMode:function(a){this._scaleDetails.spacingMode=a,this.invalidateProperties("setSpacingMode")},getSpacingMode:function(){return this._scaleDetails.spacingMode},setShowExplicitMinMax:function(a){this._scaleDetails.showExplicitMinMax=a,this.invalidateProperties("setShowExplicitMinMax")},setLogScale:function(a){this._useLogScaleIfPossible=a,this.invalidateProperties("setLogScale")},getLogScale:function(){return this._scale===this._logarithmicScale},numberFormat:function(a,b){return this._discrete?a:e.numberFormat(a,b?b:this._precision,this._exponentUsed)},format:function(a){return this._discrete||!this._formatter?a+"":this._formatter.format(a,this._formatPattern)},getNumberFormatPrecision:function(){return this._precision},_transition:function(){this._onAnimatitonEnd()},setDataRangeTransition:function(a){this._transitionEnabled=a},setDataRange:function(a,b){return this._scaleDetails.dataMin=a,this._scaleDetails.dataMax=b,this.invalidateDisplay("setDataRange"),this.invalidateProperties("setDataRange"),this},setRealDataRange:function(a,b){this._scaleDetails.realDataMin=a,this._scaleDetails.realDataMax=b,this.invalidateProperties("setRealDataRange")},getDataMin:function(){return this._scaleDetails.dataMin},getDataMax:function(){return this._scaleDetails.dataMax},setNiceNumberEnabled:function(a){this._scaleDetails.niceNumberEnabled!==a&&(this._scaleDetails.niceNumberEnabled=a,this.invalidateProperties("setNiceNumberEnabled"))},setWhiteSpaceOptimizingEnabled:function(a){this._scaleDetails.whiteSpaceOptimizingEnabled=a,this.invalidateProperties("setWhiteSpaceOptimizingEnabled")},getLabels:function(){return this._levels},updateFormatter:function(){var a=this.getType().indices;this._formatter=1===a.length&&this.measureFormatters.length?this.measureFormatters[a[0]]:this.combinedMeasuresFormatter||this._defaultFormatter,this._formatter.prepare&&this._formatter.prepare()},_onAnimatitonEnd:function(){this._super(),this.rect.width>0&&this.calculateLabelSpace(this.rect)},_updateProperties:function(){l.from.call(this),this._changed=this._oldIsVertical===this.isVertical()&&"number"==typeof this._scale.plotRange&&!isNaN(this._scale.plotRange),this._oldIsVertical=this.isVertical(),this.updateFormatter(),this._isSizing||this._updateScaleAndTicks()},_updateScaleAndTicks:function(){this._calculateScale(this._calculationSize,this._calculatedPlotMin,this._calculatedPlotMax),this._generateTickObjects(this._scale,this._plotSize),this._updateTickPositions(),this._areLabelsVisible&&this._generateLevels()},clear:function(){this._linearTween.end(),this._tickTween.end(),this._super()},getWidthOfValue:function(){return 1},getPositionOfValue:function(a){var b,c=this._scale.plotMin,d=this._scale.plotRange;return b=0===d?a>c?100*this._plotSize:c>a?100*-this._plotSize:this._plotSize/2:this._scale.getPositionOfValue(a),(this._isVertical&&!this._reverse||!this._isVertical&&this._reverse)&&(b=this._plotSize-b),b+this._padding[this._isVertical?"top":"left"]},getPositionOfNormalizedValue:function(a){var b=this._scale.plotMin,c=this._scale.plotMax;return this.getPositionOfValue(a*(c-b)+b)},getValueOfPosition:function(a){return this._plotSize<=0?NaN:(a-=this._padding[this._isVertical?"top":"left"],(this._isVertical&&!this._reverse||!this._isVertical&&this._reverse)&&(a=this._plotSize-a),this._scale.getValueOfPosition(a))},getAngleOfValue:function(a){return d.getAngleOfNormalizedValue((a-this._scale.plotMin)/(this._scale.plotMax-this._scale.plotMin),this)},getAngleOfNormalizedValue:function(a){return d.getAngleOfNormalizedValue(a,this)}})}),define("objects.views/selections/cache-item-combo",["./cache-item-base"],function(a){"use strict";var b=a.extend({addShape:function(a,b,c,d){this._super(a,b,c),void 0!==d&&(this._shapeMeasures||(this._shapeMeasures=[]),this._shapeMeasures.push(d))},getMeasuresIndecies:function(a){if(this._shapeMeasures&&void 0!==this._shapeMeasures[this._shapes.indexOf(a)]){var b=this._shapeMeasures[this._shapes.indexOf(a)];return void 0!==b?[b]:[]}return this._super()}});return b}),define("objects.views/charts/chart-data-helper",["objects.views/charts/utils/tree-node","objects.views/selections/cache-item-combo"],function(a,b){function c(a,b){var c=a?d(a):null;if(c){var e=c.getDimensions();if(e.length)return b.qText+","+e.join(",")}return b.qText}function d(a){return"P"===a.data.qType&&a.parent?a.parent.cacheItem:a.cacheItem}function e(b,c,d){var e,l=new a,m=[],n=[];return b&&b.length?(g=0,h=0,i=c&&c.length<2,j=c,k=d,l.data.qApprMaxGlyphCount=k[0]?k[0].qApprMaxGlyphCount:0,e=f(b[0].qSubNodes,l,m,n,0),{dimensionTree:e,cacheItems:m}):{dimensionTree:l,cacheItems:[]}}function f(e,m,n,o,p){var q,r,s,t,u,v;for(o[h]||(o[h]={}),s=0;s<e.length;s++)if("T"!==e[s].qType){if(q=new a,q.data.qType=e[s].qType,q.data.qMaxPos=e[s].qMaxPos,q.data.qMinNeg=e[s].qMinNeg,"P"===e[s].qType&&(l=e[s]),"V"===e[s].qType||"E"===e[s].qType||"P"===e[s].qType?(q.data.qText=e[s].qText,q.data.qNum=e[s].qNum,q.data.qValue=e[s].qValue,q.data.rowIndex=0,i?(r=new a,r.data.qType="_M",r.data.qMaxPos=q.data.qMaxPos,r.data.qMinNeg=q.data.qMinNeg,r.data.qText=j[0].qFallbackTitle,r.data.rowIndex=e[s].qRow,r.addChild(q),q=r):q.data.rowIndex=e[s].qRow):(q.data.qText="O"===e[s].qType&&k[p]?k[p].othersLabel||"":e[s].qText,k[p+1]&&(q.data.qApprMaxGlyphCount=k[p+1].qApprMaxGlyphCount),q.data.qElemNo=e[s].qElemNo,q.data.rowIndex=e[s].qRow),m.addChild(q),"V"!==e[s].qType&&"P"!==e[s].qType){var w=c(m,e[s]);if(o[h][w]&&l)u=o[h][w],q.cacheItem=u;else{u=new b(null,null,null,null,e[s].qRow,h),q.cacheItem=u,u.addDimension(q.data.qText),u.id=e[s].qElemNo;var x=d(m);if(x){u=q.cacheItem,u.parent=x,x.children.push(u),v=u.parent.getDimensions();for(t in v)u.addDimension(v[t])}o[h][w]=u}}"V"===e[s].qType&&(u=d(m),u&&(u.addMeasure(l?l.qText:q.data.qText,e[s].qValue,e[s].qText),n.contains(u)||n.push(u))),e[s].qSubNodes&&e[s].qSubNodes.length>0&&(h++,q=f(e[s].qSubNodes,q,n,o,p+("N"===e[s].qType||"O"===e[s].qType?1:0)))}return 0===--h&&g++,m}var g,h,i,j,k,l;return{prepareData:e}}),define("objects.views/charts/chart-context",["./events/event-launcher","objects.views/charts/utils/tree-node","objects.views/charts/chart-data-helper","objects.views/selections/cache-item-combo"],function(a,b,c,d){"use strict";function e(a,c,d,e){var f=new b;return f.text=a,f.title=c,f.id=d,f.idx=e,f}function f(a,c){var d,e=new b;e.data.qApprMaxGlyphCount=0;for(d in c)e.data[d]=c[d];return a&&a.addChild(e),e}var g;return g=a.extend({init:function(a){this._super(),this._properties={},a&&this.refresh(a)},refresh:function(a){this._data=a,this._qDataObject=a.qHyperCube?a.qHyperCube:a.qListObject;var b;if(this._qDataObject.qStackedDataPages&&this._qDataObject.qStackedDataPages.length>0)b=this._generatePivotTree();else{if(!(this._qDataObject.qDataPages&&this._qDataObject.qDataPages.length>0))return;b=this._generateDimensionTree()}this._dimensionTree=b?b.dimensionTree:null,this._cacheItems=b?b.cacheItems:null,this.fire("dimensionTreeChanged")},bindProperty:function(){throw new Error("ChartContext bindProperty: Deprecated")},unBindProperty:function(){throw new Error("ChartContext unBindProperty: Deprecated")},releaseAll:function(){throw new Error("ChartContext releaseAll: Deprecated")},release:function(){this._data=null,this._dimensionTree=null,this._cacheItems=null,this._qDataObject=null},_generateDimensionTree:function(){var a,c,g,h,i,j,k,l,m,n,o,p,q,r=e(),s=this.getDataMatrix(),t=this._qDataObject,u=t.qMeasureInfo,v=t.qDimensionInfo,w=t.qDataPages[0].qArea.qTop,x=t.qDataPages[0].qTails,y=u.length,z=v.length,A=s&&s[0]?s[0].length:0,B=[],C=[];for(k=0,j=0;z>j;j++)v[j].qError||(B[k]=j,k++);if(z=k,0===z)return null;for(n=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d].data.qText===b&&a[d].data.qNum===c)return d;return-1},j=0;j<s.length;j++){for(a=s[j],g=r,k=0;z>k;k++){if(c=a[k],!c)return;if(m=c.qIsOtherCell?void 0===g.data.othersIndex?-1:g.data.othersIndex:n(g.children,c.qText,c.qNum),-1===m){if(h=f(g,{qElemNo:a[k].qElemNumber,qText:a[k].qText,rowIndex:w+j,type:"dimension"}),void 0!==typeof a[k].qNum&&(h.data.qNum=a[k].qNum),c.qIsOtherCell&&(h.data.qIsOtherCell=!0,h.data.qText=v[B[k]].othersLabel||""),c.qIsTotalCell&&(h.data.qIsTotalCell=!0),g.data.qApprMaxGlyphCount=v[B[k]].qApprMaxGlyphCount,c.qIsOtherCell&&(g.data.othersIndex=g.children.length-1),o=new d([h.data.qText],null,null,null,w+j,k,h.data.qElemNo),g.cacheItem){o.parent=g.cacheItem,o.parent.children.push(o),p=o.parent.getDimensions();for(q in p)o.addDimension(p[q])}h.cacheItem=o,g=h}else g=g.children[m]}for(l=0;y>l&&A>z+l;l++)h=f(g,{qText:u[l].qFallbackTitle,qNum:a[z+l].qNum,rowIndex:w+j,type:"measure"}),g.data.qApprMaxGlyphCount=Math.max(g.qApprMaxGlyphCount,u[l].qApprMaxGlyphCount),o=g.cacheItem,
o.addMeasure(h.data.qText,h.data.qNum,a[z+l].qText),0===l&&C.push(o),i=new b,i.data={qText:a[z+l].qText,qNum:a[z+l].qNum,qElemNo:a[z+l].qElemNumber,qState:a[z+l].qState},h.addChild(i)}return x&&x[0]&&(x[0].qUp>0||x[0].qDown>0)&&(r.children[r.children.length-1].incomplete=!0),{dimensionTree:r,cacheItems:C}},_generatePivotTree:function(){return c.prepareData(this._qDataObject.qStackedDataPages[0].qData,this._qDataObject.qMeasureInfo,this._qDataObject.qDimensionInfo)},_extractProperties:function(){throw new Error("ChartContext _extractProperties: Deprecated")},_updateProperty:function(){throw new Error("ChartContext _updateProperty: Deprecated")},getDataMatrix:function(){return this._qDataObject.qDataPages[0].qMatrix},getDimensionTree:function(){return this._dimensionTree},getCacheItems:function(){return this._cacheItems}})}),define("objects.views/charts/events/chart-event",["core.utils/class"],function(a){"use strict";return a.extend({init:function(a){this._type=a},getType:function(){return this._type}})}),define("objects.views/charts/events/property-change-event",["objects.views/charts/events/chart-event"],function(a){"use strict";return a.extend({init:function(a,b,c){this._super("propertyChange"),this.property=a,this.oldValue=b,this.newValue=c}})}),define("objects.views/charts/utils/binding",["core.utils/class","objects.views/charts/events/event-launcher","objects.views/charts/events/property-change-event"],function(a,b,c){function d(){var a,b,c,d,f,j,k,l;for(4===arguments.length?(c=new h(arguments[0]),a=arguments[1],b=arguments[2],j=arguments[3]):(c=new h(arguments[0],arguments[1]),a=arguments[2],b=arguments[3],j=arguments[4]),d=b.split("."),f=d[0],l=0;l<d.length;l++)k=new g(a,f),c.add(k),a=a&&"function"==typeof a[e(f)]?a[e(f)]():void 0,f=d[l+1];return c.startObserving(j),new i(c)}function e(a){return"get"+a.substring(0,1).toUpperCase()+a.substring(1)}function f(a,b){var d,e,f=b.substring(0,1).toUpperCase()+b.substring(1);"function"==typeof a["set"+f]&&(a[k]||(a[k]={}),void 0===a[k][b]?(d=a["set"+f],e=a.hasOwnProperty("set"+f),a["set"+f]=function(e){var g="function"==typeof a["get"+f]?a["get"+f]():void 0;return"function"==typeof a["get"+f]&&e===g?void d.call(a,e):(d.call(a,e),void a.fire(new c(b,g,e)))},a[k][b]={observers:1,original:d,isOriginalOwn:e,keep:!1}):a[k][b].observers++)}var g,h,i,j,k="__setters";return g=b.extend("Link",{init:function(a,b){this._super(),this._property=b,this._host=a},setHost:function(a){this._host===a&&this._hostObserved||(this.unobserve(),this._host=a,this.observe())},observe:function(a){if(!this._host)return void this.fire("hostPropertyValueChanged",[void 0]);f(this._host,this._property);var b=this,c=e(this._property);this._callback=function(a){a.property===b._property&&b.fire("hostPropertyValueChanged",[a.newValue])},this._callbackSimple=function(){"function"==typeof this[c]&&b.fire("hostPropertyValueChanged",[this[c]()])},a||"function"!=typeof this._host[c]||b.fire("hostPropertyValueChanged",[this._host[c]()]),this._host.listen("propertyChange",this._callback),this._host.listen(this._property+"Changed",this._callbackSimple),this._hostObserved=!0},unobserve:function(){if(this._host){if(this._callback&&this._host.stopListen("propertyChange",this._callback),this._callbackSimple&&this._host.stopListen(this._property+"Changed",this._callbackSimple),this._host[k]&&this._host[k][this._property]){var a,b=this._host[k][this._property];b.observers--,b.observers<=0&&(a="set"+this._property.substring(0,1).toUpperCase()+this._property.substring(1),b.isOriginalOwn?this._host[a]=b.original:(this._host[a]=null,delete this._host[a]),b.original=null,this._host[k][this._property]=null,delete this._host[k][this._property])}this._host=void 0,this._callback=void 0,this._callbackSimple=void 0,this._hostObserved=!1}}}),h=a.extend("Chain",{init:function(a,b){this._links=[],1===arguments.length&&"function"==typeof a?this._setter=a:(this._wannabe=a,this._wannabeProp=b)},add:function(a){var b,c=this;a.listen("hostPropertyValueChanged",function(a){if(b=c._links.indexOf(this),b===c._links.length-1)if(c._setter)c._setter(a);else{var d="set"+c._wannabeProp.substring(0,1).toUpperCase()+c._wannabeProp.substring(1);"function"==typeof c._wannabe[d]&&c._wannabe[d](a)}else c._links[b+1].setHost(a)}),this._links.push(a)},startObserving:function(a){this._links[0].observe(a)},isBroken:function(){return this._isBroken},unwatch:function(){for(var a=this._links.pop();a;)a.unobserve(),a.stopListen("hostPropertyValueChanged"),a=this._links.pop();this._setter=void 0,this._wannabe=void 0,this._wannabeProp=void 0}}),i=a.extend("ChangeWatcher",{init:function(a){this._chain=a},unbind:function(){this._chain.unwatch()}}),j={},j.bindProperty=function(a,b,c,e,f){return d(a,b,c,e,f)},j.bindSetter=function(a,b,c,e){return d(a,b,c,e)},j.getter=e,j}),define("objects.views/charts/components/mini-chart",["./chart-component","../components/axis/continuous-axis","../components/data-area","../chart-context","objects.views/charts/utils/binding","general.utils/color","core.utils/deferred"],function(a,b,c,d,e,f,g){function h(a,b){var c,d={};if(b)for(c in a)"qHyperCube"===c?d[c]={qDataPages:[],qDimensionInfo:a.qHyperCube.qDimensionInfo.slice(),qMeasureInfo:a.qHyperCube.qMeasureInfo.slice(),qStackedDataPages:[],qMode:"S",qSize:{qcx:2,qcy:0}}:d[c]=a[c];else{if(!a.reducedHyperCube)return a;d={};for(c in a)"qHyperCube"===c?d[c]=a.reducedHyperCube:d[c]=a[c]}return d}var i;return i=a.extend("MiniChart",{init:function(a,b){this._super.apply(this,Array.prototype.slice.call(arguments)),this.components={},this.options=b,this._chartContext=new d,this._createComponents();var c=12303291;this._colorMap=void 0,this._constantColorMap={getColorByNode:function(){return new f(c)},getColor:function(){return new f(c)}},this.components.dataArea.setColorMap&&this.components.dataArea.setColorMap(this._constantColorMap),this.components.dataArea.setLayoutMode(3),e.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree"),this._logScale=!1},setData:function(a){if(!a||!a.qHyperCube)return g.resolve();this._data=null;var b,c,d=a.qHyperCube,e=this,f=Math.min(2e3,1e4/(d.qMeasureInfo.length+1)),i=-1,j=("linechart"===a.visualization||"barchart"===a.visualization&&a.barGrouping&&"stacked"===a.barGrouping.grouping)&&d.qDimensionInfo.length>1&&"K"===d.qMode?1:0;return"function"!=typeof this.backendApi.getReducedData?(this._data=h(a),this.invalidateProperties()):(b=h(a,!0),a.reducedHyperCube=b.qHyperCube,c=a.reducedHyperCube,this.backendApi.getReducedData([{qTop:0,qLeft:j,qWidth:a.qHyperCube.qDimensionInfo.length+a.qHyperCube.qMeasureInfo.length+j,qHeight:f}],i).then(function(a){return c.qDataPages=a,e._data=b,j&&a&&(a[0].isReduced||a[0].qIsReduced)&&(c.qDimensionInfo=d.qDimensionInfo.slice(0,1),c.qMeasureInfo=[d.qMeasureInfo[0],d.qMeasureInfo[0]]),e.invalidateProperties()}))},calculateRelevantSize:function(){this.relevantSize=Math.max(30,Math.min(40,this.outerRect[this.isVertical()?"width":"height"]/8))},setRect:function(a,b,c,d){this._super(a,b,c,d);for(var e in this.components)this.components[e].setRect(0,0,c,d);this.updateSize()},setOuterRect:function(a,b,c,d){this._super(a,b,c,d);for(var e in this.components)this.components[e].setOuterRect(a,b,c,d)},setLayoutToContainerRatios:function(a,b){this._super(a,b);for(var c in this.components)this.components[c].setLayoutToContainerRatios(a,b)},setContainerRect:function(a,b,c,d){this._super(a,b,c,d);for(var e in this.components)this.components[e].setContainerRect(a,b,c,d)},updateSize:function(){this._super();for(var a in this.components)this.components[a].updateSize()},isVisible:function(a){return this._super(a)&&this.rect&&this.rect.width>0&&this.rect.height>0},setLogScale:function(a){this._logScale=a,this._logScale!==!0&&(this._logScale=!1)},getLogScale:function(){return this._logScale},setHasValidData:function(a){this._super(a),Object.keys(this.components).forEach(function(b){this.components[b].setHasValidData(a)},this)},setDock:function(a){this._super(a),this.isVertical()?(this.components.measureAxis.setDock("top"),this.components.dimensionAxis.setDock("left")):(this.components.measureAxis.setDock("left"),this.components.dimensionAxis.setDock("bottom"))},paint:function(a,b){if(!b||!this.isVisible())return g.resolve();this._super(a,b);var c,d=[];this.components.dataArea.rect=this.rect.clone(),this.components.dimensionAxis.rect=this.components.dataArea.rect,this.components.measureAxis.rect=this.components.dataArea.rect,this.components.dataArea.rect.x=0,this.components.dataArea.rect.y=0,this.components.dimensionAxis.invalidateProperties("MiniChart.paint"),this.components.dimensionAxis.updateNow(["properties"]),this.components.measureAxis.invalidateProperties("MiniChart.paint"),this.components.measureAxis.updateNow(["properties"]),this.components.dimensionAxis.calculateValuePositionMappingInfo(),this.components.measureAxis.calculateValuePositionMappingInfo();for(c in this.components)d.push(this.components[c].invalidateDisplay("MiniChart.paint"));return g.all(d)},_createComponents:function(){var a=this.components,d=this.options;Object.keys(d.components).forEach(function(e){var f,g=[this.testId||"component",e].join("."),h=d.components[e];if(h.label=e,"function"==typeof d.components[e].clazz)f=d.components[e].clazz;else switch(e){case"dataArea":f=c;break;case"yAxis":case"measureAxis":f=b}f&&(a[e]=new f(this.container,h,g)),a[e].setUseTransition&&a[e].setUseTransition(!1)},this)},updateColorMap:function(a){if(a&&a.qHyperCube&&a.qHyperCube.qDimensionInfo[0]){var b=a.qHyperCube.qDataPages[0]&&a.qHyperCube.qDataPages[0].qIsReduced;this.components.dataArea.setColorMap&&(b||!a.color.auto&&"byExpression"===a.color.mode?this.components.dataArea.setColorMap(this._constantColorMap):this.components.dataArea.setColorMap(this._colorMap))}},updateAxis:function(a){var b,c,d,e,f,g;f=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),g=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),b=this.components.measureAxis,c=this.components.dimensionAxis,b.setNiceNumberEnabled(!1),b.setLogScale(this._logScale),"barchart"===a.visualization&&(g=Math.max(0,g),f=Math.min(0,f)),e=this.components.dataArea.getMinorAxisData(),e&&(g=e.max,f=e.min),(f===g&&0===g||isNaN(f)&&isNaN(g))&&(g=10,f=-10,b.setDataRange(f,g)),d=this.components.dataArea.getMajorAxisData(),d?c.setDataRange(d.data,d.info):c.setDataRange([],[])},setBackendApi:function(a){this.backendApi=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setOrientation:function(a){this._orientation=a||"horizontal"},_updateProperties:function(){if(this._data){var a=this._data;this.updateColorMap(a),this._chartContext.refresh(a),this.components.dataArea.setData(a),this.components.dataArea.updateNow(["properties"]),this.updateAxis(a),this.invalidateDisplay("MiniChart._updateProperties")}},clear:function(){Object.keys(this.components).forEach(function(a){this.components[a].clear()},this)},release:function(){this._super(),Object.keys(this.components).forEach(function(a){this.components[a].release()},this)},showComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var a in this.components.dataArea.renderers)this.components.dataArea.renderers[a].show()},hideComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var a in this.components.dataArea.renderers)this.components.dataArea.renderers[a].hide()}}),Object.defineProperty(i.prototype,"className",{value:"MiniChart"}),i}),define("objects.views/charts/representation/legend-data-provider",["../events/event-launcher","objects.views/charts/utils/tree-iterator"],function(a,b){function c(a,c){var d,e,f,g,h,i,j,k=[],l={},m=this._qDataObject,n=this._legendMarker?this._legendMarker:"rect",o=m?m.qDimensionInfo instanceof Array?m.qDimensionInfo:[m.qDimensionInfo]:null,p=this._colorMap;if(c=void 0===c?o.length-1:c,d=this._dimensionTree,a)for(h=m.qMeasureInfo,i=h.length,f=0;i>f;f++)k.push({label:h[f].qFallbackTitle,color:p.getColor(0,0,f),id:[-1],type:"measure",marker:this._legendMarker?this._legendMarker:this._measureLegendTypes?this._measureLegendTypes[f]||"box":"box"});else b.each.call(d,function(a){j=b.getLevel.call(a),j-1===c&&-2!==a.data.qElemNo&&void 0===l[a.data.qText]&&(g=[],g[c]=a.data.qElemNo,e={label:-3!==a.data.qElemNo?a.data.qText:o[0].othersLabel,color:p.getColor(g,0,0,a.data.rowIndex),id:[a.data.qElemNo],index:a.data.rowIndex,type:"dimension",marker:n},k.push(e),l[a.data.qText]=e)});return k}function d(a,b){var c,d,e,f,g,h,i,j=[],k={},l=this._data.qListObject.qDataPages[0].qMatrix,m=this._qDataObject,n=m?m.qDimensionInfo instanceof Array?m.qDimensionInfo:[m.qDimensionInfo]:null,o=this._colorMap;if(b=void 0===b?n.length-1:b,a)for(c=this._data.qListObject.qMeasureInfo,d=c.length,f=0;d>f;f++)j.push({label:c[f].qFallbackTitle,color:o.getColor(0,0,f),id:[-1],type:"measure"});else for(e=0;e<l.length;e++)g=l[e][b],-3!==g.qElemNumber&&-2!==g.qElemNumbero&&void 0===k[g.qText]&&(h=[],h[b]=g.qElemNumber,i={label:g.qText,color:o.getColor(h,0,0,e),id:[g.qElemNumber],type:"dimension"},j.push(i),k[g.qText]=i);return j}var e;return e=a.extend({init:function(a){this._data=a,this._colorMappings={}},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getColorMapping:function(){if(!this._colorMap||!this._data)return[];var a,b=this._colorMap.getLegendMode();return"primary"===b[2]?[]:this._colorMappings[b]?this._colorMappings[b]:(a="box"===b[0]&&"range"===b[1]||"scale"===b[0]?this._colorMap.generateScaleBasedMapping():this._data.qListObject?d.apply(this,["measure"===b[2],this._colorMap.getDimensionIndex()[0]]):c.apply(this,["measure"===b[2],this._colorMap.getDimensionIndex()[0]]),this._colorMappings[b]=a,a)},setData:function(a){var b=a.qHyperCube?a.qHyperCube:a.qListObject,c=a.qHyperCube?a.qHyperCube.qDimensionInfo:[a.qListObject.qDimensionInfo];this._qDataObject=b,this._data=a,a&&b.qDataPages.length?this._others=b.qDataPages[0].qMatrix.some(function(a){return c&&c.length&&a[c.length-1].qIsOtherCell===!0}):this._others=!1,this._colorMappings={}},setDimensionTree:function(a){this._dimensionTree=a,this._colorMappings={}},setMeasureLegendTypes:function(a){this._measureLegendTypes=a},setLegendMarker:function(a){this._legendMarker=a},release:function(){this._colorMap=null,this._dimensionTree=null,this._data=null,this._qDataObject=null}})}),define("general.utils/color-cache",["./color"],function(a){function b(a,b){return function(){var c,d,e=function(){};return e.prototype=a.prototype,c=new e,d=a.apply(c,b),Object(d)===d?d:c}}function c(){j++}function d(){var d,e,f,k;if(arguments.length<3)"string"==typeof arguments[0]?d=arguments[0]:"number"==typeof arguments[0]&&arguments[0]>=0&&(d=arguments[0]+"");else if(arguments.length>=3)for(d=arguments[0],f=0;f>arguments.length;f++)d+=","+arguments[f];if(d&&g[d])return g[d];if(k=b(a,arguments)(),e=k._r+","+k._g+","+k._b+","+k._a,h[e])k=h[e];else{if(j>=i)return k;h[e]=k,c()}return d&&(g[d]=k),k}function e(d,e,f){var g,l,m=k(d._r+(e._r-d._r)*f),n=k(d._g+(e._g-d._g)*f),o=k(d._b+(e._b-d._b)*f),p=k(d._a+(e._a-d._a)*f);if(g=m+","+n+","+o+","+p,h[g])l=h[g];else{if(l=b(a,[m,n,o,p])(),j>=i)return l;h[g]=l,c()}return l}function f(){g={},h={},j=0}var g={},h={},i=5e3,j=0,k=Math.floor;return{retriveColor:d,retriveBlend:e,clear:f}}),define("objects.views/charts/representation/color-scale",["core.utils/class","general.utils/color-cache"],function(a,b){"use strict";function c(a,b){var c;return a=h(g(.999999999999*(a+1e-12),1e-12),.999999999999),c=b-a*b}function d(a){return a=a?a:this._startLevel,h(a,this._colorParts.length-1)}function e(a){a.forEach(function(a){a.forEach(function(a){a.reverse()}),a.reverse()})}var f,g=Math.max,h=Math.min,i=b.retriveColor(13816530);return f=a.extend({init:function(){this._colorParts=[],this._startLevel=0,this._reverse=!1},addColorPart:function(a,c,d){d=d||0,this._startLevel=g(d,this._startLevel),this._colorParts[d]||(this._colorParts[d]=[]),this._colorParts[d].push([b.retriveColor(a),b.retriveColor(c)])},setReverse:function(a){this._reverse!==a&&(this._reverse=a,e(this._colorParts))},getColor:function(a,e){var f,g,h,j,k,l,m;return isNaN(a)?i:(e=d.apply(this,[e]),f=c(a,this._colorParts[e].length),g=Math.floor(f),j=this._colorParts[e][g],k=j[0],l=j[1],h=f-g,m=b.retriveBlend(k,l,h))},getColors:function(a){var b,c=[];for(b=0;b<a.length;b++)c.push(this.getColor(a[b]));return c},getLegendParts:function(a){var b,c,e,f=[];for(a=d.apply(this,[a]),c=this._colorParts[a].length,b=0;c>b;++b)e=this._colorParts[a][b],f.push({grad:e,color:e[0],solid:e[0]===e[1],index:b});return f}})}),define("objects.views/charts/representation/color-globals",[],function(){var a={};return a.qualitativeColors=[["#4477aa"],["#4477aa","#cc6677"],["#4477aa","#ddcc77","#cc6677"],["#4477aa","#117733","#ddcc77","#cc6677"],["#332288","#88ccee","#117733","#ddcc77","#cc6677"],["#332288","#88ccee","#117733","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#cc6677","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#cc6677","#882255","#aa4499"],["#332288","#44aa99","#88ccee","#117733","#999933","#ddcc77","#661100","#cc6677","#882255","#aa4499"],["#332288","#6699cc","#44aa99","#88ccee","#117733","#999933","#ddcc77","#661100","#cc6677","#882255","#aa4499"],["#332288","#6699cc","#88ccee","#44aa99","#117733","#999933","#ddcc77","#661100","#cc6677","#aa4466","#882255","#aa4499"]],a.largeQualitativeColors=["#99c867","#e43cd0","#e2402a","#66a8db","#3f1a20","#e5aa87","#3c6b59","#aa2a6b","#e9b02e","#7864dd","#65e93c","#5ce4ba","#d0e0da","#d796dd","#64487b","#e4e72b","#6f7330","#932834","#ae6c7d","#986717","#e3cb70","#408c1d","#dd325f","#533d1c","#2a3c54","#db7127","#72e3e2","#e2c1da","#d47555","#7d7f81","#54ae9b","#e9daa6","#3a8855","#5be66e","#ab39a4","#a6e332","#6c469d","#e39e51","#4f1c42","#273c1c","#aa972e","#8bb32a","#bdeca5","#63ec9b","#9c3519","#aaa484","#72256d","#4d749f","#9884df","#e590b8","#44b62b","#ad5792","#c65dea","#e670ca","#e38783","#29312d","#6a2c1e","#d7b1aa","#b1e7c3","#cdc134","#9ee764","#56b8ce","#2c6323","#65464a","#b1cfea","#3c7481","#3a4e96","#6493e1","#db5656","#747259","#bbabe4","#e33f92","#d0607d","#759f79","#9d6b5e","#8574ae","#7e304c","#ad8fac","#4b77de","#647e17","#b9c379","#8da8b0","#b972d9","#786279","#7ec07d","#916436","#2d274f","#dce680","#759748","#dae65a","#459c49","#b7934a","#51c671","#9ead3f","#969a5c","#b9976a","#46531a","#c0f084","#76c146","#bad0ad"],a.divColors=["#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e"].reverse(),a.divColorPyramid=[null,["#4477aa","#4477aa"].reverse(),["#99c7ec","#99c7ec","#f5a275","#f5a275"].reverse(),["#99c7ec","#99c7ec","#fffad2","#fffad2","#f5a275","#f5a275"].reverse(),["#008bce","#008bce","#b4ddf7","#b4ddf7","#f9bd7e","#f9bd7e","#d03232","#d03232"].reverse(),["#008bce","#008bce","#b4ddf7","#b4ddf7","#fffad2","#fffad2","#f9bd7e","#f9bd7e","#d03232","#d03232"].reverse(),["#3a89c9","#3a89c9","#99c7ec","#99c7ec","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f5a275","#f5a275","#d24d3e","#d24d3e"].reverse(),["#3a89c9","#3a89c9","#99c7ec","#99c7ec","#e6f5fe","#e6f5fe","#fffad2","#fffad2","#ffe3aa","#ffe3aa","#f5a275","#f5a275","#d24d3e","#d24d3e"].reverse(),["#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e"].reverse(),["#3d52a1","#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e","#ae1c3e"].reverse(),["#3d52a1","#3d52a1","#3a89c9","#3a89c9","#77b7e5","#77b7e5","#b4ddf7","#b4ddf7","#e6f5fe","#e6f5fe","#ffe3aa","#ffe3aa","#f9bd7e","#f9bd7e","#ed875e","#ed875e","#d24d3e","#d24d3e","#ae1c3e","#ae1c3e"].reverse()],a.seqColorPyramid=[null,["#d95f0e","#d95f0e"],["#fec44f","#fec44f","#d95f0e","#d95f0e"].reverse(),["#fed98e","#fed98e","#fb9a29","#fb9a29","#cc4c02","#cc4c02"].reverse(),["#fed98e","#fed98e","#fe9929","#fe9929","#d95f0e","#d95f0e","#993404","#993404"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fe9929","#fe9929","#d95f0e","#d95f0e","#993404","#993404"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fe9929","#fe9929","#ec7014","#ec7014","#cc4c02","#cc4c02","#8c2d04","#8c2d04"].reverse(),["#fee391","#fee391","#fec44f","#fec44f","#fb9a29","#fb9a29","#ec7014","#ec7014","#cc4c02","#cc4c02","#993404","#993404","#662506","#662506"].reverse()],a.seqColors=["#fff7bc","#fee391","#fee391","#fec44f","#fec44f","#fb9a29","#fb9a29","#ec7014","#ec7014","#cc4c02","#cc4c02","#993404","#993404","#662506"].reverse(),a.primaryColor="#4477aa",a.othersColor="#a5a5a5",a.nullColor="#d2d2d2",a}),define("objects.views/charts/representation/sequential-color-map",["jquery","core.utils/theme","general.utils/color-cache","objects.views/charts/events/event-launcher","objects.views/charts/representation/color-scale","objects.views/charts/representation/color-globals"],function(a,b,c,d,e,f){"use strict";function g(a,b){var c,d,f,g=new e;if(b){for(d=0;d<a.length;d++)if(f=a[d])for(c=0;c<f.length;c+=2)g.addColorPart(f[c],f[c+1],d)}else for(c=0;c<a.length;c+=2)g.addColorPart(a[c],a[c+1]);return g}function h(a,b){var c,d,e,f,g,h,j,k,l,m,p,q,r,s=[],t=!1;if(!a||!a.qDataPages||!a.qDataPages.length)return[];for(c=a.qMeasureInfo,d=a.qDimensionInfo instanceof Array?a.qDimensionInfo:[a.qDimensionInfo],e=a.qDataPages[0].qMatrix,m=[],this._others=!1,r=[],this._dataMaxMinValues=null,g=d.length,h=g;h<c.length+g;h++){m[h-g]||(m[h-g]=[]),p=-Number.MAX_VALUE,q=Number.MAX_VALUE;a:for(f=0;f<e.length;f++){for(j=0;g>j;j++){if(k=e[f][j],-3===k.qElemNumber&&j===d.length-1){this._others=!0;continue a}if(-2===k.qElemNumber&&j===d.length-1){this._null=!0;continue a}}l=e[f][h],l&&(m[h-g].push(l.qNum),isNaN(l.qNum)||(p=n(l.qNum,p),q=o(l.qNum,q),t=!0))}r.push({max:p,min:q}),a.qSize.qcy<=e.length&&!b?s[h-g]=i(p,q,m[h-g],1,this.getLargestScaleSize()):s[h-g]=this.getLargestScaleSize()}return a.qSize.qcy<=e.length&&!b&&t&&(this._dataMaxMinValues=r),s}function i(a,b,c,d,e){var f,g,h,j,k=0,l=[];if(f=(a-b)/(d+1),0===f)return 1;for(g=0;g<c.length;g++)h=.99*(c[g]-b),j=c[g]>a?Math.floor(a/f):c[g]<b?0:Math.floor(h/f),isNaN(j)||(l[j]?l[j]++:l[j]=1);for(g=0;g<l.length;g++)l[g]&&k++;return d>=k||k>=e?Math.max(k,d):i(a,b,c,++d,e)}function j(a){var b,c=[];for(b=0;b<a.length;b++)a[b]?c.push(k(a[b],!1)):c.push(null);return c}function k(a,b){var c=1,d=[];for(d.push(a[0]),b||d.push(a[0]);c<a.length-1;c++)d.push(a[c]),d.push(a[c]);return c<a.length&&(d.push(a[c]),b||d.push(a[c])),d}function l(a){var b=a.colorSchemes.ordinalScales[0];this._seqScale=g(k(b.scale,"gradient"===b.type),"class-pyramid"===b.type),this._largestScaleSize=b.scale.length,b=a.colorSchemes.ordinalScales[1],this._seqClasses=g(j(b.scale),"class-pyramid"===b.type),this._largestScaleSize=n(b.scale.length,this._largestScaleSize),b=a.colorSchemes.ordinalScales[2],this._divScale=g(k(b.scale,"gradient"===b.type),"class-pyramid"===b.type),this._largestScaleSize=n(b.scale.length,this._largestScaleSize),b=a.colorSchemes.ordinalScales[3],this._divClasses=g(j(b.scale),"class-pyramid"===b.type),this._largestScaleSize=n(b.scale.length,this._largestScaleSize),this._activeScale=this._seqScale}var m,n=Math.max,o=Math.min;return m=d.extend({init:function(a){l.call(this,b),this._activeScale=this._seqScale,this._measure=0,this.setData(a)},setData:function(a){if(this._data=a,a){var b=a.color||{},c=a.qHyperCube?a.qHyperCube:a.qListObject,d=c?c.qDimensionInfo instanceof Array?c.qDimensionInfo:[c.qDimensionInfo]:null;if(this._qDataObject=c,this._persistantColors=b.persistent!==!1,this._byExpression="byExpression"===b.mode,this._classes=!1,this._numUsedColors=h.apply(this,[this._qDataObject,b.autoMinMax===!1||this._byExpression]),this._dimIndex=d?d.length-1:0,void 0!==b.measureScheme){var e=b.measureScheme.split("");"s"===e[0]?"c"===e[1]?(this._activeScale=this._seqClasses,this._classes=!0):this._activeScale=this._seqScale:"c"===e[1]?(this._activeScale=this._divClasses,this._classes=!0):this._activeScale=this._divScale}void 0!==b.reverseScheme&&(this._seqScale.setReverse(b.reverseScheme===!0),this._divScale.setReverse(b.reverseScheme===!0),this._divClasses.setReverse(b.reverseScheme===!0),this._seqClasses.setReverse(b.reverseScheme===!0))}},getColor:function(a,b,d,e){var g,h,i,j=this._qDataObject;if(d=d||0,a=a instanceof Array?a[this._dimIndex]:a,-3===a)g=c.retriveColor(f.othersColor);else if(-2===a||d>=j.qMeasureInfo.length)g=c.retriveColor(f.nullColor);else{if(i=this._getMinMax(j.qMeasureInfo[d],d),!i||isNaN(e))return c.retriveColor(f.nullColor);h=i.min===i.max?.5:(e-i.min)/(i.max-i.min),g=this._activeScale.getColor(h,this._getNumUsedColors(d))}return g},getActiveScale:function(){return this._activeScale},getLargestScaleSize:function(){return this._largestScaleSize||0},generateScaleBasedMapping:function(){var b,c,d,e,f,g,h,i,j,k,l=this._qDataObject,m=this.getValueFormatter();if(k=this._activeScale,j=[],h=k.getLegendParts(this._getNumUsedColors(0)),b=this._getMinMax(l.qMeasureInfo[this._measure],this._measure),!b)return j;if(c=b.max-b.min,isNaN(c))return j;for(f=h.length,e=c/f,g=b.max,!isNaN(b.measureMax)&&this._classes&&(i=a.extend(!0,{},h[0]),i.isMax=!0,i.min=m.formatValue(g),i.id=[b.measureMax,g],i.type="range",j.push(i)),d=0;f-1>d;d++)i=h[d],i.isMax=0===d,i.max=m.formatValue(g),i.min=m.formatValue(g-e),i.id=[g,g-e],i.type="range",g-=e,j.push(i);return i=h[d],i.max=m.formatValue(g),i.min=m.formatValue(b.min),i.id=[g,b.min],i.type="range",j.push(i),!isNaN(b.measureMin)&&this._classes&&(i=a.extend(!0,{},h[d]),i.max=m.formatValue(b.min),i.min=void 0,i.id=[b.min,b.measureMin],i.type="range",j.push(i)),j},getColorMapping:function(){return this.generateScaleBasedMapping()},getLegendMode:function(){return[this._classes?"box":"scale",this._classes?"range":"item","measure"]},getLegendTitle:function(){return this._qDataObject.qMeasureInfo[this._measure].qFallbackTitle},setMeasureFormatters:function(a){this._measureFormatters=a},setGenericFormatter:function(a){this._formatter=a},getValueFormatter:function(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:{formatValue:function(a){return a}}},_getMinMax:function(a,b){var c;return this._data.color.autoMinMax===!1?c={min:this._data.color.measureMin||0,max:this._data.color.measureMax||10}:this._dataMaxMinValues&&this._dataMaxMinValues[b]?this._dataMaxMinValues[b]:a?{min:a.qMin,max:a.qMax}:null},_getNumUsedColors:function(a){return this._numUsedColors[a]},calculateNumberOfUsedColors:i})}),define("objects.utils/date-formatter",["core.utils/class"],function(a){"use strict";function b(a,b){for(var c=a.length;b>c;c++)a="0"+a;return a}function c(a,b){var c=a.getHours(),d=a.getDay()-1;return b&&(c%=12,c||(c=12)),0>d&&(d=6),{year:a.getFullYear(),month:a.getMonth(),day:d,date:a.getDate(),h:c,m:a.getMinutes(),s:a.getSeconds(),f:a.getMilliseconds(),t:a.getHours()>=12?"pm":"am"}}function d(a){var b=a.toString().split(".");return b[1]?b=Number("0."+b[1]):0}function e(a){var b=a,c=24*d(b),e=60*d(c),f=60*d(e),g=1e3*d(f);return{d:Math.floor(b),h:Math.floor(c),m:Math.floor(e),s:Math.floor(f),f:Math.round(g)}}function f(a,b){var c,d=e(a),f=d.d,g=d.h,h=d.m,i=d.s,j=d.f,k=0;return/w+|t+/gi.test(b)&&(c=new Date(1899,11,30+Math.floor(a),0,0,86400*(a-Math.floor(a))),isNaN(c.getTime())&&(c=null)),/D+/gi.test(b)||(g+=24*f),/h+/gi.test(b)||(h+=60*g),/m+/gi.test(b)||(i+=60*h),/w+/gi.test(b)&&(k=c?c.getDay()-1:0,0>k&&(k=6)),{year:0,month:0,day:k,date:f,h:g,m:h,s:i,f:j,t:c?c.getHours()>=12?"pm":"am":""}}function g(a,c){return{"Y+|y+":{Y:Number((c.year+"").slice(-2))+"",YY:b((c.year+"").slice(-2),2),YYY:b((c.year+"").slice(-3),3),def:function(a){return b(c.year+"",a.length)}},"M+":{M:c.month+1,MM:b(c.month+1+"",2),MMM:a.locale_months_abbr[c.month],def:a.locale_months[c.month]},"W+|w+":{W:c.day,WW:b(c.day+"",2),WWW:a.locale_days_abbr[c.day],def:a.locale_days[c.day]},"D+|d+":{D:c.date,def:function(a){return b(c.date+"",a.length)}},"h+|H+":{h:c.h,def:function(a){return b(c.h+"",a.length)}},"m+":{m:c.m,def:function(a){return b(c.m+"",a.length)}},"s+|S+":{s:c.s,def:function(a){return b(c.s+"",a.length)}},"f+|F+":{def:function(a){var b=c.f+"",d=a.length-b.length;if(d>0)for(var e=0;d>e;e++)b+="0";else 0>d&&(b=b.slice(0,a.length));return b}},"t{1,2}|T{1,2}":{def:function(a){var b=c.t;return a[0].toUpperCase()===a[0]&&(b=b.toUpperCase()),b=b.slice(0,a.length)}}}}var h,i=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],j=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],k=["January","February","March","April","May","June","July","August","September","October","November","December"],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return h=a.extend({init:function(a,b){var c=a||{};c.qCalendarStrings||(c.qCalendarStrings={qLongDayNames:i,qDayNames:j,qLongMonthNames:k,qMonthNames:l}),this.localeInfo=c,this.locale_days=c.qCalendarStrings.qLongDayNames.slice(),this.locale_days_abbr=c.qCalendarStrings.qDayNames.slice(),this.locale_months=c.qCalendarStrings.qLongMonthNames.slice(),this.locale_months_abbr=c.qCalendarStrings.qMonthNames.slice(),this.pattern=b},clone:function(){var a=new h(this.localeInfo,this.pattern);return a.subtype=this.subtype,a},format:function(a,b){b||(b=this.pattern?this.pattern:"YYYY-MM-DD hh:mm:ss"),b=b.replace(/\[.+\]|\[|\]/g,"");var d,e=/t+/gi.test(b);d=a instanceof Date?c(a,e):f(a,b);var h=g(this,d),i=[];for(var j in h)i.push(j);var k=new RegExp(i.join("|"),"g"),l=b.replace(k,function(a){var b;for(var c in h)if(b=new RegExp(c),b.test(a))break;if(!b)return"";var d;for(var e in h[c])if(e===a||e.toLowerCase()===a){d=h[c][e],"undefined"==typeof d&&(d=h[c][e.toLowerCase()]);break}return"undefined"==typeof d&&(d=h[c].def),"function"==typeof d&&(d=d(a)),d});return l}}),h.parseInterval=e,h}),define("objects.utils/num-date-time-formatter",["objects.utils/number-formatter","objects.utils/date-formatter"],function(a,b){"use strict";function c(a){if(isNaN(a)||!isFinite(a))return 1;var b=Number(a).toExponential(),c=b.split("e"),d=1;return"+"===c[1][0]&&(d+=Number(c[1])),d}function d(a){if(isNaN(a)||!isFinite(a))return 0;var b,c=Number(a).toExponential(),d=c.split("e"),e=0;return"-"===d[1][0]?(e=Math.abs(Number(d[1])),d=d[0].split("."),d[1]&&(e+=d[1].length)):(b=Number(d[1]),d=d[0].split("."),e=d[1]?d[1].length-b:0),e}var e,f={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"};return e=a.extend("QFormatter",{init:function(c,d,e,g,h){var i=c||{};this.localeInfo=i,this.pattern=d||"",this.decimalDelimiter="string"==typeof g?g:"string"==typeof i.qDecimalSep?i.qDecimalSep:".",this.thousandDelimiter="string"==typeof e?e:"string"==typeof i.qThousandSep&&this.decimalDelimiter!==i.qThousandSep?i.qThousandSep:"",this.type=h||f.AUTO,h===f.AUTO&&(this.pattern="#"+this.decimalDelimiter+"##A"),this._numberFormatter=new a(c),this._dateFormatter=new b(c),this.prepare()},clone:function(){return new e(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type)},prepare:function(a,b,c){if(a||(a=this.pattern),!a)switch(this.type){case f.INTEGER:a="##############";break;case f.NUMBER:a=Array(this.localeInfo.qnDec||11).join("#");break;case f.FIXED_TO:a="#"+this.localeInfo.qDecimalSep||"."+Array(this.localeInfo.qnDec||4).join("#");break;case f.MONEY:a=this.localeInfo.qMoneyFmt,c||(c=this.localeInfo.qMoneyDecimalSep||"."),b||c===this.localeInfo.qMoneyThousandSep||(b=this.localeInfo.qMoneyThousandSep);break;case f.DATE:a=this.localeInfo.qDateFmt||"YYYY-MM-DD";
break;case f.DATE_TIME:a=this.localeInfo.qTimestampFmt||"YYYY-MM-DD hh:mm:ss";break;case f.TIME:case f.INTERVAL:a=this.localeInfo.qTimeFmt||"hh:mm:ss";break;default:a="##########"}this._numberFormatter.pattern=this.pattern,this._dateFormatter.pattern=this.pattern,this._numberFormatter.thousandDelimiter=this.thousandDelimiter,this._numberFormatter.decimalDelimiter=this.decimalDelimiter,this._numberFormatter.type=this.type,this._numberFormatter.prepare(a,b,c),this._prepared={pattern:a,t:b,d:c}},formatValue:function(a){var b,c=this._prepared;if("NaN"===a||"number"==typeof a&&isNaN(a))return"-";if(isNaN(a)||"number"!=typeof a)return a+"";switch(this.type){case f.DATE:case f.TIME:case f.DATE_TIME:return b=new Date(1899,11,30+Math.floor(a),0,0,86400*(a-Math.floor(a))),isNaN(b.getTime())?this._numberFormatter.format(a,"0",c.t,c.d):this._dateFormatter.format(b,c.pattern);case f.INTERVAL:return this._dateFormatter.format(a,c.pattern);default:return this._numberFormatter.formatValue(a)}},format:function(a,b,c,d){return"NaN"===a||"number"==typeof a&&isNaN(a)?"-":isNaN(a)||"number"!=typeof a?a+"":(this.prepare(b,c,d),this.formatValue(a))},createPatternFromRange:function(a,b,c){var d,e,f,g="",h=Number(Number(a).toExponential().split("e")[1]),i=Number(Number(b).toExponential().split("e")[1]),j=Math.min(Math.abs(h),Math.abs(i)),k=Math.abs(b-a),l=Number(Number(k/50).toExponential().split("e")[1]);if(f=Math.abs(l),0===k)return"0"+this.decimalDelimiter+"##"+(c?"A":"");if(l>=0?f=c?Math.max(2,j-l):0:(e=(c?j-j%3:0)*(0>i?1:-1),f-=e),g+=this.thousandDelimiter?"#"+this.thousandDelimiter+"##0":"0",f)for(g+=this.decimalDelimiter,d=0;f>d;d++)g+="#";return g+(c?"A":"")}}),e.getSignificantIntegers=function(a){return c(a)},e.getSignificantDecimals=function(a){return d(a)},e}),define("objects.views/charts/representation/expression-color-map",["core.utils/theme","general.utils/color-cache","objects.views/charts/representation/sequential-color-map","objects.utils/num-date-time-formatter","translator"],function(a,b,c,d,e){"use strict";function f(a,b){var c,d=-Number.MAX_VALUE,e=Number.MAX_VALUE;return b.color.autoMinMax===!1?{min:b.color.measureMin||0,max:b.color.measureMax||10}:a?(Object.keys(a).forEach(function(b){c=a[b].value;var f=b.split(",");isNaN(c)||f.contains("-3")||f.contains("-2")||(d=Math.max(d,c),e=Math.min(e,c))}),{min:e,max:d}):null}function g(c){if(!(c&&c.qDataPages[0]&&c.qMeasureInfo&&c.qMeasureInfo.length))return{};var d,e,f,g,h,j,k=c.qDataPages[0].qMatrix,l=i(c.qDimensionInfo),m={},n=0;for(c.qMeasureInfo[0].qAttrExprInfo&&c.qMeasureInfo[0].qAttrExprInfo.every(function(a,b){"colorByExpression"===a.type&&(n=b)}),h=0;h<k.length;h++){for(g=k[h][l].qAttrExps,f=""+k[h][0].qElemNumber,j=1;l>j;j++)f+=","+k[h][j].qElemNumber;g&&g.qValues.length?(d=b.retriveColor(isNaN(g.qValues[n].qNum)?g.qValues[n].qText:g.qValues[n].qNum,"argb"),e=g.qValues[n].qNum):(d=b.retriveColor(a.colorSchemes.nullColor),e=NaN),m[f]={color:d,value:e}}return m}function h(c){if(!(c&&c.qStackedDataPages[0]&&c.qMeasureInfo&&c.qMeasureInfo.length))return{};var d,e,f,g,h=c.qStackedDataPages[0].qData[0],i={};return g=function(c,h){if("V"===c.qType)f=c.qAttrExps,f&&f.qValues.length?(d=b.retriveColor(isNaN(f.qValues[0].qNum)?f.qValues[0].qText:f.qValues[0].qNum,"argb"),e=f.qValues[0].qNum,i[h]={color:d,value:e}):(d=b.retriveColor(a.colorSchemes.nullColor),e=NaN,i[h]||(i[h]={color:d,value:e}));else if(c.qSubNodes.length>0){"N"===c.qType&&(h?h+=","+c.qElemNo:h=""+c.qElemNo);for(var j=0;j<c.qSubNodes.length;j++)g(c.qSubNodes[j],h)}},g(h),i}function i(a){return Array.isArray(a)?a.length:1}var j;return j=c.extend({init:function(a){this._formatter=new d(null),this._super(a)},setData:function(a){if(this._super(a),this._mapping={},a){var b=a.color||{},c=a.qHyperCube?a.qHyperCube:a.qListObject;if(this._qDataObject=c,this._data=a,this._isColorExpression=b.expressionIsColor!==!1,this._byExpression="byExpression"===b.mode,this._expressionLabel=b.expressionLabel&&""!==b.expressionLabel?b.expressionLabel:e.get("Object.ChartTooltip.ColorExpression"),this._byExpression){c.qDataPages&&c.qDataPages[0]?this._mapping=g(c):c.qStackedDataPages&&c.qStackedDataPages[0]&&(this._mapping=h(c)),this._minMax=f(this._mapping,a);var d=this._mapping;this._numUsedColors=[this.calculateNumberOfUsedColors(this._minMax.max,this._minMax.min,Object.keys(d).map(function(a){var b=a.split(",");return b.contains("-3")||b.contains("-2")?null:d[a].value}),1,this.getLargestScaleSize())],this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare()}else this._minMax=null,this._mapping=null,this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()}},getColor:function(c,d,e,f){if(!this._byExpression)return this._super(c,d,e,f);var g,h,i,j=this._qDataObject,k=j?j.qMeasureInfo.length:0;return e=0,h=c instanceof Array?this._dimIndex>=0?c[this._dimIndex]:void 0:c,i=c instanceof Array?c.join(","):c+"",-3===h||void 0===h&&c instanceof Array&&-1!==c.indexOf(-3)?b.retriveColor(a.colorSchemes.othersColor):-2===h?b.retriveColor(a.colorSchemes.nullColor):k?!this._mapping[i]||this._mapping[i].color.isInvalid()&&this._isColorExpression?b.retriveColor(a.colorSchemes.nullColor):g=this._isColorExpression?this._mapping[i].color:this._super(c,d,0,this._mapping[i].value):this._super(c,d,e,f)},getExpressionValue:function(a){var b=a instanceof Array?a.join(","):a+"";return!this._mapping[b]||this._isColorExpression?void 0:this._mapping[b].value},getLegendTitle:function(){return this._byExpression?this._expressionLabel:this._super()},getLegendMode:function(){return this._byExpression?this._isColorExpression?["box","item","primary",!0]:[this._classes?"box":"scale",this._classes?"range":"item","measure",!0]:this._super()},getValueFormatter:function(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:this._formatter},setGenericFormatter:function(a){this._super(a),this._byExpression&&this._minMax?(this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare()):this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()},_getMinMax:function(a,b){return this._byExpression?a&&this._minMax?{min:this._minMax.min,max:this._minMax.max}:null:this._super(a,b)},_getNumUsedColors:function(a){return this._numUsedColors[a]}})}),define("objects.views/charts/representation/qualitative-color-map",["translator","core.utils/theme","general.utils/color-cache","objects.views/charts/events/event-launcher"],function(a,b,c,d){"use strict";function e(a,b,c,d){var e=d.qDimensionInfo instanceof Array?d.qDimensionInfo.length:1,f=d.qMeasureInfo?d.qMeasureInfo.length:0;return a&&a!==l?f>1&&c!==n&&a!==m&&(a=n):a=b===m||c===l&&1>=e&&1>=f?m:n,"byDimension"===a?n:a}function f(a,b,c,d){var e,f=0,g=b instanceof Array,h=g?b.length:1;if(c&&!a)for(f;h>f;++f)if(e=g?b[f].cId:b.cId,e===c)return f;return d===p?0:h-1}function g(a,b,c,d,e,f,g){return b>1&&c!==n?b:d?e?0:f[g].qCardinal:a.qDataPages.length?a.qDataPages[0].qMatrix.length:a.qStackedDataPages.length&&a.qStackedDataPages[0].qData.length?a.qStackedDataPages[0].qData[0].qSubNodes.length:e?0:f[g].qCardinal}function h(a){return b.palette[a]?b.palette[a]:a}var i,j,k,l="auto",m="primary",n="dimension",o="measure",p="first",q="last";return i=d.extend({init:function(a,c){c=c||{},this._primaryColorMode=c.colorBy||l,this._autoMode=c.autoMode||l,this._multiDimScheme=c.multiDimScheme||q,this._primaryColor=b.colorSchemes.primaryColor,j=b.colorSchemes.qualitativeScales[0].scale,k=b.colorSchemes.qualitativeScales[1].scale,this._qualitativeScale=j[j.length-1],this._persistantColors=!1,a&&this.setData(a)},setData:function(a){var b=a.color||{},c=a.qHyperCube?a.qHyperCube:a.qListObject,d=c&&c.qMeasureInfo?c.qMeasureInfo.length:0,i=c.qDimensionInfo instanceof Array?c.qDimensionInfo:[c.qDimensionInfo];this._qDataObject=c,this._data=a,this._colorMode=b.auto?l:b.mode||m,this._internalMode=e(b.auto?l:b.mode||l,this._autoMode,this._primaryColorMode,c),this._persistentColors=b.persistent!==!1,this._dimIndex=f(b.auto,i,b.dimensionId,this._multiDimScheme),this._haveNoDimension=0===i.length||this._dimIndex<0,this._dimLabel=this._haveNoDimension?"":i[this._dimIndex].qFallbackTitle,this._dimSize=g(c,d,this._primaryColorMode,this._persistentColors,this._haveNoDimension,i,this._dimIndex),void 0!==b.singleColor&&(this._primaryColor=h(b.singleColor)),this._dimSize>j.length?this._qualitativeScale="100"!==b.dimensionScheme?j[j.length-1]:k:this._qualitativeScale=j[(this._dimSize-1)%j.length]},getColor:function(a,d,e){var f,g,h,i=this._qDataObject,j=i?i.qMeasureInfo.length:0;return h=a instanceof Array?this._dimIndex>=0?a[this._dimIndex]:void 0:a,-3===h||a instanceof Array&&-1!==a.indexOf(-3)?c.retriveColor(b.colorSchemes.othersColor):-2===h?c.retriveColor(b.colorSchemes.nullColor):this._internalMode===m&&this._colorMode===l?c.retriveColor(b.colorSchemes.primaryColor):this._internalMode===m?c.retriveColor(this._primaryColor):(f=j>1&&this._primaryColorMode!==n?e:this._persistentColors?h:d,g=c.retriveColor(this._qualitativeScale[f%this._qualitativeScale.length]))},getLegendMode:function(){var a=this._qDataObject?this._qDataObject.qMeasureInfo.length:0,b=this._internalMode===m?m:this._autoMode===o||this._primaryColorMode===o||a>1&&this._primaryColorMode!==n?"measure":"dimension";return["box","item",b,"measure"===b]},getDimensionIndex:function(){return this._dimIndex},getLegendTitle:function(){var b=this._qDataObject,c=b?b.qMeasureInfo.length:0,d=b?b.qDimensionInfo instanceof Array?b.qDimensionInfo.length:1:0;return this._primaryColorMode===o||1===d&&c>1&&this._primaryColorMode!==n?a.get("Common.Measures"):this._dimLabel}})}),define("objects.views/charts/representation/combo-color-map",["objects.views/charts/events/event-launcher","objects.views/charts/representation/legend-data-provider","objects.views/charts/representation/expression-color-map","objects.views/charts/representation/qualitative-color-map"],function(a,b,c,d){var e,f="auto",g="qualitative",h="primary",i="expression",j="measure";return e=a.extend({init:function(a,e){this._qualitativeMap=new d(a,e),this._sequentialMap=new c(a,e),this._legendDataProvider=new b(a),this._legendDataProvider.setColorMap(this),this._title="DEBUG",a&&this.setData(a)},getColor:function(a,b,c,d){return this._colorMode===j||this._colorMode===i?this._sequentialMap.getColor(a,d,c,b):this._qualitativeMap.getColor(a,d,c,b)},getTooltipContent:function(a){var b,c,d=null;return this._colorMode===i&&(b=this._sequentialMap.getExpressionValue(a),void 0!==b&&(this._sequentialMap.getValueFormatter&&(c=this._sequentialMap.getValueFormatter())&&(b=c.formatValue(b)),d={label:this.getLegendTitle(),value:b})),d},getColorMapping:function(){return this._legendDataProvider.getColorMapping()},generateScaleBasedMapping:function(){return this._sequentialMap.generateScaleBasedMapping()},getLegendMode:function(){return this._colorMode===j||this._colorMode===i?this._sequentialMap.getLegendMode():this._qualitativeMap.getLegendMode()},getSelectionIndices:function(){return this.getDimensionIndex()},getLegendTitle:function(){return this._colorMode===j||this._colorMode===i?this._sequentialMap.getLegendTitle():this._qualitativeMap.getLegendTitle()},getDimensionIndex:function(){return this._colorMode===j?[0]:[this._qualitativeMap.getDimensionIndex()]},setData:function(a){if(this._colorMode=g,this._data=a,a.color)if(a.color.auto)this._colorMode=f,this._sequentialMap.setData(a),this._qualitativeMap.setData(a);else switch(a.color.mode){case"byMeasure":this._colorMode=j,this._sequentialMap.setData(a);break;case"byExpression":this._colorMode=i,this._sequentialMap.setData(a);break;case"primary":this._colorMode=h,this._qualitativeMap.setData(a);break;default:this._qualitativeMap.setData(a)}else this._sequentialMap.setData(a),this._qualitativeMap.setData(a);this._legendDataProvider.setData(a)},setMeasureFormatters:function(a){this._measureFormatters=a,this._sequentialMap.setMeasureFormatters(a)},setGenericFormatter:function(a){this._sequentialMap.setGenericFormatter(a)},setDimensionTree:function(a){this._dimensionTree=a,this._legendDataProvider.setDimensionTree(a)},getLegendDataProvider:function(){return this._legendDataProvider},release:function(){this._qualitativeMap.release&&this._qualitativeMap.release(),this._sequentialMap.release&&this._sequentialMap.release(),this._legendDataProvider.release&&this._legendDataProvider.release(),this._dimensionTree=null,this._legendDataProvider=null,this._sequentialMap=null,this._qualitativeMap=null}}),Object.defineProperties(e.prototype,{mode:{get:function(){return this._colorMode}}}),Object.defineProperties(e,{AUTO:{value:f,writable:!1},PRIMARY:{value:h,writable:!1},MEASURE:{value:j,writable:!1},EXPRESSION:{value:i,writable:!1},QUALITATIVE:{value:g,writable:!1}}),Object.defineProperties(e.prototype,{AUTO:{value:f,writable:!1},PRIMARY:{value:h,writable:!1},MEASURE:{value:j,writable:!1},EXPRESSION:{value:i,writable:!1},QUALITATIVE:{value:g,writable:!1}}),e}),define("objects.views/charts/utils/chart-formatting",["core.utils/class","objects.utils/num-date-time-formatter","objects.utils/number-formatter"],function(a,b){"use strict";function c(a){return!!a.qIsAutoFormat&&["M","D","T","TS","IV"].indexOf(a.qNumFormat.qType)<0}var d=a.extend("ChartFormatting",{init:function(a,b){this.localeInfo=a,this.measureFormatters=this.getFormattersForMeasures(b),this.combinedMeasuresFormatter=this.getFormatterFromFormatters(this.measureFormatters)},createFormatter:function(){return new b(this.localeInfo)},getLocaleInfo:function(){return this.localeInfo||{}},getFormatters:function(){return this.measureFormatters||[]},getMeasureFormatter:function(a){return this.measureFormatters[a]?this.measureFormatters[a]:void 0},getCombinedMeasuresFormatter:function(){return this.combinedMeasuresFormatter},formatMeasure:function(a,b){var c=this.measureFormatters[b];return c?c.format(a):a},getFormatterFromFormatters:function(a){var c,d,e,f,g,h=0,i=0,j=0,k=a?a.filter(function(a){return a.values?!isNaN(a.values.range):!1}):[];return a&&a.length&&(a.forEach(function(a){return"U"===a.type||a.values&&isNaN(a.values.range)?i++:["D","T","TS","IV"].contains(a.type)?h=1:j=1,a.prepare(),a}),k.length&&(c=k.reduce(function(a,b){return Math.min(b.values.min,a)},k[0].values.min),d=k.reduce(function(a,b){return Math.max(b.values.max,a)},k[0].values.max),e=Math.abs(d-c)),h+j>1?(g=a.filter(function(a){return"datetime"!==a.type})[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,"U"),isNaN(e)||(f.pattern=f.createPatternFromRange(c,d,!0))):h+j===1&&0===i?(g=a[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,g.type)):(g=a.filter(function(a){return"U"!==a.type}),g=g.length?g[0]:a[0]||{},f=new b(this.localeInfo,g.pattern,g.thousandDelimiter,g.decimalDelimiter,g.type),isNaN(e)||"U"!==g.type||(f.pattern=f.createPatternFromRange(c,d,!0))),f.prepare()),f||(f=new b(this.localeInfo,"0")),f},getFormattersForMeasures:function(a,d){var e,f=[];return a&&a.length&&(e=d?a.filter(function(a,b){return d.indexOf(b)>=0}):a,f=e.map(function(a){var d=c(a),e=new b(this.localeInfo,a.qNumFormat.qFmt,a.qNumFormat.qThou,a.qNumFormat.qDec,d?"U":a.qNumFormat.qType),f=Math.abs(a.qMax-a.qMin),g=isNaN(f);return e.values={min:a.qMin,max:a.qMax,range:f},!g&&d&&(e.pattern=e.createPatternFromRange(a.qMin,a.qMax,!0)),e.prepare(),e},this)),f}});return d}),define("objects.views/charts/chart",["jquery","./events/event-launcher","./layout-engine","./components/data-area","./components/axis/axis","./components/axis/discrete-axis","./components/legend/color-legend","./components/legend/color-legend-light","./components/mini-chart","./representation/combo-color-map","./chart-context","objects.utils/shapes/rect","objects.utils/layout","objects.views/charts/utils/binding","objects.views/charts/utils/chart-formatting","client.utils/state","objects.extension/default-view","objects.utils/event-utils","core.utils/deferred"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){"use strict";function t(){if(this.selections){var a,b,c,d=this.components.dataArea.getSelectableShapes(),f=this._selectedRows,h=0,i=!1,j=[],k=this.selections.getActiveType?this.selections.getActiveType():!1,l=!!k;this.selections.cache&&(this.selections.cache.clear(),d.forEach(function(a){this.selections.cache.add(a)},this),l&&("item"===k.getActiveMode()?(h=this.components.dimensionAxis?this.components.dimensionAxis.getSelectionIndices()[0]:0,i=this.components.dimensionAxis&&this._data.qHyperCube.qDimensionInfo.length>1,d.forEach(function(d){b=d.col,a=d.rowIndex||d.row||0,i?b===h?d.selected=f.indexOf(a)>=0:f.indexOf(a)>=0&&b>h&&(c=d.parent,c&&c.col===h&&j.indexOf(c)<0&&j.push(c)):d.selected=f.indexOf(a)>=0},this),j&&j.forEach(function(b){b.children.forEach(function(b){a=b.rowIndex||b.row||0,b.selected=!0,f.indexOf(a)<0&&f.push(a)})})):(k.activeComponent instanceof e&&!k.activeComponent.isDiscrete()||k.activeComponent instanceof g&&"range"===k.getActiveMode())&&k.updateShapesState()),this.providers&&this.providers.tooltip&&this.providers.tooltip.setSelectableShapes(d)),Object.keys(this.components).forEach(function(a){["colorLegend","xAxis","dimensionAxis"].contains(a)&&this.components[a].setSelectableShapes(d)},this)}}function u(){var a,b,c,d,e,f,g,h,i,j=this.container.parentElement,k="",l="";if(j.style.height="100%",j.style.width="",j.style.left="",j.style.top="",this._readStoredData&&this._data.snapshotData.content.size){a=this.container.clientWidth,b=this.container.clientHeight,g=this._data.snapshotData.content.size,c=g.w,d=g.h;var m=c/d,n=a/b;n>=m?(h=b/d,e=b*m/a,a=100*e+"%",b="100%",k=50*(1-e)+"%"):(h=a/c,f=a/m/b,b=100*f+"%",a="",l=50*(1-f)+"%"),this._chartScale=h,this.$scope.dataAttributes.chartScale=h;for(i in this.components)this.components[i].chartScale=this._chartScale;j.style.width=a,j.style.height=b,j.style.left=k,j.style.top=l}}function v(){this._sizeChanged=!1,u.call(this);var a,b,c=this.rect,d=this.container.clientWidth,e=this.container.clientHeight,f=new l(0,0,d,e);if(this.containerRect=new l(0,0,d,e),this._readStoredData&&this._data.snapshotData.content.size&&(b={width:this._data.snapshotData.content.size.w,height:this._data.snapshotData.content.size.h}),b&&(f=new l(0,0,b.width,b.height)),!c||c.width!==f.width||c.height!==f.height){for(a in this.components)this.components[a].setOuterRect(f.x+1,f.y+1,f.width-2,f.height-2);this.rect=f,this._updateLayoutMode(this.rect.width,this.rect.height),this._sizeChanged=!0}}function w(a,b){Object.keys(this.components).forEach(function(c){["colorLegend","xAxis","dimensionAxis","dataArea"].contains(c)&&this.components[c].setGlobalOpacity(a,b||!1)},this)}function x(){var a;this.chartFormatter=new o(this.backendApi.localeInfo,this._data.qHyperCube.qMeasureInfo);for(a in this.components)this.components[a].chartFormatter=this.chartFormatter,this.components[a].measureFormatters=this.chartFormatter.getFormatters(),this.components[a].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter()}function y(){var a,c={};for(a in b.prototype)b.prototype.hasOwnProperty(a)&&"init"!==a&&(c[a]=b.prototype[a]);return c}var z,A,B;return A={debug:!0,components:{}},B=q.extend(y()),z=B.extend({refreshSelections:function(){this.specialCaseForSingleSelect=!1},initialize:function(){this._super(),this._initiateBindings()},init:function(d,e,f,g){b.prototype.init.call(this),f=a.extend(!0,f||{},{},A),this._super(d,e,f,g),this.container=e[0],this.backendApi=g,this.layoutEngine=new c,this.components={},this.providers={},this._changeWatchers=[],this._createComponents(),this._createProviders(),this._chartScale=1,this.chartFormatter=new o(this.backendApi.localeInfo),this._selectedRows=[],this._chartContext=new k,this._layoutMode=m.LayoutMode.FULL,this.$scope.dataAttributes={},this.resize(),this.specialCaseForSingleSelect=!1},selectionModeAlpha:.5,setMinimumRequirements:function(a,b){this._requirements={dimensions:{min:a},measures:{min:b}}},onToggleLasso:function(){this.toggleLasso(!this.isLassoing())},notUsingLasso:function(a){var b,c;return this.selections&&this.selections.options.getSelectionType&&this.selections.types&&this.selections.types.dataArea?this.selections.types.dataArea.options.lassoSelection?!1:(b=this.selections.options.getSelectionType.call(this.selections,{x:a.pageX,y:a.pageY}),c=!(!b||"item"!==b._activeMode||!b.activeComponent||b.activeComponent&&b.activeComponent!==this.components.dataArea)):!0},onSelection:{ToggleShape:function(a){if(!a.selected&&1===this.$scope.layout.qHyperCube.qSize.qcy)return void(this.specialCaseForSingleSelect=!0);if(this.toggleCacheItem?this.toggleCacheItem(a):this.onSelection.scheduleInvalidation.call(this),-3===a.id||a.id>=0){var b=a.rowIndex||a.row||0;a.selected&&this._selectedRows.indexOf(b)<0?this._selectedRows.push(b):!a.selected&&this._selectedRows.indexOf(b)>=0&&this._selectedRows.splice(this._selectedRows.indexOf(b),1)}this.specialCaseForSingleSelect=!1,this._haveToggledShapes=!!this._selectedRows.length},Activated:function(){w.apply(this,[this.selectionModeAlpha]),this._haveToggledShapes=!1},Deactivated:function(){w.apply(this,[1,this._haveToggledShapes]),this._selectedRows=[],this._toggleLasso&&this.toggleLasso(!1)},Select:function(a,b,c,d){if(!this.specialCaseForSingleSelect){var e=Array.isArray(c)?c:[c||0];this._selectedRows.length?this.backendApi.select(this._selectedRows,e,d)["catch"](function(a){a.isHandled=!0}):a.length&&a.every(function(a){return!a.selected})&&this.backendApi.clearSelections()}},SelectRange:function(a,b){var c=this;this.backendApi.selectRange(a,b).then(function(a){a.qSuccess||c.backendApi.clearSelections()})},Confirm:function(){},Cancel:function(){},Clear:function(){this._selectedRows=[]},scheduleInvalidation:function(){var a=this;this._invalidationTimer||(this._invalidationTimer=setTimeout(function(){a.onSelection.invalidate.call(a),a._invalidationTimer=null},10))},cancelInvalidation:function(){clearTimeout(this._invalidationTimer),this._invalidationTimer=null},invalidate:function(){this.components.dataArea.invalidateDisplay("Chart.onSelection.invalidate"),this.components.colorLegend&&this.components.colorLegend.invalidateDisplay("Chart.onSelection.invalidate"),Object.keys(this.components).forEach(function(a){this.components[a]instanceof f&&this.components[a].invalidateDisplay("Chart.onSelection.invalidate")},this)}},getLayoutMode:function(){return this._layoutMode},getVerticalLayoutMode:function(){return this._verticalLayoutMode},getHorizontalLayoutMode:function(){return this._horizontalLayoutMode},setLayoutMode:function(a){this._explicitLayoutMode=a,this._layoutMode!==a&&(this._layoutMode=a,this.fire("layoutModeChanged"))},getSnapshotSize:function(){return{w:this.rect.width,h:this.rect.height}},_updateLayoutMode:function(a,b){this._explicitLayoutMode||(this._layoutMode=m.getLayoutMode(a,b),this._horizontalLayoutMode=m.getHorizontalLayoutMode(a),this._verticalLayoutMode=m.getVerticalLayoutMode(b),this.fire("layoutModeChanged"),this.fire("verticalLayoutModeChanged"),this.fire("horizontalLayoutModeChanged"))},_createProviders:function(){var a=this.options;a.providers.colorMap&&(this.providers.colorMap="function"==typeof a.providers.colorMap.clazz?new a.providers.colorMap.clazz(void 0,a.providers.colorMap):new j,this.components.dataArea&&this.components.dataArea.setColorMap(this.providers.colorMap),this.components.colorLegend&&this.components.colorLegend.setColorMap(this.providers.colorMap))},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]);var a;for(a in this.components)this._changeWatchers.push(n.bindProperty(this.components[a],"layoutMode",this,"layoutMode")),this._changeWatchers.push(n.bindProperty(this.components[a],"verticalLayoutMode",this,"verticalLayoutMode")),this._changeWatchers.push(n.bindProperty(this.components[a],"horizontalLayoutMode",this,"horizontalLayoutMode"));this.components.dataArea&&this._changeWatchers.push(n.bindSetter(t.bind(this),this.components.dataArea,"selectableShapes"))},_createComponents:function(){var a,b,c,e=this,f=this.components,j=this.options;Object.keys(j.components).map(function(a){return{sortKey:j.components[a].sortKey||0,cmpKey:a}}).sort(function(a,b){return a.sortKey-b.sortKey}).forEach(function(k){var l=k.cmpKey;if(a=["component",l].join("."),b=j.components[l],b.label=l,b.backendApi=e.backendApi,c=null,"function"==typeof j.components[l].clazz)c=j.components[l].clazz;else switch(l){case"dataArea":case"dataArea2":c=d;break;case"colorLegend":c=g;break;case"colorLegendLight":c=h}c&&(b._disableSelections=j._disableSelections,f[l]=new c(this.container,b,a),f[l].setUseTransition(p.state<2),f[l]instanceof i||this.layoutEngine.addComponent(f[l]))},this)},preLayout:function(){},layout:function(a,b){this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect,a,b)},resize:function(){return this._data&&this.isValid(this._data)?(this.prePaint(this._data),this._paint()):s.resolve()},setSnapshotData:function(a,b){var c=this.getSnapshotSize(),d={};Object.keys(this.components).forEach(function(a){d[a]={visible:this.components[a].isVisible(),dock:this.components[a].dock,size:{w:this.components[a].rect.width,h:this.components[a].rect.height}}},this),a.snapshotData.content={chartData:this.getSnapshotChartData(b),size:{w:c.w,h:c.h},components:d,v:.96}},getSnapshotChartData:function(){var a={};return this.components.colorLegend&&(a.legendScrollOffset=this.components.colorLegend.getScrollPosition()),a},getSnapshotStoredChartData:function(){return this._data&&this._data.snapshotData&&this._data.snapshotData.content?this._data.snapshotData.content.chartData:void 0},_postResize:function(){},_paint:function(){if(!this.isValid(this._data))return this.clear().then(function(){return{invalid:!0}});var a=this.getSnapshotStoredChartData();return this.components.colorLegend&&(this.components.colorLegend.pagingMode=this._pagingMode||0,this._readStoredData&&a&&this.components.colorLegend.setScrollPosition(a.legendScrollOffset||0)),v.call(this),this.$scope.dataAttributes.doesNotFit=this.rect.height<10,this._sizeChanged&&this._postResize(),s.resolve()},paint:function(a,b){return a.qSelectionInfo&&a.qSelectionInfo.qInSelections||!this.isValid(this._data)?s.resolve():this._paint(b)},suppressOnPaint:function(a){var b=this._super(a);return b&&this.prePaint(a),b},prePaint:function(){this.$scope.dataAttributes.layoutMode=this._layoutMode},updateData:function(a){if(this._data=a,!this.isValid(a)||this._madeSelections===!1)return delete this._madeSelections,this.updateSelectableState(a),this.clear();var b=this._updateData(a);return b&&"function"==typeof b.then?b:s.resolve()},_updateData:function(a){var b;this._data=a,this._readStoredData=this.options._readStoredData||a&&a.snapshotData&&a.snapshotData.content&&!this.isEffect&&p.view===p.Views.story,this._selectedRows=[],a.legend&&this.components.colorLegend&&this.components.colorLegend[(a.legend.auto||a.legend.show?"show":"hide")+"Component"](),x.call(this),this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.selections&&this.selections.types.tooltip&&(this.selections.types.tooltip.measureFormatters=this.chartFormatter.getFormatters(),this.selections.types.tooltip.parentScope=this.$scope,this.selections.types.tooltip.colorMap=this.providers.colorMap),this._chartContext.refresh(a);var c=this.isValid(this._data);for(b in this.components)this.components[b]._hasValidData=c;this.updateSelectableState()},destroy:function(){for(this.off();this._changeWatchers.length;)this._changeWatchers.pop().unbind();var a;for(a in this.components)this.components[a].release();for(a in this.providers)this.providers[a].release&&this.providers[a].release();this.$scope.dataAttributes={},this.selections&&this.selections.cache.clear(),this._chartContext.release(),this._data&&p.view!==p.Views.story&&delete this._data.snapshotData,this._super.apply(this,arguments)},clear:function(){var a=[];return Object.keys(this.components).forEach(function(b){a.push(this.components[b].clear())},this),s.all(a)},isValid:function(a){var b,c=!1;c=!!a&&!!a.qHyperCube&&a.qHyperCube.qDimensionInfo.length&&!a.qHyperCube.qDimensionInfo.some(function(a){return!!a.qError})&&a.qHyperCube.qMeasureInfo.length&&!a.qHyperCube.qMeasureInfo.some(function(a){return!!a.qError});for(b in this.components)this.components[b].setHasValidData(c);return c},isDataSelectable:function(a){return this.isValid(this._data)&&this.allowInteraction(p)?a.qHyperCube.qDimensionInfo.some(function(a){return a.qLocked!==!0}):!1},updateSelectableState:function(a){this.selections&&(this.isDataSelectable(a||this._data)?(this.selections.setLocked(!1),this.components.colorLegend&&this.components.colorLegend.setLocked(!1)):(this.selections.setLocked(!0),this.components.colorLegend&&this.components.colorLegend.setLocked(!0)))},on:function(){Object.keys(this.components).forEach(function(a){this.components[a].on()},this),this.updateSelectableState(this._data),this._super()},off:function(){Object.keys(this.components).forEach(function(a){this.components[a].off()},this),this._super()},setInteraction:function(a){a?this.on():this.off()},selectWhileLocked:function(){r.showLockedFeedback(this._data.qHyperCube.qDimensionInfo)}})}),define("objects.views/charts/components/ref-lines",["./chart-component","core.utils/theme","objects.views/charts/utils/canvas-renderer"],function(a,b,c){"use strict";function d(a){return Number(void 0!==a.value?a.value:a)}function e(a){return b.palette[a]?b.palette[a]:a}function f(){if(!this._numRefLinesDataAxes||!this._numAxes)return!1;var a,b,c,e,f,g,h;for(a=0;a<this._numAxes;a+=1)for(c=this._axes[a],g=c.getPlotMin(),h=c.getPlotMax(),this._axisPlotMinValues[a]=g,this._axisPlotMaxValues[a]=h,e=this._data[a]||[],b=0;b<e.length;b+=1)if(f=d(e[b].refLineExpr),e[b]&&e[b].show&&void 0!==e[b].refLineExpr&&null!==f&&!isNaN(f)&&f>=g&&h>=f)return!0;return!1}function g(){var a,b,c,d;for(a=0;a<this._numAxes;a+=1)if(b=this._axes[a],c=b.getPlotMin(),d=b.getPlotMax(),this._axisPlotMinValues[a]!==c||this._axisPlotMaxValues[a]!==d)return!0;return!1}function h(){var a,b;for(a=0;a<this._numAxes;a+=1)b=this._axes[a],this._axisPlotMinValues[a]=b.getPlotMin(),this._axisPlotMaxValues[a]=b.getPlotMax()}var i,j="#333";return i=a.extend("RefLines",{init:function(){this._super.apply(this,arguments),this.renderer=new c(this.container),this.renderer.edgeBleed={top:1,left:1,right:0,bottom:0},this._$renderAreaWrap.addClass("qv-chart-component-reflines"),this._hasVisibleRefLines=!1,this._numAxes=0,this.renderers={lines:this.renderer}},setData:function(){this._super.apply(this,arguments),this._numRefLinesDataAxes=void 0===this._data?0:this._data.length,this._hasVisibleRefLines=f.call(this),h.call(this)},setAxes:function(a){var b=this;this._axes=a,this._axes.forEach(function(a){a.listen("changed",function(){this.invalidateDisplay()},b)}),this._numAxes=void 0===a?0:a.length,(void 0===this._axisPlotMinValues||this._axisPlotMinValues.length!==this._numAxes)&&(this._axisPlotMinValues=new Array(this._numAxes)),(void 0===this._axisPlotMaxValues||this._axisPlotMaxValues.length!==this._numAxes)&&(this._axisPlotMaxValues=new Array(this._numAxes))},isVisible:function(){var a=this._super.apply(this,arguments);return a&&this._numAxes&&this._numRefLinesDataAxes?!0:!1},hasValidData:function(){return this._super()&&this._numRefLinesDataAxes&&this._numAxes},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),g.call(this)&&(this._hasVisibleRefLines=f.call(this),h.call(this)),!this._hasVisibleRefLines)return this.renderer.shapes=[],void this.renderer.clear();var a,b,c,d,i,k,l,m,n,o,p,q,r,s=[];for(a=0;a<this._numRefLinesDataAxes;a+=1)for(c=this._data[a],d=this._axes[a],i=this._axisPlotMinValues[a],
k=this._axisPlotMaxValues[a],b=0;b<c.length;b+=1)c[b].show&&void 0!==c[b].refLineExpr&&(l=this._currentProperties["value"+a+b],null===l||isNaN(l)||l>k||i>l||(m=d.getPositionOfValue(l),m=Math.floor(m)-.5,d.isVertical()?(n=0,o=m,p=this.rect.width,q=m):(n=m,o=0,p=m,q=this.rect.height),r=void 0!==c[b].color?e(c[b].color):j,s.push({type:"line",stroke:r,strokeWidth:1,shape:{x1:n,y1:o,x2:p,y2:q}})));this.renderer.shapes=s,this.renderer.render()},_updateProperties:function(){if(this._data){var a,b,c=this._data,d=c.length;for(a=0;d>a;a++)if(void 0!==c[a])for(b=0;b<c[a].length;b++)this._transitionProperties["value"+a+b]=c[a][b].refLineExpr.value;this._super()}}})}),define("text!objects.views/charts/components/axis/axis-title.ng.html",[],function(){return'<div qva-breadcrumb-bar \r\n     class="qva-breadcrumb-bar" \r\n     fontscale="fs" \r\n     vertical="vertical" \r\n     ng-class="{\'vertical\':vertical, \'horizontal\': !vertical}">\r\n</div>\r\n'}),define("text!objects.views/charts/components/axis/breadcrumb-bar.ng.html",[],function(){return'<div class="qv-breadcrumb" ng-class="{\'vertical\':vertical, \'horizontal\': !vertical}" ng-style="fontStyle">\r\n	<div class="qv-breadcrumb-container" ng-style="containerStyle">\r\n		<span ng-if="dim1">\r\n			<span class="crumb-item" ng-repeat="label in dim1" ng-class="{ \'single-label\': singleLabelMode }">\r\n				<i ng-if="$last && locked0" class="icon-toolbar-locked"></i>\r\n				<span ng-style="getCrumbStyle(hoverIndex === $index, $last, disabled)"\r\n					  ng-mouseover="hoverIndex = $index"\r\n					  ng-mouseout="hoverIndex = -1"\r\n					  ng-class="{\'crumb-button\' : !$last, \'disabled\' : disabled}"\r\n					  qva-activate="onClick($event,0,$index)">\r\n					{{label}}\r\n					<span class="crumb-arrow" ng-if="!$last">\r\n						U\r\n					</span>\r\n				</span>\r\n			</span>\r\n		</span>\r\n		<span ng-if="dim1 && dim2">,&nbsp;</span>\r\n		<span ng-if="dim2">\r\n			<span class="crumb-item" ng-repeat="label in dim2" ng-class="{ \'single-label\': singleLabelMode }">\r\n				<i ng-if="$last && locked1" class="icon-toolbar-locked"></i>\r\n				<span ng-style="getCrumbStyle(hoverIndex === $index, $last, disabled)"\r\n					  ng-mouseover="hoverIndex = $index"\r\n					  ng-mouseout="hoverIndex = -1"\r\n					  ng-class="{\'crumb-button\' : !$last, \'disabled\' : disabled }"\r\n					  qva-activate="onClick($event,1,$index)">\r\n					{{label}}\r\n					<span class="crumb-arrow"\r\n						  ng-if="!$last">\r\n						U\r\n					</span>\r\n				</span>\r\n			</span>\r\n		</span>\r\n	</div>\r\n	<div class="qv-breadcrumb-h-fader" ng-class="{\'hidden\': !hasDrillDown }" ng-style="faderStyleH">&nbsp;</div>\r\n</div>\r\n<div class="qv-breadcrumb-v-fader" ng-class="{\'hidden\': !hasDrillDown }" ng-style="faderStyleV">&nbsp;</div>'}),define("objects.views/charts/components/axis/breadcrumb-bar",["general.utils/color","assets/qvangular/qvangular-core","text!./breadcrumb-bar.ng.html","objects.views/charts/chart-style-service","touche"],function(a,b,c,d){function e(b){var c=i.getValue("",null,"backgroundColor","#ffffff"),d=a.toRGBA(c,0),e=a.toRGBA(c,1);b.fontStyle={"font-size":i.getValue("","axis.title","fontSize"),"font-family":i.getValue("","axis.title","fontFamily"),"font-weight":i.getValue("","axis.title","fontWeight")},b.faderStyleH={background:"linear-gradient(to right, "+e+", "+d+")"},b.faderStyleV={background:"linear-gradient(to right, "+e+", "+d+")"},j.crumbColor={color:i.getValue("","axis.title","color")},j.crumbButtonColor={color:i.getValue("","axis.title","color","inactive")},j.crumbButtonHoverColor={color:i.getValue("","axis.title","color","active")},j.crumbButtonLockedColor={color:i.getValue("","axis.title","color","locked")},j.crumbButtonDisabledColor={color:i.getValue("","axis.title","color","disabled")}}function f(a){var b=a.fontScale;a.containerStyle={"font-size":1*b+"em","line-height":"1em"},a.rightAlign&&!a.singleLabelMode?(a.containerStyle.position="absolute",a.containerStyle.right=k+"px"):a.rightAlign&&(a.containerStyle.width="100%"),a.vertical&&!a.singleLabelMode?a.containerStyle.left="-"+(52+a.verticalLeftShift)+"%":a.vertical&&(a.containerStyle.left="-"+(52-a.verticalLeftShift)+"%")}function g(a,b){return(a?a.length:0)+(b?b.length:0)===1}function h(a,b){return a&&a.length>1||b&&b.length>1}var i=d.getInstance(),j={},k=10;b.directive("qvaBreadcrumbBar",function(){return{template:c,link:function(a,b,c){a.labels1=a.$eval(c.labels1),a.hoverIndex=-1,a.height=b.width(),a.singleLabelMode=!0,a.onClick=function(b,c,d){a.disabled||a.$emit("drill-up",c,d)},a.setDimension=function(b,c){0===b?a.dim1=c:a.dim2=c,a.singleLabelMode=g(a.dim1,a.dim2),a.hasDrillDown=h(a.dim1,a.dim2)},a.getCrumbStyle=function(a,b,c){return c?j.crumbButtonDisabledColor:b?j.crumbColor:a?j.crumbButtonHoverColor:j.crumbButtonColor},e(a),a.$watch("fontScale",function(){f(a,c)}),a.setRelevantSize=function(d){!a.vertical&&b.find(".qv-breadcrumb-container").width()+k>d?a.rightAlign=!0:a.rightAlign=!1,a.vertical&&b.find(".qv-breadcrumb-container").width()>d?a.verticalLeftShift=(b.find(".qv-breadcrumb-container").width()-d)/.02/b.find(".qv-breadcrumb-container").width():a.verticalLeftShift=2,f(a,c)},a.setLocked=function(b,c){a["locked"+b]=c}}}})}),define("objects.views/charts/components/axis/axis-title",["../chart-component-angular","objects.views/charts/utils/canvas-renderer","text!./axis-title.ng.html","objects.views/charts/components/axis/breadcrumb-bar","jquery"],function(a,b,c){"use strict";var d,e=3;return d=a.extend("AxisTitle",{init:function(){var a=this,b=Array.prototype.slice.call(arguments);b.push(c),this._super.apply(this,b),this._type="measure",this._numCrumbs=[1,1],this._showTitle=!0,this._innerScope.fontScale=1,this._innerScope.vertical=!1,this.drillUpRef=this._innerScope.$on("drill-up",function(b,c,d){a._numCrumbs[c]-d>0&&a.fire("drill-up",[b,c,a._numCrumbs[c]-d])})},calculateRelevantSize:function(){this._super();var a={font:"12px 'QlikView Sans'",lineHeight:1.4};this._titleFontHeight=b.getFontHeight(a.font),this.relevantSize=this._titleFontHeight*a.lineHeight+e},setShowStrategy:function(a){this._showTitle=["all","title"].contains(a)},setDock:function(a){this._super(a),this._innerScope.vertical=this.isVertical()},setTitle:function(a){this._title=a},setType:function(a){this._type=a},setData:function(){if(this._super.apply(this,arguments),"dimension"===this._type){this._qDimensionInfo=this._data&&this._data.qHyperCube?this._data.qHyperCube.qDimensionInfo:null;var a,b;a=this._qDimensionInfo?this._qDimensionInfo.length:0,a>0&&3>a?(b=this._qDimensionInfo[0],this._numCrumbs[0]=b.qGroupPos,this._innerScope.setLocked(0,b.qLocked||!1),this._innerScope.setDimension(0,b.qGroupFallbackTitles.slice(0,b.qGroupPos+1)),1===a?this._innerScope.setDimension(1,!1):(b=this._qDimensionInfo[1],this._numCrumbs[1]=b.qGroupPos,this._innerScope.setLocked(1,b.qLocked||!1),this._innerScope.setDimension(1,b.qGroupFallbackTitles.slice(0,b.qGroupPos+1)))):(this._innerScope.setDimension(0,!1),this._innerScope.setDimension(1,!1))}},setFont:function(a){this._style&&(this._style.font=a)},isVisible:function(){return this._super.apply(this,arguments)&&this._showTitle},on:function(){this._innerScope.disabled=!1},off:function(){this._innerScope.disabled=!0},paint:function(){this._innerScope.fontScale=this.chartScale,this._innerScope.setRelevantSize(this.isVertical()?this.rect.height:this.rect.width),this._innerScope.$digest()},release:function(){this._super(),this.drillUpRef()}})}),define("objects.views/charts/components/grid",["./chart-component","objects.views/charts/utils/canvas-renderer","objects.views/charts/chart-style-service"],function(a,b,c){function d(a,b,c,d,e,f,g){var h,i,j,k;return g?(h=0,i=d,j=a,k=a):(h=a,i=a,j=0,k=e),{type:"line",opacity:c,strokeWidth:f,shape:{x1:h,x2:i,y1:j,y2:k},stroke:b}}function e(a,b){var c,e,f,g,i=a.ticks,j=a.minorTicks,k=i?i.length:0,l=j?j.length:0,m=a.getSpacingMode()===h.DENSE,n=a.getSpacingMode()===h.SPARSE?2:1,o=b.rect.height,p=b.rect.width,q=b.style,r=[];if(a.getSpacingMode()===h.NONE||!i)return[];for(g=0;k>g;g+=1)e=i[g].position,c=i[g].value,f=i[g].opacity,(g%n===0||0===c)&&(0===c?r.push(d(e,q.zero.color,f,p,o,q.zero.width,a.isVertical())):r.push(d(e,q.major.color,f,p,o,q.major.width,a.isVertical())));if(m&&j)for(g=0;l>g;g+=1)e=j[g].position,r.push(d(e,q.minor.color,1,p,o,q.minor.width,a.isVertical()));return r}function f(a,b){var c="",d=a.layoutMap[b]||"medium",e={ticks:{major:{color:a.getValue(c,"axis.grid.major","color",d),width:a.getValue(c,"axis.grid.major","width",d)},minor:{color:a.getValue(c,"axis.grid.minor","color",d),width:a.getValue(c,"axis.grid.major","width",d)},zero:{color:a.getValue(c,"axis.grid.zero","color",d),width:a.getValue(c,"axis.grid.major","width",d)}}};return e}var g,h;return h={NONE:0,SPARSE:1,NORMAL:1,DENSE:3},g=a.extend("Grid",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._styleService=c.getInstance(),this._style=f(this._styleService,this._layoutMode),this._renderer=new b(this.container),this._renderer.edgeBleed={top:1,left:1,bottom:0,right:0},this._$renderAreaWrap.addClass("qv-chart-component-grid"),this.renderers={gridlines:this._renderer}},afterRenderLines:function(){},setAxes:function(a,b){this._primaryHorizontalAxis!==a&&(this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",null,this),this._primaryHorizontalAxis=a,this._primaryHorizontalAxis.listen("changed",function(){this.invalidateDisplay("Grid.setAxes")},this)),this._primaryVerticalAxis!==b&&(this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",null,this),this._primaryVerticalAxis=b,this._primaryVerticalAxis.listen("changed",function(){this.invalidateDisplay("Grid.setAxes")},this))},hasValidData:function(){return this._super()&&this._primaryVerticalAxis&&this._primaryHorizontalAxis},paint:function(a,b){this._super(a,b);var c;return this._primaryVerticalAxis.updateNow(),this._primaryHorizontalAxis.updateNow(),c=e(this._primaryVerticalAxis,{rect:this.rect,style:this._style.ticks}),c=c.concat(e(this._primaryHorizontalAxis,{rect:this.rect,style:this._style.ticks})),this.afterRenderLines(c),this._renderer.shapes=c,this._renderer.render(),this},release:function(){this._super(),this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",null,this),this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",null,this)}})}),define("objects.views/charts/axis-chart",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.views/charts/components/ref-lines","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/axis/axis-title","objects.views/charts/components/grid","general.utils/property-resolver"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,b){b&&"auto"!==h.getValue(b,"legend.dock","auto")?a.setDock(b.legend.dock):a.outerRect.height/a.outerRect.width<1?a.setDock("right"):a.setDock("bottom")}var j;return j=b.extend({init:function(b,h,i,j){var k=a.extend(!0,{components:{grid:{show:!0,dock:"center",showFlag:c.prototype.ShowFlags.XSMALL,clazz:g},refLines:{clazz:d},colorLegend:{show:!0,order:4,reductionOrder:1,dock:"right",relevantSize:126,showFlag:c.prototype.ShowFlags.MEDIUM},xAxis:{show:!0,order:1,dock:"bottom",relevantSize:120,showFlag:c.prototype.ShowFlags.XSMALL,clazz:e},yAxis:{show:!0,order:1,dock:"left",relevantSize:90,reductionOrder:2,showFlag:c.prototype.ShowFlags.XSMALL,clazz:e},xAxisTitle:{show:!0,order:1.1,dock:"bottom",relevantSize:30,reductionOrder:1,showFlag:c.prototype.ShowFlags.SMALL,clazz:f}}},i||{});this._super(b,h,k,j)},_updateData:function(a,b){this._super.apply(this,[].slice.call(arguments)),this.updateDataArea(a,b),this.updateAxis(a,b),this.updateLegend(a,b),this.updateGrid(a,b),this.updateRefLines(a,b)},updateDataArea:function(a,b){var c,d;for(c in b.axes)d=b.axes[c],d.component.setDataIndices(d.dataIndices||[d.dataIndex||0]),d.component.setCurrentDataIndices(d.currentDataIndices||d.dataIndices||[d.dataIndex||0])},setAxisDataRange:function(a,b,c,d,e,f){var g,h;null!==d&&null!==e||null===d&&null===e?(g=c,h=b):null!==d&&c>=d?(g=d-f,h=b):null!==e&&e>=b?(g=c,h=e+f):(g=c,h=b),a.setDataRange(g,h),this.components.miniChart&&this.components.miniChart.components.measureAxis.setDataRange(g,h)},updateAxis:function(a,b){var c,d,e,f=b.axes,g=this.components.miniChart;for(c in b.axes)d=f[c],d.component.setTitle(d.title),d.component.setShowStrategy(d.data.show),d.component.setLabelMode(d.data.label),d.component.setLockedInfo&&d.component.setLockedInfo(a.qHyperCube.qDimensionInfo.map(function(a){return a.qLocked===!0})),d.component.setPlotMin&&(e=this.getAxisOptions(d),d.component.setPlotMin(e.min),d.component.setPlotMax(e.max),d.component.setTickMultiplier(d.data.spacing),d.component.setLogScale(d.data.logarithmic),g&&(e=this.getAxisOptions(d),g.components.measureAxis.setPlotMin(e.min),g.components.measureAxis.setPlotMax(e.max))),d.component.isVertical()?d.component.setDock("far"===d.data.dock?"right":"left"):d.component.setDock("far"===d.data.dock?"top":"bottom");for(c in b.axisTitles)d=b.axisTitles[c],d.component.setTitle(d.title),d.component.setShowStrategy(d.data.show),d.component.isVertical()?d.component.setDock("far"===d.data.dock?"right":"left"):d.component.setDock("far"===d.data.dock?"top":"bottom")},getAxisOptions:function(a){return a&&a.data?a.data.autoMinMax?{min:null,max:null}:{min:["min","minMax"].contains(a.data.minMax)?Number(a.data.min):null,max:["max","minMax"].contains(a.data.minMax)?Number(a.data.max):null}:void 0},_postResize:function(){this._super(),i.apply(this,[this.components.colorLegend,this._data])},updateLegend:function(){this.components.colorLegend&&i.apply(this,[this.components.colorLegend,this._data])},updateGrid:function(a,b){if(this.components.grid){var c,d;if(a.gridLine&&"number"==typeof a.gridLine.spacing){d=a.gridLine.auto?2:a.gridLine.spacing;for(c in b.axes)b.axes[c].component.setSpacingMode&&b.axes[c].component.setSpacingMode(d)}}},updateRefLines:function(a,b){var c,d=b.refLineLabels,e=[],f=[];for(c in d)d[c].component&&(d[c].component.setData(d[c].data),d[c].component.setAxis(d[c].axis),d[c].component.setDock(d[c].axis.getOppositeDock()),f.push(d[c].axis),e.push(d[c].data));b.refLines&&b.refLines.component&&(b.refLines.component.setAxes(f),b.refLines.component.setData(e))}})}),define("objects.views/charts/components/scroll-area",["./chart-component","objects.utils/shapes/rect","client.utils/state","jquery","touche"],function(a,b,c,d){function e(a){var c,d=this,e=this.isVertical(),f={size:e?"height":"width",pos:e?"y":"x",coord:e?"pageY":"pageX"},g=new b(0,0,0,0),h=d._$renderAreaWrap.offset();g.x=h.left,g.y=h.top,g.width=d._$renderAreaWrap.width(),g.height=d._$renderAreaWrap.height(),this.fire("scrollStart"),c=a.points[0][f.pos]-g[f.pos]-d.scrollRect[f.size]*g[f.size]/2,d.scrollRect[f.pos]=Math.max(0,Math.min(g[f.size]*(1-d.scrollRect[f.size]),c))/g[f.size],d.setOffset(d.scrollRect[f.pos]*d.fullState.max)}function f(a){var c=this,d=this.isVertical(),e={size:d?"height":"width",pos:d?"y":"x",coord:d?"pageY":"pageX"},f=c._$renderAreaWrap.offset();this._containerRect=new b(0,0,0,0),this._containerRect.x=f.left,this._containerRect.y=f.top,this._containerRect.width=c._$renderAreaWrap.width(),this._containerRect.height=c._$renderAreaWrap.height(),c.scrollRect[e.size]=c.viewState.range/c.fullState.max,this._rp=a.points[0][e.pos]-this._containerRect[e.pos]-c.scrollRect[e.pos]*this._containerRect[e.size],this._rp<0?(c.scrollRect[e.pos]=Math.max(0,c.scrollRect[e.pos]-this._rp/this._containerRect[e.size]),this._rp=0):this._rp/this._containerRect[e.size]>c.scrollRect[e.size]&&(c.scrollRect[e.pos]=Math.min(1,this._rp/this._containerRect[e.size])-c.scrollRect[e.size],this._rp=c.scrollRect[e.size]*this._containerRect[e.size]),this.fire("scrollStart")}function g(a){var b=this,c=this.options,d=this.isVertical(),e="function"==typeof c.onScroll?c.onScroll:function(){},f={size:d?"height":"width",pos:d?"y":"x",coord:d?"pageY":"pageX"},g=a.points[0][f.pos]-this._containerRect[f.pos];b.scrollRect[f.pos]=Math.max(0,Math.min(this._containerRect[f.size]*(1-b.scrollRect[f.size]),g-this._rp))/this._containerRect[f.size],b.setOffset(b.scrollRect[f.pos]*b.fullState.max),e()}function h(){if(this.miniChart){var a=this;Touche(this.miniChart.container).tap({id:n,end:function(b,c){e.call(a,c)}}),Touche(this.miniChart.container).swipe({id:n,options:{radiusThreshold:1},start:function(b,c){f.call(a,c)},update:function(b,c){g.call(a,c)}})}}function i(){this.miniChart&&(d(this.miniChart.container).off(n),Touche(this.miniChart.container).off("*",n))}function j(){this.miniChart&&(this._internalUseMiniChart?this.miniChart.showComponent():this.miniChart.hideComponent())}function k(a,b){var c=this.viewState.min;this.viewState.min=Math.max(0,Math.min(this._explicitOffset||0,(this.fullState.max||0)-(this.viewState.range||0))),this.viewState.min!==c&&(this.invalidateDisplay(a),b&&this.fire("offsetChanged"))}function l(a,b,c){var d=Array.isArray(a)?a:[a];d.forEach(function(a){c.forEach(function(b){a.style[b]=""}),a.className=b})}var m,n=".scrollarea";return m=a.extend("ScrollArea",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._useMiniChart=!0,this._internalUseMiniChart=!0,this._miniChartThreshold=.5,this._miniChartMinimunNumberOfBars=3,this.scrollRect=new b(0,0,0,0),this.fullState={min:0,max:20},this.viewState={min:0,range:10},this._$renderAreaWrap.addClass("qv-chart-component-scroll-area"),this.before=document.createElement("div"),this.bar=document.createElement("div"),this.after=document.createElement("div"),this.before.style.position="absolute",this.bar.style.position="absolute",this.after.style.position="absolute",this.before.style.backgroundColor=this.after.style.backgroundColor="rgba(0,0,0,0.1)",this.bar.style.marginTop="-1px",d(this.before).attr("tid","component.scrollArea.before"),d(this.bar).attr("tid","component.scrollArea.bar"),d(this.after).attr("tid","component.scrollArea.after"),this.container.appendChild(this.before),this.container.appendChild(this.bar),this.container.appendChild(this.after)},on:function(){var a=this;Touche(this.container).tap({id:n,end:function(b,d){c.isInEditMode()||e.call(a,d)}}),Touche(this.container).swipe({id:n,options:{radiusThreshold:1},start:function(b,d){c.isInEditMode()||f.call(a,d)},update:function(b,d){c.isInEditMode()||g.call(a,d)}}),h.call(this)},off:function(){d(this.container).off(n),Touche(this.container).off("*",n),i.call(this)},calculateRelevantSize:function(){var a,b=Touche.utils.touch?32:16;this.miniChart&&this._useMiniChart&&(this.miniChart.calculateRelevantSize(),a=this.miniChart.relevantSize,this._internalUseMiniChart=!0,j.apply(this)),this.relevantSize=this._internalUseMiniChart?a||16:b},insertAdjacentTo:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setRect:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setDock:function(a){this._super(a),this.miniChart&&this.miniChart.setDock(a)},getOffset:function(){return this.viewState.min},setOffset:function(a){this._explicitOffset=a,k.call(this,"ScrollArea.setOffset")},setMiniChart:function(a){i.call(this),this.miniChart=a,this.miniChart&&(this.miniChart.setDock(this.options.dock),j.apply(this)),c.isInEditMode()||a.backendApi.isSnapshot||h.call(this),this.invalidateDisplay("ScrollArea.setMiniChart")},setUseMiniChart:function(a){this._useMiniChart=a,this._internalUseMiniChart=a,j.apply(this),this.invalidateDisplay("ScrollArea.setUseMiniChart")},getUseMiniChart:function(){return this._useMiniChart},setViewRange:function(a){this.viewState.range=a,k.call(this,"ScrollArea.setViewRange",!0),this.invalidateDisplay("ScrollArea.setViewRange")},getViewRange:function(){return this.viewState.range},setSpaces:function(a){this._spaces=a},setDataRange:function(a){this.dataRange=a,this.invalidateDisplay("ScrollArea.setDataRange")},getDataRange:function(){return this.dataRange},setFullRange:function(a){this.fullState.max=a,k.apply(this,["ScrollArea.setFullRange",!0]),this.invalidateDisplay("ScrollArea.setFullRange")},isVisible:function(a){return this._super(a)&&this.viewState.range<this.fullState.max},setOuterRect:function(a,b,c,d){this._super(a,b,c,d),this.miniChart&&this.miniChart.setOuterRect(a,b,c,d)},setLayoutToContainerRatios:function(a,b){this._super(a,b),this.miniChart&&this.miniChart.setLayoutToContainerRatios(a,b)},setContainerRect:function(a,b,c,d){this._super(a,b,c,d),this.miniChart&&this.miniChart.setContainerRect(a,b,c,d)},updateSize:function(){this._super(),this.miniChart&&this._internalUseMiniChart&&this.miniChart.isVisible()?(this.before.style.display="block",this.bar.style.border="1px solid rgba(0,0,0,0.4)",this.bar.style.backgroundColor="transparent",this.after.style.display="block",this.isVertical()?l.apply(this,[[this.before,this.bar,this.after],"qv-chart-scrollable-mini-chart-vertical",["width","left"]]):(l.apply(this,[[this.before,this.after],"qv-chart-scrollable-mini-chart-horizontal",["height","top"]]),l.apply(this,[this.bar,"qv-chart-scrollable-mini-chart-bar-horizontal",["height","top"]]))):(this.before.style.display="none",this.bar.style.backgroundColor="rgba(0,0,0,0.2)",this.bar.style.boxShadow="none",this.bar.style.border="none",this.after.style.display="none",this.isVertical()?l.apply(this,[this.bar,"qv-chart-scrollable-vertical",["width","left"]]):l.apply(this,[this.bar,"qv-chart-scrollable-horizontal",["height","top"]]))},paint:function(a,b){var c;this.bar.style.display="block",this._super(a,b),this.scrollRect[this.isVertical()?"height":"width"]=this.viewState.range/this.fullState.max,this.scrollRect[this.isVertical()?"y":"x"]=this.viewState.min/this.fullState.max,c=this.scrollRect[this.isVertical()?"height":"width"]*this.rect[this.isVertical()?"height":"width"],c=1>c?1:c,c=100*c/this.rect[this.isVertical()?"height":"width"],this.isVertical()?(d(this.before).css({height:100*this.scrollRect.y+"%",top:"0%"}),d(this.bar).css({top:100*this.scrollRect.y+"%",height:c+"%"}),d(this.after).css({top:100*this.scrollRect.y+c+"%",height:100-(100*this.scrollRect.y+c)+"%"})):(d(this.before).css({width:100*this.scrollRect.x+"%",left:"0%"}),d(this.bar).css({left:100*this.scrollRect.x+"%",width:c+"%"}),d(this.after).css({left:100*this.scrollRect.x+c+"%",width:100-(100*this.scrollRect.x+c)+"%"}))},clear:function(){this.bar.style.display="none"}}),Object.defineProperty(m.prototype,"className",{value:"ScrollArea"}),m}),define("objects.views/charts/utils/label-positioner",[],function(){"use strict";var a;return a={positionRectanglesAlongAxis:function(a,b,c,d,e){function f(){if(0===r)return s=[],void(t=0);var c,d,e,f,g;for(s=[[0]],c=1;r>c;c++)d=a[c].position,e=a[c].size,f=a[c-1].position,g=a[c-1].size,f+g/2+b>d-e/2?s[s.length-1].push(c):s.push([c]);t=s?s.length:0}function g(){0!==r&&(h(),i(),k(),u=j(),u||l())}function h(){var d,e,f,g,h;for(e=a[0].position,f=a[0].size,e=Math.max(c,e-f/2)+f/2,a[0].newPosition=e,d=1;r>d;d++)g=a[d-1].newPosition,h=a[d-1].size,e=a[d].position,f=a[d].size,e=Math.max(g+h/2+b,e-f/2)+f/2,a[d].newPosition=e}function i(){var e,f,g,h,i;if(f=a[r-1].newPosition,g=a[r-1].size,f+g/2>d)for(a[r-1].newPosition=d-g/2-c,e=r-2;e>=0;e--)h=a[e+1].newPosition,i=a[e+1].size,f=a[e].newPosition,g=a[e].size,f=Math.min(h-i/2-b,f+g/2)-g/2,a[e].newPosition=f}function j(){var d,e,f,g=a[0].newPosition,h=a[0].size;if(c>g-h/2)return!0;if(g-h/2>c)return!1;for(d=1;r>d;d++)if(e=a[d-1].newPosition,f=a[d-1].size,g=a[d].newPosition,h=a[d].size,g-h/2>e+f/2+b)return!1;return!0}function k(){var b,c,d,e,f,g,h,i,j,k,l,m;for(v&&v.length===t||(v=new Array(t)),b=0;t>b;b+=1)c=s[b],d=c[0],e=c[c.length-1],f=a[d],g=a[e],j=f.position,h=f.size,l=f.newPosition-h/2,k=g.position,i=g.size,m=g.newPosition+i/2,v[b]={firstPosition:j,lastPosition:k,minPosition:l,maxPosition:m}}function l(){m(0,c);for(var a=1;t>a;a++)m(a,v[a-1].maxPosition+b)}function m(a,b){var c=s[a];c.length%2===0?n(a,b):o(a,b)}function n(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,q;d=s[b],e=d[0],f=d[d.length/2-1],g=d[d.length/2],h=a[e],i=a[f],j=a[g],l=h.newPosition,k=h.size,n=(i.position+j.position)/2,o=(i.newPosition+j.newPosition)/2,q=o-n,m=l-q,p(b,l,m,k,c)}function o(b,c){var d,e,f,g,h,i,j,k,l,m,n;d=s[b],e=d[0],f=d[(d.length-1)/2],g=a[e],h=a[f],i=g.newPosition,j=g.size,k=h.position,l=h.newPosition,m=l-k,n=i-m,p(b,i,n,j,c)}function p(a,b,c,d,e){if(!(c>=b)){c=Math.max(e+d/2,c);var f=b-c;v[a].minPosition-=f,v[a].maxPosition-=f,q(a,f)}}function q(b,c){var d,e,f,g=s[b],h=g?g.length:0;for(d=0;h>d;d++)e=g[d],f=a[e],f.newPosition-=c}var r,s,t,u,v;r=a?a.length:0,e!==!0&&a.sort(function(a,b){return a.position>b.position?1:-1}),f(),g()}}}),define("objects.views/charts/components/ref-line-labels",["./chart-component","core.utils/theme","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/label-positioner","util"],function(a,b,c,d,e){"use strict";function f(a){var b,d,e,f,g=a?a.length:0;for(b=0;g>b;b++)d=a[b],e=d.shapeWrapper,f=c.measureTextObject(e),d.size=f.height,d.info=f}function g(a){return b.palette[a]?b.palette[a]:a}function h(a,b,c,d,e,f){return void 0===e&&(e=Number.MAX_VALUE),void 0===f&&(f=1),{type:"text",fill:"black",shape:{text:a,font:b,x:c,y:d,align:L,baseline:M,maxWidth:e,maxNumLines:f}}}function i(a){if(void 0===a||""===a)return 0;F.shape.text=a;var b=c.measureTextObject(F);return b.width}function j(a){return void 0===a||""===a?0:(H.shape.text=a,c.measureTextObject(H))}function k(a){if(void 0===a||""===a)return 0;G.shape.text=a;var b=c.measureTextObject(G);return b.width}function l(a,b){return void 0===a||""===a?{numLines:0,width:0,height:0,lines:[]}:(G.shape.text=a,G.shape.maxWidth=b,c.measureTextObject(G))}function m(a,b,c){if(void 0===a||""===a)return{index:-1,width1:0,width2:0,width:0};void 0===b&&(b=i(a));for(var d,e,f,g,h=Number.MAX_VALUE,j=a.length,k=Math.floor(j/2),l=a.substring(0,k),m=0,n=!0,o=l.lastIndexOf(" ");o>-1&&n;)l=a.substring(0,o),d=i(l),e=b-d-c,f=Math.max(d,e),f>h?n=!1:(h=f,m++,g={index:o,width1:d,width2:e,width:h},o=l.lastIndexOf(" "));if(m>1)return g;for(o=a.indexOf(" ",k),m=0;o>-1;){if(l=a.substring(o+1),e=i(l),d=b-e-c,f=Math.max(d,e),f>h)return g;h=f,m++,g={index:o,width1:d,width2:e,width:h},o=a.indexOf(" ",o+1)}return void 0===g&&(g={index:-1,width1:0,width2:b,width:b}),g}function n(a,b,c){if(void 0===a||""===a)return{index1:-1,index2:-1,width1:0,width2:0,width3:0,width:0};void 0===b&&(b=i(a));for(var d,e,f,g,h,j,k,l=Number.MAX_VALUE,n=a.length,o=Math.floor(n/3),p=a.substring(0,o),q=0,r=!0,s=p.lastIndexOf(" ");s>-1&&r;)p=a.substring(0,s),d=a.substring(s+1),f=i(d),e=b-f-c,j=m(d,f,c),h=j.width,g=Math.max(e,h),g>l?r=!1:(l=g,q++,k={index1:s,index2:j.index,width1:e,width2:j.width1,width3:j.width2,width:l},s=p.lastIndexOf(" "));if(q>1)return k;for(s=a.indexOf(" ",o),q=0;s>-1;){if(d=a.substring(s+1),f=i(d),e=b-f-c,j=m(d,f,c),h=j.width,g=Math.max(e,h),g>l)return k;l=g,q++,k={index1:s,index2:j.index,width1:e,width2:j.width1,width3:j.width2,width:l},s=a.indexOf(" ",s+1)}return void 0===k&&(k={index1:-1,index2:-1,width1:0,width2:0,width3:b,width:b}),k}function o(a,b,c,d,e){var f;if(c>=b)return{minTextWidth:b,level:1};if(2*c>=b){if(f=m(a,b,d),f.width<=c)return{minTextWidth:f.width,level:0===f.width1?3:2};if(0===f.width1)return{minTextWidth:Math.ceil(f.width/2)+e,level:3}}return 3*c>b?(f=n(a,b,d),0===f.width1&&0===f.width2?{minTextWidth:Math.min(Math.ceil(f.width/3)+Math.ceil(3*e/2),c),level:3}:{minTextWidth:Math.min(f.width,c),level:3}):{minTextWidth:c,level:3}}function p(a,b,c,d,e,f){a.size=b,a.size2=c,a.numLines=d,a.level=e,a.info=f}function q(a,b,c,d){if(!(a.size/2<=b||3===a.numLines||3===a.level)){var e,f;if(2===a.numLines)return e=n(a.text,a.singleLineTextWidth,c),f=l(a.text,e.width),void p(a,e.width,f.height,f.numLines,3,f);if(e=m(a.text,a.singleLineTextWidth,c),0!==e.width1){if(e.width/2<=b||d===!0)return f=l(a.text,e.width),void p(a,e.width,f.height,f.numLines,2,f);e=n(a.text,a.singleLineTextWidth,c),f=l(a.text,e.width),p(a,e.width,f.height,f.numLines,3,f)}}}function r(a,b,c,d){var e,f;a.position+a.size/2+c>b.position-b.size/2&&(a.size>b.size?(e=a,f=b.position-b.size/2-c-a.position):(e=b,f=b.position-(a.position+a.size/2+c)),q(e,f,d,!0))}function s(a,b,c,d,e,f,g){a.singleLineTextWidth=b,a.size=c,a.size2=d,a.numLines=e,a.level=f,a.info=g}function t(a){return String(void 0!==a.label?a.label:a)}function u(a,b){var c=a,d=e.escapeRegExp("+-"+(this.chartFormatter.getLocaleInfo().qDecimalSep||"")+(this.chartFormatter.getLocaleInfo().qThousandSep||"")),f=c.replace(new RegExp("[0-9e"+d+"]","g"),"");return f=f.length?c:this._axis.format(b)}function v(a){if(this._axis&&this._data){this._axis.updateFormatter();var b,c,d,e,f,g,h=this._data?this._data.length:0,i=[],j=this._axis.getPlotMin(),k=this._axis.getPlotMax(),l=-Number.MAX_VALUE,m=Number.MAX_VALUE,n=0,o=0;for(this._plotMinValueForRelevantSize=j,this._plotMaxValueForRelevantSize=k,this._maxLowerLabelIndex=void 0,this._minUpperLabelIndex=void 0,b=0;h>b;b+=1)this._data[b]&&this._data[b].show&&void 0!==this._data[b].refLineExpr&&(c=t(this._data[b].refLineExpr),d=a?this._currentProperties["value"+b]:this._data[b].refLineExpr.value,null===d||isNaN(d)||(j>d?(n++,d>l&&(this._maxLowerLabelIndex=b)):d>k?(o++,m>d&&(this._minUpperLabelIndex=b)):(e=this._data[b].label,f=" ("+u.apply(this,[c,d])+")",g=e+f,i.push({index:b,text:g,value:d,text1:e,text2:f}))));o>0&&i.push({index:-1,text:10>o?o.toString():"9+",value:"max",type:1}),n>0&&i.push({index:-2,text:10>n?n.toString():"9+",value:"min",type:-1}),this._labelObjects=i,this._numLabelObjects=this._labelObjects?this._labelObjects.length:0,this._labelsMaxWidthNeedToUpdate=!0,this._labelsMaxHeightNeedToUpdate=!0,this._labelObjectsNeedToUpdate=!1,this._numLowerLabels=n,this._numUpperLabels=o}}function w(){if(this._labelsMaxWidthNeedToUpdate){this._labelsMaxWidthNeedToUpdate=!1;var a,b,c,d=0;for(G.shape.maxWidth=this._labelMaxWidthForYAxis,a=0;a<this._numLabelObjects;a++)if(void 0!==this._labelObjects[a].type?(b=j(this._labelObjects[a].text),c=z(b),d=Math.max(d,c+4)):d=Math.max(d,k(this._labelObjects[a].text)+4),d>=this._labelMaxWidthForYAxis)return void(this._labelsMaxWidth=this._labelMaxWidthForYAxis);this._labelsMaxWidth=d}}function x(a){return"max"===a?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.5+(this.isVertical()?-.1:.1):"min"===a?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.5+(this.isVertical()?.1:-.1):Math.floor(this._axis.getPositionOfValue(a))-.5}function y(){var a,b,c;for(a=0;a<this._numLabelObjects;a+=1)b=this._labelObjects[a],c=x.call(this,b.value),b.position=c}function z(a){return Math.sqrt(a.width*a.width+a.height*a.height)}function A(){if(this._labelsMaxHeightNeedToUpdate){this._labelsMaxHeightNeedToUpdate=!1,y.call(this);var a,b,c,e=0;for(this.calculateLabelWidths(this._labelObjects,this._componentWidth,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),d.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this._componentWidth,!0),a=0;a<this._numLabelObjects;a+=1)void 0!==this._labelObjects[a].type?(b=j(this._labelObjects[a].text),c=z(b),e=Math.max(e,c)):e=Math.max(e,this._labelObjects[a].size2);this._labelsMaxHeight=e}}function B(a){var b,c,d=0,e=a.length-1;for(b=0;e>b;b++)c=a[b],d+="-"===c.substr(c.length-1,1)?c.length-1:c.length+1;return d}function C(a,b){I.shape.text=a,I.shape.maxWidth=b;var d=c.measureTextObject(I);return d.lines[0]}function D(a){var b,c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s=a?a.length:0;for(b=0;s>b;b++)c=a[b],d=c.info,d&&d.truncated===!0&&(e=d.lines,f=c.text,g=c.text1,h=c.text2,l=e[e.length-1],m=B(e),n=f.indexOf(l.substring(0,l.length-1),m),0>n||(j=g.substring(n),r=i(h),q=d.width-r-2,P>q?p=g.substring(0,n):(k=C(j,q),o=n+k.length-1,p=g.substring(0,o)+P),c.text=p+h,c.shapeWrapper.shape.text=c.text));
}var E,F,G,H,I,J,K,L="center",M="bottom",N="#333",O="#737373",P="…",Q=2;return E=a.extend("RefLineLabels",{init:function(){this._super.apply(this,arguments),this.renderer=new c(this.container),this._currentProperties={},this._transitionProperties={},this.renderers={labels:this.renderer},this._$renderAreaWrap.addClass("qv-chart-component-reflinelabels"),this._hasVisibleRefLines=!1,this._font="12px 'QlikView Sans'",this._font2="10px 'QlikView Sans'",this._labelMargin=4,this._labelMaxWidthForYAxis=70,this._labelMaxWidthForXAxis=100,this._labelMaxHeightForXAxis=50,this._verticaLabelGap=4,this._horizontalLabelGap=6,this._boundaryGap=4,F=h("",this._font,0,0,Number.MAX_VALUE,1),G=h("",this._font,0,0,Number.MAX_VALUE,3),H=h("",this._font2,0,0,Number.MAX_VALUE,1),I=h("",this._font,0,0,Number.MAX_VALUE,1)},calculateRelevantSize:function(){if(this._super(),v.call(this),this.isVertical())w.call(this),this.relevantSize=this._labelsMaxWidth+this._labelMargin;else{var a=this.rect.width?this.rect.width:this._axis._plotSize;this._componentWidth!==a&&(this._componentWidth=a,this._labelsMaxHeightNeedToUpdate=!0),A.call(this),this.relevantSize=this._labelsMaxHeight+this._labelMargin}},calculatePreliminaryRelevantSize:function(){this.relevantSize=this.isVertical()?this._labelMaxWidthForYAxis:this._labelMaxHeightForXAxis},setData:function(){this._super.apply(this,arguments),this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues(),this._labelObjectsNeedToUpdate=!0},setAxis:function(a){var b=this;this._axis=a,this._axis.listen("changed",function(){this.invalidateDisplay()},b),this._labelObjectsNeedToUpdate=!0},isVisible:function(){var a=this._super.apply(this,arguments);return a?(this._axis&&(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues()),this._hasVisibleRefLines):!1},calculateLabelWidths:function(a,b,c,d,e){var f,g,h,j,k,m,n,p=a?a.length:0;if(0!==p){for(J=i("m m")-i("mm"),K=i("m"),f=0;p>f;f++)h=a[f],j=h.text,void 0===j||""===j?s(h,0,0,0,0,0,void 0):(k=i(j),m=o(j,k,e,J,K),n=l(j,m.minTextWidth),s(h,k,m.minTextWidth,n.height,n.numLines,m.level,n));for(a.sort(function(a,b){return a.position>b.position?1:-1}),h=a[p-1],void 0!==h.text&&""!==h.text&&q(h,b-h.position-d,J),h=a[0],void 0!==h.text&&""!==h.text&&q(h,h.position-d,J),f=0;p-1>f;f++)if(void 0!==a[f].text&&""!==a[f].text&&void 0!==a[f+1].text&&""!==a[f+1].text)for(g=0;4>g;g++)r(a[f],a[f+1],c,J)}},checkIfHavingVisibleRefLines:function(){if(!this._data||0===this._data.length||!this._axis)return!1;var a;for(a=0;a<this._data.length;a+=1)if(this._data[a]&&this._data[a].show&&void 0!==this._data[a].refLineExpr){if("value"in this._data[a].refLineExpr&&(null===this._data[a].refLineExpr.value||isNaN(this._data[a].refLineExpr.value)))continue;return!0}return!1},updateLocalPlotMaxMinValues:function(){this._axis&&(this._plotMinValue=this._axis.getPlotMin(),this._plotMaxValue=this._axis.getPlotMax())},setLabelMargin:function(a){this._labelMargin=void 0===a?4:a},hasValidData:function(){return this._super()&&this._data&&this._axis},paint:function(){if(this._super.apply(this,arguments),(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues()),this._hasVisibleRefLines){v.call(this,!0);var a,b,e,h,i,j,k,l,m,n,o,p,q,r=this.isVertical()?"middle":"top"===this.dock?"bottom":"top",s="middle",t=this.rect.width,u=this.rect.height,w=t/2+this._labelMargin/2+1,y="top"===this.dock?u-this._labelMargin:this._labelMargin,A=new Array(this._numLabelObjects),B=this._labelMaxWidthForYAxis,C=this._font,E=w,F="top"===this.dock?(u-this._labelMargin)/2:(u+this._labelMargin)/2;for(a=0;a<this._numLabelObjects;a+=1)p=this._labelObjects[a],b=p.index,e=x.call(this,p.value),this.isVertical()?(h=w,i=e):(h=e,i=void 0!==p.type?F:y),j=b>-1&&void 0!==this._data[b].color?g(this._data[b].color):N,void 0!==p.type?(C=this._font2,q=s,j="white"):(C=this._font,q=r),k={type:"text",fill:j,shape:{text:p.text,x:h,y:i,align:"center",baseline:q,font:C,maxWidth:B,maxNumLines:3}},A[a]=k,p.position=e,p.shapeWrapper=k;if(0!==this._numLabelObjects){if(this.isVertical()){for(f(this._labelObjects),this._numUpperLabels>0&&(e=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.7,this._labelObjects.push({position:e,size:Q})),this._numLowerLabels>0&&(e=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.3,this._labelObjects.push({position:e,size:Q})),d.positionRectanglesAlongAxis(this._labelObjects,this._verticaLabelGap,this._boundaryGap,this.rect.height,!1),a=this._labelObjects.length-1;a>-1;a--)void 0===this._labelObjects[a].shapeWrapper&&this._labelObjects.splice(a,1);for(a=0;a<this._numLabelObjects;a+=1)p=this._labelObjects[a],l=p.shapeWrapper.shape,l.y=p.newPosition,1===p.type&&(m=c.measureTextObject(p.shapeWrapper),n={cx:l.x,cy:l.y,r:z(m)/2}),-1===p.type&&(m=c.measureTextObject(p.shapeWrapper),o={cx:l.x,cy:l.y,r:z(m)/2})}else{for(this.calculateLabelWidths(this._labelObjects,this.rect.width,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),this._numUpperLabels>0&&(e=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.3,this._labelObjects.push({position:e,size:Q})),this._numLowerLabels>0&&(e=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.7,this._labelObjects.push({position:e,size:Q})),d.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this.rect.width,!1),a=this._labelObjects.length-1;a>-1;a--)void 0===this._labelObjects[a].shapeWrapper&&this._labelObjects.splice(a,1);for(a=0;a<this._numLabelObjects;a+=1)p=this._labelObjects[a],l=p.shapeWrapper.shape,l.x=p.newPosition,l.maxWidth=p.size,1===p.type&&(m=c.measureTextObject(p.shapeWrapper),n={cx:l.x,cy:F,r:z(m)/2}),-1===p.type&&(m=c.measureTextObject(p.shapeWrapper),o={cx:l.x,cy:F,r:z(m)/2})}D(this._labelObjects),this.isVertical()?(this._numUpperLabels>0&&(k={type:"polygon",fill:N,shape:{points:[{x:E-3,y:5.2},{x:E,y:0},{x:E+3,y:5.2}]}},A.push(k),k={type:"circle",fill:O,shape:n},A.splice(0,0,k)),this._numLowerLabels>0&&(k={type:"polygon",fill:N,shape:{points:[{x:E-3,y:u-5.2},{x:E,y:u},{x:E+3,y:u-5.2}]}},A.push(k),k={type:"circle",fill:O,shape:o},A.splice(0,0,k))):(this._numLowerLabels>0&&(k={type:"polygon",fill:N,shape:{points:[{x:5.2,y:F-3},{x:0,y:F},{x:5.2,y:F+3}]}},A.push(k),k={type:"circle",fill:O,shape:o},A.splice(0,0,k)),this._numUpperLabels>0&&(k={type:"polygon",fill:N,shape:{points:[{x:t-5.2,y:F-3},{x:t,y:F},{x:t-5.2,y:F+3}]}},A.push(k),k={type:"circle",fill:O,shape:n},A.splice(0,0,k))),this.renderer.shapes=A,this.renderer.render()}}},release:function(){this._super(),this._axis&&this._axis.stopListen("changed",null,this)},_updateProperties:function(){if(this._data){var a,b,c=this._data,d=c.length;for(b=0;d>b;b++)a="value"+b,this._transitionProperties[a]=c[b].refLineExpr.value;this.calculateRelevantSize(),this._super()}}})}),define("objects.backend-api/stacked-cube-slicer",["core.utils/class","objects.utils/shapes/rect"],function(a,b){"use strict";var c,d=new b(0,0,0,0),e=new b(0,0,0,0);return c=a.extend("StackedCubeSlicer",{init:function(){this.pages=[]},get:function(a){return a.map(function(a){return this.getPage(a)}.bind(this))},getPage:function(a){var c,f,g,h=[];for(f=0;f<this.pages.length;f++)if(c=this.pages[f].qArea,d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(c.qLeft,c.qTop,c.qWidth,c.qHeight),g=e.intersection(d,!0),h.push({coverage:g?g.clone():new b(0,0,0,0),idx:f}),c.qLeft<=a.qLeft&&c.qLeft+c.qWidth>=a.qLeft+a.qWidth&&c.qTop<=a.qTop&&c.qTop+c.qHeight>=a.qTop+a.qHeight)return this._extract(a,this.pages[f]);return h.sort(function(a,b){return b.coverage.width*b.coverage.height-a.coverage.width*a.coverage.height}),h[0].coverage.height>0&&h[0].coverage.width>0?this._extract(a,this.pages[h[0].idx]):{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qData:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(a){this.pages=a},containsArea:function(a){for(var b,c=0;c<this.pages.length;c++)if(b=this.pages[c].qArea,b.qLeft<=a.qLeft&&b.qLeft+b.qWidth>=a.qLeft+a.qWidth&&b.qTop<=a.qTop&&b.qTop+b.qHeight>=a.qTop+a.qHeight)return!0;return!1},contains:function(a){return this.pages&&this.pages.length?0===a.filter(function(a){return!this.containsArea(a)}.bind(this)).length:!1},_extract:function(a,b){d.set(a.qLeft,a.qTop,a.qWidth,a.qHeight),e.set(b.qArea.qLeft,b.qArea.qTop,b.qArea.qWidth,b.qArea.qHeight);var c,f,g=d.intersection(e,!0);if(!g)return{qArea:{qTop:a.qTop,qLeft:a.qLeft,qWidth:0,qHeight:0},qData:[]};f=Math.max(0,a.qTop-b.qArea.qTop);var h=b.qData[0],i=h.qSubNodes;c={};for(var j in h)h.hasOwnProperty(j)&&("qSubNodes"===j?c[j]=i.slice(f,f+g.height):c[j]=h[j]);return c.qUp+=f,c.qDown+=b.qArea.qHeight-g.height-f,{qArea:{qTop:g.y,qLeft:g.x,qWidth:g.width,qHeight:g.height},qData:[c]}}})}),define("objects.views/charts/scrollable-chart",["jquery","./axis-chart","objects.views/charts/components/axis/discrete-axis","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/chart-component","objects.views/charts/components/scroll-area","objects.views/charts/components/mini-chart","objects.views/charts/components/ref-line-labels","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","objects.utils/event-utils","objects.utils/shapes/rect","core.utils/deferred","objects.backend-api/stacked-cube-slicer","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a,b){var c,d,e=this.components.scrollArea;this._panning||(this._panning=!0,this._panX=b.points[0].x,this._panY=b.points[0].y),e.isHorizontal()?(d=b.swipe&&b.swipe.currentPoint?b.swipe.currentPoint.x:a.pageX,c=e.getOffset()-(d-this._panX)/(this.components.dimensionAxis._discreteSpacing||28),this._panX=d):(d=b.swipe&&b.swipe.currentPoint?b.swipe.currentPoint.y:a.pageY,c=e.getOffset()-(d-this._panY)/(this.components.dimensionAxis._discreteSpacing||28),this._panY=d),c=0>c?0:c,e.setOffset(c)}function p(a){var b=a.getActiveType(),c=a.types.tooltip;b&&"range.dimension"===b.getActiveMode()&&b.cancel(),c&&c.clearSelection()}function q(a,b,e,f){var g,h,i=[],j=[];Object.keys(this.components).forEach(function(a){this.components[a]instanceof c?i.push(this.components[a]):this.components[a]instanceof d&&!this.components[a].isStacked&&j.push(this.components[a])}.bind(this)),g=["top","bottom"].contains(i[0].dock)?"x":"y",h="x"===g?"y":"x",this.selections.types.range.setComponent(g,i),1===a&&this.selections.types.tooltip.setComponent(g,i),this.selections.types.range.setComponent(h,j),e&&(a>1||b>1)?(this.selections.types.range.setComponent(h,[]),"byMeasure"===f?this.selections.types.colorLegend.removeComponent("colorLegend",this.components.colorLegend):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)}function r(){this._isPagingTransitionEnabled&&(this.components.measureAxis.setDataRangeTransition(!1),this.components.measureAxis.stopListen("endTransition",s,this),this.components.measureAxis.stopListen("startTransition",t,this),clearTimeout(this._pagingTransitionTimer),delete this.components.measureAxis.setDataRange,this._isPagingTransitionEnabled=!1)}function s(){this.components.refLineLabels&&this.layout();for(var a in this.components)this.components[a].invalidateDisplay("ScrollableChart.onAxisTransitionEnded")}function t(){this._visibleRefLines=this.components.refLineLabels.isVisible()}function u(){if(!this._isPagingTransitionEnabled){this._isPagingTransitionEnabled=!0;var a=this,b=this.components.measureAxis,c=b.setDataRange;b.listen("endTransition",s,this),b.listen("startTransition",t,this),this._pagingTransitionTimer=null,this.components.measureAxis.setDataRange=function(d,e){clearTimeout(a._pagingTransitionTimer),a._pagingTransitionTimer=setTimeout(function(){var f;b.setDataRangeTransition(!0),c.apply(b,[d,e]),a.layout();for(f in a.components)a.components[f].invalidateDisplay()},500)}}}function v(){var a,b,c,d,e,f=this.components.scrollArea,g=this._scrollableHint,h=[];this._scrollAffordance||(this._scrollAffordance={canIncrease:!1,canDecrease:!1}),c=f.getOffset(),e=f.getViewRange(),d=f.fullState.max,b=c>0,a=d>c+e,(b!==this._scrollAffordance.canDecrease||a!==this._scrollAffordance.canIncrease)&&(this._scrollAffordance.canIncrease=a,this._scrollAffordance.canDecrease=b,b&&h.push(f.isVertical()?"up":"left"),a&&h.push(f.isVertical()?"down":"right"),g.attr("class",function(a,b){return b.replace(/\bqv-chart-scrollable-\S+/g,"")}),g.addClass("qv-chart-scrollable-"+h.join("-")))}var w,x={NONE:0,ONE_DIM:1,TWO_DIM:2};return w=b.extend("ScrollableChart",{init:function(b,d,k,m){var n=this,o=a.extend(!0,{providers:{colorMap:{clazz:i,multiDimScheme:"last"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:e.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",showFlag:e.prototype.ShowFlags.SPARK},miniChart:{show:!0,clazz:g,components:{dimensionAxis:{show:!1,clazz:c},measureAxis:{show:!1},dataArea:{isMini:!0,show:!0}}},xAxis:{clazz:c,reductionOrder:10,shrinkToFitThreshold:.85,showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:e.prototype.ShowFlags.SMALL,horizontal:e.prototype.ShowFlags.XSMALL}},titleShowFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}}},xAxisTitle:{showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}},reductionOrder:1},scrollArea:{sortKey:2,show:!0,dock:"bottom",order:2,relevantSize:20,reductionOrder:10.1,showFlag:e.prototype.ShowFlags.XSMALL,clazz:f},refLineLabels:{show:!0,dock:"right",order:3,reductionOrder:3,showFlag:{whenVertical:{vertical:e.prototype.ShowFlags.XSMALL,horizontal:e.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:e.prototype.ShowFlags.MEDIUM,horizontal:e.prototype.ShowFlags.XSMALL}},clazz:h}}},k||{});this._super(b,d,o,m),this._scrollableHint=a("<div class='qv-chart-scrollable'>").appendTo(d),this._changeWatchers=this._changeWatchers||[],this._pagingInfo=new l(0,0,0,0),this.components.measureAxis=this.components.yAxis,this.components.dimensionAxis=this.components.xAxis,this.components.dimensionAxisTitle=this.components.xAxisTitle,delete this.components.xAxisTitle,delete this.components.xAxis,delete this.components.yAxis,this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.listen("drill-up",function(a,b,c){n.backendApi.drillUp(b,c)}),this.components.scrollArea.listen("scrollStart",function(){p(this.selections)}.bind(this)),this._showLegend=!1,this.scrollMultiplicator=1,this.components.dataArea.setMinorAxis(this.components.measureAxis),this.components.dataArea.setMajorAxis(this.components.dimensionAxis),this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis),this.components.dimensionAxis.setMinDiscreteUnitSize(28),this._changeWatchers.push(j.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(j.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(j.bindSetter(function(){n.components.dimensionAxis.setOffset(n.components.scrollArea.getOffset())},this.components.scrollArea,"offset")),this._changeWatchers.push(j.bindSetter(function(a){n.components.scrollArea.setFullRange(a)},this.components.dimensionAxis,"numDiscreteUnits")),this._changeWatchers.push(j.bindSetter(function(a){n.components.scrollArea.setViewRange(n._pagingMode===x.TWO_DIM?a/2:a)},this.components.dimensionAxis,"numDiscreteUnitsInView")),this._changeWatchers.push(j.bindSetter(function(){n._checkPage!==!1&&n.checkPage(),v.call(n)},this.components.dimensionAxis,"offset"))},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.Pan.bind(this.onPan.bind(this)),this.options._disableSelections||(this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},getSnapshotSize:function(){var a=this.rect.width,b=this.rect.height,c=this.getSnapshotChartData();return!c.hasMiniChart&&this.components.scrollArea.isVisible()&&(this.components.scrollArea.isVertical()?a-=this.components.scrollArea.rect.width:b-=this.components.scrollArea.rect.height),{w:a,h:b}},getSnapshotChartData:function(b){var c=a.extend(!0,this._super()||{},{scrollOffset:b&&b.ignoreReducedData?0:this.components.scrollArea.getOffset(),discreteSpacing:this.components.dimensionAxis.getDiscreteSpacing(),axisInnerOffset:b&&b.ignoreReducedData?0:this.components.dimensionAxis.getInnerOffset(),hasMiniChart:this.components.miniChart&&!!this.components.miniChart.isVisible()});return b&&b.ignoreReducedData&&this.components.measureAxis.isStacked&&(c.dataRanges=[{min:this.components.measureAxis.getPlotMin(),max:this.components.measureAxis.getPlotMax()}]),c},setSnapshotData:function(a,b){function c(){var b=this.components.scrollArea,c=b.getOffset()/this.scrollMultiplicator,d=Math.round(c),e=b.getViewRange()/this.scrollMultiplicator,f=Math.round(e-(d-c)),g=this._pagingInfo.y;if(isNaN(f)&&(f=10),this._data.barGrouping&&"grouped"===this._data.barGrouping.grouping&&this._data.qHyperCube.qMeasureInfo.length>1)d=Math.floor(c),f=Math.ceil(e-(d-c)),a.snapshotData.content.chartData.scrollOffset=b.getOffset()%this.scrollMultiplicator;else if(this._data.barGrouping&&"grouped"===this._data.barGrouping.grouping&&this._data.qHyperCube.qDimensionInfo.length>1){var h=this.components.dataArea._tree;if(d=Math.max(Math.round(c-.5),g),f=Math.round(this.components.dimensionAxis.getNumDiscreteUnitsInView()-(d-(c-.5))),h){var i,j=0,k=0,l=0,m=g;if(g!==d){for(j=0;j<h.children.length&&d>m;j++,m++)for(i=h.children[j],k=0;k<i.children.length&&d>m;k++,++m)l++;d=g+l,j=Math.max(0,j-1),k=Math.max(0,k-1)}for(l=0,m=0;j<h.children.length&&f>m;j++,m++){for(i=h.children[j],k;k<i.children.length&&f>m;k++,++m)l++;k=0}f=l}else f*=2}return{qTop:d,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:f}}this._super(a,b);var d=m();if(!b||!b.ignoreReducedData)return d.resolve(a),d.promise;delete a.reducedHyperCube;var e=a.qHyperCube;if("K"===e.qMode){var f=new n;f.store(e.qStackedDataPages);var g=f.get([c.call(this)]);e.qSize.qcy=g[0].qArea.qHeight,g[0]&&g[0].qData[0]&&(g[0].qData[0].qDown=0,g[0].qData[0].qUp=0),e.qStackedDataPages=g,d.resolve(a)}else this.backendApi.getData([c.call(this)]).then(function(b){"S"===e.qMode?e.qDataPages=b:e.qStackedDataPages=b,e.qSize.qcy=b[0].qArea.qHeight,e.qDimensionInfo[0].qStateCounts&&(e.qDimensionInfo[0].qStateCounts.qOption=e.qSize.qcy,e.qDimensionInfo[0].qStateCounts.qSelected=0),d.resolve(a)});return d.promise},checkPage:function(a){if(!this.isValid(this._data)||!this._pagingMode)return!1;var b=this.components.scrollArea,c=Math.floor(b.getOffset()/this.scrollMultiplicator),d=this._pagingInfo.y,e=this._pagingInfo.height,f=this._pagingMode===x.TWO_DIM?0:20,g=Math.ceil(b.getViewRange()/this.scrollMultiplicator);return isNaN(g)&&(g=500),this._pagingMode===x.TWO_DIM&&(g*=2),c+g>d+e||Math.max(0,c)<d?this.pageData(Math.floor(Math.max(0,c-f)),g+2*f,a):void 0},pageData:function(a,b,c){if("function"!=typeof this.backendApi.getReducedData)return!1;var d=m();if(this._data.qHyperCube){var e,f=this;e="K"===this._data.qHyperCube.qMode?this._data.qHyperCube.qStackedDataPages[0]&&this._data.qHyperCube.qStackedDataPages[0].qData&&this._data.qHyperCube.qStackedDataPages[0].qData.length>0:this._data.qHyperCube.qDataPages[0]&&this._data.qHyperCube.qDataPages[0].qMatrix.length>0,0>=b?("S"===f._data.qHyperCube.qMode?f._data.qHyperCube.qDataPages=[]:f._data.qHyperCube.qStackedDataPages=[],f._pagingInfo.set(a,0,this._data.qHyperCube.qSize.qcx,b)):this.backendApi.getData([{qTop:a,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:b}]).then(function(g){if("S"===f._data.qHyperCube.qMode){f._data.qHyperCube.qDataPages=g;var h=g[0].qArea;f._pagingInfo.set(h.qLeft,h.qTop,h.qWidth,h.qHeight)}else f._data.qHyperCube.qStackedDataPages=g,f._pagingInfo.set(0,a,f._data.qHyperCube.qSize.qcx,b);c||!e?(f._chartContext.refresh(f._data),f.paint(f._data).then(function(){d.resolve()})):f.partialUpdate(f._data).then(function(){d.resolve()})})}else d.resolve();return d.promise},partialUpdate:function(a){var b,c,d,e,f=[];u.call(this),this._chartContext.refresh(a),this.providers.colorMap.setData(a),c=a.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:a.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(c*this.scrollMultiplicator);for(b in this.components)"miniChart"!==b&&this.components[b].invalidateProperties("ScrollableChart.partialUpdate");return this.components.dataArea.updateNow(["properties"]),d=this.components.dataArea.getMajorAxisData(),e=this.components.dataArea.getMinorAxisData(),!e||this._readStoredData&&this.getSnapshotStoredChartData().dataRanges||this.components.measureAxis.setDataRange(e.min,e.max),this.components.dimensionAxis.setDataRange(d.data,d.info),this.components.colorLegend.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),f.push(this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate")),f.push(this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate")),f.push(this.components.colorLegend.invalidateDisplay("ScrollableChart.partialUpdate")),m.all(f)},_updateData:function(a){if(this._super.apply(this,[].slice.call(arguments)),this._pagingInfo.set(0,0,0,0),this.isValid(a)){var b,c=a.qHyperCube.qStackedDataPages[a.qHyperCube.qStackedDataPages.length-1];b=c&&c.qData?c.qData.length?{qLeft:0,qTop:0,qWidth:a.qHyperCube.qSize.qcx,qHeight:c.qData[0].qSubNodes.length}:c.qArea:a.qHyperCube.qDataPages[0].qArea,this._pagingInfo.set(b.qLeft,b.qTop,b.qWidth,b.qHeight)}},updateAxis:function(a){this._super.apply(this,[].slice.call(arguments)),this._readStoredData&&this.options.hideChartScrollWithoutMiniChart&&!this.components.scrollArea.getUseMiniChart()?this.components.scrollArea.hideComponent():this.components.scrollArea.showComponent(),q.apply(this,[a.qHyperCube.qDimensionInfo.length,a.qHyperCube.qMeasureInfo.length,"S"!==a.qHyperCube.qMode,a.color?a.color.mode:null]),this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_disablePagingTransitions:function(){r.call(this)},_enablePagingTransitions:function(){u.call(this)},_postResize:function(){this._super(),this.components.dimensionAxis&&this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_updateMinDiscreteUnitSize:function(a){var b=this._data.qHyperCube.qSize.qcy,c=this._data.qHyperCube,d="S"===c.qMode?"qDataPages":"qStackedDataPages",f=c[d]&&c[d][0]?c[d][0].qArea.qHeight:0;return f>=b&&this.options.components.scrollArea.show===!1?void a.setMinDiscreteUnitSize(null):void(!a.isVisible(this._layoutMode)||"title"===this._data.dimensionAxis.show||"all"===this._data.dimensionAxis.show&&"none"===this._data.dimensionAxis.label?this._layoutMode===e.prototype.ShowFlags.SPARK?a.setMinDiscreteUnitSize(7):a.setMinDiscreteUnitSize(20):a.setMinDiscreteUnitSize(28))},layout:function(){var a;if(this.options.components.scrollArea.show===!1){var b=this.components.dimensionAxis;b._hideMyLabels=!1,a=function(){return b._discreteSpacing*(b._groupSize||1)<20?(b._hideMyLabels=!0,!0):void 0}}this._super(this.components.dimensionAxis.isVertical()?"vertical":"horizontal",a);var c=this.components.dataArea.rect.clone(),d={top:0,left:0,right:0,bottom:0},e=this.components.measureAxis.getPadding(),f=this.components.dataArea.layoutToContainerRatios;d.top+=e.top,d.left+=e.left,d.right+=e.right,d.bottom+=e.bottom,this._scrollableHint.css({left:(c.x+d.left)*f.x,top:(c.y+d.top)*f.y,width:(c.width-d.left-d.right)*f.x,height:(c.height-d.top-d.bottom)*f.y}),v.call(this)},onPan:function(a,b,c){var d=this;switch(a){case"start":d._panX=c.points[0].x,d._panY=c.points[0].y,p(d.selections);break;case"update":o.apply(d,[b,c]);break;case"end":this._panning=!1}},on:function(){if(this._super(),!this.options._disableSelections){var b=this,c=this.namespace,d=3,e=function(c){var e,f=k.getMouseWheelData(c.originalEvent),g=b.components.scrollArea,h=b.components.colorLegend.rect.clone(),i=a(b.components.colorLegend.container).offset();h.x=i.left,h.y=i.top,h.pointInside(f.x,f.y)||(e=Math.floor(g.getOffset())+(f.delta>0?-d:d),e=0>e?0:e,g.setOffset(e),p(b.selections))};Touche(this.container).swipe({id:c,options:{preventDefault:!1,useMomentum:!0,touches:2,inertia:.7},start:function(a,c){b._panning=!0,b._panX=c.points[0].x,b._panY=c.points[0].y,p(b.selections)},update:function(a,c){o.apply(b,[a,c])},end:function(){b._panning=!1}}),Touche(this.container).wheelswipe({id:c,options:{useMomentum:!0,inertia:.7},start:function(a){b._panning=!0,b._panX=a.pageX,b._panY=a.pageY,p(b.selections)},update:function(a,c){o.apply(b,[a,c])},end:function(){b._panning=!1}}),a(this.container).on("mousewheel"+c+" DOMMouseScroll"+c,k.throttle(e,20)),this.components.miniChart&&a(this.components.miniChart.container).on("mousewheel"+c+" DOMMouseScroll"+c,k.throttle(e,20))}},off:function(){Touche(this.components.dataArea.container).off("*",this.namespace),Touche(this.container).off("*",this.namespace),this.components.miniChart&&a(this.components.miniChart.container).off(this.namespace),a(this.container).off(this.namespace),this._super()},destroy:function(){this._super(),this._disablePagingTransitions(),this.components.scrollArea.stopListen("scrollStart"),this.components.dimensionAxisTitle.stopListen("drill-up")}})}),define("objects.backend-api/hypercube-api",["./backend-api"],function(a){"use strict";var b;return b=a.extend("HyperCube",{init:function(a){this._super(a,"/qHyperCubeDef"),this.cacheCube.setMethodName("GetHyperCubeData")},updateCache:function(a){a&&a.qHyperCube?(this.cacheCube.set(a.qHyperCube.qDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear()},getData:function(a){return this.cacheCube.getData(a)},getHyperCubeAdaptiveGrid:function(a,b,c,d){return this.model.rpc("GetHyperCubeBinnedData","qDataPages",[this.path,a,{width:0,height:0},b,c,d,0])},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},selectRange:function(a,b,c){var d;return b=!!b,c=c||[],d=a.map(function(a){return{qMeasureIx:a.measure,qRange:{qMin:a.range.min,qMax:a.range.max,qMinInclEq:a.range.minInclEq!==!1,qMaxInclEq:a.range.maxInclEq!==!1}}}),this.model.rpc("RangeSelectHyperCubeValues",null,[this.path,d,c,b])},select:function(a,b){return this.model.rpc("SelectHyperCubeCells",null,[this.path,a,b])},selectValues:function(a,b,c){return this.model.rpc("SelectHyperCubeValues",null,[this.path,a,b,c])},getProperties:function(){return this.model.getProperties()},save:function(){return this.model.save()},getDimensionInfos:function(){return this.model.layout.qHyperCube.qDimensionInfo},getMeasureInfos:function(){return this.model.layout.qHyperCube.qMeasureInfo},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections}})}),define("objects.backend-api/stacked-api",["./hypercube-api"],function(a){"use strict";function b(a,b,c){var d,e,f,g=[];for(e=0;e<b.length;e++)for(d=0;d<a.length;d++)f={qType:c,qCol:b[e],qRow:a[d]},g.push(f);return g}var c;return c=a.extend("StackedApi",{init:function(){this._super.apply(this,arguments),this.backendStackThrottle.setMethodName("GetHyperCubeStackData")},updateCache:function(a){a&&a.qHyperCube&&"S"===a.qHyperCube.qMode?(this.cacheCube.set(a.qHyperCube.qDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(a){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.rpc("GetHyperCubePivotData","qDataPages",[this.path,a]);case"S":return this.cacheCube.getData(a);case"K":return this.backendStackThrottle.getData(a);default:return this.cacheCube.getData(a)}},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},select:function(a,c,d){switch(this.model.layout.qHyperCube.qMode){case"P":case"K":return this.model.rpc("SelectPivotCells",null,[this.path,b(a,c,d)]);default:return this.model.rpc("SelectHyperCubeCells",null,[this.path,a,c])}}})}),define("text!extensions.qliktech/barchart/barchart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div class="qv-viz-disclaimer" ng-if="dataAttributes.limitedData || dataAttributes.hasNegativeData">\r\n	<span>*</span>\r\n	<span ng-if="dataAttributes.limitedData" q-translation="Object.Disclaimer.LimitedData" q-title-translation="Object.Disclaimer.LimitedData" ng-style="getDisclaimerStyle(dataAttributes.chartScale)"></span>\r\n</div>\r\n'}),define("extensions.qliktech/barchart/barchart",["jquery","util","client.utils/state","core.utils/deferred","extensions.qliktech/barchart/bararea","extensions.qliktech/barchart/barchart-properties","extensions.qliktech/barchart/barchart-data","objects.views/charts/scrollable-chart","objects.backend-api/stacked-api","text!./barchart.ng.html","objects.extension/object-conversion"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,b,c,d,e,f){var g,h=["bottom","top"],i=["left","right"];"horizontal"===f?(g=h,h=i,i=g,d.setDock("right")):d.setDock("bottom"),a.setDock("far"===e.dimensionAxis.dock?h[1]:h[0]),b.setDock("far"===e.dimensionAxis.dock?h[1]:h[0]),c.setDock("far"===e.measureAxis.dock?i[1]:i[0])}var m,n,o=500,p={NONE:0,ONE_DIM:1,TWO_DIM:2};return m=h.extend("BarChart",{namespace:".barchart",init:function(b,c,d,f){var g,h=a.extend(!0,{},d);this.$scope=b,d=a.extend(!0,d||{},{components:{dataArea:{clazz:e},miniChart:{components:{dataArea:{clazz:e}}}}},h),this._super(b,c,d,f),this._data={},this._tree=null,this.components.dimensionAxis.setMaxDiscreteUnitSize(64),g=this.components.miniChart,this.components.miniChart&&(this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setUseMiniChart(!0),g.components.measureAxis.setDock("left"),g.components.dimensionAxis.setDock("bottom"),g.components.dataArea.setMinorAxis(g.components.measureAxis),g.components.dataArea.setMajorAxis(g.components.dimensionAxis),g.components.dataArea.setShowDataPoints(!1),g.setColorMap(this.providers.colorMap)),this._orientation="vertical"},initSelections:function(){this.options._disableSelections||this.selections.Select.bind(function(a,b){var c=[0];this.selections._activeType.components.dataArea?c=this.components.dataArea.getSelectionIndices()||[0]:this.selections._activeType.components.colorLegend&&(c=this.components.colorLegend.getSelectionIndices()),
this.onSelection.Select.apply(this,[a,b,c,"L"])}.bind(this)),this._super()},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var a,b=this._data,c=this.components.scrollArea,e=this.getSnapshotStoredChartData(),f="vertical"===b.orientation?this.rect.height:this.rect.width,g=0,h=[];this._cutMode?((this._cutMode.positive||this._cutMode.negative)&&(g=this._layoutMode>=15?32:this._layoutMode>=7?16:8),"vertical"===b.orientation?this.components.measureAxis.setPadding(this._cutMode.positive?g:0,0,this._cutMode.negative?g:0,0):this.components.measureAxis.setPadding(0,this._cutMode.positive?g:0,0,this._cutMode.negative?g:0)):this.components.measureAxis.setPadding(0,0,0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(f/4))),this.components.dimensionAxisTitle.setFont(this.components.dimensionAxis._style.title.font),this.layout(),this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(h.push(this.components.miniChart.setData(b)),this._dataForMiniChartChanged=!1),this._readStoredData&&(this.components.dimensionAxis.setInnerOffset(e.axisInnerOffset),this.components.scrollArea.setOffset(e.scrollOffset));var i=this.checkPage();if(i)h.push(i);else{for(a in this.components)h.push(this.components[a].invalidateDisplay("BarChart.paint"));c.viewState.min+c.viewState.range>c.fullState.max&&c.setOffset(c.fullState.max-c.viewState.range)}return d.all(h)},prePaint:function(){this._super()},_updateData:function(a){this._checkPage=!1,this._disablePagingTransitions.call(this),this._data=a,this._dataForMiniChartChanged=!0,this.isStacked="stacked"===a.barGrouping.grouping&&(a.qHyperCube.qDimensionInfo.length>1||a.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,this.components.scrollArea.setUseMiniChart(!0),this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.colorLegend.setData(a),this.components.dimensionAxisTitle.setData(a),a.orientation&&this.components.miniChart?(this._orientation!==a.orientation&&(this.components.miniChart.clear(),this._orientation=a.orientation),this.components.miniChart.setOrientation(a.orientation),this.components.scrollArea.setMiniChart(this.components.miniChart)):this._orientation=a.orientation;var b={axes:{measureAxis:{component:this.components.measureAxis},dimensionAxis:{component:this.components.dimensionAxis}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.refLineLabels}},refLines:{component:this.components.refLines}},c=null,d=this.getSnapshotStoredChartData();this.scrollMultiplicator=a.qHyperCube.qDimensionInfo.length<2&&"grouped"===a.barGrouping.grouping&&a.qHyperCube.qMeasureInfo.length>1?a.qHyperCube.qMeasureInfo.length+1:1,this._pagingMode=p.NONE,this.components.dataArea._allowInnerSelection=!1,a.qHyperCube.qDimensionInfo.length<2&&a.qHyperCube.qSize.qcy>o?(c=a.qHyperCube.qSize.qcy,"grouped"===a.barGrouping.grouping&&a.qHyperCube.qMeasureInfo.length>1&&(this.scrollMultiplicator=a.qHyperCube.qMeasureInfo.length+1,c*=this.scrollMultiplicator),this._pagingMode=p.ONE_DIM):a.qHyperCube.qDimensionInfo.length>1&&"grouped"===a.barGrouping.grouping?(a.qHyperCube.qSize.qcy>o&&(this._pagingMode=p.TWO_DIM,c=a.qHyperCube.qSize.qcy),this.components.dataArea._allowInnerSelection=a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1):a.qHyperCube.qDimensionInfo.length>1&&(this.components.dataArea._allowInnerSelection=a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1,c=this.isStacked?a.qHyperCube.qStackedDataPages&&a.qHyperCube.qStackedDataPages.length&&a.qHyperCube.qStackedDataPages[0].qData&&a.qHyperCube.qStackedDataPages[0].qData.length?a.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+a.qHyperCube.qStackedDataPages[0].qData[0].qDown:a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected:a.qHyperCube.qDataPages[0].qMatrix.length+a.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+a.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected,this._pagingMode=p.ONE_DIM),this.components.dimensionAxis.isDiscrete()||(this._pagingMode=p.NONE),this.components.dimensionAxis.setNumDiscreteUnits(c),this._super(a,b),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(d.axisInnerOffset),this.components.scrollArea.setOffset(d.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},updateDataArea:function(a){this.components.dataArea.setShowDataPoints(a.dataPoint.showLabels),this.components.dataArea.setGroupingMode(a.barGrouping.grouping),this.components.miniChart&&this.components.miniChart.components.dataArea.setGroupingMode(a.barGrouping.grouping),this.components.dataArea.updateNow(["properties"])},updateAxis:function(d,e){var f,g,h,i,j,k,m,o,p,q,r,s,t,u=this.getSnapshotStoredChartData(),v=d.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return{min:a.qMin,max:a.qMax,index:d.qHyperCube.qMeasureInfo.indexOf(a)}});p=v.reduce(function(a,b){return a.min<b.min?a:b},v[0]),q=v.reduce(function(a,b){return a.max>b.max?a:b},v[0]),r=p?p.min:n,s=q?q.max:n,b.isNumeric(r)||(r=0),b.isNumeric(s)||(s=1),f=this.components.measureAxis,g=this.components.dimensionAxis,h=this.components.dimensionAxisTitle;var w=this.components.dataArea.getMajorAxisData(),x=this.components.dataArea.getMinorAxisData();g.setDataRange(w.data,w.info),g.setGroupSize(w.groupSize),k=d.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}).join(", "),m=d.qHyperCube.qDimensionInfo.map(function(a){return a.qFallbackTitle}).join(", "),c.view!==c.Views.story?(h.setTitle(m),h.showComponent()):h.hideComponent(),a.extend(e.axes.measureAxis,{data:a.extend(!0,{},d.measureAxis,{logarithmic:!1}),title:k,dataIndices:d.qHyperCube.qMeasureInfo.map(function(a,b){return b})}),a.extend(e.axes.dimensionAxis,{data:d.dimensionAxis,title:c.view!==c.Views.story?"":m,dataIndices:d.qHyperCube.qDimensionInfo.map(function(a,b){return b}),currentDataIndices:[0]}),a.extend(e.axisTitles.dimensionAxisTitle,{data:d.dimensionAxis,title:c.view!==c.Views.story?"":m}),o=e.axes.measureAxis,t=this.getAxisOptions(o),e.refLineLabels.labels.axis=f,l.apply(this,[g,h,f,this.components.scrollArea,d,this._orientation]),this._super(d,e);for(j in e.axes)i=e.axes[j],i.component.setDataIndices(i.dataIndices||[i.dataIndex||0]),i.component.setCurrentDataIndices(i.currentDataIndices||i.dataIndices||[i.dataIndex||0]);r>s?(s=10,r=-10):r===s&&0===s&&(s=10,r=-10),s=Math.max(0,s),r=Math.min(0,r),p&&q?(this._cutMode=this.getSpikeSettings(d,p,q,r,s,t),s=this._cutMode.max,r=this._cutMode.min):this._cutMode={positive:!1,negative:!1},this._readStoredData&&u.dataRanges&&u.dataRanges[0]?this.setAxisDataRange(f,u.dataRanges[0].max,u.dataRanges[0].min,t.max,t.min,1):x?this.setAxisDataRange(f,x.max,x.min,t.max,t.min,1):this.setAxisDataRange(f,s,r,t.max,t.min,1),"none"===d.measureAxis.show?g.setUnitAlignment("center"):["near","far"].contains(d.measureAxis.dock)?g.setUnitAlignment(g.isHorizontal()?d.measureAxis.dock:"near"===d.measureAxis.dock?"far":"near"):g.isHorizontal()?g.setUnitAlignment("left"===d.measureAxis.dock?"near":"far"):g.setUnitAlignment("bottom"===d.measureAxis.dock?"far":"near")},getSpikeSettings:function(a,b,c,d,e,f){for(var g,h,i=0,j=0,k=0,l=0,m=!1,n=!1,o=c.index+a.qHyperCube.qDimensionInfo.length,p=b.index+a.qHyperCube.qDimensionInfo.length,q=a.qHyperCube.qDataPages[0]?a.qHyperCube.qDataPages[0].qMatrix:[],r=0;r<q.length;r++)g=q[r],h=g[o].qNum,h>0&&!isNaN(h)&&(g[0].qIsOtherCell||g[1].qIsOtherCell?k=Math.max(h,k):i=Math.max(h,i)),h=g[p].qNum,0>h&&!isNaN(h)&&(g[0].qIsOtherCell||g[1].qIsOtherCell?l=Math.min(h,l):j=Math.min(h,j));return this.isStacked&&a.qHyperCube.qMeasureInfo.length+a.qHyperCube.qDimensionInfo.length>2||(null!==f.max&&f.max<e?m=f.max>0:i>0&&k/i>5&&(e=i,m=e>=0),null!==f.min&&f.min>d?n=f.min<0:0>j&&l/j>5&&(d=j,n=0>d)),{max:e,min:d,positive:m,negative:n}},setOrientation:function(a){this._orientation=a||"horizontal"},getOrientation:function(){return this._orientation}}),{type:"barchart",BackendApi:i,template:j,View:m,definition:f,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:o,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},colorLegend:{}}},data:g,importProperties:function(a,b,c){var d=k.axisChart.importProperties.apply(k,[a,b,c]),e=d.qProperty;return e.qHyperCubeDef.qDimensions.length>1&&"stacked"===e.barGrouping.grouping&&(e.qHyperCubeDef.qMode="K"),d},exportProperties:k.axisChart.exportProperties.bind(k)}}),define("extensions.qliktech/piechart/piearea-helper",["objects.views/charts/renderers/canvas-renderer","objects.views/charts/components/axis/radial-axis-helper","general.utils/color"],function(a,b,c){function d(a,b){return Math.round(100*a*Math.pow(10,b))/Math.pow(10,b)}function e(a){return a/360*Math.PI*2%(2*Math.PI)}function f(b,c,d,e,f,i,j,k){if(k)return g(b,c,d,f,i);var l,m,n,o,p,q=d.end-d.start,r=d.radius,s=.4,t=(d.arcCenter+e)%(2*Math.PI),u=(t+Math.PI)%(2*Math.PI);return p=b.font===f&&b.text===c?b.pieLabelMeasures:a.measureText(c,f),0>q&&(q+=2*Math.PI),l=h(q>s&&p.width<q*r,u),m="center"===l,n=r*Math.cos(t)+(m?Math.cos(t)*p.width/2:0)+(m?-p.width/2:"right"===l?-p.width:0),o=r*Math.sin(t)+(m?Math.sin(t)*p.height/2:0),b.baseline="middle",b.align="left",b.fill=i,b.font=f,b.text=c,b.textAlign=l,b.x=n,b.y=o,b.width=p.width,b.laHeight=p.height,b.arcCenter=u,b.arcLength=q,b.pieLabelMeasures=p,b}function g(b,c,d,e,f){var g=d.radius,h=e.split("px"),i=h[1],j=a.measureText(c,e),k=Math.min(2*g/j.width,8),l=11,m=Math.min(100,Math.max(g/10*k*.3,l)),n=m+"px"+i;return b.fill=f,b.text=c,b.font=n,b.align="center",b.baseline="bottom",b.x=0,b.y=0,b.maxWidth=1.3*g,b}function h(a,b){return a?"center":b<Math.PI/2||b>1.5*Math.PI?"right":"left"}function i(b,c,d,e,f,g,h,i,k,l){if(k)return j(b,c,e,l,d);var m,n,o,p,q,r,s=(e.arcCenter+f)%(2*Math.PI),t=(s+Math.PI)%(2*Math.PI),u=i?i:a.measureText(c,h);return q=g?e.innerRadius:e.radius,m=t<Math.PI/2||t>1.5*Math.PI,n=t>Math.PI,r=.07*(m?1:-1)*(n?1:-1)*Math.abs(Math.sin(t)),o=.95*q*Math.cos(s)+e.cx-(m?-1:1)*(Math.abs(Math.cos(t))*u.width/2),p=.95*q*Math.sin(s+r)+e.cy-(n?1:-1)*(Math.abs(Math.sin(t))*u.height/2),b.fill=d,b.x=o,b.y=p,b.text=c,b.font=h,b.align="center",b.baseline="middle",b.maxWidth=1.4*u.width,b}function j(b,c,d,e,f){if(!e)return b;var g,h=d.radius,i=e.split("px"),j=i[0],k=i[1],l=.8*j,m=10,n=l+"px"+k,o=a.measureText(c,n);return o.width>1.2*h&&(g=1.2*h/o.width,l=Math.max(l*g,m),n=l+"px"+k),b.fill=f,b.text=c,b.font=n,b.align="center",b.baseline="top",b.maxWidth=1.3*h,b.x=d.cx,b.y=d.cy,b}function k(a,b,d,e,f){return d||c.useDarkLabel(e,f)?b:a}function l(a,b,c){if(a.length<2)return[];var d,e,f,g,h=Math.min(c.width,c.height),i=[],j=[],k=[],l=[],n=[],o=[];for(f=0;f<a.length;f++)o.push({label:a[f],line:b[f]});for(o.sort(function(a,b){return a.label.arcCenter>b.label.arcCenter?1:-1}),f=0;f<a.length;f++)switch(e=o[f],d=e.label,g=d.arcCenter,d.quartile=s(g),d.quartile){case 1:i.push(e);break;case 2:j.push(e);break;case 3:k.push(e);break;case 4:l.push(e)}return n=i.concat(j.reverse()).concat(k).concat(l.reverse()),n=m(n,h,c)}function m(a,c,d){var e,f,g,h,i,j,k,l,m,s,t,u,v,w,x=a[0]?a[0].label.laHeight:20,y=10,z=20;for(m=0;m<a.length;m++){e=a[m].label,j=e.x,k=e.y,g=b.getPolPos({x:j,y:k}),h=e.arcCenter<Math.PI/2||e.arcCenter>3*Math.PI/2,z=Math.max(Math.min(z,g.r/15),5),i=b.getCartPos({r:g.r+z,a:g.a}),j=i.x,k=i.y,0!==m&&(f=a[m-1].label,l=f.y),f&&q(e.quartile,f.quartile)?(u=p(k,l,e.quartile,f.quartile,h,x),v=Math.abs(u),l=k+u+2*(u>0?1:-1)):(t=e.arcLength*c/3,v=x-t,l=k+(v>0?v*(1===e.quartile||2===e.quartile?1:-1):0)),v>y?(w={x:e.x,y:e.y},n(a[m],w,{x:j,y:l})):a[m].line.strokeWidth=0,e.x=j,e.y=l,e=o(e,d),e.maxWidth=e.width,e.width=null,"center"===a[m].label.textAlign&&v>y&&(a[m].line.x1+=Math.cos(a[m].label.arcLength)*(h?1:-1)*a[m].label.maxWidth/2,a[m].line.x2+=(h?1:-1)*a[m].label.maxWidth/4,a[m].line.y1+=Math.sin(a[m].label.arcLength)*(h?1:-1)*a[m].label.laHeight/2,a[m].line.y2+=(h?1:-1)*a[m].label.laHeight/2,a[m].line.strokeWidth=1),s=e.y+d.height/2+x*(r(e.quartile)?.5:-.5);var A=-s>0||s-d.height>0;a[m].label.visible=!A,a[m].line.visible=!A}return a}function n(a,b,c){var d,e,f,g,h={r:Math.sqrt(b.x*b.x+b.y*b.y),a:Math.atan2(b.y,b.x)},i={r:Math.sqrt(c.x*c.x+c.y*c.y),a:Math.atan2(c.y,c.x)},j=a.label.textAlign,k=2,l=3;return d=(h.r+k)*Math.cos(h.a),e=(h.r+k)*Math.sin(h.a),f=(i.r-l)*Math.cos(i.a),g=(i.r-l)*Math.sin(i.a),a.line.x1=d+("right"===j?a.label.width:0),a.line.y1=e,a.line.x2=f+("right"===j?a.label.width:0),a.line.y2=g,a}function o(a,b){var c={x:b.width/2,y:b.height/2};switch(a.textAlign){case"left":a.x+a.width>b.width-c.x&&(a.width-=a.x+a.width-(b.width-c.x));break;case"right":a.x<-c.x&&(a.width+=a.x+c.x,a.x=-c.x);break;case"center":a.x<-c.x?(a.width+=a.x+c.x,a.x=-c.x):a.x+a.width>b.width-c.x&&(a.width-=a.x+a.width-(b.width-c.x))}return a}function p(a,b,c,d,e,f){var g;return g=f>(a-b)*(1===d||2===c?1:-1)?b-a+f*(e&&3===c||!e&&4===c?-1:1):0}function q(a,b){return a===b||3===a&&2===b}function r(a){return 1===a||2===a}function s(a){var b=1;return a>=1.5*Math.PI?b=2:a<=Math.PI/2?b=3:a>Math.PI/2&&a<Math.PI&&(b=4),b}function t(a,d,e,f,g){var h,i;return h=b.getCartPos({r:g.radius-1,a:g.start+g.radianOffset},{x:g.cx,y:g.cy}),i=b.getCartPos({r:g.innerRadius+1,a:g.start+g.radianOffset},{x:g.cx,y:g.cy}),a.x1=h.x,a.y1=h.y,a.x2=i.x,a.y2=i.y,a.strokeWidth=1,e&&c.getContrast(d,e)>1.2?a.stroke=d.toHex():a.stroke=d.isDark()?"#ccc":"#333",a}return{getFormattedPercentageValue:d,getRadianOffset:e,updateNameLabel:f,updateValueLabel:i,getLabelColor:k,improveNameLabelPositions:l,updateLabel:n,checkQuartile:s,isBottomQuartile:r,checkRelevantQuartile:q,checkInterference:p,checkEllipsis:o,updateDivider:t}}),define("extensions.qliktech/piechart/piearea",["objects.views/charts/components/chart-component","objects.views/charts/shapes/arc","objects.views/charts/shapes/circle","objects.views/charts/shapes/line","objects.views/charts/shapes/text","objects.views/charts/shapes/container","objects.views/charts/utils/tree-iterator","objects.views/charts/renderers/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/piechart/piearea-helper","translator","general.utils/color","core.utils/deferred"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a,b){var c={backgroundColor:a.getValue(v,null,"backgroundColor"),dataPoint:{},dataValue:{},shape:{},line:{}};return c.dataPoint.label={font:a.getFont(v,"item.name",b),color:{dark:a.getValue(v,"item.name","color","dark"),light:a.getValue(v,"item.name","color","light")}},c.dataValue.label={font:a.getFont(v,"item.value",b),color:{dark:a.getValue(v,"item.value","color","dark"),light:a.getValue(v,"item.value","color","light")}},c.shape={border:{width:a.getValue(v,"item.shape.border","width")},selected:{border:{width:a.getValue(v,"item.shape.border","width","selected"),color:a.getValue(v,"item.shape.border","color","selected")}}},c.line={color:a.getValue(v,"item.line","color"),width:a.getValue(v,"item.line","width")},c}function o(a,b,c,d,e,f){a?(c.strokeWidth=b.shape.selected.border.width,c.stroke=b.shape.selected.border.color,c.opacity=w,c.zIndex=1,d.opacity=1,f.opacity=1,e.opacity=1):(c.opacity=void 0,c.strokeWidth=void 0,c.stroke=void 0,c.zIndex=void 0,d.opacity=void 0,f.opacity=void 0,e.opacity=void 0)}function p(a){a>300?this._fontSize="large":a>200?this._fontSize="medium":a>100?this._fontSize="small":this._fontSize="tiny"}function q(a,b,c){return a.set(0,0,this._showAsDonut?this._innerRadius:0,this._radius,b,b+c,this._radianOffset),a}function r(){if(!this._data||!this._tree)return m.resolve();var a,b,c,d,e,f,g,i,k,n,o,p,r,s,u,v,w,x,y,z,A,B,C=this._tree,D=this._itemData.length,E=C.children.length,F=0,G=0,H=[],I=[],J=this._styles,K=this,L=new l(J.backgroundColor).isDark();this.beforeRenderPie(this._tree,t),this._radianOffset=j.getRadianOffset(this._currentProperties.rotation+90);var M=(this._radianOffset<0?this._radianOffset+2*Math.PI:this._radianOffset)%(2*Math.PI);if(y={nameLabel:{font:J.dataPoint.label.font,color:"#f00"},dataLabel:{font:J.dataValue.label.font,color:"#f00"}},E){for(u=1===this._numSlices,b=0;D>b;b++){if(c=this._itemData[b],!c.pieData||c.pieData.value<=0)return m.resolve();G=Math.min(2*Math.PI*c.pieData.share,2*Math.PI),f=K._arcs[c.pieData.shpIndex],g=c.parent.cacheItem.selected,q.apply(K,[f,F-Math.PI,G]),x={border:{color:"white",width:0}},u&&!K._showAsDonut?(o=K._singleItemCircle,o.set(0,0,f.radius)):o=f,r=K._dividers[c.pieData.shpIndex],r.visible=!1,g||u||(r=K._dividers[c.pieData.shpIndex],r.visible=!0,j.updateDivider.call(this,r,c.pieData.color,e,x.border,o),K.dividerAddedToRender(r)),K.pieAddedToRender(c,o),K._showDimensionValues&&(d=u?j.getLabelColor(J.dataPoint.label.color.light,J.dataPoint.label.color.dark,K._showAsDonut,c.pieData.color,L):L?J.dataPoint.label.color.light:J.dataPoint.label.color.dark,i=j.updateNameLabel(K._nameLabels[c.pieData.shpIndex],c.pieData.title,f,M,y.nameLabel.font,d,K.rect,u),H.push(i),p=K._lines[c.pieData.shpIndex],p.stroke=J.line.color,p.strokeWidth=J.line.width,p.x1=0,p.y1=0,p.x2=0,p.y2=0,I.push(p)),F+=G,e=c.pieData.color}if(this._valueLabelContainer.removeChildren(),!this._data.dataPoint.auto||this._layoutMode>3)for(a=0;a<this._sortedIndices.length;a++){if(s=this._itemData[this._sortedIndices[a].idx],!s.pieData||s.pieData.value<=0)return m.resolve();if(f=K._arcs[s.pieData.shpIndex],v=f.start,w=f.end,w+=0>v*w?2*Math.PI:0,n=this._dataPointsLabelMode===t.SHARE?s.pieData.formattedShare.toString()+" %":s.pieData.label,k=K._valueLabels[s.pieData.shpIndex],z=k.font===y.dataLabel.font&&k.text===n?k.pieLabelMeasures:h.measureText(n,y.dataLabel.font),k.pieLabelMeasures=z,B=(f.arcCenter+f.radianOffset)%(2*Math.PI),A=(B+Math.PI)%(2*Math.PI),!(this._dataPointsLabelMode!==t.NONE&&f.radius*(w===v?2*Math.PI:w>=v?w-v:v-w)>Math.abs(Math.cos(A))*z.height*2+Math.abs(Math.sin(A))*z.width*2))break;d=j.getLabelColor(J.dataValue.label.color.light,J.dataValue.label.color.dark,this._showAsDonut,s.pieData.color,L),k=j.updateValueLabel(k,n,d,f,M,this._showAsDonut,y.dataLabel.font,z,u,i?i.font:null),k.maxWidth<(this._showAsDonut?f.innerRadius:f.radius)*(u?2:1)&&this._valueLabelContainer.addChild(k)}}j.improveNameLabelPositions(H.concat(),I,K.rect),this._nameLabelContainer.removeChildren(),this._lineContainer.removeChildren();var N=[],O=[];for(a=0;a<H.length;a++)H[a].visible!==!1&&N.push(H[a]),I[a].visible!==!1&&O.push(I[a]);return this._nameLabelContainer.addChildren(N),this._lineContainer.addChildren(O),this._prevRect&&this._prevRect.w===this.rect.width&&this._prevRect.w===this.rect.height||(this._prevRect={w:this.rect.width,h:this.rect.height},this._renderRoot.clearTransform(),this._renderRoot.translate(this.rect.width/2,this.rect.height/2)),this.renderers.pie.render(!0)}var s,t,u=1,v="pieChart",w=1;return t={NONE:0,SHARE:1,VALUE:2},s=a.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._arcs=[],this._nameLabels=[],this._valueLabels=[],this._lines=[],this._dividers=[],this._itemData=[],this._labelRects=[],this._cacheItems=[],this.renderers={pie:new h(this.container,{name:"pie"})},this.renderers.pie.setCompositingEnabled(!1),this._renderRoot=new f,this._rotationContainer=new f,this._arcContainer=new f,this._dividerContainer=new f,this._nameLabelContainer=new f,this._valueLabelContainer=new f,this._lineContainer=new f,this._rowToShapeMapping={},this._dividerContainer.strokeWidth=1,this._arcContainer.lineJoin="round",this._rotationContainer.addChildren([this._arcContainer,this._dividerContainer]),this._renderRoot.addChildren([this._rotationContainer,this._nameLabelContainer,this._valueLabelContainer,this._lineContainer]),this.renderers.pie.stage.addChild(this._renderRoot),this._singleItemCircle=new c(0,0,0),this._singleItemCircle.type="circle",this._fontSize="large",this._styles={},this._styleService=i.getInstance(),this._transitionHelper.setTransitionCurve("easeout"),this._maxSizeRatio=.8,this._showValueTextInsideSlice=!1,this._showDimensionValues=!0,this._showAsDonut=!1,this._showLabels=!0,this._recalculcating=!1,this._currentProperties.rotation=0,this._transitionProperties.rotation=0,this._hasNegativeValues=!1,this._innerRadiusRatio=.7},beforeRenderPie:function(){},pieAddedToRender:function(){},dividerAddedToRender:function(){},afterPaint:function(){return m.resolve()},setShowDimensionValues:function(a){this._showDimensionValues=a,this.invalidateDisplay("setShowDimensionValues")},getShowDimensionValues:function(){return this._showDimensionValues},setRotation:function(a){this._transitionProperties.rotation=a,this._transition()},getRotation:function(){return this._transitionProperties.rotation},setScaleRatio:function(a){this._maxSizeRatio=a,this.invalidateDisplay("setScaleRatio")},getScaleRatio:function(){return this._maxSizeRatio},setShowAsDonut:function(a){this._showAsDonut=a,this.invalidateDisplay("setShowAsDonut")},getShowAsDonut:function(){return this._showAsDonut},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setDataPointsLabelMode:function(a){switch(a){case"value":this._dataPointsLabelMode=t.VALUE;break;case"share":this._dataPointsLabelMode=t.SHARE;break;default:this._dataPointsLabelMode=t.NONE}this.invalidateDisplay("setDataPointsLabelMode")},getDataPointsLabelMode:function(){return this._dataPointsLabelMode},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay("setDimensionTree")},updateSize:function(){this._super()},_updateProperties:function(){if(this._data&&this._tree){this._itemData=[];var a,c,f,h,i,l,m=[],n=this._data.qHyperCube.qDimensionInfo.length,p=this._tree,q=n+1,r=0,s=this._arcs.length,t=p.children.length,v=this.measureFormatters[0],w=this,x=this.selectionIdentifier?this.selectionIdentifier:"dataArea";this._numSlices=0,this._arcContainer.removeChildren(),this._dividerContainer.removeChildren(),this._rowToShapeMapping={};var y,z,A,B,C,D=this._arcContainer,E=this._dividerContainer;t&&(g.each.call(p,function(j,k){if(c=g.getLevel.call(j),j.idx=k,c===q){if(f=j.data.qNum,isNaN(f)||0>=f)return void((1>=n||0>=k)&&(a=j.parent.cacheItem,m.push(a)));w._numSlices++,i=j.parent.data.qText,l="U"!==v.type?j.children[0].data.qText:v.formatValue(j.data.qNum),j.pieData={value:f,title:i,color:null,label:l},j.pieData.shpIndex=r++,h=null!=w._colorMap?w._colorMap.getColor(j.parent.data.qElemNo,f,0,j.parent.idx):null,j.pieData.color=h,r>s?(y=new b(0,0,0,0,0,0,0),C=new d(0,0,0,0),z=new e,A=new e,B=new d(0,0,0,0),w._arcs.push(y),w._nameLabels.push(z),w._valueLabels.push(A),w._lines.push(B),w._dividers.push(C)):(y=w._arcs[j.pieData.shpIndex],z=w._nameLabels[j.pieData.shpIndex],A=w._valueLabels[j.pieData.shpIndex],B=w._lines[j.pieData.shpIndex],C=w._dividers[j.pieData.shpIndex]),w._rowToShapeMapping[j.data.rowIndex]=j.pieData.shpIndex,o(!1,w._styles,y,z,A,B),y.fill=h.toRGBA(),D.addChild(y),E.addChild(C),a=j.parent.cacheItem,t>1||w._showAsDonut?(a.addShape(x,y),a.addShape(x,z)):a.addShape(x,w._singleItemCircle),m.push(a),w._itemData.push(j)}}),this._singleItemCircle.opacity=void 0,this._singleItemCircle.strokeWidth=0,this._singleItemCircle.stroke="white",1!==w._itemData.length||w._showAsDonut||(this._singleItemCircle.fill=w._itemData[0].pieData.color.toRGBA(),D.removeChildren(),D.addChild(this._singleItemCircle),E.removeChildren())),this.setSelectableShapes(m),this._sortedIndices=this._itemData.map(function(a,b){return{value:a.pieData.value,idx:b}}),this._sortedIndices.sort(function(a,b){return a.value<b.value?1:-1});var F,G,H=0;this._numNonZero=0,this._itemData.forEach(function(a){H+=a.pieData.value,w._numNonZero+=a.pieData.value>0?1:0}),this._itemData.forEach(function(a){F=a.pieData.value/H,a.pieData.share=F,G=j.getFormattedPercentageValue(F,w._data.dataPoint.sharePrecision?w._data.dataPoint.sharePrecision:u),a.pieData.formattedShare=G,a.parent.cacheItem.addMeasure(k.get("properties.dataPoints.labelmode.share"),G+" %",G+" %")}),this._super()}},hasValidData:function(){return this._super()&&this._data&&this._tree},_onAnimatitonEnd:function(){this._super(),this.getRotation()%360===0&&(this._currentProperties.rotation=this._transitionProperties.rotation=0)},paint:function(){return this._super(this._layoutMode,this._data),this._radius=this._maxSizeRatio*Math.min(this.rect.width,this.rect.height)/2,this.renderers.pie.stage.opacity=this._globalAlpha||1,this._dividerContainer.opacity=.4*this._globalAlpha,p.apply(this,[this._radius]),this._styles=n(this._styleService,this._fontSize),this._innerRadius=this._innerRadiusRatio*this._radius,r.call(this).then(function(){return this.afterPaint()}.bind(this))},toggleCacheItem:function(a){var b=!0,c=this._styles;this.renderers.pie.stage.opacity!==this._globalAlpha&&(b=!1,this.renderers.pie.stage.opacity=this._globalAlpha);var d=this._rowToShapeMapping[a.row],e=this._arcs[d],f=this._nameLabels[d],g=this._valueLabels[d],h=this._lines[d];e&&(o(a.selected,c,e,f,g,h),b&&(e.invalidate(),f.invalidate(),h.invalidate(),g.invalidate())),1===this._itemData.length&&(a.selected?(this._singleItemCircle.opacity=w,this._singleItemCircle.strokeWidth=c.shape.selected.border.width,this._singleItemCircle.stroke=c.shape.selected.border.color):(this._singleItemCircle.opacity=void 0,this._singleItemCircle.strokeWidth=0,this._singleItemCircle.stroke="white"),b&&this._singleItemCircle.invalidate()),b||this.renderers.pie.render(!0)}})}),define("extensions.qliktech/piechart/piechart-properties",["general.utils/property-resolver"],function(a){function b(b){var c=a.getValue(b,"color.auto"),d=a.getValue(b,"color.expressionIsColor"),e=a.getValue(b,"color.mode");return!c&&"primary"===e||!c&&"byExpression"===e&&(d||void 0===d)}var c,d;c={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showAsDonut:{ref:"donut.showAsDonut",type:"boolean",component:"item-selection-list",defaultValue:!1,horizontal:!0,items:[{icon:"∏",component:"icon-item",labelPlacement:"bottom",translation:"properties.pie",value:!1},{icon:"π",component:"icon-item",labelPlacement:"bottom",translation:"properties.donut",value:!0}]},labels:{type:"items",snapshot:{tid:"property-labels"},items:{dimensionTitle:{ref:"dimensionTitle",type:"boolean",component:"switch",translation:"properties.dataPoints.dimensionlabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},valuesAuto:{ref:"dataPoint.auto",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},labelMode:{ref:"dataPoint.labelMode",type:"string",component:"dropdown",options:[{value:"none",translation:"Common.None"},{value:"share",translation:"properties.dataPoints.labelmode.share"},{value:"value",translation:"properties.dataPoints.labelmode.value"}],defaultValue:"share",show:function(b){return!a.getValue(b,"dataPoint.auto")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{colorMode:{defaultValue:"byDimension"}},legend:{items:{show:{show:function(a){return!b(a)},snapshot:{tid:"property-legend"}},showTitle:{show:function(c){return a.getValue(c,"legend.show")&&!b(c)}},dock:{show:function(c){return a.getValue(c,"legend.show")&&!b(c)}}}}}}}};var e={uses:"data",items:{dimensions:{uses:"dimensions"},measures:{uses:"measures",items:{numberFormatting:{items:{percentOfPieMessage:{component:"text",translation:"properties.numberFormatting.pieMessage",show:function(b,c){return c&&(a.getValue(c,"properties.dataPoint.auto")||"share"===a.getValue(c,"properties.dataPoint.labelMode"))}}}}}}}};d={uses:"sorting"};var f={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:e,sorting:d,addons:f,settings:c}}}),define("extensions.qliktech/piechart/piechart-data",["general.utils/property-resolver"],function(a){function b(a){1===a.getDimensions().length&&1===a.getMeasures().length&&(a.getMeasures()[0].qSortBy.qSortByNumeric=-1,1!==a.getSorting()[0]&&a.changeSorting(1,0))}function c(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byExpression"===e&&0===d.length&&a.setValue(b,"color.mode","primary")}function d(a,c){a.qOtherTotalSpec.qOtherMode="OTHER_COUNTED",a.qOtherTotalSpec.qOtherCounted={qv:"10"},b(c)}return{dimensions:{add:function(a,b,c){d(a,c)},replace:function(a,b,c,e,f){d(a,f)},min:1,max:1},measures:{min:1,max:1,add:function(a,c,d){b(d)},remove:function(a,b,d){c(b,d)}}}}),define("text!extensions.qliktech/piechart/piechart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero"></div>'}),define("objects.views/charts/disclaimers/chart-utils",["util"],function(a){function b(a,b){var c,d,e,f,g,h=b.length;for(a&&(d=!(a.autoMinMax||"min"!==a.minMax&&"minMax"!==a.minMax||null===a.min||isNaN(a.min)),e=!(a.autoMinMax||"max"!==a.minMax&&"minMax"!==a.minMax||null===a.max||isNaN(a.max))),f=Number.MAX_VALUE,g=-Number.MAX_VALUE,c=0;h>c;c++)if(f=d?a.min:Math.min(f,b[c].qMin),g=e?a.max:Math.max(g,b[c].qMax),0>=f&&g>=0)return!0;return!1}var c={applyDisclaimerAttributes:function(c,d,e,f,g,h){return d||(d={}),a.extend(d,{limitedData:!1,hasNegativeOrZeroData:!1,onlyNegativeOrZero:!1,onlyNanData:!1,hasDataRangeIncludingZero:!1}),d.noDataExist=h.qHyperCube.qSize.qcy*h.qHyperCube.qSize.qcx===0,d.noDataExist?(e.toggleClass("qv-viz-with-disclaimer",!1),d):(c=c||{},c.overlay=c.overlay||!1,c.supportNegative=void 0===c.supportNegative?!0:c.supportNegative,c.supportRangeOverZero=void 0===c.supportRangeOverZero?!0:c.supportRangeOverZero,h.qHyperCube.qDataPages[0]?d.limitedData=!c.paging&&h.qHyperCube.qSize.qcy>h.qHyperCube.qDataPages[0].qMatrix.length:d.limitedData=c.explicitLimitedData===!0,d.hasNegativeOrZeroData=!c.supportNegative&&h.qHyperCube.qMeasureInfo.some(function(a){return a.qMin<=0}),d.onlyNegativeOrZero=!c.supportNegative&&h.qHyperCube.qMeasureInfo.every(function(a){return a.qMax<=0&&a.qMax>=a.qMin})||0===h.qHyperCube.qSize.qcy,d.onlyNanData=h.qHyperCube.qMeasureInfo.every(function(a){return a.qMax<a.qMin||"NaN"===a.qMax}),d.hasDataRangeIncludingZero=!c.supportRangeOverZero&&b(h.measureAxis,h.qHyperCube.qMeasureInfo,h.lineType),d.onlyNegativeOrZero&&c.overlay||!(d.limitedData||d.hasNegativeOrZeroData&&!c.supportNegative||d.hasDataRangeIncludingZero)?(e.toggleClass("qv-viz-with-disclaimer",!1),f.options.showDisclaimerStar=!1):(e.toggleClass("qv-viz-with-disclaimer",c.bottom),f.options.showDisclaimerStar=!0),d)}};return c}),define("text!objects.views/charts/disclaimers/chart-disclaimer.ng.html",[],function(){return'<div class="qv-viz-disclaimer" ng-if="visible && (options.limitedData || options.hasNegativeOrZeroData || options.hasDataRangeIncludingZero) && !options.doesNotFit" ng-style="getDisclaimerStyle(options.chartScale)">\r\n	<span>*</span>\r\n	<span ng-if="options.limitedData" q-translation="Object.Disclaimer.LimitedData" q-title-translation="Object.Disclaimer.LimitedData"></span>\r\n	<span ng-if="options.hasNegativeOrZeroData" q-translation="Object.Disclaimer.NegativeOrZeroValues" q-title-translation="Object.Disclaimer.NegativeOrZeroValues"></span>\r\n	<span ng-if="options.hasDataRangeIncludingZero" q-translation="Object.Disclaimer.DataRangeIncludingZero" q-title-translation="Object.Disclaimer.DataRangeIncludingZero"></span>\r\n</div>\r\n';
}),define("objects.views/charts/disclaimers/chart-disclaimer-directive",["qvangular","text!./chart-disclaimer.ng.html"],function(a,b){a.directive("qvaChartDisclaimer",function(){return{template:b,replace:!0,scope:{options:"=",visible:"="},link:function(a){a.getDisclaimerStyle=function(a){return a=Math.min(1,a||1),{"font-size":1*a+"em"}}}}})}),define("extensions.qliktech/piechart/piechart",["jquery","core.utils/deferred","client.utils/state","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.views/charts/components/axis/axis-title","./piearea","objects.views/charts/representation/combo-color-map","objects.backend-api/hypercube-api","extensions.qliktech/piechart/piechart-properties","extensions.qliktech/piechart/piechart-data","text!./piechart.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a){var b=a.getRotation(),c=b%360,d=c>180?b+360-c:b-c;a.setRotation(d)}function q(a,b,c){b.legend.show===!1||c?a.hideComponent():a.showComponent()}function r(a,b){b&&"auto"!==b.legend.dock?a.setDock(b.legend.dock):a.outerRect.height/a.outerRect.width>1?a.setDock("right"):a.setDock("bottom")}function s(a){if(void 0!==a){this.components.dataArea.setRotation(a);var b=this.selections.types.tooltip;b&&b.clearSelection()}}var t,u=".piechart";return t=d.extend("PieChart",{init:function(b,c,d,i){var j=this,k=a.extend(!0,{},d);d=a.extend(!0,d||{},{debug:!0,providers:{colorMap:{clazz:h,colorBy:"dimension"}},components:{xAxisTitle:{show:!0,order:1,dock:"top",relevantSize:30,showFlag:e.prototype.ShowFlags.SMALL,clazz:f},dataArea:{sortKey:1e3,show:!0,dock:"center",clazz:g,showFlag:e.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:e.prototype.ShowFlags.MEDIUM}}},k),this._super(b,c,d,i),this.components.dimensionAxisTitle=this.components.xAxisTitle,this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.listen("drill-up",function(a,b,c){j.backendApi.drillUp(b,c)}),delete this.components.xAxisTitle,this._showLegend=!1,this._lastRotation=0},initSelections:function(){this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.options._disableSelections||(this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.onSelection.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},on:function(){this._super();var b=this;a(this.components.dataArea.container).on("mousewheel"+u+" DOMMouseScroll"+u,function(a){var c=m.getMouseWheelData(a.originalEvent);s.apply(b,[b.components.dataArea.getRotation()+5*c.delta]),a.preventDefault()}),a(this.components.dataArea.container).on("mouseup"+u,function(a){2===a.which&&(a.preventDefault(),p(b.components.dataArea))}),Touche(this.container).rotate({id:u,start:function(){b._lastRotation=0,b.components.dataArea.setUseTransition(!1),Touche.preventGestures(this.gestureHandler)},update:function(a,c){s.apply(b,[b.components.dataArea.getRotation()+c.rotation-b._lastRotation]),b._lastRotation=c.rotation,Touche.preventGestures(this.gestureHandler)},end:function(){b.components.dataArea.setUseTransition(!0),Touche.preventGestures(this.gestureHandler)}}),Touche(this.components.dataArea.container).tap({id:u,options:{touches:3},end:function(){p(b.components.dataArea),Touche.preventGestures(this.gestureHandler)}}),this._on=!0},off:function(){Touche(this.components.dataArea.container).off("*",u),Touche(this.container).off("*",u),a(this.components.dataArea.container).off(u),this._super(),this._on=!1},_postResize:function(){r.apply(this,[this.components.colorLegend,this._data])},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{rotation:this.components.dataArea._currentProperties.rotation})},_paint:function(){var a,c=[];if(!this.isValid(this._data))return this.clear();this._super(),this.layout(),this.components.dataArea.setShowDimensionValues(this._layoutMode>e.prototype.ShowFlags.SPARK);for(a in this.components)c.push(this.components[a].invalidateDisplay("PieChart._paint"));return b.all(c)},prePaint:function(a){this._super(),n.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,c,a)},_updateData:function(a){this._data=a;var b=this.getSnapshotStoredChartData();this._super(a),this.$scope.dataAttributes.onlyNegativeOrZero?(this.selections.off(),this._on&&this.off()):!this.$scope.dataAttributes.onlyNegativeOrZero&&this.isDataSelectable(a)&&(this.selections.on(),this._on||c.isInEditMode()||this.on()),this.providers.colorMap.setData(a),this.components.dataArea.setData(a),this.components.colorLegend.setData(a),this.components.dimensionAxisTitle.setData(a),this.providers.colorMap.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.setDimensionTree(this._chartContext.getDimensionTree()),a.dataPoint&&this.components.dataArea.setDataPointsLabelMode(a.dataPoint.auto?"share":a.dataPoint.labelMode),a.donut&&this.components.dataArea.setShowAsDonut(a.donut.showAsDonut),a.scale&&this.components.dataArea.setScaleRatio(a.scale),this._readStoredData&&b?this.components.dataArea.setRotation(b.rotation):a.rotation?this.components.dataArea.setRotation(a.rotation):p(this.components.dataArea),a.dimensionTitle===!1||this.$scope.dataAttributes.onlyNegativeOrZero?this.components.dimensionAxisTitle.hideComponent():this.components.dimensionAxisTitle.showComponent(),q.apply(this,[this.components.colorLegend,a,this.$scope.dataAttributes.onlyNegativeOrZero]),r.apply(this,[this.components.colorLegend,this._data])},setShowLegend:function(a){this._showLegend=a,a?this.components.colorLegend.showComponent():this.components.colorLegend.hideComponent()},getShowLegend:function(){return this._showLegend},toggleCacheItem:function(a){this.components.dataArea.toggleCacheItem(a),this.components.colorLegend.invalidateDisplay("ScatterPlot#toggleCacheItem")},destroy:function(){this._super(),this.components.dimensionAxisTitle&&this.components.dimensionAxisTitle.stopListen("drill-up")}}),{type:"piechart",BackendApi:i,template:l,View:t,definition:j,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:500}],qSuppressZero:!1,qSuppressMissing:!0}},data:k,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},colorLegend:{}}},importProperties:o.colorChart.importProperties.bind(o),exportProperties:o.colorChart.exportProperties.bind(o)}}),define("extensions.qliktech/scatterplot/scatter-helper",["objects.utils/shapes/circle","objects.utils/shapes/rect","objects.utils/shapes/polygon"],function(a,b,c){function d(d,e){var f;switch(d){case"circle":f=new a(e[0],e[1],e[2],e[3]);break;case"rect":f=new b(e[0],e[1],e[2],e[3]);break;case"polygon":f=new c}return f}function e(a,b){return a?[]:b}function f(a){return a.dotData&&"NaN"!==a.dotData.xValue&&"NaN"!==a.dotData.yValue?!0:!1}function g(a){return a&&a.cacheItem&&a.cacheItem.selected?!0:!1}function h(a,b){return!b||!!a.selected||!!a.highlighted}function i(a,b,c,d){var e;return e=b?j(a,c.sizeDataMin,c.sizeDataMax,c._minDotSize,c._maxDotSize):c._minDotSize,e*d}function j(a,b,c,d,e){var f,g;return isNaN(a)||null===a?NaN:b===c?(d+e)/2:b>=a?d:a>=c?e:(f=(a-b)/(c-b),g=d+(e-d)*Math.sqrt(f))}function k(a,b,c,d,e){var f=isNaN(c)||void 0===c,g=f?0:c;return-g>a||a>d+g||-g>b||b>e+g}function l(a,b,c){return 0>a?-10+c:a>b?b-c+10:a}function m(a,b,c){var d;for(d=0;d<c.length;d++)if(a[c[d]]!==b[c[d]])return!1;return!0}function n(a,b,c,d,e){return 13!==a.length?null:(a[0].x=b-d+e/2,a[0].y=c-d-e/2,a[1].x=b-d-e/2,a[1].y=c-d+e/2,a[2].x=b-e,a[2].y=c,a[3].x=b-d-e/2,a[3].y=c+d-e/2,a[4].x=b-d+e/2,a[4].y=c+d+e/2,a[5].x=b,a[5].y=c+e,a[6].x=b+d-e/2,a[6].y=c+d+e/2,a[7].x=b+d+e/2,a[7].y=c+d-e/2,a[8].x=b+e,a[8].y=c,a[9].x=b+d+e/2,a[9].y=c-d+e/2,a[10].x=b+d-e/2,a[10].y=c-d-e/2,a[11].x=b,a[11].y=c-e,a[12].x=b-d+e/2,a[12].y=c-d-e/2,a)}function o(a,b){var c,d,e=!1;for(d=0;d<a.length;d++)if(c=a[d],"circle"===c.type){if(m(c,b,["cx","cy","r"])){e=!0;break}}else if(m(c,b,["cx","cy"])){e=!0;break}return e}function p(a,b){var c,d;return c=a.cacheItem.getShapes("dataArea")[0],d=b.cacheItem.getShapes("dataArea")[0],c.cy-c.r>d.cy-d.r?1:c.cy-c.r<d.cy-d.r?-1:c.cx-c.r>d.cx-d.r?1:c.cx-c.r<d.cx-d.r?-1:c.r>d.r?-1:c.r<d.r?1:a.cacheItem.id<b.cacheItem.id?-1:1}function q(a,b){return 0===b?a[1]?a[1]:null:a[b-1]}function r(a,b,c,d){var e,f,g={x:!1,y:!1};return isNaN(d.cx)||isNaN(d.cy)?(g.y=!0,g):(e=-(b.y-a.y),0>e?g:(e<2*a.height+d.r+c.r&&(g.y=!0,f=Math.abs(b.x-a.x),f<a.width/2+b.width/2&&(g.x=!0)),g))}function s(a,b){var c=a.x-a.width/2;return a.maxWidth=a.width,0>c&&(a.maxWidth+=2*c,a.x=a.maxWidth/2),c=a.x+a.width/2-b,c>0&&(a.maxWidth-=2*c),a.maxWidth=Math.max(a.maxWidth,0),a}function t(a,b){return a.x=b.x-b.width/2,a.y=b.y-b.height,a.width=b.maxWidth,a.height=b.height,a}return{createShape:d,checkClearNodes:e,checkNodeValid:f,checkSelected:g,checkShouldRender:h,getRadius:i,getDotRadius:j,outOfBounds:k,outOfBoundsPosition:l,isSame:m,updateCross:n,checkOverlapping:o,sortObjectsForLabels:p,getComparableObject:q,checkLabelInterference:r,checkEllipsis:s,centerLabel:t}}),define("extensions.qliktech/scatterplot/scatter-circle",["objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/polygon","objects.views/charts/shapes/circle"],function(a,b,c,d){function e(a,d,e){"saltire"===this.type?c.render.apply(this,[a,d,e]):b.render.apply(this,[a,d,e])}function f(a){var b,c=[];for(b=0;a>b;b++)c.push(g());return c}function g(){return{x:0,y:0}}function h(a,b,c,d,e){return 13!==a.length?null:(a[0].x=b-d+e/2,a[0].y=c-d-e/2,a[1].x=b-d-e/2,a[1].y=c-d+e/2,a[2].x=b-e,a[2].y=c,a[3].x=b-d-e/2,a[3].y=c+d-e/2,a[4].x=b-d+e/2,a[4].y=c+d+e/2,a[5].x=b,a[5].y=c+e,a[6].x=b+d-e/2,a[6].y=c+d+e/2,a[7].x=b+d+e/2,a[7].y=c+d-e/2,a[8].x=b+e,a[8].y=c,a[9].x=b+d+e/2,a[9].y=c-d+e/2,a[10].x=b+d-e/2,a[10].y=c-d-e/2,a[11].x=b,a[11].y=c-e,a[12].x=b-d+e/2,a[12].y=c-d-e/2,a)}var i=d.extend("ScatterCircle",{init:function(a,b,c,d,e){this._super(a,b,c),this.type="circle",this.saltireSize=d,this.saltireWidth=e},set:function(a,b,c,d,e){this.saltireSize=this.saltireSize||d,this.saltireWidth=this.saltireWidth||e,this._saltire=h(this._saltire||f(13),a,b,this.saltireSize,this.saltireWidth),this._polygons=[{points:this._saltire}],this._super(a,b,c)}});return a._registerRenderFn(e,i),i}),define("extensions.qliktech/scatterplot/heat-map-light",["core.utils/class","objects.views/charts/shapes/rect","objects.views/charts/shapes/text","general.utils/color","objects.utils/number-formatter","objects.views/charts/renderers/canvas-renderer"],function(a,b,c,d,e,f){function g(a){var c=new b(this._xAxis.getPositionOfValue(a.qText[0])-1,this._yAxis.getPositionOfValue(a.qText[1])-1,this._xAxis.getPositionOfValue(a.qText[2])-this._xAxis.getPositionOfValue(a.qText[0])+1,this._yAxis.getPositionOfValue(a.qText[3])-this._yAxis.getPositionOfValue(a.qText[1])+1),e=new d(this._colorMapLight.getColor(a.qNum/this._maxNrInBin));c.fill=e.toRGBA(),this._renderer.stage.addChild(c),c.width>40&&c.height>15&&h.call(this,c,a.qNum,e.isDark())}function h(a,b,d){var e=new c;e.x=a.x+a.width/2,e.y=a.y+a.height/2+4,e.text=this._numberFormatter.format(b,this._defaultPattern),e.align="center",e.fill=d?"#fff":"#444",e.font="11px 'QlikView Sans'",this._renderer.stage.addChild(e)}var i=a.extend("HeatMapLight",{init:function(a,b){this._renderer=a,this._selectedRenderer=b,this._numberFormatter=new e,this._defaultPattern="#.#A"},setData:function(a){this._data=a[0].concat(),this._metaData=this._data.splice(0,1)[0],this._maxNrInBin=this._metaData.qNum},setColorMapLight:function(a){this._colorMapLight=a},getColorMapLight:function(){return this._colorMapLight},hasValidData:function(){return this._data&&this._metaData},setXAxis:function(a){this._xAxis=a},setYAxis:function(a){this._yAxis=a},draw:function(){if(this._data&&this._data.length&&!(this._data.length<1)){this._pixelRatio=f.getDevicePixelToBackingStoreRatio(),this._renderer.stage.removeChildren(),this._renderer.clear(),this._selectedRenderer&&(this._selectedRenderer.stage.removeChildren(),this._selectedRenderer.clear());var a;for(a=0;a<this._data.length;a++)g.call(this,this._data[a]);return this._renderer.render()}},copyHeatMap:function(){return this._renderer._canvas.width&&this._renderer._canvas.height&&(this._imageData=this._renderer._canvas.getContext("2d").getImageData(0,0,this._renderer._canvas.width,this._renderer._canvas.height),this._selectedRenderer&&this._selectedRenderer._updateSize()),this._imageData},getHeatMapCanvas:function(){return this._renderer._canvas},clipSelected:function(a){this._renderer._canvas.width&&this._renderer._canvas.height&&(this._selectedRenderer.clear(),this._selectedRenderer._canvas.getContext("2d").putImageData(this._imageData,0,0,a.x*this._pixelRatio,a.y*this._pixelRatio,a.width*this._pixelRatio,a.height*this._pixelRatio))},clearSelection:function(){this._selectedRenderer.stage.removeChildren(),this._selectedRenderer.clear()}});return i}),define("extensions.qliktech/scatterplot/scatterarea",["objects.views/charts/components/chart-component","extensions.qliktech/scatterplot/scatter-helper","objects.views/charts/renderers/canvas-renderer","./scatter-circle","objects.views/charts/shapes/text","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/utils/tree-iterator","objects.views/charts/chart-style-service","general.utils/color","core.utils/deferred","extensions.qliktech/scatterplot/heat-map-light"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";function m(a,b,c,d){return a.set(b,c,d),a}function n(a){var b,c=a.length;for(b=0;c>b;b++)a[b].renderer.setAttribute("style",{opacity:a[b].visible?1:0});setTimeout(function(){for(b=0;c>b;b++)a[b].renderer.setAttribute("style",{visibility:a[b].visible?"":"hidden"})},500)}function o(a){var b="scatterPlot",c={backgroundColor:a.getValue(b,null,"backgroundColor"),dataPoint:{label:{color:a.getValue(b,"value","color"),font:a.getFont(b,"value"),background:a.getValue(b,"value","background")}},shape:{border:{width:a.getValue(b,"shape.border","width")},selected:{border:{color:a.getValue(b,"shape.border","color"),width:a.getValue(b,"shape.border","width","selected")}},outOfBounds:{opacity:a.getValue(b,"shape.outOfBounds","opacity")}},line:{color:a.getValue(b,"line","color"),width:a.getValue(b,"line","width")}};return c}function p(a){var c,e,f,g,h,i,j,l,o,p,q,r,s,t,u,v=this._tree,w=this._tree.children.length,x=b.createShape("circle",[0,0,0,0]),y=this.rect.width,z=this.rect.height,A=this._dots,B=this,C=[],D=[],E=3,F=1,G=3,H=this._canvasShapes,I=this._data.qHyperCube.qMeasureInfo.length>2&&!this._data.qHyperCube.qDataPages[0].qIsReduced,J=Math.min(this.rect.height,this.rect.width)/300,K=this.selectionIdentifier?this.selectionIdentifier:"dataArea",L=this._styles;if(!w)return void this.clear();if(this._renderedNodes=b.checkClearNodes(!a,this._renderedNodes),v.children.forEach(function(k){if(b.checkNodeValid(k)&&(j=!1,g=b.checkSelected(k),k.selected=g,k.highlighted=k.cacheItem.highlighted,p=g?L.shape.selected.border.width:L.shape.border.width,q=g?.9:void 0,"dimension"===k.data.type)){if(!b.checkShouldRender(k,a)||!B._currentProperties.values)return;if(r=B._currentProperties.values[k.data.qElemNo],!r)return;if(c=B._xAxis.getPositionOfValue(r.xValue),e=B._yAxis.getPositionOfValue(r.yValue),f=b.getRadius(r.rValue,I,B._currentProperties,J),isNaN(c)||isNaN(e))return;f=.5>f?.5:f,G=G>f?f:G,l=isNaN(f)||void 0===f,k.dotData.outOfBounds=j=b.outOfBounds(c,e,f,y,z),j&&(f=G,c=b.outOfBoundsPosition(c,y,f),e=b.outOfBoundsPosition(e,z,f)),o=l&&!j,x=m(A[k.dotData.dotIndex],c,e,o?2*E:f),i=k.cacheItem,i.clearShapes(K),i.addShape(K,x,!0),h=i.highlighted,k.dotData.color=B._colorMap.getColor(k.data.qElemNo,k._children[0].data.qNum,0,k.data.rowIndex),t=k.dotData.color.isDark()?"light":"dark",u=!1,k.selected||(u=b.checkOverlapping(j?D:C,x,c,e,F)),u||(s=H[k.idx],s?s.fill=k.dotData.color.toRGBA():(s=new d(0,0,0,E,F),s.fill=k.dotData.color.toRGBA(),s.strokeWidth=p,s.opacity=q,s.stroke=h?L.shape.highlighted.border[t].color:g?L.shape.selected.border.color:B._sheetBackgroundColor.toRGBA(),s.data.label=k.data.qText?k.data.qText.substr(0,128):"",H[k.idx]=s),j?B._isBigData||(s.set(x.cx,x.cy,x.r),s.type="circle",D.push(s)):(s.set(x.cx,x.cy,x.r),l?s.type="saltire":s.type="circle",a||(C.push(s),B._renderedNodes.push(k))))}}),!a){var M=[];return this.renderers.dots.stage.removeChildren(),this.renderers.dots.stage.addChildren(C),M.push(this.renderers.dots.render()),this._isBigData?n.call(this,[{renderer:this.renderers.oob,visible:!1}]):(n.call(this,[{renderer:this.renderers.oob,visible:!0}]),this.renderers.oob.stage.removeChildren(),this.renderers.oob.stage.addChildren(D),M.push(this.renderers.oob.render())),k.all(M)}}function q(){var a,c,d,h,i,j,k,l,m,n,o,p,q,r=this._renderedNodes.length,t=this,u=[],v=this._labelShapes,w=this.renderers.labels,x=this._styles,y=this.selectionIdentifier?this.selectionIdentifier:"dataArea";return r&&(j=this._renderedNodes.sort(b.sortObjectsForLabels),j.forEach(function(r,w){if(v[r.data.rowIndex]&&(v[r.data.rowIndex].visible=!1),h=r.cacheItem,c=r.dotData.label,a=h.getShapes(y)[0],i=h.toggleShapes[0],n=w-1,k=b.getComparableObject(j,w),c.x=a.cx,c.y=a.cy-a.r-5,!c||r.dotData.outOfBounds)return void i.set(0,0,0,0);if(t._labelMode===s.AUTO&&k){if(l=k.cacheItem.getShapes(y)[0],d=k.dotData.label,m=b.checkLabelInterference(c,d,a,l),m.x&&m.y)return void(i.width=0);for(;m.y&&n>0;)if(n--,k=0!==w?j[n]:null,l=k.cacheItem.getShapes(y)[0],d=k.dotData.label,m=b.checkLabelInterference(c,d,a,l),m.x&&m.y)return void(i.width=0)}return c.y-c.height<0||c.y>t.rect.height?void i.set(0,0,0,0):(c=b.checkEllipsis(c,t.rect.width),i=b.centerLabel(i,c),void(i.width&&(v[r.data.rowIndex]?(p=v[r.data.rowIndex].rect,o=v[r.data.rowIndex].text,q=v[r.data.rowIndex].line,v[r.data.rowIndex].visible=!0):(p=new f,o=new e,q=new g,v[r.data.rowIndex]={visible:!0,rect:p,text:o,line:q},p.fill=x.dataPoint.label.background,o.fill=x.dataPoint.label.color,o.align="center",o.font=x.dataPoint.label.font,o.baseline="bottom",q.stroke=x.line.color),o.setText(c.text),o.x=c.x,o.y=c.y,o.maxWidth=c.maxWidth,p.x=o.x-o.maxWidth/2-2,p.y=i.y,p.width=i.width+4,p.height=i.height,q.set(c.x,c.y-2,c.x,c.y+3),u.push(p),u.push(o),u.push(q))))})),w.stage.removeChildren(),w.stage.addChildren(u),w.render()}var r,s;return s={NONE:0,AUTO:1,ALL:2},r=a.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._dots=[],this._labelRects=[],this._cacheItems=[],this._renderedNodes=[],this._showDataPoints=!0,this._colorMap=null,this._navigationVisible=!1,this._globalAlpha=1,this._canvasShapes={},this._labelMode=s.AUTO,this._savedCacheItems={},this._transitionProperties._minDotSize=2,this._transitionProperties._maxDotSize=10,this._style={dataPoints:{color:"#666",font:"12px 'QlikView Sans'"}},this._styles={},this._styleService=i.getInstance(),this._styles=o(this._styleService),this._sheetBackgroundColor=new j(this._styles.backgroundColor),this._sheetBackgroundColor.setAlpha(.3),this.renderers={heat:new c(this.container,{name:"heat"}),selectedHeat:new c(this.container,{name:"selectedHeat"}),dots:new c(this.container,{name:"dots"}),labels:new c(this.container,{name:"labels"}),oob:new c(this.container,{name:"oob"})},this._heatMap=new l(this.renderers.heat,this.renderers.selectedHeat);var a="brightness(0.8)",b="opacity 0.5s linear";this.renderers.selectedHeat.setAttribute("style",{filter:a,webkitFilter:a,mozFilter:a}),this.renderers.heat.setAttribute("style",{webkitTransition:b,mozTransition:b,transition:b}),this.renderers.dots.setAttribute("style",{webkitTransition:b,mozTransition:b,transition:b}),this.renderers.labels.setAttribute("style",{webkitTransition:b,mozTransition:b,transition:b}),this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10},this._transitionHelper.setTransitionTime(500,0)},setIsBigData:function(a){this._isBigData=a},getIsBigData:function(){return this._isBigData},setIsReduced:function(a){a!==this._isReduced&&(this._reducedModeChanged=!0,this._isReduced=a)},getIsReduced:function(){return this._isReduced},setHeatMap:function(a){this._heatMap.setData(a)},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setColorMapLight:function(a){this._colorMapLight=a,this._heatMap.setColorMapLight(this._colorMapLight)},getColorMapLight:function(){return this._colorMap},setXAxis:function(a){this._xAxis=a,this._heatMap.setXAxis(a),this._xAxis.listen("changed",function(){this.invalidateDisplay()},this)},setYAxis:function(a){this._yAxis=a,this._heatMap.setYAxis(a),this._yAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay()},setMinDotSize:function(a){this._transitionProperties._minDotSize=a,this.invalidateDisplay()},setMaxDotSize:function(a){this._transitionProperties._maxDotSize=a,this.invalidateDisplay()},setLabelMode:function(a){this._labelMode=a,this.invalidateDisplay()},setNavigation:function(a){this._navigationVisible=a,this.invalidateDisplay()},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10}},_updateSize:function(){this.invalidateDisplay()},setData:function(a){this._super(a)},_updateProperties:function(){if(this._data&&this._tree){this._canvasShapes={},this._labelShapes={};var a,c,d,e,f,g,i,j=[],k=this._data.qHyperCube.qDimensionInfo.length,l=this._data.qHyperCube.qMeasureInfo.length,m=this._tree,n=this,o=this._dots,p=this._labelRects,q=m.children.length,r=0,s=this._dots.length,t=k+1,u=this.renderers.dots,v=this._style.dataPoints,w=this.selectionIdentifier?this.selectionIdentifier:"dataArea";return this._onlySelected=!1,n._transitionProperties.values={},n._transitionProperties.nodes={},l>2&&(n._transitionProperties.sizeDataMin=this._data.qHyperCube.qMeasureInfo[2].qMin,n._transitionProperties.sizeDataMax=this._data.qHyperCube.qMeasureInfo[2].qMax),q&&h.each.call(m,function(l,m){if(i=h.getLevel.call(l),l.idx=m,i===t-1){if(k>1&&m>0)return;e=l.children[0].data.qNum,f=l.children[1].data.qNum,g=l.children.length>2?l.children[2].data.qNum:.5,l.dotData={color:null,label:null},1>=k&&(l.dotData.dotIndex=r++,r>s?(a=b.createShape("circle",[0,0,0,0]),c=b.createShape("rect",[0,0,0,0]),o.push(a),p.push(c)):(a=n._dots[l.dotData.dotIndex],c=n._labelRects[l.dotData.dotIndex]),d=l.cacheItem,d.addShape(w,a,!0),d.toggleShapes=[c],j.push(d),n._transitionProperties.values[l.data.qElemNo]={xValue:e,yValue:f,rValue:g}),l.dotData.label={x:0,y:0,width:0,height:0,text:l.data.qText},l.dotData.label.width=u.getTextWidth(l.dotData.label.text,v.font),l.dotData.label.height=u.getFontHeight(v.font)}}),this._dots.length>r&&(this._dots=this._dots.slice(0,r),this._labelRects=this._labelRects.slice(0,r)),this.setSelectableShapes(j),this._super()}},hasValidData:function(){return this._super()&&this._data&&(this._tree||this._isReduced&&this._heatMap.hasValidData())&&this._xAxis&&this._yAxis},paint:function(){var a=this;if(this._super(this._layoutMode,this._data),this._xAxis&&this._yAxis&&this._data){if(this._xAxis.updateNow(),this._yAxis.updateNow(),this.renderers.oob.edgeBleed={left:10,right:10,bottom:10,top:10},this._styles=o(this._styleService),!this._renderData)return this.clear();if(this.renderers.dots.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this._isReduced)return this.renderers.heat.stage.removeChildren(),this.renderers.heat.clear(),this._reducedModeChanged?(this._reducedModeChanged=!1,this.setSelectableShapes([]),n.call(this,[{renderer:this.renderers.heat,visible:!0},{renderer:this.renderers.selectedHeat,visible:!0},{renderer:this.renderers.dots,visible:!1},{renderer:this.renderers.labels,visible:!1},{renderer:this.renderers.oob,visible:!1}]),this._heatMap.draw()):(this.renderers.labels.stage.removeChildren(),this.renderers.labels.clear(),this.renderers.dots.stage.removeChildren(),this.renderers.dots.clear(),this.renderers.oob.stage.removeChildren(),this.renderers.oob.clear(),this.setSelectableShapes([]),this._heatMap.draw());if(this._tree.children.length>0){var b=function(){var b,c,d=[];return b=p.apply(a,[a._onlySelected]),b&&d.push(b),a._onlySelected=!1,a._labelMode>s.NONE&&a._layoutMode>a.ShowFlags.XSMALL?(c=q.apply(a,[]),c&&d.push(c)):(a.renderers.labels.stage.removeChildren(),d.push(a.renderers.labels.clear())),k.all(d)};return this._reducedModeChanged?(this._reducedModeChanged=!1,n.call(this,[{renderer:this.renderers.heat,visible:!1},{renderer:this.renderers.selectedHeat,visible:!1},{renderer:this.renderers.dots,visible:!0},{renderer:this.renderers.labels,visible:!0}]),b()):(this.renderers.heat.clear(),this.renderers.heat.stage.removeChildren(),this.renderers.selectedHeat.clear(),this.renderers.selectedHeat.stage.removeChildren(),b())}}},clear:function(){return this._transitionHelper.clear(),this._super()},toggleCacheItem:function(a){var b=!0,c=this._styles,d=.9,e=this;this.renderers.dots.stage.opacity!==this._globalAlpha&&(b=!1,this.renderers.dots.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha);var f=this._canvasShapes[a.row],g=this._labelShapes[a.row];f&&(a.selected?(f.strokeWidth=c.shape.selected.border.width,f.stroke=c.shape.selected.border.color,f.opacity=d,f.zIndex=1,g&&g.visible&&(g.text.opacity=1,g.line.opacity=1,g.zIndex=1)):(f.opacity=void 0,f.stroke=e._sheetBackgroundColor.toRGBA(),f.strokeWidth=c.shape.border.width,f.zIndex=void 0,g&&g.visible&&(g.text.opacity=void 0,g.line.opacity=void 0,g.zIndex=void 0)),b&&(f.invalidate(),g&&g.visible&&g.text.invalidate())),b||(this.renderers.dots.render(),this.renderers.labels.render(),this.renderers.oob.render())},updateRangeSelection:function(a){this._heatMap.copyHeatMap(a),this._heatMap.clipSelected(a)},startRangeSelection:function(a){this._heatMap.copyHeatMap(a)},copyHeatMap:function(){return this._heatMap.copyHeatMap()},getHeatMapCanvas:function(){return this._heatMap.getHeatMapCanvas()},clearSelection:function(){this._heatMap.clearSelection()},setRenderData:function(a){this._renderData=a}})}),define("client.property-panel/components/color-scale-creator/color-scale-creator-utils",["core.utils/theme","general.utils/color","jquery"],function(a,b,c){function d(a,b,d){var e;return e=c.extend(!0,{},a),e&&e.limits&&(e.limits=e.limits.concat().sort(function(a,b){return a.value-b.value}),e.limits.forEach(function(a){a.value=(a.value-b)/(d-b)})),e&&e.colors&&(e.colors=e.colors.concat().map(function(a){return{color:j.resolveColor(a.color)}})),e}function e(a,b){if(0!==a.limits.length){var c;return c=0===b?a.limits[b].gradient:b===a.colors.length-1?a.limits[b-1].gradient:a.limits[b].gradient||a.limits[b-1].gradient}}function f(a,b,c){if(isNaN(b))return 0;var d,e,f=c?Math.min(c,b):0,g=a.segments.limits.concat().sort(function(a,b){return a.value-b.value}),h=a.segments.colors;for(e=0;e<h.length;e++){if(e===h.length-1)return e;if(d=g[e].value,d>b&&b>=f)return e;f=d}return 0}function g(a,b,c){var d,e,f=a.limits.concat().sort(function(a,b){return a.value-b.value}),g=b>0?f[b-1]:{value:0,gradient:!1},h=a.colors[b-(b>0?1:0)],i=f[b]?f[b]:{value:1,gradient:!1},j=a.colors[b+(b<a.colors.length-1?1:0)],k=c===i.value?1:(c-g.value)/(i.value-g.value);return g&&g.gradient&&i&&i.gradient?c-g.value<i.value-c?(d=h.color,e=.5-k):(d=j.color,e=k-.5):g&&g.gradient?(d=h.color,e=1-(.5+k/2)):i&&i.gradient?(d=j.color,e=k/2):(d=a.colors[b].color,e=c),{color:d,t:e}}function h(b){return a.palette[b]?a.palette[b]:"number"==typeof b?"#000":b}function i(a,c,e,f){var g,h,i,j,k=0,l=d.call(this,a,e,f);if(0>=c)return l.colors[0].color;if(c>=1)return l.colors[l.colors.length-1].color;for(i=0;i<l.colors.length;i++){if(h=l.limits[i]?l.limits[i].value:1,c>=k&&h>c){g=this.getBlendInfo(l,i,c,e,f),j=new b(l.colors[i].color).blend(new b(g.color),g.t);break}k=h}return j}var j={blendValue:i,shouldBlend:e,getBlendInfo:g,resolveColor:h,getSegmentIndex:f};return j}),define("extensions.qliktech/scatterplot/color-map-light",["core.utils/class","client.property-panel/components/color-scale-creator/color-scale-creator-utils"],function(a,b){function c(){return this._colors&&this._colors.length&&this._limits&&this._limits.length&&!isNaN(this._min)&&!isNaN(this._max)&&this._colors.length===this._limits.length+1}var d=a.extend("ColorMapLight",{init:function(a){this._colors=a.colors,this._limits=a.limits,this._min=a.min,this._max=a.max,this._valid=c.call(this)},getColor:function(a){if(this._valid){var c={colors:this._colors,limits:this._limits},d=(a-this._min)/(this._max-this._min),e=b.blendValue(c,d,this._min,this._max);return e}},getColorMapping:function(){}});return d}),define("extensions.qliktech/scatterplot/scatterplot-properties",["general.utils/property-resolver","translator"],function(a,b){function c(b){return"primary"!==a.getValue(b,"color.mode")&&!a.getValue(b,"color.auto")}var d,e,f,g,h=1e3;f={component:"text",translation:"properties.compression.willNotAffect",show:function(a,b){return g(b)}},g=function(a){return a.layout.qHyperCube.qDimensionInfo[0]&&a.layout.qHyperCube.qDimensionInfo[0].qCardinal>h},d={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},bubbleSizeItems:{type:"items",items:{bubbleSizes:{type:"integer",component:"slider",ref:"dataPoint.bubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:5,show:function(a){return a.qHyperCubeDef.qMeasures.length<3}},rangeBubbleSizes:{type:"array",component:"slider",ref:"dataPoint.rangeBubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:[2,8],show:function(a){return a.qHyperCubeDef.qMeasures.length>=3}},rangeBubbleCompressionNote:f}},label:{type:"items",items:{labelMode:{ref:"labels.mode",translation:"properties.labels",type:"string",component:"dropdown",defaultValue:1,options:[{value:1,translation:"Common.Auto"},{value:2,translation:"Common.All"},{value:0,translation:"Common.None"}],snapshot:{tid:"property-labels"}},labelModeCompressionNote:f}},queryLevel:{type:"integer",component:"slider",ref:"compressionResolution",translation:"properties.compression.resolution",min:4,max:8,step:1,defaultValue:5,show:function(a,b){return g(b)}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a){
return!a.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{autoColor:{},colorsAnLegendCompressionNote:f,colorMode:{defaultValue:"primary",options:function(a,b){var c=[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"}];return b.getMeasures().length>=1&&c.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),c}},persistentColors:{show:function(b){return!a.getValue(b,"color.auto")&&"byDimension"===a.getValue(b,"color.mode")}}}},legend:{show:function(a){return c(a)},items:{show:{snapshot:{tid:"property-legend"}},showTitle:{show:function(b){return a.getValue(b,"legend.show")}},dock:{show:function(b){return a.getValue(b,"legend.show")}}}}}},xAxis:{type:"items",uses:"measureAxis",label:function(a,c){var d,e=c.getMeasureLayouts()[0];return d=e&&!e.qError?b.get("properties.xAxisWithInfo",[e.qFallbackTitle]):b.get("properties.xAxis")},items:{axis:{items:{show:{ref:"xAxis.show",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},dock:{ref:"xAxis.dock",show:function(a){return"none"!==a.xAxis.show},options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}]},spacing:{ref:"xAxis.spacing",show:function(a){return"none"!==a.xAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"xAxis.autoMinMax"},minMax:{ref:"xAxis.minMax",show:function(a){return!a.xAxis.autoMinMax}},min:{ref:"xAxis.min",show:function(a){return["min","minMax"].contains(a.xAxis.minMax)&&!a.xAxis.autoMinMax},invalid:function(a){return"minMax"===a.xAxis.minMax?a.xAxis.min>=a.xAxis.max:!1}},max:{ref:"xAxis.max",show:function(a){return["max","minMax"].contains(a.xAxis.minMax)&&!a.xAxis.autoMinMax},invalid:function(a){return"minMax"===a.xAxis.minMax?a.xAxis.min>=a.xAxis.max:!1}}}}}},yAxis:{type:"items",uses:"measureAxis",label:function(a,c){var d,e=c.getMeasureLayouts()[1];return d=e&&!e.qError?b.get("properties.yAxisWithInfo",[e.qFallbackTitle]):b.get("properties.yAxis")},items:{axis:{items:{show:{ref:"yAxis.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"yAxis.dock",show:function(a){return"none"!==a.yAxis.show}},spacing:{ref:"yAxis.spacing",show:function(a){return"none"!==a.yAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"yAxis.autoMinMax"},minMax:{ref:"yAxis.minMax",show:function(a){return!a.yAxis.autoMinMax}},min:{ref:"yAxis.min",show:function(a){return["min","minMax"].contains(a.yAxis.minMax)&&!a.yAxis.autoMinMax},invalid:function(a){return"minMax"===a.yAxis.minMax?a.yAxis.min>=a.yAxis.max:!1}},max:{ref:"yAxis.max",show:function(a){return["max","minMax"].contains(a.yAxis.minMax)&&!a.yAxis.autoMinMax},invalid:function(a){return"minMax"===a.yAxis.minMax?a.yAxis.min>=a.yAxis.max:!1}}}}}}}};var i={uses:"data"};return e={type:"items",component:"expandable-items",translation:"properties.addons",items:{refLinesX:{uses:"reflines",ref:"refLine.refLinesX",translation:"properties.referenceLinesX"},refLinesY:{uses:"reflines",ref:"refLine.refLinesY",translation:"properties.referenceLinesY"},dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:i,addons:e,settings:d}}}),define("extensions.qliktech/scatterplot/scatterplot-data",["general.utils/property-resolver"],function(a){function b(a){var b=a.getMeasures();2===b.length?a.setSorting([2,1,0]):3===b.length&&a.setSorting([3,2,1,0])}function c(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byExpression"===e&&0===d.length&&a.setValue(b,"color.mode","primary")}var d={dimensions:{min:1,max:1},measures:{min:2,max:3,add:function(a,c,d){b(d),a.qSortBy.qSortByNumeric=-1},remove:function(a,d,e){b(e),c(d,e)}}};return d}),define("text!extensions.qliktech/scatterplot/scatterplot.ng.html",[],function(){return'<div style="height: 100%; position: relative;">\r\n	<div qv-extension\r\n		class="qv-viz"\r\n		style="position: relative;">\r\n	</div>\r\n	<span class="qv-viz-disclaimer" ng-if="dataAttributes.reduceDataDisc  && dataAttributes.layoutMode > 2">{{ reducedDataNote }}</span>\r\n	<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n	<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n    <div qva-scatter-navigation>\r\n	<!--on-navigation="onNavigation"\r\n    navigation-disabled="navigationDisabled"\r\n    navigation-home-only="navigationHomeOnly"\r\n    navigation-visible="navigationVisible"\r\n    navigation-style="navigationPosition"-->\r\n	</div>\r\n	<div qva-scatter-mini-map ng-show="showMiniMap" ng-style="miniMapStyle" colorMap="colorMap"></div>\r\n	<qv-resolution-slider></qv-resolution-slider>\r\n</div>'}),define("text!extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation.ng.html",[],function(){return'<div class="qv-scatter-nav" ng-style="navigationStyle">\r\n	<div ng-show="navigationHomeOnly && navigationVisible" class="qv-scatter-nav-homeonly">\r\n		<button class="qv-scatter-nav-home qui-plainbuttonicon" data-icon="ü" qva-activate="onHomePressed()" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ResetZoom" />\r\n	</div>\r\n	<div ng-show="!navigationHomeOnly && navigationVisible" class="qv-scatter-nav-fullnav">\r\n		<div class="qv-scatter-nav-top">\r\n			<button class="qv-scatter-nav-up qui-plainbuttonicon" data-icon="R" qva-activate="onNavigationPressed(\'navUp\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanUp" />\r\n		</div>\r\n		<div class="qv-scatter-nav-middle">\r\n			<button class="qv-scatter-nav-left qui-plainbuttonicon" data-icon="T" qva-activate="onNavigationPressed(\'navLeft\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanLeft" />\r\n			<button class="qv-scatter-nav-home qui-plainbuttonicon" data-icon="ü" qva-activate="onHomePressed()" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ResetZoom" />\r\n			<button class="qv-scatter-nav-right qui-plainbuttonicon" data-icon="U" qva-activate="onNavigationPressed(\'navRight\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanRight" />\r\n		</div>\r\n		<div class="qv-scatter-nav-bottom">\r\n			<button class="qv-scatter-nav-down qui-plainbuttonicon" data-icon="S" qva-activate="onNavigationPressed(\'navDown\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanDown" />\r\n			<button class="qv-scatter-nav-in qui-plainbuttonicon" data-icon="Y" qva-activate="onNavigationPressed(\'zoomIn\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomIn" />\r\n			<button class="qv-scatter-nav-out qui-plainbuttonicon" data-icon="Z" qva-activate="onNavigationPressed(\'zoomOut\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomOut" />\r\n		</div>\r\n	</div>\r\n</div>'}),define("extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation",["qvangular","text!./scatterplot-navigation.ng.html"],function(a,b){a.directive("qvaScatterNavigation",function(){return{template:b,replace:!0,link:function(a,b){a.innerElement=b.find(".qv-scatter-nav"),a.onHomePressed=function(){a.$broadcast("navigationPressed","resetZoom")},a.onNavigationPressed=function(b){a.$broadcast("navigationPressed",b)}}}})}),define("extensions.qliktech/scatterplot/axis-light",["core.utils/class"],function(a){var b=a.extend("AxisLight",{init:function(a,b,c,d){this._values={min:a,max:b},this._positions={min:c,max:d}},setValues:function(a){this._values=a},getValues:function(){return this._values},setPositions:function(a){this._positions=a},getPositions:function(){return this._positions},getPositionOfValue:function(a){var b=(a-this._values.min)/(this._values.max-this._values.min),c=this._positions.max-this._positions.min;return this._positions.min+c*b}});return b}),define("text!extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map.ng.html",[],function(){return'<div class="qv-scatter-mini-map">\r\n	<div class="scatter-mini-map"></div>\r\n	<div class="scatter-mini-map-focus" ng-style="focusStyle"></div>\r\n</div>'}),define("extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map",["qvangular","objects.views/charts/renderers/canvas-renderer","extensions.qliktech/scatterplot/axis-light","extensions.qliktech/scatterplot/heat-map-light","text!./scatterplot-mini-map.ng.html","touche"],function(a,b,c,d,e){a.directive("qvaScatterMiniMap",function(){return{template:e,replace:!0,link:function(a,e){var f,g,h,i=e.find(".scatter-mini-map"),j=".scatterplot-mini-map",k=new c,l=new c,m=function(b){if(h){var c=k.getPositionOfValue(h.xMin),d=l.getPositionOfValue(h.yMax),e=k.getPositionOfValue(h.xMax)-k.getPositionOfValue(h.xMin),f=l.getPositionOfValue(h.yMin)-l.getPositionOfValue(h.yMax),g=b.width,i=b.height;0>c?(e+=c,c=0):c>g&&(c=g,e=0),0>d?(f+=d,d=0):d>i&&(d=i,f=0),c+e>g&&(e=g-c),d+f>i&&(f=i-d),f=f>i?i:f,e=e>g?g:e,a.focusStyle={left:c,top:d,width:e,height:f}}},n=function(b,c){var d=a.focusStyle.width,f=a.focusStyle.height,i={x:c.pagePoints[0].x-e.offset().left,y:c.pagePoints[0].y-e.offset().top},j={x:a.focusStyle.left+d/2,y:a.focusStyle.top+f/2},k=(i.x-j.x)/(h.scale*e.width()),l=(i.y-j.y)/(h.scale*e.height());a.$broadcast("navigationPressed","jumpTo",{x:-k*g.width+g.width/2,y:-l*g.height+g.height/2})};a.renderers={overview:new b(i[0],{name:"overview"})},f=new d(a.renderers.overview),f.setXAxis(k),f.setYAxis(l),f.setColorMapLight(a.colorMap),a.$on("onUpdateMiniMapData",function(a,b){f.setData(b)}),a.$on("onResizeMiniMap",function(b,c,d){k.setPositions({min:0,max:c.width}),l.setPositions({min:c.height,max:0}),a.renderers.overview.setDimensions(0,0,c.width,c.height),m({width:c.width,height:c.height}),g=d,f.draw()}),a.$on("onUpdateMiniMap",function(b,c){var d=e.width(),g=e.height();k.setValues(c.x),k.setPositions({min:0,max:d}),l.setValues(c.y),l.setPositions({min:g,max:0}),a.renderers.overview.setDimensions(0,0,e.width(),e.height()),f.draw()}),a.$on("onUpdateMiniMapFocus",function(a,b,c,d,f){var g=k.getValues();h={xMin:b,yMin:d,xMax:c,yMax:f,scale:(c-b)/(g.max-g.min)},m({width:e.width(),height:e.height()})}),a.$on("onResetMiniMapFocus",function(){a.focusStyle={left:0,top:0,width:e.width(),height:e.height()}}),Touche(e[0]).tap({id:j,end:function(a,b){n(a,b)}}),Touche(e[0]).swipe({id:j,update:function(a,b){n(a,b)}})}}})}),define("text!extensions.qliktech/scatterplot/directives/resolution-slider/resolution-slider.ng.html",[],function(){return'<div class="qv-reso-slider" ng-show="resolutionSliderVisible" ng-style="resolutionSliderStyle">\r\n	<div class="qv-reso-slider-icon icon-low-resolution"></div>\r\n\r\n	<div class="value">\r\n		<div class="slider" qv-resolution-slider-ui></div>\r\n	</div>\r\n\r\n	<div class="qv-reso-slider-icon icon-high-resolution"></div>\r\n</div>'}),define("extensions.qliktech/scatterplot/directives/resolution-slider/resolution-slider",["qvangular","translator","text!./resolution-slider.ng.html","jqueryui"],function(a,b,c){a.directive("qvResolutionSlider",function(){return{template:c,restrict:"E",replace:!0,link:function(){}}}),a.directive("qvResolutionSliderUi",function(){return{restrict:"A",link:function(a,c){function d(b,c){if(c.value!==a.layout.compressionResolution){var d=[[{qPath:"/compressionResolution",qOp:"replace",qValue:c.value.toString()}],!0];a.backendApi.applyPatches(d)}}var e={min:4,max:8,step:1,value:a.layout.compressionResolution,stop:d};a.$watch("layout.compressionResolution",function(a){a!==c.slider("value")&&c.slider("value",a)}),c.slider(e);var f=c.find(".ui-slider-handle");f.attr("title",b.get("properties.compression.resolution"))}}})}),define("extensions.qliktech/scatterplot/scatterplot",["jquery","core.utils/deferred","client.utils/state","translator","objects.views/charts/axis-chart","objects.views/charts/components/chart-component","objects.views/charts/components/ref-line-labels","objects.views/charts/utils/binding","./scatterarea","objects.views/charts/representation/combo-color-map","extensions.qliktech/scatterplot/color-map-light","objects.backend-api/hypercube-api","extensions.qliktech/scatterplot/scatterplot-properties","extensions.qliktech/scatterplot/scatterplot-data","text!./scatterplot.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/utils/matrix","general.utils/property-resolver","objects.utils/number-formatter","extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation","extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map","extensions.qliktech/scatterplot/directives/resolution-slider/resolution-slider","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){"use strict";function v(a){var b,c=[],d=a[0].qMatrix;if(c.push(d[0][0]),a[0].reformatted)for(b=1;b<d.length;b++)try{c.push(d[b][0])}catch(e){}else{for(b=1;b<d.length;b++)try{d[b][0].qText=JSON.parse(d[b][0].qText),c.push(d[b][0])}catch(e){}a[0].reformatted=!0}return[c]}function w(a,b){b&&"auto"!==t.getValue(b,"legend.dock","auto")?a.setDock(b.legend.dock):a.outerRect.height/a.outerRect.width<1?a.setDock("right"):a.setDock("bottom")}function x(a){var b=a.getActiveType(),c=a.types.tooltip;b&&"item"!==b.getActiveMode()&&b.clearSelection(),c&&c.clearSelection()}function y(){var a=(this._layoutMode<31||!this._data.navigation)&&this._on&&!c.isInEditMode()&&this._layoutMode>3,b=(!this._defaultZoomPan||!!this._data.navigation)&&this._on&&!c.isInEditMode()&&(this._layoutMode>3||a&&this._layoutMode>=3),d=this;this.$scope.navigationHomeOnly=a,this.$scope.navigationVisible=b,this.$scope.navigationStyle={top:this.components.dataArea.rect.y+5+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+5+"px"},setTimeout(function(){d.$scope.$digest()})}function z(){this.$scope.resolutionSliderVisible=!this.backendApi.isSnapshot&&!c.isInEditMode()&&this.components.dataArea.getIsReduced()}function A(){var a=this.components.dataArea,b=a._xAxis,c=a._yAxis,d=this;x(this.selections),b.setUseTransition(this._allowTransitions),c.setUseTransition(this._allowTransitions),b.setPlotMin(!this._data.xAxis.autoMinMax&&["min","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.min):null),b.setPlotMax(!this._data.xAxis.autoMinMax&&["max","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.max):null),c.setPlotMin(!this._data.yAxis.autoMinMax&&["min","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.min):null),c.setPlotMax(!this._data.yAxis.autoMinMax&&["max","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.max):null),this._axisInfo.x.min=this.components.xAxis.getPlotMin(),this._axisInfo.x.max=this.components.xAxis.getPlotMax(),this._axisInfo.y.min=this.components.yAxis.getPlotMin(),this._axisInfo.y.max=this.components.yAxis.getPlotMax(),this._defaultZoomPan=!0,this._zoomScale=1,this._paint(),setTimeout(function(){d._debouncedUpdateLayout.call(d),d.$scope.$emit("onResetMiniMapFocus"),d.$scope.showMiniMap=!1},1e3)}function B(a,b,c,d){var e,f,g,h=this,i=this._transformMatrix.identity(),j=this.components.dataArea.rect,k=this.components.xAxis,l=this.components.yAxis,m={x:this._axisInfo.x.min,y:this._axisInfo.y.min},n={x:this._axisInfo.x.max,y:this._axisInfo.y.max},o=n.x-m.x,p=n.y-m.y,q={x:a/j.width*o+m.x,y:n.y-b/j.height*p};f=(this._panX-a)/j.width*o,g=(this._panY-b)/j.height*p,i.translate(f,-g),c&&(i.translate(q.x,q.y),i.scale(1/c,1/c),i.translate(-q.x,-q.y)),this._defaultZoomPan=!1,m=i.transformPoint(m),n=i.transformPoint(n);var r=m.x>this._xZoomMin&&n.x<this._xZoomMax&&n.x-m.x>1e-5*(k.getDataMax()-k.getDataMin()),s=m.y>this._yZoomMin&&n.y<this._yZoomMax&&n.y-m.y>1e-5*(l.getDataMax()-l.getDataMin());r&&(k.setPlotMin(m.x),k.setPlotMax(n.x)),s&&(l.setPlotMin(m.y),l.setPlotMax(n.y)),r&&s&&(this.components.dataArea.clearSelection(),d&&(this._translateInfo.x=Math.round(d.deltaX),this._translateInfo.y=Math.round(d.deltaY),this.components.dataArea.getIsReduced()&&this.components.dataArea.renderers.heat.translateScene(this._translateInfo.x-this._prevTranslateInfo.x,this._translateInfo.y-this._prevTranslateInfo.y),this._prevTranslateInfo.x=this._translateInfo.x,this._prevTranslateInfo.y=this._translateInfo.y),1!==c&&this.components.dataArea.getIsReduced()&&this.components.dataArea.renderers.heat.scaleScene(a,b,c),!this._isBigData||k.getPlotMin()<=this._resettedAxisInfo.x.min&&k.getPlotMax()>=this._resettedAxisInfo.x.max&&l.getPlotMin()<=this._resettedAxisInfo.y.min&&l.getPlotMax()>=this._resettedAxisInfo.y.max?h.$scope.showMiniMap=!1:h.$scope.showMiniMap=!0,h.$scope.$emit("onUpdateMiniMapFocus",m.x,n.x,m.y,n.y));for(e in this.components)"dataArea"===e&&this.components.dataArea.getIsReduced()||this.components[e].invalidateDisplay();y.call(this)}function C(a,b){this._panX=a,this._panY=b,this._axisInfo.x.min=this.components.xAxis.getPlotMin(),this._axisInfo.x.max=this.components.xAxis.getPlotMax(),this._axisInfo.y.min=this.components.yAxis.getPlotMin(),this._axisInfo.y.max=this.components.yAxis.getPlotMax(),this._prevTranslateInfo.x=this._translateInfo.x=0,this._prevTranslateInfo.y=this._translateInfo.y=0,this.components.xAxis.setUseTransition(!1),this.components.yAxis.setUseTransition(!1),x(this.selections)}function D(){this._debouncedUpdateLayout()}function E(a,c,e,f,g){if(this._dataDfd=b(),this._ready=this._dataDfd.promise,!this._data)return this._fetchedData=!0,this.$scope.throbberApi.hide(),b.resolve();var h=this,i=this._data.compressionResolution?this._data.compressionResolution:M,j=1e3,k=g?g-1:0,l=function(){return h._fetchedData=!0,h.prePaint(h._data),b.all([h._updateData(h._data)]).then(function(){h._dataDfd.resolve(),h.$scope.throbberApi.hide()})};return this.backendApi.getHyperCubeAdaptiveGrid(void 0===h._data?void 0:[{qTop:0,qLeft:0,qWidth:h._data.qHyperCube.qSize.qcx,qHeight:h._data.qHyperCube.qSize.qcy}],[{qLeft:a,qTop:c,qWidth:e,qHeight:f}],j,Math.min(i+k,N)).then(function(a){if(!h._data||!a||h._destroyed)return h._fetchedData=!0,void h.$scope.throbberApi.hide();if(h.components.dataArea.setIsBigData(!0),a[0].qMatrix.length>0){h._isReducedMode=!0,h._data.qHyperCube.isReduced=!0;var b=v([a[0]]);return h.components.dataArea.setHeatMap(b),h.components.colorLegendLight&&h.components.colorLegendLight.setClusterDataPage(b),h._needUpdateMiniMap&&h.$scope.$emit("onUpdateMiniMapData",b),h.components.dataArea.setIsReduced(!0),h.$scope.reducedDataNote="*"+d.get("properties.compression.providingOverviewOf",[h._numberFormatter.format(h._data.qHyperCube.qSize.qcy,h._defaultPattern)]),h._toggleLasso&&(h._oldToggleLasso=!0,h.toggleLasso(!1)),l()}return h._isReducedMode=!1,h._data.qHyperCube.isReduced=!1,h._data.qHyperCube.qDataPages=[a[1]],h.components.dataArea.setIsReduced(!1),!h._toggleLasso&&h._oldToggleLasso&&(h.toggleLasso(!0),h._oldToggleLasso=!1),l()})}function F(){var a;if(this._dataUpdatedOnPanOrZoom&&!this._isReducedMode&&this._selectedElemNumbers){var b,c,d=this._data&&this._data.qHyperCube&&this._data.qHyperCube.qDataPages&&this._data.qHyperCube.qDataPages[0]?this._data.qHyperCube.qDataPages[0].qMatrix:void 0,e=d?d.length:0,f={},g=this._selectedElemNumbers.length;for(a=[],this._selectedElemNumbersWithoutRowIndex=[],b=0;e>b;b++)c=d[b][0].qElemNumber,f[c]=b;for(b=0;g>b;b++)c=this._selectedElemNumbers[b],void 0===f[c]?this._selectedElemNumbersWithoutRowIndex[this._selectedElemNumbersWithoutRowIndex.length]=c:a[a.length]=f[c]}return a}function G(){var a=this.components.dataArea.rect.width,b=this.components.dataArea.rect.height,c=.15,d=10;this._layoutMode<=3?this.$scope.miniMapStyle={display:"none"}:this.$scope.miniMapStyle={display:"block",left:this.components.dataArea.rect.x+this.components.dataArea.rect.width*(1-c)-d,top:this.components.dataArea.rect.y+this.components.dataArea.rect.height*(1-c)-d,width:this.components.dataArea.rect.width*c,height:this.components.dataArea.rect.height*c},this.$scope.$emit("onResizeMiniMap",this.$scope.miniMapStyle,{width:a,height:b})}function H(){var a={colors:[{color:"rgba(111,153,197,1.0)"},{color:"rgba(29,51,72,1.0)"}],limits:[{value:.5,gradient:!0}],min:0,max:1};this._colorMapLight=new k(a),this.components.dataArea&&this.components.dataArea.setColorMapLight(this._colorMapLight),this.components.colorLegendLight&&this.components.colorLegendLight.setColorMapLight(this._colorMapLight)}function I(){var a,b,c=this.components.dataArea.rect.width,d=270,e=170,f=10;this._layoutMode<=3||this._inSelectionMode?b={visibility:"hidden"}:(a=Math.max(e,Math.min(d,.5*c)),b={visibility:"visible",left:this.components.dataArea.rect.x+c/2-a/2,width:a,top:this.components.dataArea.rect.y+f}),this.$scope.resolutionSliderStyle=b}var J,K=".scatterplot",L=1e3,M=6,N=8;return J=e.extend("ScatterPlot",{init:function(b,d,e,k){var l,m=this;e=a.extend(!0,e||{},{providers:{colorMap:{clazz:j,colorBy:"dimension",autoMode:"primary"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:f.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",clazz:i,showFlag:f.prototype.ShowFlags.SPARK},grid:{showFlag:f.prototype.ShowFlags.XSMALL},colorLegendLight:{show:!0,order:4,reductionOrder:1,dock:"right",relevantSize:126,showFlag:f.prototype.ShowFlags.MEDIUM},xAxis:{showFlag:f.prototype.ShowFlags.SMALL},yAxis:{showFlag:f.prototype.ShowFlags.SMALL},xAxisTitle:{show:!1},refLineLabelsX:{show:!0,dock:"top",order:3,showFlag:f.prototype.ShowFlags.XSMALL,clazz:g},refLineLabelsY:{show:!0,dock:"right",order:3,showFlag:f.prototype.ShowFlags.XSMALL,clazz:g}}}),this._resettedAxisInfo={x:{min:0,max:0},y:{min:0,max:0}},this._axisInfo={x:{min:null,max:null},y:{min:null,max:null}},this._prevTranslateInfo={x:0,y:0},this._translateInfo={x:0,y:0},this._needNewData=!0,this._super(b,d,e,k),this.backendApi.setCacheOptions({enabled:!1}),this._numberFormatter=new u,this._defaultPattern="#.#A",this.components.xAxisTitle.hideComponent(),this._showLegend=!1,this.components.dataArea.setYAxis(this.components.yAxis),this.components.dataArea.setXAxis(this.components.xAxis),this.components.yAxis.setShowExplicitMinMax(!1),this.components.xAxis.setShowExplicitMinMax(!1),this._allowTransitions=c.view!==c.Views.story,this.components.yAxis.setUseTransition(this._allowTransitions),this.components.xAxis.setUseTransition(this._allowTransitions),this.components.grid.setAxes(this.components.xAxis,this.components.yAxis),this._transformMatrix=new s;var n=this.providers.colorMap.getLegendDataProvider();n.setLegendMarker("circle"),H.call(this),b.colorMap=this._colorMapLight,this.components.xAxis.getTransitionHelper().setTransitionTime(700),this.components.yAxis.getTransitionHelper().setTransitionTime(700),this.components.dataArea.getTransitionHelper().setTransitionTime(700),this._changeWatchers.push(h.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(h.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._debouncedUpdateLayout=p.debounce(function(){var a=m._data.qHyperCube.qSize.qcy>L&&!this.backendApi.isSnapshot,b=m.components.xAxis.getPlotMin(),c=m.components.xAxis.getPlotMax(),d=m.components.yAxis.getPlotMin(),e=m.components.yAxis.getPlotMax(),f=Math.floor(Math.sqrt((m._data.qHyperCube.qMeasureInfo[1].qMax-m._data.qHyperCube.qMeasureInfo[1].qMin)/(e-d)));a?(m._dataUpdatedOnPanOrZoom=!0,E.call(this,b,e,c-b,e-d,f).then(function(){m._paint()})):m._paint().then(function(){m.components.xAxis.setUseTransition(!0),m.components.yAxis.setUseTransition(!0)})},400),l=function(a,b,d){if(!c.isInEditMode()){var e=m.components.dataArea.rect.width/2,f=m.components.dataArea.rect.height/2;C.apply(m,[e,f]),B.apply(m,[a,b,d,{deltaX:a-e,deltaY:b-f}]),D.apply(m)}},this._zoomScale=1,this.onNavigationPressed=b.$on("navigationPressed",function(a,b,c){switch(a.preventDefault(),b){case"resetZoom":A.call(m);break;case"zoomIn":l(m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2,m._zoomScale+.2);break;case"zoomOut":l(m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2,m._zoomScale-.2);break;case"navUp":l(m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2+30,0);break;case"navDown":l(m.components.dataArea.rect.width/2,m.components.dataArea.rect.height/2-30,0);break;case"navLeft":l(m.components.dataArea.rect.width/2+30,m.components.dataArea.rect.height/2,0);break;case"navRight":l(m.components.dataArea.rect.width/2-30,m.components.dataArea.rect.height/2,0);break;case"jumpTo":l(c.x,c.y)}}),this.$scope.navigationDisabled=!0},initSelections:function(){var a=this,b=this.components.dataArea;this.selections._disableSelections=this.options._disableSelections,this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.Pan.bind(this.onPan.bind(this)),this.options._disableSelections||(this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.types.range.setComponent("x",this.components.xAxis),this.selections.types.range.setComponent("y",this.components.yAxis),this.selections.Activated.bind(function(){b.getIsReduced()&&b.copyHeatMap(),a._inSelectionMode=!0,I.call(a),a.onSelection.Activated.call(a)}),this.selections.Deactivated.bind(function(){a._inSelectionMode=!1,I.call(a),a.onSelection.Deactivated.call(a)}),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(a.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)),this.selections.ResetSelections.bind(function(){b.getIsReduced&&b.clearSelection()}))},Select:function(a,b,c,d){var e,f,g,h=[];for(e=this._data.qHyperCube.qDataPages[0].qMatrix,f=0;f<this._selectedRows.length;f++)g=e[this._selectedRows[f]],void 0!==g&&(h[h.length]=g[0].qElemNumber);this._selectedElemNumbers=this._selectedElemNumbersWithoutRowIndex?this._selectedElemNumbersWithoutRowIndex.concat(h):h,this._data.qHyperCube.qSize.qcy>L?this._selectedElemNumbers&&this._selectedElemNumbers.length?this.backendApi.selectValues(0,this._selectedElemNumbers,!1):this.backendApi.clearSelections():this.onSelection.Select.apply(this,[a,b,c,d])},Clear:function(){this.onSelection.Clear.call(this),this._selectedElemNumbers=void 0},Confirm:function(){this.onSelection.Confirm.call(this),this._selectedElemNumbers=void 0},_postResize:function(){this._super(),w.apply(this,[this.components.colorLegendLight,this._data])},updateLegend:function(){this.components.colorLegend&&(this._super(),w.apply(this,[this.components.colorLegendLight,this._data]))},_paint:function(c){var d=this;return this._super().then(function(e){return e&&e.invalid?void 0:d._ready.then(function(){var d,e=[],f=this;this._fetchedData=!1,this.components.dataArea&&(this._offset=a(this.components.dataArea.container).offset()),void 0===c&&(c=!0),c&&(this._updateLayoutMode(this.rect.width,this.rect.height),this.layout());for(d in this.components)e.push(this.components[d].invalidateDisplay());return y.call(this),this._needUpdateMiniMap&&setTimeout(function(){f._resettedAxisInfo.x.min=f.components.xAxis.getPlotMin(),f._resettedAxisInfo.x.max=f.components.xAxis.getPlotMax(),f._resettedAxisInfo.y.min=f.components.yAxis.getPlotMin(),f._resettedAxisInfo.y.max=f.components.yAxis.getPlotMax(),f.$scope.$emit("onUpdateMiniMap",f._resettedAxisInfo),f.$scope.showMiniMap=!1,f._needUpdateMiniMap=!1},1e3),c&&(G.call(this),I.call(this)),b.all(e)}.bind(this))}.bind(this))},onPan:function(a,b,c){var d=this;switch(a){case"update":d._panning||(d._panning=!0,C.apply(d,[c.swipe.startPoint.x,c.swipe.startPoint.y])),d._panning&&B.apply(d,[c.swipe.currentPoint.x,c.swipe.currentPoint.y,1,c.swipe]);break;case"end":D.apply(d),d._panning=!1}},on:function(){var b,c,d,e=this;if(!this._on){if(this.supressDotRendering)return void this.selections.off();var f=function(a){var b=p.getMouseWheelData(a.originalEvent);C.apply(e,[b.x-e._offset.left,b.y-e._offset.top]),B.apply(e,[b.x-e._offset.left,b.y-e._offset.top,b.delta>0?1.2:.8]),D.apply(e)};p.throttle(f,20),a(this.components.dataArea.container).on("mousewheel"+K+" DOMMouseScroll"+K,function(a){f(a),a.preventDefault()}),Touche(this.components.dataArea.container).wheelswipe({id:K,start:function(a){b=e._panX=a.pageX,c=e._panY=a.pageY},update:function(a){if(!e._panning&&(Math.abs(a.pageX-e._panX)>3||Math.abs(a.pageX-e._panX)>3)&&(e._panning=!0,C.apply(e,[e._panX,e._panY])),e._panning){var d={curDeltaX:a.pageX-b,curDeltaY:a.pageY-c};B.apply(e,[a.pageX,a.pageY,1,d]),b=a.pageX,c=a.pageY}},end:function(){e._panning||A.call(e),D.apply(e),e._panning=!1}});var g;Touche(this.components.dataArea.container).swipe({id:K,options:{touches:2},start:function(a,b){var c=b.points[1].x-b.points[0].x,e=b.points[1].y-b.points[0].y;d=1,g=Math.sqrt(c*c+e*e)},update:function(a,b){var c,f,h={x:(b.points[0].x+b.points[1].x)/2,y:(b.points[0].y+b.points[1].y)/2},i=b.points[1].x-b.points[0].x,j=b.points[1].y-b.points[0].y,k=Math.sqrt(i*i+j*j),l=k/g;e._panning||(e._panning=!0),c=h.x-e._offset.left,f=h.y-e._offset.top,C.apply(e,[c,f]),B.apply(e,[c,f,1+(l-d)]),d=l,Touche.preventGestures(this.gestureHandler)},end:function(){e._panning=!1,D.apply(e)}}).tap({id:this.eventNS,options:{touches:2,preventDefault:!1},end:function(){e._isReducedMode&&Touche.preventGestures(this.gestureHandler)}}),Touche(this.components.dataArea.container).tap({id:K,options:{touches:3},end:function(){A.call(e),Touche.preventGestures(this.gestureHandler)}}),Touche(this.container).longtap({id:K}),this._super(),this.$scope.navigationDisabled=!1,this._on=!0}},off:function(){this.$scope.navigationDisabled=!0,this._on&&(Touche(this.components.dataArea.container).off("*",K),Touche(this.container).off("*",K),a(this.components.dataArea.container).off(K),a(this.container).off(K),this._super(),this._on=!1)},isValid:function(a){return this._super(a)&&a.qHyperCube.qMeasureInfo.length>=2&&!this.supressChartRendering},prePaint:function(a){this._super(),this.$scope.dataAttributes.limitedData=a.qHyperCube.qSize.qcy>L,this.$scope.dataAttributes.reduceDataDisc=this.$scope.dataAttributes.limitedData,q.applyDisclaimerAttributes({title:!1,bottom:!0,overlay:!1,explicitLimitedData:this.$scope.dataAttributes.limitedData},this.$scope.dataAttributes,this.$element,this.$scope,c,a),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist,this.supressDotRendering=this.supressChartRendering,this.$scope.dataAttributes.noDataExist||(this.$scope.dataAttributes.onlyNanData=a.qHyperCube.qMeasureInfo.slice(0,2).some(function(a){return a.qMax<a.qMin||"NaN"===a.qMax}))},toggleLasso:function(a){a&&this._isReducedMode||this._super(a)},isLassoDisabled:function(){return this._isReducedMode},isLassoing:function(){return this._toggleLasso&&!this._isReducedMode},_updateHyperCube:function(a){this._allowTransitions=c.view!==c.Views.story;var b,d,e,f,g;this._dataUpdatedOnPanOrZoom||(this._defaultZoomPan=!0),this._transformMatrix.identity(),this._currentPanX=0,this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.colorLegend.setData(a),this.components.colorLegendLight&&this.components.colorLegendLight.setData(a),g=this.getSnapshotStoredChartData(),f=a.qHyperCube.qMeasureInfo[0].qMin,e=a.qHyperCube.qMeasureInfo[0].qMax,
d=e-f,b=f-10*(d>0?d:Math.abs(e)/20),["min","minMax"].contains(a.xAxis.minMax&&!a.xAxis.autoMinMax)?this._xZoomMin=a.xAxis.min<b?a.xAxis.min:b:this._xZoomMin=b,b=e+10*(d>0?d:Math.abs(e)/20),["max","minMax"].contains(a.xAxis.minMax&&!a.xAxis.autoMinMax)?this._xZoomMax=a.xAxis.max>b?a.xAxis.max:b:void 0!==a.xAxis.min?this._xZoomMax=a.xAxis.min>b?a.xAxis.min+b:b:this._xZoomMax=b,f=a.qHyperCube.qMeasureInfo[1].qMin,e=a.qHyperCube.qMeasureInfo[1].qMax,d=e-f,b=f-10*(d>0?d:Math.abs(e)/20),["min","minMax"].contains(a.yAxis.minMax&&!a.yAxis.autoMinMax)?this._yZoomMin=a.yAxis.min<b?a.yAxis.min:b:this._yZoomMin=b,b=e+10*(d>0?d:Math.abs(e)/20),["max","minMax"].contains(a.yAxis.minMax&&!a.yAxis.autoMinMax)?this._yZoomMax=a.yAxis.max>b?a.yAxis.max:b:void 0!==a.yAxis.min?this._yZoomMax=a.yAxis.min>b?a.yAxis.min+Math.abs(b):b:this._yZoomMax=b,this._readStoredData&&g&&(this.components.xAxis.setPlotMin(g.xAxisMin),this.components.xAxis.setPlotMax(g.xAxisMax),this.components.yAxis.setPlotMin(g.yAxisMin),this.components.yAxis.setPlotMax(g.yAxisMax)),a.legend&&this.components.colorLegend[(this.supressDotRendering||!a.legend.auto&&!a.legend.show?"hide":"show")+"Component"](),this._zoomScale=1},_updateData:function(a){var c,d=this;this._data=a,this._needNewData=!0;var e=F.call(this);if(this._fetchedData)c={axes:{xAxis:{component:this.components.xAxis,data:a.xAxis,title:a.qHyperCube.qMeasureInfo[0].qFallbackTitle,dataIndices:[0]},yAxis:{component:this.components.yAxis,data:a.yAxis,title:a.qHyperCube.qMeasureInfo[1].qFallbackTitle,dataIndices:[1]}},refLineLabels:{x:{axis:this.components.xAxis,data:a.refLine?a.refLine.refLinesX:"",component:this.components.refLineLabelsX},y:{axis:this.components.yAxis,data:a.refLine?a.refLine.refLinesY:"",component:this.components.refLineLabelsY}},refLines:{component:this.components.refLines}},this._super(a,c),e&&(this._selectedRows=e),this._updateHyperCube(a),this._needNewData=!1;else if(this._dataUpdatedOnPanOrZoom=!1,this._isBigData=a.qHyperCube.isBigData=a.qHyperCube.qSize.qcy>L,this._needUpdateMiniMap=!0,this._isBigData){var f=a.xAxis.autoMinMax||"min"!==a.xAxis.minMax&&"minMax"!==a.xAxis.minMax?a.qHyperCube.qMeasureInfo[0].qMin:a.xAxis.min,g=a.xAxis.autoMinMax||"max"!==a.xAxis.minMax&&"minMax"!==a.xAxis.minMax?a.qHyperCube.qMeasureInfo[0].qMax:a.xAxis.max,h=a.yAxis.autoMinMax||"min"!==a.yAxis.minMax&&"minMax"!==a.yAxis.minMax?a.qHyperCube.qMeasureInfo[1].qMin:a.yAxis.min,i=a.yAxis.autoMinMax||"max"!==a.yAxis.minMax&&"minMax"!==a.yAxis.minMax?a.qHyperCube.qMeasureInfo[1].qMax:a.yAxis.max;this.$scope.throbberApi.show(),E.call(this,f,i,g-f,i-h)}else this._dataDfd=b(),this._ready=this._dataDfd.promise,this._isReducedMode=!1,a.qHyperCube.isReduced=!1,this._selectedElemNumbers=void 0,this._selectedElemNumbersWithoutRowIndex=void 0,this.backendApi.getData([{qTop:0,qLeft:0,qWidth:a.qHyperCube.qSize.qcx,qHeight:1e3}]).then(function(a){d._data.qHyperCube.qDataPages=a,d._fetchedData=!0,d.components.dataArea.setIsBigData(!1),d.components.dataArea.setIsReduced(!1),d.prePaint(d._data),b.all([d._updateData(d._data)]).then(function(){d._dataDfd.resolve()})});z.call(this)},updateDataArea:function(a,b){this._super(a,b),a.qHyperCube.qMeasureInfo.length>2&&a.dataPoint.rangeBubbleSizes?a.dataPoint.rangeBubbleSizes.length>0&&(this.components.dataArea.setMinDotSize(a.dataPoint.rangeBubbleSizes[0]),a.dataPoint.rangeBubbleSizes.length>1&&this.components.dataArea.setMaxDotSize(a.dataPoint.rangeBubbleSizes[1])):a.dataPoint.bubbleSizes&&this.components.dataArea.setMinDotSize(a.dataPoint.bubbleSizes),null!==a.labels.mode&&this.components.dataArea.setLabelMode(a.labels.mode),this.components.dataArea.setRenderData(!this.supressDotRendering),this.supressDotRendering?(this.selections.off(),this._on&&this.off()):!this.supressDotRendering&&this.isDataSelectable(a)&&(this.selections.on(),this._on||c.isInEditMode()||this.on())},updateAxis:function(a,b){if(!this._dataUpdatedOnPanOrZoom){this._super(a,b);var c,d,e,f,g,h,i,j,k=0;for(f in b.axes)c=b.axes[f],e=c.dataIndices[0],d=c.component,g=a.qHyperCube.qMeasureInfo[e].qMin,h=a.qHyperCube.qMeasureInfo[e].qMax,i=!c.data.autoMinMax&&["min","minMax"].contains(c.data.minMax)?Number(c.data.min):null,j=!c.data.autoMinMax&&["max","minMax"].contains(c.data.minMax)?Number(c.data.max):null,g>h?(h=10,g=-10):g===h&&0===h||isNaN(g)&&isNaN(h)?(h=10,g=-10):k=Math.abs(h!==g?.02*(h-g):.1*h),this.setAxisDataRange(d,Math.max(g,h+k),g-k,j,i,k)}},updateRefLines:function(a,b){this._super(a,b);for(var c in b.refLineLabels)b.refLineLabels[c].component.setLabelMargin(10)},toggleCacheItem:function(a){this.components.dataArea.toggleCacheItem(a),this.components.colorLegend.invalidateDisplay("ScatterPlot#toggleCacheItem")},getSnapshotData:function(a,b,c,d,e,f){var g=this._data&&this._data.compressionResolution?this._data.compressionResolution:M,h=1e3,i=f?f-1:0;return this.backendApi.getHyperCubeAdaptiveGrid([{qTop:0,qLeft:0,qWidth:a.qHyperCube.qSize.qcx,qHeight:a.qHyperCube.qSize.qcy}],[{qLeft:b,qTop:c,qWidth:d,qHeight:e}],h,g+i).then(function(b){a.dataPages=b,a.foo="custom"})},setSnapshotData:function(a){if(this._super(a),!(this._isReducedMode||a.qHyperCube.qSize.qcy>L))return b.resolve();var c=this.components.xAxis.getPlotMin(),d=this.components.xAxis.getPlotMax(),e=this.components.yAxis.getPlotMin(),f=this.components.yAxis.getPlotMax(),g=Math.floor(Math.sqrt((this._data.qHyperCube.qMeasureInfo[1].qMax-this._data.qHyperCube.qMeasureInfo[1].qMin)/(f-e)));return this.getSnapshotData(a,c,f,d-c,f-e,g)},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{xAxisMin:this.components.xAxis.getPlotMin(),xAxisMax:this.components.xAxis.getPlotMax(),yAxisMin:this.components.yAxis.getPlotMin(),yAxisMax:this.components.yAxis.getPlotMax()})},clear:function(){this._super(),this.$scope.navigationVisible=!1},getContextMenu:function(a,b){var d=a,e=d.model,f=c.isInEditMode(),g=e.layout;d.isReadonly&&f||b.addItem({translation:"Common.Navigation",tid:"navigation",icon:"icon-hub-home",select:function(){if(f)e.getProperties().then(function(a){a.navigation=!a.navigation,e.save()});else{var a=[[],!0];a[0][0]={qPath:"/navigation",qOp:void 0===g.navigation?"add":"replace",qValue:g.navigation?"false":"true"},d.backendApi.applyPatches(a)}}})},onStateChanged:function(){z.call(this)},destroy:function(){this._super(),this.onNavigationPressed(),this._destroyed=!0}}),{type:"scatterplot",BackendApi:l,template:o,View:J,definition:m,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0}},data:n,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},colorLegend:{}}},importProperties:r.colorChart.importProperties.bind(r),exportProperties:r.colorChart.exportProperties.bind(r)}}),define("extensions.qliktech/linechart/line-objects-model",["core.utils/class","util"],function(a,b){var c,d={LINE:"line",AREA:"area",STACKED:"stackedArea"},e={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return c=a.extend("LineObjectsModel",{init:function(){this._lineObjectSettings=[]},update:function(a,c){this._updateLineObjectsSettings(a,b.extend({selections:this._getSelected(a,c.numDimensions)},c))},getLineObjectsSettings:function(){return this._lineObjectSettings},getPointsOutOfRange:function(){return this._outOfRange.points},_updateLineObjectsSettings:function(a,c){var d,e,f,g,h,i,j,k=a?a.length:0;for(this._outOfRange={up:{},down:{},points:[]},this._lineObjectSettings=[],d=0;k>d;d++)e=a[d],f=c.minorAxes[c.measureToAxisIndex[e.measureIdx]],g=c.axesSettings[c.measureToAxisIndex[e.measureIdx]],h=this._getColorSettings(c.colorMap,g),h.interpolatePointColors=h.isExpression,i=[],this._updateLinePoints(a[d].points,i,this._outOfRange,b.extend({majorAxis:c.majorAxis,minorAxis:f,measureIdx:e.measureIdx,axisSettings:g,isLineSelected:c.selections.lines.indexOf(d)>=0},c)),j=b.extend({info:a.info,colors:h,clippings:this._getClippings(f,c.rect),idx:a.idx,points:i},c),this._lineObjectSettings.push(j)},_updateLinePoints:function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q,r=f.style.line.width%2===0?0:.5,s=a?a.length:0,t=1===s;for(l=f.majorAxis.getPositionOfValue(0,0),m=0,h=0;s>h;h++)if(a[h]&&(g=a[h],i=g.idx,j={x:f.majorAxis.getPositionOfValue(i,0),y:f.minorAxis.zeroPos},k=g.cacheCircle,k.cx=j.x,k.cy=j.y,!t||!(j.x<0||j.x>f.rect.width))){if(g.isNaN&&!g.hasRightNeighbour&&"number"!=typeof g.nearestRightNeighbour)break;if(g.isNaN&&f.lineType===d.STACKED&&f.nullMode===e.CONNECT&&g.isInterpolationOffset!==!0);else if(g.isNaN&&g.isInterpolationOffset!==!0){l=f.majorAxis.getPositionOfValue(g.hasRightNeighbour?h+1:g.nearestRightNeighbour,0),b.push(!1);continue}if(n=g.hasRightNeighbour?a[h+1].idx:g.nearestRightNeighbour,l="undefined"!=typeof n?f.majorAxis.getPositionOfValue(n,0):NaN,0>l)b.push(!1);else if(m>f.rect.width)b.push(!1);else{o=g.cacheItem.selected;var u=!o&&f.isLineSelected&&f.selections.synqronize&&this._isSelectedIndirectly(i,f.selections.lines,f.selections.points),v=f.minorAxis.getPositionOfValue(g.aggregated.end);j.y=Math.floor(v)-r,j.y<-1e5&&(j.y=-1e5),j.y>f.rect.height+1e5&&(j.y=f.rect.height+1e5),k.r=Math.max(f.style.dataPoints.size.normal/2,8),k.cy=Math.max(f.axisSettings.topCutoff,Math.min(f.axisSettings.bottomCutoff,j.y)),g.isNaN||(m=j.x),p=f.colorMap.getColor(g.cacheItem.parent?[g.cacheItem.parent.id,g.cacheItem.id]:g.cacheItem.id,g.aggregated.end,f.measureIdx,g.rowIndex).toRGBA(),q={size:o?f.style.dataPoints.size.selected:f.style.dataPoints.size.normal,selected:o||u,selectedIndirectly:u,text:g.cacheItem.getDimensions()[0],measureIdx:g.measureIdx,label:g.label,value:g.aggregated.end,isNaN:g.isNaN,isInterpolationOffset:g.isInterpolationOffset,color:p,outOfRangeUp:v<f.axisSettings.topCutoff,outOfRangeDown:v>f.axisSettings.bottomCutoff,outOfDimensionBounds:j.x<0||j.x>f.rect.width,outOfBounds:j.x<0||j.x>f.rect.width||g.aggregated.end>f.axisSettings.plotMax||g.aggregated.end<f.axisSettings.plotMin,dataIndex:i,isSingle:!g.hasLeftNeighbour&&!g.hasRightNeighbour&&f.nullMode!==e.CONNECT||t,x:j.x,y:j.y,y1:0===g.aggregated.start?f.axisSettings.areaStartBase:f.minorAxis.getPositionOfValue(g.aggregated.start),cacheItem:g.cacheItem},(q.outOfRangeUp||q.outOfRangeDown)&&(q.outOfRangeUp&&!c.up[q.x]?(c.points.push(q),c.up[q.x]=!0):q.outOfRangeDown&&!c.down[q.x]&&(c.points.push(q),c.down[q.x]=!0)),b[i]=q}}},_getSelected:function(a,b){var c,d,e,f=[],g=[],h=a.length;if(b)for(c=0;h>c;c++)for(e=a[c].points,d=0;d<e.length;d++)e[d]&&e[d].cacheItem.selected&&(-1===f.indexOf(c)?(f.push(c),g[c]=[e[d].idx]):g[c].push(e[d].idx));return{lines:f,points:g,synqronize:f.length>1}},_isSelectedIndirectly:function(a,b,c){var d,e,f,g=b?b.length:0,h=!1;for(d=0;g>d;d++)for(f=c[b[d]],e=0;e<f.length;e++)if(a===f[e]){h=!0;break}return h},_getMeasureGradient:function(a,b){var c=a.plotMin,d=a.plotRange,e={gradient:{colors:[],limits:[],x0:0,x1:0,y0:a.posMin,y1:a.posMax}};return b.getColorMapping().slice().reverse().forEach(function(a){e.gradient.colors.push(a.grad[0].toRGBA()),e.gradient.colors.push(a.grad[1].toRGBA()),e.gradient.limits.push(Math.min(1,Math.max(0,(a.id[0]-c)/d))),e.gradient.limits.push(Math.min(1,Math.max(0,(a.id[1]-c)/d)))}),e},_getClippings:function(a,b){var c=a.getPadding(),d=c.top-1,e=a.rect.height-c.bottom;return{areaClip:{x:0,y:d,width:b.width,height:e-d-.5},lineClip:{x:0,y:d,width:b.width,height:e-d-.5}}},_getColorSettings:function(a,b){var c,d=.3;return a.mode&&a.mode===a.MEASURE&&!isNaN(b.posMin)&&(d=.6,c=this._getMeasureGradient(b,a)),{isExpression:a.mode&&a.mode===a.EXPRESSION,areaAlpha:d,gradient:c}}})}),define("extensions.qliktech/linechart/layers/layer",["core.utils/class","objects.views/charts/renderers/canvas-renderer","core.utils/deferred"],function(a,b,c){var d;return d=a.extend("layer",{init:function(a,c){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new b(this.wrapper,c),this.minorAxis=null,this.majorAxis=null,a.appendChild(this.wrapper)},update:function(){},release:function(){this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null,this.renderer.release(),this.minorAxis=null,this.majorAxis=null},show:function(){this.wrapper.style.display="block"},hide:function(){this.wrapper.style.display="none"},render:function(){return"none"!==this.wrapper.style.display?this.renderer.render():c.resolve()}})}),define("extensions.qliktech/linechart/layers/shapes/points",["objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect"],function(a,b,c,d){function e(a){switch(a){case"diamond":case"triangle":return new c;case"circle":return new b;case"line":return new d;default:return new d}}function f(a,b,c,d,e){var f=d;switch(e){case"circle":a.set(b,c,.5*f);break;case"diamond":a.set([{x:b,y:c-f/2},{x:b-f/2,y:c},{x:b,y:c+f/2},{x:b+f/2,y:c}]);break;case"triangle":a.set([{x:b,y:c-f/2},{x:b-f/2,y:c+f/2},{x:b+f/2,y:c+f/2}]);break;default:f=d,a.set(b-f/2,c-f/2,f,f)}}var g;return g=a.extend("Points",{init:function(a){this._super(),this._symbol=a||"circle"},update:function(a){var b,c,d,g=a.points?a.points:[],h=0,i=!1,j=g?g.length:0;for(c=0;j>c;c++)d=g[c],!d||d.outOfDimensionBounds||d.isNaN||(b=this._children[h++],b||(b=e(this._symbol),this.addChild(b)),f(b,d.x,d.y,d.size,this._symbol),b.fill=d.selectedIndirectly?"white":d.color,b.stroke=d.selectedIndirectly?d.color:d.selected?"white":!1,b.opacity=d.selected||d.selectedIndirectly?1:a.globalAlpha,b.strokeWidth=1.5,b.visible=!d.outOfBounds&&!d.isNaN&&(a.showDataPoints||d.isSingle||d.keep||d.selected),b.visible&&!i&&(i=b["true"]),b.data.outOfBounds=d.outOfBounds,b.data.value=d.value,b.data.label=d.label,b.data.dataIndex=d.dataIndex,b.data.text=d.text);return h<this._children.length&&this.removeChildren(this._children.slice(h-this._children.length)),this.visible=i,this}})}),define("extensions.qliktech/linechart/layers/shapes/poly-line",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(a,b,c){"use strict";function d(a){var b,c=[];for(b=0;b<a.length;b++)c=c.concat(e(a[b]));return c}function e(a){var b,c,d,g,h,i,j,k=[],l=a._polygons[0].points;if(!l||l.length<2)return k;for(a.data.selected=l[0].selected&&l[1].selected,i=null,j=l.length-1,h=1;h<l.length;h++)if(l[h-1].selected&&l[h].selected){i=h-1;break}if(null!==i){for(h=i;h<l.length;h++)if(!l[h].selected){j=h-1;break}c=l.slice(0,i+1),d=l.slice(i,j+1),g=l.slice(j),c&&c.length>1&&(b=f(c,a),k.push(b)),d&&d.length>1&&(b=f(d,a),b.data.selected=!0,k.push(b)),g&&g.length>1&&(b=f(g,a),k=k.concat(e(b)))}else k.push(a);return k}function f(a,c){var d=new b(a);return d.opacity=c.opacity,d.close=!1,d.stroke=c.stroke,d.strokeWidth=c.strokeWidth,d.lineJoin=c.lineJoin,d.lineCap=c.lineCap,d}function g(a,c,e,f){var g,h,i,k,l,m=[];for(i=c?c.length:0,k=[],g=0;i>g;g++)l=c[g],!l||l.isNaN&&l.isInterpolationOffset!==!0?e===j.GAP&&h&&m.length&&(h.set(m),k.push(h),h=null,m=[]):(h||(h=new b,h.close=!1,h.stroke=f||l.color||"#333333",h.lineJoin="round",h.lineCap="round",h.opacity=1,m=[]),m.push({x:l.x,y:l.y,selected:l.selected,dataIndex:l.dataIndex,y_:l.y1}));for(h&&m.length>1&&(h.set(m),k.push(h)),k=d(k),i=k.length,g=0;i>g;g++)k[g].strokeWidth=a.style.line.width*(k[g].data.selected?2:1),k[g].opacity=k[g].data.selected?1:a.globalAlpha;return k}function h(a,b,d){var e,f,g,h=b?b.length:0,i=[],k=null;for(e=0;h>e;e++)f=b[e],!f||f.isNaN&&f.isInterpolationOffset!==!0?d===j.GAP&&(g=null):g?(k=new c(g.x,g.y,f.x,f.y),k.data.selected=g.selected&&f.selected,k.data.y1_=g.y1,k.data.y2_=f.y1,k.stroke={gradient:{x0:g.x,y0:g.y,x1:f.x,y1:f.y,limits:[0,1],colors:[g.color||"#333333",f.color||"#333333"]}},k.opacity=k.data.selected?1:a.globalAlpha,k.strokeWidth=a.style.line.width*(k.data.selected?2:1),i.push(k),g=f):g=f;return i}var i,j={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return i=a.extend("PolyLine",{init:function(){this._super(),this.lineJoin="round",this.lineCap="round"},update:function(a){this.clip=a.clippings.lineClip,this.removeChildren(),a.colors.interpolatePointColors?this.addChildren(h.call(this,a,a.points,a.nullMode)):this.addChildren(g.call(this,a,a.points,a.nullMode,a.colors.gradient))}})}),define("extensions.qliktech/linechart/layers/shapes/poly-area",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(a,b,c){function d(a){return{x:a.x,y:a.y_}}var e;return e=a.extend("PolyArea",{init:function(){this._super()},update:function(a,e){var f,g,h,i,j;for(this.clip=a.clippings.areaClip,this.removeChildren(),i=e?e.length:0,h=[],f=0;i>f;f++)e[f]instanceof b?(j=e[f]._polygons[0].points,g=new b(j.concat(j.map(d).reverse())),g.fill=a.colors.gradient||e[f].stroke,g.opacity=a.colors.areaAlpha*(e[f].data.selected?1:a.globalAlpha)):e[f]instanceof c&&(j=[{x:e[f].x1,y:e[f].y1},{x:e[f].x1,y:e[f].data.y1_},{x:e[f].x2,y:e[f].data.y2_},{x:e[f].x2,y:e[f].y2}],g=new b(j),g.fill=a.colors.gradient||"#eeeeee",g.opacity=a.colors.areaAlpha*(e[f].data.selected?1:a.globalAlpha)),g&&h.push(g);this.addChildren(h)}})}),define("extensions.qliktech/linechart/layers/shapes/line-object",["objects.views/charts/shapes/container","./points","./poly-line","./poly-area"],function(a,b,c,d){var e;return e=a.extend("LineObject",{init:function(a,e){this._super(),this.data.label=a.info.label,e.showArea&&(this._areaLayer=new d,this.addChild(this._areaLayer)),this._lineLayer=new c,this.addChild(this._lineLayer),this._pointLayer=new b("circle"),this.addChild(this._pointLayer)},update:function(a){this._pointLayer.update(a),this._lineLayer.update(a),this.visible=this._pointLayer.visible||this._lineLayer.visible,this._areaLayer&&(this._areaLayer.update(a,this._lineLayer.children),this._areaLayer.visible&&(this.visible=!0))}})}),define("extensions.qliktech/linechart/layers/line-objects-layer",["./layer","./shapes/line-object"],function(a,b){var c;return c=a.extend("LineObjectLayer",{init:function(a){this._super(a,{name:"line-objects-layer"})},updateInstances:function(a,c){var d,e=a?a.length:0,f=[];for(this.renderer.stage.removeChildren(),d=0;e>d;d++)f.push(new b(a[d],{showArea:c.showArea}));this.renderer.stage.addChildren(f),this._lineObjects=f},getLineObjects:function(){return this._lineObjects},update:function(a){var b,c=this._lineObjects?this._lineObjects.length:0;for(b=0;c>b;b++)this._lineObjects[b].update(a[b])}})}),define("extensions.qliktech/linechart/layers/oob-layer",["./layer","objects.views/charts/shapes/polygon"],function(a,b){function c(a,b,c,d,e){var f=[];return"left"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a-d,y:b})):"right"===e?(f.push({x:a,y:b+c/2}),f.push({x:a,y:b-c/2}),f.push({x:a+d,y:b})):"up"===e?(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b-d})):"down"===e&&(f.push({x:a-c/2,y:b}),f.push({x:a+c/2,y:b}),f.push({x:a,y:b+d})),f}var d;return d=a.extend("OutOfBoundsLayer",{init:function(a){this._super(a,{name:"out-of-bounds-layer"}),this._markerSize=8},update:function(a,d){var e,f,g,h,i,j,k=this.renderer.stage,l=k.children,m=d.markerSize||this._markerSize,n=a?a.length:0;for(j=0;n>j;j++)e=l[j],f=a[j],h=f,f.data&&(h=f.data),i=d.axesSettings[d.measureToAxisIndex[h.measureIdx]],g=c(h.x,h.outOfRangeUp?i.topCutoff+m:i.bottomCutoff-m,m,m,h.outOfRangeUp?"up":"down"),e?e.set(g):(e=new b(g),k.addChild(e)),e.fill="#999999",e.opacity=h.selected?1:d.globalAlpha;n<l.length&&k.removeChildren(l.slice(n-l.length))}})}),define("extensions.qliktech/linechart/layers/label-layer",["./layer","objects.views/charts/utils/canvas-renderer","objects.utils/shapes/geometry-math"],function(a,b,c){function d(){var a,b,c,d,e,f,g,h,i,j,k=this.renderer.scaling.x,l=this.renderer.scaling.y,m={},n=this.combinedMeasuresFormatter;for(this._allDataLineObjectsLength=this._allDataLineObjects?this._allDataLineObjects.length:0,this._dataLabelsOfLines=new Array(this._allDataLineObjectsLength),this._allDataPointLabels=[],a=0;a<this._allDataLineObjectsLength;a++)for(this._dataLabelsOfLines[a]=[],c=this._allDataLineObjects[a],f=c.find("Points [visible='true']"),e=f?f.length:0,b=0;e>b;b++)g=f[b].getBoundingRect(),h=g.x/k+g.width/(2*k),i=g.y/l+g.height/(2*l),j=h+";"+i,j in m||(m[j]=!0,d={text:this._lineType===s.STACKED&&this._allDataLineObjectsLength>1?n.formatValue(f[b].value):f[b].data.label,x0:h,y0:i,x:h,y:i-this._dataLabelMargin,align:"center",baseline:"bottom",font:this._style.dataPoints.font,maxWidth:512,maxNumLines:1,line:a},this._dataLabelsOfLines[a].push(d),this._allDataPointLabels.push(d));this._numAllDataPointLabels=this._allDataPointLabels.length}function e(){var a;for(a=0;a<this._numAllDataPointLabels;a++)this._allDataPointLabels[a].size=b.measureTextObject({type:"text",shape:this._allDataPointLabels[a]})}function f(){e.call(this);var a,b,c,d,f,g,h,i=this._discreteSpacing/2;for(a=0;a<this._allDataLineObjectsLength;a++)if(d=this._dataLabelsOfLines[a],c=d.length,0!==c)if(1!==c){for(f=d[0],f.priority=5,h=d[1],f.leftDx=i,f.leftDy=0,f.rightDx=h.x0-f.x0,f.rightDy=f.y0-h.y0,b=1;c-1>b;b++)f=d[b],g=d[b-1],h=d[b+1],f.leftDx=g.rightDx,f.leftDy=-g.rightDy,f.rightDx=h.x0-f.x0,f.rightDy=f.y0-h.y0,g.y0<f.y0?f.y0<h.y0?f.priority=1:f.y0===h.y0?f.priority=2:f.priority=3:g.y0===f.y0?f.y0<h.y0?f.priority=2:f.y0===h.y0?f.priority=0:f.priority=2:f.y0<h.y0?f.priority=4:f.y0===h.y0?f.priority=2:f.priority=1;f=d[c-1],g=d[c-2],f.leftDx=g.rightDx,f.leftDy=-g.rightDy,f.rightDx=i,f.rightDy=0,f.priority=5}else f=d[0],f.leftDx=i,f.leftDy=0,f.rightDx=i,f.rightDy=0}function g(){var a,b;for(a=0;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],i.call(this,b),h.call(this,b)}function h(a){var b,c,d,e=this._dataLabelHorizontalGap/2,f=this._dataLabelVerticalGap/2;b=a.size.width/2,c=b+e,a.minX=a.x-b,a.maxX=a.x+b,a.minX2=a.x-c,a.maxX2=a.x+c,d=a.size.height,"top"===a.baseline&&(a.minY=a.y,a.maxY=a.y+d,a.maxY2=a.maxY+f,a.minY2=a.minY-f),"bottom"===a.baseline&&(a.maxY=a.y,a.minY=a.y-d,a.maxY2=a.maxY+f,a.minY2=a.minY-f),"middle"===a.baseline&&(a.maxY=a.y+d/2,a.minY=a.y-d/2,a.maxY2=a.maxY+f,a.minY2=a.minY-f)}function i(a){var b,c,d,e,f,g=a.leftDx,h=a.rightDx,i=a.leftDy,j=a.rightDy,k=1e-9;(i>0||j>0)&&(i=Math.max(i,k),j=Math.max(j,k),b=a.size.width+2*this._horizontalDistanceFromLine,d=b/(g/i+h/j),d>this._maxDataLabelMargin?(a.y=a.y0+this._dataLabelMargin,a.baseline="top"):(d=Math.max(d,this._dataLabelMargin),a.y=a.y0-d,e=d*g/i,f=d*h/j,c=b/2,c>e?a.x=a.x+(c-e):c>f&&(a.x=a.x-(c-f))))}function j(a){var b,c,d,e,f=0,g=this.rect.width,h=9;a.priority>3?(a.baseline="middle",a.x0-f<=g-a.x0?(a.x=a.x0+h+a.size.width/2,a.y=a.y0):(a.x=a.x0-h-a.size.width/2,a.y=a.y0)):3===a.priority&&(b=a.leftDy/a.leftDx,c=a.rightDy/a.rightDx,c>=b?(d=(a.size.height/2+1)/c,2*h>=d?(a.baseline="middle",a.y=a.y0,a.x=a.x0+Math.max(d,h)+a.size.width/2):(e=2*h*c-1,a.baseline="top",a.y=a.y0-e,a.x=a.x0+2*h+a.size.width/2)):(d=(a.size.height/2+1)/b,2*h>=d?(a.baseline="middle",a.y=a.y0,a.x=a.x0-Math.max(d,h)-a.size.width/2):(e=2*h*b-1,a.baseline="top",a.y=a.y0-e,a.x=a.x0-2*h-a.size.width/2)))}function k(){void 0!==this._usedDataMax&&this._usedDataMax===this._usedDataMin?this._allDataPointLabels.sort(function(a,b){return a.x0<b.x0?-1:1}):this._allDataPointLabels.sort(function(a,b){return a.line>b.line?-1:a.line<b.line?1:a.priority>b.priority?-1:a.priority===b.priority?a.y0===b.y0?a.x0>b.x0?-1:1:4===a.priority?a.y0>b.y0?1:-1:3===a.priority?a.y0>b.y0?-1:1:a.y0<b.y0?-1:1:1})}function l(a,b){return a.minX2>b.maxX2||a.maxX2<b.minX2||a.minY2>b.maxY2||a.maxY2<b.minY2?!1:!0}function m(){var a,b,c=0,d=this.rect.width,e=1,f=this.rect.height-1;for(a=0;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],b.status=b.x0>c&&b.x0<d&&b.minX>=c&&b.maxX<=d&&b.minY>=e&&b.maxY<=f,!b.status&&b.priority>2&&(j.call(this,b),h.call(this,b),b.status=b.x0>c&&b.x0<d&&b.minX>=c&&b.maxX<=d&&b.minY>=e&&b.maxY<=f)}function n(){var a,b,c,d,e,f,g=[];for(a=0;a<this._allDataLineObjectsLength;a++)for(c=this._allDataLineObjects[a],d=c.find("PolyLine [stroke]"),e=d?d.length:0,b=0;e>b;b++)f=d[b],g.push(f.getPoints());return g}function o(){var a,b,d=n.call(this);for(a=0;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],b.status&&(b.status=!c.checkPolylinesIntersectingRectDefinedByMaxMin(d,b))}function p(){var a,b;for(a=1;a<this._numAllDataPointLabels;a++)b=this._allDataPointLabels[a],b.status&&q.call(this,a)}function q(a){var b,c=this._allDataPointLabels[a];for(b=0;a>b;b++)if(this._allDataPointLabels[b].status&&l(c,this._allDataPointLabels[b]))return c.status=!1,void(this._allDataPointLabels[b].hasConflict=!0)}var r,s={LINE:"line",AREA:"area",STACKED:"stackedArea"};return r=a.extend("LabelLayer",{init:function(a){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new b(this.wrapper),this.minorAxis=null,this.majorAxis=null,a.appendChild(this.wrapper),this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2},update:function(a,b){this.combinedMeasuresFormatter=b.combinedMeasuresFormatter,this._allDataLineObjects=a,this._lineType=b.lineType,this._discreteSpacing=b.majorAxis.getDiscreteSpacing(),this._style=b.style,this.rect=b.rect,this.renderer.shapes=[],d.call(this),f.call(this),g.call(this),k.call(this),m.call(this),o.call(this),p.call(this);var c,e,h,i=[];for(c=0;c<this._numAllDataPointLabels;c++)e=this._allDataPointLabels[c],e.status&&(h={type:"text",fill:this._style.dataPoints.color,shape:e},i.push(h));this.renderer.shapes=i}})}),define("extensions.qliktech/linechart/linearea",["objects.views/charts/components/chart-component","objects.utils/shapes/circle","./line-objects-model","./layers/line-objects-layer","./layers/oob-layer","./layers/label-layer","objects.views/charts/chart-style-service","core.utils/deferred"],function(a,b,c,d,e,f,g,h){"use strict";function i(a){return!!a}function j(a){var b,c,d,e,f,g=a?a.length:0;for(b=0;g>b;b++)if(f=a[b],f&&!f.hasRightNeighbour){for(c=b+1;g>c;c++)if(a[c]&&!a[c].isNaN){f.nearestRightNeighbour=c;break}if(!f.isNaN){if(!isNaN(f.nearestRightNeighbour))for(e=c-b,d=1;e>d;d++)a[b+d]&&(a[b+d].nearestRightNeighbour=f.nearestRightNeighbour,a[b+d].nearestLeftNeighbour=b);b=c-1}}}function k(a){var b,c,d,e,f,g,h,i,j=a?a.length:0;for(b=0;j>b;b++)if(i=a[b],i&&!i.hasRightNeighbour&&!i.isNaN&&!isNaN(i.nearestRightNeighbour))for(c=i.nearestRightNeighbour,f=i.value,g=a[c].value,h=c-b,d=1;h>d;d++)e=d/h,a[b+d]&&(a[b+d].interpolatedValue=f*(1-e)+g*e)}function l(a,b){var c,d,e,f,g,h=[],i=a?a.length:0;for(c=0;i>c;c++)d=a[c].points,Object.keys(d).forEach(function(a){var c=!1;g=d[a].idx,h[g]||(h[g]={pos:0,neg:0,total:0}),f=d[a],f&&(e=f.isNaN?isNaN(f.interpolatedValue)?0:f.interpolatedValue:f.value,isNaN(e)||(b?(0===e?f.hasLeftNeighbour&&d[a-1]?c=d[a-1].aggregated.end<0:f.hasRightNeighbour&&d[a+1]&&(c=d[a+1].aggregated.end<0):c=0>e,c?(f.aggregated.start=h[g].neg,h[g].neg+=e,f.aggregated.end=h[g].neg):(f.aggregated.start=h[g].pos,h[g].pos+=e,f.aggregated.end=h[g].pos)):(f.aggregated.start=h[g].total,h[g].total+=e,h[g].pos=Math.max(h[g].pos,h[g].total),h[g].neg=Math.min(h[g].neg,h[g].total),f.aggregated.end=h[g].total),"number"==typeof f.interpolatedValue&&(f.interpolatedValue=f.aggregated.end,f.isInterpolationOffset=!0)))});return{pos:Math.max.apply(null,h.filter(function(a){return!!a}).map(function(a){return a.pos})),neg:Math.min.apply(null,h.filter(function(a){return!!a}).map(function(a){return a.neg}))}}function m(a,b){var c=a.layoutMap[b]||"medium",d={dataPoints:{color:a.getValue(p,"item.value","color"),font:a.getFont(p,"item.value",c),size:{normal:a.getValue(p,"item.shape","size"),selected:a.getValue(p,"item.shape","size","selected")}},outOfRange:{color:a.getValue(p,"item.outOfRange","color")},line:{width:a.getValue(p,"item.line","width",c)}};return d}function n(){if(!this._data||!this._tree)return[];var a,b=this._data.qHyperCube.qDimensionInfo,c=b.length,d=[],e=0;return this._tree.children.forEach(function(f){f.id=b[0].cId+"_"+f.data.qElemNo,a={label:f.data.qText||"",cacheIndex:[],id:f.id},d.push(a),1===c&&(a.cacheIndex[0]=e++),c>1&&f.children.forEach(function(){a.cacheIndex.push(e++)},this)},this),{data:d,info:[{qApprMaxGlyphCount:this._tree.data.qApprMaxGlyphCount}],groupSize:null}}var o,p="lineChart",q={LINE:"line",AREA:"area",STACKED:"stackedArea"},r={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return o=a.extend("LineArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._generatedCacheItems=[],this._showDataPoints=!0,this._colorMap=null,this._showDataPoints=!1,this._lineType=q.LINE,this._nullMode=r.GAP,this._separateStacking=!0,this._globalAlpha=1,this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2,this._styleService=g.getInstance(),this._lineObjectsModel=new c,this._lineLayer=new d(this.container),this.layers=[this._lineLayer],this.isMini||(this._oobLayer=new e(this.container),this.layers.push(this._oobLayer),this._labelLayer=new f(this.container),this.layers.push(this._labelLayer))},preRender:function(){},afterPaint:function(){return h.resolve()},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setShowDataPoints:function(a){this._showDataPoints=a},getShowDataPoints:function(){return this._showDataPoints},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties()},setLineType:function(a){this._lineType=a},setNullMode:function(a){this._nullMode=a},setSeparateStacking:function(a){this._separateStacking=a},setShowDataPointLabels:function(a){this._showDataPointLabels=a},getShowDataPointLabels:function(){return this._showDataPointLabels},freezeZOrdering:function(){this._zOrderFreezed=!0},unFreezeZOrdering:function(){this._zOrderFreezed=!1},setColorMappings:function(a){this._colorMappings=a},_updateSize:function(){this.invalidateDisplay()},getCacheItems:function(){return this._cacheItems},setCacheItems:function(a){this._cacheItems=a},getGeneratedCacheItems:function(){return this._generatedCacheItems||[]},setMeasureIndices:function(a){this._measureIndices=a},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},_updateProperties:function(){if(this._data&&this._tree){this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis),this._majorAxisData=n.call(this),this._minorAxisData=null;var a,c,d,e,f,g,h,m=[],o=this._data.qHyperCube.qDimensionInfo,p=o.length,s=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,t=this._data.qHyperCube.qMeasureInfo,u=this._tree,v=this._shapes,w=u.children.length,x=0,y=this._shapes.length,z={},A=this.measureFormatters,B=this.selectionIdentifier?this.selectionIdentifier:"dataArea",C=this._minorAxes,D=[],E=[];if(this._measureIndices)E=this._measureIndices;else if(s>0&&20>s)for(;E.length<s;)E.push(E.slice(-1)[0]+1||0);if(E.forEach(function(a){D[a]=C.filter(function(b){return b._dataIndices?b._dataIndices.indexOf(a)>=0:!0})[0]}),this._measureToAxis=D,this._measureToAxisIndex=D.map(function(a){return C.indexOf(a)}),this._polysData=[],w&&E||E.length){u.children.forEach(function(i,j){i.id=o[0].cId+"_"+i.data.qElemNo,i.children.forEach(function(k,l){if(p>1)a=i.id+";"+o[1].cId+"_"+k.data.qElemNo,h=z[k.data.qText],h||(z[k.data.qText]={info:{label:k.data.qText},points:[],values:[],measureIdx:p>1?0:l},h=z[k.data.qText]),k=k.children[0],g=A[0];else{if(this._measureIndices&&this._measureIndices.indexOf(l)<0)return;a=i.id,h=z[l],h||(z[l]={info:{label:t[l].qFallbackTitle
},measureIdx:l,points:[],values:[]},h=z[l]),g=A[l]}d=k.children[0],d&&(c=void 0!==d.data.qValue?d.data.qValue:d.data.qNum,f=isNaN(c),this._nullMode===r.ZERO&&f&&(c=0,f=!1),k.chartData={value:c,isNaN:f,idx:j,measureIdx:p>1?0:l,hasLeftNeighbour:!!h.points[j-1]&&!h.points[j-1].isNaN,hasRightNeighbour:!1,color:null,text:d.data.qText,label:d.data.qText?g&&("U"===g.type||isNaN(d.data.qNum))?g.formatValue(c):d.data.qText:"",rowIndex:k.data.rowIndex,dimValue:i.data.qNum,id:a,aggregated:{}},k.chartData.isNaN||(k.chartData.aggregated.start=0,k.chartData.aggregated.end=c,h.values.push(c)),h.points[j]=k.chartData,h.points[j-1]&&(h.points[j-1].hasRightNeighbour=!k.chartData.isNaN),k.chartData.shapeIndex=x++,x>y&&v.push(new b(NaN,NaN,NaN)),k.chartData.cacheCircle=v[k.chartData.shapeIndex],e=k.parent,e.cacheItem&&(m.indexOf(e.cacheItem)<0&&m.push(e.cacheItem),k.chartData.cacheItem=e.cacheItem,e.cacheItem.addShape(B,k.chartData.cacheCircle,!0),e.cacheItem.calculateTooltipPosition=!0))},this)},this);var F=[],G=this._nullMode===r.CONNECT&&this._lineType===q.STACKED&&(s>1||p>1);if(Object.keys(z).forEach(function(a){this._nullMode!==r.ZERO&&j.call(this,z[a].points),G&&k.call(this,z[a].points),z[a].points=z[a].points.filter(i),F.push(z[a])},this),this._polysData=F,this._zOrderFreezed){var H=this._sortedOrder;this._polysData.forEach(function(a,b){a.idx=b}),this._polysData.sort(function(a,b){return H.indexOf(a.idx)-H.indexOf(b.idx)})}else this._lineType===q.AREA?(this._polysData.forEach(function(a,b){a.idx=b,a.values.sort(function(a,b){return b-a}),a.absMedian=Math.abs(a.values[Math.floor(a.values.length/2)])}),this._polysData.sort(function(a,b){return b.absMedian-a.absMedian})):this._polysData.forEach(function(a,b){a.idx=b}),this._sortedOrder=this._polysData.map(function(a){return a.idx});if(this._lineType===q.STACKED&&(s>1||p>1)){var I=l.apply(this,[F,this._separateStacking]);this._minorAxisData={min:I.neg>=0?0:I.neg,max:I.pos<0?0:I.pos}}}this._shapes.length>x&&(this._shapes=this._shapes.slice(0,x)),this.setSelectableShapes(m),this._lineLayer.updateInstances(this._polysData,{showArea:[q.AREA,q.STACKED].contains(this._lineType)})}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree},updateSize:function(){this._super(),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensions(0,-1,this.rect.width,this.rect.height+1),a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this),this._style=m(this._styleService,this._layoutMode)},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={top:1,left:0,right:0,bottom:0}},release:function(){this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this)},beforeLayerUpdates:function(){},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow();var a={numDimensions:this._data.qHyperCube.qDimensionInfo.length,showDataPoints:this._showDataPoints&&this._layoutMode>this.ShowFlags.SPARK,nullMode:this._nullMode,globalAlpha:this._globalAlpha,majorAxis:this._majorAxis,minorAxes:this._minorAxes,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails),combinedMeasuresFormatter:this.combinedMeasuresFormatter,colorMap:this._colorMap,rect:this.rect,style:this._style,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2)},b=this,c=[];return this._lineObjectsModel.update(this._polysData,a),this.beforeLayerUpdates(this._lineObjectsModel.getLineObjectsSettings()),this._lineLayer.update(this._lineObjectsModel.getLineObjectsSettings()),this.preRender(this._lineLayer._lineObjects),c.push(this._lineLayer.render()),this._oobLayer&&(this._oobLayer.update(this._lineObjectsModel.getPointsOutOfRange(),a),c.push(this._oobLayer.render())),this._labelLayer&&(this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPointLabels&&this._showDataPoints?(this._labelLayer.update(this._lineLayer.getLineObjects(),a),this._labelLayer.show(),c.push(this._labelLayer.render())):this._labelLayer.hide()),h.all(c).then(function(){return b.afterPaint(a.axesSettings[0].topCutoff,a.axesSettings[0].bottomCutoff)})},_getAxisDetails:function(a){var b=a.getPlotMin(),c=a.getPlotMax(),d=c-b,e=a.getPadding(),f=e.top,g=a.rect.height-e.bottom,h=0;return h=b>0?g:0>c?f:Math.floor(a.getPositionOfValue(0))-.5,{plotMin:b,plotMax:c,posMin:a.getPositionOfValue(b),posMax:a.getPositionOfValue(c),plotRange:d,topCutoff:f,bottomCutoff:g,areaStartBase:h,zeroPos:Math.floor(a.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/linechart/linechart-properties",["translator"],function(a){function b(a,b){var c=b.getDimensions(),d=b.getMeasures();return"area"===a.lineType&&c.length+d.length>2}function c(a,b){return b?b.getMeasureLayouts():a.qHyperCubeDef.qMeasures.map(function(a){return a.qDef})}function d(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}var e,f,g;e={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{lineType:{ref:"lineType",type:"string",component:"item-selection-list",defaultValue:"line",horizontal:!0,items:[{icon:"æ",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"ø",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.area",value:"area"}]},stackedProps:{type:"items",grouped:!1,items:{stackedArea:{ref:"stackedArea",translation:"properties.style.stackedArea",type:"boolean",defaultValue:!1,show:function(a,c){return b(a,c)}},separateStacking:{ref:"separateStacking",translation:"properties.separateStacking",type:"boolean",defaultValue:!0,readOnly:function(a){return!a.stackedArea},show:function(a,c){return b(a,c)}}}},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap"},dataPointSettings:{type:"items",grouped:!1,snapshot:{tid:"property-dataPoint"},items:{dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1},showDataPointLabels:{ref:"dataPoint.showLabels",translation:"properties.dataPoints.labelmode",type:"boolean",component:"switch",defaultValue:!1,show:function(a){return a.dataPoint&&a.dataPoint.show},options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{type:"number",component:"dropdown",ref:"gridLine.spacing",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(a){return a.gridLine&&!a.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:function(a,b){var c=[{value:"primary",translation:"properties.colorMode.primary"}];return 1===b.getMeasures().length&&b.getDimensions().length<=1&&c.push({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),b.getMeasures().length>1?c.push({value:"byDimension",translation:"properties.colorMode.multicolored"}):b.getDimensions().length>1&&c.push({value:"byDimension",translation:"properties.colorMode.byDimension"}),b.getMeasures().length>=1&&c.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),c}}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var e,f=d(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return e=f?a.get("properties.xAxisWithInfo",[f]):a.get("properties.xAxis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a){return a.dimensionAxis&&["all","labels"].contains(a.dimensionAxis.show)}},dock:{type:"string",component:"dropdown",ref:"dimensionAxis.dock",translation:"Common.Position",options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}],show:function(a){return a.dimensionAxis&&"none"!==a.dimensionAxis.show},defaultValue:"near"}}},measureAxis:{uses:"measureAxis",label:function(b,d){var e,f=c(b,d).map(function(a){return a.qFallbackTitle}).join(", ");return e=f?a.get("properties.yAxisWithInfo",[f]):a.get("properties.yAxis")},items:{axis:{type:"items",items:{show:{snapshot:{title:"properties.yAxis",tid:"property-yAxis"}}}},scale:{type:"items",items:{logScale:{ref:"measureAxis.logarithmic",translation:"properties.axis.logarithmicScale",type:"boolean"},label:{component:"text",translation:"properties.axis.logarithmicScaleNote",show:function(a){return a.measureAxis&&a.measureAxis.logarithmic}}}}}}}},f={uses:"sorting",items:{dimensions:{locked:function(a,b,c){return 1===c.getMeasures().length&&2===c.getDimensions().length?0===a:!1}}}},g={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"},refLines:{uses:"reflines"}}};var h={uses:"data",items:{dimensions:{}}};return{type:"items",component:"accordion",items:{data:h,sorting:f,addons:g,settings:e}}}),define("extensions.qliktech/linechart/linechart-data",["general.utils/property-resolver","general.utils/array-util"],function(a,b){function c(a){var b=a.getDimensions(),c=a.getMeasures();1===b.length&&1===c.length&&0!==a.getSorting()[0]&&a.changeSorting(1,0)}function d(b,c){var d=c.getDimensions(),e=c.getMeasures(),f=a.getValue(b,"color.mode");d.length>1&&a.setValue(b,"color.persistent",!0),"byMeasure"===f&&(d.length>1||e.length>1)?a.setValue(b,"color.mode","byDimension"):"byDimension"===f&&d.length<=1&&e.length<=1?a.setValue(b,"color.mode","primary"):"byExpression"===f&&0===e.length&&a.setValue(b,"color.mode","primary")}function e(a){return a>=2?1:15}return{dimensions:{min:1,max:function(a){return a>=2?1:2},add:function(a,b,e){e.getDimensions().length>1&&(b.qHyperCubeDef.qMode="K",b.qHyperCubeDef.qAlwaysFullyExpanded=!0),c(e),d(b,e)},remove:function(a,b,c){var f=c.getDimensions(),g=c.getMeasures(),h=e(f.length),i=c.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;1===g.length&&i&&i.length&&i.splice(0,h-1).forEach(function(a){g.push(a),c.hcProperties.qInterColumnSortOrder.push(f.length+g.length-1)}),d(b,c),1===f.length&&(b.qHyperCubeDef.qMode="S")},autoSort:function(a,b,c,d){c&&(c.contains("$text")||c.contains("$ascii")?d.qSortByAscii=1:c.contains("$numeric")&&(d.qSortByNumeric=1))}},measures:{min:1,max:e,add:function(a,b,e){c(e),d(b,e)},remove:function(a,c,e){var f=e.getDimensions(),g=e.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;1===f.length&&g&&g.length&&(f.push(g.splice(0,1)[0]),b.indexAdded(e.hcProperties.qInterColumnSortOrder,f.length-1)),d(c,e),f.length>1?(c.qHyperCubeDef.qMode="K",c.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===f.length&&(c.qHyperCubeDef.qMode="S")}}}}),define("text!extensions.qliktech/linechart/linechart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="true"></div>'}),define("extensions.qliktech/linechart/linechart",["jquery","util","client.utils/state","core.utils/deferred","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","./linearea","extensions.qliktech/linechart/linechart-properties","extensions.qliktech/linechart/linechart-data","objects.backend-api/stacked-api","text!./linechart.ng.html","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";function n(a){var b,c,d=0,e=0;b=this.components.measureAxis,!a.dataPoint.show||this._layoutMode<=f.prototype.ShowFlags.XSMALL?(d=0,e=0):a.dataPoint.show&&(c=15,a.dataPoint.showLabels&&(d=c+7,e=0)),["near","bottom"].contains(this.components.dimensionAxis.dock)?b.setPadding(d,0,e,0):b.setPadding(e,0,d,0)}function o(a,b,c){return a===b&&(a>0&&(a+=c),0>b&&(b-=c)),b>=1?b=1:b>0?b=Math.pow(10,Math.floor(Math.log(b)/Math.log(10))):-1>=a?a=-1:0>a&&(a=-Math.pow(10,Math.floor(Math.log(-a)/Math.log(10)))),{max:a,min:b}}var p,q={NONE:0,ONE_DIM:1,TWO_DIM:2};return p=e.extend("LineChart",{namespace:".linechart",init:function(b,c,d,e){var f,h=a.extend(!0,{},d);d=a.extend(!0,d||{},{components:{dataArea:{clazz:g},miniChart:{components:{dataArea:{clazz:g}}}}},h),this._super(b,c,d,e),this.components.miniChart&&(f=this.components.miniChart,this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setMiniChart(f),f.setColorMap(this.providers.colorMap),f.components.measureAxis.setDock("left"),f.components.dimensionAxis.setDock("bottom"),f.components.dataArea.setMinorAxis(f.components.measureAxis),f.components.dataArea.setMajorAxis(f.components.dimensionAxis),f.setOrientation("vertical"))},initSelections:function(){this.options._disableSelections||(this.selections.types.range.setComponent("x",this.components.dimensionAxis),this.selections.types.range.setComponent("y",this.components.measureAxis),this.selections.Select.bind(function(a,b){var c,d=this.selections.getActiveType().activeComponent;c=d instanceof g?this.components.dimensionAxis.getType().current:d.getSelectionIndices(),this.onSelection.Select.apply(this,[a,b,c,"L"])}.bind(this))),this._super()},_postResize:function(){this.components.measureAxis.setNiceNumberEnabled(this._layoutMode>f.prototype.ShowFlags.XSMALL),this._super()},partialUpdate:function(){return this.components.dataArea.freezeZOrdering(),this._super.apply(this,[].slice.call(arguments))},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var a,b=this.components.scrollArea,c=[];n.call(this,this._data),this.layout(),this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(c.push(this.components.miniChart.setData(this._data)),this._dataForMiniChartChanged=!1);var e=this.checkPage();if(e)c.push(e);else{for(a in this.components)c.push(this.components[a].invalidateDisplay("LineChart.paint"));b.viewState.min+b.viewState.range>b.fullState.max&&b.setOffset(b.fullState.max-b.viewState.range)}return d.all(c)},prePaint:function(a){this._super();var b=!1;if(2===a.qHyperCube.qDimensionInfo.length&&a.qHyperCube.qStackedDataPages[0]){var d=a.qHyperCube.qStackedDataPages[0].qData[0];b=0!==d.qSubNodes[0].qUp||0!==d.qSubNodes[d.qSubNodes.length-1].qDown}l.applyDisclaimerAttributes({title:a.qHyperCube.qDimensionInfo.length>1,bottom:!0,supportRangeOverZero:!a.measureAxis.logarithmic,paging:1===a.qHyperCube.qDimensionInfo.length,explicitLimitedData:b},this.$scope.dataAttributes,this.$element,this.$scope,c,a)},_updateData:function(a){this._checkPage=!1,this._data=a,this._dataForMiniChartChanged=!0,this._disablePagingTransitions(),this.components.dataArea.unFreezeZOrdering(),this.isStacked=("stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea)&&(a.qHyperCube.qDimensionInfo.length>1||a.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,a.qHyperCube.qDimensionInfo.length>1&&!this.isStacked?this.components.scrollArea.setUseMiniChart(!1):this.components.scrollArea.setUseMiniChart(!0);var b=null;this._pagingMode=q.NONE,a.qHyperCube.qDimensionInfo.length>1?(b=a.qHyperCube.qStackedDataPages&&a.qHyperCube.qStackedDataPages.length?a.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+a.qHyperCube.qStackedDataPages[0].qData[0].qDown+a.qHyperCube.qStackedDataPages[0].qData[0].qUp:null,this.components.dimensionAxis.setSelectionIndices([0]),this.components.dataArea.setSelectionIndices([0,1]),this._pagingMode=q.ONE_DIM,this.isStacked=!0):a.qHyperCube.qSize.qcy>a.qHyperCube.qDataPages[0].qArea.qHeight&&(b=a.qHyperCube.qSize.qcy,this._pagingMode=q.ONE_DIM),this.components.dimensionAxis.isDiscrete()||(this._pagingMode=q.NONE),this.components.dimensionAxis.setNumDiscreteUnits(b);var d,e=a.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}).join(", "),f=a.qHyperCube.qDimensionInfo.map(function(a){return a.qFallbackTitle}).join(", "),g={axes:{measureAxis:{component:this.components.measureAxis,data:a.measureAxis,title:e,dataIndices:a.qHyperCube.qMeasureInfo.map(function(a,b){return b})},dimensionAxis:{component:this.components.dimensionAxis,data:a.dimensionAxis,title:c.view!==c.Views.story?"":f,dataIndices:a.qHyperCube.qDimensionInfo.map(function(a,b){return b})}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.refLineLabels,axis:this.components.measureAxis}},refLines:{component:this.components.refLines},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:a.dimensionAxis}}},h=this.components.dimensionAxisTitle;this.components.dataArea.setData(a),this.providers.colorMap.setData(a),this.components.colorLegend.setData(a);var i=this.providers.colorMap.getLegendDataProvider();i.setLegendMarker(a.dataPoint.show?["line","circle"]:["line"]),h.setData(a),this._super(a,g),d=this.getSnapshotStoredChartData(),c.view!==c.Views.story?(h.setTitle(f),h.showComponent()):h.hideComponent(),this._readStoredData&&d?(this.components.dimensionAxis.setInnerOffset(d.axisInnerOffset),this.components.scrollArea.setOffset(d.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},updateDataArea:function(a){var b="stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea?"stackedArea":a.lineType;this._super.apply(this,[].slice.call(arguments)),this.components.dataArea.setLineType(b),this.components.miniChart&&(this.components.miniChart.components.dataArea.setLineType(b),this.components.miniChart.components.dataArea.setNullMode(a.nullMode),this.components.miniChart.components.dataArea.setSeparateStacking(a.separateStacking),this.components.miniChart.setLogScale(a.measureAxis.logarithmic)),this.components.dataArea.setShowDataPoints(a.dataPoint.show),this.components.dataArea.setNullMode(a.nullMode),this.components.dataArea.setSeparateStacking(a.separateStacking),this.components.dataArea.setShowDataPointLabels(a.dataPoint.showLabels),this.components.dataArea.updateNow(["properties"])},updateAxis:function(a,c){this._super(a,c);var d,e,f,g,h,i,j,k=this.getSnapshotStoredChartData();f=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),g=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),b.isNumeric(f)||(f=-1),b.isNumeric(g)||(g=1),h=c.axes.measureAxis,i=!h.data.autoMinMax&&["min","minMax"].contains(h.data.minMax)?Number(h.data.min):null,j=!h.data.autoMinMax&&["max","minMax"].contains(h.data.minMax)?Number(h.data.max):null,this._dataMaxPositive=g>0,this._dataMinNegative=0>f,d=this.components.measureAxis,d.setWhiteSpaceOptimizingEnabled(!0),d.setRealDataRange(void 0,void 0);var l=this.components.dataArea.getMajorAxisData(),m=this.components.dataArea.getMinorAxisData();if(this.components.dimensionAxis.setDataRange(l.data,l.info),e=0,f>g?(g=10,f=-10):g===f&&(g?e=Math.abs(g?.2*g:0):(g=10,f=-10)),this._readStoredData&&k&&k.dataRanges)this.setAxisDataRange(d,k.dataRanges[0].max,k.dataRanges[0].min,j,i,e);else if(m&&("stackedArea"===a.lineType||"area"===a.lineType&&a.stackedArea)&&(a.qHyperCube.qMeasureInfo.length>1||a.qHyperCube.qDimensionInfo.length>1))this.setAxisDataRange(d,m.max,m.min,j,i,e);else if("line"!==a.lineType)if(this._data.measureAxis.logarithmic){var p=o(g,f,e);this.setAxisDataRange(d,p.max,p.min,j,i,e)}else this.setAxisDataRange(d,g>0?g+e:0,0>f?f-e:0,j,i,e);else this.setAxisDataRange(d,g>0?g+e:Math.min(0,g+e),0>f?f-e:Math.max(0,f-e),j,i,e);n.call(this,a)}}),{type:"linechart",BackendApi:j,template:k,View:p,definition:h,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:500,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},data:i,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},range:{},colorLegend:{}}},importProperties:function(a,b,c){var d=m.axisChart.importProperties.apply(m,[a,b,c]),e=d.qProperty;return e.qHyperCubeDef.qDimensions.length>1&&(e.qHyperCubeDef.qMode="K"),e.color&&"byDimension"===e.color.mode&&e.qHyperCubeDef.qDimensions.length<=1&&m.changeProperty("color.mode","primary",d),d},exportProperties:m.axisChart.exportProperties.bind(m)}}),define("extensions.qliktech/treemap/treemap-node",["objects.views/charts/shapes/container","objects.views/charts/shapes/display-object","objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/rect","objects.views/charts/shapes/rect","objects.utils/shapes/rect"],function(a,b,c,d,e,f){var g=a.extend("TreemapNode",{init:function(a,b,c){this._super(),this.x=0,this.y=0,this.width=0,this.height=0,this.data.area=0,this.data.value=b||0,this.data.label=a||"",this.data.valueLabel=c||"",f.apply(this,[0,0,0,0])},pointInside:b.prototype.pointInside,containsPoint:e.prototype.containsPoint,intersectsLocalLine:e.prototype.intersectsLocalLine,getLocalPoints:e.prototype.getLocalPoints,getLocalBoundingRect:e.prototype.getLocalBoundingRect,_calculateBounds:b.prototype._calculateBounds});return Object.keys(e.prototype).forEach(function(a){!g.prototype.hasOwnProperty(a)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(a)<0&&(g.prototype[a]=e.prototype[a])}),c._registerRenderFn(d.render,g),g}),define("extensions.qliktech/treemap/treemap-layout",["core.utils/class","extensions.qliktech/treemap/treemap-node","translator"],function(a,b,c){var d,e=24,f=4,g=8e3,h=4e3,i={NONE:0,NONE_COLLAPSED:.1,LEAF:1,HEADER:2,OVERLAY:3};return d=a.extend("TreemapLayout",{init:function(){this.cellPadding=2,this.collapseHeadersOnSmallBranches=!0,this.labeling={},this.othersLabel=c.get("properties.dimensionLimits.others")},sort:function(){return this},weigh:function(a,c,d){if(!a||!a.length)return this;d=d||0;for(var e,f,g=a.length,h=0,i=0,j=a[0].parent.data.value;g;)h+=a[--g].data.value;for(g=a.length,e=Math.max(h,j);g;)a[--g].data.weight=e?a[g].data.value/e:0,i+=a[g].data.weight,a[g].isBranch&&this.weigh(a[g].children,c,d+1);return 1-i>1e-5&&(f=new b,f.data.label="",f.data.weight=1-i,f.x=0,f.y=0,f.width=0,f.height=0,f.data.qElemNo=-3,f.data.qType="O",f.data.isFakeOthers=!0,f.data.value=j-h,f.data.depth=(a[0].parent.data.depth||0)+1,a[0].parent.addChild(f),a[0].parent.children!==a&&a.push(f)),this},layout:function(){return this},arrange:function(a,b,c,d,g,h){if(!a||!a.length)return this;this.layout(a,b,c,d,g);var j,k,l,m=this.cellPadding;for(l=0;l<a.length;l++)j=a[l],j.visible=j.width>0&&j.height>0,j.isBranch?(j.width=Math.max(0,j.width-m),j.height=Math.max(0,j.height-m),j.x+=.5*m,j.y+=.5*m,j.visible=j.width>0&&j.height>0,j.data.labelType=this._getLabelType(h,!0,j.data.area),k=j.data.labelType!==i.HEADER?0:e,j.data.labelType===i.NONE_COLLAPSED&&(k=f,j.data.labelType=i.NONE),this.arrange(j.children,j.width,j.height-k,j.x,j.y+k,h+1)):j.data.labelType=this._getLabelType(h,!1,j.data.area);return this},_getLabelType:function(a,b,c){return b?a>this.labeling.headers.numLevels?i.NONE:a===this.labeling.headers.numLevels?this.labeling.overlay.show&&c>=h?i.OVERLAY:i.NONE:this.collapseHeadersOnSmallBranches&&g>c?i.NONE_COLLAPSED:h>c?i.NONE:i.HEADER:h>c||"none"===this.labeling.leaves.type?i.NONE:i.LEAF}}),d.LABEL=i,d}),define("extensions.qliktech/treemap/treemap-squarified-layout",["extensions.qliktech/treemap/treemap-layout"],function(a){"use strict";function b(a,b,c){var d,f,g,h=c.x,i=c.y,j=c.shortSide,k=a.length,l=0;if(c.direction===e){for(;k>l;l++)g=a[l],g.data.area<=0?(f=0,d=j):(f=j*g.data.area/b,d=g.data.area/f),g.x=Number(h.toFixed(5)),g.y=Number(i.toFixed(5)),g.width=Number(d.toFixed(5)),g.height=Number(f.toFixed(5)),i+=f;c.x+=d,c.width-=d}else{for(;k>l;l++)g=a[l],g.data.area<=0?(d=0,f=j):(d=j*g.data.area/b,f=g.data.area/d),g.x=Number(h.toFixed(5)),g.y=Number(i.toFixed(5)),g.width=Number(d.toFixed(5)),g.height=Number(f.toFixed(5)),h+=d;c.y+=f,c.height-=f}}function c(a,b,c,d){for(var e,f,g=Number.MAX_VALUE,h=0,i=b*b,j=c*c,k=a.length;k;)a[--k].data.area<g&&(g=a[k].data.area),a[k].data.area>h&&(h=a[k].data.area);return e=Math.max(i*h/j,j/(i*g)),d.data.area<g&&(g=d.data.area),d.data.area>h&&(h=d.data.area),j=(c+d.data.area)*(c+d.data.area),f=Math.max(i*h/j,j/(i*g)),e>=f}var d,e=0,f=1;return d=a.extend({init:function(){this._super()},sort:function(a){var b,c;if(!a||!a.length)return this;for(a.sort(function(a,b){return"O"===b.data.qType?-1:"O"===a.data.qType?1:b.data.weight-a.data.weight}),c=a.length,b=0;c>b;b++)a[b].isBranch&&this.sort(a[b].children);return this},layout:function(a,d,g,h,i){if(!a||!a.length)return this;var j,k,l,m,n={x:h,y:i,width:d,height:g,direction:d>=g?e:f,shortSide:Math.min(g,d)},o=0,p=[],q=d*g;for(k=a.length;k;)a[--k].data.area=q*a[k].data.weight;for(k=0;k<a.length;)j=a[k],n.direction===e?(m=n.height*j.data.area/(o+j.data.area),l=j.data.area/m):(l=n.width*j.data.area/(o+j.data.area),m=j.data.area/l),!p.length||c(p,n.shortSide,o,j)?(o+=j.data.area,p.push(j),k++):(b(p,o,n),o=0,p=[],n.shortSide=Math.min(n.width,n.height),n.direction=n.height<=n.width?e:f);return p.length&&b(p,o,n),this}})}),define("extensions.qliktech/treemap/treemap-hierarchy",["core.utils/class","extensions.qliktech/treemap/treemap-node"],function(a,b){"use strict";function c(a,d,e,g,h,i,j){var k,l,m,n,o,p=d?d.length:0;for(g=g||0,j=j||0,o=0;p>o;o++)k=null,m=d[o],l=m.children,m.data.qType===f.PSEUDO&&(j=o),m.data.qType!==f.TOTAL&&(l.length?1===l.length&&l[0].data.qType===f._MEASURE?(n=l[0].children,n=n?n[0]:null,n&&!isNaN(n.data.qValue)&&n.data.qValue>0&&(k=new b(m.data.qText,n.data.qValue,i?i.formatValue(n.data.qValue):n.data.qText),k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem)):1===l.length&&l[0].data.qType===f.VALUE?!isNaN(l[0].data.qValue)&&l[0].data.qValue>0&&(k=new b(m.data.qText,l[0].data.qValue,i?i.formatValue(l[0].data.qValue):l[0].data.qText),k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem):m.data.qMaxPos>0&&(k=new b(m.data.qText,m.data.qMaxPos),k.data.qElemNo=m.data.qElemNo,k.data.row=m.data.rowIndex,k.data.qType=m.data.qType,k.data.cacheItem=m.cacheItem,k.data.addMeasures=!0,m.cacheItem&&m.cacheItem.addShape("dataArea",k),c(k,l,e,g+1,h,i,j)):!isNaN(m.data.qValue)&&m.data.qValue>0&&(k=new b(m.data.qText,m.data.qValue,m.data.qText),k.data.qType=m.data.qType,k.data.qElemNo=m.data.qElemNo,k.data.row=m.data.rowIndex,k.data.isMeasure=g===e,m.cacheItem&&m.cacheItem.addShape("dataArea",k),k.data.cacheItem=m.cacheItem),k&&(k.data.depth=g,isNaN(j)||(k.data.measureIndex=j),a.addChild(k)))}function d(a){var b=[];return a.forEach(function(a){b=b.concat(a.children)}),b}var e,f={PSEUDO:"P",TOTAL:"T",VALUE:"V",NORMAL:"N",OTHERS:"O",ROOT:"R",_MEASURE:"_M"};return e=a.extend("TreemapHierarchy",{init:function(a){this.root=a||new b,this._pseudoDimPos=0,this.labeling={values:{show:!1}}},setData:function(a,b){this._pseudoDimPos=a.pseudoDimPos||0,this._numMeasures=a.qHyperCube.qMeasureInfo.length,this._numDimensions=a.qHyperCube.qDimensionInfo.length,this._dimensionLocks=a.qHyperCube.qDimensionInfo.map(function(a){return a.qLocked}),this._selectionStates=a.qHyperCube.qDimensionInfo.map(function(a){return a.qStateCounts});var d=this.labeling.values.show&&this.measureFormatters&&this.measureFormatters[0]&&"U"===this.measureFormatters[0].type?this.measureFormatters[0]:null,e=a.qHyperCube.qStackedDataPages[0].qData,g=a.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}),h=a.qHyperCube.qMeasureInfo.length>1?this._pseudoDimPos:-1;this.root.removeChildren(),e&&e.length&&(this.root.data.value=e[0].qMaxPos,this.root.data.qType=f.ROOT,c(this.root,b.children,h,0,g,d))},getDimensionIndexFromNode:function(a){var b,c,d=0;if(!a)return-2;if(a.data.qType===f.PSEUDO)return-1;for(b=a,c=b.parent;b&&c&&c!==this.root;)b=c,c=b.parent,b.data.qType!==f.PSEUDO&&d++;return d},getSelectableCacheItems:function(a){if(!a||!a.length)return[];var b,c=a[0],e=c.children,g=this.getDimensionIndexFromNode(c);return c.data.qType===f.PSEUDO?e.length?this.getSelectableCacheItems(d(a)):[]:this._dimensionLocks[g]?e.length?this.getSelectableCacheItems(d(a)):[]:(b=this.getCacheItemsFromNodes(a),b.length<=1&&this._selectionStates[g].qSelected&&!this._selectionStates[g].qOption&&e.length?this.getSelectableCacheItems(d(a)):b)},getCacheItemsFromNodes:function(a){var b,c=a?a.length:0,d=[];for(b=0;c>b;b++)a[b].data.cacheItem&&d.indexOf(a[b].data.cacheItem)<0&&d.push(a[b].data.cacheItem);return d}})}),define("extensions.qliktech/treemap/treemap-area",["general.utils/color","./treemap-squarified-layout","./treemap-hierarchy","general.utils/property-resolver","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/text","objects.views/charts/components/chart-component","objects.views/charts/chart-style-service","core.utils/deferred"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(b,c){var d=1;return w.width=8*d,w.height=8*d,x.save(),x.fillStyle=a.toRGBA(b),x.strokeStyle=a.toRGBA(b,c),x.lineWidth=2,x.scale(d,d),x.beginPath(),x.moveTo(5,-1),x.lineTo(-1,5),x.moveTo(9,3),x.lineTo(3,9),x.stroke(),x.restore(),x.createPattern(w,"repeat")}function m(b,c){var d,e,f,g,i,j,k,l=b?b.length:0,n="leaf",o=new a(this._style.overlay.label.color.light),p=new a(this._style.overlay.label.color.dark),q=function(a,b){return b.data.isColorDark?a+b.data.value:a};for(d=0;l>d;d++)if(e=b[d],n=e.data.labelType,e.isBranch?(m.apply(this,[b[d].children,c+1]),j=this._branchLabelContainer):j=this._leafLabelContainer,e.data.labelType){switch(g=e.data.label,g&&g.length>512&&(g=g.substr(0,256)),this.labeling.values.show&&1===n&&e.data.valueLabel&&(g=[g,e.data.valueLabel]),e.data.labelShape?e.data.labelShape.parent||j.addChild(e.data.labelShape):(e.data.labelShape=new h,e.data.labelShape.setText(g),j.addChild(e.data.labelShape)),i={x:e.x,y:e.y,width:e.width,height:e.height,maxHeight:e.height-4,maxWidth:e.width-8,align:"left",baseline:"top"},n){case 3:e.data.labelFill||(k=e.descendants,e.data.labelFill=k.reduce(q,0)>e.data.value/2?o:p,e.data.labelStroke=e.data.labelFill===o?"rgba(33, 33, 33, 0.4)":"rgba(230, 230, 230, 0.4)",e.data.labelFill=e.data.labelFill.toRGBA(),e.data.labelShape.strokeFirst=!0),i.fill=e.data.labelFill,i.stroke=e.data.labelStroke,i.maxNumLines=/\s+/.test(e.data.label)?2:1,f=Math.round(.1*Math.sqrt(2*e.data.area)),i.font=this._styleService.getFont(r,"overlay.label",null,null,f),i.strokeWidth=f>64?2:1,i.align="center",i.baseline="middle";break;case 2:
i.fill=this._style.branch.label.color,i.stroke=void 0,i.x+=4,i.width-=4,i.font=this._style.branch.label.font,i.baseline="middle",i.maxNumLines=1,i.height=s;break;default:i.fill=e.data.isColorDark?this._style.leaf.label.color.light:this._style.leaf.label.color.dark,i.x+=4,i.y+=4,i.width-=4,i.height-=4,i.font=this.labeling.leaves.type===t.DYNAMIC?this._styleService.getFont(r,"leaf.label",null,null,Math.round(.1*Math.sqrt(2*e.area))):this._style.leaf.label.font,i.baseline="top",i.maxNumLines=this.labeling.values.show?[-1,1]:[-1]}e.data.labelShape.attrs(i)}else e.data.labelShape&&e.data.labelShape.detach()}function n(b){var c,d,e,f=b?b.length:0,g=this._colorMap;for(c=0;f>c;c++)b[c].isBranch?(b[c].fill=this._style.branch.fill,b[c].stroke=null,n.call(this,b[c].children)):b[c].data.isInitiated||(e=[],"P"!==b[c].data.qType&&"undefined"!=typeof b[c].data.qElemNo&&e.push(b[c].data.qElemNo),b[c].ancestors.forEach(function(a){["A","N"].contains(a.data.qType)&&e.push(a.data.qElemNo)}),e.reverse(),b[c].data.isInitiated=!0,b[c].data.color=g.getColor(e,b[c].data.value,b[c].data.measureIndex||0,b[c].data.row),d=b[c].data.isFakeOthers?this._branchColorAtDepth[b[c].data.depth]:b[c].data.color,b[c].data.isColorDark=a.getBestContrast(d,u,v)===u,b[c].fill=b[c].data.isFakeOthers?this._fakeOthersPatternAtDepth[b[c].data.depth]:b[c].data.color.toRGBA(),b[c].stroke=this._sheetBackgroundStroke,b[c].strokeWidth=1)}function o(a){var b={backgroundColor:a.getValue(r,null,"backgroundColor"),branch:{fill:a.getValue(r,"branch","fill"),label:{color:a.getValue(r,"branch.label","color"),font:a.getFont(r,"branch.label")}},leaf:{border:{width:{"default":a.getValue(r,"leaf.border","width"),selected:a.getValue(r,"leaf.border","width","selected")},color:{"default":a.getValue(r,"leaf.border","color"),selected:a.getValue(r,"leaf.border","color","selected")}},label:{font:a.getFont(r,"leaf.label"),color:{light:a.getValue(r,"leaf.label","color","light"),dark:a.getValue(r,"leaf.label","color","dark")}}},overlay:{label:{color:{light:a.getValue(r,"overlay.label","color","light"),dark:a.getValue(r,"overlay.label","color","dark")}}}};return b}function p(b,c){var d=b._a+c._a*(1-b._a),e=(b._r*b._a+c._r*c._a*(1-b._a))/d,f=(b._g*b._a+c._g*c._a*(1-b._a))/d,g=(b._b*b._a+c._b*c._a*(1-b._a))/d;return 0===d&&(e=f=g=0),new a(e,f,g,1)}var q,r="treemap",s=24,t={NONE:"none",STATIC:"static",DYNAMIC:"dynamic"},u=new a("#eee"),v=new a("#666"),w=document.createElement("canvas"),x=w.getContext("2d");return q=i.extend("TreeMapArea",{init:function(){this._super.apply(this,arguments),this.renderers={cells:new e(this.container,{name:"cell-layer"}),labels:new e(this.container,{name:"label-layer"}),selections:new e(this.container,{name:"selection-layer"})},this._layout=new b,this._hierarchy=new c(this.renderers.cells.stage),this._pseudoDimPos=0,this._labelSettings={values:{show:!1},headers:{show:!0,numLevels:1},overlay:{show:!0},leaves:{show:!0,type:"static"}},this._styleService=j.getInstance(),this._style=o(this._styleService),this._sheetBackgroundColor=new a(this._style.backgroundColor),this._sheetBackgroundStroke=a.toRGBA(this._sheetBackgroundColor,.5),this.labeling=this._labelSettings},cellPadding:2,setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setPseudoDimPos:function(a){this._pseudoDimPos=a},setDimensionTree:function(a){this._tree=a,this.invalidateProperties(),this.invalidateDisplay()},_updateSize:function(){this.invalidateDisplay()},_updateProperties:function(){if(this._data){d.getValue(this._data,"labels.auto")?(this.labeling.overlay.show=!0,this.labeling.headers.numLevels=0,this.labeling.leaves.type=t.STATIC):(this.labeling.overlay.show=d.getValue(this._data,"labels.overlay",!0),this.labeling.headers.numLevels=d.getValue(this._data,"labels.headers")&&this._layoutMode>3?1:0,this.labeling.leaves.type=d.getValue(this._data,"labels.leaves")?t.STATIC:t.NONE),this.labeling.values.show=d.getValue(this._data,"labels.values",!1),this._layout.labeling=this.labeling,this._hierarchy.measureFormatters=this.measureFormatters;var b=this._hierarchy.root.children;this._hierarchy.labeling=this.labeling,this._hierarchy.setData(this._data,this._tree),this._dimension=0;var c=this.renderers.labels.stage;c.removeChildren();var e=new g;c.addChild(e);var f=new g;c.addChild(f);var h=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.supressOthers});this._layout.othersLabelByDimension=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.othersLabel}),this._layout.weigh(b,h).sort(b),this._leafLabelContainer=e,this._branchLabelContainer=f;var i=this._hierarchy.getSelectableCacheItems(b),j=this.selectionIdentifier?this.selectionIdentifier:"dataArea",k=0,m=0,o=i[0]?i[0].getShapes(j)[0]:null;o&&o.ancestors.forEach(function(a){a.parent&&("N"===a.data.qType&&k++,m++)}),this.setSelectionIndices([k]),this._dimension=m,this.setSelectableShapes(i);var q=new a(this._style.branch.fill),r=this._data.qHyperCube.qDimensionInfo.length+1;this._branchColorAtDepth=[p(q,this._sheetBackgroundColor)],this._fakeOthersPatternAtDepth=[];for(var s=1;r>s;s++)this._branchColorAtDepth.push(p(q,this._branchColorAtDepth[s-1]));for(s=0;r>s;s++)this._fakeOthersPatternAtDepth.push(l(this._colorMap.getColor([-3]),.1));this._dataChanged=!0,n.call(this,b),this.renderers.selections.stage.doInvalidate=!1,this.renderers.selections.stage.removeChildren()}},hasValidData:function(){return this._super()&&this._data},paint:function(){this._super(this._layoutMode,this._data);var a=this._hierarchy.root.children;return this.renderers.cells.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this.renderers.selections.stage.opacity=1,this._layout.cellPadding=this.cellPadding*Math.sqrt(this.rect.width*this.rect.height)/500,this.labeling.headers.numLevels=(d.getValue(this._data,"labels.auto",!0)||d.getValue(this._data,"labels.headers"))&&this._layoutMode>3?1:0,a.length&&(this._dataChanged||this._oldW!==this.rect.width||this._oldH!==this.rect.height)&&(this._layout.arrange(a,this.rect.width-4,this.rect.height-4,this.rect.x,this.rect.y,0),m.apply(this,[a,0])),this._dataChanged=!1,this._oldW=this.rect.width,this._oldH=this.rect.height,k.all([this.renderers.cells.render(!0),this.renderers.labels.render(!0),this.renderers.selections.render(!0)])},release:function(){for(var a in this.renderers)this.renderers[a].release();this._selectableShapes=[],this.renderers={},this._hierarchy=null,this._layout=null,this._super()},toggleCacheItem:function(a){var b=!0;this.renderers.cells.stage.opacity!==this._globalAlpha?(b=!1,this.renderers.cells.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha,this.renderers.selections.stage.doInvalidate=!1):this.renderers.selections.stage.doInvalidate=!0,a.getShapes(this.selectionIdentifier?this.selectionIdentifier:"dataArea").forEach(function(c){a.selected?(c.data.borderShape||(c.data.borderShape=new f(c.x,c.y,c.width,c.height),c.data.borderShape.strokeWidth=this._style.leaf.border.width.selected,c.data.borderShape.stroke=this._style.leaf.border.color.selected,this.renderers.selections.stage.addChild(c.data.borderShape)),c.opacity=1,c.find("[data.labelShape]").forEach(function(a){a.data.labelShape.opacity=1,b&&a.data.labelShape.invalidate()}),c.data.labelShape&&(c.data.labelShape.opacity=1,b&&c.data.labelShape.invalidate())):(c.data.borderShape&&(c.data.borderShape.detach(),c.data.borderShape=null),c.opacity=void 0,c.data.labelShape&&(c.data.labelShape.opacity=void 0,b&&c.data.labelShape.invalidate()),c.find("[data.labelShape]").forEach(function(a){a.data.labelShape.opacity=void 0,b&&a.data.labelShape.invalidate()})),b&&c.invalidate()},this),b||(this.renderers.cells.render(),this.renderers.labels.render(),this.renderers.selections.render())}})}),define("text!extensions.qliktech/treemap/treemap.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData"></span>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero"></div>'}),define("extensions.qliktech/treemap/treemap-properties",["general.utils/property-resolver"],function(a){function b(b,c){var d=a.getValue(b,"color.auto"),e=a.getValue(b,"color.mode"),f=c.getMeasures(),g=c.getDimensions();return g.length>1&&f.length<=1&&!d&&"byDimension"===e}function c(a,b){var c=b.getDimensions(),d=b.getMeasures();return d.length+c.length>2}var d;d={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!1,items:{labels:{type:"items",items:{auto:{ref:"labels.auto",type:"boolean",translation:"properties.dataPoints.headersAndLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],snapshot:{tid:"property-dataPoints"}},headers:{ref:"labels.headers",translation:"properties.dataPoints.headers",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b,d){return!a.getValue(b,"labels.auto")&&c(b,d)}},overlay:{ref:"labels.overlay",type:"boolean",component:"switch",translation:"properties.dataPoints.overlayLabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b,c){return!a.getValue(b,"labels.auto")&&c.getDimensions().length-(a.getValue(b,"labels.headers")?1:0)>1}},leaves:{ref:"labels.leaves",type:"string",translation:"properties.dataPoints.leafLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b){return!a.getValue(b,"labels.auto")},snapshot:{tid:"property-leafLabels"}},values:{ref:"labels.values",type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(b){return a.getValue(b,"labels.auto")||a.getValue(b,"labels.leaves")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",translation:"properties.colors",items:{colors:{items:{dimensionId:{ref:"color.dimensionId",type:"string",component:"dimension-dropdown",translation:"properties.colorDimensionId",show:function(a,c){return b(a,c)}}}},legend:{show:!1}}}}};var e={uses:"data",items:{dimensions:{},measures:{}}},f={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:e,addons:f,settings:d}}}),define("extensions.qliktech/treemap/treemap-data",["general.utils/property-resolver"],function(a){function b(b,c){var d=c.getDimensions(),e=c.getMeasures(),f=a.getValue(b,"color.mode");d.length>1&&b.color&&(b.color.persistent=!0),"byMeasure"===f&&e.length>1?a.setValue(b,"color.mode","byDimension"):"byExpression"===f&&0===e.length&&a.setValue(b,"color.mode","primary")}function c(b,c){a.setValue(c,"color.dimensionId",void 0)}var d={dimensions:{min:1,max:15,add:function(a,c,d){b(c,d)},remove:function(a,d,e){c(a,d,e),b(d,e)},replace:function(b,c,d,e){a.getValue(e,"color.dimensionId")===c.qDef.cId&&a.setValue(e,"color.dimensionId",b.qDef.cId)}},measures:{min:1,max:1,add:function(a,c,d){b(c,d)},remove:function(a,c,d){b(c,d)}}};return d}),define("extensions.qliktech/treemap/treemap",["jquery","./treemap-area","client.utils/state","text!./treemap.ng.html","objects.views/charts/chart","objects.backend-api/stacked-api","objects.views/charts/disclaimers/chart-utils","extensions.qliktech/treemap/treemap-properties","extensions.qliktech/treemap/treemap-data","objects.views/charts/components/chart-component","objects.views/charts/components/axis/axis-title","objects.views/charts/representation/combo-color-map","core.utils/deferred","objects.extension/object-conversion","objects.views/charts/disclaimers/chart-disclaimer-directive","touche"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o,p=".treemap";return o=e.extend("Treemap",{init:function(c,d,e,f){this._data={},e=a.extend(!0,e||{},{debug:!0,providers:{colorMap:{clazz:l,multiDimScheme:"first"}},components:{dataArea:{clazz:b,show:!0,dock:"center",showFlag:j.prototype.ShowFlags.SPARK},xAxisTitle:{show:!1,order:1,dock:"top",relevantSize:30,showFlag:j.prototype.ShowFlags.SMALL,clazz:k}}}),this._super(c,d,e,f)},off:function(){Touche(this.container).off("*",p),this._super()},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.options._disableSelections||(this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(function(a){var b=this.components.dataArea._dimension;this._selectedRows.length?this.backendApi.select(this._selectedRows,[b],"L"):a.length&&a.every(function(a){return!a.selected})&&this.backendApi.clearSelections()}.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},_paint:function(){var a=this;return this._super().then(function(b){if(!b||!b.invalid){a.layout();var c,d=[];for(c in a.components)d.push(a.components[c].invalidateDisplay("Treemap.paint"));return m.all(d)}})},prePaint:function(a){this._super(),g.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,c,a)},_updateData:function(a){this._data=a,this._super(a),this.providers.colorMap.setData(a),this.components.dataArea.setData(a),this.providers.colorMap.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.cellPadding=2,this.components.dataArea.setPseudoDimPos(0)},toggleCacheItem:function(a){for(var b in this.components)this.components[b].toggleCacheItem?this.components[b].toggleCacheItem(a):this.components[b].invalidateDisplay("Treemap#toggleCacheItem")}}),{type:"treemap",BackendApi:f,template:d,View:o,definition:h,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"K",qNoOfLeftDims:-1,qMaxStackedCells:3e3,qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:3e3,qLeft:0,qWidth:30}],qSuppressZero:!1,qSuppressMissing:!0}},data:i,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},colorLegend:{}}},importProperties:n.colorChart.importProperties.bind(n),exportProperties:n.colorChart.exportProperties.bind(n)}}),define("objects.utils/font-manager",["core.utils/class"],function(a){function b(a,b,c){return b>a?0:a>c?1:(a-b)/(c-b)}var c;return c=a.extend("FontManager",{init:function(){this._minFontSize=10,this._maxFontSize=20,this._minRectSize=100,this._maxRectSize=900,this._fontWeight="normal",this._fontFamily="QlikView Sans",this._fontSize=10},setFontWeight:function(a){this._fontWeight=a},setFontFamily:function(a){this._fontFamily=a},setRectLimits:function(a,b){this._minRectSize=a,this._maxRectSize=b},getFont:function(a,c){var d=Math.min(a.height,a.width),e=c&&c.minFontSize?c.minFontSize:this._minFontSize,f=c&&c.maxFontSize?c.maxFontSize:this._maxFontSize,g=b(d,this._minRectSize,this._maxRectSize);return this._fontSize=e+Math.round(g*(f-e)),this._fontWeight+" "+this._fontSize+"px "+this._fontFamily},getFontSize:function(a,c){var d=Math.min(a.height,a.width),e=c&&c.minFontSize?c.minFontSize:this._minFontSize,f=c&&c.maxFontSize?c.maxFontSize:this._maxFontSize,g=b(d,this._minRectSize,this._maxRectSize);return e+Math.round(g*(f-e))}})}),define("extensions.qliktech/gauge/gauge-helper",["core.utils/class","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/shapes/arc","objects.views/charts/shapes/polygon","objects.views/charts/shapes/text","general.utils/color","objects.views/charts/components/axis/radial-axis-helper","objects.utils/font-manager"],function(a,b,c,d,e,f,g,h,i){function j(a,b,c){return{x0:a.x0,y0:a.y0,x1:a.x1,y1:a.y1,limits:b,colors:c}}var k,l=[0,1],m=[0,.5,1];return k=a.extend("GaugeHelper",{init:function(){this._padding=0,this._colorWidth=50,this._maxWidth=50,this._labelPadding=10,this._fontManager=new i,this._fontManager.setRectLimits(100,1e3),this._bigValuesSettings={minFontSize:12,maxFontSize:60}},createBarSegments:function(a,c,d,e,f){if(!a||0===a.colors.length)return{shapes:[]};var h,i,k,n,o,p,q,r,s,t,u,v,w=[],x=a.colors,y=a.limits,z=this._colorWidth,A={},B=!1,C={value:0,gradient:!1},D=new g;for(f=Math.min(Math.max(f,0),1),y=y.map(function(a){return{value:(a.value-c.getPlotMin())/(c.getPlotMax()-c.getPlotMin()),gradient:a.gradient}}),h=0;h<x.length;h++)r=y[h]?y[h]:{value:1,gradient:!1},k=r.value,n=0===h?0:y[h-1].value,s=c.getPositionOfNormalizedValue(k),u=c.getPositionOfNormalizedValue(n),A.current=new g(x[h].color),A.next=new g(x[h+1]?x[h+1].color:x[h].color),t=(f-n)/(k-n),B=t>=0&&1>=t,d?(z=e.width<10?e.width:this._colorWidth,i=new b(this._relevantPos,s,z,u-s)):(z=this._colorWidth,i=new b(u,this._relevantPos,s-u,z)),v={x0:i.x,y0:i.y+(d?i.height:0),x1:i.x+(d?0:i.width),y1:i.y},C&&C.gradient&&!r.gradient?(A.last=g.getBlend(A.current,A.last,.5),o={gradient:j(v,l,[A.last.toRGBA(),A.current.toRGBA()])},p=A.last,q=A.current):r.gradient?(A.next=g.getBlend(A.current,A.next,.5),C.gradient?(A.last=g.getBlend(A.current,A.last,.5),o={gradient:j(v,m,[A.last.toRGBA(),A.current.toRGBA(),A.next.toRGBA()])},t>.5?(t=(t-.5)/.5,p=A.last,q=A.current):(t/=.5,p=A.current,q=A.next)):(o={gradient:j(v,l,[A.current,A.next])},p=A.current,q=A.next)):o=A.current.toRGBA(),B&&(D=o.gradient?g.getBlend(p,q,t):A.current),i.opacity=1,i.fill=o,i.stroke=o,w.push(i),A.last=A.current,C=r;return{shapes:w,pointerBgColor:D}},createBarProgress:function(a,c,d,e,f){var h,i,j,k,l=[],m=new g(d),n=new g(this.style.area.color);return a=isNaN(a)?0:a>1?1:0>a?0:a,i=c.getPositionOfValue((c.getPlotMax()-c.getPlotMin())*a+c.getPlotMin()),this._labelPadding=this._colorWidth/2,j=this._colorWidth,k=this._relevantPos,h=e?new b(k,i,j,f.height):new b(0,k,i,j),h.opacity=1,h.fill=m.toHex(),h.stroke=m.createShiftedColor().toHex(),h.strokeWidth=1,l.push(h),h=e?new b(k,0,j,i):new b(i,k,f.width,j),h.opacity=1,h.fill=n.toHex(),h.stroke=n.createShiftedColor(.1).toHex(),h.strokeWidth=1,l.push(h),l},createGaugeMeterValue:function(a,b,c,d,e,g,h){var i=new f;return i.text=b,i.ColorWidth=200,i.font=h,i.opacity=1,i.fill=this.style.value.color,d?(a+g/2>e.height?(i.baseline="bottom",a=e.height):g/2>a?(i.baseline="top",a=0):i.baseline="middle",i.x=this._relevantPos+this._colorWidth+this._labelPadding,i.maxWidth=e.width-i.x,i.y=a,i.align="left"):(i.y=this._relevantPos+this._colorWidth+this._labelPadding+g,i.x=Math.max(Math.min(e.width-c/2,a),c/2),i.align="center",i.baseline="bottom"),i},createGaugeMeterPointer:function(a,b,d,f){var g,h=a>1?1:0>a?-1:0,i=[],j=this._relevantPos,k=Math.max(Math.round(this._colorWidth/25),2),l=50,m=l>j?10:this._colorWidth,n=Math.max(m,10)/6,o=f.isDark()?this.style.pointer.color.light:this.style.pointer.color.dark,p=new e,q=new c;return q.opacity=1,q.stroke=o,q.strokeWidth=k,p.opacity=1,p.fill=o,p.strokeWidth=k,a=a>1?1:0>a?0:a,g=b.getPositionOfValue((b.getPlotMax()-b.getPlotMin())*a+b.getPlotMin()),d?(0!==h&&(p.set([{x:j+m/2,y:g},{x:j-n+m/2,y:h*n*2+g},{x:j+n+m/2,y:h*n*2+g}]),i.push(p)),q.set(j,g,j+m,g)):(0!==h&&(p.set([{y:j+m/2,x:g},{y:j-n+m/2,x:-h*n*2+g},{y:j+n+m/2,x:-h*n*2+g}]),i.push(p)),q.set(g,j,g,j+m)),i.push(q),i},updateLabelStyle:function(a,b,c,d,e){this._bigValuesSettings={minFontSize:this.style.value.minFontSize,maxFontSize:this.style.value.maxFontSize},a.value.font=c.getFont(d,e,null,null,this._fontManager.getFontSize(b,this._bigValuesSettings))},createRadialSegments:function(a,b){if(!a||a.colors.length<1)return[];var c,e,f,h,i,k,n,o,p=[],q=a.limits,r=a.colors,s=this._colorWidth,t=r[0].color,u={value:0,gradient:!1},v=b._radialOptions.start,w=this._paddingToAxis;if(q=q.map(function(a){return{value:(a.value-b.getPlotMin())/(b.getPlotMax()-b.getPlotMin()),gradient:a.gradient}}),s=this._colorWidth*(b._relevantAngle>Math.PI?1:Math.sin(b._relevantAngle/4)),this._colorWidth=s,b._radius-s-w<0)return p;for(c=0;c<a.colors.length;c++)f=q[c]?q[c]:{value:1,gradient:!1},k=r[c+1]?r[c+1].color:r[c].color,e=r[c].color,i=b.getAngleOfNormalizedValue(f.value),h=new d(b._centerPoint.x,b._centerPoint.y,b._radius-s-w,b._radius-w,v,i,0),o={x0:h.x3,y0:h.y3,x1:h.x4,y1:h.y4},u&&u.gradient&&!f.gradient?(k=new g(e).blend(new g(t),.5),n={gradient:j(o,l,[k,e])}):f.gradient?(k=new g(e).blend(new g(k),.5),u.gradient?(t=new g(e).blend(new g(t),.5),n={gradient:j(o,m,[t,e,k])}):n={gradient:j(o,l,[e,k])}):n=e,h.opacity=1,h.fill=n,h.stroke=n,p.push(h),v=i,u=f,t=e;return p},createRadialGaugeMeter:function(a,b){var c,d,f,g=h.getAngleOfNormalizedValue(a,b),i=Math.max(this._colorWidth,10)/6,j=2,k=a>1?-1:1;return a>1||0>a?(d=this._colorWidth*(b._relevantAngle>Math.PI?1:Math.sin(b._relevantAngle/4)),this._colorWidth=d,c=-d*k/2,f=new e([{x:2*i+j,y:c},{x:j,y:i+c},{x:j,y:-i+c}])):f=new e([{x:.5*-i+4,y:0},{x:8*-i,y:i},{x:8*-i,y:-i}]),f.opacity=1,f.translate(b._centerPoint.x+Math.cos(g)*b._radius,b._centerPoint.y+Math.sin(g)*b._radius),f.rotate(g),(a>1||0>a)&&f.rotate(-k*Math.PI/2),f.fill=this.style.pointer.color.dark,f},createRadialProgress:function(a,b,c,f){var i,j,k,l,m=c._radialOptions.start,n=isNaN(a)?m:h.getAngleOfNormalizedValue(a,c),o=c._radialOptions.end,p=Math.min(f.width,f.height),q=[],r=(p>500?this._maxWidth:Math.max(p/500*this._maxWidth,10))/6,s=2,t=this._paddingToAxis,u=new g(this.style.area.color);return b=new g(b),j=this._colorWidth*(c._relevantAngle>Math.PI?1:Math.sin(c._relevantAngle/4)),this._colorWidth=j,c._radius-j-t<0?q:((a>1||0>a)&&(l=a>1?-1:1,k=-j*l/2,i=new e([{x:2*r+s,y:k},{x:s,y:r+k},{x:s,y:-r+k}]),i.opacity=1,i.translate(c._centerPoint.x+Math.cos(n)*c._radius,c._centerPoint.y+Math.sin(n)*c._radius),i.rotate(n-l*Math.PI/2),i.fill=b.toHex(),q.push(i)),n>m&&(i=new d(0,0,c._radius-j-t,c._radius-t,m,n,0),i.opacity=1,i.translate(c._centerPoint.x,c._centerPoint.y),i.fill=b.toHex(),i.stroke=b.createShiftedColor().toHex(),q.push(i)),o>n&&(i=new d(0,0,c._radius-j-t,c._radius-t,n,o,0),i.opacity=1,i.translate(c._centerPoint.x,c._centerPoint.y),i.fill=u.toHex(),i.stroke=u.createShiftedColor(.1).toHex(),q.push(i)),q)},createRadialGaugeValue:function(a,b,c,d,e,g){var h=new f;return h.text=b,h.x=d.width/2,h.y=.5*d.height-g/2+.05*Math.min(d.width,d.height),h.align="center",h.font=e,h.baseline="middle",h.maxWidth=1.4*c._radius,h.opacity=1,h.fill=this.style.value.color,[h]},createRadialSpark:function(a,b,c,d){var f,g,i=.4*Math.min(d.width,d.height),j=h.getAngleOfNormalizedValue(a,c)+Math.PI/2,k=0,l=new e;if(l.opacity=1,"string"!=typeof b)if(1===b.colors.length)l.fill=b.colors[0].color;else for(f=0;f<b.colors.length;f++){if(g=b.limits[f]?(b.limits[f].value-c.getPlotMin())/(c.getPlotMax()-c.getPlotMin()):1,a>=k&&g>a){l.fill=b.colors[f].color;break}k=g}else l.fill=b;return d.width<d.height?l.set([{x:0,y:-i},{x:-i/2,y:+i/2},{x:i/2,y:+i/2},{x:0,y:-i}]):l.set([{x:-i/2,y:i/2},{x:0,y:-i},{x:+i/2,y:i/2},{x:-i/2,y:i/2}]),l.translate(c._centerPoint.x,c._centerPoint.y),l.rotate(j),[l]},getGaugeWidth:function(a,b){var c;return a&&(c=b?"width":"height",this._colorWidth=a[c]>500?this._maxWidth:Math.max(a[c]/500*this._maxWidth,10)),this._colorWidth},updateSize:function(a,b,c){var d,e=Math.min(a.width,a.height);d=c?e:b?a.width:a.height,this._colorWidth=d>500?this._maxWidth:Math.max(d/500*this._maxWidth,10),this._relevantPos=(d-this._colorWidth)/2,this._paddingToAxis=Math.min(6,e/200)},getPaddingToAxis:function(){return this._paddingToAxis},getRelevantPos:function(){return this._relevantPos},getPadding:function(){return this._padding}})}),define("extensions.qliktech/gauge/gaugearea",["jquery","objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/gauge/gauge-helper","core.utils/theme","general.utils/color","core.utils/deferred"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,b){if(!this._axis||!this._segmentInfo||void 0===this._axis.getPlotMin()||void 0===this._axis.getPlotMax())return h.resolve();var d,e=this._axis,f=this._style.value.font,i=e.isVertical(),j=c.getFontHeight(f),k=this.renderers.gauge.getTextWidth(a,f),l=this._axis.getPositionOfValue(b),m=(b-e.getPlotMin())/(e.getPlotMax()-e.getPlotMin()),n=[];return this._data.useSegments?(d=this._gaugeHelper.createBarSegments(this._segmentInfo,e,i,this.rect,m),n=d.shapes,n=n.concat(this._gaugeHelper.createGaugeMeterPointer(m,e,i,d.pointerBgColor))):(n=this._gaugeHelper.createBarProgress(m,e,this._progressColor,i,this.rect),(m>1||0>m)&&(n=n.concat(this._gaugeHelper.createGaugeMeterPointer(m,e,i,new g(m>1?this._progressColor:this._style.area.color))))),!isNaN(m)&&(i&&this.rect.width>100||!i&&this.rect.height>100)&&n.push(this._gaugeHelper.createGaugeMeterValue(l,a,k,i,this.rect,j,f)),this.renderers.gauge.stage.removeChildren(),this.renderers.gauge.stage.addChildren(n),this.renderers.gauge.render()}function j(a,b){if(!this._axis||!this._segmentInfo&&this._data.useSegments||this._axis._radius<=0)return h.resolve();var d=this._axis,e=this._style.value.font,f=c.getFontHeight(e),g=Math.min(this.rect.height,this.rect.width),i=(b-d.getPlotMin())/(d.getPlotMax()-d.getPlotMin()),j=[];return 50>g?j=this._gaugeHelper.createRadialSpark(i,this._data.useSegments?this._segmentInfo:this._progressColor,d,this.rect):(this._data.useSegments?(j=this._gaugeHelper.createRadialSegments(this._segmentInfo,d),isNaN(i)||j.push(this._gaugeHelper.createRadialGaugeMeter(i,d))):j=this._gaugeHelper.createRadialProgress(i,this._progressColor,d,this.rect),j=j.concat(this._gaugeHelper.createRadialGaugeValue(b,a,d,this.rect,e,f))),this.renderers.gauge.stage.removeChildren(),this.renderers.gauge.stage.addChildren(j),this.renderers.gauge.render()}function k(a){return f.palette[a]?f.palette[a]:"number"==typeof a?"#000":a}function l(a){var b={value:{color:a.getValue(n,"value","color"),font:a.getFont(n,"value"),minFontSize:a.getValue(n,"value","minFontSize"),maxFontSize:a.getValue(n,"value","maxFontSize")},area:{color:a.getValue(n,"area","backgroundColor")},pointer:{color:{light:a.getValue(n,"pointer","color","light"),dark:a.getValue(n,"pointer","color","dark")}}};return b}var m,n="gauge";return m=b.extend({init:function(){this._super.apply(this,arguments),this._gaugeHelper=new e,this._type="bar",this._currentProperties={},this._transitionProperties={},this._inTransition=!1,this._cacheItems=[],this.renderers={gauge:new c(this.container)},this._styleService=d.getInstance(),this._style=l(this._styleService),this._gaugeHelper.style=this._style},_updateSize:function(){this.invalidateDisplay("Gauge._updateSize")},_updateProperties:function(){if(this._data){var b=this._data;this._segmentInfo=a.extend(!0,{},b.segmentInfo),this._segmentInfo&&this._segmentInfo.limits&&(this._segmentInfo.limits=this._segmentInfo.limits.concat().sort(function(a,b){return a.value-b.value})),this._segmentInfo&&this._segmentInfo.colors&&(this._segmentInfo.colors=this._segmentInfo.colors.concat().map(function(a){return{color:k(a.color)}})),this._progressColor=k(this._data.progressColor),this._orientation=b.orientation,this._type=b.gaugetype,this._transitionProperties={value:b.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,text:b.qHyperCube.qDataPages[0].qMatrix[0][0].qText},this._super()}},hasValidData:function(){return this._super()&&this._data},setAxis:function(a){this._axis=a,this._axis.listen("changed",function(){this.invalidateDisplay()},this)},setRefLines:function(a){this._refLines=a},setRefLineLabels:function(a){this._refLineLabels=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},paint:function(){if(!this._axis)return h.resolve();var a=[];this._gaugeHelper.updateSize(this.rect,this._axis.isVertical(),this._axis.isRadial()),this._refLines&&(this._refLines.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLines.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._refLineLabels&&(this._refLineLabels.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLineLabels.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._gaugeHelper.updateLabelStyle(this._style,this.rect,this._styleService,n,"value");var b=this._data.qHyperCube.qDataPages[0].qMatrix[0][0],c=this.measureFormatters[0],d="U"!==c.type?b.qText:c.formatValue(b.qNum),e=this._currentProperties.value;return this._inTransition&&(d=c.format(e)),this._axis.isRadial()?a.push(j.apply(this,[d,e])):a.push(i.apply(this,[d,e])),this._currentValue=e,this._refLines&&this._refLineLabels&&(this._refLines.setGaugeWidth(this._gaugeHelper.getGaugeWidth()),this._refLineLabels.setGaugeWidth(this._gaugeHelper.getGaugeWidth())),h.all(a)},afterPaint:function(){},clear:function(){},getGaugeWidth:function(a,b){return this._gaugeHelper.getGaugeWidth(a,b)}}),Object.defineProperty(m.prototype,"className",{value:"GaugeArea"}),m}),define("extensions.qliktech/gauge/gauge-ref-lines",["objects.views/charts/components/ref-lines","core.utils/theme"],function(a,b){"use strict";function c(a){return b.palette[a]?b.palette[a]:a}var d;return d=a.extend("GaugeRefLines",{namespace:".gaugereflines",init:function(){this._super.apply(this,arguments),this._width=50},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),this._hasVisibleRefLines){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[],r=this._paddingToAxis,s=this._relevantPos;for(a=0;a<this._numRefLinesDataAxes;a+=1)for(d=this._data[a],e=this._axes[a],f=this._axisPlotMinValues[a],g=this._axisPlotMaxValues[a],b=0;b<d.length;b+=1)d[b].show&&void 0!==d[b].refLineExpr&&(h=this._currentProperties["value"+a+b],h>g||f>h||(e.isRadial()?(o=e._radius,p=e.getAngleOfValue(h),j=e._centerPoint.x+Math.cos(p)*(o-r),k=e._centerPoint.y+Math.sin(p)*(o-r),l=e._centerPoint.x+Math.cos(p)*(o-r-this._width),m=e._centerPoint.y+Math.sin(p)*(o-r-this._width)):(i=e.getPositionOfValue(h),i=Math.floor(i)-.5,e.isVertical()?(j=s,k=i,l=s+this._width,m=i):(j=i,k=s,l=i,m=s+this._width)),n=void 0!==d[b].color?c(d[b].color):"#000000",q.push({type:"line",stroke:n,strokeWidth:1,shape:{x1:j,y1:k,x2:l,y2:m}})));this.renderer.shapes=q,this.renderer.render()}},setGaugeWidth:function(a){this._width=a,this.updateSize(),this.invalidateDisplay()},setPaddingToAxis:function(a){this._paddingToAxis=a},setRelevantPos:function(a){this._relevantPos=a}})}),define("extensions.qliktech/gauge/gauge-ref-line-labels",["objects.views/charts/components/ref-line-labels","objects.views/charts/utils/canvas-renderer","core.utils/theme"],function(a,b,c){"use strict";function d(a){return String(void 0!==a.label?a.label:a)}function e(a){return c.palette[a]?c.palette[a]:a}var f;return f=a.extend("GaugeRefLineLabels",{init:function(){this._super.apply(this,arguments)},paint:function(){if(!this._axis)return void this._clearLabels();
if(this._axis.updateNow(["properties"]),(this._plotMinValue!==this._axis.getPlotMin()||this._plotMaxValue!==this._axis.getPlotMax())&&(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues.call(this)),!this._hasVisibleRefLines)return void this._clearLabels();var a,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x="bottom",y=this._relevantPos,z=[],A=[],B=this._axis;for(a=0;a<this._data.length;a+=1)this._data[a].show&&void 0!==this._data[a].refLineExpr&&(c=this._currentProperties["value"+a],f=d(this._data[a].refLineExpr),void 0===c||isNaN(c)||c<this._axis.getPlotMin()||c>this._axis.getPlotMax()||(s={font:this._font,maxWidth:this._labelMaxWidthForYAxis,maxNumLines:3},o=f,n=o.replace(/[0-9]|\.|\-|\+|e/g,""),n=n.length?o:B.format(c),j=this._data[a].label+" ("+n+")",k=void 0!==this._data[a].color?e(this._data[a].color):"#000000",s.text=j,u=b.measureTextObject({shape:s}),B.isRadial()?(q=B._radius,r=B.getAngleOfValue(c),h=B._centerPoint.x+Math.cos(r)*q,i=B._centerPoint.y+Math.sin(r)*q,p=r>Math.PI/2&&r<3*Math.PI/2?"right":"left",x=r>Math.PI&&r<2*Math.PI?"bottom":"top",t=u.width,0>h-t?(s.maxWidth+=h-t,h=s.maxWidth):h+t>this.rect.width&&(s.maxWidth=t+(this.rect.width-(h+t)))):(g=B.getPositionOfValue(c),g=Math.floor(g)-.5,w=u.height/2,B.isVertical()?(p="left",x="middle",h=y+this._width+4,i=w>g?g+(w-g+4):g>this.rect.height-w?g-(g-(this.rect.height-w-4)):g):(p="center",i=y+this._width,x="top",v=u.width/2,h=v>g?g+(v-g+4):g>this.rect.width-v?g-(g-(this.rect.width-v-4)):g)),s.x=h,s.y=i,s.align=p,s.baseline=x,l={type:"text",fill:k,shape:s},A.push(l),z.push({position:g,shapeWrapper:l})));return m=z?z.length:0,0===m?void this._clearLabels():(this.renderer.shapes=A,void this.renderer.render())},setGaugeWidth:function(a){this._width=a,this.invalidateDisplay()},setPaddingToAxis:function(a){this._paddingToAxis=a},setRelevantPos:function(a){this._relevantPos=a},_clearLabels:function(){this.renderer.shapes&&this.renderer.shapes.length&&(this.renderer.shapes=[],this.renderer.render())}})}),define("text!extensions.qliktech/gauge/gauge.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>\r\n<div qva-popup-disclaimer ng-if="!!dataAttributes.popupDisclaimer.show" pop-close="dataAttributes.popupDisclaimer.onPopClose" pop-message="dataAttributes.popupDisclaimer.message" pop-title="dataAttributes.popupDisclaimer.title" />\r\n'}),define("extensions.qliktech/gauge/gauge-properties",["translator","general.utils/property-resolver"],function(a,b){var c,d,e;c={uses:"data"},d={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{rangeLimits:{type:"items",items:{text:{component:"text",translation:"properties.axis.rangeLimits",style:"sHeader"},min:{ref:"measureAxis.min",translation:"properties.axis.min",type:"number",expression:"optional",invalid:function(a){return a.measureAxis&&a.measureAxis.min>=a.measureAxis.max},change:function(a){b.setValue(a,"disclaimerClosed",!0)}},max:{ref:"measureAxis.max",translation:"Common.Max",type:"number",expression:"optional",defaultValue:100,invalid:function(a){return a.measureAxis&&a.measureAxis.min>=a.measureAxis.max},change:function(a){b.setValue(a,"disclaimerClosed",!0)}}}},type:{ref:"gaugetype",type:"string",component:"item-selection-list",defaultValue:"radial",horizontal:!0,items:[{icon:"¬",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.radial",value:"radial"},{icon:"¡",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.bar",value:"bar"}],change:function(a){"radial"===a.gaugetype?(e=a.orientation,a.orientation="horizontal"):a.orientation=e}},autoOrientation:{ref:"autoOrientation",translation:"properties.orientation",type:"boolean",defaultValue:!0,component:"switch",undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(a){return"bar"===a.gaugetype}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"horizontal",horizontal:!0,items:[{component:"icon-item",icon:"ƒ",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"√",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}],show:function(a){return"bar"===a.gaugetype&&!a.autoOrientation}},angle:{ref:"angle",translation:"properties.gauge.angle",type:"number",component:"slider",min:.2,max:.98,step:.1,defaultValue:.7,show:function(){return!1}},segments:{type:"items",items:{useSegments:{ref:"useSegments",type:"boolean",defaultValue:!1,translation:"properties.gauge.useSegments",change:function(a){a.useSegments&&1===a.segmentInfo.colors.length?a.segmentInfo.colors=[{color:a.progressColor}]:a.progressColor=a.segmentInfo.colors[0].color}},progressColor:{component:"color-picker",translation:"properties.color",ref:"progressColor",type:"integer",defaultValue:3,show:function(a){return!a.useSegments}},valueMode:{ref:"valueMode",translation:"properties.value",type:"string",component:"dropdown",options:[{value:"absolute",translation:"properties.gauge.absolute"},{value:"relative",translation:"properties.gauge.relative"}],show:function(){return!1},defaultValue:"absolute"},maxSegments:{ref:"maxSegments",type:"number",defaultValue:6,show:!1},segmentInfo:{ref:"segments",type:"items",component:"color-scale-creator",show:function(a){return a.useSegments},items:{limits:{ref:"segmentInfo.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(a,b){return"number"==typeof a.value&&(a.value<b.measureAxis.min||a.value>b.measureAxis.max)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},colors:{items:{color:{ref:"color",component:"color-picker",translation:"properties.color",type:"integer",defaultValue:3}},type:"array",ref:"segmentInfo.colors"}}}}},disclaimerClosed:{ref:"disclaimerClosed",type:"boolean",defaultValue:!1,show:!1}}},measureAxis:{type:"items",label:function(b,c){var d,e=c.getMeasureLayouts()[0];return d=e?a.get("properties.measureAxisWithInfo",[e.qFallbackTitle]):a.get("properties.measureAxis")},grouped:!0,items:{axis:{type:"items",snapshot:{title:"properties.measureAxis",tid:"property-yAxis"},items:{show:{ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",type:"string",component:"dropdown",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,show:function(a){return a.measureAxis&&"none"!==a.measureAxis.show&&"title"!==a.measureAxis.show},options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}]}}}}}}};var f={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}},refLines:{uses:"reflines"}}};return{type:"items",component:"accordion",items:{data:c,addons:f,settings:d}}}),define("text!extensions.qliktech/gauge/popup-disclaimer.ng.html",[],function(){return'<div class="qv-popup-disclaimer">\r\n	<div class="icon-close-button" qva-activate="onClose()"></div>\r\n	<header class="dm-header">{{popTitle}}</header>\r\n	<main class="dm-main">\r\n		<p class="dm-p">{{popMessage}}</p>\r\n	</main>\r\n</div>'}),define("extensions.qliktech/gauge/popup-disclaimer",["assets/qvangular/qvangular-core","text!extensions.qliktech/gauge/popup-disclaimer.ng.html"],function(a,b){a.directive("qvaPopupDisclaimer",function(){return{template:b,replace:!0,scope:{popMessage:"=",popTitle:"=",popClose:"="},link:function(a){a.onClose=function(){a.popClose()}}}})}),define("extensions.qliktech/gauge/gauge",["jquery","translator","objects.views/charts/chart","core.utils/deferred","extensions.qliktech/gauge/gaugearea","extensions.qliktech/gauge/gauge-ref-lines","extensions.qliktech/gauge/gauge-ref-line-labels","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","client.utils/state","objects.backend-api/hypercube-api","text!./gauge.ng.html","extensions.qliktech/gauge/gauge-properties","objects.extension/object-conversion","extensions.qliktech/gauge/popup-disclaimer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(){var b=this.components.dataArea,c=b.rect,d=80,e=a.extend({},c),f=this.components.axis,g=f.relevantSize;"vertical"===this._orientation?(e.x=c.width/2-b.getGaugeWidth(b.rect,"vertical"===this._orientation)/2-g,e.x<0?(e.width=g+e.x,e.x=0):e.width=g):(e.y=c.height/2-b.getGaugeWidth(b.rect,"vertical"===this._orientation)/2-g,e.y<0?(e.height=g+e.y,e.y=0):e.height=g),(c.width<d||c.height<d)&&(e["vertical"===this._orientation?"width":"height"]=0),f.rect=e}var p;return p=c.extend("Gauge",{namespace:".gauge",init:function(c,d,j,k){var l=this;j=a.extend(!0,j||{},{providers:{},components:{axis:{show:!0,order:0,dock:"center",showFlag:h.prototype.ShowFlags.SPARK,clazz:i},dataArea:{show:!0,order:1,dock:"center",clazz:e,showFlag:h.prototype.ShowFlags.SPARK},gaugeRefLines:{sortKey:5,show:!0,dock:"center",showFlag:h.prototype.ShowFlags.XSMALL},gaugeRefLineLabels:{show:!0,dock:"center",order:3,showFlag:h.prototype.ShowFlags.XSMALL}}}),this._type="vertical",this._orientation="horizontal",this._super(c,d,j,k),this.components.dataArea.setAxis(this.components.axis),this.components.axis.setAlignment("near"),this.components.axis.setDataRangeTransition(!0),this.components.axis.setShowLine(!1),this.components.gaugeRefLines=new f(this.container),this.components.gaugeRefLines.showFlag=h.prototype.ShowFlags.XSMALL,this.components.gaugeRefLines.setUseTransition(!0),this.components.dataArea.setRefLines(this.components.gaugeRefLines),this.layoutEngine.addComponent(this.components.gaugeRefLines),this.components.gaugeRefLineLabels=new g(this.container),this.components.gaugeRefLineLabels.showFlag=h.prototype.ShowFlags.SMALL,this.components.gaugeRefLineLabels.setUseTransition(!0),this.components.dataArea.setRefLineLabels(this.components.gaugeRefLineLabels),this.layoutEngine.addComponent(this.components.gaugeRefLineLabels),this.$scope.dataAttributes.popupDisclaimer={show:!1,message:b.get("Object.Gauge.RangeIsDefault"),title:b.get("Object.Gauge.RangeIsDefaultTitle"),onPopClose:function(){l.$scope.backendApi.model.getProperties().then(function(a){a.disclaimerClosed=!0,l.$scope.backendApi.model.save()})}}},_updateData:function(a){if(this._type=a.gaugetype,this._orientation=a.autoOrientation&&"bar"===a.gaugetype?this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal":a.orientation,a.refLine){var b={axes:{axis:{component:this.components.axis,data:a.axis,dataIndices:a.qHyperCube.qMeasureInfo.map(function(a,b){return b})}},refLineLabels:{labels:{data:a.refLine.refLines,component:this.components.gaugeRefLineLabels,axis:this.components.axis}},refLines:{component:this.components.gaugeRefLines}};this._super(a,b),this.components.dataArea.setData(a),this.updateAxis(a,this.options),this.updateRefLines(a,b)}else this.components.dataArea.setData(a),this.updateAxis(a,this.options),this._super(a)},updateRefLines:function(a,b){var c,d=b.refLineLabels,e=[],f=[];for(c in d)d[c].component&&(d[c].component.setData(d[c].data),d[c].component.setAxis(d[c].axis),d[c].component.setDock(d[c].axis.getOppositeDock()),f.push(d[c].axis),e.push(d[c].data));b.refLines&&b.refLines.component&&(b.refLines.component.setAxes([b.axes.axis.component]),b.refLines.component.setData([a.refLine.refLines]))},isValid:function(a){var b,c=!1;c=!!a&&!!a.qHyperCube&&a.qHyperCube.qMeasureInfo.length&&!a.qHyperCube.qMeasureInfo.some(function(a){return!!a.qError});for(b in this.components)this.components[b].setHasValidData(c);return c},updateAxis:function(a){var b,c,d,e,f,g,h=a.measureAxis,i=this.components.axis;b=Math.min.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),c=Math.max.apply(this,a.qHyperCube.qMeasureInfo.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax})),f=a.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle}).join(", "),i.setData(a),i.setTitle(f),i.setShowStrategy(h.show),i.setLabelMode(h.label),i.setOrientation("bar"===this._type?this._orientation:"horizontal"),i.setPlotMin&&(g=this.getAxisOptions(h),i.setPlotMin(g.min),i.setPlotMax(g.max),i.setTickMultiplier(h.spacing),i.setLogScale(h.logarithmic)),b===c&&0===c&&(c=1,b=0),c=Math.max(0,c),b=Math.min(0,b),this.setAxisDataRange(i,c,b,g.max,g.min,1),d=-Math.PI*(a.angle+.5),e=Math.PI*(a.angle-.5),e+=0>d?2*Math.PI:0,d+=0>d?2*Math.PI:0,this.components.axis.setRadial("radial"===this._type,{start:d,end:e})},getAxisOptions:function(a){return a?{min:Number(a.min),max:Number(a.max)}:void 0},setAxisDataRange:function(a,b,c,d,e,f){null!==d&&null!==e||null===d&&null===e?a.setDataRange(c,b):null!==d&&c>=d?a.setDataRange(d-f,b):null!==e&&e>=b?a.setDataRange(c,e+f):a.setDataRange(c,b)},_paint:function(){var a,b=[];if(!this.isValid(this._data))return this.clear();if(this._super(),this.layout(),this.$scope.dataAttributes.popupDisclaimer){var c=this._data.disclaimerClosed||this._data.maxMinChanged;!j.isInEditMode()||this._layoutMode<7||c?this.$scope.dataAttributes.popupDisclaimer.show=!1:this.$scope.dataAttributes.popupDisclaimer.show=!0}for(a in this.components)b.push(this.components[a].invalidateDisplay());return d.all(b)},layout:function(){var a=this.components.axis,b=a.updateSize;a.updateSize=function(){},this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect),a.updateSize=b,this._data&&this._data.autoOrientation&&"bar"===this._data.gaugetype&&(this._orientation=this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal",this.components.axis.setOrientation(this._orientation)),a.preRelevantSizeCalculation(),a.calculatePreliminaryRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),a.calculateRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),this.components.axis.isRadial()||o.call(this),a.updateSize()}}),{type:"gauge",BackendApi:k,template:l,View:p,definition:m,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:1,qHeight:1}],qSuppressMissing:!0},segmentInfo:{limits:[],colors:[{color:3}]}},data:{measures:{min:1,max:1}},snapshot:{canTakeSnapshot:!0},getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()},importProperties:n.axisChart.importProperties.bind(n),exportProperties:n.axisChart.exportProperties.bind(n)}}),define("text!extensions.qliktech/kpi/kpi.ng.html",[],function(){return'<div qv-extension class="kpi qv-viz" qva-activate="onShowVerifyDialog()" ng-class="{link : linkInteractionOn && interactionOn}">\r\n	<div ng-show="baseLayoutInfo.components[0].show" class="measure-wrapper" ng-class="textAlign" ng-style="measureTitleStyle">\r\n		<div class="measure-title ellips-text" title="{{measureTitle}}">\r\n			<span ng-bind="measureTitle"></span>\r\n			<i class="icon-info" ng-if="linkInteractionOn" title="{{sheetLinkTitle}}"></i>\r\n		</div>\r\n	</div>\r\n	<div class="value-wrapper" ng-class="textAlign">\r\n		<div class="ellips-text">\r\n			<qv-kpi-value value="mainValue.value" formatted-value="mainValue.formattedValue" value-style="mainValue.style" formatter="mainValue.formatter" glyph="mainValue.glyph" show-glyph="mainValue.showGlyph" />\r\n		</div>\r\n		<div ng-show="baseLayoutInfo.components[1].components[1].components[0].show" class="secondary-wrapper ellips-text" ng-repeat="secondaryValue in secondaryValues">\r\n			<qv-kpi-value value="secondaryValue.value" formatted-value="secondaryValue.formattedValue" value-style="secondaryValue.style" title-style="secondaryValue.titleStyle" formatter="secondaryValue.formatter" glyph="secondaryValue.glyph" show-glyph="secondaryValue.showGlyph" measure-title="secondaryValue.measureTitle" />\r\n		</div>\r\n	</div>\r\n	<!--\r\n	<div ng-show="useViz" class="visualization">\r\n		<qv-object class="cell-content" model="viz.model" options="viz.options"></qv-object>\r\n	</div>\r\n	-->\r\n\r\n	<div class="click-again-overlay" ng-class="{show : showVerifyDialog}" ng-style="verifyDialogStyle" qva-activate="linkToSheet()">\r\n		<span q-translation="properties.kpi.verifyToGoSheet"></span>\r\n		<span class="sheetLinkTitle ellips-text" ng-bind="sheetLinkTitle"></span>\r\n	</div>\r\n\r\n</div>\r\n'}),define("extensions.qliktech/kpi/kpi-properties",[],function(){var a,b;a={uses:"data",addTranslation:"Visualization.Requirements.AddMeasure",items:{measures:{items:{conditionalColoringContainer:{type:"items",grouped:!0,items:{conditionalColoring:{type:"items",ref:"qDef.conditionalColoring",show:function(){return!0},items:{useConditionalColoring:{ref:"qDef.conditionalColoring.useConditionalColoring",component:"switch",type:"boolean",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],translation:"properties.kpi.conditionalColoring",defaultValue:!1,change:function(a){a.qDef.conditionalColoring&&a.qDef.conditionalColoring.useConditionalColoring&&1===a.qDef.conditionalColoring.segments.colors.length?a.qDef.conditionalColoring.segments.colors[0].color=a.qDef.conditionalColoring.singleColor:a.qDef.conditionalColoring.singleColor=a.qDef.conditionalColoring.segments.colors[0].color}},singleColorColoring:{component:"color-picker",translation:"properties.color",ref:"qDef.conditionalColoring.singleColor",type:"integer",defaultValue:3,show:function(a){return a.qDef.conditionalColoring&&!a.qDef.conditionalColoring.useConditionalColoring}},rangeLimits:{type:"items",items:{min:{ref:"qDef.measureAxis.min",translation:"properties.axis.min",type:"number"},max:{ref:"qDef.measureAxis.max",translation:"Common.Max",type:"number",defaultValue:100}},show:function(){return!1}},segmentInfo:{ref:"qDef.conditionalColoring.segments",type:"items",component:"color-scale-creator",conditionalColoringRef:{props:"qHyperCubeDef.qMeasures",layout:"qHyperCube.qMeasureInfo"},useGlyph:!0,useAutoMinMax:!0,show:function(a){return a.qDef.conditionalColoring.useConditionalColoring},items:{limits:{ref:"qDef.conditionalColoring.segments.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(a){return isNaN(a.value)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},colors:{type:"array",ref:"qDef.conditionalColoring.segments.colors",defaultValue:[{color:2}],items:{color:{ref:"color",component:"color-picker",translation:"properties.color",type:"integer",defaultValue:2},icon:{ref:"icon",type:"string",defaultValue:"",show:!1}}}}}}}}}}}}},b={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{showMeasureTitle:{ref:"showMeasureTitle",component:"checkbox",translation:"properties.ShowTitle",defaultValue:!0},textAlign:{ref:"textAlign",type:"string",component:"dropdown",translation:"properties.Alignment",options:[{value:"left",translation:"properties.dock.left"},{value:"center",translation:"Common.Center"},{value:"right",translation:"properties.dock.right"}],defaultValue:"center"},fontSize:{ref:"fontSize",type:"string",component:"dropdown",translation:"MediaTool.Toolbar.FontSize",options:[{value:"S",translation:"Common.Small"},{value:"M",translation:"Common.Medium"},{value:"L",translation:"Common.Large"}],defaultValue:"M"},linkToSheet:{type:"items",items:{useLink:{ref:"useLink",type:"boolean",component:"switch",translation:"properties.kpi.linkToSheet",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},kpiLink:{ref:"kpiLink",type:"items",component:"sheet-dropdown",items:{id:{ref:"kpiLink.id",type:"string"},title:{ref:"kpiLink.title",type:"string"}},show:function(a){return a.useLink}}}}}}}};var c={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:a,addons:c,settings:b}}}),define("extensions.qliktech/kpi/kpi-layout",["objects.views/charts/utils/canvas-renderer"],function(a){function b(a,b,c){var d,e=a.ratio?a.ratio:1,f=b/c;return d=a.direction===m.ROW?e>f?m.COLUMN:m.ROW:e>f?m.ROW:m.COLUMN}function c(a){if(!a.components||0===a.components.length)return a;var d,e,f,g,h,i=0,j=a.boundingBox.height,k=a.boundingBox.width,l=a.direction,n=b(a,j,k);for(a.components.forEach(function(a){a.direction=a.direction?a.direction:n,d=a.size.min?a.size.min:a.size?a.size:0,"function"==typeof a.isVisible&&!a.isVisible()||d*j<(a.size.treshold&&a.size.treshold.height?a.size.treshold.height:10)||k<(a.size.treshold&&a.size.treshold.width?a.size.treshold.width:10)?a.show=!1:(i+=d,a.show=!0)}),f=a.components.length-1;f>=0;f--)g=a.components[f],1>i?g.size.stretch&&(g.size.value=g.size.min+(1-i)):g.size.value=null;return a.components.forEach(function(a){e=a.size.value?a.size.value:a.size.min?a.size.min:a.size,h={},l===m.ROW?(h.height=j,h.width=k*e):(h.width=k,h.height=j*e),a.boundingBox=h}),a.components.forEach(function(a){c(a)}),a}function d(a,b,c,g,h,i){var j,m,n;m=a.boundingBox.width,n=a.boundingBox.height,a.components&&a.components.forEach(function(b){d(b,a,m,n,h,i)}),"function"==typeof a.getText&&(h===l.MAX?j=f(a.getText(),m,n):h===l.SCALE&&(j=e(a,m,n)),i===k.ADJUSTTOTEXT&&(a.boundingBox={height:j.height,width:j.width}),a.fontSizes||(a.fontSizes={}),a.fontSizes.fontSize=10*j.fontSize+"%")}function e(a,b,c){if(!a.fontSizes)return{fontSize:"10px"};var d=a.getText(),e=a.fontSizes.min,g=a.fontSizes.max,h=a.fontSizes.maxNrChars,i=f(d,b,c,h),j=Math.min((c-e.height)/(g.height-e.height),1),k=e.fontSize+j*(g.fontSize-e.fontSize),l=Math.max(Math.min(i.fontSize,k),e.fontSize);return{fontSize:l}}function f(a,b,c,d){var e=d?d*j:g.getTextWidth(a,h),f=1.2*i,k=Math.min(b/e,c/f);return{fontSize:9*k}}var g=new a,h="10px 'QlikView Sans'",i=g.getFontHeight(h)+1,j=g.getTextWidth("M",h),k={NONE:0,ADJUSTTOTEXT:1},l={NONE:0,SCALE:1,MAX:2},m={ROW:"row",COLUMN:"column"},n={checkLayout:c,getDirection:b,sizeComponent:d,TextScaleMode:l,ElementScaleMode:k,Direction:m};return n}),define("client.utils/routing",["general.controllers/route-controller","util"],function(a,b){"use strict";var c={getUrlForSheet:function(c,d,e){var f=["sheet",c,"state",d];return e&&f.splice(0,0,!0,"sense","app",b.getParameterByName("app")),a.buildUrl.apply(a,f)},goToOverview:function(){a.setUrl(a.buildUrl())},goToDataSpace:function(){a.setUrl(a.buildUrl("data"))},goToSheet:function(b,d){a.setUrl(c.getUrlForSheet(b,d,!1))},goToStory:function(b,c,d){var e=["story",b,"state",c];d&&e.push("slide",d),a.setUrl(a.buildUrl.apply(a,e))}};return c}),define("client.models/sheet",["jquery","core.models/generic-object","general.utils/visualizations","util","core.utils/deferred"],function(a,b,c,d,e){"use strict";function f(a,b){var c,d;for(c=0;c<a.cells.length;++c)if(d=a.cells[c],d.col===b.col&&d.row===b.row)return c;return-1}function g(a,b,c){var d=f(a,b);if(-1===d){if(c)return null;throw new Error("invalid pos")}return a.cells[d]}function h(a,b){a.col=b.col,a.row=b.row,a.colspan=b.colspan,a.rowspan=b.rowspan}function i(a,b,c,d){var e=g(a,b,!0),f=e?e.name:null;return e?(e.name=c,e.type=d):a.cells.push({name:c,type:d,col:b.col,row:b.row,colspan:b.colspan,rowspan:b.rowspan}),f}function j(a,b){var c={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan},d={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan};if("left"===b||"right"===b){var e=Math.ceil(a.colspan/2);c.colspan-=e,d.col+=a.colspan-e,d.colspan=e}if("top"===b||"bottom"===b){var f=Math.ceil(a.rowspan/2);c.rowspan-=f,d.row+=a.rowspan-f,d.rowspan=f}if("top"===b||"left"===b){var g=c;c=d,d=g}return{pos1:c,pos2:d}}function k(a,b,c){var d=g(a,b,!1);if(!d||d.colspan!==b.colspan||d.rowspan!==b.rowspan)return!1;var e=j(d,c);return h(d,e.pos1),e.pos2}function l(a,b){return b.filter(function(b){return b.name===a})[0]}function m(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.qInfo.qId=d.generateId(),a.qChildren.push({qChildren:[],qProperty:e})}}var n;return n=b.extend("Sheet",{edit:function(a){var b=this;return b.getProperties().then(function(c){return a(c),b.save()})},getObject:function(a,b){return this.getLayout().then(function(c){return g(c,a,b)})},moveObject:function(a,b){return this.edit(function(c){var d=g(c,a);return b.split&&(b=k(c,b.pos,b.split),!b)?e.reject():void h(d,b)})},swapObjects:function(a,b){return this.edit(function(c){var d=g(c,a),e=g(c,b,!0);h(d,b),e&&h(e,a)})},addObject:function(a){var b,f=this,g=a.template,h=a.cell.pos,j=c.getType(g),l=a.init,n=a.children||[];return b=l.qExtendsId?e.resolve(d.extend({qInfo:{qType:g}},l)):j.getInitialProperties(l),e.all({initProps:b,props:f.getFullPropertyTree()}).then(function(a){var b=a.initProps,c=a.props;if(h.split&&(h=k(c.qProperty,h.pos,h.split),!h))return e.reject();b.qInfo.qId=d.generateId();var g=i(c.qProperty,h,b.qInfo.qId,b.qInfo.qType);if(g){for(var j=0;j<c.qChildren.length;j++)if(c.qChildren[j].qProperty.qInfo.qId===g){c.qChildren[j].qProperty=b,c.qChildren[j].qChildren=[],m(c.qChildren[j],n);break}}else{var l=c.qChildren.push({qChildren:[],qProperty:b});m(c.qChildren[l-1],n)}return f.saveTree()})},getObjectById:function(a){var b,c,d=this.layout.cells;for(b=0;b<d.length;++b)if(c=d[b],a===c.name)return c;return null},removeObject:function(a){var b=this;return b.getProperties().then(function(c){var d=f(c,a),e=c.cells[d].name;if(-1===d)throw new Error("invalid pos");c.cells.splice(d,1),b.removeChild(e,c)})},setCloneChildrenInfos:function(a){var b=this;return e.all([b.getChildInfos(),a.getChildInfos(),a.getProperties()]).then(function(b){var c=b[0],d=b[1],e=b[2];return c.forEach(function(a,b){var c=l(a.qId,e.cells);c&&(c.name=d[b].qId)}),a.save().then(function(){return a})})},clone:function(){var a=this;return this._super().then(function(b){return a.setCloneChildrenInfos(b)})},draft:function(a){var b=this;return a.rpc("CreateDraft","qDraftId",[this.id]).then(function(a){return n.get(a).then(function(a){return b.setCloneChildrenInfos(a)})})}},{listProperties:{qAppObjectListDef:{qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}}}),n.create=function(c,d){var e={version:.96,qMetaDef:{title:"",description:""},rank:-1,thumbnail:{qStaticContentUrlDef:null},columns:24,rows:12,cells:[]};return b.create.call(n,a.extend(!0,e,c),d)},n.splitPos=j,n}),define("text!extensions.qliktech/kpi/value.ng.html",[],function(){return'<div class="ellips-text">\r\n	<div class="kpi-value" ng-style="valueStyle">\r\n		<div class="ellips-text">\r\n			<span ng-bind="currentFormattedValue" title="{{currentFormattedValue}}"></span>\r\n		</div>\r\n		<div class="glyph-wrapper">\r\n			<span class="kpi-icon" ng-bind="glyph" ng-if="showGlyph"></span>\r\n		</div>\r\n	</div>\r\n	<div class="kpi-title ellips-text" ng-style="titleStyle" ng-bind="measureTitle"></div>\r\n</div>'}),define("extensions.qliktech/kpi/value",["qvangular","text!./value.ng.html","util","objects.views/charts/utils/tween"],function(a,b,c,d){a.directive("qvKpiValue",[function(){return{replace:!0,template:b,restrict:"E",scope:{value:"=",formattedValue:"=",valueStyle:"=",formatter:"=",glyph:"=",showGlyph:"=",measureTitle:"=",titleStyle:"="},link:function(a){var b=function(b,c,e,f){new d(b,{currentValue:c},400).progress(function(){b.currentFormattedValue=f?f.formatValue(b.currentValue):b.currentValue,a.$digest()}).then(function(){b.currentFormattedValue="U"!==f.type?e:f.formatValue(b.currentValue)})},e=function(){a.formattedValue&&("U"===a.formatter.type?(a.tweenFormatter||(a.tweenFormatter=a.formatter.clone()),a.tweenFormatter.pattern=f(a.formattedValue,!0),a.tweenFormatter.prepare(),b(a,a.value,a.formattedValue,a.tweenFormatter)):b(a,a.value,a.formattedValue,a.formatter))},f=function(a,b){var d,e,f="0",g=a.match(/(?:-?\d+)([^\d](?=\d))/),h=g?g[1]:"",i=0;if(h&&(e=new RegExp("(?:"+c.escapeRegExp(h)+")(\\d+)"),g=a.match(e),i=g?g[1].length:0),i)for(f+=h,d=0;i>d;d++)f+="0";return b&&(f+="A"),f};a.$watchCollection("[formattedValue,formatter]",function(){e()})}}}])}),define("extensions.qliktech/kpi/kpi",["jquery","qvangular","translator","objects.extension/default-view","objects.backend-api/hypercube-api","text!./kpi.ng.html","extensions.qliktech/kpi/kpi-properties","objects.views/charts/utils/chart-formatting","client.property-panel/components/color-scale-creator/color-scale-creator-utils","core.utils/deferred","objects.models/visualization-object","extensions.qliktech/kpi/kpi-layout","client.utils/routing","client.models/sheet","objects.extension/object-conversion","extensions.qliktech/kpi/value"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";var p,q=b.getService("$timeout");return p=d.extend("kpi",{namespace:".kpi",init:function(a,d,e,f){this._super(a,d,e,f),this._$element=d,this.$scope.mainValueStyle={},this.$scope.measureTitleStyle={},this.$scope.viz={},this.$scope.secondaryValues=[],this.$scope.secondaryLayouts=[],this.$scope.showSecondaryValues=!1,this.$scope.mainValue={formattedValue:"",value:null,style:null},a.showVerifyDialog=!1,a.onShowVerifyDialog=function(){a.linkInteractionOn&&(b.$apply(a,function(){a.showVerifyDialog=!0,a.updateVerifyDialogFontSize()}),q(function(){b.$apply(a,function(){a.showVerifyDialog=!1})},2500))},a.linkToSheet=function(){a.linkInteractionOn&&window.open(m.getUrlForSheet(a.layout.kpiLink.id,"analysis"))},a.updateVerifyDialogFontSize=function(){if(a.showVerifyDialog){var b=a.verifyDialogLayoutInfo.components[0];l.checkLayout(a.verifyDialogLayoutInfo),l.sizeComponent(b,a.verifyDialogLayoutInfo,a.verifyDialogLayoutInfo.boundingBox.width,a.verifyDialogLayoutInfo.boundingBox.height,l.TextScaleMode.SCALE,l.ElementScaleMode.NONE),a.verifyDialogStyle={fontSize:b.fontSizes.fontSize}}};var g=this;this.$scope.baseLayoutInfo={direction:l.Direction.COLUMN,ratio:1e9,boundingBox:{width:d.width(),height:d.height()},components:[{size:{min:.2,treshold:{width:150,height:12}},getText:function(){return a.measureTitle},fontSizes:{maxNrChars:15,min:{fontSize:10,height:15},max:{fontSize:40,height:80}},isVisible:function(){return a.showMeasureTitle}},{size:{min:.8,stretch:!0},ratio:1,components:[{size:{min:.5,stretch:!0},getText:function(){return g.$scope.mainValue.formattedValue+(g.$scope.mainValue.glyph?g.$scope.mainValue.glyph:"")},fontSizes:{maxNrChars:4,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:.5,components:this.$scope.secondaryLayouts,isVisible:function(){return g.$scope.secondaryLayouts.length>0}}]}]},this.$scope.secondaryLayoutInfo={size:{min:1,treshold:{width:100,height:30}},direction:l.Direction.COLUMN,components:[{size:{min:.6,stretch:!0},fontSizes:{maxNrChars:8,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:{min:.4},fontSizes:{maxNrChars:15,min:{fontSize:10,height:20},max:{fontSize:30,height:500}}}]},this.$scope.verifyDialogLayoutInfo={size:{min:1,width:20,height:20},boundingBox:{width:0,height:0},components:[{size:{min:.2,treshold:{width:100,height:100}},getText:function(){return c.get("properties.kpi.verifyToGoSheet")},fontSizes:{maxNrChars:16,min:{fontSize:10,height:20},max:{fontSize:13,height:50}}}]}},isValid:function(a){return!!a&&!!a.qHyperCube&&a.qHyperCube.qMeasureInfo.length&&!a.qHyperCube.qMeasureInfo.some(function(a){return!!a.qError})},updateData:function(a){if(this.isValid(a)){this._data=a;var b,c,d,e,f,g,h,i=a.qHyperCube.qDataPages[0].qMatrix[0],j=a.qHyperCube.qMeasureInfo.length,k=j-1,l=this.getFormatterForMeasures(a.qHyperCube.qMeasureInfo.length),m=this.$scope.secondaryValues,o=this.$scope.secondaryLayouts,p=this,q=function(){
return e},r=function(){return g};for(this.$scope.useViz=a.useViz,this.$scope.showMeasureTitle=a.showMeasureTitle,this.$scope.textAlign=a.textAlign,this.$scope.baseLayoutInfo.components[1].components[0].fontSizes.maxNrChars="S"===a.fontSize?7:"L"===a.fontSize?3:4,this.$scope.useLink=a.useLink,a.useLink&&a.kpiLink&&n.get(a.kpiLink.id).then(function(b){b.getLayout().then(function(b){a.kpiLink.title=b&&b.qMeta?b.qMeta.title:"",p.$scope.sheetLinkTitle=a.kpiLink?a.kpiLink.title:""})}),this.$scope.mainValue.value=a.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,this.$scope.mainValue.formattedValue="U"!==l[0].type?a.qHyperCube.qDataPages[0].qMatrix[0][0].qText:l[0].formatValue(this.$scope.mainValue.value),this.$scope.mainValue.formatter=l[0],h=0;k>h;h++)d=i[h+1].qText,f=i[h+1].qNum,e="U"!==l[h+1].type?d:l[h+1].formatValue(f),g=a.qHyperCube.qMeasureInfo[h+1].qFallbackTitle,m[h]||(c=this.createSecondaryValue(q,r),b={style:c.layoutInfo.components[0].fontSizes.value,titleStyle:c.layoutInfo.components[1].fontSizes.value},m.push(b),o.push(c.layoutInfo)),b=m[h],b.value=f,b.formattedValue=e,b.formatter=l[h+1],b.measureTitle=g,o[h].components[0].fontSizes.maxNrChars="S"===a.fontSize?14:"L"===a.fontSize?6:8;m.length>k&&(o.splice(k,m.length-k),m.splice(k,m.length-k)),this.$scope.measureTitle=a.qHyperCube.qMeasureInfo[0].qFallbackTitle,this.$scope.showSecondaryValues=m.length>0,a.useViz&&(this._vizCreated?!this._vizBound&&a.qChildList&&a.qChildList.qItems&&(this.bindVisualization(a.qChildList.qItems[0]),this._vizBound=!0):(this.createVisualization(a.vizType),this._vizCreated=!0))}},updateStyles:function(){if(this._data){var a,b,c=this,d=this._data,e=function(a,b){var c=d.qHyperCube.qMeasureInfo[b].conditionalColoring,e=d.qHyperCube.qMeasureInfo[b].measureAxis,f=(a-e.min)/(e.max-e.min),g=i.getSegmentIndex(c,a,e.min),h=c.segments.colors[g]?c.segments.colors[g].icon:"",j=c.useConditionalColoring?i.shouldBlend(c.segments,g)?i.blendValue(c.segments,f,e.min,e.max):i.resolveColor(c.segments.colors[g].color):i.resolveColor(c.singleColor);return{color:j,icon:h,useCondColor:c.useConditionalColoring}};this.$scope.linkInteractionOn=this.$scope.interactionOn&&this.$scope.layout.useLink&&this.$scope.layout.kpiLink&&this.$scope.layout.kpiLink.id,this.$scope.verifyDialogLayoutInfo.boundingBox.width=this._$element.width(),this.$scope.verifyDialogLayoutInfo.boundingBox.height=this._$element.height(),this.$scope.baseLayoutInfo.boundingBox=this.getBoundingBox(),l.checkLayout(this.$scope.baseLayoutInfo),this.$scope.baseLayoutInfo.components.forEach(function(a){var b=c.backendApi.isSnapshot&&c._data&&!c._data.snapshotData.object.freeResize,d=b?c._data.snapshotData.isZoomed:c.options.isZoomed;l.sizeComponent(a,c.$scope.baseLayoutInfo,c.$scope.baseLayoutInfo.boundingBox.width,c.$scope.baseLayoutInfo.boundingBox.height,0===c.$scope.secondaryValues.length&&d?l.TextScaleMode.MAX:l.TextScaleMode.SCALE,0===c.$scope.secondaryValues.length&&d?l.ElementScaleMode.ADJUSTTOTEXT:l.ElementScaleMode.NONE)}),b=e(this.$scope.mainValue.value,0),this.$scope.mainValue.glyph=b.icon,this.$scope.mainValue.showGlyph=b.useCondColor&&b.icon&&""!==b.icon,a=this.$scope.baseLayoutInfo.components[1].components[0],this.$scope.mainValue.style={color:b.color,fontSize:a.fontSizes.fontSize},a=this.$scope.baseLayoutInfo.components[0],this.$scope.measureTitleStyle={fontSize:a.fontSizes.fontSize};for(var f=1;f<d.qHyperCube.qMeasureInfo.length;f++)a=this.$scope.baseLayoutInfo.components[1].components[1].components[f-1].components[0],b=e(this.$scope.secondaryValues[f-1].value,f),this.$scope.secondaryValues[f-1].style={color:b.color,fontSize:a.fontSizes.fontSize},a=this.$scope.baseLayoutInfo.components[1].components[1].components[f-1].components[1],this.$scope.secondaryValues[f-1].titleStyle={fontSize:a.fontSizes.fontSize},this.$scope.secondaryValues[f-1].glyph=b.icon,this.$scope.secondaryValues[f-1].showGlyph=b.useCondColor&&b.icon&&""!==b.icon;this.$scope.updateVerifyDialogFontSize();var g=j();return q(function(){g.resolve()},0,!1),g.promise}},bindVisualization:function(a){var b=this;k.get(a.qInfo.qId).then(function(a){b.$scope.viz.model=a})},createSecondaryValue:function(b,c){var d=a.extend({},this.$scope.secondaryLayoutInfo);return d.components[0].getText=b,d.components[1].getText=c,{layoutInfo:d,text:b()}},paint:function(){return this.updateStyles()},resize:function(a,b){this.paint(a,b)},getFormatterForMeasures:function(a){for(var b,c,d=this._data,e=new h(this.backendApi.localeInfo,d.qHyperCube.qMeasureInfo),f=[],g=0;a>g;g++)b=d.qHyperCube.qMeasureInfo[g],c=e.getMeasureFormatter(g),"U"===c.type&&(c.pattern=c.createPatternFromRange(b.qMax,b.qMax,!0),Math.floor(Math.log(Math.abs(b.qMax))/Math.log(10))%3===2&&(c.pattern=c.pattern.substr(0,c.pattern.length-2),c.pattern+="A")),c.prepare(),f.push(c);return f},on:function(){this.$scope.interactionOn=!0,this._super(),this.updateStyles()},off:function(){this.$scope.interactionOn=!1,this._super(),this.updateStyles()},getBoundingBox:function(){var a=this.backendApi.isSnapshot&&this._data&&!this._data.snapshotData.object.freeResize;return a&&this._data.snapshotData.elementRatio?{width:this._data.snapshotData.object.size.w,height:this._data.snapshotData.object.size.w*this._data.snapshotData.elementRatio}:{width:this._$element.width(),height:this._$element.height()}},setSnapshotData:function(a){this._super(),a.snapshotData.isZoomed=this.options.isZoomed,a.snapshotData.elementRatio=this._$element.height()/this._$element.width()}}),{type:"kpi",BackendApi:e,template:f,View:p,definition:g,initialProperties:{version:1,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:500,qHeight:10}],qSuppressMissing:!0},showTitles:!1},data:{measures:{min:1,max:2}},snapshot:{canTakeSnapshot:!0},getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()},importProperties:function(a,b,c){var d,e,f,g=o.hypercube.importProperties.apply(o,[a,b,c]),h=g.qProperty,i=h.qHyperCubeDef,j=i.qMeasures,k=i.qLayoutExclude,l=k?k.qHyperCubeDef:void 0,m=l?l.qMeasures:void 0,n=[];for(j&&(n=n.concat(j)),m&&(n=n.concat(m)),d=n.length,e=0;d>e;e++)f=n[e].qDef,f.measureAxis||(f.measureAxis={min:0,max:100}),f.conditionalColoring||(f.conditionalColoring={useConditionalColoring:!1,singleColor:3,segments:{limits:[],colors:[{color:2}]}});return g},exportProperties:o.hypercube.exportProperties.bind(o)}}),define("objects.backend-api/map-api",["./backend-api","core.models/app"],function(a,b){"use strict";var c;return c=a.extend("MapApi",{init:function(a){this._super(a)},select:function(a,b,c,d){return b?this.model.rpc(a,null,[b,c,d]):void 0},select2:function(a,b,c,d){return b?this.model.rpc(a,null,[b,c,d]):void 0},selectRange:function(a,b,c){if(!(this.path.indexOf("qHyperCubeDef")<0)){var d,e=this.path.replace("/geodata","");return b=!!b,c=c||[0],d=a.map(function(a){return{qMeasureIx:a.measure,qRange:{qMin:a.range.min,qMax:a.range.max,qMinInclEq:a.range.minInclEq!==!1,qMaxInclEq:a.range.maxInclEq!==!1}}}),this.model.rpc("RangeSelectHyperCubeValues",null,[e,d,c,b])}},updateCache:function(){},setInitialData:function(){},getData:function(a,b,c){return this.model.rpc(a,null,[b,c])},evaluateExpression:function(a){return b.current.evaluateExpression(a)},getSize:function(){var a=this.model.layout,b=a.qListObject?a.qListObject:a.layers[0].qListObject;return b.qSize},isLocked:function(){var a=this.model.layout,b=a&&a.layers&&a.layers[0]&&a.layers[0].qListObject?a.layers[0].qListObject:null;return b&&b.qDimensionInfo.qLocked?!0:!1},getDimensionInfos:function(){var a=this.model.layout,b=a.qListObject?a.qListObject:a.layers[0].qListObject;return[b.qDimensionInfo]},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},beginSelections:function(){var a,c,d,e=this.model,f=[];for(a=0;a<e.layout.layers.length;++a)if(c="/layers/"+a+"/","polygon"===e.layout.layers[a].type&&"3"===e.layout.layers[a].version)d=c+"geodata/",c+="qHyperCubeDef",d+="qHyperCubeDef",f.push(c),f.push(d);else{if(e.layout.layers[a].qHyperCube)c+="qHyperCubeDef";else{if(!e.layout.layers[a].qListObject)continue;c+="qListObjectDef"}f.push(c)}return b.current.switchModal(e,f)}})}),define("text!extensions.qliktech/map/map.ng.html",[],function(){return'	<div qv-extension\r\n        class="qv-viz">\r\n	</div>\r\n<div qva-scatter-navigation>\r\n	</div>\r\n<div qva-chart-disclaimer options="dataAttributes" visible="true"></div>'}),define("text!general.services/media-tool/media-tool.ng.html",[],function(){return'<div class="qv-st-container">\r\n	<form class="qv-st-form">\r\n		<textarea class="qv-st-instance">{{data}}</textarea>\r\n	</form>\r\n</div>'}),define("general.services/media-tool/theme",[],function(){var a=["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],b={1:"XS",2:"S",3:"M",4:"L",5:"XL"},c={10:"1",13:"2",16:"3",22:"4",32:"5"},d={1:1,2:2,3:3,4:4,5:5,6:5},e={1:1,2:2,3:3,4:4,5:5};return{palette:a,fontSizes:b,fontSizesPx:c,htmlSizeToMarkdownSize:d,markdownSizeToHtmlSize:e}}),define("text!general.services/media-tool/toolbar.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" position="\'top\'" collision="\'collision\'" width="options.width" height="48" class="qui-immidiateContextual qv-texttool-toolbar"\r\n					  on-close-view="closeToolbar(event)" ondragstart="return false">\r\n\r\n	<div ng-if="textTool.showUsage" class="usage"><span q-translation="MediaTool.YouHaveUsed"></span> <span>{{textTool.usage}}%</span></div>\r\n\r\n	<div id="qv-toolbar-colorpicker" tid="colorpicker" q-title-translation="MediaTool.Toolbar.FontColor">\r\n		<div qv-color-picker-button on-close="closecolorpickerfoldout(event)" ng-model="color" ng-show="buttons.color" ng-disabled="!haveSelection()"></div>\r\n	</div>\r\n\r\n	<button id="qv-toolbar-fontsize" qva-activate="setActiveFoldout(\'fontSizes\',$event)" ng-show="buttons.fontSize" tid="fontSize" ng-disabled="!haveSelection()"\r\n			ng-class="{\'qui-active\':foldouts.fontSizes}" q-title-translation="MediaTool.Toolbar.FontSize" class="qui-button">\r\n		{{shortFontSize(textTool.fontSize)}}\r\n		<i class="text-size-arrow icon-triangle-bottom"></i>\r\n	</button>\r\n	<immidiate-contextual ng-if="foldouts.fontSizes" width="48" align-to="\'#qv-toolbar-fontsize\'" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFontsizeFoldout(event)">\r\n		<ul class="qui-icontextlist qv-media-tool-fontsize">\r\n			<li ng-repeat="size in fontSizes" qva-activate="setFontSize($event, size)" ng-class="{\'active\':textTool.fontSize == size}"><span class="qui-textlist-text">{{shortFontSize(size)}}</span></li>\r\n		</ul>\r\n	</immidiate-contextual>\r\n\r\n	<div class="qui-buttongroup" ng-show="buttonGroup1">\r\n		<div ng-class="{\'qui-active\':textTool.states.bold}" ng-show="buttons.bold" tid="bold" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Bold" class="qui-button" data-icon="toolbar-bold" qva-press="exec($event,\'bold\')"></div>\r\n		<div ng-class="{\'qui-active\':textTool.states.italic}"  ng-show="buttons.italic" tid="italic" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Italic" class="qui-button" data-icon="toolbar-cursive" qva-press="exec($event,\'italic\')"></div>\r\n		<div ng-class="{\'qui-active\':textTool.states.underline}"  ng-show="buttons.underline" tid="underline" ng-disabled="!haveSelection()"\r\n				q-title-translation="MediaTool.Toolbar.Underline" class="qui-button" data-icon="toolbar-underline" qva-press="exec($event,\'underline\')"></div>\r\n	</div>\r\n\r\n	<div class="qui-buttongroup" ng-show="buttonGroup2">\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyLeft}" ng-show="buttons.justifyLeft" tid="justifyLeft"\r\n				class="qui-button" q-title-translation="Common.Text.AlignLeft" data-icon="toolbar-left" qva-activate="exec($event,\'justifyLeft\')"></button>\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyCenter}" ng-show="buttons.justifyCenter" tid="justifyCenter"\r\n				class="qui-button" q-title-translation="Common.Text.AlignCenter" data-icon="toolbar-center" qva-activate="exec($event,\'justifyCenter\')"></button>\r\n		<button ng-class="{\'qui-active\':textTool.states.justifyRight}" ng-show="buttons.justifyRight" tid="justifyRight"\r\n				class="qui-button" q-title-translation="Common.Text.AlignRight" data-icon="toolbar-right" qva-activate="exec($event,\'justifyRight\')"></button>\r\n	</div>\r\n\r\n	<button id="qv-toolbar-link" qva-activate="openLinkFoldout($event)" ng-show="buttons.link" tid="link"\r\n			ng-class="{\'qui-active\':foldouts.link}" class="qui-button" q-title-translation="{{ textTool.states.link ? \'MediaTool.Toolbar.EditURLLink\' : \'MediaTool.Toolbar.CreateURLLink\' }}"\r\n			ng-disabled="linkDisabled()">\r\n		<i class="icon-link" ng-class="{\'active\':textTool.states.link}"></i>\r\n		<i class="icon-triangle-bottom"></i>\r\n	</button>\r\n\r\n	<button id="qv-toolbar-image" qva-activate="openMediaLibrary($event)" ng-class="{\'qui-active\':foldouts.mediaLibrary}" ng-show="buttons.image" tid="image"\r\n			class="qui-button" q-title-translation="MediaTool.Toolbar.InsertImage" data-icon="image"></button>\r\n\r\n</immidiate-contextual>'}),define("general.services/media-tool/text-selection",[],function(){function a(){return window.getSelection()}var b={};return b.createRange=function(a,b,c){var d=document.createRange();return b=b||0,c="undefined"==typeof c?a.childNodes.length:c,d.setStart(a,b),d.setEnd(a,c),d},b.createRangeForElement=function(a){var b=document.createRange();return b.selectNode(a),b},b.addRange=function(b,c){var d=a();c&&d.removeAllRanges(),d.addRange(b)},b.getRange=function(b){var c=window.getSelection();return b=b||0,c.rangeCount>b?a().getRangeAt(b):null},b.rangeEquals=function(a,b){return null===a&&null===b?!0:null===a||null===b?!1:0===a.compareBoundaryPoints(window.Range.START_TO_START,b)&&0===a.compareBoundaryPoints(window.Range.END_TO_END,b)},b}),define("text!general.services/media-tool/link-foldout/link-foldout.ng.html",[],function(){return'<immidiate-contextual width="400" align-to="options.alignTo" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFoldout(event)"\r\n					  class="qv-link-foldout qui-immidiateContextual" tid="link-foldout">\r\n\r\n	<div class="link-header">\r\n		<h1 class="link-header-text" ng-if="linkActive" q-translation="MediaTool.Toolbar.InsertUrlLink.Title"></h1>\r\n		<h1 class="link-header-text" ng-if="!linkActive" q-translation="Common.Bookmarks"></h1>\r\n		<div class="link-submenu" ng-if="inStorytelling()">\r\n			<ul>\r\n				<li class="qui-outlinebutton" ng-if="!linkActive" qva-activate="toggleLink(true)" q-translation="Common.URL" ></li>\r\n				<li class="qui-outlinebutton" ng-if="linkActive" qva-activate="toggleLink(false)" q-translation="Common.Bookmarks" ></li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n\r\n	<div class="link-content" ng-if="linkActive">\r\n		<span class="link-label" q-translation="MediaTool.Toolbar.InsertUrlLink.Label"></span>\r\n		<input class="link-input qui-input" maxlength="255" ng-model="link.url" style="margin-bottom: 10px" qv-enter="onEnter($event)"/>\r\n		<div class="link-remove-container" ng-if="showRemove">\r\n			<button class="link-remove qui-button" data-icon="bin" qva-activate="removeLink($event)" q-title-translation="MediaTool.Toolbar.RemoveLink"></button>\r\n		</div>\r\n	</div>\r\n	<div class="bookmark-content" ng-if="!linkActive">\r\n		<ul>\r\n			<li ng-if="bookmarks.length < 1" class="bookmark-link-row">\r\n				<span class="bookmark-link-row-content no-bookmarks" q-translation="Bookmarks.NoBookmarks"></span>\r\n			</li>\r\n			<li class="bookmark-link-row" ng-repeat="bookmark in bookmarks" ng-class="{ active: bookmark.active}">\r\n				<span class="bookmark-link-row-content" qva-activate="insertBookmark($event, bookmark.qInfo.qId)" data-bookmark-id="{{bookmark.qInfo.qId}}">{{bookmark.qData.title}}</span>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n<!--</div>-->\r\n</immidiate-contextual>'}),define("general.services/media-tool/link-foldout/link-foldout",["jquery","text!./link-foldout.ng.html","client.utils/state","client.models/bookmark"],function(a,b,c,d){var e={template:b,scope:{alignTo:"=",options:"="},controller:["$scope","$timeout","$element",function(b,e,f){function g(){!b.link.url&&b.link.bookmark?(b.toggleLink(!1),h()):b.toggleLink(!0)}function h(){d.getList().then(function(a){a.getLayout().then(function(a){b.bookmarks=a,i()})})}function i(){b.bookmarks.forEach(function(a){a.qInfo.qId===b.link.bookmark?a.active=!0:a.active=!1})}b.link=b.options.link,b.link.url&&"#"!==b.link.url||(b.link.url=""),b.link.url=decodeURIComponent(b.link.url);var j=b.link.url;b.alignTo=b.options.alignTo,b.linkActive=!0,b.closeFoldout=function(a){var c=encodeURI(b.link.url),d=b.link.$node;return b.closed=!0,c===j?void b.options.onCancel(a):void(c&&c.length>0&&-1===c.indexOf("javascript:")?(0!==c.search("[a-zA-Z0-9]+:")&&(c="http://"+c),b.options.onSave(a,c,d,{cmd:"createLink",formatter:"link"})):b.options.onCancel(a))},b.onEnter=function(a){b.closeFoldout(a)},b.showRemove=!!j,b.removeLink=function(a){b.options.onRemove(a,b.link.$node)},b.inStorytelling=function(){return c.state===c.States.editstory},b.insertBookmark=function(a,c){b.options.onSave(a,c,b.link.$node,{cmd:"createLink",formatter:"bookmark"})},b.toggleLink=function(c){b.linkActive=c,c&&setTimeout(function(){a(".link-input").focus()})},b.exposedApi.closing=function(){b.closed||b.closeFoldout()},b.$on("$destroy",function(){b.closed||b.closeFoldout()}),g(),b.$watch("linkActive",function(){b.linkActive&&h()}),e(function(){f.find(".link-input").focus()})}]};return e}),define("general.models/media-library",["core.models/base-object","util"],function(a,b){"use strict";function c(a,b,c){var d={name:a,type:b};return c&&(d.path=c.qUrl,d.pathDef=c.qUrlDef),"folder"===b&&(d.children=[]),d}function d(a,b){a=a.substring(1).split("/").reverse().slice(1).reverse();var d=b;return a.forEach(function(a){var b=!1;if(d.children.forEach(function(c){return c.name===a?(d=c,void(b=!0)):void 0}),!b){var e=c(a,"folder");d.children.push(e),d=e}}),d}function e(a){a.sort(function(a,b){return a.name.localeCompare(b.name)}).reverse(),a.sort(function(a,b){return"folder"===a.type&&"folder"!==b.type?-1:"folder"===a.type&&"folder"===b.type?a.name.localeCompare(b.name):"folder"!==a.type&&"folder"!==b.type?a.name.localeCompare(b.name):1}),a.forEach(function(a){"undefined"!=typeof a.children&&e(a.children)})}var f;return f=a.extend("MediaLibrary",{},{listProperties:{qMediaListDef:{}}}),f.addBasePath=function(a){return b.baseURI+".."+a},f.stripBasePath=function(a){return a=a.replace(b.baseURI,"").replace(/^\.\.\//i,"/"),a=a.replace(location.protocol+"//"+location.host,"")},f.createTree=function(a,b){b=(b||[]).join("|")||".+?";var g=c("/","folder"),h=new RegExp("\\.("+b+")$","i");return a.forEach(function(a){var b,e=a,i=e.qUrl;if(i=f.stripBasePath(i),b=decodeURIComponent((i+"").replace(/\+/g,"%20")),b=b.split("/").splice(-1)[0],b.match(h)){var j=decodeURIComponent(i).replace(/^(\/content\/default)|(\/content\/Default)/,"").replace(/^(^\/media\/([a-z0-9-])+\/([a-z0-9-])+\/)/,"/media/"),k=d(j,g);k.children.push(c(b,"file",e))}}),e(g.children),g},f}),define("text!general.components/media-library/media-library.ng.html",[],function(){return'<qv-modal-dialog qv-id="media-library-modal" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<main class="dm-main">\r\n		<p ng-if="rootEntry && !rootEntry.children.length" q-translation="MediaLibrary.NoFilesFound" class="no-files-found"></p>\r\n		<div class="entries" ng-if="rootEntry.children.length">\r\n			<ul>\r\n				<li qva-activate="entry.type === \'file\' && selectFile($event, entry.path, entry.pathDef)"\r\n					ng-class="{selected: selectedFile === entry.path, folder: entry.type === \'folder\', file: entry.type === \'file\'}"\r\n					ng-repeat="entry in rootEntry.children">\r\n					<a title="{{entry.name}}">\r\n						<i ng-if="entry.type === \'folder\'" class="icon-folder"></i>\r\n						<i ng-if="entry.type === \'file\'" class="icon-file"></i>\r\n						{{entry.name}}\r\n					</a>\r\n					<div ng-if="entry.children.length" ng-include="\'media-library-recursive.ng.html\'"></div>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n		<div class="preview" ng-if="rootEntry.children.length">\r\n			<img ng-if="previewFile" ng-src="{{previewFile}}" ng-class="{scale:scaleToFit}" qva-load="positionFile($event)" />\r\n			<p ng-if="!previewFile" q-translation="MediaLibrary.SelectAnImage"></p>\r\n		</div>\r\n	</main>\r\n\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="Common.Apply" qv-confirm-disabled="!selectedFile"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("text!general.components/media-library/media-library-recursive.ng.html",[],function(){return'<ul>\r\n	<li qva-activate="entry.type === \'file\' && selectFile($event, entry.path, entry.pathDef)"\r\n		ng-class="{selected: entry.type === \'file\' && selectedFile === entry.path, folder: entry.type === \'folder\', file: entry.type === \'file\'}"\r\n		ng-repeat="entry in entry.children">\r\n		<a title="{{entry.name}}">\r\n			<i ng-if="entry.type === \'folder\'" class="icon-folder"></i>\r\n			<i ng-if="entry.type === \'file\'" class="icon-file"></i>\r\n			{{entry.name}}\r\n		</a>\r\n		<div ng-if="entry.children.length" ng-include="\'media-library-recursive.ng.html\'"></div>\r\n	</li>\r\n</ul>\r\n'}),define("general.components/media-library/media-library",["jquery","qvangular","core.models/app","general.models/media-library","text!./media-library.ng.html","text!./media-library-recursive.ng.html","general.services/show-service/show-service"],function(a,b,c,d,e,f,g){function h(a){var b={onCancel:a.onCancel,onConfirm:a.onConfirm,selectedFile:a.selectedFile};g.show(m,b),l.isShown=!0}function i(){if(l.isShown){var b=a('[qv-id="media-library-modal"]');b.length&&b.scope().cancel()}}function j(){return l.isShown}var k=b.getService("$templateCache"),l={isShown:!1};k.put("media-library-recursive.ng.html",f);var m={template:e,controller:["$scope","$element",function(a){a.selectedFile=a.input.selectedFile||null,a.selectedFileDef=null,a.scaleToFit=!0,a.previewFile=a.selectedFile?d.addBasePath(a.selectedFile):null,a.selectFile=function(b,c,d){b.preventDefault(),b.stopPropagation(),a.selectedFile===c&&(c=null),a.setSelected(c,d)},a.setSelected=function(b,c){b=b||null;var e=b?d.addBasePath(b):null;a.selectedFile=b,a.selectedFileDef=c,a.previewFile=e},a.confirm=function(){a.input.onConfirm(a.selectedFile,a.selectedFileDef),a.destroyComponent()},a.cancel=function(){a.input.onCancel(),a.destroyComponent()},c.get().then(function(b){b.getMediaList().then(function(b){var c=d.createTree(b,["png","gif","jpg","jpeg"]);a.rootEntry=c})}),a.$on("$destroy",function(){l.isShown=!1})}]};return{show:h,hide:i,isShown:j}}),define("general.services/media-library/media-library",["general.components/media-library/media-library"],function(a){function b(b){a.show(b)}function c(){a.hide()}function d(){return a.isShown()}return{show:b,hide:c,isShown:d}}),define("general.services/media-tool/toolbar",["jquery","touche","text!./toolbar.ng.html","general.services/media-tool/theme","general.services/media-tool/text-selection","general.services/media-tool/link-foldout/link-foldout","general.services/media-library/media-library","general.services/show-service/show-service"],function(a,b,c,d,e,f,g,h){var i=d.palette,j=d.fontSizes,k={fontSizes:!1,link:!1,mediaLibrary:!1,colorpicker:!1},l={color:!0,fontSize:!0,bold:!0,italic:!0,underline:!0,justifyLeft:!0,justifyCenter:!0,justifyRight:!0,link:!0,image:!0},m={template:c,scope:{textTool:"=",options:"=",alignTo:"="},controller:["$scope","$timeout",function(c,m){c.palette=i,c.fontSizes=Object.keys(j),c.foldouts=k,"all"===c.options.buttons?(c.buttons=l,c.buttonGroup1=!0,c.buttonGroup2=!0):"object"==typeof c.options.buttons&&(c.buttons=c.options.buttons,c.buttonGroup1=c.buttons.bold||c.buttons.italic||c.buttons.underline,c.buttonGroup2=c.buttons.justifyLeft||c.buttons.justifyCenter||c.buttons.justifyRight),c.exec=function(a,d){a.preventDefault(),a.stopPropagation(),b.preventGestures(),0===d.indexOf("justify")?c.textTool.setJustify(d):c.haveSelection()&&c.textTool.setBIU(d)},c.setActiveFoldout=function(a){Object.keys(c.foldouts).forEach(function(b){b===a&&c.foldouts[b]?c.foldouts[b]=!1:c.foldouts[b]=b===a})},c.shortFontSize=function(a){return j[a]||a},c.openMediaLibrary=function(){c.textTool.saveRange(),c.setActiveFoldout("mediaLibrary"),g.show({onCancel:function(){c.setActiveFoldout(),c.textTool.restoreRange(),c.textTool.focus()},onConfirm:function(a,b){c.setActiveFoldout(),m(function(){b?c.textTool.insertImage(a,b):(c.textTool.restoreRange(),c.textTool.focus())},100)},selectedFile:null})},c.closeColorpickerFoldout=function(d){a(d.target).closest("#qv-toolbar-colorpicker").length&&b.preventGestures(),c.setActiveFoldout()},c.closeFontsizeFoldout=function(d){a(d.target).closest("#qv-toolbar-fontsize").length&&b.preventGestures(),c.setActiveFoldout()};var n=null;c.openLinkFoldout=function(){var b,d=c.textTool.currentRange,g={};d&&(b=a(d.commonAncestorContainer).closest("a"),b.length&&(g.url=b.attr("href"),g.bookmark=b.attr("data-bookmark-id"),g.$node=b),c.textTool.saveRange(),n=h.show(f,{options:{toolbarScope:c,alignTo:a("#qv-toolbar-link"),link:g,onSave:function(a,b,d,e){var f;d?(f=document.createRange(),f.setStartBefore(d[0]),f.setEndAfter(d[0]),c.textTool.insertLink(b,f,e)):c.textTool.insertLink(b,null,e),c.closeLinkFoldout(a)},onCancel:function(a){c.closeLinkFoldout(a)},onRemove:function(a,b){if(b){var d=e.createRangeForElement(b[0]);c.textTool.removeLink(d)}c.closeLinkFoldout(a)}}}),c.setActiveFoldout("link"))},c.setFontSize=function(a,b){a.preventDefault(),c.setActiveFoldout(),c.textTool.setFontSize(b)},c.closeLinkFoldout=function(d){d&&a(d.target).closest("#qv-toolbar-link").length&&b.preventGestures(),c.setActiveFoldout(),n&&(n.destroy(),n=null)},c.linkDisabled=function(){var a=c.textTool.currentRange,b=!!c.textTool.states.link;return!b&&(!a||a.collapsed)},c.haveSelection=function(){var a=c.textTool.currentRange;return!(!a||a.collapsed)},Object.defineProperty(c,"color",{get:function(){var a=10;return c.haveSelection()?d.palette.indexOf(c.textTool.color):d.palette[a]},set:function(a){c.textTool.setColor(d.palette[a])}}),c.exposedApi.closing=function(){n&&n.closing()},c.$on("$destroy",function(){c.setActiveFoldout(),n&&(n.destroy(),n=null)}),m(function(){c.textTool.refreshState()})}]};return m}),define("general.services/media-tool/command-queue",[],function(){var a=function(){this.queue=[]};return a.prototype.push=function(a){this.queue.push(a)},a.prototype.execAll=function(a){this.queue.forEach(a)},a.prototype.remove=function(a){var b,c,d=!1;for(b=this.queue.length-1;b>=0;b--)c=this.queue[b],c.cmd===a&&(d=!0,this.queue.splice(b,1));return d},a.prototype.clear=function(){this.queue=[]},a}),define("general.services/media-tool/markdown-html-parser",["util"],function(a){function b(){var b=g.formatters.map(function(b){return b.character?a.escapeRegExp(b.character):""}),c="("+b.join("|")+"){1}\\[",d="\\]\\(([^\\\\)]*(?:\\\\.[^\\\\)]*)*)\\)",e="((?![\\s\\S]*?"+c+"[\\s\\S]*?)[\\s\\S]*?)";g.markdownRegex=new RegExp(c+e+d,"mg")}function c(a,b,d){for(var e=a.exec(b),f=[];e&&!(f.indexOf(e.index)>-1);)f.push(e.index),b=d(b,e),e=a.exec(b);return f.length?c(a,b,d):b}function d(a){return a.split("").reverse().join("")}function e(){var a=g.formatters.filter(function(a){return!!a.toHTML});return a.sort(function(a,b){var c=a.toHTML.priority||0,d=b.toHTML.priority||0;return d-c}),a}function f(){var a=g.formatters.filter(function(a){return!!a.toMarkdown});return a.sort(function(a,b){var c=a.toMarkdown.priority||0,d=b.toMarkdown.priority||0;return d-c}),a}var g={};return g.register=function(a){g.formatters.push(a),b()},g.toHTML=function(a,b){var f=b||e(),h=!1;return a=a.replace(/\$\&amp;/g,"&#36;&amp;"),a=c(g.markdownRegex,a,function(a,b){return a.replace(b[0],function(){return g.getFormatter(b[1]).toHTML.callback(b[2],b[4])})}),f.forEach(function(b){b.toHTML&&b.toHTML.regex&&(b.toHTML.reverse&&(a=d(a)),a=c(b.toHTML.regex,a,function(a,c){var d=c.splice(0,1)[0];return h=!0,a.replace(d,b.toHTML.callback.apply(b.toHTML.callback,c))}),b.toHTML.reverse&&(a=d(a)))}),h?g.toHTML(a,b):a},g.toMarkdown=function(a,b){var c=b||f(),d=new Option;return d.innerHTML=a,c.forEach(function(a){a.toMarkdown.tags.forEach(function(b){var c=Array.prototype.slice.call(d.getElementsByTagName(b.name)).reverse();c.forEach(function(c){var d,e=!b.attr.length||b.attr.some(function(a){return c.hasAttribute(a)}),f=b.dontMatchAttr&&b.dontMatchAttr.some(function(a){return c.hasAttribute(a)});if(d=a.toMarkdown.regex?e&&!f&&a.toMarkdown.regex.exec(c.outerHTML.trim()):[c.outerHTML.trim()],!f&&e&&d){var g=document.createElement("span");g.innerHTML=a.toMarkdown.callback.apply(c,d.slice(1)),c.parentNode.replaceChild(g,c)}})})}),d.innerHTML.replace(/<(\/)?span>/g,"")},g.getFormatter=function(a){var b,c=g.formatters;for(b=0;b<c.length;b++)if(c[b].character===a)return c[b];return null},g.escapeMarkdown=function(a){return a.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\~/g,"\\~").replace(/\-/g,"\\-")},g.unescapeMarkdown=function(a){return a.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\~/g,"~").replace(/\\\-/g,"-")},g.reset=function(){g.formatters=[],g.markdownRegex=null},g.reset(),g}),define("general.services/media-tool/formatters/font-color",["sirtrevor","core.utils/theme","general.services/media-tool/theme","general.services/media-tool/markdown-html-parser"],function(a,b,c,d){var e=b.palette;return d.register({name:"font-color",character:"#",toHTML:{callback:function(a,b){return'<font color="'+e[b]+'">'+a+"</font>"}},toMarkdown:{regex:/^<font(?: size="([0-7]|undefined)")? color="(#[a-f0-9]{3,6})"(?: size="([0-7]|undefined)")?.*?>([\s\S]+)<\/font>$/,callback:function(a,b,d,f){if(""===f)return"";var g=a||d;return null!==g&&void 0!==g&&(g=c.htmlSizeToMarkdownSize[g],f="%["+f+"]("+g+")"),-1===e.indexOf(b)?f:"#["+f+"]("+e.indexOf(b)+")"},tags:[{name:"font",attr:["color"]}]}}),a.Formatter.extend({title:"color",cmd:"foreColor",text:"color",onClick:function(a){document.execCommand(a.cmd,!1,a.param)}})}),define("general.services/media-tool/formatters/font-size",["sirtrevor","general.services/media-tool/theme","general.services/media-tool/markdown-html-parser"],function(a,b,c){return c.register({name:"font-size",character:"%",toHTML:{callback:function(a,c){return"<font size='"+b.markdownSizeToHtmlSize[c]+"'>"+a+"</font>"}},toMarkdown:{regex:/^<font size="([0-7])".*?>([\s\S]+)<\/font>$/,callback:function(a,c){return""===c?"":(a>7&&(a=b.fontSizesPx[a]),null!==a&&void 0!==a?(a=b.htmlSizeToMarkdownSize[a],"%["+c+"]("+a+")"):c)},tags:[{name:"font",attr:["size"]}]}}),a.Formatter.extend({title:"fontsize",cmd:"fontSize",text:"fontsize"})}),define("general.services/media-tool/feature-detection",["angular","general.services/media-tool/text-selection"],function(a,b){function c(a,c){var e=document.activeElement;return document.body.appendChild(d),d.innerHTML="Feature detection.",d.focus(),b.addRange(b.createRange(d),!0),document.execCommand(a,!1,c),document.activeElement=e,document.body.removeChild(d),d.innerHTML}var d=a.element("<div contenteditable style='position:absolute;top: -999999px;'>")[0],e=c("justifyCenter").indexOf(" align=")>-1;return{usesAlign:e}}),define("general.services/media-tool/formatters/justify",["sirtrevor","qvangular","encoder","general.services/media-tool/markdown-html-parser","general.services/media-tool/feature-detection"],function(a,b,c,d,e){var f=e.usesAlign;d.register({name:"justify",character:"^",toHTML:{
callback:function(a,b){return a||(a="&nbsp;"),f?'<div align="'+c.encodeForAttr2(b)+'">'+a+"</div>":'<div style="text-align: '+c.encodeForAttr2(b)+';">'+a+"</div>"}},toMarkdown:{regex:/^<(?:div|p) (?:style="text(?:\\)?-)?align(?:="|: )(left|center|right|justified)(?:"|;").*?>([\s\S]+)<\/(?:div|p)>$/,callback:function(a,b){return"^["+b+"]("+a+")"},tags:[{name:"div",attr:["align","style"]},{name:"p",attr:["align"]}]}});var g=a.Formatter.extend({title:"align left",cmd:"justifyLeft",text:"left",onClick:function(){var a=b.getService("qvMediaTool").getParagraph().el.style,c=a.direction;"ltr"!==c&&c||(c="ltr",a.direction="rtl"),document.execCommand("justifyLeft",!1),"ltr"===c&&(a.direction="ltr")}}),h=a.Formatter.extend({title:"align center",cmd:"justifyCenter",text:"center",onClick:function(){document.execCommand("justifyCenter",!1)}}),i=a.Formatter.extend({title:"align right",cmd:"justifyRight",text:"right",toMarkdown:function(a){return d.toMarkdown(a)},toHTML:function(a){return d.toHTML(a)},onClick:function(){var a=b.getService("qvMediaTool").getParagraph().el.style,c=a.direction;"rtl"===c&&(a.direction="ltr"),document.execCommand("justifyRight",!1),"rtl"===c&&(a.direction="rtl")}});return{Left:g,Right:i,Center:h}}),define("general.services/media-tool/formatters/bold",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"bold",character:"**",toHTML:{priority:5,regex:/\*\*(?!\\)([\s\S]+?(?!\*\\))\*\*/g,callback:function(a){return">b/<"+a+">b<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:b|strong)>([\s\S]+)<\/(?:b|strong)>$/,callback:function(a){return""===a?"":"**"+a+"**"},tags:[{name:"b",attr:[]},{name:"strong",attr:[]}]}}),a.Formatter.extend({title:"bold",cmd:"bold",text:"B",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag(["b","strong"])||a.hasEndAncestorTag(["b","strong"]):a.hasStartAncestorTag(["b","strong"])&&a.hasEndAncestorTag(["b","strong"])},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("general.services/media-tool/formatters/italic",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"italic",character:"_",toHTML:{priority:5,regex:/\_(?!\\)([\s\S]+?(?!\_\\))\_/g,callback:function(a){return">i/<"+a+">i<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:i|em)>([\s\S]+)<\/(?:i|em)>$/,callback:function(a){return""===a?"":"_"+a+"_"},tags:[{name:"i",attr:[]},{name:"em",attr:[]}]}}),a.Formatter.extend({title:"italic",cmd:"italic",text:"I",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag(["i","em"])||a.hasEndAncestorTag(["i","em"]):a.hasStartAncestorTag(["i","em"])&&a.hasEndAncestorTag(["i","em"])},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("general.services/media-tool/formatters/underline",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"underline",character:"~",toHTML:{priority:5,regex:/~(?!\\)([\s\S]+?(?!~\\))~/g,callback:function(a){return">u/<"+a+">u<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<u>([\s\S]+)<\/u>$/,callback:function(a){return""===a?"":"~"+a+"~"},tags:[{name:"u",attr:[]}]}}),a.Formatter.extend({title:"underline",cmd:"underline",text:"U",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("u")||a.hasEndAncestorTag("u"):a.hasStartAncestorTag("u")&&a.hasEndAncestorTag("u")},toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("general.services/media-tool/formatters/bookmark",["jquery","qvangular","sirtrevor","encoder","general.services/media-tool/markdown-html-parser"],function(a,b,c,d,e){function f(c,d){var e=b.getService("qvMediaTool"),f=e.getRange().commonAncestorContainer,g=a(f).find("a[href="+d+"]");return"#text"===f.nodeName&&(g="A"!==c.nodeName?a(c).find("a[href="+d+"]"):a(c)),0===g.length&&(g=a(f).find("a:not([href])")),g}return e.register({name:"bookmark",character:"$",toHTML:{callback:function(a,b){return'<a href="#" class="bookmark-link" data-bookmark-id="'+d.encodeForAttr2(b)+'">'+a+"</a>"}},toMarkdown:{regex:/^<a (?=.*data\\-bookmark\\-id="([^"]+)").*?>([\s\S]+?)<\/a>$/,callback:function(a,b){return"$["+b+"]("+a+")"},tags:[{name:"a",attr:["data\\-bookmark\\-id"]}]}}),c.Formatter.extend({title:"bookmark",cmd:"createLink",text:"Bookmark",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("a")||a.hasEndAncestorTag("a"):a.hasStartAncestorTag("a")&&a.hasEndAncestorTag("a")},onClick:function(b){var c=b.url;a(document).on("DOMNodeInserted.bookmark",function(b){var d=f(b.target,c);a.each(d,function(b,d){a(d).hasClass("bookmark-link")||(d.setAttribute("href","#"),d.removeAttribute("_moz_dirty"),d.className+="bookmark-link",d.setAttribute("data-bookmark-id",c))}),setTimeout(function(){a(document).off("DOMNodeInserted.bookmark")},250)}),document.execCommand(this.cmd,!1,c)}})}),define("general.services/media-tool/formatters/link",["sirtrevor","general.services/media-tool/markdown-html-parser"],function(a,b){return b.register({name:"link",character:"@",toHTML:{callback:function(a,b){return 0===b.indexOf("javascript:")&&(b=""),0!==b.search("[a-zA-Z0-9]+:")&&(b="http://"+b),b=b.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24"),"<a href='"+decodeURI(b)+"' target='\\_blank'>"+a+"</a>"}},toMarkdown:{regex:/^<a href="(?!#)([^"]+)".*?>([\s\S]+?)<\/a>$/,callback:function(a,b){return"@["+b+"]("+a+")"},tags:[{name:"a",attr:["href"]}]}}),a.Formatter.extend({title:"link",cmd:"createLink",text:"Link",isActive:function(a){return a.rangeCollapsed?a.hasStartAncestorTag("a")||a.hasEndAncestorTag("a"):a.hasStartAncestorTag("a")&&a.hasEndAncestorTag("a")},onClick:function(a){var b=a.url;document.execCommand(this.cmd,!1,b)}})}),define("general.services/media-tool/formatters/unlink",["sirtrevor"],function(a){return a.Formatter.extend({title:"unlink",cmd:"unlink",text:"Unlink",onClick:function(a){var b=a.url;document.execCommand(this.cmd,!1,b)}})}),define("lz-string",[],function(){var a={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(b){if(null==b)return"";var c,d,e,f,g,h,i,j="",k=0;for(b=a.compress(b);k<2*b.length;)k%2==0?(c=b.charCodeAt(k/2)>>8,d=255&b.charCodeAt(k/2),e=k/2+1<b.length?b.charCodeAt(k/2+1)>>8:NaN):(c=255&b.charCodeAt((k-1)/2),(k+1)/2<b.length?(d=b.charCodeAt((k+1)/2)>>8,e=255&b.charCodeAt((k+1)/2)):d=e=NaN),k+=3,f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+a._keyStr.charAt(f)+a._keyStr.charAt(g)+a._keyStr.charAt(h)+a._keyStr.charAt(i);return j},decompressFromBase64:function(b){if(null==b)return"";var c,d,e,f,g,h,i,j,k="",l=0,m=0,n=a._f;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");m<b.length;)g=a._keyStr.indexOf(b.charAt(m++)),h=a._keyStr.indexOf(b.charAt(m++)),i=a._keyStr.indexOf(b.charAt(m++)),j=a._keyStr.indexOf(b.charAt(m++)),d=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,l%2==0?(c=d<<8,64!=i&&(k+=n(c|e)),64!=j&&(c=f<<8)):(k+=n(c|d),64!=i&&(c=e<<8),64!=j&&(k+=n(c|f))),l+=3;return a.decompress(k)},compressToUTF16:function(b){if(null==b)return"";var c,d,e,f="",g=0,h=a._f;for(b=a.compress(b),c=0;c<b.length;c++)switch(d=b.charCodeAt(c),g++){case 0:f+=h((d>>1)+32),e=(1&d)<<14;break;case 1:f+=h(e+(d>>2)+32),e=(3&d)<<13;break;case 2:f+=h(e+(d>>3)+32),e=(7&d)<<12;break;case 3:f+=h(e+(d>>4)+32),e=(15&d)<<11;break;case 4:f+=h(e+(d>>5)+32),e=(31&d)<<10;break;case 5:f+=h(e+(d>>6)+32),e=(63&d)<<9;break;case 6:f+=h(e+(d>>7)+32),e=(127&d)<<8;break;case 7:f+=h(e+(d>>8)+32),e=(255&d)<<7;break;case 8:f+=h(e+(d>>9)+32),e=(511&d)<<6;break;case 9:f+=h(e+(d>>10)+32),e=(1023&d)<<5;break;case 10:f+=h(e+(d>>11)+32),e=(2047&d)<<4;break;case 11:f+=h(e+(d>>12)+32),e=(4095&d)<<3;break;case 12:f+=h(e+(d>>13)+32),e=(8191&d)<<2;break;case 13:f+=h(e+(d>>14)+32),e=(16383&d)<<1;break;case 14:f+=h(e+(d>>15)+32,(32767&d)+32),g=0}return f+h(e+32)},decompressFromUTF16:function(b){if(null==b)return"";for(var c,d,e="",f=0,g=0,h=a._f;g<b.length;){switch(d=b.charCodeAt(g)-32,f++){case 0:c=d<<1;break;case 1:e+=h(c|d>>14),c=(16383&d)<<2;break;case 2:e+=h(c|d>>13),c=(8191&d)<<3;break;case 3:e+=h(c|d>>12),c=(4095&d)<<4;break;case 4:e+=h(c|d>>11),c=(2047&d)<<5;break;case 5:e+=h(c|d>>10),c=(1023&d)<<6;break;case 6:e+=h(c|d>>9),c=(511&d)<<7;break;case 7:e+=h(c|d>>8),c=(255&d)<<8;break;case 8:e+=h(c|d>>7),c=(127&d)<<9;break;case 9:e+=h(c|d>>6),c=(63&d)<<10;break;case 10:e+=h(c|d>>5),c=(31&d)<<11;break;case 11:e+=h(c|d>>4),c=(15&d)<<12;break;case 12:e+=h(c|d>>3),c=(7&d)<<13;break;case 13:e+=h(c|d>>2),c=(3&d)<<14;break;case 14:e+=h(c|d>>1),c=(1&d)<<15;break;case 15:e+=h(c|d),f=0}g++}return a.decompress(e)},compress:function(b){if(null==b)return"";var c,d,e,f={},g={},h="",i="",j="",k=2,l=3,m=2,n="",o=0,p=0,q=a._f;for(e=0;e<b.length;e+=1)if(h=b.charAt(e),Object.prototype.hasOwnProperty.call(f,h)||(f[h]=l++,g[h]=!0),i=j+h,Object.prototype.hasOwnProperty.call(f,i))j=i;else{if(Object.prototype.hasOwnProperty.call(g,j)){if(j.charCodeAt(0)<256){for(c=0;m>c;c++)o<<=1,15==p?(p=0,n+=q(o),o=0):p++;for(d=j.charCodeAt(0),c=0;8>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}else{for(d=1,c=0;m>c;c++)o=o<<1|d,15==p?(p=0,n+=q(o),o=0):p++,d=0;for(d=j.charCodeAt(0),c=0;16>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}k--,0==k&&(k=Math.pow(2,m),m++),delete g[j]}else for(d=f[j],c=0;m>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;k--,0==k&&(k=Math.pow(2,m),m++),f[i]=l++,j=String(h)}if(""!==j){if(Object.prototype.hasOwnProperty.call(g,j)){if(j.charCodeAt(0)<256){for(c=0;m>c;c++)o<<=1,15==p?(p=0,n+=q(o),o=0):p++;for(d=j.charCodeAt(0),c=0;8>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}else{for(d=1,c=0;m>c;c++)o=o<<1|d,15==p?(p=0,n+=q(o),o=0):p++,d=0;for(d=j.charCodeAt(0),c=0;16>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1}k--,0==k&&(k=Math.pow(2,m),m++),delete g[j]}else for(d=f[j],c=0;m>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;k--,0==k&&(k=Math.pow(2,m),m++)}for(d=2,c=0;m>c;c++)o=o<<1|1&d,15==p?(p=0,n+=q(o),o=0):p++,d>>=1;for(;;){if(o<<=1,15==p){n+=q(o);break}p++}return n},decompress:function(b){if(null==b)return"";if(""==b)return null;var c,d,e,f,g,h,i,j,k=[],l=4,m=4,n=3,o="",p="",q=a._f,r={string:b,val:b.charCodeAt(0),position:32768,index:1};for(d=0;3>d;d+=1)k[d]=d;for(f=0,h=Math.pow(2,2),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;switch(c=f){case 0:for(f=0,h=Math.pow(2,8),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;j=q(f);break;case 1:for(f=0,h=Math.pow(2,16),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;j=q(f);break;case 2:return""}for(k[3]=j,e=p=j;;){if(r.index>r.string.length)return"";for(f=0,h=Math.pow(2,n),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;switch(j=f){case 0:for(f=0,h=Math.pow(2,8),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;k[m++]=q(f),j=m-1,l--;break;case 1:for(f=0,h=Math.pow(2,16),i=1;i!=h;)g=r.val&r.position,r.position>>=1,0==r.position&&(r.position=32768,r.val=r.string.charCodeAt(r.index++)),f|=(g>0?1:0)*i,i<<=1;k[m++]=q(f),j=m-1,l--;break;case 2:return p}if(0==l&&(l=Math.pow(2,n),n++),k[j])o=k[j];else{if(j!==m)return null;o=e+e.charAt(0)}p+=o,k[m++]=e+o.charAt(0),l--,e=o,0==l&&(l=Math.pow(2,n),n++)}}};return a}),define("general.services/media-tool/formatters/measure",["qvangular","sirtrevor","util","translator","lz-string","general.utils/array-util","objects.views/charts/utils/canvas-renderer","general.services/media-tool/markdown-html-parser"],function(a,b,c,d,e,f,g,h){function i(a,b){var c,d=a.qHyperCube.qMeasureInfo;for(c=0;c<d.length;++c)if(d[c].cId===b)return d[c];return null}function j(a,b){var c,d,e=a.qHyperCube.qMeasureInfo;for(c=0;c<e.length;++c)if(e[c].cId===b)return d=a.qHyperCube.qGrandTotalRow[c],!d||"NaN"===d.qNum&&"-"===d.qText?"":d.qText;return""}function k(a){var b,c=30,d=g.getDevicePixelToBackingStoreRatio(),e=150,f=.35,h="13px 'QlikView Sans'",i=l.getContext("2d"),j=g.measureTextObject({shape:{text:a,width:112,font:h}});b=Math.ceil(Math.min(j.width+50,e)),l.height=c*d,l.width=b*d,l.style.height=c+"px",l.style.width=b+"px",i.clearRect(0,0,l.width,l.height),i.save(),i.scale(d,d),i.font="24px 'QlikView Icons'",i.globalAlpha=f,i.fillText("3",2,c/2+8),i.globalAlpha=1,i.font="13px 'QlikView Sans'",i.fillText(j.lines[0],32,c/2+5),i.restore();var k=l.toDataURL("image/png"),m=document.createElement("img");return m.setAttribute("src",k),m.setAttribute("class","tokenized-measure"),m.setAttribute("width",b+"px"),m.setAttribute("height",c+"px"),m}var l=document.createElement("canvas");return h.register({name:"measure",character:"=",toHTML:{callback:function(b,c){var f,g,h=a.getService("qvMediaTool");if(h.isActive()){var l=h.getOptions();if(!l.useMeasures)return"";var m,n=l.propertyHandler.getMeasure(c),o=!1;if(n){var p=i(l.layout,c);!p||p.qError?(o=!0,m=d.get("Object.ErrorMessage.MissingMeasure")):m=p.qFallbackTitle}else m=l.copiedMeasures[c];var q=JSON.stringify(n);g=k(m),g.setAttribute("data-measure-id",c),g.setAttribute("data-measure-name",e.compressToBase64(m)),g.setAttribute("data-measure",e.compressToBase64(q)),g.setAttribute("data-tid","ti-measure"),o&&g.classList.add("invalid-measure")}else{f=h.getCurrentLayout();var r=j(f,c);if(null===r)return"";g=document.createElement("span"),g.setAttribute("data-tid","ti-measure"),g.appendChild(document.createTextNode(r))}return g.outerHTML}},toMarkdown:{callback:function(){var b="",d=this.getAttribute("data\\-measure\\-id"),g=a.getService("qvMediaTool").getOptions();if(!i(g.layout,d)&&!g.copiedMeasures[d]){var h=e.decompressFromBase64(this.getAttribute("data\\-measure")),j=JSON.parse(h);d=c.generateId(),j.qDef.cId=d;var k=g.properties;k.qHyperCubeDef.qMeasures.push(j),f.indexAdded(k.qHyperCubeDef.qInterColumnSortOrder,k.qHyperCubeDef.qDimensions.length+k.qHyperCubeDef.qMeasures.length-1);var l=e.decompressFromBase64(this.getAttribute("data\\-measure\\-name"));g.copiedMeasures[d]=l}return"=["+b+"]("+d+")"},tags:[{name:"img",attr:["data\\-measure\\-id"]}]}}),b.Formatter.extend({title:"measure",cmd:"",text:"measure",toMarkdown:function(a){return a},toHTML:function(a){return a}})}),define("general.services/media-tool/formatters/image",["qvangular","sirtrevor","general.services/media-tool/markdown-html-parser","general.models/media-library"],function(a,b,c,d){function e(a,b,c){for(var d=c?"qStaticContentUrl":"qStaticContentUrlDef",e=0;e<b.length;e++)if(b[e].id===a)return b[e].url[d].qUrl;return""}function f(a){return a.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24")}return c.register({name:"image",character:"!",toHTML:{callback:function(b,g){var h=a.getService("qvMediaTool");if(h.getOptions().useImageArray){var i=g,j=h.getCurrentLayout();g=e(b,j.images,!0),g=g?c.escapeMarkdown(g):i}return g=d.stripBasePath(g),g=f(g),g=d.addBasePath(g),b||(b="image"),b=f(b),"<img src='"+g+"' data-image-id='"+b+"'>"}},toMarkdown:{regex:/^<img.*?src="([^"]+)".*?>$/,callback:function(a){var b=this.getAttribute("data\\-image\\-id")||"";return b||(b=""),a=c.unescapeMarkdown(a),a=d.stripBasePath(a),a=c.escapeMarkdown(a),"!["+b+"]("+a+")"},tags:[{name:"img",attr:["src"],dontMatchAttr:["data\\-measure\\-id"]}]}}),b.Formatter.extend({title:"image",cmd:"insertImage",text:"image",onClick:function(a){document.execCommand(a.cmd,!1,a.param)}})}),define("general.services/media-tool/formatters/paste",["general.services/media-tool/markdown-html-parser","util"],function(a,b){var c=/color: rgb\\\((\d{1,3}), (\d{1,3}), (\d{1,3})/i,d=/font\\\-size: (\d+)px/i,e=/text\\\-decoration: underline/i,f=/font\\\-weight: bold/i;a.register({name:"paste",character:"`",toMarkdown:{regex:/^<(span|font|i|b|u) style="(.+?)">(.+?)<\/(?:span|font|i|b|u)>$/,callback:function(g,h,i){var j;return c.test(h)&&(h=h.replace(/rgb\\\(/g,"rgb(").replace(/\\\);/g,");"),i=a.getFormatter("#").toMarkdown.callback(null,b.normalizeToHex(h),null,i)),j=d.exec(h),j&&(i=a.getFormatter("%").toMarkdown.callback(j[1],i)),j=e.exec(h),j&&(i=a.getFormatter("~").toMarkdown.callback(i)),j=f.exec(h),j&&(i=a.getFormatter("**").toMarkdown.callback(i)),this.innerHTML=i,this.removeAttribute("style"),a.toMarkdown(this.outerHTML.trim())},tags:[{name:"span",attr:["style"]},{name:"font",attr:["style"]},{name:"b",attr:["style"]},{name:"i",attr:["style"]},{name:"u",attr:["style"]}]}}),a.register({name:"word",character:"``",toMarkdown:{regex:/^.+$/i,callback:function(){return" "},tags:[{name:"style",attr:[]},{name:"w:WordDocument",attr:[]}]}})}),define("general.services/media-tool/sir-trevor-extensions",["jquery","sirtrevor","underscore","general.services/media-tool/text-selection","general.services/media-tool/formatters/font-color","general.services/media-tool/formatters/font-size","general.services/media-tool/formatters/justify","general.services/media-tool/formatters/bold","general.services/media-tool/formatters/italic","general.services/media-tool/formatters/underline","general.services/media-tool/formatters/bookmark","general.services/media-tool/formatters/link","general.services/media-tool/formatters/unlink","general.services/media-tool/formatters/measure","general.services/media-tool/formatters/image","general.utils/string-limits","general.services/media-tool/formatters/paste"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){for(var b=[],c=0;c<a.childNodes.length;c++)3===a.childNodes[c].nodeType?b.push(a.childNodes[c]):b.push.apply(b,q(a.childNodes[c]));return b}function r(){var a=this,b=a.textContent.length-p.textImage;if(b>0){var c=d.getRange(),e=c.commonAncestorContainer;if(3===e.nodeType){var f=q(document.activeElement),g=f.indexOf(e);f=f.splice(0,g+1),f.reverse().forEach(function(a){return 0>=b?!1:(a.nodeValue.length>b?(a.splitText(a.nodeValue.length-b),a.parentNode.removeChild(a.nextSibling),d.addRange(c,!0)):a.parentNode.removeChild(a),void(b-=a.nodeValue.length))})}}}delete b.Formatters.Bold,delete b.Formatters.Italic,delete b.Formatters.Link,delete b.Formatters.Unlink,b.Formatters.bold=new h,b.Formatters.italic=new i,b.Formatters.underline=new j,b.Formatters.justifyLeft=new g.Left,b.Formatters.justifyCenter=new g.Center,b.Formatters.justifyRight=new g.Right,b.Formatters.fontSize=new f,b.Formatters.foreColor=new e,b.Formatters.bookmark=new k,b.Formatters.link=new l,b.Formatters.unlink=new m,b.Formatters.measure=new n,b.Formatters.insertImage=new o,b.Blocks.Paragraph=function(){return b.Block.extend({type:"paragraph",className:"st-block",icon_name:"paragraph",editorHTML:'<div class="st-required st-text-block" contenteditable="true" autocomplete="off" autocorrect="off"></div>',attributes:function(){return c.extend(b.SimpleBlock.fn.attributes.call(this),{})},title:function(){return"Paragraph"},loadData:function(a){this.getTextBlock().html(b.toHTML(a.text,this.type))},focus:function(){var a=this.getTextBlock();a.focus()},_initTextBlocks:function(){var a=this.getTextBlock();a.bind("input",r).bind("paste",this._handleContentPaste).bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter)},_initUIComponents:function(){this.onFocus(),this.onBlur()},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready")},toData:function(){b.log("toData for "+this.blockID);var c=this.getTextBlock();c.find("div,p").each(function(){var b=a(this);b.is("[align],[style]")||b.attr("align","left")});var d=c.html();this.setData({text:b.toMarkdown(d,this.type)})}})}(),b.FloatingBlockControls=function(){return b.FloatingBlockControls.extend({className:"",bound:[],initialize:function(){},attributes:function(){}})}(),b.BlockControls=function(){return b.FloatingBlockControls.extend({className:"",bound:[],html:"",initialize:function(){},hide:function(){},show:function(){},handleControlButtonClick:function(){}})}(),b.FormatBar=function(){return b.FormatBar.extend({className:"",initialize:function(){}})}()}),define("general.services/media-tool/media-tool",["jquery","underscore","util","general.utils/dom-util","qvangular","sirtrevor","text!./media-tool.ng.html","general.services/media-tool/theme","general.services/media-tool/toolbar","general.services/media-tool/command-queue","general.services/media-tool/text-selection","general.utils/string-limits","general.models/media-library","general.services/show-service/show-service","general.utils/support","./sir-trevor-extensions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p,q=e.getService("$sce"),r={bold:!1,italic:!1,underline:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,link:!1,fontSize:!1};return p={controller:["$scope","$element","$timeout",function(g,p,s){function t(){u(),y=n.show(i,{textTool:g,options:g.options.toolbar||{},alignTo:g.options.alignTo||p})}function u(){y&&(g.editor.formatBar.$el.remove(),y.destroy(),y=null)}function v(){function a(a){return g.getEditorElement()===a}function b(a,c){return Array.isArray(a)?a.some(function(a){return b(a,c)}):c.some(function(b){return b.nodeName.toLowerCase()===a})}var c=d.getAncestorsUntil(g.currentRange.startContainer,a),e=d.getAncestorsUntil(g.currentRange.endContainer,a);return{rangeCollapsed:g.currentRange.collapsed,hasStartAncestorTag:function(a){return b(a,c)},hasEndAncestorTag:function(a){return b(a,e)}}}function w(b){function c(a){g.saveRange(),g.cmdQueue.clear(),a&&g.refreshState()}var e=!o.treatAsDesktop();a("body").on("mouseup.texttool",function(b){var f=a(b.target);f.closest(".qv-texttool-toolbar, .qui-immidiateContextual, .qv-modal-container-centered").length?d.isInput(document.activeElement)||(g.focus(),g.restoreRange()):e||document.activeElement===g.getEditorElement()[0]&&s(function(){c(!0),g.$apply()})}),e&&a(document).on("selectionchange.texttool",function(){if(document.activeElement===g.getEditorElement()[0]){var a=k.getRange();a&&!k.rangeEquals(a,g.currentRange)&&c(!0)}}),b.on("qv-activate","img",function(a){var b=k.createRangeForElement(a.target);g.focus(),k.addRange(b,!0),g.saveRange(),g.refreshState()}),b.on("scroll",function(){g.saveScroll()}),b.on("keydown input",function(a){13!==a.which&&(g.cmdQueue.execAll(function(a){g.execCustom(a)}),g.cmdQueue.clear()),s(function(){g.$apply()})}),e||b.on("keyup",function(){c(!0)})}var x=q.getTrustedHtml(f.toHTML(g.options.markdown));g.data={data:[{type:"paragraph",data:{text:f.toMarkdown(x)}}]},g.states=r,g.cmdQueue=new j;var y;this.scope=function(){return g},this.closing=function(){y&&(y.closing(),y.destroy())},g.getParagraph=function(){return g.editor.blocks[0]},g.getEditorElement=function(){return g.getParagraph().getTextBlock()},g.destroy=function(){u(),g.destroyComponent()},g.calculateUsage=function(){var a=g.getEditorElement()[0];g.usage=Math.min(100,(a.textContent.length/l.textImage*100).toFixed(0)),g.showUsage=g.usage>=90},g.refreshState=function(){g.currentRange&&e.$apply(g,function(){g.calculateUsage();var a=v();Object.keys(g.states).forEach(function(b){g.states[b]=f.Formatters[b].isActive(a)});var b;g.currentRange&&(b=document.queryCommandValue("foreColor"),"undefined"!=typeof b&&(b=c.normalizeToHex(b))),g.color=b||"#545352";var e,i;g.currentRange&&(i=d.getParentElementWithAttribute(g.currentRange.endContainer,"font","size"),i&&(e=i.getAttribute("size"),e=h.htmlSizeToMarkdownSize[e],e=h.markdownSizeToHtmlSize[e]),"undefined"===e&&(e=null)),g.fontSize=e||3})},g.saveRange=function(){var a=k.getRange();a?g.currentRange=a.cloneRange():g.currentRange=null},g.restoreRange=function(){if(g.currentRange){var a=k.getRange();a?a&&(k.rangeEquals(a,g.currentRange)||k.addRange(g.currentRange,!0)):k.addRange(g.currentRange,!0)}},g.saveScroll=function(){g.currentScrollTop=g.getEditorElement()[0].scrollTop},g.restoreScroll=function(){g.currentScrollTop&&(g.getEditorElement()[0].scrollTop=g.currentScrollTop)},g.setJustify=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.execCustom({cmd:a}),g.saveRange(),g.refreshState()},g.setBIU=function(a){if(g.focus(),g.restoreScroll(),g.restoreRange(),g.states[a]=!g.states[a],g.currentRange.collapsed){var b=g.cmdQueue.remove(a);b||g.cmdQueue.push({cmd:a})}else g.execCustom({cmd:a});g.saveRange()},g.setFontSize=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.currentRange.collapsed?(g.cmdQueue.remove("fontSize"),g.cmdQueue.push({param:a,cmd:"fontSize"})):g.execCustom({param:a,cmd:"fontSize"}),g.saveRange(),g.fontSize=a},g.setColor=function(a){g.focus(),g.restoreScroll(),g.restoreRange(),g.currentRange.collapsed?(g.cmdQueue.remove("foreColor"),g.cmdQueue.push({param:a,cmd:"foreColor"})):g.execCustom({param:a,cmd:"foreColor"}),g.saveRange(),g.color=a},g.insertImage=function(a,b){a=m.addBasePath(a),b=m.addBasePath(b),g.focus(),g.restoreRange(),g.execCustom({param:a,cmd:"insertImage"}),g.options.insertedImages.push({url:a,urlDef:b}),g.saveRange(),g.focus()},g.insertLink=function(a,b,c){b?k.addRange(b,!0):g.restoreRange(),g.focus(),g.execCustom({url:a,cmd:c.cmd,formatter:c.formatter}),g.saveRange(),g.refreshState()},g.removeLink=function(a){k.addRange(a,!0),g.execCustom({cmd:"unlink",range:a}),g.saveRange(),g.refreshState(),g.focus()},g.execCustom=function(a){var c=f.Formatters[a.formatter||a.cmd];b.isUndefined(c)||(!b.isUndefined(c.onClick)&&b.isFunction(c.onClick)?c.onClick(a):document.execCommand(a.cmd,!1,a.param))},g.focus=function(){g.getEditorElement().focus()},s(function(){g.editor=new f.Editor({el:p.find("textarea"),defaultType:"paragraph",onEditorRender:function(){var a=p.find(".st-text-block");w(a),"function"==typeof g.options.onOpen&&g.options.onOpen(g),g.options.toolbar&&t(),s(function(){g.refreshState()})}})}),g.$on("$destroy",function(){u(),a("body").off(".texttool"),a(document).off(".texttool")})}],template:g}}),define("general.services/media-tool/media-tool-service",["qvangular","sirtrevor","general.services/media-tool/media-tool"],function(a,b,c){var d=a.getService("$sce"),e=a.service("qvMediaTool",[function(){var a,e,f,g={};return g.show=function(b,d){f=d,a=b.showComponent(c,{options:d})},g.hide=function(){a&&(a.scope().destroy(),a=null,f=null)},g.closing=function(){a&&a.closing()},g.isActive=function(){return f&&"function"==typeof f.isActive?f.isActive():!!a},g.getCurrentLayout=function(){return e},g.getOptions=function(){return f||{}},g.getMarkdown=function(){var b,c=a.scope().getParagraph();return c&&(b=c.saveAndGetData())?b.text:null},g.hasContent=function(a){return a&&"^[\n](left)"!==a},g.getParagraph=function(){return a.scope().getParagraph()},g.getEditorElement=function(){return a.scope().getEditorElement()},g.getRange=function(){return a.scope().currentRange},g.toHTML=function(a,c){if(e=c,a){var f=b.toHTML(a);return a=b.toMarkdown(f),d.getTrustedHtml(b.toHTML(a))}return""},g.toMarkdown=function(a){return a?b.toMarkdown(a):""},g}]);return e}),define("core.utils/help-url",["core.utils/external-urls"],function(a){function b(){var a=location.pathname.split("/").slice(-2,-1)[0];location.pathname.toLowerCase().indexOf("/workbench/")>-1?a="workbench":"qmc"!==a.toLowerCase()&&(a="client"),d+=a+"/"}var c={},d=a.serverHelpBaseUrl;return c.setBaseUrl=function(c){d=c?a.personalHelpBaseUrl:a.serverHelpBaseUrl,b()},Object.defineProperty(c,"path",{get:function(){return d}}),b(),c}),define("extensions.qliktech/map/map-properties",["general.utils/property-resolver","general.services/media-tool/media-tool-service","translator","core.utils/help-url"],function(a,b,c,d){function e(a){if(!a||a.qLibraryId)return!1;var b=a.qDef.qFieldDefs[0];return b&&b.length&&"="===b[0]}function f(b){var c=a.getValue(b,"color.auto"),d=a.getValue(b,"color.mode"),e=a.getValue(b,"color.expressionIsColor");return c||"primary"===d||"byExpression"===d&&(e||void 0===e)}function g(b){return"byExpression"===a.getValue(b,"color.mode")&&a.getValue(b,"color.expressionIsColor")===!0}var h=1,i=[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"}],j=i.concat({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),k=j.concat({value:"byExpression",translation:"properties.colorMode.byExpression"}),l={ref:"layers",type:"array",translation:"Common.Data",addTranslation:"properties.layers.add",component:"layers",allowMove:!0,max:h,items:{polygonLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{text:{component:"text",translation:"Common.Dimension",style:"sHeader"},field:{ref:"qListObjectDef.qDef.qFieldDefs.0",type:"string",translation:"Common.Field",component:"expression",expressionType:"dimension",show:function(a){var b=a.qListObjectDef;return b&&!b.qLibraryId},readOnly:!0},libraryDimension:{ref:"qListObjectDef.qLibraryId",type:"string",translation:"Common.Dimension",component:"library-item",libraryItemType:"dimension",show:function(a){var b=a.qListObjectDef;return b&&b.qLibraryId}},geodata:{ref:"qListObjectDef.qExpressions.1.qExpr",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(a){return a&&e(a.qListObjectDef)}}}},measure:{type:"items",items:{text:{component:"text",translation:"Common.Measure",style:"sHeader"},expression:{ref:"qListObjectDef.qExpressions.0.qExpr",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(b,c,d,e){var f=b.qListObjectDef.qExpressions[0].qExpr;if(f=f.trim(),""===f)"byMeasure"===a.getValue(d,"color.mode")&&(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{var g=d.layers.indexOf(b),h=e.layout.layers[g],i=h.qListObject.qExpressions&&h.qListObject.qExpressions[0]?h.qListObject.qExpressions[0].qExpr:"";i=void 0!==i?i.trim():"",d.color.auto&&"primary"===d.color.mode&&""===i&&(d.color.auto=!1,d.color.mode="byMeasure")}},show:function(b){return!a.getValue(b,"qListObjectDef.qExpressions.0.qLibraryId")}},libraryMeasure:{ref:"qListObjectDef.qExpressions.0.qLibraryId",type:"string",translation:"Common.Measure",component:"library-item",libraryItemType:"measure",show:function(b){return a.getValue(b,"qListObjectDef.qExpressions.0.qLibraryId")}},label:{ref:"qListObjectDef.qExpressions.0.qLabel",type:"string",translation:"Common.Label",show:function(b){return!a.getValue(b,"qListObjectDef.qExpressions.0.qLibraryId")}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",defaultValue:!0,show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}},polygon3Layer:{type:"items",component:"expandable-items",sourceType:"polygon3Layer",grouped:!0,items:{dimensions:{type:"items",items:{text:{component:"text",translation:"Common.Dimension",style:"sHeader"},field:{type:"string",component:"expression",expressionType:"dimension",ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",translation:"Common.Field",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return!b||!b.qLibraryId},readOnly:!0},libraryDimension:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qHyperCubeDef.qDimensions.0.qLibraryId",translation:"Common.Dimension",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return b&&b.qLibraryId}},geodata:{ref:"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&e(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0,
change:function(b){var c=a.getValue(b,"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression");a.setValue(b,"qHyperCubeDef.qDimensions.0.qNullSuppression",c)}},showExcluded:{type:"boolean",ref:"showExcluded",defaultValue:!0,translation:"properties.dimensions.showExcluded"}}},measure:{type:"items",items:{text:{component:"text",translation:"Common.Measure",style:"sHeader"},expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(b,c,d){var e=b.qHyperCubeDef.qMeasures[0],f=d.layers.indexOf(b);if(e&&""===e.qDef.qDef)("byMeasure"===a.getValue(d,"color.mode")||"byExpression"===a.getValue(d,"color.mode"))&&(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{e.qSortBy={qSortByLoadOrder:1};var g=d.layers[f].measureDef;g=void 0!==g?g.trim():"",d.color.auto&&"primary"===d.color.mode&&""===g&&(d.color.auto=!1,d.color.mode="byMeasure")}d.layers[f].measureDef=b.qHyperCubeDef.qMeasures[0].qDef.qDef},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},libraryMeasure:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qHyperCubeDef.qMeasures.0.qLibraryId",translation:"Common.Measure",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&b.qLibraryId}},label:{ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},suppressZero:{type:"boolean",ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",inverted:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!!b}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{type:"boolean",ref:"show",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}},pointLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{text:{component:"text",translation:"Common.Dimension",style:"sHeader"},field:{ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"Common.Field",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return!b||!b.qLibraryId},readOnly:!0},libraryDimension:{ref:"qHyperCubeDef.qDimensions.0.qLibraryId",type:"string",translation:"Common.Dimension",component:"library-item",libraryItemType:"dimension",show:function(a){var b=a.qHyperCubeDef.qDimensions[0];return b&&b.qLibraryId}},geodata:{ref:"qHyperCubeDef.qDimensions.1.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"properties.layers.pointData",change:function(a){var b=a.qHyperCubeDef.qDimensions[1].qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]},show:function(a){return a&&a.qHyperCubeDef&&a.qHyperCubeDef.qDimensions&&e(a.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0}}},measure:{type:"items",items:{text:{component:"text",translation:"Common.Measure",style:"sHeader"},expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(b,c,d,e){var f=b.qHyperCubeDef.qMeasures[0];if(f&&""===f.qDef.qDef)b.qHyperCubeDef.qMeasures.length=0,2===b.qHyperCubeDef.qInterColumnSortOrder[0]&&b.qHyperCubeDef.qInterColumnSortOrder.splice(0,1),("byMeasure"===a.getValue(d,"color.mode")||"byExpression"===a.getValue(d,"color.mode"))&&(a.setValue(d,"color.mode","primary"),a.getValue(d,"color.auto")===!1&&a.setValue(d,"color.auto",!0));else{f.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},2!==b.qHyperCubeDef.qInterColumnSortOrder[0]&&b.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2);var g=d.layers.indexOf(b),h=e.layout.layers[g],i=h.qHyperCube.qMeasureInfo?h.qHyperCube.qMeasureInfo.length:0;d.color.auto&&"primary"===d.color.mode&&0===i&&(d.color.auto=!1,d.color.mode="byMeasure")}},show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},libraryMeasure:{ref:"qHyperCubeDef.qMeasures.0.qLibraryId",type:"string",translation:"Common.Measure",component:"library-item",libraryItemType:"measure",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&b.qLibraryId}},label:{ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!b||!b.qLibraryId}},suppressZero:{type:"boolean",ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",inverted:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!!b}},useSize:{ref:"useSize",type:"boolean",translation:"properties.map.useSize",defaultValue:!0,show:function(a){return a.qHyperCubeDef.qMeasures[0]}},bubbleSizes:{ref:"bubbleSizes",type:"integer",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:8,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return!(b&&a.useSize)}},rangeBubbleSizes:{ref:"rangeBubbleSizes",type:"array",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:[1,32],show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize}},customRange:{type:"items",items:{autoMinMax:{ref:"autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize}},customMin:{ref:"customMin",translation:"properties.axis.min",expression:"optional",type:"number",defaultValue:0,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize&&a.autoMinMax===!1},invalid:function(b){return"minMax"===a.getValue(b,"minMax")?a.getValue(b,"customMin")>=a.getValue(b,"customMax"):!1}},customMax:{ref:"customMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(a){var b=a.qHyperCubeDef.qMeasures[0];return b&&a.useSize&&a.autoMinMax===!1},invalid:function(b){return"minMax"===a.getValue(b,"minMax")?a.getValue(b,"customMin")>=a.getValue(b,"customMax"):!1}}}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",show:function(b,c,d){return a.getValue(d.properties,"background.show",!1)}}}}}}}},m={component:"items",type:"items",translation:"properties.background",grouped:!0,items:{show:{ref:"background.show",type:"boolean",translation:"properties.show",component:"switch",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],defaultValue:!1,change:function(b){b.layers.length&&!b.background.show&&(b.layers[0].show=!0),b.background&&b.background.show&&void 0===b.background.defaultMapService&&a.setValue(b,"background.defaultMapService",!0)}},baseLayers:{type:"items",show:function(b){return a.getValue(b,"background.show")},items:{defaultMapService:{ref:"background.defaultMapService",type:"boolean",translation:"properties.mapService",component:"switch",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},customMapService:{type:"items",items:{type:{ref:"background.layers.0.type",type:"string",translation:"properties.type",component:"dropdown",options:[{translation:"properties.layers.type.slippy",value:"XYZ"}],defaultValue:"XYZ"},urls:{ref:"background.layers.0.urls.0",type:"string",translation:"Common.URL",minlength:1},attribution:{ref:"background.layers.0.attribution",type:"string",translation:"properties.attribution",component:"textarea",maxlength:1024,resolveFunctions:{get:function(a,c){var d=a(c.type);return b.toHTML(d)},set:function(a,c,d){var e=b.toMarkdown(a);c(d.type,e)}}},helpLink:{component:"link",url:function(){return d.path+"#"+c.language+"|map.htm"},translation:"properties.background.help"}},show:function(b){var c=a.getValue(b,"background.defaultMapService");return!c}}}}}},n={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},autoZoomOnSelection:{ref:"autoZoomOnSelection",type:"boolean",defaultValue:!0,translation:"properties.autoZoomOnSelection",show:function(a){return a&&a.layers&&a.layers[0]&&"point"===a.layers[0].type}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:function(a,b){var c=b.getMeasures(),d=c?c.length:0,e=b.getLayerTypeAndVersion();switch(e[0]){case"point":return d>0?k:i;case"polygon":return"2"===e[1]||"3"===e[1]?d>0?k:i:d>0?j:i}return i}},persistentColors:{show:function(b){return!(a.getValue(b,"color.auto")||"byDimension"!==a.getValue(b,"color.mode")||"point"===b.layers[0].type||"polygon"===b.layers[0].type&&"2"===b.layers[0].version)}},attributeExpression:{ref:"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:function(b){var c=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.type="colorByExpression",d&&(d.colorExpression=c.qExpression))},globalChange:function(b){var c,d,e,f=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures",[]),g=a.getValue(b,"layers.0.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),h=null,i=function(a,b){"colorByExpression"===a.type&&(d=b)};if(f.length+g.length>1){for(c=g.length-1;c>=0;--c)e=g[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);for(c=f.length-1;c>=0;--c)e=f[c].qAttributeExpressions||[],d=-1,e.every(i),d>=0&&(h=e.splice(d,1)[0]);!f[0].qAttributeExpressions&&h&&(f[0].qAttributeExpressions=[]),h&&f[0].qAttributeExpressions.splice(0,0,h)}var j=a.getValue(b,"color.colorExpression");1!==f.length||f[0].qAttributeExpressions&&0!==f[0].qAttributeExpressions.length||!j||(f[0].qAttributeExpressions=[{qExpression:j,type:"colorByExpression"}])}},expressionLabel:{change:function(b){var c=a.getValue(b,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),d=a.getValue(b,"color");c&&(c.label=a.getValue(b,"color.expressionLabel"),d&&(d.colorExpression=c.qExpression))}}}},legend:{items:{show:{show:function(a){return!f(a)}},showTitle:{show:function(b){return a.getValue(b,"legend.show")&&!f(b)&&!g(b)}},dock:{show:function(b){return a.getValue(b,"legend.show")&&!f(b)}}}}}}}},o={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{items:{expr:{ref:"calcCond",expressionType:"measure",change:function(a,b){b.rippleToHyperCubes("qCalcCond",a.calcCond)}},customErrorMessage:{ref:"customErrorMessage.calcCond",show:function(b){return""!==a.getValue(b,"calcCond")},change:function(a,b){b.rippleToHyperCubes("customErrorMessage.calcCond",a.customErrorMessage.calcCond)}}}},suppressZero:null}}}};return{type:"items",component:"accordion",items:{data:l,background:m,addons:o,settings:n}}}),define("extensions.qliktech/map/projection/unit-projection",["core.utils/class"],function(a){var b;return b=a.extend("UnitProjection",{init:function(){},getProjectionType:function(){return"Unit"},project:function(a){return a},invProject:function(a){return a}})}),define("extensions.qliktech/map/projection/mercator-projection",["core.utils/class","objects.utils/shapes/point"],function(a,b){var c,d=Math.PI,e=d/2,f=d/4,g=d/180,h=Math.max,i=Math.min,j=85.0511287798059*g,k=180/d;return c=a.extend("MercatorProjection",{init:function(){},getProjectionType:function(){return"Mercator"},project:function(a){if(a){var c=h(i(a.y*g,j),-j),d=a.x*g,e=0,l=d-e,m=Math.log(Math.tan(f+c/2));return l*=k,m*=k,new b(l,m)}},invProject:function(a){if(a){var c=a.x*g,d=a.y*g,f=0,h=c+f,i=2*Math.atan(Math.pow(Math.E,d))-e;return h*=k,i*=k,new b(h,i)}}})}),define("extensions.qliktech/map/projection/viewport-projection",["objects.views/charts/events/event-launcher","objects.utils/shapes/point","objects.utils/shapes/rect","extensions.qliktech/map/projection/unit-projection","extensions.qliktech/map/projection/mercator-projection","objects.views/charts/utils/matrix"],function(a,b,c,d,e,f){function g(a){return this._projectedMapOriginalCenterIsZeroPoint?a:new b(a.x-this._projectedMapOriginalCenter.x,a.y-this._projectedMapOriginalCenter.y)}function h(a){return this._projectedMapOriginalCenterIsZeroPoint?a:new b(a.x+this._projectedMapOriginalCenter.x,a.y+this._projectedMapOriginalCenter.y)}function i(a,c){var d=Math.pow(2,c+8)/this._projectedMapSize;return new b(a.x*d,a.y*d)}function j(a,c){var d=Math.pow(2,c+8)/this._projectedMapSize;return new b(a.x/d,a.y/d)}function k(){if(this._projection&&this._projectedMapBoundingBox){var a,b,c,d,e;this._projectedMapSize=Math.max(this._projectedMapBoundingBox.width,this._projectedMapBoundingBox.height),a=Math.pow(2,this._zoomLevel+8)/this._projectedMapSize,this._projectedMapOriginalCenter=this._projectedMapBoundingBox.getCenterPoint(),this._mapOriginialCenter=this._projection.invProject(this._projectedMapOriginalCenter),this._currentMapCenter||(this._currentMapCenter=this._mapOriginialCenter),0===this._projectedMapOriginalCenter.x&&0===this._projectedMapOriginalCenter?this._projectedMapOriginalCenterIsZeroPoint=!0:this._projectedMapOriginalCenterIsZeroPoint=!1,(!this._projectedCurrentMapCenter||this._projectionChanged||this._currentMapCenterChanged)&&(this._projectedCurrentMapCenter=this._projection.project(this._currentMapCenter)),this._transformMatrixForZoomLevel.identity(),this._transformMatrixForZoomLevel.translate(this._viewportSize.x/2,this._viewportSize.y/2),this._transformMatrixForZoomLevel.scale(1,-1),this._transformMatrixForZoomLevel.scale(a,a),this._transformMatrixForZoomLevel.translate(-this._projectedMapOriginalCenter.x,-this._projectedMapOriginalCenter.y),b=this._transformMatrixForZoomLevel.transformPoint(this._projectedMapOriginalCenter),c=this._transformMatrixForZoomLevel.transformPoint(this._projectedCurrentMapCenter),d=b.x-c.x,e=b.y-c.y,this._transformMatrix.identity(),this._transformMatrix.translate(d,e),this._transformMatrix.multiply(this._transformMatrixForZoomLevel.elements),this._invTransformMatrix=this._transformMatrix.clone(),this._invTransformMatrix.invert(),this._projectionChanged=!1,this._currentMapCenterChanged=!1,this.enabledChangeEvent&&this.fire("changed")}}function l(){this._projection instanceof e&&(this._projectedMapBoundingBox=new c(-180,-85.0511287798059,360,170.1022575596118)),this._projection instanceof d&&(this._projectedMapBoundingBox=new c(-180,-180,360,360)),this._projectedMapSize=Math.max(this._projectedMapBoundingBox.width,this._projectedMapBoundingBox.height)}var m,n=0,o=1e-9,p=new b(0,0),q=Math.log(2);return m=a.extend("ViewportProjection",{init:function(){this._super(),n++,this._fractionalZoomMode=!0,this._viewportSize=new b(256,256),this._zoomLevel=0,this._maxZoomLevel=20,this._minZoomLevel=0,this._translation=new b(0,0),this._unitProjection=new d,this._mercatorProjection=new e,this._projection=this._unitProjection,this._projectedMapOriginalCenter=new b(0,0),l.call(this),this._projectedMapOriginalCenterIsZeroPoint=!0,this._transformMatrixForZoomLevel=new f,this._transformMatrix=new f,this._invTransformMatrix=new f,this.enabledChangeEvent=!0},setProjection:function(a){return this._projection&&a&&this._projection.getProjectionType()===a.getProjectionType()?!1:(this._projection=a,this._projection||(this._projection=this._unitProjection),l.call(this),this._projectionChanged=!0,k.call(this),!0)},getProjection:function(){return this._projection},getUnitProjection:function(){return this._unitProjection},getMercatorProjection:function(){return this._mercatorProjection},setProjectedMapBoundingBox:function(a){this._projectedMapBoundingBox&&this._projectedMapBoundingBox.equal&&this._projectedMapBoundingBox.equal(a)||(this._projectedMapBoundingBox=new c(a.x,a.y,a.width,a.height),k.call(this))},getProjectedMapBoundingBox:function(){return this._projectedMapBoundingBox},setSize:function(a){return this._viewportSize&&this._viewportSize.equal&&this._viewportSize.equal(a)?!1:(this._viewportSize=new b(a.x,a.y),k.call(this),!0)},getSize:function(){return this._viewportSize},setZoomLevel:function(a){return isNaN(a)?!1:(this._fractionalZoomMode||(a=Math.round(a)),a=Math.max(Math.min(a,this._maxZoomLevel),this._minZoomLevel),Math.abs(this._zoomLevel-a)<.001?!1:(this._zoomLevel=a,k.call(this),!0))},getZoomLevel:function(){return this._zoomLevel},setMapCenter:function(a){return a?this._currentMapCenter&&this._currentMapCenter.closeTo&&this._currentMapCenter.closeTo(a,o)?!1:(this._currentMapCenterChanged=!0,this._currentMapCenter=new b(a.x,a.y),k.call(this),!0):!1},getMapCenter:function(){return this._currentMapCenter},setMapCenterInLonLat:function(a){if(!a)return!1;var b=this._projection instanceof d?this._mercatorProjection.project(a):a;return this.setMapCenter(b)},getMapCenterInLonLat:function(){return this._projection instanceof d?this._mercatorProjection.invProject(this._currentMapCenter):this._currentMapCenter},setFractionalZoomMode:function(a){this._fractionalZoomMode=a},getFractionalZoomMode:function(){return this._fractionalZoomMode},project:function(a){var b,c;return b=this._projection.project(a),c=this.transform(b)},invProject:function(a){var b,c;return b=this.invTransform(a),c=this._projection.invProject(b)},fromLonLatToViewport:function(a){var b,c;return b=this._projection instanceof d?this._mercatorProjection.project(a):a,c=this.project(b)},fromViewportToLonLat:function(a){var b,c;return b=this.invProject(a),c=this._projection instanceof d?this._mercatorProjection.invProject(b):b},fromMapRectToViewportRect:function(a){var d,e,f;return d=this.project(new b(a.x,a.y)),e=this.project(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},fromViewportRectToMapRect:function(a){var d,e,f;return d=this.invProject(new b(a.x,a.y)),e=this.invProject(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},getMapRectOfViewport:function(){return this.fromViewportRectToMapRect({x:0,y:0,width:this._viewportSize.x,height:this._viewportSize.y})},getMapRectOfViewportIfZoomOnAMapRect:function(a){var b=this.enabledChangeEvent;this.enabledChangeEvent=!1;var c=this.getZoomLevel(),d=this.getMapCenter();this.zoomOnMapRectangle(a);var e=this.getMapRectOfViewport();return this.setZoomLevel(c),this.setMapCenter(d),this.enabledChangeEvent=b,e},getViewRectangleInMapCoordinate:function(){var a,b,d;return a=this.invProject(p),b=this.invProject(this._viewportSize),d=new c(a.x,a.y,b.x-a.x,b.y-a.y)},fromLonLatRectToViewportRect:function(a){var d,e,f;return d=this.fromLonLatToViewport(new b(a.x,a.y)),e=this.fromLonLatToViewport(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},fromViewportRectToLonLatRect:function(a){var d,e,f;return d=this.fromViewportToLonLat(new b(a.x,a.y)),e=this.fromViewportToLonLat(new b(a.x+a.width,a.y+a.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)},transform:function(a){var c=this._transformMatrix.transformPoint(a);return new b(c.x,c.y)},invTransform:function(a){var c=this._invTransformMatrix.transformPoint(a);return new b(c.x,c.y)},fromMapPointToPixel:function(a,c){var d,e,f,h,j=Math.pow(2,c+7);return d=this._projection.project(a),e=g.call(this,d),f=i.apply(this,[e,c]),h=new b(f.x+j,j-f.y)},fromPixelToMapPoint:function(a,c){var d,e,f,g,i=Math.pow(2,c+7);return g=new b(a.x-i,i-a.y),f=j.apply(this,[g,c]),e=h.call(this,f),d=this._projection.invProject(e)},fromLonLatToPixel:function(a,c){var d,e,f,h,j=Math.pow(2,c+7);return d=this._mercatorProjection.project(a),e=g.call(this,d),f=i.apply(this,[e,c]),h=new b(f.x+j,j-f.y)},fromPixelToLonLat:function(a,c){var d,e,f,g,i=Math.pow(2,c+7);return g=new b(a.x-i,i-a.y),f=j.apply(this,[g,c]),e=h.call(this,f),d=this._mercatorProjection.invProject(e)},calculateZoomLevelForMapRectangle:function(a){if(a){var c,d,e,f,g,h,i,j,k,l;return c=new b(a.x,a.y),d=new b(a.x+a.width,a.y+a.height),e=this.fromMapPointToPixel(c,0),f=this.fromMapPointToPixel(d,0),g=Math.abs(e.x-f.x),h=Math.abs(e.y-f.y),i=0===g?Number.MAX_VALUE:this._viewportSize.x/g,j=0===h?Number.MAX_VALUE:this._viewportSize.y/h,k=Math.min(i,j),k===Number.MAX_VALUE?20:l=Math.log(k)/Math.LN2}},calculateCenterPointForMapRectangle:function(a){if(a){var c,d,e,f,g,h;return c=new b(a.x,a.y),d=new b(a.x+a.width,a.y+a.height),e=this.fromMapPointToPixel(c,0),f=this.fromMapPointToPixel(d,0),g=new b((e.x+f.x)/2,(e.y+f.y)/2),h=this.fromPixelToMapPoint(g,0)}},moveViewport:function(a,c){this.setMapCenter(this.invProject(new b(this._viewportSize.x/2-a,this._viewportSize.y/2-c)))},zoom:function(a){a>0&&this.setZoomLevel(this.getZoomLevel()+Math.log(a)/Math.LN2)},zoomOnPixel:function(a,b){if(b>0){var c,d,e;c=this.invTransform(a),e=Math.log(b)/Math.LN2,this.setZoomLevel(this.getZoomLevel()+e),d=this.transform(c),this.moveViewport(a.x-d.x,a.y-d.y)}},zoomOnMapRectangle:function(a,b){if(a){var c,d;c=this.calculateZoomLevelForMapRectangle(a),this._fractionalZoomMode||(c=b?Math.round(c):Math.floor(c)),this.setZoomLevel(c),d=this.calculateCenterPointForMapRectangle(a),this.setMapCenter(d)}},setMaxZoomLevel:function(a){this._maxZoomLevel=a},setMinZoomLevel:function(a){this._minZoomLevel=a},getViewRectangleInLonLat:function(){var a,b;return a=this.fromViewportToLonLat(p),b=this.fromViewportToLonLat(this._viewportSize),new c(Math.min(a.x,b.x),Math.min(a.y,b.y),Math.abs(a.x-b.x),Math.abs(a.y-b.y))},getTransformMatrix:function(){return this._transformMatrix},setTransformMatrix:function(a){var c,d,e;this._invTransformMatrix=a.clone().invert(),c=Math.abs(a.elements[0][0]),d=Math.log(c*this._projectedMapSize)/q-8,e=this.invProject(new b(this._viewportSize.x/2,this._viewportSize.y/2)),this.setZoomLevel(d),this.setMapCenter(e)},getInvTransformMatrix:function(){return this._invTransformMatrix}})}),define("extensions.qliktech/map/map-layer",["objects.views/charts/components/chart-component","objects.views/charts/utils/canvas-renderer"],function(a,b){"use strict";function c(){this._viewportProjectionChanged=!0,this._shouldPaintOnDataChanged||this.invalidateDisplay("onViewportProjectionChanged")}function d(){this._viewportProjectionChanged=!0,this.paint()}function e(){void 0!==this._layerData.opacity&&(this.container.style.opacity=this._layerData.opacity,this.container.style.filter="alpha(opacity="+100*this._layerData.opacity+")")}function f(){this._toggledOnCacheItems.forEach(function(a){a.selected=!1}),this._toggledOnCacheItems=[],this._selectedRows=[]}function g(a){var b=this,c=this._toggledOnCacheItems.map(function(a){return a.row});this.updateBackendApi(),this.backendApi.select2("SelectHyperCubeCells",this._layerPath,c,a).then(function(a){b._selectionFailed=!a.qSuccess,b._selectionFailed&&f.call(b)})}var h;return h=a.extend("MapLayer",{init:function(){this._super.apply(this,arguments),this._viewportProjectionChanged=!1,this._data=void 0,this._layerData=void 0,this._qData=void 0,this._qMatrix=void 0,this._qSelectionInfo=void 0,this._numItems=0,this._layoutMode=void 0,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=void 0,this._layerBounds=void 0,this._cacheItems=null,this._renderer=new b(this.container),this._firstAutoZoomed=!1,this._numPoints=0,this._toggledOnCacheItems=[],this._selectedRows=[]},setData:function(a,b){var c;this._skipInvalidateOnGlobalOpacityChange=!0,this._data=a,this._layerData=b,this._toggledOnCacheItems=[],this._selectedRows=[],c=this._layerData?this._layerData.show:!1,c?this.showComponent():this.hideComponent(),this._qSelectionInfo=this._data?this._data.qSelectionInfo:void 0,e.call(this)},getData:function(){return this._data},getLayerData:function(){return this._layerData},setLayerIndex:function(a){this._layerIndex=a},getLayerIndex:function(){return this._layerIndex},setLayerType:function(a){this._layerType=a},getLayerType:function(){return this._layerType},setVersion:function(a){this._version=a},getVersion:function(){return this._version},setFirstAutoZoomed:function(a){this._firstAutoZoomed=a},getFirstAutoZoomed:function(){return this._firstAutoZoomed},getLayerPath:function(){return this._layerPath},getNumPoints:function(){return this._numPoints},getLayerBounds:function(){return this._layerBounds},setViewportProjection:function(a){this._viewportProjection!==a&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",c,this),this._viewportProjection.stopListen("changedByInteraction",d,this)),this._viewportProjection=a,this._viewportProjection&&(this._viewportProjection.listen("changed",c,this),this._viewportProjection.listen("changedByInteraction",d,this)))},setBackendApi:function(a){this.backendApi=a},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getLayerOutputData:function(){return this._layerData?this._layerData.qHyperCube?{color:this._data.color,legend:this._data.legend,qSelectionInfo:this._data.qSelectionInfo,qHyperCube:this._layerData.qHyperCube}:this._layerData.qListObject?{color:this._data.color,legend:this._data.legend,qSelectionInfo:this._data.qSelectionInfo,qListObject:this._layerData.qListObject}:void 0:void 0},getMeasureInfo:function(){return this._layerData?this._layerData.qHyperCube?this._layerData.qHyperCube.qMeasureInfo:this._layerData.qListObject?this._layerData.qListObject.qMeasureInfo:void 0:void 0},getSelectedRows:function(){return this._toggleOnCacheItemsChanged&&(this._selectedRows=this._toggledOnCacheItems.map(function(a){return a.row}),this._toggleOnCacheItemsChanged=!1),this._selectedRows},setGlobalOpacity:function(a,b){var c=this;this._skipInvalidateOnGlobalOpacityChange=!1,this._globalAlpha=a,b||setTimeout(function(){c._skipInvalidateOnGlobalOpacityChange||(f.call(c),c.invalidateDisplay("MapLayer.setGlobalOpacity"),c._skipInvalidateOnGlobalOpacityChange=!0)},100)},setPreselectionMode:function(a){this._preselectionMode=a},toggleShapes:function(a){var b,c,d,e=a?a.length:0;if(this.isVisible()&&0!==e)for(this._skipInvalidateOnGlobalOpacityChange=!0,b=0;e>b;b++)d=a[b],(-3===d.id||d.id>=0)&&(d.selected&&this._toggledOnCacheItems.indexOf(d)<0?(this._toggledOnCacheItems[this._toggledOnCacheItems.length]=d,this._toggleOnCacheItemsChanged=!0):d.selected||(c=this._toggledOnCacheItems.indexOf(d),c>=0&&(this._toggledOnCacheItems.splice(c,1),this._toggleOnCacheItemsChanged=!0)))},selectOnLayer:function(a,b){this.isVisible()&&(this._toggledOnCacheItems.length?g.call(this,b):a&&a.length&&a.every(function(a){return!a.selected})&&this.clearSelections())},clearSelections:function(){this.updateBackendApi(),this.backendApi.clearSelections()},updateBackendApi:function(){this.backendApi&&this.backendApi.path!==this._layerPath&&(this.backendApi.path=this._layerPath,this.backendApi.path&&(this.backendApi.dataPath=this.backendApi.path.slice(1,-3)))},afterPaint:function(){},clear:function(){this._renderer&&this._renderer.shapes&&this._renderer.shapes.length&&(this._renderer.shapes=[],this._renderer.render(),this.afterPaint())},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},release:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this._viewportProjection=null,this.backendApi=null}})}),define("extensions.qliktech/map/geo-region",["objects.utils/shapes/rect","objects.utils/shapes/geometry-math"],function(a,b){"use strict";function c(a,b){var c=a?a.length:0,d=[];return this._id=b,0===c?void this.setGeoPolygons(d):void this.setGeoPolygons(a)}return c.prototype={setId:function(a){this._id=a},getId:function(){return this._id},setGeoPolygons:function(a){this.geopolygons!==a&&(this.geopolygons=a,this._numGeoPolygons=this.geopolygons?this.geopolygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validateGeoPolygons:function(){var a;for(a=0;a<this._numGeoPolygons;a++)this.geopolygons[a].validatePolygons()},getGeoPolygons:function(){return this.geopolygons},getNumGeoPolygons:function(){return this._numGeoPolygons},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numGeoPolygons;a++)b+=this.geopolygons[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var a;for(a=0;a<this._numGeoPolygons;a++)this.geopolygons[a]&&(this.points=this.points.concat(this.geopolygons[a].getPoints()))}return this.points},pointInside:function(a,b){if(this.calculateBounds(),void 0===this._bounds||a<=this._bounds.x||a>=this._bounds.x+this._bounds.width||b<=this._bounds.y||b>=this._bounds.y+this._bounds.height)return!1;var c;for(c=0;c<this._numGeoPolygons;c++)if(this.geopolygons[c].pointInside(a,b))return!0;return!1},intersectsLine:function(a){if(!a)return!1;var b;for(b=0;b<this._numGeoPolygons;b++)if(this.geopolygons[b].intersectsLine(a))return!0;return!1},intersectsRect:function(a){if(!a)return!1;var b;for(b=0;b<this._numGeoPolygons;b++)if(this.geopolygons[b].intersectsRect(a))return!0;return!1},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numGeoPolygons)return null;var c=b.calculateBounds(this.geopolygons);this._bounds=new a(c.x,c.y,c.width,c.height)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="";for(a=0;a<this._numGeoPolygons-1;a++)b+=this.geopolygons[a].toString()+";";return b+=this.geopolygons[this._numGeoPolygons-1].toString()}},c}),define("extensions.qliktech/map/geo-regions-data",["core.utils/class","objects.utils/shapes/point","objects.utils/shapes/rect","objects.utils/shapes/geometry-math","extensions.qliktech/map/projection/unit-projection"],function(a,b,c,d,e){function f(){var a,b,c,d,e,f,g,h,i,j;for(this._projectedGeoRegions&&this._projectedGeoRegions.length===this._numGeoRegions||(this._projectedGeoRegions=new Array(this._numGeoRegions)),a=0;a<this._numGeoRegions;a++)for(e=this._geoRegions[a].getGeoPolygons(),f=e?e.length:0,this._projectedGeoRegions[a]&&this._projectedGeoRegions[a].length===f||(this._projectedGeoRegions[a]=new Array(f)),b=0;f>b;b++)for(g=e[b].getPolygons(),h=g?g.length:0,this._projectedGeoRegions[a][b]&&this._projectedGeoRegions[a][b].length===h||(this._projectedGeoRegions[a][b]=new Array(h)),c=0;h>c;c++)for(i=g[c].points,j=i?i.length:0,this._projectedGeoRegions[a][b][c]&&this._projectedGeoRegions[a][b][c].length===j||(this._projectedGeoRegions[a][b][c]=new Array(j)),d=0;j>d;d++)this._projectedGeoRegions[a][b][c][d]=this._projection.project(i[d])}function g(){var a;for(this._regionIdToRegionIndexMapping={},a=0;a<this._numGeoRegions;a++)this._regionIdToRegionIndexMapping[this._geoRegions[a].getId()]=a}var h;return h=a.extend("GeoRegionsData",{init:function(){this._numGeoRegions=0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0,this._projectedGeoRegionsNeedToUpdate=!1,
this._projection=new e,this._numPointsNeedToUpdate=!0},getNumGeoRegions:function(){return this._numGeoRegions},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numGeoRegions;a++)b+=this._geoRegions[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},setGeoRegions:function(a){this._geoRegions=a,this._numGeoRegions=this._geoRegions?this._geoRegions.length:0,this._projectedGeoRegionsNeedToUpdate=!0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0},getGeoRegions:function(){return this._geoRegions},getGeoRegionById:function(a){this._regionIdToRegionIndexMappingNeedToUpdate&&(g.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1);var b=this._regionIdToRegionIndexMapping[a];return this._geoRegions[b]},setProjection:function(a){this._projection&&a&&this._projection.getProjectionType()===a.getProjectionType()||(this._projection=a,this._projectedGeoRegionsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0)},getProjection:function(){return this._projection},getProjectedGeoRegions:function(){return this._projectedGeoRegionsNeedToUpdate&&this._projection&&(f.call(this),this._projectedGeoRegionsNeedToUpdate=!1),this._projectedGeoRegions},getProjectedGeoRegionById:function(a){this._regionIdToRegionIndexMappingNeedToUpdate&&(g.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1),this._projectedGeoRegionsNeedToUpdate&&this._projection&&(f.call(this),this._projectedGeoRegionsNeedToUpdate=!1);var b=this._regionIdToRegionIndexMapping[a];return this._projectedGeoRegions[b]},calculateBounds:function(){if(this._mapBoundsNeedToUpdate){this._mapBoundsNeedToUpdate=!1;var a=d.calculateBounds(this._geoRegions);a?this._mapBounds=new c(a.x,a.y,a.width,a.height):this._mapBounds=null}return this._mapBounds},calculateProjectedBounds:function(){if(this._projectedMapBoundsNeedToUpdate){this._projectedMapBoundsNeedToUpdate=!1;var a,d,e=this.calculateBounds();e?(a=this._projection.project(new b(e.x,e.y)),d=this._projection.project(new b(e.x+e.width,e.y+e.height)),this._projectedMapBounds=new c(a.x,a.y,d.x-a.x,d.y-a.y)):this._projectedMapBounds=null}return this._projectedMapBounds},calculateBoundsOfRegionIds:function(a){var b,e,f,g=a?a.length:0,h=new Array(g);for(b=0;g>b;b++)h[b]=this.getGeoRegionById(a[b]);return e=d.calculateBounds(h),f=e?new c(e.x,e.y,e.width,e.height):null},calculateProjectedBoundsOfRegionIds:function(a){var d,e,f,g=this.calculateBoundsOfRegionIds(a);return g?(d=this._projection.project(new b(g.x,g.y)),e=this._projection.project(new b(g.x+g.width,g.y+g.height)),f=new c(d.x,d.y,e.x-d.x,e.y-d.y)):f=null,f}})}),define("extensions.qliktech/map/geo-polygon",["objects.utils/shapes/polygon","objects.utils/shapes/rect","objects.utils/shapes/line","objects.utils/shapes/point","objects.utils/shapes/geometry-math"],function(a,b,c,d,e){"use strict";function f(a){var b,c=a?a.length:0,e=Math.floor(c/2),f=new Array(e);for(b=0;e>b;b++)f[b]=new d(a[2*b],a[2*b+1]);return f}function g(a,b){var c,d=b-1;if(0===b)return-1;for(c=0;d>c;)if(a[c].x+180<o){if(a[c+1].x+180<o)return c;c+=2}else c++;return-1}function h(a,b,c){var d,e;return d=a[c],e=a[c+1],180-Math.abs(d.x)<o&&180-Math.abs(e.x)<o?!0:!1}function i(a,b){return 0>b?b+a:b>=a?b-a:b}function j(a,b,c){var d=b-1;if(h(a,b,i(d,c+2))){if(0===c){if(a[b-2].x>=0)return!0}else if(c===b-2){if(a[b-3].x>=0)return!0}else if(a[c-1].x>=0)return!0}else if(h(a,b,i(d,c-2))){if(0===c){if(a[2].x>=0)return!0}else if(c===b-2){if(a[1].x>=0)return!0}else if(a[c+2].x>=0)return!0}else if(0===c){if(a[b-2].x>=0&&a[2].x>=0)return!0}else if(c===b-2){if(a[b-3].x>=0&&a[1].x>=0)return!0}else if(a[c-1].x>=0&&a[c+2].x>=0)return!0;return!1}function k(a,b,c){0===c?(a[c].x=180,a[c+1].x=180,a[b-1].x=180):c===b-2?(a[c].x=180,a[c+1].x=180,a[0].x=180):(a[c].x=180,a[c+1].x=180)}function l(a){var b,c=a?a.points:null,d=c?c.length:0;b=g(c,d),0>b||j(c,d,b)&&k(c,d,b)}function m(a){var b,c=a?a.length:0;for(b=0;c>b;b++)l(a[b])}function n(b){var c,d=b?b.length:0,e=[];if(0===d)return void this.setPolygons(e);if(b[0].getPoints)this.setPolygons(b);else{for(c=0;d>c;c++)b[c]&&b[c].length&&e.push(new a(f(b[c])));this.setPolygons(e)}}var o=1e-5;return n.prototype={setPolygons:function(a){this.polygons!==a&&(this.polygons=a,this._numPolygons=this.polygons?this.polygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validatePolygons:function(){m(this.polygons)},getPolygons:function(){return this.polygons},getNumPolygons:function(){return this._numPolygons},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var a;for(a=0;a<this._numPolygons;a++)this.polygons[a]&&(this.points=this.points.concat(this.polygons[a].getPoints()))}return this.points},getNumPoints:function(){if(this._numPointsNeedToUpdate){var a,b=0;for(a=0;a<this._numPolygons;a++)b+=this.polygons[a].getNumPoints();this._numPoints=b,this._numPointsNeedToUpdate=!1}return this._numPoints},pointInside:function(a,b){if(this.calculateBounds(),void 0===this._bounds||a<=this._bounds.x||a>=this._bounds.x+this._bounds.width||b<=this._bounds.y||b>=this._bounds.y+this._bounds.height)return!1;var c,d,e;if(0===this._numPolygons)return!1;if(this.polygons[0].pointInside(a,b)){for(d=this._innerPolygons?this._innerPolygons.length:0,c=0;d>c;c++)if(this.polygons[this._innerPolygons[c]].pointInside(a,b))return!1;return!0}for(e=this._outerPolygons?this._outerPolygons.length:0,c=0;e>c;c++)if(this.polygons[this._outerPolygons[c]].pointInside(a,b))return!0;return!1},intersectsLine:function(a){if(!a)return!1;if(this.pointInside(a.x1,a.y1)||this.pointInside(a.x2,a.y2))return!0;var b;for(b=0;b<this._numPolygons;b++)if(this.polygons[b].intersectsLine(a))return!0;return!1},intersectsLines:function(a){var b,c=a?a.length:0;for(b=0;c>b;b++)if(this.intersectsLine(a[b]))return!0;return!1},intersectsRect:function(a){if(!a)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(a.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(a))return!1;var b,d,e,f,g;return b=a.x,d=a.getRight(),e=a.y,f=a.getBottom(),this.pointInside(b,e)||this.pointInside(d,e)||this.pointInside(d,f)||this.pointInside(b,f)?!0:(g=[new c(b,e,d,e),new c(b,f,d,f),new c(b,e,b,f),new c(d,e,d,f)],this.intersectsLines(g))},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numPolygons)return null;var a,c,d,f=e.calculateBounds(this.polygons);for(this._bounds=new b(f.x,f.y,f.width,f.height),a=this.polygons[0].calculateBounds(),this._innerPolygons=[],this._outerPolygons=[],d=1;d<this._numPolygons;d++)c=this.polygons[d].calculateBounds(),a.rectInside(c)&&this.polygons[0].pointInside(this.polygons[d].points[0].x,this.polygons[d].points[0].y)?this._innerPolygons.push(d):this._outerPolygons.push(d)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var a,b="";for(a=0;a<this._numPolygons-1;a++)b+=this.polygons[a].toString()+";";return b+=this.polygons[this._numPolygons-1].toString()}},n}),define("extensions.qliktech/map/map-polygon-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","objects.utils/shapes/point","objects.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon"],function(a,b,c,d,e,f,g,h){"use strict";function i(){return this._dimensionTitle!==this._qData.qDimensionInfo.qFallbackTitle?(this._dimensionTitle=this._qData.qDimensionInfo.qFallbackTitle,!0):!1}function j(){var a=this._qData.qExpressions.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._qData.qExpressions[a-1])?(this._geometryMeasureInfo=this._qData.qExpressions[a-1],!0):this._rawGeoRegions||this._loadingGeometryData?!1:!0}function k(a){var b,c=a?a.length:0;for(b=0;c>b;b++)a[b]=new d(a[b][0],a[b][1]);return new e(a)}function l(a){var b,c=a?a.length:0,d=new Array(c);for(b=0;c>b;b++)d[b]=k(a[b]);return new h(d)}function m(a,b){var c,d,e="-"===b?[]:JSON.parse(b),g=e.length;for(c=0;g>c;c++)e[c]=l(e[c]);return d=new f(e,a)}function n(a){this._rawGeoRegions=a,this._geoRegionsData.setGeoRegions(a),"$mercator"!==this._qExpressions[1].projection?(this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._layerBounds=this._geoRegionsData.calculateProjectedBounds()):this._layerBounds=this._geoRegionsData.calculateBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function o(){var a=this,b=this._layerIndex,c=Math.min(this._qData.qSize.qcy||u,u);this._loadingGeometryData=!0,this.backendApi.getData("GetListObjectData","/layers/"+b+"/qListObjectDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:c}]).then(function(b){if(a.backendApi&&a._viewportProjection){a._loadingGeometryData=!1,a._rawGeoRegions={};var c,d,e,f,g,h=0,i=b?b.qDataPages:void 0,j=i?i instanceof Array&&i[0]?i[0].qMatrix:i.qMatrix:void 0;if(j&&0!==j.length){for(a._geometryDimensionIdx=2,g=j?j.length:0,e=new Array(g),c=0;g>c;c++)f=j[c][0].qText,d=j[c][a._geometryDimensionIdx].qText,e[c]=m(f,d),e[c].validateGeoPolygons(),h+=e[c].getNumPoints();n.call(a,e),a._dataChanged=!0,a.fire("dataChanged"),a._numPoints!==h&&(a._numPoints=h,a.fire("numPointsChanged",[a])),a.invalidateProperties("MapPolygonLayer.setGeoRegionsData"),a.invalidateDisplay("MapPolygonLayer.setGeoRegionsData")}}})}function p(a){var b,c,d,e,f,g,h=a.qExpressions,i=a.qDimensionInfo,j=a.qDataPages[0]?a.qDataPages[0].qMatrix:void 0,k=j?j.length:0,l=-Number.MAX_VALUE,m=Number.MAX_VALUE;if(!this._hasMeasure)return void(a.qMeasureInfo=[]);for(b={qFallbackTitle:void 0===h[0].qLabel?h[0].qExpr:h[0].qLabel},c=0;k>c;c++)d=j[c],e=d[0].qState,f="S"===e||"O"===e||"L"===e,f?(g=d[1].qNum,g>l&&(l=g),m>g&&(m=g)):d[1].qNum=NaN;b.qMax=l===-Number.MAX_VALUE?NaN:l,b.qMin=m===Number.MAX_VALUE?NaN:m,b.qNumFormat=i.qNumFormat,b.qIsAutoFormat=i.qIsAutoFormat,a.qMeasureInfo=[b]}function q(a,b){var c,d,f,g,i,j,k,l,m,n=a?a.length:0,o=new Array(n);for(j=0;n>j;j++){for(c=a[j],d=c?c.length:0,m=new Array(d),k=0;d>k;k++){for(f=c[k],i=f?f.length:0,g=new Array(i),l=0;i>l;l++)g[l]=this._viewportProjection.project(f[l]);m[k]=new e(g)}o[j]=new h(m)}b.setGeoPolygons(o)}function r(){this._toggledOnCacheItems.forEach(function(a){a.selected=!1}),this._toggledOnCacheItems=[],this._selectedRows=[]}function s(){var a=this,b=this.getSelectedRows();this.updateBackendApi(),this.backendApi.select("SelectListObjectValues",this._layerPath,b,!1).then(function(b){a._selectionFailed=!b.qSuccess,a._selectionFailed&&r.call(a)})}var t,u=1e3,v="#ddd",w=new c(v),x="#333",y="#333";return t=a.extend("MapPolygonLayer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new g,this.renderers={polygonlayer:this._renderer}},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/qListObjectDef"},getDataType:function(){return"listObject"},setData:function(a,b){this._super(a,b),this._qData=this._layerData?this._layerData.qListObject:void 0,this._qMatrix=this._qData&&this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._numItems=this._qMatrix?this._qMatrix.length:0,this._qExpressions=this._qData?this._qData.qExpressions:void 0,this._hasMeasure=this._qExpressions&&this._qExpressions[0]&&this._qExpressions[0].qExpr?!0:!1,p.call(this,this._qData),this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this.show&&this._qExpressions&&this._qExpressions[1]&&this._qExpressions[1].qExpr&&(i.call(this)||j.call(this))?o.call(this):(this._dataChanged=!0,this.fire("dataChanged"),this.invalidateProperties("MapPolygonLayer.setData"))},hasValidData:function(){return this._super()&&this._layerData},getSelectedRows:function(){return this._toggleOnCacheItemsChanged&&(this._selectedRows=this._toggledOnCacheItems.map(function(a){return a.id}),this._toggleOnCacheItemsChanged=!1),this._selectedRows},selectOnLayer:function(a){if(this.isVisible()){var b,c,d,e;if(this._singleSelectedItemClicked=!1,this._toggledOnCacheItems.length){if(1===this._toggledOnCacheItems.length&&1===this._numSelectedItems&&0===this._numSelectedExcludedItems&&this._selectedCacheItem===this._toggledOnCacheItems[0])return void(this._singleSelectedItemClicked=!0);s.call(this)}else{if(a&&1===a.length&&!a[0].selected&&(b=a[0].row,c=this._qMatrix[b],d=c[0].qState,e="S"===d||"L"===d))return;a&&a.length&&a.every(function(a){return!a.selected})&&this.clearSelections()}}},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||0===this._qExpressions.length||""===this._qExpressions[1].qExpr||void 0===this._qExpressions[1].qExpr||null===this._qExpressions[1].qExpr)return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),0!==this._numItems){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=this._qMatrix,p=this._hasMeasure?0:-1,r=[],s=[],t=0,u=0;for(this._skipInvalidateOnGlobalOpacityChange=!0,this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections,this._selectionByLayer||this._nodes.some(function(a){return a.cacheItem.selected})&&(this._singleSelectedItemClicked?(this._nodes.forEach(function(a){a.cacheItem.selected=!1}),this._singleSelectedItemClicked=!1):this._selectionByLayer=!0),a=0;a<this._numItems;a++)b=o[a],c=b[0],d=c.qState,e=c.qText,f=this._nodes[a],g=f.shapeWrapper,h=g.shape,i=this._geoRegionsData.getProjectedGeoRegionById(e),q.apply(this,[i,h]),j=f.cacheItem,k="S"===d||"O"===d||"L"===d,n=f.color,!k&&j.selected&&(m=this._hasMeasure?b[1].qNum:null,n=this._colorMap.getColor(c.qElemNumber,m,p,a)),g.fill=n.toRGBA(),this._selectionByLayer?(l=j.selected,g.stroke=l?y:x,g.strokeWidth=l?2:1):(l=k,g.stroke=x,g.strokeWidth=1),l?(g.opacity=1,s[u++]=g):(g.opacity=this._globalAlpha,r[t++]=g);this._rendererShapes=0===this._numItems?[]:r.concat(s),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1,this._selectionFailed=!1,this.afterPaint()}}},getSnapshotLayerData:function(a){var b=Math.min(this._qData.qSize.qcy||u,u);return this.backendApi.getData("GetListObjectData","/layers/"+this._layerIndex+"/qListObjectDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:b}]).then(function(b){a.qListObject.qDataPages=b.qDataPages})},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var a,c,d,e,g,h,i,j,k,l,m,n,o,p,q=this._qMatrix,r=this._hasMeasure?0:-1,s=this._hasMeasure?this._qMeasureInfo[0].qFallbackTitle:"";for(this._singleSelectedItemClicked=!1,this._regionsChanged=!0,this._numSelectedItems=0,this._numSelectedExcludedItems=0,this._nodes=new Array(this._numItems),m=new Array(this._numItems),a=0;a<this._numItems;a++)c=q[a],d=c[0],e=c[1],g=d.qState,h=d.qText,i=d.qElemNumber||0,j=new f(void 0,h),j.rowIndex=a,l=new b([h],[],[],[],a,0,i),l.selected=!1,l.layerIndex=this._layerIndex,l.addShape("dataArea",j,!0),n="S"===g||"O"===g||"L"===g,o=this._hasMeasure?e.qNum:null,p=n?this._colorMap.getColor(d.qElemNumber,o,r,a):w,this._hasMeasure&&n&&l.addMeasure(s,o,e.qText),m[a]=l,k={type:"multipolygon",shape:j},this._nodes[a]={shapeWrapper:k,cacheItem:l,color:p},"S"===g&&(this._numSelectedItems++,this._selectedCacheItem=l),"XS"===g&&this._numSelectedExcludedItems++;this.setSelectableShapes(m),this.fire("selectableShapesChanged"),this._dataChanged=!1}}})}),define("extensions.qliktech/map/map-polygon3-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","objects.utils/shapes/point","objects.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon"],function(a,b,c,d,e,f,g,h){"use strict";function i(){return this._showExcluded?this._allItemsBounds:j.call(this)}function j(){var a,b=new Array(this._numItems);for(a=0;a<this._numItems;a++)b[a]=this._qMatrix[a][0].qText;return"$mercator"!==this._geoData.qMeasureInfo[0].projection?this._geoRegionsData.calculateProjectedBoundsOfRegionIds(b):this._geoRegionsData.calculateBoundsOfRegionIds(b)}function k(){return this._qData&&this._qData.qDimensionInfo&&this._qData.qDimensionInfo[0]?this._dimensionTitle!==this._qData.qDimensionInfo[0].qFallbackTitle?(this._dimensionTitle=this._qData.qDimensionInfo[0].qFallbackTitle,!0):!1:void 0!==this._dimensionTitle?(this._dimensionTitle=void 0,!0):!1}function l(){var a=this._geoData.qMeasureInfo.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._geoData.qMeasureInfo[a-1])?(this._geometryMeasureInfo=this._geoData.qMeasureInfo[a-1],!0):this._rawGeoRegions||this._loadingGeometryData?!1:!0}function m(a){var b,c=a?a.length:0;for(b=0;c>b;b++)a[b]=new d(a[b][0],a[b][1]);return new e(a)}function n(a){var b,c=a?a.length:0,d=new Array(c);for(b=0;c>b;b++)d[b]=m(a[b]);return new h(d)}function o(a,b){var c,d,e="-"===b?[]:JSON.parse(b),g=e.length;for(c=0;g>c;c++)e[c]=n(e[c]);return d=new f(e,a)}function p(a){this._rawGeoRegions=a,this._geoRegionsData.setGeoRegions(a),"$mercator"!==this._geoData.qMeasureInfo[0].projection?(this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._allItemsBounds=this._geoRegionsData.calculateProjectedBounds()):this._allItemsBounds=this._geoRegionsData.calculateBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function q(){var a=this,b=this._layerIndex,c=Math.min(this._geoData.qSize.qcy||u,u),d=[{qTop:0,qLeft:0,qWidth:2,qHeight:c}];this._loadingGeometryData=!0,this.backendApi.getData("GetHyperCubeData","/layers/"+b+"/geodata/qHyperCubeDef",d).then(function(b){if(a.backendApi&&a._viewportProjection){a._loadingGeometryData=!1,a._rawGeoRegions={};var c,d,e,f,g,h=0,i=b?b.qDataPages:void 0,j=i?i instanceof Array&&i[0]?i[0].qMatrix:i.qMatrix:void 0;for(g=j?j.length:0,a._qMatrix2=j,a._numRegions=g,a._geometryDimensionIdx=1,e=new Array(g),c=0;g>c;c++)f=j[c][0].qText,d=j[c][a._geometryDimensionIdx].qText,e[c]=o(f,d),e[c].validateGeoPolygons(),h+=e[c].getNumPoints();p.call(a,e),a._dataChanged=!0,a.fire("dataChanged"),a._numPoints!==h&&(a._numPoints=h,a.fire("numPointsChanged",[a])),a.invalidateProperties("MapPolygon3Layer.setGeoRegionsData"),a.invalidateDisplay("MapPolygon3Layer.setGeoRegionsData")}})}function r(a,b){var c,d,f,g,i,j,k,l,m,n=a?a.length:0,o=new Array(n);for(j=0;n>j;j++){for(c=a[j],d=c?c.length:0,m=new Array(d),k=0;d>k;k++){for(f=c[k],i=f?f.length:0,g=new Array(i),l=0;i>l;l++)g[l]=this._viewportProjection.project(f[l]);m[k]=new e(g)}o[j]=new h(m)}b.setGeoPolygons(o)}function s(a){return void 0===a||null===a||""===a}var t,u=1e3,v="#ddd",w=new c(v),x="#333",y="#333";return t=a.extend("MapPolygon3Layer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new g,this.renderers={polygonlayer:this._renderer},this._numRegions=0},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/geodata/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(a,b){this._super(a,b),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._geoData=this._layerData?this._layerData.geodata.qHyperCube:void 0,this._qMatrix=this._qData&&this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._numItems=this._qMatrix?this._qMatrix.length:0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._hasMeasure=this._qMeasureInfo&&this._qMeasureInfo.length>0,this._geoDataHeight=this._geoData&&this._geoData.qSize?this._geoData.qSize.qcy:0,this._showExcluded=void 0===b.showExcluded?!0:b.showExcluded,this.show&&(this._geoDataHeight!==this._numRegions||k.call(this)||l.call(this))?q.call(this):(this._dataChanged=!0,this.fire("dataChanged"),this.invalidateProperties("MapPolygon3Layer.setData"))},hasValidData:function(){return this._super()&&this._layerData},getNumSelectedItems:function(){return this._numSelectedItems},getSelectedCacheItem:function(){return this._selectedCacheItem},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||!this._geoData||!this._geoData.qMeasureInfo||0===this._geoData.qMeasureInfo.length||s(this._geoData.qMeasureInfo[0].qFallbackTitle))return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),0!==this._numRegions){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=this._qMatrix2,p=this._hasMeasure?0:-1,q=[],t=[],u=0,v=0;for(n=this._rowIndexList?this._rowIndexList.length:0,this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections||this._nodes.some(function(a){return a.cacheItem.selected}),a=0;n>a;a++)b=this._rowIndexList[a],c=o[b],d=c[0],e=d.qText,f=this._nodeMap[e],g=f.shapeWrapper,h=g.shape,i=this._geoRegionsData.getProjectedGeoRegionById(e),r.apply(this,[i,h]),j=f.cacheItem,k=-1!==f.index,m=f.color,!k&&j.selected&&(m=this._colorMap.getColor(d.qElemNumber,NaN,p,b)),g.fill=m.toRGBA(),this._selectionByLayer?(l=j.selected,g.stroke=l?y:x,g.strokeWidth=l?2:1):(l=k,g.stroke=x,g.strokeWidth=1),l?(g.opacity=1,t[v++]=g):(g.opacity=this._globalAlpha,q[u++]=g);this._rendererShapes=q.concat(t),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1,this.afterPaint()}}},getSnapshotLayerData:function(a){var b=Math.min(this._geoData.qSize.qcy||u,u);return this.backendApi.getData("GetHyperCubeData","/layers/"+this._layerIndex+"/geodata/qHyperCubeDef",[{qTop:0,qLeft:0,qWidth:2,qHeight:b}]).then(function(b){a.geodata.qHyperCube.qDataPages=b.qDataPages})},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var a,c,d,e,g,h,j,k,l,m,n,o,p,q,r=this._qMatrix2,s=this._hasMeasure?0:-1,t=this._hasMeasure?this._qMeasureInfo[0].qFallbackTitle:"";if(this._regionsChanged=!0,this._numSelectedItems=0,this._regionIdDictionary={},this._nodeMap={},this._showExcluded)for(this._nodes=new Array(this._numRegions),n=new Array(this._numRegions),this._rowIndexList=new Array(this._numRegions),a=0;a<this._numRegions;a++)d=r[a],e=d[0],h=e.qText,j=e.qElemNumber||0,k=new f(void 0,h),k.rowIndex=a,m=new b([h],[],[],[],a,0,j),m.selected=!1,m.layerIndex=this._layerIndex,m.addShape("dataArea",k,!0),n[a]=m,l={type:"multipolygon",shape:k},this._nodeMap[h]=this._nodes[a]={shapeWrapper:l,cacheItem:m,color:w,index:-1},this._rowIndexList[a]=a;else{for(r=this._qMatrix,a=0;a<this._numItems;a++)h=r[a][0].qText,this._regionIdDictionary[h]=!0;for(this._nodes=new Array(this._numItems),n=new Array(this._numItems),this._rowIndexList=new Array(this._numItems),c=0,r=this._qMatrix2,a=0;a<this._numRegions;a++)d=r[a],e=d[0],h=e.qText,this._regionIdDictionary[h]&&(j=e.qElemNumber||0,k=new f(void 0,h),k.rowIndex=a,m=new b([h],[],[],[],a,0,j),m.selected=!1,m.layerIndex=this._layerIndex,m.addShape("dataArea",k,!0),n[c]=m,l={type:"multipolygon",shape:k},this._nodeMap[h]=this._nodes[c]={shapeWrapper:l,cacheItem:m,color:w,index:-1},this._rowIndexList[c]=a,c++)}for(r=this._qMatrix,a=0;a<this._numItems;a++)d=r[a],e=d[0],g=d[1],h=e.qText,p=this._nodeMap[h],p&&(m=p.cacheItem,o=this._hasMeasure?g.qNum:null,p.color=this._colorMap.getColor(e.qElemNumber,o,s,a),this._hasMeasure&&m.addMeasure(t,o,g.qText),p.index=a,this._selectedCacheItem=m);this._numSelectedItems=this._numItems,this.setSelectableShapes(n),this.fire("selectableShapesChanged"),this._dataChanged=!1,q=i.call(this),q&&q.equal(this._layerBounds)||(this._layerBounds=q,!this._layerBounds||0===this._layerBounds.width&&0===this._layerBounds.height||this.fire("boundsChanged",[this]))}}})}),define("extensions.qliktech/map/map-glyph-layer",["extensions.qliktech/map/map-layer","extensions.qliktech/scatterplot/scatter-helper","objects.views/selections/cache-item-combo","objects.utils/shapes/rect"],function(a,b,c,d){"use strict";function e(){var a,b,c,e,f,g=Number.MAX_VALUE,h=Number.MAX_VALUE,i=-Number.MAX_VALUE,j=-Number.MAX_VALUE;for(a=0;a<this._numItems;a++)b=this._nodes[a].shapeWrapper.shape,c=b.position,!c||isNaN(c.x)||isNaN(c.y)||(g=Math.min(g,c.x),h=Math.min(h,c.y),i=Math.max(i,c.x),j=Math.max(j,c.y));return g===Number.MAX_VALUE||h===Number.MAX_VALUE||i===-Number.MAX_VALUE||j===-Number.MAX_VALUE?void 0:(e=i-g,f=j-h,new d(g,h,e,f))}function f(){var a,c,d,e,f,g=3,h=1;for(a=0;a<this._numItems;a++)if(d=this._nodes[a].shapeWrapper.shape)if(0===d.type)d.position?(e=this._viewportProjection.project(d.position),d.setPosition(e.x,e.y)):d.setPosition(NaN,NaN);else if(d.position){if(e=this._viewportProjection.project(d.position),f=d.points,!f||13!==f.length)for(f=new Array(13),c=0;13>c;c++)f[c]={};f=b.updateCross(f,e.x,e.y,g,h),d.set(f)}else d.set([])}function g(){this._hasMeasure?void 0===this._layerData.autoMinMax||this._layerData.autoMinMax===!0?(this._qMin=this._qMeasureInfo[0].qMin,this._qMax=this._qMeasureInfo[0].qMax):(this._qMin=this._layerData.customMin,this._qMax=this._layerData.customMax):(this._qMin=void 0,this._qMax=void 0)}function h(){return isNaN(this._qMin)||void 0===this._qMin||null===this._qMin?!1:isNaN(this._qMax)||void 0===this._qMax||null===this._qMax?!1:this._qMax<this._qMin?!1:!0}var i,j=1e3,k="#333";return i=a.extend("MapPointLayer",{init:function(){this._super.apply(this,arguments),this.renderers={pointlayer:this._renderer},this._layerBounds=void 0,this._useSize=!0},setLayerIndex:function(a){this._layerIndex=a,this._layerPath="/layers/"+this._layerIndex+"/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(a,b){this._super(a,b),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._qMatrix=this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._qDimensionInfo=this._qData?this._qData.qDimensionInfo:void 0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._numMeasures=this._qMeasureInfo?this._qMeasureInfo.length:0,this._hasMeasure=this._numMeasures>0&&this._qMeasureInfo[0].qFallbackTitle?!0:!1,this._data&&this._data.color&&!this._data.color.persistent&&(this._data.color.persistent=!0),g.call(this),this._isValidMinMax=h.call(this),this._qRange=this._qMax-this._qMin,this._numItems=this._qMatrix?this._qMatrix.length:0,this._needUpdateProperties=!0,this._needPaint=!0,this._hasMeasure&&this._useSize?this._maxDotSize=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32:this._maxDotSize=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this.fire("dataChanged"),this.invalidateProperties("MapPointLayer.setData")},hasValidData:function(){return this._super()&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle},getNumSelectedItems:function(){return this._numItems},getLayerBounds:function(){var a,b,c,d,e;return a=this._viewportProjection.getSize(),this._layerBounds?(this._layerBounds2=this._layerBounds.clone(),a&&(e=2*(this._maxDotSize+1),c=a.x-e,d=a.y-e,b=Math.min(c/this._layerBounds.width,d/this._layerBounds.height),c=b*this._layerBounds.width,d=b*this._layerBounds2.height,b=Math.min(a.x/c,a.y/d),this._layerBounds2.scale(b)),this._layerBounds2):this._layerBounds},paint:function(){if(this._super(this._layoutMode,this._data),!(this.show&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle&&this._viewportProjection&&0!==this._qMatrix.length&&void 0!==this._qMatrix[0][1]))return this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),void 0!==this._nodes){var a,b,c,d,e,g,h,i,j,l=[],m=[],n=0,o=0;for((this._glyphsChanged||this._viewportProjectionChanged)&&f.call(this),a=0;a<this._numItems;a++)b=this._nodes[a],i=b.shapeWrapper,j=i.shape,j&&j.position&&(c=b.color,d=b.cacheItem.selected,d?(e=k,g=2,h=1,m[o++]=i):(e=c.createShiftedColor().toRGBA(),g=1,h=this._globalAlpha,l[n++]=i),i.stroke=e,i.strokeWidth=g,i.opacity=h);this._rendererShapes=0===this._numItems?[]:l.concat(m),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,this.afterPaint()}},setRect:function(a,b,c,d){this._super(a,b,c,d),this.rect&&this.rect.x===a&&this.rect.y===b&&this.rect.width===c&&this.rect.height===d||!this._layerBounds||0===this._layerBounds.width&&0===this._layerBounds.height||this.fire("boundsChanged",[this])},getSnapshotLayerData:function(a){var b=Math.min(this._qData.qSize.qcy||j,j);return this.backendApi.getData("GetHyperCubeData","/layers/"+this._layerIndex+"/qHyperCubeDef",[{qTop:0,qLeft:0,qWidth:3,qHeight:b}]).then(function(b){a.qHyperCube.qDataPages=b.qDataPages})},_updateProperties:function(){if(this.show&&this._needUpdateProperties&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle){var a,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=this._qMatrix,y=this._hasMeasure?0:-1,z="polygon",A="circle";for(t=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[0]?this._layerData.rangeBubbleSizes[0]:2,u=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32,s=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this._useSize=this._layerData.useSize,this._glyphsChanged=!0,this._nodes=new Array(this._numItems),l=[],m={},n=0,this._geoDataIsProjected=this._qDimensionInfo&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qTags&&this._qDimensionInfo[1].qTags.indexOf("$mercator")>-1,q=this._viewportProjection.getMercatorProjection(),v=this._hasMeasure&&this._useSize,a=0;a<this._numItems;a++)f=x[a][0].qText,g=x[a][0].qElemNumber||0,h=x[a][2]?x[a][2].qNum:void 0,v?this._isValidMinMax?(r=b.getDotRadius(h,this._qMin,this._qMax,t,u),isNaN(r)?(i=b.createShape(z),i.type=1,j=z):(i=b.createShape(A,[0,0,r,0]),i.type=0,j=A)):(i=b.createShape(z),i.type=1,j=z):(i=b.createShape(A,[0,0,s,0]),i.type=0,j=A),"-"===x[a][1].qText?i.position=void 0:(d=JSON.parse(x[a][1].qText),i.position=this._geoDataIsProjected?{x:d[0],y:d[1]}:q.project({x:d[0],y:d[1]})),i.rowIndex=a,m[f]?k=m[f].cacheItem:(k=new c([f],[],[],[],a,0,g),k.selected=!1,k.layerIndex=this._layerIndex,m[f]={cacheItem:k,numShapes:0},l[n++]=k),k.addShape("dataArea",i,!0,[m[f].numShapes]),m[f].numShapes++,this._hasMeasure&&k.addMeasure(this._qMeasureInfo[0].qFallbackTitle,x[a][2].qNum,x[a][2].qText),p=this._colorMap.getColor([x[a][0].qElemNumber,x[a][1].qElemNumber],h,y,a),o={type:j,fill:p.toRGBA(),shape:i},this._nodes[a]={shapeWrapper:o,cacheItem:k,color:p};this.setSelectableShapes(l),this.fire("selectableShapesChanged"),this._dimensionTitle=this._qDimensionInfo[0].qFallbackTitle,this._needUpdateProperties=!1,w=e.call(this),w&&w.equal(this._layerBounds)||(this._layerBounds=w,!this._layerBounds||0===this._layerBounds.width&&0===this._layerBounds.height||this.fire("boundsChanged",[this]))}}})}),define("extensions.qliktech/map/base-map-layer",["jquery","angular","objects.views/charts/components/chart-component","objects.utils/shapes/rect","objects.utils/shapes/point","client.utils/state","openlayers","general.services/media-tool/media-tool-service"],function(a,b,c,d,e,f,g,h){"use strict";function i(){var a,b,c,d;a=this._viewportProjection?this._viewportProjection.getViewRectangleInLonLat():void 0,a&&(b=new g.Geometry.Point(a.x,a.y),b.transform(u,t),c=new g.Geometry.Point(a.x+a.width,a.y+a.height),c.transform(u,t),d=new g.Bounds,d.extend(b),d.extend(c),d.toBBOX(),this._openLayers.zoomToExtent(d))}function j(){g.Map.prototype.adjustZoom=function(a){return a};var a=g.Element.hasClass;g.Element.hasClass=function(b,c){return b&&a(b,c)};var b=g.Event.observe;
g.Event.observe=function(a,c,d,e){var f=g.Util.getElement(a);f&&b.apply(this,[a,c,d,e])},t=new g.Projection("EPSG:900913"),u=new g.Projection("EPSG:4326")}function k(a){this._attribution=h.toHTML(a),this.fire("attributionChanged",[a])}function l(){var a,b;a=this._viewportProjection.getZoomLevel(),b=this._viewportProjection.getMapCenterInLonLat(),this.setMapCenter(b),this.setZoomLevel(a)}function m(){if(this._viewportProjection&&this.show){var a,b,c,d,e=!1;a=this.getZoomLevel(),b=this.getMapCenter(),c=this._viewportProjection.getZoomLevel(),d=this._viewportProjection.getMapCenterInLonLat(),b||(b=d),Math.abs(a-c)<.001&&(!d||d.closeTo(b,1e-6))||(this._viewportProjection.enabledChangeEvent=!1,e=e||this._viewportProjection.setZoomLevel(a),e=e||this._viewportProjection.setMapCenterInLonLat(b),this._viewportProjection.inResetZoomMode&&(this._viewportProjection.inResetZoomMode=!1,this._viewportProjection.fire("resetZoomFinished")),e&&this._viewportProjection.fire("changed"),this._viewportProjection.enabledChangeEvent=!0)}}function n(a){a.events.register("loadend",this,m),this._openLayers.addLayer(a),this._openLayers.setBaseLayer(a),o.call(this),this._baseLayer=a}function o(){this._baseLayer&&(this._openLayers.removeLayer(this._baseLayer),this._baseLayer.events.unregister("loadend",this,m)),this._baseLayer=void 0}function p(a){var c,d=a.urls,e=a.attribution||"";(this._urls!==d||this._attribution!==e)&&(b.equals(this._urls,d)||(this._urls=d,this._urls&&this._urls.some(function(a){return a&&a.trim()})?(c=new g.Layer.XYZ("XYZ",this._urls,{wrapDateLine:!0}),n.call(this,c)):o.call(this)),this._attribution!==e&&k.call(this,e))}function q(a){var c,d=a.urls,e=a.params||"";try{e=JSON.parse(e)}catch(f){return}(this._urls!==d||this._params!==e)&&(this._params=e,b.equals(this._urls,d)||(this._urls=d,this._urls?(c=new g.Layer.WMS("WMS",this._urls,this._params),n.call(this,c)):o.call(this)))}function r(a){var c,d=a.urls,e=a.params||"";try{e=JSON.parse(e)}catch(f){return}b.equals(this._urls,d)||(this._params=e,this._urls!==d&&(this._urls=d,this._urls?(c=new g.Layer.TMS("TMS",this._urls?this._urls:"blank",this._params),n.call(this,c)):o.call(this)))}var s,t,u,v,w=1e-9,x=1e-4,y=20,z=0;return j(),s=c.extend("BaseMapLayer",{init:function(){function b(){v=new g.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}}),c._openLayers=new g.Map({div:c.container,transitionEffect:null,zoomMethod:null,controls:[v],projection:new g.Projection("EPSG:900913"),displayProjection:new g.Projection("EPSG:4326"),maxExtent:new g.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),displayOutsideMaxExtent:!0,wrapDateLine:!0}),c._viewState!==f.States.analysis&&c._openLayers.controls.length&&v.deactivate(),c._minZoomLevel=0,c._maxZoomLevel=20,i.call(c),c._zoomCenterInitialized=!1,c._viewportProjection&&(c.updateViewportToBaseMap(!1),c._zoomCenterInitialized=!0),c._ready=!0}this._super.apply(this,arguments),this._attribution=null,this._mapCenter=null,this._zoomLevel=null,this._layerNames=["OSM","MQ-OSM","MQSatellite"],this._selectedLayerName="OSM",this._googleMapLayersAdded=!1,this._isBingMapUsed=!1,this._needToSetBackgroundMapType=!1;var c=this;a(this.container).css({width:"100%",height:"100%"}),b()},getAttribution:function(){return void 0===this._attribution?"":this._attribution},setViewportProjection:function(a){this._viewportProjection!==a&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",l,this),this._viewportProjection.stopListen("changedByInteraction",l,this)),this._viewportProjection=a,this._viewportProjection&&(this._viewportProjection.listen("changed",l,this),this._viewportProjection.listen("changedByInteraction",l,this)),this.updateViewportToBaseMap(!0))},setRect:function(a,b,c,e){this._super(a,b,c,e),this._viewport=new d(a,b,c,e)},getViewport:function(){return this._viewport},setFirstAutoZoomed:function(a){this._firstAutoZoomed=a},getFirstAutoZoomed:function(){return this._firstAutoZoomed},hasValidSize:function(){if(!this._openLayers)return!1;var a=this._openLayers.getSize();return a&&a.w>0&&a.h>0},isReady:function(){return this._ready&&this._openLayers&&this._openLayers.layers&&this._openLayers.layers.length>0&&this._baseLayer},setViewState:function(a){this._viewState=a,this._openLayers&&0!==this._openLayers.controls.length&&this._viewState!==f.States.analysis&&v.deactivate()},showComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!0),this.updateViewportToBaseMap(!0)},hideComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!1)},getMapCenter:function(){if(this.show&&this.isReady()&&this.hasValidSize()){var a=this._openLayers.getCenter();if(a)return a.transform(this._openLayers.getProjectionObject(),u),new e(a.lon,a.lat)}},setMapCenter:function(a){if(a&&this.show&&this.isReady()&&this.hasValidSize()){var b,c;b=this.getMapCenter(),b&&b.closeTo(a,w)||(this._mapCenter=a,c=new g.LonLat(a.x,a.y),c.transform(u,this._openLayers.getProjectionObject()),this._openLayers.setCenter(c))}},getZoomLevel:function(){return this.show&&this.isReady()&&this.hasValidSize()?this._openLayers.zoom:0},setZoomLevel:function(a){this.show&&this._openLayers&&this.hasValidSize()&&!(Math.abs(this.getZoomLevel()-a)<x)&&this.isReady()&&(this._zoomLevel=a,this._openLayers.zoomTo(a))},panBy:function(a,b){this.show&&this.isReady()&&this.hasValidSize()&&this._openLayers.moveByPx(a,b)},fromLonLatToViewport:function(a){if(!this.show||!this.isReady()||!this.hasValidSize())return void 0;var b,c;return b=new g.LonLat(a.x,a.y),b.transform(u,this._openLayers.getProjectionObject()),c=this._openLayers.getViewPortPxFromLonLat(b),new e(c.x,c.y)},fromViewportToLonLat:function(a){if(!this.show||!this.isReady()||!this.hasValidSize())return void 0;var b,c,d;return b=new g.Pixel(a.x,a.y),c=this._openLayers.getLonLatFromViewPortPx(b),d=this._openLayers.getProjectionObject(),c.transform(d,u),new e(c.lon,c.lat)},updateViewportToBaseMap:function(a){var b,c,d,e,f=!1;return this._viewportProjection&&this.isReady()?(c=this._viewportProjection.getZoomLevel(),b=this._viewportProjection.getMapCenterInLonLat(),b=b?b:{x:0,y:0},c=Math.min(y,Math.max(z,c)),this.setMapCenter(b),this.setZoomLevel(c),a&&(d=this.getMapCenter(),e=this.getZoomLevel(),this._viewportProjection.enabledChangeEvent=!1,Math.abs(e-c)>x&&(f=f||this._viewportProjection.setZoomLevel(e)),d&&b&&!d.closeTo(b)&&(f=f||this._viewportProjection.setMapCenterInLonLat(d)),f&&this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0),f):f},setData:function(a){this._super(a);var b,c,d,e;if(d=this._data.background.defaultMapService,d?(b={urls:["http://a.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://b.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://c.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ","http://d.tiles.mapbox.com/v3/qlik.a9f74321/${z}/${x}/${y}.png?access_token=pk.eyJ1IjoicWxpayIsImEiOiJwZHptbGw4In0.FbrCcSWr4wJj9DeIj7VLgQ"],type:"XYZ",attribution:"<a href='https://www.mapbox.com/about/maps/'>&copy; Mapbox &copy; OpenStreetMap</a> <a class='mapbox-improve-map' href='https://www.mapbox.com/map-feedback/' target='_blank'>Improve this map</a>"},c="XYZ"):(b=this._data.background.layers?this._data.background.layers[0]:{},c=b.type||"XYZ"),b&&(this._urls||b.urls))switch(c){case"XYZ":p.call(this,b);break;case"WMS":q.call(this,b);break;case"TMS":r.call(this,b)}this._openLayers&&this._baseLayer&&(z=this._openLayers.getMinZoom(),y=this._openLayers.getNumZoomLevels()+z-1,(this._minZoomLevel!==z||this._maxZoomLevel!==y)&&(this._minZoomLevel=z,this._maxZoomLevel=y,this.fire("maxMinZoomLevelChanged",[y,z]))),e=this._data&&this._data.background&&this._data.background.show&&(d||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(a){return a&&a.trim()})),e?this.showComponent():this.hideComponent(),this.fire("baseLayerChanged"),this.invalidateProperties("BaseMapLayer.setData")},hasValidData:function(){return!0},paint:function(){this._super(this._layoutMode);var a,b,c;this._openLayers&&(a=this._openLayers.getSize(),b=a.w,c=a.h,(b!==this.rect.width||c!==this.rect.height)&&this._openLayers.updateSize())},_updateProperties:function(){!this.show},afterPaint:function(){},release:function(){this._super(),o.call(this),v.destroy(),this._openLayers.destroy()}})}),define("extensions.qliktech/map/layer-dependency",["objects.views/charts/events/event-launcher"],function(a){"use strict";function b(){this._layer&&(this._colorMapData=this._layer.getLayerOutputData(),this.fire("changed"))}var c;return c=a.extend("LayerDependency",{init:function(){this._super()},setLayer:function(a){this._layer!==a&&(this._layer&&this._layer.stopListen("dataChanged",b,this),this._layer=a,this._layer&&this._layer.listen("dataChanged",b,this))},getColorMapData:function(){return this._colorMapData},release:function(){this._layer&&this._layer.stopListen("dataChanged",b,this),this._layer=null}})}),define("extensions.qliktech/map/map-area",["jquery","objects.views/charts/components/chart-component","objects.utils/shapes/rect","extensions.qliktech/map/map-polygon-layer","extensions.qliktech/map/map-polygon3-layer","extensions.qliktech/map/map-glyph-layer","extensions.qliktech/map/base-map-layer","extensions.qliktech/map/layer-dependency","objects.views/charts/utils/chart-formatting","touche"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){switch(a.type){case"polygon":return"3"===a.version?e:d;case"point":return f}return null}function k(a){var b;a.setLayoutMode(this._layoutMode),b=this.rect,a.setRect(b.x,b.y,b.width,b.height),b=this.outerRect,a.setOuterRect(b.x,b.y,b.width,b.height),b=this.containerRect,a.setContainerRect(b.x,b.y,b.width,b.height),b=this.layoutToContainerRatios,a.setLayoutToContainerRatios(b.x,b.y),a.setViewportProjection(this._viewportProjection)}function l(a,b,c,d){var e="layer."+d+"."+b+(void 0===c?"":c),f=new a(this.layersContainer,{clazz:a},e);return f.setLayerType(b),f.setVersion(c),f}function m(){var a,b,c,d,e,f,h,i;for(b=this._data?this._data.layers:null,d=b?b.length:0,d=Math.min(d,this._maxNumLayers),!this.baseMapLayer&&this._data&&this._data.background&&this._data.background.show&&(this._data.background.defaultMapService||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(a){return a&&a.trim()}))&&(this.addBaseMapLayer(new g(this.layersContainer,{clazz:g},"BaseMapLayer")),this.addAttributionLayer(document.createElement("div"))),a=0;d>a;a++)c=b[a],f=c.type,h=c.version,i=j(c),i&&(e=this.layers[a],e?(e.getLayerType()!==f||e.getVersion()!==h)&&this.removeLayer(e,!0):(e=l.apply(this,[i,f,h,a]),this.addLayer(e,a)));if(this._numLayers>d)for(a=d;a<this._numLayers;a++)e=this._layers[a],e&&this.removeLayer(e);this._numLayers=d,this.attributionLayer&&this.container.appendChild(this.attributionLayer)}function n(){for(var a=0;a<this._numLayers;a++)this.layers[a].setData(this._data,this._data.layers[a]);this.baseMapLayer&&(this.baseMapLayer.setData(this._data),u.call(this))}function o(){this._numLayers<1||this.layers[this._numLayers-1].updateBackendApi()}function p(a,b){var c,d,e,f,g,h,i,j;a&&(c=a.x,d=a.x+a.width,e=a.y,f=a.y+a.height,g=b.x,h=b.x+b.width,i=b.y,j=b.y+b.height,g>c&&(c=g),d>h&&(d=h),i>e&&(e=i),f>j&&(f=j),a.set(c,e,d-c,f-e))}function q(){var a,b;for(a=0;a<this._numLayers;a++)b=this.layers[a],b&&!b.hasValidData()&&b.clear()}function r(){var a,b,c=Math.min(this._numLayers,this._maxNumLayers);for(a=0;c>a;a++){if(b=this._data.layers[a],b&&b.qHyperCube&&b.qHyperCube.qDimensionInfo&&b.qHyperCube.qDimensionInfo.length>0)return this.layers[a];if(b&&b.qListObject&&b.qListObject.qDimensionInfo&&b.qListObject.qDimensionInfo.qFallbackTitle)return this.layers[a]}}function s(){var a=this._colorMap.getLegendDataProvider();a.setLegendMarker("point"===this.coloredLayer.getLayerData().type?"circle":"rect")}function t(a,b){this._interactionController.setMaxZoomLevel(a),this._interactionController.setMinZoomLevel(b)}function u(){this.attributionLayer.innerHTML=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady()?this.baseMapLayer.getAttribution():""}function v(){var a=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady();this.map.setFractionalZoomMode(!a)}function w(){this.updateSelectableShapes()}function x(){var a,b,c,d,e,f,g=!1,h=!1,i=this._changedBoundsLayers?this._changedBoundsLayers.length:0;if(this.layersReady&&0!==i){for(b=0;b<this._numLayers;b++)this.layers[b].isVisible()&&(c=this.layers[b].getLayerBounds(),c&&(d=d?d.union(c):c.clone()));if(p.apply(this,[d,this._worldBounds]),void 0===d&&void 0===this._unionBounds?this._unionBounds=this._worldBounds:this._unionBounds=d,this._unionBounds&&this._unionBounds.hasNaN()&&(this._unionBounds=this._worldBounds),e=this.map.isSnapshot()&&this.map.getSnapshotStoredChartData()?this.map.getSnapshotStoredChartData().mapRect:void 0,f=e&&void 0!==e.width&&void 0!==e.height&&void 0!==e.x&&void 0!==e.y,this._unionBounds&&void 0!==d){for(b=0;i>b;b++)a=this._changedBoundsLayers[b],a&&(g=!0,(!a.getFirstAutoZoomed()||this.map.getAutoZoomOnDataChange())&&(this._unionBounds.width||this._unionBounds.height)&&(h=!0,a.setFirstAutoZoomed(!0)));g&&this.map.setMapBounds(this._unionBounds),!h||this.map.isSnapshot()&&f||this.map.zoomOnMapBounds()}else 0===i&&this.baseMapLayer&&void 0===d&&!this.baseMapLayer.getFirstAutoZoomed()&&((void 0===this._unionBounds||this._unionBounds.hasNaN())&&(this._unionBounds=this._worldBounds),this.map.setMapBounds(this._unionBounds),!this._unionBounds.width||!this._unionBounds.height||this.map.isSnapshot()&&f||(this.map.zoomOnMapBounds(),this.baseMapLayer.setFirstAutoZoomed(!0)));this._changedBoundsLayers=[]}}function y(a){-1===this._changedBoundsLayers.indexOf(a)&&(this._changedBoundsLayers.push(a),x.call(this))}function z(){var a,b,c,d=0;for(a=0;a<this._numLayers;a++)b=this.layers[a],c=b&&b.getNumPoints?b.getNumPoints():0,d+=c;this.map.setZoomPanByWebkitTransform(d>D)}function A(){var a=this._layerDependency.getColorMapData();this._colorMap.setData(a),this._legend.setData(a),this._chartContext.refresh(a),s.call(this),this.layersReady=!0,this.map.layersReady=!0,this.map.paint(this._data),x.call(this)}var B,C=".maparea",D=3e4,E=0;return B=b.extend("MapArea",{init:function(a,b){this._super.apply(this,Array.prototype.slice.call(arguments)),this.id="MapArea"+E++,this.layers=[],this._maxNumLayers=1,this._numLayers=0,this.options=b,this._unionBounds=void 0,this._worldBounds=new c(-180,-180,360,360),this._changedBoundsLayers=[],this._layerDependency=new h,this._layerDependency.listen("changed",A,this)},setMaxNumLayers:function(a){isNaN(a)&&(a=0),this._maxNumLayers=a},getMaxNumLayers:function(){return this._maxNumLayers},setData:function(a){this.layersReady=!1,this._data=a,m.call(this),o.call(this),this.coloredLayer=r.call(this),this._layerDependency.setLayer(this.coloredLayer),n.call(this),q.call(this),this.map.setFormatter(new i(this.backendApi.localeInfo,this.coloredLayer.getMeasureInfo()))},addLayer:function(a,b){a&&(a.setLayerIndex(b),a.setBackendApi(this.backendApi),a.listen("selectableShapesChanged",w,this),a.listen("boundsChanged",y,this),a.listen("numPointsChanged",z,this),a.setColorMap(this._colorMap),k.call(this,a),this.layers[b]=a)},removeLayer:function(a,b){if(a){var c,d,e=this.layers.indexOf(a);a.stopListen("selectableShapesChanged",w,this),a.stopListen("boundsChanged",y,this),a.stopListen("numPointsChanged",z,this),a.clear(),a.release(),a.off(),a.container&&a.container.parentElement&&(c=a.container,d=c.parentElement,d.removeChild(c)),!b&&e>-1&&this.layers.splice(e,1)}},addBaseMapLayer:function(a){this.baseMapLayer||(this.baseMapLayer=a,this.layersContainer.insertBefore(a.container,this.layersContainer.firstChild),k.call(this,a),a.listen("maxMinZoomLevelChanged",t,this),a.listen("attributionChanged",u,this),a.listen("baseLayerChanged",v,this),a.setViewState(this.map.getViewState()))},removeBaseMapLayer:function(){if(this.baseMapLayer){var a,b;this.baseMapLayer.stopListen("maxMinZoomLevelChanged",t,this),this.baseMapLayer.stopListen("attributionChanged",u,this),this.baseMapLayer.stopListen("baseLayerChanged",v,this),this.baseMapLayer.container&&this.baseMapLayer.container.parentElement&&(a=this.baseMapLayer.container,b=a.parentElement,b.removeChild(a))}},addAttributionLayer:function(a){this.attributionLayer||(this.attributionLayer=a,a.style.position="absolute",a.style.bottom="0",a.style.right="0",Touche(a).tap({id:C,options:{preventDefault:!1},start:function(){Touche.preventGestures(this.gestureHandler)}}),this.container.appendChild(a))},removeAttributionLayer:function(){this.attributionLayer&&this.container.removeChild(this.attributionLayer)},setBackendApi:function(a){this.backendApi=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setBackendApi(a)},setMap:function(a){this.map=a},getMap:function(){return this.map},setViewportProjection:function(a){if(this._viewportProjection!==a){this._viewportProjection=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setViewportProjection(this._viewportProjection);this.baseMapLayer&&this.baseMapLayer.setViewportProjection(this._viewportProjection)}},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},setLegend:function(a){this._legend=a},setChartContext:function(a){this._chartContext=a},setInteractionController:function(a){this._interactionController=a},setHasValidData:function(a){this._super(a);for(var b=0;b<this._numLayers;b++)this.layers[b].setHasValidData(a)},hasValidData:function(){return this._super()&&this._data},setLayoutMode:function(a){this._super(a);for(var b=0;b<this._numLayers;b++)this.layers[b].setLayoutMode(a);this.baseMapLayer&&this.baseMapLayer.setLayoutMode(a)},setRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setRect(0,0,c,d)},setOuterRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setOuterRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setOuterRect(0,0,c,d)},setLayoutToContainerRatios:function(a,b){this._super(a,b);for(var c=0;c<this._numLayers;c++)this.layers[c].setLayoutToContainerRatios(a,b);this.baseMapLayer&&this.baseMapLayer.setLayoutToContainerRatios(a,b)},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var a in this.renderers)this.renderers[a].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[a].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1);for(var b=0;b<this._numLayers;b++)this.layers[b].updateSize()},setContainerRect:function(a,b,c,d){this._super(a,b,c,d);for(var e=0;e<this._numLayers;e++)this.layers[e].setContainerRect(0,0,c,d);this.baseMapLayer&&this.baseMapLayer.setContainerRect(0,0,c,d)},showComponent:function(){this._super();var a,b;for(a=0;a<this._numLayers;a++)for(b=0;b<this.layers[a].renderers.length;b++)this.layers[a].renderers[b].show();this.baseMapLayer&&(this.baseMapLayer.showComponent(),u.call(this))},hideComponent:function(){this._super();var a,b;for(a=0;a<this._numLayers;a++)for(b=0;b<this.layers[a].renderers.length;b++)this.layers[a].renderers[b].hide();this.baseMapLayer&&(this.baseMapLayer.hideComponent(),u.call(this))},hasVisibleLayer:function(){for(var a=0;a<this._numLayers;a++)if(this.layers[a].show)return!0;return!1},hasVisibleBaseLayer:function(){return this.baseMapLayer&&this.baseMapLayer.show},isVisible:function(a){return this._super(a)&&this.rect&&this.rect.width>0&&this.rect.height>0},clear:function(){for(var a=0;a<this._numLayers;a++)this.layers[a].clear()},release:function(){for(var a=0;a<this._numLayers;a++)this.layers[a].release();this.baseMapLayer&&(this.baseMapLayer.release(),this.baseMapLayer.stopListen("attributionChanged"),this.baseMapLayer.stopListen("baseLayerChanged")),this.map=null,this.baseMapLayer=null,this.backendApi=null},setGlobalOpacity:function(a,b){this._globalAlpha=a;for(var c=0;c<this._numLayers;c++)this.layers[c].setGlobalOpacity(a,b)},updateSelectableShapes:function(){if(0!==this._numLayers){var a,b,c;for(c=this.layers[0].getSelectableShapes(),a=1;a<this._numLayers;a++)b=this.layers[a].getSelectableShapes(),b&&b.length>0&&(c=c.concat(b));this.setSelectableShapes(c)}},paint:function(a,b){if(this.layersReady&&b){this._super(a,b);for(var c=0;c<this._numLayers;c++)this.layers[c].invalidateProperties("MapArea.paint"),this.layers[c].invalidateDisplay("MapArea.paint");this.baseMapLayer&&this.baseMapLayer.invalidateDisplay("MapArea.paint")}},setPreselectionMode:function(a){this._preselectionMode=a;for(var b=0;b<this._numLayers;b++)this.layers[b].setPreselectionMode(a)},_updateProperties:function(){this._data&&this.invalidateDisplay("MapArea._updateProperties")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=a(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute",overflow:"hidden"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container),this.layersContainer=document.createElement("div"),this._$layersContainerWrap=a(this.layersContainer),this._$layersContainerWrap.css({position:"absolute",width:"100%",height:"100%"}),this.container.appendChild(this.layersContainer))}}),Object.defineProperty(B.prototype,"className",{value:"MapArea"}),B}),define("extensions.qliktech/map/map-handler",["objects.utils/data-properties/data-property-handler","core.utils/deferred","general.utils/array-util","util"],function(a,b,c,d){"use strict";function e(){var a=d.generateId(),b={type:"polygon",cId:a,show:!0,opacity:1,qListObjectDef:{qDef:{qGrouping:"N",qFieldDefs:[],qFieldLabels:[],qSortCriterias:[],qNumberPresentations:[]},qFrequencyMode:"N",qShowAlternatives:!0,qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:2,qHeight:o}],qExpressions:[{qExpr:""},{qExpr:"",geoType:"polygon"}]}};return this.properties.layers.push(b),b}function f(){var a=d.generateId(),b={type:"polygon",version:"3",cId:a,show:!0,qHyperCubeDef:{qDimensions:[],qMeasures:[{qDef:{qDef:""}}],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:2,qHeight:o}],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage},geodata:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage}},measureDef:""};return this.properties.layers.push(b),b}function g(a){var b,c,d=a?a.length:0;for(b=0;d>b;b++){if(c=a[b],c.qHyperCubeDef&&c.qHyperCubeDef.qDimensions&&1===c.qHyperCubeDef.qDimensions.length&&c.qHyperCubeDef.qDimensions[0].qDef&&(c.qHyperCubeDef.qDimensions[0].qLibraryId||c.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0]))return c;if(c.qHyperCubeDef&&c.qHyperCubeDef.qDimensions&&2===c.qHyperCubeDef.qDimensions.length&&c.qHyperCubeDef.qDimensions[0].qDef&&(c.qHyperCubeDef.qDimensions[0].qLibraryId||c.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0])&&c.qHyperCubeDef.qDimensions[1].qDef&&c.qHyperCubeDef.qDimensions[1].qDef.qFieldDefs[0])return c;if(c.qListObjectDef&&(c.qListObjectDef.qLibraryId||c.qListObjectDef.qDef&&c.qListObjectDef.qDef.qFieldDefs&&c.qListObjectDef.qDef.qFieldDefs.length&&c.qListObjectDef.qDef.qFieldDefs[0]))return c}}function h(){var a=this.properties.color;a.auto&&"primary"===a.mode&&(a.auto=!1,a.mode="byMeasure")}function i(a){var b,c,d="";return b=void 0===a.tags?a.qTags:a.tags,c=void 0===a.name?a.qName:a.name,c="["+c+"]",b&&b.indexOf("$mercator")>-1&&(d="$mercator"),{qExpr:"GeoReduceGeometry({1}"+c+")",geoType:"polygon",projection:d}}function j(a){var b=i(a),c=b.qExpr,d=this.createExpressionMeasure(c,c);return d.qDef.projection=b.projection,d.qDef.qAggrFunc="None",d.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},d}function k(a,b,c){var d,e;for(d=0;d<b.length&&(e=b[d],d!==b.length-1);++d)a&&(a[e]||(a[e]={}),a=a[e]);a&&(a[e]=c)}var l,m,n,o=1e3;return n=[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}],m={qDef:{qFieldDefs:[],qFieldLabels:[],qSortCriterias:[]}},l=a.extend({init:function(a,b){this._super(a,null,b,null),this.dimensionProperties=this.autoSortDimension(m)},rippleToHyperCubes:function(a,b){var c,d,e=a.split(".");for(c=0;c<this.properties.layers.length;++c)d=this.properties.layers[c],k(d.qHyperCubeDef,e,b),d.geodata&&k(d.geodata.qHyperCubeDef,e,b)},setProperties:function(a){a&&a.layers&&a.layers[0]&&"point"===a.layers[0].type&&a.color&&a.color.persistent===!1&&(a.color.persistent=!0),this._super(a)},getDimensions:function(a){if(a||(a=g(this.properties.layers)),!a)return[];if(a.qHyperCubeDef)return a.qHyperCubeDef.qDimensions;if(a.qListObjectDef){var b=a.qListObjectDef.qDef;return b&&b.qFieldDefs&&b.qFieldDefs.length||a.qListObjectDef.qLibraryId?[a.qListObjectDef]:[]}return[]},getMeasures:function(a){if(a||(a=g(this.properties.layers)),!a)return[];if(a.qHyperCubeDef){if("polygon"!==a.type)return a.qHyperCubeDef.qMeasures;var b=a.qHyperCubeDef.qMeasures;if(b&&b[0]&&(b[0].qLibraryId||b[0].qDef&&void 0!==b[0].qDef.qDef&&""!==b[0].qDef.qDef.trim()))return[b[0]]}return a.qListObjectDef&&a.qListObjectDef.qExpressions&&a.qListObjectDef.qExpressions[0]&&(a.qListObjectDef.qExpressions[0].qExpr||a.qListObjectDef.qExpressions[0].qLibraryId)?[a.qListObjectDef.qExpressions[0]]:[]},getLayerType:function(a){return a||(a=g(this.properties.layers)),a?a.type:void 0},getLayerTypeAndVersion:function(a){return a||(a=g(this.properties.layers)),a?[a.type,a.version]:[void 0,void 0]},addPointLayer:function(){var a=d.generateId(),b={type:"point",cId:a,show:!0,opacity:1,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:3,qHeight:o}],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage},useSize:!0,bubbleSizes:8,rangeBubbleSizes:[2,32],autoMinMax:!0,customMin:0,customMax:10};return this.properties.layers.push(b),void 0===this.properties.background&&(this.properties.background={}),this.properties.background.show=!0,void 0===this.properties.color&&(this.properties.color={}),this.properties.color.persistent=!0,b},addPolygonLayer:function(a){return a&&""!==a?f.call(this):e.call(this)},autoSortDimension:function(a){return b.resolve(l.autoSortDimension(a))},createFieldDimension:function(a){var b=d.extend(!0,{},m);return b.qDef.qFieldDefs[0]=a,b.qDef.qFieldLabels[0]="",b},getLayers:function(){return this.properties.layers},getLayersWithoutMeasure:function(){return this.properties.layers.filter(function(a){switch(a.type){case"polygon":if(a.qHyperCubeDef){var b=b;return!(b&&b[0]&&(b[0].qDef&&b[0].qDef.qDef||b[0].qLibraryId))}return!a.qListObjectDef.qExpressions[0].qExpr&&!a.qListObjectDef.qExpressions[0].qLibraryId;case"point":return!a.qHyperCubeDef.qMeasures.length}return!1})},addHypercubeDimension:function(a,e){var f=this.getDimensions(e);return a.qDef.cId||(a.qDef.cId=d.generateId()),f.length<2&&(f.push(a),c.indexAdded(e.qHyperCubeDef.qInterColumnSortOrder,f.length-1)),"polygon"===e.type&&"3"===e.version&&(f=e.geodata.qHyperCubeDef.qDimensions,a=d.extend(!0,{},a),a.qDef.cId=d.generateId(),f.length<2&&f.push(a)),b.resolve(a)},addListObjectDimension:function(a,b){return b.qListObjectDef=d.extend(!0,b.qListObjectDef,a),a},addDimension:function(a){var c,d=this.properties.layers.length;if(d>0){if(c=this.properties.layers[d-1],c.qListObjectDef)return this.addListObjectDimension(a,c);if(c.qHyperCubeDef)return this.addHypercubeDimension(a,c)}return b.resolve(a)},replaceDimension:function(a,c){var e,f,g,h,i=this.properties.layers.length;return i>0&&(e=this.properties.layers[i-1],e.qListObjectDef?(h=d.extend(!0,e.qListObjectDef,c),c.qLibraryId?(delete h.qDef.qFieldDefs,delete h.qDef.qFieldLabels):delete h.qLibraryId,this.properties.layers[i-1].qListObjectDef=h):e.qHyperCubeDef&&(f=this.getDimensions(e),g=f[a],c.qDef.cId=d.generateId(),f[a]=c,"function"==typeof this.dimensionDefinition.replace&&this.dimensionDefinition.replace.call(null,c,g,a,this.properties,this))),b.resolve(c)},removeDimension:function(){},getDimensionLayout:function(){var a=this.layout?this.layout.layers:void 0;return a&&1===a.length&&a[0].qListObject&&a[0].qListObject.qDimensionInfo?a[0].qListObject.qDimensionInfo:""},hasPolygonData:function(){var a,b=this.properties.layers[0].qListObjectDef.qExpressions;for(a=0;a<b.length;++a)if("polygon"===b[a].geoType.toLowerCase())return!0;return!1},addFieldAsGeoPolygonField:function(a){var b=this.properties.layers[this.properties.layers.length-1];b.qListObjectDef?b.qListObjectDef.qExpressions[1]=i(a):b.geodata.qHyperCubeDef.qMeasures[0]=j.call(this,a)},addMeasureToPolygonLayer:function(a,b){a.qListObjectDef?a.qListObjectDef.qExpressions[0]=b:(b.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},b.qDef.qAggrFunc="None",a.qHyperCubeDef.qMeasures[0]=b,a.measureDef=b.qDef.qDef),h.call(this)},addMeasureToPointLayer:function(a,b){b.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},a.qHyperCubeDef.qMeasures.length?a.qHyperCubeDef.qMeasures[0]=b:(a.qHyperCubeDef.qMeasures.push(b),a.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2)),h.call(this)},addMeasure:function(a){var c={qExpr:a.qDef.qDef},d=this.properties.layers[0].qListObjectDef.qExpressions;return this.hasPolygonData()?d[0]&&"polygon"!==d[0].geoType.toLowerCase()?d[0]=c:d.splice(d.length-2,0,c):0===d.length?d.push(c):d[0]=c,b.resolve(a)}}),l.autoSortDimension=function(a){return a.qDef.qSortCriterias=d.extend(!0,[],n),a},l}),define("extensions.qliktech/map/map-util",["general.utils/array-util"],function(a){function b(a){var b,c,d,e=[],f=[];if(b=a.split("["),b.length>1){for(d=0;d<b.length;d++)c=b[d].split("]"),c.length>1&&(e=e.concat(c.splice(0,1))),f=f.concat(c);f=f.join(" ")}else f=a;return{fields:e,rest:f}}function c(a,b){for(var c in b)(!a[c]||a[c].distance>b[c].distance)&&(a[c]=b[c])}var d={extract2FieldNamesOfGeoMakePoint:function(a){var c,d,e,f,g,h,i,j,k,l;for(c=b(a),d=c.fields,e=c.rest,f=e.replace("("," ( "),g=f.split(" "),h=0;h<g.length;)""===g[h]?g.splice(h,1):h++;for(h=0;h<g.length-1;)"("===g[h+1]?g.splice(h,1):h++;for(f=g.join(""),i=[",","\\+","-","\\(","\\)","\\*","/","=","\\>","\\<"],i.join("|"),g=f.split(new RegExp(i.join("|"),"g")),h=0;h<g.length;)""===g[h]?g.splice(h,1):h++;for(j=d.concat(g),h=0;h<j.length;h++)k=j[h],l=k.substring(0,1),('"'===l||"'"===l)&&(k=k.substring(1)),l=k.substring(k.length-1),('"'===l||"'"===l)&&(k=k.substring(0,k.length-1)),j[h]=k;return j},findFieldsInGeoMakePointFunction:function(a,b){var c,d=this.extract2FieldNamesOfGeoMakePoint(a),e=b?b.length:0,f=d?d.length:0,g=[],h={};for(c=0;e>c;c++)h[b[c].qName]=c;for(c=0;f>c;c++)void 0!==h[d[c]]&&(g[g.length]=b[h[d[c]]]);return g},isGeoMakePointField:function(a){return this.isGeoMakePointExpression(a.qName)},isGeoMakePointExpression:function(a){var b,c,d=a.split("(")[0],e=["="," "];for(e.join("|"),b=d.split(new RegExp(e.join("|"),"g")),c=0;c<b.length;)""===b[c]?b.splice(c,1):c++;return b&&1===b.length&&"geomakepoint"===b[0].toLowerCase()},isNormalGeoField:function(a){return d.isNormalGeoPointField(a)||d.isGeoPolygonField(a);
},isNormalGeoPointField:function(a){return a.qTags.indexOf("$geopoint")>-1},isGeoField:function(a){return d.isGeoPointField(a)||d.isGeoPolygonField(a)},isGeoPointField:function(a){return this.isNormalGeoPointField(a)||this.isGeoMakePointField(a)},isGeoPolygonField:function(a){return a.qTags.indexOf("$geomultipolygon")>-1||a.qTags.indexOf("$geopolygon")>-1},getFieldsInTable:function(b,c){var d,e,f=[];for(d=0;d<c.length;d++)e=c[d],a.contains(e.qSrcTables,b)&&f.push(e);return f},simplifyGeoMakePointExpression:function(a){var b,c,e,f,g,h,i,j;return b=d.extract2FieldNamesOfGeoMakePoint(a),c=b[0],e=b[1],f=a.indexOf(c),g=a.indexOf(e),h=a.substring(0,f),i=a.substring(f+c.length,g),j=a.substring(g+e.length),h.trim()+c+i.trim()+e+j.trim()},getFieldsInArchipelagoForGeoMakePointField:function(a,b){var d,e=this.findFieldsInGeoMakePointFunction(a.qName,b),f=e?e.length:0,g={};for(d=0;f>d;d++)c(g,this.getFieldsInArchipelago(e[d],b));return g},getFieldsInArchipelago:function(a,b){function c(a,g){var h,i,j,k,l;for(h=0;h<a.length;h++)if(j=a[h],!f[j])for(f[j]=!0,k=d.getFieldsInTable(j,b),i=0;i<k.length;i++)l=k[i],e[l.qName]||(e[l.qName]={field:l,distance:g},c(l.qSrcTables,++g))}var e={},f={};return c(a.qSrcTables,0),e},filterFields:function(a,b){function c(a,b){return Array.isArray(b)?b.some(function(b){return c(a,b)}):a.qTags.indexOf(b)>-1}var d,e,f=a?a.length:0,g=[];for(d=0;f>d;d++)e=a[d],c(e,b)&&g.push(e);return g},findGeoAssociatedFields:function(a,b){var c,e,f,g,h,i,j,k={};for(c=0;c<b.length;c++)for(f=b[c],i=d.getFieldsInArchipelago(f,a),g=Object.keys(i),e=0;e<g.length;e++)h=g[e],j=i[h].field,k[h]?k[h].geoFields.push(f):k[h]={field:j,geoFields:[f],distance:i[h]};return Object.keys(k).map(function(a){return k[a]})},addLayer:function(a,b,c){var e,f,g=a.geoField;return f="field"===a.type?c.createFieldDimension(a.value):c.createLibraryDimension(a.libraryId),d.isGeoPointField(g)?(e=c.addPointLayer(),c.addDimension(f),c.addDimension(c.createFieldDimension(g.qName))):(e=c.addPolygonLayer("3"),c.addDimension(f),c.addFieldAsGeoPolygonField(g)),e}};return d}),define("extensions.qliktech/map/map-autocomplete",["extensions.qliktech/map/map-util","translator"],function(a,b){function c(a){return a.sort(function(a,b){var c;return c=a.distance<b.distance?-1e3:a.distance>b.distance?1e3:0,a.value<b.value?c-=10:a.value>b.value&&(c+=10),c})}return{getFieldSuggestions:function(d,e){var f=b.get("Common.Fields"),g=e.map(function(b){var c=b.field.qName,e={label:c,value:c,field:b.field,geoFields:b.geoFields,associatedFields:[],distance:b.distance,category:f,type:"field"};if(a.isGeoField(b.field)){var g=a.getFieldsInArchipelago(b.field,d),h=a.isGeoPointField(b.field),i=d.filter(function(c){var d=c.qName;return g[d]&&(!a.isGeoField(c)||h&&d===b.field.qName)});e.associatedFields=i,e.hasAlternatives=i.length>1}else e.hasAlternatives=b.geoFields.length>1;return e});return c(g)},getDimensionSuggestions:function(d,e,f){function g(b,c,d){var e,f,g;if(e=a.isGeoMakePointExpression(c),e&&(c=a.simplifyGeoMakePointExpression(c)),b&&c)for(f=0;f<b.length;f++)if(g=b[f],g.field.qName===c)return g;return e&&d?{geoFields:[d.qData.info[0]],field:d.qData.info[0],distance:{distance:Math.MAX_VALUE,field:d.qData.info[0]}}:void 0}var h=b.get("Common.Dimensions"),i=d.map(function(a){var b=a&&a.qData&&a.qData.info&&a.qData.info[0]?a.qData.info[0].qName:"",c=""===b?null:g(f,b,a);return c?{dimension:a,associatedField:c}:void 0}).filter(function(a){return!!a}),j=i.map(function(b){var c,d,f=b.dimension.qData.title,g=b.associatedField,i={label:f,value:f,field:g.field,libraryId:b.dimension.qInfo.qId,geoFields:g.geoFields,associatedFields:[],distance:b.distance,category:h,type:"dimension"},j=a.isGeoMakePointField(g.field);if(j)c=a.getFieldsInArchipelagoForGeoMakePointField(g.field,e),d=e.filter(function(b){var d=b.qName;return c[d]&&(!a.isGeoField(b)||d===g.field.qName)}),i.associatedFields=d,i.hasAlternatives=d.length>1;else{var k=a.isNormalGeoPointField(g.field),l=a.isGeoPolygonField(g.field);k||l?(c=a.getFieldsInArchipelago(g.field,e),d=e.filter(function(b){var d=b.qName;return c[d]&&(!a.isGeoField(b)||k&&d===g.field.qName)}),i.associatedFields=d,i.hasAlternatives=d.length>1):i.hasAlternatives=g.geoFields.length>1}return i});return c(j)}}}),define("general.models/field-on-fly",["general.models/field"],function(a){"use strict";var b;return b=a.extend("FieldOnFly",{},{listProperties:{qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0,qShowDefinitionOnly:!0}}})}),define("text!extensions.qliktech/map/add-popover/add-layer-popover.ng.html",[],function(){return'<immidiate-contextual width="230" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)">\r\n	<div class="object-add-popover" ng-show="!step2">\r\n		<object-add-typeahead>\r\n			<div class="object-add-popover-header">\r\n				<div class="qui-inputwithicon">\r\n					<input type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\r\n						   object-add-typeahead-input on-escape="onEscape($event)" maxlength="255"/>\r\n				</div>\r\n			</div>\r\n			<div class="object-add-popover-content" object-add-typeahead-menu>\r\n				<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="dimension in dimensions"  tid="dimension-item"\r\n							object-add-typeahead-item="dimension" on-select="selectItem(dimension)">\r\n						<span qve-highlight text="{{dimension.label}}" query="search.term" class="qui-list-text"></span>\r\n						<i class="object-add-popover-toogle-step2-icon qui-list-icon icon-triangle-right" ng-if="dimension.hasAlternatives"></i>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\r\n				<ul class="qui-list">\r\n					<li class="qui-list-item" ng-repeat="field in fields" tid="field-item"\r\n						object-add-typeahead-item="field" on-select="selectItem(field)">\r\n						<i ng-if="isDirectDiscoveryField( field )" class="icon-directdiscovery qui-list-icon" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\r\n						<span qve-highlight text="{{field.label}}" query="search.term" class="qui-list-text"></span>\r\n						<i class="object-add-popover-toogle-step2-icon qui-list-icon icon-triangle-right" ng-if="field.hasAlternatives"></i>\r\n					</li>\r\n				</ul>\r\n				<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\r\n			</div>\r\n		</object-add-typeahead>\r\n	</div>\r\n	<div class="object-add-popover back" ng-show="step2">\r\n		<div class="object-add-popover-header">\r\n			<div qva-activate="goBack($event);">\r\n				<i class="icon-triangle-left"></i>\r\n				<span q-translation="Visualization.Requirements.Back"></span>\r\n			</div>\r\n		</div>\r\n		<div class="object-add-popover-content">\r\n			<div class="object-add-popover-list-header">{{headerLabel}}</div>\r\n			<ul class="qui-list">\r\n				<li class="qui-list-item" ng-repeat="suggestedItem in suggestedItems"\r\n					qva-activate="selectItem(suggestedItem)" tid="from-field-item">\r\n					<span class="qui-list-text">{{getSuggestionLabel(suggestedItem)}}</span>\r\n				</li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</immidiate-contextual>'}),define("extensions.qliktech/map/add-popover/add-layer-popover",["core.utils/deferred","general.utils/string-normalization","translator","general.utils/array-util","general.utils/support","extensions.qliktech/map/map-util","extensions.qliktech/map/map-autocomplete","general.models/field-on-fly","general.models/library/dimension","text!./add-layer-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,c){return""===c?a:a.filter(function(a){return"undefined"==typeof a.value?!1:b.string(a.value.toLowerCase()).indexOf(b.string(c.toLowerCase()))>-1})}var m=100,n={template:j,controller:["$scope",function(b){b.search={term:""},b.isDirectDiscoveryField=k.isDirectDiscoveryField,b.getDirectDiscoveryTypeTranslationKey=k.getTypeTranslationKey,b.autoFocus=e.treatAsDesktop(),b.suggestedItems=[],b.position||(b.position="right"),b.getSuggestionLabel=function(a){return f.isGeoPointField(a.geoFields[0])?c.get("properties.layers.autocomplete.pointSuggestion",[a.label]):c.get("properties.layers.autocomplete.regionSuggestion",[a.label])},b.selectItem=function(a){1!==a.geoFields.length||a.field&&f.isGeoField(a.field)?f.isGeoField(a.field)?(b.headerLabel=c.get("Visualization.Requirements.SelectFieldForLayer"),b.suggestedItems=a.associatedFields.map(function(b){return{label:b.qName,value:b.qName,type:"field",geoFields:[a.field]}}),b.step2=!0):(b.headerLabel=c.get("Visualization.Requirements.SelectGeoFieldForLayer"),b.suggestedItems=a.geoFields.map(function(b){return{label:b.qName,value:a.value,libraryId:a.libraryId,type:a.type,geoFields:[b]}}),b.step2=!0):"dimension"===a.type?b.addLibraryDimension({libraryId:a.libraryId,type:a.type,geoField:a.geoFields[0]}):b.addFieldDimension({value:a.value,type:a.type,geoField:a.geoFields[0]})},b.onEscape=function(a){""!==b.search.term?(a.stopPropagation(),b.search.term=""):b.closeAddPopover()},b.goBack=function(a){a.preventDefault(),b.suggestedItems=[],b.step2=!1};var j=null;b.$watch("search.term",function(c){function e(){var a=l(j.fields,c),e=l(j.dimensions,c);e.length>m?(e=d.limit(e,m),a=[]):a.length+e.length>m&&(a=d.limit(a,m-e.length)),b.fields=a,b.dimensions=e}j?e():a.all({fields:h.getListLayout(),dimensions:i.getListLayout()}).then(function(a){var b=f.filterFields(a.fields,["$geomultipolygon","$geopolygon","$geopoint"]),c=f.findGeoAssociatedFields(a.fields,b),d=c.filter(function(a){return!a.field.qIsDefinitionOnly});j={fields:g.getFieldSuggestions(a.fields,d),dimensions:g.getDimensionSuggestions(a.dimensions,a.fields,c)},e()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",closeAddPopover:"=",position:"="}};return n}),define("extensions.qliktech/map/map-layer-creation",["translator","qvangular","core.models/app","extensions.qliktech/map/map-util","general.models/field","util"],function(a,b,c,d,e,f){"use strict";function g(a,b,c,d){c.addPolygonLayer("3"),c.addDimension(a),c.addFieldAsGeoPolygonField(b),d.save()}function h(a,b,c,d){c.addPointLayer(),c.addDimension(a),c.addDimension(b),d.save()}function i(a,c,d,e,f,h){c.addItem({translation:d,tid:"add-as-polygon-layer",select:function(){g(e,a,f,h),b.$rootScope.$broadcast("pp-open-path","data."+f.properties.layers[0].cId)}})}function j(a,c,d,e,f,g){c.addItem({translation:d,tid:"add-as-point-layer",select:function(){var c=f.createFieldDimension(a.qName);h(e,c,f,g),b.$rootScope.$broadcast("pp-open-path","data."+f.properties.layers[0].cId)}})}function k(a,b,c,d,e){var f;1===b.length?j(a,c.menu,"Object.Map.DropActions.AddAsPointLayer",b[0].dimension,d,e):b.length>1&&(f=c.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),b.forEach(function(b){j(a,f,["properties.layers.autocomplete.pointSuggestion",b.name],b.dimension,d,e)}))}function l(a,b,c,d,e){var f;1===b.length?i(a,c.menu,"Object.Map.DropActions.AddAsRegionLayer",b[0].dimension,d,e):b.length>1&&(f=c.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),b.forEach(function(b){i(a,f,["properties.layers.autocomplete.regionSuggestion",b.name],b.dimension,d,e)}))}function m(a,b,c,e,f){d.isGeoPointField(a)?k(a,b,c,e,f):l(a,b,c,e,f)}function n(a,b,c,e,f){var g=[],h=[];b.forEach(function(a){d.isGeoPointField(a)?g.push(a):h.push(a)});var k;1===h.length?i(h[0],c.menu,"Object.Map.DropActions.AddAsRegionLayer",a,e,f):h.length>1&&(k=c.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),h.forEach(function(b){i(b,k,["properties.layers.autocomplete.regionSuggestion",b.qName],a,e,f)})),1===g.length?j(g[0],c.menu,"Object.Map.DropActions.AddAsPointLayer",a,e,f):g.length>1&&(k=c.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),g.forEach(function(b){j(b,k,["properties.layers.autocomplete.pointSuggestion",b.qName],a,e,f)}))}function o(b,c,d,e){b.forEach(function(b){var g=c.properties.layers.indexOf(b),h=p>1?"Add as measure in layer "+(g+1):a.get("contextMenu.addFieldAsMeasure"),i=f.escapeField(d.item.name),j=d.menu.addItem({translation:h,tid:"add-as-measure"});["Sum","Count","Avg","Min","Max"].forEach(function(a){var d=a+"("+i+")";j.addItem({label:d,tid:a.toLowerCase(),select:function(){var a;switch(b.type){case"polygon":a=b.qHyperCubeDef?c.createExpressionMeasure(d,d):{qExpr:d,qLabel:d},c.addMeasureToPolygonLayer(b,a);break;case"point":a=c.createExpressionMeasure(d,d),c.addMeasureToPointLayer(b,a);break;default:return}e.save()}})})})}var p=1;return{getDropFieldOptions:function(a,b,f,i){var j=a.item,k=b.getLayers(),l=b.getLayersWithoutMeasure(),q={qTags:j.tags,qSrcTables:j.srcTables,qName:j.name},r=d.isGeoPointField(q),s=d.isGeoPolygonField(q),t=r||s;t?l.length?(o(l,b,a,f),i()):k.length>=p?i():e.getListLayout().then(function(c){var e=d.getFieldsInArchipelago(q,c),g=c.filter(function(a){var b=a.qName;return e[b]&&(!d.isGeoField(a)||r&&b===q.qName)}),h=g.map(function(a){var c=b.createFieldDimension(a.qName);return{name:a.qName,dimension:c}});m(q,h,a,b,f),i()}):c.current.findMatchingFields(a.item.name,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(c){var e,m,q=c.qFieldNames;l.length?(o(l,b,a,f),i()):k.length>=p||0===q.length?i():1===q.length?(e=b.createFieldDimension(j.name),d.isGeoPointField(q[0])?(m=b.createFieldDimension(q[0].qName),h(e,m,b,f)):g(e,q[0],b,f)):(e=b.createFieldDimension(j.name),n(e,q,a,b,f),i())})},getDropDimensionOptions:function(a,b,f,i){if(b.getLayers().length>0)return void i();var j=a.item;d.isGeoMakePointField(j.info[0])?e.getListLayout().then(function(c){var e=d.getFieldsInArchipelagoForGeoMakePointField(j.info[0],c);if(e){var g=c.filter(function(a){var b=a.qName;return e[b]&&!d.isGeoField(a)}),h=g.map(function(a){var c=b.createFieldDimension(a.qName);return{name:a.qName,dimension:c}});k(j.info[0],h,a,b,f)}i()}):d.isGeoField(j.info[0])?e.getListLayout().then(function(c){for(var e,g=0;g<c.length;g++)if(c[g].qName===j.info[0].qName){e=c[g];break}if(e){var h=d.getFieldsInArchipelago(e,c),k=d.isGeoPointField(e),l=c.filter(function(a){var b=a.qName;return h[b]&&(!d.isGeoField(a)||k&&b===e.qName)}),n=l.map(function(a){var c=b.createFieldDimension(a.qName);return{name:a.qName,dimension:c}});m(e,n,a,b,f)}i()}):c.current.findMatchingFields(j.info[0].qName,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(c){var e,j,k=a.item,l=c.qFieldNames;0===l.length?i():1===l.length?(e=b.createLibraryDimension(k.id),d.isGeoPointField(l[0])?(j=b.createFieldDimension(l[0].qName),h(e,j,b,f)):g(e,l[0],b,f)):(e=b.createLibraryDimension(k.id),n(e,l,a,b,f),i())})},getDropMeasureOptions:function(a,c,d,e){var f=a.item,g=c.getLayersWithoutMeasure();g.length&&g.forEach(function(e){a.menu.addItem({translation:["contextMenu.add",f.name],tid:"add",select:function(){var a;switch(e.type){case"polygon":a=e.qHyperCubeDef?c.createLibraryMeasure(f.id):{qLibraryId:f.id},c.addMeasureToPolygonLayer(e,a);break;case"point":a=c.createLibraryMeasure(f.id),c.addMeasureToPointLayer(e,a);break;default:return}d.save(),b.$rootScope.$broadcast("pp-open-path","data."+e.cId)}})}),e()},addFieldDimension:function(a,c){return c.model.getProperties().then(function(e){if(!(e.layers.length>=p)){var f=c.ext.getCreatePropertyHandler();f.setProperties(e),d.addLayer(a,e,f),b.$rootScope.$broadcast("pp-open-path","data."+e.layers[0].cId)}})},addLibraryDimension:function(a,c){return c.model.getProperties().then(function(e){if(!(e.layers.length>=p)){var f=c.ext.getCreatePropertyHandler();f.setProperties(e),d.addLayer(a,e,f),b.$rootScope.$broadcast("pp-open-path","data."+e.layers[0].cId)}})}}}),define("extensions.qliktech/map/interaction-controller",["jquery","util","objects.utils/event-utils","objects.utils/shapes/point","objects.views/charts/utils/matrix","extensions.qliktech/map/projection/unit-projection","touche"],function(a,b,c,d,e,f){"use strict";function g(a){if(a){var b=a.getActiveType?a.getActiveType():void 0,c=a.types?a.types.tooltip:void 0;b&&b.clearSelection&&b.getActiveMode&&"item"!==b.getActiveMode()&&b.clearSelection(),c&&c.clearSelection&&this.chart&&this.chart.components&&this.chart.components.dataArea.id===c.tooltipComponentId&&c.clearSelection()}}function h(){var a=this._viewportProjection.getMapCenterInLonLat();Math.abs(a.x)>180&&(a.x=a.x%360,a.x>180?a.x-=360:a.x<-180&&(a.x+=360),this._viewportProjection.setMapCenterInLonLat(a))}function i(a){g.call(this,this.chart.selections),a=Math.min(Math.max(a,this._minZoomLevel),this._maxZoomLevel),this._viewportProjection.setZoomLevel(a)}function j(a,b,c,d){var f,g,h,i,j,k=new e,l=c/d;h=b.x-a.x,i=b.y-a.y,f=this._localMatrix.clone().invert().transformPoint(a),k.translate(f.x,f.y),k.scale(l,l),k.translate(-f.x,-f.y),this._localMatrix=this._localMatrix.multiply(k),j=this._localMatrix.elements,this._localMatrix.translate(h/j[0][0],i/j[1][1]),m.call(this),k.identity(),g=this._globalMatrix.clone().invert().transformPoint(a),k.translate(g.x,g.y),k.scale(l,l),k.translate(-g.x,-g.y),this._globalMatrix=this._globalMatrix.multiply(k),j=this._globalMatrix.elements,this._globalMatrix.translate(h/j[0][0],i/j[1][1])}function k(a){var b=this.dataArea.layersContainer;b.style["-webkit-transform"]=a,b.style["-moz-transform"]=a,b.style["-o-transform"]=a,b.style["-ms-transform"]=a,b.style.transform=a}function l(){if(!this._setTransformOrigin){var a=this.dataArea.layersContainer,b="top left";a.style["-webkit-transform-origin"]=b,a.style["-moz-transform-origin"]=b,a.style["-o-transform-origin"]=b,a.style["-ms-transform-origin"]=b,a.style["transform-origin"]=b,this._setTransformOrigin=!0}}function m(){var a=this._localMatrix.elements,b="matrix("+a[0][0]+",0,0,"+a[1][1]+","+a[0][2]+","+a[1][2]+")";k.call(this,b)}function n(){this._interactionStarted||(g.call(this,this.chart.selections),this._localMatrix.identity(),this._globalMatrix=this._viewportProjection.getTransformMatrix().clone(),this._interactionStarted=!0)}function o(){if(!(this._zooming||this._panning||this._pinching)){var a=!1;k.call(this,"matrix(1,0,0,1,0,0)"),this._viewportProjection.enabledChangeEvent=!1,this._viewportProjection.setTransformMatrix(this._globalMatrix),this.dataArea.hasVisibleBaseLayer()&&(h.call(this),a=this.dataArea.baseMapLayer.updateViewportToBaseMap(!0)),a||this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0,this._interactionStarted=!1}}function p(a,b){q.apply(this,[a,b])}function q(a,c){if(!this._disableZoomOnMouseWheel){this._disableZoomOnMouseWheel=!0;var d=this;if(setTimeout(function(){d._disableZoomOnMouseWheel=!1},d._mouseWheelTimeoutPeriod),!this._zoomPanByWebkitTransform)return void w.apply(this,[a,c]);var f,g,h=new e;this._zooming=!0,n.call(this),f=this._localMatrix.clone().invert().transformPoint(a),h.translate(f.x,f.y),h.scale(c,c),h.translate(-f.x,-f.y),this._localMatrix=this._localMatrix.multiply(h),m.call(this),h.identity(),g=this._globalMatrix.clone().invert().transformPoint(a),h.translate(g.x,g.y),h.scale(c,c),h.translate(-g.x,-g.y),this._globalMatrix=this._globalMatrix.multiply(h)}}function r(){this._zooming=!1,(this._zoomPanByWebkitTransform)&&o.call(this)}function s(a,b){t.apply(this,[a,b])}function t(a,c){if(!this._zoomPanByWebkitTransform)return void v.apply(this,[a,c]);this._panning=!0,n.call(this);var d=this._localMatrix.elements;this._localMatrix.translate(a/d[0][0],c/d[1][1]),m.call(this),d=this._globalMatrix.elements,this._globalMatrix.translate(a/d[0][0],c/d[1][1])}function u(){this._panning=!1,(this._zoomPanByWebkitTransform)&&o.call(this)}function v(a,b){this._viewportProjection.enabledChangeEvent=!1,this.moveViewport(a,b),this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0}function w(a,b){this._viewportProjection.enabledChangeEvent=!1,this.zoomOnPixel(a,b),this._viewportProjection.fire("changedByInteraction"),this._viewportProjection.enabledChangeEvent=!0}function x(a,b){this.chart=a,this.dataArea=this.chart.components.dataArea,this._minZoomLevel=0,this._maxZoomLevel=20,this._interactionStarted=!1,this._zoomPanByWebkitTransform=!1,this._fractionalZoomMode=!0,this._defaultScale=Math.pow(2,.5),this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=50,this._viewportProjection=b,this._viewportProjection.setMinZoomLevel(this._minZoomLevel),this._viewportProjection.setMaxZoomLevel(this._maxZoomLevel),this._localMatrix=new e}var y=200,z=1e-6;return x.prototype={setOffset:function(a){this._offset=a},navigate:function(a){var b,c=this;switch(a){case"resetZoom":c.zoomOnMapBounds();break;case"zoomIn":if(b=c.getZoomLevel(),void 0===b||null===b||b===c._maxZoomLevel)return;c.zoom(c._defaultScale);break;case"zoomOut":if(b=c.getZoomLevel(),void 0===b||null===b||b===c._minZoomLevel)return;c.zoom(c._invDefaultScale);break;case"navUp":v.apply(c,[0,y]);break;case"navDown":v.apply(c,[0,-y]);break;case"navLeft":v.apply(c,[y,0]);break;case"navRight":v.apply(c,[-y,0])}},onPan:function(a,b,c){var d=this;switch(a){case"start":s.apply(d,[c.swipe.deltaX,c.swipe.deltaY]);break;case"update":t.apply(d,[c.swipe.curDeltaX,c.swipe.curDeltaY]);break;case"end":u.apply(d)}},on:function(b,e){var f,g,h,i,k=this,m=!1,v=!1;l.call(this);var w=function(a){var b,e,f,g,h=c.getMouseWheelData(a.originalEvent);b=h.x-k._offset.left,e=h.y-k._offset.top,f=new d(b,e),g=h.delta>0?k._defaultScale:k._invDefaultScale,v?q.apply(k,[f,g]):p.apply(k,[f,g]),v=!0,null!==i&&clearTimeout(i),i=setTimeout(function(){i=null,r.call(k),v=!1},250)};c.throttle(w,20),a(e).on("mousewheel"+b+" DOMMouseScroll"+b,function(a){w(a),a.preventDefault()}),Touche(e).wheelswipe({id:b,start:function(a){k._panX=a.pageX,k._panY=a.pageY,m=!1},update:function(a){var b,c,d,e,f;b=a.pageX,c=a.pageY,d=b-k._panX,e=c-k._panY,f=m,!m&&(Math.abs(d)>3||Math.abs(e)>3)&&(m=!0),m&&(k._panX=b,k._panY=c,f?t.apply(k,[d,e]):s.apply(k,[d,e]))},end:function(){m?u.call(k):k.zoomOnMapBounds(),m=!1}}),Touche(e).pinch({id:b,options:{useMomentum:!0,inertia:.7},start:function(a,b){g={},g.x=(this.pinch.start.point1.x+this.pinch.start.point2.x)/2-k._offset.left,g.y=(this.pinch.start.point1.y+this.pinch.start.point2.y)/2-k._offset.top,h={x:b.centerPoint.x-k._offset.left,y:b.centerPoint.y-k._offset.top},k._pinching=!0,n.call(k),j.apply(k,[g,h,b.scale,b.scale]),f=b.scale,g=h,Touche.preventGestures(this.gestureHandler)},update:function(a,b){h={x:b.centerPoint.x-k._offset.left,y:b.centerPoint.y-k._offset.top},k._pinching=!0,n.call(k),j.apply(k,[g,h,b.scale,f]),f=b.scale,g=h,Touche.preventGestures(this.gestureHandler)},end:function(){k._pinching=!1,o.call(k)}}),Touche(e).swipe({id:b,options:{useMomentum:!0,touches:2,inertia:.7},start:function(a,b){k.onPan("start",a,b),Touche.preventGestures(this.gestureHandler)},update:function(a,b){k.onPan("update",a,b)},end:function(a,b){k.onPan("end",a,b)}}),Touche(e).tap({id:b,options:{touches:3},end:function(){k.zoomOnMapBounds(),Touche.preventGestures(this.gestureHandler)}})},setMaxZoomLevel:function(a){this._maxZoomLevel=a,this._viewportProjection&&this._viewportProjection.setMaxZoomLevel(a)},setMinZoomLevel:function(a){this._minZoomLevel=a,this._viewportProjection&&this._viewportProjection.setMinZoomLevel(a)},setMapCenter:function(a){g.call(this,this.chart.selections),this._viewportProjection&&this._viewportProjection.setMapCenter(a)},getMapCenter:function(){return this._viewportProjection?this._viewportProjection.getMapCenter():null},setZoomLevel:function(a){!isNaN(a)&&isFinite(a)&&(Math.abs(a-Math.round(a))<z&&(a=Math.round(a)),i.call(this,a))},getZoomLevel:function(){return this._viewportProjection?this._viewportProjection.getZoomLevel():0},moveViewport:function(a,b){var c,e,g;this.dataArea.baseMapLayer&&this.dataArea.baseMapLayer.isReady()&&this.dataArea.baseMapLayer.show?(this.dataArea.baseMapLayer.panBy(-a,-b),c=this.dataArea.baseMapLayer.getMapCenter(),e=this._viewportProjection.getProjection()instanceof f?this._viewportProjection.getMercatorProjection().project(c):c,this.setMapCenter(e)):(g=this._viewportProjection.getSize(),this.setMapCenter(this._viewportProjection.invProject(new d(g.x/2-a,g.y/2-b))))},zoom:function(a){if(a>0){var b=Math.log(a)/Math.LN2;Math.abs(b-Math.round(b))<z&&(b=Math.round(b)),this.setZoomLevel(this.getZoomLevel()+b)}},zoomOnPixel:function(a,b){var c,d,e=this.getZoomLevel();e<=this._minZoomLevel&&1>=b||e>=this._maxZoomLevel&&b>=1||(g.call(this,this.chart.selections),c=Math.pow(2,this._minZoomLevel-e),d=Math.pow(2,this._maxZoomLevel-e),b=Math.min(Math.max(b,c),d),this._viewportProjection.zoomOnPixel(a,b),this.dataArea.hasVisibleBaseLayer()&&h.call(this))},zoomOnMapRectangle:function(a,b){g.call(this,this.chart.selections),this._viewportProjection.zoomOnMapRectangle(a,b)},zoomOnViewportRectangle:function(a,b){var c=this._viewportProjection.fromViewportRectToMapRect(a);this.zoomOnMapRectangle(c,b)},setMapBounds:function(a){!a||this._mapBounds&&this._mapBounds.equal(a)||(this._mapBounds=a.clone())},zoomOnMapBounds:function(){var a=this._mapBounds&&!this._mapBounds.hasNaN()?this._mapBounds:this._worldBounds;return a?(this.zoomOnMapRectangle(a,!1),this.dataArea.hasVisibleBaseLayer()&&(this._viewportProjection.inResetZoomMode=!0),this._viewportProjection.fire("resetZoomFinished"),!0):void 0},setFractionalZoomMode:function(a){this._fractionalZoomMode=a,this._defaultScale=this._fractionalZoomMode?Math.pow(2,.5):2,this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=this._fractionalZoomMode?50:100,this._viewportProjection&&this._viewportProjection.setFractionalZoomMode(a)},getFractionalZoomMode:function(){return this._fractionalZoomMode},setZoomPanByWebkitTransform:function(a){this._zoomPanByWebkitTransform=a},getZoomPanByWebkitTransform:function(){return this._zoomPanByWebkitTransform}},x}),define("extensions.qliktech/map/map",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","client.utils/state","objects.backend-api/map-api","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","text!./map.ng.html","extensions.qliktech/map/map-properties","extensions.qliktech/map/projection/viewport-projection","extensions.qliktech/map/projection/unit-projection","extensions.qliktech/map/map-area","objects.utils/shapes/rect","objects.utils/event-utils","general.utils/property-mapper","extensions.qliktech/map/map-handler","objects.views/charts/components/axis/axis","objects.views/charts/components/legend/color-legend","extensions.qliktech/map/add-popover/add-layer-popover","extensions.qliktech/map/map-layer-creation","extensions.qliktech/map/interaction-controller","core.utils/deferred","extensions.qliktech/scatterplot/directives/navigation/scatterplot-navigation","touche","objects.views/charts/disclaimers/chart-disclaimer-directive"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){"use strict";function w(a){var b=a&&a.qDimensionInfo&&!a.qDimensionInfo.qError;return b}function x(a){var b=a&&a.qDimensionInfo.length&&!a.qDimensionInfo.some(function(a){return!!a.qError});return a.qMeasureInfo&&a.qMeasureInfo.length&&(b=b&&!a.qMeasureInfo.some(function(a){return!!a.qError})),b}function y(a){if(!(a&&(a.layers&&0!==a.layers.length||a.background&&a.background.show)))return!1;var b,c,d=Math.min(a.layers.length,O);for(b=0;d>b;b++)if(c=a.layers[b],c.qListObject){if(w(c.qListObject))return!0}else{if(!c.qHyperCube)return!1;if(x(c.qHyperCube))return!0}return a.background&&a.background.show}function z(a){var b=a&&a.qDimensionInfo.every(function(a){return a.qLocked!==!0});return b}function A(a){var b=a&&a.qDimensionInfo.qLocked!==!0;return b}function B(a){this._projection&&a&&this._projection.getProjectionType()===a.getProjectionType()||(this._projection=a,this._projection||(this._projection=this._unitProjection),this._viewportProjection.setProjection(this._projection))}function C(a){this._viewportProjection.setSize(a)}function D(){this._resizing||this._layouting||(this._mapRect=this._viewportProjection.getMapRectOfViewport()),this.updateNavigation()}function E(){if(this.selections){var a=this.components.dataArea.getSelectableShapes(),b=this.components.dataArea.layers,c=this.selections.getActiveType?this.selections.getActiveType():!1,d=!!c;this.selections.cache&&(this.selections.cache.clear(),a.forEach(function(a){this.selections.cache.add(a)},this),d&&("item"===c.getActiveMode()?a.forEach(function(a){var c=b[a.layerIndex].getSelectedRows();a.selected=c&&c.indexOf(a.rowIndex)>=0}):(c.activeComponent instanceof q&&!c.activeComponent.isDiscrete()||c.activeComponent instanceof r&&"range"===c.getActiveMode())&&c.updateShapesState()),this.providers&&this.providers.tooltip&&this.providers.tooltip.setSelectableShapes(a)),Object.keys(this.components).forEach(function(b){["colorLegend","xAxis","dimensionAxis"].contains(b)&&this.components[b].setSelectableShapes(a)},this)}}function F(a){var b,c,d,e=a?a.length:0,f=[];for(b=0;e>b;b++)c=a[b],d=c.layerIndex,void 0===f[d]&&(f[d]=[]),f[d][f[d].length]=c;return f}function G(a,b,c){var d,e,f,g,h;for(d=c;d>-1;d--)for(e=b[d],f=e?e.length:0,g=0;f>g;g++)h=e[g],h.selected=!1}function H(a,b){!b||b.legend&&"auto"===b.legend.dock?a.outerRect.height/a.outerRect.width<1?a.setDock("right"):a.setDock("bottom"):a.setDock(b.legend.dock)}function I(){this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getMapRectOfViewport(),this._mapRect=this._mapRectInZoomOnMapBoundsMode.clone(),this.updateNavigation()}function J(){if(!this._mapRectInZoomOnMapBoundsMode)return!0;var a=this._mapRectInZoomOnMapBoundsMode.x-this._mapRect.x,b=this._mapRectInZoomOnMapBoundsMode.y-this._mapRect.y,c=this._mapRect.width-this._mapRectInZoomOnMapBoundsMode.width,d=this._mapRect.height-this._mapRectInZoomOnMapBoundsMode.height;return Math.abs(a)<N&&Math.abs(c)<N&&b>-N&&d>-N||Math.abs(b)<N&&Math.abs(d)<N&&a>-N&&c>-N?!0:!1}function K(a,b){var c=this;this.$scope.navigationVisible=a,this.$scope.navigationHomeOnly=void 0===b?(this.rect.width<400||this.rect.height<400||!this._data.navigation)&&!this.backendApi.isSnapshot&&this._layoutMode>3:b,this.$scope.navigationStyle={top:this.components.dataArea.rect.y+13+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+13+"px"},void 0===this._timeoutID&&(this._timeoutID=setTimeout(function(){c._timeoutID=void 0,c.$scope.$digest()}))}var L,M=".map",N=1e-9,O=1;return L=b.extend("Map",{namespace:M,init:function(b,d,e,h){var i=this;e=a.extend(!0,e||{},{providers:{colorMap:{clazz:f,multiDimScheme:"first",colorBy:"primary",autoMode:"primary"}},components:{dataArea:{show:!0,dock:"center",clazz:l,showFlag:c.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:c.prototype.ShowFlags.MEDIUM}}}),this._super(b,d,e,h),this.backendApi=h,this.components.colorLegend.hideComponent(),this._autoZoomOnDataChange=!0,this._worldBounds=new m(-180,-180,360,360),this._unitProjection=new k,this.setViewportProjection(new j),B.call(this,this._unitProjection),this.interactionController=new u(this,this._viewportProjection),this.components.dataArea.setMaxNumLayers(O),this.components.dataArea.setMap(this),this.components.dataArea.setBackendApi(this.backendApi),this.components.dataArea.setLegend(this.components.colorLegend),this.components.dataArea.setChartContext(this._chartContext),this.components.dataArea.setInteractionController(this.interactionController),this._changeWatchers=this._changeWatchers||[],
this._changeWatchers.push(g.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(g.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this.onNavigationPressed=b.$on("navigationPressed",function(a,b){a.preventDefault(),i.interactionController.navigate(b)}),this.$scope.navigationDisabled=!0,this._scaleMapOnResize=!0},setFormatter:function(a){var b;if(this.chartFormatter=a,this.chartFormatter){for(b in this.components)this.components[b].chartFormatter=this.chartFormatter,this.components[b].measureFormatters=this.chartFormatter.getFormatters(),this.components[b].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter();this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.selections&&this.selections.types.tooltip&&(this.selections.types.tooltip.measureFormatters=this.chartFormatter.getFormatters())}},setViewportProjection:function(a){this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished",I,this),this._viewportProjection.stopListen("changed",D,this),this._viewportProjection.stopListen("changedByInteraction",D,this)),this._viewportProjection=a,this.components.dataArea.setViewportProjection(this._viewportProjection),this._viewportProjection&&(this._viewportProjection.listen("resetZoomFinished",I,this),this._viewportProjection.listen("changed",D,this),this._viewportProjection.listen("changedByInteraction",D,this))},getViewportProjection:function(){return this._viewportProjection},paint:function(a,b){this._super(a,b)},suppressOnPaint:function(a){var b;return this.$scope.object.forcePaint?(this.$scope.object.forcePaint=!1,b=!1):b=a.qSelectionInfo&&a.qSelectionInfo.qInSelections,b&&this.prePaint(a),b},prePaint:function(a){this._super();var b=this,c=!1;a.layers.forEach(function(a){var d=a.qHyperCube?a.qHyperCube:a.qListObject,e=d&&d.qDataPages&&d.qDataPages[0]&&d.qDataPages[0].qMatrix?d.qDataPages[0].qMatrix.length:0;b.$scope.dataAttributes.limitedData=e>0&&d.qSize.qcy>e,b.$scope.dataAttributes.limitedData&&(c=!0)}),this.$scope.options.showDisclaimerStar=c,this.$element.toggleClass("qv-viz-with-disclaimer",c)},_updateData:function(a,b){this.layersReady=!1,this._data=a,this._readStoredData=a&&a.snapshotData&&a.snapshotData.content&&!this.isEffect&&this.backendApi.isSnapshot,this.setAutoZoomOnDataChange(this._data.autoZoomOnSelection),this.updateSelectableState(a),this.components.dataArea.setData(a),this.selections&&this.selections.types&&this.selections.types.tooltip&&(this.selections.types.tooltip.enabled=this.components.dataArea.hasVisibleLayer(),this.selections.types.tooltip.parentScope=this.$scope,this.selections.types.tooltip.colorMap=this.providers.colorMap),this.updateLegend(a,b)},_postResize:function(){this._super(),H.apply(this,[this.components.colorLegend,this._data])},updateLegend:function(a){if(this.components.colorLegend){H.apply(this,[this.components.colorLegend,a]);var b=a&&a.legend&&a.legend.show;b=b&&this.components.dataArea.hasVisibleLayer(),b?this.components.colorLegend.showComponent():this.components.colorLegend.hideComponent()}},updateSelectableState:function(a){this.selections&&(this.isDataSelectable(a||this._data)?(this.selections.setLocked(!1),this.components.colorLegend.setLocked(!1),"byMeasure"===this._data.color.mode&&this._data.layers[0].qListObject?this.selections.types.colorLegend.removeComponent("colorLegend",this.components.colorLegend):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)):(this.selections.setLocked(!0),this.components.colorLegend.setLocked(!0)))},isValid:function(a){var b,c=y(a);for(b in this.components)this.components[b].setHasValidData(c);return c},isDataSelectable:function(a){if(!this.isValid(a)||!this.allowInteraction(d))return!1;var b,c=Math.min(a.layers.length,O);for(b=0;c>b;b++){if(a.layers[b].qListObject&&A(a.layers[b].qListObject))return!0;if(a.layers[b].qHyperCube&&z(a.layers[b].qHyperCube))return!0}return!1},setAutoZoomOnDataChange:function(a){this._autoZoomOnDataChange=!!a},getAutoZoomOnDataChange:function(){return this._autoZoomOnDataChange},setScaleMapOnResize:function(a){this._scaleMapOnResize=a},getScaleMapOnResize:function(){return this._scaleMapOnResize},setMapCenter:function(a){this.interactionController.setMapCenter(a)},getMapCenter:function(){return this.interactionController.getMapCenter()},setZoomLevel:function(a){this.interactionController.setZoomLevel(a)},getZoomLevel:function(){return this.interactionController.getZoomLevel()},setMapBounds:function(a){this._mapBounds=a.clone(),this.interactionController.setMapBounds(a),this._autoZoomOnDataChange||(this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getMapRectOfViewportIfZoomOnAMapRect(this._mapBounds),this.updateNavigation())},zoomOnMapBounds:function(){return this.interactionController.zoomOnMapBounds()},setFractionalZoomMode:function(a){this.interactionController.setFractionalZoomMode(a)},getFractionalZoomMode:function(){return this.interactionController.getFractionalZoomMode()},setZoomPanByWebkitTransform:function(a){this.interactionController.setZoomPanByWebkitTransform(a)},getZoomPanByWebkitTransform:function(){return this.interactionController.getZoomPanByWebkitTransform()},on:function(){return this._on?void this._super():(this.interactionController.on(M,this.components.dataArea.container),Touche(this.container).longtap({id:M}),this._super(),this.$scope.navigationDisabled=!1,void(this._on=!0))},off:function(){this.$scope.navigationDisabled=!0,this._on&&(Touche(this.components.dataArea.container).off("*",M),Touche(this.container).off("*",M),a(this.components.dataArea.container).off(M),a(this.container).off(M),this._super(),this._on=!1)},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.types.tooltip.setComponent("dataArea",this.components.dataArea),this.selections.Pan.bind(this.interactionController.onPan.bind(this.interactionController)),this.options._disableSelections||(this.selections.Activated.bind(this.Activated.bind(this)),this.selections.Deactivated.bind(this.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.ToggleShapes.bind(this.ToggleShapes.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},selectWhileLocked:function(){var a,b=[];this._data.layers.forEach(function(c){a=c.qHyperCube?c.qHyperCube:c.qListObject,b.push(a.qDimensionInfo instanceof Array?a.qDimensionInfo[0]:a.qDimensionInfo)}),n.showLockedFeedback(b)},ToggleShapes:function(a,b){if(a&&0!==a.length){var c,d,e,f,g,h,i,j=this;for(this._haveToggledShapes=!1,this._renderOnToggleShapes=!0,setTimeout(function(){j._renderOnToggleShapes&&j.onSelection.scheduleInvalidation.call(j,!0),j._renderOnToggleShapes=!1},50),e=this._data&&this._data.layers?Math.min(this._data.layers.length,O):0,d=F(a),h=4===(4&b)?!0:!1,this._layerIndexOfClick=-1,f=e-1;f>-1;f--)if(c=this.components.dataArea.layers[f],g=d[f],i=g?g.length:0,c.isVisible()&&0!==i&&(c.toggleShapes(g),h))return this._layerIndexOfClick=f,void G(a,d,f-1)}},Activated:function(){this.onSelection.Activated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!0)},Deactivated:function(){this._renderOnToggleShapes=!1,this.onSelection.Deactivated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Cancel:function(){this.onSelection.Cancel.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Clear:function(){this.onSelection.Clear.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Select:function(a,b,c){var d,e=F(a),f=Array.isArray(c)?c:[c||0],g=this.components.dataArea.layers,h=g?g.length:0;if(-1===this._layerIndexOfClick){for(d=0;h>d;d++)"hyperCube"===g[d].getDataType()&&g[d].selectOnLayer(e[d],f);for(d=0;h>d;d++)"listObject"===g[d].getDataType()&&g[d].selectOnLayer(e[d],f)}else d=this._layerIndexOfClick,g[d].selectOnLayer(e[d],f)},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]);var a;for(a in this.components)this._changeWatchers.push(g.bindProperty(this.components[a],"layoutMode",this,"layoutMode"));this.components.dataArea&&this._changeWatchers.push(g.bindSetter(E.bind(this),this.components.dataArea,"selectableShapes"))},resize:function(){this._resizing=!0,this._super(),this._resizing=!1},layout:function(){this._super();var b=this.components.dataArea?this.components.dataArea.rect:this.rect;C.call(this,{x:b.width,y:b.height}),this.components.dataArea.setRect(b.x,b.y,b.width,b.height),this.components.dataArea.updateSize(),this.components.dataArea&&this.interactionController.setOffset(a(this.components.dataArea.container).offset())},setPreselectionMode:function(a){this._preselectionMode=a,this.components.dataArea.setPreselectionMode(a)},_paint:function(){if(this.layersReady){var a;if(this._super()===!1)return!1;if(this._layouting=!0,this.layout(),this._layouting=!1,this.backendApi.isSnapshot&&this._readStoredData){var b=this.getSnapshotStoredChartData(),c=b.mapRect;c&&void 0!==c.width&&void 0!==c.height&&void 0!==c.x&&void 0!==c.y?this._viewportProjection.zoomOnMapRectangle(c,!0):this.zoomOnMapBounds()}else!this._inZoomOnMapBoundsMode||this._firstTimeZoomOnMapBound&&!this._autoZoomOnDataChange?this._scaleMapOnResize&&this._mapRect&&this._viewportProjection.zoomOnMapRectangle(this._mapRect,!0):this._firstTimeZoomOnMapBound=this.zoomOnMapBounds();for(a in this.components)this.components[a].invalidateDisplay("Map._paint");return this.updateNavigation(),this._dataChanged=!1,!0}},updateNavigation:function(a){var b,c;this._data&&this.rect&&this._mapRect&&(b=(this.rect.width<400||this.rect.height<400||!this._data.navigation)&&this._on&&!d.isInEditMode()&&this._layoutMode>3,this._inZoomOnMapBoundsMode=J.call(this),c=void 0===a?(!this._inZoomOnMapBoundsMode||!!this._data.navigation)&&this._on&&!d.isInEditMode()&&(this._layoutMode>3||b&&this._layoutMode>=3):!a,K.apply(this,[c,b]))},getContextMenu:function(a,b){var c=a,e=c.model,f=d.isInEditMode(),g=e.layout;c.isReadonly&&f||b.addItem({translation:"Common.Navigation",tid:"navigation",icon:"icon-hub-home",select:function(){if(f)e.getProperties().then(function(a){a.navigation=!a.navigation,e.save()});else{var a=[[],!0];a[0][0]={qPath:"/navigation",qOp:void 0===g.navigation?"add":"replace",qValue:g.navigation?"false":"true"},c.backendApi.applyPatches(a)}}})},destroy:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished"),this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this.onNavigationPressed()},getViewState:function(){return d.state},setSnapshotData:function(a){var b=[];if(this._super(a),this.isSnapshot())return v.resolve();for(var c=0;c<this._data.layers.length;c++)b[c]=this.components.dataArea.layers[c].getSnapshotLayerData(a.layers[c]);return v.all(b)},getSnapshotChartData:function(){return a.extend(!0,this._super()||{},{mapRect:this._viewportProjection.getMapRectOfViewport()})},isSnapshot:function(){return this.backendApi&&this.backendApi.isSnapshot}}),{type:"map",BackendApi:e,template:h,View:L,definition:i,initialProperties:{version:"0.9",layers:[]},exportProperties:null,importProperties:null,getDimensionInfo:function(){return[]},getMeasureInfo:function(){return[]},onStateChanged:function(a){this.components.dataArea.baseMapLayer&&this.components.dataArea.baseMapLayer.setViewState(a)},mapProperties:function(){this.mappedDefinition=o.mapDefinition(this.definition,this.type),this.dimensionDefinition={min:1,max:1,ppPath:"data"}},addFieldDimension:t.addFieldDimension,addLibraryDimension:t.addLibraryDimension,addDimensionPopoverComponent:s,getDropFieldOptions:t.getDropFieldOptions,getDropDimensionOptions:t.getDropDimensionOptions,getDropMeasureOptions:t.getDropMeasureOptions,getCreatePropertyHandler:function(){return new p(this.dimensionDefinition)},hasError:function(a){var b,c,d=a.layout;for(b=0;b<d.layers.length;++b){if(c=d.layers[b],c.qHyperCube&&c.qHyperCube.qError)return c.qHyperCube.qError;if(c.geodata&&c.geodata.qHyperCube&&c.geodata.qHyperCube.qError)return c.geodata.qHyperCube.qError}return!1},showRequirements:function(a){var b=a.layout;return!b.layers||!b.layers.length},snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},tooltip:{},colorLegend:{}}}}}),define("extensions.qliktech/combochart/markerarea",["core.utils/deferred","objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","extensions.qliktech/linechart/layers/oob-layer"],function(a,b,c,d,e,f,g,h){function i(a){switch(a){case"diamond":case"triangle":return new f;case"circle":return new e;case"line":return new g;default:return new g}}function j(a,b,c,d,e,f){var g,h=e.type,i=e.rgb,j=e.shiftedRgb,k=.5,l=e.isFilled,m=!0;switch(h){case"circle":a.set(b,c,Math.max(2,Math.min(6,.125*d)));break;case"diamond":g=Math.max(2,Math.min(12,.25*d)),a.set([{x:b,y:c-g/2},{x:b-g/2,y:c},{x:b,y:c+g/2},{x:b+g/2,y:c}]);break;case"triangle":g=Math.max(2,Math.min(12,.25*d)),a.set([{x:b,y:c-g/2},{x:b-g/2,y:c+g/2},{x:b+g/2,y:c+g/2}]);break;case"line":g=Math.max(2,.5*d),24>g?a.set(b-g/2,Math.floor(c)-k,g,Math.min(3,Math.max(2,Math.round(g/4)))):a.set(Math.floor(b-g/2)-k,Math.floor(c)-k,Math.ceil(g),Math.min(3,Math.max(2,Math.round(g/4)))),l=!0;break;default:g=Math.max(2,Math.min(12,.25*d)),a.set(b-g/2,c-g/2,g,g)}m&&l!==!1?(a.fill=i,a.stroke=j):(a.stroke=i,delete a.fill),f&&(a.stroke="#000000")}function k(a){var b,c,d,e,f,g,h,i=this._shapes?this._shapes.length:0,k=this.rect.width,l=this._majorAxis;for(this._outOfRange={up:{},down:{},points:[]},b=0;i>b;b++)h=this._shapes[b],e=this._minorAxes[h.data.axisIdx],f=a[this._measureToAxisIndex[h.data.measureIdx]],g=l.getWidthOfId(h.data.axisId),c=l.getPositionOfId(h.data.axisId),d=e.getPositionOfValue(h.data.end),h.data.x=c,h.data.y=d,h.data.outOfRangeUp=d<f.topCutoff,h.data.outOfRangeDown=d>f.bottomCutoff,h.data.selected=h.data.cacheItem&&h.data.cacheItem.selected,h.opacity=h.data.outOfRangeUp||h.data.outOfRangeDown?0:h.data.selected?1:this._globalAlpha,d=h.data.outOfRangeUp?f.topCutoff+4:h.data.outOfRangeDown?f.bottomCutoff-4:Math.floor(d),j(h,c,d,g,h.data,h.data.cacheItem&&h.data.cacheItem.selected),h.data.isVisible=c>0&&k>c,h.data.isVisible&&(h.data.outOfRangeUp||h.data.outOfRangeDown)&&(h.data.outOfRangeUp&&!this._outOfRange.up[c]?(this._outOfRange.points.push(h),this._outOfRange.up[c]=!0):h.data.outOfRangeDown&&!this._outOfRange.down[c]&&(this._outOfRange.points.push(h),this._outOfRange.down[c]=!0))}var l;return l=b.extend("MarkerArea",{init:function(){this._super.apply(this,arguments),this.renderers={markers:new c(this.container,{name:"marker-layer"})},this._oobLayer=new h(this.container),this.layers=[this._oobLayer],this._markerRenderer=this.renderers.markers},setColorMap:function(a){this._colorMap=a},getColorMap:function(){return this._colorMap},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(a){this._measureIndices=a},setMajorAxis:function(a){this._majorAxis=a,this._majorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMajorAxis")},this)},setMinorAxis:function(a){this._minorAxis=a,this._minorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMinorAxis")},this)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setSecondaryMinorAxis")},this)},setDimensionTree:function(a){this._tree=a,this.invalidateProperties()},hasValidData:function(){return this._super()&&this._data},getMajorAxisData:function(){return this._majorAxisData},createAxisData:function(a,b,c,d){d||(this._cacheIndex=0);var e=a.children;return e.map(function(a){var c;return"dimension"===b.types[d]&&(c={label:a.data.qText,group:!1,id:a.data.id,cacheIndex:[]},"measure"===b.types[d+1]&&c.cacheIndex.push(this._cacheIndex++)),c},this)},_createMeasureDisplayNode:function(a,b,c,d){var e=i(c),f=a.children[0].data,g=a.parent.cacheItem,h=this.measureFormatters[b],j="undefined"!=typeof f.qValue?f.qValue:f.qNum,k=a.ancestors.filter(function(a){return"qElemNo"in a.data}).map(function(a){return a.data.qElemNo}).reverse();return e.data={qText:a.data.qText,qNum:j,start:0,end:j,valueLabel:h&&"U"===h.type?h.formatValue(j):a.data.qText,cacheItem:g,type:c,isFilled:d,measureIdx:b,color:this._colorMap.getColor(k,j,b,a.data.rowIndex)},g.addShape("dataArea",e,!0),e.fill=e.data.color.toHex(),e.data.rgb=e.data.color.toRGBA(),e.data.shiftedRgb=e.data.color.createShiftedColor().toRGBA(),e},_createDimensionDisplayNode:function(a){var b=new d;return b.data={qText:a.data.qText},b},_applyIds:function(a,b,c,d){var e;a.children.forEach(function(f,g){e=a.data.id?a.data.id+";"||"":"","dimension"===c[d]?(f.data.id=e+b[d]+":"+f.data.qElemNo,this._applyIds(f,b,c,d+1)):"measure"===c[d]&&(f.data.id=e+b[d+g])},this)},getRenderTree:function(a,b,c,d){var e,f,g;return f=a.children,"measure"===b.types[d]&&this._measureIndices&&(f=f.filter(function(a,b){return this._measureIndices.indexOf(b)>=0},this)),f.map(function(a,f){var h;return"dimension"===b.types[d]?(h=this._createDimensionDisplayNode(a),e=this.getRenderTree(a,b,c,d+1),e.forEach(function(a){h.addChild(a)})):"measure"===b.types[d]&&(g=this._measureIndices?this._measureIndices[f]:f,h=this._createMeasureDisplayNode(a,g,this._data.qHyperCube.qMeasureInfo[g].series.marker||"circle",this._data.qHyperCube.qMeasureInfo[g].series.markerFill),h.data.axisId=a.parent.data.id,h.data.axisIdx=b.measureToAxisIndex[g],c.shapes.push(h)),h},this)},_updateProperties:function(){if(this._markerRenderer.stage.removeChildren(),this._data&&this._tree){var a,b,c=this._data.qHyperCube.qDimensionInfo.length,d=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,e=c+1,f=new Array(c).join(",").split(",").map(function(){return"dimension"}),g=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(a){return a.cId}),h=this._data.qHyperCube.qDimensionInfo.map(function(a){return a.qApprMaxGlyphCount});h.push(this._data.qHyperCube.qMeasureInfo.reduce(function(a,b){return Math.max(a,b.qApprMaxGlyphCount)},0)),this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis);var i=this._minorAxes,j=[],k=[];if(this._measureIndices)k=this._measureIndices;else if(d>0&&20>d)for(;k.length<d;)k.push(k.slice(-1)[0]+1||0);k.forEach(function(a){j[a]=i.filter(function(b){return b._dataIndices?b._dataIndices.indexOf(a)>=0:!0})[0]}),this._measureToAxis=j,this._measureToAxisIndex=j.map(function(a){return i.indexOf(a)}),f.push("measure"),a={shapes:[],shapesToLabel:[],globalPositiveSum:0,globalNegativeSum:0},b={colIds:g,types:f,numLevels:e,numMeasures:d,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails)},this._applyIds(this._tree,g,f,0);var l=this.getRenderTree(this._tree,b,a,0);this._objects=l,this._shapes=a.shapes,l.forEach(function(a){this._markerRenderer.stage.addChild(a)},this);var m=this.createAxisData(this._tree,b,a,0),n=f.map(function(a,b){return{qApprMaxGlyphCount:h[b],show:b<f.length-1}});this._majorAxisData={data:m,info:n},this.setSelectableShapes(a.shapes.map(function(a){return a.data.cacheItem}))}},paint:function(){this._super(this._layoutMode,this._data);var b=this._minorAxes.map(this._getAxisDetails),c=[];return k.call(this,b),this._oobLayer&&(this._oobLayer.update(this._outOfRange.points,{measureToAxisIndex:this._measureToAxisIndex,axesSettings:b,globalAlpha:this._globalAlpha,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2)}),c.push(this._oobLayer.render())),c.push(this._markerRenderer.render()),a.all(c)},updateSize:function(){this._super(),this.renderers.markers.setDimensions(0,-1,this.rect.width,this.rect.height),this.layers.forEach(function(a){a.rect=this.rect,a.renderer.setDimensions(0,0,this.rect.width,this.rect.height),a.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this)},release:function(){this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this)},_getAxisDetails:function(a){var b=a.getPlotMin(),c=a.getPlotMax(),d=c-b,e=a.getPadding(),f=e.top-1,g=a.rect.height-e.bottom,h=0;return h=b>0?g:0>c?f:Math.floor(a.getPositionOfValue(0))-.5,{plotMin:b,plotMax:c,posMin:a.getPositionOfValue(b),posMax:a.getPositionOfValue(c),plotRange:d,topCutoff:f,bottomCutoff:g,areaStartBase:h,zeroPos:Math.floor(a.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/combochart/comboarea",["objects.views/charts/components/chart-component","extensions.qliktech/linechart/linearea","extensions.qliktech/barchart/bararea","extensions.qliktech/combochart/markerarea","core.utils/deferred"],function(a,b,c,d,e){"use strict";var f;return f=a.extend("ComboArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=null;var a=new(Function.prototype.bind.apply(c,[null].concat([].slice.call(arguments)))),e=new(Function.prototype.bind.apply(b,[null].concat([].slice.call(arguments)))),f=new(Function.prototype.bind.apply(d,[null].concat([].slice.call(arguments))));e.setShowDataPoints(!0),e.setShowDataPointLabels(!1),a.setShowDataPoints(!1),this.subComponents=[a,e,f],this.lineArea=e,this.barArea=a,this.markerArea=f},setColorMap:function(a){this._colorMap=a,this.subComponents.forEach(function(b){b.setColorMap(a)})},getColorMap:function(){return this._colorMap},setShowDataPoints:function(){},setMajorAxis:function(a){this.subComponents.forEach(function(b){b.setMajorAxis(a)}),this._majorAxis=a},setMinorAxis:function(a){this._minorAxis=a,this.subComponents[0].setMinorAxis(this._minorAxis),this.subComponents[2].setMinorAxis(this._minorAxis)},setSecondaryMinorAxis:function(a){this._secondaryMinorAxis=a},setDimensionTree:function(a){this._tree=a,this.subComponents.forEach(function(b){b.setDimensionTree(a)})},setData:function(a){this._super(a);for(var b=[],c=[],d=[],e=0;e<a.qHyperCube.qMeasureInfo.length;e++)a.qHyperCube.qMeasureInfo[e].series&&"line"===a.qHyperCube.qMeasureInfo[e].series.type?b.push(e):a.qHyperCube.qMeasureInfo[e].series&&"marker"===a.qHyperCube.qMeasureInfo[e].series.type?d.push(e):c.push(e);this.subComponents[0].setHasValidData(c.length>0),this.subComponents[1].setHasValidData(b.length>0),this.subComponents[2].setHasValidData(d.length>0),this.lineArea.setMeasureIndices(b),this.barArea.setMeasureIndices(c),this.markerArea.setMeasureIndices(d),this.subComponents.forEach(function(b){b.setData(a)}),this.barArea.setMinorAxis(this._minorAxis),this.lineArea.setMinorAxis(this._secondaryMinorAxis),this.lineArea.setSecondaryMinorAxis(this._minorAxis),this.markerArea.setMinorAxis(this._minorAxis),this.markerArea.setSecondaryMinorAxis(this._secondaryMinorAxis),this.invalidateProperties()},setHasValidData:function(a){this.subComponents.forEach(function(b){b.setHasValidData(a)})},setLayoutMode:function(a){this._super(a),this.subComponents.forEach(function(b){b.setLayoutMode(a)})},setRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setRect(a,b,c,d)})},setOuterRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setOuterRect(a,b,c,d)})},setLayoutToContainerRatios:function(a,b){this._super(a,b),this.subComponents.forEach(function(c){c.setLayoutToContainerRatios(a,b)})},setContainerRect:function(a,b,c,d){this._super(a,b,c,d),this.subComponents.forEach(function(e){e.setContainerRect(a,b,c,d)})},insertAdjacentTo:function(){this._super.apply(this,[].slice.call(arguments)),this.subComponents.forEach(function(a){a.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},this)},setGlobalOpacity:function(a,b){this._super(a,b),this.subComponents.forEach(function(c){c.setGlobalOpacity(a,b)},this)},setLineType:function(){},updateSize:function(){this._super(),this.subComponents.forEach(function(a){a.updateSize()},this)},_updateDisplay:function(){var a=[];return this.subComponents.forEach(function(b){a.push(b.invalidateDisplay())}),e.all(a)},_updateSize:function(){},_updateProperties:function(){if(this._data&&this._tree){this.subComponents[0].updateNow(["properties"]),this.subComponents[1].updateNow(["properties"]),this.subComponents[2].updateNow(["properties"]);var a=this.subComponents[0].getSelectableShapes();a&&a.length||(a=this.subComponents[1].getSelectableShapes()),a&&a.length||(a=this.subComponents[2].getSelectableShapes()),this.setSelectableShapes(a)}},invalidateProperties:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this.subComponents.forEach(function(a){a.invalidateProperties("ComboArea.invalidateProperties")})},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow()},release:function(){this.subComponents.forEach(function(a){a.release()})}})}),define("extensions.qliktech/combochart/combochart-properties",["translator","general.utils/property-resolver"],function(a,b){function c(a,c,d){var e,f=d||0;e=c?c.getMeasureLayouts():b.getValue(a,"qHyperCubeDef.qMeasures",[]).map(function(a){return a.qDef});var g=e.filter(function(a){return b.getValue(a,"series.axis",0)===f||0===f&&"bar"===b.getValue(a,"series.type","bar")});return g}function d(a,b){return b?b.getDimensionLayouts():a.qHyperCubeDef.qDimensions.map(function(a){return a.qDef})}function e(a,b){return b.getMeasures().filter(function(a){return a.qDef.series&&"line"===a.qDef.series.type}).length>0}function f(a,b){return b.getMeasures().filter(function(a){return!a.qDef.series||"bar"===a.qDef.series.type}).length>1}var g,h,i,j;return g={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,show:function(a,b){return e(a,b)||f(a,b)},items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"∫",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"ª",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(a,b){return f(a,b)}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,show:!1,items:[{component:"icon-item",icon:"º",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"Ω",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap",show:function(a,b){return e(a,b)&&b.getMeasures().length>1}},dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1,show:function(a,b){return e(a,b)}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{type:"items",label:function(b,c){var e,f="x",g=d(b,c).map(function(a){return a.qFallbackTitle||""}).join(", ");return e=g?a.get("properties."+f+"AxisWithInfo",[g]):a.get("properties."+f+"Axis")},items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(a){return["all","labels"].contains(a.dimensionAxis.show)}},dock:{ref:"dimensionAxis.dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}],show:function(a){return"none"!==a.dimensionAxis.show}}}},measureAxis:{uses:"measureAxis",label:function(b,d){var e,f=c(b,d,0).map(function(a){return a.qFallbackTitle});return e=f.length?a.get("properties.yAxisWithInfo",[f.join(",")]):a.get("properties.yAxis")},show:function(a){return c(a,null,0).length>0},items:{axis:{items:{show:{ref:"measureAxes.0.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"measureAxes.0.dock",show:function(a){return"none"!==a.measureAxes[0].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.0.spacing",show:function(a){return a.measureAxes[0]&&"none"!==a.measureAxes[0].show}}}},minMax:{items:{autoMinMax:{ref:"measureAxes.0.autoMinMax"},minMax:{ref:"measureAxes.0.minMax",defaultValue:"min",show:function(a){return!a.measureAxes[0].autoMinMax}},min:{ref:"measureAxes.0.min",show:function(a){return["min","minMax"].contains(a.measureAxes[0].minMax)&&!a.measureAxes[0].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[0].minMax?a.measureAxes[0].min>=a.measureAxes[0].max:!1}},max:{ref:"measureAxes.0.max",show:function(a){return["max","minMax"].contains(a.measureAxes[0].minMax)&&!a.measureAxes[0].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[0].minMax?a.measureAxes[0].min>=a.measureAxes[0].max:!1}}}}}},secondaryMeasureAxis:{uses:"measureAxis",label:function(b,d){var e,f=c(b,d,1).map(function(a){return a.qFallbackTitle});return e=f.length?a.get("properties.yAxisWithInfo",[f.join(",")]):a.get("properties.yAxis")},show:function(a){return c(a,null,1).length>0},items:{axis:{items:{show:{ref:"measureAxes.1.show"},dock:{ref:"measureAxes.1.dock",defaultValue:"far",show:function(a){return"none"!==a.measureAxes[1].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.1.spacing",show:function(a){return a.measureAxes[1]&&"none"!==a.measureAxes[1].show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxes.1.autoMinMax"},minMax:{ref:"measureAxes.1.minMax",defaultValue:"min",show:function(a){return!a.measureAxes[1].autoMinMax}},min:{ref:"measureAxes.1.min",show:function(a){return["min","minMax"].contains(a.measureAxes[1].minMax)&&!a.measureAxes[1].autoMinMax},invalid:function(a){return"minMax"===a.measureAxes[1].minMax?a.measureAxes[1].min>=a.measureAxes[1].max:!1}},max:{ref:"measureAxes.1.max",show:function(a){return["max","minMax"].contains(a.measureAxes[1].minMax)&&!a.measureAxes[1].autoMinMax;
},invalid:function(a){return"minMax"===a.measureAxes[1].minMax?a.measureAxes[1].min>=a.measureAxes[1].max:!1}}}}}}}},h={uses:"data",items:{dimensions:{},measures:{items:{series:{type:"items",items:{seriesType:{ref:"qDef.series.type",type:"string",component:"item-selection-list",defaultValue:"bar",horizontal:!0,items:[{icon:"∫",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.bar",value:"bar"},{icon:"æ",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"É",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.marker",value:"marker"}],change:function(){}},seriesAxis:{ref:"qDef.series.axis",type:"integer",component:"dropdown",defaultValue:0,options:[{translation:"properties.axis.primary",value:0},{translation:"properties.axis.secondary",value:1}],show:function(a){return a.qDef.series&&a.qDef.series.type&&"bar"!==a.qDef.series.type}},seriesMarker:{ref:"qDef.series.marker",type:"string",component:"dropdown",defaultValue:"circle",options:[{translation:"properties.marker.circle",value:"circle"},{translation:"properties.marker.rect",value:"rect"},{translation:"properties.marker.diamond",value:"diamond"},{translation:"properties.marker.triangle",value:"triangle"},{translation:"properties.marker.line",value:"line"}],show:function(a){return a.qDef.series&&"marker"===a.qDef.series.type}},seriesMarkerFill:{ref:"qDef.series.markerFill",translation:"properties.series.fill",type:"boolean",defaultValue:!0,show:function(a){return a.qDef.series&&"marker"===a.qDef.series.type&&!["line"].contains(a.qDef.series.marker)}}}}}}}},j={uses:"sorting"},i={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:h,sorting:j,addons:i,settings:g}}}),define("extensions.qliktech/combochart/combochart-data",["general.utils/property-resolver"],function(a){function b(b,c){var d=c.getMeasures(),e=a.getValue(b,"color.mode");"byMeasure"===e&&d.length>1?a.setValue(b,"color.mode","byDimension"):"byDimension"===e&&1===d.length&&"line"===a.getValue(d[0].qDef,"series.type")&&a.setValue(b,"color.mode","primary")}return{dimensions:{min:1,max:1,add:function(a,c,d){b(c,d)}},measures:{min:1,max:15,add:function(a,c,d){b(c,d)},replace:function(a,b){b.qDef.series&&(a.qDef.series.type=b.qDef.series.type||"bar")}}}}),define("text!extensions.qliktech/combochart/combochart.ng.html",[],function(){return'<div qv-extension class="qv-viz"></div>'}),define("extensions.qliktech/combochart/combochart",["jquery","util","qvangular","core.utils/deferred","client.utils/state","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","extensions.qliktech/combochart/comboarea","extensions.qliktech/combochart/combochart-properties","extensions.qliktech/combochart/combochart-data","objects.backend-api/hypercube-api","objects.extension/default-extension","objects.extension/object-conversion","text!./combochart.ng.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,c,d,e,f,g){if(c.length){var h,i,j;f?(h=f.min,i=f.max):(h=Math.min.apply(this,c.filter(function(a){return!isNaN(a.qMin)}).map(function(a){return a.qMin})),i=Math.max.apply(this,c.filter(function(a){return!isNaN(a.qMax)}).map(function(a){return a.qMax}))),b.isNumeric(h)||(h=-1),b.isNumeric(i)||(i=1),j=this.getAxisOptions(d),e&&(i=Math.max(0,i),h=Math.min(0,h)),g&&(g.min=h,g.max=i,g.minMeasure&&g.maxMeasure?(this._cutMode=this.getSpikeSettings(g,j),h=this._cutMode.min,i=this._cutMode.max):this._cutMode={positive:!1,negative:!1}),a.setRealDataRange(void 0,void 0),this.setAxisDataRange(a,i,h,j.max,j.min,1)}}function q(a,b){var d,e=this.item,f=["contextMenu.add",e.name];b.canAddMeasure()&&(d=this.menu.addItem({translation:f,tid:"add-as"}),d.addItem({translation:"contextMenu.asBar",tid:"as-bar",icon:"icon-bar-chart-vertical",select:function(){b.addLibraryMeasure(e.id).then(function(b){b.qDef.series.type="bar",a.save(),c.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})}}),d.addItem({translation:"contextMenu.asLine",tid:"as-line",icon:"icon-line-chart",select:function(){b.addLibraryMeasure(e.id).then(function(b){b.qDef.series.type="line",b.qDef.series.axis=1,a.save(),c.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})}}),d.addItem({translation:"contextMenu.asMarker",tid:"as-marker",icon:"icon-shapes",select:function(){b.addLibraryMeasure(e.id).then(function(b){b.qDef.series.type="marker",b.qDef.series.axis=1,a.save()})}}))}var r,s={NONE:0,ONE_DIM:1,TWO_DIM:2};return r=f.extend("ComboChart",{namespace:".combochart",init:function(b,c,d,e){d=a.extend(!0,{components:{dataArea:{clazz:i},axis:{show:!0,order:1.1,reductionOrder:2.1,dock:"right",relevantSize:90,showFlag:g.prototype.ShowFlags.XSMALL,clazz:h}}},d||{}),this._super(b,c,d,e),this.components.scrollArea.setUseMiniChart(!1),this.components.axis.setShowStrategy("all"),this.components.dataArea.setSecondaryMinorAxis(this.components.axis)},partialUpdate:function(a){var b,c,e,f=[];this._enablePagingTransitions(),this._chartContext.refresh(a),this.providers.colorMap.setData(a),c=a.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:a.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(c*this.scrollMultiplicator);for(b in this.components)"miniChart"!==b&&this.components[b].invalidateProperties("ScrollableChart.partialUpdate");this.components.dataArea.updateNow(["properties"]),e=this.components.dataArea.barArea.getMeasureIndices().length?this.components.dataArea.barArea.getMajorAxisData():this.components.dataArea.markerArea.getMeasureIndices().length?this.components.dataArea.markerArea.getMajorAxisData():this.components.dataArea.lineArea.getMajorAxisData(),this.components.dimensionAxis.setDataRange(e.data,e.info);var g=this.components.dataArea.barArea.getMinorAxisData();return g&&this._dataOptions.primary.forEach(function(a){this._dataOptions.barSeries.indexOf(a)<0&&!isNaN(a.qMin)&&(g.min=Math.min(a.qMin,g.min),g.max=Math.max(a.qMax,g.max))},this),p.apply(this,[this.components.measureAxis,this._dataOptions.primary,this._dataOptions.axes.measureAxis,!!g,g,g?this.getPrimaryMeasureSettings(a,this._dataOptions):null]),this.components.dimensionAxis.updateNow(["properties"]),this.components.colorLegend.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),f.push(this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate")),f.push(this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate")),f.push(this.components.colorLegend.invalidateDisplay("ScrollableChart.partialUpdate")),d.all(f)},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var a,b=this.components.scrollArea,c=this.rect.height,e=this.getSnapshotStoredChartData(),f=0,g=[];(this._cutMode.positive||this._cutMode.negative)&&(this._layoutMode>=31&&(f=48),f=this._layoutMode>=15?32:this._layoutMode>=7?16:8),this.components.measureAxis.setPadding(this._cutMode.positive?f:0,0,this._cutMode.negative?f:0,0),this.components.axis.setPadding(this._cutMode.positive?f:0,0,this._cutMode.negative?f:0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(c/4))),this.components.dataArea.updateNow(["properties"]),this.components.dimensionAxis.updateNow(["properties"]),this.layout(),this._readStoredData&&(this.components.dimensionAxis.setInnerOffset(e.axisInnerOffset),this.components.scrollArea.setOffset(e.scrollOffset));var h=this.checkPage();if(h)g.push(h);else{for(a in this.components)g.push(this.components[a].invalidateDisplay("ComboChart.paint"));b.viewState.min+b.viewState.range>b.fullState.max&&b.setOffset(b.fullState.max-b.viewState.range)}return d.all(g)},_updateData:function(b){this._checkPage=!1;var c,d,f,h,i,j,k,l,m,n,o=this.getSnapshotStoredChartData();if(c=b.qHyperCube.qMeasureInfo.filter(function(a){return a.series&&"line"===a.series.type}),d=b.qHyperCube.qMeasureInfo.filter(function(a){return!a.series||"bar"===a.series.type}),f=b.qHyperCube.qMeasureInfo.filter(function(a){return a.series&&"marker"===a.series.type}),h=[],i=[],b.qHyperCube.qMeasureInfo.forEach(function(a){a.series&&"bar"!==a.series.type&&1===a.series.axis?i.push(a):h.push(a)}),this.isStacked=!1,this.components.measureAxis.isStacked="stacked"===b.barGrouping.grouping&&d.length>1,this.components.axis.isStacked=!1,this._pagingMode=s.NONE,this.scrollMultiplicator="grouped"===b.barGrouping.grouping&&d.length>1?d.length+1:1,b.qHyperCube.qSize.qcy>b.qHyperCube.qDataPages[0].qArea.qHeight){this._pagingMode=s.ONE_DIM;var p=b.qHyperCube.qSize.qcy;"grouped"===b.barGrouping.grouping&&d.length>1&&(this.scrollMultiplicator=d.length+1,p*=this.scrollMultiplicator),this.components.dimensionAxis.setNumDiscreteUnits(p)}else this.components.dimensionAxis.setNumDiscreteUnits(null);this.components.dimensionAxis.isDiscrete()||(this._pagingMode=s.NONE),j=h.map(function(a){return a.qFallbackTitle}).join(", "),k=b.qHyperCube.qDimensionInfo.map(function(a){return a.qFallbackTitle}).join(", "),l=i.map(function(a){return a.qFallbackTitle}).join(", "),m={primary:h,secondary:i,lineSeries:c,markerSeries:f,barSeries:d,axes:{measureAxis:{component:this.components.measureAxis,data:a.extend(!0,{},b.measureAxes[0],{show:h.length?b.measureAxes[0].show:"none"}),title:b.measureAxes[0].title||j,dataIndices:h.map(function(a){return b.qHyperCube.qMeasureInfo.indexOf(a)})},secondaryMeasureAxis:{component:this.components.axis,data:a.extend(!0,{},b.measureAxes[1],{show:i.length?b.measureAxes[1].show:"none",dock_:["near","far"].contains(b.measureAxes[0].dock)?"near"===b.measureAxes[0].dock?"far":"near":g.prototype.getOppositeDock.call({options:{dock:b.measureAxes[0].dock}})}),title:b.measureAxes[1].title||l,dataIndices:i.map(function(a){return b.qHyperCube.qMeasureInfo.indexOf(a)})},dimensionAxis:{component:this.components.dimensionAxis,data:b.dimensionAxis,title:e.view!==e.Views.story?"":k,dataIndices:b.qHyperCube.qDimensionInfo.map(function(a,b){return b})}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:b.dimensionAxis,title:e.view!==e.Views.story?"":k}}},n=this.components.dimensionAxisTitle,this._dataOptions=m,this._data=b,n.setData(b),this.components.dataArea.setData(b),this.providers.colorMap.setData(b),this.components.colorLegend.setData(b);var q=this.providers.colorMap.getLegendDataProvider();q.setMeasureLegendTypes(b.qHyperCube.qMeasureInfo.map(function(a){return a.series&&a.series.type?"line"===a.series.type?b.dataPoint.show?["line","circle"]:["line"]:"marker"===a.series.type?[(a.series.markerFill===!1?"!":"")+(a.series.marker||"circle")]:["rect"]:["rect"]})),this._super(b,m),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(o.axisInnerOffset),this.components.scrollArea.setOffset(o.scrollOffset)):(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)),this._checkPage=!0},initSelections:function(){this._super(),this.options._disableSelections||(this.selections.types.range.addComponent("y",this.components.axis),this.selections.Select.bind(function(a,b){var c,d=this.selections.getActiveType().activeComponent;c=d.subComponents?this.components.dimensionAxis.getType().current:d.getSelectionIndices(),this.onSelection.Select.apply(this,[a,b,c])}.bind(this)))},updateDataArea:function(a){this._super.apply(this,[].slice.call(arguments)),this.components.dataArea.lineArea.setShowDataPoints(a.dataPoint.show),this.components.dataArea.lineArea.setLineType("area"===a.lineType&&a.stackedArea?"stackedArea":a.lineType),this.components.dataArea.lineArea.setNullMode(a.nullMode),this.components.dataArea.barArea.setGroupingMode(a.barGrouping.grouping),this.components.dataArea.updateNow(["properties"])},getMinDiscreteUnitSize:function(){return this._minDiscreteUnitSize},updateAxis:function(a,b){var c,d,f,g=b.primary.indexOf(b.barSeries[0])>=0,h=this.getSnapshotStoredChartData();this._super(a,b),this._cutMode={positive:!1,negative:!1};var i=this.components.dataArea.barArea.getMinorAxisData();i&&b.primary.forEach(function(a){b.barSeries.indexOf(a)<0&&!isNaN(a.qMin)&&(i.min=Math.min(a.qMin,i.min),i.max=Math.max(a.qMax,i.max))}),this._readStoredData&&h.dataRanges&&(i.min=h.dataRanges[0].min,i.max=h.dataRanges[0].max),p.apply(this,[this.components.measureAxis,b.primary,b.axes.measureAxis,g,i,g?this.getPrimaryMeasureSettings(a,b):null]),p.apply(this,[this.components.axis,b.secondary,b.axes.secondaryMeasureAxis,"zero"===a.nullMode,null]),d=this.chartFormatter.getFormattersForMeasures(a.qHyperCube.qMeasureInfo,b.primary.map(function(b){return a.qHyperCube.qMeasureInfo.indexOf(b)})),f=this.chartFormatter.getFormattersForMeasures(a.qHyperCube.qMeasureInfo,b.secondary.map(function(b){return a.qHyperCube.qMeasureInfo.indexOf(b)})),this.components.measureAxis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(d),this.components.axis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(f),c=b.barSeries.length?this.components.dataArea.barArea.getMajorAxisData():b.markerSeries.length?this.components.dataArea.markerArea.getMajorAxisData():b.lineSeries.length?this.components.dataArea.lineArea.getMajorAxisData():{data:[],info:[],groupSize:null},this.components.dimensionAxis.setDataRange(c.data,c.info),this.components.dimensionAxis.setGroupSize(c.groupSize,c.info),this._updateMinDiscreteUnitSize(this.components.dimensionAxis),!b.primary.length&&b.secondary.length||["all","labels"].indexOf(b.axes.measureAxis.data.show)<0&&b.secondary.length&&["all","labels"].indexOf(b.axes.secondaryMeasureAxis.data.show)>=0?this.components.grid.setAxes(this.components.dimensionAxis,this.components.axis):this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis);var j=this.components.dimensionAxisTitle;j.setDock("far"===a.dimensionAxis.dock?"top":"bottom"),e.view===e.Views.story&&j.hideComponent()},_updateMinDiscreteUnitSize:function(a){this._super(a)},getPrimaryMeasureSettings:function(a,c){var d,e,f,g,h=c.primary.filter(function(a){return!isNaN(a.qMin)}).map(function(b){return{min:b.qMin,max:b.qMax,index:a.qHyperCube.qMeasureInfo.indexOf(b),isBarSeries:c.barSeries.indexOf(b)>=0}}),i=c.primary.filter(function(a){return!isNaN(a.qMin)&&c.barSeries.indexOf(a)<0});return h.length&&(d=h.reduce(function(a,b){return a.min<b.min?a:b},h[0]),e=h.reduce(function(a,b){return a.max>b.max?a:b},h[0]),e&&(g=d.max),d&&(f=d.min),b.isNumeric(f)||(f=0),b.isNumeric(g)||(g=1)),{minMeasure:d,maxMeasure:e,nonBarSeriesMax:Math.max.apply(null,i.map(function(a){return a.qMax})),nonBarSeriesMin:Math.min.apply(null,i.map(function(a){return a.qMin})),min:f,max:g,data:a,options:c}},getSpikeSettings:function(a,b){var c,d,e=a.data,f=a.minMeasure,g=a.maxMeasure,h=a.min,i=a.max,j=0,k=0,l=0,m=0,n=!1,o=!1,p=g.index+e.qHyperCube.qDimensionInfo.length,q=f.index+e.qHyperCube.qDimensionInfo.length,r=e.qHyperCube.qDataPages[0]?e.qHyperCube.qDataPages[0].qMatrix:[];if(!isNaN(a.nonBarSeriesMax)&&a.nonBarSeriesMax>0&&(j=a.nonBarSeriesMax),!isNaN(a.nonBarSeriesMin)&&a.nonBarSeriesMin<0&&(k=a.nonBarSeriesMin),!this.components.measureAxis.isStacked){for(var s=0;s<r.length;s++)c=r[s],d=c[p].qNum,d>0&&!isNaN(d)&&(c[0].qIsOtherCell||c[1].qIsOtherCell?l=Math.max(d,l):j=Math.max(d,j)),d=c[q].qNum,0>d&&!isNaN(d)&&(c[0].qIsOtherCell||c[1].qIsOtherCell?m=Math.min(d,m):k=Math.min(d,k));null!==b.max&&b.max<g.max?n=b.max>0:j>0&&l/j>5&&(i=j,n=i>=0),null!==b.min&&b.min>f.min?o=b.min<0:0>k&&m/k>5&&(h=k,o=0>h)}return{max:i,min:h,positive:n,negative:o}}}),{type:"ComboChart",BackendApi:l,template:o,View:r,definition:j,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:17,qHeight:500}],qSuppressMissing:!0},measureAxes:[{autoMinMax:!0,dock:"near",max:10,min:0,minMax:"min",show:"all",spacing:1},{autoMinMax:!0,dock:"far",max:10,min:0,minMax:"min",show:"all",spacing:1}]},data:k,snapshot:{canTakeSnapshot:!0},options:{selections:{dataArea:{},range:{},colorLegend:{},tooltip:{}}},getDropMeasureOptions:function(a,b,c,d,e){"measure"===a.item.type?(q.call(a,c,b,e),b.getMeasures().length>=b.minMeasures()&&a.ReplaceMeasures(c,b,e),d()):m.getDropMeasureOptions(a,b,c,d,e)},importProperties:function(a,c,d){var e,f=n.axisChart.importProperties.apply(n,[a,c,d]),g="linechart"===a.properties.visualization,h=[];return f.qProperty.qHyperCubeDef.qMeasures.forEach(function(a){a.qDef.series||(a.qDef.series={type:g?"line":"bar",axis:0,marker:"circle",markerFill:!0}),h.indexOf(a.qDef.series.axis)<0&&h.push(a.qDef.series.axis)}),e=h.sort().shift(),f.qProperty.measureAxes[e]&&a.properties.measureAxis&&"undefined"!=typeof a.properties.measureAxis.autoMinMax&&b.extend(!0,f.qProperty.measureAxes[e],a.properties.measureAxis,{logarithmic:!1}),f},exportProperties:n.axisChart.exportProperties.bind(n)}}),define("workbench/mashupapi/qglobal",["qvangular","core.models/app","client.models/rpc-session"],function(a,b,c){function d(a,b,c,d){return a.session.rpc({method:b,handle:-1,params:c||[]}).then(function(a){return d&&d(a.result),a.result})}function e(a){a instanceof c?this.session=a:(this.session=c.get("?transient=",a),this.session.open())}return e.prototype.getAppList=function(c){var d=this.session;a.$apply(a.$rootScope,function(){b.getList(d).then(function(a){c(a)})})},e.prototype.getAuthenticatedUser=function(a){return d(this,"GetAuthenticatedUser",[],a)},e.prototype.isPersonalMode=function(a){return d(this,"IsPersonalMode",[],a)},e.prototype.getQTProduct=function(a){return d(this,"QTProduct",[],a)},e.prototype.getProductVersion=function(a){return d(this,"ProductVersion",[],a)},e.prototype.getQvVersion=function(a){return this.getProductVersion(a)},e.prototype.cancelReload=function(){return d(this,"CancelReload",[])},e.prototype.GetProgress=function(a,b){return d(this,"GetProgress",[a],b)},e}),define("client.models/current-selections",["core.models/session-object","core.models/app","general.models/field"],function(a,b,c){"use strict";function d(a,b,d){c.get(b,void 0,a).then(function(a){a[d]()})}var e;return e=a.extend("CurrentSelections",{clearField:function(a){d(this.app,a,"clear")},lockField:function(a){d(this.app,a,"lock")},unlockField:function(a){d(this.app,a,"unlock")},clearAll:function(){return this.app.rpc("ClearAll",null)},back:function(){return this.app.rpc("Back",null)},forward:function(){return this.app.rpc("Forward",null)}}),e.get=function(c){return c=c||b.current,a.get.call(this,{qInfo:{qType:"CurrentSelection"},qSelectionObjectDef:{}},c).then(function(a){return a.app=c,a})},e}),define("workbench/mashupapi/qfield",["qvangular","core.utils/deferred","general.models/field"],function(a,b,c){function d(a,c,d,e,f,g,h){var i=new b;return a.waitFor.then(function(){a.field[c](d,e,f,g,h).then(function(){i.resolve()},function(){i.reject()})}),i.promise}function e(d,e,f){var g=this,h=new b;g.waitFor=h.promise,a.$apply(a.$rootScope,function(){c.get(e,f||"$",d).then(function(a){g.field=a,h.resolve()},function(){h.reject()})})}return e.prototype.clear=function(){return d(this,"clear")},e.prototype.lock=function(){return d(this,"lock")},e.prototype.unlock=function(){return d(this,"unlock")},e.prototype.clearOther=function(a){return d(this,"clearOther",a||!1)},e.prototype.selectAll=function(a){return d(this,"selectAll",a||!1)},e.prototype.selectExcluded=function(a){return d(this,"selectExcluded",a||!1)},e.prototype.selectAlternative=function(a){return d(this,"selectAlternative",a||!1)},e.prototype.selectPossible=function(a){return d(this,"selectPossible",a||!1)},e.prototype.toggleSelect=function(a,b){return d(this,"toggleSelect",a,b||!1)},e.prototype.selectMatch=function(a,b){return d(this,"selectMatch",a,b||!1)},e.prototype.select=function(a,b,c){return d(this,"select",a,b||!1,c||!1)},e.prototype.selectValues=function(a,b,c){var e=[];return a.forEach(function(a){"number"==typeof a?e.push({qIsNumeric:!0,qNumber:a}):"string"==typeof a?e.push({qText:a}):e.push(a)}),d(this,"selectValues",e,b||!1,c||!1)},e}),define("workbench/mashupapi/qbookmark",["client.models/bookmark"],function(a){function b(a){this.app=a}return b.prototype.create=function(b,c){var d=this.app;return a.create({qMetaDef:{title:b,description:c}},d)},b.prototype.apply=function(b){var c=this.app;return a.apply(b,c)},b.prototype.remove=function(b){var c=this.app;return a.remove(b,c)},b}),define("core.models/variable",["core.models/base-object","core.models/app","core.utils/deferred","autogenerated/qix/engine-enums"],function(a,b,c,d){"use strict";var e=d.NxLocalizedErrorCode,f=a.extend("Variable",{getContent:function(){var a=this,b=new c;return this.rpc("GetContent").then(function(a){b.resolve(a)},function(c){c.error.code===e.LOCERR_GENERIC_ABORTED?(a.rpc("GetContent").then(function(a){b.resolve(a)}),c.isHandled=!0):b.reject(c.error)}),b.promise},getRawContent:function(){return this.rpc("GetRawContent")},setContent:function(a,b){return this.rpc("SetContent",null,[a,b||!1])}});return f.get=function(a,c){function d(){return c.rpc("GetVariable","qReturn",[a])}return c=c||b.current,this.getModel(a,c.session,d)},f.create=function(a,c){return c=c||b.current,c.rpc("CreateVariable","qReturn",[a])},f}),define("workbench/mashupapi/qvariable",["core.utils/deferred","core.models/variable"],function(a,b){function c(a,b){this.app=a,this.qapp=b}return c.prototype.create=function(a){return b.create(a,this.app)},c.prototype.setContent=function(c,d){var e=new a;return b.get(c,this.app).then(function(a){a.setContent(d+"").then(function(a){e.resolve(a)},function(a){e.reject(a.error)})},function(a){e.reject(a.error)}),e.promise},c.prototype.getContent=function(c,d){var e=new a,f=this.qapp,g=d?function(a){d(a,f)}:function(){};return b.get(c,this.app).then(function(a){a.getContent().then(function(a){g(a,f),e.resolve(a)},function(a){e.reject(a.error)})},function(a){e.reject(a.error)}),e.promise},c}),define("workbench/mashupapi/qapp",["jquery","qvangular","core.utils/deferred","core.models/session-object","core.models/generic-object","client.models/current-selections","objects.models/visualization-object","client.models/snapshot","objects.backend-api/snapshot-api","workbench/mashupapi/qfield","workbench/mashupapi/qbookmark","workbench/mashupapi/qvariable","workbench/mashupapi/qglobal"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(c,d,e,f){var g=a(c),h=b.$rootScope.$new(),i="";e&&e.noInteraction&&(i='<div style="width:100%;height:100%;position:relative">'),i+=e&&e.currentSelections?'<qv-stage-current-selections class="qvt-selections" app-name="'+f+'"></qv-stage-current-selections><div id="qv-global-search-container"></div>':'<qv-object model="model" options="options"></qv-object>',e&&e.noInteraction&&(i+='<div style="position:absolute;top:0;left:0;width:100%;height:100%;overflow: hidden;"></div>'),e&&e.noInteraction&&(i+="</div>"),g.html(i),h.model=d,h.options=e||{};var j=b.getService("$compile");return j(g.contents())(h),b.$apply(h),h}function o(a){this.fieldCache={},Object.defineProperties(this,{id:{value:a.id},model:{value:a},global:{value:new m(a.session)},bookmark:{value:new k(a)},variable:{value:new l(a,this)}})}var p,q=0;return o.prototype.clearAll=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("ClearAll",null).then(function(){a.resolve()})}),a.promise},o.prototype.back=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("Back",null).then(function(){a.resolve()})}),a.promise},o.prototype.forward=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("Forward",null).then(function(){a.resolve()})}),a.promise},o.prototype.lockAll=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("LockAll",null).then(function(){a.resolve()})}),a.promise},o.prototype.unlockAll=function(){var a=new c,d=this.model;return b.$apply(b.$rootScope,function(){d.rpc("UnlockAll",null).then(function(){a.resolve()})}),a.promise},o.prototype.getObject=function(a,d,e){var h,i,j=this.model;if(d?"string"==typeof a&&(a=document.getElementById(a)):(d=a,a=void 0),h=new c,"CurrentSelections"===d){if(a){var k=e||{};k.currentSelections=!0,i=n(a,null,k,this.id)}f.get(j).then(function(a){a.close=function(){i&&i.$destroy()},h.resolve(a)})}else b.$apply(b.$rootScope,function(){g.get(d,j).then(function(b){a&&(i=n(a,b,e)),b.getLayout().then(function(){b.close=function(){i&&i.$destroy()},h.resolve(b)})},function(a){p&&(p(a.error),a.isHandled=!0),h.reject(a.error)})});return h.promise},o.prototype.getSnapshot=function(a,b){var d=new c;return b||(b=a,a=void 0),h.Snapshot.get(b,this.model).then(function(b){a&&("string"==typeof a&&(a=document.getElementById(a)),n(a,b,{APIType:i,noInteraction:!0})),b.getLayout().then(function(){d.resolve(b)},function(a){d.reject(a.error)})},function(a){d.reject(a.error)}),d.promise},o.prototype.getObjectProperties=function(a){return e.getProperties(a,this.model)},o.prototype.getFullPropertyTree=function(a){return e.get(a,this.model).then(function(a){return a.getFullPropertyTree().then(function(){return a})})},o.prototype.createGenericObject=function(a,c){var e=this,f=c?function(a){c(a,e)}:function(){};q++,a.qInfo=a.qInfo||{},a.qInfo.qType=a.qInfo.qType||"mashup",a.qInfo.qId=a.qInfo.qId||"MU"+q;var g=d.get(a,this.model);return b.$apply(b.$rootScope,function(){g.then(function(a){a.getLayout().then(f),a.Invalidated.bind(function(){a.getLayout().then(f)}),a.Aborted.bind(function(){a.getLayout().then(f)})},function(a){p&&(p(a.error,e),a.isHandled=!0)})}),g},o.prototype.destroySessionObject=function(a){return this.model.rpc("DestroySessionObject",null,[a])},o.prototype.createCube=function(a,b){return this.createGenericObject({qHyperCubeDef:a},b)},o.prototype.createList=function(a,b){return this.createGenericObject({qListObjectDef:a},b)},o.prototype.getList=function(a,b){q++;var c={qInfo:{qType:a,qId:"MU"+q}};return"BookmarkList"===a?c.qBookmarkListDef={qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description"}}:"SnapshotList"===a?c.qBookmarkListDef={qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}:"CurrentSelections"===a?c.qSelectionObjectDef={}:"DimensionList"===a?c.qDimensionListDef={qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}:"MeasureList"===a?c.qMeasureListDef={qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}:"sheet"===a?c.qAppObjectListDef={qType:"sheet",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}:"masterobject"===a?c.qAppObjectListDef={qType:"masterobject",qData:{name:"/metadata/name",visualization:"/visualization",tags:"/metadata/tags"}}:c["q"+a+"Def"]={},this.createGenericObject(c,b)},o.prototype.getAppObjectList=function(a,b){return b||(b=a,a="sheet"),this.getList(a,b)},o.prototype.searchSuggest=function(a,b,d){var e=new c;return this.model.rpc("SearchSuggest",null,[b,a]).then(function(a){d&&d(a),e.resolve()},function(){e.reject()}),e.promise},o.prototype.searchAssociations=function(a,b,d,e){var f=new c;return this.model.rpc("SearchAssociations",null,[d||{},a,b]).then(function(a){e&&e(a),f.resolve()},function(){f.reject()}),f.promise},o.prototype.selectAssociations=function(a,b,c,d){return this.model.rpc("SelectAssociations",null,[c||{},b,a,d||!1])},o.prototype.getAppLayout=function(a){var b=this,c=a?function(c){a(c,b)}:function(){},d=b.model.getLayout();return b.model.Invalidated.bind(function(){b.model.getLayout().then(c)}),b.model.Aborted.bind(function(){b.model.getLayout().then(c)}),d.then(c),d},o.prototype.addAlternateState=function(a){return this.model.rpc("AddAlternateState",null,[a])},o.prototype.removeAlternateState=function(a){return this.model.rpc("RemoveAlternateState",null,[a])},o.prototype.doReload=function(a,b,c){return this.fieldCache={},this.model.rpc("DoReload",null,[a||0,b||!1,c||!1])},o.prototype.doSave=function(a){return this.model.rpc("DoSave",null,[a])},o.prototype.field=function(a,b){var c=b?a+"/"+b:a;return this.fieldCache[c]||(this.fieldCache[c]=new j(this.model,a,b)),this.fieldCache[c]},o.setErrorCallback=function(a){p=a},o}),define("general.utils/touch-configuration-util",["jquery","touche"],function(a,b){"use strict";function c(){b.utils.msPointer&&0===window.navigator.msMaxTouchPoints?a(document.body.parentElement).addClass("touch-off"):a(document.body.parentElement).addClass("touch-"+(a.support.touch?"on":"off"))}return{configureTouchSupport:c}}),define("qlikui/factory",["assets/qvangular/qvangular-core"],function(a){function b(b,c){if(!b)throw new Error("Name is undefined.");if(!c.template)throw new Error("Template is undefined.");var d={restrict:"E",replace:!0,transclude:null!=c.transclude?c.transclude:!0,template:c.template,requires:c.requires,scope:null!=c.scope?c.scope:"=",controller:c.controller||function(){},link:c.link||function(){}};return a.directive(b,function(){return d}),d}var c={component:b};return c}),define("text!assets/qlikui/components/qui-dialog-default/qui-dialog-default.html",[],function(){return'<div class="qui-delayedModal delayedModal qui-delayedmodal" ng-transclude>\r\n	<!-- This will be replaced by ng-transclude -->\r\n</div>'}),define("assets/qlikui/components/qui-dialog-default/qui-dialog-default",["qlikui/factory","text!assets/qlikui/components/qui-dialog-default/qui-dialog-default.html"],function(a,b){a.component("quiDialogDefault",{template:b})}),define("text!assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait.html",[],function(){return'<div>\r\n	<qui-dialog-default>\r\n		<header class="dm-header" q-translation="Common.PleaseWait">#Working#</header>\r\n		<main class="dm-main">\r\n			<p class="qui-pleasewaitdialog-loader-container"><img src="/resources/img/loader.svg"/></p>\r\n\r\n			<p class="qui-pleasewaitdialog-pleasewait" q-translation="Common.PleaseWait"></p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n		</footer>\r\n	</qui-dialog-default>\r\n</div>'}),define("assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait",["qlikui/factory","text!assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait.html"],function(a,b){a.component("quiDialogPleasewait",{template:b})}),define("text!assets/qlikui/components/qui-dialog-alert/qui-dialog-alert.html",[],function(){return'<div>\r\n	<qui-dialog-default>\r\n		<header class="dm-header">\r\n			This is the header\r\n		</header>\r\n		<main class="dm-main">\r\n			This is a simple example of an alert box\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<button class="qui-button" ng-click="close()">Close me</button>\r\n		</footer>\r\n	</qui-dialog-default>\r\n</div>'}),define("assets/qlikui/components/qui-dialog-alert/qui-dialog-alert",["qlikui/factory","text!assets/qlikui/components/qui-dialog-alert/qui-dialog-alert.html"],function(a,b){a.component("quiDialogAlert",{template:b,scope:{onClose:"&"},controller:["$scope",function(a){a.close=function(){a.onClose()}}]})}),define("assets/qlikui/components/qui-input-number/numerical-interval-transformer",[],function(){function a(a){return Number(String(a).replace(/[^-\d]/g,""))}return{getNumerical:function(b,c,d){return b=a(b),c=Number(c),d=Number(d),c>b?c:0!==d&&b>d?d:b}}}),define("text!assets/qlikui/components/qui-input-number/qui-input-number.ng.html",[],function(){return'<span>\r\n	<input class="qui-button" type="button" value="-" qva-activate="onChange(-1)" ng-disabled="quiDisabled" ng-if="quiWithButtons"/>\r\n\r\n	<input type="tel" class="qui-input {{quiClass}}" title="{{quiTitle}}" ng-model="quiModel" ng-change="onChange()" ng-disabled="quiDisabled"/>\r\n\r\n	<input class="qui-button" type="button" value="+" qva-activate="onChange(1)" ng-disabled="quiDisabled" ng-if="quiWithButtons"/>\r\n</span>\r\n';
}),define("assets/qlikui/components/qui-input-number/qui-input-number",["qlikui/factory","assets/qlikui/components/qui-input-number/numerical-interval-transformer","text!./qui-input-number.ng.html"],function(a,b,c){a.component("quiInputNumber",{template:c,scope:{quiModel:"=",quiDisabled:"=",quiTitle:"@",quiMin:"@",quiMax:"@",quiClass:"@",quiSelectTextOnFocus:"@",quiWithButtons:"@"},controller:["$scope","$element",function(a,c){a.quiSelectTextOnFocus&&(a.selected=!1,c.click(function(){a.selected===!1&&(c.select(),a.selected=!0)}),c.blur(function(){a.selected=!1})),a.onChange=function(d){var e=parseInt(d)||0;a.quiModel=b.getNumerical(parseInt(c.find(".qui-input").val())+e,a.quiMin,a.quiMax)}}]})}),define("text!assets/qlikui/components/qui-modal-default/qui-modal-default.html",[],function(){return'<div class="qui-modalbackground"></div>'}),define("assets/qlikui/components/qui-modal-default/qui-modal-default",["qlikui/factory","text!assets/qlikui/components/qui-modal-default/qui-modal-default.html"],function(a,b){a.component("quiModalDefault",{template:b})}),define("text!assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup.html",[],function(){return'<div>\r\n	<label class="qui-radiobutton" ng-repeat="option in options" ng-class="{ \'qui-checked\' : option.value === quiSelectedValue, \'qui-disabled\': quiDisabled }">\r\n		<input type="radio" name="{{quiGroupName}}" value="{{option.value}}" ng-disabled="quiDisabled">\r\n		<div class="radio-wrap" ng-click="selected(option.value)">\r\n			<span class="radio"></span>\r\n			<span class="radio-text">{{option.label}}</span>\r\n			<div></div>\r\n		</div>\r\n	</label>\r\n</div>'}),define("assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup",["qlikui/factory","text!assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup.html","translator"],function(a,b,c){a.component("quiRadiobuttongroup",{template:b,scope:{quiGroupName:"@",quiOptions:"@",quiTranslateKeys:"@",quiSelectedValue:"=",quiDisabled:"="},controller:["$scope",function(a){function b(){for(var b=JSON.parse(a.quiOptions),d=[],e=0;e<Object.keys(b).length;e++){var f=Object.keys(b)[e],g=b[f];d.push({label:a.quiTranslateKeys?c.get(f):f,value:g})}a.options=d}a.selected=function(b){a.quiSelectedValue=b},a.isChecked=function(b){return a.quiSelectedValue===b?"checked":""},b()}]})}),define("text!assets/qlikui/components/qui-checkbox/qui-checkbox.html",[],function(){return'<label class="qui-checkboxicon" title="{{quiTitle}}" ng-class="{ \'qui-hover\': hover }" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n	<input type="checkbox" ng-model="quiModel" ng-disabled="quiDisabled">\r\n		<div class="check-wrap">\r\n			<span class="check"></span>\r\n			<span class="check-text">{{quiLabel}}</span>\r\n		</div>\r\n</label>\r\n'}),define("assets/qlikui/components/qui-checkbox/qui-checkbox",["qlikui/factory","text!assets/qlikui/components/qui-checkbox/qui-checkbox.html"],function(a,b){a.component("quiCheckbox",{template:b,scope:{quiModel:"=",quiDisabled:"=",quiLabel:"@",quiTitle:"@"}})}),define("text!assets/qlikui/components/qui-radiobutton/qui-radiobutton.html",[],function(){return'<label class="qui-radiobutton" ng-class="{ \'qui-disabled\': quiDisabled, \'qui-hover\': hover }" title="{{quiTitle}}" qva-activate="focus()" ng-mouseenter="hover = true" ng-mouseleave="hover = false">\r\n    <input type="radio" value="{{quiValue}}" ng-model="quiModel" ng-disabled="quiDisabled" ng-change="quiChange" name="{{quiName}}">\r\n    <div class="radio-wrap" qva-tabindex="{{tabindex}}">\r\n        <span class="radio"></span>\r\n        <span class="radio-text">{{quiLabel}}</span>\r\n    </div>\r\n</label>\r\n'}),define("assets/qlikui/components/qui-radiobutton/qui-radiobutton-logic-factory",[],function(){"use strict";function a(a){function b(){a.tabindex=a.quiDisabled?-1:a.quiTabindex}function c(b){a.quiDiasabled||32===b.keyCode&&(a.quiModel=a.quiValue,a.$apply())}return a.quiTabindex||(a.quiTabindex=0),b(),{select:c,updateTabindex:b}}return{createRadioButtonLogic:function(b){return new a(b)}}}),define("assets/qvangular/qvangular-tabindex/qvangular-tabindex-logic",[],function(){"use strict";function a(a,b){0>a?b[0].removeAttribute("tabindex"):b[0].setAttribute("tabindex",a)}return{updateTabindex:a}}),define("assets/qvangular/qvangular-tabindex/qvangular-tabindex",["assets/qvangular/qvangular-core","assets/qvangular/qvangular-tabindex/qvangular-tabindex-logic"],function(a,b){"use strict";a.directive("qvaTabindex",function(){return{restrict:"A",scope:{qvaTabindex:"@"},controller:["$scope","$element",function(a,c){a.$watch("qvaTabindex",function(a){b.updateTabindex(a,c)})}]}})}),define("assets/qlikui/components/qui-radiobutton/qui-radiobutton",["qlikui/factory","text!assets/qlikui/components/qui-radiobutton/qui-radiobutton.html","assets/qlikui/components/qui-radiobutton/qui-radiobutton-logic-factory","assets/qvangular/qvangular-tabindex/qvangular-tabindex","translator"],function(a,b,c){a.component("quiRadiobutton",{template:b,scope:{quiLabel:"@",quiTitle:"@",quiValue:"@",quiName:"@",quiTabindex:"@",quiModel:"=",quiDisabled:"=",quiChange:"="},controller:["$scope","$element","$timeout",function(a,b,d){d(function(){function d(a){e.select(a)}var e=c.createRadioButtonLogic(a);a.$watch("quiDisabled",e.updateTabindex),a.focus=function(){b[0].querySelector(".radio-wrap").focus()},b.on("keydown",d)})}]})}),define("text!assets/qlikui/components/qui-float/qui-float.html",[],function(){return'<div class="qui-float" ng-style="{top:top, left:left}" ng-show="visible" qva-reported-window-size="reportedWindowSize">\r\n	<div ng-transclude></div>\r\n</div>'}),define("assets/qlikui/components/qui-float/qui-float",["qlikui/factory","text!assets/qlikui/components/qui-float/qui-float.html"],function(a,b){a.component("quiFloat",{template:b,replace:!0,scope:{quiOffset:"=",quiResizeOnChange:"="},transclude:!0,controller:["$scope","$element","$timeout",function(a,b,c){function d(){a.quiOffset&&a.reportedSize&&a.reportedWindowSize?(a.quiOffset.left+a.reportedSize.width<a.reportedWindowSize.width?a.left=a.quiOffset.left:a.left=a.reportedWindowSize.width-a.reportedSize.width,a.quiOffset.top+a.reportedSize.height<a.reportedWindowSize.height?a.top=a.quiOffset.top:a.top=a.reportedWindowSize.height-a.reportedSize.height,a.visible=!0):a.visible=!1}function e(){c(function(){a.reportedSize={width:b.outerWidth(),height:b.outerHeight()}})}a.$watch("quiResizeOnChange",e,!0),a.$watch("[quiOffset, reportedSize, reportedWindowSize]",d,!0)}]})}),define("text!assets/qlikui/components/qui-button/qui-button.html",[],function(){return'<button class="{{className}}" ng-transclude></button>'}),define("assets/qlikui/components/qui-button/qui-button",["qlikui/factory","text!assets/qlikui/components/qui-button/qui-button.html"],function(a,b){function c(a,b,c,d,e){var f=["qui"];f.push(c||(b?"outlinebutton":"button")),a.className=f.join("-"),d&&(a.className+=" round"),e&&(a.className+="-light")}var d=13;a.component("quiButton",{template:b,scope:{theme:"@"},controller:["$scope","$element","$attrs",function(a,b,e){c(a,e.hasOwnProperty("outline"),e.buttonType,e.hasOwnProperty("round"),e.hasOwnProperty("light")),b.on("keypress",function(a){a.keyCode===d&&b.trigger("qv-activate")})}]})}),define("text!assets/qlikui/components/qui-popover-button/qui-popover-button.ng.html",[],function(){return'<button\r\n		class="qui-popover-button qui-dropdown"\r\n		tid="{{quiModel.tid}}"\r\n		data-ng-disabled="quiModel.isDisabled()"\r\n		data-ng-class="buttonClasses"\r\n		data-icon="{{quiModel.icon}}"\r\n		q-title-translation="{{currentTitle}}"\r\n		data-qva-activate="onClick()"></button>'}),define("text!assets/qlikui/components/qui-popover-button/qui-popover-button-menu.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo"\r\n					  smallview="quiModel.menuOptions.smallview"\r\n					  position="quiModel.menuOptions.position"\r\n					  width="quiModel.menuOptions.width"\r\n					  top="quiModel.menuOptions.top"\r\n					  hidepointer="quiModel.menuOptions.hidepointer"\r\n					  on-close-view="onClose(event)">\r\n	<div qva-include-qui-popover-button component=\'quiList\' input="quiModel.menuOptions.content" data-destroy-component="closeFromContent()"></div>\r\n</immidiate-contextual>'}),define("text!assets/qlikui/components/qui-list/qui-list.ng.html",[],function(){return'<ul ng-class="menuClasses" tid="{{tid}}">\r\n	<li class="toolbar-menu-li" ng-repeat="menuItem in menuItems" data-icon="{{menuItem.icon}}" ng-disabled="menuItem.disable" qui-click=\'menuItem.fn()\' ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" ng-hide="menuItem.hide">\r\n		<span class="qui-textlist-text"\r\n			  tid="{{menuItem.tid}}"\r\n			  q-title-translation="{{ menuItem.title || menuItem.text}}"\r\n			  ng-class="{\'open-in-new-tab-text-optional\': menuItem.openInNewTab == \'optional\', \'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}"\r\n			  qva-activate="selectMenuItem(menuItem, $event)" q-translation="{{menuItem.text}}" ng-disabled="menuItem.disable">\r\n		</span>\r\n		<span ng-if="menuItem.openInNewTab" class="open-in-new-tab" ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" data-icon="stacked-windows" q-title-translation="{{ menuItem.title || \'Tooltip.OpenInNewTab\'}}" qva-activate="selectMenuItem(menuItem, $event, \'true\')" ng-disabled="menuItem.disable"></span>\r\n	</li>\r\n</ul>'}),define("assets/qlikui/components/qui-list/qui-list",["qlikui/factory","text!assets/qlikui/components/qui-list/qui-list.ng.html"],function(a,b){return a.component("quiList",{scope:{tid:"=",menuClasses:"=",createMenuItems:"="},template:b,controller:["$scope",function(a){a.menuClasses=a.menuClasses?a.menuClasses:"qui-textlist",a.createMenuItems().then(function(b){a.menuItems=b}),a.selectMenuItem=function(b,c,d){c&&c.preventDefault&&c.preventDefault(),b.disable||(a.destroyComponent(),b.selected(c,d))}}]})}),define("text!general.components/immidiate-contextual/immidiate-contextual.ng.html",[],function(){return"<div class='qui-immidiateContextual' qva-outside='onOutsidePopover($event)'>\r\n	<div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\r\n	<div class='content' ng-transclude></div>\r\n</div>\r\n"}),define("text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html",[],function(){return"<div class='qui-immidiateContextual-small' qva-activate='onOutsidePopover($event)' qva-outside='onOutsidePopover($event)'>\r\n    <div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\r\n    <div class='content' ng-transclude></div>\r\n</div>\r\n"}),/*!
 * mqa.js
 * https://github.com/peol/mqa.js/
 * MIT/GPL Dual License, use whatever fits your project.
 * Copyright(C) Andrée Hansson (@peolanha) 2013
 */
function(a,b){"use strict";function c(a){return Array.prototype.slice.apply(a)}function d(a){return function(b){var c=i[a];c&&(g("Media query triggered for alias",a),c.forEach(function(a){a(b.matches)}))}}function e(a){var b=matchMedia(k[a]),c=j[a]=d(a);c.mql=b,g("Binding",a),b.addListener(c)}function f(a){var b=j[a];b&&(g("Unbinding",a),b.mql.removeListener(b)),delete i[a],delete j[a]}function g(){if(h){var a=c(arguments);a.unshift("[mqa.js]"),console.log.apply(console,a)}}var h=!1,i={},j={},k={},l=location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),m={};m.add=function(a,b){g("Creating alias",a,"with query",b),k[a]=b},m.remove=function(a){g("Removing alias",a);var b=k.hasOwnProperty(a);return b&&(f(a),delete k[a]),b},m.parse=function(){g("Parsing CSS rules"),c(b.styleSheets).forEach(function(a){var b=a.href&&0!==a.href.indexOf("/")&&0!==a.href.indexOf(l);try{if(b||null===a.cssRules)return}catch(d){return}c(a.cssRules).forEach(function(a){if(a&&a instanceof CSSMediaRule){var b=/#-mqa-alias-(\w+)\s*?\{/.exec(a.cssText);b&&m.add(b[1],a.media.mediaText)}})})},m.on=function(a,b){var c=i[a];c||(c=[],e(a)),c.push(b),i[a]=c,g("Added new listener on",a,b)},m.off=function(a,b){var c=i[a];if(c){var d=c.indexOf(b);c.splice(d,1),c.length||f(a)}g("Removed listener from",a,b)},m.match=function(a){var b=k[a],c=!1;return b&&(c=matchMedia(b).matches),c},Object.defineProperty(m,"queries",{get:function(){return JSON.parse(JSON.stringify(k))}}),m.parse(),"function"==typeof define&&define.amd?define("mqa",m):a.mqa=m}(window,document),define("general.utils/responsive-state",["mqa","core.utils/notification"],function(a,b){"use strict";var c,d,e={};return e.Orientation={portrait:"portrait",landscape:"landscape"},b.mixin(e),e.notification("ViewChanged"),e.notification("OrientationChanged"),c=a.match("smalldevice"),d=a.match("portrait")?e.Orientation.portrait:e.Orientation.landscape,a.on("smalldevice",function(a){c=a,e.ViewChanged.emit(c)}),"undefined"==typeof window.orientation?a.on("portrait",function(a){d=a?e.Orientation.portrait:e.Orientation.landscape,e.OrientationChanged.emit(d)}):window.onorientationchange=function(){d=e.Orientation.landscape,(0===window.orientation||180===window.orientation)&&(d=e.Orientation.portrait),e.OrientationChanged.emit(d),c&&d===e.Orientation.landscape&&window.scrollTo&&window.scrollTo(0,0)},Object.defineProperties(e,{isSmallDevice:{get:function(){return c}},orientation:{get:function(){return d}}}),document.body.scrollTop=document.documentElement.scrollTop=0,e}),define("general.components/immidiate-contextual/immidiate-contextual",["jquery","general.utils/window-positioner","general.utils/arrow-positioner","text!general.components/immidiate-contextual/immidiate-contextual.ng.html","text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html","assets/qvangular/qvangular-core","core.utils/resize","general.utils/dom-util","general.utils/responsive-state"],function(a,b,c,d,e,f,g,h,i){f.directive("immidiateContextual",function(){return{replace:!0,template:function(a,b){var c=d;return i.isSmallDevice&&b.smallview&&(c=e),c},transclude:!0,scope:{onCloseView:"&",hidepointer:"="},restrict:"E",link:function(d,e,i){var j,k,l=a(d.$parent.$eval(i.alignTo)),m=a(d.$parent.$eval(i.offset))[0],n=d.$parent.$eval(i.width),o=d.$parent.$eval(i.top),p=d.$parent.$eval(i.height),q=d.$parent.$eval(i.position),r=d.$parent.$eval(i.limits)||null,s=d.$parent.$eval(i.collision)||"none";"undefined"!=typeof p&&e.css("height",p||"100"),"undefined"!=typeof n&&e.css("width",n||"100"),d.onOutsidePopover=function(a){a.stopPropagation(),a.preventDefault(),d.onCloseView({event:a})},a(document).on("keydown.immediateContextual",function(b){var c=h.isInput(document.activeElement);!a(".qui-immidiateContextual").length||c||9!==b.which&&32!==b.which||(b.preventDefault(),d.onCloseView({event:b}),d.$apply(),l.hasClass("qui-button")&&l.hasClass("qui-active")&&l.removeClass("qui-active"))}),d.positionMap=function(a){var b={topRight:"right",top:"top",topLeft:"left",centerRight:"right",center:"right",centerLeft:"left",bottom:"bottom",bottomLeft:"left",bottomRight:"right"};return b[a]},d.synchronAlign=function(){d.hidepointer?d.$parent.event&&(j=b.alignToCoordinate(e,d.$parent.event.pageX,d.$parent.event.pageY,i.position)):(m?(j=b.alignToCoordinate(e,m.x,m.y,q),j=d.positionMap(j)):j=b.align(e,l,{position:q,collision:s,limits:r}),e.find("div.immidiate-contextual-arrow").addClass(j),c.align(e,l,j,e.children("div.immidiate-contextual-arrow")))},d.align=function(){"undefined"!=typeof o&&e.css({top:parseInt(o,10)}),k=f.getService("$timeout")(d.synchronAlign)},d.$on("recalculatePointer",function(){d.hidepointer||c.align(e,l,j,e.children("div.immidiate-contextual-arrow"))}),d.$on("$destroy",function(){f.getService("$timeout").cancel(k),g.off("end",d.align),a(document).off("keydown.immediateContextual")}),g.on("end",d.align),d.align()}}})}),define("assets/qlikui/components/qui-popover-button/qui-popover-button",["qvangular","qlikui/factory","text!assets/qlikui/components/qui-popover-button/qui-popover-button.ng.html","text!assets/qlikui/components/qui-popover-button/qui-popover-button-menu.ng.html","general.services/show-service/show-service","assets/qlikui/components/qui-list/qui-list","core.utils/resize","general.components/immidiate-contextual/immidiate-contextual"],function(a,b,c,d,e,f,g){a.componentDirective("qvaIncludeQuiPopoverButton",{ngModel:"=",destroyComponent:"&"});var h={template:d,scope:{quiModel:"=",alignTo:"=",shared:"="},controller:["$scope",function(a){a.quiList=f,a.onClose=function(){a.destroyComponent()},a.closeFromContent=function(){a.destroyComponent(),a.shared.pressed=!1},a.$on("$destroy",function(){g.off("start",a.onClose),a.shared.setToFalse()}),g.on("start",a.onClose)}]};b.component("quiPopoverButton",{template:c,transclude:!0,scope:{quiModel:"="},controller:["$scope","$element","$timeout",function(a,b,c){a.shared={},a.shared.pressed=!1,a.buttonClasses={"qui-active":a.shared.pressed},a.$watch("quiModel.buttonType",function(b){b&&(a.buttonClasses[b]=!0)}),a.$watch("shared.pressed",function(b){a.buttonClasses["qui-active"]=b,a.currentTitle=b&&a.quiModel.tooltipActive?a.quiModel.tooltipActive:a.quiModel.tooltipInactive}),a.shared.setToFalse=function(){c(function(){a.shared.pressed=!1},130)},a.onClick=function(){a.shared.pressed||(a.shared.pressed=!0,e.show(h,{quiModel:a.quiModel,alignTo:b,shared:a.shared}))}}]})}),define("text!assets/qlikui/components/qui-toggle-switch/qui-toggle-switch.ng.html",[],function(){return'<div class="switch qui-onoffswitch" ng-class="{ \'qui-focus\': focus, \'qui-checked\': value }" ng-disabled="readOnly">\r\n	<label class="onoffswitch-label" >\r\n		<input type="checkbox" ng-model="value" class="onoffswitch-checkbox" ng-disabled="readOnly || touch">\r\n		<span class="onoffswitch-span">\r\n			<div class="onoffswitch-inner"></div>\r\n			<div class="onoffswitch-switch" ></div>\r\n		</span>\r\n	</label>\r\n</div>'}),define("assets/qlikui/components/qui-toggle-switch/qui-toggle-switch",["qlikui/factory","text!assets/qlikui/components/qui-toggle-switch/qui-toggle-switch.ng.html","touche"],function(a,b){a.component("quiToggleSwitch",{scope:{readOnly:"=",value:"=",isFocused:"=?"},template:b,controller:["$scope","$element",function(a,b){Touche.utils.touch&&(a.touch=!0,Touche(b.find("label")[0]).swipe({options:{preventDefault:!0},end:function(b,c){a.readOnly||(("right"===c.swipe.direction&&a.value||"left"===c.swipe.direction&&!a.value)&&(a.value=!a.value,a.$apply()),Touche.preventGestures(this.gestureHandler))}}).tap({end:function(){a.readOnly||(a.value=!a.value,a.$apply(),Touche.preventGestures(this.gestureHandler))}}))}]})}),define("text!assets/qlikui/components/qui-search-field/qui-search-field.ng.html",[],function(){return'<div class="qui-searchfield"  ng-class="{ \'qui-focus\': focus }" ng-disabled="disabled">\r\n	<span class="magnifying-glass"></span>\r\n	<span q-title-translation="Common.Clear" class="clear-button" ng-show="query.length" qva-activate="clearSearch($event)"></span>\r\n	<input maxlength="{{maxlength || 255}}" q-placeholder="{{placeholder}}" ng-model="query" ng-disabled="disabled" autocomplete="{{autocomplete}}" spellcheck="{{spellcheck}}" ng-trim="false" type="text" qva-blur="blurred()"\r\n			qva-focus="autoFocus" qv-escape="escape($event)" qv-enter="enter($event)"/>\r\n</div>'}),define("assets/qlikui/components/qui-search-field/qui-search-field",["qlikui/factory","general.utils/support","text!assets/qlikui/components/qui-search-field/qui-search-field.ng.html"],function(a,b,c){a.component("quiSearchField",{scope:{query:"=",disabled:"=",autocomplete:"=",spellcheck:"=",placeholder:"@",autoFocus:"=?",isFocused:"=?",focuscallback:"&",maxlength:"=",onEscape:"&",onEnter:"&"},template:c,link:function(a,c){var d=c.find("span.clear-button"),e=c.find("input");a.focus=!1,e.on("focus.quiSearchField",function(){a.$root.$$phase?a.focused():a.$apply(function(){a.focused()})}),a.focused=function(){a.focuscallback(),a.focus=!0,a.isFocused=!0},a.blurred=function(){a.focus=!1,a.isFocused=!1},a.escape=function(b){a.onEscape&&a.onEscape({$event:b})},a.enter=function(b){a.onEnter&&a.onEnter({$event:b})},a.clearSearch=function(c){c.preventDefault(),a.query="",e[0]&&b.treatAsDesktop()&&e[0].focus()},a.$on("$destroy",function(){e.off(".quiSearchField"),d.off(".quiSearchField")})}})}),define("text!assets/qlikui/components/qui-filter/qui-filter.ng.html",[],function(){return'<div class="button-div qui-filter qui-buttongroup">\r\n	<qui-button light\r\n				qva-activate="toggleAscDesc()"\r\n				class="asc-desc"\r\n				title="{{sortTitle | translate}}"\r\n				data-icon="{{isAscending ? \'ascending\' : \'descending\'}}"></qui-button>\r\n\r\n	<qui-button light\r\n				disabled="disabled"\r\n				ng-if="sections.length <= 1"\r\n				class="sort-filter qui-dropdown"\r\n				title="{{ sortOptTitle | translate }}">\r\n		{{ $parent.sections[0].text || "Common.SortByAlphabetical" | translate }}\r\n	</qui-button>\r\n\r\n	<qui-select ng-if="sections.length > 1"\r\n				class="sort-filter light"\r\n				qui-model="$parent.selectedFltr"\r\n				qui-options="option.value as option.text | translate for option in sections"\r\n				title="{{sortOptTitle | translate}}"></qui-select>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-filter/qui-filter",["qlikui/factory","text!assets/qlikui/components/qui-filter/qui-filter.ng.html"],function(a,b){a.component("quiFilter",{restrict:"E",replace:!0,scope:{isAscending:"=",sections:"=",selectedFltr:"=",toggleAscDesc:"&",sortTitle:"@",sortOptTitle:"@"},template:b})}),define("text!assets/qlikui/components/qui-toolbar/qui-app-info.ng.html",[],function(){return'<section class="qv-app-info-holder">\r\n	<div class="app-info-click-area"\r\n		 qva-activate="quiModel.onButton()"\r\n		 q-title-translation="{{quiModel.tooltip()}}"\r\n		 ng-class="{\'has-app-details\': quiModel.hasAppDetails()}">\r\n		<span class="app-read-only" ng-if="quiModel.readOnly"><i data-icon="padlock" q-title-translation="Hub.App.ReadOnly"></i>&nbsp;</span>\r\n\r\n		<h1 class="app-title">{{quiModel.appTitle}}</h1>\r\n\r\n		<h1 class="app-info-icon" data-icon="info" ng-if="quiModel.hasAppDetails()"></h1>\r\n	</div>\r\n</section>'}),define("text!assets/qlikui/components/qui-toolbar/qui-toolbar-button.ng.html",[],function(){return'<button\r\n		tid="{{quiModel.tid}}"\r\n		qva-activate="onButton($event)"\r\n		qva-outside-ignore-for="{{quiModel.name}}"\r\n		q-title-translation="{{(quiModel.pressed && quiModel.tooltipActive ? quiModel.tooltipActive : quiModel.tooltipInactive)}}"\r\n		ng-disabled="quiModel.isDisabled()"\r\n		ng-hide="quiModel.isHidden()"\r\n		ng-class="{\'qui-button\': !quiModel.qlikuiSmallIconButton, \'qui-smalliconbutton\': quiModel.qlikuiSmallIconButton,\'qui-active\': quiModel.pressed, \'noIcon\': !quiModel.icon, \'{{quiModel.hasStrongActiveColor}}\': true, \'iconToTheRight\': quiModel.iconToTheRight, \'dyn-text\': quiModel.dynamicText }">\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && !quiModel.iconToTheRight" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && quiModel.showText()" class="item-title">{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}</span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && !quiModel.textOnly && quiModel.iconToTheRight" data-icon="{{quiModel.icon}}" ng-class="{\'qui-dropdown\': quiModel.isDropdownButton}"></span>\r\n	<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="quiModel.dynamicText">{{ quiModel.dynamicText() }}</span>\r\n</button>'}),define("assets/qlikui/components/qui-toolbar/qui-toolbar",["jquery","qlikui/factory","text!assets/qlikui/components/qui-toolbar/qui-app-info.ng.html","text!assets/qlikui/components/qui-toolbar/qui-toolbar-button.ng.html"],function(a,b,c,d){b.component("quiToolbar",{template:"<div class='qui-toolbar' ng-transclude />"}),b.component("quiToolbarLeft",{template:"<div class='qui-buttonset-left' ng-transclude />"}),b.component("quiToolbarRight",{template:"<div class='qui-buttonset-right' ng-transclude />"}),b.component("quiToolbarButtonGroup",{template:"<div class='qui-buttongroup' ng-transclude />"}),b.component("quiToolbarAppInfo",{template:c,scope:{quiModel:"="}}),b.component("quiToolbarButton",{template:d,scope:{quiModel:"="},controller:["$scope","$timeout",function(b){b.onButton=function(c){a.support.touch&&c.target.focus(),b.quiModel.isToggleButton&&(b.quiModel.pressed=!b.quiModel.pressed),b.quiModel.onButtonClicked(b.quiModel,c)}}]})}),define("text!assets/qlikui/components/qui-select/qui-select.html",[],function(){return'<div class="qui-select">\r\n	<select class="select" %attrs%>\r\n		%options%\r\n	</select>\r\n	<div class="arrow"></div>\r\n	<div class="border"></div>\r\n</div>\r\n'}),define("assets/qlikui/components/qui-select/qui-select",["qlikui/factory","text!assets/qlikui/components/qui-select/qui-select.html"],function(a,b){a.component("quiSelect",{transclude:!1,template:function(a,c){var d='ng-model="'+c.quiModel+'"';c.quiDisabled&&(d+=' ng-disabled="'+c.quiDisabled+'"'),c.quiOptions&&(d+=' ng-options="'+c.quiOptions+'"'),c.quiChange&&(d+=' ng-change="'+c.quiChange+'"'),c.quiTid&&(d+=' tid="'+c.quiTid+'"');var e=b.replace("%attrs%",d).replace("%options%",a.html());return e},link:function(a,b){var c=b.find(".select");c.on("mouseenter",function(){c.addClass("qui-hover")}),c.on("mouseleave",function(){c.removeClass("qui-hover")})},scope:!1})}),define("text!assets/qlikui/components/qui-button-outline-round/qui-button-outline-round.html",[],function(){return'<button class="qv-btn-outline-round" ng-class="{\'qv-btn-outline-round-no-text\': !qvaButtonText && !qvaButtonPreIconText, \'qv-btn-outline-round-with-text\':  qvaButtonText || qvaButtonPreIconText}">\r\n	<div class="qv-btn-outline-round-flex">\r\n		<span ng-if="qvaButtonPreIconText" ng-class="{\'qv-btn-outline-round-icon-right\': classIcon}" class="qv-btn-outline-round-text">{{qvaButtonPreIconText}}</span>\r\n		<i class="outline-icon {{ classIcon }}"></i>\r\n		<span ng-if="qvaButtonText" ng-class="{\'qv-btn-outline-round-icon-left\': classIcon}" class="qv-btn-outline-round-text" q-translation="{{qvaButtonText}}"></span>\r\n	</div>\r\n</button>'}),define("assets/qlikui/components/qui-button-outline-round/qui-button-outline-round",["qlikui/factory","text!assets/qlikui/components/qui-button-outline-round/qui-button-outline-round.html"],function(a,b){a.component("quiButtonOutlineRound",{template:b,replace:!0,scope:{"class":"@",classIcon:"@",qvaButtonText:"@",qvaButtonPreIconText:"="},link:function(a){a.$watch("classIcon",function(b){a.classIcon=b})}})}),define("text!assets/qlikui/components/qui-button-icon/qui-button-icon.html",[],function(){return'<button class="{{className}}" ng-class="classes" ng-transclude></button>'}),define("assets/qlikui/components/qui-button-icon/qui-button-icon",["qlikui/factory","text!assets/qlikui/components/qui-button-icon/qui-button-icon.html"],function(a,b){function c(a,b,c){var d="qui-btn-icn";a.className=d+(b?"-tgl":""),c&&(a.className+=" qui-active")}var d=13;a.component("quiButtonIcon",{template:b,scope:{icon:"@",active:"="},controller:["$scope","$element","$attrs",function(a,b,e){function f(){c(a,e.hasOwnProperty("toggle"),a.active)}function g(a){a.keyCode===d&&b.trigger("qv-activate")}a.$watch("active",f),b.on("keypress",g)}]})}),define("qlikui/components",["assets/qlikui/components/qui-dialog-default/qui-dialog-default","assets/qlikui/components/qui-dialog-pleasewait/qui-dialog-pleasewait","assets/qlikui/components/qui-dialog-alert/qui-dialog-alert","assets/qlikui/components/qui-input-number/qui-input-number","assets/qlikui/components/qui-modal-default/qui-modal-default","assets/qlikui/components/qui-radiobuttongroup/qui-radiobuttongroup","assets/qlikui/components/qui-checkbox/qui-checkbox","assets/qlikui/components/qui-radiobutton/qui-radiobutton","assets/qlikui/components/qui-float/qui-float","assets/qlikui/components/qui-button/qui-button","assets/qlikui/components/qui-popover-button/qui-popover-button","assets/qlikui/components/qui-list/qui-list","assets/qlikui/components/qui-toggle-switch/qui-toggle-switch","assets/qlikui/components/qui-search-field/qui-search-field","assets/qlikui/components/qui-filter/qui-filter","assets/qlikui/components/qui-toolbar/qui-toolbar","assets/qlikui/components/qui-select/qui-select","assets/qlikui/components/qui-button-outline-round/qui-button-outline-round","assets/qlikui/components/qui-button-icon/qui-button-icon"],function(){}),define("general.utils/qv-swipe",["jquery","touche"],function(a){function b(b,c,d){return a.Event(b,{pageX:d.pagePoints[0].x,pageY:d.pagePoints[0].y,ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,originalEvent:c,gestureData:d})}function c(){function a(){document.removeEventListener("mousedown",b,!0),document.removeEventListener("mousemove",c,!0),document.removeEventListener("mouseup",d,!0)}function b(a){a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(b){b.preventDefault(),b.stopPropagation(),a(),clearTimeout(e)}var e;document.addEventListener("mousedown",b,!0),document.addEventListener("mousemove",c,!0),document.addEventListener("mouseup",d,!0),e=setTimeout(a,350)}var d;Touche(document.body).tap({options:{preventDefault:!1},start:function(b){d=a(b.target)}}),Touche(document.body).swipe({options:{preventDefault:!1,radiusThreshold:8},start:function(a,c){var e=b("qv-swipestart",a,c);d.trigger(e)},update:function(a,c){var e=b("qv-swipeupdate",a,c);d.trigger(e)},cancel:function(){var b=a.Event("qv-swipecancel");d.trigger(b)},end:function(a,e){Touche.utils.isMouse(a)||c();var f=b("qv-swipe",a,e);d.trigger(f)}})}),define("general.utils/qv-longtapswipe",["jquery","touche"],function(a,b){"use strict";var c=b.Gesture.augment(function(c){function d(){c.apply(this,arguments)}function e(){function a(){document.removeEventListener("mousedown",b,!0),document.removeEventListener("mousemove",c,!0),document.removeEventListener("mouseup",d,!0)}function b(a){a.preventDefault(),a.stopPropagation()}function c(a){a.preventDefault(),a.stopPropagation()}function d(b){b.preventDefault(),b.stopPropagation(),a(),clearTimeout(e)}var e;document.addEventListener("mousedown",b,!0),document.addEventListener("mousemove",c,!0),document.addEventListener("mouseup",d,!0),e=setTimeout(a,350)}var f=!1;return this.defaults={radiusThreshold:10,timeThreshold:510,touches:1,precedence:4,preventDefault:!1,which:1,interval:10},this.on=function(a){this.count=0,b(a).longtap({id:this.id,options:{precedence:this.options.precedence,preventDefault:this.options.preventDefault,touches:this.options.touches,which:this.options.which,areaThreshold:this.options.areaThreshold,timeThreshold:this.options.timeThreshold,interval:this.options.interval},start:this.longtapStart.bind(this),update:this.longtapUpdate.bind(this),cancel:this.longtapCancel.bind(this),end:this.longtapEnd.bind(this)}).swipe({id:this.id,options:{precedence:this.options.precedence+1,preventDefault:this.options.preventDefault,radiusThreshold:this.options.radiusThreshold,touches:this.options.touches},start:this.swipeStart.bind(this),update:this.swipeUpdate.bind(this),end:this.swipeEnd.bind(this),cancel:this.swipeCancel.bind(this)})},this.off=function(a){b(a).off("longtap",this.id),b(a).off("swipe",this.id)},this.longtapStart=function(){f=!1},this.longtapUpdate=function(a,b){100===b.percentage&&(f=!0)},this.longtapEnd=function(){this.binder.cancel()},this.longtapCancel=function(){f||this.binder.cancel()},this.swipeStart=function(b,c){var d=a(b.target).is("input, textarea");f&&!d?this.binder.start(b,c):f&&d&&(f=!1)},this.swipeUpdate=function(a,b){f&&this.binder.update(a,b)},this.swipeEnd=function(a,b){f&&(e(),this.binder.end(a,b))},this.swipeCancel=function(){f=!1,this.binder.cancel()},d});b.gestures.add("longtapswipe",c)}),define("text!client.views/current-selections/current-selections.ng.html",[],function(){return'<div class="qv-panel-subtoolbar qv-panel-current-selections" ng-class="{smallDevice: isSmallDevice}">\r\n	<div ng-if="!isSmallDevice">\r\n		<div class="qv-selections-pager">\r\n\r\n			<div class="buttons borderbox">\r\n\r\n				<button class="qv-subtoolbar-button borderbox" qva-activate="back()" ng-disabled="disable.back" q-title-translation="Tooltip.NavigateBack">\r\n					<i class="icon-toolbar-navigation-back"></i>\r\n				</button>\r\n\r\n				<button class="qv-subtoolbar-button borderbox" qva-activate="forward()" ng-disabled="disable.forward" q-title-translation="Tooltip.NavigateForward">\r\n					<i class="icon-toolbar-navigation-forward"></i>\r\n				</button>\r\n\r\n				<button id="clearselections" class="qv-subtoolbar-button borderbox" ng-disabled="disable.clear" qva-activate="clearAllFields()" q-title-translation="Tooltip.ClearSelections">\r\n					<i class="icon-toolbar-clearselections"></i>\r\n				</button>\r\n\r\n			</div>\r\n			<div class="selections-shadow" ng-if="showShadow"></div>\r\n			<div class="wrap borderbox" style="height: 100%;" qv-pager qv-selection-pager>\r\n				<ul class="list" ng-show="items.length > 0 && !isGlobalSelectionsActive" qva-delegated-activate=".item#showPopover($event)" qva-outside-ignore-for="currentSelectionsItems">\r\n					<li ng-repeat="item in items track by item.qField" data-csid="{{item.qField}}">\r\n						<div class="item" ng-mousemove="openTooltip($event, item)" ng-mouseleave="closeTooltip()" ng-class="{\r\n				\'active\' : item.qField === activeFieldName,\r\n				\'dim\' : $parent.itemSelected && !item.active,\r\n				\'item-locked\' : item.qLocked,\r\n				\'locked-feedback item-animate-in\' : item.feedbackActive && item.qLocked,\r\n				\'item-animate-out\' : !item.feedbackActive && item.qLocked }">\r\n							<div ng-class="{locked:item.qLocked}" class="text">\r\n								<div class="text-wrap">\r\n									<span ng-class="{ \'icon-toolbar-locked\': item.qLocked }"></span><span class="name">{{item.qField}}</span>\r\n								</div>\r\n								<span class="values">{{item.translation}}</span>\r\n							</div>\r\n						<span ng-class="{\r\n						\'icon-toolbar-locked\': item.qLocked,\r\n						\'item-animate-in\' : item.feedbackActive,\r\n						\'item-animate-out\' : !item.feedbackActive,\r\n						\'icon-locked-feedback\' : item.feedbackActive && item.qLocked }">\r\n						</span>\r\n							<div class="options">\r\n								<a ng-if="!item.qLocked && !item.isPlaceHolder" qva-activate="clear(item.qField)" class="remove" q-title-translation="CurrentSelections.Remove">\r\n									<i class="icon-cancel"></i>\r\n								</a>\r\n							</div>\r\n\r\n							<qv-state-count-bar ng-if="!item.isPlaceHolder" cardinal="item.qTotal" state-counts="item.qStateCounts"></qv-state-count-bar>\r\n						</div>\r\n					</li>\r\n				</ul>\r\n\r\n				<div ng-if="!items.length" class="empty-text no-selection" q-translation="CurrentSelections.NoSelections"></div>\r\n				<a class="qv-pager-nav qv-pager-previous" qva-activate="prevPage()" q-title-translation="Tooltip.Previous"><i class="icon-hub-previous"></i></a>\r\n				<a class="qv-pager-nav qv-pager-next" qva-activate="nextPage()" q-title-translation="Tooltip.Next"><i class="icon-hub-next"></i></a>\r\n			</div>\r\n			<div class="buttons-end borderbox">\r\n				<button tid="toggleGlobalSearchButton" class="qv-subtoolbar-button global-search-button borderbox" ng-class="{active: isGlobalSearchActive}" qva-activate="toggleGlobalSearch()" q-title-translation="{{isGlobalSearchActive ? \'Tooltip.CloseGlobalSearch\' : \'Tooltip.GlobalSearch\'}}">\r\n					<i class="icon-toolbox-search-magnifier"></i>\r\n				</button>\r\n\r\n				<button class="qv-subtoolbar-button borderbox" ng-class="{active: isGlobalSelectionsActive}" qva-activate="toggleGlobalSelection($event)"\r\n					q-title-translation="{{isGlobalSelectionsActive ? \'Tooltip.CloseGlobalSelector\' : \'Tooltip.GlobalSelector\'}}" tid="currentSelections.toggleGlobalSelections">\r\n					<i class="icon-toolbar-currentselections"></i>\r\n				</button>\r\n			</div>\r\n\r\n		</div>\r\n	</div>\r\n	<div ng-if="isSmallDevice && mobileIndicatorShow && !inSelection " qva-activate="toggleGlobalSelection($event)" class="qv-current-selections-mobile-wrapper" tid="currentSelections.toggleMobileSelections" q-title-translation="GlobalSelections.CurrentSelections">\r\n		<div class="qv-current-selections-mobile-background">\r\n			<p class="qv-current-selections-mobile-nbr" ng-class="{selections: nbrSelections > 0}">{{nbrSelections}}</p>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("objects.models/listbox",["objects.models/visualization-object","general.utils/visualizations","objects.utils/data-properties/listobject-util","util","objects.utils/type-loader"],function(a,b,c,d,e){"use strict";var f,g=[];return f=a.extend("Listbox",{}),f.createTransient=function(c,d,f){var h,i,j,k=-1,l=g.length;for(h={that:c,app:d,props:f},i=0;l>i;i++)if(angular.equals(g[i].askFor,h)){k=i;break}return k>=0?g[k].result:(j=e.load().then(function(){return b.getType("listbox").getInitialProperties(f).then(function(b){return a.createTransient.call(c,b,d)})}),g.push({askFor:h,result:j}),j)},f.createTransientField=function(a,b,e){var f={};return f.qListObjectDef=c.createFieldDimension(b),d.extend(!0,f,e||{}),this.createTransient(this,a,f)},f.createTransientDimension=function(a,b,e){var f={};return f.qListObjectDef=c.createLibraryDimension(b),d.extend(!0,f,e||{}),this.createTransient(this,a,f)},f}),define("objects/listbox-popover/listbox-popover",["core.utils/deferred","core.utils/resize"],function(a,b){var c={template:null,controller:["$scope","$element","$timeout",function(c,d,e){function f(){e(function(){c.destroyComponent(),d.remove()}),b.off("start.listbox-popover-error",f)}function g(){return e(function(){return d.find(".toolbar-wrapper").outerWidth()})}var h=this;h.selectionsActivated=function(){},h.selectionsDeactivated=function(){},h.close=function(){f()},c.closeView=function(a){c.onPopoverClose(a),f()},a.all({object:c.getVisualization(),width:g()}).then(function(a){var d=a.object,e=a.width;d.getSelectionToolbar().then(function(a){c.toolbar=a,c.toolbar.showLock=c.options.showLock,c.toolbar.position={width:e},d.activateSelections()}),d.loaded.then(function(){d.ext.hasError({layout:d.model.layout})&&b.on("start.listbox-popover-error",f)}),d.selectionsApi.watchActivated(function(){h.selectionsActivated()}),d.selectionsApi.watchDeactivated(function(){h.selectionsDeactivated(),f()}),c.closeView=function(a){d.selectionsApi.confirm(),c.onPopoverClose(a),f()}})}]};return c}),define("text!objects/listbox-popover/listbox-popover.ng.html",[],function(){return'<immidiate-contextual\r\n		class="qv-listbox-popover"\r\n		align-to="$alignToElement"\r\n		position="popupPosition"\r\n		collision="collision"\r\n		width="234"\r\n		height="332"\r\n		on-close-view="closeView(event)"\r\n		qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\r\n	<div class="toolbar-wrapper"\r\n		qva-include-selection-toolbar\r\n		component="selectionToolbarComponent"\r\n		toolbar="toolbar"\r\n		options="options"></div>\r\n	<div class="listbox-wrapper" >\r\n		<qv-object object="object" model="model" options="options"></qv-object>\r\n	</div>\r\n</immidiate-contextual>\r\n'}),define("text!objects/listbox-popover/listbox-popover-small-device.ng.html",[],function(){return'<div\r\n	class="qv-listbox-popover-small-device">\r\n	<div class="toolbar-wrapper"\r\n		qva-include-selection-toolbar\r\n		component="selectionToolbarComponent"\r\n		toolbar="toolbar"\r\n		options="options">\r\n	</div>\r\n	<h1 class="qvt-visualization-title">{{model.layout.title || model.layout.qListObject.qDimensionInfo.qFallbackTitle}}</h1>\r\n	<div class="listbox-wrapper">\r\n		<qv-object object="object" model="model" options="options"></qv-object>\r\n	</div>\r\n</div>\r\n'}),define("objects/listbox-popover/listbox-popover-service",["qvangular","util","core.utils/deferred","objects.models/listbox","client.views/selection-toolbar/selection-toolbar","objects/listbox-popover/listbox-popover","general.utils/responsive-state","text!./listbox-popover.ng.html","text!./listbox-popover-small-device.ng.html","objects/object","general.components/immidiate-contextual/immidiate-contextual"],function(a,b,c,d,e,f,g,h,i){a.service("qvListboxPopoverService",["$document",function(a){var j,k,l,m=a.find("body");return k={show:function(a,d,k,n){var o=c(),p={$alignToElement:d.$alignToElement,popupPosition:d.position||"bottom",collision:d.collision||"none",qvaOutsideIgnoreFor:d.qvaOutsideIgnoreFor,getVisualization:function(){return o.promise},model:a,onPopoverClose:this.onPopoverClose,options:{setController:o.resolve,isPopover:!0,showLock:d.showLock,search:d.search||{}},selectionToolbarComponent:e};return l&&(l.selectionsActivated=function(){},l.selectionsDeactivated=function(){},l.close()),j=angular.element("<div>"),m.append(j),f.template=g.isSmallDevice?i:h,l=j.showComponent(f,p),l.selectionsActivated=function(){b.isFunction(n)&&n()},l.selectionsDeactivated=function(){b.isFunction(k)&&k(),k=null,n=null},l},showField:function(a,b,e,f,g,h){return d.createTransientField(b,a,f).then(function(a){return c.resolve(this.show(a,e,g,h))}.bind(this))},showDimension:function(a,b,c,e,f,g){d.createTransientDimension(b,a,e).then(function(a){this.show(a,c,f,g)}.bind(this))},close:function(){l&&l.close()},onPopoverClose:function(){}}}])}),define("widget.pager",["jquery","jqueryui"],function(a){return a.widget("qv.pager",{options:{itemSelector:">li",orientation:"horizontal",pageSize:"auto",startPage:1,animationDuration:300},_create:function(){var b=this.options;a.extend(this,{positionProperty:"horizontal"===b.orientation?"left":"top",sizeProperty:"horizontal"===b.orientation?"outerWidth":"outerHeight"}),this.refresh(),this.goToPage(b.startPage)},isItemInsidePage:function(b){var c=a(b),d=c.position()[this.positionProperty]+c[this.sizeProperty](),e=Math.abs(parseFloat(c.parent().css("margin-"+this.positionProperty))),f=e+this.containerSize;return d>e&&f>d},calculatePageSize:function(){return Math.floor(this.containerSize/this.calculateItemSize())},calculateItemSize:function(){return this.element.find(this.options.itemSelector).eq(0)[this.sizeProperty]()},refresh:function(){var a=this.currentPage||1;this.containerSize=this.element.parent()[this.sizeProperty](),this.pageSize="auto"===this.options.pageSize?this.calculatePageSize():this.options.pageSize,this.itemSize=this.calculateItemSize(),this.maxPages=Math.ceil(this.element.find(this.options.itemSelector).length/this.pageSize||1),this.currentPage=Math.min(a,this.maxPages),this.goToPage(this.currentPage)},goToPage:function(a){this.currentPage=Math.min(Math.max(1,a),this.maxPages);var b=(this.currentPage-1)*this.itemSize*this.pageSize,c={};c[this.positionProperty]=-b+"px",this.element.stop(!0).animate(c,this.options.animationDuration);
},goToPreviousPage:function(){this.goToPage(this.currentPage-1)},goToNextPage:function(){this.goToPage(this.currentPage+1)},goToPageContaining:function(a){var b=Math.ceil(this.element.find(a).index()+1/this.pageSize);this.goToPage(b)},_destroy:function(){this.element.off(this.eventNamespace)}}),a}),define("general.components/pager/pager",["qvangular","core.utils/resize","widget.pager"],function(a,b){a.directive("qvPager",["$timeout",function(a){return{restrict:"A",priority:0,link:function(c,d){function e(){c.refreshPager()}"ontouchstart"in window&&d.css("overflow-x","auto"),c.pagerData=d.find("ul").pager().data("qv-pager"),d.addClass("qv-pager"),c.nextPage=function(){a(function(){c.pagerData.goToNextPage(),c.refreshPager(!0)})},c.prevPage=function(){a(function(){c.pagerData.goToPreviousPage(),c.refreshPager(!0)})},c.goToPage=function(a){c.pagerData.goToPage(a),c.refreshPager(!0)},c.refreshPager=function(a){var b="";a||c.pagerData.refresh(),d.removeClass("qv-pager-back qv-pager-forward"),1!==c.pagerData.currentPage?(c.showShadow=!0,b+="qv-pager-back "):c.showShadow=!1,c.pagerData.currentPage!==c.pagerData.maxPages&&(b+="qv-pager-forward "),d.addClass(b)},c.$on("refreshPager",e),c.$on("$destroy",function(){b.off("end",e)})}}}])}),define("text!client.views/global-selections/global-selections.ng.html",[],function(){return'<div class="qv-global-selections" ng-class="{\'toolbar\': toolbar}">\r\n\r\n	<section class="qv-gs-section qv-gs-top" tid="globalSelections.topSection">\r\n		<header class="qv-gs-header">\r\n			<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\r\n		</header>\r\n		<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'fields\' }" all-items="selectedFields"></div>\r\n	</section>\r\n\r\n	<section class="qv-gs-section" tid="globalSelections.bottomSection">\r\n		<header class="qv-gs-header">\r\n			<h2 q-translation="GlobalSelections.AppDimensions"></h2>\r\n			<qui-checkbox qui-model="showFields" qui-label="{{\'GlobalSelections.ShowFields\'|translate}}" qui-title="{{\'GlobalSelections.ShowFields\'|translate}}" tid="globalSelections.showFields"></qui-checkbox>\r\n			<qui-search-field class="qv-gs-searchfield" placeholder="GlobalSelections.FilterDimensionsAndFields" query="filter" maxlength="255"\r\n							 tid="globalSelections.searchField" on-escape="filter = \'\';" auto-focus="autoFocus" on-enter="onEnter($event)"></qui-search-field>\r\n		</header>\r\n\r\n		<div class="qv-gs-info" ng-if="!dimAvailable && !showFields">\r\n			<h2 q-translation="GlobalSelections.DimensionsWarning"></h2>\r\n		</div>\r\n		<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'dimensions\'}" all-items="dimensionsFields" filter="filter"></div>\r\n	</section>\r\n</div>\r\n'}),define("text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="confirm-dialog" qv-cancel="cancel()" qv-confirm="confirm()">\r\n	<main class="dm-main">\r\n		<div class="qv-mvc-dialog-content">\r\n			<div class="qv-mvc-dialog-icon icon-{{icon}}" ng-show="icon"></div>\r\n			<p><span q-translation="{{text}}"></span></p>\r\n		</div>\r\n	</main>\r\n	<qv-confirm-cancel-footer qv-confirm="confirm()" qv-cancel="cancel()" qv-confirm-label="{{$parent.confirmLabel}}"></qv-confirm-cancel-footer>\r\n</qv-modal-dialog>\r\n'}),define("general.utils/tabbable-elements",["jquery","jqueryui"],function(a){"use strict";var b=[];return{preventTabbing:function(c){var d={id:b.length,elements:c.find(":tabbable")};b.push(d),d.elements.each(function(){var b=a(this);b.data("tabbable-elements-tabindex",b.attr("tabindex"))}),d.elements.attr("tabindex","-1")},restoreTabbing:function(){var c=b.pop();c.elements.each(function(){var b=a(this),c=b.data("tabbable-elements-tabindex");c?b.attr("tabindex",c):b.removeAttr("tabindex")})}}}),define("assets/client/dialogs/directives/tabbable-container",["qvangular","general.utils/tabbable-elements","jquery"],function(a,b,c){a.directive("qvTabbableContainer",function(){return{restrict:"A",controller:["$scope","$element",function(a,d){var e=d[0].nextSibling,f=d[0].parentNode;f.removeChild(d[0]),b.preventTabbing(c(document.body)),document.activeElement&&document.activeElement.blur(),f.insertBefore(d[0],e),a.$on("$destroy",function(){b.restoreTabbing()})}]}})}),define("general.utils/keyboard-event-dispatcher",["jquery"],function(a){function b(a){Object.keys(f).forEach(function(b){f[b]=f[b].filter(function(b){return b.jackId!==a})})}function c(a){var b=Array.prototype.slice.call(arguments,1);f[a].forEach(function(a){a.jackId===g[g.length-1]&&a.handler.apply(null,b)})}function d(a,b,d){f[b]||(e.on(b,c.bind(null,b)),f[b]=[]),f[b].push({jackId:a.id,handler:d})}var e,f={},g=[],h={on:function(a,b){d(this,a,b)},release:function(){var a=this.id;b(a),g.splice(g.indexOf(a),1)}};return{hijack:function(){e||(e=a(document));var b=Object.create(h,{id:{value:g.length}});return g.push(b.id),b}}}),define("assets/client/dialogs/directives/escape",["qvangular","general.utils/keyboard-event-dispatcher"],function(a,b){a.directive("qvDialogEscape",["$parse",function(a){return{restrict:"A",controller:["$scope",function(a){var c=this.hijack=b.hijack();a.$on("$destroy",function(){c.release()})}],link:function(b,c,d,e){var f=a(d.qvDialogEscape);e.hijack.on("keydown",function(a){27===a.keyCode&&(a.preventDefault(),setTimeout(function(){b.$apply(function(){f(b,{$event:a})})}))})}}}])}),define("text!assets/client/dialogs/directives/modal-dialog.ng.html",[],function(){return'<div class="modal-container qui-modalbackground-centered" qv-tabbable-container>\r\n	<div id="{{id}}"\r\n		 class="modal-frame qui-delayedModal"\r\n		 ng-transclude></div>\r\n</div>\r\n'}),define("assets/client/dialogs/directives/modal-dialog",["qvangular","text!assets/client/dialogs/directives/modal-dialog.ng.html","general.utils/keyboard-event-dispatcher"],function(a,b,c){a.directive("qvModalDialog",function(){return{scope:{id:"@qvId",confirm:"&qvConfirm",cancel:"&qvCancel"},restrict:"E",transclude:!0,replace:!0,template:b,link:function(a){var b=c.hijack();a.$on("$destroy",function(){b.release()}),b.on("keydown",function(b){if(27===b.keyCode&&(b.preventDefault(),setTimeout(function(){a.$apply(function(){a.cancel()})})),13===b.keyCode){if("TEXTAREA"===b.target.tagName)return;if("BUTTON"===b.target.tagName)return;setTimeout(function(){a.$apply(function(){a.confirm()})})}})}}})}),define("text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html",[],function(){return'<footer class="dm-footer">\r\n    <qui-button qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f"></qui-button>\r\n    <qui-button qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></qui-button>\r\n</footer>\r\n'}),define("assets/client/dialogs/directives/confirm-cancel-footer",["qvangular","text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html"],function(a,b){a.directive("qvConfirmCancelFooter",function(){return{scope:{confirmLabel:"@qvConfirmLabel",confirm:"&qvConfirm",confirmDisabled:"=qvConfirmDisabled",cancel:"&qvCancel"},restrict:"E",replace:!0,template:b}})}),define("assets/client/dialogs/directives/dialog-directives",["assets/client/dialogs/directives/tabbable-container","assets/client/dialogs/directives/escape","assets/client/dialogs/directives/modal-dialog","assets/client/dialogs/directives/confirm-cancel-footer"],function(){}),define("assets/client/dialogs/confirm-dialog/confirm-dialog",["general.services/show-service/show-service","text!assets/client/dialogs/confirm-dialog/confirm-dialog.ng.html","assets/client/dialogs/directives/dialog-directives"],function(a,b){function c(b){var c=b.text,e=void 0!==b.icon?b.icon:"cogwheel",f=b.confirm||"Common.OK",g={text:c,icon:e,confirmLabel:f};return a.show(d,g).resultPromise}var d={template:b,scope:{text:"=",icon:"=",confirmLabel:"="},controller:["$scope",function(a){a.confirm=function(){a.destroyComponent(),a.deferredResult.resolve()},a.cancel=function(){a.destroyComponent(),a.deferredResult.reject()}}]};return{show:c}}),define("client.controllers/grid-controller",["core.utils/deferred","client.utils/state","objects.models/visualization-object"],function(a,b,c){"use strict";function d(a,b){for(var c=[],d=0;b>d;d++){c[d]=[];for(var e=0;a>e;e++)c[d][e]=1}return c}function e(a,b){var c,d,e=b.row+b.rowspan,f=b.col+b.colspan;for(c=b.row;e>c;c++)for(d=b.col;f>d;d++)a[c][d]=0}function f(a,b){var c=a.rectFor(b);return{width:"calc( "+c.width+"% - "+2*c.margin+"px )",height:"calc( "+c.height+"% - "+2*c.margin+"px )",left:"calc( "+c.left+"% + "+c.margin+"px )",top:"calc( "+c.top+"% + "+c.margin+"px )"}}function g(a,c,d){var e=b.isInEditMode(),f=e?4:0,g=100,h=100,i=g/c,j=h/d;a.rectFor=function(a){var b=a.colspan*i,c=a.rowspan*j,d=a.col*i,e=a.row*j;return{left:d,top:e,width:b,height:c,margin:f}};var k,l=[],m=[];for(k=0;c-1>k;++k){var n=(k+1)*i;m.push({left:n+"%"})}for(k=0;d-1>k;++k){var o=(k+1)*j;l.push({top:o+"%"})}a.cols=c,a.rows=d,a.horizontalLines=l,a.verticalLines=m}function h(a,c){var d=c.qInfo.qId!==a.lastSheetId,e=!d&&b.isInEditMode()&&!a.zoomCell&&c.permissions.update;a.lastSheetId=c.qInfo.qId,a.hasUpdatePermission=c.permissions.update,a.isSheet=!0,a.isMaster=!1,a.sheetTitle=c.qMeta&&c.qMeta.title||"",a.isDraft=c.qMeta&&c.qMeta.sourceObject&&c.qMeta.sourceObject.length,a.isDraftOwner=c.qMeta&&c.qMeta.draftObject&&c.qMeta.draftObject.length,(d||!a.hasUpdatePermission)&&(a.activeCell=null),d&&(a.cells=[]),j(a,c.cells.slice(),e)}function i(a,b){var c;if(!b)return null;for(c=0;c<b.length;++c)if(b[c].id===a)return b[c];return null}function j(b,f,g){function h(a){e(q,a);var c={},d={col:a.col,row:a.row,colspan:a.colspan,rowspan:a.rowspan};b.setCellSize(c,d),c.isEmpty=!0,p.push(c)}function j(d){e(q,d);var f=i(d.name,b.cells);if(!f){f={},f.id=d.name;var h=a();f.options={setController:h.resolve,id:d.name,isVisible:!0,isZoomed:!1,isActive:!1},c.get(d.name).then(function(a){f.model=a,g&&b.toggleActive(f)}),f.getVisualization=function(){return h.promise}}var j={col:d.col,row:d.row,colspan:d.colspan,rowspan:d.rowspan};b.setCellSize(f,j),f.isEmpty=!1,p.push(f)}function k(){function a(a,b,c){for(var g=a;d.length>0;){var h=d[d.length-1];if(h.rowSpan===c)return;if(h.rowSpan<c)break;d.pop(),g=h.col;var i=a-h.col,j=h.rowSpan*i;j>e&&(e=j,f={col:h.col,row:b,colspan:i,rowspan:h.rowSpan})}c>0&&d.push({col:g,rowSpan:c})}for(var b,c,d,e,f,g=n,h=[];g--;)for(c=0,b=o,h[g]=[];b--;)q[b][g]?h[g][b]=++c:(c=0,h[g][b]=null);for(f=null,e=0,d=[],b=0;o>b;++b){for(g=0;n>g;++g)null!==h[g][b]?a(g,b,h[g][b]):a(g,b,0);a(g,b,0)}return f}function l(){for(var a,b=1;;){if(a=k(),!a)break;a.priority=b++,f.push(a),h(a)}}function m(a){a.sort(function(a,b){return a=a.pos,b=b.pos,a.row-b.row}).sort(function(a,b){return a=a.pos,b=b.pos,a.row===b.row?a.col-b.col:a.row-b.row})}var n=b.cols,o=b.rows,p=[],q=d(n,o);f.forEach(j),m(p),l(),b.cells=p}function k(){}return k.prototype.setCellSize=function(a,b){a.pos=b,a.style=f(this,b)},k.prototype.updateActiveCell=function(){function a(a,b){b>=0&&j[a]>b&&(j[a]=b)}function c(a,b){0===j[a]&&1>=b||p.push({dir:a,expand:j[a],contract:b-1})}var d=this;if(d.activeCell&&b.isInEditMode()){for(var e=d.activeCell.pos,f=e.col,g=f+e.colspan,h=e.row,i=h+e.rowspan,j={left:f,right:d.cols-g,top:h,bottom:d.rows-i},k=0;k<d.cells.length;++k)if(d.cells[k]!==d.activeCell&&!d.cells[k].isEmpty){var l=d.cells[k].pos.col,m=l+d.cells[k].pos.colspan,n=d.cells[k].pos.row,o=n+d.cells[k].pos.rowspan;i>n&&o>h&&(a("left",f-m),a("right",l-g)),g>l&&m>f&&(a("top",h-o),a("bottom",n-i))}var p=[];c("left",e.colspan),c("right",e.colspan),c("top",e.rowspan),c("bottom",e.rowspan),d.activeCell.resize=p,d.activeCell.updating=!1}},k.prototype.removeResizeHandles=function(){var a=this;a.activeCell&&delete a.activeCell.resize},k.prototype.clearActiveCell=function(){var a=this;a.removeResizeHandles(),a.activeCell=null},k.prototype.toggleActive=function(a){var c=this;b.isInEditMode()&&(!a||c.zoomCell||a.isEmpty?c.clearActiveCell():(c.clearActiveCell(),c.hasUpdatePermission&&(c.activeCell=a),c.updateActiveCell()))},k.prototype.setEditMaster=function(a,b){var c=this,d=[{name:a,type:b,col:0,row:0,colspan:1,rowspan:1}];c.lastSheetId=null,c.isSheet=!1,c.isMaster=!0,g(c,1,1),c.activeCell=null,j(c,d,!1),c.zoom(c.cells[0])},k.prototype.update=function(a){if(a){var b=this;b.layout=a,g(b,a.columns||12,a.rows||7),h(b,a),b.activeCell&&-1===b.cells.indexOf(b.activeCell)&&b.clearActiveCell(),b.zoomCell&&-1===b.cells.indexOf(b.zoomCell)&&(b.zoomCell=null),b.updateActiveCell()}},k.prototype.zoom=function(a){var b=this;b.cells&&(b.cells.forEach(function(b){b.options&&(b.options.isVisible=b===a||!a,b.options.isZoomed=b===a&&!!a)}),a?(b.clearActiveCell(),b.zoomCell=a,a.object&&(a.object.expanded=!!a)):b.zoomCell&&(b.zoomCell.object&&(b.zoomCell.object.expanded=!1),b.clearActiveCell(),b.hasUpdatePermission&&(b.activeCell=b.zoomCell),b.zoomCell=null,b.updateActiveCell()))},k.prototype.getOptimalCell=function(){var a=this,b=a.cells.slice();b.sort(function(a,b){if(a.isEmpty&&!b.isEmpty)return-1;if(b.isEmpty&&!a.isEmpty)return 1;var c=a.pos.colspan*a.pos.rowspan,d=b.pos.colspan*b.pos.rowspan;return c>d?-1:d>c?1:0});var c=b[0]||null;if(c&&!c.isEmpty)if(c.pos.colspan>1||c.pos.rowspan>1){var d=c.pos.colspan>c.pos.rowspan?"right":"bottom";c={isEmpty:!0,pos:{pos:c.pos,split:d}}}else c=null;return c},k}),define("client.services/grid-service",["qvangular","core.models/rpc-base","client.controllers/grid-controller","client.utils/state","jquery","general.services/delayed-modal/delayed-modal"],function(a,b,c,d,e){"use strict";function f(){var b=a.getService("$delayedModal"),c=e.extend(!0,{},{},{title:"Ui.Warning.GridFull.Title",content:"Ui.Warning.GridFull"});b.open(c)}function g(a,b){d.setView(a);var c=e(document.body);c.toggleClass("qv-view-sheet",!b),c.toggleClass("qv-view-object",b),c.toggleClass("qv-gridzoom",b)}function h(e){var f;p||(p=a.$rootScope.$new(!0),p.grid=new c,p.model=e,b.bindLayout(p,"model",function(a){p.grid.update(a)}),p.$watch(d.isInEditMode,function(a){f=a,p.grid.update(p.grid.layout),f?p.grid.updateActiveCell():(p.grid.removeResizeHandles(),n())}),p.$watch("grid.zoomCell",function(a){if(!(m()||d.view===d.Views.story&&d.state!==d.States.analysis)){var b=a?d.Views.object:d.Views.sheet;g(b,!!a)}}),d.SheetChanged.bind(i))}function i(a){p&&(p.model=a)}function j(){p&&(p.$destroy(),p=null,d.SheetChanged.unbind(i))}function k(){var a=p&&p.grid.getOptimalCell();return a||f(),a}function l(a){p&&p.model.removeObject(a.pos)}function m(){return p&&p.grid&&!p.model}function n(){m()&&(i(d.model),g(d.Views.sheet,!1))}function o(a,b){p&&(p.model=null,p.grid.setEditMaster(a,b),g(d.Views.masterObject,!0))}var p=null;return{start:h,stop:j,goToEditMode:function(){d.setState(d.States.edit)},getOptimalCell:k,removeCell:l,isActive:function(){return!!p},getGrid:function(){return p&&p.grid},getModel:function(){return p&&p.model},getActiveCell:function(){return p&&(p.grid.activeCell||p.grid.zoomCell)},activateCell:function(a){p&&p.grid.toggleActive(a)},deactivateCell:function(){p&&p.grid.toggleActive(null)},getZoomCell:function(){return p&&p.grid.zoomCell},getZoomedCellId:function(){return p.grid.zoomCell.id},zoomInOnCell:function(a){var b;p&&(b=p.grid.cells.filter(function(b){return b.id===a}),b.length&&p.grid.zoom(b[0]))},zoomOut:function(){p&&p.grid.zoom(null)},isEditMaster:m,closeEditMaster:n,editMaster:o}}),define("client.assets/assets-utils",["jquery","util","assets/client/dialogs/confirm-dialog/confirm-dialog","pubsub","client.utils/state","client.services/grid-service"],function(a,b,c,d,e,f){function g(a,b){c.show({text:a}).then(b)}function h(a){if(!i)throw new TypeError("Permissions are not available yet. Make sure you have initialized this module with init().");switch(a){case"measure":return i.createMeasure;case"dimension":return i.createDimension;case"visualization":return i.createMasterobject;default:throw new TypeError("'"+a+"' is an unknown type.")}}var i,j={init:function(b){b&&(i=a.extend({},b))},getContextMenuAddToText:function(){var a=f.getActiveCell();return a?"contextMenu.addToVisualization":"contextMenu.addToSheet"},getAddToOptions:function(){var a=f.getActiveCell(),b=null;return e.isInEditMode()&&(b={},a?b.object=!0:b.sheet=!0),b},getAddToText:function(){var a=f.getActiveCell();return e.isInEditMode()?a?"library.addtoVisualization":"library.addtosheet":null},addItemToSheetOrVisualization:function(a){if(this.isAddToMode()){var b=f.getActiveCell(),c={item:a};b&&(c.cell=b),d.publish("/ui/library/addToSheet",c)}},librarySearchFn:function(a,c,d){return c&&""!==c?(d=d?d:function(a,c){return b.match([a.name],c)})(a,c.toLowerCase()):!0},libraryMultiSearch:function(a,c,d){if(a.match={},!c||""===c)return!0;c=c.toLowerCase();for(var e=!1,f=0;f<d.length;++f){var g=d[f];b.match(a[g],c)&&(e=!0,a.match[g]=!0)}return e},itemDblClickHandler:function(a){this.isAddToSheetMode()&&d.publish("/ui/library/addToSheet",{item:a})},removeDialog:g,editDialog:g,hasLinks:function(a,b){return b.get(a).then(function(a){return a.getLinkedObjects().then(function(a){return 0!==a.length})})},toggleSelection:function(b,c){var d=a(c.currentTarget);return b.selected=!b.selected,b.selected?(d.on("qv-outside",function(c){var e=a(c.target);1!==e.closest("#library-preview").length&&1!==e.closest(".qv-contextmenu").length&&(b.selected=!1,d.off("qv-outside"))}),!0):(d.off("qv-outside"),!1)},removeSelection:function(b){a.each(b,function(a,b){b.selected=!1})},localeOrderBy:function(a,b){if(a){var c=function(a,b){return a.localeCompare(b)};b&&b instanceof Function&&(c=function(a,c){return b(a).localeCompare(b(c))}),a.sort(c)}return a},isAddToSheetMode:function(){return e.isInEditMode()&&e.view===e.Views.sheet&&e.model.layout.permissions.update},isAddToVisualizationMode:function(){return e.isInEditMode()&&(e.view===e.Views.object&&e.model.layout.permissions.update||e.view===e.Views.masterObject)},isAddToMode:function(){return this.isAddToSheetMode()||this.isAddToVisualizationMode()},permissionToCreate:h};return j}),define("text!client.views/global-selections/directives/scroll/scroll.ng.html",[],function(){return'<div class="qv-gs-scroll-container">\r\n	<qv-scroll-area class="qv-gs-scroll-area">\r\n		<div ng-if="scrollApi.loadPrevious" class="qv-gs-scroll-btn qv-gs-scroll-btn-previous" tid="globalSelections.loadPrevious">\r\n			<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true"></qv-scroll-load-button>\r\n		</div>\r\n		<div ng-repeat="item in items" class="qv-gs-listbox">\r\n			<p ng-if="item.qField" q-title-translation="Common.Field" tid="globalSelections.fieldIndicator" class="qv-gs-field-indicator">-</p>\r\n			<qv-gs-badge></qv-gs-badge>\r\n			<qv-object ng-if="item.visible" model="item.model" options="item.options" object="item.object" class="qv-object-listbox" id="{{item.id}}"></qv-object>\r\n			<div ng-if="!item.visible" class="qv-object qv-object-listbox qv-gs-placeholder" id="{{item.id}}">\r\n				<h1 class="qv-object-title">{{item.title}}</h1>\r\n				<div class="progress">\r\n					<qv-rain></qv-rain>\r\n				</div>\r\n			</div>\r\n		</div>\r\n		<div ng-if="scrollApi.loadNext" class="qv-gs-scroll-btn" tid="globalSelections.loadNext">\r\n			<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n		</div>\r\n	</qv-scroll-area>\r\n	<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\r\n</div>\r\n'}),define("general.scroll/api/dom-api",["core.utils/class","touche"],function(a,b){"use strict";function c(){return".grid-object-dom-api-"+ ++e}var d,e=0;return d=a.extend({init:function(a,b,d,e,f){f=f||".scroll-content",this.$element=a,this.$scrollArea=b,this.$scrollContent=b.find(f),this.firstRowSelector=d,this.lastRowSelector=e,this.namespace=c()},destroy:function(){this.unbindNativeScroll()},bindNativeScroll:function(a){this.$scrollArea.on("scroll"+this.namespace,a)},unbindNativeScroll:function(){this.$scrollArea.off(this.namespace)},resetNativeScroll:function(){this.$scrollArea.scrollTop(0)},preventNativeScroll:function(){var a="mousewheel"+this.namespace+" DOMMouseScroll"+this.namespace+" mousemove"+this.namespace;return this.$scrollArea.on(a,function(a){a.preventDefault()}),b(this.$scrollArea[0]).tap({id:this.namespace}),function(){this.$scrollArea.off(a),b(this.$scrollArea[0]).off("tap",this.namespace)}.bind(this)},getBoundingBox:function(){return this.$element[0].getBoundingClientRect()},getClientWidth:function(){return this.$element[0].clientWidth},getClientHeight:function(){return this.$element[0].clientHeight},getScrollAreaBoundingBox:function(){return this.$scrollArea[0].getBoundingClientRect()},getScrollAreaClientWidth:function(){return this.$scrollArea[0].clientWidth},getScrollAreaClientHeight:function(){return this.$scrollArea[0].clientHeight},getScrollAreaOffsetTop:function(){return this.$scrollArea[0].offsetTop},getScrollContentBoundingBox:function(){return this.$scrollContent[0].getBoundingClientRect()},getFirstRow:function(){return this.$scrollArea.find(this.firstRowSelector)},getLastRow:function(){return this.$scrollArea.find(this.lastRowSelector)},alignToFirstRow:function(){var a=this.getFirstRow(),b=48;return function(){var c=a.position().top-b;this.$scrollArea.scrollTop(c)}.bind(this)},alignToLastRow:function(){var a=this.getLastRow(),b=48;return function(){this.$scrollArea.scrollTop(0);var c=a.position().top-this.getScrollAreaBoundingBox().height+a[0].getBoundingClientRect().height+b;this.$scrollArea.scrollTop(c)}.bind(this)}})}),define("general.scroll/api/data-api",["core.utils/deferred","core.utils/class"],function(a,b){"use strict";var c;return c=b.extend({getRowCount:function(){return 0},getFirstElementIndex:function(){return-1},getLastElementIndex:function(){return-1},getIndexOf:function(a){return a.getIndex()},onVirtualScroll:function(){return a.resolve()},onGotoNextBlock:function(){return a.resolve()},onGotoPreviousBlock:function(){return a.resolve()},onInitialNativeScroll:function(){return a.resolve()}})}),define("general.scroll/scroll-area-service",["qvangular"],function(a){"use strict";a.service("qvScrollAreaService",function(){return{createScrollbar:function(){return{vLength:0,vViewportLength:0,vPos:0,vPage:0,thumb:{},style:{},classList:[],enabled:!1,getScrollDelta:function(a){var b=0,c=0;if(!this.enabled)return[0,0];switch(this.direction){case"vertical":c=a.swipe.curDeltaY*(1/this.scaleFactor);break;case"horizontal":b=a.swipe.curDeltaX*(1/this.scaleFactor);break;default:throw"not implemented"}return[b,c]},active:!1}},setScrollbarData:function(a,b,c,d,e,f){var g,h=3;switch(b){case"vertical":g=f.height;break;case"horizontal":g=f.width;break;default:throw"not implemented"}if(a.enabled=d>e&&g>0,a.enabled)switch(g-=2*h,a.uiOffset=h,a.direction=b,a.vLength=d,a.vViewportLength=e,a.vPos=0,a.vPage=g,a.length=g,a.trackSize=c,a.scaleFactor=g/d,a.thumb.pos=0,a.thumb.size=0,a.thumb.vPos=0,a.showMinAffordance=!1,a.showMaxAffordance=!0,a.direction){case"vertical":a.style.top=f.top+a.uiOffset+"px",a.style.width=c+"px",a.style.left=f.left+f.width-c-a.uiOffset+"px",a.style.height=f.height-2*a.uiOffset+"px";break;case"horizontal":a.style.height=c+"px",a.style.top=f.top+f.height-c-a.uiOffset+"px",a.style.left=f.left+a.uiOffset+"px",a.style.width=f.width-2*a.uiOffset+"px";break;default:throw"not implemented"}},setVirtualScrollPos:function(a,b,c){var d=0,e=b.vLength-b.vViewportLength,f=0,g=b.thumb.vPos;return b.enabled?(b.vPos+=a,b.showMinAffordance=!1,b.showMaxAffordance=!1,b.vPos<d?(g=d,b.vPos=c?b.vPos:d,b.showMaxAffordance=!0):b.vPos>e?(g=e,b.vPos=c?b.vPos:e,b.showMinAffordance=!0):(b.vPos!==d&&(b.showMinAffordance=!0),b.vPos!==e&&(b.showMaxAffordance=!0),g=b.vPos),f=g-b.thumb.vPos,b.thumb.vPos=g,f):0},setThumbStyle:function(a,b){var c=b.thumb,d=12,e=b.scaleFactor,f=Math.round(c.vPos*e),g=Math.round(b.vViewportLength*e);switch(d>g&&(f-=Math.round((d-g)/2),g=d),f=Math.max(f,0),f+g>b.length&&(f=b.length-g),c.size=g,c.pos=f,b.direction){case"vertical":a.top=f+"px",a.height=g+"px";break;case"horizontal":a.left=f+"px",a.width=g+"px";break;default:throw"not implemented"}},setTrackHitAreaStyle:function(a,b,c){"vertical"===b.direction?(a.right=-b.uiOffset+"px",a.width=c+b.uiOffset+"px"):(a.bottom=-b.uiOffset+"px",a.height=c+b.uiOffset+"px")}}})}),define("general.scroll/scroll-area-controller",["general.utils/support","general.scroll/scroll-area-service"],function(a){"use strict";var b=["$scope","$element","$timeout","qvScrollAreaService",function(b,c,d,e){var f,g,h,i,j=[],k=[],l=[];b.interactive=!1,b.virtualSize={width:0,height:0},b.virtualViewport={width:0,height:0},b.scrollbarX=e.createScrollbar(),b.scrollbarY=e.createScrollbar(),b.viewportRect={top:0,left:0,width:0,height:0},b.hover=!1,b.isMouse=!0,b.$on("$destroy",function(){clearTimeout(h),clearTimeout(i)}),this.setMouse=function(a){b.isMouse=a},this.getScrollAreaRect=function(){var a=c[0].getBoundingClientRect();return{top:0,left:0,width:Math.ceil(a.width),height:Math.ceil(a.height)}},this.addScrollbarXCtrl=function(a){f=a},this.addScrollbarYCtrl=function(a){g=a},this.allowFade=function(){return(void 0===f||f.allowFade())&&(void 0===g||g.allowFade())},this.toggleFadeScrollbars=function(a){clearTimeout(i),clearTimeout(h),(a||this.allowFade())&&(h=setTimeout(function(){var b=a?"fadeIn":"fadeOut";f&&f[b](),g&&g[b]()},a?0:800))},this.fadeInScrollbars=function(){this.toggleFadeScrollbars(!0)},this.fadeOutScrollbars=function(){a.treatAsDesktop()&&b.hover||this.toggleFadeScrollbars(!1)},this.fadeOutScrollbarsDelayed=function(){clearTimeout(i),i=setTimeout(function(){this.toggleFadeScrollbars(!1)}.bind(this),1e3)},this.setNonMouseTrackSize=function(){"object"==typeof b.nonMouseViewportScrolling&&(c.addClass(b.nonMouseViewportScrolling.className),this.setTrackSize(b.nonMouseViewportScrolling.scrollbarSize))},this.setMouseTrackSize=function(){"object"==typeof b.nonMouseViewportScrolling&&c.removeClass(b.nonMouseViewportScrolling.className),this.setTrackSize(b.scrollbarSize)},this.setTrackSize=function(a){var c=this.getVirtualPosition();this.setVirtualSize(b.virtualSize,b.virtualViewport,b.viewportRect,a),this.setVirtualScrollPos(c.vPosX,c.vPosY)},this.setupScrollbars=function(a){a=a||8,e.setScrollbarData(b.scrollbarY,"vertical",a,b.virtualSize.height,b.virtualViewport.height,b.viewportRect),e.setScrollbarData(b.scrollbarX,"horizontal",a,b.virtualSize.width,b.virtualViewport.width,b.viewportRect),b.scrollbarX.enabled&&b.scrollbarY.enabled&&(b.scrollbarX.length-=a,b.scrollbarX.scaleFactor=b.scrollbarX.length/b.virtualSize.width,b.scrollbarX.style.width=b.viewportRect.width-a-2*b.scrollbarX.uiOffset+"px",b.scrollbarY.length-=a,b.scrollbarY.scaleFactor=b.scrollbarY.length/b.virtualSize.height,b.scrollbarY.style.height=b.viewportRect.height-a-2*b.scrollbarY.uiOffset+"px")},this.setVirtualSize=function(a,c,d,e){b.viewportRect=d,b.virtualSize.width=a.width,b.virtualSize.height=a.height,b.virtualViewport.width=c.width,b.virtualViewport.height=c.height,this.setupScrollbars(e)},this.setViewport=function(a){b.viewportRect=a},this.setVirtualViewport=function(a){var c=this.getVirtualPosition();b.virtualViewport.width=a.width,b.virtualViewport.height=a.height,b.scrollbarX.vViewportLength=a.width,b.scrollbarY.vViewportLength=a.height,this.setupScrollbars(b.isMouse?b.scrollbarSize:b.nonMouseViewportScrolling.scrollbarSize),this.setVirtualScrollPos(c.vPosX,c.vPosY)},this.getVirtualSize=function(){return{width:b.virtualSize.width,height:b.virtualSize.height}},this.getVirtualPosition=function(){var a=0,c=this.getMaxPosition();return{vPosX:Math.max(a,Math.min(c.vPosX,b.scrollbarX.vPos)),vPosY:Math.max(a,Math.min(c.vPosY,b.scrollbarY.vPos))}},this.getMaxPosition=function(){var a=0,c=Math.max(a,b.scrollbarX.vLength-b.scrollbarX.vViewportLength),d=Math.max(a,b.scrollbarY.vLength-b.scrollbarY.vViewportLength);return{vPosX:c,vPosY:d}},this.isMouseOver=function(){return b.hover},this.resetScroll=function(){void 0!==b.scrollbarX.vPos&&void 0!==b.scrollbarY.vPos&&(0!==b.scrollbarX.vPos||0!==b.scrollbarY.vPos)&&this.scroll(-b.scrollbarX.vPos,-b.scrollbarY.vPos,!0,!1)},this.setVirtualScrollPos=function(a,c,d){e.setVirtualScrollPos(a,b.scrollbarX,d),e.setVirtualScrollPos(c,b.scrollbarY,d)},this.scroll=function(a,c,d,f){var g,h;g=e.setVirtualScrollPos(a,b.scrollbarX,f),h=e.setVirtualScrollPos(c,b.scrollbarY,f),(0!==g||0!==h||d)&&j.forEach(function(a){a(g,h)})},this.getScrollAmount=function(a,b,c){switch(c){default:return{deltaX:a,deltaY:b}}},this.scrollStart=function(){k.forEach(function(a){a()})},this.scrollEnd=function(){l.forEach(function(a){a()})},this.onScroll=function(a){j.push(a)},this.onScrollStart=function(a){k.push(a)},this.onScrollEnd=function(a){l.push(a)},this.on=function(){b.off=b.on(),b.interactive=!0},this.off=function(){b.off&&(b.off(),b.interactive=!1)},this.isVerticalScrollEnabled=function(){return b.scrollbarY.enabled},this.digest=function(){b.$parent.$digest()}}];return b}),define("general.scroll/loader/loader",["qvangular","core.utils/deferred"],function(a,b){"use strict";a.directive("qvScrollLoader",["$animate","$timeout",function(a,c){return{restrict:"E",replace:!0,template:function(a,b){var c=b.tag||"div";return"<"+c+' ng-style="loaderStyle" class="qv-scroll-loader qv-animate"><qv-rain ng-if="showRain" show="showRain"></qv-rain></'+c+">"},scope:{},controller:function(){},link:function(d,e,f,g){function h(a,b){d.loaderStyle.top=a,d.loaderStyle.width=b.width,d.loaderStyle.height=b.height}var i,j=!!f.noRain;d.loaderStyle={width:0,height:0},d.showRain=!1,g.fadeIn=function(f,g){var k=b();return h(f,g),j||(i=c(function(){d.showRain=!0})),a.addClass(e,"fade",function(){k.resolve()}),k.promise},g.fadeOut=function(){var c=b();return d.showRain=!1,a.removeClass(e,"fade",function(){d.loaderStyle.width=0,d.loaderStyle.height=0,d.$digest(),c.resolve()}),c.promise},d.$on("$destroy",function(){c.cancel(i)})}}}])}),define("text!general.scroll/loader/load-button.ng.html",[],function(){return'<div class="qv-scroll-data-load-buttons" ng-class="{ previous: previous }">\r\n	<div ng-transclude></div>\r\n	<button class="qui-outlinebutton" qva-activate="load()">\r\n		<p q-translation="{{text}}"></p>\r\n	</button>\r\n</div>'}),define("general.scroll/loader/load-button",["qvangular","text!./load-button.ng.html"],function(a,b){"use strict";a.directive("qvScrollLoadButton",[function(){return{restrict:"E",transclude:!0,replace:!0,template:function(a,c){var d=c.tag||"div";return b.replace(/^\s*<div/,"<"+d).replace(/<\/div>\s*$/,"</"+d+">")},scope:{onLoad:"&",text:"@",previous:"="},link:function(a){a.load=function(){a.onLoad()}}}}])}),define("text!general.scroll/scroll-area.ng.html",[],function(){return'<div>\r\n	<div class="scroll-content" ng-transclude></div>\r\n	<qv-scroll-area-affordance x-show="scrollbarY.showMinAffordance" x-direction="\'vertical\'" x-dock="\'min\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scroll-area-affordance x-show="scrollbarX.showMinAffordance" x-direction="\'horizontal\'" x-dock="\'min\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scrollbar x-data="scrollbarY" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarY.enabled"></qv-scrollbar>\r\n	<qv-scrollbar x-data="scrollbarX" x-interactive="interactive" x-viewport-rect="viewportRect" ng-if="scrollbarX.enabled"></qv-scrollbar>\r\n	<qv-scroll-area-affordance x-show="scrollbarY.showMaxAffordance" x-direction="\'vertical\'" x-dock="\'max\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n	<qv-scroll-area-affordance x-show="scrollbarX.showMaxAffordance" x-direction="\'horizontal\'" x-dock="\'max\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\r\n</div>\r\n';
}),define("text!general.scroll/scrollbar.ng.html",[],function(){return'<div class="scrollbar-animation scrollbar-track"\r\n	ng-class="data.classList"\r\n	ng-style="data.style">\r\n	<qv-scrollbar-track-hit-area ng-style="trackHitAreaStyle" class="scrollbar-hitarea"></qv-scrollbar-track-hit-area>\r\n	<qv-scrollbar-thumb ng-class="{ active: data.active }" class="scrollbar-thumb" ng-style="thumbStyle"></qv-scrollbar-thumb>\r\n</div>\r\n'}),define("general.scroll/mouse-wheel-service",["qvangular"],function(a){"use strict";var b="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";a.service("qvMouseWheelService",function(){return{getEventName:function(){return b},getMouseWheelData:function(a){var c=1,d=0,e=0,f=0,g=40;return"wheel"===b?a:("MozMousePixelScroll"===a.type&&(c=0),a.wheelDelta&&(d=-a.wheelDelta/g),a.detail&&(d=-a.detail/3),f=d,void 0!==a.axis&&a.axis===a.HORIZONTAL_AXIS&&(f=0,e=-1*d),void 0!==a.wheelDeltaY&&(f=-1*a.wheelDeltaY/g),void 0!==a.wheelDeltaX&&(e=-1*a.wheelDeltaX/g),{deltaMode:c,delta:d,deltaX:e,deltaY:f,x:a.pageX,y:a.pageY})}}})}),define("general.scroll/scroll-area-affordance",["qvangular"],function(a){"use strict";a.directive("qvScrollAreaAffordance",function(){return{restrict:"E",template:'<div ng-show="show" class="scroll-affordance" ng-class="[dock,direction]" ng-style="style"></div>',replace:!0,require:"^qvScrollArea",scope:{viewportRect:"=",direction:"=",dock:"=",size:"=?",show:"="},link:function(a){a.size=a.size||18,a.style={},a.updateAffordance=function(){switch(a.direction){case"vertical":switch(a.style.width=a.viewportRect.width+"px",a.style.height=a.size+"px",a.dock){case"min":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+"px";break;case"max":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+a.viewportRect.height-a.size+"px";break;default:throw"Dock "+a.dock+" not supported"}break;case"horizontal":switch(a.style.width=a.size+"px",a.style.height=a.viewportRect.height+"px",a.dock){case"min":a.style.left=a.viewportRect.left+"px",a.style.top=a.viewportRect.top+"px";break;case"max":a.style.left=a.viewportRect.left+a.viewportRect.width-a.size+"px",a.style.top=a.viewportRect.top+"px";break;default:throw"Dock "+a.dock+" not supported"}break;default:throw"Direction "+a.direction+" not supported"}},a.$watch("viewportRect",a.updateAffordance,!0)}}})}),define("general.scroll/scroll-area",["jquery","qvangular","general.scroll/scroll-area-controller","text!./scroll-area.ng.html","text!./scrollbar.ng.html","touche","general.utils/support","general.scroll/scroll-area-service","general.scroll/mouse-wheel-service","general.scroll/scroll-area-affordance"],function(a,b,c,d,e,f,g){"use strict";b.directive("qvScrollArea",["$document","$timeout","qvScrollAreaService","qvMouseWheelService",function(b,e,h,i){return{restrict:"E",transclude:!0,template:d,replace:!0,scope:{scrollbarSize:"=?",nonMouseViewportScrolling:"=?"},require:"qvScrollArea",controller:c,link:function(c,d,e,h){function j(a,b){var d=c.viewportRect.left,e=c.viewportRect.top,f=c.viewportRect.left+c.viewportRect.width,g=c.viewportRect.top+c.viewportRect.height;return a>=d&&f>=a&&b>=e&&g>=b}function k(){d.off(c.namespace),b.off(c.namespace),f(d[0]).off("*",c.namespace)}"number"!=typeof c.scrollbarSize&&(c.scrollbarSize=8),c.$watch("scrollbarX.enabled",function(a){a===!0&&d.css("overflow-x","hidden")}),c.$watch("scrollbarY.enabled",function(a){a===!0&&d.css("overflow-y","hidden")}),c.namespace=".scroll-area-"+c.$id,c.on=function(){return d.on(i.getEventName()+c.namespace,function(a){var b,c=i.getMouseWheelData(a.originalEvent);b=h.getScrollAmount(c.deltaX,c.deltaY,c.deltaMode),h.scroll(b.deltaX,b.deltaY,!1,!1),g.treatAsDesktop()||(h.setMouseTrackSize(),h.fadeInScrollbars(),h.fadeOutScrollbarsDelayed()),h.digest()}),b.on("keydown"+c.namespace,function(b){var d,e,f=0,g=0,i=a(b.target),j=i.is("input")||i.is("textarea");if(c.hover&&!j){switch(b.keyCode){case 33:g=1,d=2;break;case 34:g=-1,d=2;break;case 36:g=1,d=10;break;case 35:g=-1,d=10;break;case 38:g=1,d=1;break;case 40:g=-1,d=1;break;case 39:f=-1,d=1;break;case 37:f=1,d=1;break;default:return}e=h.getScrollAmount(f,g,d),h.scroll(-e.deltaX,-e.deltaY,!1,!1),h.digest()}}),d.on((g.treatAsDesktop()?"mouseenter":"pointerenter")+c.namespace,function(a){c.isMouse=g.isMouse(a.originalEvent),c.isMouse?(c.hover=!0,g.treatAsDesktop()&&(h.setMouseTrackSize(),h.fadeInScrollbars()),h.digest()):a.preventDefault()}),d.on((g.treatAsDesktop()?"mouseleave":"pointerleave")+c.namespace,function(a){c.isMouse=g.isMouse(a.originalEvent),c.isMouse&&(c.hover=!1,g.treatAsDesktop()&&h.fadeOutScrollbars())}),"object"==typeof c.nonMouseViewportScrolling&&("number"!=typeof c.nonMouseViewportScrolling.scrollbarSize&&(c.nonMouseViewportScrolling.scrollbarSize=36),"string"!=typeof c.nonMouseViewportScrolling.className&&(c.nonMouseViewportScrolling.className="show-non-mouse-scrollbars"),f(d[0]).swipe({id:c.namespace,options:{radiusThreshold:0,useMomentum:!0,inertia:.7},start:function(a,b){return g.isMouse(a)?void this.cancel():j(b.pagePoints[0].x-this.rect.x,b.pagePoints[0].y-this.rect.y)?(h.setMouse(!1),h.setNonMouseTrackSize(),h.scrollStart(),h.fadeInScrollbars(),void h.digest()):void this.cancel()},update:function(a,b){var d=c.scrollbarX.getScrollDelta(b)[0],e=c.scrollbarY.getScrollDelta(b)[1];h.scroll(-1*d,-1*e,!1,!0),h.digest()},end:function(){h.scrollEnd(),h.fadeOutScrollbars(),h.digest()}})),k},c.$on("$destroy",function(){k()})}}}]),b.directive("qvScrollbar",["qvScrollAreaService",function(a){return{restrict:"E",require:["^qvScrollArea","qvScrollbar"],scope:{data:"=",interactive:"=",viewportRect:"="},template:e,replace:!0,controller:function(){},link:function(b,c,d,e){function f(a){c[a?"addClass":"removeClass"]("fade")}var h=e[0],i=e[1];"vertical"===b.data.direction?(b.data.classList.push("vertical"),h.addScrollbarYCtrl(i)):(b.data.classList.push("horizontal"),h.addScrollbarXCtrl(i)),i.allowFade=function(){return!b.data.active},i.fadeIn=function(){return f(!0)},i.fadeOut=function(){return f(!1)},b.thumbStyle={},b.$watch("data.thumb",function(){a.setThumbStyle(b.thumbStyle,b.data)},!0),b.$watch("data.vPage",function(){a.setThumbStyle(b.thumbStyle,b.data)}),b.$watch("data.vLength",function(){a.setThumbStyle(b.thumbStyle,b.data)}),b.$watch("data.enabled",function(a){h.isMouseOver()&&a&&i.fadeIn()}),b.setThumbStyle=a.setThumbStyle.bind(null,b.thumbStyle,b.data),b.trackHitAreaStyle={},b.$watch("data.trackSize",function(c){void 0!==c&&a.setTrackHitAreaStyle(b.trackHitAreaStyle,b.data,c)}),b.start=function(a){h.setMouse(a),b.data.active||g.treatAsDesktop()||(a?h.setMouseTrackSize():h.setNonMouseTrackSize(),h.fadeInScrollbars()),b.data.active=!0,h.scrollStart()},b.update=function(a,b){h.scroll(a,b,!1,!0)},b.end=function(a){var c=b.data,d=0,e=c.vLength-c.vViewportLength;c.vPos<d?c.vPos=d:c.vPos>e&&(c.vPos=e),b.data.active=!1,h.scrollEnd(),a?h.fadeOutScrollbarsDelayed():h.fadeOutScrollbars()},b.on=function(){return b.hitAreaOff=b.hitAreaOn(),b.thumbOff=b.thumbOn(),function(){b.hitAreaOff(),b.thumbOff()}},b.$watch("interactive",function(a){a?b.off=b.on():b.off&&b.off()})}}}]),b.directive("qvScrollbarThumb",[function(){return{restrict:"E",template:"<div></div>",replace:!0,require:"^qvScrollArea",link:function(a,b,c,d){a.thumbOn=function(){return f(b[0]).tap({start:function(b){f.preventGestures(this.gestureHandler),a.start(g.isMouse(b)),d.digest()}}).swipe({options:{radiusThreshold:0},update:function(b,c){a.update.apply(a,a.data.getScrollDelta(c)),d.digest()},end:function(){a.end(),d.digest()}}),function(){f(b[0]).off()}},a.$on("$destroy",function(){f(b[0]).off()})}}}]),b.directive("qvScrollbarTrackHitArea",[function(){return{restrict:"E",replace:!0,template:"<div></div>",require:"^qvScrollArea",link:function(a,b,c,d){function e(b,c){var e,f,g,h,i,j=a.data.thumb.size,k=a.data.thumb.pos,l=0,m=0;switch(a.data.direction){case"vertical":f=b.pagePoints[0].y-c.y<k,g=b.pagePoints[0].y-c.y>k+j,g?(e=d.getScrollAmount(-1,-1,2),l=0,m=-e.deltaY):f&&(e=d.getScrollAmount(1,1,2),l=0,m=-e.deltaY);break;case"horizontal":h=b.pagePoints[0].x-c.x<k,i=b.pagePoints[0].x-c.x>k+j,h?(e=d.getScrollAmount(1,1,2),l=-e.deltaX,m=0):i&&(e=d.getScrollAmount(-1,-1,2),l=-e.deltaX,m=0)}d.scroll(l,m)}function h(b,c){switch(a.data.direction){case"vertical":a.update(0,(b.pagePoints[0].y-c.y-(a.data.thumb.pos+a.data.thumb.size/2))*(1/a.data.scaleFactor));break;case"horizontal":a.update((b.pagePoints[0].x-c.x-(a.data.thumb.pos+a.data.thumb.size/2))*(1/a.data.scaleFactor),0);break;default:throw"not implemented"}}a.hitAreaOn=function(){return f(b[0]).tap({start:function(b,c){f.preventGestures(this.gestureHandler),a.start(g.isMouse(b)),a.setThumbStyle(),g.isMouse(b)?e(c,this.rect):h(c,this.rect),d.digest()},end:function(){a.end(!0),d.digest()}}).swipe({options:{radiusThreshold:0},start:function(b,c){return g.isMouse(b)?void this.cancel():(a.update.apply(a,a.data.getScrollDelta(c)),void d.digest())},update:function(b,c){a.update.apply(a,a.data.getScrollDelta(c)),d.digest()},end:function(){a.end(!0),d.digest()}}),function(){f(b[0]).off()}},a.$on("$destroy",function(){f(b[0]).off()})}}}])}),define("general.scroll/api/vertical-scroll-api",["core.utils/class","core.utils/notification","util","general.utils/support","general.scroll/api/dom-api","general.scroll/api/data-api","general.scroll/scroll-area-controller","general.scroll/loader/loader","general.scroll/loader/load-button","general.scroll/scroll-area"],function(a,b,c,d,e,f,g){"use strict";var h;return h=a.extend({destroy:function(){this.$timeout.cancel(this.initPromise),this.$timeout.cancel(this.setVirtualSizePromise),this.unpreventNativeScroll&&this.unpreventNativeScroll(),this.domApi.destroy()},init:function(a,e){b.create(this,"Scroll"),this.$timeout=a,this.initPromise=null,this.setVirtualSizePromise=null,void 0!==e.virtualScrollEnabled?this.virtualScrollEnabled=e.virtualScrollEnabled:this.virtualScrollEnabled=d.treatAsDesktop(),this.loaderStyle={width:0,height:0},this.totalRows=0,this.totalColumns=0,this.alignBottom=!1,this.alignRight=!1,this.ignoreScroll=!1,this.loadNext=!1,this.loadPrevious=!1,this.settings=c.extend(!0,{minRowHeight:21,minColumnWidth:30,viewportRowCount:0,viewportColumnCount:0,width:0,height:0,blockSize:100,keepItemsCount:10},e)},initialize:function(a,b,c,d){if(!(a instanceof e))throw"Must provide an instance of domApi";if(!(b instanceof f))throw"Must provide an instance of dataApi";if(!(c instanceof g[4]))throw"Must provide an instance of ScrollAreaController";if(!d||"function"!=typeof d.fadeIn||"function"!=typeof d.fadeOut)throw"Must provide valid loader api";return this.initPromise?this.initPromise:(this.domApi=a,this.dataApi=b,this.virtualScrollApi=c,this.loaderApi=d,this.initPromise=this.$timeout(function(){this.onInit(),this.onInitVirtualScroll(),this.bindNativeScroll()}.bind(this)),this.initPromise)},onInit:function(){this.updateViewport()},onInitVirtualScroll:function(){this.virtualScrollApi.onScroll(this.onVirtualScroll.bind(this)),this.virtualScrollApi.getScrollAmount=this.getVirtualScrollAmount.bind(this)},bindNativeScroll:function(){this.domApi.bindNativeScroll(this.onNativeScroll.bind(this))},activate:function(){this.virtualScrollEnabled&&this.virtualScrollApi.on(),this.unpreventNativeScroll&&(this.unpreventNativeScroll(),this.unpreventNativeScroll=null)},deactivate:function(){this.unpreventNativeScroll=this.domApi.preventNativeScroll(),this.virtualScrollApi.off()},updateViewport:function(){var a=this.domApi.getBoundingBox();this.settings.width=a.width,this.settings.height=a.height,this.settings.viewportRowCount=Math.ceil(this.settings.height/this.settings.minRowHeight),this.settings.viewportColumnCount=Math.ceil(this.settings.width/this.settings.minColumnWidth)},setTotalRows:function(a){this.totalRows=a},setTotalColumns:function(a){this.totalColumns=a},getSpliceArgs:function(){var a=this.dataApi.getRowCount(),b=this.settings.viewportRowCount,c=this.settings.keepItemsCount,d=a-b-c;return[0,d]},onSetVirtualSize:function(a){var b,c,d,e=this.domApi.getScrollAreaBoundingBox(),f=this.virtualScrollApi.getVirtualPosition(),g=this.settings.minColumnWidth*this.totalColumns,h=this.settings.minRowHeight*this.totalRows;this.dataApi.getRowCount()===this.totalRows&&(h=this.domApi.getScrollContentBoundingBox().height),b={width:g,height:h},c={width:e.width,height:e.height},d={top:0,left:0,width:e.width,height:e.height},this.virtualScrollApi.setVirtualSize(b,c,d),a&&this.virtualScrollApi.scroll(f.vPosX,f.vPosY,!0)},setVirtualSize:function(a){if(this.virtualScrollEnabled){var b=this.setVirtualSizePromise=this.$timeout(function(){this.onSetVirtualSize(a),this.updateAlignBottom()}.bind(this));return b}},getVirtualScrollAmount:function(a,b,c){var d=this.virtualScrollApi.getVirtualPosition(),e=this.virtualScrollApi.getMaxPosition();if(this.alignBottom&&0>b)return{deltaX:a,deltaY:b};switch(c){case 1:return{deltaX:0,deltaY:this.settings.minRowHeight*b};case 2:return{deltaX:0,deltaY:this.settings.viewportRowCount*this.settings.minRowHeight*b};case 10:return{deltaX:0,deltaY:b>0?d.vPosY*b:d.vPosY-e.vPosY};default:return{deltaX:a,deltaY:b}}},onVirtualScroll:function(a,b){this.Scroll.emit();var c=this.virtualScrollApi.getVirtualPosition(),d=Math.floor(c.vPosY/this.settings.minRowHeight),e=this.settings.viewportRowCount,f=Math.floor(c.vPosX/this.settings.minColumnWidth),g=this.settings.viewportColumnCount;return d>0&&d+e>this.totalRows&&(d=Math.max(0,this.totalRows-e),e=Math.min(this.totalRows,e)),this.dataApi.onVirtualScroll(d,e,f,g,a,b).then(function(){this.updateAlignBottom(),this.updateAlignRight()}.bind(this))},updateAlignBottom:function(){var a=this.virtualScrollApi.getVirtualPosition(),b=this.virtualScrollApi.getMaxPosition();this.virtualScrollApi.isVerticalScrollEnabled()&&a.vPosY===b.vPosY?this.alignBottom=!0:this.alignBottom=!1},updateAlignRight:function(){var a=this.virtualScrollApi.getVirtualPosition(),b=this.virtualScrollApi.getMaxPosition();this.virtualScrollApi.isVerticalScrollEnabled()&&a.vPosX===b.vPosX?this.alignRight=!0:this.alignRight=!1},updateLoadingButtons:function(){var a=this.dataApi.getFirstElementIndex(),b=this.dataApi.getRowCount();a+b>=this.totalRows||0===this.totalRows||0>a?this.loadNext=!1:this.loadNext=!0,a>0?this.loadPrevious=!0:this.loadPrevious=!1},resetNativeScroll:function(){return this.ignoreScroll=!0,this.loadNext=!1,this.loadPrevious=!1,this.domApi.resetNativeScroll(),function(){this.ignoreScroll=!1}.bind(this)},onNativeScroll:function(){if(this.Scroll.emit(),!this.ignoreScroll){var a=this.dataApi.getLastElementIndex()+1,b=this.settings.blockSize-a;this.ignoreScroll=!0,this.dataApi.onInitialNativeScroll(a,b).then(function(){this.updateLoadingButtons()}.bind(this))}},gotoNextBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var a=this.domApi.alignToLastRow(),b=this.dataApi.getLastElementIndex()+1,c=this.settings.blockSize-this.settings.keepItemsCount;this.dataApi.onGotoNextBlock(b,c).then(function(){this.updateLoadingButtons(),this.$timeout(function(){a(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))},gotoPreviousBlock:function(){this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),this.domApi.getScrollAreaBoundingBox()).then(function(){var a=this.domApi.alignToFirstRow(),b=this.settings.blockSize-this.settings.keepItemsCount,c=this.dataApi.getFirstElementIndex()-b;0>c&&(b+=c,c=0),this.dataApi.onGotoPreviousBlock(c,b).then(function(){this.updateLoadingButtons(),this.$timeout(function(){a(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))}})}),define("general.scroll/api/simple-list-data-api",["core.utils/deferred","general.scroll/api/data-api"],function(a,b){"use strict";var c;return c=b.extend({init:function(a){this.list=[],this.scrollApi=a},getRowCount:function(){return this.scrollApi.items?this.scrollApi.items.length:0},getFirstElementIndex:function(){return this.list.indexOf(this.scrollApi.items[0])},getLastElementIndex:function(){return this.list.indexOf(this.scrollApi.items[this.scrollApi.items.length-1])},getItems:function(a,b){return this.list.slice(Math.max(0,a),a+b)},setItems:function(a,b){this.scrollApi.items=this.getItems(a,b)},setList:function(a){this.list=a,this.scrollApi.setTotalRows(this.list.length),this.scrollApi.virtualScrollEnabled?(this.setItems(0,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(!1)):(this.setItems(0,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()())},resize:function(){this.scrollApi.updateViewport();var b=this.getRowCount(),c=b>0?this.getFirstElementIndex():0;return 0!==c&&c+this.scrollApi.settings.viewportRowCount>b&&(c=Math.max(0,b-this.scrollApi.settings.viewportRowCount)),this.scrollApi.virtualScrollEnabled?(this.setItems(c,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(!0)):0===c&&b<this.scrollApi.settings.blockSize?(this.setItems(c,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()(),a.resolve()):a.resolve()},onVirtualScroll:function(b,c){return this.setItems(b,c),a.resolve()},onInitialNativeScroll:function(b,c){return this.setItems(0,b+c),a.resolve()},onGotoNextBlock:function(b,c){var d=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(b-d,c+d),a.resolve()},onGotoPreviousBlock:function(b,c){var d=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(b,c+d),a.resolve()}})}),function(a,b){"use strict";var c=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],d={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15},e=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=function(a){return h(a,!0)},g=function(a){return h(a,!1)},h=function(a,c){c===b&&(c=!0);var d=k(a)?m(a):l(a);if(c)var f=1779033703,g=3144134277,h=1013904242,n=2773480762,o=1359893119,p=2600822924,q=528734635,r=1541459225;else var f=3238371032,g=914150663,h=812702999,n=4144912697,o=4290775857,p=1750603025,q=1694076839,r=3204075428;for(var s=0,t=d.length;t>s;s+=16){for(var u,v,w=[],x=0;16>x;++x)w[x]=d[s+x];for(var x=16;64>x;++x)u=i(w[x-15],7)^i(w[x-15],18)^w[x-15]>>>3,v=i(w[x-2],17)^i(w[x-2],19)^w[x-2]>>>10,w[x]=w[x-16]+u+w[x-7]+v;for(var y,z,A,B,C=f,D=g,E=h,F=n,G=o,H=p,I=q,J=r,x=0;64>x;++x)u=i(C,2)^i(C,13)^i(C,22),y=C&D^C&E^D&E,A=u+y,v=i(G,6)^i(G,11)^i(G,25),B=G&H^~G&I,z=J+v+B+e[x]+w[x]&4294967295,J=I,I=H,H=G,G=F+z,F=E,E=D,D=C,C=z+A;f+=C,g+=D,h+=E,n+=F,o+=G,p+=H,q+=I,r+=J}var K=j(f)+j(g)+j(h)+j(n)+j(o)+j(p)+j(q);return c&&(K+=j(r)),K},i=function(a,b){return a>>>b|a<<32-b},j=function(a){for(var b="",d=0;4>d;d++){var e=3-d<<3;b+=c[a>>e+4&15]+c[a>>e&15]}return b},k=function(a){for(var b=a.length;b--;)if(a.charCodeAt(b)>255)return!0;return!1},l=function(a){var b,c=a.length,d=(c+8>>6)+1,e=d<<4,f=[];for(b=0;e>b;++b)f[b]=0;for(b=0;c>b;++b)f[b>>2]|=a.charCodeAt(b)<<(3-b%4<<3);return f[b>>2]|=128<<(3-b%4<<3),f[e-1]=c<<3,f},m=function(a){for(var b=encodeURIComponent(a),c=[],e=0,f=0,g=b.length;g>e;++e){var h=b.charCodeAt(e);37==h?c[f>>2]|=(d[b.charAt(++e)]<<4|d[b.charAt(++e)])<<(3-f%4<<3):c[f>>2]|=h<<(3-f%4<<3),++f}var i=(f+8>>6)+1,j=i<<4,k=f>>2;c[k]|=128<<(3-f%4<<3);for(var e=k+1;j>e;++e)c[e]=0;return c[j-1]=f<<3,c};window.sha256=f,window.sha224=g}(this),define("sha256",function(){}),define("assets/datamodelviewer/utils/dmv-crypto-util",["sha256"],function(){function a(a){if(void 0===a)throw new Error("String is undefined.");if(0===a.length)throw new Error("String is empty.");var b=sha256(a);return b}var b={sha256:a};return b}),define("client.views/global-selections/directives/scroll/scroll",["qvangular","text!./scroll.ng.html","core.utils/class","objects.models/listbox","core.models/app","objects.utils/data-properties/listobject-util","core.utils/resize","core.utils/deferred","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/simple-list-data-api","jquery","util","objects.utils/shapes/rect","assets/datamodelviewer/utils/dmv-crypto-util","client.views/selection-toolbar/selection-toolbar-service","general.scroll/scroll-area"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";function p(a,b){for(;a.length>b;)a.pop()}var q=k.extend({init:function(){this.resetColumnIndex(),this._super.apply(this,arguments)},resetColumnIndex:function(){this.columnIndex=0},setList:function(a){this.list=a,this.scrollApi.setTotalRows(this.list.length),this.setItems(this.columnIndex,this.scrollApi.settings.blockSize),this.scrollApi.updateLoadingButtons()},onInitialNativeScroll:function(){return h.resolve()},onGotoNextBlock:function(){var a=this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this));return a},onGotoPreviousBlock:function(){var a=this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this));return a}}),r=j.extend({resetNativeScroll:function(){this.$scrollArea.scrollLeft(0)},alignToFirstRow:function(){var a=this.getFirstRow(),b=a.children("article").attr("id"),c=260;return function(){var a,d=l(this.$scrollArea.find("#"+b));d.length>0&&(a=d.offset().left-c,this.$scrollArea.scrollLeft(a))}.bind(this)},alignToLastRow:function(){var a=this.getLastRow(),b=a.children("article").attr("id"),c=250;return function(){var a,d=l(this.$scrollArea.find("#"+b));d.length>0&&(this.$scrollArea.scrollLeft(0),a=d.parent().position().left-this.getScrollAreaBoundingBox().width+d[0].getBoundingClientRect().width+c,this.$scrollArea.scrollLeft(a))}.bind(this)},getBoundingBox:function(){var a=this._super.apply(this,arguments);return new n(a.top,a.left,a.height,a.width)}}),s=c.extend({size:{width:0,height:0},itemSize:0,itemSpacing:0,$element:void 0,init:function(a,b,c){this.$scope=a,this.$timeout=b,this.selectionToolbarService=c,this.$scope.items=[]},initialize:function(a,b,c){this.setSize(b),this.setItemSize(c.itemSize),this.setItemSpacing(c.itemSpacing),this.setElement(a.find(".qv-gs-scroll-area")),this.setItems(),this.initialized=!0},updateVisible:function(){var a=this.offsetX-(this.$scope.scrollApi.loadPrevious?1:0),b=this.visibleItemsCount;this.$scope.items.forEach(function(c,d){var e=d>=a&&a+b>d;!c.visible&&e&&(c.options={isPopOver:!1}),e&&!c.model&&this.getModel(c).then(function(a,b){a.model=b}.bind(null,c)),c.visible=e},this)},getModel:function(a){var b,c=this.getInitProps(a.title);return a.qField?b=d.createTransientField(e.current,a.qField,c):a.qId&&(b=d.createTransientDimension(e.current,a.qId,c)),b},onScroll:function(){this.selectionToolbarService.confirm(),this.updateHighlights(),this.$timeout.cancel(this.scrollTimeout),this.scrollTimeout=this.$timeout(function(){this.updateVisible(),this.updateHighlights()}.bind(this),100)},onResize:function(a){this.setSize(a),this.updateVisible()},updateHighlights:function(){this.$scope.items.forEach(function(a){a.options.highlightQuery=this.$scope.filter},this)},setItems:function(){var a,b,c,d=this.$scope,e=this.totalItemsCount;for(d.items.length!==e&&p(d.items,e),a=0;e>a;a++)b=d.items[a]||{},c=d.scrollApi.items[a],c.enableBadge&&(b.enableBadge=c.enableBadge),b.model||(b.options={isPopOver:!1}),c.qField?(delete b.qId,b.model&&b.qField===c.qField||(b.visible&&(d.items[a]=m.extend(!0,{},b),b=d.items[a],delete b.$$hashKey,delete b.options.search),b.title=c.title,b.qField=c.qField,b.id=o.sha256(b.qField),delete b.model)):c.qId&&(delete b.qField,b.model&&b.qId===c.qId||(b.visible&&(d.items[a]=m.extend(!0,{},b),b=d.items[a],delete b.$$hashKey,delete b.options.search),b.title=c.title,b.qId=c.qId,b.id=o.sha256(b.qId),delete b.model)),d.items[a]||(d.items[a]=b);this.updateVisible()},getInitProps:function(a){var b={title:a,qListObjectDef:{qDef:{}}};return f.autoSortDimension(b.qListObjectDef),b},getWidthOf:function(a){return this.totalItemSize*a-this.itemSpacing},setItemSize:function(a){this.itemSize=a||220},setItemSpacing:function(a){this.itemSpacing=a||20},setSize:function(a){this.size=a},setElement:function(a){this.$element=a,this.$element.on("scroll",this.onScroll.bind(this))}});Object.defineProperties(s.prototype,{vPosX:{get:function(){return this.$element.scrollLeft()}},totalItemSize:{get:function(){return this.itemSize+this.itemSpacing}},visibleItemsCount:{get:function(){var a=Math.ceil(((this.vPosX+(this.previousBtnVisible?240:0))%this.totalItemSize+this.size.width)/this.totalItemSize);return Math.min(a,this.totalItemsCount+(this.previousBtnVisible?1:0))}},totalItemsCount:{get:function(){return(this.$scope.scrollApi.items||[]).length}},offsetX:{get:function(){return Math.floor(this.vPosX/this.totalItemSize)}},previousBtnVisible:{get:function(){return!!this.$scope.scrollApi.loadPrevious}}}),s.$inject=["$scope","$timeout","qvSelectionToolbarService"],a.directive("qvGlobalSelectSection",["$parse","$timeout",function(a,c){return{controller:s,require:["qvGlobalSelectSection","^qvGlobalSelections"],template:b,replace:!0,scope:{allItems:"=",filter:"="},link:function(b,d,e,f){var h=f[0],j=f[1],k=a(e.qvGlobalSelectSection)(),l={},m=d.find(".qv-gs-scroll-area"),n=m.controller("qvScrollArea"),o=d.find(".qv-scroll-loader").controller("qvScrollLoader"),p={blockSize:24,minRowHeight:240,keepItemsCount:4,virtualScrollEnabled:!1},s=b.scrollApi=new i(c,p),t=new q(s),u=new r(d,m,".qv-gs-listbox:first",".qv-gs-listbox:last"),v=null,w=function(){l.width=d.innerWidth(),l.height=d.innerHeight(),h.onResize(l)};s.initialize(u,t,n,o).then(function(){s.activate(),s.updateViewport(),b.$watch("filter",function(){t.resetColumnIndex(),s.resetNativeScroll()}),b.$watch("allItems",function(a){a&&(t.setList(a),v&&v(),v=b.$watch("scrollApi.items",function(){j.ignoreUpdates||(0===s.items.length&&b.allItems.length>0&&(s.resetNativeScroll(),t.resetColumnIndex(),t.setList(a)),h.initialized&&h.setItems())}))})}),c(function(){l.width=d.innerWidth(),l.height=d.innerHeight(),h.initialize(d,l,k)}),g.on("end",w),b.$on("$destroy",function(){g.off("end",w),s.destroy()}),j.addCallback(k.type,function(){h.$timeout(function(){h.setItems(),h.$timeout(function(){h.updateHighlights()})})})}}}])}),define("text!client.views/global-selections/directives/badge/badge.ng.html",[],function(){return'<div class="qv-gs-badge" ng-if="item.showBadge" q-title-translation="Tooltip.clearSelection" tid="globalSelections.badge">\r\n	<q qva-activate="badgeClick(item)"></q>\r\n</div>\r\n'}),define("objects.backend-api/listbox-api",["./backend-api"],function(a){"use strict";var b;return b=a.extend("Listbox",{init:function(a){this._super(a,"/qListObjectDef"),this.cacheCube.setMethodName("GetListObjectData")},select:function(a,b,c){return this.model.rpc("SelectListObjectValues","qReturn",[this.path,b,c])},selectAll:function(){return this.model.rpc("SelectListObjectAll",null,[this.path])},selectPossible:function(){return this.model.rpc("SelectListObjectPossible",null,[this.path])},selectAlternative:function(){return this.model.rpc("SelectListObjectAlternative",null,[this.path])},selectExcluded:function(){return this.model.rpc("SelectListObjectExcluded",null,[this.path])},search:function(a){return this.model.rpc("SearchListObjectFor","qSuccess",[this.path,a])},abortSearch:function(){return this.model.rpc("AbortListObjectSearch",null,[this.path])},confirmSearch:function(a){return this.model.rpc("AcceptListObjectSearch",null,[this.path,a])},updateCache:function(a){this.cacheCube.set(a.qListObject.qDataPages),this.cacheCube.setCubeSize(a.qListObject.qSize)},setInitialData:function(a){this.cacheCube.set(a.qListObject.qDataPages)},getData:function(a){return this.cacheCube.getData(a)},getDataPage:function(a){return this.getData([a]).then(function(a){return a[0]})},getSize:function(){return this.model.layout.qListObject.qSize},lock:function(){return this.model.rpc("Lock",null,[this.path])},unlock:function(){return this.model.rpc("Unlock",null,[this.path])},isLocked:function(){return this.model.layout&&this.model.layout.qListObject&&this.model.layout.qListObject.qDimensionInfo.qLocked?!0:!1},getDimensionInfos:function(){return this.model.layout&&this.model.layout.qListObject?[this.model.layout.qListObject.qDimensionInfo]:[]}})}),define("client.views/global-selections/directives/badge/badge",["qvangular","text!./badge.ng.html","objects.backend-api/listbox-api"],function(a,b,c){a.directive("qvGsBadge",function(){return{restrict:"E",template:b,replace:!0,link:function(b){b.item.enableBadge&&(b.item.object||(b.item.object={}),b.$watchCollection("[item.model.layout.qListObject.qDimensionInfo.qLocked, item.object.selectionsApi.active]",function(c){a.$apply(function(){b.item.showBadge=(void 0===c[0]||c[0]===!1)&&c[1]===!1})}),b.badgeClick=function(a){var b=new c(a.model);b.beginSelections(),b.clearSelections(),b.endSelections(!0)})}}})}),define("client.views/global-selections/global-selections",["jquery","qvangular","text!./global-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.utils/support","client.assets/assets-utils","core.utils/class","general.models/field","client.assets/tab-contents/fields/assets-field-list-model","core.utils/deferred","core.models/app","core.utils/resize","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.utils/type-loader","client.views/selection-toolbar/selection-toolbar-service","client.views/global-selections/directives/scroll/scroll","client.views/global-selections/directives/badge/badge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=".globalSelections",q=h.extend({init:function(b,c){var d=this;this.$scope=b,this.$document=c,this.callbacks=[],this.ignoreUpdates=!1,this.hasLoaded=!1,b.dimensions=[],b.dimensionsFields=[],b.selectedFields=[],b.fields=[],b.dimAvailable=!1,b.showFields=!1,b.showFieldsCheckbox=!0,b.filter="",b.autoFocus=f.treatAsDesktop(),k.all({fields:this.getFields(),select:this.bindCurrentSelections(),dim:this.getLibraryDimensions(),reg:this.registerExtensions()}).then(function(){d.hasLoaded=!0,d.setupUi(d),b.$watchCollection("[filter, showFields]",function(){d.filterShown(d,d.$scope)}),a(".qv-gs-section .qv-gs-header")[1].style.display="none",a(".qv-gs-section .qv-gs-header")[1].offsetHeight,a(".qv-gs-section .qv-gs-header")[1].style.display="block"})},registerExtensions:function(){var a=new k;return o.load().then(function(){a.resolve()}),a.promise},getFields:function(){var a=this.$scope,b=new k;return i.getListLayout().then(function(c){a.fields=j.expand(c).map(function(a){return{title:a.qName,qField:a.qName,qTags:a.qTags}}),b.resolve()}),b.promise},_updateCurrentSelectionFields:function(a){var b=this,c=this.$scope;c.selectedFields=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}).map(function(a){return{title:a.qField,qField:a.qField,enableBadge:!0}}),b.hasLoaded&&b.filterShown(b,c)},handleCurrentSelectionFields:function(){var a=this;this.$scope.currentSelectionsModel.getLayout().then(function(b){a._updateCurrentSelectionFields(b)})},bindCurrentSelections:function(){var a=this.$scope,b=this;return d.get().then(function(c){return a.currentSelectionsModel=c,d.bindLayout(a,"currentSelectionsModel",function(a){l.current.isModal()||b._updateCurrentSelectionFields(a)})})},getLibraryDimensions:function(){
var a=this.isCalculatedField,b=this.$scope,c=new k;return e.getList().then(function(d){d.getLayout().then(function(d){b.dimensions=d.filter(function(b){return b.qData.info.length>0&&(b.qData.info.some(a)?!1:!0)&&"H"!==b.qData.grouping}).map(function(a){return{title:a.qData.title,fieldName:a.qData.info[0].qName,qId:a.qInfo.qId}}),c.resolve()})}),c.promise},setupUi:function(a){var b=a.$scope;b.showFieldsCheckbox=b.fields.length>0,b.dimAvailable=b.dimensions.length>0,!b.dimAvailable&&b.showFieldsCheckbox&&(b.showFields=!0)},isCalculatedField:function(a){return"="===a.qName[0]},filterShown:function(a,c){var d="",e=[];c.dimensionsFields=c.dimensions.filter(function(a){return!c.selectedFields.some(function(b){return a.fieldName===b.qField})}),c.showFields&&(e=c.fields.filter(function(a){return!c.selectedFields.some(function(b){return b.qField===a.qField})}),e=n.removeMeasureAndDetailsFields(e),c.dimensionsFields=c.dimensionsFields.concat(e.filter(function(a){return!c.dimensions.some(function(b){return a.qField===b.fieldName})}))),c.filter.length>0&&(d=c.filter.toLowerCase(),e=c.dimensionsFields.filter(function(a){return-1!==a.title.toLowerCase().indexOf(d)}),c.dimensionsFields=e),g.localeOrderBy(c.dimensionsFields,function(a){return a.title}),b.$apply(c,function(){a.notifyCallbacks(a)})},addCallback:function(a,b){this.callbacks.push({type:a,fn:b})},notifyCallbacks:function(a){a.hasLoaded&&(a.ignoreUpdates||a.callbacks.forEach(function(a){("fields"===a.type||"dimensions"===a.type)&&a.fn()}))},setIgnoreUpdates:function(a){this.ignoreUpdates=a}});return q.$inject=["$scope","$document"],b.directive("qvGlobalSelections",["$document","qvSelectionToolbarService","$timeout",function(b,d,e){return{restrict:"E",template:c,controller:q,require:["qvGlobalSelections"],scope:{},replace:!0,link:function(c,f,g,h){c.toolbar=b.find(".qui-toolbar")[0]?!0:!1;var i=h[0],j=!1,k=function(){j=!1},l=function(){e(function(){i.setIgnoreUpdates(j),i.handleCurrentSelectionFields(),j=!1})};d.Closed.bind(l),b.on("keyup"+p,function(a){27===a.which?j=!1:13===a.which&&(j=!1)}),Touche(b[0].body).tap({id:p,options:{preventDefault:!1},start:function(b){var c=a(b.target).closest(".qv-gs-badge").length>0,d=a(b.target).closest(".qv-gs-listbox").length>0;j=d&&!c}}),m.on("start",k),c.$on("$destroy",function(){i.callbacks=[],d.Closed.unbind(l),Touche(b[0].body).off("*",p),b.off(p),m.off("start",k)}),c.onEnter=function(a){a.stopPropagation(),a.target.blur()}}}}]),"<qv-global-selections></qv-global-selections>"}),define("text!client.views/mobile-selections/mobile-selections.ng.html",[],function(){return'<div class="qv-mobile-selections" tid="{{\'mobileSelections.showFields.\' + filter.showFields}}">\r\n		<div class="qv-ms-toolbar">\r\n		<p qva-activate="selectionsBack()" ng-class="{\'qv-ms-button-disabled\' : disable.back, \'qv-ms-button-enabled\': !disable.back}" class="qv-ms-toolbar-buttons" tid="mobileSelections.back" q-title-translation="Tooltip.NavigateBack"><</p>\r\n		<p qva-activate="selectionsForward()" ng-class="{\'qv-ms-button-disabled\' : disable.forward, \'qv-ms-button-enabled\': !disable.forward}" class="qv-ms-toolbar-buttons" tid="mobileSelections.forward" q-title-translation="Tooltip.NavigateForward">=</p>\r\n		<p qva-activate="selectionsClear()" ng-class="{\'qv-ms-button-disabled\' : disable.clear, \'qv-ms-button-enabled\': !disable.clear}" class="qv-ms-toolbar-buttons" tid="mobileSelections.clear" q-title-translation="Tooltip.ClearSelections">:</p>\r\n		<p qva-activate="toggleMenu()" ng-class="{\'qv-ms-button-disabled\' : !enableMenu, \'qv-ms-button-enabled\': enableMenu, \'qv-ms-button-menu-active\': menuActive }" class="qv-ms-toolbar-buttons" id="mobileSelectionsMenu" tid="mobileSelections.showMenu" qva-outside-ignore-for="allOutside" q-title-translation="Toolbar.Menu">¨</p>\r\n\r\n		<qui-button qva-activate="close($event)" name="close" class="qv-ms-toolbar-close" tid="mobileSelections.close">\r\n			<span q-translation="Common.Close" class="qv-ms-toolbar-close-text"></span>\r\n		</qui-button>\r\n		</div>\r\n		<header class="qv-ms-header">\r\n				<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\r\n		</header>\r\n	<qui-search-field placeholder="GlobalSelections.FilterDimensionsAndFields" query="filter.filter" maxlength="255"\r\n		on-enter="filter.onEnter($event)" class="qv-ms-searchbox" tid="mobileSelections.searchfield">\r\n		</qui-search-field>\r\n		<div class="qv-ms-scroll-area">\r\n			<qv-ms-selected ng-repeat="item in selectedFields"></qv-ms-selected>\r\n			<qv-ms-selectable ng-repeat="item in selectables"></qv-ms-selectable>\r\n		</div>\r\n</div>\r\n'}),define("text!client.views/mobile-selections/menu/mobile-selections-menu.ng.html",[],function(){return'<immidiate-contextual align-to=" \'#mobileSelectionsMenu\' " position="\'bottom\'" on-close-view="closeView()" qva-outside-ignore-for="mobileSelectionsMenu" smallview="true">\r\n	<ul class="qui-icontextlist">\r\n		<li qva-activate="toggleFields($event)">\r\n			<p class="qui-textlist-text" q-translation="{{fieldsLabel}}"></p>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>\r\n'}),define("client.views/mobile-selections/menu/mobile-selections-menu",["text!./mobile-selections-menu.ng.html"],function(a){"use strict";var b={scope:{menuItem:"=",closeMenu:"="},template:a,controller:["$scope",function(a){a.fieldsLabel=a.menuItem.model.showFields?"GlobalSelections.HideFields":"GlobalSelections.ShowFields",a.toggleFields=function(b){b.preventDefault(),a.menuItem.model.showFields=!a.menuItem.model.showFields,a.closeMenu()},a.closeView=function(){a.closeMenu()}}]};return b}),define("text!client.views/mobile-selections/directives/selectable/selectable.ng.html",[],function(){return'<div qva-activate="showSelectable()" ng-class="{\'qv-ms-touch-flash\' : item.flash}" class="qv-ms-selectable" tid="mobileSelections.selectable">\r\n	<p ng-if="item.qField" class="qv-ms-is-field"></p>\r\n	<div class="qv-ms-highlight">\r\n		<span qve-highlight text="{{item.title}}" query="filter.filter"></span>\r\n	</div>\r\n</div>\r\n'}),define("client.views/mobile-selections/directives/selectable/selectable",["qvangular","text!./selectable.ng.html","core.utils/class"],function(a,b,c){var d=c.extend({init:function(a){this.$scope=a}});d.$inject=["$scope"],a.directive("qvMsSelectable",["$timeout",function(a){return{controller:d,restrict:"E",replace:!0,template:b,link:function(b){b.showSelectable=function(){b.item.flash=!0,a(function(){b.$emit("showListbox",b.item),b.item.flash=!1},20)}}}}])}),define("text!client.views/mobile-selections/directives/selected/selected.ng.html",[],function(){return'<div class="qv-ms-selected" tid="mobileSelections.selected">\r\n	<div class="qv-ms-selected-icon">\r\n		<a ng-show="!item.qLocked" qva-activate="clear(item.qField)">\r\n			<i class="icon-cancel"></i>\r\n		</a>\r\n		<a ng-show="item.qLocked" qva-activate="showSelected(item.qField)">\r\n			<i class="icon-toolbar-locked"></i>\r\n		</a>\r\n	</div>\r\n	<div qva-activate="showSelected(item.qField)" class="qv-ms-selected-info">\r\n		<h1 class="qv-object-title">{{item.qField}}</h1>\r\n		<span>{{item.translation}}</span>\r\n		<qv-state-count-bar cardinal="item.qTotal" state-counts="item.qStateCounts"></qv-state-count-bar>\r\n	</div>\r\n</div>\r\n'}),define("client.views/mobile-selections/directives/selected/selected",["qvangular","text!./selected.ng.html","core.utils/class"],function(a,b,c){var d=c.extend({init:function(a){this.$scope=a}});d.$inject=["$scope"],a.directive("qvMsSelected",function(){return{controller:d,restrict:"E",replace:!0,template:b,link:function(a){a.showSelected=function(){a.$emit("showListbox",a.item)},a.clear=function(b){a.currentSelectionsModel.clearField(b)}}}})}),define("client.views/current-selections/current-selections-service",["qvangular","translator"],function(a,b){a.service("qvCurrentSelectionsService",[function(){return{translate:function(a){var c,d=a.qStateCounts.qSelected+a.qStateCounts.qSelectedExcluded+a.qStateCounts.qLocked+a.qStateCounts.qLockedExcluded,e=a.qTotal;return c=e===d&&e>1?b.get("CurrentSelections.All"):d>1&&e>1?b.get("CurrentSelections.Of",[d,e]):a.qSelectedFieldSelectionInfo.map(function(a){return a.qName}).join(", ").toString()}}}])}),define("client.views/mobile-selections/mobile-selections",["qvangular","text!./mobile-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.models/field","client.assets/assets-utils","core.utils/class","core.utils/deferred","core.models/app","objects.models/listbox","general.services/show-service/show-service","client.views/mobile-selections/menu/mobile-selections-menu","client.assets/tab-contents/fields/assets-directdiscovery-service","client.views/global-selections/global-selections-service","client.views/mobile-selections/directives/selectable/selectable","client.views/mobile-selections/directives/selected/selected","objects/listbox-popover/listbox-popover-service","client.views/current-selections/current-selections-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=g.extend({init:function(a,b){var c=this;c.$scope=a,c.$document=b,c.hasLoaded=!1,a.dimensions=[],a.fields=[],a.selectedFields=[],a.filter={filter:"",showFields:!1,onEnter:function(a){a.stopPropagation(),a.target.blur()}},a.selectables=[],a.dimAvailable=!1,a.enableMenu=!0,a.disable={clear:!1,back:!1,forward:!1},h.all({selections:this.bindCurrentSelections(c),dimensions:this.getLibraryDimensions(),fields:this.getFields()}).then(function(){c.hasLoaded=!0,a.enableMenu=a.fields.length>0,a.dimAvailable=a.dimensions.length>0,!a.dimAvailable&&a.enableMenu&&(a.filter.showFields=!0),a.$watch("filter",function(){c.filterSelectables(c)},!0)})},filterSelectables:function(b){var c=b.$scope,d="",e=[];c.selectables=c.dimensions.filter(function(a){return!c.selectedFields.some(function(b){return a.fieldName===b.qField})}),c.filter.showFields===!0&&(e=c.fields.filter(function(a){return!c.selectedFields.some(function(b){return b.qField===a.qField})}),e=m.removeMeasureAndDetailsFields(e),c.selectables=c.selectables.concat(e.filter(function(a){return!c.dimensions.some(function(b){return a.qField===b.fieldName})}))),c.filter.filter.length>0&&(d=c.filter.filter.toLowerCase(),e=c.selectables.filter(function(a){return-1!==a.title.toLowerCase().indexOf(d)}),c.selectables=e),f.localeOrderBy(c.selectables,function(a){return a.title}),a.$apply(c)},bindCurrentSelections:function(b){var d=b.$scope,e=new h,f=a.getService("qvCurrentSelectionsService");return c.get().then(function(a){d.currentSelectionsModel=a,c.bindLayout(d,"currentSelectionsModel",function(a){d.disable={clear:0===a.qSelectionObject.qSelections.length||a.qSelectionObject.qSelections.every(function(a){return a.qLocked}),back:0===a.qSelectionObject.qBackCount,forward:0===a.qSelectionObject.qForwardCount},d.selectedFields=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex}),d.selectedFields.forEach(function(a){a.translation=f.translate(a)}),b.hasLoaded&&b.filterSelectables(b)}),e.resolve()}),e.promise},getLibraryDimensions:function(){var a=this.isCalculatedField,b=this.$scope,c=new h;return d.getList().then(function(d){d.getLayout().then(function(d){b.dimensions=d.filter(function(b){return b.qData.info.length>0&&(b.qData.info.some(a)?!1:!0)&&"H"!==b.qData.grouping}).map(function(a){return{title:a.qData.title,fieldName:a.qData.info[0].qName,qId:a.qInfo.qId}}),c.resolve()})}),c.promise},getFields:function(){var a=this.$scope,b=new h;return e.getListLayout().then(function(c){a.fields=c.map(function(a){return{title:a.qName,qField:a.qName,qTags:a.qTags}}),b.resolve()}),b.promise},isCalculatedField:function(a){return"="===a.qName[0]}});return n.$inject=["$scope","$document"],a.directive("qvMobileSelections",["$document","qvGlobalSelectionsService","qvListboxPopoverService",function(a,c,d){return{restrict:"E",template:b,controller:n,replace:!0,require:["qvMobileSelections"],scope:{},link:function(a,b){var e=null,f=function(){e.destroy(),e=null,a.menuActive=!1};document.activeElement&&document.activeElement.blur(),a.close=function(a){a.preventDefault(),c.off("select")},a.selectionsBack=function(){a.currentSelectionsModel.back()},a.selectionsForward=function(){a.currentSelectionsModel.forward()},a.selectionsClear=function(){a.currentSelectionsModel.clearAll()},a.toggleMenu=function(){e?f():a.enableMenu&&(a.menuActive=!0,e=k.show(l,{menuItem:{model:a.filter},closeMenu:f}))},a.$on("showListbox",function(a,c){var e={title:c.title,qListObjectDef:{qDef:{}}},f=function(a){b.children(".qv-ms-searchbox").find("input").blur(),d.show(a,{})};c.qField?j.createTransientField(i.current,c.qField,e).then(f):j.createTransientDimension(i.current,c.qId,e).then(f)}),a.$on("$destroy",function(){e&&(e.destroy(),e=null)})}}}]),"<qv-mobile-selections></qv-mobile-selections>"}),define("text!client.views/global-selections-deactivate/global-selections-deactivate.ng.html",[],function(){return'<div class="qv-global-selections-deactivate" qva-activate="deactivateGlobalSelection()" ng-style="{height: height}">\r\n	\r\n</div>'}),define("client.views/global-selections-deactivate/global-selections-deactivate",["text!./global-selections-deactivate.ng.html","qvangular","client.views/global-selections/global-selections-service"],function(a,b){return{template:a,controller:["$scope","$document","qvGlobalSelectionsService",function(a,c,d){b.getService("$timeout")(function(){a.height=c.find(".qui-toolbar").outerHeight(),a.height||(a.height=c.find(".qv-panel-current-selections").outerHeight())}),a.deactivateGlobalSelection=function(){d.offAll()}}]}}),define("text!client.views/global-search/global-search.ng.html",[],function(){return'<div class="qv-global-search" ng-class="{ overlay:displaySuggestions || displayResult }" ng-style="{paddingTop: toolbarHeight}" tid="globalSearch">\r\n    <qv-global-search-input class="qv-global-search-input"></qv-global-search-input>\r\n	<div class="qv-global-search-dimmer" ng-if="query" >     \r\n		<qv-global-search-result class="qv-global-search-result" tid="globalSearch.ResultList" ng-class="{ \'qv-global-search-result-loader-open\': resultLoaderOpen, \'noresults\' : showNoResultsMessage() }" ></qv-global-search-result>	\r\n	</div> \r\n</div>\r\n'}),define("general.utils/qv-keyboard-shortcuts",["jquery","general.utils/dom-util"],function(a,b){"use strict";function c(){this.groups=[],this.shortcuts=[],this.timer={id:null},this.isReleased=!0,this.currentEvent=void 0}var d,e={a:65,alt:18,b:66,backspace:8,c:67,ctrl:17,d:68,del:46,down:40,e:69,f:70,enter:13,esc:27,g:71,h:72,home:36,i:73,j:74,k:75,l:76,left:37,m:77,n:78,o:79,p:80,q:81,r:82,right:39,s:83,shift:16,space:32,t:84,tab:9,u:85,up:38,v:86,w:87,win:224,x:88,y:89,z:90,cmd:91},f="qvKeyboardShortcuts",g=!1;return c.prototype.createGroup=function(a,b){var c,d,e=this;for(d=0;d<this.groups.length;d++)if(this.groups[d].name===a){c=this.groups[d];break}if(c)throw"Keyboard shortcut group already exist: "+a;return c={name:a,priority:b,active:!1,shortcuts:[]},this.groups.push(c),this.groups.sort(function(a,b){return a.priority-b.priority}),{registerKeys:function(a,b,d){e.registerKeys(c,a,b,d)},on:function(){e.activateGroup(c)},off:function(){e.deactivateGroup(c)},"delete":function(){e.deactivateGroup(c),e.deleteGroup(c)}}},c.prototype.activateGroup=function(b){var c=this;b.active=!0,g||(g=!0,a(document).on("keydown."+f,function(a){c.handleEvent(a)}))},c.prototype.deactivateGroup=function(b){var c;b.active=!1,c=this.groups.reduce(function(a,b){return b.active&&a++,a},0),0===c&&g&&(g=!1,a(document).off("keydown."+f))},c.prototype.deleteGroup=function(a){this.groups=this.groups.filter(function(b){return b!==a})},c.prototype.registerKeys=function(a,b,c,d){var f=b.toLowerCase().split("+"),g={ctrlKey:!1,shiftKey:!1,keyCode:null,name:"",callback:null,allowInAllContexts:d&&"allowInInput"in d?d.allowInInput:!1,preventDefault:d&&"preventDefault"in d?d.preventDefault:!0,delay:d&&"delay"in d?d.delay:250};for(var h in e)for(var i=0;i<f.length;i++)g.name=b.toLowerCase(),g.callback=c,("ctrl"===f[i]||"cmd"===f[i])&&(g.ctrlKey=!0),"shift"===f[i]&&(g.shiftKey=!0),f[i]===h&&17!==e[h]&&16!==e[h]&&91!==e[h]&&(g.keyCode=e[h]);a.shortcuts.push(g)},c.prototype.preventDefault=function(){this.currentEvent&&this.currentEvent.preventDefault()},c.prototype.handleEvent=function(a){function c(a,b,c){for(var d,e,f=0;f<h.groups.length;f++)if(d=h.groups[f],d.active)for(var g=0;g<d.shortcuts.length;g++)if(e=d.shortcuts[g],e.ctrlKey===a&&e.shiftKey===b&&e.keyCode===c)return e}function d(a,c){var d=b.isInput(document.activeElement);(!d||c.allowInAllContexts)&&e(a,c)}function e(a,b){b.preventDefault&&a.preventDefault(),"number"!=typeof h.timer.id&&(b.callback(b),b.delay>0?h.timer.id=setTimeout(function(){f()},b.delay):f())}function f(){clearTimeout(h.timer.id),delete h.timer.id}var g,h=this;this.currentEvent=a,a.shiftKey?a.shiftKey&&(!a.ctrlKey&&!a.metaKey||a.altKey||(g=c(!0,!0,a.which),g&&d(a,g))):!a.ctrlKey&&!a.metaKey||a.altKey?(g=c(!1,!1,a.which),g&&d(a,g)):(g=c(!0,!1,a.which),g&&d(a,g))},d=new c}),define("client.views/global-search/global-search-keyboard-shortcuts",["qvangular","general.utils/qv-keyboard-shortcuts"],function(a,b){function c(c,e,f){function g(){var a=e.stateFocus;"input"===a?a=e.displaySuggestions?"suggestions":e.isPartials()?"partials":e.displayResult?"results":"start-new-search":"suggestions"===a?a=e.isPartials()?"partials":e.displayResult?"results":"start-new-search":"partials"===a&&e.forcePartials&&(a="results"),e.stateFocus=a}function h(){var a=e.stateFocus;"results"===a&&0===e.activeSelectIx?a=e.isPartials()?"partials":e.displaySuggestions?"suggestions":"input":"partials"===a||"start-new-search"===a?a=e.displaySuggestions?"suggestions":"input":"suggestions"===a&&(a="input"),e.stateFocus=a}function i(){return"INPUT"===w[0].activeElement.tagName}function j(){b.preventDefault(),a.$rootScope.$apply()}function k(a){var b,c,d;return document.selection&&document.selection.createRange?(b=document.selection.createRange(),c=b.getBookmark(),d=c.charCodeAt(2)-2):a.setSelectionRange&&(d=a.selectionStart),d===a.value.length}function l(){i()?"suggestions"===e.stateFocus?f.hideSuggestions():e.query?e.query="":e.close():e.close(),j()}function m(){"suggestions"===e.stateFocus&&(e.activeSuggestionIx=e.activeSuggestionIx>0?e.activeSuggestionIx-1:e.suggestions.length-1,j())}function n(){"suggestions"===e.stateFocus&&(e.activeSuggestionIx=(e.activeSuggestionIx+1)%e.suggestions.length,j())}function o(){switch(h(),e.stateFocus){case"input":e.activeSuggestionIx=-1;break;case"suggestions":e.activeSuggestionIx=0,e.activeSelectIx=-1;break;case"partials":e.activeSuggestionIx=-1,e.activeSelectIx=-1;break;case"results":e.activeSuggestionIx=-1,f.moveActiveResult(-1)}j()}function p(){switch(g(),e.stateFocus){case"input":e.activeSuggestionIx=-1;break;case"suggestions":e.activeSuggestionIx=0,e.activeSelectIx=-1;break;case"partials":e.activeSuggestionIx=-1,e.activeSelectIx=-1;break;case"results":e.activeSuggestionIx=-1,f.moveActiveResult(1)}j()}function q(a){switch(e.stateFocus){case"input":e.isPartials()?f.setShowPartialMatches():e.displaySuggestions?r(a,!0):e.displayResult?f.select(e.searchTerms,0):f.startNewSearchFor();break;case"suggestions":r(a,!0);break;case"partials":f.setShowPartialMatches();break;case"results":e.showMeMoreFocus?f.loadNextPage():f.select(e.searchTerms,e.activeSelectIx);break;case"start-new-search":f.startNewSearchFor()}j()}function r(a,b){(b||k(v))&&(e.activeSuggestionIx=-1===e.activeSuggestionIx?0:e.activeSuggestionIx,e.onSuggestSelect()),j()}function s(){f.closeSearch(),b.preventDefault()}var t,u,v=c.find("input")[0],w=a.getService("$document");e.stateFocus="input",t={preventDefault:!1,allowInInput:!0,delay:0},u={preventDefault:!1,allowInInput:!0,delay:75},d=b.createGroup("global-search",1),d.registerKeys("esc",l,t),d.registerKeys("left",m,u),d.registerKeys("right",n,u),d.registerKeys("up",o,u),d.registerKeys("down",p,u),d.registerKeys("enter",q,t),d.registerKeys("tab",r,t),d.registerKeys("ctrl+f",s,t),d.on()}var d;return c.prototype.on=function(){d.on()},c.prototype.off=function(){d.off()},c.prototype["delete"]=function(){d["delete"]()},c}),define("text!client.views/global-search/directives/input/input.ng.html",[],function(){return'<div class="qv-search-input" ng-class="{\'focus\': isInputFocused}">\r\n	<div class="search-field-area">\r\n		<qui-search-field class="search-field" query="query" placeholder="GlobalSearch.SearchData" auto-focus="autoFocus" autocomplete="\'off\'" spellcheck="\'false\'" is-focused="isInputFocused" tid="globalSearch.searchField" />\r\n	</div>\r\n	<div class="search-underlines">\r\n		<span ng-repeat="underline in underlines" class="underline" ng-class="underline.isWhitespace ? \'term-space\' : \'term\' + underline.colorIx">{{underline.string}}</span>\r\n		<qv-global-search-input-hint></qv-global-search-input-hint>\r\n	</div>\r\n</div>'}),define("text!client.views/global-search/directives/input/input-hint.ng.html",[],function(){return'<span ng-show="displaySuggestions" class="search-suggest" tid="globalSearch.suggestionString">{{hintString}}</span>\r\n'}),define("client.views/global-search/global-search-japanese-support",["qvangular"],function(a){function b(){this.zen2han=function(a){return a.replace(c,function(a){return d[a]})},this.han2zen=function(a){return a.replace(f,function(a){return g[a]})},this.isHalfWidthKana=function(a){return a.length===this.zen2han(a).length}}var c=new RegExp("(?:["+["。「」ァアィイゥウェ","エォオカガキギクグケ","ゲコゴサザシジスズセ","ゼソゾタダチヂッツヅ","テデトドナニヌネノハ","バパヒビピフブプヘベ","ペホボポマミムメモャ","ヤュユョヨラリルレロ","ワヲンヴ・ー"].join("")+"])","g"),d={"。":"｡","「":"｢","」":"｣","・":"･","ー":"ｰ","ァ":"ｧ","ア":"ｱ","ィ":"ｨ","イ":"ｲ","ゥ":"ｩ","ウ":"ｳ","ェ":"ｪ","エ":"ｴ","ォ":"ｫ","オ":"ｵ","カ":"ｶ","ガ":"ｶﾞ","キ":"ｷ","ギ":"ｷﾞ","ク":"ｸ","グ":"ｸﾞ","ケ":"ｹ","ゲ":"ｹﾞ","コ":"ｺ","ゴ":"ｺﾞ","サ":"ｻ","ザ":"ｻﾞ","シ":"ｼ","ジ":"ｼﾞ","ス":"ｽ","ズ":"ｽﾞ","セ":"ｾ","ゼ":"ｾﾞ","ソ":"ｿ","ゾ":"ｿﾞ","タ":"ﾀ","ダ":"ﾀﾞ","チ":"ﾁ","ヂ":"ﾁﾞ","ッ":"ｯ","ツ":"ﾂ","ヅ":"ﾂﾞ","テ":"ﾃ","デ":"ﾃﾞ","ト":"ﾄ","ド":"ﾄﾞ","ナ":"ﾅ","ニ":"ﾆ","ヌ":"ﾇ","ネ":"ﾈ","ノ":"ﾉ","ハ":"ﾊ","バ":"ﾊﾞ","パ":"ﾊﾟ","ヒ":"ﾋ","ビ":"ﾋﾞ","ピ":"ﾋﾟ","フ":"ﾌ","ブ":"ﾌﾞ","プ":"ﾌﾟ","ヘ":"ﾍ","ベ":"ﾍﾞ","ペ":"ﾍﾟ","ホ":"ﾎ","ボ":"ﾎﾞ","ポ":"ﾎﾟ","マ":"ﾏ","ミ":"ﾐ","ム":"ﾑ","メ":"ﾒ","モ":"ﾓ","ャ":"ｬ","ヤ":"ﾔ","ュ":"ｭ","ユ":"ﾕ","ョ":"ｮ","ヨ":"ﾖ","ラ":"ﾗ","リ":"ﾘ","ル":"ﾙ","レ":"ﾚ","ロ":"ﾛ","ワ":"ﾜ","ヲ":"ｦ","ン":"ﾝ","ヴ":"ｳﾞ"},e=function(a){var b={};for(var c in a)b[a[c]]=c;return b},f=new RegExp("(?:"+["[","｡｢｣･ｦｧｨｩｪｫ","ｬｭｮｯｰｱｲｴｵﾅ","ﾆﾇﾈﾉﾏﾐﾑﾒﾓﾔ","ﾕﾖﾗﾘﾙﾚﾛﾜﾝ","]","|","[","ｳｶｷｸｹｺｻｼｽｾ","ｿﾀﾁﾂﾃﾄ","]","[ﾞ]?","|","[ﾊﾋﾌﾍﾎ][ﾞﾟ]?"].join("")+")","g"),g=e(d);a.service("qvGlobalSearchJapaneseSupportService",b)}),define("client.views/global-search/global-search-data-service",["qvangular","client.views/global-search/global-search-japanese-support"],function(a){function b(a,b,d,e){var i;0!==b.length&&(a[d]||(a[d]={}),i=a[d],i.string=b,i.isWhitespace=e||b.length<h&&!c(b)||'"'===b,i.colorIx=i.isWhitespace?-1:f,f=i.isWhitespace?f:(f+1)%g)}function c(a){return a.match(/[\u3040-\u9FBF]/)||a.match(/[\uFF65-\uFF9F]/)}function d(a,b,d,e){b.length<h&&!c(b)||a.push({string:b,startQuote:d,endQuote:e})}function e(a,b,c,d){var e,f,g,h,i,j;for(i=a.qCharPos,j=i+a.qCharCount,e=0;e<b.length;++e)if(g=b[e],!(i>=g.end)){for(f=e;f<b.length;++f)h=b[f],!(j>h.end);f--,f-e>1&&b.splice(e+1,f-e-1),e===f?b.splice(e+1,0,{start:j,end:h.end,highlight:h.highlight,term:h.term}):h.start=j,g.end=i,b.splice(e+1,0,{start:i,end:j,highlight:!0,term:c});break}for(e=b.length-1;e>=0;--e)b[e].start===b[e].end?b.splice(e,1):b[e].substring=d.substring(b[e].start,b[e].end)}var f=0,g=6,h=1,i=!1;a.service("qvGlobalSearchService",function(){this.transformResult=function(a,b,c,d,f){var h,i,j,k,l,m,n,o,p,q,r,s,t=b.qResults;for(this.setGlobalSearchActive(!0),a.searchTermGroups=a.searchTermGroups||[],h=0;h<t.qSearchTermsMatched.length;++h){for(a.searchTermGroups[c+h]=a.searchTermGroups[c+h]||[],m=a.searchTermGroups[c+h],m.maxCombinations=0,i=0;i<t.qSearchTermsMatched[h].length;++i){for(m[d+i]=m[d+i]||{},n=m[d+i],n.selectIx=t.qSearchTermsMatched[h][i].qId,n.groupBaseRowIx=f,n.matches=n.matches||[],n.nbrMatches=0,j=0;j<t.qSearchTermsMatched[h][i].qFieldMatches.length;++j){for(q=t.qSearchTermsMatched[h][i].qFieldMatches[j],n.matches[j]=n.matches[j]||{},o=n.matches[j],o.fieldName=t.qFieldNames[q.qField],o.hits=o.hits||[],s=q.qValues.length,o.rowIndex=n.selectIx,o.fieldMatchIndex=j,o.nDisplayValues=s,o.moreHits=q.qNoOfMatches-s,n.nbrMatches+=q.qTerms.length,n.nbrMatches>m.maxCombinations&&(m.maxCombinations=n.nbrMatches),k=0;s>k;++k)for(o.hits[k]=o.hits[k]||{},p=o.hits[k],r=t.qFieldDictionaries[q.qField].qResult[q.qValues[k]],p.ranges=[{start:0,end:r.qText.length,highlight:!1,term:-1}],l=0;l<r.qRanges.length;++l)e(r.qRanges[l],p.ranges,r.qRanges[l].qTerm%g,r.qText,t.qSearchTerms[r.qRanges[l].qTerm]);o.hits.splice(k,o.hits.length-k)}n.matches.splice(j,n.matches.length-j)}m.splice(d+i,m.length-(d+i)),f+=m.length,a.nbrLoadedRows=f,d=0}for(a.searchTermGroups.splice(c+h,a.searchTermGroups.length-(c+h)),this.setHeaders(a),a.displayResult=!1,h=0;h<a.searchTermGroups.length;++h)if(a.searchTermGroups[h].length>0){a.displayResult=!0;break}},this.showMore=function(a,b){var c=a.qResults;if(1===c.qSearchTermsMatched.length){var d,f,h,i,j=c.qSearchTermsMatched[0][0].qFieldMatches[b.fieldMatchIndex],k=j.qValues.length;for(b.nDisplayValues=k,b.moreHits=j.qNoOfMatches-k,h=0;k>h;++h)if(!b.hits[h])for(b.hits[h]={},f=b.hits[h],d=c.qFieldDictionaries[j.qField].qResult[j.qValues[h]],f.ranges=[{start:0,end:d.qText.length,highlight:!1,term:-1}],i=0;i<d.qRanges.length;++i)e(d.qRanges[i],f.ranges,d.qRanges[i].qTerm%g,d.qText,c.qSearchTerms[d.qRanges[i].qTerm])}},this.setHeaders=function(a){var b,c,d,e=0;for(c=0;c<a.searchTermGroups.length;c++)for(d=0;d<a.searchTermGroups[c].length;d++)b=a.searchTermGroups[c][d],b.matches.length>e&&(e=b.matches.length);for(a.columnCount=e,a.columnWidth=Math.floor(100/e)+"%",a.shadowHeaders=a.shadowHeaders||[],a.shadowHeaders.splice(0,a.shadowHeaders.length-e),c=a.shadowHeaders.length;e>c;c++)a.shadowHeaders[c]={}},this.transformSuggest=function(a,b,c){var d,e,f=0,g=[];for(this.getUnderlinersAndSearchTerms(a.query,g,[]),c=void 0!==c?c:25,c=Math.min(c,b.qResult.qSuggestions.length),d=0;c>d;++d)e={value:b.qResult.qSuggestions[d].qValue,term:b.qResult.qSuggestions[d].qTerm},a.query!==this.getResultingQueryFromSuggestion(g,e)&&(a.suggestions[f]=e,f++);a.suggestions.splice(f,a.suggestions.length-f)},this._whitespaces=[" ","	","\n","\r","\r\n","　"],this.isWhiteSpaceAt=function(a,b){var c,d=this._whitespaces,e=a.charAt(b);for(c=0;c<d.length;++c)if(e===d[c])return!0;return!1},this.getUnderlinersAndSearchTerms=function(a,c,e){function g(a,b){var c,d,e;for(d=0;d<o.length;++d)c=a.indexOf(o[d],b),c>=0&&(!e||e>c)&&(e=c);return e||-1}function h(a,b){var c;do c=a.indexOf('"',b),b=c+1;while(c>=0&&m>b&&!p.isWhiteSpaceAt(a,b));return c}function i(){for(;m>l&&p.isWhiteSpaceAt(a,l);)l++;l>k&&b(c,a.substring(k,l),n++,!0),k=l}var j,k=0,l=0,m=a.length,n=0,o=this._whitespaces,p=this;for(e.length=0,f=0,i();m>k;)if('"'!==a.charAt(k)){if(l=g(a,k),j=l>=0?a.substring(k,l):a.substring(k),b(c,j,n++),d(e,j,!1,!1),0>l)break;k=l,i()}else{if(b(c,a.substring(k,k+1),n++),l=h(a,++k),j=l>=0?a.substring(k,l):a.substring(k),b(c,j,n++),d(e,j,!0,l>0),0>l)break;b(c,a.substring(l,l+1),n++),k=l+=1,i()}c.splice(n,c.length-n)},this.getSuggestTerms=function(a,b){function c(a){var b,c,d;if(a=a.trim(),0===a.length)return null;for(b=a.length,c=b-1,d=-1;c>-1;){if(h.isWhiteSpaceAt(a,c)){d=c+1;break}c--}return d=Math.max(d,0),a.substring(d,b)}var d,e,f,g,h=this;return d=b[b.length-1],f=c(a),e=b.map(function(a){return a.string}),f&&(g=d?d.startQuote&&!d.endQuote:!1,2===f.length&&'"'===f.charAt(0)?e.push(f.charAt(1)):1!==f.length||g||e.push(f)),e},this.getUnderlineLengthFromTermIx=function(a,b){for(var c,d=0,e=0;d<a.length&&(c=a[d],b>e||c.isWhitespace)&&(d!==a.length-1||1!==c.string.length||this.isWhiteSpaceAt(c.string,0)||'"'===c.string);)c.isWhitespace||e++,d++;return d>0?d:0},this.getResultingQueryFromSuggestion=function(a,b){var c,d,e,f,g=this.getUnderlineLengthFromTermIx(a,b.term);return c=a.slice(0,g).reduce(function(a,b){return a+b.string},""),d='"'===c.charAt(c.length-1),e=d?!1:b.value.indexOf(" ")>=0,f=e||d,c+(e?'"':"")+b.value+(f?'"':"")},this.getMinQueryLength=function(){return h},this.setGlobalSearchActive=function(a){i=a},this.isGlobalSearchActive=function(){return i}})}),define("client.views/global-search/directives/input/input",["qvangular","util","text!./input.ng.html","text!./input-hint.ng.html","client.views/global-search/global-search-data-service","client.views/global-search/global-search-japanese-support"],function(a,b,c,d){function e(a,b){var c;if(a.length!==b.length)return!1;for(c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}var f=null;a.directive("qvGlobalSearchInput",["$timeout","qvGlobalSearchService",function(d,g){return{restrict:"E",replace:!0,template:c,require:"^qvGlobalSearch",link:function(c,h,i,j){var k=h.find("input"),l=[],m=a.getService("$document");k.on("keydown",function(){c.ignoreQueryChange=!1}),c.autoFocus=!b.isIos()&&!b.isAndroid(),c.$watch("query",function(a){var b,h,i=[];return d.cancel(f),c.ignoreQueryChange||j.resetSuggestions(),a&&0!==a.length?(g.getUnderlinersAndSearchTerms(a,c.underlines,i),c.ignoreQueryChange?void(c.ignoreQueryChange=!1):void(f=d(function(){g.isWhiteSpaceAt(a,a.length-1)||'"'===a.charAt(a.length-1)?j.hideSuggestions():(h=g.getSuggestTerms(a,i),j.suggest(h)),b=i.map(function(a){return a.string}),i.length>0&&!e(b,l)?j.search(b):a.length<g.getMinQueryLength()&&j.emptyResult(),l=b,f=null},200))):(j.emptyResult(),c.underlines.length=0,void(l=[]))}),c.$watch("isInputFocused",function(a){a&&m.find("body").animate({scrollTop:h.offset().top},100)}),c.$on("focusInput",function(){k.focus()}),c.$on("blurInput",function(){k.blur()}),c.$on("$destroy",function(){k.off()})}}}]),a.directive("qvGlobalSearchInputHint",["qvGlobalSearchService","qvGlobalSearchJapaneseSupportService",function(a,b){return{restrict:"E",replace:!0,template:d,require:"^qvGlobalSearch",link:function(c){function d(){var d,e,f,g,h=c.suggestions[-1===c.activeSuggestionIx?0:c.activeSuggestionIx],i=[],j=[];a.getUnderlinersAndSearchTerms(c.query,i,j),d=a.getSuggestTerms(c.query,j),!c.displaySuggestions||c.suggestions.length<=0||0===d.length||(e=a.getUnderlineLengthFromTermIx(i,h.term),f=i.slice(e).reduce(function(a,b){return a+(b.isWhitespace?" ":b.string)},""),f=b.isHalfWidthKana(h.value)?b.zen2han(f):b.han2zen(f),f=h.value.slice(0,f.length),g=h.value.slice(f.length),c.ignoreQueryChange=!0,c.hintString=g)}c.$watch("activeSuggestionIx",function(){d()}),c.$watchCollection("suggestions",function(){d()}),c.$watch("displaySuggestions",function(){d()})}}}])}),define("text!client.views/global-search/directives/result/result.ng.html",[],function(){return'<div>\r\n\r\n	<qv-global-search-suggest class="qv-global-search-suggest" qv-scroll-to-active="{{activeSelectIx === -1 && stateFocus === \'suggestions\'}}" ></qv-global-search-suggest>	\r\n\r\n	<div ng-if="isPartials()" qv-scroll-to-active="{{stateFocus === \'partials\'}}" class="qv-global-search-result-message search-partials-message">\r\n		<qv-global-search-result-msg model="searchTerms" selections="currentSelections"></qv-global-search-result-msg>\r\n		<div qva-activate="setShowPartialMatches($event)" tid="globalSearch.showPartialMatches" class="btn-base partial-matches-btn" q-translation="{{ !forcePartials?\'GlobalSearch.ShowPartialMatches\' : \'GlobalSearch.HidePartialMatches\' }}" ng-class="{ \'active\': stateFocus === \'partials\' }" ></div>\r\n	</div>\r\n	\r\n	<div ng-if="(displayResult && !isPartials()) || forcePartials" class="qv-global-search-result-groups">\r\n\r\n		<div ng-if="(outsideSelection || currentSelections)" class="qv-global-search-result-title strong" >\r\n			<span ng-if="outsideSelection && !currentSelections" tid="globalSearch.matchesWholeDataset" q-translation="GlobalSearch.MatchesWholeDataset"></span>\r\n			<span ng-if="currentSelections" tid="globalSearch.addToYourSelections" q-translation="GlobalSearch.AddToYourSelections"></span>\r\n		</div>\r\n\r\n		<!-- Results -->\r\n		<div ng-repeat="searchTermGroup in searchTermGroups">\r\n			\r\n			<div class="table">\r\n				<div class="caption" ng-if="searchTermGroup.0.nbrMatches < searchTerms.length" q-translation="GlobalSearch.MatchedSearchTerms,{{searchTermGroup.0.nbrMatches}}"></div>\r\n				<div class="group-row">\r\n					<div class="tr">\r\n						<div class="th" ng-repeat="header in shadowHeaders" ng-style="{width: columnWidth}"></div>\r\n					</div>\r\n				</div>\r\n				<div class="group-row">\r\n					<div class="tr" ng-class="{ \'touch-off\':!isSmallDevice }" ng-repeat="combination in searchTermGroup" qv-scroll-to-active="{{(combination.groupBaseRowIx + $index === activeSelectIx) && stateFocus === \'results\' }}" qva-activate="select( combination, $index )" tid="globalSearch.resultGroup" >\r\n						<div class="td" ng-repeat="match in combination.matches" tid="globalSearch.resultField">\r\n							<div class="group-hits" ng-class="{ \'open\' : match.mobileExpand }">\r\n								<span class="field-name" tid="globalSearch.resultField.Name">{{match.fieldName}}</span>\r\n								<span ng-repeat="hit in match.hits" tid="globalSearch.resultField.Hit">\r\n									<span ng-repeat="range in hit.ranges track by $index" ng-class="range.highlight ? \'highlighted\' + range.term : \'\'">{{range.substring}}</span>\r\n									<span>{{$last ? \'\' : \', \'}}</span>\r\n								</span>\r\n							</div>\r\n							<div tid="globalSearch.resultField.MoreHits" ng-if="$last && match.moreHits > 0" qva-activate="onShowMoreHits($event, match)" ng-class="match.disableShowMore?\'more-hits-disabled\':\'more-hits-mobile\'"><span class="more-text" q-translation="GlobalSearch.MoreResults,{{match.moreHits}}"></span></div>\r\n						</div>\r\n						<div class="td" ng-if="combination.matches.length < columnCount && !isSmallDevice" colspan="{{columnCount - combination.matches.length}}"></div>\r\n					</div>\r\n				</div>\r\n			</div>\r\n			<hr ng-if="!$last" />\r\n		</div>\r\n\r\n		<!-- show me more button -->\r\n		<div qv-scroll-to-active="{{showMeMoreFocus}}" class="show-me-more"><span ng-if="paging.totalRows > paging.lastRowIx" tid="globalSearch.showmemore" qva-activate="showMeMore($event)" class="btn-base" q-translation="GlobalSearch.ShowMeMore" ng-class="{\'active\': showMeMoreFocus }"></span></div>\r\n\r\n	</div>\r\n\r\n	<qv-global-search-no-results class="search-no-results-message" ng-show="showNoResultsMessage()" ></qv-global-search-no-results>\r\n\r\n	<qv-global-search-throbber></qv-global-search-throbber>\r\n</div>\r\n';
}),define("text!client.views/global-search/directives/result/result-message.ng.html",[],function(){return'<div class="qv-global-search-result-message-inline">\r\n    <span ng-if="currentSelections" q-translation="GlobalSearch.NoMatchesWithinCurrentSelection"></span>\r\n    <span ng-if="!currentSelections" q-translation="GlobalSearch.NoMatchesForTheTerms"></span>\r\n    <span ng-repeat="t in searchTerms track by $index">\r\n        <span class="underlined{{$index % capUnderlineMaxNumber}}">{{t}}</span>\r\n        <i ng-if="!$last && $index === searchTerms.length-2" q-translation="GlobalSearch.And"></i><i ng-if="!$last && $index !== searchTerms.length-2">,</i>\r\n    </span> \r\n</div>  '}),define("text!client.views/global-search/directives/result/no-results.ng.html",[],function(){return'<div>\r\n    <div class="qv-global-search-result-groups">\r\n\r\n        <div class="qv-global-search-result-message" >            \r\n            <qv-global-search-result-msg model="searchTerms" selections="currentSelections"></qv-global-search-result-msg>\r\n\r\n            <div ng-if="currentSelections && !allSelectionsLocked" tid="globalSearch.newSearchJustFor" qva-activate="searchOutsideSelections($event)" class="btn-base" q-translation="GlobalSearch.NewSearchJustFor,{{query.trim()}}" ng-class="{ \'active\': stateFocus === \'start-new-search\'}"></div>\r\n        </div>\r\n    </div>      \r\n\r\n    <div class="qv-global-search-result-error" ng-if="error.show">\r\n        <span q-translation="{{error.translation}}"></span>\r\n    </div>\r\n</div>'}),define("client.views/global-search/directives/result/result",["qvangular","text!./result.ng.html","text!./result-message.ng.html","text!./no-results.ng.html","touche"],function(a,b,c,d){a.directive("qvGlobalSearchResult",["$timeout",function(a){return{restrict:"E",template:b,replace:!0,require:["^qvGlobalSearch","qvGlobalSearchResult"],controller:function(){this.getElement=function(){}},link:function(b,c,d,e){var f=e[0],g=e[1];b.resultLoaderOpen=!1,b.emptyMessageEnabled=!1,b.capUnderlineMaxNumber=6,b.select=function(c,d){Touche.utils.touch?(b.activeResultIx=d,a(function(){f.select(b.searchTerms,c.selectIx)},100)):f.select(b.searchTerms,c.selectIx)},b.loadNextPage=function(){f.loadNextPage()},g.getElement=function(){return c},b.setShowPartialMatches=function(){f.setShowPartialMatches()},b.showMeMore=function(){f.loadNextPage()},b.showNoResultsMessage=function(){var a=b.emptyMessageEnabled&&b.searchTerms.length>0&&!b.displayResult&&!b.error.show&&!b.resultLoaderOpen;return a}}}}]),a.directive("qvScrollToActive",function(){return{restrict:"A",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(a,b,c,d){function e(a){a[0].scrollTop=b[0].offsetTop}function f(){b[0].scrollIntoView(!1)}var g=d[1];c.$observe("qvScrollToActive",function(a){if(a=a+""=="true",b.toggleClass("active",a),a){var c=g.getElement(),d=b.position();d.top<0?e(c):d.top+b.height()>c.height()&&f()}})}}}),a.directive("qvGlobalSearchResultMsg",function(){return{restrict:"E",template:c,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(){}}}),a.directive("qvGlobalSearchNoResults",function(){return{restrict:"E",template:d,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(){}}})}),define("text!client.views/global-search/directives/suggest/suggest.ng.html",[],function(){return'<div class="qv-search-suggest-wrapper" ng-if="displaySuggestions" tid="globalSearch.suggestions">\r\n	<span class="hidden">{{query}}</span>\r\n    <div ng-show="isSmallDevice" class="dym" q-translation="GlobalSearch.DidYouMean"></div>\r\n	<ul class="suggest-popup">\r\n		<li ng-repeat="suggest in suggestions track by $index" ng-class="{active: $index == activeSuggestionIx && stateFocus === \'suggestions\'}" qva-activate="onSuggestSelect($index)" tid="globalSearch.suggestion" bold-suggest=\'{{suggest.value}}\'>\r\n			{{suggest.value}}\r\n		</li>\r\n	</ul>\r\n</div>\r\n'}),define("client.views/global-search/directives/suggest/suggest",["qvangular","text!./suggest.ng.html"],function(a,b){a.directive("qvGlobalSearchSuggest",[function(){return{restrict:"E",template:b,replace:!0,require:"^qvGlobalSearch",link:function(){}}}])}),define("text!client.views/global-search/directives/throbber/throbber.ng.html",[],function(){return'<div ng-show="resultLoaderOpen" class="qv-animate progress ng-hide">\r\n	<div class="progress-loader"></div>\r\n</div>'}),define("client.views/global-search/directives/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(a,b){"use strict";a.directive("qvGlobalSearchThrobber",["$timeout",function(a){return{replace:!0,template:b,restrict:"E",require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(b,c,d,e){function f(a){a&&(h.getElement()[0].scrollTop=0)}var g,h=e[1];b.$on("resultLoader",function(c,d,e){d?(a.cancel(g),g=a(function(){f(e),b.resultLoaderOpen=!0,b.emptyMessageEnabled=!1},1e3)):(a.cancel(g),f(e),b.resultLoaderOpen=!1,b.emptyMessageEnabled=b.searchTerms.length>0)})}}}])}),define("client.views/global-search/global-search",["jquery","qvangular","text!./global-search.ng.html","core.models/app","./global-search-keyboard-shortcuts","autogenerated/qix/engine-enums","client.controllers/error-handler-controller","general.utils/responsive-state","client.models/current-selections","client.views/global-search/directives/input/input","client.views/global-search/directives/result/result","client.views/global-search/directives/suggest/suggest","client.views/global-search/directives/throbber/throbber","client.views/global-search/global-search-data-service","client.views/global-selections/global-selections-service"],function(a,b,c,d,e,f,g,h,i){var j={idle:0,pending:1};return b.directive("qvGlobalSearch",function(){return{restrict:"E",template:c,controller:["$scope","$document","$element",function(c,k,l){function m(b){var c=a(b.target);1!==c.closest(".qv-selections-pager").length&&(l.off("qv-outside"),x.closeSearch())}function n(){var a="Cleared";return c.currentSelections&&(a="CurrentSelections",c.lockedSelections&&c.lockedSelections.length>0&&(a="LockedFieldsOnly")),a}function o(a){var b,d,e=c.searchTermGroups.length-1;return d=a.qSearchTermsMatched[0][0].qFieldMatches.reduce(function(a,b){return a+b.qTerms.length},0),b=c.searchTermGroups[e][0].nbrMatches===d?e:e+1}function p(a){var b=0;return c.searchTermGroups[a]&&(b=c.searchTermGroups[a].length),b}function q(a){var b,d,e=c.searchTermGroups;return e[a]?(d=e[a],b=d[0].groupBaseRowIx):(d=e[a-1],b=d[0].groupBaseRowIx+d.length),b}var r=b.getService("qvGlobalSearchService"),s=b.getService("$timeout"),t=b.getService("qvGlobalSelectionsService"),u=new e(l,c,this),v={search:{idCounter:0,state:j.idle,searchTerms:""},result:{state:j.idle},suggest:{idCounter:0,state:j.idle,suggestTerms:""}},w=function(){s(function(){c.isSmallDevice=h.isSmallDevice})},x=this;c.isSmallDevice=h.isSmallDevice,h.ViewChanged.bind(w),c.input="input goes here",c.result="result goes here",c.$on("$destroy",function(){u["delete"](),h.ViewChanged.unbind(w)}),i.get().then(function(a){c.modelSelections=a}),c.$watch(t.getSelectionCount,function(a){c.currentSelections=a&&a>0?!0:!1,x.search(c.searchTerms)}),c.$watch(t.getSelectionLockedCount,function(a){c.allSelectionsLocked=c.currentSelections&&t.getSelectionCount()===a}),c.underlines=[],c.query="",c.searchTerms=[],c.searchTermGroups=[],c.displayResult=!1,c.activeSelectIx=-1,c.showMeMoreFocus=!1,c.forcePartials=!1,c.allSelectionsLocked=!1,c.error={show:!1,message:"",description:""},c.paging={lastRowIx:0,totalRows:0},c.searchOutsideSelections=function(){x.startNewSearchFor()},c.onShowMoreHits=function(a,b){if(a.stopPropagation(),!b.disableShowMore){b.disableShowMore=!0,b.mobileExpand=!0;var d={qOffset:b.rowIndex,qCount:1,qMaxNbrFieldMatches:b.nDisplayValues+15};x.callSearch(c.searchTerms,d).then(function(a){r.showMore(a,b)})["finally"](function(){b.disableShowMore=!1})}},c.close=function(){x.closeSearch()},l.on("qv-outside",m),c.suggestions=[],c.displaySuggestions=!1,c.activeSuggestionIx=-1,c.ignoreQueryChange=!1,c.onSuggestSelect=function(a){var b,d,e,f=[];a=void 0!==a?a:c.activeSuggestionIx,e=c.suggestions[a],r.getUnderlinersAndSearchTerms(c.query,f,[]),b=r.getResultingQueryFromSuggestion(f,e),b.length>255?(u.off(),g.showDialog({message:"ErrorDialog.SearchStringTooLong"}),d=c.$on("errorHandlerClosed",function(){u.on(),d()})):(c.query=b+" ",c.ignoreQueryChange=!1),x.hideSuggestions(),c.$broadcast("focusInput")},this.hideSuggestions=function(){c.displaySuggestions&&(c.displaySuggestions=!1,this.resetSuggestions())},this.startNewSearchFor=function(){c.outsideSelection=!0,c.modelSelections.clearAll(),this.search(c.searchTerms)},this.setShowPartialMatches=function(){c.forcePartials=!c.forcePartials},c.isPartials=function(){return c.searchTermGroups.length&&c.searchTerms.length>c.searchTermGroups[0].maxCombinations},this.resetSuggestions=function(){c.activeSuggestionIx=-1,c.activeSelectIx=-1},this.showSuggestions=function(){c.displaySuggestions=!0,c.activeSuggestionIx=-1,c.activeSelectIx=-1},this.showError=function(a){c.displayResult=!1,c.error.show=!0,c.error.translation="ErrorCode."+a.error.code,a.isHandled=!0},this.toogleSuggestions=function(a){a?this.showSuggestions():this.hideSuggestions()},this.emptyResult=function(){c.displayResult=!1,c.activeSelectIx=-1,c.error.show=!1,v.search.state=j.idle,v.suggest.state=j.idle,c.searchTerms=[],c.searchTermGroups=[],c.outsideSelection=!1,c.$broadcast("resultLoader",!1),c.forcePartials=!1,c.stateFocus="input",this.hideSuggestions(),r.setGlobalSearchActive(!1)},this.moveActiveResult=function(a){c.showMeMoreFocus=!1,0!==a&&(a>0?(c.activeSelectIx=Math.min(c.activeSelectIx+1,c.nbrLoadedRows),c.activeSelectIx=Math.min(c.activeSelectIx,c.paging.totalRows-1),c.activeSelectIx===c.nbrLoadedRows&&(c.showMeMoreFocus=!0)):0>a&&(c.activeSelectIx=Math.max(c.activeSelectIx-1,0)))},this.search=function(a){function b(b){e===v.search.idCounter&&v.search.state===j.pending&&(v.search.state=j.idle,v.search.searchTerms="",c.searchTerms=a,c.$broadcast("resultLoader",!1,!0),r.transformResult(c,b,0,0,0),c.activeSelectIx=-1,c.paging.lastRowIx=c.searchTermGroups.reduce(function(a,b){return a+b.length},0),c.paging.totalRows=b.qResults.qTotalSearchResults)}function d(a){a.error.code===f.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(g.emptyResult(),g.showError(a)),a.error.code!==f.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(v.search.state=j.idle,v.search.searchTerms="",c.$broadcast("resultLoader",!1),c.displayResult=!1)}if(c.stateFocus="input",0!==a.length){v.search.idCounter=v.search.idCounter+1;var e=v.search.idCounter,g=this,h={qOffset:0,qCount:5,qMaxNbrFieldMatches:5};v.search.state=j.pending,v.search.searchTerms=a,c.$broadcast("resultLoader",!0,!0),c.error.show=!1,this.callSearch(a,h).then(b,d)}},this.loadNextPage=function(){var a={qOffset:c.paging.lastRowIx,qCount:5,qMaxNbrFieldMatches:5};v.result.state===j.idle&&(v.result.state=j.pending,c.showMeMoreFocus=!1,this.callSearch(c.searchTerms,a).then(function(a){var b=o(a.qResults),d=p(b),e=q(b);r.transformResult(c,a,b,d,e),c.paging.lastRowIx=c.searchTermGroups.reduce(function(a,b){return a+b.length},0)})["finally"](function(){v.result.state=j.idle}))},this.callSearch=function(a,b){var c={qContext:n()},e=d.current.rpc("SearchAssociations",null,[c,a,b]);return e},this.closeSearch=function(){c.isSmallDevice?(x.emptyResult(),c.query=""):t.toggleGlobalSearch()},this.suggest=function(a){function b(a){v.suggest.suggestTerms="",r.isWhiteSpaceAt(c.query,c.query.length-1)||'"'===c.query.charAt(c.query.length-1)||(h===v.suggest.idCounter&&v.suggest.state===j.pending&&(r.transformSuggest(c,a,10),g.toogleSuggestions(c.suggestions.length>0),c.$broadcast("suggestShow",!0,!0)),v.suggest.state=j.idle)}function e(a){a.error.code===f.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(a.isHandled=!0),a.error.code!==f.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(v.suggest.state=j.idle,v.suggest.suggestTerms="")}if(0!==a.length){var g=this;v.suggest.idCounter=v.suggest.idCounter+1;var h=v.suggest.idCounter;v.suggest.state=j.pending,v.suggest.suggestTerms=a,d.current.rpc("SearchSuggest",null,[{},a]).then(b,e)}},this.select=function(a,b){if(c.$broadcast("blurInput"),0!==a.length&&0!==c.searchTermGroups.length){0>b&&(b=c.activeSelectIx=0);var e={qContext:n()};d.current.rpc("SelectAssociations",null,[e,a,b]),this.emptyResult(),c.query="",c.$broadcast("focusInput")}}}],require:["qvGlobalSearch"],scope:{},replace:!0,link:function(){}}}),"<qv-global-search></qv-global-search>"}),define("client.views/global-selections/global-selections-service",["jquery","qvangular","client.views/global-selections/global-selections","client.views/mobile-selections/mobile-selections","client.views/global-selections-deactivate/global-selections-deactivate","client.views/global-search/global-search","client.utils/state","general.utils/responsive-state","core.models/app","client.views/selection-toolbar/selection-toolbar-service"],function(a,b,c,d,e,f,g,h,i){b.service("qvGlobalSelectionsService",["$document","$timeout","qvSelectionToolbarService",function(j,k,l){function m(){var a=Object.keys(v),b=0;return a.forEach(function(a){v[a].$container&&b++}),b}function n(){(!g.isInAnalysisMode||g.inObjectView())&&q(v.search)}function o(){q(v.select),p(v.select)}function p(a){a.$container=angular.element("<div>"),a.$containerId?j.find(a.$containerId).append(a.$container):j.find("body").append(a.$container),a.$container.showComponent(a.getComponent()),t||h.isSmallDevice||(t=angular.element("<div>"),j.find("body").append(t),t.showComponent(e)),a.setup()}function q(a){a.$container&&(a.$container.remove(),a.$container=void 0),t&&0===m()&&(t.remove(),t=void 0),a.destroy()}function r(a){return a.$container?!0:!1}function s(b){r(b)?(q(b),a("body").removeClass("qv-global-selections-enabled")):(g.state===g.States.snapshot&&g.setState(g.States.analysis),a("body").addClass("qv-global-selections-enabled"),p(b))}var t,u,v={select:{$container:void 0,getComponent:function(){return h.isSmallDevice?d:c},setup:function(){h.ViewChanged.bind(o)},destroy:function(){h.ViewChanged.unbind(o)}},search:{$container:void 0,$containerId:"#qv-global-search-container",getComponent:function(){return f},setup:function(){g.StateChanged.bind(n),i.current.isModal()&&l.confirm()},destroy:function(){g.StateChanged.unbind(n)}}},w=null,x=0,y=0,z=b.getService("qvGlobalSearchService");return u={toggleGlobalSelection:function(){s(v.select)},toggleGlobalSearch:function(){k(function(){s(v.search)})},openGlobalSearch:function(){v.search.$container||(q(v.search),p(v.search))},closeGlobalSearchIfNotActive:function(){z.isGlobalSearchActive()||this.off("search")},off:function(a){var b=v[a];q(b)},offAll:function(){var a=this,b=Object.keys(v);b.forEach(function(b){a.off(b)})},isSelectActive:function(){return void 0!==v.select.$container},isSearchActive:function(){return void 0!==v.search.$container},setCsShowCallback:function(a){w=a},setCsShow:function(a){w&&w(a)},setSelectionCount:function(a){x=a},getSelectionCount:function(){return x},setSelectionLockedCount:function(a){y=a},getSelectionLockedCount:function(){return y}}}])}),define("text!client.views/state-count-bar/state-count-bar.ng.html",[],function(){return'<div class="qv-state-count-bar" tid="stateCount">\r\n	<div class="state selected" ng-style="{\'width\': percents.qSelected + \'%\'}"></div>\r\n	<div class="state locked" ng-style="{\'width\': percents.qLocked + \'%\'}"></div>\r\n	<div class="state optional" ng-style="{\'width\':  percents.qOption + \'%\'}"></div>\r\n	<div class="state alternative" ng-style="{\'width\':  percents.qAlternative + \'%\'}"></div>\r\n</div>'}),define("client.views/state-count-bar/state-count-bar",["qvangular","text!./state-count-bar.ng.html"],function(a,b){"use strict";a.directive("qvStateCountBar",function(){return{restrict:"E",template:b,scope:{cardinal:"=",stateCounts:"="},link:function(a){function b(){var b,e=a.cardinal,f=a.stateCounts;void 0!==e&&void 0!==f&&(b=c(e,f),a.percents=d(b))}function c(a,b){var c={};return["qSelected","qLocked","qOption","qAlternative"].forEach(function(d){var e=b[d]||0,f=Math.round(e/a*100);e>0&&0===f&&(f=1),c[d]=f}),c}function d(a){var b,c,d={},e=0;for(b in a)d[b]=a[b],(!c||a[b]>a[c])&&(c=b),e+=a[b];return e>100&&(d[c]=a[c]-(e-100)),d}a.percents=[],a.$watch("cardinal",function(){b()}),a.$watchCollection("stateCounts",function(){b()})}}})}),define("client.views/current-selections/current-selections",["qvangular","text!./current-selections.ng.html","client.models/current-selections","core.utils/resize","general.utils/responsive-state","client.utils/state","core.models/app","objects/listbox-popover/listbox-popover-service","general.components/pager/pager","client.views/global-selections/global-selections-service","client.views/state-count-bar/state-count-bar","objects.views/charts/tooltip/chart-tooltip-service","client.views/current-selections/current-selections-service"],function(a,b,c,d,e,f,g){"use strict";function h(a,b){return a.isPlaceHolder=!0,a.active=!1,a.qLocked=!1,a.feedbackActive=!1,a.translation="",a.qTotal=0,a.qStateCounts=0,b&&(a.qField=b),a}a.directive("qvSelectionPager",["qvGlobalSelectionsService","$timeout",function(a,b){return{restrict:"A",priority:1,link:function(c){var e=c.$watch(a.isSelectActive,function(a){c.$emit("globalSelectionActive",a),b(function(){c.refreshPager(!1)})});d.on("end",c.refreshPager),c.$on("$destroy",function(){e()})}}}]);var i={template:b,replace:!0,restrict:"E",scope:{appName:"@"},link:function(b){var c=a.getService("$timeout"),d=a.getService("qvGlobalSelectionsService"),i=function(){c(function(){b.isSmallDevice=e.isSmallDevice})},j=function(){f.inSheetView()&&e.isSmallDevice&&d.openGlobalSearch()};b.isSmallDevice=e.isSmallDevice,b.cachedPlaceHolders=[],e.ViewChanged.bind(i),b.$watch("isSmallDevice",function(a){a===!0?d.openGlobalSearch():d.closeGlobalSearchIfNotActive()}),f.StateChanged.bind(j),b.mobileIndicatorTop=!1,b.mobileIndicatorShow=!1,d.setCsShowCallback(function(a){b.mobileIndicatorShow=a}),b.$on("globalSelectionActive",function(a,c){b.isGlobalSelectionsActive=c}),g.get(b.appName).then(function(a){b.$watch(a.isModal.bind(a),function(a){b.inSelection=a,b.inSelection&&b.activeFieldName&&b.activeFieldName.length>0?b.cachedPlaceHolders=b.items.map(function(a){return h({},a.qField)}):(b.cachedPlaceHolders=[],b.items=b.items.filter(function(a){return!a.isPlaceHolder}))})}),b.$watch(d.isSearchActive,function(a){b.isGlobalSearchActive=a}),b.toggleGlobalSelection=function(a){a.preventDefault(),d.toggleGlobalSelection()},b.toggleGlobalSearch=function(){d.toggleGlobalSearch()},b.$on("$destroy",function(){e.ViewChanged.unbind(i),d.off("search"),f.StateChanged.unbind(j),d.setCsShowCallback(null)})},controller:["$scope","$timeout","qvChartTooltipService","qvGlobalSelectionsService","qvCurrentSelectionsService",function(b,d,g,i,j){function k(){i.setCsShow(e.isSmallDevice&&b.items.length>0&&f.view!==f.Views.object)}var l,m,n=!1,o=a.getService("qvListboxPopoverService");b.items=[],c.get().then(function(a){b.model=a}),c.bindLayout(b,"model",function(a){b.disable={clear:0===a.qSelectionObject.qSelections.length||a.qSelectionObject.qSelections.every(function(a){return a.qLocked}),back:0===a.qSelectionObject.qBackCount,forward:0===a.qSelectionObject.qForwardCount},b.items=a.qSelectionObject.qSelections.sort(function(a,b){return a.qSortIndex-b.qSortIndex});var c=0;b.items.forEach(function(a){a.qLocked===!0&&c++,a.translation=j.translate(a)}),b.nbrSelections=b.items.length,i.setSelectionLockedCount(c),i.setSelectionCount(b.items.length),k(),b.cachedPlaceHolders.length>0&&b.activeFieldName&&b.activeFieldName.length>0&&(b.cachedPlaceHolders.forEach(function(a){a=h(a)}),b.items.forEach(function(a){b.cachedPlaceHolders.forEach(function(c,d){a.qField===c.qField&&(b.cachedPlaceHolders[d]=a)})}),b.items=b.cachedPlaceHolders),d(function(){b.$broadcast("refreshPager")})}),b.$watch(f.inObjectView,k),b.$watch("isSmallDevice",k),b.clear=function(a){b.$parent.itemSelected&&(b.$parent.itemSelected=!1),b.model.clearField(a)},b.clearAllFields=function(){b.model.clearAll()},b.back=function(){b.model.back()},b.forward=function(){b.model.forward()},b.showPopover=function(a){var c=angular.element(a.target).closest(".item"),e=c.scope().item.qField,f={qvaOutsideIgnoreFor:"currentSelectionsItems",$alignToElement:c,showLock:!0};return b.isClearSelectionIcon(a.target)?void(b.activeFieldName&&(o.close(),b.activeFieldName="")):e===b.activeFieldName?(o.close(),void(b.activeFieldName="")):(d(function(){b.closeTooltip()},100),b.activeFieldName=e,void o.showField(e,b.model.session.currentApp,f,{},function(){b.activeFieldName="",d(function(){b.closeTooltip()},100)}))},b.openTooltip=function(a,c){return b.isClearSelectionIcon(a.target)?void b.closeTooltip():void(n||Touche.utils.touch||(b.cancelTooltip(),l=d(function(){var b=c.qStateCounts.qSelected+c.qStateCounts.qSelectedExcluded+c.qStateCounts.qLocked+c.qStateCounts.qLockedExcluded;n=!0,g.open({content:[{header:c.qField+" ("+b+"/"+c.qTotal+")",rows:[{content:c.translation}]}],position:{x:a.clientX,y:a.clientY},direction:"bottom",template:"generic"})},500)))},b.closeTooltip=function(){n=!1,b.cancelTooltip(),g.close()},b.cancelTooltip=function(){d.cancel(l)},b.isClearSelectionIcon=function(a){return angular.element(a).closest(".remove").is(".remove")},m=a.$rootScope.$on("locked-feedback",function(c,d){b.items.forEach(function(c){-1!==d[0].indexOf(c.qField)&&(d[1]?c.feedbackActive=!1:c.feedbackActive=!0,a.$apply(b))})}),b.$on("$destroy",function(){m()})}]};return a.directive("qvStageCurrentSelections",function(){return i}),i}),define("qlik",["qvangular","translator","core.models/app","client.models/rpc-session","core.utils/deferred","workbench/mashupapi/qglobal","workbench/mashupapi/qapp","client.utils/state","general.utils/touch-configuration-util","general.models/library/extension-list","util","qlikui/components","general.utils/qv-activate","general.utils/qv-swipe","general.utils/qv-longtapswipe","objects/object","client.views/current-selections/current-selections","core.utils/augment","general.services/content-api/content-api"],function(a,b,c,d,e,f,g,h,i,j,k){function l(){u||(u=!0,i.configureTouchSupport(),h.setState(h.States.analysis),h.setView(h.Views.sheet),v||b.setup())}function m(a){r=a,g.setErrorCallback(a)}function n(a){v=!0,b.setup(a)}function o(a){return a&&a.backendApi?new g(a.backendApi.model.session.currentApp):(s||(s=new g(c.current)),s)}function p(b,d){l();var e=b;return d&&(e+="/"+d.host+d.identity?"/"+d.identity:""),t[e]?t[e]:(a.$apply(a.$rootScope,function(){var a=c.getSync(b,d,!0);if(a){a.waitForOpen.promise.then(null,function(a){r&&(r(a.error),a.isHandled=!0)});var f=new g(a);f.close=function(){return delete t[e],a.close()},t[e]=f}}),t[e])}function q(a){return new f(a)}var r,s,t={},u=!1,v=!1,w={openApp:p,currApp:o,getGlobal:q,setOnError:m,setLanguage:n,getAppList:function(b,e){e=k.extend({host:k.hostname,port:k.port,isSecure:k.isSecure,reloadURI:k.reloadURI,prefix:k.basePath},e),a.$apply(a.$rootScope,function(){var a=d.get("?transient=",e);a.open(),c.getList(a).then(function(c){b(c),a.close()})})},resize:function(a){a?pubsub.publish("/ui/object/resize."+a):pubsub.publish("/resize/end")},getExtensionList:function(a){var b=new e;return j.getList().then(function(c){a&&a(c),b.resolve(c)}),b.promise},callRepository:function(b,c,d){return a.getService("$contentApi").request({method:c||"GET",url:b,data:d})}};return define("qlik",w),require.s.contexts.sense&&(require.s.contexts._.defined.angular=require.s.contexts.sense.defined.angular),w}),define("extensions.qliktech/straight-table/straight-table-properties",["client.property-panel/default-properties","util","general.utils/property-resolver","translator"],function(a,b,c,d){var e={textAlignAuto:{ref:"qDef.textAlign.auto",type:"boolean",component:"switch",translation:"Common.Text.TextAlignment",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},textAlign:{ref:"qDef.textAlign.align",type:"string",component:"dropdown",options:[{value:"left",translation:"Common.Text.AlignLeft"},{value:"right",translation:"Common.Text.AlignRight"}],defaultValue:"left",show:function(a){return void 0!==a.qDef.textAlign&&!a.qDef.textAlign.auto}}},f={tableColorBgByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.0.qExpression",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:""},tableColorByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.1.qExpression",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",change:function(a){void 0===a.qAttributeExpressions[0]&&(a.qAttributeExpressions[0]={})}},totalsAggr:{type:"items",items:{totalsAggrFunc:{type:"string",component:"dropdown",ref:"qDef.qAggrFunc",translation:"Object.Table.AggrFunc",options:[{value:"Expr",translation:"Common.Auto"},{value:"Avg",translation:"Object.Table.AggrFunc.Avg"},{value:"Count",translation:"Object.Table.AggrFunc.Count"},{value:"Max",translation:"Object.Table.AggrFunc.Max"},{value:"Min",translation:"Object.Table.AggrFunc.Min"},{value:"Sum",translation:"Object.Table.AggrFunc.Sum"},{value:"None",translation:"Object.Table.AggrFunc.None"}],defaultValue:"Expr"},totalsAggrFuncMessage:{component:"text",translation:"Object.Table.AggrFuncMessage",show:function(a,b){return b&&!c.getValue(b,"properties.totals.show")&&"noTotals"===c.getValue(b,"properties.totals.position")}}}}},g={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{totals:{ref:"totals.show",type:"boolean",translation:"properties.totals",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},totalsMode:{ref:"totals.position",translation:"Common.Position",type:"string",component:"dropdown",options:[{value:"noTotals",translation:"Common.None"},{value:"top",translation:"Common.Top"},{value:"bottom",translation:"Common.Bottom"}],defaultValue:"noTotals",show:function(a){return!a.totals.show}},totalsLabel:{ref:"totals.label",translation:"properties.totals.label",type:"string",expression:"optional",defaultValue:function(){return d.get("Object.Table.Totals")}}}}}},h={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},i={type:"items",component:"columns",translation:"Common.Data",sortIndexRef:"qHyperCubeDef.columnOrder",allowMove:!0,allowAdd:!0,addTranslation:"Common.Columns",items:{dimensions:{type:"array",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",grouped:!0,items:b.extend(!0,{},a.dimensions.items,e)},measures:{type:"array",component:"expandable-items",ref:"qHyperCubeDef.qMeasures",grouped:!0,items:b.extend(!0,{},a.measures.items,f,e)}}},j={uses:"sorting"};return{type:"items",component:"accordion",items:{data:i,sorting:j,addons:h,settings:g}}}),define("text!extensions.qliktech/straight-table/straight-table.ng.html",[],function(){return'<div class="qv-st" ng-class="{ \'qv-st-interactive\': interactive,\r\n	\'align-totals\': scrollApi.alignTotals,\r\n	\'align-column-picker\': scrollApi.settings.columnPicker.show,\r\n	\'qv-st-selections-active\': selections.active,\r\n	\'qv-st-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled\r\n	}"\r\n	 ng-style="fontScale">\r\n	<qv-straight-table-top-header on-sort-header="sort(header);" on-search="search($alignTo,header)"></qv-straight-table-top-header>\r\n	<qv-scroll-area class="qv-grid-object-scroll-area qv-animate">\r\n		<qv-straight-table-data qv-selections-select-while-locked="selectWhileLocked()"\r\n								qv-selections-toggle-dimension-value="{ selector: \'.qv-st-data-cell\'}"\r\n								qv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, $event)"\r\n								qv-selections-multiselect="{ selector: \'.qv-st-data-cell:not(.qv-st-data-cell-null-value)\' }"\r\n								qv-selections-start-multiselect="interactive && activateSelections(cell)"\r\n								qv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\r\n								qv-selections-end-multiselect="interactive && multiselect()"></qv-straight-table-data>\r\n	</qv-scroll-area>\r\n	<qv-straight-table-bottom-header></qv-straight-table-bottom-header>\r\n	<qv-scroll-loader></qv-scroll-loader>\r\n	<qv-straight-table-column-picker-activator ng-if="scrollApi.settings.columnPicker.show"></qv-straight-table-column-picker-activator>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/snapshot/snapshot-helper",["jquery"],function(a){function b(b,c,d){for(var e,f,g=d.top+d.height,h=0;h<b.length;){if(a(b[h]).offset().top+a(b[h]).height()>d.top){e=b[h];break}h++}for(h=b.length-1;h>=0;){if(a(b[h]).offset().top<g){f=b[h];break}h--}if(!e||!f||0>=c)return{index:1,height:1,width:1};var i=a(e).scope().row.getIndex(),j=a(f).scope().row.getIndex();return{index:i,height:j-i+1,width:c}}function c(a){if(!a.layout.snapshotData||a.layout.snapshotData.object.freeResize)return void delete a.dataTableHeight;var b=a.object.objectSize.h,c=b/a.layout.snapshotData.object.size.h,d=a.layout.snapshotData.object.dataTableHeight;a.dataTableHeight={height:d*c+"px","max-height":60*c+"px"}}return{scaleDynamically:c,getIndexHeightAndWidth:b}}),define("objects.grid/data-grid",["core.utils/class"],function(a){var b,c,d,e,f,g,h;return c=a.extend("ClassList",{init:function(){this.classList=[]},addClass:function(a){if(a){var b=this.classList.indexOf(a);return-1===b&&this.classList.push(a),this}},removeClass:function(a){if(a){var b=this.classList.indexOf(a);return-1!==b&&this.classList.splice(b,1),this}},hasClass:function(a){return-1!==this.classList.indexOf(a)}}),d=c.extend("Cell",{init:function(){this._super.apply(this,arguments),this.setDefaults()},setDefaults:function(){this.classList.length=0,this.style={},this.color={},this.colspan=1,this.rowspan=1,this.text="",this.dataValue=-1,this.dataValue=-1,this.dataColIx=-1,this.dataRowIx=-1,this.isDimensionValue=!1,this.type=void 0,this.locked=!1,this.isNullValue=!1,this.tid="",this.fieldName=""},setData:function(a,b,c,d,e){this.text=a,this.rowspan=b||1,this.colspan=c||1,this.dataRowIx=d||-1,this.dataColIx=e||-1},setHeader:function(a,b,c,d,e,f,g){this.text=a,this.dataValue=b,this.rowspan=c||1,this.colspan=d||1,this.dataRowIx=e,this.dataColIx=f,this.templateSrc="pt-header-cell-item.ng.html",this.addClass("header"),this.setNullClass(g)},setTopHeader:function(){this.setHeader.apply(this,arguments),this.addClass("top")},setLeftHeader:function(){this.setHeader.apply(this,arguments),this.addClass("left")},setFromMetaHeader:function(a){Object.keys(a).forEach(function(b){this[b]=a[b]},this)},setNullClass:function(a){a&&(this.isNullValue=a,this.addClass("null-value"))}}),f=d.extend("StraightCell",{setDefaults:function(){this._super.apply(this,arguments),this.isNumeric=!1,this.textAlign="left",this.color.bgByExpression=!1,this.color.bgIsDark=!1,this.selected=!1,this.selectedHighlighted=!1,this.qvaOutsideIgnoreFor="",this.isSearchIcon=!1,this.open=!1,this.sortable=!1,this.isMeasure=!1,this.isSorted=!1,this.reversed=!1,this.isTotal=!1,this.isSelectLocked=!1}}),g=d.extend("PivotCell",{setDefaults:function(){this._super.apply(this,arguments),this.templateSrc="pt-cell-item.ng.html",this.collapseExpandClass="",this.isMeta=!1},setCollapseExpandClass:function(a){this.addClass("parent"),a.qCanExpand?this.collapseExpandClass="icon-add":a.qCanCollapse&&(this.collapseExpandClass="icon-remove")},setEmpty:function(a,b,c){this.setHeader("",-4,a,b),this.addClass("empty"),this.addClass(c)}}),e=c.extend("Row",{init:function(a){this._super.apply(this,arguments),this.cells=[],this.style={},this.isBold=!1,this.classList=[],this.gridType=a,this.reset()},getIndex:function(){var a,b;for(b=0;b<this.cells.length;++b)if(a=this.cells[b],a.dataRowIx>=0)return a.dataRowIx;return-1},setNextCellIx:function(a){this.nextCellIx=a;
},reset:function(a){var b;for(this.nextCellIx=0,this.isBold=!1,a||(this.classList=[]),b=0;b<this.cells.length;++b)this.cells[b].setDefaults()},removeUnused:function(){this.cells.splice(this.nextCellIx,this.cells.length-this.nextCellIx)},_createCell:function(){switch(this.gridType){case"pivot":return new g;default:return new f}},getCell:function(a){return this.cells[a]||(this.cells[a]=this._createCell()),this.cells[a]},getNextCell:function(){var a;return this.cells[this.nextCellIx]?(a=this.cells[this.nextCellIx],a.setDefaults()):a=this.cells[this.nextCellIx]=this._createCell(),this.nextCellIx++,a},getCellSize:function(){return this.nextCellIx},addEmptyHeaderCell:function(a,b,c,d,e,f){var g=this.getNextCell();return g.setEmpty(c,d,e),g.setData("",c,d,a,b),g.setNullClass(f),g},addEmptyMetaCell:function(a,b,c){var d=this.addEmptyHeaderCell(-1,-1,a,b,c);return d.isMeta=!0,d},addEmptyDataCell:function(a,b){var c=this.getNextCell();return c.setData("",-4,a,b),c.addClass("empty"),c},addTotalCell:function(a,b,c){var d=this.getNextCell();return d.setHeader(a,-1,b,c),d.addClass("bold"),this.addClass("bold"),d},addLeftCollapseExpandCell:function(a,b,c,d){var e=this.getNextCell();return e.setLeftHeader("",-1,1,1,a,b),e.setCollapseExpandClass(c),e.setNullClass(d),e}}),h=a.extend("RowList",{init:function(a){this.rows=[],this.gridType=a},reset:function(a){this.rows.forEach(function(b){b.reset(a)}),this.nextRowIx=0},get:function(a){return this.rows[a]||(this.rows[a]=new e(this.gridType)),this.rows[a]},getNext:function(){var a=this.get(this.nextRowIx);return this.nextRowIx++,a},removeUnused:function(){this.rows.splice(this.nextRowIx,this.rows.length-this.nextRowIx),this.rows.forEach(function(a){a.removeUnused()})},setNextRowIx:function(a){this.nextRowIx=a}}),b=a.extend("DataGrid",{init:function(a){this.headerList=new h(a),this.rowList=new h(a),this.footerList=new h(a),this.gridType=a,this.reset()},setTopTreeDepth:function(a){this.topTreeDepth=a},setLeftTreeDepth:function(a){this.leftTreeDepth=a},reset:function(a,b){this.rowList.reset(),a||(this.headerList.reset(b),this.footerList.reset(b)),this.topTreeDepth=-1,this.leftTreeDepth=-1},getRowsByCellType:function(a){var b=[];return b=a===this.CELL_TYPE_DATA||a===this.CELL_TYPE_LEFT?this.rows:this.headerRows},getRow:function(a){return this.rowList.get(a)},getHeaderRow:function(a){return this.headerList.get(a)},getFooterRow:function(a){return this.footerList.get(a)},getNextRow:function(){return this.rowList.getNext()},getNextHeaderRow:function(){return this.headerList.getNext()},getNextFooterRow:function(){return this.footerList.getNext()},getCell:function(a,b){return this.getRow(a).getCell(b)},getHeaderCell:function(a,b){return this.getHeaderRow(a).getCell(b)},getFooterCell:function(a,b){return this.getFooterRow(a).getCell(b)},removeUnused:function(){this.rowList.removeUnused(),this.headerList.removeUnused(),this.footerList.removeUnused()},getNextRowIx:function(){return this.rowList.nextRowIx},setNextRowIx:function(a){this.rowList.setNextRowIx(a)},setNextHeaderIx:function(a){this.headerList.setNextRowIx(a)}}),Object.defineProperties(b.prototype,{headerRows:{get:function(){return this.headerList.rows}},footerRows:{get:function(){return this.footerList.rows}},rows:{get:function(){return this.rowList.rows}},GRID_TYPE_STRAIGHT:{get:function(){return"straight"}},GRID_TYPE_PIVOT:{get:function(){return"pivot"}},CELL_TYPE_TOP:{get:function(){return"top"}},CELL_TYPE_LEFT:{get:function(){return"left"}},CELL_TYPE_DATA:{get:function(){return"data"}}}),b}),define("objects.grid/services/data-service",["qvangular","translator","general.utils/color"],function(a,b,c){"use strict";function d(a,b){var c,d=[],e=a.length,f=b.length;for(c=0;e>c;++c)d.push(c);for(c=0;f>c;++c)d.push(e+c);return d}function e(a,b){var c,d,e,f,g=[];for(d=a.rows.length,c=0;d>c;++c)f=a.rows[c],e=f.cells.length,e>b&&b>=0&&g.push(f.cells[b]);return g}function f(a,b,c,d){var e,f,h=g(a,b,c),i=h.length,j=[];for(f=0;i>f;++f)e=h[f],e.dataValue===d&&j.push(e);return j}function g(a,b,c){var d,e,f,g,h=a.getRowsByCellType(b),i=h.length,j=null,k=[];for(d=0;i>d;++d)for(f=h[d],g=f.cells.length,e=0;g>e;++e)j=f.cells[e],j.type===b&&j.dataColIx===c&&k.push(j);return k}function h(a,b,c){var d,e,f,g,h,i=a.getRowsByCellType(b),j=i.length,k=[];for(d=0;j>d;++d)for(f=i[d],h=f.cells.length,e=0;h>e;++e)g=f.cells[e],g.type===b&&g.dataRowIx===c&&k.push(g);return k}function i(a,b,c,d){var e,f,g,h,i=a.getRowsByCellType(b),j=i.length,k=null;for(e=0;j>e;++e)for(g=i[e],h=g.cells.length,f=0;h>f;++f)if(k=g.cells[f],k.dataColIx===c&&k.dataRowIx===d)return k;return null}function j(a,b){return b.type===a.CELL_TYPE_LEFT||b.type===a.CELL_TYPE_DATA?g(a,b.type,b.dataColIx):h(a,b.type,b.dataRowIx)}function k(a,b,c){var d,e,f=j(a,b),g=f.length,h=[];for(e=0;g>e;++e)d=f[e],d.dataValue===c&&h.push(d);return h}function l(a,b){var c=b.qHyperCube.qDimensionInfo.length;return b.qHyperCube.columnOrder?c>a?b.qHyperCube.qDimensionInfo[a]:b.qHyperCube.qMeasureInfo[a-c]:{othersLabel:!1,qLocked:!1}}function m(a,b){var c=b.qHyperCube.qGrandTotalRow[a-b.qHyperCube.qDimensionInfo.length];return c||(c={qText:""}),c}function n(a){return a?"qDimensionType"in a:void 0}function o(a){return void 0===a.textAlign||a.textAlign.auto}function p(a){return a?"right":"left"}function q(a,b){return o(a)?p(b):a.textAlign.align||"left"}function r(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p;for(i=0;i<f.length;++i)j=f[i],p=h.getDimInfo(h.leftDimCnt+d),k=e.getHeaderRow(a),l=k.getNextCell(),l.type=e.CELL_TYPE_TOP,l.locked=y(j)?!1:p.qLocked,l.isDimensionValue=!(y(j)||t(j)||v(j)||w(j)),m=j.qText,t(j)&&(n=h.leftCellCnt+b,n>=h.pseudoDimIndex&&n--,m=h.layout.qHyperCube.qDimensionInfo[n].othersLabel),l.setTopHeader(m,j.qElemNo,1,1,b,g+c,u(j)),(v(j)||j.qCanCollapse||j.qCanExpand)&&(l.addClass("bold"),l.setCollapseExpandClass(j),k.addClass("bold")),j.qSubNodes.length?(o=r(a+1,b+1,c,d+1,e,j.qSubNodes,g,h),l.colspan=o-c,c=o):c++;return c}function s(a,b,c,d){d.dataColumnsInfo.cnt<=0||(r(1,0,0,0,a,b,c,d),a.setNextHeaderIx(Math.max(2,a.topTreeDepth+1)),a.headerRows[a.headerRows.length-1].addClass("last-top-row"))}function t(a){return-3===a.qElemNo}function u(a){return-2===a.qElemNo}function v(a){return-1===a.qElemNo}function w(a){return-4===a.qElemNo}function x(a){return v(a)||w(a)}function y(a){return"P"===a.qType}function z(a){return a.qCanCollapse||a.qCanExpand||a.qSubNodes.length&&!y(a.qSubNodes[0])}function A(a,b){return 0===a&&(v(b)||y(b))||!x(b)&&!y(b)}function B(a,b,c,d,e,f,g,h){var i,j=0,k=e.getRow(a),l=g.getDimInfo(c),m=!(y(d)||t(d)||v(d)||u(d)),n=l?l.qLocked:!1;return c>0&&(i=k.addEmptyHeaderCell(f+a,b,1,c,"left",u(d)),i.type=e.CELL_TYPE_LEFT,i.isDimensionValue=m,i.locked=n,i.dataValue=d.qElemNo),(d.qCanCollapse||d.qCanExpand)&&(i=k.addLeftCollapseExpandCell(f+a,b,d,u(d)),i.type=e.CELL_TYPE_LEFT,i.isDimensionValue=m,i.locked=n,i.dataValue=d.qElemNo,j=-1),i=k.getNextCell(),i.type=e.CELL_TYPE_LEFT,i.isDimensionValue=m,i.locked=n,h=h||d.qText,t(d)&&(h=l.othersLabel),i.setLeftHeader(h,d.qElemNo,1,g.leftCellCnt-c+j,f+a,b,u(d)),(v(d)||z(d))&&(i.addClass("bold"),k.addClass("bold")),i}function C(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o;for(l=0;l<e.length;++l)m=e[l],A(b,m)&&(f=m,g=b,h=c),b>0&&y(m)&&(i=m),m.qSubNodes.length?(o=c+(b>0&&y(m)?0:1),a=C(a,b+1,o,d,m.qSubNodes,f,g,h,i,j,k)):(n=f.qText,i&&(n+=u(f)?" ":" - "+i.qText,i=null),B(a,g,h,f,d,j,k,n),++a);return a}function D(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q=0;for(g=0;g<d.length;++g)if(h=d[g],n=f.getDimInfo(b),o=!y(h)&&!t(h)&&!v(h),p=n?n.qLocked:!1,i=c.getRow(a),w(h)?(j=i.getNextCell(),j.type=c.CELL_TYPE_LEFT,j.dataValue=h.qElemNo,j.isDimensionValue=o,j.locked=p,j.setLeftHeader("",-4,1,2)):(j=i.getNextCell(),j.type=c.CELL_TYPE_LEFT,j.isDimensionValue=o,j.locked=p,(h.qCanCollapse||h.qCanExpand)&&(k=j,k.setLeftHeader("",h.qElemNo,1,1,e+a,b,u(h)),k.setCollapseExpandClass(h),j=i.getNextCell(),j.type=c.CELL_TYPE_LEFT,j.isDimensionValue=o,j.locked=p,q=1),m=h.qText,t(h)&&(m=n.othersLabel),j.setLeftHeader(m,h.qElemNo,1,2-q,e+a,b,u(h)),v(h)&&(j.addClass("bold"),i.addClass("bold"))),h.qSubNodes.length)l=D(a,b+1,c,h.qSubNodes,e,f),j.rowspan=l-a,k&&(k.rowspan=j.rowspan),a=l;else{var r=f.leftCellCnt-2*(b+1);r>0&&(j=i.getNextCell(),j.type=c.CELL_TYPE_LEFT,j.dataValue=h.qElemNo,j.isDimensionValue=o,j.locked=p,j.setLeftHeader("",-4,1,r)),++a}return a}function E(a,b,c,d){d.isIndentMode?C(0,0,0,a,b,null,-1,-1,null,c,d):D(0,0,a,b,c,d)}function F(a,b){var d,e;a.style.backgroundColor="",a.color.bgByExpression=!1,a.color.bgIsDark=!1,"U"!==b.qType&&b.qAttrExps&&b.qAttrExps.qValues&&b.qAttrExps.qValues.length&&(a.color.bgByExpression=!0,e="NaN"!==b.qAttrExps.qValues[0].qNum?b.qAttrExps.qValues[0].qNum:b.qAttrExps.qValues[0].qText,d=new c(e,"argb"),d.isInvalid()||(a.style.backgroundColor=d.toRGBA(),a.color.bgIsDark=d.isDark()&&d.getAlpha()>.5,a.addClass(a.color.bgIsDark?"color-light":"color-dark"))),a.style.color="",b.qAttrExps&&b.qAttrExps.qValues&&b.qAttrExps.qValues.length>1&&(e="NaN"!==b.qAttrExps.qValues[1].qNum?b.qAttrExps.qValues[1].qNum:b.qAttrExps.qValues[1].qText,d=new c(e,"argb"),d.isInvalid()||(a.style.color=d.toRGBA()))}function G(a,b,c,d,e){var f,g,h,i,j,k,l;for(f=0,h=b.length;h>f;++f)for(k=a.getNextRow(),0===a.leftTreeDepth&&k.addEmptyHeaderCell(c+f,d,1,1),i=Math.min(e.dataColumnsInfo.cnt,b[f].length),0===i&&0===f&&k.cells[k.nextCellIx-1].addClass("first-data-cell"),g=0;i>g;++g)l=k.getNextCell(),l.type=a.CELL_TYPE_DATA,j=b[f][g],l.setData(j.qText,1,1,c+f,d+g),l.addClass("data"),0===f&&0===g&&l.addClass("first-data-cell"),"U"===j.qType&&l.setNullClass(!0),isNaN(j.qNum)||l.addClass("numeric"),k.hasClass("bold")&&l.addClass("bold"),F(l,j)}function H(a,b,d,e,f,g,h){var i,j,k,m,o,p,r,s,t,u,v,w,x,y;for(x=new c(255,255,255,1),j=g.length,i=0;j>i;++i){for(p=b.getRow(d+i),o=g[i].length,m=0;o>m;++m)t=f.qLeft+m,s=g[i][m],k=l(t,a),r=p.getCell(e+m),r.type=b.CELL_TYPE_DATA,r.isOtherCell=s.qIsOtherCell,r.isTotalCell=s.qIsTotalCell,r.isOtherCell?r.value=k.othersLabel:r.value=s.qText,r.locked=k.qLocked,r.dataValue=s.qElemNumber,r.dataColIx=t,r.dataRowIx=h?f.qTop+f.qHeight-i-1:f.qTop+i,r.isNumeric=!isNaN(s.qNum),r.style.textAlign=q(k,r.isNumeric),r.isNullValue=r.isDimensionValue?-2===r.dataValue:s.qIsNull,r.isDimensionValue=!r.isNullValue&&n(k),r.selected=!1,r.selectedHighlighted=!1,r.rowspan=1,r.colspan=n(k)?2:1,r.style.backgroundColor="",r.color.bgByExpression=!1,r.color.bgIsDark=!1,!r.isNullValue&&s.qAttrExps&&s.qAttrExps.qValues&&s.qAttrExps.qValues.length&&(v="NaN"!==s.qAttrExps.qValues[0].qNum?s.qAttrExps.qValues[0].qNum:s.qAttrExps.qValues[0].qText,u=new c(v,"argb"),u.isInvalid()||(r.color.bgByExpression=!0,r.style.backgroundColor=u.toRGBA(),r.color.bgIsDark=u.isDark()&&u.getAlpha()>.5,y=c.getBlend(x,new c(u._r,u._g,u._b,1),u._a),r.color.fadeFromColor=new c(y._r,y._g,y._b,0).toRGBA(),r.color.fadeToColor=y.toRGBA(),1===b.headerRows.length&&(w=b.getHeaderRow(0).cells.filter(function(a){return a.dataColIx===r.dataColIx})[0],w.color.bgIsDark=u.isDark()))),r.style.color="",s.qAttrExps&&s.qAttrExps.qValues&&s.qAttrExps.qValues.length>1&&(v="NaN"!==s.qAttrExps.qValues[1].qNum?s.qAttrExps.qValues[1].qNum:s.qAttrExps.qValues[1].qText,u=new c(v,"argb"),u.isInvalid()||(r.style.color=u.toRGBA()));p.setNextCellIx(e+m)}b.setNextRowIx(d+i)}function I(a,b){var c,d,e,f;c=a.getHeaderRow(0),b.dataColumnsInfo.cnt>0&&b.leftCellCnt>0&&(d=c.addEmptyMetaCell(a.topTreeDepth+1,b.leftCellCnt,"left-meta"),d.templateSrc="pt-meta-left.ng.html",d.addClass("meta")),b.dataColumnsInfo.cnt>0&&(e=c.addEmptyMetaCell(1,b.dataColumnsInfo.cnt),e.addClass("top-meta").addClass("meta"),e.templateSrc="pt-meta-top.ng.html"),b.leftCellCnt>0&&(f=a.getHeaderRow(1),b.dataColumnsInfo.cnt>0&&a.topTreeDepth<=0&&f.addEmptyHeaderCell(-1,-1,1,b.dataColumnsInfo.cnt,"left")),a.setNextHeaderIx(Math.max(2,a.topTreeDepth+1))}function J(a,b){return b.length?J(a+1,b[0].qSubNodes):a}function K(a,c){function d(){return c.qHyperCube.qMeasureInfo.length>0&&c.qHyperCube.qGrandTotalRow.length>0}function e(){return d()&&c.totals&&(c.totals.show||"noTotals"!==c.totals.position)}function f(){return e()&&c.totals&&!c.totals.show&&"bottom"===c.totals.position?!1:!0}var g,h,i,j,k,l=a.headerRows[0].getCellSize();if(e()&&f())h=a.getNextHeaderRow();else{if(!e())return;h=a.getNextFooterRow()}for(g=0;l>g;++g)k=a.getHeaderCell(0,g),k.isSearchIcon||(j=h.getNextCell(),j.type=a.CELL_TYPE_TOP,j.tid=k.isSearchIcon?"st.total.search":"st.total",j.colIx=g,j.style={},j.colspan=k.isDimension?2:1,j.isDimension=!f()&&k.isDimension,j.isMeasure=k.isMeasure,k.isMeasure?(i=m(k.dataColIx,c),j.value=i.qText,j.isNumeric=!0):(j.value=0===g?void 0!==c.totals.label?c.totals.label:b.get("Object.Table.Totals"):" ",j.isNumeric=!1),k.info&&(j.style.textAlign=q(k.info,j.isNumeric)),j.isTotal=!0)}function L(a,b){var c,d,e,f=b.length;for(d=a.getNextHeaderRow(),c=0;f>c;++c)e=d.getNextCell(),e.type=a.CELL_TYPE_TOP,e.setFromMetaHeader(b[c])}function M(a,b){a.tid="st.header",a.qvaOutsideIgnoreFor="",a.isSearchIcon=!1,a.open=!1,a.isNumeric="N"===a.info.qDimensionType||void 0===a.info.qDimensionType,a.locked=a.info.qLocked,a.value=a.info.qFallbackTitle,a.canCollapse=!1,a.canExpand=!1,a.sortable=!0,a.rowspan=1,a.colspan=1,a.dataColIx=a.qLeft,a.isDimension=!!a.info.qDimensionType,a.fieldName=a.isDimension?a.info.qGroupFieldDefs[a.info.qGroupPos]:"",a.isMeasure=!a.isDimension,a.isSorted=a.dataColIx===b[0],a.reversed=!!a.info.qReverseSort,a.sortIndicator=a.info.qSortIndicator,a.style={},a.style.textAlign=q(a.info,a.isNumeric),a.color={}}function N(a,b,c){function d(a){return z>a?y[a]:A[a-z]}var e,f,g,h,i,j,k,l,n,o,p,q=b.width-(b.columnPicker.show?0:b.columnPicker.width),r=b.column.minWidth,s=b.column.minSearchWidth,t=b.column.glyphWidth,u=b.column.maxMeasureWidth,v=a.qHyperCube,w=v.columnOrder,x=w.length,y=v.qDimensionInfo,z=y.length,A=v.qMeasureInfo,B=r/q,C=24,D=C/q,E=s/q,F=0,G=14,H=[],I=[],J=Math.floor(q/t),K=Math.ceil(r/t),L=Math.ceil(C/t),N=Math.ceil(G/t),O=1,P=Math.floor(Math.min(q,u)/t)-N;for(b.columnPicker.show=!1,e=0;x>e&&J>0&&(j=d(w[e]),i=0,o=w[e]>=z,k=j.qApprMaxGlyphCount,o?(p=m(w[e],a),n=Math.min(p.qText.length,P),k=Math.min(k,P),l=Math.max(L,k,j.qFallbackTitle.length,n)):(l=K,i=Math.ceil(s/t)),l+=N,!(0>J-l&&0===H.length&&o))&&!(0>J-l&&H.length>0);++e)J-=l,h={info:j,isDimension:w[e]<z,isMeasure:o,grandTotal:p,qLeft:w[e],apprMaxGlyphCnt:k,calcApprMaxGlyphCnt:l,searchGlyphCnt:i},M(h,v.qEffectiveInterColumnSortOrder),H.push(h);for(b.columnCount=e,b.columnPicker.show=x>e,e=0,x=H.length;x>e;++e)h=H[e],h.isDimension?(h.bestFitWidthFactor=h.apprMaxGlyphCnt*t/q,h.widthFactor=B,I.push(h)):(h.bestFitWidthFactor=h.calcApprMaxGlyphCnt*t/q,h.widthFactor=Math.max(D,h.bestFitWidthFactor)),h.widthFactor+=G/q,O-=h.widthFactor;if(O>0){for(I.sort(function(a,b){return a.apprMaxGlyphCnt<b.apprMaxGlyphCnt}),e=0,f=I.length;f>e&&(h=I[e],g=0,h.bestFitWidthFactor>h.widthFactor&&(g=Math.max(0,Math.min(O,h.bestFitWidthFactor-h.widthFactor)),h.widthFactor+=g),!(0>=O));++e)O-=g;if(O>0)for(e=0;x>e;++e)h=H[e],h.widthFactor+=O/x}for(e=0,x=H.length;F+x>e;++e)h=H[e],h.isDimension?(H.splice(e+1,0,{isSearchIcon:!0,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+c,tid:"st.header.search",widthFactor:E,style:{width:100*E+"%"},fieldName:h.fieldName,dataColIx:h.dataColIx,colspan:1}),h.widthFactor-=E,h.style.width=100*h.widthFactor+"%",++F):h.style.width=100*h.widthFactor+"%";return H}a.service("qvGridObjectDataService",function(){return{getTopTreeDepth:function(a){return J(0,a.qTop)},getLeftTreeDepth:function(a){return J(0,a.qLeft)},updatePivotItems:function(a,b,c,d){var e=a.layout,f=a.grid,g=b[0].qTop,h=b[0].qLeft,i=b[0].qData,j=J(0,g),k=J(0,h),l=c[0],m=a.metaGhostHeaders,n=e.qHyperCube.qIndentMode,o=this.getPseudoDimIndex(e);f.reset(!1,d,o,n),f.setTopTreeDepth(j),f.setLeftTreeDepth(k),I(f,m),s(f,g,l.qLeft,m),E(f,h,l.qTop,m),G(f,i,l.qTop,l.qLeft,m),f.removeUnused()},updateStraightItems:function(a,b,c,d,e,f){var g,h=a.layout,i=a.grid,j=0,k=Math.min(b.length,a.scrollApi.settings.columnCount);for(d||i.reset(f),f||(L(i,c),K(i,h)),j=i.getNextRowIx(),g=0;k>g;++g)0!==b[g].length&&H(h,i,j,g,b[g].qArea,b[g].qMatrix,e);d&&i.setNextRowIx(i.rows.length),i.removeUnused()},getPseudoDimIndex:function(a){var b=a.qHyperCube.qEffectiveInterColumnSortOrder.indexOf(-1);return~b?b:a.qHyperCube.qEffectiveInterColumnSortOrder.length},getColumnInfo:l,getColumnCells:e,getCellsInColumnWithValue:f,getCellsInColumn:g,getCellsInRow:h,getSiblingCells:j,getSiblingCellsWithValue:k,getCellInColumnWithRowIndex:i,columnOrder:{get:d},getStraightMetaHeaders:N}})}),define("objects.grid/services/selections",["qvangular","util","objects.grid/services/data-service","objects.grid/directives/selections"],function(a,b){"use strict";a.service("qvGridObjectSelectionService",["$timeout","$document","qvGridObjectDataService",function(a,c,d){var e;return e={$new:function(){var a={active:!1,currentDataColIx:-1,currentDataRowIx:-1,currentCell:void 0,activationCell:void 0,dataValues:{},unbindKeyboard:null};return Object.defineProperties(a,{dataValuesArray:{get:function(){var a,b=[],c=Object.keys(this.dataValues),d=c.length;for(a=0;d>a;++a)b.push(parseInt(c[a]));return b}},selectedIndices:{get:function(){var a,b=[],c=this.dataValuesArray,d=c.length;for(a=0;d>a;++a)b.push(this.dataValues[c[a]]);return b}}}),a},init:function(a,b,c,d,f,g){a.confirm=function(){b.endSelections(!0),a.deactivated(),e.reset(c),e.hide(c),d()},a.cancel=function(){b.endSelections(!1),a.deactivated(),e.reset(c),e.hide(c),f()},a.clear=function(){c.dataValues={},g(),e.reset(c),b.clearSelections()}},reset:function(a){a.dataValues={},a.currentDataColIx=-1,a.currentDataRowIx=-1,a.currentCell=void 0},show:function(a,c){a.active||(a.currentDataColIx=c.dataColIx,a.currentDataRowIx=c.dataRowIx,a.activationCell=b.extend(!0,{},c),a.active=!0)},hide:function(a){a.active=!1},bindKeyboard:function(a,b){var d=".selections-keyboard-"+b;return c.on("keyup"+d,function(b){27===b.which?a.cancel():13===b.which&&a.confirm()}),function(){c.off(d)}},isColumnar:function(a,b){return b.type===a.CELL_TYPE_LEFT||b.type===a.CELL_TYPE_DATA},selectValue:function(a,b,c){c.dataValues[b.dataValue]=e.isColumnar(a,b)?b.dataRowIx:b.dataColIx,c.currentDataColIx=b.dataColIx,c.currentDataRowIx=b.dataRowIx},selectCell:function(a,b,c){a.gridType===a.GRID_TYPE_PIVOT?(b[c?"addClass":"removeClass"]("selected-highlighted"),b[c?"removeClass":"addClass"]("selected")):(b.selectedHighlighted=c?!0:!1,b.selected=c?!1:!0)},lockCell:function(a,b){a.gridType===a.GRID_TYPE_PIVOT?b.addClass("locked"):b.isSelectLocked=!0},deselectValue:function(a,b,c){delete c.dataValues[b.dataValue]},deselectCell:function(a,b){a.gridType===a.GRID_TYPE_PIVOT?(b.removeClass("selected-highlighted"),b.removeClass("selected")):(b.selectedHighlighted=!1,b.selected=!1)},unlockCell:function(a,b){a.gridType===a.GRID_TYPE_PIVOT?b.removeClass("locked"):b.isSelectLocked=!1},getSelectionType:function(a,b){var c={};return c[a.CELL_TYPE_TOP]="T",c[a.CELL_TYPE_LEFT]="L",c[a.CELL_TYPE_DATA]="D",c[b]},sendSelection:function(a,b,c,d,f){var g,h,i,j=c.selectedIndices;0!==j.length&&(e.isColumnar(d,c.currentCell)?(g=[c.currentDataColIx],h=c.selectedIndices):(g=c.selectedIndices,h=[c.currentDataRowIx]),i=e.getSelectionType(d,f.type),b.selectionsMade=!0,a.select(h,g,i))},getCellCountWithDataValue:function(a,b,c){var d,f,g,h=[],i=0,j=b.length;if(0===j)return 0;for(g=0;j>g;++g)f=b[g],d=e.isColumnar(a,f)?f.dataColIx:f.dataRowIx,f.dataValue===c&&-1===h.indexOf(d)&&(h.push(d),i++);return i},getSiblingCell:function(a,b){return a.gridType===a.GRID_TYPE_PIVOT?b.currentCell:b.activationCell},selectDimensionCells:function(a,c,f,g,h,i){var j,k,l=h.dataValue,m=l in f.dataValues,n=d.getSiblingCells(g,e.getSiblingCell(g,f)||h);if(-1!==n.indexOf(h)&&(k=h.type===g.CELL_TYPE_TOP?a.getSize().qcx:a.getSize().qcy,j=e.getCellCountWithDataValue(g,n,l),k!==j||!i||!m))return n.forEach(function(a){a.dataValue in f.dataValues&&e.selectCell(g,a)}),i&&m?(e.deselectValue(g,h,f),n.forEach(function(a){a.dataValue===l&&e.deselectCell(g,a)})):m?i||(n.forEach(function(a){a.dataValue===l&&e.selectCell(g,a)}),e.selectCell(g,h,!0)):(e.selectValue(g,h,f),n.forEach(function(a){a.dataValue===l&&e.selectCell(g,a)}),e.selectCell(g,h,!0)),f.currentCell=b.extend(!0,{},h),function(){0===f.dataValuesArray.length?c.clear():e.sendSelection(a,c,f,g,h)}},selectDimensionValue:function(a,b,c,d,f,g,h){var i,j=e.activateSelections(a,b,c,d,f);return f.locked||f.isNullValue||(i=e.selectDimensionCells(b,c,d,g,f,h),i&&i()),j},activateSelections:function(b,c,d,f,g){return f.active||g.locked||(c.beginSelections(),e.show(f,g),f.unbindKeyboard=e.bindKeyboard(d,b),a(function(){d.activated(!0)})),function(){f.unbindKeyboard()}},updateStraight:function(a,b,c){var f,g,h,i;if(b.dataValuesArray.length)for(i=d.getSiblingCells(a,c),h=i.length,f=0;h>f;++f)g=i[f],g.dataValue in b.dataValues&&(e.selectCell(a,g),b.currentDataRowIx===g.dataRowIx&&e.selectCell(a,g,!0))},updatePivot:function(a,b,c){var f,g,h,i;if(b.dataValuesArray.length)for(i=d.getSiblingCells(a,c),h=i.length,f=0;h>f;++f)g=i[f],g.dataValue in b.dataValues&&e.selectCell(a,g)}}}])}),define("text!extensions.qliktech/straight-table/layout/top/straight-table-top-header.ng.html",[],function(){return'<div class="qv-st-header" tid="qv-st-header-top" ng-style="scrollApi.topBottomStyle">\r\n	<table qva-delegated-activate=".qv-st-header-sortable#interactive && !selections.active && sortHeader($event);\r\n		   .qv-st-header-cell-search:not(.qv-st-total-cell)#interactive && !selections.active && searchHeader($event)">\r\n		<colgroup class="qv-st-columns">\r\n			<col ng-repeat="header in grid.headerRows[0].cells"\r\n				 ng-style="header.style"\r\n				 ng-class="header.classList" />\r\n		</colgroup>\r\n		<tbody>\r\n			<tr ng-repeat="row in grid.headerRows">\r\n				<th ng-repeat="header in row.cells"\r\n					tid="{{header.tid}}"\r\n					class="qv-st-header-cell"\r\n					qva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\r\n					ng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\r\n					\'qv-st-header-sortable\': header.sortable,\r\n					\'qv-st-total-cell\': header.isTotal,\r\n					\'qv-st-header-cell-dimension\': header.isDimension,\r\n					\'qv-st-header-cell-search\': header.isSearchIcon,\r\n					\'qv-st-header-cell-search-open\': header.isSearchIcon && header.open }"\r\n					colspan="{{header.colspan}}">\r\n					<qv-straight-table-header-cell ng-if="!header.isSearchIcon"></qv-straight-table-header-cell>\r\n					<qv-straight-table-header-cell-search ng-if="!header.isTotal && header.isSearchIcon"></qv-straight-table-header-cell-search>\r\n				</th>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/top/straight-table-top-header",["qvangular","jquery","text!./straight-table-top-header.ng.html"],function(a,b,c){"use strict";a.directive("qvStraightTableTopHeader",function(){return{restrict:"E",replace:!0,template:c,link:function(a,c,d){a.sortHeader=function(c){a.$eval(d.onSortHeader,{header:b(c.target).scope().header})},a.searchHeader=function(c){var e=b(c.target).closest(".qv-st-header-cell"),f=e.scope().header;c.preventDefault(),a.$eval(d.onSearch,{$alignTo:e,header:f})}}}})}),define("text!extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell.ng.html",[],function(){return'<div class="qv-st-header-cell-wrapper">\r\n	<div class="qv-st-fade-out"\r\n		 ng-class="{ \'qv-st-header-selections-active\': header.selectionsActive }" title="{{header.value}}">\r\n		<i ng-class="{\'icon-toolbar-locked\': header.locked }"></i><span>{{header.value}}</span>\r\n	</div>\r\n	<i ng-if="header.isSorted && header.sortIndicator !== \'N\'"\r\n		class="qv-st-sorting-indicator"\r\n		ng-class="{ \'icon-triangle-top\': header.sortIndicator === \'A\', \'icon-triangle-bottom\': header.sortIndicator === \'D\', \'icon-triangle-light\': header.color.bgIsDark && !header.reversed }"\r\n		ng-style="header.sortStyle"></i>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell",["qvangular","text!./straight-table-header-cell.ng.html"],function(a,b){"use strict";a.directive("qvStraightTableHeaderCell",[function(){return{restrict:"E",replace:!0,template:b,link:function(a,b){var c=b.closest(".qv-st-header-cell");a.$watch("!header.isTotal && selections.currentDataColIx === header.dataColIx",function(b){return b?(a.header.addClass("qv-st-active-col"),void(a.selectionsApi.getDockToElement=function(){return c})):void(-1!==a.selections.currentDataColIx&&a.header.removeClass("qv-st-active-col"))})}}}]),a.directive("qvStraightTableHeaderCellSearch",[function(){return{restrict:"E",replace:!0,template:'<i class="icon-magnifying-glass" q-title-translation="Common.Search"></i>',link:function(a,b){var c=b.closest(".qv-st-header-cell");a.$watch("!header.isTotal && selections.currentDataColIx === header.dataColIx",function(b){return b?(a.header.addClass("qv-st-active-col"),void(a.selectionsApi.getSelectionToolbarWidthOffset=function(){return c[0].getBoundingClientRect().width+1})):void(-1!==a.selections.currentDataColIx&&a.header.removeClass("qv-st-active-col"))})}}}])}),define("text!extensions.qliktech/straight-table/layout/data/straight-table-data.ng.html",[],function(){return'<div class="qv-st-data" ng-class="{ \'align-bottom\': scrollApi.alignBottom }" tid="qv-st-data">\r\n	<qv-scroll-load-button ng-show="interactive && scrollApi.loadPrevious" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true">\r\n	</qv-scroll-load-button>\r\n	<table ng-style="dataTableHeight">\r\n		<colgroup class="qv-st-columns">\r\n			<col ng-repeat="header in grid.headerRows[0].cells"\r\n				 ng-style="header.style"\r\n				 ng-class="header.classList" />\r\n		</colgroup>\r\n		<tbody>\r\n			<tr ng-repeat="row in grid.rows" class="qv-st-data-row" ng-class="{ \'qv-grid-object-data-first-row\': $first, \'qv-grid-object-data-last-row\': $last }">\r\n				<td ng-repeat="cell in row.cells" class="qv-st-data-cell"\r\n					rowspan="{{ cell.rowspan }}"\r\n					colspan="{{ cell.colspan }}"\r\n					ng-style="cell.style"\r\n					ng-class="{ \'qv-st-data-cell-dimension-value\' : cell.isDimensionValue,\r\n						\'qv-st-data-cell-numeric\': cell.isNumeric,\r\n						\'qv-st-data-cell-selected\': cell.selected,\r\n						\'qv-st-data-cell-selected-highlighted\': cell.selectedHighlighted,\r\n						\'qv-st-data-cell-null-value\': cell.isNullValue,\r\n						\'qv-st-data-cell-locked\': cell.isSelectLocked,\r\n						\'qv-st-data-cell-color-dark\': cell.color.bgByExpression && !cell.color.bgIsDark,\r\n						\'qv-st-data-cell-color-light\': cell.color.bgByExpression && cell.color.bgIsDark }">\r\n					<qv-straight-table-data-cell></qv-straight-table-data-cell>\r\n				</td>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n	<qv-scroll-loader class="qv-scroll-row-loader"></qv-scroll-loader>\r\n	<qv-scroll-load-button ng-show="interactive && scrollApi.loadNext" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/data/straight-table-data",["qvangular","text!./straight-table-data.ng.html"],function(a,b){"use strict";a.directive("qvStraightTableData",[function(){return{restrict:"E",replace:!0,template:b}}])}),define("text!extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell.ng.html",[],function(){return'<div ng-class="{ \'qv-st-fade-out\': !cell.color.bgByExpression, \'qv-st-fade-out-bgr-expr\': cell.color.bgByExpression}" title="{{cell.value}}">\r\n	{{cell.value}} <div ng-if="cell.color.bgByExpression && !cell.isNumeric" class="qv-st-fade-out-bgr-expr-overlay" ng-attr-style="background-image: linear-gradient(to right, {{cell.color.fadeFromColor}}, {{cell.color.fadeToColor}});"></div>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell",["qvangular","text!./straight-table-data-cell.ng.html"],function(a,b){"use strict";a.directive("qvStraightTableDataCell",[function(){return{restrict:"E",replace:!0,template:b,link:function(){}}}])}),define("text!extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header.ng.html",[],function(){return'<div class="qv-st-bottom-header" tid="qv-st-bottom-header" ng-style="topBottomStyle">\r\n	<table>\r\n		<colgroup class="qv-st-columns">\r\n			<col ng-repeat="header in grid.headerRows[0].cells"\r\n				 ng-style="header.style"\r\n				 ng-class="header.classList" />\r\n		</colgroup>\r\n		<tbody>\r\n			<tr ng-repeat="row in grid.footerRows">\r\n				<th ng-repeat="header in row.cells"\r\n					tid="{{header.tid}}"\r\n					class="qv-st-header-cell"\r\n					ng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\r\n					\'qv-st-total-cell\': header.isTotal,\r\n					\'qv-st-header-cell-dimension\': header.isDimension,\r\n					\'qv-st-header-cell-measure\': header.isMeasure,\r\n					\'qv-st-header-cell-search\': header.isSearchIcon }"\r\n					colspan="{{header.colspan}}">\r\n					<qv-straight-table-header-cell></qv-straight-table-header-cell>\r\n				</th>\r\n			</tr>\r\n		</tbody>\r\n	</table>\r\n</div>\r\n'}),define("extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header",["qvangular","text!./straight-table-bottom-header.ng.html"],function(a,b){"use strict";a.directive("qvStraightTableBottomHeader",function(){return{restrict:"E",replace:!0,template:b,link:function(){}}})}),define("client.property-panel/components/components",[],function(){function a(a){var b=a.component;if("string"==typeof b)return e[b]?e[b]:(window.console.log('Error! No component found with name "'+b+'"'),e.missing);if("object"==typeof b)return b;switch(a.type){case"items":return e.items;case"string":return e.string;case"integer":return e.integer;case"number":return e.number;case"boolean":return e.checkbox;case"array":return a.items?e.list:e.slider;default:return a.type?(window.console.log('Error! No component found for type "'+a.type+'"'),e.missing):(window.console.log('Warning! Missing component/type in definition. Using "items" component.'),e.items)}}function b(a){return e[a]}function c(a){return!!b(a)}function d(a,b){if(e[a])throw"Property panel component already loaded: "+a;e[a]=b}var e={missing:{template:"<div></div>",controller:[function(){}]}};return{getComponent:b,hasComponent:c,findComponent:a,addComponent:d}}),define("text!client.property-panel/popovers/type-popover.ng.html",[],function(){return'<immidiate-contextual width="150" align-to="alignTo" position="\'bottom\'" on-close-view="closeTypeFoldout(event)" class="pp-type-popover" tid="pp-type-popover">\r\n	<ul class="qui-icontextlist">\r\n		<li ng-repeat="item in items" tid="{{item.tid}}" ng-class="{ \'qui-disabled\': item.disabled() }" qva-activate="itemClicked($event,item);">\r\n			<span class="qui-textlist-text" q-translation="{{item.translation}}"></span>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>'}),define("client.property-panel/popovers/type-popover",["text!./type-popover.ng.html"],function(a){return{template:a,controller:["$scope",function(a){a.itemClicked=function(a,b){a.preventDefault(),b.disabled()||b.select()}}],scope:{items:"=",alignTo:"=",closeTypeFoldout:"="}}}),define("general.sortable/sortable-list-service",["jquery","qvangular"],function(a,b){"use strict";b.service("qvSortableListDragService",[function(){var b;return b={$new:function(){return{fromItem:void 0,enterItem:void 0,enterList:void 0,toItem:void 0,offsetX:0,offsetY:0,left:0,top:0,direction:void 0,clientRect:void 0,scroll:{},pageX:0,pageY:0}},startOffset:function(a,b,c,d){var e=c.offsetParent(),f=c.position();b.left=f.left+e[0].scrollLeft,b.top=f.top+e[0].scrollTop,b.offsetX=b.left-d.x-e[0].scrollLeft,b.offsetY=b.top-d.y-e[0].scrollTop},startData:function(a,b,c,d){b.scroll.clientRect=a[0].getBoundingClientRect(),b.scroll.width=a[0].scrollWidth,b.scroll.height=a[0].scrollHeight,b.clientRect=c[0].getBoundingClientRect(),b.minLeft=-b.clientRect.width,b.maxLeft=b.scroll.width,b.minTop=-b.clientRect.height,
b.maxTop=b.scroll.height-b.clientRect.height,b.fromItem=c.scope()[d],b.toItem=void 0,b.enterItem=void 0,b.enterList=void 0},updateData:function(c,d,e,f,g,h,i,j,k,l,m){function n(a){return a.length&&b.isChild(c[0],a[0])}var o,p,q,r,s=function(){};d.pageX=f,d.pageY=g,d.pageX<=d.scroll.clientRect.left?d.pageX=d.scroll.clientRect.left+1:d.pageX>=d.scroll.clientRect.left+d.scroll.clientRect.width&&(d.pageX=d.scroll.clientRect.left+d.scroll.clientRect.width-1),d.pageY<=d.scroll.clientRect.top?d.pageY=d.scroll.clientRect.top+1:d.pageY>=d.scroll.clientRect.top+d.scroll.clientRect.height&&(d.pageY=d.scroll.clientRect.top+d.scroll.clientRect.height-1);var t=e[0].style.display;e[0].style.display="none",p=document.elementFromPoint(d.pageX,d.pageY),o=a(p).closest(j),n(o)?s=function(a){q=a.scope()[k],d.enterItem!==q&&(d.enterList=void 0,d.enterItem=q,d.toItem=d.enterItem,l())}:(o=a(p).closest(h),n(o)?s=function(a){r="function"==typeof i?i(a):a.scope()[i],d.enterList!==r&&(d.enterList=r,d.enterItem=void 0,d.toItem=void 0,m())}:d.enterItem=void 0),e[0].style.display=t,s(o)},start:function(a,b,c){c[0].style||(c[0].style=""),c[0].style.position="absolute",c[0].style.width=b.clientRect.width+"px",c[0].style.height=b.clientRect.height+"px",c[0].style.pointerEvents="none",c[0].style.left=b.left+"px",c[0].style.top=b.top+"px",c[0].style.zIndex=1},update:function(a,b,c,d){var e,f;switch(b.direction){case"horizontal":b.left=d.currentPoint.x+b.offsetX+a[0].scrollLeft;break;case"vertical":b.top=d.currentPoint.y+b.offsetY+a[0].scrollTop;break;default:b.left=d.currentPoint.x+b.offsetX+a[0].scrollLeft,b.top=d.currentPoint.y+b.offsetY+a[0].scrollTop}e=b.left,f=b.top,b.left<b.minLeft?e=b.minLeft:b.left>b.maxLeft&&(e=b.maxLeft),b.top<b.minTop?f=b.minTop:b.top>b.maxTop&&(f=b.maxTop),c[0].style.left=e+"px",c[0].style.top=f+"px"},end:function(a,b){a.stopAutoScrolling&&(a.stopAutoScrolling(),a.stopAutoScrolling=null),b&&b.length&&b[0].removeAttribute("style")},isParent:function(a,b){return a===b},isChild:function(a,c){var d=c;if(b.isParent(a,c))return!1;for(;d;){if(d===a)return!0;d=d.parentNode}return!1},autoScroll:function(a,b,c,d,e,f,g,h){function i(e,g){if(k=a.scrollLeft,l=a.scrollTop,j){if(0>e&&0===k)return void(j=!1);if(e>0&&k+parseInt(b.height+.5,10)>=c)return void(j=!1);if(0>g&&0===l)return void(j=!1);if(g>0&&l+parseInt(b.height+.5,10)>=d)return void(j=!1);0!==e&&(a.scrollLeft+=e),0!==g&&(a.scrollTop+=g),f(),setTimeout(function(){i(e,g)})}}var j=!0,k=0,l=0,m=0,n=0;switch(e.direction){case"horizontal":e.pageX<=b.left+h?m=-g:e.pageX>=b.left+b.width-h&&(m=g);break;case"vertical":e.pageY<=b.top+h?n=-g:e.pageY>=b.top+b.height-h&&(n=g);break;default:e.pageY<=b.top+h?n=-g:e.pageY>=b.top+b.height-h&&(n=g)}return(0!==m||0!==n)&&i(m,n),e.stopAutoScrolling&&(e.stopAutoScrolling(),delete e.stopAutoScrolling),e.stopAutoScrolling=function(){j=!1},e.stopAutoScrolling}}}])}),define("general.sortable/sortable-list",["core.utils/class","util","jquery","qvangular","touche","general.utils/dom-util","general.sortable/sortable-list-service"],function(a,b,c,d,e,f){"use strict";var g=a.extend("DefaultSortableList",{init:function(a){this.options=b.extend(!0,{gesture:{name:"swipe",options:{radiusThreshold:2,preventDefault:!1}},direction:"",scrollSelector:"",listSelector:"",listKey:"",itemSelector:"[ng-repeat]",itemDragSelector:"[ng-repeat]",itemKey:"$index"},a||{})},onBegin:function(){},onEnter:function(){},onEnterList:function(){},onMove:function(){},onMoveToList:function(){},onCancel:function(){},allowDrag:function(a){return e.utils.isMouse(a)?!!c(a.target).closest(this.options.itemSelector).length:!!c(a.target).closest(this.options.itemDragSelector).length},allowScroll:function(a){return!this.allowDrag(a)},allowEnter:function(){return!0},allowAutoScroll:function(){return!0},onAutoScroll:function(a){a()},getGesture:function(){return this.options.gesture},getDirection:function(){return this.options.direction},getScrollSensitivity:function(a){return e.utils.isMouse(a)?15:25},getScrollSpeed:function(a){return e.utils.isMouse(a)?15:25}});return d.directive("qvSortableList",["$parse","qvSortableListDragService",function(a,b){return{restrict:"A",controller:function(){},link:function(a,d,h,i){var j=a.$watch(h.qvSortableList,function(h){function k(){return n=void 0,e(d[0])[q.name](v).tap(u),e(m[0]).tap({id:"sortable-list-tap-"+a.$id,options:{preventDefault:!1},start:function(a){h.allowScroll(a)||f.isInput(a.target)||a.preventDefault()}}),function(){e(m[0]).off("*","sortable-list-tap-"+a.$id),e(d[0]).off("*",t)}}if(j(),!(h instanceof g)){var l=g.extend(h||{});h=new l(h&&h.options)}var m=d.closest(h.options.scrollSelector);m.length||(m=d);var n,o,p,q,r,s=b.$new(),t="sortable-list-"+a.$id,u={id:t,options:{preventDefault:!1},start:function(a,d){if(n=void 0,!f.isInput(a.target)&&b.isChild(m[0],a.target)&&h.allowDrag(a)){if(n=c(a.target).closest(h.options.itemSelector),0===n.length)return void(n=void 0);s.direction=h.getDirection(),o=h.getScrollSpeed(a),p=h.getScrollSensitivity(a),b.startOffset(m,s,n,d.pagePoints[0]),b.startData(m,s,n,h.options.itemKey)}},end:function(){n=void 0}},v={id:t,start:function(c){return n?(c.preventDefault(),h.onBegin(s.fromItem,s.clientRect),a.$digest(),void b.start(m,s,n)):void this.cancel()},update:function(c,d){function e(){b.update(m,s,n,d.swipe),b.updateData(m,s,n,d.pagePoints[0].x,d.pagePoints[0].y,h.options.listSelector,h.options.listKey,h.options.itemSelector,h.options.itemKey,function(){f()},function(){h.onEnterList(s.enterList),a.$digest()})}function f(){h.allowEnter(s.enterItem,s.fromItem)?(h.onEnter(s.enterItem),a.$digest()):(s.enterItem=void 0,s.toItem=void 0)}if(!n)return void this.cancel();if(e(),h.allowAutoScroll()){var g=b.autoScroll.bind(this,m[0],s.scroll.clientRect,s.scroll.width,s.scroll.height,s,e,o,p);h.onAutoScroll(g,s.enterList,s.enterItem,function(a,c,d,f){b.autoScroll(a,c,d,f,s,e,o,p)})}},end:function(){b.end(s,n),void 0!==s.toItem?(h.onMove(s.fromItem,s.toItem),a.$digest()):void 0!==s.enterList?(h.onMoveToList(s.fromItem,s.enterList),a.$digest()):(h.onCancel(),a.$digest()),n=void 0},cancel:function(){n&&(b.end(s,n),h.onCancel(),n=void 0)}};q=h.options.gesture,v.options=q.options,a.$on("$destroy",function(){e(m[0]).off("*","sortable-list-tap-"+a.$id),e(d[0]).off("*",t)}),i.on=function(){r||(r=k())},i.off=function(){r&&(r(),r=void 0)},i.cancel=function(){v.cancel()},i.on()})}}}]),g}),define("general.sortable/sortable-item-lists",["core.utils/class","general.sortable/sortable-list"],function(a,b){"use strict";var c={Dimensions:1,Measures:2,Placeholder:16,Locked:32},d=a.extend("SortableItem",{init:function(a,b,c,d){this.title=a,this.id=b,this.classList=c||[],this.typeFlag=d||1},addClass:function(a){if(a){var b=this.classList.indexOf(a);return-1===b&&this.classList.push(a),this}},removeClass:function(a){if(a){var b=this.classList.indexOf(a);return-1!==b&&this.classList.splice(b,1),this}},hasClass:function(a){return-1!==this.classList.indexOf(a)}}),e=a.extend("SortableItemList",{init:function(a,b){this.items=[],this.disabled=!1,this.typeFlag=a||1,Object.keys(b||{}).forEach(function(a){this[a]=b[a]},this)},add:function(a,b,c,e){var f=new d(a,b,c,e);return this.items.push(f),f},addItem:function(a){if(!(a instanceof d))throw new Error("item not instance of SortableItem");return this.items.push(a),a},createItem:function(a){var b=new d;return Object.keys(a||{}).forEach(function(c){b[c]=a[c]}),b},moveItem:function(a,b){this.items.splice(b,0,this.items.splice(a,1)[0])},getItemByIndex:function(a){return this.items[a]},getItemById:function(a){return this.get(function(b){return b.id===a})[0]},getIndexByItem:function(a){return this.items.indexOf(a)},get:function(a){return this.items.filter(a||function(){return!0})},getLockedIndices:function(){return this.get(function(a){return!!(a.typeFlag&c.Locked)}).map(function(a){return this.getIndexByItem(a)},this)},reset:function(){this.items.length=0,this.disabled=!1},isEmpty:function(){return 0===this.items.length}});Object.defineProperties(e.prototype,{length:{get:function(){return this.items.length}}});var f=b.extend("SortableItemLists",{init:function(){this._super.apply(this,arguments),this.lists=[],this.dragPlaceholder=null},addPlaceholder:function(a){var b=this.getList(a),e=b.items.indexOf(a);return this.dragPlaceholder=new d("","placeholder",[],c.Placeholder),b.items.splice(e,0,this.dragPlaceholder),this.dragPlaceholder.style={visibility:"hidden"},this.dragPlaceholder},removePlaceholder:function(){if(this.dragPlaceholder){var a=this.getList(this.dragPlaceholder),b=a.items.indexOf(this.dragPlaceholder);-1!==b&&(a.items.splice(b,1),this.dragPlaceholder=null)}},getPlaceholder:function(){return this.dragPlaceholder},createList:function(a,b){var c=new e(a,b);return this.lists.push(c),c},reset:function(){this.lists.forEach(function(a){a.reset()})},getList:function(a){return this.lists.filter(function(b){return-1!==b.items.indexOf(a)})[0]},disable:function(a){this.lists.forEach(function(b){b.disabled=!(a.typeFlag&b.typeFlag)})},enable:function(){this.lists.forEach(function(a){a.disabled=!1})},moveItem:function(a,b){var c,d,e=this.getList(a),f=this.getList(b);e&&f&&(d=f.items.indexOf(b),c=e.items.indexOf(a),e.items.splice(c,1),f.items.splice(d,0,a))},onBegin:function(a,b){this.addPlaceholder(a,b),this.disable(a)},onEnter:function(a){var b=this.getList(a),c=b.getLockedIndices();this.moveItem(this.dragPlaceholder,a);var d=b.getLockedIndices();c.forEach(function(a,c){b.moveItem(d[c],a)})},onEnterList:function(a){if(!a.disabled){var b=this.getList(this.dragPlaceholder),c=b.getIndexByItem(this.dragPlaceholder);b.items.splice(c,1),a.items.push(this.dragPlaceholder)}},onMove:function(a){var b=this.dragPlaceholder;this.moveItem(a,b),this.removePlaceholder(),this.enable()},onMoveToList:function(a,b){if(!b.disabled){var c=this.getList(a),d=c.items.indexOf(a);if(c===b)return void this.onMove(a);c.items.splice(d,1),b.items.push(a)}this.removePlaceholder(),this.enable()},onCancel:function(){this.removePlaceholder(),this.enable()},allowEnter:function(a,b){return!!(b.typeFlag&this.getList(a).typeFlag)}});return f.create=function(a){var b=f.extend(a||{});return a=new b(a&&a.options)},f}),define("extensions.qliktech/straight-table/properties/columns/columns-sorting-util",["general.utils/array-util"],function(a){function b(a){function b(){for(var a=[],b=0;b<d.length+e.length;b++)a.push(b);return a}var d=a.qDimensions,e=a.qMeasures;c(d,e,a.columnOrder)&&(a.columnOrder=b()),c(d,e,a.qInterColumnSortOrder)&&(a.qInterColumnSortOrder=b())}function c(a,b,c){var d={},e=[],f=!1;c.forEach(function(a){d[a]?f=!0:d[a]=!0}),f=f||a.length+b.length!==Object.keys(d).length,Object.keys(d).forEach(function(a){e.push(parseInt(a,10))}),e=e.sort(function(a,b){return a-b});for(var g=0;g<e.length;++g)f=f||e[g]!==g;return f}function d(c){function d(){for(var b=0;b<k.length;b++)if(k[b]!==b){var c=k[b],d=k.indexOf(b),e=k[d];a.swap(k,b,d),a.swap(g,c,e),a.swap(i,i.indexOf(c),i.indexOf(e)),a.swap(j,j.indexOf(c),j.indexOf(e))}}function e(){for(var b=0;b<l.length;b++)if(l[b]!==b+g.length){var c=l[b],d=l.indexOf(b+g.length),e=l[d];a.swap(l,b,d),a.swap(h,c-g.length,e-g.length),a.swap(i,i.indexOf(c),i.indexOf(e)),a.swap(j,j.indexOf(c),j.indexOf(e))}}b(c);for(var f,g=c.qDimensions,h=c.qMeasures,i=c.columnOrder,j=c.qInterColumnSortOrder,k=[],l=[],m=0;m<i.length;m++)f=i[m],f<g.length?k.push(f):l.push(f);d(),e()}return{validateTableHyperCube:b,fixTableHypercubeOrders:d,isInvalidOrderArray:c}}),define("text!client.property-panel/components/common/data.ng.html",[],function(){return'<div class="pp-component pp-list-component pp-toplist" tcl="data">\r\n	<button class="qui-outlinebutton pp-toplist-add-button" qva-activate="addClicked($event)" qv-enter="addClicked($event)"\r\n			ng-disabled="addDisabled()" tid="add-data">\r\n		{{getAddLabel()}}\r\n		<i class="toggle-expand icon-triangle-bottom" ng-if="hasMultipleAddOptions()"></i>\r\n	</button>\r\n\r\n	<div class="pp-toplist-content pp-data-container" qv-sortable-list="sortableItemLists">\r\n		<div class="pp-data" ng-repeat="list in sortableItemLists.lists" tid="{{list.tid}}" ng-class="{ \'disabled\': list.disabled }" ng-if="list.show() != false">\r\n			<div class="pp-data-header ">\r\n				<span class="pp-data-header-text">{{list.title}}</span>\r\n			</div>\r\n\r\n			<ul class="pp-expandable-list pp-data-list">\r\n				<li ng-repeat="item in list.items track by item.id" ng-include src="item.templateSrc" ng-class="item.classList"></li>\r\n			</ul>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!general.components/context-menu/context-menu.ng.html",[],function(){return'<div class="qui-immidiateContextual qv-contextmenu" tid="context-menu" qva-outside="close($event)">\r\n	<div class="content">\r\n		<ul class="qui-textlist">\r\n			<li ng-if="levels.length" class="qv-contextmenu-item-container back">\r\n				<div class="qv-contextmenu-item" qva-activate="goBack();" tcl="context-menu-item">\r\n					<i class="icon-triangle-left back-icon"></i>\r\n					<span class="qui-textlist-text" q-translation="Common.Back" tid="context-menu-back"></span>\r\n				</div>\r\n			</li>\r\n			<li ng-repeat="item in currentItems" class="qv-contextmenu-item-container">\r\n				<div class="qv-contextmenu-item" ng-class="{ \'qv-contextmenu-has-submenu\': item.hasSubmenu(), \'has-icon\': item.hasIcon() }"\r\n					 qva-activate="selectItem($event,item)" tcl="context-menu-item">\r\n					<i class="item-icon {{item.icon}}" ng-if="item.hasIcon()"></i>\r\n					<span class="qui-textlist-text" title="{{item.getLabel()}}" tid="{{item.tid}}">{{item.getLabel()}}</span>\r\n					<i ng-show="item.hasSubmenu()" class="icon-triangle-right"></i>\r\n				</div>\r\n			</li>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'}),define("general.components/context-menu/context-menu",["jquery","general.utils/window-positioner","core.utils/resize","text!./context-menu.ng.html"],function(a,b,c,d){"use strict";function e(a,b,c,d){switch(b){case"BottomLeft":c-=a.outerWidth();break;case"Bottom":c-=a.outerWidth()/2;break;case"BottomRight":break;case"Left":c-=a.outerWidth(),d-=a.outerHeight()/2;break;case"Center":c-=a.outerWidth()/2,d-=a.outerHeight()/2;break;case"Right":d-=a.outerHeight()/2;break;case"Top":d-=a.outerHeight(),c-=a.outerWidth()/2;break;case"TopRight":default:d-=a.outerHeight()}return{left:c,top:d}}function f(b,c){var d=a(window),e=10,f=e,g=d.outerWidth()-b.outerWidth()-e,h=Math.max(f,Math.min(g,c.left)),i=e,j=d.outerHeight()-b.outerHeight()-e,k=Math.max(i,Math.min(j,c.top));return{left:h,top:k}}function g(a,b,c){var d=e(a,b,c.x,c.y);return d=f(a,d),a.offset(d),d}function h(a,b){return b=f(a,b),a.offset(b),b}function i(a,b){a.$$postDigest(function(){a.$$postDigest(b)})}var j={template:d,scope:{menu:"=",options:"="},controller:["$scope","$element","$timeout",function(d,e){function f(a){i(d,function(){d.options.alignTo?b.align(l(),d.options.alignTo,{collision:d.options.collision||"flip",position:d.options.docking||"top"}):(a=a||m,m=a?h(l(),a):g(l(),d.options.docking,d.options.position))})}function j(){if(d.levels.length){var a=d.levels.pop();d.currentItems=a.items,f(a.offset)}}function k(a){var b=a.items;d.levels.push({items:d.currentItems,offset:m}),d.currentItems=b,f()}function l(){return e.children().first()}var m=null;d.levels=[],d.currentItems=d.menu.items,d.goBack=function(){j()},d.selectItem=function(a,b){a.stopPropagation(),b.hasSubmenu()?k(b):(b.select(b.args),d.close())},d.close=function(){"function"==typeof d.menu.onClosing&&d.menu.onClosing.call(null),d.destroyComponent(),c.off("start",d.close)},c.on("start",d.close),e.find(".content").css("max-height",a(window).outerHeight()-40),f(),"function"==typeof d.menu.onOpen&&d.menu.onOpen.call(null)}]};return j}),define("general.components/context-menu/context-menu-service",["qvangular","general.components/context-menu/context-menu","general.services/show-service/show-service","translator"],function(a,b,c,d){"use strict";var e=function(a){var b=this;Object.keys(a||{}).forEach(function(c){b[c]=a[c]}),this.items=[]};e.prototype.addItem=function(a){var b=new e(a);return this.items.push(b),b},e.prototype.hasSubmenu=function(){return this.items.length>0},e.prototype.hasIcon=function(){return!!this.icon},e.prototype.getLabel=function(){function a(a){return Array.isArray(a)?d.get(a[0],a.slice(1).join(",")):d.get(a)}return"function"==typeof this.translation?a(this.translation()):this.translation?a(this.translation):"function"==typeof this.label?this.label():this.label?this.label:"Missing translation/label"},a.service("qvContextMenu",function(){var a,d={};return d.show=function(e,f){if(d.close(),0!==e.items.length){var g=f.component||b;return a=c.show(g,{menu:e,options:f})}},d.close=function(){a&&(a.destroy(),a=null)},d.menu=function(){var a=new e,b={addItem:function(b){return a.addItem(b)}};return Object.defineProperty(b,"items",{get:function(){return a.items}}),b},d})}),define("extensions.qliktech/straight-table/properties/columns/columns",["qvangular","jquery","touche","client.property-panel/components/components","general.utils/support","objects.error-handling/error-translation","translator","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover","client.property-panel/popovers/type-popover","general.utils/property-resolver","general.services/show-service/show-service","general.sortable/sortable-item-lists","extensions.qliktech/straight-table/properties/columns/columns-sorting-util","text!client.property-panel/components/common/data.ng.html","general.components/context-menu/context-menu-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){return{name:"columns",template:o,controller:["$scope","$element","$timeout","qvGridObjectDataService",function(o,p,q,r){function s(a){var c=b(a.currentTarget);H=l.show(j,{items:[{tid:"dimension",select:function(){A("dimension",c)},disabled:function(){return o.args.handler.getDimensions().length>=o.args.handler.maxDimensions()},translation:"Common.Dimension"},{tid:"measure",select:function(){A("measure",c)},disabled:function(){return o.args.handler.getMeasures().length>=o.args.handler.maxMeasures()},translation:"Common.Measure"}],closeTypeFoldout:t,alignTo:c})}function t(a){H&&(H.destroy(),H=null),a&&b(a.target).hasClass("pp-toplist-add-button")&&c.preventGestures(),o.addType=null}function u(){var a=k.getValue(o.data,o.definition.sortIndexRef);void 0===a?(a=r.columnOrder.get(o.args.handler.getDimensionLayouts(),o.args.handler.getMeasureLayouts()),k.setValue(o.data,o.definition.sortIndexRef,a),o.$emit("saveProperties")):a.length&&"number"!=typeof a[0]&&(k.setValue(o.data,o.definition.sortIndexRef,a.map(function(a){return a.dataColIx})),o.$emit("saveProperties"))}function v(){u();var a=k.getValue(o.data,o.definition.sortIndexRef),b=o.data.qHyperCubeDef.qDimensions.length;if(o.sortableItemLists.reset(),a.forEach(function(a,c){var d,e,g,h,i;b>a?(e=a,g=o.data.qHyperCubeDef.qDimensions[e],h="dimension",i=g.qDef.cId,d=o.definition.items.dimensions):(e=a-b,g=o.data.qHyperCubeDef.qMeasures[e],i=g.qDef.cId,h="measure",d=o.definition.items.measures);var j=K.createItem({title:function(){var a;if("dimension"===h){var b=o.args.handler.getDimensionLayout(i);a=b&&b.qError?f.getDimensionError(b.qError.qErrorCode):g.qLibraryId?b&&b.title||"":b&&b.qFallbackTitle||""}else{var c=o.args.handler.getMeasureLayout(g.qDef.cId);a=c&&c.qError?f.getMeasureError(c.qError.qErrorCode):c&&c.qFallbackTitle||""}return a},isInvalid:function(){if("dimension"===h){var a=o.args.handler.getDimensionLayout(i);return a&&!!a.qError}var b=o.args.handler.getMeasureLayout(i);return b&&!!b.qError},component:G,definition:{type:"items",items:d.items},data:g,args:o.args,id:i,expanded:E.get(F+i)||!1,index:c,type:h,sourceIndex:e,dataColIx:a,templateSrc:"pp-data-item.ng.html",markerClass:"dimension"===h?"pp-dimension":"pp-measure",sortable:o.definition.allowMove!==!1});K.addItem(j)}),K.isEmpty()){var c=K.createItem({id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1});K.addItem(c)}}function w(a){o.args.handler.addFieldDimension(a.value,"").then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function x(a){o.args.handler.addLibraryDimension(a.libraryId).then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function y(a){o.args.handler.addLibraryMeasure(a.libraryId).then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function z(a){o.args.handler.addExpressionMeasure(a.value,"").then(function(a){E.put(F+a.qDef.cId,!0),o.$emit("saveProperties",o.data),B(),C()})}function A(a,b){o.addType=a,t(),D(),"dimension"===a?(I=l.show(h,{alignTo:b,position:"bottom",closeAddPopover:B,addFieldDimension:w,addLibraryDimension:x}),o.adding=!0):I=l.show(i,{alignTo:b,position:"bottom",closeAddPopover:B,addLibraryMeasure:y,addExpressionMeasure:z})}function B(a){I&&(I.destroy(),I=null),a&&b(a.target).hasClass("pp-toplist-add-button")&&c.preventGestures(),o.adding=!1}function C(){q(function(){var a=p.find(".pp-toplist-content"),b=a.find(".pp-data-list").children().last();a[0].scrollTop=b[0].offsetTop-1},100)}function D(){K.items.forEach(function(a){a.expanded=!1,E.put(F+a.id,!1)})}var E=o.args.cache,F="columns_",G=d.getComponent("items");o.expandClicked=function(a,c){c.disabled||b(a.target).hasClass("pp-move-item")||(c.expanded=!c.expanded,E.put(F+c.id,c.expanded))};var H=null,I=null,J=null;o.addClicked=function(a){s(a)},o.hasMultipleAddOptions=function(){return!0},o.getAddLabel=function(){return g.get("properties.columns.add")},o.removeItem=function(a){"dimension"===a.type?o.args.handler.removeDimension(a.sourceIndex).then(function(){o.$emit("saveProperties")}):o.args.handler.removeMeasure(a.sourceIndex).then(function(){o.$emit("saveProperties")})},o.openContextMenu=function(b,c){var d=a.getService("qvContextMenu").menu();d.addItem({translation:"Common.Delete",tid:"delete",select:function(){o.removeItem(c)}}),J=a.getService("qvContextMenu").show(d,{position:{x:b.pageX,y:b.pageY},docking:"Top"})},o.$on("pp-open-path",function(a,b){var c=b.split("."),d=c[0],e=c[1];"columns"===d&&e&&(E.put(F+e,!0),C())}),o.add=function(a){a&&a.trim().length&&("measure"===o.addType?z({value:a,label:a}):"dimension"===o.addType&&w({value:a,label:a}))},o.sortableItemLists=m.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:e.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("qv-pp-sortable"),a.templateSrc="pp-data-item.ng.html"},onBegin:function(){this._super.apply(this,arguments),D()},onMove:function(){this._super.apply(this,arguments),o.data.qHyperCubeDef.columnOrder=K.get().filter(function(a){return"empty-item"!==a.id}).map(function(a){return a.dataColIx}),n.fixTableHypercubeOrders(o.data.qHyperCubeDef),o.$emit("saveProperties")}});var K=o.sortableItemLists.createList(1,{title:g.get("Common.Columns"),tid:"columns"});o.$watchCollection("data.qHyperCubeDef.columnOrder",v),o.$watchCollection("data.qHyperCubeDef.qDimensions",v),o.$watchCollection("data.qHyperCubeDef.qMeasures",v),o.$on("$destroy",function(){t(),B(),J&&J.destroy()})}]}}),define("text!extensions.qliktech/straight-table/column-picker/column-picker.ng.html",[],function(){return'<div class="qv-st-column-picker"\r\n	 tid="qv-st-column-picker"\r\n	 qva-activate="interactive && !selections.active && toggleColumnPickerPopover();"\r\n	 qva-outside-ignore-for="{{columnPicker.qvaOutsideIgnoreFor}}"\r\n	 ng-class="{ \'qv-st-column-picker-open\': columnPicker.showPopover }">\r\n	<table>\r\n		<tr>\r\n			<td q-title-translation="{{columnPicker.showPopover ? \'Tooltip.CloseColumnPicker\' : \'Tooltip.ColumnPicker\'}}">\r\n				<div class="qv-st-column-picker-more"></div>\r\n			</td>\r\n		</tr>\r\n	</table>\r\n</div>\r\n'}),define("text!extensions.qliktech/straight-table/column-picker/column-picker-popover.ng.html",[],function(){return'<immidiate-contextual class="qv-st-column-picker-popover"\r\n					  align-to="$alignColumnPickerTo"\r\n					  position="\'left\'"\r\n					  collision="\'flip fit\'"\r\n					  width="180"\r\n					  height="\'auto\'"\r\n					  qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}"\r\n					  on-close-view=" toggleColumnPickerPopover();">\r\n	<div class="qv-st-cp-header-wrapper"><p class="qv-st-cp-header" q-translation="Common.Columns"></p></div>\r\n	<ul class="qv-st-cp-popover-list"\r\n		qv-sortable-list="sortableItemLists">\r\n		<li class="qv-st-cp-popover-list-item"\r\n			draggable="false"\r\n			ng-repeat="col in columnPicker.columns.items track by col.id"\r\n			ng-class="col.classList"\r\n			ng-style="col.style">\r\n			<table class="qv-st-cp-popover-table" ng-if="col.id !== -2">\r\n				<tr>\r\n					<td ng-class="{ \'disabled\': col.disabled }">\r\n						<div class="qv-st-cp-fade-out">{{col.title}}</div>\r\n					</td>\r\n					<td ng-if="col.id >= 0" class="qv-st-cp-handle">\r\n						<div class="icon-handle"></div>\r\n					</td>\r\n				</tr>\r\n			</table>\r\n		</li>\r\n	</ul>\r\n</immidiate-contextual>\r\n'}),define("extensions.qliktech/straight-table/column-picker/column-picker",["jquery","qvangular","text!./column-picker.ng.html","text!./column-picker-popover.ng.html","core.utils/resize","general.sortable/sortable-item-lists","general.sortable/sortable-list"],function(a,b,c,d,e,f){"use strict";return b.service("qvStraighTableColumnPickerService",["$document",function(b){var c,e,f=b.find("body");return e={show:function(e){return c=b.find(".qv-st-column-picker-popover"),c.length||(c=a("<div>")),c.showComponent({controller:function(){},template:d},e),c.appendTo(f),function(){c.remove()}}}}]),b.directive("qvStraightTableColumnPicker",function(){return{restrict:"A",require:"qvSortableList",link:function(a,b,c,d){a.columnPicker.cancel=function(){d.cancel()}}}}),b.directive("qvStraightTableColumnPickerActivator",["qvStraighTableColumnPickerService",function(a){return{restrict:"E",replace:!0,template:c,require:"^qvStraightTable",link:function(b,c,d,g){function h(){b.columnPicker.columns.get().forEach(function(a,c){b.scrollApi.settings.columnCount<c?a.disabled=!0:a.disabled=!1})}function i(){var a,c,d,e,f=b.layout.qHyperCube.qDimensionInfo,g=b.layout.qHyperCube.qMeasureInfo,i=f.length;b.columnPicker.cancel(),b.columnPicker.columns.reset(),b.layout.qHyperCube.columnOrder.forEach(function(c){a=i>c?f[c].qFallbackTitle:g[c-i].qFallbackTitle,b.columnPicker.columns.add(a,c,["qv-st-cp-sortable"])}),c=b.columnPicker.columns.add("",-2,["qv-st-cp-divider"],32),c.isDivider=!0,d=b.columnPicker.columns.getIndexByItem(c),e=b.scrollApi.settings.columnCount,b.columnPicker.columns.moveItem(d,e),h()}function j(){e.off("start."+b.$id,j),b.columnPicker.showPopover&&(k(),b.columnPicker.showPopover=!1,b.$digest())}var k;b.sortableItemLists=f.create({options:{direction:"vertical",itemKey:"col",itemSelector:".qv-st-cp-sortable",itemDragSelector:".qv-st-cp-handle"},addPlaceholder:function(a,b){var c=this._super.apply(this,arguments);c.style.height=b.height,c.id=-1},onMove:function(){this._super.apply(this,arguments),h(),b.applyColumnOrderSoftPatch(!1,b.columnPicker.columns.get(function(a){return a.id>=0}).map(function(a){return a.id}))}}),b.columnPicker={showPopover:!1,columns:b.sortableItemLists.createList(),qvaOutsideIgnoreFor:"qv-st-column-picker-"+b.$id,cancel:function(){}},g.watchPaint(i),b.toggleColumnPickerPopover=function(){b.$alignColumnPickerTo=c,b.columnPicker.showPopover=!b.columnPicker.showPopover,b.columnPicker.showPopover?(i(),k=a.show({$alignColumnPickerTo:b.$alignColumnPickerTo,columnPicker:b.columnPicker,onMoveBegin:b.onMoveBegin,onMoveEnter:b.onMoveEnter,onMoveCancel:b.onMoveCancel,onMove:b.onMove,toggleColumnPickerPopover:b.toggleColumnPickerPopover,qvaOutsideIgnoreFor:b.columnPicker.qvaOutsideIgnoreFor,sortableItemLists:b.sortableItemLists,hc:b.layout.qHyperCube}),e.on("start."+b.$id,j)):k&&k()}}}}])}),define("extensions.qliktech/straight-table/straight-table",["qvangular","core.utils/deferred","objects.backend-api/hypercube-api","extensions.qliktech/straight-table/straight-table-properties","text!./straight-table.ng.html","objects.extension/base-controller","objects.extension/object-conversion","general.utils/array-util","extensions.qliktech/straight-table/snapshot/snapshot-helper","general.utils/support","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.utils/event-utils","objects.grid/data-grid","objects.grid/services/data-service","objects.grid/services/selections","extensions.qliktech/straight-table/layout/top/straight-table-top-header","extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell","extensions.qliktech/straight-table/layout/data/straight-table-data","extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell","extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header","extensions.qliktech/straight-table/properties/columns/columns","extensions.qliktech/straight-table/column-picker/column-picker","objects/listbox-popover/listbox-popover-service"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";var p,q,r,s;return q=k.extend({destroy:function(){this._super.apply(this,arguments),this.$timeout.cancel(this.updateTopBottomPromise)},init:function(a,b,c){this.isSnapshot=c,this.topBottomStyle={},this.alignTotals=!1,this._super.apply(this,arguments)},updateTopBottom:function(){this.updateTopBottomPromise=this.$timeout(function(){var a=this.domApi.getClientWidth(),b=this.domApi.getScrollContentBoundingBox().height,c=this.domApi.getScrollAreaClientHeight(),d=this.domApi.getScrollAreaClientWidth();if(b>c||this.alignBottom?(this.alignTotals=!1,this.topBottomStyle.marginRight=a-d):(this.alignTotals=!0,this.topBottomStyle.marginRight=0),this.virtualScrollEnabled&&!this.isSnapshot){var e=this.dataApi.getRowCount(),f=Math.ceil(c/this.settings.minRowHeight),g=e-(e-f);e>f&&(this.dataApi.getRows().splice(g),this.settings.viewportRowCount=f)}}.bind(this))},updateAlignBottom:function(){this._super(),this.updateTopBottom()}}),r=m.extend({init:function(a){this.visualizationCtrl=a},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(a,b){return this.visualizationCtrl.onVirtualScroll(a,b)},onInitialNativeScroll:function(a,b){return this.visualizationCtrl.onInitialNativeScroll(a,b)},onGotoNextBlock:function(a,b){return this.visualizationCtrl.onGotoNextBlock(a,b)},onGotoPreviousBlock:function(a,b){return this.visualizationCtrl.onGotoPreviousBlock(a,b)}}),s=l.extend({init:function(a,b,c,d,e,f){this.snapshotObject=f,this._super.apply(this,arguments)},getBoundingBox:function(){var a;return a=this.snapshotObject.freeResize?this.$element[0].getBoundingClientRect():{height:this.snapshotObject.size.h,width:this.snapshotObject.size.w}}}),p=f.extend({handledColumnOrderMigration:function(){var a=this.$scope;return void 0===a.layout.qHyperCube.columnOrder||a.layout.qHyperCube.columnOrder.length&&"number"!=typeof a.layout.qHyperCube.columnOrder[0]?(this.appliedSoftPatch||(void 0===a.layout.qHyperCube.columnOrder?a.applyColumnOrderSoftPatch(!0,this.dataService.columnOrder.get(a.layout.qHyperCube.qDimensionInfo,a.layout.qHyperCube.qMeasureInfo)):a.applyColumnOrderSoftPatch(!1,a.layout.qHyperCube.columnOrder.map(function(a){return a.dataColIx})),this.appliedSoftPatch=!0),!0):!1},init:function(a,b,c,d){this.appliedSoftPatch=!1,this._paintWatches=[],this._resizeWatches=[],this.dataService=c,this.selectionService=d,this.$timeout=b,this.metaHeaders=[],this._super.apply(this,arguments),a.backendApi.setCacheOptions({width:1}),Object.defineProperties(a,{isDesktop:{get:function(){
return j.treatAsDesktop()}}})},watchPaint:function(a){var b=this;return b._paintWatches.push(a),function(){var c=b._paintWatches.indexOf(a);b._paintWatches.splice(c,1)}},watchResize:function(a){var b=this;return b._resizeWatches.push(a),function(){var c=b._resizeWatches.indexOf(a);b._resizeWatches.splice(c,1)}},update:function(a,c,d,e,f){var g=this.getDataInfo(a,c,f),h=b();return this.$scope.backendApi.getData(g.rects).then(function(a){this.onUpdateData({dataPages:a,dataInfo:g},d,e,f).then(function(){h.resolve(a)})}.bind(this)),h.promise},updateLocked:function(a){var b,c,d,e,f,g,h,i=this.dataService,j=this.selectionService,k=this.$scope.selections,l=k.activationCell,m=[];if(l){for(b=a.getRowsByCellType(a.CELL_TYPE_DATA),f=i.getSiblingCells(a,l),c=b.length,h=0;c>h;++h)m=m.concat(b[h].cells);for(e=m.length,h=0;e>h;++h)d=m[h],g=-1!==f.indexOf(d),(g&&!d.isDimensionValue||!g&&!d.isMeta)&&j[l&&k.active?"lockCell":"unlockCell"](a,d)}},getDataInfo:function(a,b,c){var d,e,f,g=[];for(c?e=this.metaHeaders:(e=this.dataService.getStraightMetaHeaders(this.$scope.layout,this.$scope.scrollApi.settings,this.$scope.$id),this.metaHeaders=e),f=e.length,d=0;f>d;++d)e[d].isSearchIcon||g.push({qLeft:e[d].qLeft,qTop:a||0,qWidth:1,qHeight:b});return g.length||g.push({qTop:0,qLeft:0,qWidth:0,qHeight:0}),{rects:g,metaHeaders:e}},onUpdateData:function(a,b,c,d){return c&&a.dataPages.forEach(function(a){a.qMatrix.reverse()}),this.dataService.updateStraightItems(this.$scope,a.dataPages,a.dataInfo.metaHeaders,b,c,d),c&&this.$scope.grid.rows.reverse(),this.$scope.selections.active&&(this.selectionService.updateStraight(this.$scope.grid,this.$scope.selections,this.$scope.selections.activationCell),this.updateLocked(this.$scope.grid)),this.$scope.backendApi.isSnapshot&&i.scaleDynamically(this.$scope),this.$scope.scrollApi.updateTopBottom(),this.$timeout(function(){},0,!1)},setSnapshotData:function(a){var b,c,d=!!a.sourceObjectId,e=this.$scope,f=e.scrollApi.domApi,g=f.getScrollAreaBoundingBox(),h=f.$scrollArea.find(".qv-st-data-row"),j=e.scrollApi.settings.columnCount;return b=i.getIndexHeightAndWidth(h,j,g),c=this.getDataInfo(b.index,b.height),c.rects.splice(b.width),e.backendApi.getData(c.rects).then(function(f){a.qHyperCube.qDataPages=f,a.snapshotData.object.dataTableRowCount=b.height,a.snapshotData.object.dataTableHeight=e.isDesktop?g.height:g.height*(2/3),a.snapshotData.object.size.h*=e.isDesktop?1:2/3;var h=e.layout.qHyperCube.columnOrder.slice(0,c.rects.length);return d||(a.qHyperCube.columnOrder=h),a})},process:function(a,c,d){return this.handledColumnOrderMigration()?b.resolve():this.update(a,c,!1,!1,!1).then(function(){this.$scope.scrollApi.setTotalRows(this.$scope.layout.qHyperCube.qSize.qcy),this.$scope.scrollApi.setVirtualSize(d)}.bind(this))},processPaint:function(){var a,b,c=0;return a=this.$scope.scrollApi.settings.viewportRowCount,b=this.$scope.scrollApi.resetNativeScroll(),this.process(c,a,!1).then(function(){b()})},processResize:function(){var a=this.$scope.grid.rows.length,b=a?this.$scope.grid.rows[0].getIndex():0,c=this.$scope.scrollApi.settings.viewportRowCount;return a>c&&(c=a),this.process(b,c,!0)},onVirtualScroll:function(a,b){return this.update(a,b,!1,!1,!0)},gotoBlock:function(a,b,c){var d=this.$scope.scrollApi.getSpliceArgs(),e=this.$scope.grid.rows,f=this.$scope.grid.getNextRowIx();return c&&e.reverse(),e.splice.apply(e,d),f-=d[1],this.$scope.grid.setNextRowIx(f),this.update(a,b,!0,c,!0)},onGotoNextBlock:function(a,b){return this.gotoBlock(a,b,!1)},onGotoPreviousBlock:function(a,b){return this.gotoBlock(a,b,!0)},getRows:function(){return this.$scope.grid.rows},getRowCount:function(){return this.$scope.grid.rows.length},getFirstElementIndex:function(){return this.$scope.grid.rows[0].getIndex()},getLastElementIndex:function(){return this.$scope.grid.rows[this.$scope.grid.rows.length-1].getIndex()}}),p.$inject=["$scope","$timeout","qvGridObjectDataService","qvGridObjectSelectionService"],a.directive("qvStraightTable",["$timeout","qvGridObjectDataService","qvGridObjectSelectionService","qvListboxPopoverService",function(a,c,d,f){return{restrict:"E",replace:!0,template:e,require:["qvStraightTable","^qvObject"],controller:p,link:function(e,g,i,j){function k(a,b){return x[a]().then(function(){b.forEach(function(a){a()})})}function m(){x.updateLocked(e.grid),w&&w()}function p(){c.getSiblingCells(e.grid,e.selections.activationCell).forEach(function(a){d.deselectCell(e.grid,a)}),x.updateLocked(e.grid),w&&w()}function t(){e.selections.active&&e.selections.activationCell&&(c.getSiblingCells(e.grid,e.selections.activationCell).forEach(function(a){d.deselectCell(e.grid,a)}),x.updateLocked(e.grid))}function u(){e.object.selectionsClass="",x.updateLocked(e.grid)}function v(a,b){var c,d,e=a.length;for(c=0;e>c;++c)if(d=a[c],d.dataRowIx===b)return d}var w,x=j[0],y=j[1],z=g.find(".qv-grid-object-scroll-area"),A=z.controller("qvScrollArea"),B=g.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),C=z.find(".qv-scroll-row-loader").controller("qvScrollLoader"),D="."+e.id+"-straight-table",E={minRowHeight:29,columnCount:0,column:{minWidth:102,minSearchWidth:25,glyphWidth:8,maxMeasureWidth:350},columnPicker:{show:!1,width:21},blockSize:50},F=e.scrollApi=new q(a,E,e.backendApi.isSnapshot),G=new r(x),H=e.backendApi.isSnapshot?new s(g,z,"","",null,e.layout.snapshotData.object):new l(g,z,".qv-grid-object-data-first-row",".qv-grid-object-data-last-row");e.grid=new o("straight"),e.selections=d.$new(),e.$on("$destroy",function(){F.destroy(),g.off(D)}),g.on("contextmenu"+D,function(a){e.selections.active&&a.preventDefault()}),F.initialize(H,G,A,B).then(function(){x.onStateChanged=function(a){x.allowInteraction(a)?(e.interactive=!0,e.scrollApi.activate()):(e.interactive=!1,e.scrollApi.deactivate())},x.setInteraction=function(a){e.scrollApi[a?"activate":"deactivate"]()},x.onPaint=function(){return this.$scope.selections.active?b.resolve():k("processPaint",x._paintWatches)},x.onResize=function(){return e.scrollApi.updateViewport(),k("processResize",x._resizeWatches)},x.onInitialNativeScroll=function(a,b){return C.fadeIn(null,{width:"100%",height:"30px"},"relative").then(function(){return x.update(a,b,!0,!1,!0).then(function(){return C.fadeOut()})})},y.addChildController(x)}),e.applyColumnOrderSoftPatch=function(a,b){var c=[[],!0],d=a?"add":"replace";c[0][0]={qPath:"/qHyperCubeDef/columnOrder",qOp:d.toString(),qValue:JSON.stringify(b)},e.backendApi.applyPatches(c)},d.init(e.selectionsApi,e.backendApi,e.selections,m,p,t);var I=e.selectionsApi.ignoreOnOutside;e.selectionsApi.ignoreOnOutside=function(a){return a.closest(".qv-st-dim-columns").length?!0:I(a)||a.closest(".qv-st-selections-active").length?!0:void 0},e.selectionsApi.getMenuMaxHeight=function(){return g.outerHeight()},e.selectWhileLocked=function(){n.showLockedFeedback(e.layout.qHyperCube.qDimensionInfo)},e.selectDimensionValue=function(a,b){e.scrollApi.updateViewport(),e.selectionsApi.getKeyAsToggleSelected(b)||(t(),d.reset(e.selections)),w=d.selectDimensionValue(e.$id,e.backendApi,e.selectionsApi,e.selections,a,e.grid,!0);var c=e.selectionsApi.watchActivated(function(){u(),c()})},e.activateSelections=function(a){e.scrollApi.updateViewport(),w=d.activateSelections(e.$id,e.backendApi,e.selectionsApi,e.selections,a);var b=e.selectionsApi.watchActivated(function(){u(),b()})},e.multiselectDimensionValues=function(a,b){function f(a){var b=v(h,a);b&&b.isDimensionValue&&d.selectDimensionCells(e.backendApi,e.selectionsApi,e.selections,e.grid,b,!1)}var g,h=c.getSiblingCells(e.grid,a),i=a.dataRowIx,j=b.dataRowIx;if(j>=i)for(g=i;j>=g;++g)f(g);else if(i>j)for(g=i;g>=j;--g)f(g)},e.multiselect=function(){e.selections.active&&d.sendSelection(e.backendApi,e.selectionsApi,e.selections,e.grid,e.selections.currentCell)},e.sort=function(a){e.scrollApi.updateViewport();var b,d,f,g=a.dataColIx,i=[].concat(e.layout.qHyperCube.qEffectiveInterColumnSortOrder),j=i[0],k="",l=[[],!0];g!==j&&(f=i.indexOf(g),h.move(i,f,0)),l[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:"["+i.join(",")+"]"},g===j&&(k=a.isDimension?"/qHyperCubeDef/qDimensions/":"/qHyperCubeDef/qMeasures/",b=c.getColumnInfo(g,e.layout),a.reversed=!b.qReverseSort,d=a.isDimension?g:g-e.layout.qHyperCube.qDimensionInfo.length,k+=d+"/qDef/qReverseSort",l[0][1]={qPath:k,qOp:"replace",qValue:a.reversed.toString()}),e.backendApi.applyPatches(l)},e.currentHeaderSearch=null,e.search=function(a,b){return e.currentHeaderSearch===b?(b.open=!1,e.currentHeaderSearch=null,void f.close()):(e.currentHeaderSearch&&(e.currentHeaderSearch.open=!1,e.currentHeaderSearch=null),f.showField(b.fieldName,e.backendApi.model.session.currentApp,{$alignToElement:a,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+e.$id,collision:"flipfit"},null,function(){e.currentHeaderSearch&&(e.currentHeaderSearch.open=!1),e.currentHeaderSearch=null}),b.open=!0,void(e.currentHeaderSearch=b))}}}}]),{initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"S",columnOrder:[]}},data:{dimensions:{min:1,max:1e3,add:function(a,b,c){var d=c.hcProperties.columnOrder;return h.indexAdded(d,c.getDimensions().length-1),a},remove:function(a,b,c,d){var e=c.hcProperties.columnOrder;h.indexRemoved(e,d)}},measures:{add:function(a,b,c){var d=c.hcProperties.columnOrder;h.indexAdded(d,c.getDimensions().length+c.getMeasures().length-1)},remove:function(a,b,c,d){var e=c.hcProperties.columnOrder,f=e.indexOf(d);h.indexRemoved(e,f)},min:0,max:1e3}},snapshot:{canTakeSnapshot:!0},type:"table",template:"<qv-straight-table></qv-straight-table>",BackendApi:c,definition:d,importProperties:function(b,c,d){var e=g.hypercube.importProperties(b,c,d),f=e.qProperty.qHyperCubeDef.columnOrder,h=e.qProperty.qHyperCubeDef.qDimensions,i=e.qProperty.qHyperCubeDef.qMeasures;return f.length&&h.length+i.length===f.length||(e.qProperty.qHyperCubeDef.columnOrder=a.getService("qvGridObjectDataService").columnOrder.get(h,i)),e},exportProperties:g.hypercube.exportProperties}}),define("extensions.qliktech/listbox/listbox-properties",["general.utils/property-resolver"],function(a){var b,c,d,e=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return b={uses:"settings",items:{}},c={type:"items",translation:"Common.Dimension",ref:"qListObjectDef",items:{label:{type:"string",ref:"qListObjectDef.qDef.qFieldLabels.0",translation:"Common.Label",show:!1},libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(a){return a.qListObjectDef&&a.qListObjectDef.qLibraryId}},field:{type:"string",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",change:function(a){var b=a.qListObjectDef.qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]},show:function(a){return a.qListObjectDef&&!a.qListObjectDef.qLibraryId}},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},d={type:"items",translation:"properties.sorting",grouped:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a,b){return a.qListObjectDef.qDef.autoSort?b.autoSortDimension(a.qListObjectDef):void 0}},expression:{type:"items",show:function(a){return a.qListObjectDef?!a.qListObjectDef.qDef.autoSort:!1},items:{expressionToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",translation:"properties.sorting.sortByExpression",resolveFunctions:"booleanToSortInteger"},expression:{type:"number",component:"expression",ref:"qListObjectDef.qDef.qSortCriterias.0.qExpression",translation:"Common.Expression",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",0)}},expressionOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByExpression",0)}}}},frequency:{type:"items",show:function(a){return a.qListObjectDef?!a.qListObjectDef.qDef.autoSort:!1},items:{frequencyToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",translation:"properties.sorting.sortByFrequency",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},frequencyOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByFrequency",0)}}}},numeric:{type:"items",show:function(a){return a.qListObjectDef?!a.qListObjectDef.qDef.autoSort:!1},items:{numericToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",translation:"properties.sorting.sortByNumeric",defaultSort:-1,resolveFunctions:"booleanToSortInteger"},numericOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByNumeric",0)}}}},ascii:{type:"items",show:function(a){return a.qListObjectDef?!a.qListObjectDef.qDef.autoSort:!1},items:{asciiToggled:{type:"boolean",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",translation:"properties.sorting.sortByAlphabetic",resolveFunctions:"booleanToSortInteger"},asciiOrder:{type:"string",component:"dropdown",ref:"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",options:e,resolveFunctions:"enumToSortInteger",show:function(b){return 0!==a.getValue(b,"qListObjectDef.qDef.qSortCriterias.0.qSortByAscii",0)}}}}}},{type:"items",component:"accordion",items:{dimension:c,sorting:d,settings:b}}}),define("text!extensions.qliktech/listbox/listbox.ng.html",[],function(){return'<div class="qv-listbox-container" ng-class="{ \'qv-listbox-interactive\': interactive }" tid="qv-listbox-container">\r\n	<div qv-listbox-search ng-show="options.search.show" class="qv-listbox-search">\r\n		<qui-search-field query="query" is-focused="focused" on-escape="onEscape($event);" auto-focus="autoFocus" />\r\n	</div>\r\n	<div class="qv-listbox-wrapper" ng-class="{ \'searchActive\': options.search.show }">\r\n		<qv-scroll-area class="qv-listbox-scroll-area qv-animate" ng-class="{ \'qv-listbox-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled }">\r\n			<ul class="qv-listbox" ng-class="{ \'align-bottom\': scrollApi.alignBottom }"\r\n				qv-selections-select-while-locked="selectWhileLocked()"\r\n				qv-selections-toggle-dimension-value="{ selector: \'li\', itemKey: \'item\' }"\r\n				qv-selections-on-toggle-dimension-value="interactive && select($event, item)"\r\n				qv-selections-multiselect="{ selector: \'li\', itemKey: \'item\' }"\r\n				qv-selections-start-multiselect="interactive && multiselectStart($event)"\r\n				qv-selections-update-multiselect="interactive && multiselectUpdate(start, current)"\r\n				qv-selections-end-multiselect="interactive && multiselectEnd($event)">\r\n				<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="interactive && scrollApi.loadPrevious" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true">\r\n				</qv-scroll-load-button>\r\n				<li ng-repeat="item in items" ng-class="item.classNames" tid="listbox.item">\r\n					<div class="qv-listbox-tick"><i class="icon-tick"></i></div>\r\n					<div class="qv-listbox-text" ng-class="{ \'qv-listbox-numeric\' : item.isNumeric }">\r\n						<span ng-attr-title="{{item.text}}">\r\n							<span ng-repeat="textItem in item.textItems" ng-class="{ highlighted: textItem.isHighlighted }">{{textItem.text}}</span>\r\n						</span>\r\n					</div>\r\n				</li>\r\n				<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\r\n				<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="interactive && scrollApi.loadNext" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\r\n			</ul>\r\n		</qv-scroll-area>\r\n		<qv-scroll-loader></qv-scroll-loader>\r\n	</div>\r\n</div>\r\n'}),define("text!client.services/export-dialog/export-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="export-dialog">\r\n	<div ng-if="state === states.PENDING">\r\n		<header class="dm-header" q-translation="Export.Exporting"></header>\r\n		<main class="dm-main">\r\n			<div class="qv-loader dm-p"></div>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="cancel()" q-translation="Common.Cancel"></qui-button>\r\n		</footer>\r\n	</div>\r\n	<div ng-if="state === states.COMPLETED">\r\n		<header class="dm-header" q-translation="Export.Completed"></header>\r\n		<main class="dm-main">\r\n			<p class="dm-p">\r\n				<span q-translation="Export.CompletedDescription"></span>\r\n				<span q-translation="Export.WarningDataTruncated" ng-if="dataIsTruncated"></span>\r\n			</p>\r\n			<p class="dm-p">\r\n				<a ng-href="{{exportUrl}}" target="_blank" q-translation="Export.CompletedLink"></a>\r\n			</p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="close()" q-translation="Common.Close"></qui-button>\r\n		</footer>\r\n	</div>\r\n	<div ng-if="state === states.FAILED">\r\n		<header class="dm-header" q-translation="Export.Failed"></header>\r\n		<main class="dm-main">\r\n			<p class="dm-p" q-translation="{{errorTranslation}}"></p>\r\n		</main>\r\n		<footer class="dm-footer">\r\n			<qui-button qva-activate="close()" q-translation="Common.Close"></qui-button>\r\n		</footer>\r\n	</div>\r\n</qv-modal-dialog>'}),define("client.services/export-dialog/export-dialog",["qvangular","text!./export-dialog.ng.html","general.services/show-service/show-service"],function(a,b,c){var d={template:b,scope:{model:"=",hypercubePath:"="},controller:["$scope",function(a){a.states={FAILED:-1,IDLE:0,PENDING:1,COMPLETED:2},a.state=a.states.PENDING,a.model.getLayout().then(function(b){var c=a.model.exportData(null,a.hypercubePath,b.title||null);a.rpcId=c.rpcId,c.then(function(b){a.exportUrl=".."+b.result.qUrl,a.state=a.states.COMPLETED,b.warnings&&1e3===b.warnings[0]&&(a.dataIsTruncated=!0)},function(b){a.state=a.states.FAILED,a.errorTranslation="ErrorCode."+b.error.code,b.isHandled=!0})}),a.openExportWindow=function(){window.open(a.exportUrl)},a.cancel=function(){a.rpcId?a.model.cancelRequest(a.rpcId)["finally"](a.close):a.close()},a.close=function(){a.destroyComponent()}}]};a.service("$exportDialog",[function(){return{show:function(a,b){var e={model:a,hypercubePath:b};return c.show(d,e)}}}])}),define("extensions.qliktech/listbox/listbox-search",["qvangular","util","general.utils/support"],function(a,b,c){"use strict";var d=document.createElement("input");d.type="text",a.directive("qvListboxSearch",["$document","$timeout",function(e,f){return{link:function(g,h){function i(){return e.on("keypress.watchKeyChars"+g.$id,function(a){27!==a.keyCode&&13!==a.keyCode&&(d.value=String.fromCharCode(a.which),d.value.length&&g.$apply(function(){g.options.search.toggle(!0,d.value)}))}),function(){e.off(".watchKeyChars"+g.$id)}}function j(){function a(){return g.$watch("query",function(a,b){void 0!==a&&a!==b&&g.backendApi.search(a)})}function b(){d&&d(),g.query="",d=a()}function c(a){var b=a.split(" ");return b.some(function(a){var b=a.trim()[0];return"<"===b||">"===b})}var d,h;return b(),h=g.$watch("focused",function(a){void 0!==a&&g.selectionsApi.toggleKeyboardAccelerators(!a)}),e.on("keydown.listboxSearch"+g.$id,function(a){g.focused===!0&&f(function(){switch(a.which){case 13:var d,e=g.backendApi.getSize();g.backendApi.isLocked()?g.backendApi.abortSearch():e.qcy>0&&(d=g.selectionsApi.getKeyAsToggleSelected(a),d=c(g.query)?!d:d,g.backendApi.confirmSearch(d),g.selectionsApi.selectionsMade=!0,b());break;case 27:g.backendApi.abortSearch(),b()}})}),function(){d(),h(),e.off(".listboxSearch"+g.$id)}}var k,l;g.autoFocus=!1,g.selectionsApi.deactivateSearch=function(){k&&k(),l&&l(),a.$apply(g,function(){g.options.search&&g.options.search.toggle(!1)})},g.onEscape=function(a){g.query&&g.query.length?g.query="":(g.backendApi.abortSearch(),g.selectionsApi.cancel()),a.preventDefault()},g.options.search=b.extend(!0,{show:g.options.isPopover,toggle:function(a,b){g.options.search.show=void 0!==a?a:!g.options.search.show,g.options.search.show?(g.query=b,k=j()):(k&&k(),g.backendApi.abortSearch(),g.query="")}},g.options.search),g.options.showSearch=!0,g.$watch("options.search.show",function(a){g.autoFocus=a&&c.treatAsDesktop(),a||h.find("input").blur()}),g.$watch("selectionsApi.active && !focused",function(a){a?l=i():void 0!==a&&l&&l()}),g.$on("$destroy",function(){e.off(".listboxSearch"+g.$id),e.off(".watchKeyChars"+g.$id),delete g.options.search}),g.options.isPopover&&g.options.search.toggle(!0,g.options.search.defaultStr)}}}])}),define("extensions.qliktech/listbox/listbox",["qvangular","objects.backend-api/listbox-api","extensions.qliktech/listbox/listbox-properties","general.utils/property-mapper","text!./listbox.ng.html","objects.utils/data-properties/listobject-handler","objects.extension/object-conversion","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.extension/base-controller","general.utils/support","objects.extension/default-selection-toolbar","objects.utils/event-utils","client.services/export-dialog/export-dialog","general.scroll/scroll-area","objects.grid/directives/selections","./listbox-search"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";function o(a,b,c){var d=".selections-keyboard-"+c;return a.on("keyup"+d,function(a){b.focused||(27===a.which?b.selectionsApi.cancel():13===a.which&&b.selectionsApi.confirm())}),function(){a.off(d)}}var p,q;return q=j.extend({init:function(a){this.visualizationCtrl=a},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(a,b){return this.visualizationCtrl.onVirtualScroll(a,b)},onInitialNativeScroll:function(a,b){return this.visualizationCtrl.onInitialNativeScroll(a,b)},onGotoNextBlock:function(a,b){return this.visualizationCtrl.onGotoNextBlock(a,b)},onGotoPreviousBlock:function(a,b){return this.visualizationCtrl.onGotoPreviousBlock(a,b)}}),p=k.extend({init:function(a,b){function c(b){b.selected||a.selectedValues.push(b.dataValue),b.selected=!0,b.classNames="selected serverSelected "}this._super.apply(this,arguments);var d;a.selectionsApi.watchDeactivated(function(){a.$emit("childSelectionActive",!1),a.options.search.show=!1,d&&d()}),a.selectionsApi.watchActivated(function(){a.$emit("childSelectionActive",!0),d&&d(),d=o(b,a,a.$id)}),a.selectionsApi.clear=function(){a.selectedValues=[],this.selectionsMade=!0,a.backendApi.clearSelections()},a.selectedValues=[],a.activateSelections=function(){a.selectionsApi.active||(a.selectedValues=[]),a.selectionsApi.activate()},a.selectValues=function(b,c){a.selectionsApi.selectionsMade=!0,a.backendApi.select(0,b,c)},a.select=function(b,c){var d=a.selectionsApi.getKeyAsToggleSelected(b);a.activateSelections(),d||a.items.forEach(function(a){a!==c&&(a.selected=!1,a.classNames="serverOptional")}),c.selected=!c.selected,c.classNames=c.selected?"selected serverSelected":"serverOptional",a.selectValues([c.dataValue],d)},a.multiselectStart=function(b){a.activateSelections(),a.selectionsApi.getKeyAsToggleSelected(b)||a.items.forEach(function(a){a.selected=!1,a.classNames="serverOptional"})},a.multiselectUpdate=function(b,d){var e,f,g,h;if(-1!==a.items.indexOf(d))if(g=a.items.indexOf(b),h=a.items.indexOf(d),h>=g)for(e=g;h>=e;++e)f=a.items[e],c(f);else if(g>h)for(e=g;e>=h;--e)f=a.items[e],c(f)},a.multiselectEnd=function(b){a.selectValues(a.selectedValues,a.selectionsApi.getKeyAsToggleSelected(b))},a.selectWhileLocked=function(){n.showLockedFeedback([a.layout.qListObject.qDimensionInfo])},a.$on("$destroy",function(){d&&d()}),Object.defineProperties(a,{isDesktop:{get:function(){return l.treatAsDesktop()}}})},update:function(a,b,c,d){var e=this.getDataInfo(a,b);return this.$scope.backendApi.getData(e.rects).then(function(a){this.onUpdateData(a,c,d)}.bind(this))},getDataInfo:function(a,b){return a=a||0,{rects:[{qTop:a,qLeft:0,qWidth:1,qHeight:b}]}},stateMap:{S:"Selected",A:"Alternative",O:"Optional",XS:"SelectedExcluded",L:"Locked",X:"Excluded",XL:"ExcludedLock"},getState:function(a){return this.stateMap[a]},isSelected:function(a){return"Selected"===this.getState(a)},updateTextItem:function(a,b){var c,d,e,f,g=b.qHighlightRanges&&b.qHighlightRanges.qRanges.length||0,h=b.qText&&b.qText.split("")||[],i=0;if(a.textItems=[],h.length||a.textItems.push({isHighlighted:!1,text:""}),!g)return void a.textItems.push({isHighlighted:!1,text:b.qText});for(e=b.qHighlightRanges.qRanges.sort(function(a,b){return a.qCharPos-b.qCharPos}),c=0;g>c;++c)d=e[c],f=d.qCharPos,f!==i&&a.textItems.push({isHighlighted:!1,text:h.splice(0,f-i).join("")}),a.textItems.push({isHighlighted:!0,text:h.splice(0,d.qCharCount).join("")}),i=d.qCharPos+d.qCharCount;h.length&&a.textItems.push({isHighlighted:!1,text:h.splice(0,h.length).join("")})},updateItems:function(a,b,c){var d,e,f,g,h,i,j=0,k=a[0].qArea.qTop,l=a[0].qArea.qHeight,m=this.$scope.items,n=a[0].qMatrix;for(c&&n.reverse(),b&&(j=m.length),i=this.$scope.backendApi.isLocked(),d=0,e=n.length;e>d;++d)m[j+d]||(m[j+d]={}),g=m[j+d],f=n[d][0],h=this.getState(f.qState),g.locked=i,g.dataValue=f.qElemNumber,g.dataColIx=0,g.dataRowIx=c?k+l-d-1:k+d,g.isNumeric="NaN"!==f.qNum,g.selected=this.isSelected(f.qState),g.classNames=g.selected?"selected server"+h:"server"+h,g.isDimensionValue=!0,g.text=f.qText,this.updateTextItem(g,f);b||m.splice(d),c&&m.reverse()},onUpdateData:function(a,b,c){this.updateItems(a,b,c),this.$scope.selectedValues=[]},process:function(a,b,c){return this.update(a,b,!1,!1).then(function(){this.$scope.scrollApi.setTotalRows(this.$scope.layout.qListObject.qSize.qcy),this.$scope.scrollApi.setVirtualSize(c)}.bind(this))},processPaint:function(){var a,b,c=0;return a=this.$scope.scrollApi.settings.viewportRowCount,b=this.$scope.scrollApi.resetNativeScroll(),this.process(c,a,!1).then(function(){b()})},processResize:function(){var a=this.$scope.items.length,b=a?this.$scope.items[0].dataRowIx:0,c=this.$scope.scrollApi.settings.viewportRowCount;return a>c&&(c=a),this.process(b,c,!0)},onVirtualScroll:function(a,b){var c=this.update(a,b,!1,!1);return this.$scope.$digest(),c},gotoBlock:function(a,b,c){var d=this.$scope.scrollApi.getSpliceArgs(),e=this.$scope.items;return c&&e.reverse(),e.splice.apply(e,d),this.update(a,b,!0,c)},onGotoNextBlock:function(a,b){return this.gotoBlock(a,b,!1)},onGotoPreviousBlock:function(a,b){return this.gotoBlock(a,b,!0)},getRows:function(){return this.$scope.items},getRowCount:function(){return this.$scope.items.length},getFirstElementIndex:function(){return this.$scope.items[0].dataRowIx},getLastElementIndex:function(){return this.$scope.items[this.$scope.items.length-1].dataRowIx},getSelectionToolbar:function(){return new m(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[],[{name:"Selections.All",tid:"selection-toolbar-menu.selectAll",iconClass:"icon-selection-toolbar-selectAll",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectAll()},isDisabled:function(){return!this.hasState(["qOption","qAlternative","qExcluded","qDeselected"])}},{name:"Selections.Possible",tid:"selection-toolbar-menu.selectPossible",iconClass:"icon-selection-toolbar-selectPossible",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectPossible()},isDisabled:function(){return!this.hasState(["qOption"])}},{name:"Selections.Alternative",tid:"selection-toolbar-menu.selectAlternative",iconClass:"icon-selection-toolbar-selectAlternative",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectAlternative()},isDisabled:function(){return!this.hasState(["qAlternative"])}},{name:"Selections.Excluded",tid:"selection-toolbar-menu.selectExcluded",iconClass:"icon-selection-toolbar-selectExcluded",buttonClass:"",action:function(){this.selectionsApi.selectionsMade=!0,this.backendApi.selectExcluded()},isDisabled:function(){return!this.hasState(["qExcluded","qAlternative"])}},{name:"contextMenu.export",tid:"selection-toolbar-menu.exportData",iconClass:"icon-toolbar-sharelist",buttonClass:"",action:function(){a.getService("$exportDialog").show(this.backendApi.model)},isDisabled:function(){return!1}}])}}),p.$inject=["$scope","$document"],a.directive("qvListbox",["$timeout",function(a){return{restrict:"E",replace:!0,template:e,require:["qvListbox","^qvObject"],controller:p,link:function(b,c,d,e){var f=e[0],g=e[1],j=c.find(".qv-listbox-scroll-area"),k=j.controller("qvScrollArea"),l=c.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),m=j.find(".qv-scroll-row-loader").controller("qvScrollLoader"),n="."+b.id+"-listbox",o={blockSize:200,minRowHeight:30},p=b.scrollApi=new h(a,o,b.backendApi.isSnapshot),r=new q(f),s=new i(c,j,"li:not(.qv-listbox-load-buttons):first","li:not(.qv-listbox-load-buttons):not(.qv-scroll-row-loader):last");b.items=[],b.$on("$destroy",function(){p.destroy(),c.off(n)}),c.on("contextmenu"+n,function(a){b.object.selectionsApi.active&&a.preventDefault()}),p.initialize(s,r,k,l).then(function(){b.options.isPopover&&b.activateSelections(),b.$watch("options.search.show",function(){b.options.isPopover||b.scrollApi.setVirtualSize(!0)}),b.$watch("options.interactionEnabled",function(a){void 0!==a&&b.scrollApi[a?"activate":"deactivate"]()}),f.onStateChanged=function(a){f.allowInteraction(a)?(b.interactive=!0,b.scrollApi.activate()):(b.interactive=!1,b.scrollApi.deactivate())},f.onPaint=function(){var a=b.scrollApi.totalRows===this.$scope.layout.qListObject.qSize.qcy;return b.selectionsApi.active&&a?f.processResize():void f.processPaint()},f.onResize=function(){b.scrollApi.updateViewport(),f.processResize()},f.onInitialNativeScroll=function(a,b){return m.fadeIn(null,{width:"100%",height:"30px"},"relative").then(function(){return f.update(a,b,!0,!1).then(function(){return m.fadeOut()})})},g.addChildController(f)})}}}]),{type:"listbox",template:"<qv-listbox></qv-listbox>",initialProperties:{version:.96,qListObjectDef:{qShowAlternatives:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:0,qHeight:0}],qDef:{qSortCriterias:[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}]}}},data:{dimensions:{min:1,max:1}},mapProperties:function(){this.mappedDefinition=d.mapDefinition(this.definition,this.type),this.dimensionDefinition=d.findDefinition(this.mappedDefinition,"qListObjectDef",!0)},getCreatePropertyHandler:function(){return new f(this.dimensionDefinition)},showRequirements:function(){return!1},hasError:function(a){var b=a.layout;return!b.qListObject||!b.qListObject.qDimensionInfo||!!b.qListObject.qDimensionInfo.qError},BackendApi:b,definition:c,options:{search:{},selections:{}},getDropFieldOptions:function(a,b,c,d){a.Add(c,b),a.ReplaceDimensions(c,b),d()},getDropMeasureOptions:function(a,b,c,d){d()},importProperties:g.listbox.importProperties,exportProperties:g.listbox.exportProperties}}),define("objects.backend-api/field-api",["./backend-api"],function(a){"use strict";var b;return b=a.extend("FieldApi",{init:function(a){this._super(a,"/dimensions"),this.cacheCube.setMethodName("GetListObjectData")},updateCache:function(){},getProperties:function(){return this.model.getProperties()},getData:function(a){
return this.cacheCube.getData(a)},getSize:function(){return this.model.layout.qListObject.qSize},isLocked:function(){return this.model.layout.qListObject.qDimensionInfo.qLocked}})}),define("extensions.qliktech/filterpane/filterpane-properties",["client.property-panel/default-sorting-properties","util"],function(a,b){var c,d,e,f;return f={qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1},c={uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}}}},d={type:"array",component:"filterpane-data",translation:"Common.Data",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,ref:"qChildListDef",items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(a){return a.qListObjectDef.qLibraryId}},field:{type:"string",component:"expression",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",show:function(a){return!a.qListObjectDef.qLibraryId},change:function(a){var b=a.qListObjectDef.qDef;b.qFieldLabels||(b.qFieldLabels=[]),b.qFieldLabels[0]=b.qFieldDefs[0]}},title:{ref:"title",type:"string",expression:"optional",translation:"Common.Title"},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},e={type:"items",component:"filterpane-sorting",translation:"properties.sorting",allowMove:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(a){if(a.qListObjectDef.qDef.autoSort)for(var b=a.qListObjectDef,c=0;c<b.qDef.qSortCriterias.length;c++)b.qDef.qSortCriterias[c]=f}},dimension:{component:"sorting-dimension",type:"items",ref:"qListObjectDef",show:function(a){return!a.qListObjectDef.qDef.autoSort},items:b.extend(!0,{},a.items.dimensions.items.dimension.items,{dimensionDefinition:{items:{frequency:{show:!0}}}})}}},{type:"items",component:"accordion",items:{data:d,sorting:e,settings:c}}}),define("extensions.qliktech/filterpane/filterpane-handler",["objects.utils/data-properties/data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util","general.utils/visualizations"],function(a,b,c,d,e){"use strict";var f=1e3,g=a.extend({init:function(a,b,c){this._super(a,null,b,null),this.model=c,this.dimensionLayout=[],this.dimensions=[]},autoSortDimension:function(a){return a.qLibraryId?c.findLibraryDimension(a.qLibraryId).then(function(c){return c&&b.autoSortDimension(a,c.qData.info),a}):c.findField(a.qDef.qFieldDefs[0]).then(function(c){return c&&b.autoSortDimension(a,[c]),a})},getDimensions:function(){return this.dimensions||[]},minDimensions:function(){return 1},maxDimensions:function(){return 1e3},setModel:function(a){this.model=a},addDimension:function(a){var b,g,h=this;return a.qDef.cId=d.generateId(),a.qShowAlternatives=!0,this.getDimensions().length<f?(b=e.getType("listbox"),g=b.getInitialProperties({}),g.then(function(b){return h.autoSortDimension(a).then(function(){return b.qListObjectDef=a,a.qLibraryId?c.findLibraryDimension(a.qLibraryId).then(function(a){return b.title=a.qData.title,h.model.createChild(b,h.properties).then(function(){return b.qListObjectDef})}):(b.title=a.qDef.title||a.qDef.qFieldLabels[0]||a.qDef.qFieldDefs[0],h.model.createChild(b,h.properties).then(function(){return b.qListObjectDef}))})})):void 0},removeDimension:function(a){var b=this.layout.qChildList.qItems[a];return this.model.removeChild(b.qInfo.qId,this.properties).then(function(){return b})},getDimensionLayouts:function(){return this.dimensionLayout||[]},getDimensionLayout:function(a){var b=this.getDimensionLayouts();return b[a]?b[a].qListObject.qDimensionInfo:""}});return g}),define("text!extensions.qliktech/filterpane/filterpane.ng.html",[],function(){return'<qv-filterpane class="qv-filterpane" qv-collapsed-listbox-delegated-open outside-ignore-name="outsideIgnoreName">\r\n	<div ng-repeat="column in columns" class="qv-filterpane-column">\r\n		<div ng-repeat="item in column.items"\r\n			 ng-class="{\'qv-filterpane-collapsed\': !item.expand, \'qv-filterpane-expanded\': item.expand}"\r\n			 ng-style="{height: item.height}"\r\n			 tid="qv-object-filterpane.dimension">\r\n			<qv-object ng-if="item.expand" model="item.model" options="item.options" style="height: 100%; overflow: hidden;"></qv-object>\r\n			<qv-collapsed-listbox ng-if="!item.expand" model="item.model" outside-ignore-name="outsideIgnoreName" responsive-mode="item.responsiveMode"></qv-collapsed-listbox>\r\n		</div>\r\n\r\n		<div ng-if="column.showAll && object.expanded" class="qv-filterpane-collapsed qv-filterpane-showall">\r\n			<div class="presentation" q-title-translation="Tooltip.Filterpane.NotAllItemsShow"></div>\r\n		</div>\r\n		<div ng-if="column.showAll && !object.expanded" class="qv-filterpane-collapsed qv-filterpane-fullscreen">\r\n			<button class="add-button qui-outlinebutton"\r\n					ng-class="{ \'qui-disabled\': state.state }"\r\n					qva-activate="triggerFullScreen()"\r\n					q-title-translation="Tooltip.Filterpane.ClickForFullScreen"></button>\r\n		</div>\r\n	</div>\r\n</qv-filterpane>\r\n'}),define("extensions.qliktech/filterpane/filterpane-layout",["qvangular","general.utils/responsive-state","general.utils/property-resolver"],function(a,b,c){"use strict";var d=34,e=28,f=10,g=89,h=160,i=20,j=27,k=30;a.service("qvFilterpaneLayout",function(){return{getMaxColumns:function(a){return b.isSmallDevice?1:Math.floor((a.width+i)/(h+i))||1},getMaxItemsPerColumn:function(a){return Math.max(1,Math.floor((a.height+f)/(d+f)))},getDimensionCount:function(a){return a.qChildList.qItems.length},getColumnItemsCount:function(a){var b=0;return a.forEach(function(a){b+=a.itemCount}),b},getHeightOf:function(a){var b=(d+f)*a-f;return Math.max(b,0)},getDimensionCardinal:function(a){var b=c.getValue(a,"model.layout.qListObject.qDimensionInfo.qStateCounts",void 0);if(b)return Object.keys(b).reduce(function(a,c){return a+b[c]},0)},getHeightOfExpanded:function(a){var b=a*k+j+3;return b},doesAllFit:function(a,b,c){return a*b>=c},haveRoomToExpandOne:function(a,c){var d=c.itemCount>1?f:0;return b.isSmallDevice?!1:a.height>this.getHeightOf(c.itemCount-1)+g+d},getSize:function(a,b){return{width:a.innerWidth()-1,height:a.innerHeight(),dimensionCount:this.getDimensionCount(b)}},sizeChanged:function(a,b){return!angular.equals(a,b)},calculateColumns:function(a,c,d){var h=!b.isSmallDevice&&a.height>g,i=this.getMaxColumns(a),j=this.getMaxItemsPerColumn(a),k=this.getColumnItemsCount(c);if(h&&this.doesAllFit(j,i-c.length-1,a.dimensionCount-k-1))c.push({expand:!0,itemCount:1}),k+1<a.dimensionCount&&this.calculateColumns(a,c,d);else{var l;l=Math.min(a.dimensionCount-k,j),b.isSmallDevice?l=a.dimensionCount-k:d||(l=Math.ceil((a.dimensionCount-k)/(i-c.length)),l=Math.max(j,l),l=Math.min(a.dimensionCount-k,l)),c.push({expand:!1,itemCount:l}),c.length>=i&&j>0&&this.getColumnItemsCount(c)<a.dimensionCount&&(c[c.length-1].showAll=!0,e+f>a.height-this.getHeightOf(j)&&(c[c.length-1].itemCount=Math.max(c[c.length-1].itemCount-1,0))),this.getColumnItemsCount(c)<a.dimensionCount&&c.length<i&&this.calculateColumns(a,c,d)}},balanceColumns:function(a,b){var c,d,e;return c=b.filter(function(a){return a.expand}),d=b.filter(function(a){return a.expand===!1}),d.length>0&&!d[d.length-1].showAll&&this.haveRoomToExpandOne(a,d[d.length-1])?d[d.length-1].expandLast=!0:(e=this.getColumnItemsCount(d),d.forEach(function(a,b){var c,f;c=b<e%d.length?1:0,f=Math.floor(e/d.length)+c,a.itemCount=f},this)),d.concat(c)},getDimensions:function(a){return a.qChildList.qItems.map(function(a){return{id:a.qInfo.qId,expand:!1,height:void 0,responsiveMode:"full"}})},sortDimensions:function(a,b){var c;return c=a.qChildList.qItems.map(function(a){return a.qInfo.qId}),c.map(function(a){return b.filter(function(b){return b.id===a})[0]})},isValid:function(a){return!!a&&!!a.qChildList&&!!a.qChildList.qItems&&this.getDimensionCount(a)>0},mergeColumnsAndDimensions:function(a,b){return a.forEach(function(a){a.items=b.slice(0,a.itemCount),b=b.slice(a.itemCount)},this),a},reSizeArray:function(a,b,c,d){for(;a.length>b;)a.pop();for(;a.length<b;)a.push(c.extend(!0,{},d))},dimensionsEqual:function(a,b){return a.id===b.id&&a.expand===b.expand&&a.height===b.height},shouldDimensionBeUpdated:function(a,b){return!this.dimensionsEqual(a,b)},patchScope:function(a,b,c){this.resizeScopeArrays(a,b,c),a.columns.forEach(function(c,d,e){var f=b[d];e[d].showAll=f.showAll,e[d].expand=f.expand,e[d].expandLast=f.expandLast,e[d].itemCount=f.itemCount,c.items.forEach(function(b,c){this.shouldDimensionBeUpdated(b,f.items[c])&&(delete b.$$hashKey,delete b.model,b.expand||delete b.options,b.expand&&!b.options&&(b.options={isPopover:!1,isReadonly:a.object.isReadonly}),this.copyDimensionValues(f.items[c],b))},this)},this)},calculateExpandPriority:function(a,b){a.forEach(function(a){if(a.expandLast){for(var c=0,e=function(b){for(var d,e,f=a.items.length-1;f>=0;f--)if(d=this.getDimensionCardinal(a.items[f]),d&&5>d&&(e=this.getHeightOfExpanded(d),b>e&&!a.items[f].expand))return a.items[f].expand=!0,a.items[f].height=e+"px",c++,e;return!1},h=b.height-this.getHeightOf(a.itemCount-1)-f,i=0;h>g;){var j=e.call(this,h);if(!j)break;i+=j,h=b.height-this.getHeightOf(a.itemCount-c)-f-i}if(!c||h>g){var k=a.items[a.items.length-1];k.expand||(k.height=b.height-this.getHeightOf(a.itemCount-c-1)-i-f+"px",k.expand=!0)}}a.expand&&(a.items[0].expand=!0),1===a.items.length&&b.height<d-4&&(a.items[0].responsiveMode=b.height<.5*d?"spark":"small",a.items[0].height=b.height+"px")},this)},resolveAllModels:function(a,b,c,d){var e=[];return b.forEach(function(b,d){var f=a.columns[d]||{items:[]};b.items.forEach(function(a,b){var d=f.items[b]||{};(this.shouldDimensionBeUpdated(a,d)||!d.model)&&e.push(c(a))},this)},this),d.all(e)},resizeScopeArrays:function(a,b,c){a.columns.length!==b.length&&this.reSizeArray(a.columns,b.length,c,{items:[]}),a.columns.forEach(function(d,e){d.items.length!==b[e].items.length&&this.reSizeArray(a.columns[e].items,b[e].items.length,c,{})},this)},copyDimensionValues:function(a,b){Object.keys(a).forEach(function(c){b[c]=a[c]})},getResolveModelFunction:function(a,b,c){return function(d){return this.resolveModel(a,d,b,c)}.bind(this)},resolveModel:function(a,b,c,d){var e=a.get(b.id,d),f=new c;return e.then(function(a){return b.model=a,a.getLayout().then(function(){f.resolve()})}),f.promise}}})}),define("text!extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed.ng.html",[],function(){return'<div class="qv-collapsed-listbox" ng-class="{locked: isLocked, error: hasError, spark: responsiveMode == \'spark\', small: responsiveMode == \'small\'}" qva-outside-ignore-for="{{outsideIgnoreName}}">\r\n	<div class="error-layer"></div>\r\n	<div class="title" title="{{ title }}">\r\n		<span ng-if="isLocked" class="icon-toolbar-locked"></span>\r\n		<span class="title-text">{{ title }}</span>\r\n	</div>\r\n	<qv-state-count-bar ng-if="!hasError" cardinal="cardinal" state-counts="stateCounts"></qv-state-count-bar>\r\n	<i class="icon-triangle-right"></i>\r\n</div>'}),define("extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed",["qvangular","objects.models/listbox","text!./collapsed.ng.html","client.utils/state","client.views/state-count-bar/state-count-bar","objects/listbox-popover/listbox-popover-service"],function(a,b,c,d){"use strict";a.directive("qvCollapsedListbox",function(){return{restrict:"E",replace:!0,template:c,scope:{model:"=",outsideIgnoreName:"=",responsiveMode:"="},require:"^qv-collapsed-listbox-delegated-open",link:function(c){c.title="",c.hasError=!1,c.isLocked=!1,b.bindLayout(c,"model",function(b){a.$apply(c,function(){var a=b.qListObject.qDimensionInfo;c.hasError=b.qListObject.qError||b.qListObject.qDimensionInfo.qError?!0:!1,c.cardinal=a.qCardinal,c.stateCounts=a.qStateCounts,c.isLocked=a.qStateCounts.qLocked>0,c.title=b.title,c.id=b.qInfo.qId})})}}}),a.directive("qvCollapsedListboxDelegatedOpen",function(){return{restrict:"A",scope:{outsideIgnoreName:"="},controller:["$scope","$element","qvListboxPopoverService",function(a,b,c){function e(a,b){return{left:a.position().left-b.position().left,top:a.position().top-b.position().top,right:b.width()-a.position().left-a.width(),bottom:b.height()-a.position().top-a.height()}}function f(a,b){var c,d=e(a,b);return c=Math.max(d.left,d.right)>Math.max(d.top,d.bottom)?d.left>d.right?"left":"right":d.top>d.bottom?"top":"bottom"}var g;b.on("qv-activate",".qv-collapsed-listbox:not(.error)",function(e){var h=angular.element(e.target).closest(".qv-collapsed-listbox"),i=h.isolateScope().model,j=h.isolateScope().id,k={qvaOutsideIgnoreFor:a.outsideIgnoreName,$alignToElement:h,position:f(h,b),collision:"flipfit"};if(e.preventDefault(),a.$parent.allowInteraction(d)){if(j===g)return c.close(),void(g=void 0);g=j,c.show(i,k,function(){g=void 0})}})}]}})}),define("extensions.qliktech/filterpane/filterpane",["qvangular","util","core.utils/deferred","objects.backend-api/field-api","extensions.qliktech/filterpane/filterpane-properties","extensions.qliktech/filterpane/filterpane-handler","objects.utils/data-properties/listobject-util","general.utils/property-mapper","objects.models/listbox","text!./filterpane.ng.html","objects.extension/base-controller","objects.extension/export-format","objects.extension/object-conversion","client.utils/state","extensions.qliktech/filterpane/filterpane-layout","extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";var o,p,q=1e3,r=0,s=function(){return"filterpane-"+ ++r};return p=k.extend({size:{},columns:[],expandable:!1,init:function(a,b,c,d){this.$scope=a,this.$element=b,this.$timeout=c,this.filterpaneLayout=d,a.allowInteraction=this.allowInteraction.bind(this),a.object.throbberApi.off(),this.showThrobberTimeout=c(function(){a.object.throbberApi.show()},1e3),a.outsideIgnoreName=s(),a.columns=[],a.ext.expandable=function(){return this.expandable}.bind(this),a.state=n,a.options||(a.options={}),a.triggerFullScreen=function(){n.state||a.$emit("objectTrigger","zoomOnCell")}},onPaint:function(){this.update(this.$scope.layout)},onResize:function(){this.update(this.$scope.layout)},update:function(a){var d,e=this.size,f=this.$scope,g=this.columns,h=this.$element,j=f.object.model.session.currentApp,k=this.filterpaneLayout,l=k.getSize(h,a),m=k.getResolveModelFunction(i,c,j);return k.sizeChanged(e,l)&&(this.size=e=l,this.columns=g=this.getColumns(e)),k.isValid(a)?(d=k.getDimensions(a),d=k.sortDimensions(a,d),g=k.mergeColumnsAndDimensions(g,d),void k.resolveAllModels(f,g,m,c).then(function(){k.patchScope(f,g,b),k.calculateExpandPriority(f.columns,e),this.$timeout.cancel(this.showThrobberTimeout),f.object.throbberApi.hide(),this.expandable=!f.columns.some(function(a){return a.items.some(function(a){var b=a.model;return b&&b.layout&&b.layout.qSelectionInfo&&b.layout.qSelectionInfo.qInSelections})})}.bind(this))):void(f.columns=g=[])},getColumns:function(a){var b=[];return this.filterpaneLayout.calculateColumns(a,b,this.$scope.options.zoomEnabled),this.filterpaneLayout.balanceColumns(a,b)},setInteraction:function(a){this.$scope.columns.forEach(function(b){b.items.forEach(function(b){b.expand&&(b.options.interactionEnabled=a)})})}}),p.$inject=["$scope","$element","$timeout","qvFilterpaneLayout"],o={type:"filterpane",template:j,BackendApi:d,filterpaneController:p,definition:e,initialProperties:{version:.96,qChildListDef:{qData:{info:"/qInfo"}}},data:{dimensions:{min:1,max:1e3}},expandable:function(){return!1},mapProperties:function(){this.mappedDefinition=h.mapDefinition(this.definition,this.type),this.dimensionDefinition={min:1}},getCreatePropertyHandler:function(){return new f(this.dimensionDefinition)},addFieldDimension:function(b,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.setModel(c.model),e.addFieldDimension(b.value,"").then(function(b){a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})})},addLibraryDimension:function(b,c){return c.model.getProperties().then(function(d){var e=c.ext.getCreatePropertyHandler();return e.setProperties(d),e.setModel(c.model),e.addLibraryDimension(b.libraryId).then(function(b){a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)})})},getDropFieldOptions:function(b,c,d){c.getDimensions().length<c.maxDimensions()&&(c.setModel(d),c.addFieldDimension(b.item.name,"").then(function(b){d.save(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)}))},getDropDimensionOptions:function(b,c,d){c.getDimensions().length<c.maxDimensions()&&(c.setModel(d),c.addLibraryDimension(b.item.id).then(function(b){d.save(),a.$rootScope.$broadcast("pp-open-path","data."+b.qDef.cId)}))},getDropMeasureOptions:function(a,b,c,d){d()},exportProperties:function(a){var b,c,d,e,f,g=new l,h=a.qProperty,i=g.data[0];for(c=0;c<a.qChildren.length;++c)b=a.qChildren[c].qProperty,i.dimensions.push({qDef:b.qListObjectDef.qDef,qLibraryId:b.qListObjectDef.qLibraryId,qOtherTotalSpec:b.qListObjectDef.qOtherTotalSpec||{qOtherMode:"OTHER_OFF",qOtherCounted:{qv:"10"}},title:b.title});if(h.qLayoutExclude&&h.qLayoutExclude.qHyperCubeDef){if(h.qLayoutExclude.qHyperCubeDef.qDimensions)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qDimensions.length;++c)i.dimensions.push(h.qLayoutExclude.qHyperCubeDef.qDimensions[c]);if(h.qLayoutExclude.qHyperCubeDef.qMeasures)for(c=0;c<h.qLayoutExclude.qHyperCubeDef.qMeasures.length;++c)i.measures.push(h.qLayoutExclude.qHyperCubeDef.qMeasures[c])}for(e in h)"qChildListDef"!==e&&(g.properties[e]=h[e]);if(h.qLayoutExclude||(h.qLayoutExclude={}),h.qLayoutExclude.disabled){for(e in h.qLayoutExclude.disabled)f=e,g.properties.hasOwnProperty(f)||(g.properties[f]=h.qLayoutExclude.disabled[e]);h.qLayoutExclude.disabled.previousShowTitles&&(g.properties.showTitles=!0)}for(delete h.qLayoutExclude,c=0;c<i.dimensions.length;++c)for(d=0;d<i.dimensions[c].qDef.qSortCriterias.length;++d)i.dimensions[0].qDef.qSortCriterias[d].qSortByFrequency=0,i.dimensions[0].qDef.qSortCriterias[d].qSortByState=0;return g},importProperties:function(a,c){var d,e,f,h={qChildren:[]},i={},j=a.data[0];d=q,i.qLayoutExclude||(i.qLayoutExclude={}),i.qLayoutExclude.disabled={};for(e in a.properties)"qLayoutExclude"===e?a.properties[e].quarantine&&(i.qLayoutExclude.quarantine=b.extend(!0,{},a.properties[e].quarantine)):c.hasOwnProperty(e)||"qMetaDef"===e?i[e]=a.properties[e]:i.qLayoutExclude.disabled[e]=a.properties[e];for(i=b.extend(!0,{},c,i),f=0;f<j.dimensions.length;++f)h.qChildren.length<d?h.qChildren.push({qProperty:g.createDefaultListBox(j.dimensions[f],j.dimensions[f].title),qChildren:[]}):(i.qLayoutExclude||(i.qLayoutExclude={}),i.qLayoutExclude.qHyperCubeDef||(i.qLayoutExclude.qHyperCubeDef={}),i.qLayoutExclude.qHyperCubeDef.qDimensions||(i.qLayoutExclude.qHyperCubeDef.qDimensions=[]),i.qLayoutExclude.qHyperCubeDef.qDimensions.push(j.dimensions[f]));for(f=0;f<j.measures.length;++f)i.qLayoutExclude||(i.qLayoutExclude={}),i.qLayoutExclude.qHyperCubeDef||(i.qLayoutExclude.qHyperCubeDef={}),i.qLayoutExclude.qHyperCubeDef.qMeasures||(i.qLayoutExclude.qHyperCubeDef.qMeasures=[]),i.qLayoutExclude.qHyperCubeDef.qMeasures.push(j.measures[f]);return m.importCommonProperties(i,a,c),i.showTitles&&(i.qLayoutExclude.disabled.previousShowTitles=!0,i.showTitles=!1),h.qProperty=i,h}},a.directive("qvFilterpane",function(){return{controller:p,require:["qvFilterpane","^qvObject"],replace:!0,restrict:"E",link:function(a,b,c,d){var e=d[0],f=d[1];f.addChildController(e)}}}),o}),define("text!extensions.qliktech/text-image/text-image.ng.html",[],function(){return'<div qv-extension style=\'width: 100%; height: 100%;\' qva-activate="edit()">\r\n	<div class="qv-media-tool-html" ng-class="[sizeClass, visibilityClass, responsiveClass]" ng-click="clickHtml($event)" ng-if="!editing && !initializing && !saving && !empty" ng-bind-html="html"></div>\r\n	<div class="text-image-hint" ng-if="empty && !editing" ng-class="{ \'selected\': isSelected() }">\r\n		<div class="hint-content" ng-show="!isSelected() || !editmode || object.isLink">\r\n			<i class="hint-icon icon-text-image"></i>\r\n			<div class="text" q-translation="Object.TextImage.EmptyHint"></div>\r\n		</div>\r\n		<div class="hint-content" ng-show="isSelected() && editmode && !object.isLink">\r\n			<i class="hint-icon icon-add"></i>\r\n			<div class="text" q-translation="Object.TextImage.EmptySelectedHint"></div>\r\n		</div>\r\n	</div>\r\n	<div class="qv-media-tool-editor" ng-class="[sizeClass, visibilityClass, responsiveClass]" ng-if="initializing || editing || saving" qv-text-image-editor x-editor-options="editorOptions" x-save="save"></div>\r\n</div>'}),define("extensions.qliktech/text-image/text-image-properties",["general.utils/property-resolver"],function(a){return{type:"items",component:"accordion",items:{data:{uses:"data"},settings:{uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}},presentation:{type:"items",translation:"properties.presentation",items:{responsive:{type:"string",component:"dropdown",ref:"responsive",translation:"properties.textImage.responsive",defaultValue:"all",undefinedValue:"none",snapshot:{tid:"property-responsive"},options:[{value:"all",translation:"properties.textImage.responsive.textImages"},{value:"text",translation:"properties.textImage.responsive.text"},{value:"images",translation:"properties.textImage.responsive.images"},{value:"none",translation:"properties.textImage.responsive.none"}]}}},markdown:{type:"string",ref:"markdown",show:!1,defaultValue:""},images:{type:"array",ref:"images",show:!1,defaultValue:[]},backgroundImage:{type:"items",translation:"properties.backgroundImage",grouped:!0,items:{useBackgroundImage:{ref:"background.isUsed",type:"boolean",translation:"properties.backgroundImage.use",component:"switch",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},backgroundUrl:{ref:"background.url.qStaticContentUrlDef.qUrl",layoutRef:"background.url.qStaticContentUrl.qUrl",schemaIgnore:!0,translation:"Common.Image",tooltip:{select:"properties.media.select",remove:"properties.media.removeBackground"},type:"string",component:"media",defaultValue:"",show:function(b){return a.getValue(b,"background.isUsed")}},backgroundSize:{ref:"background.size",translation:"properties.backgroundImage.size",type:"string",component:"dropdown",defaultValue:"auto",options:[{value:"auto",translation:"Common.Auto"},{value:"alwaysFit",translation:"properties.backgroundImage.sizeAlwaysFit"},{value:"fitWidth",translation:"properties.backgroundImage.sizeFitWidth"},{value:"fitHeight",translation:"properties.backgroundImage.sizeFitHeight"},{value:"fill",translation:"properties.backgroundImage.sizeStretch"}],show:function(b){return a.getValue(b,"background.isUsed")&&a.getValue(b,"background.url.qStaticContentUrlDef.qUrl")}},backgroundPosition:{ref:"background.position",translation:"Common.Position",type:"string",component:"align-matrix",defaultValue:"topLeft",show:function(b){return a.getValue(b,"background.isUsed")&&a.getValue(b,"background.url.qStaticContentUrlDef.qUrl")}}}}}}}}}),define("extensions.qliktech/text-image/measure-utils",["general.utils/array-util","util"],function(a,b){function c(a,b){var c,d,e,f=[],g=[];for(c=a.map(function(a){return a.qDef.cId}),d=b.map(function(a){return a.qDef.cId}),e=d.length-1;e>=0;--e)c.contains(d[e])||f.push({index:e,id:d[e],measure:b[e]});for(e=0;e<c.length;++e)d.contains(c[e])?c.lastIndexOf(c[e])!==e&&g.push({index:e,id:c[e],measure:a[e]}):g.push({index:e,id:c[e],measure:a[e]});return{removed:f,added:g}}function d(a,b){return b.replace(/=\[(\w*?)]\((\w*?)\)/g,function(b,c,d){return a===d?"":b})}function e(a,b,c,d){var e=-1;return c.replace(/=\[(\w*?)]\((\w*?)\)/g,function(c,f,g){if(g===a){++e;var h="undefined"!=typeof d;if(!h||h&&e===d)return"=["+f+"]("+b+")"}return c})}function f(d,f){var g=f.qHyperCubeDef.qMeasures,h=c(d,g);h.removed.forEach(function(b){var c=b.index;g.splice(c,1),a.indexRemoved(f.qHyperCubeDef.qInterColumnSortOrder,f.qHyperCubeDef.qDimensions.length+c)}),h.added.forEach(function(c){var d=c.measure.qDef.cId,h=b.generateId();c.measure.qDef.cId=h,g.push(c.measure),a.indexAdded(f.qHyperCubeDef.qInterColumnSortOrder,f.qHyperCubeDef.qDimensions.length+g.length-1),f.markdown=e(d,h,f.markdown,1)})}return{removeMeasure:d,replaceMeasure:e,syncMeasures:f}}),define("extensions.qliktech/text-image/image-utils",["general.services/media-tool/markdown-html-parser","general.models/media-library","util"],function(a,b,c){function d(a,b){function c(a){for(var c=0;c<b.length;c++)if(b[c].id===a)return b[c].url.qStaticContentUrlDef.qUrl;return null}var d,e=[],f=[],g=a.map(function(a){return a.id||""}),h=b.map(function(a){return a.id});for(d=h.length-1;d>=0;--d)g.contains(h[d])||e.push({index:d,id:h[d],url:b[d].url});for(d=0;d<g.length;++d)h.contains(g[d])?g.lastIndexOf(g[d])!==d&&f.push({index:d,id:g[d],url:c(g[d])}):f.push({index:d,id:g[d],url:a[d].url});return{removed:e,added:f}}function e(a,b,c,d){var e=-1;return c.replace(/!\[(\w*?)]\((.*?)\)/g,function(c,f,g){if(f===a){++e;var h="undefined"!=typeof d;if(!h||h&&e===d)return"!["+b+"]("+g+")"}return c})}function f(f,g){g.images||(g.images=[]);var h=g.images,i=d(f,h);i.removed.forEach(function(a){var b=a.index;h.splice(b,1)}),i.added.forEach(function(d){var f=d.id,i=c.generateId(),j=a.unescapeMarkdown(d.url);j=b.stripBasePath(j),h.push({id:i,url:{qStaticContentUrlDef:{qUrl:j}}}),f?g.markdown=e(f,i,g.markdown,1):g.markdown=e(f,i,g.markdown,0)})}return{syncImages:f}}),define("extensions.qliktech/text-image/text-image",["jquery","qvangular","lz-string","text!./text-image.ng.html","./text-image-properties","objects.backend-api/hypercube-api","client.utils/state","general.services/media-tool/media-tool-service","general.utils/string-limits","./measure-utils","./image-utils","general.models/media-library","core.utils/resize"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(c,d){if("none"===c.responsive||"undefined"==typeof c.responsive)c.sizeClass="",c.visibilityClass="",c.responsiveClass="";else{c.sizeClass="",c.visibilityClass="hidden","images"===c.responsive?c.responsiveClass="responsive-images":"text"===c.responsive?c.responsiveClass="responsive-text":c.responsiveClass="responsive-images responsive-text";var e=b.getService("$timeout"),f=d.find(".qv-media-tool-html")[0];if(!f)return void(c.visibilityClass="");e(function(){c.sizeClass="",c.sizeStyle={maxWidth:"100%",maxHeight:"100%"},a(f).find("img").css(c.sizeStyle);var b=f.scrollHeight/f.clientHeight;b>1&&(c.sizeStyle={maxWidth:Math.floor(1/b*100)+"%",maxHeight:Math.floor(1/b*100)+"%"},a(f).find("img").css(c.sizeStyle)),b>3?c.sizeClass="bp-4":b>2?c.sizeClass="bp-3":b>1.5?c.sizeClass="bp-2":b>1?c.sizeClass="bp-1":c.sizeClass="",c.visibilityClass=""},10)}}function o(a){return!h.hasContent(a)||""===a.trim()}var p,q,r=b.getService("$sce");return p={auto:"auto auto",alwaysFit:"contain",fitWidth:"100% auto",fitHeight:"auto 100%",fill:"100% 100%"},q={topLeft:"0% 0%",centerLeft:"50% 0%",bottomLeft:"100% 0%",topCenter:"0% 50%",centerCenter:"50% 50%",bottomCenter:"100% 50%",topRight:"0% 100%",centerRight:"50% 100%",bottomRight:"100% 100%"},b.directive("qvTextImageEditor",[function(){return{restrict:"A",scope:{editorOptions:"=",save:"="},link:function(b,c){h.show(c,b.editorOptions),c.on("qv-outside",function(c){var d=a(c.target);d.closest(".qv-texttool-toolbar, .modal-container, .qui-immidiateContextual").length||b.save()}),b.$on("$destroy",function(){b.save(),h.hide()})}}}]),{type:"text-image",BackendApi:f,definition:e,initialProperties:{version:.96,qHyperCubeDef:{qDimensions:[],qMeasures:[],customErrorMessage:{calcCond:""}},images:[],markdown:"",background:{url:{},size:"auto"}},data:{measures:{min:0,max:1e3,add:function(a,b){b.markdown+="=[]("+a.qDef.cId+")"},remove:function(a,b){b.markdown=j.removeMeasure(a.qDef.cId,b.markdown)},replace:function(a,b,c,d){d.markdown=j.replaceMeasure(b.qDef.cId,a.qDef.cId,d.markdown)}}},snapshot:{canTakeSnapshot:function(a){return!o(a.layout.markdown)}},exportProperties:null,importProperties:null,template:d,showRequirements:function(){return!1},getDropMeasureOptions:function(a,b,c,d){b.getMeasures().length<b.maxMeasures()?"expression"===a.item.type?b.addExpressionMeasure(a.item.name,"").then(function(){c.save()}):b.addLibraryMeasure(a.item.id).then(function(){c.save()}):(a.ReplaceMeasures(c,b),d())},controller:["$scope",function(d){function e(a){var b=[];return a.find(".tokenized-measure").each(function(a,d){var e=d.getAttribute("data-measure");e=c.decompressFromBase64(e),b.push(JSON.parse(e))}),b}function f(a){function b(a){for(var b=h.getOptions().insertedImages,c=0;c<b.length;c++)if(b[c].url===a)return b[c].urlDef;return null}var c=[];return a.find("img").map(function(a,d){var e=d.getAttribute("data-image-id"),f=d.getAttribute("src"),g=b(f);g||(g=d.getAttribute("src")),c.push({id:e,url:g})}),c}function l(){b.$apply(d,function(){d.editing=!1})}d.isSelected=function(){return d.options.isActive||d.options.isZoomed},d.$watch("editing",function(a){d.object.preventDrag=a}),d.edit=function(){!g.isInEditMode()||d.editing||d.object.isLink||d.isSelected()&&(d.saving=!1,d.saved=!1,d.backendApi.getProperties().then(function(a){var b=d.ext.getCreatePropertyHandler();b.setProperties(a),d.editorOptions={markdown:a.markdown,maxlength:i.textImage,toolbar:{buttons:"all",width:564},useMeasures:!0,useImageArray:!0,layout:d.backendApi.model.layout,properties:a,propertyHandler:b,copiedMeasures:[],insertedImages:[],onOpen:function(a){a.saveRange(),d.$apply(function(){d.editing=!0,d.initializing=!1})},isActive:function(){return d.editing||d.initializing}},d.initializing=!0}))},d.save=function(){if(!d.saving&&!d.saved){h.closing();var a=h.getMarkdown(),b=h.getEditorElement();if(null!==a&&a!==d.markdown){d.saving=!0;var c=h.getOptions().properties;c.markdown=a,j.syncMeasures(e(b),c),k.syncImages(f(b),c),d.backendApi.model.save(),d.saved=!0}else d.editing=!1}},d.clickHtml=function(b){var c=g.isInEditMode()||g.state===g.States.snapshot;c&&a(b.target).closest("a").length&&b.preventDefault()},m.on("start",l),d.$on("$destroy",function(){m.off("start",l)})}],view:{paint:function(a,b){function c(){return b.background&&b.background.isUsed&&b.background.url&&b.background.url.qStaticContentUrl&&b.background.url.qStaticContentUrl.qUrl||""}var d=this.$scope,e="",f="",g="",i="";d.saving&&(d.editing=!1,d.saving=!1),e=c(),e&&(l.stripBasePath(e),e=e.replace(/"/g,'\\"'),e=e.replace(/'/g,"\\'"),f="url('"+l.addBasePath(e)+"')",g=p[b.background.size]||p.auto,i=q[b.background.position]||q.topLeft),this.$element.css({backgroundImage:f,backgroundSize:g,backgroundPosition:i,backgroundRepeat:"no-repeat"}),d.empty=o(b.markdown)&&!e,d.html=r.trustAsHtml(h.toHTML(b.markdown,b)),d.markdown=b.markdown,d.responsive=b.responsive,n(d,this.$element)},resize:function(){this.paint.apply(this,arguments)},onStateChanged:function(){this.$scope.editmode=g.isInEditMode(),this.$scope.editmode||(this.$scope.editing=!1)}},getDropFieldOptions:function(a,b,c,d,e){a.AddFieldAsMeasure(c,b,e),d()},getDropDimensionOptions:function(a,b,c,d){d()}}}),define("objects.backend-api/pivot-api",["./backend-api"],function(a){"use strict";function b(a,b,c){var d,e,f,g=[];for(e=0;e<b.length;e++)for(d=0;d<a.length;d++)f={qType:c,qCol:b[e],qRow:a[d]},g.push(f);return g}var c;return c=a.extend("PivotApi",{init:function(a){this._super(a,"/qHyperCubeDef",{mode:"P"}),this.cacheCube.setMethodName("GetHyperCubePivotData")},updateCache:function(a){a&&a.qHyperCube&&"P"===a.qHyperCube.qMode?(this.cacheCube.set(a.qHyperCube.qPivotDataPages),this.cacheCube.setCubeSize(a.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear();
},getData:function(a){switch(this.model.layout.qHyperCube.qMode){case"P":return this.cacheCube.getData(a);default:throw"you are using a non-supported backend-api"}},getReducedData:function(a,b,c){return c=void 0!==c?c:"D1",this.model.rpc("GetHyperCubeReducedData","qDataPages",[this.path,a,b,c])},select:function(a,c,d){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.rpc("SelectPivotCells",null,[this.path,b(a,c,d)]);default:throw"you are using a non-supported backend-api"}},expandTop:function(a,b,c){return this.model.rpc("ExpandTop",null,[this.path,a,b,c])},expandLeft:function(a,b,c){return this.model.rpc("ExpandLeft",null,[this.path,a,b,c])},collapseTop:function(a,b,c){return this.model.rpc("CollapseTop",null,[this.path,a,b,c])},collapseLeft:function(a,b,c){return this.model.rpc("CollapseLeft",null,[this.path,a,b,c])},clearSelections:function(){return this.model.rpc("ResetMadeSelections")},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},getSize:function(){return this.model.layout.qHyperCube.qSize}})}),define("extensions.qliktech/pivot-table/pivot-table-properties",["client.property-panel/default-properties","general.utils/property-resolver","util","translator"],function(a,b,c,d){function e(a,b,c){if(!c.properties.qHyperCubeDef.qIndentMode)return!0;var d,e=c.properties.qHyperCubeDef.qInterColumnSortOrder.indexOf(-1),f=c.properties.qHyperCubeDef.qNoOfLeftDims;return e>-1&&f>e&&f--,d=c.properties.qHyperCubeDef.qDimensions.indexOf(a),0===d||d>=f}var f,g,h;f={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{alwaysFullyExpanded:{ref:"qHyperCubeDef.qAlwaysFullyExpanded",type:"boolean",translation:"properties.pivot.fullyExpanded",defaultValue:!1},indentMode:{ref:"qHyperCubeDef.qIndentMode",type:"boolean",translation:"properties.pivot.indentMode"}}}}},g={uses:"sorting",component:"pivot-sorting"};var i={type:"items",component:"pivot-data",translation:"properties.data",addTranslation:"Properties.AddData",items:{dimensions:c.extend(!0,{},a.dimensions,{items:{globalGrouping:{type:"boolean",translation:"properties.dimensionLimits.globalGrouping",ref:"qOtherTotalSpec.qGlobalOtherGrouping",defaultValue:!1,show:function(a){return"OTHER_OFF"!==b.getValue(a,"qOtherTotalSpec.qOtherMode")}},totalMode:{type:"string",component:"switch",translation:"properties.showTotals",ref:"qOtherTotalSpec.qTotalMode",defaultValue:"TOTAL_OFF",trueOption:{value:"TOTAL_EXPR",translation:"properties.on"},falseOption:{value:"TOTAL_OFF",translation:"properties.off"},show:e},totalsLabel:{type:"string",component:"expression",expressionType:"StringExpr",ref:"qTotalLabel",translation:"properties.dimensionLimits.totals",defaultValue:function(){return d.get("properties.dimensionLimits.totals")},show:function(a,c,d){return"TOTAL_OFF"!==b.getValue(a,"qOtherTotalSpec.qTotalMode")&&e(a,c,d)}}}}),measures:c.extend(!0,{},a.measures,{items:{tableColorBgByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.0.qExpression",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:""},tableColorByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.1.qExpression",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",change:function(a){void 0===a.qAttributeExpressions[0]&&(a.qAttributeExpressions[0]={})}}}})}};return h={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling"}}},{type:"items",component:"accordion",items:{data:i,sorting:g,addons:h,settings:f}}}),define("extensions.qliktech/pivot-table/pivot-sorting-util",["general.utils/array-util"],function(a){function b(a){function b(){for(var b=[],c=0;c<d.length;c++)b.push(c);var e=a.qMeasures.length>=2;return e&&b.push(-1),b}var d=a.qDimensions;c(d,a.qInterColumnSortOrder)&&(a.qInterColumnSortOrder=b())}function c(a,b){var c={},d=[],e=!1,f=-1!==b.indexOf(-1);b.forEach(function(a){c[a]?e=!0:c[a]=!0}),e=f?e||a.length+1!==Object.keys(c).length:e||a.length!==Object.keys(c).length,Object.keys(c).forEach(function(a){"-1"!==a&&d.push(parseInt(a,10))}),d=d.sort(function(a,b){return a-b});for(var g=0;g<d.length;++g)e=e||d[g]!==g;return e}function d(c){function d(){for(var b=0;b<e.length;b++)if(-1!==e[b]&&e[b]!==b){var c=e[b],d=e.indexOf(b),h=e[d];a.swap(e,b,d),a.swap(f,b,d),a.swap(g,g.indexOf(c),g.indexOf(h))}}b(c);var e,f=c.qDimensions,g=c.qInterColumnSortOrder;e=g.filter(function(a){return-1!==a}),d()}function e(a,b){var c=a.qDimensions,d=a.qInterColumnSortOrder,e=[],f=b.indexOf(-1);b.forEach(function(a){-1!==a&&e.push(c[a])}),e.forEach(function(a,b){c[b]=a}),d.splice(0,d.length);for(var g=0;g<e.length;g++)d.push(g);f>-1&&d.splice(f,0,-1)}function f(a,b){var c=a.qMeasures,d=[];b.forEach(function(a){d.push(c[a])}),c.splice(0,c.length),d.forEach(function(a){c.push(a)})}return{validatePivotHyperCube:b,fixPivotHypercubeOrders:d,reorderPivotDimensions:e,reorderMeasures:f,isInvalidOrderArray:c}}),define("extensions.qliktech/pivot-table/pivot-hypercube-handler",["objects.utils/data-properties/hypercube-handler","core.utils/deferred","general.utils/array-util","extensions.qliktech/pivot-table/pivot-sorting-util","util"],function(a,b,c,d,e){"use strict";var f,g=1e3;return f=a.extend({addDimension:function(a,c){var f=this.getDimensions(),g=this;return a.qDef.cId||(a.qDef.cId=e.generateId()),f.length<this.maxDimensions()?this.autoSortDimension(a).then(function(){var e,h,i=g.hcProperties.qNoOfLeftDims,j=f.length;return d.fixPivotHypercubeOrders(g.hcProperties),e=g.hcProperties.qInterColumnSortOrder,h=e.indexOf(-1),c||-1!==i?!c&&i>=0?(h>=i?(e.splice(h,1),e.push(j),e.splice(h+1,0,-1)):e.push(j),f.splice(i,0,a),g.hcProperties.qNoOfLeftDims++):(0===j&&(g.hcProperties.qNoOfLeftDims=0),e.push(j),f.push(a)):(g.hcProperties.qNoOfLeftDims=1,e.unshift(j),f.splice(0,0,a)),b.resolve(a)}):void 0},removeDimension:function(a){var e,f,g,h=this.getDimensions(),i=this.properties.qHyperCubeDef.qNoOfLeftDims,j=this.hcProperties.qInterColumnSortOrder;for(g=0;g<j.length;g++)if(j[g]===a){f=g;break}return i>=f+1&&this.properties.qHyperCubeDef.qNoOfLeftDims--,e=h.splice(a,1)[0],c.indexRemoved(this.hcProperties.qInterColumnSortOrder,a),d.fixPivotHypercubeOrders(this.hcProperties),b.resolve(e)},addMeasure:function(a){var c=this.getMeasures(),d=this;if(a.qDef.cId||(a.qDef.cId=e.generateId()),delete a.qDef.qNumFormat,c.length<this.maxMeasures()){var f=1===c.length;return c.push(a),this.autoSortMeasure(a).then(function(){return f&&d.hcProperties.qInterColumnSortOrder.push(-1),a})}return c.length<g?(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(a),b.resolve(a)):void 0},removeMeasure:function(a){var c,d,e,f=this.getMeasures();if(a<f.length){if(c=2===f.length,d=this.hcProperties.qMeasures.splice(a,1)[0],this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length)f.push(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(0,1)[0]);else if(c){var g=this.hcProperties.qInterColumnSortOrder;e=g.indexOf(-1),g.splice(e,1),e+1<=this.hcProperties.qNoOfLeftDims&&this.hcProperties.qNoOfLeftDims--}}else d=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(a-f.length,1)[0];return b.resolve(d)},getSorting:function(){throw"don't call this"},changeSorting:function(){throw"don't call this"},setSorting:function(){throw"don't call this"}})}),define("text!extensions.qliktech/pivot-table/pivot-table.ng.html",[],function(){return'<div class="qv-pt" ng-class="{ \'qv-pt-interactive\': interactive, \'sortable-active\': pivoting.dragPlaceholder }">\r\n	<qv-scroll-area x-non-mouse-viewport-scrolling="nonMouseViewportScrolling"\r\n					class="qv-grid-object-scroll-area"\r\n					qva-delegated-activate=".qv-pt-expandable#interactive && !selectionsApi.active && collapseExpand($event);"\r\n					qv-sortable-list="pivoting">\r\n		<table	qv-selections-select-while-locked="selectWhileLocked()"\r\n				qv-selections-toggle-dimension-value="{ selector: \'.cell\' }"\r\n				qv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, $event)"\r\n				qv-selections-exclude-toggle-dimension-value="excludeDimensionToggle($event)"\r\n				qv-selections-multiselect="{ selector: \'.cell:not(.null-value)\' }"\r\n				qv-selections-start-multiselect="interactive && activateSelections(cell)"\r\n				qv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\r\n				qv-selections-end-multiselect="interactive && multiselect()">\r\n			<colgroup>\r\n				<col ng-repeat="cell in metaGhostHeaders.headers" ng-style="cell.style" />\r\n			</colgroup>\r\n			<tbody>\r\n				<tr ng-repeat="row in grid.headerRows" tid="header.row"\r\n					ng-class="row.classList">\r\n					<th ng-repeat="cell in row.cells"\r\n						ng-class="cell.classList"\r\n						class="cell"\r\n						colspan="{{cell.colspan}}"\r\n						rowspan="{{cell.rowspan}}"\r\n						ng-style="cell.style"\r\n						qv-pivot-table-include="cell.templateSrc"\r\n						title="{{cell.text}}"\r\n						tid="header.row.cell"></th>\r\n				</tr>\r\n				<tr ng-repeat="row in grid.rows" tid="data.row">\r\n					<td ng-repeat="cell in row.cells"\r\n						ng-class="cell.classList"\r\n						class="cell"\r\n						colspan="{{cell.colspan}}"\r\n						rowspan="{{cell.rowspan}}"\r\n						ng-style="cell.style"\r\n						qv-pivot-table-include="cell.templateSrc"\r\n						title="{{cell.text}}"\r\n						tid="data.row.cell"></td>\r\n				</tr>\r\n			</tbody>\r\n		</table>\r\n	</qv-scroll-area>\r\n</div>\r\n'}),define("text!extensions.qliktech/pivot-table/cell-item.ng.html",[],function(){return'<div class="value">\r\n	{{cell.text}}\r\n</div>'}),define("text!extensions.qliktech/pivot-table/header-cell-item.ng.html",[],function(){return'<div class="value">\r\n	<i class="qv-pt-expandable" ng-if="cell.collapseExpandClass" ng-class="cell.collapseExpandClass"></i>\r\n	<span>{{cell.text}}</span>\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-left.ng.html",[],function(){return'<div class="left-meta-headers list"\r\n	 tid="meta.rows"\r\n	 ng-repeat="list in [pivoting.rows]"\r\n	 qv-pivot-table-include="list.templateSrc">\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-top.ng.html",[],function(){return'<div class="top-meta-headers list"\r\n	 tid="meta.columns"\r\n	 ng-repeat="list in [pivoting.columns]"\r\n	 qv-pivot-table-include="list.templateSrc">\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-list.ng.html",[],function(){return'<div class="button-wrapper"\r\n	 ng-repeat="header in list.items track by header.id"\r\n	 qv-pivot-table-include="header.templateSrc">\r\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-item.ng.html",[],function(){return'<div class="qui-outlinebutton qv-pt-meta-button"\r\n		tid="meta.button"\r\n		ng-style="header.style"\r\n		ng-class="{ \'qui-active\': header.open, \'pseudo\': header.isPseudoDim, \'dragging\': header.dragging, \'qui-disabled\': !interactive || selectionsApi.active }"\r\n		qva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\r\n		qva-activate="!header.isPseudoDim && !selectionsApi.active && interactive && showDimension($event, header)"\r\n		title="{{header.title}}">\r\n	<div class="meta-text">{{header.title}}</div>\r\n	<i ng-if="!header.isPseudoDim" class="icon-triangle-bottom meta-arrow"></i>\r\n</div>'}),define("ng",[],function(){return{load:function(a,b,c,d){function e(){"undefined"!=typeof window&&window.qvangularGlobal?c(window.qvangularGlobal.getService(a)):setTimeout(e,5)}d.isBuild||"undefined"==typeof window?c():e()}}}),define("objects.grid/data-grid-provider",["qvangular","./data-grid"],function(a,b){"use strict";a.provider("qvDataGrid",function(){this.$get=[function(){return function(a){return new b(a)}}]})}),define("extensions.qliktech/pivot-table/meta/ghost-headers-provider",["qvangular","util","translator","general.utils/support"],function(a,b,c,d){"use strict";function e(a){this.calcApprMaxGlyphCnt=a,this.style={}}function f(a,c,e){this.metaHeaderPadding=10;var f={glyphWidth:i,collapseExpandIconGlyphCnt:d.treatAsDesktop()?3:4,columnPaddingGlyphCnt:3,metaHeaderMaxGlyphCnt:(150+this.metaHeaderPadding)/i,cellPaddingGlyphCnt:Math.ceil(12/i),buttonPaddingGlyphCnt:Math.ceil(20/i),buttonArrowGlyphCnt:Math.ceil(13/i),buttonMarginOfSafetyGlyphCnt:2,leftTree:{emptyGlyphCnt:3,widthFactor:.35},topTree:{wideWidthFactor:.3,growFactor:1.2}};this.opts=b.extend(!0,f,a),this.layout=c,this.viewportRect=e,this.headers=[],this.maxGlyphs=0,this.availableGlyphs=0,this.totLeftGlyphCnt=0,this.leftCellCnt=0,this.dataColumnsInfo={cnt:0,width:0}}function g(a){var b=!!this.layout.qHyperCube.qAlwaysFullyExpanded;return this.sortOrder.filter(function(b,c){return a?c>=this.leftDimCnt:c<this.leftDimCnt},this).map(function(a,c){var d=0;if(-1===a)return 0;var e=this.layout.qHyperCube.qDimensionInfo[a];return c+1<this.leftDimCnt?(d=e.qApprMaxGlyphCount,b||(d+=this.opts.collapseExpandIconGlyphCnt),d=Math.max(e.othersLabel.length,d)):(d=e.qApprMaxGlyphCount,d+=this.opts.columnPaddingGlyphCnt),d},this).sort(function(a,b){return b-a})[0]||0}function h(a){return this.sortOrder.filter(function(b,c){return a?c>=this.leftDimCnt:c<this.leftDimCnt},this).map(function(a){var b=0;return-1===a?b=c.get("Common.Measures").length:(b=this.layout.qHyperCube.qDimensionInfo[a].qFallbackTitle.length+this.opts.buttonArrowGlyphCnt,b=Math.max(this.layout.qHyperCube.qDimensionInfo[a].othersLabel.length,b)),b+this.opts.buttonPaddingGlyphCnt+this.opts.buttonMarginOfSafetyGlyphCnt},this).sort(function(a,b){return b-a})[0]||0}var i=8;f.prototype={_reset:function(){this.headers.length=0,this.maxGlyphs=0,this.availableGlyphs=0,this.totLeftGlyphCnt=0,this.leftCellCnt=0,this.dataColumnsInfo.cnt=0,this.dataColumnsInfo.width=0},_addCollapseExpandHeader:function(a){var b=new e(this.opts.collapseExpandIconGlyphCnt);a.push(b),this.availableGlyphs-=this.opts.collapseExpandIconGlyphCnt,this.totLeftGlyphCnt+=this.opts.collapseExpandIconGlyphCnt},_addCollapseExpandHeaders:function(a){for(var b=0;b<this.leftDimCnt-1&&this.leftDimCnt>1&&this.leftDimCnt<=this.sortOrderCnt;++b)this._addCollapseExpandHeader(a)},_addLeftTreeMetaGhostHeader:function(a,b){var c=new e(b);a.push(c),this.availableGlyphs-=b,this.totLeftGlyphCnt+=b},_addEmptyLeftTreeMetaGhostHeader:function(a,b){var c=new e(b||this.opts.leftTree.emptyGlyphCnt);a.push(c),this.availableGlyphs-=c.calcApprMaxGlyphCnt},_getDataGhostHeaders:function(){var a,b,c=[];for(a=0;this.availableGlyphs>0&&this.totDataColCnt>0&&a<this.totDataColCnt;++a){if(b=this.longestMeasureGlyphCnt,b+=this.opts.columnPaddingGlyphCnt,b/this.longestTopDimGlyphCnt<this.opts.topTree.wideWidthFactor&&(b+=b*this.opts.topTree.growFactor),this.availableGlyphs-b<0){this.availableGlyphs=0;break}this.availableGlyphs-=b;var d=new e(b);c.push(d)}return c},_getLeftGhostHeaders:function(a,b){var c=[],d=this.longestLeftDimGlyphCnt,e=this.longestLeftDimTitleGlyphCnt;return d=Math.max(d,e),d>0?this.isIndentMode?this._getLeftGhostHeadersIndent(c,d):this._getLeftGhostHeadersNonIndent(c,b):this._addEmptyLeftTreeMetaGhostHeader(c,a),c},_getLeftGhostHeadersIndent:function(a,b){var c=this.opts.collapseExpandIconGlyphCnt*(this.leftDimCnt-1);this.pseudoInLeftTree&&(b+=this.longestMeasureTitleGlyphCnt),b+c>this.availableGlyphs&&(b=Math.max(this.availableGlyphs-c,Math.min(b+c,this.opts.metaHeaderMaxGlyphCnt,Math.floor(this.opts.leftTree.widthFactor*this.maxGlyphs)))),this._addCollapseExpandHeaders(a),this._addLeftTreeMetaGhostHeader(a,b)},_getLeftGhostHeadersNonIndent:function(a,b){this._getLeftDimsWidths(b).forEach(function(b){this._addCollapseExpandHeader(a),this._addLeftTreeMetaGhostHeader(a,b)},this)},_getLeftDimsWidths:function(a){for(var b,c,d,e=[],f=0,g=0,h=this.opts.collapseExpandIconGlyphCnt*a,i=0;a>i;++i)b=this._getDimGlyphCnt(i)+this.opts.cellPaddingGlyphCnt,f+=b,e.push({target:b,adjusted:b});if(f+h>this.availableGlyphs)for(f=0,i=0;a>i;++i)b=Math.min(this.opts.metaHeaderMaxGlyphCnt,e[i].target>8?e[i].target/2:e[i].target),e[i].adjusted=b,f+=b;if(f+h>this.availableGlyphs&&f+h>this.maxGlyphs)for(g=(f+h-this.maxGlyphs)/f,i=0;a>i;++i)b=e[i].adjusted,e[i].adjusted=Math.floor(b-b*g);else if(f+h<this.availableGlyphs)for(d=this.availableGlyphs-f-h,c=e.reduce(function(a,b){return a+(b.adjusted<b.target?b.target:0)},0),i=0;a>i;++i)b=e[i],b.adjusted<b.target&&(e[i].adjusted+=Math.floor(b.target/c*d));return e.map(function(a){return a.adjusted})},_calculateGhostMetaHeadersWidth:function(a){var b,c=1;this.headers.forEach(function(b){b.widthFactor=b.calcApprMaxGlyphCnt*this.opts.glyphWidth/a,b.style.width=100*b.widthFactor+"%",c-=b.widthFactor},this),b=this.headers.slice(this.leftCellCnt),c>0&&b.forEach(function(a){a.widthFactor+=c/this.dataColumnsInfo.cnt,a.style.width=100*a.widthFactor+"%"},this),b.length&&(this.dataColumnsInfo.width=b[0].widthFactor*a)},update:function(a,b){var c,d,e,f;for(this._reset(),this.maxGlyphs=Math.floor(this.viewportRect.width/this.opts.glyphWidth),this.availableGlyphs=this.maxGlyphs,this.availableGlyphs>0&&(d=this._getDataGhostHeaders()),c=this._getLeftGhostHeaders(a,b),f=d.reduce(function(a,b){return a+b.calcApprMaxGlyphCnt},0),e=c.reduce(function(a,b){return a+b.calcApprMaxGlyphCnt},0);d.length>0&&f+e>this.maxGlyphs;){var g=d.pop();f-=g.calcApprMaxGlyphCnt}this.headers=c.concat(d),this.dataColumnsInfo.cnt=d.length,this.leftCellCnt=c.length,this._calculateGhostMetaHeadersWidth(this.viewportRect.width)},_getDimGlyphCnt:function(a){var b=this.pseudoDimIndex;if(b===a)return this.longestMeasureTitleGlyphCnt;var c=a>b?a-1:a;return this.layout.qHyperCube.qDimensionInfo[c].qApprMaxGlyphCount},getDimInfo:function(a){return a===this.pseudoDimIndex?void 0:this.layout.qHyperCube.qDimensionInfo[this.sortOrder[a]]}},Object.defineProperties(f.prototype,{isIndentMode:{get:function(){return this.layout.qHyperCube.qIndentMode}},pseudoDimIndex:{get:function(){var a=this.sortOrder.indexOf(-1);return~a?a:this.sortOrderCnt}},longestMeasureGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(a){return Math.max(a.qApprMaxGlyphCount,2)}).sort(function(a,b){return b-a})[0]||0}},longestMeasureTitleGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(a){return a.qFallbackTitle.length}).sort(function(a,b){return b-a})[0]||0}},longestLeftDimTitleGlyphCnt:{get:function(){return h.call(this)}},longestLeftDimGlyphCnt:{get:function(){return g.call(this)}},longestTopDimGlyphCnt:{get:function(){return g.call(this,!0)}},sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}},totDataColCnt:{get:function(){return this.layout.qHyperCube.qSize.qcx}},pseudoInLeftTree:{get:function(){return this.pseudoDimIndex<this.leftDimCnt}}}),a.provider("qvPivotTableMetaGhostHeadersProvider",function(){this.$get=[function(){return function(a,b,c){return new f(a,b,c)}}]})}),define("extensions.qliktech/pivot-table/meta/pivoting",["general.sortable/sortable-item-lists","translator"],function(a,b){"use strict";var c;return c=a.extend("SortableMetaLists",{init:function(a,b,c,d,e,f,g){this._super.apply(this,[a]),this.layout=e,this.backendApi=b,this.grid=c,this.metaGhostHeaders=d,this.$id=f,this.currentPopover=g,this.rows=this.createList(),this.rows.templateSrc="pt-meta-list.ng.html",this.columns=this.createList(),this.columns.templateSrc="pt-meta-list.ng.html"},reset:function(){this._super.apply(this,arguments)},update:function(a,c,d,e){var f,g,h,i,j;for(this.reset(),f=0;f<this.sortOrderCnt;++f){if(g=this.sortOrder[f],f<this.leftDimCnt)h=this.rows;else{if(0>=d)continue;h=this.columns}-1!==g?(j=this.layout.qHyperCube.qDimensionInfo[g].qGroupFieldDefs[this.layout.qHyperCube.qDimensionInfo[g].qGroupPos],i=h.createItem({title:this.layout.qHyperCube.qDimensionInfo[g].qFallbackTitle,id:this.layout.qHyperCube.qDimensionInfo[g].cId,fieldName:j,style:{},qvaOutsideIgnoreFor:"qv-pt-meta-header-"+this.$id,open:this.currentPopover.header&&j===this.currentPopover.header.fieldName,dimIx:g})):i=h.createItem({title:b.get("Common.Measures"),dimIx:-1,isPseudoDim:!0,style:{}}),i.templateSrc="pt-meta-item.ng.html",f<this.leftDimCnt&&i.title.length+this.metaGhostHeaders.metaHeaderPadding>a&&(i.style.maxWidth=a*c-this.metaGhostHeaders.metaHeaderPadding,i.style.minWidth=0),f>=this.leftDimCnt&&1===d&&i.title.length>Math.floor(e/c)&&(i.style.maxWidth=Math.floor(e)-this.metaGhostHeaders.metaHeaderPadding,i.style.minWidth=0),h.addItem(i)}}}),Object.defineProperties(c.prototype,{sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}}}),c}),define("extensions.qliktech/pivot-table/meta/pivoting-provider",["qvangular","./pivoting"],function(a,b){"use strict";function c(){this.$get=[function(){return function(a,c,d,e,f,g,h,i){return new(b.extend("PivotTableSortableMetaLists",{addPlaceholder:function(a,b){var c=this._super.apply(this,arguments);c.style.width=b.width,c.templateSrc="pt-meta-item.ng.html",a.dragging=!0},allowAutoScroll:function(){return!1},onBegin:function(){this._super.apply(this,arguments),h.off(),i.off(),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!0)},enable:function(){this._super.apply(this,arguments),h.on(),i.on(),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!1)},onMove:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onMoveToList:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onEnterList:function(a){a===this.rows&&a.isEmpty()&&this.metaGhostHeaders.update(2*this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt),this._super.apply(this,arguments),a===this.columns&&this.rows.isEmpty()&&this.metaGhostHeaders.update(this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt)},patchPivotingProperties:function(){var a,b=[];this.rows.items.forEach(function(a){b.push(a.dimIx)}),a=b.length,this.columns.items.forEach(function(a){b.push(a.dimIx)});var c=[[],!0];c[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(b)},c[0][1]={qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(a)},this.backendApi.applyPatches(c)},toggleCellsWhenSorting:function(){var a,b;for(a=arguments.length-1;a>=0;--a)if(Array.isArray(arguments[a])){var c,d,e,f,g=arguments[a];for(c=0;c<g.length;++c)for(e=g[c].cells.length,d=0;e>d;++d)f=g[c].cells[d],f.isMeta?f[b?"addClass":"removeClass"]("drop"):f[b?"addClass":"removeClass"]("locked")}else b=arguments[a]}}))({listSelector:".meta",listKey:function(a){return a.find(".list").scope().list},itemSelector:".button-wrapper",itemDragSelector:".button-wrapper",itemKey:"header"},a,c,d,e,f,g)}}]}a.provider("qvPivotTablePivoting",c)}),define("extensions.qliktech/pivot-table/snapshot/snapshot-helper",[],function(){function a(a,b){var c=a[0].getBoundingClientRect();return b&&!b.freeResize?{height:b.size.h,width:b.size.w,top:c.top,left:c.left}:c}return{getSnapshotScrollAreaBBox:a}}),define("extensions.qliktech/pivot-table/viewport-provider",["qvangular","extensions.qliktech/pivot-table/snapshot/snapshot-helper"],function(a,b){"use strict";function c(a,c,d,e,f,g,h,i,j){var k,l,m=c.find(e),n=m.find(f),o=n.find(g);return k={minRowHeight:d,rect:{left:0,top:0,width:0,height:0},scrollRect:{left:0,top:0,width:0,height:0},rowCount:0,getVirtualScrollController:function(){return m.controller("qvScrollArea")},getSortableListController:function(){return m.controller("qvSortableList")},getMultiSelectController:function(){return o.controller("qvSelectionsMultiselect")},getFirstDataCell:function(){var a=m.find(h);return a.length?a.position():{top:0,left:0}},getTopHeaders:function(){return m.find(i)},getScrollAreaBBox:function(){return j?b.getSnapshotScrollAreaBBox(m,j.object):m[0].getBoundingClientRect()},getScrollAreaPosition:function(){return m.position()},getScrollContentBBox:function(){return n[0].getBoundingClientRect()},updateRowCount:function(a){k.rowCount=Math.ceil(a)},getVisibleRowCount:function(){function a(a,b){var c=a.offsetTop+a.getBoundingClientRect().height,d=b.top+b.height;return d>=c}function b(a,b){var c=b-a;return 1===c?b:Math.floor(a+c/2)}function d(c,e,f){var g=f-e,h=b(e,f),i=a(c[h],k.scrollRect);return 0===g?i?h:-1:1===g?i?h:d(c,e,e):i?d(c,h,f):d(c,e,h)}var e,f,g=c[0].querySelector(h);if(!g)return 0;if(e=g.parentNode,f=Array.prototype.slice.call(e.parentNode.childNodes),f=f.filter(function(a){return a.nodeType===Node.ELEMENT_NODE}),f=f.splice(f.indexOf(e)),0===f.length)return 0;var i=d(f,0,f.length-1)+1;if(i===f.length){var j=f[f.length-1],l=k.scrollRect.top+k.scrollRect.height-(j.offsetTop+j.getBoundingClientRect().height);i+=Math.floor(l/(3*k.minRowHeight))}return i},updateRect:function(){return a.cancel(l),l=a(function(){var a=k.getScrollAreaBBox();k.rect.top=a.top,k.rect.left=a.left,k.rect.width=a.width,k.rect.height=a.height,k.updateRowCount(k.rect.height/d)},!1)},updateScrollRect:function(b){return a.cancel(l),l=a(function(){var a=k.getScrollAreaPosition(),c=k.getFirstDataCell();k.scrollRect.top=a.top+c.top,k.scrollRect.left=c.left,k.scrollRect.width=k.rect.width-c.left,k.scrollRect.height=k.rect.height-c.top,b&&(k.updateRowCount(k.collapsedRowCount||k.scrollRect.height/d),delete k.collapsedRowCount)},!1)},getScrollRect:function(){return{top:k.scrollRect.top,left:k.scrollRect.left,width:k.scrollRect.width,height:k.scrollRect.height}}}}function d(a){return c.bind(null,a)}function e(){this.$get=["$timeout",d]}a.provider("qvPivotTableViewportProvider",e)}),define("extensions.qliktech/pivot-table/virtual-scroll-provider",["qvangular"],function(a){"use strict";function b(a,b,c){function d(b){var d=Math.ceil(a.scrollRect.height/a.minRowHeight);j.activeFromStart||(b.qTop+d<=c.qcy?(j.active=!1,b.qHeight=d):b.qHeight=c.qcy-b.qTop,j.active||b.qHeight===a.rowCount||(a.updateRowCount(b.qHeight),i.setVirtualViewport({width:a.scrollRect.width,height:a.rowCount})))}function e(c){return{qLeft:b.cnt>0?Math.round(c.vPosX/b.width):0,qTop:Math.round(c.vPosY),qWidth:Math.max(1,b.cnt),qHeight:Math.max(1,a.rowCount)}}function f(a){a.qTop>0&&a.qTop+a.qHeight>c.qcy&&(a.qTop=Math.max(0,c.qcy-a.qHeight),a.qHeight=Math.min(c.qcy,a.qHeight)),a.qLeft>0&&a.qLeft+a.qWidth>c.qcx&&(a.qLeft=Math.max(0,c.qcx-a.qWidth),a.qWidth=Math.min(c.qcx,a.qWidth))}var g,h,i=a.getVirtualScrollController(),j={active:!1,activeFromStart:!1,lastTop:0},k={xAxis:!1,yAxis:!1};return h={page:{qLeft:0,qTop:0,qWidth:0,qHeight:0},equalsPage:function(a){return this.page.qLeft===a.qLeft&&this.page.qTop===a.qTop&&this.page.qWidth===a.qWidth&&this.page.qHeight===a.qHeight},setPage:function(a){k.yAxis=this.page.qTop!==a.qTop,k.xAxis=this.page.qLeft!==a.qLeft,this.page.qLeft=a.qLeft,this.page.qTop=a.qTop,this.page.qWidth=a.qWidth,this.page.qHeight=a.qHeight},onGetData:function(a){g=a},setScrollViewport:function(){a.updateScrollRect(!1).then(function(){i.setViewport(a.getScrollRect())})},setVirtualSize:function(){var d=this;a.updateScrollRect(!0).then(function(){var e,f,g,k,l;j.active=!1,j.activeFromStart=!1,j.lastTop=0,a.scrollRect.top+a.scrollRect.height>=a.rect.height&&h.page.qHeight>=c.qcy&&(e=a.getVisibleRowCount(),e<h.page.qHeight&&(j.active=!0,j.activeFromStart=!0,a.updateRowCount(e))),f={vPosY:d.page.qTop,vPosX:d.page.qLeft*b.width},k=h.page.qWidth===c.qcx?a.scrollRect.width:c.qcx*b.width,g={width:k,height:c.qcy},l={width:a.scrollRect.width,height:a.rowCount},i.setVirtualSize(g,l,a.getScrollRect()),(f.vPosY>0||f.vPosX>0)&&i.scroll(f.vPosX,f.vPosY)})},alignToBottom:function(){if(j.active&&k.yAxis){var b=a.getVisibleRowCount();b!==a.rowCount&&(a.updateRowCount(b),i.setVirtualViewport({width:a.scrollRect.width,height:a.rowCount}))}}},i.onScroll(function(){var a=i.getVirtualPosition(),b=i.getMaxPosition(),c=e(a);j.active&&c.qTop<j.lastTop&&(d(c),b=i.getMaxPosition()),b.vPosY>0&&a.vPosY===b.vPosY&&(j.active=!0),f(c),j.lastTop=c.qTop,(!h.equalsPage(c)||j.active)&&(h.setPage(c),g(h.page))}),i.getScrollAmount=function(c,d,e){var f=i.getVirtualPosition(),g=i.getMaxPosition();switch(e){case 1:return{deltaX:b.width*c,deltaY:d};case 2:return{deltaX:b.cnt*b.width*c,deltaY:a.rowCount*d};case 10:return{deltaX:0,deltaY:d>0?f.vPosY*d:f.vPosY-g.vPosY};default:return{deltaX:c,deltaY:Math.floor(d/a.minRowHeight)}}},h}function c(){return b}function d(){this.$get=[c]}a.provider("qvPivotTableVirtualScrollProvider",d)}),define("extensions.qliktech/pivot-table/selections-provider",["qvangular","jquery","objects.utils/event-utils"],function(a,b,c){"use strict";function d(a,d,e,f,g,h,i,j){function k(b,c){var e,f,g,h,i,j,k,l=[],m=q.dataValuesArray.length;for(e=b.getRowsByCellType(b.CELL_TYPE_TOP).concat(b.getRowsByCellType(b.CELL_TYPE_LEFT)),i=m>0?d.getSiblingCells(b,c):[],f=e.length,k=0;f>k;++k)l=l.concat(e[k].cells);for(h=l.length,k=0;h>k;++k)g=l[k],j=-1!==i.indexOf(g),(j&&!g.isDimensionValue||!j&&!g.isMeta)&&a[m?"lockCell":"unlockCell"](b,g)}function l(){q.active&&(a.updatePivot(h,q,q.currentCell),k(h,q.currentCell))}function m(){j.on(),p&&p()}function n(){j.on(),p&&p()}function o(){q.active&&q.currentCell&&(d.getSiblingCells(h,q.currentCell).forEach(function(b){a.deselectCell(h,b)}),k(h,q.currentCell))}var p,q=a.$new();return e.excludeDimensionToggle=function(a){return!f.active&&b(a.target).is(".qv-pt-expandable")},e.selectDimensionValue=function(b,c){var d=f.getKeyAsToggleSelected(c);d||(o(),a.reset(q)),p=a.selectDimensionValue(e.$id,g,f,q,b,h,d),k(h,q.currentCell)},e.activateSelections=function(b){p=a.activateSelections(e.$id,g,f,q,b)},e.multiselectDimensionValues=function(b,c){var i,j,l,m,n=d.getSiblingCells(h,b),o=n.length,p=a.isColumnar(h,b),r=p?b.dataRowIx:b.dataColIx,s=p?c.dataRowIx:c.dataColIx;if(-1!==n.indexOf(c)&&c.isDimensionValue){for(i=0;o>i;++i)l=n[i],j=p?l.dataRowIx:l.dataColIx,m=s>=r?j>=r&&s>=j:j>=s&&r>=j,m&&l.isDimensionValue&&l!==c&&a.selectDimensionCells(g,f,q,e.grid,l,!1);a.selectDimensionCells(g,f,q,e.grid,c,!1),k(h,q.currentCell)}},e.multiselect=function(){q.active&&a.sendSelection(g,f,q,h,q.currentCell)},e.selectWhileLocked=function(){q.dataValuesArray.length>0||c.showLockedFeedback(i.qHyperCube.qDimensionInfo)},f.watchActivated(function(){j.off()}),a.init(f,g,q,m,n,o),{updateSelections:l}}function e(a,b){return d.bind(null,a,b)}function f(){this.$get=["qvGridObjectSelectionService","qvGridObjectDataService",e]}a.provider("qvPivotTableSelectionsProvider",f)}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel.ng.html",[],function(){return'<div class="qv-pivot-panel"\r\n	 qv-sortable-list="sortableItemLists">\r\n	<div class="qv-pivot-panel-row" ng-repeat="row in grid.rows">\r\n		<div class="qv-pivot-panel-column" ng-if="$first"></div>\r\n		<div ng-repeat="list in row.lists" class="qv-pivot-panel-column" ng-class="{\'qv-pivot-panel-disabled\': list.disabled}">\r\n			<h2>{{list.title}}</h2>\r\n			<div class="qv-pivot-panel-list">\r\n				<ul>\r\n					<li ng-repeat="item in list.items track by item.id" class="qv-pivot-panel-item" ng-class="item.classList" ng-include src="itemTemplateSrc"></li>\r\n				</ul>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n'}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel-item.ng.html",[],function(){return'<div class="field-wrapper field-token" ng-style="item.style">\r\n	<div ng-if="list.showMoveHandle" class="icon-handle"></div>\r\n	<div class="field-text">{{item.title}}</div>\r\n</div>\r\n'}),define("extensions.qliktech/pivot-table/pivot-panel/pivot-panel",["jquery","qvangular","text!./pivot-panel.ng.html","text!./pivot-panel-item.ng.html","ng!$templateCache","general.sortable/sortable-item-lists","translator","general.sortable/sortable-list"],function(a,b,c,d,e,f,g){
var h={Dimension:"dimension",Measure:"measure",Pseudo:"pseudo"};e.put("pivot-panel-item.ng.html",d),b.directive("qvPivotPanel2",function(){return{restrict:"E",template:c,replace:!0,scope:{layout:"=layout",backendApi:"=backendApi"},controller:["$scope","$element",function(b,c){function d(a){var b;return b=a.qLibraryId?a.title||"":a.qFallbackTitle||""}function e(){var a,c=b.layout.qHyperCube.qNoOfLeftDims;b.sortableItemLists.reset(),a=b.layout.qHyperCube.qEffectiveInterColumnSortOrder.map(function(a){var c;return b.$broadcast("pivotPanelUpdated"),-1===a?{title:"Measures",cId:"pseudo-dimension",type:h.Pseudo,dimIndex:a,cssClass:["sortable","is-pseudo"]}:(c=b.layout.qHyperCube.qDimensionInfo[a],{title:d(c),cId:c.cId,type:h.Dimension,dimIndex:a,cssClass:["sortable"]})}),c=0>c?a.length:c,a.splice(0,c).forEach(function(a){var c=b.rows.add(a.title,a.cId,a.cssClass,1);c.dimIndex=a.dimIndex}),a.forEach(function(a){var c=b.columns.add(a.title,a.cId,a.cssClass,1);c.dimIndex=a.dimIndex}),b.layout.qHyperCube.qMeasureInfo.forEach(function(a){b.measures.add(a.qFallbackTitle||"",a.cId,[],2)})}var i=this;b.itemTemplateSrc="pivot-panel-item.ng.html",b.sortableItemLists=f.create({options:{listKey:"list",listSelector:".qv-pivot-panel-column",itemSelector:".sortable",itemDragSelector:".icon-handle",itemKey:"item"},addPlaceholder:function(){var a=this._super.apply(this,arguments);a.addClass("sortable")},bindAutoScroll:function(){var b=c.find(".qv-pivot-panel-list ul");b.each(function(){var b=a(this),c=b.scope().list;c.scrollInfo={elem:b[0],clientRect:b[0].getBoundingClientRect(),scrollWidth:b[0].scrollWidth,scrollHeight:b[0].scrollHeight}})},onBegin:function(){this._super.apply(this,arguments),this.bindAutoScroll()},onEnterList:function(){this.bindAutoScroll()},onMove:function(){this._super.apply(this,arguments),i.sortOrderUpdated()},onMoveToList:function(a,b){this._super.apply(this,arguments),b.disabled||i.sortOrderUpdated()},onAutoScroll:function(a,b,c,d){if(this._super.apply(this,arguments),!b&&c&&(b=this.getList(c)),b){var e=b.scrollInfo;d(e.elem,e.clientRect,e.scrollWidth,e.scrollHeight)}}}),b.columns=b.sortableItemLists.createList(1,{title:g.get("Common.Columns"),showMoveHandle:!0}),b.rows=b.sortableItemLists.createList(1,{title:g.get("Common.Rows"),showMoveHandle:!0}),b.measures=b.sortableItemLists.createList(2,{title:g.get("Common.Measures")}),b.grid={rows:[]},b.grid.rows.push({lists:[b.columns]}),b.grid.rows.push({lists:[b.rows,b.measures]}),i.sortOrderUpdated=function(){var a,c=[];b.rows.items.forEach(function(a){c.push(a.dimIndex)}),a=c.length,b.columns.items.forEach(function(a){c.push(a.dimIndex)});var d=[[],!0];d[0][0]={qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(c)},d[0][1]={qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(a)},b.backendApi.applyPatches(d)},b.$watchCollection("layout.qHyperCube.qDimensionInfo",e),b.$watchCollection("layout.qHyperCube.qEffectiveInterColumnSortOrder",e),b.$watchCollection("layout.qHyperCube.qMeasureInfo",e),b.$watchCollection("layout.qHyperCube.qNoOfLeftDims",e)}]}})}),define("extensions.qliktech/pivot-table/pivot-table",["qvangular","jquery","objects.backend-api/pivot-api","extensions.qliktech/pivot-table/pivot-table-properties","extensions.qliktech/pivot-table/pivot-hypercube-handler","objects.extension/object-conversion","general.utils/property-mapper","text!./pivot-table.ng.html","text!./cell-item.ng.html","text!./header-cell-item.ng.html","text!./meta/meta-left.ng.html","text!./meta/meta-top.ng.html","text!./meta/meta-list.ng.html","text!./meta/meta-item.ng.html","ng!$templateCache","general.utils/support","core.utils/deferred","objects.grid/data-grid-provider","./meta/ghost-headers-provider","./meta/pivoting-provider","./viewport-provider","./virtual-scroll-provider","./selections-provider","general.scroll/scroll-area","objects.grid/services/data-service","objects.grid/services/selections","extensions.qliktech/pivot-table/pivot-panel/pivot-panel"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";function r(a,c,d,e,f,g,i,j,k){function l(h,l,m,n){var o,r,s,t;h.currentPopover={header:void 0},h.nonMouseViewportScrolling={scrollbarSize:36,className:"show-non-mouse-scrollbars"},h.grid=a("pivot"),h.viewport=g(l,p.treatAsDesktop()?21:31,".qv-grid-object-scroll-area",".scroll-content","table",".first-data-cell","th.top:nth-child(2)",h.layout.snapshotData),o=h.viewport.getVirtualScrollController(),r=h.viewport.getSortableListController(),s=h.viewport.getMultiSelectController(),h.metaGhostHeaders=f({},h.layout,h.viewport.rect),h.pivoting=e(h.backendApi,h.grid,h.metaGhostHeaders,h.layout,h.$id,h.currentPopover,o,s),h.selections=j(h,h.selectionsApi,h.backendApi,h.grid,h.layout,r),h.virtualScroll=i(h.viewport,h.metaGhostHeaders.dataColumnsInfo,h.layout.qHyperCube.qSize),h.virtualScroll.onGetData(function(a){h.getData(a,!0).then(function(){k.cancel(t),t=k(function(){h.virtualScroll.setScrollViewport(),h.virtualScroll.alignToBottom()},100)})}),h.getData=function(a,b){var c=q();return h.backendApi.getData([a]).then(function(d){h.onUpdateData(d,a,b).then(function(){c.resolve()})}),c.promise},h.onUpdateData=function(a,b,d){return c.updatePivotItems(h,a,[b],d),h.selections.updateSelections(),k(function(){},0,!1)},h.process=function(a){return h.virtualScroll.setPage(a),h.getData(a).then(function(){h.virtualScroll.setVirtualSize()})},h.processPaint=function(){return h.updateMetaInfo().then(function(a){var b=h.layout.qHyperCube.qLastExpandedPos,c=b&&void 0!==h.expandedPosDiffX&&void 0!==h.expandedPosDiffY,d={qLeft:Math.max(0,c?b.qx-h.expandedPosDiffX:0),qTop:Math.max(0,c?b.qy-h.expandedPosDiffY:0),qWidth:a.qWidth,qHeight:a.qHeight};if(b&&d.qLeft+d.qWidth>h.layout.qHyperCube.qSize.qcx&&(d.qLeft=Math.max(0,h.layout.qHyperCube.qSize.qcx-a.qWidth)),b&&h.collapsed&&d.qTop+d.qHeight>h.layout.qHyperCube.qSize.qcy){var e=h.viewport.getVisibleRowCount();h.viewport.collapsedRowCount=e,d.qTop=Math.max(0,h.layout.qHyperCube.qSize.qcy-e),d.qHeight=e}return delete h.expandedPosDiffX,delete h.expandedPosDiffY,delete h.collapsed,h.process(d)})},h.processResize=function(){return h.updateMetaInfo().then(function(a){var b=h.layout.qHyperCube.qSize,c={qLeft:h.virtualScroll.page.qLeft,qTop:h.virtualScroll.page.qTop,qWidth:a.qWidth,qHeight:a.qHeight};return c.qTop+c.qHeight>b.qcy&&(c.qTop=Math.max(0,b.qcy-c.qHeight)),c.qLeft+c.qWidth>b.qcx&&(c.qLeft=Math.max(0,b.qcx-c.qWidth)),h.process(c)})},h.updateMetaInfo=function(){return h.viewport.updateRect().then(function(){return h.metaGhostHeaders.update(0,c.getLeftTreeDepth(h.layout.qHyperCube.qPivotDataPages[0])),h.pivoting.update(h.metaGhostHeaders.totLeftGlyphCnt,h.metaGhostHeaders.opts.glyphWidth,h.metaGhostHeaders.dataColumnsInfo.cnt,h.metaGhostHeaders.dataColumnsInfo.width),{qWidth:Math.max(1,h.metaGhostHeaders.dataColumnsInfo.cnt),qHeight:Math.max(1,h.viewport.rowCount)}})},h.collapseExpand=function(a){var c,d=b(a.target);c=d.scope().cell,c&&(h.expandedPosDiffX=c.dataColIx-h.virtualScroll.page.qLeft,h.expandedPosDiffY=c.dataRowIx-h.virtualScroll.page.qTop,"icon-add"===c.collapseExpandClass?c.hasClass("top")?h.backendApi.expandTop(c.dataRowIx,c.dataColIx,!1):c.hasClass("left")&&h.backendApi.expandLeft(c.dataRowIx,c.dataColIx,!1):"icon-remove"===c.collapseExpandClass&&(h.collapsed=!0,c.hasClass("top")?h.backendApi.collapseTop(c.dataRowIx,c.dataColIx,!1):c.hasClass("left")&&h.backendApi.collapseLeft(c.dataRowIx,c.dataColIx,!1)))},h.showDimension=function(a,c){var e=b(a.target).closest(".qv-pt-meta-button");return r.off(),h.currentPopover.header===c?(c.open=!1,h.currentPopover.header=void 0,void d.close()):(h.currentPopover.header&&(h.currentPopover.header.open=!1,h.currentPopover.header=void 0),d.showField(c.fieldName,h.backendApi.model.session.currentApp,{$alignToElement:e,qvaOutsideIgnoreFor:"qv-pt-meta-header-"+h.$id,collision:"flipfit"},null,function(){h.currentPopover.header=void 0,h.updateMetaInfo(),r.on()}),c.open=!0,void(h.currentPopover.header=c))};var u=function(a){a?(o.on(),r.on(),h.interactive=!0):(o.off(),r.off(),h.interactive=!1)};n.addChildController({setInteraction:function(a){u(a)},onStateChanged:function(a){u(this.allowInteraction(a))},onPaint:function(){return this.$scope.selectionsApi.active?q.resolve():(r.cancel(),h.processPaint())},onResize:function(){return h.processResize()},setSnapshotData:function(a){var b=h.virtualScroll.page;return h.backendApi.getData([b]).then(function(c){return h.backendApi.isSnapshot||(c[0].qArea.qTop=0,c[0].qArea.qLeft=0,a.qHyperCube.qSize.qcx=b.qWidth,a.qHyperCube.qSize.qcy=b.qHeight),a.qHyperCube.qPivotDataPages=c,a})}},h)}return{restrict:"E",replace:!0,template:h,require:"^qvObject",link:l}}return o.put("pt-cell-item.ng.html",i),o.put("pt-header-cell-item.ng.html",j),o.put("pt-meta-left.ng.html",k),o.put("pt-meta-top.ng.html",l),o.put("pt-meta-list.ng.html",m),o.put("pt-meta-item.ng.html",n),a.directive("qvPivotTableInclude",["$compile","$animate",function(a,b){return{link:function(c,d,e){b.enabled(!1,d),c.$watch(e.qvPivotTableInclude,function(){var b=c.$eval(e.qvPivotTableInclude),f=o.get(b);d.html(f),a(d.contents())(c)})}}}]),a.directive("qvPivotTable",["qvDataGrid","qvGridObjectDataService","qvListboxPopoverService","qvPivotTablePivoting","qvPivotTableMetaGhostHeadersProvider","qvPivotTableViewportProvider","qvPivotTableVirtualScrollProvider","qvPivotTableSelectionsProvider","$timeout",r]),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"P",qShowTotalsAbove:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:50,qHeight:50}],qIndentMode:!0}},data:{dimensions:{min:1,max:1e3},measures:{min:1,max:1e3}},getCreatePropertyHandler:function(){var a=g.mapProperties(this.mappedDefinition.items.data.items.dimensions),b=g.mapProperties(this.mappedDefinition.items.data.items.measures);return new e(this.dimensionDefinition,this.measureDefinition,a,b)},snapshot:{canTakeSnapshot:!0},type:"pivot-table",template:"<qv-pivot-table></qv-pivot-table>",BackendApi:c,definition:d,importProperties:f.pivotChart.importProperties.bind(f),exportProperties:f.pivotChart.exportProperties.bind(f)}}),define("workbench/mashupapi/qdata",["jquery"],function(a){function b(a,b,c){Object.defineProperties(this,{qFallbackTitle:{value:a.qFallbackTitle},qSortIndicator:{value:a.qSortIndicator},qReverseSort:{value:a.qReverseSort||!1},col:{value:b},isOrderedBy:{value:b===c.qHyperCube.qEffectiveInterColumnSortOrder[0]},isDimension:{value:b<c.qHyperCube.qDimensionInfo.length},parent:{value:c}}),a.qCardinal>0&&Object.defineProperties(this,{qCardinal:{value:a.qCardinal},qStateCounts:{value:a.qStateCounts}}),a.qMax&&Object.defineProperties(this,{qMax:{value:a.qMax},qMin:{value:a.qMin}}),a.qGroupFieldDefs&&a.qGroupFieldDefs.length>0&&Object.defineProperties(this,{field:{value:c.app.field(a.qGroupFieldDefs[a.qGroupPos])}})}function c(a,b,c,d){Object.defineProperties(this,{qDimensionInfo:{value:b},qText:{value:a.qIsOtherCell?b.othersLabel:a.qText},qElemNumber:{value:a.qElemNumber},qState:{value:a.qState},col:{value:c},parent:{value:d}}),isNaN(a.qNum)||Object.defineProperties(this,{qNum:{value:a.qNum}})}function d(a,b,c){Object.defineProperties(this,{qMeasureInfo:{value:b},qGrandTotal:{value:c},qText:{value:a.qText}}),isNaN(a.qNum)||Object.defineProperties(this,{qNum:{value:a.qNum}})}function e(a,b,e){var f=[],g=[],h=b.qDimensionInfo.length;a.forEach(function(a,i){h>i?f.push(new c(a,b.qDimensionInfo[i],i,e)):g.push(new d(a,b.qMeasureInfo[i-h],b.qGrandTotalRow[i-h]))}),Object.defineProperties(this,{dimensions:{value:f},measures:{value:g},cells:{value:f.concat(g)}})}function f(a,b,c){this.app=b,this.qHyperCube=a.layout.qHyperCube,this.model=a,this.view=c,Object.defineProperties(this,{rows:{value:[]},headers:{value:[]},totals:{value:[]},rowCount:{get:function(){return this.qHyperCube.qSize.qcy}},colCount:{get:function(){return this.qHyperCube.qSize.qcx}}});var d=this;g(d),this.model.Validated.bind(function(){g(d)})}function g(a){if(!a.model.layout.qSelectionInfo.qInSelections){var c=a.qHyperCube.qDimensionInfo.length;a.headers.length=0,a.totals.length=0,a.rows.length=0,a.qHyperCube.qDimensionInfo.forEach(function(c,d){a.headers.push(new b(c,d,a))}),a.qHyperCube.qMeasureInfo.forEach(function(d,e){a.headers.push(new b(d,e+c,a))}),a.qHyperCube.qGrandTotalRow.forEach(function(b,c){a.totals.push(new d(b,a.qHyperCube.qMeasureInfo[c]))}),a.qHyperCube.qDataPages.forEach(function(b){b.qMatrix.forEach(function(b){a.rows.push(new e(b,a.qHyperCube,a))})})}}return b.prototype.orderBy=function(){var a=[this.col];this.parent.qHyperCube.qEffectiveInterColumnSortOrder.forEach(function(b){b!==a[0]&&a.push(b)});var b=[{qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:"["+a.join(",")+"]"}];this.parent.model.applyPatches(b,!0)},b.prototype.reverseOrder=function(){var a=this.col<this.parent.qHyperCube.qDimensionInfo.length,b=[{qPath:"/qHyperCubeDef/"+(a?"qDimensions/"+this.col:"qMeasures/"+(this.col-this.parent.qHyperCube.qDimensionInfo.length))+"/qDef/qReverseSort",qOp:"replace",qValue:(!this.qReverseSort).toString()}];this.parent.model.applyPatches(b,!0)},c.prototype.select=function(b){this.parent.view.selectValues(this.col,[this.qElemNumber],!0),b&&a(b.target).toggleClass("selected")},d.prototype.getPercentOfMax=function(){return Math.round(100*this.qNum/this.qMeasureInfo.qMax*100)/100},d.prototype.getPercent=function(){return Math.round(100*this.qNum/this.qGrandTotal.qNum*100)/100},f.prototype.getMoreData=function(){if(!(this.requestActive||this.rowCount<=this.rows.length)){this.requestActive=!0;var a=this,b={qTop:this.rows.length,qLeft:0,qWidth:this.colCount,qHeight:50};a.view.backendApi.getData([b]).then(function(b){b[0].qMatrix.forEach(function(b){a.rows.push(new e(b,a.qHyperCube,a))}),a.requestActive=!1})}},f.prototype.getColByName=function(a){if(a){var b,c=a.toUpperCase();return this.headers&&this.headers.forEach(function(a,d){a.qFallbackTitle.toUpperCase()===c&&(b=d)}),b}},f}),define("qwidget.model/widget-file",["core.utils/deferred","qvangular","general.services/content-api/content-api"],function(a,b){function c(a,c){return b.getService("$contentApi").request({method:"GET",url:"/extensions/"+a+(c?"?"+(new Date).getTime():""),cache:!1,transformResponse:function(a){return a}})}function d(e,f,g){var h=new a;if(g)return c(e).success(function(a,b,c){c("last-modified")!==g?h.reject():d(e,f).then(function(){h.resolve()})}),h.promise;var i=e.split("/");return b.getService("$contentApi").request({method:"POST",url:"/qrs/extension/"+i[0]+"/uploadfile?externalpath="+i[1]+"&overwrite=true",data:f}).success(function(){h.resolve()}).error(function(a){h.reject(a)}),h.promise}function e(c){var d=new a,e=c.split("/");return b.getService("$contentApi").request({method:"DELETE",url:"/qrs/extension/"+e[0]+"/deletecontent?externalpath="+e[1]}).success(function(){d.resolve()}).error(function(a){d.reject(a)}),d.promise}return{loadFile:c,saveFile:d,deleteFile:e}}),define("qwidget.model/widget-library",["core.utils/deferred","general.models/library/extension-list","./widget-file"],function(a,b,c){var d,e=[],f=function(a,b){Object.defineProperties(this,{libid:{value:a,configurable:!0,writable:!0},data:{value:b,configurable:!0,writable:!0}}),b.type="widget-library"};return f.prototype.save=function(){return c.saveFile(this.libid+"/"+this.libid+".qext",JSON.stringify(this.data))},f.prototype.addTemplate=function(a){this.data.widgets||(this.data.widgets=[]),this.data.widgets.push(a.id),this.save()},f.prototype.removeTemplate=function(a){this.data.widgets&&(this.data.widgets=this.data.widgets.filter(function(b){return b!==a}),this.save())},f.prototype["delete"]=function(){var b=new a,d=this,e=d.id+"/"+d.id;return c.deleteFile(e+".qext").then(function(){b.resolve()},function(){b.reject()}),b.promise},f.getList=function(){return d||(d=new a,b.getList().then(function(a){a.forEach(function(a){"widget-library"===a.data.type&&e.push(new f(a.id,a.data))}),d.resolve(e)})),d.promise},f.get=function(b){var c=new a;return f.getList().then(function(){var a;e.forEach(function(c){c.libid===b&&(a=c)}),a?c.resolve(a):c.reject()}),c.promise},f.isEnabled=function(){var b=new a;return f.getList().then(function(){b.resolve(e.length>0)}),b.promise},f}),define("qwidget.model/widget-template",["core.utils/deferred","./widget-library","./widget-file","core.utils/notification"],function(a,b,c,d){function e(a){var b=document.createElement("div");b.innerHTML=a;for(var c=b.getElementsByTagName("script"),d=c.length;d--;)c[d].parentNode.removeChild(c[d]);return a=b.innerHTML}function f(a){var b;i.forEach(function(c,d){a.id===c.id&&a.libid===c.libid&&(b=d)}),b?i[b]=a:i.push(a),k[a.libid+"/"+a.id]=a}function g(b,d,e){var g=new a;return c.loadFile(b+".json",!0).success(function(a,b,c){var h=JSON.parse(a),i=new l(d,e,h.name||e,h.properties);i.lastmodified=c("last-modified"),f(i),g.resolve(i)}),g.promise}var h,i=[],j=[],k=[],l=function(a,b,c,d){this._version=0,Object.defineProperties(this,{libid:{value:a},id:{value:b},name:{value:c,configurable:!0,writable:!0},html:{get:function(){return this._html},set:function(a){this._html=a,this._version++}},css:{get:function(){return this._css},set:function(a){this._css=a,this._version++}},properties:{value:d,configurable:!0,writable:!0},version:{get:function(){return this._version}},isLoaded:{get:function(){return void 0!==this._html}}})};l.prototype.load=function(){if(!this.loadDfd){this.loadDfd=new a;var b=this,d=this.libid+"/"+this.id;c.loadFile(d+".html").success(function(a){var f=e(a);c.loadFile(d+".css").success(function(a){b.css=a,b.html=f,b.loadDfd.resolve()})})}return this.loadDfd.promise},l.prototype.save=function(){var d=new a,e=this,f=e.libid+"/"+e.id;return c.saveFile(f+".json",JSON.stringify({name:e.name,properties:e.properties}),e.lastmodified).then(function(){c.saveFile(f+".html",e.html),c.saveFile(f+".css",e.css),e.lastmodified||b.get(e.libid).then(function(a){a.addTemplate(e)}),c.loadFile(f+".json").success(function(a,b,c){e.lastmodified=c("last-modified")}),l.Updated.emit(i),d.resolve()},function(){d.reject()}),d.promise},l.prototype.copy=function(a){return l.add({libid:a.libid||this.libid,id:a.id,name:a.name||this.name,html:a.html||this.html,css:a.css||this.css,properties:a.properties||this.properties})},l.prototype["delete"]=function(){var d=new a,e=this,f=e.libid+"/"+e.id;return c.deleteFile(f+".json").then(function(){b.get(e.libid).then(function(a){a.removeTemplate(e.id)}),c.deleteFile(f+".html"),c.deleteFile(f+".css"),delete j[f],i.forEach(function(a,b){a.id===e.id&&a.libid===e.libid&&delete i[b]}),l.Updated.emit(i),d.resolve()},function(){d.reject()}),d.promise};var m=function(b){var c=b.libid,d=new a,e=[];return b.data.widgets&&b.data.widgets.forEach(function(a){e.push(l.get(c,a,!0))}),a.all(e).then(function(){d.resolve()}),d.promise};return l.getTemplateList=function(c){var d=[];return(!h||c)&&(h=new a,b.getList().then(function(b){b.forEach(function(a){d.push(m(a))}),a.all(d).then(function(){h.resolve(i)})})),h.promise},l.getLoaded=function(a){return k[a]},l.get=function(b,c,d){if(!c){var e=b.split("/");b=e[0],c=e[1]}var f=b+"/"+c,h=new a;return j[f]||(j[f]=g(f,b,c)),j[f].then(function(a){a.isLoaded||d?h.resolve(a):a.load().then(function(){h.resolve(a)})}),h.promise},l.add=function(b){if(!b.id||!b.libid)return!1;var c=new l(b.libid,b.id,b.name||"",b.properties);c.html=b.html||"",c.css=b.css,f(c);var d=b.libid+"/"+b.id;if(!j[d]){var e=new a;j[d]=e.promise,e.resolve(c)}return l.Updated.emit(i),c},d.create(l,"Updated"),l}),/*!
 * Less - Leaner CSS v2.4.0
 * http://lesscss.org
 *
 * Copyright (c) 2009-2015, Alexis Sellier <self@cloudhead.net>
 * Licensed under the Apache v2 License.
 *
 */
/** * @license Apache v2
 */
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("assets/external/less/less",[],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.less=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("./utils").addDataAttr,e=a("./browser");b.exports=function(a,b){d(b,e.currentScript(a)),void 0===b.isFileProtocol&&(b.isFileProtocol=/^(file|(chrome|safari)(-extension)?|resource|qrc|app):/.test(a.location.protocol)),b.async=b.async||!1,b.fileAsync=b.fileAsync||!1,b.poll=b.poll||(b.isFileProtocol?1e3:1500),b.env=b.env||("127.0.0.1"==a.location.hostname||"0.0.0.0"==a.location.hostname||"localhost"==a.location.hostname||a.location.port&&a.location.port.length>0||b.isFileProtocol?"development":"production");var c=/!dumpLineNumbers:(comments|mediaquery|all)/.exec(a.location.hash);c&&(b.dumpLineNumbers=c[1]),void 0===b.useFileCache&&(b.useFileCache=!0),void 0===b.onReady&&(b.onReady=!0)}},{"./browser":3,"./utils":9}],2:[function(a,b,c){a("promise/polyfill.js");var d=window.less||{};a("./add-default-options")(window,d);var e=b.exports=a("./index")(window,d);d.onReady&&(/!watch/.test(window.location.hash)&&e.watch(),e.pageLoadFinished=e.registerStylesheets().then(function(){return e.refresh("development"===e.env)}))},{"./add-default-options":1,"./index":7,"promise/polyfill.js":"promise/polyfill.js"}],3:[function(a,b,c){var d=a("./utils");b.exports={createCSS:function(a,b,c){var e=c.href||"",f="less:"+(c.title||d.extractId(e)),g=a.getElementById(f),h=!1,i=a.createElement("style");i.setAttribute("type","text/css"),c.media&&i.setAttribute("media",c.media),i.id=f,i.styleSheet||(i.appendChild(a.createTextNode(b)),h=null!==g&&g.childNodes.length>0&&i.childNodes.length>0&&g.firstChild.nodeValue===i.firstChild.nodeValue);var j=a.getElementsByTagName("head")[0];if(null===g||h===!1){var k=c&&c.nextSibling||null;k?k.parentNode.insertBefore(i,k):j.appendChild(i)}if(g&&h===!1&&g.parentNode.removeChild(g),i.styleSheet)try{i.styleSheet.cssText=b}catch(l){throw new Error("Couldn't reassign styleSheet.cssText.")}},currentScript:function(a){var b=a.document;return b.currentScript||function(){var a=b.getElementsByTagName("script");return a[a.length-1]}()}}},{"./utils":9}],4:[function(a,b,c){b.exports=function(a,b,c){var d=null;if("development"!==b.env)try{d="undefined"==typeof a.localStorage?null:a.localStorage}catch(e){}return{setCSS:function(a,b,e){if(d){c.info("saving "+a+" to cache.");try{d.setItem(a,e),d.setItem(a+":timestamp",b)}catch(f){c.error('failed to save "'+a+'" to local storage for caching.')}}},getCSS:function(a,b){var c=d&&d.getItem(a),e=d&&d.getItem(a+":timestamp");return e&&b.lastModified&&new Date(b.lastModified).valueOf()===new Date(e).valueOf()?c:void 0}}}},{}],5:[function(a,b,c){var d=a("./utils"),e=a("./browser");b.exports=function(a,b,c){function f(b,f){var g,h,i="less-error-message:"+d.extractId(f||""),j='<li><label>{line}</label><pre class="{class}">{content}</pre></li>',k=a.document.createElement("div"),l=[],m=b.filename||f,n=m.match(/([^\/]+(\?.*)?)$/)[1];k.id=i,k.className="less-error-message",h="<h3>"+(b.type||"Syntax")+"Error: "+(b.message||"There is an error in your .less file")+'</h3><p>in <a href="'+m+'">'+n+"</a> ";var o=function(a,b,c){void 0!==a.extract[b]&&l.push(j.replace(/\{line\}/,(parseInt(a.line,10)||0)+(b-1)).replace(/\{class\}/,c).replace(/\{content\}/,a.extract[b]))};b.extract&&(o(b,0,""),o(b,1,"line"),o(b,2,""),h+="on line "+b.line+", column "+(b.column+1)+":</p><ul>"+l.join("")+"</ul>"),b.stack&&(b.extract||c.logLevel>=4)&&(h+="<br/>Stack Trace</br />"+b.stack.split("\n").slice(1).join("<br/>")),k.innerHTML=h,e.createCSS(a.document,[".less-error-message ul, .less-error-message li {","list-style-type: none;","margin-right: 15px;","padding: 4px 0;","margin: 0;","}",".less-error-message label {","font-size: 12px;","margin-right: 15px;","padding: 4px 0;","color: #cc7777;","}",".less-error-message pre {","color: #dd6666;","padding: 4px 0;","margin: 0;","display: inline-block;","}",".less-error-message pre.line {","color: #ff0000;","}",".less-error-message h3 {","font-size: 20px;","font-weight: bold;","padding: 15px 0 5px 0;","margin: 0;","}",".less-error-message a {","color: #10a","}",".less-error-message .error {","color: red;","font-weight: bold;","padding-bottom: 2px;","border-bottom: 1px dashed red;","}"].join("\n"),{title:"error-message"}),k.style.cssText=["font-family: Arial, sans-serif","border: 1px solid #e00","background-color: #eee","border-radius: 5px","-webkit-border-radius: 5px","-moz-border-radius: 5px","color: #e00","padding: 15px","margin-bottom: 15px"].join(";"),"development"===c.env&&(g=setInterval(function(){var b=a.document,c=b.body;c&&(b.getElementById(i)?c.replaceChild(k,b.getElementById(i)):c.insertBefore(k,c.firstChild),clearInterval(g))},10))}function g(a,b){c.errorReporting&&"html"!==c.errorReporting?"console"===c.errorReporting?k(a,b):"function"==typeof c.errorReporting&&c.errorReporting("add",a,b):f(a,b)}function h(b){var c=a.document.getElementById("less-error-message:"+d.extractId(b));c&&c.parentNode.removeChild(c)}function i(a){}function j(a){c.errorReporting&&"html"!==c.errorReporting?"console"===c.errorReporting?i(a):"function"==typeof c.errorReporting&&c.errorReporting("remove",a):h(a)}function k(a,d){var e="{line} {content}",f=a.filename||d,g=[],h=(a.type||"Syntax")+"Error: "+(a.message||"There is an error in your .less file")+" in "+f+" ",i=function(a,b,c){void 0!==a.extract[b]&&g.push(e.replace(/\{line\}/,(parseInt(a.line,10)||0)+(b-1)).replace(/\{class\}/,c).replace(/\{content\}/,a.extract[b]))};a.extract&&(i(a,0,""),i(a,1,"line"),i(a,2,""),h+="on line "+a.line+", column "+(a.column+1)+":\n"+g.join("\n")),a.stack&&(a.extract||c.logLevel>=4)&&(h+="\nStack Trace\n"+a.stack),b.logger.error(h)}return{add:g,remove:j}}},{"./browser":3,"./utils":9}],6:[function(a,b,c){b.exports=function(b,c){function d(){if(window.XMLHttpRequest&&!("file:"===window.location.protocol&&"ActiveXObject"in window))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return c.error("browser doesn't support AJAX."),null}}var e=a("../less/environment/abstract-file-manager.js"),f={},g=function(){};return g.prototype=new e,g.prototype.alwaysMakePathsAbsolute=function(){return!0},g.prototype.join=function(a,b){return a?this.extractUrlParts(b,a).path:b},g.prototype.doXHR=function(a,e,f,g){function h(b,c,d){b.status>=200&&b.status<300?c(b.responseText,b.getResponseHeader("Last-Modified")):"function"==typeof d&&d(b.status,a)}var i=d(),j=b.isFileProtocol?b.fileAsync:b.async;"function"==typeof i.overrideMimeType&&i.overrideMimeType("text/css"),c.debug("XHR: Getting '"+a+"'"),i.open("GET",a,j),i.setRequestHeader("Accept",e||"text/x-less, text/css; q=0.9, */*; q=0.5"),i.send(null),b.isFileProtocol&&!b.fileAsync?0===i.status||i.status>=200&&i.status<300?f(i.responseText):g(i.status,a):j?i.onreadystatechange=function(){4==i.readyState&&h(i,f,g)}:h(i,f,g)},g.prototype.supports=function(a,b,c,d){return!0},g.prototype.clearFileCache=function(){f={}},g.prototype.loadFile=function(a,b,c,d,e){b&&!this.isPathAbsolute(a)&&(a=b+a),c=c||{};var g=this.extractUrlParts(a,window.location.href),h=g.url;if(c.useFileCache&&f[h])try{var i=f[h];e(null,{contents:i,filename:h,webInfo:{lastModified:new Date}})}catch(j){e({filename:h,message:"Error loading file "+h+" error was "+j.message})}else this.doXHR(h,c.mime,function(a,b){f[h]=a,e(null,{contents:a,filename:h,webInfo:{lastModified:b}})},function(a,b){e({type:"File",message:"'"+b+"' wasn't found ("+a+")",href:h})})},g}},{"../less/environment/abstract-file-manager.js":14}],7:[function(a,b,c){var d=a("./utils").addDataAttr,e=a("./browser");b.exports=function(b,c){function f(a){return c.postProcessor&&"function"==typeof c.postProcessor&&(a=c.postProcessor.call(a,a)||a),a}function g(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function h(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){var d=c.concat(Array.prototype.slice.call(arguments,0));return a.apply(b,d)}}function i(a){for(var b,d=m.getElementsByTagName("style"),e=0;e<d.length;e++)if(b=d[e],b.type.match(t)){var f=g(c);f.modifyVars=a;var i=b.innerHTML||"";f.filename=m.location.href.replace(/#.*$/,""),n.render(i,f,h(function(a,b,c){b?r.add(b,"inline"):(a.type="text/css",a.styleSheet?a.styleSheet.cssText=c.css:a.innerHTML=c.css)},null,b))}}function j(a,b,e,h,i){function j(c){var d=c.contents,g=c.filename,i=c.webInfo,j={currentDirectory:q.getPath(g),filename:g,rootFilename:g,relativeUrls:k.relativeUrls};if(j.entryPath=j.currentDirectory,j.rootpath=k.rootpath||j.currentDirectory,i&&(i.remaining=h,!k.modifyVars)){var l=s.getCSS(g,i);if(!e&&l)return i.local=!0,void b(null,l,d,a,i,g)}r.remove(g),k.rootFileInfo=j,n.render(d,k,function(c,e){c?(c.href=g,b(c)):(e.css=f(e.css),k.modifyVars||s.setCSS(a.href,i.lastModified,e.css),b(null,e.css,d,a,i,g))})}var k=g(c);d(k,a),k.mime=a.type,i&&(k.modifyVars=i),q.loadFile(a.href,null,k,o,function(a,c){return a?void b(a):void j(c)})}function k(a,b,c){for(var d=0;d<n.sheets.length;d++)j(n.sheets[d],a,b,n.sheets.length-(d+1),c)}function l(){"development"===n.env&&(n.watchTimer=setInterval(function(){n.watchMode&&(q.clearFileCache(),k(function(a,c,d,f,g){a?r.add(a,a.href||f.href):c&&e.createCSS(b.document,c,f)}))},c.poll))}var m=b.document,n=a("../less")();n.options=c;var o=n.environment,p=a("./file-manager")(c,n.logger),q=new p;o.addFileManager(q),n.FileManager=p,a("./log-listener")(n,c);var r=a("./error-reporting")(b,n,c),s=n.cache=c.cache||a("./cache")(b,c,n.logger);c.functions&&n.functions.functionRegistry.addMultiple(c.functions);var t=/^text\/(x-)?less$/;return n.watch=function(){return n.watchMode||(n.env="development",l()),this.watchMode=!0,!0},n.unwatch=function(){return clearInterval(n.watchTimer),this.watchMode=!1,!1},n.registerStylesheets=function(){return new Promise(function(a,b){var c=m.getElementsByTagName("link");n.sheets=[];for(var d=0;d<c.length;d++)("stylesheet/less"===c[d].rel||c[d].rel.match(/stylesheet/)&&c[d].type.match(t))&&n.sheets.push(c[d]);a()})},n.modifyVars=function(a){return n.refresh(!0,a,!1)},n.refresh=function(a,c,d){return(a||d)&&d!==!1&&q.clearFileCache(),new Promise(function(d,f){var g,h,j;g=h=new Date,k(function(a,c,i,k,l){return a?(r.add(a,a.href||k.href),void f(a)):(l.local?n.logger.info("loading "+k.href+" from cache."):n.logger.info("rendered "+k.href+" successfully."),e.createCSS(b.document,c,k),n.logger.info("css for "+k.href+" generated in "+(new Date-h)+"ms"),0===l.remaining&&(j=new Date-g,n.logger.info("less has finished. css generated in "+j+"ms"),d({startTime:g,endTime:h,totalMilliseconds:j,sheets:n.sheets.length})),void(h=new Date))},a,c),i(c)})},n.refreshStyles=i,n}},{"../less":29,"./browser":3,"./cache":4,"./error-reporting":5,"./file-manager":6,"./log-listener":8,"./utils":9}],8:[function(a,b,c){b.exports=function(a,b){var c=4,d=3,e=2,f=1;b.logLevel="undefined"!=typeof b.logLevel?b.logLevel:"development"===b.env?d:f,b.loggers||(b.loggers=[{debug:function(a){b.logLevel>=c&&console.log(a)},info:function(a){b.logLevel>=d&&console.log(a)},warn:function(a){b.logLevel>=e&&console.warn(a)},error:function(a){b.logLevel>=f&&console.error(a)}}]);for(var g=0;g<b.loggers.length;g++)a.logger.addListener(b.loggers[g])}},{}],9:[function(a,b,c){b.exports={extractId:function(a){return a.replace(/^[a-z-]+:\/+?[^\/]+/,"").replace(/[\?\&]livereload=\w+/,"").replace(/^\//,"").replace(/\.[a-zA-Z]+$/,"").replace(/[^\.\w-]+/g,"-").replace(/\./g,":")},addDataAttr:function(a,b){for(var c in b.dataset)if(b.dataset.hasOwnProperty(c))if("env"===c||"dumpLineNumbers"===c||"rootpath"===c||"errorReporting"===c)a[c]=b.dataset[c];else try{a[c]=JSON.parse(b.dataset[c])}catch(d){}}}},{}],10:[function(a,b,c){var d={};b.exports=d;var e=function(a,b,c){if(a)for(var d=0;d<c.length;d++)a.hasOwnProperty(c[d])&&(b[c[d]]=a[c[d]])},f=["paths","relativeUrls","rootpath","strictImports","insecure","dumpLineNumbers","compress","syncImport","chunkInput","mime","useFileCache","processImports","reference","pluginManager"];d.Parse=function(a){e(a,this,f),"string"==typeof this.paths&&(this.paths=[this.paths])};var g=["paths","compress","ieCompat","strictMath","strictUnits","sourceMap","importMultiple","urlArgs","javascriptEnabled","pluginManager","importantScope"];d.Eval=function(a,b){e(a,this,g),this.frames=b||[],this.importantScope=this.importantScope||[]},d.Eval.prototype.inParenthesis=function(){this.parensStack||(this.parensStack=[]),this.parensStack.push(!0)},d.Eval.prototype.outOfParenthesis=function(){this.parensStack.pop()},d.Eval.prototype.isMathOn=function(){return this.strictMath?this.parensStack&&this.parensStack.length:!0},d.Eval.prototype.isPathRelative=function(a){return!/^(?:[a-z-]+:|\/|#)/i.test(a)},d.Eval.prototype.normalizePath=function(a){var b,c=a.split("/").reverse();for(a=[];0!==c.length;)switch(b=c.pop()){case".":break;case"..":0===a.length||".."===a[a.length-1]?a.push(b):a.pop();break;default:a.push(b)}return a.join("/")}},{}],11:[function(a,b,c){b.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},{}],12:[function(a,b,c){b.exports={colors:a("./colors"),unitConversions:a("./unit-conversions")}},{"./colors":11,"./unit-conversions":13}],13:[function(a,b,c){b.exports={length:{m:1,cm:.01,mm:.001,"in":.0254,px:.0254/96,pt:.0254/72,pc:.0254/72*12},duration:{s:1,ms:.001},angle:{rad:1/(2*Math.PI),deg:1/360,grad:.0025,turn:1}}},{}],14:[function(a,b,c){var d=function(){};d.prototype.getPath=function(a){var b=a.lastIndexOf("?");return b>0&&(a=a.slice(0,b)),b=a.lastIndexOf("/"),0>b&&(b=a.lastIndexOf("\\")),0>b?"":a.slice(0,b+1)},d.prototype.tryAppendLessExtension=function(a){return/(\.[a-z]*$)|([\?;].*)$/.test(a)?a:a+".less"},d.prototype.supportsSync=function(){return!1},d.prototype.alwaysMakePathsAbsolute=function(){return!1},d.prototype.isPathAbsolute=function(a){return/^(?:[a-z-]+:|\/|\\|#)/i.test(a)},d.prototype.join=function(a,b){return a?a+b:b},d.prototype.pathDiff=function(a,b){var c,d,e,f,g=this.extractUrlParts(a),h=this.extractUrlParts(b),i="";if(g.hostPart!==h.hostPart)return"";for(d=Math.max(h.directories.length,g.directories.length),c=0;d>c&&h.directories[c]===g.directories[c];c++);for(f=h.directories.slice(c),e=g.directories.slice(c),c=0;c<f.length-1;c++)i+="../";for(c=0;c<e.length-1;c++)i+=e[c]+"/";return i},d.prototype.extractUrlParts=function(a,b){var c,d,e=/^((?:[a-z-]+:)?\/+?(?:[^\/\?#]*\/)|([\/\\]))?((?:[^\/\\\?#]*[\/\\])*)([^\/\\\?#]*)([#\?].*)?$/i,f=a.match(e),g={},h=[];if(!f)throw new Error("Could not parse sheet href - '"+a+"'");if(b&&(!f[1]||f[2])){if(d=b.match(e),!d)throw new Error("Could not parse page url - '"+b+"'");f[1]=f[1]||d[1]||"",f[2]||(f[3]=d[3]+f[3])}if(f[3]){for(h=f[3].replace(/\\/g,"/").split("/"),c=0;c<h.length;c++)"."===h[c]&&(h.splice(c,1),c-=1);for(c=0;c<h.length;c++)".."===h[c]&&c>0&&(h.splice(c-1,2),c-=2)}return g.hostPart=f[1],g.directories=h,g.path=(f[1]||"")+h.join("/"),g.fileUrl=g.path+(f[4]||""),g.url=g.fileUrl+(f[5]||""),g},b.exports=d},{}],15:[function(a,b,c){var d=a("../logger"),e=function(a,b){this.fileManagers=b||[],a=a||{};for(var c=["encodeBase64","mimeLookup","charsetLookup","getSourceMapGenerator"],d=[],e=d.concat(c),f=0;f<e.length;f++){var g=e[f],h=a[g];h?this[g]=h.bind(a):f<d.length&&this.warn("missing required function in environment - "+g)}};e.prototype.getFileManager=function(a,b,c,e,f){a||d.warn("getFileManager called with no filename.. Please report this issue. continuing."),null==b&&d.warn("getFileManager called with null directory.. Please report this issue. continuing.");var g=this.fileManagers;c.pluginManager&&(g=[].concat(g).concat(c.pluginManager.getFileManagers()));for(var h=g.length-1;h>=0;h--){var i=g[h];if(i[f?"supportsSync":"supports"](a,b,c,e))return i}return null},e.prototype.addFileManager=function(a){this.fileManagers.push(a)},e.prototype.clearFileManagers=function(){this.fileManagers=[]},b.exports=e},{"../logger":31}],16:[function(a,b,c){function d(a,b,c){var d,f,g,h,i=b.alpha,j=c.alpha,k=[];g=j+i*(1-j);for(var l=0;3>l;l++)d=b.rgb[l]/255,f=c.rgb[l]/255,h=a(d,f),g&&(h=(j*f+i*(d-j*(d+f-h)))/g),k[l]=255*h;return new e(k,g)}var e=a("../tree/color"),f=a("./function-registry"),g={multiply:function(a,b){return a*b},screen:function(a,b){return a+b-a*b},overlay:function(a,b){return a*=2,1>=a?g.multiply(a,b):g.screen(a-1,b)},softlight:function(a,b){var c=1,d=a;return b>.5&&(d=1,c=a>.25?Math.sqrt(a):((16*a-12)*a+4)*a),a-(1-2*b)*d*(c-a)},hardlight:function(a,b){return g.overlay(b,a)},difference:function(a,b){return Math.abs(a-b)},exclusion:function(a,b){return a+b-2*a*b},average:function(a,b){return(a+b)/2},negation:function(a,b){return 1-Math.abs(a+b-1)}};for(var h in g)g.hasOwnProperty(h)&&(d[h]=d.bind(null,g[h]));f.addMultiple(d)},{"../tree/color":47,"./function-registry":21}],17:[function(a,b,c){function d(a){return Math.min(1,Math.max(0,a))}function e(a){return h.hsla(a.h,a.s,a.l,a.a)}function f(a){if(a instanceof i)return parseFloat(a.unit.is("%")?a.value/100:a.value);if("number"==typeof a)return a;throw{type:"Argument",message:"color functions take numbers as parameters"}}function g(a,b){return a instanceof i&&a.unit.is("%")?parseFloat(a.value*b/100):f(a)}var h,i=a("../tree/dimension"),j=a("../tree/color"),k=a("../tree/quoted"),l=a("../tree/anonymous"),m=a("./function-registry");h={rgb:function(a,b,c){return h.rgba(a,b,c,1)},rgba:function(a,b,c,d){var e=[a,b,c].map(function(a){return g(a,255)});return d=f(d),new j(e,d)},hsl:function(a,b,c){return h.hsla(a,b,c,1)},hsla:function(a,b,c,e){function g(a){return a=0>a?a+1:a>1?a-1:a,1>6*a?j+(i-j)*a*6:1>2*a?i:2>3*a?j+(i-j)*(2/3-a)*6:j}a=f(a)%360/360,b=d(f(b)),c=d(f(c)),e=d(f(e));var i=.5>=c?c*(b+1):c+b-c*b,j=2*c-i;return h.rgba(255*g(a+1/3),255*g(a),255*g(a-1/3),e)},hsv:function(a,b,c){return h.hsva(a,b,c,1)},hsva:function(a,b,c,d){a=f(a)%360/360*360,b=f(b),c=f(c),d=f(d);var e,g;e=Math.floor(a/60%6),g=a/60-e;var i=[c,c*(1-b),c*(1-g*b),c*(1-(1-g)*b)],j=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];return h.rgba(255*i[j[e][0]],255*i[j[e][1]],255*i[j[e][2]],d)},hue:function(a){return new i(a.toHSL().h)},saturation:function(a){return new i(100*a.toHSL().s,"%")},lightness:function(a){return new i(100*a.toHSL().l,"%")},hsvhue:function(a){return new i(a.toHSV().h)},hsvsaturation:function(a){return new i(100*a.toHSV().s,"%")},hsvvalue:function(a){return new i(100*a.toHSV().v,"%")},red:function(a){return new i(a.rgb[0])},green:function(a){return new i(a.rgb[1])},blue:function(a){return new i(a.rgb[2])},alpha:function(a){return new i(a.toHSL().a)},luma:function(a){return new i(a.luma()*a.alpha*100,"%")},luminance:function(a){var b=.2126*a.rgb[0]/255+.7152*a.rgb[1]/255+.0722*a.rgb[2]/255;return new i(b*a.alpha*100,"%")},saturate:function(a,b){if(!a.rgb)return null;var c=a.toHSL();return c.s+=b.value/100,c.s=d(c.s),e(c)},desaturate:function(a,b){var c=a.toHSL();return c.s-=b.value/100,c.s=d(c.s),e(c)},lighten:function(a,b){var c=a.toHSL();return c.l+=b.value/100,c.l=d(c.l),e(c)},darken:function(a,b){var c=a.toHSL();return c.l-=b.value/100,c.l=d(c.l),e(c)},fadein:function(a,b){var c=a.toHSL();return c.a+=b.value/100,c.a=d(c.a),e(c)},fadeout:function(a,b){var c=a.toHSL();return c.a-=b.value/100,c.a=d(c.a),e(c)},fade:function(a,b){var c=a.toHSL();return c.a=b.value/100,c.a=d(c.a),e(c)},spin:function(a,b){var c=a.toHSL(),d=(c.h+b.value)%360;return c.h=0>d?360+d:d,e(c)},mix:function(a,b,c){c||(c=new i(50));var d=c.value/100,e=2*d-1,f=a.toHSL().a-b.toHSL().a,g=((e*f==-1?e:(e+f)/(1+e*f))+1)/2,h=1-g,k=[a.rgb[0]*g+b.rgb[0]*h,a.rgb[1]*g+b.rgb[1]*h,a.rgb[2]*g+b.rgb[2]*h],l=a.alpha*d+b.alpha*(1-d);return new j(k,l)},greyscale:function(a){return h.desaturate(a,new i(100))},contrast:function(a,b,c,d){if(!a.rgb)return null;if("undefined"==typeof c&&(c=h.rgba(255,255,255,1)),"undefined"==typeof b&&(b=h.rgba(0,0,0,1)),b.luma()>c.luma()){var e=c;c=b,b=e}return d="undefined"==typeof d?.43:f(d),a.luma()<d?c:b},argb:function(a){return new l(a.toARGB())},color:function(a){if(a instanceof k&&/^#([a-f0-9]{6}|[a-f0-9]{3})$/i.test(a.value))return new j(a.value.slice(1));if(a instanceof j||(a=j.fromKeyword(a.value)))return a.value=void 0,a;throw{type:"Argument",message:"argument must be a color keyword or 3/6 digit hex e.g. #FFF"}},tint:function(a,b){return h.mix(h.rgb(255,255,255),a,b)},shade:function(a,b){return h.mix(h.rgb(0,0,0),a,b)}},m.addMultiple(h)},{"../tree/anonymous":43,"../tree/color":47,"../tree/dimension":53,"../tree/quoted":70,"./function-registry":21}],18:[function(a,b,c){b.exports=function(b){var c=a("../tree/quoted"),d=a("../tree/url"),e=a("./function-registry"),f=function(a,b){return new d(b,a.index,a.currentFileInfo).eval(a.context)},g=a("../logger");e.add("data-uri",function(a,e){e||(e=a,a=null);var h=a&&a.value,i=e.value,j=this.currentFileInfo,k=j.relativeUrls?j.currentDirectory:j.entryPath,l=i.indexOf("#"),m="";-1!==l&&(m=i.slice(l),i=i.slice(0,l));var n=b.getFileManager(i,k,this.context,b,!0);if(!n)return f(this,e);var o=!1;if(a)o=/;base64$/.test(h);else{if(h=b.mimeLookup(i),"image/svg+xml"===h)o=!1;else{var p=b.charsetLookup(h);o=["US-ASCII","UTF-8"].indexOf(p)<0}o&&(h+=";base64")}var q=n.loadFileSync(i,k,this.context,b);if(!q.contents)return g.warn("Skipped data-uri embedding of "+i+" because file not found"),f(this,e||a);var r=q.contents;if(o&&!b.encodeBase64)return f(this,e);r=o?b.encodeBase64(r):encodeURIComponent(r);var s="data:"+h+","+r+m,t=32768;return s.length>=t&&this.context.ieCompat!==!1?(g.warn("Skipped data-uri embedding of "+i+" because its size ("+s.length+" characters) exceeds IE8-safe "+t+" characters!"),f(this,e||a)):new d(new c('"'+s+'"',s,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../logger":31,"../tree/quoted":70,"../tree/url":77,"./function-registry":21}],19:[function(a,b,c){var d=a("../tree/keyword"),e=a("./function-registry"),f={eval:function(){var a=this.value_,b=this.error_;if(b)throw b;return null!=a?a?d.True:d.False:void 0},value:function(a){this.value_=a},error:function(a){this.error_=a},reset:function(){this.value_=this.error_=null}};e.add("default",f.eval.bind(f)),b.exports=f},{"../tree/keyword":62,"./function-registry":21}],20:[function(a,b,c){var d=a("./function-registry"),e=function(a,b,c,e){this.name=a.toLowerCase(),this.func=d.get(this.name),this.index=c,this.context=b,this.currentFileInfo=e};e.prototype.isValid=function(){return Boolean(this.func)},e.prototype.call=function(a){return this.func.apply(this,a)},b.exports=e},{"./function-registry":21}],21:[function(a,b,c){b.exports={_data:{},add:function(a,b){this._data.hasOwnProperty(a),this._data[a]=b},addMultiple:function(a){Object.keys(a).forEach(function(b){this.add(b,a[b])}.bind(this))},get:function(a){return this._data[a]}}},{}],22:[function(a,b,c){b.exports=function(b){var c={functionRegistry:a("./function-registry"),functionCaller:a("./function-caller")};return a("./default"),a("./color"),a("./color-blending"),a("./data-uri")(b),a("./math"),a("./number"),a("./string"),a("./svg")(b),a("./types"),c}},{"./color":17,"./color-blending":16,"./data-uri":18,"./default":19,"./function-caller":20,"./function-registry":21,"./math":23,"./number":24,"./string":25,"./svg":26,"./types":27}],23:[function(a,b,c){function d(a,b,c){if(!(c instanceof e))throw{type:"Argument",message:"argument must be a number"};return null==b?b=c.unit:c=c.unify(),new e(a(parseFloat(c.value)),b)}var e=a("../tree/dimension"),f=a("./function-registry"),g={ceil:null,floor:null,sqrt:null,abs:null,tan:"",sin:"",cos:"",atan:"rad",asin:"rad",acos:"rad"};for(var h in g)g.hasOwnProperty(h)&&(g[h]=d.bind(null,Math[h],g[h]));g.round=function(a,b){var c="undefined"==typeof b?0:b.value;return d(function(a){return a.toFixed(c)},null,a)},f.addMultiple(g)},{"../tree/dimension":53,"./function-registry":21}],24:[function(a,b,c){var d=a("../tree/dimension"),e=a("../tree/anonymous"),f=a("./function-registry"),g=function(a,b){switch(b=Array.prototype.slice.call(b),b.length){case 0:throw{type:"Argument",message:"one or more arguments required"}}var c,f,g,h,i,j,k,l,m=[],n={};for(c=0;c<b.length;c++)if(g=b[c],g instanceof d)if(h=""===g.unit.toString()&&void 0!==l?new d(g.value,l).unify():g.unify(),j=""===h.unit.toString()&&void 0!==k?k:h.unit.toString(),k=""!==j&&void 0===k||""!==j&&""===m[0].unify().unit.toString()?j:k,l=""!==j&&void 0===l?g.unit.toString():l,f=void 0!==n[""]&&""!==j&&j===k?n[""]:n[j],void 0!==f)i=""===m[f].unit.toString()&&void 0!==l?new d(m[f].value,l).unify():m[f].unify(),(a&&h.value<i.value||!a&&h.value>i.value)&&(m[f]=g);else{if(void 0!==k&&j!==k)throw{type:"Argument",message:"incompatible types"};n[j]=m.length,m.push(g)}else Array.isArray(b[c].value)&&Array.prototype.push.apply(b,Array.prototype.slice.call(b[c].value));return 1==m.length?m[0]:(b=m.map(function(a){return a.toCSS(this.context)}).join(this.context.compress?",":", "),new e((a?"min":"max")+"("+b+")"))};f.addMultiple({min:function(){return g(!0,arguments)},max:function(){return g(!1,arguments)},convert:function(a,b){return a.convertTo(b.value)},pi:function(){return new d(Math.PI)},mod:function(a,b){return new d(a.value%b.value,a.unit)},pow:function(a,b){if("number"==typeof a&&"number"==typeof b)a=new d(a),b=new d(b);else if(!(a instanceof d&&b instanceof d))throw{type:"Argument",message:"arguments must be numbers"};return new d(Math.pow(a.value,b.value),a.unit)},percentage:function(a){return new d(100*a.value,"%")}})},{"../tree/anonymous":43,"../tree/dimension":53,"./function-registry":21}],25:[function(a,b,c){var d=a("../tree/quoted"),e=a("../tree/anonymous"),f=a("../tree/javascript"),g=a("./function-registry");g.addMultiple({e:function(a){return new e(a instanceof f?a.evaluated:a.value)},escape:function(a){return new e(encodeURI(a.value).replace(/=/g,"%3D").replace(/:/g,"%3A").replace(/#/g,"%23").replace(/;/g,"%3B").replace(/\(/g,"%28").replace(/\)/g,"%29"))},replace:function(a,b,c,e){var f=a.value;return f=f.replace(new RegExp(b.value,e?e.value:""),c.value),new d(a.quote||"",f,a.escaped)},"%":function(a){for(var b=Array.prototype.slice.call(arguments,1),c=a.value,e=0;e<b.length;e++)c=c.replace(/%[sda]/i,function(a){var c=a.match(/s/i)?b[e].value:b[e].toCSS();return a.match(/[A-Z]$/)?encodeURIComponent(c):c});return c=c.replace(/%%/g,"%"),new d(a.quote||"",c,a.escaped)}})},{"../tree/anonymous":43,"../tree/javascript":60,"../tree/quoted":70,"./function-registry":21}],26:[function(a,b,c){b.exports=function(b){var c=a("../tree/dimension"),d=a("../tree/color"),e=a("../tree/expression"),f=a("../tree/quoted"),g=a("../tree/url"),h=a("./function-registry");h.add("svg-gradient",function(a){function b(){throw{type:"Argument",message:"svg-gradient expects direction, start_color [start_position], [color position,]..., end_color [end_position]"}}arguments.length<3&&b();var h,i,j,k,l,m,n,o=Array.prototype.slice.call(arguments,1),p="linear",q='x="0" y="0" width="1" height="1"',r={compress:!1},s=a.toCSS(r);switch(s){case"to bottom":h='x1="0%" y1="0%" x2="0%" y2="100%"';break;case"to right":h='x1="0%" y1="0%" x2="100%" y2="0%"';break;case"to bottom right":h='x1="0%" y1="0%" x2="100%" y2="100%"';break;case"to top right":h='x1="0%" y1="100%" x2="100%" y2="0%"';break;case"ellipse":case"ellipse at center":p="radial",h='cx="50%" cy="50%" r="75%"',q='x="-50" y="-50" width="101" height="101"';break;default:throw{type:"Argument",message:"svg-gradient direction must be 'to bottom', 'to right', 'to bottom right', 'to top right' or 'ellipse at center'"}}for(i='<?xml version="1.0" ?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none"><'+p+'Gradient id="gradient" gradientUnits="userSpaceOnUse" '+h+">",j=0;j<o.length;j+=1)o[j]instanceof e?(k=o[j].value[0],l=o[j].value[1]):(k=o[j],l=void 0),k instanceof d&&((0===j||j+1===o.length)&&void 0===l||l instanceof c)||b(),m=l?l.toCSS(r):0===j?"0%":"100%",n=k.alpha,i+='<stop offset="'+m+'" stop-color="'+k.toRGB()+'"'+(1>n?' stop-opacity="'+n+'"':"")+"/>";return i+="</"+p+"Gradient><rect "+q+' fill="url(#gradient)" /></svg>',i=encodeURIComponent(i),i="data:image/svg+xml,"+i,new g(new f("'"+i+"'",i,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../tree/color":47,"../tree/dimension":53,"../tree/expression":56,"../tree/quoted":70,"../tree/url":77,"./function-registry":21}],27:[function(a,b,c){var d=a("../tree/keyword"),e=a("../tree/detached-ruleset"),f=a("../tree/dimension"),g=a("../tree/color"),h=a("../tree/quoted"),i=a("../tree/anonymous"),j=a("../tree/url"),k=a("../tree/operation"),l=a("./function-registry"),m=function(a,b){
return a instanceof b?d.True:d.False},n=function(a,b){if(void 0===b)throw{type:"Argument",message:"missing the required second argument to isunit."};if(b="string"==typeof b.value?b.value:b,"string"!=typeof b)throw{type:"Argument",message:"Second argument to isunit should be a unit or a string."};return a instanceof f&&a.unit.is(b)?d.True:d.False},o=function(a){var b=Array.isArray(a.value)?a.value:Array(a);return b.filter(function(a){return"Comment"===a.type?!1:!0})};l.addMultiple({isruleset:function(a){return m(a,e)},iscolor:function(a){return m(a,g)},isnumber:function(a){return m(a,f)},isstring:function(a){return m(a,h)},iskeyword:function(a){return m(a,d)},isurl:function(a){return m(a,j)},ispixel:function(a){return n(a,"px")},ispercentage:function(a){return n(a,"%")},isem:function(a){return n(a,"em")},isunit:n,unit:function(a,b){if(!(a instanceof f))throw{type:"Argument",message:"the first argument to unit must be a number"+(a instanceof k?". Have you forgotten parenthesis?":"")};return b=b?b instanceof d?b.value:b.toCSS():"",new f(a.value,b)},"get-unit":function(a){return new i(a.unit)},extract:function(a,b){return b=b.value-1,o(a)[b]},length:function(a){return new f(o(a).length)}})},{"../tree/anonymous":43,"../tree/color":47,"../tree/detached-ruleset":52,"../tree/dimension":53,"../tree/keyword":62,"../tree/operation":68,"../tree/quoted":70,"../tree/url":77,"./function-registry":21}],28:[function(a,b,c){var d=a("./contexts"),e=a("./parser/parser");b.exports=function(a){var b=function(a,b){this.rootFilename=b.filename,this.paths=a.paths||[],this.contents={},this.contentsIgnoredChars={},this.mime=a.mime,this.error=null,this.context=a,this.queue=[],this.files={}};return b.prototype.push=function(b,c,f,g,h){var i=this;this.queue.push(b);var j=function(a,c,d){i.queue.splice(i.queue.indexOf(b),1);var e=d===i.rootFilename;g.optional&&a?h(null,{rules:[]},!1,null):(i.files[d]=c,a&&!i.error&&(i.error=a),h(a,c,e,d))},k={relativeUrls:this.context.relativeUrls,entryPath:f.entryPath,rootpath:f.rootpath,rootFilename:f.rootFilename},l=a.getFileManager(b,f.currentDirectory,this.context,a);if(!l)return void j({message:"Could not find a file-manager for "+b});c&&(b=l.tryAppendLessExtension(b));var m=function(a){var b=a.filename,c=a.contents.replace(/^\uFEFF/,"");k.currentDirectory=l.getPath(b),k.relativeUrls&&(k.rootpath=l.join(i.context.rootpath||"",l.pathDiff(k.currentDirectory,k.entryPath)),!l.isPathAbsolute(k.rootpath)&&l.alwaysMakePathsAbsolute()&&(k.rootpath=l.join(k.entryPath,k.rootpath))),k.filename=b;var h=new d.Parse(i.context);h.processImports=!1,i.contents[b]=c,(f.reference||g.reference)&&(k.reference=!0),g.inline?j(null,c,b):new e(h,i,k).parse(c,function(a,c){j(a,c,b)})},n=l.loadFile(b,f.currentDirectory,this.context,a,function(a,b){a?j(a):m(b)});n&&n.then(m,j)},b}},{"./contexts":10,"./parser/parser":36}],29:[function(a,b,c){b.exports=function(b,c){var d,e,f,g,h,i={version:[2,4,0],data:a("./data"),tree:a("./tree"),Environment:h=a("./environment/environment"),AbstractFileManager:a("./environment/abstract-file-manager"),environment:b=new h(b,c),visitors:a("./visitors"),Parser:a("./parser/parser"),functions:a("./functions")(b),contexts:a("./contexts"),SourceMapOutput:d=a("./source-map-output")(b),SourceMapBuilder:e=a("./source-map-builder")(d,b),ParseTree:f=a("./parse-tree")(e),ImportManager:g=a("./import-manager")(b),render:a("./render")(b,f,g),parse:a("./parse")(b,f,g),LessError:a("./less-error"),transformTree:a("./transform-tree"),utils:a("./utils"),PluginManager:a("./plugin-manager"),logger:a("./logger")};return i}},{"./contexts":10,"./data":12,"./environment/abstract-file-manager":14,"./environment/environment":15,"./functions":22,"./import-manager":28,"./less-error":30,"./logger":31,"./parse":33,"./parse-tree":32,"./parser/parser":36,"./plugin-manager":37,"./render":38,"./source-map-builder":39,"./source-map-output":40,"./transform-tree":41,"./tree":59,"./utils":80,"./visitors":84}],30:[function(a,b,c){var d=a("./utils"),e=b.exports=function(a,b,c){Error.call(this);var e=a.filename||c;if(b&&e){var f=b.contents[e],g=d.getLocation(a.index,f),h=g.line,i=g.column,j=a.call&&d.getLocation(a.call,f).line,k=f.split("\n");this.type=a.type||"Syntax",this.filename=e,this.index=a.index,this.line="number"==typeof h?h+1:null,this.callLine=j+1,this.callExtract=k[j],this.column=i,this.extract=[k[h-1],k[h],k[h+1]]}this.message=a.message,this.stack=a.stack};if("undefined"==typeof Object.create){var f=function(){};f.prototype=Error.prototype,e.prototype=new f}else e.prototype=Object.create(Error.prototype);e.prototype.constructor=e},{"./utils":80}],31:[function(a,b,c){b.exports={error:function(a){this._fireEvent("error",a)},warn:function(a){this._fireEvent("warn",a)},info:function(a){this._fireEvent("info",a)},debug:function(a){this._fireEvent("debug",a)},addListener:function(a){this._listeners.push(a)},removeListener:function(a){for(var b=0;b<this._listeners.length;b++)if(this._listeners[b]===a)return void this._listeners.splice(b,1)},_fireEvent:function(a,b){for(var c=0;c<this._listeners.length;c++){var d=this._listeners[c][a];d&&d(b)}},_listeners:[]}},{}],32:[function(a,b,c){var d=a("./less-error"),e=a("./transform-tree"),f=a("./logger");b.exports=function(a){var b=function(a,b){this.root=a,this.imports=b};return b.prototype.toCSS=function(b){var c,g,h={};try{c=e(this.root,b)}catch(i){throw new d(i,this.imports)}try{var j=Boolean(b.compress);j&&f.warn("The compress option has been deprecated. We recommend you use a dedicated css minifier, for instance see less-plugin-clean-css.");var k={compress:j,dumpLineNumbers:b.dumpLineNumbers,strictUnits:Boolean(b.strictUnits),numPrecision:8};b.sourceMap?(g=new a(b.sourceMap),h.css=g.toCSS(c,k,this.imports)):h.css=c.toCSS(k)}catch(i){throw new d(i,this.imports)}if(b.pluginManager)for(var l=b.pluginManager.getPostProcessors(),m=0;m<l.length;m++)h.css=l[m].process(h.css,{sourceMap:g,options:b,imports:this.imports});b.sourceMap&&(h.map=g.getExternalSourceMap()),h.imports=[];for(var n in this.imports.files)this.imports.files.hasOwnProperty(n)&&n!==this.imports.rootFilename&&h.imports.push(n);return h},b}},{"./less-error":30,"./logger":31,"./transform-tree":41}],33:[function(a,b,c){var d,e=a("./contexts"),f=a("./parser/parser"),g=a("./plugin-manager");b.exports=function(b,c,h){var i=function(b,c,j){if(c=c||{},"function"==typeof c&&(j=c,c={}),!j){d||(d="undefined"==typeof Promise?a("promise"):Promise);var k=this;return new d(function(a,d){i.call(k,b,c,function(b,c){b?d(b):a(c)})})}var l,m,n=new g(this);if(n.addPlugins(c.plugins),c.pluginManager=n,l=new e.Parse(c),c.rootFileInfo)m=c.rootFileInfo;else{var o=c.filename||"input",p=o.replace(/[^\/\\]*$/,"");m={filename:o,relativeUrls:l.relativeUrls,rootpath:l.rootpath||"",currentDirectory:p,entryPath:p,rootFilename:o},m.rootpath&&"/"!==m.rootpath.slice(-1)&&(m.rootpath+="/")}var q=new h(l,m);new f(l,q,m).parse(b,function(a,b){return a?j(a):void j(null,b,q,c)},c)};return i}},{"./contexts":10,"./parser/parser":36,"./plugin-manager":37,promise:void 0}],34:[function(a,b,c){b.exports=function(a,b){function c(b){var c=h-q;512>c&&!b||!c||(p.push(a.slice(q,h+1)),q=h+1)}var d,e,f,g,h,i,j,k,l,m=a.length,n=0,o=0,p=[],q=0;for(h=0;m>h;h++)if(j=a.charCodeAt(h),!(j>=97&&122>=j||34>j))switch(j){case 40:o++,e=h;continue;case 41:if(--o<0)return b("missing opening `(`",h);continue;case 59:o||c();continue;case 123:n++,d=h;continue;case 125:if(--n<0)return b("missing opening `{`",h);n||o||c();continue;case 92:if(m-1>h){h++;continue}return b("unescaped `\\`",h);case 34:case 39:case 96:for(l=0,i=h,h+=1;m>h;h++)if(k=a.charCodeAt(h),!(k>96)){if(k==j){l=1;break}if(92==k){if(h==m-1)return b("unescaped `\\`",h);h++}}if(l)continue;return b("unmatched `"+String.fromCharCode(j)+"`",i);case 47:if(o||h==m-1)continue;if(k=a.charCodeAt(h+1),47==k)for(h+=2;m>h&&(k=a.charCodeAt(h),!(13>=k)||10!=k&&13!=k);h++);else if(42==k){for(f=i=h,h+=2;m-1>h&&(k=a.charCodeAt(h),125==k&&(g=h),42!=k||47!=a.charCodeAt(h+1));h++);if(h==m-1)return b("missing closing `*/`",i);h++}continue;case 42:if(m-1>h&&47==a.charCodeAt(h+1))return b("unmatched `/*`",h);continue}return 0!==n?f>d&&g>f?b("missing closing `}` or `*/`",d):b("missing closing `}`",d):0!==o?b("missing closing `)`",e):(c(!0),p)}},{}],35:[function(a,b,c){var d=a("./chunker");b.exports=function(){function a(){k.i>i&&(h=h.slice(k.i-i),i=k.i)}var b,c,e,f,g,h,i,j=[],k={};k.save=function(){i=k.i,j.push({current:h,i:k.i,j:c})},k.restore=function(a){(k.i>e||k.i===e&&a&&!f)&&(e=k.i,f=a);var b=j.pop();h=b.current,i=k.i=b.i,c=b.j},k.forget=function(){j.pop()},k.isWhitespace=function(a){var c=k.i+(a||0),d=b.charCodeAt(c);return d===l||d===o||d===m||d===n},k.$=function(c){var d,e,f=typeof c;return"string"===f?b.charAt(k.i)!==c?null:(t(1),c):(a(),(d=c.exec(h))?(e=d[0].length,t(e),"string"==typeof d?d:1===d.length?d[0]:d):null)},k.$re=function(a){k.i>i&&(h=h.slice(k.i-i),i=k.i);var b=a.exec(h);return b?(t(b[0].length),"string"==typeof b?b:1===b.length?b[0]:b):null},k.$char=function(a){return b.charAt(k.i)!==a?null:(t(1),a)};var l=32,m=9,n=10,o=13,p=43,q=44,r=47,s=57;k.autoCommentAbsorb=!0,k.commentStore=[],k.finished=!1;var t=function(a){for(var d,e,f,j=k.i,p=c,q=k.i-i,s=k.i+h.length-q,u=k.i+=a,v=b;k.i<s;k.i++){if(d=v.charCodeAt(k.i),k.autoCommentAbsorb&&d===r){if(e=v.charAt(k.i+1),"/"===e){f={index:k.i,isLineComment:!0};var w=v.indexOf("\n",k.i+1);0>w&&(w=s),k.i=w,f.text=v.substr(f.i,k.i-f.i),k.commentStore.push(f);continue}if("*"===e){var x=v.substr(k.i),y=x.match(/^\/\*(?:[^*]|\*+[^\/*])*\*+\//);if(y){f={index:k.i,text:y[0],isLineComment:!1},k.i+=f.text.length-1,k.commentStore.push(f);continue}}break}if(d!==l&&d!==n&&d!==m&&d!==o)break}if(h=h.slice(a+k.i-u+q),i=k.i,!h.length){if(c<g.length-1)return h=g[++c],t(0),!0;k.finished=!0}return j!==k.i||p!==c};return k.peek=function(a){return"string"==typeof a?b.charAt(k.i)===a:a.test(h)},k.peekChar=function(a){return b.charAt(k.i)===a},k.currentChar=function(){return b.charAt(k.i)},k.getInput=function(){return b},k.peekNotNumeric=function(){var a=b.charCodeAt(k.i);return a>s||p>a||a===r||a===q},k.start=function(a,f,j){b=a,k.i=c=i=e=0,g=f?d(a,j):[a],h=g[0],t(0)},k.end=function(){var a,c=k.i>=b.length;return k.i<e&&(a=f,k.i=e),{isFinished:c,furthest:k.i,furthestPossibleErrorMessage:a,furthestReachedEnd:k.i>=b.length-1,furthestChar:b[k.i]}},k}},{"./chunker":34}],36:[function(a,b,c){var d=a("../less-error"),e=a("../tree"),f=a("../visitors"),g=a("./parser-input"),h=a("../utils"),i=function j(a,b,c){function i(a,b,c){var d="[object Function]"===Object.prototype.toString.call(a)?a.call(n):o.$(a);return d?d:void l(b||("string"==typeof a?"expected '"+a+"' got '"+o.currentChar()+"'":"unexpected token"))}function k(a,b){return o.$char(a)?a:void l(b||"expected '"+a+"' got '"+o.currentChar()+"'")}function l(a,e){throw new d({index:o.i,filename:c.filename,type:e||"Syntax",message:a},b)}function m(a){var b=c.filename;return{lineNumber:h.getLocation(a,o.getInput()).line+1,fileName:b}}var n,o=g();return{parse:function(g,h,i){var k,l,m,n,p=null,q="";if(l=i&&i.globalVars?j.serializeVars(i.globalVars)+"\n":"",m=i&&i.modifyVars?"\n"+j.serializeVars(i.modifyVars):"",a.pluginManager)for(var r=a.pluginManager.getPreProcessors(),s=0;s<r.length;s++)g=r[s].process(g,{context:a,imports:b,fileInfo:c});(l||i&&i.banner)&&(q=(i&&i.banner?i.banner:"")+l,n=b.contentsIgnoredChars,n[c.filename]=n[c.filename]||0,n[c.filename]+=q.length),g=g.replace(/\r\n?/g,"\n"),g=q+g.replace(/^\uFEFF/,"")+m,b.contents[c.filename]=g;try{o.start(g,a.chunkInput,function(a,e){throw d({index:e,type:"Parse",message:a,filename:c.filename},b)}),k=new e.Ruleset(null,this.parsers.primary()),k.root=!0,k.firstRoot=!0}catch(t){return h(new d(t,b,c.filename))}var u=o.end();if(!u.isFinished){var v=u.furthestPossibleErrorMessage;v||(v="Unrecognised input","}"===u.furthestChar?v+=". Possibly missing opening '{'":")"===u.furthestChar?v+=". Possibly missing opening '('":u.furthestReachedEnd&&(v+=". Possibly missing something")),p=new d({type:"Parse",message:v,index:u.furthest,filename:c.filename},b)}var w=function(a){return a=p||a||b.error,a?(a instanceof d||(a=new d(a,b,c.filename)),h(a)):h(null,k)};return a.processImports===!1?w():void new f.ImportVisitor(b,w).run(k)},parsers:n={primary:function(){for(var a,b=this.mixin,c=[];;){for(;;){if(a=this.comment(),!a)break;c.push(a)}if(o.finished)break;if(o.peek("}"))break;if(a=this.extendRule())c=c.concat(a);else if(a=b.definition()||this.rule()||this.ruleset()||b.call()||this.rulesetCall()||this.directive())c.push(a);else if(!o.$re(/^[\s\n]+/)&&!o.$re(/^;+/))break}return c},comment:function(){if(o.commentStore.length){var a=o.commentStore.shift();return new e.Comment(a.text,a.isLineComment,a.index,c)}},entities:{quoted:function(){var a,b=o.i;return a=o.$re(/^(~)?("((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)')/),a?new e.Quoted(a[2],a[3]||a[4],Boolean(a[1]),b,c):void 0},keyword:function(){var a=o.$re(/^%|^[_A-Za-z-][_A-Za-z0-9-]*/);return a?e.Color.fromKeyword(a)||new e.Keyword(a):void 0},call:function(){var a,b,d,f,g=o.i;if(!o.peek(/^url\(/i))return o.save(),(a=o.$re(/^([\w-]+|%|progid:[\w\.]+)\(/))?(a=a[1],b=a.toLowerCase(),"alpha"===b&&(f=n.alpha())?f:(d=this.arguments(),o.$char(")")?(o.forget(),new e.Call(a,d,g,c)):void o.restore("Could not parse call arguments or missing ')'"))):void o.forget()},arguments:function(){for(var a,b=[];;){if(a=this.assignment()||n.expression(),!a)break;if(b.push(a),!o.$char(","))break}return b},literal:function(){return this.dimension()||this.color()||this.quoted()||this.unicodeDescriptor()},assignment:function(){var a,b;return a=o.$re(/^\w+(?=\s?=)/i),a&&o.$char("=")?(b=n.entity(),b?new e.Assignment(a,b):void 0):void 0},url:function(){var a,b=o.i;return o.autoCommentAbsorb=!1,"u"===o.currentChar()&&o.$re(/^url\(/)?(a=this.quoted()||this.variable()||o.$re(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",o.autoCommentAbsorb=!0,k(")"),new e.URL(null!=a.value||a instanceof e.Variable?a:new e.Anonymous(a),b,c)):void(o.autoCommentAbsorb=!0)},variable:function(){var a,b=o.i;return"@"===o.currentChar()&&(a=o.$re(/^@@?[\w-]+/))?new e.Variable(a,b,c):void 0},variableCurly:function(){var a,b=o.i;return"@"===o.currentChar()&&(a=o.$re(/^@\{([\w-]+)\}/))?new e.Variable("@"+a[1],b,c):void 0},color:function(){var a;if("#"===o.currentChar()&&(a=o.$re(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/))){var b=a.input.match(/^#([\w]+).*/);return b=b[1],b.match(/^[A-Fa-f0-9]+$/)||l("Invalid HEX color code"),new e.Color(a[1])}},dimension:function(){if(!o.peekNotNumeric()){var a=o.$re(/^([+-]?\d*\.?\d+)(%|[a-z]+)?/i);return a?new e.Dimension(a[1],a[2]):void 0}},unicodeDescriptor:function(){var a;return a=o.$re(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/),a?new e.UnicodeDescriptor(a[0]):void 0},javascript:function(){var a,b=o.i;return a=o.$re(/^(~)?`([^`]*)`/),a?new e.JavaScript(a[2],Boolean(a[1]),b,c):void 0}},variable:function(){var a;return"@"===o.currentChar()&&(a=o.$re(/^(@[\w-]+)\s*:/))?a[1]:void 0},rulesetCall:function(){var a;return"@"===o.currentChar()&&(a=o.$re(/^(@[\w-]+)\s*\(\s*\)\s*;/))?new e.RulesetCall(a[1]):void 0},extend:function(a){var b,c,d,f,g,h=o.i;if(a?o.$re(/^&:extend\(/):o.$re(/^:extend\(/)){do{for(d=null,b=null;!(d=o.$re(/^(all)(?=\s*(\)|,))/))&&(c=this.element());)b?b.push(c):b=[c];d=d&&d[1],b||l("Missing target selector for :extend()."),g=new e.Extend(new e.Selector(b),d,h),f?f.push(g):f=[g]}while(o.$char(","));return i(/^\)/),a&&i(/^;/),f}},extendRule:function(){return this.extend(!0)},mixin:{call:function(){var a,b,d,f,g,h,i=o.currentChar(),j=!1,l=o.i;if("."===i||"#"===i){for(o.save();;){if(a=o.i,f=o.$re(/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/),!f)break;d=new e.Element(g,f,a,c),b?b.push(d):b=[d],g=o.$char(">")}return b&&(o.$char("(")&&(h=this.args(!0).args,k(")")),n.important()&&(j=!0),n.end())?(o.forget(),new e.mixin.Call(b,h,l,c,j)):void o.restore()}},args:function(a){var b,c,d,f,g,h,i=n.entities,j={args:null,variadic:!1},k=[],m=[],p=[];for(o.save();;){if(a)h=n.detachedRuleset()||n.expression();else{if(o.commentStore.length=0,"."===o.currentChar()&&o.$re(/^\.{3}/)){j.variadic=!0,o.$char(";")&&!b&&(b=!0),(b?m:p).push({variadic:!0});break}h=i.variable()||i.literal()||i.keyword()}if(!h)break;f=null,h.throwAwayComments&&h.throwAwayComments(),g=h;var q=null;if(a?h.value&&1==h.value.length&&(q=h.value[0]):q=h,q&&q instanceof e.Variable)if(o.$char(":")){if(k.length>0&&(b&&l("Cannot mix ; and , as delimiter types"),c=!0),g=a&&n.detachedRuleset()||n.expression(),!g){if(!a)return o.restore(),j.args=[],j;l("could not understand value for named argument")}f=d=q.name}else{if(!a&&o.$re(/^\.{3}/)){j.variadic=!0,o.$char(";")&&!b&&(b=!0),(b?m:p).push({name:h.name,variadic:!0});break}a||(d=f=q.name,g=null)}g&&k.push(g),p.push({name:f,value:g}),o.$char(",")||(o.$char(";")||b)&&(c&&l("Cannot mix ; and , as delimiter types"),b=!0,k.length>1&&(g=new e.Value(k)),m.push({name:d,value:g}),d=null,k=[],c=!1)}return o.forget(),j.args=b?m:p,j},definition:function(){var a,b,c,d,f=[],g=!1;if(!("."!==o.currentChar()&&"#"!==o.currentChar()||o.peek(/^[^{]*\}/)))if(o.save(),b=o.$re(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/)){a=b[1];var h=this.args(!1);if(f=h.args,g=h.variadic,!o.$char(")"))return void o.restore("Missing closing ')'");if(o.commentStore.length=0,o.$re(/^when/)&&(d=i(n.conditions,"expected condition")),c=n.block())return o.forget(),new e.mixin.Definition(a,f,c,d,g);o.restore()}else o.forget()}},entity:function(){var a=this.entities;return this.comment()||a.literal()||a.variable()||a.url()||a.call()||a.keyword()||a.javascript()},end:function(){return o.$char(";")||o.peek("}")},alpha:function(){var a;if(o.$re(/^opacity=/i))return a=o.$re(/^\d+/),a||(a=i(this.entities.variable,"Could not parse alpha")),k(")"),new e.Alpha(a)},element:function(){var a,b,d,f=o.i;return b=this.combinator(),a=o.$re(/^(?:\d+\.\d+|\d+)%/)||o.$re(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||o.$char("*")||o.$char("&")||this.attribute()||o.$re(/^\([^&()@]+\)/)||o.$re(/^[\.#:](?=@)/)||this.entities.variableCurly(),a||(o.save(),o.$char("(")?(d=this.selector())&&o.$char(")")?(a=new e.Paren(d),o.forget()):o.restore("Missing closing ')'"):o.forget()),a?new e.Element(b,a,f,c):void 0},combinator:function(){var a=o.currentChar();if("/"===a){o.save();var b=o.$re(/^\/[a-z]+\//i);if(b)return o.forget(),new e.Combinator(b);o.restore()}if(">"===a||"+"===a||"~"===a||"|"===a||"^"===a){for(o.i++,"^"===a&&"^"===o.currentChar()&&(a="^^",o.i++);o.isWhitespace();)o.i++;return new e.Combinator(a)}return o.isWhitespace(-1)?new e.Combinator(" "):new e.Combinator(null)},lessSelector:function(){return this.selector(!0)},selector:function(a){for(var b,d,f,g,h,j,k,m=o.i;(a&&(d=this.extend())||a&&(j=o.$re(/^when/))||(g=this.element()))&&(j?k=i(this.conditions,"expected condition"):k?l("CSS guard can only be used at the end of selector"):d?h=h?h.concat(d):d:(h&&l("Extend can only be used at the end of selector"),f=o.currentChar(),b?b.push(g):b=[g],g=null),"{"!==f&&"}"!==f&&";"!==f&&","!==f&&")"!==f););return b?new e.Selector(b,h,k,m,c):void(h&&l("Extend must be used to extend a selector, it cannot be used on its own"))},attribute:function(){if(o.$char("[")){var a,b,c,d=this.entities;return(a=d.variableCurly())||(a=i(/^(?:[_A-Za-z0-9-\*]*\|)?(?:[_A-Za-z0-9-]|\\.)+/)),c=o.$re(/^[|~*$^]?=/),c&&(b=d.quoted()||o.$re(/^[0-9]+%/)||o.$re(/^[\w-]+/)||d.variableCurly()),k("]"),new e.Attribute(a,c,b)}},block:function(){var a;return o.$char("{")&&(a=this.primary())&&o.$char("}")?a:void 0},blockRuleset:function(){var a=this.block();return a&&(a=new e.Ruleset(null,a)),a},detachedRuleset:function(){var a=this.blockRuleset();return a?new e.DetachedRuleset(a):void 0},ruleset:function(){var b,c,d,f;for(o.save(),a.dumpLineNumbers&&(f=m(o.i));;){if(c=this.lessSelector(),!c)break;if(b?b.push(c):b=[c],o.commentStore.length=0,c.condition&&b.length>1&&l("Guards are only currently allowed on a single selector."),!o.$char(","))break;c.condition&&l("Guards are only currently allowed on a single selector."),o.commentStore.length=0}if(b&&(d=this.block())){o.forget();var g=new e.Ruleset(b,d,a.strictImports);return a.dumpLineNumbers&&(g.debugInfo=f),g}o.restore()},rule:function(b){var d,f,g,h,i,j=o.i,k=o.currentChar();if("."!==k&&"#"!==k&&"&"!==k)if(o.save(),d=this.variable()||this.ruleProperty()){if(i="string"==typeof d,i&&(f=this.detachedRuleset()),o.commentStore.length=0,!f){h=!i&&d.pop().value;var l=!b&&(a.compress||i);if(l&&(f=this.value()),!f&&(f=this.anonymousValue()))return o.forget(),new e.Rule(d,f,!1,h,j,c);l||f||(f=this.value()),g=this.important()}if(f&&this.end())return o.forget(),new e.Rule(d,f,g,h,j,c);if(o.restore(),f&&!b)return this.rule(!0)}else o.forget()},anonymousValue:function(){var a=o.$re(/^([^@+\/'"*`(;{}-]*);/);return a?new e.Anonymous(a[1]):void 0},"import":function(){var a,b,d=o.i,f=o.$re(/^@import?\s+/);if(f){var g=(f?this.importOptions():null)||{};if(a=this.entities.quoted()||this.entities.url())return b=this.mediaFeatures(),o.$(";")||(o.i=d,l("missing semi-colon or unrecognised media features on import")),b=b&&new e.Value(b),new e.Import(a,b,g,d,c);o.i=d,l("malformed import statement")}},importOptions:function(){var a,b,c,d={};if(!o.$char("("))return null;do if(a=this.importOption()){switch(b=a,c=!0,b){case"css":b="less",c=!1;break;case"once":b="multiple",c=!1}if(d[b]=c,!o.$char(","))break}while(a);return k(")"),d},importOption:function(){var a=o.$re(/^(less|css|multiple|once|inline|reference|optional)/);return a?a[1]:void 0},mediaFeature:function(){var a,b,d=this.entities,f=[];o.save();do if(a=d.keyword()||d.variable())f.push(a);else if(o.$char("(")){if(b=this.property(),a=this.value(),!o.$char(")"))return o.restore("Missing closing ')'"),null;if(b&&a)f.push(new e.Paren(new e.Rule(b,a,null,null,o.i,c,!0)));else{if(!a)return o.restore("badly formed media feature definition"),null;f.push(new e.Paren(a))}}while(a);return o.forget(),f.length>0?new e.Expression(f):void 0},mediaFeatures:function(){var a,b=this.entities,c=[];do if(a=this.mediaFeature()){if(c.push(a),!o.$char(","))break}else if(a=b.variable(),a&&(c.push(a),!o.$char(",")))break;while(a);return c.length>0?c:null},media:function(){var b,d,f,g;return a.dumpLineNumbers&&(g=m(o.i)),o.$re(/^@media/)&&(b=this.mediaFeatures(),d=this.block())?(f=new e.Media(d,b,o.i,c),a.dumpLineNumbers&&(f.debugInfo=g),f):void 0},directive:function(){var b,d,f,g,h,i,j,k=o.i,n=!0;if("@"===o.currentChar()){if(d=this["import"]()||this.media())return d;if(o.save(),b=o.$re(/^@[a-z-]+/)){switch(g=b,"-"==b.charAt(1)&&b.indexOf("-",2)>0&&(g="@"+b.slice(b.indexOf("-",2)+1)),g){case"@counter-style":h=!0,n=!0;break;case"@charset":h=!0,n=!1;break;case"@namespace":i=!0,n=!1;break;case"@keyframes":h=!0;break;case"@host":case"@page":case"@document":case"@supports":j=!0}return o.commentStore.length=0,h?(d=this.entity(),d||l("expected "+b+" identifier")):i?(d=this.expression(),d||l("expected "+b+" expression")):j&&(d=(o.$re(/^[^{;]+/)||"").trim(),d&&(d=new e.Anonymous(d))),n&&(f=this.blockRuleset()),f||!n&&d&&o.$char(";")?(o.forget(),new e.Directive(b,d,f,k,c,a.dumpLineNumbers?m(k):null)):void o.restore("directive options not recognised")}}},value:function(){var a,b=[];do if(a=this.expression(),a&&(b.push(a),!o.$char(",")))break;while(a);return b.length>0?new e.Value(b):void 0},important:function(){return"!"===o.currentChar()?o.$re(/^! *important/):void 0},sub:function(){var a,b;return o.save(),o.$char("(")?(a=this.addition(),a&&o.$char(")")?(o.forget(),b=new e.Expression([a]),b.parens=!0,b):void o.restore("Expected ')'")):void o.restore()},multiplication:function(){var a,b,c,d,f;if(a=this.operand()){for(f=o.isWhitespace(-1);;){if(o.peek(/^\/[*\/]/))break;if(o.save(),c=o.$char("/")||o.$char("*"),!c){o.forget();break}if(b=this.operand(),!b){o.restore();break}o.forget(),a.parensInOp=!0,b.parensInOp=!0,d=new e.Operation(c,[d||a,b],f),f=o.isWhitespace(-1)}return d||a}},addition:function(){var a,b,c,d,f;if(a=this.multiplication()){for(f=o.isWhitespace(-1);;){if(c=o.$re(/^[-+]\s+/)||!f&&(o.$char("+")||o.$char("-")),!c)break;if(b=this.multiplication(),!b)break;a.parensInOp=!0,b.parensInOp=!0,d=new e.Operation(c,[d||a,b],f),f=o.isWhitespace(-1)}return d||a}},conditions:function(){var a,b,c,d=o.i;if(a=this.condition()){for(;;){if(!o.peek(/^,\s*(not\s*)?\(/)||!o.$char(","))break;if(b=this.condition(),!b)break;c=new e.Condition("or",c||a,b,d)}return c||a}},condition:function(){var a,b,c,d,f=this.entities,g=o.i,h=!1;return o.$re(/^not/)&&(h=!0),k("("),a=this.addition()||f.keyword()||f.quoted(),a?(d=o.$re(/^(?:>=|<=|=<|[<=>])/),d?(b=this.addition()||f.keyword()||f.quoted(),b?c=new e.Condition(d,a,b,g,h):l("expected expression")):c=new e.Condition("=",a,new e.Keyword("true"),g,h),k(")"),o.$re(/^and/)?new e.Condition("and",c,this.condition()):c):void 0},operand:function(){var a,b=this.entities;o.peek(/^-[@\(]/)&&(a=o.$char("-"));var c=this.sub()||b.dimension()||b.color()||b.variable()||b.call();return a&&(c.parensInOp=!0,c=new e.Negative(c)),c},expression:function(){var a,b,c=[];do a=this.comment(),a?c.push(a):(a=this.addition()||this.entity(),a&&(c.push(a),o.peek(/^\/[\/*]/)||(b=o.$char("/"),b&&c.push(new e.Anonymous(b)))));while(a);return c.length>0?new e.Expression(c):void 0},property:function(){var a=o.$re(/^(\*?-?[_a-zA-Z0-9-]+)\s*:/);return a?a[1]:void 0},ruleProperty:function(){function a(a){var b=o.i,c=o.$re(a);return c?(g.push(b),f.push(c[1])):void 0}var b,d,f=[],g=[];for(o.save(),a(/^(\*?)/);;)if(!a(/^((?:[\w-]+)|(?:@\{[\w-]+\}))/))break;if(f.length>1&&a(/^((?:\+_|\+)?)\s*:/)){for(o.forget(),""===f[0]&&(f.shift(),g.shift()),d=0;d<f.length;d++)b=f[d],f[d]="@"!==b.charAt(0)?new e.Keyword(b):new e.Variable("@"+b.slice(2,-1),g[d],c);return f}o.restore()}}}};i.serializeVars=function(a){var b="";for(var c in a)if(Object.hasOwnProperty.call(a,c)){var d=a[c];b+=("@"===c[0]?"":"@")+c+": "+d+(";"===String(d).slice(-1)?"":";")}return b},b.exports=i},{"../less-error":30,"../tree":59,"../utils":80,"../visitors":84,"./parser-input":35}],37:[function(a,b,c){var d=function(a){this.less=a,this.visitors=[],this.preProcessors=[],this.postProcessors=[],this.installedPlugins=[],this.fileManagers=[]};d.prototype.addPlugins=function(a){if(a)for(var b=0;b<a.length;b++)this.addPlugin(a[b])},d.prototype.addPlugin=function(a){this.installedPlugins.push(a),a.install(this.less,this)},d.prototype.addVisitor=function(a){this.visitors.push(a)},d.prototype.addPreProcessor=function(a,b){var c;for(c=0;c<this.preProcessors.length&&!(this.preProcessors[c].priority>=b);c++);this.preProcessors.splice(c,0,{preProcessor:a,priority:b})},d.prototype.addPostProcessor=function(a,b){var c;for(c=0;c<this.postProcessors.length&&!(this.postProcessors[c].priority>=b);c++);this.postProcessors.splice(c,0,{postProcessor:a,priority:b})},d.prototype.addFileManager=function(a){this.fileManagers.push(a)},d.prototype.getPreProcessors=function(){for(var a=[],b=0;b<this.preProcessors.length;b++)a.push(this.preProcessors[b].preProcessor);return a},d.prototype.getPostProcessors=function(){for(var a=[],b=0;b<this.postProcessors.length;b++)a.push(this.postProcessors[b].postProcessor);return a},d.prototype.getVisitors=function(){return this.visitors},d.prototype.getFileManagers=function(){return this.fileManagers},b.exports=d},{}],38:[function(a,b,c){var d;b.exports=function(b,c,e){var f=function(b,e,g){if("function"==typeof e&&(g=e,e={}),!g){d||(d="undefined"==typeof Promise?a("promise"):Promise);var h=this;return new d(function(a,c){f.call(h,b,e,function(b,d){b?c(b):a(d)})})}this.parse(b,e,function(a,b,d,e){if(a)return g(a);var f;try{var h=new c(b,d);f=h.toCSS(e)}catch(a){return g(a)}g(null,f)})};return f}},{promise:void 0}],39:[function(a,b,c){b.exports=function(a,b){var c=function(a){this.options=a};return c.prototype.toCSS=function(b,c,d){var e=new a({contentsIgnoredCharsMap:d.contentsIgnoredChars,rootNode:b,contentsMap:d.contents,sourceMapFilename:this.options.sourceMapFilename,sourceMapURL:this.options.sourceMapURL,outputFilename:this.options.sourceMapOutputFilename,sourceMapBasepath:this.options.sourceMapBasepath,sourceMapRootpath:this.options.sourceMapRootpath,outputSourceFiles:this.options.outputSourceFiles,sourceMapGenerator:this.options.sourceMapGenerator,sourceMapFileInline:this.options.sourceMapFileInline}),f=e.toCSS(c);return this.sourceMap=e.sourceMap,this.sourceMapURL=e.sourceMapURL,this.options.sourceMapInputFilename&&(this.sourceMapInputFilename=e.normalizeFilename(this.options.sourceMapInputFilename)),f+this.getCSSAppendage()},c.prototype.getCSSAppendage=function(){var a=this.sourceMapURL;if(this.options.sourceMapFileInline){if(void 0===this.sourceMap)return"";a="data:application/json;base64,"+b.encodeBase64(this.sourceMap)}return a?"/*# sourceMappingURL="+a+" */":""},c.prototype.getExternalSourceMap=function(){return this.sourceMap},c.prototype.setExternalSourceMap=function(a){this.sourceMap=a},c.prototype.isInline=function(){return this.options.sourceMapFileInline},c.prototype.getSourceMapURL=function(){return this.sourceMapURL},c.prototype.getOutputFilename=function(){return this.options.sourceMapOutputFilename},c.prototype.getInputFilename=function(){return this.sourceMapInputFilename},c}},{}],40:[function(a,b,c){b.exports=function(a){var b=function(b){this._css=[],this._rootNode=b.rootNode,this._contentsMap=b.contentsMap,this._contentsIgnoredCharsMap=b.contentsIgnoredCharsMap,b.sourceMapFilename&&(this._sourceMapFilename=b.sourceMapFilename.replace(/\\/g,"/")),this._outputFilename=b.outputFilename,this.sourceMapURL=b.sourceMapURL,b.sourceMapBasepath&&(this._sourceMapBasepath=b.sourceMapBasepath.replace(/\\/g,"/")),b.sourceMapRootpath?(this._sourceMapRootpath=b.sourceMapRootpath.replace(/\\/g,"/"),"/"!==this._sourceMapRootpath.charAt(this._sourceMapRootpath.length-1)&&(this._sourceMapRootpath+="/")):this._sourceMapRootpath="",this._outputSourceFiles=b.outputSourceFiles,this._sourceMapGeneratorConstructor=a.getSourceMapGenerator(),this._lineNumber=0,this._column=0};return b.prototype.normalizeFilename=function(a){return a=a.replace(/\\/g,"/"),this._sourceMapBasepath&&0===a.indexOf(this._sourceMapBasepath)&&(a=a.substring(this._sourceMapBasepath.length),("\\"===a.charAt(0)||"/"===a.charAt(0))&&(a=a.substring(1))),(this._sourceMapRootpath||"")+a},b.prototype.add=function(a,b,c,d){if(a){var e,f,g,h,i;if(b){var j=this._contentsMap[b.filename];this._contentsIgnoredCharsMap[b.filename]&&(c-=this._contentsIgnoredCharsMap[b.filename],0>c&&(c=0),j=j.slice(this._contentsIgnoredCharsMap[b.filename])),j=j.substring(0,c),f=j.split("\n"),h=f[f.length-1]}if(e=a.split("\n"),g=e[e.length-1],b)if(d)for(i=0;i<e.length;i++)this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+i+1,column:0===i?this._column:0},original:{line:f.length+i,column:0===i?h.length:0},source:this.normalizeFilename(b.filename)});else this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+1,column:this._column},original:{line:f.length,column:h.length},source:this.normalizeFilename(b.filename)});1===e.length?this._column+=g.length:(this._lineNumber+=e.length-1,this._column=g.length),this._css.push(a)}},b.prototype.isEmpty=function(){return 0===this._css.length},b.prototype.toCSS=function(a){if(this._sourceMapGenerator=new this._sourceMapGeneratorConstructor({file:this._outputFilename,sourceRoot:null}),this._outputSourceFiles)for(var b in this._contentsMap)if(this._contentsMap.hasOwnProperty(b)){var c=this._contentsMap[b];this._contentsIgnoredCharsMap[b]&&(c=c.slice(this._contentsIgnoredCharsMap[b])),this._sourceMapGenerator.setSourceContent(this.normalizeFilename(b),c)}if(this._rootNode.genCSS(a,this),this._css.length>0){var d,e=JSON.stringify(this._sourceMapGenerator.toJSON());this.sourceMapURL?d=this.sourceMapURL:this._sourceMapFilename&&(d=this._sourceMapFilename),this.sourceMapURL=d,this.sourceMap=e}return this._css.join("")},b}},{}],41:[function(a,b,c){var d=a("./contexts"),e=a("./visitors"),f=a("./tree");b.exports=function(a,b){b=b||{};var c,g=b.variables,h=new d.Eval(b);
"object"!=typeof g||Array.isArray(g)||(g=Object.keys(g).map(function(a){var b=g[a];return b instanceof f.Value||(b instanceof f.Expression||(b=new f.Expression([b])),b=new f.Value([b])),new f.Rule("@"+a,b,!1,null,0)}),h.frames=[new f.Ruleset(null,g)]);var i,j=[],k=[new e.JoinSelectorVisitor,new e.ExtendVisitor,new e.ToCSSVisitor({compress:Boolean(b.compress)})];if(b.pluginManager){var l=b.pluginManager.getVisitors();for(i=0;i<l.length;i++){var m=l[i];m.isPreEvalVisitor?j.push(m):m.isPreVisitor?k.splice(0,0,m):k.push(m)}}for(i=0;i<j.length;i++)j[i].run(a);for(c=a.eval(h),i=0;i<k.length;i++)k[i].run(c);return c}},{"./contexts":10,"./tree":59,"./visitors":84}],42:[function(a,b,c){var d=a("./node"),e=function(a){this.value=a};e.prototype=new d,e.prototype.type="Alpha",e.prototype.accept=function(a){this.value=a.visit(this.value)},e.prototype.eval=function(a){return this.value.eval?new e(this.value.eval(a)):this},e.prototype.genCSS=function(a,b){b.add("alpha(opacity="),this.value.genCSS?this.value.genCSS(a,b):b.add(this.value),b.add(")")},b.exports=e},{"./node":67}],43:[function(a,b,c){var d=a("./node"),e=function(a,b,c,d,e){this.value=a,this.index=b,this.mapLines=d,this.currentFileInfo=c,this.rulesetLike="undefined"==typeof e?!1:e};e.prototype=new d,e.prototype.type="Anonymous",e.prototype.eval=function(){return new e(this.value,this.index,this.currentFileInfo,this.mapLines,this.rulesetLike)},e.prototype.compare=function(a){return a.toCSS&&this.toCSS()===a.toCSS()?0:void 0},e.prototype.isRulesetLike=function(){return this.rulesetLike},e.prototype.genCSS=function(a,b){b.add(this.value,this.currentFileInfo,this.index,this.mapLines)},b.exports=e},{"./node":67}],44:[function(a,b,c){var d=a("./node"),e=function(a,b){this.key=a,this.value=b};e.prototype=new d,e.prototype.type="Assignment",e.prototype.accept=function(a){this.value=a.visit(this.value)},e.prototype.eval=function(a){return this.value.eval?new e(this.key,this.value.eval(a)):this},e.prototype.genCSS=function(a,b){b.add(this.key+"="),this.value.genCSS?this.value.genCSS(a,b):b.add(this.value)},b.exports=e},{"./node":67}],45:[function(a,b,c){var d=a("./node"),e=function(a,b,c){this.key=a,this.op=b,this.value=c};e.prototype=new d,e.prototype.type="Attribute",e.prototype.eval=function(a){return new e(this.key.eval?this.key.eval(a):this.key,this.op,this.value&&this.value.eval?this.value.eval(a):this.value)},e.prototype.genCSS=function(a,b){b.add(this.toCSS(a))},e.prototype.toCSS=function(a){var b=this.key.toCSS?this.key.toCSS(a):this.key;return this.op&&(b+=this.op,b+=this.value.toCSS?this.value.toCSS(a):this.value),"["+b+"]"},b.exports=e},{"./node":67}],46:[function(a,b,c){var d=a("./node"),e=a("../functions/function-caller"),f=function(a,b,c,d){this.name=a,this.args=b,this.index=c,this.currentFileInfo=d};f.prototype=new d,f.prototype.type="Call",f.prototype.accept=function(a){this.args&&(this.args=a.visitArray(this.args))},f.prototype.eval=function(a){var b,c=this.args.map(function(b){return b.eval(a)}),d=new e(this.name,a,this.index,this.currentFileInfo);if(d.isValid())try{if(b=d.call(c),null!=b)return b}catch(g){throw{type:g.type||"Runtime",message:"error evaluating function `"+this.name+"`"+(g.message?": "+g.message:""),index:this.index,filename:this.currentFileInfo.filename}}return new f(this.name,c,this.index,this.currentFileInfo)},f.prototype.genCSS=function(a,b){b.add(this.name+"(",this.currentFileInfo,this.index);for(var c=0;c<this.args.length;c++)this.args[c].genCSS(a,b),c+1<this.args.length&&b.add(", ");b.add(")")},b.exports=f},{"../functions/function-caller":20,"./node":67}],47:[function(a,b,c){function d(a,b){return Math.min(Math.max(a,0),b)}function e(a){return"#"+a.map(function(a){return a=d(Math.round(a),255),(16>a?"0":"")+a.toString(16)}).join("")}var f=a("./node"),g=a("../data/colors"),h=function(a,b){Array.isArray(a)?this.rgb=a:6==a.length?this.rgb=a.match(/.{2}/g).map(function(a){return parseInt(a,16)}):this.rgb=a.split("").map(function(a){return parseInt(a+a,16)}),this.alpha="number"==typeof b?b:1};h.prototype=new f,h.prototype.type="Color",h.prototype.luma=function(){var a=this.rgb[0]/255,b=this.rgb[1]/255,c=this.rgb[2]/255;return a=.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4),b=.03928>=b?b/12.92:Math.pow((b+.055)/1.055,2.4),c=.03928>=c?c/12.92:Math.pow((c+.055)/1.055,2.4),.2126*a+.7152*b+.0722*c},h.prototype.genCSS=function(a,b){b.add(this.toCSS(a))},h.prototype.toCSS=function(a,b){var c,e,f=a&&a.compress&&!b;if(this.value)return this.value;if(e=this.fround(a,this.alpha),1>e)return"rgba("+this.rgb.map(function(a){return d(Math.round(a),255)}).concat(d(e,1)).join(","+(f?"":" "))+")";if(c=this.toRGB(),f){var g=c.split("");g[1]===g[2]&&g[3]===g[4]&&g[5]===g[6]&&(c="#"+g[1]+g[3]+g[5])}return c},h.prototype.operate=function(a,b,c){for(var d=[],e=this.alpha*(1-c.alpha)+c.alpha,f=0;3>f;f++)d[f]=this._operate(a,b,this.rgb[f],c.rgb[f]);return new h(d,e)},h.prototype.toRGB=function(){return e(this.rgb)},h.prototype.toHSL=function(){var a,b,c=this.rgb[0]/255,d=this.rgb[1]/255,e=this.rgb[2]/255,f=this.alpha,g=Math.max(c,d,e),h=Math.min(c,d,e),i=(g+h)/2,j=g-h;if(g===h)a=b=0;else{switch(b=i>.5?j/(2-g-h):j/(g+h),g){case c:a=(d-e)/j+(e>d?6:0);break;case d:a=(e-c)/j+2;break;case e:a=(c-d)/j+4}a/=6}return{h:360*a,s:b,l:i,a:f}},h.prototype.toHSV=function(){var a,b,c=this.rgb[0]/255,d=this.rgb[1]/255,e=this.rgb[2]/255,f=this.alpha,g=Math.max(c,d,e),h=Math.min(c,d,e),i=g,j=g-h;if(b=0===g?0:j/g,g===h)a=0;else{switch(g){case c:a=(d-e)/j+(e>d?6:0);break;case d:a=(e-c)/j+2;break;case e:a=(c-d)/j+4}a/=6}return{h:360*a,s:b,v:i,a:f}},h.prototype.toARGB=function(){return e([255*this.alpha].concat(this.rgb))},h.prototype.compare=function(a){return a.rgb&&a.rgb[0]===this.rgb[0]&&a.rgb[1]===this.rgb[1]&&a.rgb[2]===this.rgb[2]&&a.alpha===this.alpha?0:void 0},h.fromKeyword=function(a){var b,c=a.toLowerCase();return g.hasOwnProperty(c)?b=new h(g[c].slice(1)):"transparent"===c&&(b=new h([0,0,0],0)),b?(b.value=a,b):void 0},b.exports=h},{"../data/colors":11,"./node":67}],48:[function(a,b,c){var d=a("./node"),e=function(a){" "===a?(this.value=" ",this.emptyOrWhitespace=!0):(this.value=a?a.trim():"",this.emptyOrWhitespace=""===this.value)};e.prototype=new d,e.prototype.type="Combinator";var f={"":!0," ":!0,"|":!0};e.prototype.genCSS=function(a,b){var c=a.compress||f[this.value]?"":" ";b.add(c+this.value+c)},b.exports=e},{"./node":67}],49:[function(a,b,c){var d=a("./node"),e=a("./debug-info"),f=function(a,b,c,d){this.value=a,this.isLineComment=b,this.currentFileInfo=d};f.prototype=new d,f.prototype.type="Comment",f.prototype.genCSS=function(a,b){this.debugInfo&&b.add(e(a,this),this.currentFileInfo,this.index),b.add(this.value)},f.prototype.isSilent=function(a){var b=this.currentFileInfo&&this.currentFileInfo.reference&&!this.isReferenced,c=a.compress&&"!"!==this.value[2];return this.isLineComment||b||c},f.prototype.markReferenced=function(){this.isReferenced=!0},f.prototype.isRulesetLike=function(a){return Boolean(a)},b.exports=f},{"./debug-info":51,"./node":67}],50:[function(a,b,c){var d=a("./node"),e=function(a,b,c,d,e){this.op=a.trim(),this.lvalue=b,this.rvalue=c,this.index=d,this.negate=e};e.prototype=new d,e.prototype.type="Condition",e.prototype.accept=function(a){this.lvalue=a.visit(this.lvalue),this.rvalue=a.visit(this.rvalue)},e.prototype.eval=function(a){var b=function(a,b,c){switch(a){case"and":return b&&c;case"or":return b||c;default:switch(d.compare(b,c)){case-1:return"<"===a||"=<"===a||"<="===a;case 0:return"="===a||">="===a||"=<"===a||"<="===a;case 1:return">"===a||">="===a;default:return!1}}}(this.op,this.lvalue.eval(a),this.rvalue.eval(a));return this.negate?!b:b},b.exports=e},{"./node":67}],51:[function(a,b,c){var d=function(a,b,c){var e="";if(a.dumpLineNumbers&&!a.compress)switch(a.dumpLineNumbers){case"comments":e=d.asComment(b);break;case"mediaquery":e=d.asMediaQuery(b);break;case"all":e=d.asComment(b)+(c||"")+d.asMediaQuery(b)}return e};d.asComment=function(a){return"/* line "+a.debugInfo.lineNumber+", "+a.debugInfo.fileName+" */\n"},d.asMediaQuery=function(a){var b=a.debugInfo.fileName;return/^[a-z]+:\/\//i.test(b)||(b="file://"+b),"@media -sass-debug-info{filename{font-family:"+b.replace(/([.:\/\\])/g,function(a){return"\\"==a&&(a="/"),"\\"+a})+"}line{font-family:\\00003"+a.debugInfo.lineNumber+"}}\n"},b.exports=d},{}],52:[function(a,b,c){var d=a("./node"),e=a("../contexts"),f=function(a,b){this.ruleset=a,this.frames=b};f.prototype=new d,f.prototype.type="DetachedRuleset",f.prototype.evalFirst=!0,f.prototype.accept=function(a){this.ruleset=a.visit(this.ruleset)},f.prototype.eval=function(a){var b=this.frames||a.frames.slice(0);return new f(this.ruleset,b)},f.prototype.callEval=function(a){return this.ruleset.eval(this.frames?new e.Eval(a,this.frames.concat(a.frames)):a)},b.exports=f},{"../contexts":10,"./node":67}],53:[function(a,b,c){var d=a("./node"),e=a("../data/unit-conversions"),f=a("./unit"),g=a("./color"),h=function(a,b){this.value=parseFloat(a),this.unit=b&&b instanceof f?b:new f(b?[b]:void 0)};h.prototype=new d,h.prototype.type="Dimension",h.prototype.accept=function(a){this.unit=a.visit(this.unit)},h.prototype.eval=function(a){return this},h.prototype.toColor=function(){return new g([this.value,this.value,this.value])},h.prototype.genCSS=function(a,b){if(a&&a.strictUnits&&!this.unit.isSingular())throw new Error("Multiple units in dimension. Correct the units or use the unit function. Bad unit: "+this.unit.toString());var c=this.fround(a,this.value),d=String(c);if(0!==c&&1e-6>c&&c>-1e-6&&(d=c.toFixed(20).replace(/0+$/,"")),a&&a.compress){if(0===c&&this.unit.isLength())return void b.add(d);c>0&&1>c&&(d=d.substr(1))}b.add(d),this.unit.genCSS(a,b)},h.prototype.operate=function(a,b,c){var d=this._operate(a,b,this.value,c.value),e=this.unit.clone();if("+"===b||"-"===b)if(0===e.numerator.length&&0===e.denominator.length)e.numerator=c.unit.numerator.slice(0),e.denominator=c.unit.denominator.slice(0);else if(0===c.unit.numerator.length&&0===e.denominator.length);else{if(c=c.convertTo(this.unit.usedUnits()),a.strictUnits&&c.unit.toString()!==e.toString())throw new Error("Incompatible units. Change the units or use the unit function. Bad units: '"+e.toString()+"' and '"+c.unit.toString()+"'.");d=this._operate(a,b,this.value,c.value)}else"*"===b?(e.numerator=e.numerator.concat(c.unit.numerator).sort(),e.denominator=e.denominator.concat(c.unit.denominator).sort(),e.cancel()):"/"===b&&(e.numerator=e.numerator.concat(c.unit.denominator).sort(),e.denominator=e.denominator.concat(c.unit.numerator).sort(),e.cancel());return new h(d,e)},h.prototype.compare=function(a){var b,c;if(!(a instanceof h))return void 0;if(this.unit.isEmpty()||a.unit.isEmpty())b=this,c=a;else if(b=this.unify(),c=a.unify(),0!==b.unit.compare(c.unit))return void 0;return d.numericCompare(b.value,c.value)},h.prototype.unify=function(){return this.convertTo({length:"px",duration:"s",angle:"rad"})},h.prototype.convertTo=function(a){var b,c,d,f,g,i=this.value,j=this.unit.clone(),k={};if("string"==typeof a){for(b in e)e[b].hasOwnProperty(a)&&(k={},k[b]=a);a=k}g=function(a,b){return d.hasOwnProperty(a)?(b?i/=d[a]/d[f]:i*=d[a]/d[f],f):a};for(c in a)a.hasOwnProperty(c)&&(f=a[c],d=e[c],j.map(g));return j.cancel(),new h(i,j)},b.exports=h},{"../data/unit-conversions":13,"./color":47,"./node":67,"./unit":76}],54:[function(a,b,c){var d=a("./node"),e=a("./ruleset"),f=function(a,b,c,d,e,f,g){this.name=a,this.value=b,c&&(this.rules=c,this.rules.allowImports=!0),this.index=d,this.currentFileInfo=e,this.debugInfo=f,this.isReferenced=g};f.prototype=new d,f.prototype.type="Directive",f.prototype.accept=function(a){var b=this.value,c=this.rules;c&&(this.rules=a.visit(c)),b&&(this.value=a.visit(b))},f.prototype.isRulesetLike=function(){return this.rules||!this.isCharset()},f.prototype.isCharset=function(){return"@charset"===this.name},f.prototype.genCSS=function(a,b){var c=this.value,d=this.rules;b.add(this.name,this.currentFileInfo,this.index),c&&(b.add(" "),c.genCSS(a,b)),d?("Ruleset"===d.type&&(d=[d]),this.outputRuleset(a,b,d)):b.add(";")},f.prototype.eval=function(a){var b=this.value,c=this.rules;return b&&(b=b.eval(a)),c&&(c=c.eval(a),c.root=!0),new f(this.name,b,c,this.index,this.currentFileInfo,this.debugInfo,this.isReferenced)},f.prototype.variable=function(a){return this.rules?e.prototype.variable.call(this.rules,a):void 0},f.prototype.find=function(){return this.rules?e.prototype.find.apply(this.rules,arguments):void 0},f.prototype.rulesets=function(){return this.rules?e.prototype.rulesets.apply(this.rules):void 0},f.prototype.markReferenced=function(){var a,b;if(this.isReferenced=!0,this.rules)for(b=this.rules.rules,a=0;a<b.length;a++)b[a].markReferenced&&b[a].markReferenced()},f.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},f.prototype.outputRuleset=function(a,b,c){var d,e=c.length;if(a.tabLevel=(0|a.tabLevel)+1,a.compress){for(b.add("{"),d=0;e>d;d++)c[d].genCSS(a,b);return b.add("}"),void a.tabLevel--}var f="\n"+Array(a.tabLevel).join("  "),g=f+"  ";if(e){for(b.add(" {"+g),c[0].genCSS(a,b),d=1;e>d;d++)b.add(g),c[d].genCSS(a,b);b.add(f+"}")}else b.add(" {"+f+"}");a.tabLevel--},b.exports=f},{"./node":67,"./ruleset":73}],55:[function(a,b,c){var d=a("./node"),e=a("./paren"),f=a("./combinator"),g=function(a,b,c,d){this.combinator=a instanceof f?a:new f(a),"string"==typeof b?this.value=b.trim():b?this.value=b:this.value="",this.index=c,this.currentFileInfo=d};g.prototype=new d,g.prototype.type="Element",g.prototype.accept=function(a){var b=this.value;this.combinator=a.visit(this.combinator),"object"==typeof b&&(this.value=a.visit(b))},g.prototype.eval=function(a){return new g(this.combinator,this.value.eval?this.value.eval(a):this.value,this.index,this.currentFileInfo)},g.prototype.genCSS=function(a,b){b.add(this.toCSS(a),this.currentFileInfo,this.index)},g.prototype.toCSS=function(a){a=a||{};var b=this.value,c=a.firstSelector;return b instanceof e&&(a.firstSelector=!0),b=b.toCSS?b.toCSS(a):b,a.firstSelector=c,""===b&&"&"===this.combinator.value.charAt(0)?"":this.combinator.toCSS(a)+b},b.exports=g},{"./combinator":48,"./node":67,"./paren":69}],56:[function(a,b,c){var d=a("./node"),e=a("./paren"),f=a("./comment"),g=function(a){if(this.value=a,!a)throw new Error("Expression requires an array parameter")};g.prototype=new d,g.prototype.type="Expression",g.prototype.accept=function(a){this.value=a.visitArray(this.value)},g.prototype.eval=function(a){var b,c=this.parens&&!this.parensInOp,d=!1;return c&&a.inParenthesis(),this.value.length>1?b=new g(this.value.map(function(b){return b.eval(a)})):1===this.value.length?(this.value[0].parens&&!this.value[0].parensInOp&&(d=!0),b=this.value[0].eval(a)):b=this,c&&a.outOfParenthesis(),this.parens&&this.parensInOp&&!a.isMathOn()&&!d&&(b=new e(b)),b},g.prototype.genCSS=function(a,b){for(var c=0;c<this.value.length;c++)this.value[c].genCSS(a,b),c+1<this.value.length&&b.add(" ")},g.prototype.throwAwayComments=function(){this.value=this.value.filter(function(a){return!(a instanceof f)})},b.exports=g},{"./comment":49,"./node":67,"./paren":69}],57:[function(a,b,c){var d=a("./node"),e=function f(a,b,c){switch(this.selector=a,this.option=b,this.index=c,this.object_id=f.next_id++,this.parent_ids=[this.object_id],b){case"all":this.allowBefore=!0,this.allowAfter=!0;break;default:this.allowBefore=!1,this.allowAfter=!1}};e.next_id=0,e.prototype=new d,e.prototype.type="Extend",e.prototype.accept=function(a){this.selector=a.visit(this.selector)},e.prototype.eval=function(a){return new e(this.selector.eval(a),this.option,this.index)},e.prototype.clone=function(a){return new e(this.selector,this.option,this.index)},e.prototype.findSelfSelectors=function(a){var b,c,d=[];for(b=0;b<a.length;b++)c=a[b].elements,b>0&&c.length&&""===c[0].combinator.value&&(c[0].combinator.value=" "),d=d.concat(a[b].elements);this.selfSelectors=[{elements:d}]},b.exports=e},{"./node":67}],58:[function(a,b,c){var d=a("./node"),e=a("./media"),f=a("./url"),g=a("./quoted"),h=a("./ruleset"),i=a("./anonymous"),j=function(a,b,c,d,e){if(this.options=c,this.index=d,this.path=a,this.features=b,this.currentFileInfo=e,void 0!==this.options.less||this.options.inline)this.css=!this.options.less||this.options.inline;else{var f=this.getPath();f&&/[#\.\&\?\/]css([\?;].*)?$/.test(f)&&(this.css=!0)}};j.prototype=new d,j.prototype.type="Import",j.prototype.accept=function(a){this.features&&(this.features=a.visit(this.features)),this.path=a.visit(this.path),!this.options.inline&&this.root&&(this.root=a.visit(this.root))},j.prototype.genCSS=function(a,b){this.css&&(b.add("@import ",this.currentFileInfo,this.index),this.path.genCSS(a,b),this.features&&(b.add(" "),this.features.genCSS(a,b)),b.add(";"))},j.prototype.getPath=function(){return this.path instanceof g?this.path.value:this.path instanceof f?this.path.value.value:null},j.prototype.isVariableImport=function(){var a=this.path;return a instanceof f&&(a=a.value),a instanceof g?a.containsVariables():!0},j.prototype.evalForImport=function(a){var b=this.path;return b instanceof f&&(b=b.value),new j(b.eval(a),this.features,this.options,this.index,this.currentFileInfo)},j.prototype.evalPath=function(a){var b=this.path.eval(a),c=this.currentFileInfo&&this.currentFileInfo.rootpath;if(!(b instanceof f)){if(c){var d=b.value;d&&a.isPathRelative(d)&&(b.value=c+d)}b.value=a.normalizePath(b.value)}return b},j.prototype.eval=function(a){var b,c=this.features&&this.features.eval(a);if(this.skip&&("function"==typeof this.skip&&(this.skip=this.skip()),this.skip))return[];if(this.options.inline){var d=new i(this.root,0,{filename:this.importedFilename},!0,!0);return this.features?new e([d],this.features.value):[d]}if(this.css){var f=new j(this.evalPath(a),c,this.options,this.index);if(!f.css&&this.error)throw this.error;return f}return b=new h(null,this.root.rules.slice(0)),b.evalImports(a),this.features?new e(b.rules,this.features.value):b.rules},b.exports=j},{"./anonymous":43,"./media":63,"./node":67,"./quoted":70,"./ruleset":73,"./url":77}],59:[function(a,b,c){var d={};d.Node=a("./node"),d.Alpha=a("./alpha"),d.Color=a("./color"),d.Directive=a("./directive"),d.DetachedRuleset=a("./detached-ruleset"),d.Operation=a("./operation"),d.Dimension=a("./dimension"),d.Unit=a("./unit"),d.Keyword=a("./keyword"),d.Variable=a("./variable"),d.Ruleset=a("./ruleset"),d.Element=a("./element"),d.Attribute=a("./attribute"),d.Combinator=a("./combinator"),d.Selector=a("./selector"),d.Quoted=a("./quoted"),d.Expression=a("./expression"),d.Rule=a("./rule"),d.Call=a("./call"),d.URL=a("./url"),d.Import=a("./import"),d.mixin={Call:a("./mixin-call"),Definition:a("./mixin-definition")},d.Comment=a("./comment"),d.Anonymous=a("./anonymous"),d.Value=a("./value"),d.JavaScript=a("./javascript"),d.Assignment=a("./assignment"),d.Condition=a("./condition"),d.Paren=a("./paren"),d.Media=a("./media"),d.UnicodeDescriptor=a("./unicode-descriptor"),d.Negative=a("./negative"),d.Extend=a("./extend"),d.RulesetCall=a("./ruleset-call"),b.exports=d},{"./alpha":42,"./anonymous":43,"./assignment":44,"./attribute":45,"./call":46,"./color":47,"./combinator":48,"./comment":49,"./condition":50,"./detached-ruleset":52,"./dimension":53,"./directive":54,"./element":55,"./expression":56,"./extend":57,"./import":58,"./javascript":60,"./keyword":62,"./media":63,"./mixin-call":64,"./mixin-definition":65,"./negative":66,"./node":67,"./operation":68,"./paren":69,"./quoted":70,"./rule":71,"./ruleset":73,"./ruleset-call":72,"./selector":74,"./unicode-descriptor":75,"./unit":76,"./url":77,"./value":78,"./variable":79}],60:[function(a,b,c){var d=a("./js-eval-node"),e=a("./dimension"),f=a("./quoted"),g=a("./anonymous"),h=function(a,b,c,d){this.escaped=b,this.expression=a,this.index=c,this.currentFileInfo=d};h.prototype=new d,h.prototype.type="JavaScript",h.prototype.eval=function(a){var b=this.evaluateJavaScript(this.expression,a);return"number"==typeof b?new e(b):"string"==typeof b?new f('"'+b+'"',b,this.escaped,this.index):new g(Array.isArray(b)?b.join(", "):b)},b.exports=h},{"./anonymous":43,"./dimension":53,"./js-eval-node":61,"./quoted":70}],61:[function(a,b,c){var d=a("./node"),e=a("./variable"),f=function(){};f.prototype=new d,f.prototype.evaluateJavaScript=function(a,b){var c,d=this,f={};if(void 0!==b.javascriptEnabled&&!b.javascriptEnabled)throw{message:"You are using JavaScript, which has been disabled.",filename:this.currentFileInfo.filename,index:this.index};a=a.replace(/@\{([\w-]+)\}/g,function(a,c){return d.jsify(new e("@"+c,d.index,d.currentFileInfo).eval(b))});try{a=new Function("return ("+a+")")}catch(g){throw{message:"JavaScript evaluation error: "+g.message+" from `"+a+"`",filename:this.currentFileInfo.filename,index:this.index}}var h=b.frames[0].variables();for(var i in h)h.hasOwnProperty(i)&&(f[i.slice(1)]={value:h[i].value,toJS:function(){return this.value.eval(b).toCSS()}});try{c=a.call(f)}catch(g){throw{message:"JavaScript evaluation error: '"+g.name+": "+g.message.replace(/["]/g,"'")+"'",filename:this.currentFileInfo.filename,index:this.index}}return c},f.prototype.jsify=function(a){return Array.isArray(a.value)&&a.value.length>1?"["+a.value.map(function(a){return a.toCSS()}).join(", ")+"]":a.toCSS()},b.exports=f},{"./node":67,"./variable":79}],62:[function(a,b,c){var d=a("./node"),e=function(a){this.value=a};e.prototype=new d,e.prototype.type="Keyword",e.prototype.genCSS=function(a,b){if("%"===this.value)throw{type:"Syntax",message:"Invalid % without number"};b.add(this.value)},e.True=new e("true"),e.False=new e("false"),b.exports=e},{"./node":67}],63:[function(a,b,c){var d=a("./ruleset"),e=a("./value"),f=a("./element"),g=a("./selector"),h=a("./anonymous"),i=a("./expression"),j=a("./directive"),k=function(a,b,c,f){this.index=c,this.currentFileInfo=f;var g=this.emptySelectors();this.features=new e(b),this.rules=[new d(g,a)],this.rules[0].allowImports=!0};k.prototype=new j,k.prototype.type="Media",k.prototype.isRulesetLike=!0,k.prototype.accept=function(a){this.features&&(this.features=a.visit(this.features)),this.rules&&(this.rules=a.visitArray(this.rules))},k.prototype.genCSS=function(a,b){b.add("@media ",this.currentFileInfo,this.index),this.features.genCSS(a,b),this.outputRuleset(a,b,this.rules)},k.prototype.eval=function(a){a.mediaBlocks||(a.mediaBlocks=[],a.mediaPath=[]);var b=new k(null,[],this.index,this.currentFileInfo);this.debugInfo&&(this.rules[0].debugInfo=this.debugInfo,b.debugInfo=this.debugInfo);var c=!1;a.strictMath||(c=!0,a.strictMath=!0);try{b.features=this.features.eval(a)}finally{c&&(a.strictMath=!1)}return a.mediaPath.push(b),a.mediaBlocks.push(b),a.frames.unshift(this.rules[0]),b.rules=[this.rules[0].eval(a)],a.frames.shift(),a.mediaPath.pop(),0===a.mediaPath.length?b.evalTop(a):b.evalNested(a)},k.prototype.variable=function(a){return d.prototype.variable.call(this.rules[0],a)},k.prototype.find=function(){return d.prototype.find.apply(this.rules[0],arguments)},k.prototype.rulesets=function(){return d.prototype.rulesets.apply(this.rules[0])},k.prototype.emptySelectors=function(){var a=new f("","&",this.index,this.currentFileInfo),b=[new g([a],null,null,this.index,this.currentFileInfo)];return b[0].mediaEmpty=!0,b},k.prototype.markReferenced=function(){var a,b=this.rules[0].rules;for(this.rules[0].markReferenced(),this.isReferenced=!0,a=0;a<b.length;a++)b[a].markReferenced&&b[a].markReferenced()},k.prototype.evalTop=function(a){var b=this;if(a.mediaBlocks.length>1){var c=this.emptySelectors();b=new d(c,a.mediaBlocks),b.multiMedia=!0}return delete a.mediaBlocks,delete a.mediaPath,b},k.prototype.evalNested=function(a){var b,c,f=a.mediaPath.concat([this]);for(b=0;b<f.length;b++)c=f[b].features instanceof e?f[b].features.value:f[b].features,f[b]=Array.isArray(c)?c:[c];return this.features=new e(this.permute(f).map(function(a){for(a=a.map(function(a){return a.toCSS?a:new h(a)}),b=a.length-1;b>0;b--)a.splice(b,0,new h("and"));return new i(a)})),new d([],[])},k.prototype.permute=function(a){if(0===a.length)return[];if(1===a.length)return a[0];for(var b=[],c=this.permute(a.slice(1)),d=0;d<c.length;d++)for(var e=0;e<a[0].length;e++)b.push([a[0][e]].concat(c[d]));return b},k.prototype.bubbleSelectors=function(a){a&&(this.rules=[new d(a.slice(0),[this.rules[0]])])},b.exports=k},{"./anonymous":43,"./directive":54,"./element":55,"./expression":56,"./ruleset":73,"./selector":74,"./value":78}],64:[function(a,b,c){var d=a("./node"),e=a("./selector"),f=a("./mixin-definition"),g=a("../functions/default"),h=function(a,b,c,d,f){this.selector=new e(a),this.arguments=b&&b.length?b:null,this.index=c,this.currentFileInfo=d,this.important=f};h.prototype=new d,h.prototype.type="MixinCall",h.prototype.accept=function(a){this.selector&&(this.selector=a.visit(this.selector)),this.arguments&&(this.arguments=a.visitArray(this.arguments))},h.prototype.eval=function(a){function b(b,c){var d,e;for(k=0;2>k;k++){for(w[k]=!0,g.value(k),d=0;d<c.length&&w[k];d++)e=c[d],e.matchCondition&&(w[k]=w[k]&&e.matchCondition(null,a));b.matchCondition&&(w[k]=w[k]&&b.matchCondition(h,a))}return w[0]||w[1]?w[0]!=w[1]?w[1]?z:A:y:x}var c,d,e,h,i,j,k,l,m,n,o,p,q,r,s,t=[],u=!1,v=[],w=[],x=-1,y=0,z=1,A=2;for(h=this.arguments&&this.arguments.map(function(b){return{name:b.name,value:b.value.eval(a)}}),s=function(b){return b.matchArgs(null,a)},i=0;i<a.frames.length;i++)if((c=a.frames[i].find(this.selector,null,s)).length>0){for(m=!0,j=0;j<c.length;j++){for(d=c[j].rule,e=c[j].path,l=!1,k=0;k<a.frames.length;k++)if(!(d instanceof f)&&d===(a.frames[k].originalRuleset||a.frames[k])){l=!0;break}l||d.matchArgs(h,a)&&(o={mixin:d,group:b(d,e)},o.group!==x&&v.push(o),u=!0)}for(g.reset(),q=[0,0,0],j=0;j<v.length;j++)q[v[j].group]++;if(q[y]>0)p=A;else if(p=z,q[z]+q[A]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(h)+"`",index:this.index,filename:this.currentFileInfo.filename};for(j=0;j<v.length;j++)if(o=v[j].group,o===y||o===p)try{d=v[j].mixin,d instanceof f||(r=d.originalRuleset||d,d=new f("",[],d.rules,null,!1),d.originalRuleset=r),Array.prototype.push.apply(t,d.evalCall(a,h,this.important).rules)}catch(B){throw{message:B.message,index:this.index,filename:this.currentFileInfo.filename,stack:B.stack}}if(u){if(!this.currentFileInfo||!this.currentFileInfo.reference)for(i=0;i<t.length;i++)n=t[i],n.markReferenced&&n.markReferenced();return t}}throw m?{type:"Runtime",message:"No matching definition was found for `"+this.format(h)+"`",index:this.index,filename:this.currentFileInfo.filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.index,filename:this.currentFileInfo.filename}},h.prototype.format=function(a){return this.selector.toCSS().trim()+"("+(a?a.map(function(a){var b="";return a.name&&(b+=a.name+":"),b+=a.value.toCSS?a.value.toCSS():"???"}).join(", "):"")+")"},b.exports=h},{"../functions/default":19,"./mixin-definition":65,"./node":67,"./selector":74}],65:[function(a,b,c){var d=a("./selector"),e=a("./element"),f=a("./ruleset"),g=a("./rule"),h=a("./expression"),i=a("../contexts"),j=function(a,b,c,f,g,h){this.name=a,this.selectors=[new d([new e(null,a,this.index,this.currentFileInfo)])],this.params=b,this.condition=f,this.variadic=g,this.arity=b.length,this.rules=c,this._lookups={},this.required=b.reduce(function(a,b){return!b.name||b.name&&!b.value?a+1:a},0),this.frames=h};j.prototype=new f,j.prototype.type="MixinDefinition",j.prototype.evalFirst=!0,j.prototype.accept=function(a){this.params&&this.params.length&&(this.params=a.visitArray(this.params)),this.rules=a.visitArray(this.rules),this.condition&&(this.condition=a.visit(this.condition))},j.prototype.evalParams=function(a,b,c,d){var e,j,k,l,m,n,o,p,q=new f(null,null),r=this.params.slice(0),s=0;if(b=new i.Eval(b,[q].concat(b.frames)),c)for(c=c.slice(0),s=c.length,k=0;s>k;k++)if(j=c[k],n=j&&j.name){for(o=!1,l=0;l<r.length;l++)if(!d[l]&&n===r[l].name){d[l]=j.value.eval(a),q.prependRule(new g(n,j.value.eval(a))),o=!0;break}if(o){c.splice(k,1),k--;continue}throw{type:"Runtime",message:"Named argument for "+this.name+" "+c[k].name+" not found"}}for(p=0,k=0;k<r.length;k++)if(!d[k]){if(j=c&&c[p],n=r[k].name)if(r[k].variadic){for(e=[],l=p;s>l;l++)e.push(c[l].value.eval(a));q.prependRule(new g(n,new h(e).eval(a)))}else{if(m=j&&j.value)m=m.eval(a);else{if(!r[k].value)throw{type:"Runtime",message:"wrong number of arguments for "+this.name+" ("+s+" for "+this.arity+")"};m=r[k].value.eval(b),q.resetCache()}q.prependRule(new g(n,m)),d[k]=m}if(r[k].variadic&&c)for(l=p;s>l;l++)d[l]=c[l].value.eval(a);p++}return q},j.prototype.makeImportant=function(){var a=this.rules?this.rules.map(function(a){return a.makeImportant?a.makeImportant(!0):a}):this.rules,b=new j(this.name,this.params,a,this.condition,this.variadic,this.frames);return b},j.prototype.eval=function(a){return new j(this.name,this.params,this.rules,this.condition,this.variadic,this.frames||a.frames.slice(0))},j.prototype.evalCall=function(a,b,c){var d,e,j=[],k=this.frames?this.frames.concat(a.frames):a.frames,l=this.evalParams(a,new i.Eval(a,k),b,j);return l.prependRule(new g("@arguments",new h(j).eval(a))),d=this.rules.slice(0),e=new f(null,d),e.originalRuleset=this,e=e.eval(new i.Eval(a,[this,l].concat(k))),c&&(e=e.makeImportant()),e},j.prototype.matchCondition=function(a,b){return this.condition&&!this.condition.eval(new i.Eval(b,[this.evalParams(b,new i.Eval(b,this.frames?this.frames.concat(b.frames):b.frames),a,[])].concat(this.frames).concat(b.frames)))?!1:!0},j.prototype.matchArgs=function(a,b){var c,d=a&&a.length||0;if(this.variadic){if(d<this.required-1)return!1}else{if(d<this.required)return!1;if(d>this.params.length)return!1}c=Math.min(d,this.arity);for(var e=0;c>e;e++)if(!this.params[e].name&&!this.params[e].variadic&&a[e].value.eval(b).toCSS()!=this.params[e].value.eval(b).toCSS())return!1;return!0},b.exports=j},{"../contexts":10,"./element":55,"./expression":56,"./rule":71,"./ruleset":73,"./selector":74}],66:[function(a,b,c){var d=a("./node"),e=a("./operation"),f=a("./dimension"),g=function(a){this.value=a};g.prototype=new d,g.prototype.type="Negative",g.prototype.genCSS=function(a,b){b.add("-"),this.value.genCSS(a,b)},g.prototype.eval=function(a){return a.isMathOn()?new e("*",[new f(-1),this.value]).eval(a):new g(this.value.eval(a))},b.exports=g},{"./dimension":53,"./node":67,"./operation":68}],67:[function(a,b,c){var d=function(){};d.prototype.toCSS=function(a){var b=[];return this.genCSS(a,{add:function(a,c,d){b.push(a)},isEmpty:function(){return 0===b.length}}),b.join("")},d.prototype.genCSS=function(a,b){b.add(this.value)},d.prototype.accept=function(a){this.value=a.visit(this.value)},d.prototype.eval=function(){return this},d.prototype._operate=function(a,b,c,d){switch(b){case"+":return c+d;case"-":return c-d;case"*":return c*d;case"/":return c/d}},d.prototype.fround=function(a,b){var c=a&&a.numPrecision;return null==c?b:Number((b+2e-16).toFixed(c))},d.compare=function(a,b){if(a.compare&&"Quoted"!==b.type&&"Anonymous"!==b.type)return a.compare(b);if(b.compare)return-b.compare(a);if(a.type!==b.type)return void 0;if(a=a.value,b=b.value,!Array.isArray(a))return a===b?0:void 0;if(a.length!==b.length)return void 0;for(var c=0;c<a.length;c++)if(0!==d.compare(a[c],b[c]))return void 0;return 0},d.numericCompare=function(a,b){return b>a?-1:a===b?0:a>b?1:void 0},b.exports=d},{}],68:[function(a,b,c){var d=a("./node"),e=a("./color"),f=a("./dimension"),g=function(a,b,c){this.op=a.trim(),this.operands=b,this.isSpaced=c};g.prototype=new d,g.prototype.type="Operation",g.prototype.accept=function(a){this.operands=a.visit(this.operands)},g.prototype.eval=function(a){var b=this.operands[0].eval(a),c=this.operands[1].eval(a);if(a.isMathOn()){if(b instanceof f&&c instanceof e&&(b=b.toColor()),c instanceof f&&b instanceof e&&(c=c.toColor()),!b.operate)throw{type:"Operation",message:"Operation on an invalid type"};return b.operate(a,this.op,c)}return new g(this.op,[b,c],this.isSpaced)},g.prototype.genCSS=function(a,b){
this.operands[0].genCSS(a,b),this.isSpaced&&b.add(" "),b.add(this.op),this.isSpaced&&b.add(" "),this.operands[1].genCSS(a,b)},b.exports=g},{"./color":47,"./dimension":53,"./node":67}],69:[function(a,b,c){var d=a("./node"),e=function(a){this.value=a};e.prototype=new d,e.prototype.type="Paren",e.prototype.genCSS=function(a,b){b.add("("),this.value.genCSS(a,b),b.add(")")},e.prototype.eval=function(a){return new e(this.value.eval(a))},b.exports=e},{"./node":67}],70:[function(a,b,c){var d=a("./node"),e=a("./js-eval-node"),f=a("./variable"),g=function(a,b,c,d,e){this.escaped=null==c?!0:c,this.value=b||"",this.quote=a.charAt(0),this.index=d,this.currentFileInfo=e};g.prototype=new e,g.prototype.type="Quoted",g.prototype.genCSS=function(a,b){this.escaped||b.add(this.quote,this.currentFileInfo,this.index),b.add(this.value),this.escaped||b.add(this.quote)},g.prototype.containsVariables=function(){return this.value.match(/(`([^`]+)`)|@\{([\w-]+)\}/)},g.prototype.eval=function(a){function b(a,b,c){var d=a;do a=d,d=a.replace(b,c);while(a!==d);return d}var c=this,d=this.value,e=function(b,d){return String(c.evaluateJavaScript(d,a))},h=function(b,d){var e=new f("@"+d,c.index,c.currentFileInfo).eval(a,!0);return e instanceof g?e.value:e.toCSS()};return d=b(d,/`([^`]+)`/g,e),d=b(d,/@\{([\w-]+)\}/g,h),new g(this.quote+d+this.quote,d,this.escaped,this.index,this.currentFileInfo)},g.prototype.compare=function(a){return"Quoted"!==a.type||this.escaped||a.escaped?a.toCSS&&this.toCSS()===a.toCSS()?0:void 0:d.numericCompare(this.value,a.value)},b.exports=g},{"./js-eval-node":61,"./node":67,"./variable":79}],71:[function(a,b,c){function d(a,b){var c,d="",e=b.length,f={add:function(a){d+=a}};for(c=0;e>c;c++)b[c].eval(a).genCSS(a,f);return d}var e=a("./node"),f=a("./value"),g=a("./keyword"),h=function(a,b,c,d,g,h,i,j){this.name=a,this.value=b instanceof e?b:new f([b]),this.important=c?" "+c.trim():"",this.merge=d,this.index=g,this.currentFileInfo=h,this.inline=i||!1,this.variable=void 0!==j?j:a.charAt&&"@"===a.charAt(0)};h.prototype=new e,h.prototype.type="Rule",h.prototype.genCSS=function(a,b){b.add(this.name+(a.compress?":":": "),this.currentFileInfo,this.index);try{this.value.genCSS(a,b)}catch(c){throw c.index=this.index,c.filename=this.currentFileInfo.filename,c}b.add(this.important+(this.inline||a.lastRule&&a.compress?"":";"),this.currentFileInfo,this.index)},h.prototype.eval=function(a){var b,c=!1,e=this.name,f=this.variable;"string"!=typeof e&&(e=1===e.length&&e[0]instanceof g?e[0].value:d(a,e),f=!1),"font"!==e||a.strictMath||(c=!0,a.strictMath=!0);try{if(a.importantScope.push({}),b=this.value.eval(a),!this.variable&&"DetachedRuleset"===b.type)throw{message:"Rulesets cannot be evaluated on a property.",index:this.index,filename:this.currentFileInfo.filename};var i=this.important,j=a.importantScope.pop();return!i&&j.important&&(i=j.important),new h(e,b,i,this.merge,this.index,this.currentFileInfo,this.inline,f)}catch(k){throw"number"!=typeof k.index&&(k.index=this.index,k.filename=this.currentFileInfo.filename),k}finally{c&&(a.strictMath=!1)}},h.prototype.makeImportant=function(){return new h(this.name,this.value,"!important",this.merge,this.index,this.currentFileInfo,this.inline)},b.exports=h},{"./keyword":62,"./node":67,"./value":78}],72:[function(a,b,c){var d=a("./node"),e=a("./variable"),f=function(a){this.variable=a};f.prototype=new d,f.prototype.type="RulesetCall",f.prototype.eval=function(a){var b=new e(this.variable).eval(a);return b.callEval(a)},b.exports=f},{"./node":67,"./variable":79}],73:[function(a,b,c){var d=a("./node"),e=a("./rule"),f=a("./selector"),g=a("./element"),h=a("./paren"),i=a("../contexts"),j=a("../functions/default"),k=a("./debug-info"),l=function(a,b,c){this.selectors=a,this.rules=b,this._lookups={},this.strictImports=c};l.prototype=new d,l.prototype.type="Ruleset",l.prototype.isRuleset=!0,l.prototype.isRulesetLike=!0,l.prototype.accept=function(a){this.paths?a.visitArray(this.paths,!0):this.selectors&&(this.selectors=a.visitArray(this.selectors)),this.rules&&this.rules.length&&(this.rules=a.visitArray(this.rules))},l.prototype.eval=function(a){var b,c,d,f,g=this.selectors,h=!1;if(g&&(c=g.length)){for(b=[],j.error({type:"Syntax",message:"it is currently only allowed in parametric mixin guards,"}),f=0;c>f;f++)d=g[f].eval(a),b.push(d),d.evaldCondition&&(h=!0);j.reset()}else h=!0;var i,k,m=this.rules?this.rules.slice(0):null,n=new l(b,m,this.strictImports);n.originalRuleset=this,n.root=this.root,n.firstRoot=this.firstRoot,n.allowImports=this.allowImports,this.debugInfo&&(n.debugInfo=this.debugInfo),h||(m.length=0);var o=a.frames;o.unshift(n);var p=a.selectors;p||(a.selectors=p=[]),p.unshift(this.selectors),(n.root||n.allowImports||!n.strictImports)&&n.evalImports(a);var q=n.rules,r=q?q.length:0;for(f=0;r>f;f++)q[f].evalFirst&&(q[f]=q[f].eval(a));var s=a.mediaBlocks&&a.mediaBlocks.length||0;for(f=0;r>f;f++)"MixinCall"===q[f].type?(m=q[f].eval(a).filter(function(a){return a instanceof e&&a.variable?!n.variable(a.name):!0}),q.splice.apply(q,[f,1].concat(m)),r+=m.length-1,f+=m.length-1,n.resetCache()):"RulesetCall"===q[f].type&&(m=q[f].eval(a).rules.filter(function(a){return a instanceof e&&a.variable?!1:!0}),q.splice.apply(q,[f,1].concat(m)),r+=m.length-1,f+=m.length-1,n.resetCache());for(f=0;f<q.length;f++)i=q[f],i.evalFirst||(q[f]=i=i.eval?i.eval(a):i);for(f=0;f<q.length;f++)if(i=q[f],i instanceof l&&i.selectors&&1===i.selectors.length&&i.selectors[0].isJustParentSelector()){q.splice(f--,1);for(var t=0;t<i.rules.length;t++)k=i.rules[t],k instanceof e&&k.variable||q.splice(++f,0,k)}if(o.shift(),p.shift(),a.mediaBlocks)for(f=s;f<a.mediaBlocks.length;f++)a.mediaBlocks[f].bubbleSelectors(b);return n},l.prototype.evalImports=function(a){var b,c,d=this.rules;if(d)for(b=0;b<d.length;b++)"Import"===d[b].type&&(c=d[b].eval(a),c&&c.length?(d.splice.apply(d,[b,1].concat(c)),b+=c.length-1):d.splice(b,1,c),this.resetCache())},l.prototype.makeImportant=function(){var a=new l(this.selectors,this.rules.map(function(a){return a.makeImportant?a.makeImportant():a}),this.strictImports);return a},l.prototype.matchArgs=function(a){return!a||0===a.length},l.prototype.matchCondition=function(a,b){var c=this.selectors[this.selectors.length-1];return c.evaldCondition?c.condition&&!c.condition.eval(new i.Eval(b,b.frames))?!1:!0:!1},l.prototype.resetCache=function(){this._rulesets=null,this._variables=null,this._lookups={}},l.prototype.variables=function(){return this._variables||(this._variables=this.rules?this.rules.reduce(function(a,b){if(b instanceof e&&b.variable===!0&&(a[b.name]=b),"Import"===b.type&&b.root&&b.root.variables){var c=b.root.variables();for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},{}):{}),this._variables},l.prototype.variable=function(a){return this.variables()[a]},l.prototype.rulesets=function(){if(!this.rules)return null;var a,b,c=[],d=this.rules,e=d.length;for(a=0;e>a;a++)b=d[a],b.isRuleset&&c.push(b);return c},l.prototype.prependRule=function(a){var b=this.rules;b?b.unshift(a):this.rules=[a]},l.prototype.find=function(a,b,c){b=b||this;var d,e,g=[],h=a.toCSS();return h in this._lookups?this._lookups[h]:(this.rulesets().forEach(function(h){if(h!==b)for(var i=0;i<h.selectors.length;i++)if(d=a.match(h.selectors[i])){if(a.elements.length>d){if(!c||c(h)){e=h.find(new f(a.elements.slice(d)),b,c);for(var j=0;j<e.length;++j)e[j].path.push(h);Array.prototype.push.apply(g,e)}}else g.push({rule:h,path:[]});break}}),this._lookups[h]=g,g)},l.prototype.genCSS=function(a,b){function c(a,b){return"boolean"==typeof a.isRulesetLike?a.isRulesetLike:"function"==typeof a.isRulesetLike?a.isRulesetLike(b):!1}var d,e,f,g,h,i,j=[],l=[],m=[];a.tabLevel=a.tabLevel||0,this.root||a.tabLevel++;var n,o=a.compress?"":Array(a.tabLevel+1).join("  "),p=a.compress?"":Array(a.tabLevel).join("  ");for(d=0;d<this.rules.length;d++)h=this.rules[d],c(h,this.root)?m.push(h):h.isCharset&&h.isCharset()?j.push(h):l.push(h);if(l=j.concat(l),!this.root){g=k(a,this,p),g&&(b.add(g),b.add(p));var q,r=this.paths,s=r.length;for(n=a.compress?",":",\n"+p,d=0;s>d;d++)if(i=r[d],q=i.length)for(d>0&&b.add(n),a.firstSelector=!0,i[0].genCSS(a,b),a.firstSelector=!1,e=1;q>e;e++)i[e].genCSS(a,b);b.add((a.compress?"{":" {\n")+o)}for(d=0;d<l.length;d++)h=l[d],d+1!==l.length||this.root&&0!==m.length&&!this.firstRoot||(a.lastRule=!0),h.genCSS?h.genCSS(a,b):h.value&&b.add(h.value.toString()),a.lastRule?a.lastRule=!1:b.add(a.compress?"":"\n"+o);if(this.root||(b.add(a.compress?"}":"\n"+p+"}"),a.tabLevel--),n=(a.compress?"":"\n")+(this.root?o:p),f=m.length)for(l.length&&n&&b.add(n),m[0].genCSS(a,b),d=1;f>d;d++)n&&b.add(n),m[d].genCSS(a,b);b.isEmpty()||a.compress||!this.firstRoot||b.add("\n")},l.prototype.markReferenced=function(){var a;if(this.selectors)for(a=0;a<this.selectors.length;a++)this.selectors[a].markReferenced();if(this.rules)for(a=0;a<this.rules.length;a++)this.rules[a].markReferenced&&this.rules[a].markReferenced()},l.prototype.getIsReferenced=function(){var a,b,c,d;if(this.paths)for(a=0;a<this.paths.length;a++)for(c=this.paths[a],b=0;b<c.length;b++)if(c[b].getIsReferenced&&c[b].getIsReferenced())return!0;if(this.selectors)for(a=0;a<this.selectors.length;a++)if(d=this.selectors[a],d.getIsReferenced&&d.getIsReferenced())return!0;return!1},l.prototype.joinSelectors=function(a,b,c){for(var d=0;d<c.length;d++)this.joinSelector(a,b,c[d])},l.prototype.joinSelector=function(a,b,c){function d(a,b){var c,d;if(0===a.length)c=new h(a[0]);else{var e=[];for(d=0;d<a.length;d++)e.push(new g(null,a[d],b.index,b.currentFileInfo));c=new h(new f(e))}return c}function e(a,b){var c,d;return c=new g(null,a,b.index,b.currentFileInfo),d=new f([c])}function i(a,b,c){function f(a){var b;return"Paren"!==a.value.type?null:(b=a.value.value,"Selector"!==b.type?null:b)}var h,m,n,o,p,q,r,s,t,u,v=!1;for(o=[],p=[[]],h=0;h<c.elements.length;h++)if(s=c.elements[h],"&"!==s.value){var w=f(s);if(null!=w){l(o,p);var x,y=[],z=[];for(x=i(y,b,w),v=v||x,n=0;n<y.length;n++){var A=e(d(y[n],s),s);k(p,[A],s,c,z)}p=z,o=[]}else o.push(s)}else{for(v=!0,q=[],l(o,p),m=0;m<p.length;m++)if(r=p[m],0===b.length)r.length>0&&r[0].elements.push(new g(s.combinator,"",s.index,s.currentFileInfo)),q.push(r);else for(n=0;n<b.length;n++){var B=j(r,b[n],s,c);q.push(B)}p=q,o=[]}for(l(o,p),h=0;h<p.length;h++)t=p[h].length,t>0&&(a.push(p[h]),u=p[h][t-1],p[h][t-1]=u.createDerived(u.elements,c.extendList));return v}function j(a,b,c,d){var e,f,h;if(e=[],a.length>0?(e=a.slice(0),f=e.pop(),h=d.createDerived(f.elements.slice(0))):h=d.createDerived([]),b.length>0){var i=c.combinator,j=b[0].elements[0];i.emptyOrWhitespace&&!j.combinator.emptyOrWhitespace&&(i=j.combinator),h.elements.push(new g(i,j.value,c.index,c.currentFileInfo)),h.elements=h.elements.concat(b[0].elements.slice(1))}return 0!==h.elements.length&&e.push(h),b.length>1&&(e=e.concat(b.slice(1))),e}function k(a,b,c,d,e){var f;for(f=0;f<a.length;f++){var g=j(a[f],b,c,d);e.push(g)}return e}function l(a,b){var c,d;if(0!==a.length){if(0===b.length)return void b.push([new f(a)]);for(c=0;c<b.length;c++)d=b[c],d.length>0?d[d.length-1]=d[d.length-1].createDerived(d[d.length-1].elements.concat(a)):d.push(new f(a))}}var m,n,o;if(n=[],o=i(n,b,c),!o)if(b.length>0)for(n=[],m=0;m<b.length;m++)n.push(b[m].concat(c));else n=[[c]];for(m=0;m<n.length;m++)a.push(n[m])},b.exports=l},{"../contexts":10,"../functions/default":19,"./debug-info":51,"./element":55,"./node":67,"./paren":69,"./rule":71,"./selector":74}],74:[function(a,b,c){var d=a("./node"),e=function(a,b,c,d,e,f){this.elements=a,this.extendList=b,this.condition=c,this.currentFileInfo=e||{},this.isReferenced=f,c||(this.evaldCondition=!0)};e.prototype=new d,e.prototype.type="Selector",e.prototype.accept=function(a){this.elements&&(this.elements=a.visitArray(this.elements)),this.extendList&&(this.extendList=a.visitArray(this.extendList)),this.condition&&(this.condition=a.visit(this.condition))},e.prototype.createDerived=function(a,b,c){c=null!=c?c:this.evaldCondition;var d=new e(a,b||this.extendList,null,this.index,this.currentFileInfo,this.isReferenced);return d.evaldCondition=c,d.mediaEmpty=this.mediaEmpty,d},e.prototype.match=function(a){var b,c,d=this.elements,e=d.length;if(a.CacheElements(),b=a._elements.length,0===b||b>e)return 0;for(c=0;b>c;c++)if(d[c].value!==a._elements[c])return 0;return b},e.prototype.CacheElements=function(){if(!this._elements){var a=this.elements.map(function(a){return a.combinator.value+(a.value.value||a.value)}).join("").match(/[,&#\*\.\w-]([\w-]|(\\.))*/g);a?"&"===a[0]&&a.shift():a=[],this._elements=a}},e.prototype.isJustParentSelector=function(){return!this.mediaEmpty&&1===this.elements.length&&"&"===this.elements[0].value&&(" "===this.elements[0].combinator.value||""===this.elements[0].combinator.value)},e.prototype.eval=function(a){var b=this.condition&&this.condition.eval(a),c=this.elements,d=this.extendList;return c=c&&c.map(function(b){return b.eval(a)}),d=d&&d.map(function(b){return b.eval(a)}),this.createDerived(c,d,b)},e.prototype.genCSS=function(a,b){var c,d;if(a&&a.firstSelector||""!==this.elements[0].combinator.value||b.add(" ",this.currentFileInfo,this.index),!this._css)for(c=0;c<this.elements.length;c++)d=this.elements[c],d.genCSS(a,b)},e.prototype.markReferenced=function(){this.isReferenced=!0},e.prototype.getIsReferenced=function(){return!this.currentFileInfo.reference||this.isReferenced},e.prototype.getIsOutput=function(){return this.evaldCondition},b.exports=e},{"./node":67}],75:[function(a,b,c){var d=a("./node"),e=function(a){this.value=a};e.prototype=new d,e.prototype.type="UnicodeDescriptor",b.exports=e},{"./node":67}],76:[function(a,b,c){var d=a("./node"),e=a("../data/unit-conversions"),f=function(a,b,c){this.numerator=a?a.slice(0).sort():[],this.denominator=b?b.slice(0).sort():[],c?this.backupUnit=c:a&&a.length&&(this.backupUnit=a[0])};f.prototype=new d,f.prototype.type="Unit",f.prototype.clone=function(){return new f(this.numerator.slice(0),this.denominator.slice(0),this.backupUnit)},f.prototype.genCSS=function(a,b){var c=a&&a.strictUnits;1===this.numerator.length?b.add(this.numerator[0]):!c&&this.backupUnit?b.add(this.backupUnit):!c&&this.denominator.length&&b.add(this.denominator[0])},f.prototype.toString=function(){var a,b=this.numerator.join("*");for(a=0;a<this.denominator.length;a++)b+="/"+this.denominator[a];return b},f.prototype.compare=function(a){return this.is(a.toString())?0:void 0},f.prototype.is=function(a){return this.toString().toUpperCase()===a.toUpperCase()},f.prototype.isLength=function(){return Boolean(this.toCSS().match(/px|em|%|in|cm|mm|pc|pt|ex/))},f.prototype.isEmpty=function(){return 0===this.numerator.length&&0===this.denominator.length},f.prototype.isSingular=function(){return this.numerator.length<=1&&0===this.denominator.length},f.prototype.map=function(a){var b;for(b=0;b<this.numerator.length;b++)this.numerator[b]=a(this.numerator[b],!1);for(b=0;b<this.denominator.length;b++)this.denominator[b]=a(this.denominator[b],!0)},f.prototype.usedUnits=function(){var a,b,c={};b=function(b){return a.hasOwnProperty(b)&&!c[d]&&(c[d]=b),b};for(var d in e)e.hasOwnProperty(d)&&(a=e[d],this.map(b));return c},f.prototype.cancel=function(){var a,b,c={};for(b=0;b<this.numerator.length;b++)a=this.numerator[b],c[a]=(c[a]||0)+1;for(b=0;b<this.denominator.length;b++)a=this.denominator[b],c[a]=(c[a]||0)-1;this.numerator=[],this.denominator=[];for(a in c)if(c.hasOwnProperty(a)){var d=c[a];if(d>0)for(b=0;d>b;b++)this.numerator.push(a);else if(0>d)for(b=0;-d>b;b++)this.denominator.push(a)}this.numerator.sort(),this.denominator.sort()},b.exports=f},{"../data/unit-conversions":13,"./node":67}],77:[function(a,b,c){var d=a("./node"),e=function(a,b,c,d){this.value=a,this.currentFileInfo=c,this.index=b,this.isEvald=d};e.prototype=new d,e.prototype.type="Url",e.prototype.accept=function(a){this.value=a.visit(this.value)},e.prototype.genCSS=function(a,b){b.add("url("),this.value.genCSS(a,b),b.add(")")},e.prototype.eval=function(a){var b,c=this.value.eval(a);if(!this.isEvald&&(b=this.currentFileInfo&&this.currentFileInfo.rootpath,b&&"string"==typeof c.value&&a.isPathRelative(c.value)&&(c.quote||(b=b.replace(/[\(\)'"\s]/g,function(a){return"\\"+a})),c.value=b+c.value),c.value=a.normalizePath(c.value),a.urlArgs&&!c.value.match(/^\s*data:/))){var d=-1===c.value.indexOf("?")?"?":"&",f=d+a.urlArgs;-1!==c.value.indexOf("#")?c.value=c.value.replace("#",f+"#"):c.value+=f}return new e(c,this.index,this.currentFileInfo,!0)},b.exports=e},{"./node":67}],78:[function(a,b,c){var d=a("./node"),e=function(a){if(this.value=a,!a)throw new Error("Value requires an array argument")};e.prototype=new d,e.prototype.type="Value",e.prototype.accept=function(a){this.value&&(this.value=a.visitArray(this.value))},e.prototype.eval=function(a){return 1===this.value.length?this.value[0].eval(a):new e(this.value.map(function(b){return b.eval(a)}))},e.prototype.genCSS=function(a,b){var c;for(c=0;c<this.value.length;c++)this.value[c].genCSS(a,b),c+1<this.value.length&&b.add(a&&a.compress?",":", ")},b.exports=e},{"./node":67}],79:[function(a,b,c){var d=a("./node"),e=function(a,b,c){this.name=a,this.index=b,this.currentFileInfo=c||{}};e.prototype=new d,e.prototype.type="Variable",e.prototype.eval=function(a){var b,c=this.name;if(0===c.indexOf("@@")&&(c="@"+new e(c.slice(1),this.index,this.currentFileInfo).eval(a).value),this.evaluating)throw{type:"Name",message:"Recursive variable definition for "+c,filename:this.currentFileInfo.filename,index:this.index};if(this.evaluating=!0,b=this.find(a.frames,function(b){var d=b.variable(c);if(d){if(d.important){var e=a.importantScope[a.importantScope.length-1];e.important=d.important}return d.value.eval(a)}}))return this.evaluating=!1,b;throw{type:"Name",message:"variable "+c+" is undefined",filename:this.currentFileInfo.filename,index:this.index}},e.prototype.find=function(a,b){for(var c,d=0;d<a.length;d++)if(c=b.call(a,a[d]))return c;return null},b.exports=e},{"./node":67}],80:[function(a,b,c){b.exports={getLocation:function(a,b){for(var c=a+1,d=null,e=-1;--c>=0&&"\n"!==b.charAt(c);)e++;return"number"==typeof a&&(d=(b.slice(0,a).match(/\n/g)||"").length),{line:d,column:e}}}},{}],81:[function(a,b,c){var d=a("../tree"),e=a("./visitor"),f=a("../logger"),g=function(){this._visitor=new e(this),this.contexts=[],this.allExtendsStack=[[]]};g.prototype={run:function(a){return a=this._visitor.visit(a),a.allExtends=this.allExtendsStack[0],a},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitRuleset:function(a,b){if(!a.root){var c,e,f,g,h=[],i=a.rules,j=i?i.length:0;for(c=0;j>c;c++)a.rules[c]instanceof d.Extend&&(h.push(i[c]),a.extendOnEveryPath=!0);var k=a.paths;for(c=0;c<k.length;c++){var l=k[c],m=l[l.length-1],n=m.extendList;for(g=n?n.slice(0).concat(h):h,g&&(g=g.map(function(a){return a.clone()})),e=0;e<g.length;e++)this.foundExtends=!0,f=g[e],f.findSelfSelectors(l),f.ruleset=a,0===e&&(f.firstExtendOnThisSelectorPath=!0),this.allExtendsStack[this.allExtendsStack.length-1].push(f)}this.contexts.push(a.selectors)}},visitRulesetOut:function(a){a.root||(this.contexts.length=this.contexts.length-1)},visitMedia:function(a,b){a.allExtends=[],this.allExtendsStack.push(a.allExtends)},visitMediaOut:function(a){this.allExtendsStack.length=this.allExtendsStack.length-1},visitDirective:function(a,b){a.allExtends=[],this.allExtendsStack.push(a.allExtends)},visitDirectiveOut:function(a){this.allExtendsStack.length=this.allExtendsStack.length-1}};var h=function(){this._visitor=new e(this)};h.prototype={run:function(a){var b=new g;if(this.extendIndicies={},b.run(a),!b.foundExtends)return a;a.allExtends=a.allExtends.concat(this.doExtendChaining(a.allExtends,a.allExtends)),this.allExtendsStack=[a.allExtends];var c=this._visitor.visit(a);return this.checkExtendsForNonMatched(a.allExtends),c},checkExtendsForNonMatched:function(a){var b=this.extendIndicies;a.filter(function(a){return!a.hasFoundMatches&&1==a.parent_ids.length}).forEach(function(a){var c="_unknown_";try{c=a.selector.toCSS({})}catch(d){}b[a.index+" "+c]||(b[a.index+" "+c]=!0,f.warn("extend '"+c+"' has no matches"))})},doExtendChaining:function(a,b,c){var e,f,g,h,i,j,k,l,m=[],n=this;for(c=c||0,e=0;e<a.length;e++)for(f=0;f<b.length;f++)j=a[e],k=b[f],j.parent_ids.indexOf(k.object_id)>=0||(i=[k.selfSelectors[0]],g=n.findMatch(j,i),g.length&&(j.hasFoundMatches=!0,j.selfSelectors.forEach(function(a){h=n.extendSelector(g,i,a),l=new d.Extend(k.selector,k.option,0),l.selfSelectors=h,h[h.length-1].extendList=[l],m.push(l),l.ruleset=k.ruleset,l.parent_ids=l.parent_ids.concat(k.parent_ids,j.parent_ids),k.firstExtendOnThisSelectorPath&&(l.firstExtendOnThisSelectorPath=!0,k.ruleset.paths.push(h))})));if(m.length){if(this.extendChainCount++,c>100){var o="{unable to calculate}",p="{unable to calculate}";try{o=m[0].selfSelectors[0].toCSS(),p=m[0].selector.toCSS()}catch(q){}throw{message:"extend circular reference detected. One of the circular extends is currently:"+o+":extend("+p+")"}}return m.concat(n.doExtendChaining(m,b,c+1))}return m},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitSelector:function(a,b){b.visitDeeper=!1},visitRuleset:function(a,b){if(!a.root){var c,d,e,f,g=this.allExtendsStack[this.allExtendsStack.length-1],h=[],i=this;for(e=0;e<g.length;e++)for(d=0;d<a.paths.length;d++)if(f=a.paths[d],!a.extendOnEveryPath){var j=f[f.length-1].extendList;j&&j.length||(c=this.findMatch(g[e],f),c.length&&(g[e].hasFoundMatches=!0,g[e].selfSelectors.forEach(function(a){h.push(i.extendSelector(c,f,a))})))}a.paths=a.paths.concat(h)}},findMatch:function(a,b){var c,d,e,f,g,h,i,j=this,k=a.selector.elements,l=[],m=[];for(c=0;c<b.length;c++)for(d=b[c],e=0;e<d.elements.length;e++)for(f=d.elements[e],(a.allowBefore||0===c&&0===e)&&l.push({pathIndex:c,index:e,matched:0,initialCombinator:f.combinator}),h=0;h<l.length;h++)i=l[h],g=f.combinator.value,""===g&&0===e&&(g=" "),!j.isElementValuesEqual(k[i.matched].value,f.value)||i.matched>0&&k[i.matched].combinator.value!==g?i=null:i.matched++,i&&(i.finished=i.matched===k.length,i.finished&&!a.allowAfter&&(e+1<d.elements.length||c+1<b.length)&&(i=null)),i?i.finished&&(i.length=k.length,i.endPathIndex=c,i.endPathElementIndex=e+1,l.length=0,m.push(i)):(l.splice(h,1),h--);return m},isElementValuesEqual:function(a,b){if("string"==typeof a||"string"==typeof b)return a===b;if(a instanceof d.Attribute)return a.op!==b.op||a.key!==b.key?!1:a.value&&b.value?(a=a.value.value||a.value,b=b.value.value||b.value,a===b):a.value||b.value?!1:!0;if(a=a.value,b=b.value,a instanceof d.Selector){if(!(b instanceof d.Selector)||a.elements.length!==b.elements.length)return!1;for(var c=0;c<a.elements.length;c++){if(a.elements[c].combinator.value!==b.elements[c].combinator.value&&(0!==c||(a.elements[c].combinator.value||" ")!==(b.elements[c].combinator.value||" ")))return!1;if(!this.isElementValuesEqual(a.elements[c].value,b.elements[c].value))return!1}return!0}return!1},extendSelector:function(a,b,c){var e,f,g,h,i,j=0,k=0,l=[];for(e=0;e<a.length;e++)h=a[e],f=b[h.pathIndex],g=new d.Element(h.initialCombinator,c.elements[0].value,c.elements[0].index,c.elements[0].currentFileInfo),h.pathIndex>j&&k>0&&(l[l.length-1].elements=l[l.length-1].elements.concat(b[j].elements.slice(k)),k=0,j++),i=f.elements.slice(k,h.index).concat([g]).concat(c.elements.slice(1)),j===h.pathIndex&&e>0?l[l.length-1].elements=l[l.length-1].elements.concat(i):(l=l.concat(b.slice(j,h.pathIndex)),l.push(new d.Selector(i))),j=h.endPathIndex,k=h.endPathElementIndex,k>=b[j].elements.length&&(k=0,j++);return j<b.length&&k>0&&(l[l.length-1].elements=l[l.length-1].elements.concat(b[j].elements.slice(k)),j++),l=l.concat(b.slice(j,b.length))},visitRulesetOut:function(a){},visitMedia:function(a,b){var c=a.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);c=c.concat(this.doExtendChaining(c,a.allExtends)),this.allExtendsStack.push(c)},visitMediaOut:function(a){var b=this.allExtendsStack.length-1;this.checkExtendsForNonMatched(this.allExtendsStack[b]),this.allExtendsStack.length=b},visitDirective:function(a,b){var c=a.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);c=c.concat(this.doExtendChaining(c,a.allExtends)),this.allExtendsStack.push(c)},visitDirectiveOut:function(a){var b=this.allExtendsStack.length-1;this.checkExtendsForNonMatched(this.allExtendsStack[b]),this.allExtendsStack.length=b}},b.exports=h},{"../logger":31,"../tree":59,"./visitor":87}],82:[function(a,b,c){function d(a){this.imports=[],this.variableImports=[],this._onSequencerEmpty=a,this._currentDepth=0}d.prototype.addImport=function(a){var b=this,c={callback:a,args:null,isReady:!1};return this.imports.push(c),function(){c.args=Array.prototype.slice.call(arguments,0),c.isReady=!0,b.tryRun()}},d.prototype.addVariableImport=function(a){this.variableImports.push(a)},d.prototype.tryRun=function(){this._currentDepth++;try{for(;;){for(;this.imports.length>0;){var a=this.imports[0];if(!a.isReady)return;this.imports=this.imports.slice(1),a.callback.apply(null,a.args)}if(0===this.variableImports.length)break;var b=this.variableImports[0];this.variableImports=this.variableImports.slice(1),b()}}finally{this._currentDepth--}0===this._currentDepth&&this._onSequencerEmpty&&this._onSequencerEmpty()},b.exports=d},{}],83:[function(a,b,c){var d=a("../contexts"),e=a("./visitor"),f=a("./import-sequencer"),g=function(a,b){this._visitor=new e(this),this._importer=a,this._finish=b,this.context=new d.Eval,this.importCount=0,this.onceFileDetectionMap={},this.recursionDetector={},this._sequencer=new f(this._onSequencerEmpty.bind(this))};g.prototype={isReplacing:!1,run:function(a){try{this._visitor.visit(a)}catch(b){this.error=b}this.isFinished=!0,this._sequencer.tryRun()},_onSequencerEmpty:function(){this.isFinished&&this._finish(this.error)},visitImport:function(a,b){var c=a.options.inline;if(!a.css||c){var e=new d.Eval(this.context,this.context.frames.slice(0)),f=e.frames[0];this.importCount++,a.isVariableImport()?this._sequencer.addVariableImport(this.processImportNode.bind(this,a,e,f)):this.processImportNode(a,e,f)}b.visitDeeper=!1},processImportNode:function(a,b,c){var d,e=a.options.inline;try{d=a.evalForImport(b)}catch(f){f.filename||(f.index=a.index,f.filename=a.currentFileInfo.filename),a.css=!0,a.error=f}if(!d||d.css&&!e)this.importCount--,this.isFinished&&this._sequencer.tryRun();else{d.options.multiple&&(b.importMultiple=!0);for(var g=void 0===d.css,h=0;h<c.rules.length;h++)if(c.rules[h]===a){c.rules[h]=d;break}var i=this.onImported.bind(this,d,b),j=this._sequencer.addImport(i);this._importer.push(d.getPath(),g,d.currentFileInfo,d.options,j)}},onImported:function(a,b,c,d,e,f){c&&(c.filename||(c.index=a.index,c.filename=a.currentFileInfo.filename),this.error=c);var g=this,h=a.options.inline,i=e||f in g.recursionDetector;if(b.importMultiple||(i?a.skip=!0:a.skip=function(){return f in g.onceFileDetectionMap?!0:(g.onceFileDetectionMap[f]=!0,!1)}),d&&(a.root=d,a.importedFilename=f,!h&&(b.importMultiple||!i))){g.recursionDetector[f]=!0;var j=this.context;this.context=b;try{this._visitor.visit(d)}catch(c){this.error=c}this.context=j}g.importCount--,g.isFinished&&g._sequencer.tryRun()},visitRule:function(a,b){b.visitDeeper=!1},visitDirective:function(a,b){this.context.frames.unshift(a)},visitDirectiveOut:function(a){this.context.frames.shift()},visitMixinDefinition:function(a,b){this.context.frames.unshift(a)},visitMixinDefinitionOut:function(a){this.context.frames.shift()},visitRuleset:function(a,b){this.context.frames.unshift(a)},visitRulesetOut:function(a){this.context.frames.shift()},visitMedia:function(a,b){this.context.frames.unshift(a.rules[0])},visitMediaOut:function(a){this.context.frames.shift()}},b.exports=g},{"../contexts":10,"./import-sequencer":82,"./visitor":87}],84:[function(a,b,c){var d={Visitor:a("./visitor"),ImportVisitor:a("./import-visitor"),ExtendVisitor:a("./extend-visitor"),JoinSelectorVisitor:a("./join-selector-visitor"),ToCSSVisitor:a("./to-css-visitor")};b.exports=d},{"./extend-visitor":81,"./import-visitor":83,"./join-selector-visitor":85,"./to-css-visitor":86,"./visitor":87}],85:[function(a,b,c){var d=a("./visitor"),e=function(){this.contexts=[[]],this._visitor=new d(this)};e.prototype={run:function(a){return this._visitor.visit(a)},visitRule:function(a,b){b.visitDeeper=!1},visitMixinDefinition:function(a,b){b.visitDeeper=!1},visitRuleset:function(a,b){var c,d=this.contexts[this.contexts.length-1],e=[];this.contexts.push(e),a.root||(c=a.selectors,c&&(c=c.filter(function(a){return a.getIsOutput()}),a.selectors=c.length?c:c=null,c&&a.joinSelectors(e,d,c)),c||(a.rules=null),a.paths=e)},visitRulesetOut:function(a){this.contexts.length=this.contexts.length-1},visitMedia:function(a,b){var c=this.contexts[this.contexts.length-1];a.rules[0].root=0===c.length||c[0].multiMedia}},b.exports=e},{"./visitor":87}],86:[function(a,b,c){var d=a("../tree"),e=a("./visitor"),f=function(a){this._visitor=new e(this),this._context=a};f.prototype={isReplacing:!0,run:function(a){return this._visitor.visit(a)},visitRule:function(a,b){return a.variable?void 0:a},visitMixinDefinition:function(a,b){a.frames=[]},visitExtend:function(a,b){},visitComment:function(a,b){return a.isSilent(this._context)?void 0:a},visitMedia:function(a,b){return a.accept(this._visitor),b.visitDeeper=!1,a.rules.length?a:void 0},visitDirective:function(a,b){if("@charset"===a.name){if(!a.getIsReferenced())return;if(this.charset){if(a.debugInfo){var c=new d.Comment("/* "+a.toCSS(this._context).replace(/\n/g,"")+" */\n");return c.debugInfo=a.debugInfo,this._visitor.visit(c)}return}this.charset=!0}if(a.rules&&a.rules.rules){if(this._mergeRules(a.rules.rules),a.accept(this._visitor),b.visitDeeper=!1,a.getIsReferenced())return a;if(!a.rules.rules)return;for(var e=0;e<a.rules.rules.length;e++){var f=a.rules.rules[e];if(f.getIsReferenced&&f.getIsReferenced())return a.markReferenced(),a}}else if(a.getIsReferenced())return a},checkPropertiesInRoot:function(a){for(var b,c=0;c<a.length;c++)if(b=a[c],b instanceof d.Rule&&!b.variable)throw{message:"properties must be inside selector blocks, they cannot be in the root.",index:b.index,filename:b.currentFileInfo?b.currentFileInfo.filename:null}},visitRuleset:function(a,b){var c,e=[];if(a.firstRoot&&this.checkPropertiesInRoot(a.rules),a.root)a.accept(this._visitor),b.visitDeeper=!1,(a.firstRoot||a.rules&&a.rules.length>0)&&e.splice(0,0,a);else{a.paths&&(a.paths=a.paths.filter(function(a){var b;for(" "===a[0].elements[0].combinator.value&&(a[0].elements[0].combinator=new d.Combinator("")),b=0;b<a.length;b++)if(a[b].getIsReferenced()&&a[b].getIsOutput())return!0;return!1}));for(var f=a.rules,g=f?f.length:0,h=0;g>h;)c=f[h],c&&c.rules?(e.push(this._visitor.visit(c)),f.splice(h,1),g--):h++;g>0?a.accept(this._visitor):a.rules=null,b.visitDeeper=!1,f=a.rules,f&&(this._mergeRules(f),f=a.rules),f&&(this._removeDuplicateRules(f),f=a.rules),f&&f.length>0&&a.paths.length>0&&e.splice(0,0,a)}return 1===e.length?e[0]:e},_removeDuplicateRules:function(a){if(a){var b,c,e,f={};for(e=a.length-1;e>=0;e--)if(c=a[e],c instanceof d.Rule)if(f[c.name]){b=f[c.name],b instanceof d.Rule&&(b=f[c.name]=[f[c.name].toCSS(this._context)]);var g=c.toCSS(this._context);-1!==b.indexOf(g)?a.splice(e,1):b.push(g)}else f[c.name]=c}},_mergeRules:function(a){if(a){for(var b,c,e,f={},g=0;g<a.length;g++)c=a[g],c instanceof d.Rule&&c.merge&&(e=[c.name,c.important?"!":""].join(","),f[e]?a.splice(g--,1):f[e]=[],f[e].push(c));Object.keys(f).map(function(a){function e(a){return new d.Expression(a.map(function(a){return a.value}))}function g(a){return new d.Value(a.map(function(a){return a}))}if(b=f[a],b.length>1){c=b[0];var h=[],i=[];b.map(function(a){"+"===a.merge&&(i.length>0&&h.push(e(i)),i=[]),i.push(a)}),h.push(e(i)),c.value=g(h)}})}}},b.exports=f},{"../tree":59,"./visitor":87}],87:[function(a,b,c){function d(a){return a}function e(a,b){var c,d;for(c in a)if(a.hasOwnProperty(c))switch(d=a[c],typeof d){case"function":d.prototype&&d.prototype.type&&(d.prototype.typeIndex=b++);
break;case"object":b=e(d,b)}return b}var f=a("../tree"),g={visitDeeper:!0},h=!1,i=function(a){this._implementation=a,this._visitFnCache=[],h||(e(f,1),h=!0)};i.prototype={visit:function(a){if(!a)return a;var b=a.typeIndex;if(!b)return a;var c,e=this._visitFnCache,f=this._implementation,h=b<<1,i=1|h,j=e[h],k=e[i],l=g;if(l.visitDeeper=!0,j||(c="visit"+a.type,j=f[c]||d,k=f[c+"Out"]||d,e[h]=j,e[i]=k),j!==d){var m=j.call(f,a,l);f.isReplacing&&(a=m)}return l.visitDeeper&&a&&a.accept&&a.accept(this),k!=d&&k.call(f,a),a},visitArray:function(a,b){if(!a)return a;var c,d=a.length;if(b||!this._implementation.isReplacing){for(c=0;d>c;c++)this.visit(a[c]);return a}var e=[];for(c=0;d>c;c++){var f=this.visit(a[c]);void 0!==f&&(f.splice?f.length&&this.flatten(f,e):e.push(f))}return e},flatten:function(a,b){b||(b=[]);var c,d,e,f,g,h;for(d=0,c=a.length;c>d;d++)if(e=a[d],void 0!==e)if(e.splice)for(g=0,f=e.length;f>g;g++)h=e[g],void 0!==h&&(h.splice?h.length&&this.flatten(h,b):b.push(h));else b.push(e);return b}},b.exports=i},{"../tree":59}],88:[function(a,b,c){function d(){if(!h){h=!0;for(var a,b=g.length;b;){a=g,g=[];for(var c=-1;++c<b;)a[c]();b=g.length}h=!1}}function e(){}var f=b.exports={},g=[],h=!1;f.nextTick=function(a){g.push(a),h||setTimeout(d,0)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.on=e,f.addListener=e,f.once=e,f.off=e,f.removeListener=e,f.removeAllListeners=e,f.emit=e,f.binding=function(a){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(a){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],89:[function(a,b,c){function d(a){function b(a){return null===i?void k.push(a):void g(function(){var b=i?a.onFulfilled:a.onRejected;if(null===b)return void(i?a.resolve:a.reject)(j);var c;try{c=b(j)}catch(d){return void a.reject(d)}a.resolve(c)})}function c(a){try{if(a===l)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var b=a.then;if("function"==typeof b)return void f(b.bind(a),c,d)}i=!0,j=a,h()}catch(e){d(e)}}function d(a){i=!1,j=a,h()}function h(){for(var a=0,c=k.length;c>a;a++)b(k[a]);k=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");var i=null,j=null,k=[],l=this;this.then=function(a,c){return new l.constructor(function(d,f){b(new e(a,c,d,f))})},f(a,c,d)}function e(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function f(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var g=a("asap");b.exports=d},{asap:91}],90:[function(a,b,c){function d(a){this.then=function(b){return"function"!=typeof b?this:new e(function(c,d){f(function(){try{c(b(a))}catch(e){d(e)}})})}}var e=a("./core.js"),f=a("asap");b.exports=e,d.prototype=e.prototype;var g=new d(!0),h=new d(!1),i=new d(null),j=new d(void 0),k=new d(0),l=new d("");e.resolve=function(a){if(a instanceof e)return a;if(null===a)return i;if(void 0===a)return j;if(a===!0)return g;if(a===!1)return h;if(0===a)return k;if(""===a)return l;if("object"==typeof a||"function"==typeof a)try{var b=a.then;if("function"==typeof b)return new e(b.bind(a))}catch(c){return new e(function(a,b){b(c)})}return new d(a)},e.all=function(a){var b=Array.prototype.slice.call(a);return new e(function(a,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}b[f]=g,0===--e&&a(b)}catch(i){c(i)}}if(0===b.length)return a([]);for(var e=b.length,f=0;f<b.length;f++)d(f,b[f])})},e.reject=function(a){return new e(function(b,c){c(a)})},e.race=function(a){return new e(function(b,c){a.forEach(function(a){e.resolve(a).then(b,c)})})},e.prototype["catch"]=function(a){return this.then(null,a)}},{"./core.js":89,asap:91}],91:[function(a,b,c){(function(a){function c(){for(;e.next;){e=e.next;var a=e.task;e.task=void 0;var b=e.domain;b&&(e.domain=void 0,b.enter());try{a()}catch(d){if(i)throw b&&b.exit(),setTimeout(c,0),b&&b.enter(),d;setTimeout(function(){throw d},0)}b&&b.exit()}g=!1}function d(b){f=f.next={task:b,domain:i&&a.domain,next:null},g||(g=!0,h())}var e={task:void 0,next:null},f=e,g=!1,h=void 0,i=!1;if("undefined"!=typeof a&&a.nextTick)i=!0,h=function(){a.nextTick(c)};else if("function"==typeof setImmediate)h="undefined"!=typeof window?setImmediate.bind(window,c):function(){setImmediate(c)};else if("undefined"!=typeof MessageChannel){var j=new MessageChannel;j.port1.onmessage=c,h=function(){j.port2.postMessage(0)}}else h=function(){setTimeout(c,0)};b.exports=d}).call(this,a("_process"))},{_process:88}],92:[function(a,b,c){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(a,b){var c=arguments.length?this.then.apply(this,arguments):this;c.then(null,function(a){setTimeout(function(){throw a},0)})})},{}],"promise/polyfill.js":[function(a,b,c){a("asap");"undefined"==typeof Promise&&(Promise=a("./lib/core.js"),a("./lib/es6-extensions.js")),a("./polyfill-done.js")},{"./lib/core.js":89,"./lib/es6-extensions.js":90,"./polyfill-done.js":92,asap:91}]},{},[2])(2)}),define("extensions.qliktech/widget/widget-util",["assets/external/less/less"],function(a){var b=/\{{[^}]*}}/gim;return{hasAngularBindings:function(a){return a&&(a.match(b)||[]).length>0},processLess:function(b,c){var d="#widget"+c+" {"+b+"}";return a.render(d)}}}),define("extensions.qliktech/widget/widget-properties",["translator"],function(a){function b(a){if(a&&a.properties){var b={};return d(a.properties)&&(b.dimensions=a.properties.dimensions),c(a.properties)&&(b.measures=a.properties.measures),b}return{dimensions:{min:0,max:100},measures:{min:0,max:100}}}function c(a){return a.measures&&(a.measures.max>0||void 0===a.measures.max)}function d(a){return a.dimensions&&(a.dimensions.max>0||void 0===a.dimensions.max)}function e(a){return a.settings&&a.settings.length>0}function f(b){var c={type:"items",component:"accordion",items:{data:{uses:"data"},settings:{uses:"settings"}}};if(b&&b.properties){var d=b.properties;if(e(d)){var f={};d.settings.forEach(function(b,c){var d=c+1;"object"==typeof b?f["property"+d]={ref:b.ref||"property"+d,type:b.type||"string",expression:b.expression||"optional",label:b.label||a.get("Widget.Property",[d]),defaultValue:b.defaultValue,component:b.component,options:b.options,min:b.min,max:b.max,step:b.step}:f["property"+d]={ref:"property"+d,type:"string",expression:"optional",label:b}}),c.items.settings.items={settings:{type:"items",translation:"Widget.Settings",items:f}}}}return c}return{getData:b,getDefinition:f}}),define("extensions.qliktech/widget/widget-minichart",["assets/qvangular/qvangular-core"],function(a){a.directive("qwMiniChart",[function(){return{template:'<div style="position:relative;"></div>',restrict:"E",replace:"true",scope:"=",link:function(a,b,c){var d=b[0];a.$watch(c.values,function(a){if(a){var b=a[0].qNum;a.forEach(function(a){b=Math.max(b,a.qNum)});var c=Math.floor(100/a.length),e=0,f="",g="position:absolute;bottom:0px;clear:both;width:"+c+"%;";a.forEach(function(a,d){f+="<div class='bar bar"+d+"' style='"+g+"left:"+e+"%;height:"+(a.qNum>0?100*a.qNum/b:0)+"%;'></div>",e+=c}),d.innerHTML=f}},!0)}}}])}),define("extensions.qliktech/widget/widget",["qvangular","core.utils/deferred","translator","qlik","workbench/mashupapi/qdata","objects.extension/default-extension","objects.extension/object-conversion","qwidget.model/widget-template","./widget-util","./widget-properties","./widget-minichart"],function(a,b,c,d,e,f,g,h,i,j){function k(a,b){a.htmlElement.innerHTML="<div class='widget-error'>"+b+"</div>"}function l(a,b,d){return b||0!==b.length?void i.processLess(b,d).then(function(b){a.styleElement.innerHTML=b.css},function(b){k(a,c.get("Widget.InvalidCss",[b]))}):void(a.styleElement.innerHTML="")}function m(a,b,d){var e=d.templateId;return a.htmlElement||(a.styleElement=document.createElement("style"),b.appendChild(a.styleElement),a.htmlElement=document.createElement("div"),a.htmlElement.id="widget"+d.qInfo.qId,a.htmlElement.style.height="100%",a.htmlElement.style.overflow="auto",b.appendChild(a.htmlElement)),e?void h.get(e).then(function(b){if(a.template=b,i.hasAngularBindings(b.css)){var c=n("<div>"+b.css+"</div>")(a.$scope);o(function(){l(a,c[0].innerHTML,d.qInfo.qId)})}(e!==a.templateId||a.version!==b.version)&&(i.hasAngularBindings(b.css)||l(a,b.css,d.qInfo.qId),a.templateId=e,a.version=b.version,a.htmlElement.innerHTML=b.html,n(a.htmlElement)(a.$scope))},function(){k(a,c.get("Widget.TemplateNotFound",[e]))}):void k(a,c.get("Widget.NoTemplate"))}var n=a.getService("$compile"),o=a.getService("$timeout");return{initialProperties:{version:1,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:50}]},templateId:""},mapProperties:function(a){var c=this,d=new b,e=h.getLoaded(a.layout.templateId);return c.data=j.getData(e),c.definition=j.getDefinition(e),f.mapProperties.apply(c),d.resolve(),d.promise},snapshot:{canTakeSnapshot:!0},importProperties:function(a,b,c){var d=g.hypercube.importProperties(a,b,c);return b.templateId&&(d.qProperty.templateId=b.templateId),d},paint:function(a,b){this.$scope.app||(this.$scope.app=d.currApp(this)),this.$scope.data||(this.$scope.data=new e(this.backendApi.model,this.$scope.app,this)),this.$scope.layout=b,m(this,a[0],b)},controller:["$scope",function(){}]}});